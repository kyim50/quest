var pJ=Object.defineProperty;var mJ=(e,t,r)=>t in e?pJ(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var gJ=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var kv=(e,t,r)=>mJ(e,typeof t!="symbol"?t+"":t,r);var VCe=gJ((hl,dl)=>{function _J(e,t){for(var r=0;r<t.length;r++){const s=t[r];if(typeof s!="string"&&!Array.isArray(s)){for(const c in s)if(c!=="default"&&!(c in e)){const f=Object.getOwnPropertyDescriptor(s,c);f&&Object.defineProperty(e,c,f.get?f:{enumerable:!0,get:()=>s[c]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const f of c)if(f.type==="childList")for(const _ of f.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function r(c){const f={};return c.integrity&&(f.integrity=c.integrity),c.referrerPolicy&&(f.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?f.credentials="include":c.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function s(c){if(c.ep)return;c.ep=!0;const f=r(c);fetch(c.href,f)}})();var yJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gy(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var x$={exports:{}},uI={},b$={exports:{}},Wr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vx=Symbol.for("react.element"),vJ=Symbol.for("react.portal"),xJ=Symbol.for("react.fragment"),bJ=Symbol.for("react.strict_mode"),wJ=Symbol.for("react.profiler"),TJ=Symbol.for("react.provider"),EJ=Symbol.for("react.context"),SJ=Symbol.for("react.forward_ref"),IJ=Symbol.for("react.suspense"),CJ=Symbol.for("react.memo"),AJ=Symbol.for("react.lazy"),xB=Symbol.iterator;function PJ(e){return e===null||typeof e!="object"?null:(e=xB&&e[xB]||e["@@iterator"],typeof e=="function"?e:null)}var w$={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T$=Object.assign,E$={};function Wy(e,t,r){this.props=e,this.context=t,this.refs=E$,this.updater=r||w$}Wy.prototype.isReactComponent={};Wy.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Wy.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function S$(){}S$.prototype=Wy.prototype;function O4(e,t,r){this.props=e,this.context=t,this.refs=E$,this.updater=r||w$}var L4=O4.prototype=new S$;L4.constructor=O4;T$(L4,Wy.prototype);L4.isPureReactComponent=!0;var bB=Array.isArray,I$=Object.prototype.hasOwnProperty,z4={current:null},C$={key:!0,ref:!0,__self:!0,__source:!0};function A$(e,t,r){var s,c={},f=null,_=null;if(t!=null)for(s in t.ref!==void 0&&(_=t.ref),t.key!==void 0&&(f=""+t.key),t)I$.call(t,s)&&!C$.hasOwnProperty(s)&&(c[s]=t[s]);var x=arguments.length-2;if(x===1)c.children=r;else if(1<x){for(var a=Array(x),I=0;I<x;I++)a[I]=arguments[I+2];c.children=a}if(e&&e.defaultProps)for(s in x=e.defaultProps,x)c[s]===void 0&&(c[s]=x[s]);return{$$typeof:Vx,type:e,key:f,ref:_,props:c,_owner:z4.current}}function RJ(e,t){return{$$typeof:Vx,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function N4(e){return typeof e=="object"&&e!==null&&e.$$typeof===Vx}function MJ(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var wB=/\/+/g;function C3(e,t){return typeof e=="object"&&e!==null&&e.key!=null?MJ(""+e.key):t.toString(36)}function iE(e,t,r,s,c){var f=typeof e;(f==="undefined"||f==="boolean")&&(e=null);var _=!1;if(e===null)_=!0;else switch(f){case"string":case"number":_=!0;break;case"object":switch(e.$$typeof){case Vx:case vJ:_=!0}}if(_)return _=e,c=c(_),e=s===""?"."+C3(_,0):s,bB(c)?(r="",e!=null&&(r=e.replace(wB,"$&/")+"/"),iE(c,t,r,"",function(I){return I})):c!=null&&(N4(c)&&(c=RJ(c,r+(!c.key||_&&_.key===c.key?"":(""+c.key).replace(wB,"$&/")+"/")+e)),t.push(c)),1;if(_=0,s=s===""?".":s+":",bB(e))for(var x=0;x<e.length;x++){f=e[x];var a=s+C3(f,x);_+=iE(f,t,r,a,c)}else if(a=PJ(e),typeof a=="function")for(e=a.call(e),x=0;!(f=e.next()).done;)f=f.value,a=s+C3(f,x++),_+=iE(f,t,r,a,c);else if(f==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return _}function gT(e,t,r){if(e==null)return e;var s=[],c=0;return iE(e,s,"","",function(f){return t.call(r,f,c++)}),s}function kJ(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var xa={current:null},sE={transition:null},DJ={ReactCurrentDispatcher:xa,ReactCurrentBatchConfig:sE,ReactCurrentOwner:z4};function P$(){throw Error("act(...) is not supported in production builds of React.")}Wr.Children={map:gT,forEach:function(e,t,r){gT(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return gT(e,function(){t++}),t},toArray:function(e){return gT(e,function(t){return t})||[]},only:function(e){if(!N4(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Wr.Component=Wy;Wr.Fragment=xJ;Wr.Profiler=wJ;Wr.PureComponent=O4;Wr.StrictMode=bJ;Wr.Suspense=IJ;Wr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DJ;Wr.act=P$;Wr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=T$({},e.props),c=e.key,f=e.ref,_=e._owner;if(t!=null){if(t.ref!==void 0&&(f=t.ref,_=z4.current),t.key!==void 0&&(c=""+t.key),e.type&&e.type.defaultProps)var x=e.type.defaultProps;for(a in t)I$.call(t,a)&&!C$.hasOwnProperty(a)&&(s[a]=t[a]===void 0&&x!==void 0?x[a]:t[a])}var a=arguments.length-2;if(a===1)s.children=r;else if(1<a){x=Array(a);for(var I=0;I<a;I++)x[I]=arguments[I+2];s.children=x}return{$$typeof:Vx,type:e.type,key:c,ref:f,props:s,_owner:_}};Wr.createContext=function(e){return e={$$typeof:EJ,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:TJ,_context:e},e.Consumer=e};Wr.createElement=A$;Wr.createFactory=function(e){var t=A$.bind(null,e);return t.type=e,t};Wr.createRef=function(){return{current:null}};Wr.forwardRef=function(e){return{$$typeof:SJ,render:e}};Wr.isValidElement=N4;Wr.lazy=function(e){return{$$typeof:AJ,_payload:{_status:-1,_result:e},_init:kJ}};Wr.memo=function(e,t){return{$$typeof:CJ,type:e,compare:t===void 0?null:t}};Wr.startTransition=function(e){var t=sE.transition;sE.transition={};try{e()}finally{sE.transition=t}};Wr.unstable_act=P$;Wr.useCallback=function(e,t){return xa.current.useCallback(e,t)};Wr.useContext=function(e){return xa.current.useContext(e)};Wr.useDebugValue=function(){};Wr.useDeferredValue=function(e){return xa.current.useDeferredValue(e)};Wr.useEffect=function(e,t){return xa.current.useEffect(e,t)};Wr.useId=function(){return xa.current.useId()};Wr.useImperativeHandle=function(e,t,r){return xa.current.useImperativeHandle(e,t,r)};Wr.useInsertionEffect=function(e,t){return xa.current.useInsertionEffect(e,t)};Wr.useLayoutEffect=function(e,t){return xa.current.useLayoutEffect(e,t)};Wr.useMemo=function(e,t){return xa.current.useMemo(e,t)};Wr.useReducer=function(e,t,r){return xa.current.useReducer(e,t,r)};Wr.useRef=function(e){return xa.current.useRef(e)};Wr.useState=function(e){return xa.current.useState(e)};Wr.useSyncExternalStore=function(e,t,r){return xa.current.useSyncExternalStore(e,t,r)};Wr.useTransition=function(){return xa.current.useTransition()};Wr.version="18.3.1";b$.exports=Wr;var W=b$.exports;const Gr=Gy(W),jE=_J({__proto__:null,default:Gr},[W]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OJ=W,LJ=Symbol.for("react.element"),zJ=Symbol.for("react.fragment"),NJ=Object.prototype.hasOwnProperty,FJ=OJ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,BJ={key:!0,ref:!0,__self:!0,__source:!0};function R$(e,t,r){var s,c={},f=null,_=null;r!==void 0&&(f=""+r),t.key!==void 0&&(f=""+t.key),t.ref!==void 0&&(_=t.ref);for(s in t)NJ.call(t,s)&&!BJ.hasOwnProperty(s)&&(c[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)c[s]===void 0&&(c[s]=t[s]);return{$$typeof:LJ,type:e,key:f,ref:_,props:c,_owner:FJ.current}}uI.Fragment=zJ;uI.jsx=R$;uI.jsxs=R$;x$.exports=uI;var N=x$.exports,M$={exports:{}},vl={},k$={exports:{}},D$={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(ft,Rt){var Yt=ft.length;ft.push(Rt);e:for(;0<Yt;){var ht=Yt-1>>>1,At=ft[ht];if(0<c(At,Rt))ft[ht]=Rt,ft[Yt]=At,Yt=ht;else break e}}function r(ft){return ft.length===0?null:ft[0]}function s(ft){if(ft.length===0)return null;var Rt=ft[0],Yt=ft.pop();if(Yt!==Rt){ft[0]=Yt;e:for(var ht=0,At=ft.length,wt=At>>>1;ht<wt;){var Xt=2*(ht+1)-1,Ft=ft[Xt],Sn=Xt+1,qn=ft[Sn];if(0>c(Ft,Yt))Sn<At&&0>c(qn,Ft)?(ft[ht]=qn,ft[Sn]=Yt,ht=Sn):(ft[ht]=Ft,ft[Xt]=Yt,ht=Xt);else if(Sn<At&&0>c(qn,Yt))ft[ht]=qn,ft[Sn]=Yt,ht=Sn;else break e}}return Rt}function c(ft,Rt){var Yt=ft.sortIndex-Rt.sortIndex;return Yt!==0?Yt:ft.id-Rt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;e.unstable_now=function(){return f.now()}}else{var _=Date,x=_.now();e.unstable_now=function(){return _.now()-x}}var a=[],I=[],D=1,O=null,F=3,Z=!1,J=!1,re=!1,ne=typeof setTimeout=="function"?setTimeout:null,G=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Q(ft){for(var Rt=r(I);Rt!==null;){if(Rt.callback===null)s(I);else if(Rt.startTime<=ft)s(I),Rt.sortIndex=Rt.expirationTime,t(a,Rt);else break;Rt=r(I)}}function de(ft){if(re=!1,Q(ft),!J)if(r(a)!==null)J=!0,Qt(Te);else{var Rt=r(I);Rt!==null&&kt(de,Rt.startTime-ft)}}function Te(ft,Rt){J=!1,re&&(re=!1,G(he),he=-1),Z=!0;var Yt=F;try{for(Q(Rt),O=r(a);O!==null&&(!(O.expirationTime>Rt)||ft&&!be());){var ht=O.callback;if(typeof ht=="function"){O.callback=null,F=O.priorityLevel;var At=ht(O.expirationTime<=Rt);Rt=e.unstable_now(),typeof At=="function"?O.callback=At:O===r(a)&&s(a),Q(Rt)}else s(a);O=r(a)}if(O!==null)var wt=!0;else{var Xt=r(I);Xt!==null&&kt(de,Xt.startTime-Rt),wt=!1}return wt}finally{O=null,F=Yt,Z=!1}}var we=!1,oe=null,he=-1,X=5,ge=-1;function be(){return!(e.unstable_now()-ge<X)}function ke(){if(oe!==null){var ft=e.unstable_now();ge=ft;var Rt=!0;try{Rt=oe(!0,ft)}finally{Rt?Ee():(we=!1,oe=null)}}else we=!1}var Ee;if(typeof Y=="function")Ee=function(){Y(ke)};else if(typeof MessageChannel<"u"){var zt=new MessageChannel,Ut=zt.port2;zt.port1.onmessage=ke,Ee=function(){Ut.postMessage(null)}}else Ee=function(){ne(ke,0)};function Qt(ft){oe=ft,we||(we=!0,Ee())}function kt(ft,Rt){he=ne(function(){ft(e.unstable_now())},Rt)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ft){ft.callback=null},e.unstable_continueExecution=function(){J||Z||(J=!0,Qt(Te))},e.unstable_forceFrameRate=function(ft){0>ft||125<ft?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<ft?Math.floor(1e3/ft):5},e.unstable_getCurrentPriorityLevel=function(){return F},e.unstable_getFirstCallbackNode=function(){return r(a)},e.unstable_next=function(ft){switch(F){case 1:case 2:case 3:var Rt=3;break;default:Rt=F}var Yt=F;F=Rt;try{return ft()}finally{F=Yt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ft,Rt){switch(ft){case 1:case 2:case 3:case 4:case 5:break;default:ft=3}var Yt=F;F=ft;try{return Rt()}finally{F=Yt}},e.unstable_scheduleCallback=function(ft,Rt,Yt){var ht=e.unstable_now();switch(typeof Yt=="object"&&Yt!==null?(Yt=Yt.delay,Yt=typeof Yt=="number"&&0<Yt?ht+Yt:ht):Yt=ht,ft){case 1:var At=-1;break;case 2:At=250;break;case 5:At=1073741823;break;case 4:At=1e4;break;default:At=5e3}return At=Yt+At,ft={id:D++,callback:Rt,priorityLevel:ft,startTime:Yt,expirationTime:At,sortIndex:-1},Yt>ht?(ft.sortIndex=Yt,t(I,ft),r(a)===null&&ft===r(I)&&(re?(G(he),he=-1):re=!0,kt(de,Yt-ht))):(ft.sortIndex=At,t(a,ft),J||Z||(J=!0,Qt(Te))),ft},e.unstable_shouldYield=be,e.unstable_wrapCallback=function(ft){var Rt=F;return function(){var Yt=F;F=Rt;try{return ft.apply(this,arguments)}finally{F=Yt}}}})(D$);k$.exports=D$;var jJ=k$.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UJ=W,yl=jJ;function cn(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var O$=new Set,W1={};function Zm(e,t){gy(e,t),gy(e+"Capture",t)}function gy(e,t){for(W1[e]=t,e=0;e<t.length;e++)O$.add(t[e])}var Vh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),QR=Object.prototype.hasOwnProperty,VJ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,TB={},EB={};function $J(e){return QR.call(EB,e)?!0:QR.call(TB,e)?!1:VJ.test(e)?EB[e]=!0:(TB[e]=!0,!1)}function qJ(e,t,r,s){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function GJ(e,t,r,s){if(t===null||typeof t>"u"||qJ(e,t,r,s))return!0;if(s)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ba(e,t,r,s,c,f,_){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=c,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=f,this.removeEmptyString=_}var ko={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ko[e]=new ba(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ko[t]=new ba(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ko[e]=new ba(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ko[e]=new ba(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ko[e]=new ba(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ko[e]=new ba(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ko[e]=new ba(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ko[e]=new ba(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ko[e]=new ba(e,5,!1,e.toLowerCase(),null,!1,!1)});var F4=/[\-:]([a-z])/g;function B4(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(F4,B4);ko[t]=new ba(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(F4,B4);ko[t]=new ba(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(F4,B4);ko[t]=new ba(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ko[e]=new ba(e,1,!1,e.toLowerCase(),null,!1,!1)});ko.xlinkHref=new ba("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ko[e]=new ba(e,1,!1,e.toLowerCase(),null,!0,!0)});function j4(e,t,r,s){var c=ko.hasOwnProperty(t)?ko[t]:null;(c!==null?c.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(GJ(t,r,c,s)&&(r=null),s||c===null?$J(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):c.mustUseProperty?e[c.propertyName]=r===null?c.type===3?!1:"":r:(t=c.attributeName,s=c.attributeNamespace,r===null?e.removeAttribute(t):(c=c.type,r=c===3||c===4&&r===!0?"":""+r,s?e.setAttributeNS(s,t,r):e.setAttribute(t,r))))}var td=UJ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_T=Symbol.for("react.element"),O_=Symbol.for("react.portal"),L_=Symbol.for("react.fragment"),U4=Symbol.for("react.strict_mode"),YR=Symbol.for("react.profiler"),L$=Symbol.for("react.provider"),z$=Symbol.for("react.context"),V4=Symbol.for("react.forward_ref"),JR=Symbol.for("react.suspense"),eM=Symbol.for("react.suspense_list"),$4=Symbol.for("react.memo"),nf=Symbol.for("react.lazy"),N$=Symbol.for("react.offscreen"),SB=Symbol.iterator;function Dv(e){return e===null||typeof e!="object"?null:(e=SB&&e[SB]||e["@@iterator"],typeof e=="function"?e:null)}var xs=Object.assign,A3;function Jv(e){if(A3===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);A3=t&&t[1]||""}return`
`+A3+e}var P3=!1;function R3(e,t){if(!e||P3)return"";P3=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(I){var s=I}Reflect.construct(e,[],t)}else{try{t.call()}catch(I){s=I}e.call(t.prototype)}else{try{throw Error()}catch(I){s=I}e()}}catch(I){if(I&&s&&typeof I.stack=="string"){for(var c=I.stack.split(`
`),f=s.stack.split(`
`),_=c.length-1,x=f.length-1;1<=_&&0<=x&&c[_]!==f[x];)x--;for(;1<=_&&0<=x;_--,x--)if(c[_]!==f[x]){if(_!==1||x!==1)do if(_--,x--,0>x||c[_]!==f[x]){var a=`
`+c[_].replace(" at new "," at ");return e.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",e.displayName)),a}while(1<=_&&0<=x);break}}}finally{P3=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Jv(e):""}function WJ(e){switch(e.tag){case 5:return Jv(e.type);case 16:return Jv("Lazy");case 13:return Jv("Suspense");case 19:return Jv("SuspenseList");case 0:case 2:case 15:return e=R3(e.type,!1),e;case 11:return e=R3(e.type.render,!1),e;case 1:return e=R3(e.type,!0),e;default:return""}}function tM(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case L_:return"Fragment";case O_:return"Portal";case YR:return"Profiler";case U4:return"StrictMode";case JR:return"Suspense";case eM:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case z$:return(e.displayName||"Context")+".Consumer";case L$:return(e._context.displayName||"Context")+".Provider";case V4:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case $4:return t=e.displayName||null,t!==null?t:tM(e.type)||"Memo";case nf:t=e._payload,e=e._init;try{return tM(e(t))}catch{}}return null}function HJ(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tM(t);case 8:return t===U4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function kf(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function F$(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function ZJ(e){var t=F$(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,f=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(_){s=""+_,f.call(this,_)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(_){s=""+_},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function yT(e){e._valueTracker||(e._valueTracker=ZJ(e))}function B$(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),s="";return e&&(s=F$(e)?e.checked?"true":"false":e.value),e=s,e!==r?(t.setValue(e),!0):!1}function UE(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function nM(e,t){var r=t.checked;return xs({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function IB(e,t){var r=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;r=kf(t.value!=null?t.value:r),e._wrapperState={initialChecked:s,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function j$(e,t){t=t.checked,t!=null&&j4(e,"checked",t,!1)}function rM(e,t){j$(e,t);var r=kf(t.value),s=t.type;if(r!=null)s==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?iM(e,t.type,r):t.hasOwnProperty("defaultValue")&&iM(e,t.type,kf(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function CB(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function iM(e,t,r){(t!=="number"||UE(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var e1=Array.isArray;function Y_(e,t,r,s){if(e=e.options,t){t={};for(var c=0;c<r.length;c++)t["$"+r[c]]=!0;for(r=0;r<e.length;r++)c=t.hasOwnProperty("$"+e[r].value),e[r].selected!==c&&(e[r].selected=c),c&&s&&(e[r].defaultSelected=!0)}else{for(r=""+kf(r),t=null,c=0;c<e.length;c++){if(e[c].value===r){e[c].selected=!0,s&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function sM(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(cn(91));return xs({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function AB(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(cn(92));if(e1(r)){if(1<r.length)throw Error(cn(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:kf(r)}}function U$(e,t){var r=kf(t.value),s=kf(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),s!=null&&(e.defaultValue=""+s)}function PB(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function V$(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function oM(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?V$(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var vT,$$=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,s,c){MSApp.execUnsafeLocalFunction(function(){return e(t,r,s,c)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(vT=vT||document.createElement("div"),vT.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=vT.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function H1(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var _1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},XJ=["Webkit","ms","Moz","O"];Object.keys(_1).forEach(function(e){XJ.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),_1[t]=_1[e]})});function q$(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||_1.hasOwnProperty(e)&&_1[e]?(""+t).trim():t+"px"}function G$(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var s=r.indexOf("--")===0,c=q$(r,t[r],s);r==="float"&&(r="cssFloat"),s?e.setProperty(r,c):e[r]=c}}var KJ=xs({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function aM(e,t){if(t){if(KJ[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(cn(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(cn(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(cn(61))}if(t.style!=null&&typeof t.style!="object")throw Error(cn(62))}}function lM(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cM=null;function q4(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var uM=null,J_=null,ey=null;function RB(e){if(e=Gx(e)){if(typeof uM!="function")throw Error(cn(280));var t=e.stateNode;t&&(t=mI(t),uM(e.stateNode,e.type,t))}}function W$(e){J_?ey?ey.push(e):ey=[e]:J_=e}function H$(){if(J_){var e=J_,t=ey;if(ey=J_=null,RB(e),t)for(e=0;e<t.length;e++)RB(t[e])}}function Z$(e,t){return e(t)}function X$(){}var M3=!1;function K$(e,t,r){if(M3)return e(t,r);M3=!0;try{return Z$(e,t,r)}finally{M3=!1,(J_!==null||ey!==null)&&(X$(),H$())}}function Z1(e,t){var r=e.stateNode;if(r===null)return null;var s=mI(r);if(s===null)return null;r=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(cn(231,t,typeof r));return r}var hM=!1;if(Vh)try{var Ov={};Object.defineProperty(Ov,"passive",{get:function(){hM=!0}}),window.addEventListener("test",Ov,Ov),window.removeEventListener("test",Ov,Ov)}catch{hM=!1}function QJ(e,t,r,s,c,f,_,x,a){var I=Array.prototype.slice.call(arguments,3);try{t.apply(r,I)}catch(D){this.onError(D)}}var y1=!1,VE=null,$E=!1,dM=null,YJ={onError:function(e){y1=!0,VE=e}};function JJ(e,t,r,s,c,f,_,x,a){y1=!1,VE=null,QJ.apply(YJ,arguments)}function eee(e,t,r,s,c,f,_,x,a){if(JJ.apply(this,arguments),y1){if(y1){var I=VE;y1=!1,VE=null}else throw Error(cn(198));$E||($E=!0,dM=I)}}function Xm(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Q$(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function MB(e){if(Xm(e)!==e)throw Error(cn(188))}function tee(e){var t=e.alternate;if(!t){if(t=Xm(e),t===null)throw Error(cn(188));return t!==e?null:e}for(var r=e,s=t;;){var c=r.return;if(c===null)break;var f=c.alternate;if(f===null){if(s=c.return,s!==null){r=s;continue}break}if(c.child===f.child){for(f=c.child;f;){if(f===r)return MB(c),e;if(f===s)return MB(c),t;f=f.sibling}throw Error(cn(188))}if(r.return!==s.return)r=c,s=f;else{for(var _=!1,x=c.child;x;){if(x===r){_=!0,r=c,s=f;break}if(x===s){_=!0,s=c,r=f;break}x=x.sibling}if(!_){for(x=f.child;x;){if(x===r){_=!0,r=f,s=c;break}if(x===s){_=!0,s=f,r=c;break}x=x.sibling}if(!_)throw Error(cn(189))}}if(r.alternate!==s)throw Error(cn(190))}if(r.tag!==3)throw Error(cn(188));return r.stateNode.current===r?e:t}function Y$(e){return e=tee(e),e!==null?J$(e):null}function J$(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=J$(e);if(t!==null)return t;e=e.sibling}return null}var e9=yl.unstable_scheduleCallback,kB=yl.unstable_cancelCallback,nee=yl.unstable_shouldYield,ree=yl.unstable_requestPaint,Us=yl.unstable_now,iee=yl.unstable_getCurrentPriorityLevel,G4=yl.unstable_ImmediatePriority,t9=yl.unstable_UserBlockingPriority,qE=yl.unstable_NormalPriority,see=yl.unstable_LowPriority,n9=yl.unstable_IdlePriority,hI=null,Ou=null;function oee(e){if(Ou&&typeof Ou.onCommitFiberRoot=="function")try{Ou.onCommitFiberRoot(hI,e,void 0,(e.current.flags&128)===128)}catch{}}var Fc=Math.clz32?Math.clz32:cee,aee=Math.log,lee=Math.LN2;function cee(e){return e>>>=0,e===0?32:31-(aee(e)/lee|0)|0}var xT=64,bT=4194304;function t1(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function GE(e,t){var r=e.pendingLanes;if(r===0)return 0;var s=0,c=e.suspendedLanes,f=e.pingedLanes,_=r&268435455;if(_!==0){var x=_&~c;x!==0?s=t1(x):(f&=_,f!==0&&(s=t1(f)))}else _=r&~c,_!==0?s=t1(_):f!==0&&(s=t1(f));if(s===0)return 0;if(t!==0&&t!==s&&!(t&c)&&(c=s&-s,f=t&-t,c>=f||c===16&&(f&4194240)!==0))return t;if(s&4&&(s|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)r=31-Fc(t),c=1<<r,s|=e[r],t&=~c;return s}function uee(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hee(e,t){for(var r=e.suspendedLanes,s=e.pingedLanes,c=e.expirationTimes,f=e.pendingLanes;0<f;){var _=31-Fc(f),x=1<<_,a=c[_];a===-1?(!(x&r)||x&s)&&(c[_]=uee(x,t)):a<=t&&(e.expiredLanes|=x),f&=~x}}function fM(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function r9(){var e=xT;return xT<<=1,!(xT&4194240)&&(xT=64),e}function k3(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function $x(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Fc(t),e[t]=r}function dee(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<r;){var c=31-Fc(r),f=1<<c;t[c]=0,s[c]=-1,e[c]=-1,r&=~f}}function W4(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var s=31-Fc(r),c=1<<s;c&t|e[s]&t&&(e[s]|=t),r&=~c}}var Ti=0;function i9(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var s9,H4,o9,a9,l9,pM=!1,wT=[],yf=null,vf=null,xf=null,X1=new Map,K1=new Map,sf=[],fee="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function DB(e,t){switch(e){case"focusin":case"focusout":yf=null;break;case"dragenter":case"dragleave":vf=null;break;case"mouseover":case"mouseout":xf=null;break;case"pointerover":case"pointerout":X1.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":K1.delete(t.pointerId)}}function Lv(e,t,r,s,c,f){return e===null||e.nativeEvent!==f?(e={blockedOn:t,domEventName:r,eventSystemFlags:s,nativeEvent:f,targetContainers:[c]},t!==null&&(t=Gx(t),t!==null&&H4(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function pee(e,t,r,s,c){switch(t){case"focusin":return yf=Lv(yf,e,t,r,s,c),!0;case"dragenter":return vf=Lv(vf,e,t,r,s,c),!0;case"mouseover":return xf=Lv(xf,e,t,r,s,c),!0;case"pointerover":var f=c.pointerId;return X1.set(f,Lv(X1.get(f)||null,e,t,r,s,c)),!0;case"gotpointercapture":return f=c.pointerId,K1.set(f,Lv(K1.get(f)||null,e,t,r,s,c)),!0}return!1}function c9(e){var t=um(e.target);if(t!==null){var r=Xm(t);if(r!==null){if(t=r.tag,t===13){if(t=Q$(r),t!==null){e.blockedOn=t,l9(e.priority,function(){o9(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function oE(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=mM(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var s=new r.constructor(r.type,r);cM=s,r.target.dispatchEvent(s),cM=null}else return t=Gx(r),t!==null&&H4(t),e.blockedOn=r,!1;t.shift()}return!0}function OB(e,t,r){oE(e)&&r.delete(t)}function mee(){pM=!1,yf!==null&&oE(yf)&&(yf=null),vf!==null&&oE(vf)&&(vf=null),xf!==null&&oE(xf)&&(xf=null),X1.forEach(OB),K1.forEach(OB)}function zv(e,t){e.blockedOn===t&&(e.blockedOn=null,pM||(pM=!0,yl.unstable_scheduleCallback(yl.unstable_NormalPriority,mee)))}function Q1(e){function t(c){return zv(c,e)}if(0<wT.length){zv(wT[0],e);for(var r=1;r<wT.length;r++){var s=wT[r];s.blockedOn===e&&(s.blockedOn=null)}}for(yf!==null&&zv(yf,e),vf!==null&&zv(vf,e),xf!==null&&zv(xf,e),X1.forEach(t),K1.forEach(t),r=0;r<sf.length;r++)s=sf[r],s.blockedOn===e&&(s.blockedOn=null);for(;0<sf.length&&(r=sf[0],r.blockedOn===null);)c9(r),r.blockedOn===null&&sf.shift()}var ty=td.ReactCurrentBatchConfig,WE=!0;function gee(e,t,r,s){var c=Ti,f=ty.transition;ty.transition=null;try{Ti=1,Z4(e,t,r,s)}finally{Ti=c,ty.transition=f}}function _ee(e,t,r,s){var c=Ti,f=ty.transition;ty.transition=null;try{Ti=4,Z4(e,t,r,s)}finally{Ti=c,ty.transition=f}}function Z4(e,t,r,s){if(WE){var c=mM(e,t,r,s);if(c===null)V3(e,t,s,HE,r),DB(e,s);else if(pee(c,e,t,r,s))s.stopPropagation();else if(DB(e,s),t&4&&-1<fee.indexOf(e)){for(;c!==null;){var f=Gx(c);if(f!==null&&s9(f),f=mM(e,t,r,s),f===null&&V3(e,t,s,HE,r),f===c)break;c=f}c!==null&&s.stopPropagation()}else V3(e,t,s,null,r)}}var HE=null;function mM(e,t,r,s){if(HE=null,e=q4(s),e=um(e),e!==null)if(t=Xm(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Q$(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return HE=e,null}function u9(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(iee()){case G4:return 1;case t9:return 4;case qE:case see:return 16;case n9:return 536870912;default:return 16}default:return 16}}var hf=null,X4=null,aE=null;function h9(){if(aE)return aE;var e,t=X4,r=t.length,s,c="value"in hf?hf.value:hf.textContent,f=c.length;for(e=0;e<r&&t[e]===c[e];e++);var _=r-e;for(s=1;s<=_&&t[r-s]===c[f-s];s++);return aE=c.slice(e,1<s?1-s:void 0)}function lE(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function TT(){return!0}function LB(){return!1}function xl(e){function t(r,s,c,f,_){this._reactName=r,this._targetInst=c,this.type=s,this.nativeEvent=f,this.target=_,this.currentTarget=null;for(var x in e)e.hasOwnProperty(x)&&(r=e[x],this[x]=r?r(f):f[x]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?TT:LB,this.isPropagationStopped=LB,this}return xs(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=TT)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=TT)},persist:function(){},isPersistent:TT}),t}var Hy={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},K4=xl(Hy),qx=xs({},Hy,{view:0,detail:0}),yee=xl(qx),D3,O3,Nv,dI=xs({},qx,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Q4,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Nv&&(Nv&&e.type==="mousemove"?(D3=e.screenX-Nv.screenX,O3=e.screenY-Nv.screenY):O3=D3=0,Nv=e),D3)},movementY:function(e){return"movementY"in e?e.movementY:O3}}),zB=xl(dI),vee=xs({},dI,{dataTransfer:0}),xee=xl(vee),bee=xs({},qx,{relatedTarget:0}),L3=xl(bee),wee=xs({},Hy,{animationName:0,elapsedTime:0,pseudoElement:0}),Tee=xl(wee),Eee=xs({},Hy,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),See=xl(Eee),Iee=xs({},Hy,{data:0}),NB=xl(Iee),Cee={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Aee={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pee={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ree(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Pee[e])?!!t[e]:!1}function Q4(){return Ree}var Mee=xs({},qx,{key:function(e){if(e.key){var t=Cee[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=lE(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Aee[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Q4,charCode:function(e){return e.type==="keypress"?lE(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?lE(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),kee=xl(Mee),Dee=xs({},dI,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),FB=xl(Dee),Oee=xs({},qx,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Q4}),Lee=xl(Oee),zee=xs({},Hy,{propertyName:0,elapsedTime:0,pseudoElement:0}),Nee=xl(zee),Fee=xs({},dI,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Bee=xl(Fee),jee=[9,13,27,32],Y4=Vh&&"CompositionEvent"in window,v1=null;Vh&&"documentMode"in document&&(v1=document.documentMode);var Uee=Vh&&"TextEvent"in window&&!v1,d9=Vh&&(!Y4||v1&&8<v1&&11>=v1),BB=" ",jB=!1;function f9(e,t){switch(e){case"keyup":return jee.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function p9(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var z_=!1;function Vee(e,t){switch(e){case"compositionend":return p9(t);case"keypress":return t.which!==32?null:(jB=!0,BB);case"textInput":return e=t.data,e===BB&&jB?null:e;default:return null}}function $ee(e,t){if(z_)return e==="compositionend"||!Y4&&f9(e,t)?(e=h9(),aE=X4=hf=null,z_=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return d9&&t.locale!=="ko"?null:t.data;default:return null}}var qee={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function UB(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!qee[e.type]:t==="textarea"}function m9(e,t,r,s){W$(s),t=ZE(t,"onChange"),0<t.length&&(r=new K4("onChange","change",null,r,s),e.push({event:r,listeners:t}))}var x1=null,Y1=null;function Gee(e){I9(e,0)}function fI(e){var t=B_(e);if(B$(t))return e}function Wee(e,t){if(e==="change")return t}var g9=!1;if(Vh){var z3;if(Vh){var N3="oninput"in document;if(!N3){var VB=document.createElement("div");VB.setAttribute("oninput","return;"),N3=typeof VB.oninput=="function"}z3=N3}else z3=!1;g9=z3&&(!document.documentMode||9<document.documentMode)}function $B(){x1&&(x1.detachEvent("onpropertychange",_9),Y1=x1=null)}function _9(e){if(e.propertyName==="value"&&fI(Y1)){var t=[];m9(t,Y1,e,q4(e)),K$(Gee,t)}}function Hee(e,t,r){e==="focusin"?($B(),x1=t,Y1=r,x1.attachEvent("onpropertychange",_9)):e==="focusout"&&$B()}function Zee(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return fI(Y1)}function Xee(e,t){if(e==="click")return fI(t)}function Kee(e,t){if(e==="input"||e==="change")return fI(t)}function Qee(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Vc=typeof Object.is=="function"?Object.is:Qee;function J1(e,t){if(Vc(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var c=r[s];if(!QR.call(t,c)||!Vc(e[c],t[c]))return!1}return!0}function qB(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function GB(e,t){var r=qB(e);e=0;for(var s;r;){if(r.nodeType===3){if(s=e+r.textContent.length,e<=t&&s>=t)return{node:r,offset:t-e};e=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=qB(r)}}function y9(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?y9(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function v9(){for(var e=window,t=UE();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=UE(e.document)}return t}function J4(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Yee(e){var t=v9(),r=e.focusedElem,s=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&y9(r.ownerDocument.documentElement,r)){if(s!==null&&J4(r)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var c=r.textContent.length,f=Math.min(s.start,c);s=s.end===void 0?f:Math.min(s.end,c),!e.extend&&f>s&&(c=s,s=f,f=c),c=GB(r,f);var _=GB(r,s);c&&_&&(e.rangeCount!==1||e.anchorNode!==c.node||e.anchorOffset!==c.offset||e.focusNode!==_.node||e.focusOffset!==_.offset)&&(t=t.createRange(),t.setStart(c.node,c.offset),e.removeAllRanges(),f>s?(e.addRange(t),e.extend(_.node,_.offset)):(t.setEnd(_.node,_.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Jee=Vh&&"documentMode"in document&&11>=document.documentMode,N_=null,gM=null,b1=null,_M=!1;function WB(e,t,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;_M||N_==null||N_!==UE(s)||(s=N_,"selectionStart"in s&&J4(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),b1&&J1(b1,s)||(b1=s,s=ZE(gM,"onSelect"),0<s.length&&(t=new K4("onSelect","select",null,t,r),e.push({event:t,listeners:s}),t.target=N_)))}function ET(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var F_={animationend:ET("Animation","AnimationEnd"),animationiteration:ET("Animation","AnimationIteration"),animationstart:ET("Animation","AnimationStart"),transitionend:ET("Transition","TransitionEnd")},F3={},x9={};Vh&&(x9=document.createElement("div").style,"AnimationEvent"in window||(delete F_.animationend.animation,delete F_.animationiteration.animation,delete F_.animationstart.animation),"TransitionEvent"in window||delete F_.transitionend.transition);function pI(e){if(F3[e])return F3[e];if(!F_[e])return e;var t=F_[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in x9)return F3[e]=t[r];return e}var b9=pI("animationend"),w9=pI("animationiteration"),T9=pI("animationstart"),E9=pI("transitionend"),S9=new Map,HB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qf(e,t){S9.set(e,t),Zm(t,[e])}for(var B3=0;B3<HB.length;B3++){var j3=HB[B3],ete=j3.toLowerCase(),tte=j3[0].toUpperCase()+j3.slice(1);qf(ete,"on"+tte)}qf(b9,"onAnimationEnd");qf(w9,"onAnimationIteration");qf(T9,"onAnimationStart");qf("dblclick","onDoubleClick");qf("focusin","onFocus");qf("focusout","onBlur");qf(E9,"onTransitionEnd");gy("onMouseEnter",["mouseout","mouseover"]);gy("onMouseLeave",["mouseout","mouseover"]);gy("onPointerEnter",["pointerout","pointerover"]);gy("onPointerLeave",["pointerout","pointerover"]);Zm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Zm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Zm("onBeforeInput",["compositionend","keypress","textInput","paste"]);Zm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Zm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Zm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var n1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nte=new Set("cancel close invalid load scroll toggle".split(" ").concat(n1));function ZB(e,t,r){var s=e.type||"unknown-event";e.currentTarget=r,eee(s,t,void 0,e),e.currentTarget=null}function I9(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var s=e[r],c=s.event;s=s.listeners;e:{var f=void 0;if(t)for(var _=s.length-1;0<=_;_--){var x=s[_],a=x.instance,I=x.currentTarget;if(x=x.listener,a!==f&&c.isPropagationStopped())break e;ZB(c,x,I),f=a}else for(_=0;_<s.length;_++){if(x=s[_],a=x.instance,I=x.currentTarget,x=x.listener,a!==f&&c.isPropagationStopped())break e;ZB(c,x,I),f=a}}}if($E)throw e=dM,$E=!1,dM=null,e}function Zi(e,t){var r=t[wM];r===void 0&&(r=t[wM]=new Set);var s=e+"__bubble";r.has(s)||(C9(t,e,2,!1),r.add(s))}function U3(e,t,r){var s=0;t&&(s|=4),C9(r,e,s,t)}var ST="_reactListening"+Math.random().toString(36).slice(2);function ex(e){if(!e[ST]){e[ST]=!0,O$.forEach(function(r){r!=="selectionchange"&&(nte.has(r)||U3(r,!1,e),U3(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ST]||(t[ST]=!0,U3("selectionchange",!1,t))}}function C9(e,t,r,s){switch(u9(t)){case 1:var c=gee;break;case 4:c=_ee;break;default:c=Z4}r=c.bind(null,t,r,e),c=void 0,!hM||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),s?c!==void 0?e.addEventListener(t,r,{capture:!0,passive:c}):e.addEventListener(t,r,!0):c!==void 0?e.addEventListener(t,r,{passive:c}):e.addEventListener(t,r,!1)}function V3(e,t,r,s,c){var f=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var _=s.tag;if(_===3||_===4){var x=s.stateNode.containerInfo;if(x===c||x.nodeType===8&&x.parentNode===c)break;if(_===4)for(_=s.return;_!==null;){var a=_.tag;if((a===3||a===4)&&(a=_.stateNode.containerInfo,a===c||a.nodeType===8&&a.parentNode===c))return;_=_.return}for(;x!==null;){if(_=um(x),_===null)return;if(a=_.tag,a===5||a===6){s=f=_;continue e}x=x.parentNode}}s=s.return}K$(function(){var I=f,D=q4(r),O=[];e:{var F=S9.get(e);if(F!==void 0){var Z=K4,J=e;switch(e){case"keypress":if(lE(r)===0)break e;case"keydown":case"keyup":Z=kee;break;case"focusin":J="focus",Z=L3;break;case"focusout":J="blur",Z=L3;break;case"beforeblur":case"afterblur":Z=L3;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=zB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=xee;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=Lee;break;case b9:case w9:case T9:Z=Tee;break;case E9:Z=Nee;break;case"scroll":Z=yee;break;case"wheel":Z=Bee;break;case"copy":case"cut":case"paste":Z=See;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=FB}var re=(t&4)!==0,ne=!re&&e==="scroll",G=re?F!==null?F+"Capture":null:F;re=[];for(var Y=I,Q;Y!==null;){Q=Y;var de=Q.stateNode;if(Q.tag===5&&de!==null&&(Q=de,G!==null&&(de=Z1(Y,G),de!=null&&re.push(tx(Y,de,Q)))),ne)break;Y=Y.return}0<re.length&&(F=new Z(F,J,null,r,D),O.push({event:F,listeners:re}))}}if(!(t&7)){e:{if(F=e==="mouseover"||e==="pointerover",Z=e==="mouseout"||e==="pointerout",F&&r!==cM&&(J=r.relatedTarget||r.fromElement)&&(um(J)||J[$h]))break e;if((Z||F)&&(F=D.window===D?D:(F=D.ownerDocument)?F.defaultView||F.parentWindow:window,Z?(J=r.relatedTarget||r.toElement,Z=I,J=J?um(J):null,J!==null&&(ne=Xm(J),J!==ne||J.tag!==5&&J.tag!==6)&&(J=null)):(Z=null,J=I),Z!==J)){if(re=zB,de="onMouseLeave",G="onMouseEnter",Y="mouse",(e==="pointerout"||e==="pointerover")&&(re=FB,de="onPointerLeave",G="onPointerEnter",Y="pointer"),ne=Z==null?F:B_(Z),Q=J==null?F:B_(J),F=new re(de,Y+"leave",Z,r,D),F.target=ne,F.relatedTarget=Q,de=null,um(D)===I&&(re=new re(G,Y+"enter",J,r,D),re.target=Q,re.relatedTarget=ne,de=re),ne=de,Z&&J)t:{for(re=Z,G=J,Y=0,Q=re;Q;Q=__(Q))Y++;for(Q=0,de=G;de;de=__(de))Q++;for(;0<Y-Q;)re=__(re),Y--;for(;0<Q-Y;)G=__(G),Q--;for(;Y--;){if(re===G||G!==null&&re===G.alternate)break t;re=__(re),G=__(G)}re=null}else re=null;Z!==null&&XB(O,F,Z,re,!1),J!==null&&ne!==null&&XB(O,ne,J,re,!0)}}e:{if(F=I?B_(I):window,Z=F.nodeName&&F.nodeName.toLowerCase(),Z==="select"||Z==="input"&&F.type==="file")var Te=Wee;else if(UB(F))if(g9)Te=Kee;else{Te=Zee;var we=Hee}else(Z=F.nodeName)&&Z.toLowerCase()==="input"&&(F.type==="checkbox"||F.type==="radio")&&(Te=Xee);if(Te&&(Te=Te(e,I))){m9(O,Te,r,D);break e}we&&we(e,F,I),e==="focusout"&&(we=F._wrapperState)&&we.controlled&&F.type==="number"&&iM(F,"number",F.value)}switch(we=I?B_(I):window,e){case"focusin":(UB(we)||we.contentEditable==="true")&&(N_=we,gM=I,b1=null);break;case"focusout":b1=gM=N_=null;break;case"mousedown":_M=!0;break;case"contextmenu":case"mouseup":case"dragend":_M=!1,WB(O,r,D);break;case"selectionchange":if(Jee)break;case"keydown":case"keyup":WB(O,r,D)}var oe;if(Y4)e:{switch(e){case"compositionstart":var he="onCompositionStart";break e;case"compositionend":he="onCompositionEnd";break e;case"compositionupdate":he="onCompositionUpdate";break e}he=void 0}else z_?f9(e,r)&&(he="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(he="onCompositionStart");he&&(d9&&r.locale!=="ko"&&(z_||he!=="onCompositionStart"?he==="onCompositionEnd"&&z_&&(oe=h9()):(hf=D,X4="value"in hf?hf.value:hf.textContent,z_=!0)),we=ZE(I,he),0<we.length&&(he=new NB(he,e,null,r,D),O.push({event:he,listeners:we}),oe?he.data=oe:(oe=p9(r),oe!==null&&(he.data=oe)))),(oe=Uee?Vee(e,r):$ee(e,r))&&(I=ZE(I,"onBeforeInput"),0<I.length&&(D=new NB("onBeforeInput","beforeinput",null,r,D),O.push({event:D,listeners:I}),D.data=oe))}I9(O,t)})}function tx(e,t,r){return{instance:e,listener:t,currentTarget:r}}function ZE(e,t){for(var r=t+"Capture",s=[];e!==null;){var c=e,f=c.stateNode;c.tag===5&&f!==null&&(c=f,f=Z1(e,r),f!=null&&s.unshift(tx(e,f,c)),f=Z1(e,t),f!=null&&s.push(tx(e,f,c))),e=e.return}return s}function __(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function XB(e,t,r,s,c){for(var f=t._reactName,_=[];r!==null&&r!==s;){var x=r,a=x.alternate,I=x.stateNode;if(a!==null&&a===s)break;x.tag===5&&I!==null&&(x=I,c?(a=Z1(r,f),a!=null&&_.unshift(tx(r,a,x))):c||(a=Z1(r,f),a!=null&&_.push(tx(r,a,x)))),r=r.return}_.length!==0&&e.push({event:t,listeners:_})}var rte=/\r\n?/g,ite=/\u0000|\uFFFD/g;function KB(e){return(typeof e=="string"?e:""+e).replace(rte,`
`).replace(ite,"")}function IT(e,t,r){if(t=KB(t),KB(e)!==t&&r)throw Error(cn(425))}function XE(){}var yM=null,vM=null;function xM(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var bM=typeof setTimeout=="function"?setTimeout:void 0,ste=typeof clearTimeout=="function"?clearTimeout:void 0,QB=typeof Promise=="function"?Promise:void 0,ote=typeof queueMicrotask=="function"?queueMicrotask:typeof QB<"u"?function(e){return QB.resolve(null).then(e).catch(ate)}:bM;function ate(e){setTimeout(function(){throw e})}function $3(e,t){var r=t,s=0;do{var c=r.nextSibling;if(e.removeChild(r),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(s===0){e.removeChild(c),Q1(t);return}s--}else r!=="$"&&r!=="$?"&&r!=="$!"||s++;r=c}while(r);Q1(t)}function bf(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function YB(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Zy=Math.random().toString(36).slice(2),Pu="__reactFiber$"+Zy,nx="__reactProps$"+Zy,$h="__reactContainer$"+Zy,wM="__reactEvents$"+Zy,lte="__reactListeners$"+Zy,cte="__reactHandles$"+Zy;function um(e){var t=e[Pu];if(t)return t;for(var r=e.parentNode;r;){if(t=r[$h]||r[Pu]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=YB(e);e!==null;){if(r=e[Pu])return r;e=YB(e)}return t}e=r,r=e.parentNode}return null}function Gx(e){return e=e[Pu]||e[$h],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function B_(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(cn(33))}function mI(e){return e[nx]||null}var TM=[],j_=-1;function Gf(e){return{current:e}}function es(e){0>j_||(e.current=TM[j_],TM[j_]=null,j_--)}function qi(e,t){j_++,TM[j_]=e.current,e.current=t}var Df={},Yo=Gf(Df),ja=Gf(!1),Rm=Df;function _y(e,t){var r=e.type.contextTypes;if(!r)return Df;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var c={},f;for(f in r)c[f]=t[f];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=c),c}function Ua(e){return e=e.childContextTypes,e!=null}function KE(){es(ja),es(Yo)}function JB(e,t,r){if(Yo.current!==Df)throw Error(cn(168));qi(Yo,t),qi(ja,r)}function A9(e,t,r){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return r;s=s.getChildContext();for(var c in s)if(!(c in t))throw Error(cn(108,HJ(e)||"Unknown",c));return xs({},r,s)}function QE(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Df,Rm=Yo.current,qi(Yo,e),qi(ja,ja.current),!0}function e6(e,t,r){var s=e.stateNode;if(!s)throw Error(cn(169));r?(e=A9(e,t,Rm),s.__reactInternalMemoizedMergedChildContext=e,es(ja),es(Yo),qi(Yo,e)):es(ja),qi(ja,r)}var Ph=null,gI=!1,q3=!1;function P9(e){Ph===null?Ph=[e]:Ph.push(e)}function ute(e){gI=!0,P9(e)}function Wf(){if(!q3&&Ph!==null){q3=!0;var e=0,t=Ti;try{var r=Ph;for(Ti=1;e<r.length;e++){var s=r[e];do s=s(!0);while(s!==null)}Ph=null,gI=!1}catch(c){throw Ph!==null&&(Ph=Ph.slice(e+1)),e9(G4,Wf),c}finally{Ti=t,q3=!1}}return null}var U_=[],V_=0,YE=null,JE=0,Bl=[],jl=0,Mm=null,kh=1,Dh="";function Jp(e,t){U_[V_++]=JE,U_[V_++]=YE,YE=e,JE=t}function R9(e,t,r){Bl[jl++]=kh,Bl[jl++]=Dh,Bl[jl++]=Mm,Mm=e;var s=kh;e=Dh;var c=32-Fc(s)-1;s&=~(1<<c),r+=1;var f=32-Fc(t)+c;if(30<f){var _=c-c%5;f=(s&(1<<_)-1).toString(32),s>>=_,c-=_,kh=1<<32-Fc(t)+c|r<<c|s,Dh=f+e}else kh=1<<f|r<<c|s,Dh=e}function eD(e){e.return!==null&&(Jp(e,1),R9(e,1,0))}function tD(e){for(;e===YE;)YE=U_[--V_],U_[V_]=null,JE=U_[--V_],U_[V_]=null;for(;e===Mm;)Mm=Bl[--jl],Bl[jl]=null,Dh=Bl[--jl],Bl[jl]=null,kh=Bl[--jl],Bl[jl]=null}var fl=null,al=null,hs=!1,kc=null;function M9(e,t){var r=Wl(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function t6(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,fl=e,al=bf(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,fl=e,al=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Mm!==null?{id:kh,overflow:Dh}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Wl(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,fl=e,al=null,!0):!1;default:return!1}}function EM(e){return(e.mode&1)!==0&&(e.flags&128)===0}function SM(e){if(hs){var t=al;if(t){var r=t;if(!t6(e,t)){if(EM(e))throw Error(cn(418));t=bf(r.nextSibling);var s=fl;t&&t6(e,t)?M9(s,r):(e.flags=e.flags&-4097|2,hs=!1,fl=e)}}else{if(EM(e))throw Error(cn(418));e.flags=e.flags&-4097|2,hs=!1,fl=e}}}function n6(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;fl=e}function CT(e){if(e!==fl)return!1;if(!hs)return n6(e),hs=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!xM(e.type,e.memoizedProps)),t&&(t=al)){if(EM(e))throw k9(),Error(cn(418));for(;t;)M9(e,t),t=bf(t.nextSibling)}if(n6(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(cn(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){al=bf(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}al=null}}else al=fl?bf(e.stateNode.nextSibling):null;return!0}function k9(){for(var e=al;e;)e=bf(e.nextSibling)}function yy(){al=fl=null,hs=!1}function nD(e){kc===null?kc=[e]:kc.push(e)}var hte=td.ReactCurrentBatchConfig;function Fv(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(cn(309));var s=r.stateNode}if(!s)throw Error(cn(147,e));var c=s,f=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===f?t.ref:(t=function(_){var x=c.refs;_===null?delete x[f]:x[f]=_},t._stringRef=f,t)}if(typeof e!="string")throw Error(cn(284));if(!r._owner)throw Error(cn(290,e))}return e}function AT(e,t){throw e=Object.prototype.toString.call(t),Error(cn(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function r6(e){var t=e._init;return t(e._payload)}function D9(e){function t(G,Y){if(e){var Q=G.deletions;Q===null?(G.deletions=[Y],G.flags|=16):Q.push(Y)}}function r(G,Y){if(!e)return null;for(;Y!==null;)t(G,Y),Y=Y.sibling;return null}function s(G,Y){for(G=new Map;Y!==null;)Y.key!==null?G.set(Y.key,Y):G.set(Y.index,Y),Y=Y.sibling;return G}function c(G,Y){return G=Sf(G,Y),G.index=0,G.sibling=null,G}function f(G,Y,Q){return G.index=Q,e?(Q=G.alternate,Q!==null?(Q=Q.index,Q<Y?(G.flags|=2,Y):Q):(G.flags|=2,Y)):(G.flags|=1048576,Y)}function _(G){return e&&G.alternate===null&&(G.flags|=2),G}function x(G,Y,Q,de){return Y===null||Y.tag!==6?(Y=Q3(Q,G.mode,de),Y.return=G,Y):(Y=c(Y,Q),Y.return=G,Y)}function a(G,Y,Q,de){var Te=Q.type;return Te===L_?D(G,Y,Q.props.children,de,Q.key):Y!==null&&(Y.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===nf&&r6(Te)===Y.type)?(de=c(Y,Q.props),de.ref=Fv(G,Y,Q),de.return=G,de):(de=mE(Q.type,Q.key,Q.props,null,G.mode,de),de.ref=Fv(G,Y,Q),de.return=G,de)}function I(G,Y,Q,de){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==Q.containerInfo||Y.stateNode.implementation!==Q.implementation?(Y=Y3(Q,G.mode,de),Y.return=G,Y):(Y=c(Y,Q.children||[]),Y.return=G,Y)}function D(G,Y,Q,de,Te){return Y===null||Y.tag!==7?(Y=xm(Q,G.mode,de,Te),Y.return=G,Y):(Y=c(Y,Q),Y.return=G,Y)}function O(G,Y,Q){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=Q3(""+Y,G.mode,Q),Y.return=G,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case _T:return Q=mE(Y.type,Y.key,Y.props,null,G.mode,Q),Q.ref=Fv(G,null,Y),Q.return=G,Q;case O_:return Y=Y3(Y,G.mode,Q),Y.return=G,Y;case nf:var de=Y._init;return O(G,de(Y._payload),Q)}if(e1(Y)||Dv(Y))return Y=xm(Y,G.mode,Q,null),Y.return=G,Y;AT(G,Y)}return null}function F(G,Y,Q,de){var Te=Y!==null?Y.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Te!==null?null:x(G,Y,""+Q,de);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case _T:return Q.key===Te?a(G,Y,Q,de):null;case O_:return Q.key===Te?I(G,Y,Q,de):null;case nf:return Te=Q._init,F(G,Y,Te(Q._payload),de)}if(e1(Q)||Dv(Q))return Te!==null?null:D(G,Y,Q,de,null);AT(G,Q)}return null}function Z(G,Y,Q,de,Te){if(typeof de=="string"&&de!==""||typeof de=="number")return G=G.get(Q)||null,x(Y,G,""+de,Te);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case _T:return G=G.get(de.key===null?Q:de.key)||null,a(Y,G,de,Te);case O_:return G=G.get(de.key===null?Q:de.key)||null,I(Y,G,de,Te);case nf:var we=de._init;return Z(G,Y,Q,we(de._payload),Te)}if(e1(de)||Dv(de))return G=G.get(Q)||null,D(Y,G,de,Te,null);AT(Y,de)}return null}function J(G,Y,Q,de){for(var Te=null,we=null,oe=Y,he=Y=0,X=null;oe!==null&&he<Q.length;he++){oe.index>he?(X=oe,oe=null):X=oe.sibling;var ge=F(G,oe,Q[he],de);if(ge===null){oe===null&&(oe=X);break}e&&oe&&ge.alternate===null&&t(G,oe),Y=f(ge,Y,he),we===null?Te=ge:we.sibling=ge,we=ge,oe=X}if(he===Q.length)return r(G,oe),hs&&Jp(G,he),Te;if(oe===null){for(;he<Q.length;he++)oe=O(G,Q[he],de),oe!==null&&(Y=f(oe,Y,he),we===null?Te=oe:we.sibling=oe,we=oe);return hs&&Jp(G,he),Te}for(oe=s(G,oe);he<Q.length;he++)X=Z(oe,G,he,Q[he],de),X!==null&&(e&&X.alternate!==null&&oe.delete(X.key===null?he:X.key),Y=f(X,Y,he),we===null?Te=X:we.sibling=X,we=X);return e&&oe.forEach(function(be){return t(G,be)}),hs&&Jp(G,he),Te}function re(G,Y,Q,de){var Te=Dv(Q);if(typeof Te!="function")throw Error(cn(150));if(Q=Te.call(Q),Q==null)throw Error(cn(151));for(var we=Te=null,oe=Y,he=Y=0,X=null,ge=Q.next();oe!==null&&!ge.done;he++,ge=Q.next()){oe.index>he?(X=oe,oe=null):X=oe.sibling;var be=F(G,oe,ge.value,de);if(be===null){oe===null&&(oe=X);break}e&&oe&&be.alternate===null&&t(G,oe),Y=f(be,Y,he),we===null?Te=be:we.sibling=be,we=be,oe=X}if(ge.done)return r(G,oe),hs&&Jp(G,he),Te;if(oe===null){for(;!ge.done;he++,ge=Q.next())ge=O(G,ge.value,de),ge!==null&&(Y=f(ge,Y,he),we===null?Te=ge:we.sibling=ge,we=ge);return hs&&Jp(G,he),Te}for(oe=s(G,oe);!ge.done;he++,ge=Q.next())ge=Z(oe,G,he,ge.value,de),ge!==null&&(e&&ge.alternate!==null&&oe.delete(ge.key===null?he:ge.key),Y=f(ge,Y,he),we===null?Te=ge:we.sibling=ge,we=ge);return e&&oe.forEach(function(ke){return t(G,ke)}),hs&&Jp(G,he),Te}function ne(G,Y,Q,de){if(typeof Q=="object"&&Q!==null&&Q.type===L_&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case _T:e:{for(var Te=Q.key,we=Y;we!==null;){if(we.key===Te){if(Te=Q.type,Te===L_){if(we.tag===7){r(G,we.sibling),Y=c(we,Q.props.children),Y.return=G,G=Y;break e}}else if(we.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===nf&&r6(Te)===we.type){r(G,we.sibling),Y=c(we,Q.props),Y.ref=Fv(G,we,Q),Y.return=G,G=Y;break e}r(G,we);break}else t(G,we);we=we.sibling}Q.type===L_?(Y=xm(Q.props.children,G.mode,de,Q.key),Y.return=G,G=Y):(de=mE(Q.type,Q.key,Q.props,null,G.mode,de),de.ref=Fv(G,Y,Q),de.return=G,G=de)}return _(G);case O_:e:{for(we=Q.key;Y!==null;){if(Y.key===we)if(Y.tag===4&&Y.stateNode.containerInfo===Q.containerInfo&&Y.stateNode.implementation===Q.implementation){r(G,Y.sibling),Y=c(Y,Q.children||[]),Y.return=G,G=Y;break e}else{r(G,Y);break}else t(G,Y);Y=Y.sibling}Y=Y3(Q,G.mode,de),Y.return=G,G=Y}return _(G);case nf:return we=Q._init,ne(G,Y,we(Q._payload),de)}if(e1(Q))return J(G,Y,Q,de);if(Dv(Q))return re(G,Y,Q,de);AT(G,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"?(Q=""+Q,Y!==null&&Y.tag===6?(r(G,Y.sibling),Y=c(Y,Q),Y.return=G,G=Y):(r(G,Y),Y=Q3(Q,G.mode,de),Y.return=G,G=Y),_(G)):r(G,Y)}return ne}var vy=D9(!0),O9=D9(!1),eS=Gf(null),tS=null,$_=null,rD=null;function iD(){rD=$_=tS=null}function sD(e){var t=eS.current;es(eS),e._currentValue=t}function IM(e,t,r){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===r)break;e=e.return}}function ny(e,t){tS=e,rD=$_=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Fa=!0),e.firstContext=null)}function Xl(e){var t=e._currentValue;if(rD!==e)if(e={context:e,memoizedValue:t,next:null},$_===null){if(tS===null)throw Error(cn(308));$_=e,tS.dependencies={lanes:0,firstContext:e}}else $_=$_.next=e;return t}var hm=null;function oD(e){hm===null?hm=[e]:hm.push(e)}function L9(e,t,r,s){var c=t.interleaved;return c===null?(r.next=r,oD(t)):(r.next=c.next,c.next=r),t.interleaved=r,qh(e,s)}function qh(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var rf=!1;function aD(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function z9(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Nh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function wf(e,t,r){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,ri&2){var c=s.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),s.pending=t,qh(e,r)}return c=s.interleaved,c===null?(t.next=t,oD(s)):(t.next=c.next,c.next=t),s.interleaved=t,qh(e,r)}function cE(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,W4(e,r)}}function i6(e,t){var r=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var c=null,f=null;if(r=r.firstBaseUpdate,r!==null){do{var _={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};f===null?c=f=_:f=f.next=_,r=r.next}while(r!==null);f===null?c=f=t:f=f.next=t}else c=f=t;r={baseState:s.baseState,firstBaseUpdate:c,lastBaseUpdate:f,shared:s.shared,effects:s.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function nS(e,t,r,s){var c=e.updateQueue;rf=!1;var f=c.firstBaseUpdate,_=c.lastBaseUpdate,x=c.shared.pending;if(x!==null){c.shared.pending=null;var a=x,I=a.next;a.next=null,_===null?f=I:_.next=I,_=a;var D=e.alternate;D!==null&&(D=D.updateQueue,x=D.lastBaseUpdate,x!==_&&(x===null?D.firstBaseUpdate=I:x.next=I,D.lastBaseUpdate=a))}if(f!==null){var O=c.baseState;_=0,D=I=a=null,x=f;do{var F=x.lane,Z=x.eventTime;if((s&F)===F){D!==null&&(D=D.next={eventTime:Z,lane:0,tag:x.tag,payload:x.payload,callback:x.callback,next:null});e:{var J=e,re=x;switch(F=t,Z=r,re.tag){case 1:if(J=re.payload,typeof J=="function"){O=J.call(Z,O,F);break e}O=J;break e;case 3:J.flags=J.flags&-65537|128;case 0:if(J=re.payload,F=typeof J=="function"?J.call(Z,O,F):J,F==null)break e;O=xs({},O,F);break e;case 2:rf=!0}}x.callback!==null&&x.lane!==0&&(e.flags|=64,F=c.effects,F===null?c.effects=[x]:F.push(x))}else Z={eventTime:Z,lane:F,tag:x.tag,payload:x.payload,callback:x.callback,next:null},D===null?(I=D=Z,a=O):D=D.next=Z,_|=F;if(x=x.next,x===null){if(x=c.shared.pending,x===null)break;F=x,x=F.next,F.next=null,c.lastBaseUpdate=F,c.shared.pending=null}}while(!0);if(D===null&&(a=O),c.baseState=a,c.firstBaseUpdate=I,c.lastBaseUpdate=D,t=c.shared.interleaved,t!==null){c=t;do _|=c.lane,c=c.next;while(c!==t)}else f===null&&(c.shared.lanes=0);Dm|=_,e.lanes=_,e.memoizedState=O}}function s6(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],c=s.callback;if(c!==null){if(s.callback=null,s=r,typeof c!="function")throw Error(cn(191,c));c.call(s)}}}var Wx={},Lu=Gf(Wx),rx=Gf(Wx),ix=Gf(Wx);function dm(e){if(e===Wx)throw Error(cn(174));return e}function lD(e,t){switch(qi(ix,t),qi(rx,e),qi(Lu,Wx),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:oM(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=oM(t,e)}es(Lu),qi(Lu,t)}function xy(){es(Lu),es(rx),es(ix)}function N9(e){dm(ix.current);var t=dm(Lu.current),r=oM(t,e.type);t!==r&&(qi(rx,e),qi(Lu,r))}function cD(e){rx.current===e&&(es(Lu),es(rx))}var ys=Gf(0);function rS(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var G3=[];function uD(){for(var e=0;e<G3.length;e++)G3[e]._workInProgressVersionPrimary=null;G3.length=0}var uE=td.ReactCurrentDispatcher,W3=td.ReactCurrentBatchConfig,km=0,vs=null,lo=null,xo=null,iS=!1,w1=!1,sx=0,dte=0;function $o(){throw Error(cn(321))}function hD(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Vc(e[r],t[r]))return!1;return!0}function dD(e,t,r,s,c,f){if(km=f,vs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,uE.current=e===null||e.memoizedState===null?gte:_te,e=r(s,c),w1){f=0;do{if(w1=!1,sx=0,25<=f)throw Error(cn(301));f+=1,xo=lo=null,t.updateQueue=null,uE.current=yte,e=r(s,c)}while(w1)}if(uE.current=sS,t=lo!==null&&lo.next!==null,km=0,xo=lo=vs=null,iS=!1,t)throw Error(cn(300));return e}function fD(){var e=sx!==0;return sx=0,e}function wu(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xo===null?vs.memoizedState=xo=e:xo=xo.next=e,xo}function Kl(){if(lo===null){var e=vs.alternate;e=e!==null?e.memoizedState:null}else e=lo.next;var t=xo===null?vs.memoizedState:xo.next;if(t!==null)xo=t,lo=e;else{if(e===null)throw Error(cn(310));lo=e,e={memoizedState:lo.memoizedState,baseState:lo.baseState,baseQueue:lo.baseQueue,queue:lo.queue,next:null},xo===null?vs.memoizedState=xo=e:xo=xo.next=e}return xo}function ox(e,t){return typeof t=="function"?t(e):t}function H3(e){var t=Kl(),r=t.queue;if(r===null)throw Error(cn(311));r.lastRenderedReducer=e;var s=lo,c=s.baseQueue,f=r.pending;if(f!==null){if(c!==null){var _=c.next;c.next=f.next,f.next=_}s.baseQueue=c=f,r.pending=null}if(c!==null){f=c.next,s=s.baseState;var x=_=null,a=null,I=f;do{var D=I.lane;if((km&D)===D)a!==null&&(a=a.next={lane:0,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null}),s=I.hasEagerState?I.eagerState:e(s,I.action);else{var O={lane:D,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null};a===null?(x=a=O,_=s):a=a.next=O,vs.lanes|=D,Dm|=D}I=I.next}while(I!==null&&I!==f);a===null?_=s:a.next=x,Vc(s,t.memoizedState)||(Fa=!0),t.memoizedState=s,t.baseState=_,t.baseQueue=a,r.lastRenderedState=s}if(e=r.interleaved,e!==null){c=e;do f=c.lane,vs.lanes|=f,Dm|=f,c=c.next;while(c!==e)}else c===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Z3(e){var t=Kl(),r=t.queue;if(r===null)throw Error(cn(311));r.lastRenderedReducer=e;var s=r.dispatch,c=r.pending,f=t.memoizedState;if(c!==null){r.pending=null;var _=c=c.next;do f=e(f,_.action),_=_.next;while(_!==c);Vc(f,t.memoizedState)||(Fa=!0),t.memoizedState=f,t.baseQueue===null&&(t.baseState=f),r.lastRenderedState=f}return[f,s]}function F9(){}function B9(e,t){var r=vs,s=Kl(),c=t(),f=!Vc(s.memoizedState,c);if(f&&(s.memoizedState=c,Fa=!0),s=s.queue,pD(V9.bind(null,r,s,e),[e]),s.getSnapshot!==t||f||xo!==null&&xo.memoizedState.tag&1){if(r.flags|=2048,ax(9,U9.bind(null,r,s,c,t),void 0,null),wo===null)throw Error(cn(349));km&30||j9(r,t,c)}return c}function j9(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=vs.updateQueue,t===null?(t={lastEffect:null,stores:null},vs.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function U9(e,t,r,s){t.value=r,t.getSnapshot=s,$9(t)&&q9(e)}function V9(e,t,r){return r(function(){$9(t)&&q9(e)})}function $9(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Vc(e,r)}catch{return!0}}function q9(e){var t=qh(e,1);t!==null&&Bc(t,e,1,-1)}function o6(e){var t=wu();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ox,lastRenderedState:e},t.queue=e,e=e.dispatch=mte.bind(null,vs,e),[t.memoizedState,e]}function ax(e,t,r,s){return e={tag:e,create:t,destroy:r,deps:s,next:null},t=vs.updateQueue,t===null?(t={lastEffect:null,stores:null},vs.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,t.lastEffect=e)),e}function G9(){return Kl().memoizedState}function hE(e,t,r,s){var c=wu();vs.flags|=e,c.memoizedState=ax(1|t,r,void 0,s===void 0?null:s)}function _I(e,t,r,s){var c=Kl();s=s===void 0?null:s;var f=void 0;if(lo!==null){var _=lo.memoizedState;if(f=_.destroy,s!==null&&hD(s,_.deps)){c.memoizedState=ax(t,r,f,s);return}}vs.flags|=e,c.memoizedState=ax(1|t,r,f,s)}function a6(e,t){return hE(8390656,8,e,t)}function pD(e,t){return _I(2048,8,e,t)}function W9(e,t){return _I(4,2,e,t)}function H9(e,t){return _I(4,4,e,t)}function Z9(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function X9(e,t,r){return r=r!=null?r.concat([e]):null,_I(4,4,Z9.bind(null,t,e),r)}function mD(){}function K9(e,t){var r=Kl();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&hD(t,s[1])?s[0]:(r.memoizedState=[e,t],e)}function Q9(e,t){var r=Kl();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&hD(t,s[1])?s[0]:(e=e(),r.memoizedState=[e,t],e)}function Y9(e,t,r){return km&21?(Vc(r,t)||(r=r9(),vs.lanes|=r,Dm|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Fa=!0),e.memoizedState=r)}function fte(e,t){var r=Ti;Ti=r!==0&&4>r?r:4,e(!0);var s=W3.transition;W3.transition={};try{e(!1),t()}finally{Ti=r,W3.transition=s}}function J9(){return Kl().memoizedState}function pte(e,t,r){var s=Ef(e);if(r={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null},e7(e))t7(t,r);else if(r=L9(e,t,r,s),r!==null){var c=va();Bc(r,e,s,c),n7(r,t,s)}}function mte(e,t,r){var s=Ef(e),c={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null};if(e7(e))t7(t,c);else{var f=e.alternate;if(e.lanes===0&&(f===null||f.lanes===0)&&(f=t.lastRenderedReducer,f!==null))try{var _=t.lastRenderedState,x=f(_,r);if(c.hasEagerState=!0,c.eagerState=x,Vc(x,_)){var a=t.interleaved;a===null?(c.next=c,oD(t)):(c.next=a.next,a.next=c),t.interleaved=c;return}}catch{}finally{}r=L9(e,t,c,s),r!==null&&(c=va(),Bc(r,e,s,c),n7(r,t,s))}}function e7(e){var t=e.alternate;return e===vs||t!==null&&t===vs}function t7(e,t){w1=iS=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function n7(e,t,r){if(r&4194240){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,W4(e,r)}}var sS={readContext:Xl,useCallback:$o,useContext:$o,useEffect:$o,useImperativeHandle:$o,useInsertionEffect:$o,useLayoutEffect:$o,useMemo:$o,useReducer:$o,useRef:$o,useState:$o,useDebugValue:$o,useDeferredValue:$o,useTransition:$o,useMutableSource:$o,useSyncExternalStore:$o,useId:$o,unstable_isNewReconciler:!1},gte={readContext:Xl,useCallback:function(e,t){return wu().memoizedState=[e,t===void 0?null:t],e},useContext:Xl,useEffect:a6,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,hE(4194308,4,Z9.bind(null,t,e),r)},useLayoutEffect:function(e,t){return hE(4194308,4,e,t)},useInsertionEffect:function(e,t){return hE(4,2,e,t)},useMemo:function(e,t){var r=wu();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var s=wu();return t=r!==void 0?r(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=pte.bind(null,vs,e),[s.memoizedState,e]},useRef:function(e){var t=wu();return e={current:e},t.memoizedState=e},useState:o6,useDebugValue:mD,useDeferredValue:function(e){return wu().memoizedState=e},useTransition:function(){var e=o6(!1),t=e[0];return e=fte.bind(null,e[1]),wu().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var s=vs,c=wu();if(hs){if(r===void 0)throw Error(cn(407));r=r()}else{if(r=t(),wo===null)throw Error(cn(349));km&30||j9(s,t,r)}c.memoizedState=r;var f={value:r,getSnapshot:t};return c.queue=f,a6(V9.bind(null,s,f,e),[e]),s.flags|=2048,ax(9,U9.bind(null,s,f,r,t),void 0,null),r},useId:function(){var e=wu(),t=wo.identifierPrefix;if(hs){var r=Dh,s=kh;r=(s&~(1<<32-Fc(s)-1)).toString(32)+r,t=":"+t+"R"+r,r=sx++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=dte++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},_te={readContext:Xl,useCallback:K9,useContext:Xl,useEffect:pD,useImperativeHandle:X9,useInsertionEffect:W9,useLayoutEffect:H9,useMemo:Q9,useReducer:H3,useRef:G9,useState:function(){return H3(ox)},useDebugValue:mD,useDeferredValue:function(e){var t=Kl();return Y9(t,lo.memoizedState,e)},useTransition:function(){var e=H3(ox)[0],t=Kl().memoizedState;return[e,t]},useMutableSource:F9,useSyncExternalStore:B9,useId:J9,unstable_isNewReconciler:!1},yte={readContext:Xl,useCallback:K9,useContext:Xl,useEffect:pD,useImperativeHandle:X9,useInsertionEffect:W9,useLayoutEffect:H9,useMemo:Q9,useReducer:Z3,useRef:G9,useState:function(){return Z3(ox)},useDebugValue:mD,useDeferredValue:function(e){var t=Kl();return lo===null?t.memoizedState=e:Y9(t,lo.memoizedState,e)},useTransition:function(){var e=Z3(ox)[0],t=Kl().memoizedState;return[e,t]},useMutableSource:F9,useSyncExternalStore:B9,useId:J9,unstable_isNewReconciler:!1};function Rc(e,t){if(e&&e.defaultProps){t=xs({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function CM(e,t,r,s){t=e.memoizedState,r=r(s,t),r=r==null?t:xs({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var yI={isMounted:function(e){return(e=e._reactInternals)?Xm(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var s=va(),c=Ef(e),f=Nh(s,c);f.payload=t,r!=null&&(f.callback=r),t=wf(e,f,c),t!==null&&(Bc(t,e,c,s),cE(t,e,c))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var s=va(),c=Ef(e),f=Nh(s,c);f.tag=1,f.payload=t,r!=null&&(f.callback=r),t=wf(e,f,c),t!==null&&(Bc(t,e,c,s),cE(t,e,c))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=va(),s=Ef(e),c=Nh(r,s);c.tag=2,t!=null&&(c.callback=t),t=wf(e,c,s),t!==null&&(Bc(t,e,s,r),cE(t,e,s))}};function l6(e,t,r,s,c,f,_){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,f,_):t.prototype&&t.prototype.isPureReactComponent?!J1(r,s)||!J1(c,f):!0}function r7(e,t,r){var s=!1,c=Df,f=t.contextType;return typeof f=="object"&&f!==null?f=Xl(f):(c=Ua(t)?Rm:Yo.current,s=t.contextTypes,f=(s=s!=null)?_y(e,c):Df),t=new t(r,f),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=yI,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=c,e.__reactInternalMemoizedMaskedChildContext=f),t}function c6(e,t,r,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,s),t.state!==e&&yI.enqueueReplaceState(t,t.state,null)}function AM(e,t,r,s){var c=e.stateNode;c.props=r,c.state=e.memoizedState,c.refs={},aD(e);var f=t.contextType;typeof f=="object"&&f!==null?c.context=Xl(f):(f=Ua(t)?Rm:Yo.current,c.context=_y(e,f)),c.state=e.memoizedState,f=t.getDerivedStateFromProps,typeof f=="function"&&(CM(e,t,f,r),c.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(t=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),t!==c.state&&yI.enqueueReplaceState(c,c.state,null),nS(e,r,c,s),c.state=e.memoizedState),typeof c.componentDidMount=="function"&&(e.flags|=4194308)}function by(e,t){try{var r="",s=t;do r+=WJ(s),s=s.return;while(s);var c=r}catch(f){c=`
Error generating stack: `+f.message+`
`+f.stack}return{value:e,source:t,stack:c,digest:null}}function X3(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function PM(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var vte=typeof WeakMap=="function"?WeakMap:Map;function i7(e,t,r){r=Nh(-1,r),r.tag=3,r.payload={element:null};var s=t.value;return r.callback=function(){aS||(aS=!0,BM=s),PM(e,t)},r}function s7(e,t,r){r=Nh(-1,r),r.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var c=t.value;r.payload=function(){return s(c)},r.callback=function(){PM(e,t)}}var f=e.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(r.callback=function(){PM(e,t),typeof s!="function"&&(Tf===null?Tf=new Set([this]):Tf.add(this));var _=t.stack;this.componentDidCatch(t.value,{componentStack:_!==null?_:""})}),r}function u6(e,t,r){var s=e.pingCache;if(s===null){s=e.pingCache=new vte;var c=new Set;s.set(t,c)}else c=s.get(t),c===void 0&&(c=new Set,s.set(t,c));c.has(r)||(c.add(r),e=Dte.bind(null,e,t,r),t.then(e,e))}function h6(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function d6(e,t,r,s,c){return e.mode&1?(e.flags|=65536,e.lanes=c,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Nh(-1,1),t.tag=2,wf(r,t,1))),r.lanes|=1),e)}var xte=td.ReactCurrentOwner,Fa=!1;function ga(e,t,r,s){t.child=e===null?O9(t,null,r,s):vy(t,e.child,r,s)}function f6(e,t,r,s,c){r=r.render;var f=t.ref;return ny(t,c),s=dD(e,t,r,s,f,c),r=fD(),e!==null&&!Fa?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Gh(e,t,c)):(hs&&r&&eD(t),t.flags|=1,ga(e,t,s,c),t.child)}function p6(e,t,r,s,c){if(e===null){var f=r.type;return typeof f=="function"&&!TD(f)&&f.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=f,o7(e,t,f,s,c)):(e=mE(r.type,null,s,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(f=e.child,!(e.lanes&c)){var _=f.memoizedProps;if(r=r.compare,r=r!==null?r:J1,r(_,s)&&e.ref===t.ref)return Gh(e,t,c)}return t.flags|=1,e=Sf(f,s),e.ref=t.ref,e.return=t,t.child=e}function o7(e,t,r,s,c){if(e!==null){var f=e.memoizedProps;if(J1(f,s)&&e.ref===t.ref)if(Fa=!1,t.pendingProps=s=f,(e.lanes&c)!==0)e.flags&131072&&(Fa=!0);else return t.lanes=e.lanes,Gh(e,t,c)}return RM(e,t,r,s,c)}function a7(e,t,r){var s=t.pendingProps,c=s.children,f=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},qi(G_,sl),sl|=r;else{if(!(r&1073741824))return e=f!==null?f.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,qi(G_,sl),sl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=f!==null?f.baseLanes:r,qi(G_,sl),sl|=s}else f!==null?(s=f.baseLanes|r,t.memoizedState=null):s=r,qi(G_,sl),sl|=s;return ga(e,t,c,r),t.child}function l7(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function RM(e,t,r,s,c){var f=Ua(r)?Rm:Yo.current;return f=_y(t,f),ny(t,c),r=dD(e,t,r,s,f,c),s=fD(),e!==null&&!Fa?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Gh(e,t,c)):(hs&&s&&eD(t),t.flags|=1,ga(e,t,r,c),t.child)}function m6(e,t,r,s,c){if(Ua(r)){var f=!0;QE(t)}else f=!1;if(ny(t,c),t.stateNode===null)dE(e,t),r7(t,r,s),AM(t,r,s,c),s=!0;else if(e===null){var _=t.stateNode,x=t.memoizedProps;_.props=x;var a=_.context,I=r.contextType;typeof I=="object"&&I!==null?I=Xl(I):(I=Ua(r)?Rm:Yo.current,I=_y(t,I));var D=r.getDerivedStateFromProps,O=typeof D=="function"||typeof _.getSnapshotBeforeUpdate=="function";O||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(x!==s||a!==I)&&c6(t,_,s,I),rf=!1;var F=t.memoizedState;_.state=F,nS(t,s,_,c),a=t.memoizedState,x!==s||F!==a||ja.current||rf?(typeof D=="function"&&(CM(t,r,D,s),a=t.memoizedState),(x=rf||l6(t,r,x,s,F,a,I))?(O||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(t.flags|=4194308)):(typeof _.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=a),_.props=s,_.state=a,_.context=I,s=x):(typeof _.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{_=t.stateNode,z9(e,t),x=t.memoizedProps,I=t.type===t.elementType?x:Rc(t.type,x),_.props=I,O=t.pendingProps,F=_.context,a=r.contextType,typeof a=="object"&&a!==null?a=Xl(a):(a=Ua(r)?Rm:Yo.current,a=_y(t,a));var Z=r.getDerivedStateFromProps;(D=typeof Z=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(x!==O||F!==a)&&c6(t,_,s,a),rf=!1,F=t.memoizedState,_.state=F,nS(t,s,_,c);var J=t.memoizedState;x!==O||F!==J||ja.current||rf?(typeof Z=="function"&&(CM(t,r,Z,s),J=t.memoizedState),(I=rf||l6(t,r,I,s,F,J,a)||!1)?(D||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(s,J,a),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(s,J,a)),typeof _.componentDidUpdate=="function"&&(t.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof _.componentDidUpdate!="function"||x===e.memoizedProps&&F===e.memoizedState||(t.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||x===e.memoizedProps&&F===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=J),_.props=s,_.state=J,_.context=a,s=I):(typeof _.componentDidUpdate!="function"||x===e.memoizedProps&&F===e.memoizedState||(t.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||x===e.memoizedProps&&F===e.memoizedState||(t.flags|=1024),s=!1)}return MM(e,t,r,s,f,c)}function MM(e,t,r,s,c,f){l7(e,t);var _=(t.flags&128)!==0;if(!s&&!_)return c&&e6(t,r,!1),Gh(e,t,f);s=t.stateNode,xte.current=t;var x=_&&typeof r.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&_?(t.child=vy(t,e.child,null,f),t.child=vy(t,null,x,f)):ga(e,t,x,f),t.memoizedState=s.state,c&&e6(t,r,!0),t.child}function c7(e){var t=e.stateNode;t.pendingContext?JB(e,t.pendingContext,t.pendingContext!==t.context):t.context&&JB(e,t.context,!1),lD(e,t.containerInfo)}function g6(e,t,r,s,c){return yy(),nD(c),t.flags|=256,ga(e,t,r,s),t.child}var kM={dehydrated:null,treeContext:null,retryLane:0};function DM(e){return{baseLanes:e,cachePool:null,transitions:null}}function u7(e,t,r){var s=t.pendingProps,c=ys.current,f=!1,_=(t.flags&128)!==0,x;if((x=_)||(x=e!==null&&e.memoizedState===null?!1:(c&2)!==0),x?(f=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(c|=1),qi(ys,c&1),e===null)return SM(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(_=s.children,e=s.fallback,f?(s=t.mode,f=t.child,_={mode:"hidden",children:_},!(s&1)&&f!==null?(f.childLanes=0,f.pendingProps=_):f=bI(_,s,0,null),e=xm(e,s,r,null),f.return=t,e.return=t,f.sibling=e,t.child=f,t.child.memoizedState=DM(r),t.memoizedState=kM,e):gD(t,_));if(c=e.memoizedState,c!==null&&(x=c.dehydrated,x!==null))return bte(e,t,_,s,x,c,r);if(f){f=s.fallback,_=t.mode,c=e.child,x=c.sibling;var a={mode:"hidden",children:s.children};return!(_&1)&&t.child!==c?(s=t.child,s.childLanes=0,s.pendingProps=a,t.deletions=null):(s=Sf(c,a),s.subtreeFlags=c.subtreeFlags&14680064),x!==null?f=Sf(x,f):(f=xm(f,_,r,null),f.flags|=2),f.return=t,s.return=t,s.sibling=f,t.child=s,s=f,f=t.child,_=e.child.memoizedState,_=_===null?DM(r):{baseLanes:_.baseLanes|r,cachePool:null,transitions:_.transitions},f.memoizedState=_,f.childLanes=e.childLanes&~r,t.memoizedState=kM,s}return f=e.child,e=f.sibling,s=Sf(f,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=r),s.return=t,s.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=s,t.memoizedState=null,s}function gD(e,t){return t=bI({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function PT(e,t,r,s){return s!==null&&nD(s),vy(t,e.child,null,r),e=gD(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function bte(e,t,r,s,c,f,_){if(r)return t.flags&256?(t.flags&=-257,s=X3(Error(cn(422))),PT(e,t,_,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(f=s.fallback,c=t.mode,s=bI({mode:"visible",children:s.children},c,0,null),f=xm(f,c,_,null),f.flags|=2,s.return=t,f.return=t,s.sibling=f,t.child=s,t.mode&1&&vy(t,e.child,null,_),t.child.memoizedState=DM(_),t.memoizedState=kM,f);if(!(t.mode&1))return PT(e,t,_,null);if(c.data==="$!"){if(s=c.nextSibling&&c.nextSibling.dataset,s)var x=s.dgst;return s=x,f=Error(cn(419)),s=X3(f,s,void 0),PT(e,t,_,s)}if(x=(_&e.childLanes)!==0,Fa||x){if(s=wo,s!==null){switch(_&-_){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(s.suspendedLanes|_)?0:c,c!==0&&c!==f.retryLane&&(f.retryLane=c,qh(e,c),Bc(s,e,c,-1))}return wD(),s=X3(Error(cn(421))),PT(e,t,_,s)}return c.data==="$?"?(t.flags|=128,t.child=e.child,t=Ote.bind(null,e),c._reactRetry=t,null):(e=f.treeContext,al=bf(c.nextSibling),fl=t,hs=!0,kc=null,e!==null&&(Bl[jl++]=kh,Bl[jl++]=Dh,Bl[jl++]=Mm,kh=e.id,Dh=e.overflow,Mm=t),t=gD(t,s.children),t.flags|=4096,t)}function _6(e,t,r){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),IM(e.return,t,r)}function K3(e,t,r,s,c){var f=e.memoizedState;f===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:c}:(f.isBackwards=t,f.rendering=null,f.renderingStartTime=0,f.last=s,f.tail=r,f.tailMode=c)}function h7(e,t,r){var s=t.pendingProps,c=s.revealOrder,f=s.tail;if(ga(e,t,s.children,r),s=ys.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&_6(e,r,t);else if(e.tag===19)_6(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(qi(ys,s),!(t.mode&1))t.memoizedState=null;else switch(c){case"forwards":for(r=t.child,c=null;r!==null;)e=r.alternate,e!==null&&rS(e)===null&&(c=r),r=r.sibling;r=c,r===null?(c=t.child,t.child=null):(c=r.sibling,r.sibling=null),K3(t,!1,c,r,f);break;case"backwards":for(r=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&rS(e)===null){t.child=c;break}e=c.sibling,c.sibling=r,r=c,c=e}K3(t,!0,r,null,f);break;case"together":K3(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function dE(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Gh(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Dm|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(cn(153));if(t.child!==null){for(e=t.child,r=Sf(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Sf(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function wte(e,t,r){switch(t.tag){case 3:c7(t),yy();break;case 5:N9(t);break;case 1:Ua(t.type)&&QE(t);break;case 4:lD(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,c=t.memoizedProps.value;qi(eS,s._currentValue),s._currentValue=c;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(qi(ys,ys.current&1),t.flags|=128,null):r&t.child.childLanes?u7(e,t,r):(qi(ys,ys.current&1),e=Gh(e,t,r),e!==null?e.sibling:null);qi(ys,ys.current&1);break;case 19:if(s=(r&t.childLanes)!==0,e.flags&128){if(s)return h7(e,t,r);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),qi(ys,ys.current),s)break;return null;case 22:case 23:return t.lanes=0,a7(e,t,r)}return Gh(e,t,r)}var d7,OM,f7,p7;d7=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};OM=function(){};f7=function(e,t,r,s){var c=e.memoizedProps;if(c!==s){e=t.stateNode,dm(Lu.current);var f=null;switch(r){case"input":c=nM(e,c),s=nM(e,s),f=[];break;case"select":c=xs({},c,{value:void 0}),s=xs({},s,{value:void 0}),f=[];break;case"textarea":c=sM(e,c),s=sM(e,s),f=[];break;default:typeof c.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=XE)}aM(r,s);var _;r=null;for(I in c)if(!s.hasOwnProperty(I)&&c.hasOwnProperty(I)&&c[I]!=null)if(I==="style"){var x=c[I];for(_ in x)x.hasOwnProperty(_)&&(r||(r={}),r[_]="")}else I!=="dangerouslySetInnerHTML"&&I!=="children"&&I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(W1.hasOwnProperty(I)?f||(f=[]):(f=f||[]).push(I,null));for(I in s){var a=s[I];if(x=c!=null?c[I]:void 0,s.hasOwnProperty(I)&&a!==x&&(a!=null||x!=null))if(I==="style")if(x){for(_ in x)!x.hasOwnProperty(_)||a&&a.hasOwnProperty(_)||(r||(r={}),r[_]="");for(_ in a)a.hasOwnProperty(_)&&x[_]!==a[_]&&(r||(r={}),r[_]=a[_])}else r||(f||(f=[]),f.push(I,r)),r=a;else I==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,x=x?x.__html:void 0,a!=null&&x!==a&&(f=f||[]).push(I,a)):I==="children"?typeof a!="string"&&typeof a!="number"||(f=f||[]).push(I,""+a):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&(W1.hasOwnProperty(I)?(a!=null&&I==="onScroll"&&Zi("scroll",e),f||x===a||(f=[])):(f=f||[]).push(I,a))}r&&(f=f||[]).push("style",r);var I=f;(t.updateQueue=I)&&(t.flags|=4)}};p7=function(e,t,r,s){r!==s&&(t.flags|=4)};function Bv(e,t){if(!hs)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function qo(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,s=0;if(t)for(var c=e.child;c!==null;)r|=c.lanes|c.childLanes,s|=c.subtreeFlags&14680064,s|=c.flags&14680064,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)r|=c.lanes|c.childLanes,s|=c.subtreeFlags,s|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=s,e.childLanes=r,t}function Tte(e,t,r){var s=t.pendingProps;switch(tD(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(t),null;case 1:return Ua(t.type)&&KE(),qo(t),null;case 3:return s=t.stateNode,xy(),es(ja),es(Yo),uD(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(CT(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,kc!==null&&(VM(kc),kc=null))),OM(e,t),qo(t),null;case 5:cD(t);var c=dm(ix.current);if(r=t.type,e!==null&&t.stateNode!=null)f7(e,t,r,s,c),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(cn(166));return qo(t),null}if(e=dm(Lu.current),CT(t)){s=t.stateNode,r=t.type;var f=t.memoizedProps;switch(s[Pu]=t,s[nx]=f,e=(t.mode&1)!==0,r){case"dialog":Zi("cancel",s),Zi("close",s);break;case"iframe":case"object":case"embed":Zi("load",s);break;case"video":case"audio":for(c=0;c<n1.length;c++)Zi(n1[c],s);break;case"source":Zi("error",s);break;case"img":case"image":case"link":Zi("error",s),Zi("load",s);break;case"details":Zi("toggle",s);break;case"input":IB(s,f),Zi("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!f.multiple},Zi("invalid",s);break;case"textarea":AB(s,f),Zi("invalid",s)}aM(r,f),c=null;for(var _ in f)if(f.hasOwnProperty(_)){var x=f[_];_==="children"?typeof x=="string"?s.textContent!==x&&(f.suppressHydrationWarning!==!0&&IT(s.textContent,x,e),c=["children",x]):typeof x=="number"&&s.textContent!==""+x&&(f.suppressHydrationWarning!==!0&&IT(s.textContent,x,e),c=["children",""+x]):W1.hasOwnProperty(_)&&x!=null&&_==="onScroll"&&Zi("scroll",s)}switch(r){case"input":yT(s),CB(s,f,!0);break;case"textarea":yT(s),PB(s);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(s.onclick=XE)}s=c,t.updateQueue=s,s!==null&&(t.flags|=4)}else{_=c.nodeType===9?c:c.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=V$(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=_.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=_.createElement(r,{is:s.is}):(e=_.createElement(r),r==="select"&&(_=e,s.multiple?_.multiple=!0:s.size&&(_.size=s.size))):e=_.createElementNS(e,r),e[Pu]=t,e[nx]=s,d7(e,t,!1,!1),t.stateNode=e;e:{switch(_=lM(r,s),r){case"dialog":Zi("cancel",e),Zi("close",e),c=s;break;case"iframe":case"object":case"embed":Zi("load",e),c=s;break;case"video":case"audio":for(c=0;c<n1.length;c++)Zi(n1[c],e);c=s;break;case"source":Zi("error",e),c=s;break;case"img":case"image":case"link":Zi("error",e),Zi("load",e),c=s;break;case"details":Zi("toggle",e),c=s;break;case"input":IB(e,s),c=nM(e,s),Zi("invalid",e);break;case"option":c=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},c=xs({},s,{value:void 0}),Zi("invalid",e);break;case"textarea":AB(e,s),c=sM(e,s),Zi("invalid",e);break;default:c=s}aM(r,c),x=c;for(f in x)if(x.hasOwnProperty(f)){var a=x[f];f==="style"?G$(e,a):f==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&$$(e,a)):f==="children"?typeof a=="string"?(r!=="textarea"||a!=="")&&H1(e,a):typeof a=="number"&&H1(e,""+a):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(W1.hasOwnProperty(f)?a!=null&&f==="onScroll"&&Zi("scroll",e):a!=null&&j4(e,f,a,_))}switch(r){case"input":yT(e),CB(e,s,!1);break;case"textarea":yT(e),PB(e);break;case"option":s.value!=null&&e.setAttribute("value",""+kf(s.value));break;case"select":e.multiple=!!s.multiple,f=s.value,f!=null?Y_(e,!!s.multiple,f,!1):s.defaultValue!=null&&Y_(e,!!s.multiple,s.defaultValue,!0);break;default:typeof c.onClick=="function"&&(e.onclick=XE)}switch(r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return qo(t),null;case 6:if(e&&t.stateNode!=null)p7(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(cn(166));if(r=dm(ix.current),dm(Lu.current),CT(t)){if(s=t.stateNode,r=t.memoizedProps,s[Pu]=t,(f=s.nodeValue!==r)&&(e=fl,e!==null))switch(e.tag){case 3:IT(s.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&IT(s.nodeValue,r,(e.mode&1)!==0)}f&&(t.flags|=4)}else s=(r.nodeType===9?r:r.ownerDocument).createTextNode(s),s[Pu]=t,t.stateNode=s}return qo(t),null;case 13:if(es(ys),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(hs&&al!==null&&t.mode&1&&!(t.flags&128))k9(),yy(),t.flags|=98560,f=!1;else if(f=CT(t),s!==null&&s.dehydrated!==null){if(e===null){if(!f)throw Error(cn(318));if(f=t.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(cn(317));f[Pu]=t}else yy(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;qo(t),f=!1}else kc!==null&&(VM(kc),kc=null),f=!0;if(!f)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||ys.current&1?uo===0&&(uo=3):wD())),t.updateQueue!==null&&(t.flags|=4),qo(t),null);case 4:return xy(),OM(e,t),e===null&&ex(t.stateNode.containerInfo),qo(t),null;case 10:return sD(t.type._context),qo(t),null;case 17:return Ua(t.type)&&KE(),qo(t),null;case 19:if(es(ys),f=t.memoizedState,f===null)return qo(t),null;if(s=(t.flags&128)!==0,_=f.rendering,_===null)if(s)Bv(f,!1);else{if(uo!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(_=rS(e),_!==null){for(t.flags|=128,Bv(f,!1),s=_.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=r,r=t.child;r!==null;)f=r,e=s,f.flags&=14680066,_=f.alternate,_===null?(f.childLanes=0,f.lanes=e,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=_.childLanes,f.lanes=_.lanes,f.child=_.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=_.memoizedProps,f.memoizedState=_.memoizedState,f.updateQueue=_.updateQueue,f.type=_.type,e=_.dependencies,f.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return qi(ys,ys.current&1|2),t.child}e=e.sibling}f.tail!==null&&Us()>wy&&(t.flags|=128,s=!0,Bv(f,!1),t.lanes=4194304)}else{if(!s)if(e=rS(_),e!==null){if(t.flags|=128,s=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Bv(f,!0),f.tail===null&&f.tailMode==="hidden"&&!_.alternate&&!hs)return qo(t),null}else 2*Us()-f.renderingStartTime>wy&&r!==1073741824&&(t.flags|=128,s=!0,Bv(f,!1),t.lanes=4194304);f.isBackwards?(_.sibling=t.child,t.child=_):(r=f.last,r!==null?r.sibling=_:t.child=_,f.last=_)}return f.tail!==null?(t=f.tail,f.rendering=t,f.tail=t.sibling,f.renderingStartTime=Us(),t.sibling=null,r=ys.current,qi(ys,s?r&1|2:r&1),t):(qo(t),null);case 22:case 23:return bD(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?sl&1073741824&&(qo(t),t.subtreeFlags&6&&(t.flags|=8192)):qo(t),null;case 24:return null;case 25:return null}throw Error(cn(156,t.tag))}function Ete(e,t){switch(tD(t),t.tag){case 1:return Ua(t.type)&&KE(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return xy(),es(ja),es(Yo),uD(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return cD(t),null;case 13:if(es(ys),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(cn(340));yy()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return es(ys),null;case 4:return xy(),null;case 10:return sD(t.type._context),null;case 22:case 23:return bD(),null;case 24:return null;default:return null}}var RT=!1,Zo=!1,Ste=typeof WeakSet=="function"?WeakSet:Set,kn=null;function q_(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(s){ks(e,t,s)}else r.current=null}function LM(e,t,r){try{r()}catch(s){ks(e,t,s)}}var y6=!1;function Ite(e,t){if(yM=WE,e=v9(),J4(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var c=s.anchorOffset,f=s.focusNode;s=s.focusOffset;try{r.nodeType,f.nodeType}catch{r=null;break e}var _=0,x=-1,a=-1,I=0,D=0,O=e,F=null;t:for(;;){for(var Z;O!==r||c!==0&&O.nodeType!==3||(x=_+c),O!==f||s!==0&&O.nodeType!==3||(a=_+s),O.nodeType===3&&(_+=O.nodeValue.length),(Z=O.firstChild)!==null;)F=O,O=Z;for(;;){if(O===e)break t;if(F===r&&++I===c&&(x=_),F===f&&++D===s&&(a=_),(Z=O.nextSibling)!==null)break;O=F,F=O.parentNode}O=Z}r=x===-1||a===-1?null:{start:x,end:a}}else r=null}r=r||{start:0,end:0}}else r=null;for(vM={focusedElem:e,selectionRange:r},WE=!1,kn=t;kn!==null;)if(t=kn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,kn=e;else for(;kn!==null;){t=kn;try{var J=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(J!==null){var re=J.memoizedProps,ne=J.memoizedState,G=t.stateNode,Y=G.getSnapshotBeforeUpdate(t.elementType===t.type?re:Rc(t.type,re),ne);G.__reactInternalSnapshotBeforeUpdate=Y}break;case 3:var Q=t.stateNode.containerInfo;Q.nodeType===1?Q.textContent="":Q.nodeType===9&&Q.documentElement&&Q.removeChild(Q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(cn(163))}}catch(de){ks(t,t.return,de)}if(e=t.sibling,e!==null){e.return=t.return,kn=e;break}kn=t.return}return J=y6,y6=!1,J}function T1(e,t,r){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var c=s=s.next;do{if((c.tag&e)===e){var f=c.destroy;c.destroy=void 0,f!==void 0&&LM(t,r,f)}c=c.next}while(c!==s)}}function vI(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var s=r.create;r.destroy=s()}r=r.next}while(r!==t)}}function zM(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function m7(e){var t=e.alternate;t!==null&&(e.alternate=null,m7(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Pu],delete t[nx],delete t[wM],delete t[lte],delete t[cte])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function g7(e){return e.tag===5||e.tag===3||e.tag===4}function v6(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||g7(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function NM(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=XE));else if(s!==4&&(e=e.child,e!==null))for(NM(e,t,r),e=e.sibling;e!==null;)NM(e,t,r),e=e.sibling}function FM(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(FM(e,t,r),e=e.sibling;e!==null;)FM(e,t,r),e=e.sibling}var Io=null,Mc=!1;function Kd(e,t,r){for(r=r.child;r!==null;)_7(e,t,r),r=r.sibling}function _7(e,t,r){if(Ou&&typeof Ou.onCommitFiberUnmount=="function")try{Ou.onCommitFiberUnmount(hI,r)}catch{}switch(r.tag){case 5:Zo||q_(r,t);case 6:var s=Io,c=Mc;Io=null,Kd(e,t,r),Io=s,Mc=c,Io!==null&&(Mc?(e=Io,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Io.removeChild(r.stateNode));break;case 18:Io!==null&&(Mc?(e=Io,r=r.stateNode,e.nodeType===8?$3(e.parentNode,r):e.nodeType===1&&$3(e,r),Q1(e)):$3(Io,r.stateNode));break;case 4:s=Io,c=Mc,Io=r.stateNode.containerInfo,Mc=!0,Kd(e,t,r),Io=s,Mc=c;break;case 0:case 11:case 14:case 15:if(!Zo&&(s=r.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){c=s=s.next;do{var f=c,_=f.destroy;f=f.tag,_!==void 0&&(f&2||f&4)&&LM(r,t,_),c=c.next}while(c!==s)}Kd(e,t,r);break;case 1:if(!Zo&&(q_(r,t),s=r.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=r.memoizedProps,s.state=r.memoizedState,s.componentWillUnmount()}catch(x){ks(r,t,x)}Kd(e,t,r);break;case 21:Kd(e,t,r);break;case 22:r.mode&1?(Zo=(s=Zo)||r.memoizedState!==null,Kd(e,t,r),Zo=s):Kd(e,t,r);break;default:Kd(e,t,r)}}function x6(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Ste),t.forEach(function(s){var c=Lte.bind(null,e,s);r.has(s)||(r.add(s),s.then(c,c))})}}function Pc(e,t){var r=t.deletions;if(r!==null)for(var s=0;s<r.length;s++){var c=r[s];try{var f=e,_=t,x=_;e:for(;x!==null;){switch(x.tag){case 5:Io=x.stateNode,Mc=!1;break e;case 3:Io=x.stateNode.containerInfo,Mc=!0;break e;case 4:Io=x.stateNode.containerInfo,Mc=!0;break e}x=x.return}if(Io===null)throw Error(cn(160));_7(f,_,c),Io=null,Mc=!1;var a=c.alternate;a!==null&&(a.return=null),c.return=null}catch(I){ks(c,t,I)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)y7(t,e),t=t.sibling}function y7(e,t){var r=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Pc(t,e),yu(e),s&4){try{T1(3,e,e.return),vI(3,e)}catch(re){ks(e,e.return,re)}try{T1(5,e,e.return)}catch(re){ks(e,e.return,re)}}break;case 1:Pc(t,e),yu(e),s&512&&r!==null&&q_(r,r.return);break;case 5:if(Pc(t,e),yu(e),s&512&&r!==null&&q_(r,r.return),e.flags&32){var c=e.stateNode;try{H1(c,"")}catch(re){ks(e,e.return,re)}}if(s&4&&(c=e.stateNode,c!=null)){var f=e.memoizedProps,_=r!==null?r.memoizedProps:f,x=e.type,a=e.updateQueue;if(e.updateQueue=null,a!==null)try{x==="input"&&f.type==="radio"&&f.name!=null&&j$(c,f),lM(x,_);var I=lM(x,f);for(_=0;_<a.length;_+=2){var D=a[_],O=a[_+1];D==="style"?G$(c,O):D==="dangerouslySetInnerHTML"?$$(c,O):D==="children"?H1(c,O):j4(c,D,O,I)}switch(x){case"input":rM(c,f);break;case"textarea":U$(c,f);break;case"select":var F=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!f.multiple;var Z=f.value;Z!=null?Y_(c,!!f.multiple,Z,!1):F!==!!f.multiple&&(f.defaultValue!=null?Y_(c,!!f.multiple,f.defaultValue,!0):Y_(c,!!f.multiple,f.multiple?[]:"",!1))}c[nx]=f}catch(re){ks(e,e.return,re)}}break;case 6:if(Pc(t,e),yu(e),s&4){if(e.stateNode===null)throw Error(cn(162));c=e.stateNode,f=e.memoizedProps;try{c.nodeValue=f}catch(re){ks(e,e.return,re)}}break;case 3:if(Pc(t,e),yu(e),s&4&&r!==null&&r.memoizedState.isDehydrated)try{Q1(t.containerInfo)}catch(re){ks(e,e.return,re)}break;case 4:Pc(t,e),yu(e);break;case 13:Pc(t,e),yu(e),c=e.child,c.flags&8192&&(f=c.memoizedState!==null,c.stateNode.isHidden=f,!f||c.alternate!==null&&c.alternate.memoizedState!==null||(vD=Us())),s&4&&x6(e);break;case 22:if(D=r!==null&&r.memoizedState!==null,e.mode&1?(Zo=(I=Zo)||D,Pc(t,e),Zo=I):Pc(t,e),yu(e),s&8192){if(I=e.memoizedState!==null,(e.stateNode.isHidden=I)&&!D&&e.mode&1)for(kn=e,D=e.child;D!==null;){for(O=kn=D;kn!==null;){switch(F=kn,Z=F.child,F.tag){case 0:case 11:case 14:case 15:T1(4,F,F.return);break;case 1:q_(F,F.return);var J=F.stateNode;if(typeof J.componentWillUnmount=="function"){s=F,r=F.return;try{t=s,J.props=t.memoizedProps,J.state=t.memoizedState,J.componentWillUnmount()}catch(re){ks(s,r,re)}}break;case 5:q_(F,F.return);break;case 22:if(F.memoizedState!==null){w6(O);continue}}Z!==null?(Z.return=F,kn=Z):w6(O)}D=D.sibling}e:for(D=null,O=e;;){if(O.tag===5){if(D===null){D=O;try{c=O.stateNode,I?(f=c.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(x=O.stateNode,a=O.memoizedProps.style,_=a!=null&&a.hasOwnProperty("display")?a.display:null,x.style.display=q$("display",_))}catch(re){ks(e,e.return,re)}}}else if(O.tag===6){if(D===null)try{O.stateNode.nodeValue=I?"":O.memoizedProps}catch(re){ks(e,e.return,re)}}else if((O.tag!==22&&O.tag!==23||O.memoizedState===null||O===e)&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===e)break e;for(;O.sibling===null;){if(O.return===null||O.return===e)break e;D===O&&(D=null),O=O.return}D===O&&(D=null),O.sibling.return=O.return,O=O.sibling}}break;case 19:Pc(t,e),yu(e),s&4&&x6(e);break;case 21:break;default:Pc(t,e),yu(e)}}function yu(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(g7(r)){var s=r;break e}r=r.return}throw Error(cn(160))}switch(s.tag){case 5:var c=s.stateNode;s.flags&32&&(H1(c,""),s.flags&=-33);var f=v6(e);FM(e,f,c);break;case 3:case 4:var _=s.stateNode.containerInfo,x=v6(e);NM(e,x,_);break;default:throw Error(cn(161))}}catch(a){ks(e,e.return,a)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Cte(e,t,r){kn=e,v7(e)}function v7(e,t,r){for(var s=(e.mode&1)!==0;kn!==null;){var c=kn,f=c.child;if(c.tag===22&&s){var _=c.memoizedState!==null||RT;if(!_){var x=c.alternate,a=x!==null&&x.memoizedState!==null||Zo;x=RT;var I=Zo;if(RT=_,(Zo=a)&&!I)for(kn=c;kn!==null;)_=kn,a=_.child,_.tag===22&&_.memoizedState!==null?T6(c):a!==null?(a.return=_,kn=a):T6(c);for(;f!==null;)kn=f,v7(f),f=f.sibling;kn=c,RT=x,Zo=I}b6(e)}else c.subtreeFlags&8772&&f!==null?(f.return=c,kn=f):b6(e)}}function b6(e){for(;kn!==null;){var t=kn;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Zo||vI(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Zo)if(r===null)s.componentDidMount();else{var c=t.elementType===t.type?r.memoizedProps:Rc(t.type,r.memoizedProps);s.componentDidUpdate(c,r.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var f=t.updateQueue;f!==null&&s6(t,f,s);break;case 3:var _=t.updateQueue;if(_!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}s6(t,_,r)}break;case 5:var x=t.stateNode;if(r===null&&t.flags&4){r=x;var a=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&r.focus();break;case"img":a.src&&(r.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var I=t.alternate;if(I!==null){var D=I.memoizedState;if(D!==null){var O=D.dehydrated;O!==null&&Q1(O)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(cn(163))}Zo||t.flags&512&&zM(t)}catch(F){ks(t,t.return,F)}}if(t===e){kn=null;break}if(r=t.sibling,r!==null){r.return=t.return,kn=r;break}kn=t.return}}function w6(e){for(;kn!==null;){var t=kn;if(t===e){kn=null;break}var r=t.sibling;if(r!==null){r.return=t.return,kn=r;break}kn=t.return}}function T6(e){for(;kn!==null;){var t=kn;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{vI(4,t)}catch(a){ks(t,r,a)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var c=t.return;try{s.componentDidMount()}catch(a){ks(t,c,a)}}var f=t.return;try{zM(t)}catch(a){ks(t,f,a)}break;case 5:var _=t.return;try{zM(t)}catch(a){ks(t,_,a)}}}catch(a){ks(t,t.return,a)}if(t===e){kn=null;break}var x=t.sibling;if(x!==null){x.return=t.return,kn=x;break}kn=t.return}}var Ate=Math.ceil,oS=td.ReactCurrentDispatcher,_D=td.ReactCurrentOwner,Hl=td.ReactCurrentBatchConfig,ri=0,wo=null,Qs=null,Ro=0,sl=0,G_=Gf(0),uo=0,lx=null,Dm=0,xI=0,yD=0,E1=null,La=null,vD=0,wy=1/0,Ih=null,aS=!1,BM=null,Tf=null,MT=!1,df=null,lS=0,S1=0,jM=null,fE=-1,pE=0;function va(){return ri&6?Us():fE!==-1?fE:fE=Us()}function Ef(e){return e.mode&1?ri&2&&Ro!==0?Ro&-Ro:hte.transition!==null?(pE===0&&(pE=r9()),pE):(e=Ti,e!==0||(e=window.event,e=e===void 0?16:u9(e.type)),e):1}function Bc(e,t,r,s){if(50<S1)throw S1=0,jM=null,Error(cn(185));$x(e,r,s),(!(ri&2)||e!==wo)&&(e===wo&&(!(ri&2)&&(xI|=r),uo===4&&of(e,Ro)),Va(e,s),r===1&&ri===0&&!(t.mode&1)&&(wy=Us()+500,gI&&Wf()))}function Va(e,t){var r=e.callbackNode;hee(e,t);var s=GE(e,e===wo?Ro:0);if(s===0)r!==null&&kB(r),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(r!=null&&kB(r),t===1)e.tag===0?ute(E6.bind(null,e)):P9(E6.bind(null,e)),ote(function(){!(ri&6)&&Wf()}),r=null;else{switch(i9(s)){case 1:r=G4;break;case 4:r=t9;break;case 16:r=qE;break;case 536870912:r=n9;break;default:r=qE}r=C7(r,x7.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function x7(e,t){if(fE=-1,pE=0,ri&6)throw Error(cn(327));var r=e.callbackNode;if(ry()&&e.callbackNode!==r)return null;var s=GE(e,e===wo?Ro:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=cS(e,s);else{t=s;var c=ri;ri|=2;var f=w7();(wo!==e||Ro!==t)&&(Ih=null,wy=Us()+500,vm(e,t));do try{Mte();break}catch(x){b7(e,x)}while(!0);iD(),oS.current=f,ri=c,Qs!==null?t=0:(wo=null,Ro=0,t=uo)}if(t!==0){if(t===2&&(c=fM(e),c!==0&&(s=c,t=UM(e,c))),t===1)throw r=lx,vm(e,0),of(e,s),Va(e,Us()),r;if(t===6)of(e,s);else{if(c=e.current.alternate,!(s&30)&&!Pte(c)&&(t=cS(e,s),t===2&&(f=fM(e),f!==0&&(s=f,t=UM(e,f))),t===1))throw r=lx,vm(e,0),of(e,s),Va(e,Us()),r;switch(e.finishedWork=c,e.finishedLanes=s,t){case 0:case 1:throw Error(cn(345));case 2:em(e,La,Ih);break;case 3:if(of(e,s),(s&130023424)===s&&(t=vD+500-Us(),10<t)){if(GE(e,0)!==0)break;if(c=e.suspendedLanes,(c&s)!==s){va(),e.pingedLanes|=e.suspendedLanes&c;break}e.timeoutHandle=bM(em.bind(null,e,La,Ih),t);break}em(e,La,Ih);break;case 4:if(of(e,s),(s&4194240)===s)break;for(t=e.eventTimes,c=-1;0<s;){var _=31-Fc(s);f=1<<_,_=t[_],_>c&&(c=_),s&=~f}if(s=c,s=Us()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*Ate(s/1960))-s,10<s){e.timeoutHandle=bM(em.bind(null,e,La,Ih),s);break}em(e,La,Ih);break;case 5:em(e,La,Ih);break;default:throw Error(cn(329))}}}return Va(e,Us()),e.callbackNode===r?x7.bind(null,e):null}function UM(e,t){var r=E1;return e.current.memoizedState.isDehydrated&&(vm(e,t).flags|=256),e=cS(e,t),e!==2&&(t=La,La=r,t!==null&&VM(t)),e}function VM(e){La===null?La=e:La.push.apply(La,e)}function Pte(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var s=0;s<r.length;s++){var c=r[s],f=c.getSnapshot;c=c.value;try{if(!Vc(f(),c))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function of(e,t){for(t&=~yD,t&=~xI,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Fc(t),s=1<<r;e[r]=-1,t&=~s}}function E6(e){if(ri&6)throw Error(cn(327));ry();var t=GE(e,0);if(!(t&1))return Va(e,Us()),null;var r=cS(e,t);if(e.tag!==0&&r===2){var s=fM(e);s!==0&&(t=s,r=UM(e,s))}if(r===1)throw r=lx,vm(e,0),of(e,t),Va(e,Us()),r;if(r===6)throw Error(cn(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,em(e,La,Ih),Va(e,Us()),null}function xD(e,t){var r=ri;ri|=1;try{return e(t)}finally{ri=r,ri===0&&(wy=Us()+500,gI&&Wf())}}function Om(e){df!==null&&df.tag===0&&!(ri&6)&&ry();var t=ri;ri|=1;var r=Hl.transition,s=Ti;try{if(Hl.transition=null,Ti=1,e)return e()}finally{Ti=s,Hl.transition=r,ri=t,!(ri&6)&&Wf()}}function bD(){sl=G_.current,es(G_)}function vm(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,ste(r)),Qs!==null)for(r=Qs.return;r!==null;){var s=r;switch(tD(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&KE();break;case 3:xy(),es(ja),es(Yo),uD();break;case 5:cD(s);break;case 4:xy();break;case 13:es(ys);break;case 19:es(ys);break;case 10:sD(s.type._context);break;case 22:case 23:bD()}r=r.return}if(wo=e,Qs=e=Sf(e.current,null),Ro=sl=t,uo=0,lx=null,yD=xI=Dm=0,La=E1=null,hm!==null){for(t=0;t<hm.length;t++)if(r=hm[t],s=r.interleaved,s!==null){r.interleaved=null;var c=s.next,f=r.pending;if(f!==null){var _=f.next;f.next=c,s.next=_}r.pending=s}hm=null}return e}function b7(e,t){do{var r=Qs;try{if(iD(),uE.current=sS,iS){for(var s=vs.memoizedState;s!==null;){var c=s.queue;c!==null&&(c.pending=null),s=s.next}iS=!1}if(km=0,xo=lo=vs=null,w1=!1,sx=0,_D.current=null,r===null||r.return===null){uo=1,lx=t,Qs=null;break}e:{var f=e,_=r.return,x=r,a=t;if(t=Ro,x.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var I=a,D=x,O=D.tag;if(!(D.mode&1)&&(O===0||O===11||O===15)){var F=D.alternate;F?(D.updateQueue=F.updateQueue,D.memoizedState=F.memoizedState,D.lanes=F.lanes):(D.updateQueue=null,D.memoizedState=null)}var Z=h6(_);if(Z!==null){Z.flags&=-257,d6(Z,_,x,f,t),Z.mode&1&&u6(f,I,t),t=Z,a=I;var J=t.updateQueue;if(J===null){var re=new Set;re.add(a),t.updateQueue=re}else J.add(a);break e}else{if(!(t&1)){u6(f,I,t),wD();break e}a=Error(cn(426))}}else if(hs&&x.mode&1){var ne=h6(_);if(ne!==null){!(ne.flags&65536)&&(ne.flags|=256),d6(ne,_,x,f,t),nD(by(a,x));break e}}f=a=by(a,x),uo!==4&&(uo=2),E1===null?E1=[f]:E1.push(f),f=_;do{switch(f.tag){case 3:f.flags|=65536,t&=-t,f.lanes|=t;var G=i7(f,a,t);i6(f,G);break e;case 1:x=a;var Y=f.type,Q=f.stateNode;if(!(f.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(Tf===null||!Tf.has(Q)))){f.flags|=65536,t&=-t,f.lanes|=t;var de=s7(f,x,t);i6(f,de);break e}}f=f.return}while(f!==null)}E7(r)}catch(Te){t=Te,Qs===r&&r!==null&&(Qs=r=r.return);continue}break}while(!0)}function w7(){var e=oS.current;return oS.current=sS,e===null?sS:e}function wD(){(uo===0||uo===3||uo===2)&&(uo=4),wo===null||!(Dm&268435455)&&!(xI&268435455)||of(wo,Ro)}function cS(e,t){var r=ri;ri|=2;var s=w7();(wo!==e||Ro!==t)&&(Ih=null,vm(e,t));do try{Rte();break}catch(c){b7(e,c)}while(!0);if(iD(),ri=r,oS.current=s,Qs!==null)throw Error(cn(261));return wo=null,Ro=0,uo}function Rte(){for(;Qs!==null;)T7(Qs)}function Mte(){for(;Qs!==null&&!nee();)T7(Qs)}function T7(e){var t=I7(e.alternate,e,sl);e.memoizedProps=e.pendingProps,t===null?E7(e):Qs=t,_D.current=null}function E7(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Ete(r,t),r!==null){r.flags&=32767,Qs=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{uo=6,Qs=null;return}}else if(r=Tte(r,t,sl),r!==null){Qs=r;return}if(t=t.sibling,t!==null){Qs=t;return}Qs=t=e}while(t!==null);uo===0&&(uo=5)}function em(e,t,r){var s=Ti,c=Hl.transition;try{Hl.transition=null,Ti=1,kte(e,t,r,s)}finally{Hl.transition=c,Ti=s}return null}function kte(e,t,r,s){do ry();while(df!==null);if(ri&6)throw Error(cn(327));r=e.finishedWork;var c=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(cn(177));e.callbackNode=null,e.callbackPriority=0;var f=r.lanes|r.childLanes;if(dee(e,f),e===wo&&(Qs=wo=null,Ro=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||MT||(MT=!0,C7(qE,function(){return ry(),null})),f=(r.flags&15990)!==0,r.subtreeFlags&15990||f){f=Hl.transition,Hl.transition=null;var _=Ti;Ti=1;var x=ri;ri|=4,_D.current=null,Ite(e,r),y7(r,e),Yee(vM),WE=!!yM,vM=yM=null,e.current=r,Cte(r),ree(),ri=x,Ti=_,Hl.transition=f}else e.current=r;if(MT&&(MT=!1,df=e,lS=c),f=e.pendingLanes,f===0&&(Tf=null),oee(r.stateNode),Va(e,Us()),t!==null)for(s=e.onRecoverableError,r=0;r<t.length;r++)c=t[r],s(c.value,{componentStack:c.stack,digest:c.digest});if(aS)throw aS=!1,e=BM,BM=null,e;return lS&1&&e.tag!==0&&ry(),f=e.pendingLanes,f&1?e===jM?S1++:(S1=0,jM=e):S1=0,Wf(),null}function ry(){if(df!==null){var e=i9(lS),t=Hl.transition,r=Ti;try{if(Hl.transition=null,Ti=16>e?16:e,df===null)var s=!1;else{if(e=df,df=null,lS=0,ri&6)throw Error(cn(331));var c=ri;for(ri|=4,kn=e.current;kn!==null;){var f=kn,_=f.child;if(kn.flags&16){var x=f.deletions;if(x!==null){for(var a=0;a<x.length;a++){var I=x[a];for(kn=I;kn!==null;){var D=kn;switch(D.tag){case 0:case 11:case 15:T1(8,D,f)}var O=D.child;if(O!==null)O.return=D,kn=O;else for(;kn!==null;){D=kn;var F=D.sibling,Z=D.return;if(m7(D),D===I){kn=null;break}if(F!==null){F.return=Z,kn=F;break}kn=Z}}}var J=f.alternate;if(J!==null){var re=J.child;if(re!==null){J.child=null;do{var ne=re.sibling;re.sibling=null,re=ne}while(re!==null)}}kn=f}}if(f.subtreeFlags&2064&&_!==null)_.return=f,kn=_;else e:for(;kn!==null;){if(f=kn,f.flags&2048)switch(f.tag){case 0:case 11:case 15:T1(9,f,f.return)}var G=f.sibling;if(G!==null){G.return=f.return,kn=G;break e}kn=f.return}}var Y=e.current;for(kn=Y;kn!==null;){_=kn;var Q=_.child;if(_.subtreeFlags&2064&&Q!==null)Q.return=_,kn=Q;else e:for(_=Y;kn!==null;){if(x=kn,x.flags&2048)try{switch(x.tag){case 0:case 11:case 15:vI(9,x)}}catch(Te){ks(x,x.return,Te)}if(x===_){kn=null;break e}var de=x.sibling;if(de!==null){de.return=x.return,kn=de;break e}kn=x.return}}if(ri=c,Wf(),Ou&&typeof Ou.onPostCommitFiberRoot=="function")try{Ou.onPostCommitFiberRoot(hI,e)}catch{}s=!0}return s}finally{Ti=r,Hl.transition=t}}return!1}function S6(e,t,r){t=by(r,t),t=i7(e,t,1),e=wf(e,t,1),t=va(),e!==null&&($x(e,1,t),Va(e,t))}function ks(e,t,r){if(e.tag===3)S6(e,e,r);else for(;t!==null;){if(t.tag===3){S6(t,e,r);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Tf===null||!Tf.has(s))){e=by(r,e),e=s7(t,e,1),t=wf(t,e,1),e=va(),t!==null&&($x(t,1,e),Va(t,e));break}}t=t.return}}function Dte(e,t,r){var s=e.pingCache;s!==null&&s.delete(t),t=va(),e.pingedLanes|=e.suspendedLanes&r,wo===e&&(Ro&r)===r&&(uo===4||uo===3&&(Ro&130023424)===Ro&&500>Us()-vD?vm(e,0):yD|=r),Va(e,t)}function S7(e,t){t===0&&(e.mode&1?(t=bT,bT<<=1,!(bT&130023424)&&(bT=4194304)):t=1);var r=va();e=qh(e,t),e!==null&&($x(e,t,r),Va(e,r))}function Ote(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),S7(e,r)}function Lte(e,t){var r=0;switch(e.tag){case 13:var s=e.stateNode,c=e.memoizedState;c!==null&&(r=c.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(cn(314))}s!==null&&s.delete(t),S7(e,r)}var I7;I7=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||ja.current)Fa=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Fa=!1,wte(e,t,r);Fa=!!(e.flags&131072)}else Fa=!1,hs&&t.flags&1048576&&R9(t,JE,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;dE(e,t),e=t.pendingProps;var c=_y(t,Yo.current);ny(t,r),c=dD(null,t,s,e,c,r);var f=fD();return t.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ua(s)?(f=!0,QE(t)):f=!1,t.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,aD(t),c.updater=yI,t.stateNode=c,c._reactInternals=t,AM(t,s,e,r),t=MM(null,t,s,!0,f,r)):(t.tag=0,hs&&f&&eD(t),ga(null,t,c,r),t=t.child),t;case 16:s=t.elementType;e:{switch(dE(e,t),e=t.pendingProps,c=s._init,s=c(s._payload),t.type=s,c=t.tag=Nte(s),e=Rc(s,e),c){case 0:t=RM(null,t,s,e,r);break e;case 1:t=m6(null,t,s,e,r);break e;case 11:t=f6(null,t,s,e,r);break e;case 14:t=p6(null,t,s,Rc(s.type,e),r);break e}throw Error(cn(306,s,""))}return t;case 0:return s=t.type,c=t.pendingProps,c=t.elementType===s?c:Rc(s,c),RM(e,t,s,c,r);case 1:return s=t.type,c=t.pendingProps,c=t.elementType===s?c:Rc(s,c),m6(e,t,s,c,r);case 3:e:{if(c7(t),e===null)throw Error(cn(387));s=t.pendingProps,f=t.memoizedState,c=f.element,z9(e,t),nS(t,s,null,r);var _=t.memoizedState;if(s=_.element,f.isDehydrated)if(f={element:s,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},t.updateQueue.baseState=f,t.memoizedState=f,t.flags&256){c=by(Error(cn(423)),t),t=g6(e,t,s,r,c);break e}else if(s!==c){c=by(Error(cn(424)),t),t=g6(e,t,s,r,c);break e}else for(al=bf(t.stateNode.containerInfo.firstChild),fl=t,hs=!0,kc=null,r=O9(t,null,s,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(yy(),s===c){t=Gh(e,t,r);break e}ga(e,t,s,r)}t=t.child}return t;case 5:return N9(t),e===null&&SM(t),s=t.type,c=t.pendingProps,f=e!==null?e.memoizedProps:null,_=c.children,xM(s,c)?_=null:f!==null&&xM(s,f)&&(t.flags|=32),l7(e,t),ga(e,t,_,r),t.child;case 6:return e===null&&SM(t),null;case 13:return u7(e,t,r);case 4:return lD(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=vy(t,null,s,r):ga(e,t,s,r),t.child;case 11:return s=t.type,c=t.pendingProps,c=t.elementType===s?c:Rc(s,c),f6(e,t,s,c,r);case 7:return ga(e,t,t.pendingProps,r),t.child;case 8:return ga(e,t,t.pendingProps.children,r),t.child;case 12:return ga(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(s=t.type._context,c=t.pendingProps,f=t.memoizedProps,_=c.value,qi(eS,s._currentValue),s._currentValue=_,f!==null)if(Vc(f.value,_)){if(f.children===c.children&&!ja.current){t=Gh(e,t,r);break e}}else for(f=t.child,f!==null&&(f.return=t);f!==null;){var x=f.dependencies;if(x!==null){_=f.child;for(var a=x.firstContext;a!==null;){if(a.context===s){if(f.tag===1){a=Nh(-1,r&-r),a.tag=2;var I=f.updateQueue;if(I!==null){I=I.shared;var D=I.pending;D===null?a.next=a:(a.next=D.next,D.next=a),I.pending=a}}f.lanes|=r,a=f.alternate,a!==null&&(a.lanes|=r),IM(f.return,r,t),x.lanes|=r;break}a=a.next}}else if(f.tag===10)_=f.type===t.type?null:f.child;else if(f.tag===18){if(_=f.return,_===null)throw Error(cn(341));_.lanes|=r,x=_.alternate,x!==null&&(x.lanes|=r),IM(_,r,t),_=f.sibling}else _=f.child;if(_!==null)_.return=f;else for(_=f;_!==null;){if(_===t){_=null;break}if(f=_.sibling,f!==null){f.return=_.return,_=f;break}_=_.return}f=_}ga(e,t,c.children,r),t=t.child}return t;case 9:return c=t.type,s=t.pendingProps.children,ny(t,r),c=Xl(c),s=s(c),t.flags|=1,ga(e,t,s,r),t.child;case 14:return s=t.type,c=Rc(s,t.pendingProps),c=Rc(s.type,c),p6(e,t,s,c,r);case 15:return o7(e,t,t.type,t.pendingProps,r);case 17:return s=t.type,c=t.pendingProps,c=t.elementType===s?c:Rc(s,c),dE(e,t),t.tag=1,Ua(s)?(e=!0,QE(t)):e=!1,ny(t,r),r7(t,s,c),AM(t,s,c,r),MM(null,t,s,!0,e,r);case 19:return h7(e,t,r);case 22:return a7(e,t,r)}throw Error(cn(156,t.tag))};function C7(e,t){return e9(e,t)}function zte(e,t,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wl(e,t,r,s){return new zte(e,t,r,s)}function TD(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Nte(e){if(typeof e=="function")return TD(e)?1:0;if(e!=null){if(e=e.$$typeof,e===V4)return 11;if(e===$4)return 14}return 2}function Sf(e,t){var r=e.alternate;return r===null?(r=Wl(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function mE(e,t,r,s,c,f){var _=2;if(s=e,typeof e=="function")TD(e)&&(_=1);else if(typeof e=="string")_=5;else e:switch(e){case L_:return xm(r.children,c,f,t);case U4:_=8,c|=8;break;case YR:return e=Wl(12,r,t,c|2),e.elementType=YR,e.lanes=f,e;case JR:return e=Wl(13,r,t,c),e.elementType=JR,e.lanes=f,e;case eM:return e=Wl(19,r,t,c),e.elementType=eM,e.lanes=f,e;case N$:return bI(r,c,f,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case L$:_=10;break e;case z$:_=9;break e;case V4:_=11;break e;case $4:_=14;break e;case nf:_=16,s=null;break e}throw Error(cn(130,e==null?e:typeof e,""))}return t=Wl(_,r,t,c),t.elementType=e,t.type=s,t.lanes=f,t}function xm(e,t,r,s){return e=Wl(7,e,s,t),e.lanes=r,e}function bI(e,t,r,s){return e=Wl(22,e,s,t),e.elementType=N$,e.lanes=r,e.stateNode={isHidden:!1},e}function Q3(e,t,r){return e=Wl(6,e,null,t),e.lanes=r,e}function Y3(e,t,r){return t=Wl(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fte(e,t,r,s,c){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=k3(0),this.expirationTimes=k3(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=k3(0),this.identifierPrefix=s,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function ED(e,t,r,s,c,f,_,x,a){return e=new Fte(e,t,r,x,a),t===1?(t=1,f===!0&&(t|=8)):t=0,f=Wl(3,null,null,t),e.current=f,f.stateNode=e,f.memoizedState={element:s,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},aD(f),e}function Bte(e,t,r){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O_,key:s==null?null:""+s,children:e,containerInfo:t,implementation:r}}function A7(e){if(!e)return Df;e=e._reactInternals;e:{if(Xm(e)!==e||e.tag!==1)throw Error(cn(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ua(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(cn(171))}if(e.tag===1){var r=e.type;if(Ua(r))return A9(e,r,t)}return t}function P7(e,t,r,s,c,f,_,x,a){return e=ED(r,s,!0,e,c,f,_,x,a),e.context=A7(null),r=e.current,s=va(),c=Ef(r),f=Nh(s,c),f.callback=t??null,wf(r,f,c),e.current.lanes=c,$x(e,c,s),Va(e,s),e}function wI(e,t,r,s){var c=t.current,f=va(),_=Ef(c);return r=A7(r),t.context===null?t.context=r:t.pendingContext=r,t=Nh(f,_),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=wf(c,t,_),e!==null&&(Bc(e,c,_,f),cE(e,c,_)),_}function uS(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function I6(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function SD(e,t){I6(e,t),(e=e.alternate)&&I6(e,t)}function jte(){return null}var R7=typeof reportError=="function"?reportError:function(e){console.error(e)};function ID(e){this._internalRoot=e}TI.prototype.render=ID.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(cn(409));wI(e,t,null,null)};TI.prototype.unmount=ID.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Om(function(){wI(null,e,null,null)}),t[$h]=null}};function TI(e){this._internalRoot=e}TI.prototype.unstable_scheduleHydration=function(e){if(e){var t=a9();e={blockedOn:null,target:e,priority:t};for(var r=0;r<sf.length&&t!==0&&t<sf[r].priority;r++);sf.splice(r,0,e),r===0&&c9(e)}};function CD(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function EI(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function C6(){}function Ute(e,t,r,s,c){if(c){if(typeof s=="function"){var f=s;s=function(){var I=uS(_);f.call(I)}}var _=P7(t,s,e,0,null,!1,!1,"",C6);return e._reactRootContainer=_,e[$h]=_.current,ex(e.nodeType===8?e.parentNode:e),Om(),_}for(;c=e.lastChild;)e.removeChild(c);if(typeof s=="function"){var x=s;s=function(){var I=uS(a);x.call(I)}}var a=ED(e,0,!1,null,null,!1,!1,"",C6);return e._reactRootContainer=a,e[$h]=a.current,ex(e.nodeType===8?e.parentNode:e),Om(function(){wI(t,a,r,s)}),a}function SI(e,t,r,s,c){var f=r._reactRootContainer;if(f){var _=f;if(typeof c=="function"){var x=c;c=function(){var a=uS(_);x.call(a)}}wI(t,_,e,c)}else _=Ute(r,t,e,c,s);return uS(_)}s9=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=t1(t.pendingLanes);r!==0&&(W4(t,r|1),Va(t,Us()),!(ri&6)&&(wy=Us()+500,Wf()))}break;case 13:Om(function(){var s=qh(e,1);if(s!==null){var c=va();Bc(s,e,1,c)}}),SD(e,1)}};H4=function(e){if(e.tag===13){var t=qh(e,134217728);if(t!==null){var r=va();Bc(t,e,134217728,r)}SD(e,134217728)}};o9=function(e){if(e.tag===13){var t=Ef(e),r=qh(e,t);if(r!==null){var s=va();Bc(r,e,t,s)}SD(e,t)}};a9=function(){return Ti};l9=function(e,t){var r=Ti;try{return Ti=e,t()}finally{Ti=r}};uM=function(e,t,r){switch(t){case"input":if(rM(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var s=r[t];if(s!==e&&s.form===e.form){var c=mI(s);if(!c)throw Error(cn(90));B$(s),rM(s,c)}}}break;case"textarea":U$(e,r);break;case"select":t=r.value,t!=null&&Y_(e,!!r.multiple,t,!1)}};Z$=xD;X$=Om;var Vte={usingClientEntryPoint:!1,Events:[Gx,B_,mI,W$,H$,xD]},jv={findFiberByHostInstance:um,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},$te={bundleType:jv.bundleType,version:jv.version,rendererPackageName:jv.rendererPackageName,rendererConfig:jv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:td.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Y$(e),e===null?null:e.stateNode},findFiberByHostInstance:jv.findFiberByHostInstance||jte,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kT=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kT.isDisabled&&kT.supportsFiber)try{hI=kT.inject($te),Ou=kT}catch{}}vl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vte;vl.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!CD(t))throw Error(cn(200));return Bte(e,t,null,r)};vl.createRoot=function(e,t){if(!CD(e))throw Error(cn(299));var r=!1,s="",c=R7;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=ED(e,1,!1,null,null,r,!1,s,c),e[$h]=t.current,ex(e.nodeType===8?e.parentNode:e),new ID(t)};vl.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(cn(188)):(e=Object.keys(e).join(","),Error(cn(268,e)));return e=Y$(t),e=e===null?null:e.stateNode,e};vl.flushSync=function(e){return Om(e)};vl.hydrate=function(e,t,r){if(!EI(t))throw Error(cn(200));return SI(null,e,t,!0,r)};vl.hydrateRoot=function(e,t,r){if(!CD(e))throw Error(cn(405));var s=r!=null&&r.hydratedSources||null,c=!1,f="",_=R7;if(r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(_=r.onRecoverableError)),t=P7(t,null,e,1,r??null,c,!1,f,_),e[$h]=t.current,ex(e),s)for(e=0;e<s.length;e++)r=s[e],c=r._getVersion,c=c(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,c]:t.mutableSourceEagerHydrationData.push(r,c);return new TI(t)};vl.render=function(e,t,r){if(!EI(t))throw Error(cn(200));return SI(null,e,t,!1,r)};vl.unmountComponentAtNode=function(e){if(!EI(e))throw Error(cn(40));return e._reactRootContainer?(Om(function(){SI(null,null,e,!1,function(){e._reactRootContainer=null,e[$h]=null})}),!0):!1};vl.unstable_batchedUpdates=xD;vl.unstable_renderSubtreeIntoContainer=function(e,t,r,s){if(!EI(r))throw Error(cn(200));if(e==null||e._reactInternals===void 0)throw Error(cn(38));return SI(e,t,r,!1,s)};vl.version="18.3.1-next-f1338f8080-20240426";function M7(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(M7)}catch(e){console.error(e)}}M7(),M$.exports=vl;var II=M$.exports;const DT=Gy(II);var k7,A6=II;k7=A6.createRoot,A6.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function cx(){return cx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},cx.apply(this,arguments)}var ff;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(ff||(ff={}));const P6="popstate";function qte(e){e===void 0&&(e={});function t(s,c){let{pathname:f,search:_,hash:x}=s.location;return $M("",{pathname:f,search:_,hash:x},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function r(s,c){return typeof c=="string"?c:hS(c)}return Wte(t,r,null,e)}function Ds(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function D7(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Gte(){return Math.random().toString(36).substr(2,8)}function R6(e,t){return{usr:e.state,key:e.key,idx:t}}function $M(e,t,r,s){return r===void 0&&(r=null),cx({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Xy(t):t,{state:r,key:t&&t.key||s||Gte()})}function hS(e){let{pathname:t="/",search:r="",hash:s=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),s&&s!=="#"&&(t+=s.charAt(0)==="#"?s:"#"+s),t}function Xy(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function Wte(e,t,r,s){s===void 0&&(s={});let{window:c=document.defaultView,v5Compat:f=!1}=s,_=c.history,x=ff.Pop,a=null,I=D();I==null&&(I=0,_.replaceState(cx({},_.state,{idx:I}),""));function D(){return(_.state||{idx:null}).idx}function O(){x=ff.Pop;let ne=D(),G=ne==null?null:ne-I;I=ne,a&&a({action:x,location:re.location,delta:G})}function F(ne,G){x=ff.Push;let Y=$M(re.location,ne,G);I=D()+1;let Q=R6(Y,I),de=re.createHref(Y);try{_.pushState(Q,"",de)}catch(Te){if(Te instanceof DOMException&&Te.name==="DataCloneError")throw Te;c.location.assign(de)}f&&a&&a({action:x,location:re.location,delta:1})}function Z(ne,G){x=ff.Replace;let Y=$M(re.location,ne,G);I=D();let Q=R6(Y,I),de=re.createHref(Y);_.replaceState(Q,"",de),f&&a&&a({action:x,location:re.location,delta:0})}function J(ne){let G=c.location.origin!=="null"?c.location.origin:c.location.href,Y=typeof ne=="string"?ne:hS(ne);return Y=Y.replace(/ $/,"%20"),Ds(G,"No window.location.(origin|href) available to create URL for href: "+Y),new URL(Y,G)}let re={get action(){return x},get location(){return e(c,_)},listen(ne){if(a)throw new Error("A history only accepts one active listener");return c.addEventListener(P6,O),a=ne,()=>{c.removeEventListener(P6,O),a=null}},createHref(ne){return t(c,ne)},createURL:J,encodeLocation(ne){let G=J(ne);return{pathname:G.pathname,search:G.search,hash:G.hash}},push:F,replace:Z,go(ne){return _.go(ne)}};return re}var M6;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(M6||(M6={}));function Hte(e,t,r){return r===void 0&&(r="/"),Zte(e,t,r,!1)}function Zte(e,t,r,s){let c=typeof t=="string"?Xy(t):t,f=Ty(c.pathname||"/",r);if(f==null)return null;let _=O7(e);Xte(_);let x=null;for(let a=0;x==null&&a<_.length;++a){let I=one(f);x=ine(_[a],I,s)}return x}function O7(e,t,r,s){t===void 0&&(t=[]),r===void 0&&(r=[]),s===void 0&&(s="");let c=(f,_,x)=>{let a={relativePath:x===void 0?f.path||"":x,caseSensitive:f.caseSensitive===!0,childrenIndex:_,route:f};a.relativePath.startsWith("/")&&(Ds(a.relativePath.startsWith(s),'Absolute route path "'+a.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),a.relativePath=a.relativePath.slice(s.length));let I=If([s,a.relativePath]),D=r.concat(a);f.children&&f.children.length>0&&(Ds(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+I+'".')),O7(f.children,t,D,I)),!(f.path==null&&!f.index)&&t.push({path:I,score:nne(I,f.index),routesMeta:D})};return e.forEach((f,_)=>{var x;if(f.path===""||!((x=f.path)!=null&&x.includes("?")))c(f,_);else for(let a of L7(f.path))c(f,_,a)}),t}function L7(e){let t=e.split("/");if(t.length===0)return[];let[r,...s]=t,c=r.endsWith("?"),f=r.replace(/\?$/,"");if(s.length===0)return c?[f,""]:[f];let _=L7(s.join("/")),x=[];return x.push(..._.map(a=>a===""?f:[f,a].join("/"))),c&&x.push(..._),x.map(a=>e.startsWith("/")&&a===""?"/":a)}function Xte(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:rne(t.routesMeta.map(s=>s.childrenIndex),r.routesMeta.map(s=>s.childrenIndex)))}const Kte=/^:[\w-]+$/,Qte=3,Yte=2,Jte=1,ene=10,tne=-2,k6=e=>e==="*";function nne(e,t){let r=e.split("/"),s=r.length;return r.some(k6)&&(s+=tne),t&&(s+=Yte),r.filter(c=>!k6(c)).reduce((c,f)=>c+(Kte.test(f)?Qte:f===""?Jte:ene),s)}function rne(e,t){return e.length===t.length&&e.slice(0,-1).every((s,c)=>s===t[c])?e[e.length-1]-t[t.length-1]:0}function ine(e,t,r){let{routesMeta:s}=e,c={},f="/",_=[];for(let x=0;x<s.length;++x){let a=s[x],I=x===s.length-1,D=f==="/"?t:t.slice(f.length)||"/",O=dS({path:a.relativePath,caseSensitive:a.caseSensitive,end:I},D),F=a.route;if(!O&&I&&r&&!s[s.length-1].route.index&&(O=dS({path:a.relativePath,caseSensitive:a.caseSensitive,end:!1},D)),!O)return null;Object.assign(c,O.params),_.push({params:c,pathname:If([f,O.pathname]),pathnameBase:une(If([f,O.pathnameBase])),route:F}),O.pathnameBase!=="/"&&(f=If([f,O.pathnameBase]))}return _}function dS(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,s]=sne(e.path,e.caseSensitive,e.end),c=t.match(r);if(!c)return null;let f=c[0],_=f.replace(/(.)\/+$/,"$1"),x=c.slice(1);return{params:s.reduce((I,D,O)=>{let{paramName:F,isOptional:Z}=D;if(F==="*"){let re=x[O]||"";_=f.slice(0,f.length-re.length).replace(/(.)\/+$/,"$1")}const J=x[O];return Z&&!J?I[F]=void 0:I[F]=(J||"").replace(/%2F/g,"/"),I},{}),pathname:f,pathnameBase:_,pattern:e}}function sne(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),D7(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let s=[],c="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,x,a)=>(s.push({paramName:x,isOptional:a!=null}),a?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),c+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":e!==""&&e!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,t?void 0:"i"),s]}function one(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return D7(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Ty(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,s=e.charAt(r);return s&&s!=="/"?null:e.slice(r)||"/"}function ane(e,t){t===void 0&&(t="/");let{pathname:r,search:s="",hash:c=""}=typeof e=="string"?Xy(e):e;return{pathname:r?r.startsWith("/")?r:lne(r,t):t,search:hne(s),hash:dne(c)}}function lne(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(c=>{c===".."?r.length>1&&r.pop():c!=="."&&r.push(c)}),r.length>1?r.join("/"):"/"}function J3(e,t,r,s){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function cne(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function z7(e,t){let r=cne(e);return t?r.map((s,c)=>c===r.length-1?s.pathname:s.pathnameBase):r.map(s=>s.pathnameBase)}function N7(e,t,r,s){s===void 0&&(s=!1);let c;typeof e=="string"?c=Xy(e):(c=cx({},e),Ds(!c.pathname||!c.pathname.includes("?"),J3("?","pathname","search",c)),Ds(!c.pathname||!c.pathname.includes("#"),J3("#","pathname","hash",c)),Ds(!c.search||!c.search.includes("#"),J3("#","search","hash",c)));let f=e===""||c.pathname==="",_=f?"/":c.pathname,x;if(_==null)x=r;else{let O=t.length-1;if(!s&&_.startsWith("..")){let F=_.split("/");for(;F[0]==="..";)F.shift(),O-=1;c.pathname=F.join("/")}x=O>=0?t[O]:"/"}let a=ane(c,x),I=_&&_!=="/"&&_.endsWith("/"),D=(f||_===".")&&r.endsWith("/");return!a.pathname.endsWith("/")&&(I||D)&&(a.pathname+="/"),a}const If=e=>e.join("/").replace(/\/\/+/g,"/"),une=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),hne=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,dne=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function fne(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const F7=["post","put","patch","delete"];new Set(F7);const pne=["get",...F7];new Set(pne);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ux(){return ux=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ux.apply(this,arguments)}const CI=W.createContext(null),B7=W.createContext(null),Hf=W.createContext(null),AI=W.createContext(null),Km=W.createContext({outlet:null,matches:[],isDataRoute:!1}),j7=W.createContext(null);function mne(e,t){let{relative:r}=t===void 0?{}:t;Hx()||Ds(!1);let{basename:s,navigator:c}=W.useContext(Hf),{hash:f,pathname:_,search:x}=PI(e,{relative:r}),a=_;return s!=="/"&&(a=_==="/"?s:If([s,_])),c.createHref({pathname:a,search:x,hash:f})}function Hx(){return W.useContext(AI)!=null}function Zx(){return Hx()||Ds(!1),W.useContext(AI).location}function U7(e){W.useContext(Hf).static||W.useLayoutEffect(e)}function Qm(){let{isDataRoute:e}=W.useContext(Km);return e?Ane():gne()}function gne(){Hx()||Ds(!1);let e=W.useContext(CI),{basename:t,future:r,navigator:s}=W.useContext(Hf),{matches:c}=W.useContext(Km),{pathname:f}=Zx(),_=JSON.stringify(z7(c,r.v7_relativeSplatPath)),x=W.useRef(!1);return U7(()=>{x.current=!0}),W.useCallback(function(I,D){if(D===void 0&&(D={}),!x.current)return;if(typeof I=="number"){s.go(I);return}let O=N7(I,JSON.parse(_),f,D.relative==="path");e==null&&t!=="/"&&(O.pathname=O.pathname==="/"?t:If([t,O.pathname])),(D.replace?s.replace:s.push)(O,D.state,D)},[t,s,_,f,e])}function PI(e,t){let{relative:r}=t===void 0?{}:t,{future:s}=W.useContext(Hf),{matches:c}=W.useContext(Km),{pathname:f}=Zx(),_=JSON.stringify(z7(c,s.v7_relativeSplatPath));return W.useMemo(()=>N7(e,JSON.parse(_),f,r==="path"),[e,_,f,r])}function _ne(e,t){return yne(e,t)}function yne(e,t,r,s){Hx()||Ds(!1);let{navigator:c}=W.useContext(Hf),{matches:f}=W.useContext(Km),_=f[f.length-1],x=_?_.params:{};_&&_.pathname;let a=_?_.pathnameBase:"/";_&&_.route;let I=Zx(),D;if(t){var O;let ne=typeof t=="string"?Xy(t):t;a==="/"||(O=ne.pathname)!=null&&O.startsWith(a)||Ds(!1),D=ne}else D=I;let F=D.pathname||"/",Z=F;if(a!=="/"){let ne=a.replace(/^\//,"").split("/");Z="/"+F.replace(/^\//,"").split("/").slice(ne.length).join("/")}let J=Hte(e,{pathname:Z}),re=Tne(J&&J.map(ne=>Object.assign({},ne,{params:Object.assign({},x,ne.params),pathname:If([a,c.encodeLocation?c.encodeLocation(ne.pathname).pathname:ne.pathname]),pathnameBase:ne.pathnameBase==="/"?a:If([a,c.encodeLocation?c.encodeLocation(ne.pathnameBase).pathname:ne.pathnameBase])})),f,r,s);return t&&re?W.createElement(AI.Provider,{value:{location:ux({pathname:"/",search:"",hash:"",state:null,key:"default"},D),navigationType:ff.Pop}},re):re}function vne(){let e=Cne(),t=fne(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return W.createElement(W.Fragment,null,W.createElement("h2",null,"Unexpected Application Error!"),W.createElement("h3",{style:{fontStyle:"italic"}},t),r?W.createElement("pre",{style:c},r):null,null)}const xne=W.createElement(vne,null);class bne extends W.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?W.createElement(Km.Provider,{value:this.props.routeContext},W.createElement(j7.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function wne(e){let{routeContext:t,match:r,children:s}=e,c=W.useContext(CI);return c&&c.static&&c.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=r.route.id),W.createElement(Km.Provider,{value:t},s)}function Tne(e,t,r,s){var c;if(t===void 0&&(t=[]),r===void 0&&(r=null),s===void 0&&(s=null),e==null){var f;if(!r)return null;if(r.errors)e=r.matches;else if((f=s)!=null&&f.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let _=e,x=(c=r)==null?void 0:c.errors;if(x!=null){let D=_.findIndex(O=>O.route.id&&(x==null?void 0:x[O.route.id])!==void 0);D>=0||Ds(!1),_=_.slice(0,Math.min(_.length,D+1))}let a=!1,I=-1;if(r&&s&&s.v7_partialHydration)for(let D=0;D<_.length;D++){let O=_[D];if((O.route.HydrateFallback||O.route.hydrateFallbackElement)&&(I=D),O.route.id){let{loaderData:F,errors:Z}=r,J=O.route.loader&&F[O.route.id]===void 0&&(!Z||Z[O.route.id]===void 0);if(O.route.lazy||J){a=!0,I>=0?_=_.slice(0,I+1):_=[_[0]];break}}}return _.reduceRight((D,O,F)=>{let Z,J=!1,re=null,ne=null;r&&(Z=x&&O.route.id?x[O.route.id]:void 0,re=O.route.errorElement||xne,a&&(I<0&&F===0?(J=!0,ne=null):I===F&&(J=!0,ne=O.route.hydrateFallbackElement||null)));let G=t.concat(_.slice(0,F+1)),Y=()=>{let Q;return Z?Q=re:J?Q=ne:O.route.Component?Q=W.createElement(O.route.Component,null):O.route.element?Q=O.route.element:Q=D,W.createElement(wne,{match:O,routeContext:{outlet:D,matches:G,isDataRoute:r!=null},children:Q})};return r&&(O.route.ErrorBoundary||O.route.errorElement||F===0)?W.createElement(bne,{location:r.location,revalidation:r.revalidation,component:re,error:Z,children:Y(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):Y()},null)}var V7=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(V7||{}),fS=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(fS||{});function Ene(e){let t=W.useContext(CI);return t||Ds(!1),t}function Sne(e){let t=W.useContext(B7);return t||Ds(!1),t}function Ine(e){let t=W.useContext(Km);return t||Ds(!1),t}function $7(e){let t=Ine(),r=t.matches[t.matches.length-1];return r.route.id||Ds(!1),r.route.id}function Cne(){var e;let t=W.useContext(j7),r=Sne(fS.UseRouteError),s=$7(fS.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[s]}function Ane(){let{router:e}=Ene(V7.UseNavigateStable),t=$7(fS.UseNavigateStable),r=W.useRef(!1);return U7(()=>{r.current=!0}),W.useCallback(function(c,f){f===void 0&&(f={}),r.current&&(typeof c=="number"?e.navigate(c):e.navigate(c,ux({fromRouteId:t},f)))},[e,t])}function Oc(e){Ds(!1)}function Pne(e){let{basename:t="/",children:r=null,location:s,navigationType:c=ff.Pop,navigator:f,static:_=!1,future:x}=e;Hx()&&Ds(!1);let a=t.replace(/^\/*/,"/"),I=W.useMemo(()=>({basename:a,navigator:f,static:_,future:ux({v7_relativeSplatPath:!1},x)}),[a,x,f,_]);typeof s=="string"&&(s=Xy(s));let{pathname:D="/",search:O="",hash:F="",state:Z=null,key:J="default"}=s,re=W.useMemo(()=>{let ne=Ty(D,a);return ne==null?null:{location:{pathname:ne,search:O,hash:F,state:Z,key:J},navigationType:c}},[a,D,O,F,Z,J,c]);return re==null?null:W.createElement(Hf.Provider,{value:I},W.createElement(AI.Provider,{children:r,value:re}))}function q7(e){let{children:t,location:r}=e;return _ne(qM(t),r)}new Promise(()=>{});function qM(e,t){t===void 0&&(t=[]);let r=[];return W.Children.forEach(e,(s,c)=>{if(!W.isValidElement(s))return;let f=[...t,c];if(s.type===W.Fragment){r.push.apply(r,qM(s.props.children,f));return}s.type!==Oc&&Ds(!1),!s.props.index||!s.props.children||Ds(!1);let _={id:s.props.id||f.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(_.children=qM(s.props.children,f)),r.push(_)}),r}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pS(){return pS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},pS.apply(this,arguments)}function G7(e,t){if(e==null)return{};var r={},s=Object.keys(e),c,f;for(f=0;f<s.length;f++)c=s[f],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function Rne(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Mne(e,t){return e.button===0&&(!t||t==="_self")&&!Rne(e)}const kne=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],Dne=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],One="6";try{window.__reactRouterVersion=One}catch{}const Lne=W.createContext({isTransitioning:!1}),zne="startTransition",D6=jE[zne];function Nne(e){let{basename:t,children:r,future:s,window:c}=e,f=W.useRef();f.current==null&&(f.current=qte({window:c,v5Compat:!0}));let _=f.current,[x,a]=W.useState({action:_.action,location:_.location}),{v7_startTransition:I}=s||{},D=W.useCallback(O=>{I&&D6?D6(()=>a(O)):a(O)},[a,I]);return W.useLayoutEffect(()=>_.listen(D),[_,D]),W.createElement(Pne,{basename:t,children:r,location:x.location,navigationType:x.action,navigator:_,future:s})}const Fne=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Bne=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,RI=W.forwardRef(function(t,r){let{onClick:s,relative:c,reloadDocument:f,replace:_,state:x,target:a,to:I,preventScrollReset:D,unstable_viewTransition:O}=t,F=G7(t,kne),{basename:Z}=W.useContext(Hf),J,re=!1;if(typeof I=="string"&&Bne.test(I)&&(J=I,Fne))try{let Q=new URL(window.location.href),de=I.startsWith("//")?new URL(Q.protocol+I):new URL(I),Te=Ty(de.pathname,Z);de.origin===Q.origin&&Te!=null?I=Te+de.search+de.hash:re=!0}catch{}let ne=mne(I,{relative:c}),G=Vne(I,{replace:_,state:x,target:a,preventScrollReset:D,relative:c,unstable_viewTransition:O});function Y(Q){s&&s(Q),Q.defaultPrevented||G(Q)}return W.createElement("a",pS({},F,{href:J||ne,onClick:re||f?s:Y,ref:r,target:a}))}),jne=W.forwardRef(function(t,r){let{"aria-current":s="page",caseSensitive:c=!1,className:f="",end:_=!1,style:x,to:a,unstable_viewTransition:I,children:D}=t,O=G7(t,Dne),F=PI(a,{relative:O.relative}),Z=Zx(),J=W.useContext(B7),{navigator:re,basename:ne}=W.useContext(Hf),G=J!=null&&$ne(F)&&I===!0,Y=re.encodeLocation?re.encodeLocation(F).pathname:F.pathname,Q=Z.pathname,de=J&&J.navigation&&J.navigation.location?J.navigation.location.pathname:null;c||(Q=Q.toLowerCase(),de=de?de.toLowerCase():null,Y=Y.toLowerCase()),de&&ne&&(de=Ty(de,ne)||de);const Te=Y!=="/"&&Y.endsWith("/")?Y.length-1:Y.length;let we=Q===Y||!_&&Q.startsWith(Y)&&Q.charAt(Te)==="/",oe=de!=null&&(de===Y||!_&&de.startsWith(Y)&&de.charAt(Y.length)==="/"),he={isActive:we,isPending:oe,isTransitioning:G},X=we?s:void 0,ge;typeof f=="function"?ge=f(he):ge=[f,we?"active":null,oe?"pending":null,G?"transitioning":null].filter(Boolean).join(" ");let be=typeof x=="function"?x(he):x;return W.createElement(RI,pS({},O,{"aria-current":X,className:ge,ref:r,style:be,to:a,unstable_viewTransition:I}),typeof D=="function"?D(he):D)});var GM;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(GM||(GM={}));var O6;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(O6||(O6={}));function Une(e){let t=W.useContext(CI);return t||Ds(!1),t}function Vne(e,t){let{target:r,replace:s,state:c,preventScrollReset:f,relative:_,unstable_viewTransition:x}=t===void 0?{}:t,a=Qm(),I=Zx(),D=PI(e,{relative:_});return W.useCallback(O=>{if(Mne(O,r)){O.preventDefault();let F=s!==void 0?s:hS(I)===hS(D);a(e,{replace:F,state:c,preventScrollReset:f,relative:_,unstable_viewTransition:x})}},[I,a,D,s,c,r,e,f,_,x])}function $ne(e,t){t===void 0&&(t={});let r=W.useContext(Lne);r==null&&Ds(!1);let{basename:s}=Une(GM.useViewTransitionState),c=PI(e,{relative:t.relative});if(!r.isTransitioning)return!1;let f=Ty(r.currentLocation.pathname,s)||r.currentLocation.pathname,_=Ty(r.nextLocation.pathname,s)||r.nextLocation.pathname;return dS(c.pathname,_)!=null||dS(c.pathname,f)!=null}var qne=function(t){return Gne(t)&&!Wne(t)};function Gne(e){return!!e&&typeof e=="object"}function Wne(e){var t=Object.prototype.toString.call(e);return t==="[object RegExp]"||t==="[object Date]"||Xne(e)}var Hne=typeof Symbol=="function"&&Symbol.for,Zne=Hne?Symbol.for("react.element"):60103;function Xne(e){return e.$$typeof===Zne}function Kne(e){return Array.isArray(e)?[]:{}}function mS(e,t){return t.clone!==!1&&t.isMergeableObject(e)?hx(Kne(e),e,t):e}function Qne(e,t,r){return e.concat(t).map(function(s){return mS(s,r)})}function Yne(e,t,r){var s={};return r.isMergeableObject(e)&&Object.keys(e).forEach(function(c){s[c]=mS(e[c],r)}),Object.keys(t).forEach(function(c){!r.isMergeableObject(t[c])||!e[c]?s[c]=mS(t[c],r):s[c]=hx(e[c],t[c],r)}),s}function hx(e,t,r){r=r||{},r.arrayMerge=r.arrayMerge||Qne,r.isMergeableObject=r.isMergeableObject||qne;var s=Array.isArray(t),c=Array.isArray(e),f=s===c;return f?s?r.arrayMerge(e,t,r):Yne(e,t,r):mS(t,r)}hx.all=function(t,r){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(s,c){return hx(s,c,r)},{})};var WM=hx,W7=typeof global=="object"&&global&&global.Object===Object&&global,Jne=typeof self=="object"&&self&&self.Object===Object&&self,Gu=W7||Jne||Function("return this")(),Of=Gu.Symbol,H7=Object.prototype,ere=H7.hasOwnProperty,tre=H7.toString,Uv=Of?Of.toStringTag:void 0;function nre(e){var t=ere.call(e,Uv),r=e[Uv];try{e[Uv]=void 0;var s=!0}catch{}var c=tre.call(e);return s&&(t?e[Uv]=r:delete e[Uv]),c}var rre=Object.prototype,ire=rre.toString;function sre(e){return ire.call(e)}var ore="[object Null]",are="[object Undefined]",L6=Of?Of.toStringTag:void 0;function Ym(e){return e==null?e===void 0?are:ore:L6&&L6 in Object(e)?nre(e):sre(e)}function Z7(e,t){return function(r){return e(t(r))}}var AD=Z7(Object.getPrototypeOf,Object);function Jm(e){return e!=null&&typeof e=="object"}var lre="[object Object]",cre=Function.prototype,ure=Object.prototype,X7=cre.toString,hre=ure.hasOwnProperty,dre=X7.call(Object);function z6(e){if(!Jm(e)||Ym(e)!=lre)return!1;var t=AD(e);if(t===null)return!0;var r=hre.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&X7.call(r)==dre}function fre(){this.__data__=[],this.size=0}function K7(e,t){return e===t||e!==e&&t!==t}function MI(e,t){for(var r=e.length;r--;)if(K7(e[r][0],t))return r;return-1}var pre=Array.prototype,mre=pre.splice;function gre(e){var t=this.__data__,r=MI(t,e);if(r<0)return!1;var s=t.length-1;return r==s?t.pop():mre.call(t,r,1),--this.size,!0}function _re(e){var t=this.__data__,r=MI(t,e);return r<0?void 0:t[r][1]}function yre(e){return MI(this.__data__,e)>-1}function vre(e,t){var r=this.__data__,s=MI(r,e);return s<0?(++this.size,r.push([e,t])):r[s][1]=t,this}function nd(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}nd.prototype.clear=fre;nd.prototype.delete=gre;nd.prototype.get=_re;nd.prototype.has=yre;nd.prototype.set=vre;function xre(){this.__data__=new nd,this.size=0}function bre(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function wre(e){return this.__data__.get(e)}function Tre(e){return this.__data__.has(e)}function Xx(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ere="[object AsyncFunction]",Sre="[object Function]",Ire="[object GeneratorFunction]",Cre="[object Proxy]";function Q7(e){if(!Xx(e))return!1;var t=Ym(e);return t==Sre||t==Ire||t==Ere||t==Cre}var eR=Gu["__core-js_shared__"],N6=function(){var e=/[^.]+$/.exec(eR&&eR.keys&&eR.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Are(e){return!!N6&&N6 in e}var Pre=Function.prototype,Rre=Pre.toString;function eg(e){if(e!=null){try{return Rre.call(e)}catch{}try{return e+""}catch{}}return""}var Mre=/[\\^$.*+?()[\]{}|]/g,kre=/^\[object .+?Constructor\]$/,Dre=Function.prototype,Ore=Object.prototype,Lre=Dre.toString,zre=Ore.hasOwnProperty,Nre=RegExp("^"+Lre.call(zre).replace(Mre,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Fre(e){if(!Xx(e)||Are(e))return!1;var t=Q7(e)?Nre:kre;return t.test(eg(e))}function Bre(e,t){return e==null?void 0:e[t]}function tg(e,t){var r=Bre(e,t);return Fre(r)?r:void 0}var dx=tg(Gu,"Map"),fx=tg(Object,"create");function jre(){this.__data__=fx?fx(null):{},this.size=0}function Ure(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Vre="__lodash_hash_undefined__",$re=Object.prototype,qre=$re.hasOwnProperty;function Gre(e){var t=this.__data__;if(fx){var r=t[e];return r===Vre?void 0:r}return qre.call(t,e)?t[e]:void 0}var Wre=Object.prototype,Hre=Wre.hasOwnProperty;function Zre(e){var t=this.__data__;return fx?t[e]!==void 0:Hre.call(t,e)}var Xre="__lodash_hash_undefined__";function Kre(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=fx&&t===void 0?Xre:t,this}function Lm(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}Lm.prototype.clear=jre;Lm.prototype.delete=Ure;Lm.prototype.get=Gre;Lm.prototype.has=Zre;Lm.prototype.set=Kre;function Qre(){this.size=0,this.__data__={hash:new Lm,map:new(dx||nd),string:new Lm}}function Yre(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function kI(e,t){var r=e.__data__;return Yre(t)?r[typeof t=="string"?"string":"hash"]:r.map}function Jre(e){var t=kI(this,e).delete(e);return this.size-=t?1:0,t}function eie(e){return kI(this,e).get(e)}function tie(e){return kI(this,e).has(e)}function nie(e,t){var r=kI(this,e),s=r.size;return r.set(e,t),this.size+=r.size==s?0:1,this}function Zf(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}Zf.prototype.clear=Qre;Zf.prototype.delete=Jre;Zf.prototype.get=eie;Zf.prototype.has=tie;Zf.prototype.set=nie;var rie=200;function iie(e,t){var r=this.__data__;if(r instanceof nd){var s=r.__data__;if(!dx||s.length<rie-1)return s.push([e,t]),this.size=++r.size,this;r=this.__data__=new Zf(s)}return r.set(e,t),this.size=r.size,this}function Ky(e){var t=this.__data__=new nd(e);this.size=t.size}Ky.prototype.clear=xre;Ky.prototype.delete=bre;Ky.prototype.get=wre;Ky.prototype.has=Tre;Ky.prototype.set=iie;function sie(e,t){for(var r=-1,s=e==null?0:e.length;++r<s&&t(e[r],r,e)!==!1;);return e}var F6=function(){try{var e=tg(Object,"defineProperty");return e({},"",{}),e}catch{}}();function Y7(e,t,r){t=="__proto__"&&F6?F6(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var oie=Object.prototype,aie=oie.hasOwnProperty;function J7(e,t,r){var s=e[t];(!(aie.call(e,t)&&K7(s,r))||r===void 0&&!(t in e))&&Y7(e,t,r)}function DI(e,t,r,s){var c=!r;r||(r={});for(var f=-1,_=t.length;++f<_;){var x=t[f],a=void 0;a===void 0&&(a=e[x]),c?Y7(r,x,a):J7(r,x,a)}return r}function lie(e,t){for(var r=-1,s=Array(e);++r<e;)s[r]=t(r);return s}var cie="[object Arguments]";function B6(e){return Jm(e)&&Ym(e)==cie}var eq=Object.prototype,uie=eq.hasOwnProperty,hie=eq.propertyIsEnumerable,die=B6(function(){return arguments}())?B6:function(e){return Jm(e)&&uie.call(e,"callee")&&!hie.call(e,"callee")},Kx=Array.isArray;function fie(){return!1}var tq=typeof hl=="object"&&hl&&!hl.nodeType&&hl,j6=tq&&typeof dl=="object"&&dl&&!dl.nodeType&&dl,pie=j6&&j6.exports===tq,U6=pie?Gu.Buffer:void 0,mie=U6?U6.isBuffer:void 0,nq=mie||fie,gie=9007199254740991,_ie=/^(?:0|[1-9]\d*)$/;function yie(e,t){var r=typeof e;return t=t??gie,!!t&&(r=="number"||r!="symbol"&&_ie.test(e))&&e>-1&&e%1==0&&e<t}var vie=9007199254740991;function rq(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=vie}var xie="[object Arguments]",bie="[object Array]",wie="[object Boolean]",Tie="[object Date]",Eie="[object Error]",Sie="[object Function]",Iie="[object Map]",Cie="[object Number]",Aie="[object Object]",Pie="[object RegExp]",Rie="[object Set]",Mie="[object String]",kie="[object WeakMap]",Die="[object ArrayBuffer]",Oie="[object DataView]",Lie="[object Float32Array]",zie="[object Float64Array]",Nie="[object Int8Array]",Fie="[object Int16Array]",Bie="[object Int32Array]",jie="[object Uint8Array]",Uie="[object Uint8ClampedArray]",Vie="[object Uint16Array]",$ie="[object Uint32Array]",Ki={};Ki[Lie]=Ki[zie]=Ki[Nie]=Ki[Fie]=Ki[Bie]=Ki[jie]=Ki[Uie]=Ki[Vie]=Ki[$ie]=!0;Ki[xie]=Ki[bie]=Ki[Die]=Ki[wie]=Ki[Oie]=Ki[Tie]=Ki[Eie]=Ki[Sie]=Ki[Iie]=Ki[Cie]=Ki[Aie]=Ki[Pie]=Ki[Rie]=Ki[Mie]=Ki[kie]=!1;function qie(e){return Jm(e)&&rq(e.length)&&!!Ki[Ym(e)]}function PD(e){return function(t){return e(t)}}var iq=typeof hl=="object"&&hl&&!hl.nodeType&&hl,I1=iq&&typeof dl=="object"&&dl&&!dl.nodeType&&dl,Gie=I1&&I1.exports===iq,tR=Gie&&W7.process,Ey=function(){try{var e=I1&&I1.require&&I1.require("util").types;return e||tR&&tR.binding&&tR.binding("util")}catch{}}(),V6=Ey&&Ey.isTypedArray,Wie=V6?PD(V6):qie,Hie=Object.prototype,Zie=Hie.hasOwnProperty;function sq(e,t){var r=Kx(e),s=!r&&die(e),c=!r&&!s&&nq(e),f=!r&&!s&&!c&&Wie(e),_=r||s||c||f,x=_?lie(e.length,String):[],a=x.length;for(var I in e)(t||Zie.call(e,I))&&!(_&&(I=="length"||c&&(I=="offset"||I=="parent")||f&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||yie(I,a)))&&x.push(I);return x}var Xie=Object.prototype;function RD(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Xie;return e===r}var Kie=Z7(Object.keys,Object),Qie=Object.prototype,Yie=Qie.hasOwnProperty;function Jie(e){if(!RD(e))return Kie(e);var t=[];for(var r in Object(e))Yie.call(e,r)&&r!="constructor"&&t.push(r);return t}function oq(e){return e!=null&&rq(e.length)&&!Q7(e)}function MD(e){return oq(e)?sq(e):Jie(e)}function ese(e,t){return e&&DI(t,MD(t),e)}function tse(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var nse=Object.prototype,rse=nse.hasOwnProperty;function ise(e){if(!Xx(e))return tse(e);var t=RD(e),r=[];for(var s in e)s=="constructor"&&(t||!rse.call(e,s))||r.push(s);return r}function kD(e){return oq(e)?sq(e,!0):ise(e)}function sse(e,t){return e&&DI(t,kD(t),e)}var aq=typeof hl=="object"&&hl&&!hl.nodeType&&hl,$6=aq&&typeof dl=="object"&&dl&&!dl.nodeType&&dl,ose=$6&&$6.exports===aq,q6=ose?Gu.Buffer:void 0,G6=q6?q6.allocUnsafe:void 0;function ase(e,t){if(t)return e.slice();var r=e.length,s=G6?G6(r):new e.constructor(r);return e.copy(s),s}function lq(e,t){var r=-1,s=e.length;for(t||(t=Array(s));++r<s;)t[r]=e[r];return t}function lse(e,t){for(var r=-1,s=e==null?0:e.length,c=0,f=[];++r<s;){var _=e[r];t(_,r,e)&&(f[c++]=_)}return f}function cq(){return[]}var cse=Object.prototype,use=cse.propertyIsEnumerable,W6=Object.getOwnPropertySymbols,DD=W6?function(e){return e==null?[]:(e=Object(e),lse(W6(e),function(t){return use.call(e,t)}))}:cq;function hse(e,t){return DI(e,DD(e),t)}function uq(e,t){for(var r=-1,s=t.length,c=e.length;++r<s;)e[c+r]=t[r];return e}var dse=Object.getOwnPropertySymbols,hq=dse?function(e){for(var t=[];e;)uq(t,DD(e)),e=AD(e);return t}:cq;function fse(e,t){return DI(e,hq(e),t)}function dq(e,t,r){var s=t(e);return Kx(e)?s:uq(s,r(e))}function pse(e){return dq(e,MD,DD)}function mse(e){return dq(e,kD,hq)}var HM=tg(Gu,"DataView"),ZM=tg(Gu,"Promise"),XM=tg(Gu,"Set"),KM=tg(Gu,"WeakMap"),H6="[object Map]",gse="[object Object]",Z6="[object Promise]",X6="[object Set]",K6="[object WeakMap]",Q6="[object DataView]",_se=eg(HM),yse=eg(dx),vse=eg(ZM),xse=eg(XM),bse=eg(KM),Rh=Ym;(HM&&Rh(new HM(new ArrayBuffer(1)))!=Q6||dx&&Rh(new dx)!=H6||ZM&&Rh(ZM.resolve())!=Z6||XM&&Rh(new XM)!=X6||KM&&Rh(new KM)!=K6)&&(Rh=function(e){var t=Ym(e),r=t==gse?e.constructor:void 0,s=r?eg(r):"";if(s)switch(s){case _se:return Q6;case yse:return H6;case vse:return Z6;case xse:return X6;case bse:return K6}return t});var wse=Object.prototype,Tse=wse.hasOwnProperty;function Ese(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&Tse.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Y6=Gu.Uint8Array;function OD(e){var t=new e.constructor(e.byteLength);return new Y6(t).set(new Y6(e)),t}function Sse(e,t){var r=t?OD(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var Ise=/\w*$/;function Cse(e){var t=new e.constructor(e.source,Ise.exec(e));return t.lastIndex=e.lastIndex,t}var J6=Of?Of.prototype:void 0,ej=J6?J6.valueOf:void 0;function Ase(e){return ej?Object(ej.call(e)):{}}function Pse(e,t){var r=t?OD(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var Rse="[object Boolean]",Mse="[object Date]",kse="[object Map]",Dse="[object Number]",Ose="[object RegExp]",Lse="[object Set]",zse="[object String]",Nse="[object Symbol]",Fse="[object ArrayBuffer]",Bse="[object DataView]",jse="[object Float32Array]",Use="[object Float64Array]",Vse="[object Int8Array]",$se="[object Int16Array]",qse="[object Int32Array]",Gse="[object Uint8Array]",Wse="[object Uint8ClampedArray]",Hse="[object Uint16Array]",Zse="[object Uint32Array]";function Xse(e,t,r){var s=e.constructor;switch(t){case Fse:return OD(e);case Rse:case Mse:return new s(+e);case Bse:return Sse(e,r);case jse:case Use:case Vse:case $se:case qse:case Gse:case Wse:case Hse:case Zse:return Pse(e,r);case kse:return new s;case Dse:case zse:return new s(e);case Ose:return Cse(e);case Lse:return new s;case Nse:return Ase(e)}}var tj=Object.create,Kse=function(){function e(){}return function(t){if(!Xx(t))return{};if(tj)return tj(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function Qse(e){return typeof e.constructor=="function"&&!RD(e)?Kse(AD(e)):{}}var Yse="[object Map]";function Jse(e){return Jm(e)&&Rh(e)==Yse}var nj=Ey&&Ey.isMap,eoe=nj?PD(nj):Jse,toe="[object Set]";function noe(e){return Jm(e)&&Rh(e)==toe}var rj=Ey&&Ey.isSet,roe=rj?PD(rj):noe,ioe=1,soe=2,ooe=4,fq="[object Arguments]",aoe="[object Array]",loe="[object Boolean]",coe="[object Date]",uoe="[object Error]",pq="[object Function]",hoe="[object GeneratorFunction]",doe="[object Map]",foe="[object Number]",mq="[object Object]",poe="[object RegExp]",moe="[object Set]",goe="[object String]",_oe="[object Symbol]",yoe="[object WeakMap]",voe="[object ArrayBuffer]",xoe="[object DataView]",boe="[object Float32Array]",woe="[object Float64Array]",Toe="[object Int8Array]",Eoe="[object Int16Array]",Soe="[object Int32Array]",Ioe="[object Uint8Array]",Coe="[object Uint8ClampedArray]",Aoe="[object Uint16Array]",Poe="[object Uint32Array]",Vi={};Vi[fq]=Vi[aoe]=Vi[voe]=Vi[xoe]=Vi[loe]=Vi[coe]=Vi[boe]=Vi[woe]=Vi[Toe]=Vi[Eoe]=Vi[Soe]=Vi[doe]=Vi[foe]=Vi[mq]=Vi[poe]=Vi[moe]=Vi[goe]=Vi[_oe]=Vi[Ioe]=Vi[Coe]=Vi[Aoe]=Vi[Poe]=!0;Vi[uoe]=Vi[pq]=Vi[yoe]=!1;function C1(e,t,r,s,c,f){var _,x=t&ioe,a=t&soe,I=t&ooe;if(_!==void 0)return _;if(!Xx(e))return e;var D=Kx(e);if(D){if(_=Ese(e),!x)return lq(e,_)}else{var O=Rh(e),F=O==pq||O==hoe;if(nq(e))return ase(e,x);if(O==mq||O==fq||F&&!c){if(_=a||F?{}:Qse(e),!x)return a?fse(e,sse(_,e)):hse(e,ese(_,e))}else{if(!Vi[O])return c?e:{};_=Xse(e,O,x)}}f||(f=new Ky);var Z=f.get(e);if(Z)return Z;f.set(e,_),roe(e)?e.forEach(function(ne){_.add(C1(ne,t,r,ne,e,f))}):eoe(e)&&e.forEach(function(ne,G){_.set(G,C1(ne,t,r,G,e,f))});var J=I?a?mse:pse:a?kD:MD,re=D?void 0:J(e);return sie(re||e,function(ne,G){re&&(G=ne,ne=e[G]),J7(_,G,C1(ne,t,r,G,e,f))}),_}var Roe=1,Moe=4;function OT(e){return C1(e,Roe|Moe)}var ij=Array.isArray,sj=Object.keys,koe=Object.prototype.hasOwnProperty,Doe=typeof Element<"u";function QM(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=ij(e),s=ij(t),c,f,_;if(r&&s){if(f=e.length,f!=t.length)return!1;for(c=f;c--!==0;)if(!QM(e[c],t[c]))return!1;return!0}if(r!=s)return!1;var x=e instanceof Date,a=t instanceof Date;if(x!=a)return!1;if(x&&a)return e.getTime()==t.getTime();var I=e instanceof RegExp,D=t instanceof RegExp;if(I!=D)return!1;if(I&&D)return e.toString()==t.toString();var O=sj(e);if(f=O.length,f!==sj(t).length)return!1;for(c=f;c--!==0;)if(!koe.call(t,O[c]))return!1;if(Doe&&e instanceof Element&&t instanceof Element)return e===t;for(c=f;c--!==0;)if(_=O[c],!(_==="_owner"&&e.$$typeof)&&!QM(e[_],t[_]))return!1;return!0}return e!==e&&t!==t}var Ooe=function(t,r){try{return QM(t,r)}catch(s){if(s.message&&s.message.match(/stack|recursion/i)||s.number===-2146828260)return console.warn("Warning: react-fast-compare does not handle circular references.",s.name,s.message),!1;throw s}};const tm=Gy(Ooe);var Loe=4;function oj(e){return C1(e,Loe)}function gq(e,t){for(var r=-1,s=e==null?0:e.length,c=Array(s);++r<s;)c[r]=t(e[r],r,e);return c}var zoe="[object Symbol]";function LD(e){return typeof e=="symbol"||Jm(e)&&Ym(e)==zoe}var Noe="Expected a function";function zD(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Noe);var r=function(){var s=arguments,c=t?t.apply(this,s):s[0],f=r.cache;if(f.has(c))return f.get(c);var _=e.apply(this,s);return r.cache=f.set(c,_)||f,_};return r.cache=new(zD.Cache||Zf),r}zD.Cache=Zf;var Foe=500;function Boe(e){var t=zD(e,function(s){return r.size===Foe&&r.clear(),s}),r=t.cache;return t}var joe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Uoe=/\\(\\)?/g,Voe=Boe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(joe,function(r,s,c,f){t.push(c?f.replace(Uoe,"$1"):s||r)}),t}),$oe=1/0;function qoe(e){if(typeof e=="string"||LD(e))return e;var t=e+"";return t=="0"&&1/e==-$oe?"-0":t}var Goe=1/0,aj=Of?Of.prototype:void 0,lj=aj?aj.toString:void 0;function _q(e){if(typeof e=="string")return e;if(Kx(e))return gq(e,_q)+"";if(LD(e))return lj?lj.call(e):"";var t=e+"";return t=="0"&&1/e==-Goe?"-0":t}function Woe(e){return e==null?"":_q(e)}function yq(e){return Kx(e)?gq(e,qoe):LD(e)?[e]:lq(Voe(Woe(e)))}var vq={exports:{}},Ei={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var To=typeof Symbol=="function"&&Symbol.for,ND=To?Symbol.for("react.element"):60103,FD=To?Symbol.for("react.portal"):60106,OI=To?Symbol.for("react.fragment"):60107,LI=To?Symbol.for("react.strict_mode"):60108,zI=To?Symbol.for("react.profiler"):60114,NI=To?Symbol.for("react.provider"):60109,FI=To?Symbol.for("react.context"):60110,BD=To?Symbol.for("react.async_mode"):60111,BI=To?Symbol.for("react.concurrent_mode"):60111,jI=To?Symbol.for("react.forward_ref"):60112,UI=To?Symbol.for("react.suspense"):60113,Hoe=To?Symbol.for("react.suspense_list"):60120,VI=To?Symbol.for("react.memo"):60115,$I=To?Symbol.for("react.lazy"):60116,Zoe=To?Symbol.for("react.block"):60121,Xoe=To?Symbol.for("react.fundamental"):60117,Koe=To?Symbol.for("react.responder"):60118,Qoe=To?Symbol.for("react.scope"):60119;function bl(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case ND:switch(e=e.type,e){case BD:case BI:case OI:case zI:case LI:case UI:return e;default:switch(e=e&&e.$$typeof,e){case FI:case jI:case $I:case VI:case NI:return e;default:return t}}case FD:return t}}}function xq(e){return bl(e)===BI}Ei.AsyncMode=BD;Ei.ConcurrentMode=BI;Ei.ContextConsumer=FI;Ei.ContextProvider=NI;Ei.Element=ND;Ei.ForwardRef=jI;Ei.Fragment=OI;Ei.Lazy=$I;Ei.Memo=VI;Ei.Portal=FD;Ei.Profiler=zI;Ei.StrictMode=LI;Ei.Suspense=UI;Ei.isAsyncMode=function(e){return xq(e)||bl(e)===BD};Ei.isConcurrentMode=xq;Ei.isContextConsumer=function(e){return bl(e)===FI};Ei.isContextProvider=function(e){return bl(e)===NI};Ei.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===ND};Ei.isForwardRef=function(e){return bl(e)===jI};Ei.isFragment=function(e){return bl(e)===OI};Ei.isLazy=function(e){return bl(e)===$I};Ei.isMemo=function(e){return bl(e)===VI};Ei.isPortal=function(e){return bl(e)===FD};Ei.isProfiler=function(e){return bl(e)===zI};Ei.isStrictMode=function(e){return bl(e)===LI};Ei.isSuspense=function(e){return bl(e)===UI};Ei.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===OI||e===BI||e===zI||e===LI||e===UI||e===Hoe||typeof e=="object"&&e!==null&&(e.$$typeof===$I||e.$$typeof===VI||e.$$typeof===NI||e.$$typeof===FI||e.$$typeof===jI||e.$$typeof===Xoe||e.$$typeof===Koe||e.$$typeof===Qoe||e.$$typeof===Zoe)};Ei.typeOf=bl;vq.exports=Ei;var Yoe=vq.exports,bq=Yoe,Joe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},eae={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},wq={};wq[bq.ForwardRef]=Joe;wq[bq.Memo]=eae;function Qi(){return Qi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Qi.apply(this,arguments)}function W_(e,t){if(e==null)return{};var r={},s=Object.keys(e),c,f;for(f=0;f<s.length;f++)c=s[f],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}var qI=W.createContext(void 0);qI.displayName="FormikContext";var tae=qI.Provider;qI.Consumer;function Tq(){var e=W.useContext(qI);return e}var rl=function(t){return typeof t=="function"},GI=function(t){return t!==null&&typeof t=="object"},nae=function(t){return String(Math.floor(Number(t)))===t},nR=function(t){return Object.prototype.toString.call(t)==="[object String]"},rae=function(t){return W.Children.count(t)===0},rR=function(t){return GI(t)&&rl(t.then)};function nl(e,t,r,s){s===void 0&&(s=0);for(var c=yq(t);e&&s<c.length;)e=e[c[s++]];return s!==c.length&&!e||e===void 0?r:e}function bm(e,t,r){for(var s=oj(e),c=s,f=0,_=yq(t);f<_.length-1;f++){var x=_[f],a=nl(e,_.slice(0,f+1));if(a&&(GI(a)||Array.isArray(a)))c=c[x]=oj(a);else{var I=_[f+1];c=c[x]=nae(I)&&Number(I)>=0?[]:{}}}return(f===0?e:c)[_[f]]===r?e:(r===void 0?delete c[_[f]]:c[_[f]]=r,f===0&&r===void 0&&delete s[_[f]],s)}function Eq(e,t,r,s){r===void 0&&(r=new WeakMap),s===void 0&&(s={});for(var c=0,f=Object.keys(e);c<f.length;c++){var _=f[c],x=e[_];GI(x)?r.get(x)||(r.set(x,!0),s[_]=Array.isArray(x)?[]:{},Eq(x,t,r,s[_])):s[_]=t}return s}function iae(e,t){switch(t.type){case"SET_VALUES":return Qi({},e,{values:t.payload});case"SET_TOUCHED":return Qi({},e,{touched:t.payload});case"SET_ERRORS":return tm(e.errors,t.payload)?e:Qi({},e,{errors:t.payload});case"SET_STATUS":return Qi({},e,{status:t.payload});case"SET_ISSUBMITTING":return Qi({},e,{isSubmitting:t.payload});case"SET_ISVALIDATING":return Qi({},e,{isValidating:t.payload});case"SET_FIELD_VALUE":return Qi({},e,{values:bm(e.values,t.payload.field,t.payload.value)});case"SET_FIELD_TOUCHED":return Qi({},e,{touched:bm(e.touched,t.payload.field,t.payload.value)});case"SET_FIELD_ERROR":return Qi({},e,{errors:bm(e.errors,t.payload.field,t.payload.value)});case"RESET_FORM":return Qi({},e,t.payload);case"SET_FORMIK_STATE":return t.payload(e);case"SUBMIT_ATTEMPT":return Qi({},e,{touched:Eq(e.values,!0),isSubmitting:!0,submitCount:e.submitCount+1});case"SUBMIT_FAILURE":return Qi({},e,{isSubmitting:!1});case"SUBMIT_SUCCESS":return Qi({},e,{isSubmitting:!1});default:return e}}var Qp={},LT={};function sae(e){var t=e.validateOnChange,r=t===void 0?!0:t,s=e.validateOnBlur,c=s===void 0?!0:s,f=e.validateOnMount,_=f===void 0?!1:f,x=e.isInitialValid,a=e.enableReinitialize,I=a===void 0?!1:a,D=e.onSubmit,O=W_(e,["validateOnChange","validateOnBlur","validateOnMount","isInitialValid","enableReinitialize","onSubmit"]),F=Qi({validateOnChange:r,validateOnBlur:c,validateOnMount:_,onSubmit:D},O),Z=W.useRef(F.initialValues),J=W.useRef(F.initialErrors||Qp),re=W.useRef(F.initialTouched||LT),ne=W.useRef(F.initialStatus),G=W.useRef(!1),Y=W.useRef({});W.useEffect(function(){return G.current=!0,function(){G.current=!1}},[]);var Q=W.useState(0),de=Q[1],Te=W.useRef({values:OT(F.initialValues),errors:OT(F.initialErrors)||Qp,touched:OT(F.initialTouched)||LT,status:OT(F.initialStatus),isSubmitting:!1,isValidating:!1,submitCount:0}),we=Te.current,oe=W.useCallback(function(Ye){var st=Te.current;Te.current=iae(st,Ye),st!==Te.current&&de(function(Mt){return Mt+1})},[]),he=W.useCallback(function(Ye,st){return new Promise(function(Mt,an){var qt=F.validate(Ye,st);qt==null?Mt(Qp):rR(qt)?qt.then(function(mn){Mt(mn||Qp)},function(mn){an(mn)}):Mt(qt)})},[F.validate]),X=W.useCallback(function(Ye,st){var Mt=F.validationSchema,an=rl(Mt)?Mt(st):Mt,qt=st&&an.validateAt?an.validateAt(st,Ye):aae(Ye,an);return new Promise(function(mn,Ln){qt.then(function(){mn(Qp)},function(fr){fr.name==="ValidationError"?mn(oae(fr)):Ln(fr)})})},[F.validationSchema]),ge=W.useCallback(function(Ye,st){return new Promise(function(Mt){return Mt(Y.current[Ye].validate(st))})},[]),be=W.useCallback(function(Ye){var st=Object.keys(Y.current).filter(function(an){return rl(Y.current[an].validate)}),Mt=st.length>0?st.map(function(an){return ge(an,nl(Ye,an))}):[Promise.resolve("DO_NOT_DELETE_YOU_WILL_BE_FIRED")];return Promise.all(Mt).then(function(an){return an.reduce(function(qt,mn,Ln){return mn==="DO_NOT_DELETE_YOU_WILL_BE_FIRED"||mn&&(qt=bm(qt,st[Ln],mn)),qt},{})})},[ge]),ke=W.useCallback(function(Ye){return Promise.all([be(Ye),F.validationSchema?X(Ye):{},F.validate?he(Ye):{}]).then(function(st){var Mt=st[0],an=st[1],qt=st[2],mn=WM.all([Mt,an,qt],{arrayMerge:lae});return mn})},[F.validate,F.validationSchema,be,he,X]),Ee=zl(function(Ye){return Ye===void 0&&(Ye=we.values),oe({type:"SET_ISVALIDATING",payload:!0}),ke(Ye).then(function(st){return G.current&&(oe({type:"SET_ISVALIDATING",payload:!1}),oe({type:"SET_ERRORS",payload:st})),st})});W.useEffect(function(){_&&G.current===!0&&tm(Z.current,F.initialValues)&&Ee(Z.current)},[_,Ee]);var zt=W.useCallback(function(Ye){var st=Ye&&Ye.values?Ye.values:Z.current,Mt=Ye&&Ye.errors?Ye.errors:J.current?J.current:F.initialErrors||{},an=Ye&&Ye.touched?Ye.touched:re.current?re.current:F.initialTouched||{},qt=Ye&&Ye.status?Ye.status:ne.current?ne.current:F.initialStatus;Z.current=st,J.current=Mt,re.current=an,ne.current=qt;var mn=function(){oe({type:"RESET_FORM",payload:{isSubmitting:!!Ye&&!!Ye.isSubmitting,errors:Mt,touched:an,status:qt,values:st,isValidating:!!Ye&&!!Ye.isValidating,submitCount:Ye&&Ye.submitCount&&typeof Ye.submitCount=="number"?Ye.submitCount:0}})};if(F.onReset){var Ln=F.onReset(we.values,Nr);rR(Ln)?Ln.then(mn):mn()}else mn()},[F.initialErrors,F.initialStatus,F.initialTouched,F.onReset]);W.useEffect(function(){G.current===!0&&!tm(Z.current,F.initialValues)&&I&&(Z.current=F.initialValues,zt(),_&&Ee(Z.current))},[I,F.initialValues,zt,_,Ee]),W.useEffect(function(){I&&G.current===!0&&!tm(J.current,F.initialErrors)&&(J.current=F.initialErrors||Qp,oe({type:"SET_ERRORS",payload:F.initialErrors||Qp}))},[I,F.initialErrors]),W.useEffect(function(){I&&G.current===!0&&!tm(re.current,F.initialTouched)&&(re.current=F.initialTouched||LT,oe({type:"SET_TOUCHED",payload:F.initialTouched||LT}))},[I,F.initialTouched]),W.useEffect(function(){I&&G.current===!0&&!tm(ne.current,F.initialStatus)&&(ne.current=F.initialStatus,oe({type:"SET_STATUS",payload:F.initialStatus}))},[I,F.initialStatus,F.initialTouched]);var Ut=zl(function(Ye){if(Y.current[Ye]&&rl(Y.current[Ye].validate)){var st=nl(we.values,Ye),Mt=Y.current[Ye].validate(st);return rR(Mt)?(oe({type:"SET_ISVALIDATING",payload:!0}),Mt.then(function(an){return an}).then(function(an){oe({type:"SET_FIELD_ERROR",payload:{field:Ye,value:an}}),oe({type:"SET_ISVALIDATING",payload:!1})})):(oe({type:"SET_FIELD_ERROR",payload:{field:Ye,value:Mt}}),Promise.resolve(Mt))}else if(F.validationSchema)return oe({type:"SET_ISVALIDATING",payload:!0}),X(we.values,Ye).then(function(an){return an}).then(function(an){oe({type:"SET_FIELD_ERROR",payload:{field:Ye,value:nl(an,Ye)}}),oe({type:"SET_ISVALIDATING",payload:!1})});return Promise.resolve()}),Qt=W.useCallback(function(Ye,st){var Mt=st.validate;Y.current[Ye]={validate:Mt}},[]),kt=W.useCallback(function(Ye){delete Y.current[Ye]},[]),ft=zl(function(Ye,st){oe({type:"SET_TOUCHED",payload:Ye});var Mt=st===void 0?c:st;return Mt?Ee(we.values):Promise.resolve()}),Rt=W.useCallback(function(Ye){oe({type:"SET_ERRORS",payload:Ye})},[]),Yt=zl(function(Ye,st){var Mt=rl(Ye)?Ye(we.values):Ye;oe({type:"SET_VALUES",payload:Mt});var an=st===void 0?r:st;return an?Ee(Mt):Promise.resolve()}),ht=W.useCallback(function(Ye,st){oe({type:"SET_FIELD_ERROR",payload:{field:Ye,value:st}})},[]),At=zl(function(Ye,st,Mt){oe({type:"SET_FIELD_VALUE",payload:{field:Ye,value:st}});var an=Mt===void 0?r:Mt;return an?Ee(bm(we.values,Ye,st)):Promise.resolve()}),wt=W.useCallback(function(Ye,st){var Mt=st,an=Ye,qt;if(!nR(Ye)){Ye.persist&&Ye.persist();var mn=Ye.target?Ye.target:Ye.currentTarget,Ln=mn.type,fr=mn.name,fi=mn.id,ir=mn.value,Ci=mn.checked,ss=mn.outerHTML,Tn=mn.options,or=mn.multiple;Mt=st||fr||fi,an=/number|range/.test(Ln)?(qt=parseFloat(ir),isNaN(qt)?"":qt):/checkbox/.test(Ln)?uae(nl(we.values,Mt),Ci,ir):Tn&&or?cae(Tn):ir}Mt&&At(Mt,an)},[At,we.values]),Xt=zl(function(Ye){if(nR(Ye))return function(st){return wt(st,Ye)};wt(Ye)}),Ft=zl(function(Ye,st,Mt){st===void 0&&(st=!0),oe({type:"SET_FIELD_TOUCHED",payload:{field:Ye,value:st}});var an=Mt===void 0?c:Mt;return an?Ee(we.values):Promise.resolve()}),Sn=W.useCallback(function(Ye,st){Ye.persist&&Ye.persist();var Mt=Ye.target,an=Mt.name,qt=Mt.id,mn=Mt.outerHTML,Ln=st||an||qt;Ft(Ln,!0)},[Ft]),qn=zl(function(Ye){if(nR(Ye))return function(st){return Sn(st,Ye)};Sn(Ye)}),Qn=W.useCallback(function(Ye){rl(Ye)?oe({type:"SET_FORMIK_STATE",payload:Ye}):oe({type:"SET_FORMIK_STATE",payload:function(){return Ye}})},[]),Gt=W.useCallback(function(Ye){oe({type:"SET_STATUS",payload:Ye})},[]),Cn=W.useCallback(function(Ye){oe({type:"SET_ISSUBMITTING",payload:Ye})},[]),hn=zl(function(){return oe({type:"SUBMIT_ATTEMPT"}),Ee().then(function(Ye){var st=Ye instanceof Error,Mt=!st&&Object.keys(Ye).length===0;if(Mt){var an;try{if(an=jn(),an===void 0)return}catch(qt){throw qt}return Promise.resolve(an).then(function(qt){return G.current&&oe({type:"SUBMIT_SUCCESS"}),qt}).catch(function(qt){if(G.current)throw oe({type:"SUBMIT_FAILURE"}),qt})}else if(G.current&&(oe({type:"SUBMIT_FAILURE"}),st))throw Ye})}),Rn=zl(function(Ye){Ye&&Ye.preventDefault&&rl(Ye.preventDefault)&&Ye.preventDefault(),Ye&&Ye.stopPropagation&&rl(Ye.stopPropagation)&&Ye.stopPropagation(),hn().catch(function(st){console.warn("Warning: An unhandled error was caught from submitForm()",st)})}),Nr={resetForm:zt,validateForm:Ee,validateField:Ut,setErrors:Rt,setFieldError:ht,setFieldTouched:Ft,setFieldValue:At,setStatus:Gt,setSubmitting:Cn,setTouched:ft,setValues:Yt,setFormikState:Qn,submitForm:hn},jn=zl(function(){return D(we.values,Nr)}),gr=zl(function(Ye){Ye&&Ye.preventDefault&&rl(Ye.preventDefault)&&Ye.preventDefault(),Ye&&Ye.stopPropagation&&rl(Ye.stopPropagation)&&Ye.stopPropagation(),zt()}),Fr=W.useCallback(function(Ye){return{value:nl(we.values,Ye),error:nl(we.errors,Ye),touched:!!nl(we.touched,Ye),initialValue:nl(Z.current,Ye),initialTouched:!!nl(re.current,Ye),initialError:nl(J.current,Ye)}},[we.errors,we.touched,we.values]),dr=W.useCallback(function(Ye){return{setValue:function(Mt,an){return At(Ye,Mt,an)},setTouched:function(Mt,an){return Ft(Ye,Mt,an)},setError:function(Mt){return ht(Ye,Mt)}}},[At,Ft,ht]),rr=W.useCallback(function(Ye){var st=GI(Ye),Mt=st?Ye.name:Ye,an=nl(we.values,Mt),qt={name:Mt,value:an,onChange:Xt,onBlur:qn};if(st){var mn=Ye.type,Ln=Ye.value,fr=Ye.as,fi=Ye.multiple;mn==="checkbox"?Ln===void 0?qt.checked=!!an:(qt.checked=!!(Array.isArray(an)&&~an.indexOf(Ln)),qt.value=Ln):mn==="radio"?(qt.checked=an===Ln,qt.value=Ln):fr==="select"&&fi&&(qt.value=qt.value||[],qt.multiple=!0)}return qt},[qn,Xt,we.values]),Ue=W.useMemo(function(){return!tm(Z.current,we.values)},[Z.current,we.values]),Xe=W.useMemo(function(){return typeof x<"u"?Ue?we.errors&&Object.keys(we.errors).length===0:x!==!1&&rl(x)?x(F):x:we.errors&&Object.keys(we.errors).length===0},[x,Ue,we.errors,F]),ut=Qi({},we,{initialValues:Z.current,initialErrors:J.current,initialTouched:re.current,initialStatus:ne.current,handleBlur:qn,handleChange:Xt,handleReset:gr,handleSubmit:Rn,resetForm:zt,setErrors:Rt,setFormikState:Qn,setFieldTouched:Ft,setFieldValue:At,setFieldError:ht,setStatus:Gt,setSubmitting:Cn,setTouched:ft,setValues:Yt,submitForm:hn,validateForm:Ee,validateField:Ut,isValid:Xe,dirty:Ue,unregisterField:kt,registerField:Qt,getFieldProps:rr,getFieldMeta:Fr,getFieldHelpers:dr,validateOnBlur:c,validateOnChange:r,validateOnMount:_});return ut}function Sq(e){var t=sae(e),r=e.component,s=e.children,c=e.render,f=e.innerRef;return W.useImperativeHandle(f,function(){return t}),W.createElement(tae,{value:t},r?W.createElement(r,t):c?c(t):s?rl(s)?s(t):rae(s)?null:W.Children.only(s):null)}function oae(e){var t={};if(e.inner){if(e.inner.length===0)return bm(t,e.path,e.message);for(var c=e.inner,r=Array.isArray(c),s=0,c=r?c:c[Symbol.iterator]();;){var f;if(r){if(s>=c.length)break;f=c[s++]}else{if(s=c.next(),s.done)break;f=s.value}var _=f;nl(t,_.path)||(t=bm(t,_.path,_.message))}}return t}function aae(e,t,r,s){r===void 0&&(r=!1);var c=YM(e);return t[r?"validateSync":"validate"](c,{abortEarly:!1,context:c})}function YM(e){var t=Array.isArray(e)?[]:{};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=String(r);Array.isArray(e[s])===!0?t[s]=e[s].map(function(c){return Array.isArray(c)===!0||z6(c)?YM(c):c!==""?c:void 0}):z6(e[s])?t[s]=YM(e[s]):t[s]=e[s]!==""?e[s]:void 0}return t}function lae(e,t,r){var s=e.slice();return t.forEach(function(f,_){if(typeof s[_]>"u"){var x=r.clone!==!1,a=x&&r.isMergeableObject(f);s[_]=a?WM(Array.isArray(f)?[]:{},f,r):f}else r.isMergeableObject(f)?s[_]=WM(e[_],f,r):e.indexOf(f)===-1&&s.push(f)}),s}function cae(e){return Array.from(e).filter(function(t){return t.selected}).map(function(t){return t.value})}function uae(e,t,r){if(typeof e=="boolean")return!!t;var s=[],c=!1,f=-1;if(Array.isArray(e))s=e,f=e.indexOf(r),c=f>=0;else if(!r||r=="true"||r=="false")return!!t;return t&&r&&!c?s.concat(r):c?s.slice(0,f).concat(s.slice(f+1)):s}var hae=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?W.useLayoutEffect:W.useEffect;function zl(e){var t=W.useRef(e);return hae(function(){t.current=e}),W.useCallback(function(){for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return t.current.apply(void 0,s)},[])}function A1(e){var t=e.validate,r=e.name,s=e.render,c=e.children,f=e.as,_=e.component,x=e.className,a=W_(e,["validate","name","render","children","as","component","className"]),I=Tq(),D=W_(I,["validate","validationSchema"]),O=D.registerField,F=D.unregisterField;W.useEffect(function(){return O(r,{validate:t}),function(){F(r)}},[O,F,r,t]);var Z=D.getFieldProps(Qi({name:r},a)),J=D.getFieldMeta(r),re={field:Z,form:D};if(s)return s(Qi({},re,{meta:J}));if(rl(c))return c(Qi({},re,{meta:J}));if(_){if(typeof _=="string"){var ne=a.innerRef,G=W_(a,["innerRef"]);return W.createElement(_,Qi({ref:ne},Z,G,{className:x}),c)}return W.createElement(_,Qi({field:Z,form:D},a,{className:x}),c)}var Y=f||"input";if(typeof Y=="string"){var Q=a.innerRef,de=W_(a,["innerRef"]);return W.createElement(Y,Qi({ref:Q},Z,de,{className:x}),c)}return W.createElement(Y,Qi({},Z,a,{className:x}),c)}var jD=W.forwardRef(function(e,t){var r=e.action,s=W_(e,["action"]),c=r??"#",f=Tq(),_=f.handleReset,x=f.handleSubmit;return W.createElement("form",Qi({onSubmit:x,ref:t,onReset:_,action:c},s))});jD.displayName="Form";function ng(e){this._maxSize=e,this.clear()}ng.prototype.clear=function(){this._size=0,this._values=Object.create(null)};ng.prototype.get=function(e){return this._values[e]};ng.prototype.set=function(e,t){return this._size>=this._maxSize&&this.clear(),e in this._values||this._size++,this._values[e]=t};var dae=/[^.^\]^[]+|(?=\[\]|\.\.)/g,Iq=/^\d+$/,fae=/^\d/,pae=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,mae=/^\s*(['"]?)(.*?)(\1)\s*$/,UD=512,cj=new ng(UD),uj=new ng(UD),hj=new ng(UD),wm={Cache:ng,split:JM,normalizePath:iR,setter:function(e){var t=iR(e);return uj.get(e)||uj.set(e,function(s,c){for(var f=0,_=t.length,x=s;f<_-1;){var a=t[f];if(a==="__proto__"||a==="constructor"||a==="prototype")return s;x=x[t[f++]]}x[t[f]]=c})},getter:function(e,t){var r=iR(e);return hj.get(e)||hj.set(e,function(c){for(var f=0,_=r.length;f<_;)if(c!=null||!t)c=c[r[f++]];else return;return c})},join:function(e){return e.reduce(function(t,r){return t+(VD(r)||Iq.test(r)?"["+r+"]":(t?".":"")+r)},"")},forEach:function(e,t,r){gae(Array.isArray(e)?e:JM(e),t,r)}};function iR(e){return cj.get(e)||cj.set(e,JM(e).map(function(t){return t.replace(mae,"$2")}))}function JM(e){return e.match(dae)||[""]}function gae(e,t,r){var s=e.length,c,f,_,x;for(f=0;f<s;f++)c=e[f],c&&(vae(c)&&(c='"'+c+'"'),x=VD(c),_=!x&&/^\d+$/.test(c),t.call(r,c,x,_,f,e))}function VD(e){return typeof e=="string"&&e&&["'",'"'].indexOf(e.charAt(0))!==-1}function _ae(e){return e.match(fae)&&!e.match(Iq)}function yae(e){return pae.test(e)}function vae(e){return!VD(e)&&(_ae(e)||yae(e))}const xae=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,WI=e=>e.match(xae)||[],HI=e=>e[0].toUpperCase()+e.slice(1),$D=(e,t)=>WI(e).join(t).toLowerCase(),Cq=e=>WI(e).reduce((t,r)=>`${t}${t?r[0].toUpperCase()+r.slice(1).toLowerCase():r.toLowerCase()}`,""),bae=e=>HI(Cq(e)),wae=e=>$D(e,"_"),Tae=e=>$D(e,"-"),Eae=e=>HI($D(e," ")),Sae=e=>WI(e).map(HI).join(" ");var sR={words:WI,upperFirst:HI,camelCase:Cq,pascalCase:bae,snakeCase:wae,kebabCase:Tae,sentenceCase:Eae,titleCase:Sae},qD={exports:{}};qD.exports=function(e){return Aq(Iae(e),e)};qD.exports.array=Aq;function Aq(e,t){var r=e.length,s=new Array(r),c={},f=r,_=Cae(t),x=Aae(e);for(t.forEach(function(I){if(!x.has(I[0])||!x.has(I[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});f--;)c[f]||a(e[f],f,new Set);return s;function a(I,D,O){if(O.has(I)){var F;try{F=", node was:"+JSON.stringify(I)}catch{F=""}throw new Error("Cyclic dependency"+F)}if(!x.has(I))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(I));if(!c[D]){c[D]=!0;var Z=_.get(I)||new Set;if(Z=Array.from(Z),D=Z.length){O.add(I);do{var J=Z[--D];a(J,x.get(J),O)}while(D);O.delete(I)}s[--r]=I}}}function Iae(e){for(var t=new Set,r=0,s=e.length;r<s;r++){var c=e[r];t.add(c[0]),t.add(c[1])}return Array.from(t)}function Cae(e){for(var t=new Map,r=0,s=e.length;r<s;r++){var c=e[r];t.has(c[0])||t.set(c[0],new Set),t.has(c[1])||t.set(c[1],new Set),t.get(c[0]).add(c[1])}return t}function Aae(e){for(var t=new Map,r=0,s=e.length;r<s;r++)t.set(e[r],r);return t}var Pae=qD.exports;const Rae=Gy(Pae),Mae=Object.prototype.toString,kae=Error.prototype.toString,Dae=RegExp.prototype.toString,Oae=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",Lae=/^Symbol\((.*)\)(.*)$/;function zae(e){return e!=+e?"NaN":e===0&&1/e<0?"-0":""+e}function dj(e,t=!1){if(e==null||e===!0||e===!1)return""+e;const r=typeof e;if(r==="number")return zae(e);if(r==="string")return t?`"${e}"`:e;if(r==="function")return"[Function "+(e.name||"anonymous")+"]";if(r==="symbol")return Oae.call(e).replace(Lae,"Symbol($1)");const s=Mae.call(e).slice(8,-1);return s==="Date"?isNaN(e.getTime())?""+e:e.toISOString(e):s==="Error"||e instanceof Error?"["+kae.call(e)+"]":s==="RegExp"?Dae.call(e):null}function Cf(e,t){let r=dj(e,t);return r!==null?r:JSON.stringify(e,function(s,c){let f=dj(this[s],t);return f!==null?f:c},2)}function Pq(e){return e==null?[]:[].concat(e)}let Rq,Mq,kq,Nae=/\$\{\s*(\w+)\s*\}/g;Rq=Symbol.toStringTag;class fj{constructor(t,r,s,c){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[Rq]="Error",this.name="ValidationError",this.value=r,this.path=s,this.type=c,this.errors=[],this.inner=[],Pq(t).forEach(f=>{if(za.isError(f)){this.errors.push(...f.errors);const _=f.inner.length?f.inner:[f];this.inner.push(..._)}else this.errors.push(f)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}Mq=Symbol.hasInstance;kq=Symbol.toStringTag;class za extends Error{static formatError(t,r){const s=r.label||r.path||"this";return s!==r.path&&(r=Object.assign({},r,{path:s})),typeof t=="string"?t.replace(Nae,(c,f)=>Cf(r[f])):typeof t=="function"?t(r):t}static isError(t){return t&&t.name==="ValidationError"}constructor(t,r,s,c,f){const _=new fj(t,r,s,c);if(f)return _;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[kq]="Error",this.name=_.name,this.message=_.message,this.type=_.type,this.value=_.value,this.path=_.path,this.errors=_.errors,this.inner=_.inner,Error.captureStackTrace&&Error.captureStackTrace(this,za)}static[Mq](t){return fj[Symbol.hasInstance](t)||super[Symbol.hasInstance](t)}}let Tu={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:e,type:t,value:r,originalValue:s})=>{const c=s!=null&&s!==r?` (cast from the value \`${Cf(s,!0)}\`).`:".";return t!=="mixed"?`${e} must be a \`${t}\` type, but the final value was: \`${Cf(r,!0)}\``+c:`${e} must match the configured type. The validated value was: \`${Cf(r,!0)}\``+c}},ka={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},Fae={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},ek={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},Bae={isValue:"${path} field must be ${value}"},tk={noUnknown:"${path} field has unspecified keys: ${unknown}"},jae={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},Uae={notType:e=>{const{path:t,value:r,spec:s}=e,c=s.types.length;if(Array.isArray(r)){if(r.length<c)return`${t} tuple value has too few items, expected a length of ${c} but got ${r.length} for value: \`${Cf(r,!0)}\``;if(r.length>c)return`${t} tuple value has too many items, expected a length of ${c} but got ${r.length} for value: \`${Cf(r,!0)}\``}return za.formatError(Tu.notType,e)}};Object.assign(Object.create(null),{mixed:Tu,string:ka,number:Fae,date:ek,object:tk,array:jae,boolean:Bae,tuple:Uae});const GD=e=>e&&e.__isYupSchema__;class gS{static fromOptions(t,r){if(!r.then&&!r.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:s,then:c,otherwise:f}=r,_=typeof s=="function"?s:(...x)=>x.every(a=>a===s);return new gS(t,(x,a)=>{var I;let D=_(...x)?c:f;return(I=D==null?void 0:D(a))!=null?I:a})}constructor(t,r){this.fn=void 0,this.refs=t,this.refs=t,this.fn=r}resolve(t,r){let s=this.refs.map(f=>f.getValue(r==null?void 0:r.value,r==null?void 0:r.parent,r==null?void 0:r.context)),c=this.fn(s,t,r);if(c===void 0||c===t)return t;if(!GD(c))throw new TypeError("conditions must return a schema object");return c.resolve(r)}}const zT={context:"$",value:"."};let rg=class{constructor(t,r={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof t!="string")throw new TypeError("ref must be a string, got: "+t);if(this.key=t.trim(),t==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===zT.context,this.isValue=this.key[0]===zT.value,this.isSibling=!this.isContext&&!this.isValue;let s=this.isContext?zT.context:this.isValue?zT.value:"";this.path=this.key.slice(s.length),this.getter=this.path&&wm.getter(this.path,!0),this.map=r.map}getValue(t,r,s){let c=this.isContext?s:this.isValue?t:r;return this.getter&&(c=this.getter(c||{})),this.map&&(c=this.map(c)),c}cast(t,r){return this.getValue(t,r==null?void 0:r.parent,r==null?void 0:r.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(t){return t&&t.__isYupRef}};rg.prototype.__isYupRef=!0;const fm=e=>e==null;function y_(e){function t({value:r,path:s="",options:c,originalValue:f,schema:_},x,a){const{name:I,test:D,params:O,message:F,skipAbsent:Z}=e;let{parent:J,context:re,abortEarly:ne=_.spec.abortEarly,disableStackTrace:G=_.spec.disableStackTrace}=c;function Y(be){return rg.isRef(be)?be.getValue(r,J,re):be}function Q(be={}){const ke=Object.assign({value:r,originalValue:f,label:_.spec.label,path:be.path||s,spec:_.spec,disableStackTrace:be.disableStackTrace||G},O,be.params);for(const zt of Object.keys(ke))ke[zt]=Y(ke[zt]);const Ee=new za(za.formatError(be.message||F,ke),r,ke.path,be.type||I,ke.disableStackTrace);return Ee.params=ke,Ee}const de=ne?x:a;let Te={path:s,parent:J,type:I,from:c.from,createError:Q,resolve:Y,options:c,originalValue:f,schema:_};const we=be=>{za.isError(be)?de(be):be?a(null):de(Q())},oe=be=>{za.isError(be)?de(be):x(be)};if(Z&&fm(r))return we(!0);let X;try{var ge;if(X=D.call(Te,r,Te),typeof((ge=X)==null?void 0:ge.then)=="function"){if(c.sync)throw new Error(`Validation test of type: "${Te.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(X).then(we,oe)}}catch(be){oe(be);return}we(X)}return t.OPTIONS=e,t}function Vae(e,t,r,s=r){let c,f,_;return t?(wm.forEach(t,(x,a,I)=>{let D=a?x.slice(1,x.length-1):x;e=e.resolve({context:s,parent:c,value:r});let O=e.type==="tuple",F=I?parseInt(D,10):0;if(e.innerType||O){if(O&&!I)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${_}" must contain an index to the tuple element, e.g. "${_}[0]"`);if(r&&F>=r.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${x}, in the path: ${t}. because there is no value at that index. `);c=r,r=r&&r[F],e=O?e.spec.types[F]:e.innerType}if(!I){if(!e.fields||!e.fields[D])throw new Error(`The schema does not contain the path: ${t}. (failed at: ${_} which is a type: "${e.type}")`);c=r,r=r&&r[D],e=e.fields[D]}f=D,_=a?"["+x+"]":"."+x}),{schema:e,parent:c,parentPath:f}):{parent:c,parentPath:t,schema:e}}class _S extends Set{describe(){const t=[];for(const r of this.values())t.push(rg.isRef(r)?r.describe():r);return t}resolveAll(t){let r=[];for(const s of this.values())r.push(t(s));return r}clone(){return new _S(this.values())}merge(t,r){const s=this.clone();return t.forEach(c=>s.add(c)),r.forEach(c=>s.delete(c)),s}}function H_(e,t=new Map){if(GD(e)||!e||typeof e!="object")return e;if(t.has(e))return t.get(e);let r;if(e instanceof Date)r=new Date(e.getTime()),t.set(e,r);else if(e instanceof RegExp)r=new RegExp(e),t.set(e,r);else if(Array.isArray(e)){r=new Array(e.length),t.set(e,r);for(let s=0;s<e.length;s++)r[s]=H_(e[s],t)}else if(e instanceof Map){r=new Map,t.set(e,r);for(const[s,c]of e.entries())r.set(s,H_(c,t))}else if(e instanceof Set){r=new Set,t.set(e,r);for(const s of e)r.add(H_(s,t))}else if(e instanceof Object){r={},t.set(e,r);for(const[s,c]of Object.entries(e))r[s]=H_(c,t)}else throw Error(`Unable to clone ${e}`);return r}class Uu{constructor(t){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new _S,this._blacklist=new _S,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(Tu.notType)}),this.type=t.type,this._typeCheck=t.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},t==null?void 0:t.spec),this.withMutation(r=>{r.nonNullable()})}get _type(){return this.type}clone(t){if(this._mutate)return t&&Object.assign(this.spec,t),this;const r=Object.create(Object.getPrototypeOf(this));return r.type=this.type,r._typeCheck=this._typeCheck,r._whitelist=this._whitelist.clone(),r._blacklist=this._blacklist.clone(),r.internalTests=Object.assign({},this.internalTests),r.exclusiveTests=Object.assign({},this.exclusiveTests),r.deps=[...this.deps],r.conditions=[...this.conditions],r.tests=[...this.tests],r.transforms=[...this.transforms],r.spec=H_(Object.assign({},this.spec,t)),r}label(t){let r=this.clone();return r.spec.label=t,r}meta(...t){if(t.length===0)return this.spec.meta;let r=this.clone();return r.spec.meta=Object.assign(r.spec.meta||{},t[0]),r}withMutation(t){let r=this._mutate;this._mutate=!0;let s=t(this);return this._mutate=r,s}concat(t){if(!t||t===this)return this;if(t.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${t.type}`);let r=this,s=t.clone();const c=Object.assign({},r.spec,s.spec);return s.spec=c,s.internalTests=Object.assign({},r.internalTests,s.internalTests),s._whitelist=r._whitelist.merge(t._whitelist,t._blacklist),s._blacklist=r._blacklist.merge(t._blacklist,t._whitelist),s.tests=r.tests,s.exclusiveTests=r.exclusiveTests,s.withMutation(f=>{t.tests.forEach(_=>{f.test(_.OPTIONS)})}),s.transforms=[...r.transforms,...s.transforms],s}isType(t){return t==null?!!(this.spec.nullable&&t===null||this.spec.optional&&t===void 0):this._typeCheck(t)}resolve(t){let r=this;if(r.conditions.length){let s=r.conditions;r=r.clone(),r.conditions=[],r=s.reduce((c,f)=>f.resolve(c,t),r),r=r.resolve(t)}return r}resolveOptions(t){var r,s,c,f;return Object.assign({},t,{from:t.from||[],strict:(r=t.strict)!=null?r:this.spec.strict,abortEarly:(s=t.abortEarly)!=null?s:this.spec.abortEarly,recursive:(c=t.recursive)!=null?c:this.spec.recursive,disableStackTrace:(f=t.disableStackTrace)!=null?f:this.spec.disableStackTrace})}cast(t,r={}){let s=this.resolve(Object.assign({value:t},r)),c=r.assert==="ignore-optionality",f=s._cast(t,r);if(r.assert!==!1&&!s.isType(f)){if(c&&fm(f))return f;let _=Cf(t),x=Cf(f);throw new TypeError(`The value of ${r.path||"field"} could not be cast to a value that satisfies the schema type: "${s.type}". 

attempted value: ${_} 
`+(x!==_?`result of cast: ${x}`:""))}return f}_cast(t,r){let s=t===void 0?t:this.transforms.reduce((c,f)=>f.call(this,c,t,this),t);return s===void 0&&(s=this.getDefault(r)),s}_validate(t,r={},s,c){let{path:f,originalValue:_=t,strict:x=this.spec.strict}=r,a=t;x||(a=this._cast(a,Object.assign({assert:!1},r)));let I=[];for(let D of Object.values(this.internalTests))D&&I.push(D);this.runTests({path:f,value:a,originalValue:_,options:r,tests:I},s,D=>{if(D.length)return c(D,a);this.runTests({path:f,value:a,originalValue:_,options:r,tests:this.tests},s,c)})}runTests(t,r,s){let c=!1,{tests:f,value:_,originalValue:x,path:a,options:I}=t,D=re=>{c||(c=!0,r(re,_))},O=re=>{c||(c=!0,s(re,_))},F=f.length,Z=[];if(!F)return O([]);let J={value:_,originalValue:x,path:a,options:I,schema:this};for(let re=0;re<f.length;re++){const ne=f[re];ne(J,D,function(Y){Y&&(Array.isArray(Y)?Z.push(...Y):Z.push(Y)),--F<=0&&O(Z)})}}asNestedTest({key:t,index:r,parent:s,parentPath:c,originalParent:f,options:_}){const x=t??r;if(x==null)throw TypeError("Must include `key` or `index` for nested validations");const a=typeof x=="number";let I=s[x];const D=Object.assign({},_,{strict:!0,parent:s,value:I,originalValue:f[x],key:void 0,[a?"index":"key"]:x,path:a||x.includes(".")?`${c||""}[${a?x:`"${x}"`}]`:(c?`${c}.`:"")+t});return(O,F,Z)=>this.resolve(D)._validate(I,D,F,Z)}validate(t,r){var s;let c=this.resolve(Object.assign({},r,{value:t})),f=(s=r==null?void 0:r.disableStackTrace)!=null?s:c.spec.disableStackTrace;return new Promise((_,x)=>c._validate(t,r,(a,I)=>{za.isError(a)&&(a.value=I),x(a)},(a,I)=>{a.length?x(new za(a,I,void 0,void 0,f)):_(I)}))}validateSync(t,r){var s;let c=this.resolve(Object.assign({},r,{value:t})),f,_=(s=r==null?void 0:r.disableStackTrace)!=null?s:c.spec.disableStackTrace;return c._validate(t,Object.assign({},r,{sync:!0}),(x,a)=>{throw za.isError(x)&&(x.value=a),x},(x,a)=>{if(x.length)throw new za(x,t,void 0,void 0,_);f=a}),f}isValid(t,r){return this.validate(t,r).then(()=>!0,s=>{if(za.isError(s))return!1;throw s})}isValidSync(t,r){try{return this.validateSync(t,r),!0}catch(s){if(za.isError(s))return!1;throw s}}_getDefault(t){let r=this.spec.default;return r==null?r:typeof r=="function"?r.call(this,t):H_(r)}getDefault(t){return this.resolve(t||{})._getDefault(t)}default(t){return arguments.length===0?this._getDefault():this.clone({default:t})}strict(t=!0){return this.clone({strict:t})}nullability(t,r){const s=this.clone({nullable:t});return s.internalTests.nullable=y_({message:r,name:"nullable",test(c){return c===null?this.schema.spec.nullable:!0}}),s}optionality(t,r){const s=this.clone({optional:t});return s.internalTests.optionality=y_({message:r,name:"optionality",test(c){return c===void 0?this.schema.spec.optional:!0}}),s}optional(){return this.optionality(!0)}defined(t=Tu.defined){return this.optionality(!1,t)}nullable(){return this.nullability(!0)}nonNullable(t=Tu.notNull){return this.nullability(!1,t)}required(t=Tu.required){return this.clone().withMutation(r=>r.nonNullable(t).defined(t))}notRequired(){return this.clone().withMutation(t=>t.nullable().optional())}transform(t){let r=this.clone();return r.transforms.push(t),r}test(...t){let r;if(t.length===1?typeof t[0]=="function"?r={test:t[0]}:r=t[0]:t.length===2?r={name:t[0],test:t[1]}:r={name:t[0],message:t[1],test:t[2]},r.message===void 0&&(r.message=Tu.default),typeof r.test!="function")throw new TypeError("`test` is a required parameters");let s=this.clone(),c=y_(r),f=r.exclusive||r.name&&s.exclusiveTests[r.name]===!0;if(r.exclusive&&!r.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return r.name&&(s.exclusiveTests[r.name]=!!r.exclusive),s.tests=s.tests.filter(_=>!(_.OPTIONS.name===r.name&&(f||_.OPTIONS.test===c.OPTIONS.test))),s.tests.push(c),s}when(t,r){!Array.isArray(t)&&typeof t!="string"&&(r=t,t=".");let s=this.clone(),c=Pq(t).map(f=>new rg(f));return c.forEach(f=>{f.isSibling&&s.deps.push(f.key)}),s.conditions.push(typeof r=="function"?new gS(c,r):gS.fromOptions(c,r)),s}typeError(t){let r=this.clone();return r.internalTests.typeError=y_({message:t,name:"typeError",skipAbsent:!0,test(s){return this.schema._typeCheck(s)?!0:this.createError({params:{type:this.schema.type}})}}),r}oneOf(t,r=Tu.oneOf){let s=this.clone();return t.forEach(c=>{s._whitelist.add(c),s._blacklist.delete(c)}),s.internalTests.whiteList=y_({message:r,name:"oneOf",skipAbsent:!0,test(c){let f=this.schema._whitelist,_=f.resolveAll(this.resolve);return _.includes(c)?!0:this.createError({params:{values:Array.from(f).join(", "),resolved:_}})}}),s}notOneOf(t,r=Tu.notOneOf){let s=this.clone();return t.forEach(c=>{s._blacklist.add(c),s._whitelist.delete(c)}),s.internalTests.blacklist=y_({message:r,name:"notOneOf",test(c){let f=this.schema._blacklist,_=f.resolveAll(this.resolve);return _.includes(c)?this.createError({params:{values:Array.from(f).join(", "),resolved:_}}):!0}}),s}strip(t=!0){let r=this.clone();return r.spec.strip=t,r}describe(t){const r=(t?this.resolve(t):this).clone(),{label:s,meta:c,optional:f,nullable:_}=r.spec;return{meta:c,label:s,optional:f,nullable:_,default:r.getDefault(t),type:r.type,oneOf:r._whitelist.describe(),notOneOf:r._blacklist.describe(),tests:r.tests.map(a=>({name:a.OPTIONS.name,params:a.OPTIONS.params})).filter((a,I,D)=>D.findIndex(O=>O.name===a.name)===I)}}}Uu.prototype.__isYupSchema__=!0;for(const e of["validate","validateSync"])Uu.prototype[`${e}At`]=function(t,r,s={}){const{parent:c,parentPath:f,schema:_}=Vae(this,t,r,s.context);return _[e](c&&c[f],Object.assign({},s,{parent:c,path:t}))};for(const e of["equals","is"])Uu.prototype[e]=Uu.prototype.oneOf;for(const e of["not","nope"])Uu.prototype[e]=Uu.prototype.notOneOf;const $ae=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function qae(e){const t=nk(e);if(!t)return Date.parse?Date.parse(e):Number.NaN;if(t.z===void 0&&t.plusMinus===void 0)return new Date(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond).valueOf();let r=0;return t.z!=="Z"&&t.plusMinus!==void 0&&(r=t.hourOffset*60+t.minuteOffset,t.plusMinus==="+"&&(r=0-r)),Date.UTC(t.year,t.month,t.day,t.hour,t.minute+r,t.second,t.millisecond)}function nk(e){var t,r;const s=$ae.exec(e);return s?{year:Th(s[1]),month:Th(s[2],1)-1,day:Th(s[3],1),hour:Th(s[4]),minute:Th(s[5]),second:Th(s[6]),millisecond:s[7]?Th(s[7].substring(0,3)):0,precision:(t=(r=s[7])==null?void 0:r.length)!=null?t:void 0,z:s[8]||void 0,plusMinus:s[9]||void 0,hourOffset:Th(s[10]),minuteOffset:Th(s[11])}:null}function Th(e,t=0){return Number(e)||t}let Gae=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Wae=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,Hae=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Zae="^\\d{4}-\\d{2}-\\d{2}",Xae="\\d{2}:\\d{2}:\\d{2}",Kae="(([+-]\\d{2}(:?\\d{2})?)|Z)",Qae=new RegExp(`${Zae}T${Xae}(\\.\\d+)?${Kae}$`),Yae=e=>fm(e)||e===e.trim(),Jae={}.toString();function iy(){return new Dq}class Dq extends Uu{constructor(){super({type:"string",check(t){return t instanceof String&&(t=t.valueOf()),typeof t=="string"}}),this.withMutation(()=>{this.transform((t,r,s)=>{if(!s.spec.coerce||s.isType(t)||Array.isArray(t))return t;const c=t!=null&&t.toString?t.toString():t;return c===Jae?t:c})})}required(t){return super.required(t).withMutation(r=>r.test({message:t||Tu.required,name:"required",skipAbsent:!0,test:s=>!!s.length}))}notRequired(){return super.notRequired().withMutation(t=>(t.tests=t.tests.filter(r=>r.OPTIONS.name!=="required"),t))}length(t,r=ka.length){return this.test({message:r,name:"length",exclusive:!0,params:{length:t},skipAbsent:!0,test(s){return s.length===this.resolve(t)}})}min(t,r=ka.min){return this.test({message:r,name:"min",exclusive:!0,params:{min:t},skipAbsent:!0,test(s){return s.length>=this.resolve(t)}})}max(t,r=ka.max){return this.test({name:"max",exclusive:!0,message:r,params:{max:t},skipAbsent:!0,test(s){return s.length<=this.resolve(t)}})}matches(t,r){let s=!1,c,f;return r&&(typeof r=="object"?{excludeEmptyString:s=!1,message:c,name:f}=r:c=r),this.test({name:f||"matches",message:c||ka.matches,params:{regex:t},skipAbsent:!0,test:_=>_===""&&s||_.search(t)!==-1})}email(t=ka.email){return this.matches(Gae,{name:"email",message:t,excludeEmptyString:!0})}url(t=ka.url){return this.matches(Wae,{name:"url",message:t,excludeEmptyString:!0})}uuid(t=ka.uuid){return this.matches(Hae,{name:"uuid",message:t,excludeEmptyString:!1})}datetime(t){let r="",s,c;return t&&(typeof t=="object"?{message:r="",allowOffset:s=!1,precision:c=void 0}=t:r=t),this.matches(Qae,{name:"datetime",message:r||ka.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:r||ka.datetime_offset,params:{allowOffset:s},skipAbsent:!0,test:f=>{if(!f||s)return!0;const _=nk(f);return _?!!_.z:!1}}).test({name:"datetime_precision",message:r||ka.datetime_precision,params:{precision:c},skipAbsent:!0,test:f=>{if(!f||c==null)return!0;const _=nk(f);return _?_.precision===c:!1}})}ensure(){return this.default("").transform(t=>t===null?"":t)}trim(t=ka.trim){return this.transform(r=>r!=null?r.trim():r).test({message:t,name:"trim",test:Yae})}lowercase(t=ka.lowercase){return this.transform(r=>fm(r)?r:r.toLowerCase()).test({message:t,name:"string_case",exclusive:!0,skipAbsent:!0,test:r=>fm(r)||r===r.toLowerCase()})}uppercase(t=ka.uppercase){return this.transform(r=>fm(r)?r:r.toUpperCase()).test({message:t,name:"string_case",exclusive:!0,skipAbsent:!0,test:r=>fm(r)||r===r.toUpperCase()})}}iy.prototype=Dq.prototype;let ele=new Date(""),tle=e=>Object.prototype.toString.call(e)==="[object Date]";class ZI extends Uu{constructor(){super({type:"date",check(t){return tle(t)&&!isNaN(t.getTime())}}),this.withMutation(()=>{this.transform((t,r,s)=>!s.spec.coerce||s.isType(t)||t===null?t:(t=qae(t),isNaN(t)?ZI.INVALID_DATE:new Date(t)))})}prepareParam(t,r){let s;if(rg.isRef(t))s=t;else{let c=this.cast(t);if(!this._typeCheck(c))throw new TypeError(`\`${r}\` must be a Date or a value that can be \`cast()\` to a Date`);s=c}return s}min(t,r=ek.min){let s=this.prepareParam(t,"min");return this.test({message:r,name:"min",exclusive:!0,params:{min:t},skipAbsent:!0,test(c){return c>=this.resolve(s)}})}max(t,r=ek.max){let s=this.prepareParam(t,"max");return this.test({message:r,name:"max",exclusive:!0,params:{max:t},skipAbsent:!0,test(c){return c<=this.resolve(s)}})}}ZI.INVALID_DATE=ele;ZI.prototype;function nle(e,t=[]){let r=[],s=new Set,c=new Set(t.map(([_,x])=>`${_}-${x}`));function f(_,x){let a=wm.split(_)[0];s.add(a),c.has(`${x}-${a}`)||r.push([x,a])}for(const _ of Object.keys(e)){let x=e[_];s.add(_),rg.isRef(x)&&x.isSibling?f(x.path,_):GD(x)&&"deps"in x&&x.deps.forEach(a=>f(a,_))}return Rae.array(Array.from(s),r).reverse()}function pj(e,t){let r=1/0;return e.some((s,c)=>{var f;if((f=t.path)!=null&&f.includes(s))return r=c,!0}),r}function Oq(e){return(t,r)=>pj(e,t)-pj(e,r)}const rle=(e,t,r)=>{if(typeof e!="string")return e;let s=e;try{s=JSON.parse(e)}catch{}return r.isType(s)?s:e};function gE(e){if("fields"in e){const t={};for(const[r,s]of Object.entries(e.fields))t[r]=gE(s);return e.setFields(t)}if(e.type==="array"){const t=e.optional();return t.innerType&&(t.innerType=gE(t.innerType)),t}return e.type==="tuple"?e.optional().clone({types:e.spec.types.map(gE)}):"optional"in e?e.optional():e}const ile=(e,t)=>{const r=[...wm.normalizePath(t)];if(r.length===1)return r[0]in e;let s=r.pop(),c=wm.getter(wm.join(r),!0)(e);return!!(c&&s in c)};let mj=e=>Object.prototype.toString.call(e)==="[object Object]";function sle(e,t){let r=Object.keys(e.fields);return Object.keys(t).filter(s=>r.indexOf(s)===-1)}const ole=Oq([]);function WD(e){return new Lq(e)}class Lq extends Uu{constructor(t){super({type:"object",check(r){return mj(r)||typeof r=="function"}}),this.fields=Object.create(null),this._sortErrors=ole,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{t&&this.shape(t)})}_cast(t,r={}){var s;let c=super._cast(t,r);if(c===void 0)return this.getDefault(r);if(!this._typeCheck(c))return c;let f=this.fields,_=(s=r.stripUnknown)!=null?s:this.spec.noUnknown,x=[].concat(this._nodes,Object.keys(c).filter(O=>!this._nodes.includes(O))),a={},I=Object.assign({},r,{parent:a,__validating:r.__validating||!1}),D=!1;for(const O of x){let F=f[O],Z=O in c;if(F){let J,re=c[O];I.path=(r.path?`${r.path}.`:"")+O,F=F.resolve({value:re,context:r.context,parent:a});let ne=F instanceof Uu?F.spec:void 0,G=ne==null?void 0:ne.strict;if(ne!=null&&ne.strip){D=D||O in c;continue}J=!r.__validating||!G?F.cast(c[O],I):c[O],J!==void 0&&(a[O]=J)}else Z&&!_&&(a[O]=c[O]);(Z!==O in a||a[O]!==c[O])&&(D=!0)}return D?a:c}_validate(t,r={},s,c){let{from:f=[],originalValue:_=t,recursive:x=this.spec.recursive}=r;r.from=[{schema:this,value:_},...f],r.__validating=!0,r.originalValue=_,super._validate(t,r,s,(a,I)=>{if(!x||!mj(I)){c(a,I);return}_=_||I;let D=[];for(let O of this._nodes){let F=this.fields[O];!F||rg.isRef(F)||D.push(F.asNestedTest({options:r,key:O,parent:I,parentPath:r.path,originalParent:_}))}this.runTests({tests:D,value:I,originalValue:_,options:r},s,O=>{c(O.sort(this._sortErrors).concat(a),I)})})}clone(t){const r=super.clone(t);return r.fields=Object.assign({},this.fields),r._nodes=this._nodes,r._excludedEdges=this._excludedEdges,r._sortErrors=this._sortErrors,r}concat(t){let r=super.concat(t),s=r.fields;for(let[c,f]of Object.entries(this.fields)){const _=s[c];s[c]=_===void 0?f:_}return r.withMutation(c=>c.setFields(s,[...this._excludedEdges,...t._excludedEdges]))}_getDefault(t){if("default"in this.spec)return super._getDefault(t);if(!this._nodes.length)return;let r={};return this._nodes.forEach(s=>{var c;const f=this.fields[s];let _=t;(c=_)!=null&&c.value&&(_=Object.assign({},_,{parent:_.value,value:_.value[s]})),r[s]=f&&"getDefault"in f?f.getDefault(_):void 0}),r}setFields(t,r){let s=this.clone();return s.fields=t,s._nodes=nle(t,r),s._sortErrors=Oq(Object.keys(t)),r&&(s._excludedEdges=r),s}shape(t,r=[]){return this.clone().withMutation(s=>{let c=s._excludedEdges;return r.length&&(Array.isArray(r[0])||(r=[r]),c=[...s._excludedEdges,...r]),s.setFields(Object.assign(s.fields,t),c)})}partial(){const t={};for(const[r,s]of Object.entries(this.fields))t[r]="optional"in s&&s.optional instanceof Function?s.optional():s;return this.setFields(t)}deepPartial(){return gE(this)}pick(t){const r={};for(const s of t)this.fields[s]&&(r[s]=this.fields[s]);return this.setFields(r,this._excludedEdges.filter(([s,c])=>t.includes(s)&&t.includes(c)))}omit(t){const r=[];for(const s of Object.keys(this.fields))t.includes(s)||r.push(s);return this.pick(r)}from(t,r,s){let c=wm.getter(t,!0);return this.transform(f=>{if(!f)return f;let _=f;return ile(f,t)&&(_=Object.assign({},f),s||delete _[t],_[r]=c(f)),_})}json(){return this.transform(rle)}noUnknown(t=!0,r=tk.noUnknown){typeof t!="boolean"&&(r=t,t=!0);let s=this.test({name:"noUnknown",exclusive:!0,message:r,test(c){if(c==null)return!0;const f=sle(this.schema,c);return!t||f.length===0||this.createError({params:{unknown:f.join(", ")}})}});return s.spec.noUnknown=t,s}unknown(t=!0,r=tk.noUnknown){return this.noUnknown(!t,r)}transformKeys(t){return this.transform(r=>{if(!r)return r;const s={};for(const c of Object.keys(r))s[t(c)]=r[c];return s})}camelCase(){return this.transformKeys(sR.camelCase)}snakeCase(){return this.transformKeys(sR.snakeCase)}constantCase(){return this.transformKeys(t=>sR.snakeCase(t).toUpperCase())}describe(t){const r=(t?this.resolve(t):this).clone(),s=super.describe(t);s.fields={};for(const[f,_]of Object.entries(r.fields)){var c;let x=t;(c=x)!=null&&c.value&&(x=Object.assign({},x,{parent:x.value,value:x.value[f]})),s.fields[f]=_.describe(x)}return s}}WD.prototype=Lq.prototype;var gj={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zq=function(e){const t=[];let r=0;for(let s=0;s<e.length;s++){let c=e.charCodeAt(s);c<128?t[r++]=c:c<2048?(t[r++]=c>>6|192,t[r++]=c&63|128):(c&64512)===55296&&s+1<e.length&&(e.charCodeAt(s+1)&64512)===56320?(c=65536+((c&1023)<<10)+(e.charCodeAt(++s)&1023),t[r++]=c>>18|240,t[r++]=c>>12&63|128,t[r++]=c>>6&63|128,t[r++]=c&63|128):(t[r++]=c>>12|224,t[r++]=c>>6&63|128,t[r++]=c&63|128)}return t},ale=function(e){const t=[];let r=0,s=0;for(;r<e.length;){const c=e[r++];if(c<128)t[s++]=String.fromCharCode(c);else if(c>191&&c<224){const f=e[r++];t[s++]=String.fromCharCode((c&31)<<6|f&63)}else if(c>239&&c<365){const f=e[r++],_=e[r++],x=e[r++],a=((c&7)<<18|(f&63)<<12|(_&63)<<6|x&63)-65536;t[s++]=String.fromCharCode(55296+(a>>10)),t[s++]=String.fromCharCode(56320+(a&1023))}else{const f=e[r++],_=e[r++];t[s++]=String.fromCharCode((c&15)<<12|(f&63)<<6|_&63)}}return t.join("")},Nq={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let c=0;c<e.length;c+=3){const f=e[c],_=c+1<e.length,x=_?e[c+1]:0,a=c+2<e.length,I=a?e[c+2]:0,D=f>>2,O=(f&3)<<4|x>>4;let F=(x&15)<<2|I>>6,Z=I&63;a||(Z=64,_||(F=64)),s.push(r[D],r[O],r[F],r[Z])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(zq(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):ale(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let c=0;c<e.length;){const f=r[e.charAt(c++)],x=c<e.length?r[e.charAt(c)]:0;++c;const I=c<e.length?r[e.charAt(c)]:64;++c;const O=c<e.length?r[e.charAt(c)]:64;if(++c,f==null||x==null||I==null||O==null)throw new lle;const F=f<<2|x>>4;if(s.push(F),I!==64){const Z=x<<4&240|I>>2;if(s.push(Z),O!==64){const J=I<<6&192|O;s.push(J)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class lle extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const cle=function(e){const t=zq(e);return Nq.encodeByteArray(t,!0)},yS=function(e){return cle(e).replace(/\./g,"")},Fq=function(e){try{return Nq.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ule(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hle=()=>ule().__FIREBASE_DEFAULTS__,dle=()=>{if(typeof process>"u"||typeof gj>"u")return;const e=gj.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},fle=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&Fq(e[1]);return t&&JSON.parse(t)},XI=()=>{try{return hle()||dle()||fle()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Bq=e=>{var t,r;return(r=(t=XI())===null||t===void 0?void 0:t.emulatorHosts)===null||r===void 0?void 0:r[e]},jq=e=>{const t=Bq(e);if(!t)return;const r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(r+1),10);return t[0]==="["?[t.substring(1,r-1),s]:[t.substring(0,r),s]},Uq=()=>{var e;return(e=XI())===null||e===void 0?void 0:e.config},Vq=e=>{var t;return(t=XI())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ple{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,r)=>{this.resolve=t,this.reject=r})}wrapCallback(t){return(r,s)=>{r?this.reject(r):this.resolve(s),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(r):t(r,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $q(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},s=t||"demo-project",c=e.iat||0,f=e.sub||e.user_id;if(!f)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:c,exp:c+3600,auth_time:c,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}}},e);return[yS(JSON.stringify(r)),yS(JSON.stringify(_)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function mle(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Jo())}function gle(){var e;const t=(e=XI())===null||e===void 0?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _le(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function yle(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function vle(){const e=Jo();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function xle(){return!gle()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function ble(){try{return typeof indexedDB=="object"}catch{return!1}}function wle(){return new Promise((e,t)=>{try{let r=!0;const s="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(s);c.onsuccess=()=>{c.result.close(),r||self.indexedDB.deleteDatabase(s),e(!0)},c.onupgradeneeded=()=>{r=!1},c.onerror=()=>{var f;t(((f=c.error)===null||f===void 0?void 0:f.message)||"")}}catch(r){t(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tle="FirebaseError";class Wu extends Error{constructor(t,r,s){super(r),this.code=t,this.customData=s,this.name=Tle,Object.setPrototypeOf(this,Wu.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qx.prototype.create)}}class Qx{constructor(t,r,s){this.service=t,this.serviceName=r,this.errors=s}create(t,...r){const s=r[0]||{},c=`${this.service}/${t}`,f=this.errors[t],_=f?Ele(f,s):"Error",x=`${this.serviceName}: ${_} (${c}).`;return new Wu(c,x,s)}}function Ele(e,t){return e.replace(Sle,(r,s)=>{const c=t[s];return c!=null?String(c):`<${s}?>`})}const Sle=/\{\$([^}]+)}/g;function Ile(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Sy(e,t){if(e===t)return!0;const r=Object.keys(e),s=Object.keys(t);for(const c of r){if(!s.includes(c))return!1;const f=e[c],_=t[c];if(_j(f)&&_j(_)){if(!Sy(f,_))return!1}else if(f!==_)return!1}for(const c of s)if(!r.includes(c))return!1;return!0}function _j(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yx(e){const t=[];for(const[r,s]of Object.entries(e))Array.isArray(s)?s.forEach(c=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(c))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function r1(e){const t={};return e.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[c,f]=s.split("=");t[decodeURIComponent(c)]=decodeURIComponent(f)}}),t}function i1(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function Cle(e,t){const r=new Ale(e,t);return r.subscribe.bind(r)}class Ale{constructor(t,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{t(this)}).catch(s=>{this.error(s)})}next(t){this.forEachObserver(r=>{r.next(t)})}error(t){this.forEachObserver(r=>{r.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,r,s){let c;if(t===void 0&&r===void 0&&s===void 0)throw new Error("Missing Observer.");Ple(t,["next","error","complete"])?c=t:c={next:t,error:r,complete:s},c.next===void 0&&(c.next=oR),c.error===void 0&&(c.error=oR),c.complete===void 0&&(c.complete=oR);const f=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),f}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,t)}sendOne(t,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{r(this.observers[t])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ple(e,t){if(typeof e!="object"||e===null)return!1;for(const r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}function oR(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Os(e){return e&&e._delegate?e._delegate:e}class Lf{constructor(t,r,s){this.name=t,this.instanceFactory=r,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rle{constructor(t,r){this.name=t,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const r=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(r)){const s=new ple;if(this.instancesDeferred.set(r,s),this.isInitialized(r)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:r});c&&s.resolve(c)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(t){var r;const s=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),c=(r=t==null?void 0:t.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(f){if(c)return null;throw f}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(kle(t))try{this.getOrInitializeService({instanceIdentifier:nm})}catch{}for(const[r,s]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(r);try{const f=this.getOrInitializeService({instanceIdentifier:c});s.resolve(f)}catch{}}}}clearInstance(t=nm){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=nm){return this.instances.has(t)}getOptions(t=nm){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:r={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:s,options:r});for(const[f,_]of this.instancesDeferred.entries()){const x=this.normalizeInstanceIdentifier(f);s===x&&_.resolve(c)}return c}onInit(t,r){var s;const c=this.normalizeInstanceIdentifier(r),f=(s=this.onInitCallbacks.get(c))!==null&&s!==void 0?s:new Set;f.add(t),this.onInitCallbacks.set(c,f);const _=this.instances.get(c);return _&&t(_,c),()=>{f.delete(t)}}invokeOnInitCallbacks(t,r){const s=this.onInitCallbacks.get(r);if(s)for(const c of s)try{c(t,r)}catch{}}getOrInitializeService({instanceIdentifier:t,options:r={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Mle(t),options:r}),this.instances.set(t,s),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch{}return s||null}normalizeInstanceIdentifier(t=nm){return this.component?this.component.multipleInstances?t:nm:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Mle(e){return e===nm?void 0:e}function kle(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dle{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const r=this.getProvider(t.name);if(r.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);r.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const r=new Rle(t,this);return this.providers.set(t,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qr;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(Qr||(Qr={}));const Ole={debug:Qr.DEBUG,verbose:Qr.VERBOSE,info:Qr.INFO,warn:Qr.WARN,error:Qr.ERROR,silent:Qr.SILENT},Lle=Qr.INFO,zle={[Qr.DEBUG]:"log",[Qr.VERBOSE]:"log",[Qr.INFO]:"info",[Qr.WARN]:"warn",[Qr.ERROR]:"error"},Nle=(e,t,...r)=>{if(t<e.logLevel)return;const s=new Date().toISOString(),c=zle[t];if(c)console[c](`[${s}]  ${e.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class HD{constructor(t){this.name=t,this._logLevel=Lle,this._logHandler=Nle,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Qr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Ole[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Qr.DEBUG,...t),this._logHandler(this,Qr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Qr.VERBOSE,...t),this._logHandler(this,Qr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Qr.INFO,...t),this._logHandler(this,Qr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Qr.WARN,...t),this._logHandler(this,Qr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Qr.ERROR,...t),this._logHandler(this,Qr.ERROR,...t)}}const Fle=(e,t)=>t.some(r=>e instanceof r);let yj,vj;function Ble(){return yj||(yj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function jle(){return vj||(vj=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qq=new WeakMap,rk=new WeakMap,Gq=new WeakMap,aR=new WeakMap,ZD=new WeakMap;function Ule(e){const t=new Promise((r,s)=>{const c=()=>{e.removeEventListener("success",f),e.removeEventListener("error",_)},f=()=>{r(Af(e.result)),c()},_=()=>{s(e.error),c()};e.addEventListener("success",f),e.addEventListener("error",_)});return t.then(r=>{r instanceof IDBCursor&&qq.set(r,e)}).catch(()=>{}),ZD.set(t,e),t}function Vle(e){if(rk.has(e))return;const t=new Promise((r,s)=>{const c=()=>{e.removeEventListener("complete",f),e.removeEventListener("error",_),e.removeEventListener("abort",_)},f=()=>{r(),c()},_=()=>{s(e.error||new DOMException("AbortError","AbortError")),c()};e.addEventListener("complete",f),e.addEventListener("error",_),e.addEventListener("abort",_)});rk.set(e,t)}let ik={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return rk.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Gq.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Af(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function $le(e){ik=e(ik)}function qle(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const s=e.call(lR(this),t,...r);return Gq.set(s,t.sort?t.sort():[t]),Af(s)}:jle().includes(e)?function(...t){return e.apply(lR(this),t),Af(qq.get(this))}:function(...t){return Af(e.apply(lR(this),t))}}function Gle(e){return typeof e=="function"?qle(e):(e instanceof IDBTransaction&&Vle(e),Fle(e,Ble())?new Proxy(e,ik):e)}function Af(e){if(e instanceof IDBRequest)return Ule(e);if(aR.has(e))return aR.get(e);const t=Gle(e);return t!==e&&(aR.set(e,t),ZD.set(t,e)),t}const lR=e=>ZD.get(e);function Wle(e,t,{blocked:r,upgrade:s,blocking:c,terminated:f}={}){const _=indexedDB.open(e,t),x=Af(_);return s&&_.addEventListener("upgradeneeded",a=>{s(Af(_.result),a.oldVersion,a.newVersion,Af(_.transaction),a)}),r&&_.addEventListener("blocked",a=>r(a.oldVersion,a.newVersion,a)),x.then(a=>{f&&a.addEventListener("close",()=>f()),c&&a.addEventListener("versionchange",I=>c(I.oldVersion,I.newVersion,I))}).catch(()=>{}),x}const Hle=["get","getKey","getAll","getAllKeys","count"],Zle=["put","add","delete","clear"],cR=new Map;function xj(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(cR.get(t))return cR.get(t);const r=t.replace(/FromIndex$/,""),s=t!==r,c=Zle.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(c||Hle.includes(r)))return;const f=async function(_,...x){const a=this.transaction(_,c?"readwrite":"readonly");let I=a.store;return s&&(I=I.index(x.shift())),(await Promise.all([I[r](...x),c&&a.done]))[0]};return cR.set(t,f),f}$le(e=>({...e,get:(t,r,s)=>xj(t,r)||e.get(t,r,s),has:(t,r)=>!!xj(t,r)||e.has(t,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xle{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(Kle(r)){const s=r.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(r=>r).join(" ")}}function Kle(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const sk="@firebase/app",bj="0.10.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh=new HD("@firebase/app"),Qle="@firebase/app-compat",Yle="@firebase/analytics-compat",Jle="@firebase/analytics",ece="@firebase/app-check-compat",tce="@firebase/app-check",nce="@firebase/auth",rce="@firebase/auth-compat",ice="@firebase/database",sce="@firebase/database-compat",oce="@firebase/functions",ace="@firebase/functions-compat",lce="@firebase/installations",cce="@firebase/installations-compat",uce="@firebase/messaging",hce="@firebase/messaging-compat",dce="@firebase/performance",fce="@firebase/performance-compat",pce="@firebase/remote-config",mce="@firebase/remote-config-compat",gce="@firebase/storage",_ce="@firebase/storage-compat",yce="@firebase/firestore",vce="@firebase/vertexai-preview",xce="@firebase/firestore-compat",bce="firebase",wce="10.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ok="[DEFAULT]",Tce={[sk]:"fire-core",[Qle]:"fire-core-compat",[Jle]:"fire-analytics",[Yle]:"fire-analytics-compat",[tce]:"fire-app-check",[ece]:"fire-app-check-compat",[nce]:"fire-auth",[rce]:"fire-auth-compat",[ice]:"fire-rtdb",[sce]:"fire-rtdb-compat",[oce]:"fire-fn",[ace]:"fire-fn-compat",[lce]:"fire-iid",[cce]:"fire-iid-compat",[uce]:"fire-fcm",[hce]:"fire-fcm-compat",[dce]:"fire-perf",[fce]:"fire-perf-compat",[pce]:"fire-rc",[mce]:"fire-rc-compat",[gce]:"fire-gcs",[_ce]:"fire-gcs-compat",[yce]:"fire-fst",[xce]:"fire-fst-compat",[vce]:"fire-vertex","fire-js":"fire-js",[bce]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vS=new Map,Ece=new Map,ak=new Map;function wj(e,t){try{e.container.addComponent(t)}catch(r){Wh.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function zm(e){const t=e.name;if(ak.has(t))return Wh.debug(`There were multiple attempts to register component ${t}.`),!1;ak.set(t,e);for(const r of vS.values())wj(r,e);for(const r of Ece.values())wj(r,e);return!0}function KI(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function Lc(e){return e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sce={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Pf=new Qx("app","Firebase",Sce);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ice{constructor(t,r,s){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Lf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Pf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ig=wce;function Wq(e,t={}){let r=e;typeof t!="object"&&(t={name:t});const s=Object.assign({name:ok,automaticDataCollectionEnabled:!1},t),c=s.name;if(typeof c!="string"||!c)throw Pf.create("bad-app-name",{appName:String(c)});if(r||(r=Uq()),!r)throw Pf.create("no-options");const f=vS.get(c);if(f){if(Sy(r,f.options)&&Sy(s,f.config))return f;throw Pf.create("duplicate-app",{appName:c})}const _=new Dle(c);for(const a of ak.values())_.addComponent(a);const x=new Ice(r,s,_);return vS.set(c,x),x}function XD(e=ok){const t=vS.get(e);if(!t&&e===ok&&Uq())return Wq();if(!t)throw Pf.create("no-app",{appName:e});return t}function zu(e,t,r){var s;let c=(s=Tce[e])!==null&&s!==void 0?s:e;r&&(c+=`-${r}`);const f=c.match(/\s|\//),_=t.match(/\s|\//);if(f||_){const x=[`Unable to register library "${c}" with version "${t}":`];f&&x.push(`library name "${c}" contains illegal characters (whitespace or "/")`),f&&_&&x.push("and"),_&&x.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Wh.warn(x.join(" "));return}zm(new Lf(`${c}-version`,()=>({library:c,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cce="firebase-heartbeat-database",Ace=1,px="firebase-heartbeat-store";let uR=null;function Hq(){return uR||(uR=Wle(Cce,Ace,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(px)}catch(r){console.warn(r)}}}}).catch(e=>{throw Pf.create("idb-open",{originalErrorMessage:e.message})})),uR}async function Pce(e){try{const r=(await Hq()).transaction(px),s=await r.objectStore(px).get(Zq(e));return await r.done,s}catch(t){if(t instanceof Wu)Wh.warn(t.message);else{const r=Pf.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Wh.warn(r.message)}}}async function Tj(e,t){try{const s=(await Hq()).transaction(px,"readwrite");await s.objectStore(px).put(t,Zq(e)),await s.done}catch(r){if(r instanceof Wu)Wh.warn(r.message);else{const s=Pf.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Wh.warn(s.message)}}}function Zq(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rce=1024,Mce=30*24*60*60*1e3;class kce{constructor(t){this.container=t,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new Oce(r),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var t,r;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),f=Ej();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===f||this._heartbeatsCache.heartbeats.some(_=>_.date===f)?void 0:(this._heartbeatsCache.heartbeats.push({date:f,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const x=new Date(_.date).valueOf();return Date.now()-x<=Mce}),this._storage.overwrite(this._heartbeatsCache))}catch(s){Wh.warn(s)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=Ej(),{heartbeatsToSend:s,unsentEntries:c}=Dce(this._heartbeatsCache.heartbeats),f=yS(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=r,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),f}catch(r){return Wh.warn(r),""}}}function Ej(){return new Date().toISOString().substring(0,10)}function Dce(e,t=Rce){const r=[];let s=e.slice();for(const c of e){const f=r.find(_=>_.agent===c.agent);if(f){if(f.dates.push(c.date),Sj(r)>t){f.dates.pop();break}}else if(r.push({agent:c.agent,dates:[c.date]}),Sj(r)>t){r.pop();break}s=s.slice(1)}return{heartbeatsToSend:r,unsentEntries:s}}class Oce{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ble()?wle().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await Pce(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return Tj(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return Tj(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...t.heartbeats]})}else return}}function Sj(e){return yS(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lce(e){zm(new Lf("platform-logger",t=>new Xle(t),"PRIVATE")),zm(new Lf("heartbeat",t=>new kce(t),"PRIVATE")),zu(sk,bj,e),zu(sk,bj,"esm2017"),zu("fire-js","")}Lce("");var zce="firebase",Nce="10.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zu(zce,Nce,"app");function KD(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(e);c<s.length;c++)t.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(e,s[c])&&(r[s[c]]=e[s[c]]);return r}function Xq(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Fce=Xq,Kq=new Qx("auth","Firebase",Xq());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xS=new HD("@firebase/auth");function Bce(e,...t){xS.logLevel<=Qr.WARN&&xS.warn(`Auth (${ig}): ${e}`,...t)}function _E(e,...t){xS.logLevel<=Qr.ERROR&&xS.error(`Auth (${ig}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ql(e,...t){throw YD(e,...t)}function jc(e,...t){return YD(e,...t)}function QD(e,t,r){const s=Object.assign(Object.assign({},Fce()),{[t]:r});return new Qx("auth","Firebase",s).create(t,{appName:e.name})}function Fh(e){return QD(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function jce(e,t,r){const s=r;if(!(t instanceof s))throw s.name!==t.constructor.name&&Ql(e,"argument-error"),QD(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function YD(e,...t){if(typeof e!="string"){const r=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(r,...s)}return Kq.create(e,...t)}function vr(e,t,...r){if(!e)throw YD(t,...r)}function Oh(e){const t="INTERNAL ASSERTION FAILED: "+e;throw _E(t),new Error(t)}function Hh(e,t){e||Oh(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lk(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function Uce(){return Ij()==="http:"||Ij()==="https:"}function Ij(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vce(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Uce()||_le()||"connection"in navigator)?navigator.onLine:!0}function $ce(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jx{constructor(t,r){this.shortDelay=t,this.longDelay=r,Hh(r>t,"Short delay should be less than long delay!"),this.isMobile=mle()||yle()}get(){return Vce()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JD(e,t){Hh(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qq{static initialize(t,r,s){this.fetchImpl=t,r&&(this.headersImpl=r),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Oh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Oh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Oh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qce={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gce=new Jx(3e4,6e4);function Xf(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Kf(e,t,r,s,c={}){return Yq(e,c,async()=>{let f={},_={};s&&(t==="GET"?_=s:f={body:JSON.stringify(s)});const x=Yx(Object.assign({key:e.config.apiKey},_)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Qq.fetch()(Jq(e,e.config.apiHost,r,x),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},f))})}async function Yq(e,t,r){e._canInitEmulator=!1;const s=Object.assign(Object.assign({},qce),t);try{const c=new Hce(e),f=await Promise.race([r(),c.promise]);c.clearNetworkTimeout();const _=await f.json();if("needConfirmation"in _)throw NT(e,"account-exists-with-different-credential",_);if(f.ok&&!("errorMessage"in _))return _;{const x=f.ok?_.errorMessage:_.error.message,[a,I]=x.split(" : ");if(a==="FEDERATED_USER_ID_ALREADY_LINKED")throw NT(e,"credential-already-in-use",_);if(a==="EMAIL_EXISTS")throw NT(e,"email-already-in-use",_);if(a==="USER_DISABLED")throw NT(e,"user-disabled",_);const D=s[a]||a.toLowerCase().replace(/[_\s]+/g,"-");if(I)throw QD(e,D,I);Ql(e,D)}}catch(c){if(c instanceof Wu)throw c;Ql(e,"network-request-failed",{message:String(c)})}}async function eb(e,t,r,s,c={}){const f=await Kf(e,t,r,s,c);return"mfaPendingCredential"in f&&Ql(e,"multi-factor-auth-required",{_serverResponse:f}),f}function Jq(e,t,r,s){const c=`${t}${r}?${s}`;return e.config.emulator?JD(e.config,c):`${e.config.apiScheme}://${c}`}function Wce(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Hce{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((r,s)=>{this.timer=setTimeout(()=>s(jc(this.auth,"network-request-failed")),Gce.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function NT(e,t,r){const s={appName:e.name};r.email&&(s.email=r.email),r.phoneNumber&&(s.phoneNumber=r.phoneNumber);const c=jc(e,t,s);return c.customData._tokenResponse=r,c}function Cj(e){return e!==void 0&&e.enterprise!==void 0}class Zce{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===t)return Wce(r.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}}async function Xce(e,t){return Kf(e,"GET","/v2/recaptchaConfig",Xf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kce(e,t){return Kf(e,"POST","/v1/accounts:delete",t)}async function eG(e,t){return Kf(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P1(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function Qce(e,t=!1){const r=Os(e),s=await r.getIdToken(t),c=e5(s);vr(c&&c.exp&&c.auth_time&&c.iat,r.auth,"internal-error");const f=typeof c.firebase=="object"?c.firebase:void 0,_=f==null?void 0:f.sign_in_provider;return{claims:c,token:s,authTime:P1(hR(c.auth_time)),issuedAtTime:P1(hR(c.iat)),expirationTime:P1(hR(c.exp)),signInProvider:_||null,signInSecondFactor:(f==null?void 0:f.sign_in_second_factor)||null}}function hR(e){return Number(e)*1e3}function e5(e){const[t,r,s]=e.split(".");if(t===void 0||r===void 0||s===void 0)return _E("JWT malformed, contained fewer than 3 sections"),null;try{const c=Fq(r);return c?JSON.parse(c):(_E("Failed to decode base64 JWT payload"),null)}catch(c){return _E("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function Aj(e){const t=e5(e);return vr(t,"internal-error"),vr(typeof t.exp<"u","internal-error"),vr(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mx(e,t,r=!1){if(r)return t;try{return await t}catch(s){throw s instanceof Wu&&Yce(s)&&e.auth.currentUser===e&&await e.auth.signOut(),s}}function Yce({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jce{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var r;if(t){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const c=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(t=!1){if(!this.isRunning)return;const r=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(t,r){this.createdAt=t,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=P1(this.lastLoginAt),this.creationTime=P1(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bS(e){var t;const r=e.auth,s=await e.getIdToken(),c=await mx(e,eG(r,{idToken:s}));vr(c==null?void 0:c.users.length,r,"internal-error");const f=c.users[0];e._notifyReloadListener(f);const _=!((t=f.providerUserInfo)===null||t===void 0)&&t.length?tG(f.providerUserInfo):[],x=tue(e.providerData,_),a=e.isAnonymous,I=!(e.email&&f.passwordHash)&&!(x!=null&&x.length),D=a?I:!1,O={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:x,metadata:new ck(f.createdAt,f.lastLoginAt),isAnonymous:D};Object.assign(e,O)}async function eue(e){const t=Os(e);await bS(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function tue(e,t){return[...e.filter(s=>!t.some(c=>c.providerId===s.providerId)),...t]}function tG(e){return e.map(t=>{var{providerId:r}=t,s=KD(t,["providerId"]);return{providerId:r,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nue(e,t){const r=await Yq(e,{},async()=>{const s=Yx({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:c,apiKey:f}=e.config,_=Jq(e,c,"/v1/token",`key=${f}`),x=await e._getAdditionalHeaders();return x["Content-Type"]="application/x-www-form-urlencoded",Qq.fetch()(_,{method:"POST",headers:x,body:s})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function rue(e,t){return Kf(e,"POST","/v2/accounts:revokeToken",Xf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){vr(t.idToken,"internal-error"),vr(typeof t.idToken<"u","internal-error"),vr(typeof t.refreshToken<"u","internal-error");const r="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Aj(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,r)}updateFromIdToken(t){vr(t.length!==0,"internal-error");const r=Aj(t);this.updateTokensAndExpiration(t,null,r)}async getToken(t,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(vr(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,r){const{accessToken:s,refreshToken:c,expiresIn:f}=await nue(t,r);this.updateTokensAndExpiration(s,c,Number(f))}updateTokensAndExpiration(t,r,s){this.refreshToken=r||null,this.accessToken=t||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(t,r){const{refreshToken:s,accessToken:c,expirationTime:f}=r,_=new sy;return s&&(vr(typeof s=="string","internal-error",{appName:t}),_.refreshToken=s),c&&(vr(typeof c=="string","internal-error",{appName:t}),_.accessToken=c),f&&(vr(typeof f=="number","internal-error",{appName:t}),_.expirationTime=f),_}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new sy,this.toJSON())}_performRefresh(){return Oh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(e,t){vr(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class Lh{constructor(t){var{uid:r,auth:s,stsTokenManager:c}=t,f=KD(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Jce(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=s,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new ck(f.createdAt||void 0,f.lastLoginAt||void 0)}async getIdToken(t){const r=await mx(this,this.stsTokenManager.getToken(this.auth,t));return vr(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(t){return Qce(this,t)}reload(){return eue(this)}_assign(t){this!==t&&(vr(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(r=>Object.assign({},r)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const r=new Lh(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(t){vr(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,r=!1){let s=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),s=!0),r&&await bS(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Lc(this.auth.app))return Promise.reject(Fh(this.auth));const t=await this.getIdToken();return await mx(this,Kce(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,r){var s,c,f,_,x,a,I,D;const O=(s=r.displayName)!==null&&s!==void 0?s:void 0,F=(c=r.email)!==null&&c!==void 0?c:void 0,Z=(f=r.phoneNumber)!==null&&f!==void 0?f:void 0,J=(_=r.photoURL)!==null&&_!==void 0?_:void 0,re=(x=r.tenantId)!==null&&x!==void 0?x:void 0,ne=(a=r._redirectEventId)!==null&&a!==void 0?a:void 0,G=(I=r.createdAt)!==null&&I!==void 0?I:void 0,Y=(D=r.lastLoginAt)!==null&&D!==void 0?D:void 0,{uid:Q,emailVerified:de,isAnonymous:Te,providerData:we,stsTokenManager:oe}=r;vr(Q&&oe,t,"internal-error");const he=sy.fromJSON(this.name,oe);vr(typeof Q=="string",t,"internal-error"),Qd(O,t.name),Qd(F,t.name),vr(typeof de=="boolean",t,"internal-error"),vr(typeof Te=="boolean",t,"internal-error"),Qd(Z,t.name),Qd(J,t.name),Qd(re,t.name),Qd(ne,t.name),Qd(G,t.name),Qd(Y,t.name);const X=new Lh({uid:Q,auth:t,email:F,emailVerified:de,displayName:O,isAnonymous:Te,photoURL:J,phoneNumber:Z,tenantId:re,stsTokenManager:he,createdAt:G,lastLoginAt:Y});return we&&Array.isArray(we)&&(X.providerData=we.map(ge=>Object.assign({},ge))),ne&&(X._redirectEventId=ne),X}static async _fromIdTokenResponse(t,r,s=!1){const c=new sy;c.updateFromServerResponse(r);const f=new Lh({uid:r.localId,auth:t,stsTokenManager:c,isAnonymous:s});return await bS(f),f}static async _fromGetAccountInfoResponse(t,r,s){const c=r.users[0];vr(c.localId!==void 0,"internal-error");const f=c.providerUserInfo!==void 0?tG(c.providerUserInfo):[],_=!(c.email&&c.passwordHash)&&!(f!=null&&f.length),x=new sy;x.updateFromIdToken(s);const a=new Lh({uid:c.localId,auth:t,stsTokenManager:x,isAnonymous:_}),I={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:f,metadata:new ck(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!(f!=null&&f.length)};return Object.assign(a,I),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pj=new Map;function zh(e){Hh(e instanceof Function,"Expected a class definition");let t=Pj.get(e);return t?(Hh(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Pj.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nG{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,r){this.storage[t]=r}async _get(t){const r=this.storage[t];return r===void 0?null:r}async _remove(t){delete this.storage[t]}_addListener(t,r){}_removeListener(t,r){}}nG.type="NONE";const Rj=nG;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yE(e,t,r){return`firebase:${e}:${t}:${r}`}class oy{constructor(t,r,s){this.persistence=t,this.auth=r,this.userKey=s;const{config:c,name:f}=this.auth;this.fullUserKey=yE(this.userKey,c.apiKey,f),this.fullPersistenceKey=yE("persistence",c.apiKey,f),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Lh._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,r,s="authUser"){if(!r.length)return new oy(zh(Rj),t,s);const c=(await Promise.all(r.map(async I=>{if(await I._isAvailable())return I}))).filter(I=>I);let f=c[0]||zh(Rj);const _=yE(s,t.config.apiKey,t.name);let x=null;for(const I of r)try{const D=await I._get(_);if(D){const O=Lh._fromJSON(t,D);I!==f&&(x=O),f=I;break}}catch{}const a=c.filter(I=>I._shouldAllowMigration);return!f._shouldAllowMigration||!a.length?new oy(f,t,s):(f=a[0],x&&await f._set(_,x.toJSON()),await Promise.all(r.map(async I=>{if(I!==f)try{await I._remove(_)}catch{}})),new oy(f,t,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mj(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(oG(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(rG(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(lG(t))return"Blackberry";if(cG(t))return"Webos";if(iG(t))return"Safari";if((t.includes("chrome/")||sG(t))&&!t.includes("edge/"))return"Chrome";if(aG(t))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=e.match(r);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function rG(e=Jo()){return/firefox\//i.test(e)}function iG(e=Jo()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function sG(e=Jo()){return/crios\//i.test(e)}function oG(e=Jo()){return/iemobile/i.test(e)}function aG(e=Jo()){return/android/i.test(e)}function lG(e=Jo()){return/blackberry/i.test(e)}function cG(e=Jo()){return/webos/i.test(e)}function t5(e=Jo()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function iue(e=Jo()){var t;return t5(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function sue(){return vle()&&document.documentMode===10}function uG(e=Jo()){return t5(e)||aG(e)||cG(e)||lG(e)||/windows phone/i.test(e)||oG(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hG(e,t=[]){let r;switch(e){case"Browser":r=Mj(Jo());break;case"Worker":r=`${Mj(Jo())}-${e}`;break;default:r=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${ig}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oue{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,r){const s=f=>new Promise((_,x)=>{try{const a=t(f);_(a)}catch(a){x(a)}});s.onAbort=r,this.queue.push(s);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const r=[];try{for(const s of this.queue)await s(t),s.onAbort&&r.push(s.onAbort)}catch(s){r.reverse();for(const c of r)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aue(e,t={}){return Kf(e,"GET","/v2/passwordPolicy",Xf(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lue=6;class cue{constructor(t){var r,s,c,f;const _=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=_.minPasswordLength)!==null&&r!==void 0?r:lue,_.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=_.maxPasswordLength),_.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=_.containsLowercaseCharacter),_.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=_.containsUppercaseCharacter),_.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=_.containsNumericCharacter),_.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=_.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(s=t.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(f=t.forceUpgradeOnSignin)!==null&&f!==void 0?f:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var r,s,c,f,_,x;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,a),this.validatePasswordCharacterOptions(t,a),a.isValid&&(a.isValid=(r=a.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),a.isValid&&(a.isValid=(s=a.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),a.isValid&&(a.isValid=(c=a.containsLowercaseLetter)!==null&&c!==void 0?c:!0),a.isValid&&(a.isValid=(f=a.containsUppercaseLetter)!==null&&f!==void 0?f:!0),a.isValid&&(a.isValid=(_=a.containsNumericCharacter)!==null&&_!==void 0?_:!0),a.isValid&&(a.isValid=(x=a.containsNonAlphanumericCharacter)!==null&&x!==void 0?x:!0),a}validatePasswordLengthOptions(t,r){const s=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;s&&(r.meetsMinPasswordLength=t.length>=s),c&&(r.meetsMaxPasswordLength=t.length<=c)}validatePasswordCharacterOptions(t,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let s;for(let c=0;c<t.length;c++)s=t.charAt(c),this.updatePasswordCharacterOptionsStatuses(r,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(t,r,s,c,f){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uue{constructor(t,r,s,c){this.app=t,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=s,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new kj(this),this.idTokenSubscription=new kj(this),this.beforeStateQueue=new oue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Kq,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(t,r){return r&&(this._popupRedirectResolver=zh(r)),this._initializationPromise=this.queue(async()=>{var s,c;if(!this._deleted&&(this.persistenceManager=await oy.create(this,t),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const r=await eG(this,{idToken:t}),s=await Lh._fromGetAccountInfoResponse(this,r,t);await this.directlySetCurrentUser(s)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var r;if(Lc(this.app)){const _=this.app.settings.authIdToken;return _?new Promise(x=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(_).then(x,x))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let c=s,f=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const _=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,x=c==null?void 0:c._redirectEventId,a=await this.tryRedirectSignIn(t);(!_||_===x)&&(a!=null&&a.user)&&(c=a.user,f=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(f)try{await this.beforeStateQueue.runMiddleware(c)}catch(_){c=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(_))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return vr(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(t){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(t){try{await bS(t)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=$ce()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Lc(this.app))return Promise.reject(Fh(this));const r=t?Os(t):null;return r&&vr(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(t,r=!1){if(!this._deleted)return t&&vr(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Lc(this.app)?Promise.reject(Fh(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Lc(this.app)?Promise.reject(Fh(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(zh(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await aue(this),r=new cue(t);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new Qx("auth","Firebase",t())}onAuthStateChanged(t,r,s){return this.registerStateListener(this.authStateSubscription,t,r,s)}beforeAuthStateChanged(t,r){return this.beforeStateQueue.pushCallback(t,r)}onIdTokenChanged(t,r,s){return this.registerStateListener(this.idTokenSubscription,t,r,s)}authStateReady(){return new Promise((t,r)=>{if(this.currentUser)t();else{const s=this.onAuthStateChanged(()=>{s(),t()},r)}})}async revokeAccessToken(t){if(this.currentUser){const r=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:r};this.tenantId!=null&&(s.tenantId=this.tenantId),await rue(this,s)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,r){const s=await this.getOrInitRedirectPersistenceManager(r);return t===null?s.removeCurrentUser():s.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const r=t&&zh(t)||this._popupRedirectResolver;vr(r,this,"argument-error"),this.redirectPersistenceManager=await oy.create(this,[zh(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var r,s;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===t?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(r=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,r,s,c){if(this._deleted)return()=>{};const f=typeof r=="function"?r:r.next.bind(r);let _=!1;const x=this._isInitialized?Promise.resolve():this._initializationPromise;if(vr(x,this,"internal-error"),x.then(()=>{_||f(this.currentUser)}),typeof r=="function"){const a=t.addObserver(r,s,c);return()=>{_=!0,a()}}else{const a=t.addObserver(r);return()=>{_=!0,a()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return vr(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=hG(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const s=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());s&&(r["X-Firebase-Client"]=s);const c=await this._getAppCheckToken();return c&&(r["X-Firebase-AppCheck"]=c),r}async _getAppCheckToken(){var t;const r=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return r!=null&&r.error&&Bce(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function Qf(e){return Os(e)}class kj{constructor(t){this.auth=t,this.observer=null,this.addObserver=Cle(r=>this.observer=r)}get next(){return vr(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let QI={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function hue(e){QI=e}function dG(e){return QI.loadJS(e)}function due(){return QI.recaptchaEnterpriseScript}function fue(){return QI.gapiScript}function pue(e){return`__${e}${Math.floor(Math.random()*1e6)}`}const mue="recaptcha-enterprise",gue="NO_RECAPTCHA";class _ue{constructor(t){this.type=mue,this.auth=Qf(t)}async verify(t="verify",r=!1){async function s(f){if(!r){if(f.tenantId==null&&f._agentRecaptchaConfig!=null)return f._agentRecaptchaConfig.siteKey;if(f.tenantId!=null&&f._tenantRecaptchaConfigs[f.tenantId]!==void 0)return f._tenantRecaptchaConfigs[f.tenantId].siteKey}return new Promise(async(_,x)=>{Xce(f,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(a=>{if(a.recaptchaKey===void 0)x(new Error("recaptcha Enterprise site key undefined"));else{const I=new Zce(a);return f.tenantId==null?f._agentRecaptchaConfig=I:f._tenantRecaptchaConfigs[f.tenantId]=I,_(I.siteKey)}}).catch(a=>{x(a)})})}function c(f,_,x){const a=window.grecaptcha;Cj(a)?a.enterprise.ready(()=>{a.enterprise.execute(f,{action:t}).then(I=>{_(I)}).catch(()=>{_(gue)})}):x(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((f,_)=>{s(this.auth).then(x=>{if(!r&&Cj(window.grecaptcha))c(x,f,_);else{if(typeof window>"u"){_(new Error("RecaptchaVerifier is only supported in browser"));return}let a=due();a.length!==0&&(a+=x),dG(a).then(()=>{c(x,f,_)}).catch(I=>{_(I)})}}).catch(x=>{_(x)})})}}async function Dj(e,t,r,s=!1){const c=new _ue(e);let f;try{f=await c.verify(r)}catch{f=await c.verify(r,!0)}const _=Object.assign({},t);return s?Object.assign(_,{captchaResp:f}):Object.assign(_,{captchaResponse:f}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function uk(e,t,r,s){var c;if(!((c=e._getRecaptchaConfig())===null||c===void 0)&&c.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await Dj(e,t,r,r==="getOobCode");return s(e,f)}else return s(e,t).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await Dj(e,t,r,r==="getOobCode");return s(e,_)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yue(e,t){const r=KI(e,"auth");if(r.isInitialized()){const c=r.getImmediate(),f=r.getOptions();if(Sy(f,t??{}))return c;Ql(c,"already-initialized")}return r.initialize({options:t})}function vue(e,t){const r=(t==null?void 0:t.persistence)||[],s=(Array.isArray(r)?r:[r]).map(zh);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(s,t==null?void 0:t.popupRedirectResolver)}function xue(e,t,r){const s=Qf(e);vr(s._canInitEmulator,s,"emulator-config-failed"),vr(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const c=!1,f=fG(t),{host:_,port:x}=bue(t),a=x===null?"":`:${x}`;s.config.emulator={url:`${f}//${_}${a}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:_,port:x,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:c})}),wue()}function fG(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function bue(e){const t=fG(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const s=r[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(s);if(c){const f=c[1];return{host:f,port:Oj(s.substr(f.length+1))}}else{const[f,_]=s.split(":");return{host:f,port:Oj(_)}}}function Oj(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function wue(){function e(){const t=document.createElement("p"),r=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n5{constructor(t,r){this.providerId=t,this.signInMethod=r}toJSON(){return Oh("not implemented")}_getIdTokenResponse(t){return Oh("not implemented")}_linkToIdToken(t,r){return Oh("not implemented")}_getReauthenticationResolver(t){return Oh("not implemented")}}async function Tue(e,t){return Kf(e,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Eue(e,t){return eb(e,"POST","/v1/accounts:signInWithPassword",Xf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sue(e,t){return eb(e,"POST","/v1/accounts:signInWithEmailLink",Xf(e,t))}async function Iue(e,t){return eb(e,"POST","/v1/accounts:signInWithEmailLink",Xf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx extends n5{constructor(t,r,s,c=null){super("password",s),this._email=t,this._password=r,this._tenantId=c}static _fromEmailAndPassword(t,r){return new gx(t,r,"password")}static _fromEmailAndCode(t,r,s=null){return new gx(t,r,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uk(t,r,"signInWithPassword",Eue);case"emailLink":return Sue(t,{email:this._email,oobCode:this._password});default:Ql(t,"internal-error")}}async _linkToIdToken(t,r){switch(this.signInMethod){case"password":const s={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uk(t,s,"signUpPassword",Tue);case"emailLink":return Iue(t,{idToken:r,email:this._email,oobCode:this._password});default:Ql(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ay(e,t){return eb(e,"POST","/v1/accounts:signInWithIdp",Xf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cue="http://localhost";class Nm extends n5{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const r=new Nm(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(r.idToken=t.idToken),t.accessToken&&(r.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(r.nonce=t.nonce),t.pendingToken&&(r.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(r.accessToken=t.oauthToken,r.secret=t.oauthTokenSecret):Ql("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t,{providerId:s,signInMethod:c}=r,f=KD(r,["providerId","signInMethod"]);if(!s||!c)return null;const _=new Nm(s,c);return _.idToken=f.idToken||void 0,_.accessToken=f.accessToken||void 0,_.secret=f.secret,_.nonce=f.nonce,_.pendingToken=f.pendingToken||null,_}_getIdTokenResponse(t){const r=this.buildRequest();return ay(t,r)}_linkToIdToken(t,r){const s=this.buildRequest();return s.idToken=r,ay(t,s)}_getReauthenticationResolver(t){const r=this.buildRequest();return r.autoCreate=!1,ay(t,r)}buildRequest(){const t={requestUri:Cue,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),t.postBody=Yx(r)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aue(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Pue(e){const t=r1(i1(e)).link,r=t?r1(i1(t)).deep_link_id:null,s=r1(i1(e)).deep_link_id;return(s?r1(i1(s)).link:null)||s||r||t||e}class r5{constructor(t){var r,s,c,f,_,x;const a=r1(i1(t)),I=(r=a.apiKey)!==null&&r!==void 0?r:null,D=(s=a.oobCode)!==null&&s!==void 0?s:null,O=Aue((c=a.mode)!==null&&c!==void 0?c:null);vr(I&&D&&O,"argument-error"),this.apiKey=I,this.operation=O,this.code=D,this.continueUrl=(f=a.continueUrl)!==null&&f!==void 0?f:null,this.languageCode=(_=a.languageCode)!==null&&_!==void 0?_:null,this.tenantId=(x=a.tenantId)!==null&&x!==void 0?x:null}static parseLink(t){const r=Pue(t);try{return new r5(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(){this.providerId=Qy.PROVIDER_ID}static credential(t,r){return gx._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){const s=r5.parseLink(r);return vr(s,"argument-error"),gx._fromEmailAndCode(t,s.code,s.tenantId)}}Qy.PROVIDER_ID="password";Qy.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Qy.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i5{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb extends i5{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af extends tb{constructor(){super("facebook.com")}static credential(t){return Nm._fromParams({providerId:af.PROVIDER_ID,signInMethod:af.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return af.credentialFromTaggedObject(t)}static credentialFromError(t){return af.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return af.credential(t.oauthAccessToken)}catch{return null}}}af.FACEBOOK_SIGN_IN_METHOD="facebook.com";af.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru extends tb{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return Nm._fromParams({providerId:Ru.PROVIDER_ID,signInMethod:Ru.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return Ru.credentialFromTaggedObject(t)}static credentialFromError(t){return Ru.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:r,oauthAccessToken:s}=t;if(!r&&!s)return null;try{return Ru.credential(r,s)}catch{return null}}}Ru.GOOGLE_SIGN_IN_METHOD="google.com";Ru.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf extends tb{constructor(){super("github.com")}static credential(t){return Nm._fromParams({providerId:lf.PROVIDER_ID,signInMethod:lf.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return lf.credentialFromTaggedObject(t)}static credentialFromError(t){return lf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return lf.credential(t.oauthAccessToken)}catch{return null}}}lf.GITHUB_SIGN_IN_METHOD="github.com";lf.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf extends tb{constructor(){super("twitter.com")}static credential(t,r){return Nm._fromParams({providerId:cf.PROVIDER_ID,signInMethod:cf.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:r})}static credentialFromResult(t){return cf.credentialFromTaggedObject(t)}static credentialFromError(t){return cf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:r,oauthTokenSecret:s}=t;if(!r||!s)return null;try{return cf.credential(r,s)}catch{return null}}}cf.TWITTER_SIGN_IN_METHOD="twitter.com";cf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rue(e,t){return eb(e,"POST","/v1/accounts:signUp",Xf(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,r,s,c=!1){const f=await Lh._fromIdTokenResponse(t,s,c),_=Lj(s);return new Fm({user:f,providerId:_,_tokenResponse:s,operationType:r})}static async _forOperation(t,r,s){await t._updateTokensIfNecessary(s,!0);const c=Lj(s);return new Fm({user:t,providerId:c,_tokenResponse:s,operationType:r})}}function Lj(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wS extends Wu{constructor(t,r,s,c){var f;super(r.code,r.message),this.operationType=s,this.user=c,Object.setPrototypeOf(this,wS.prototype),this.customData={appName:t.name,tenantId:(f=t.tenantId)!==null&&f!==void 0?f:void 0,_serverResponse:r.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(t,r,s,c){return new wS(t,r,s,c)}}function pG(e,t,r,s){return(t==="reauthenticate"?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(f=>{throw f.code==="auth/multi-factor-auth-required"?wS._fromErrorAndOperation(e,f,t,s):f})}async function Mue(e,t,r=!1){const s=await mx(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return Fm._forOperation(e,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kue(e,t,r=!1){const{auth:s}=e;if(Lc(s.app))return Promise.reject(Fh(s));const c="reauthenticate";try{const f=await mx(e,pG(s,c,t,e),r);vr(f.idToken,s,"internal-error");const _=e5(f.idToken);vr(_,s,"internal-error");const{sub:x}=_;return vr(e.uid===x,s,"user-mismatch"),Fm._forOperation(e,c,f)}catch(f){throw(f==null?void 0:f.code)==="auth/user-not-found"&&Ql(s,"user-mismatch"),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mG(e,t,r=!1){if(Lc(e.app))return Promise.reject(Fh(e));const s="signIn",c=await pG(e,s,t),f=await Fm._fromIdTokenResponse(e,s,c);return r||await e._updateCurrentUser(f.user),f}async function Due(e,t){return mG(Qf(e),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gG(e){const t=Qf(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Oue(e,t,r){if(Lc(e.app))return Promise.reject(Fh(e));const s=Qf(e),_=await uk(s,{returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Rue).catch(a=>{throw a.code==="auth/password-does-not-meet-requirements"&&gG(e),a}),x=await Fm._fromIdTokenResponse(s,"signIn",_);return await s._updateCurrentUser(x.user),x}function Lue(e,t,r){return Lc(e.app)?Promise.reject(Fh(e)):Due(Os(e),Qy.credential(t,r)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&gG(e),s})}function zue(e,t,r,s){return Os(e).onIdTokenChanged(t,r,s)}function Nue(e,t,r){return Os(e).beforeAuthStateChanged(t,r)}const TS="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _G{constructor(t,r){this.storageRetriever=t,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(TS,"1"),this.storage.removeItem(TS),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,r){return this.storage.setItem(t,JSON.stringify(r)),Promise.resolve()}_get(t){const r=this.storage.getItem(t);return Promise.resolve(r?JSON.parse(r):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fue=1e3,Bue=10;class yG extends _G{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=uG(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const r of Object.keys(this.listeners)){const s=this.storage.getItem(r),c=this.localCache[r];s!==c&&t(r,c,s)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((_,x,a)=>{this.notifyListeners(_,a)});return}const s=t.key;r?this.detachListener():this.stopPolling();const c=()=>{const _=this.storage.getItem(s);!r&&this.localCache[s]===_||this.notifyListeners(s,_)},f=this.storage.getItem(s);sue()&&f!==t.newValue&&t.newValue!==t.oldValue?setTimeout(c,Bue):c()}notifyListeners(t,r){this.localCache[t]=r;const s=this.listeners[t];if(s)for(const c of Array.from(s))c(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:s}),!0)})},Fue)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,r){await super._set(t,r),this.localCache[t]=JSON.stringify(r)}async _get(t){const r=await super._get(t);return this.localCache[t]=JSON.stringify(r),r}async _remove(t){await super._remove(t),delete this.localCache[t]}}yG.type="LOCAL";const jue=yG;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vG extends _G{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}vG.type="SESSION";const xG=vG;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uue(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YI{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const r=this.receivers.find(c=>c.isListeningto(t));if(r)return r;const s=new YI(t);return this.receivers.push(s),s}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const r=t,{eventId:s,eventType:c,data:f}=r.data,_=this.handlersMap[c];if(!(_!=null&&_.size))return;r.ports[0].postMessage({status:"ack",eventId:s,eventType:c});const x=Array.from(_).map(async I=>I(r.origin,f)),a=await Uue(x);r.ports[0].postMessage({status:"done",eventId:s,eventType:c,response:a})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}YI.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s5(e="",t=10){let r="";for(let s=0;s<t;s++)r+=Math.floor(Math.random()*10);return e+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vue{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,r,s=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let f,_;return new Promise((x,a)=>{const I=s5("",20);c.port1.start();const D=setTimeout(()=>{a(new Error("unsupported_event"))},s);_={messageChannel:c,onMessage(O){const F=O;if(F.data.eventId===I)switch(F.data.status){case"ack":clearTimeout(D),f=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(f),x(F.data.response);break;default:clearTimeout(D),clearTimeout(f),a(new Error("invalid_response"));break}}},this.handlers.add(_),c.port1.addEventListener("message",_.onMessage),this.target.postMessage({eventType:t,eventId:I,data:r},[c.port2])}).finally(()=>{_&&this.removeMessageHandler(_)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(){return window}function $ue(e){Nu().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bG(){return typeof Nu().WorkerGlobalScope<"u"&&typeof Nu().importScripts=="function"}async function que(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Gue(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function Wue(){return bG()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wG="firebaseLocalStorageDb",Hue=1,ES="firebaseLocalStorage",TG="fbase_key";class nb{constructor(t){this.request=t}toPromise(){return new Promise((t,r)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function JI(e,t){return e.transaction([ES],t?"readwrite":"readonly").objectStore(ES)}function Zue(){const e=indexedDB.deleteDatabase(wG);return new nb(e).toPromise()}function hk(){const e=indexedDB.open(wG,Hue);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{const s=e.result;try{s.createObjectStore(ES,{keyPath:TG})}catch(c){r(c)}}),e.addEventListener("success",async()=>{const s=e.result;s.objectStoreNames.contains(ES)?t(s):(s.close(),await Zue(),t(await hk()))})})}async function zj(e,t,r){const s=JI(e,!0).put({[TG]:t,value:r});return new nb(s).toPromise()}async function Xue(e,t){const r=JI(e,!1).get(t),s=await new nb(r).toPromise();return s===void 0?null:s.value}function Nj(e,t){const r=JI(e,!0).delete(t);return new nb(r).toPromise()}const Kue=800,Que=3;class EG{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await hk(),this.db)}async _withRetries(t){let r=0;for(;;)try{const s=await this._openDb();return await t(s)}catch(s){if(r++>Que)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return bG()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=YI._getInstance(Wue()),this.receiver._subscribe("keyChanged",async(t,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(t,r)=>["keyChanged"])}async initializeSender(){var t,r;if(this.activeServiceWorker=await que(),!this.activeServiceWorker)return;this.sender=new Vue(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((t=s[0])===null||t===void 0)&&t.fulfilled&&!((r=s[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||Gue()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await hk();return await zj(t,TS,"1"),await Nj(t,TS),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,r){return this._withPendingWrite(async()=>(await this._withRetries(s=>zj(s,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)))}async _get(t){const r=await this._withRetries(s=>Xue(s,t));return this.localCache[t]=r,r}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Nj(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(c=>{const f=JI(c,!1).getAll();return new nb(f).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const r=[],s=new Set;if(t.length!==0)for(const{fbase_key:c,value:f}of t)s.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(f)&&(this.notifyListeners(c,f),r.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!s.has(c)&&(this.notifyListeners(c,null),r.push(c));return r}notifyListeners(t,r){this.localCache[t]=r;const s=this.listeners[t];if(s)for(const c of Array.from(s))c(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Kue)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}EG.type="LOCAL";const Yue=EG;new Jx(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SG(e,t){return t?zh(t):(vr(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5 extends n5{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return ay(t,this._buildIdpRequest())}_linkToIdToken(t,r){return ay(t,this._buildIdpRequest(r))}_getReauthenticationResolver(t){return ay(t,this._buildIdpRequest())}_buildIdpRequest(t){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(r.idToken=t),r}}function Jue(e){return mG(e.auth,new o5(e),e.bypassAuthState)}function ehe(e){const{auth:t,user:r}=e;return vr(r,t,"internal-error"),kue(r,new o5(e),e.bypassAuthState)}async function the(e){const{auth:t,user:r}=e;return vr(r,t,"internal-error"),Mue(r,new o5(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IG{constructor(t,r,s,c,f=!1){this.auth=t,this.resolver=s,this.user=c,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(t,r)=>{this.pendingPromise={resolve:t,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(t){const{urlResponse:r,sessionId:s,postBody:c,tenantId:f,error:_,type:x}=t;if(_){this.reject(_);return}const a={auth:this.auth,requestUri:r,sessionId:s,tenantId:f||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(x)(a))}catch(I){this.reject(I)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Jue;case"linkViaPopup":case"linkViaRedirect":return the;case"reauthViaPopup":case"reauthViaRedirect":return ehe;default:Ql(this.auth,"internal-error")}}resolve(t){Hh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Hh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nhe=new Jx(2e3,1e4);async function CG(e,t,r){if(Lc(e.app))return Promise.reject(jc(e,"operation-not-supported-in-this-environment"));const s=Qf(e);jce(e,t,i5);const c=SG(s,r);return new pm(s,"signInViaPopup",t,c).executeNotNull()}class pm extends IG{constructor(t,r,s,c,f){super(t,r,c,f),this.provider=s,this.authWindow=null,this.pollId=null,pm.currentPopupAction&&pm.currentPopupAction.cancel(),pm.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return vr(t,this.auth,"internal-error"),t}async onExecution(){Hh(this.filter.length===1,"Popup operations only handle one event");const t=s5();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(jc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(jc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,pm.currentPopupAction=null}pollUserCancellation(){const t=()=>{var r,s;if(!((s=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(jc(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,nhe.get())};t()}}pm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rhe="pendingRedirect",vE=new Map;class ihe extends IG{constructor(t,r,s=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,s),this.eventId=null}async execute(){let t=vE.get(this.auth._key());if(!t){try{const s=await she(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(s)}catch(r){t=()=>Promise.reject(r)}vE.set(this.auth._key(),t)}return this.bypassAuthState||vE.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const r=await this.auth._redirectUserForId(t.eventId);if(r)return this.user=r,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function she(e,t){const r=lhe(t),s=ahe(e);if(!await s._isAvailable())return!1;const c=await s._get(r)==="true";return await s._remove(r),c}function ohe(e,t){vE.set(e._key(),t)}function ahe(e){return zh(e._redirectPersistence)}function lhe(e){return yE(rhe,e.config.apiKey,e.name)}async function che(e,t,r=!1){if(Lc(e.app))return Promise.reject(Fh(e));const s=Qf(e),c=SG(s,t),_=await new ihe(s,c,r).execute();return _&&!r&&(delete _.user._redirectEventId,await s._persistUserIfCurrent(_.user),await s._setRedirectUser(null,t)),_}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uhe=10*60*1e3;class hhe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let r=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(t,s)&&(r=!0,this.sendToConsumer(t,s),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!dhe(t)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=t,r=!0)),r}sendToConsumer(t,r){var s;if(t.error&&!AG(t)){const c=((s=t.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";r.onError(jc(this.auth,c))}else r.onAuthEvent(t)}isEventForConsumer(t,r){const s=r.eventId===null||!!t.eventId&&t.eventId===r.eventId;return r.filter.includes(t.type)&&s}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=uhe&&this.cachedEventUids.clear(),this.cachedEventUids.has(Fj(t))}saveEventToCache(t){this.cachedEventUids.add(Fj(t)),this.lastProcessedEventTime=Date.now()}}function Fj(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function AG({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function dhe(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return AG(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fhe(e,t={}){return Kf(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const phe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,mhe=/^https?/;async function ghe(e){if(e.config.emulator)return;const{authorizedDomains:t}=await fhe(e);for(const r of t)try{if(_he(r))return}catch{}Ql(e,"unauthorized-domain")}function _he(e){const t=lk(),{protocol:r,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){const _=new URL(e);return _.hostname===""&&s===""?r==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):r==="chrome-extension:"&&_.hostname===s}if(!mhe.test(r))return!1;if(phe.test(e))return s===e;const c=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yhe=new Jx(3e4,6e4);function Bj(){const e=Nu().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let r=0;r<e.CP.length;r++)e.CP[r]=null}}function vhe(e){return new Promise((t,r)=>{var s,c,f;function _(){Bj(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Bj(),r(jc(e,"network-request-failed"))},timeout:yhe.get()})}if(!((c=(s=Nu().gapi)===null||s===void 0?void 0:s.iframes)===null||c===void 0)&&c.Iframe)t(gapi.iframes.getContext());else if(!((f=Nu().gapi)===null||f===void 0)&&f.load)_();else{const x=pue("iframefcb");return Nu()[x]=()=>{gapi.load?_():r(jc(e,"network-request-failed"))},dG(`${fue()}?onload=${x}`).catch(a=>r(a))}}).catch(t=>{throw xE=null,t})}let xE=null;function xhe(e){return xE=xE||vhe(e),xE}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bhe=new Jx(5e3,15e3),whe="__/auth/iframe",The="emulator/auth/iframe",Ehe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},She=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ihe(e){const t=e.config;vr(t.authDomain,e,"auth-domain-config-required");const r=t.emulator?JD(t,The):`https://${e.config.authDomain}/${whe}`,s={apiKey:t.apiKey,appName:e.name,v:ig},c=She.get(e.config.apiHost);c&&(s.eid=c);const f=e._getFrameworks();return f.length&&(s.fw=f.join(",")),`${r}?${Yx(s).slice(1)}`}async function Che(e){const t=await xhe(e),r=Nu().gapi;return vr(r,e,"internal-error"),t.open({where:document.body,url:Ihe(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ehe,dontclear:!0},s=>new Promise(async(c,f)=>{await s.restyle({setHideOnLeave:!1});const _=jc(e,"network-request-failed"),x=Nu().setTimeout(()=>{f(_)},bhe.get());function a(){Nu().clearTimeout(x),c(s)}s.ping(a).then(a,()=>{f(_)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ahe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Phe=500,Rhe=600,Mhe="_blank",khe="http://localhost";class jj{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Dhe(e,t,r,s=Phe,c=Rhe){const f=Math.max((window.screen.availHeight-c)/2,0).toString(),_=Math.max((window.screen.availWidth-s)/2,0).toString();let x="";const a=Object.assign(Object.assign({},Ahe),{width:s.toString(),height:c.toString(),top:f,left:_}),I=Jo().toLowerCase();r&&(x=sG(I)?Mhe:r),rG(I)&&(t=t||khe,a.scrollbars="yes");const D=Object.entries(a).reduce((F,[Z,J])=>`${F}${Z}=${J},`,"");if(iue(I)&&x!=="_self")return Ohe(t||"",x),new jj(null);const O=window.open(t||"",x,D);vr(O,e,"popup-blocked");try{O.focus()}catch{}return new jj(O)}function Ohe(e,t){const r=document.createElement("a");r.href=e,r.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lhe="__/auth/handler",zhe="emulator/auth/handler",Nhe=encodeURIComponent("fac");async function Uj(e,t,r,s,c,f){vr(e.config.authDomain,e,"auth-domain-config-required"),vr(e.config.apiKey,e,"invalid-api-key");const _={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:s,v:ig,eventId:c};if(t instanceof i5){t.setDefaultLanguage(e.languageCode),_.providerId=t.providerId||"",Ile(t.getCustomParameters())||(_.customParameters=JSON.stringify(t.getCustomParameters()));for(const[D,O]of Object.entries({}))_[D]=O}if(t instanceof tb){const D=t.getScopes().filter(O=>O!=="");D.length>0&&(_.scopes=D.join(","))}e.tenantId&&(_.tid=e.tenantId);const x=_;for(const D of Object.keys(x))x[D]===void 0&&delete x[D];const a=await e._getAppCheckToken(),I=a?`#${Nhe}=${encodeURIComponent(a)}`:"";return`${Fhe(e)}?${Yx(x).slice(1)}${I}`}function Fhe({config:e}){return e.emulator?JD(e,zhe):`https://${e.authDomain}/${Lhe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dR="webStorageSupport";class Bhe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xG,this._completeRedirectFn=che,this._overrideRedirectResult=ohe}async _openPopup(t,r,s,c){var f;Hh((f=this.eventManagers[t._key()])===null||f===void 0?void 0:f.manager,"_initialize() not called before _openPopup()");const _=await Uj(t,r,s,lk(),c);return Dhe(t,_,s5())}async _openRedirect(t,r,s,c){await this._originValidation(t);const f=await Uj(t,r,s,lk(),c);return $ue(f),new Promise(()=>{})}_initialize(t){const r=t._key();if(this.eventManagers[r]){const{manager:c,promise:f}=this.eventManagers[r];return c?Promise.resolve(c):(Hh(f,"If manager is not set, promise should be"),f)}const s=this.initAndGetManager(t);return this.eventManagers[r]={promise:s},s.catch(()=>{delete this.eventManagers[r]}),s}async initAndGetManager(t){const r=await Che(t),s=new hhe(t);return r.register("authEvent",c=>(vr(c==null?void 0:c.authEvent,t,"invalid-auth-event"),{status:s.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:s},this.iframes[t._key()]=r,s}_isIframeWebStorageSupported(t,r){this.iframes[t._key()].send(dR,{type:dR},c=>{var f;const _=(f=c==null?void 0:c[0])===null||f===void 0?void 0:f[dR];_!==void 0&&r(!!_),Ql(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const r=t._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=ghe(t)),this.originValidationPromises[r]}get _shouldInitProactively(){return uG()||iG()||t5()}}const jhe=Bhe;var Vj="@firebase/auth",$j="1.7.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uhe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const r=this.auth.onIdTokenChanged(s=>{t((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,r),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const r=this.internalListeners.get(t);r&&(this.internalListeners.delete(t),r(),this.updateProactiveRefresh())}assertAuthConfigured(){vr(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vhe(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function $he(e){zm(new Lf("auth",(t,{options:r})=>{const s=t.getProvider("app").getImmediate(),c=t.getProvider("heartbeat"),f=t.getProvider("app-check-internal"),{apiKey:_,authDomain:x}=s.options;vr(_&&!_.includes(":"),"invalid-api-key",{appName:s.name});const a={apiKey:_,authDomain:x,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:hG(e)},I=new uue(s,c,f,a);return vue(I,r),I},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,r,s)=>{t.getProvider("auth-internal").initialize()})),zm(new Lf("auth-internal",t=>{const r=Qf(t.getProvider("auth").getImmediate());return(s=>new Uhe(s))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),zu(Vj,$j,Vhe(e)),zu(Vj,$j,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qhe=5*60,Ghe=Vq("authIdTokenMaxAge")||qhe;let qj=null;const Whe=e=>async t=>{const r=t&&await t.getIdTokenResult(),s=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(s&&s>Ghe)return;const c=r==null?void 0:r.token;qj!==c&&(qj=c,await fetch(e,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function Hhe(e=XD()){const t=KI(e,"auth");if(t.isInitialized())return t.getImmediate();const r=yue(e,{popupRedirectResolver:jhe,persistence:[Yue,jue,xG]}),s=Vq("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const f=new URL(s,location.origin);if(location.origin===f.origin){const _=Whe(f.toString());Nue(r,_,()=>_(r.currentUser)),zue(r,x=>_(x))}}const c=Bq("auth");return c&&xue(r,`http://${c}`),r}function Zhe(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}hue({loadJS(e){return new Promise((t,r)=>{const s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=c=>{const f=jc("internal-error");f.customData=c,r(f)},s.type="text/javascript",s.charset="UTF-8",Zhe().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});$he("Browser");var Gj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Tm,PG;(function(){var e;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(oe,he){function X(){}X.prototype=he.prototype,oe.D=he.prototype,oe.prototype=new X,oe.prototype.constructor=oe,oe.C=function(ge,be,ke){for(var Ee=Array(arguments.length-2),zt=2;zt<arguments.length;zt++)Ee[zt-2]=arguments[zt];return he.prototype[be].apply(ge,Ee)}}function r(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(s,r),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(oe,he,X){X||(X=0);var ge=Array(16);if(typeof he=="string")for(var be=0;16>be;++be)ge[be]=he.charCodeAt(X++)|he.charCodeAt(X++)<<8|he.charCodeAt(X++)<<16|he.charCodeAt(X++)<<24;else for(be=0;16>be;++be)ge[be]=he[X++]|he[X++]<<8|he[X++]<<16|he[X++]<<24;he=oe.g[0],X=oe.g[1],be=oe.g[2];var ke=oe.g[3],Ee=he+(ke^X&(be^ke))+ge[0]+3614090360&4294967295;he=X+(Ee<<7&4294967295|Ee>>>25),Ee=ke+(be^he&(X^be))+ge[1]+3905402710&4294967295,ke=he+(Ee<<12&4294967295|Ee>>>20),Ee=be+(X^ke&(he^X))+ge[2]+606105819&4294967295,be=ke+(Ee<<17&4294967295|Ee>>>15),Ee=X+(he^be&(ke^he))+ge[3]+3250441966&4294967295,X=be+(Ee<<22&4294967295|Ee>>>10),Ee=he+(ke^X&(be^ke))+ge[4]+4118548399&4294967295,he=X+(Ee<<7&4294967295|Ee>>>25),Ee=ke+(be^he&(X^be))+ge[5]+1200080426&4294967295,ke=he+(Ee<<12&4294967295|Ee>>>20),Ee=be+(X^ke&(he^X))+ge[6]+2821735955&4294967295,be=ke+(Ee<<17&4294967295|Ee>>>15),Ee=X+(he^be&(ke^he))+ge[7]+4249261313&4294967295,X=be+(Ee<<22&4294967295|Ee>>>10),Ee=he+(ke^X&(be^ke))+ge[8]+1770035416&4294967295,he=X+(Ee<<7&4294967295|Ee>>>25),Ee=ke+(be^he&(X^be))+ge[9]+2336552879&4294967295,ke=he+(Ee<<12&4294967295|Ee>>>20),Ee=be+(X^ke&(he^X))+ge[10]+4294925233&4294967295,be=ke+(Ee<<17&4294967295|Ee>>>15),Ee=X+(he^be&(ke^he))+ge[11]+2304563134&4294967295,X=be+(Ee<<22&4294967295|Ee>>>10),Ee=he+(ke^X&(be^ke))+ge[12]+1804603682&4294967295,he=X+(Ee<<7&4294967295|Ee>>>25),Ee=ke+(be^he&(X^be))+ge[13]+4254626195&4294967295,ke=he+(Ee<<12&4294967295|Ee>>>20),Ee=be+(X^ke&(he^X))+ge[14]+2792965006&4294967295,be=ke+(Ee<<17&4294967295|Ee>>>15),Ee=X+(he^be&(ke^he))+ge[15]+1236535329&4294967295,X=be+(Ee<<22&4294967295|Ee>>>10),Ee=he+(be^ke&(X^be))+ge[1]+4129170786&4294967295,he=X+(Ee<<5&4294967295|Ee>>>27),Ee=ke+(X^be&(he^X))+ge[6]+3225465664&4294967295,ke=he+(Ee<<9&4294967295|Ee>>>23),Ee=be+(he^X&(ke^he))+ge[11]+643717713&4294967295,be=ke+(Ee<<14&4294967295|Ee>>>18),Ee=X+(ke^he&(be^ke))+ge[0]+3921069994&4294967295,X=be+(Ee<<20&4294967295|Ee>>>12),Ee=he+(be^ke&(X^be))+ge[5]+3593408605&4294967295,he=X+(Ee<<5&4294967295|Ee>>>27),Ee=ke+(X^be&(he^X))+ge[10]+38016083&4294967295,ke=he+(Ee<<9&4294967295|Ee>>>23),Ee=be+(he^X&(ke^he))+ge[15]+3634488961&4294967295,be=ke+(Ee<<14&4294967295|Ee>>>18),Ee=X+(ke^he&(be^ke))+ge[4]+3889429448&4294967295,X=be+(Ee<<20&4294967295|Ee>>>12),Ee=he+(be^ke&(X^be))+ge[9]+568446438&4294967295,he=X+(Ee<<5&4294967295|Ee>>>27),Ee=ke+(X^be&(he^X))+ge[14]+3275163606&4294967295,ke=he+(Ee<<9&4294967295|Ee>>>23),Ee=be+(he^X&(ke^he))+ge[3]+4107603335&4294967295,be=ke+(Ee<<14&4294967295|Ee>>>18),Ee=X+(ke^he&(be^ke))+ge[8]+1163531501&4294967295,X=be+(Ee<<20&4294967295|Ee>>>12),Ee=he+(be^ke&(X^be))+ge[13]+2850285829&4294967295,he=X+(Ee<<5&4294967295|Ee>>>27),Ee=ke+(X^be&(he^X))+ge[2]+4243563512&4294967295,ke=he+(Ee<<9&4294967295|Ee>>>23),Ee=be+(he^X&(ke^he))+ge[7]+1735328473&4294967295,be=ke+(Ee<<14&4294967295|Ee>>>18),Ee=X+(ke^he&(be^ke))+ge[12]+2368359562&4294967295,X=be+(Ee<<20&4294967295|Ee>>>12),Ee=he+(X^be^ke)+ge[5]+4294588738&4294967295,he=X+(Ee<<4&4294967295|Ee>>>28),Ee=ke+(he^X^be)+ge[8]+2272392833&4294967295,ke=he+(Ee<<11&4294967295|Ee>>>21),Ee=be+(ke^he^X)+ge[11]+1839030562&4294967295,be=ke+(Ee<<16&4294967295|Ee>>>16),Ee=X+(be^ke^he)+ge[14]+4259657740&4294967295,X=be+(Ee<<23&4294967295|Ee>>>9),Ee=he+(X^be^ke)+ge[1]+2763975236&4294967295,he=X+(Ee<<4&4294967295|Ee>>>28),Ee=ke+(he^X^be)+ge[4]+1272893353&4294967295,ke=he+(Ee<<11&4294967295|Ee>>>21),Ee=be+(ke^he^X)+ge[7]+4139469664&4294967295,be=ke+(Ee<<16&4294967295|Ee>>>16),Ee=X+(be^ke^he)+ge[10]+3200236656&4294967295,X=be+(Ee<<23&4294967295|Ee>>>9),Ee=he+(X^be^ke)+ge[13]+681279174&4294967295,he=X+(Ee<<4&4294967295|Ee>>>28),Ee=ke+(he^X^be)+ge[0]+3936430074&4294967295,ke=he+(Ee<<11&4294967295|Ee>>>21),Ee=be+(ke^he^X)+ge[3]+3572445317&4294967295,be=ke+(Ee<<16&4294967295|Ee>>>16),Ee=X+(be^ke^he)+ge[6]+76029189&4294967295,X=be+(Ee<<23&4294967295|Ee>>>9),Ee=he+(X^be^ke)+ge[9]+3654602809&4294967295,he=X+(Ee<<4&4294967295|Ee>>>28),Ee=ke+(he^X^be)+ge[12]+3873151461&4294967295,ke=he+(Ee<<11&4294967295|Ee>>>21),Ee=be+(ke^he^X)+ge[15]+530742520&4294967295,be=ke+(Ee<<16&4294967295|Ee>>>16),Ee=X+(be^ke^he)+ge[2]+3299628645&4294967295,X=be+(Ee<<23&4294967295|Ee>>>9),Ee=he+(be^(X|~ke))+ge[0]+4096336452&4294967295,he=X+(Ee<<6&4294967295|Ee>>>26),Ee=ke+(X^(he|~be))+ge[7]+1126891415&4294967295,ke=he+(Ee<<10&4294967295|Ee>>>22),Ee=be+(he^(ke|~X))+ge[14]+2878612391&4294967295,be=ke+(Ee<<15&4294967295|Ee>>>17),Ee=X+(ke^(be|~he))+ge[5]+4237533241&4294967295,X=be+(Ee<<21&4294967295|Ee>>>11),Ee=he+(be^(X|~ke))+ge[12]+1700485571&4294967295,he=X+(Ee<<6&4294967295|Ee>>>26),Ee=ke+(X^(he|~be))+ge[3]+2399980690&4294967295,ke=he+(Ee<<10&4294967295|Ee>>>22),Ee=be+(he^(ke|~X))+ge[10]+4293915773&4294967295,be=ke+(Ee<<15&4294967295|Ee>>>17),Ee=X+(ke^(be|~he))+ge[1]+2240044497&4294967295,X=be+(Ee<<21&4294967295|Ee>>>11),Ee=he+(be^(X|~ke))+ge[8]+1873313359&4294967295,he=X+(Ee<<6&4294967295|Ee>>>26),Ee=ke+(X^(he|~be))+ge[15]+4264355552&4294967295,ke=he+(Ee<<10&4294967295|Ee>>>22),Ee=be+(he^(ke|~X))+ge[6]+2734768916&4294967295,be=ke+(Ee<<15&4294967295|Ee>>>17),Ee=X+(ke^(be|~he))+ge[13]+1309151649&4294967295,X=be+(Ee<<21&4294967295|Ee>>>11),Ee=he+(be^(X|~ke))+ge[4]+4149444226&4294967295,he=X+(Ee<<6&4294967295|Ee>>>26),Ee=ke+(X^(he|~be))+ge[11]+3174756917&4294967295,ke=he+(Ee<<10&4294967295|Ee>>>22),Ee=be+(he^(ke|~X))+ge[2]+718787259&4294967295,be=ke+(Ee<<15&4294967295|Ee>>>17),Ee=X+(ke^(be|~he))+ge[9]+3951481745&4294967295,oe.g[0]=oe.g[0]+he&4294967295,oe.g[1]=oe.g[1]+(be+(Ee<<21&4294967295|Ee>>>11))&4294967295,oe.g[2]=oe.g[2]+be&4294967295,oe.g[3]=oe.g[3]+ke&4294967295}s.prototype.u=function(oe,he){he===void 0&&(he=oe.length);for(var X=he-this.blockSize,ge=this.B,be=this.h,ke=0;ke<he;){if(be==0)for(;ke<=X;)c(this,oe,ke),ke+=this.blockSize;if(typeof oe=="string"){for(;ke<he;)if(ge[be++]=oe.charCodeAt(ke++),be==this.blockSize){c(this,ge),be=0;break}}else for(;ke<he;)if(ge[be++]=oe[ke++],be==this.blockSize){c(this,ge),be=0;break}}this.h=be,this.o+=he},s.prototype.v=function(){var oe=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);oe[0]=128;for(var he=1;he<oe.length-8;++he)oe[he]=0;var X=8*this.o;for(he=oe.length-8;he<oe.length;++he)oe[he]=X&255,X/=256;for(this.u(oe),oe=Array(16),he=X=0;4>he;++he)for(var ge=0;32>ge;ge+=8)oe[X++]=this.g[he]>>>ge&255;return oe};function f(oe,he){var X=x;return Object.prototype.hasOwnProperty.call(X,oe)?X[oe]:X[oe]=he(oe)}function _(oe,he){this.h=he;for(var X=[],ge=!0,be=oe.length-1;0<=be;be--){var ke=oe[be]|0;ge&&ke==he||(X[be]=ke,ge=!1)}this.g=X}var x={};function a(oe){return-128<=oe&&128>oe?f(oe,function(he){return new _([he|0],0>he?-1:0)}):new _([oe|0],0>oe?-1:0)}function I(oe){if(isNaN(oe)||!isFinite(oe))return O;if(0>oe)return ne(I(-oe));for(var he=[],X=1,ge=0;oe>=X;ge++)he[ge]=oe/X|0,X*=4294967296;return new _(he,0)}function D(oe,he){if(oe.length==0)throw Error("number format error: empty string");if(he=he||10,2>he||36<he)throw Error("radix out of range: "+he);if(oe.charAt(0)=="-")return ne(D(oe.substring(1),he));if(0<=oe.indexOf("-"))throw Error('number format error: interior "-" character');for(var X=I(Math.pow(he,8)),ge=O,be=0;be<oe.length;be+=8){var ke=Math.min(8,oe.length-be),Ee=parseInt(oe.substring(be,be+ke),he);8>ke?(ke=I(Math.pow(he,ke)),ge=ge.j(ke).add(I(Ee))):(ge=ge.j(X),ge=ge.add(I(Ee)))}return ge}var O=a(0),F=a(1),Z=a(16777216);e=_.prototype,e.m=function(){if(re(this))return-ne(this).m();for(var oe=0,he=1,X=0;X<this.g.length;X++){var ge=this.i(X);oe+=(0<=ge?ge:4294967296+ge)*he,he*=4294967296}return oe},e.toString=function(oe){if(oe=oe||10,2>oe||36<oe)throw Error("radix out of range: "+oe);if(J(this))return"0";if(re(this))return"-"+ne(this).toString(oe);for(var he=I(Math.pow(oe,6)),X=this,ge="";;){var be=de(X,he).g;X=G(X,be.j(he));var ke=((0<X.g.length?X.g[0]:X.h)>>>0).toString(oe);if(X=be,J(X))return ke+ge;for(;6>ke.length;)ke="0"+ke;ge=ke+ge}},e.i=function(oe){return 0>oe?0:oe<this.g.length?this.g[oe]:this.h};function J(oe){if(oe.h!=0)return!1;for(var he=0;he<oe.g.length;he++)if(oe.g[he]!=0)return!1;return!0}function re(oe){return oe.h==-1}e.l=function(oe){return oe=G(this,oe),re(oe)?-1:J(oe)?0:1};function ne(oe){for(var he=oe.g.length,X=[],ge=0;ge<he;ge++)X[ge]=~oe.g[ge];return new _(X,~oe.h).add(F)}e.abs=function(){return re(this)?ne(this):this},e.add=function(oe){for(var he=Math.max(this.g.length,oe.g.length),X=[],ge=0,be=0;be<=he;be++){var ke=ge+(this.i(be)&65535)+(oe.i(be)&65535),Ee=(ke>>>16)+(this.i(be)>>>16)+(oe.i(be)>>>16);ge=Ee>>>16,ke&=65535,Ee&=65535,X[be]=Ee<<16|ke}return new _(X,X[X.length-1]&-2147483648?-1:0)};function G(oe,he){return oe.add(ne(he))}e.j=function(oe){if(J(this)||J(oe))return O;if(re(this))return re(oe)?ne(this).j(ne(oe)):ne(ne(this).j(oe));if(re(oe))return ne(this.j(ne(oe)));if(0>this.l(Z)&&0>oe.l(Z))return I(this.m()*oe.m());for(var he=this.g.length+oe.g.length,X=[],ge=0;ge<2*he;ge++)X[ge]=0;for(ge=0;ge<this.g.length;ge++)for(var be=0;be<oe.g.length;be++){var ke=this.i(ge)>>>16,Ee=this.i(ge)&65535,zt=oe.i(be)>>>16,Ut=oe.i(be)&65535;X[2*ge+2*be]+=Ee*Ut,Y(X,2*ge+2*be),X[2*ge+2*be+1]+=ke*Ut,Y(X,2*ge+2*be+1),X[2*ge+2*be+1]+=Ee*zt,Y(X,2*ge+2*be+1),X[2*ge+2*be+2]+=ke*zt,Y(X,2*ge+2*be+2)}for(ge=0;ge<he;ge++)X[ge]=X[2*ge+1]<<16|X[2*ge];for(ge=he;ge<2*he;ge++)X[ge]=0;return new _(X,0)};function Y(oe,he){for(;(oe[he]&65535)!=oe[he];)oe[he+1]+=oe[he]>>>16,oe[he]&=65535,he++}function Q(oe,he){this.g=oe,this.h=he}function de(oe,he){if(J(he))throw Error("division by zero");if(J(oe))return new Q(O,O);if(re(oe))return he=de(ne(oe),he),new Q(ne(he.g),ne(he.h));if(re(he))return he=de(oe,ne(he)),new Q(ne(he.g),he.h);if(30<oe.g.length){if(re(oe)||re(he))throw Error("slowDivide_ only works with positive integers.");for(var X=F,ge=he;0>=ge.l(oe);)X=Te(X),ge=Te(ge);var be=we(X,1),ke=we(ge,1);for(ge=we(ge,2),X=we(X,2);!J(ge);){var Ee=ke.add(ge);0>=Ee.l(oe)&&(be=be.add(X),ke=Ee),ge=we(ge,1),X=we(X,1)}return he=G(oe,be.j(he)),new Q(be,he)}for(be=O;0<=oe.l(he);){for(X=Math.max(1,Math.floor(oe.m()/he.m())),ge=Math.ceil(Math.log(X)/Math.LN2),ge=48>=ge?1:Math.pow(2,ge-48),ke=I(X),Ee=ke.j(he);re(Ee)||0<Ee.l(oe);)X-=ge,ke=I(X),Ee=ke.j(he);J(ke)&&(ke=F),be=be.add(ke),oe=G(oe,Ee)}return new Q(be,oe)}e.A=function(oe){return de(this,oe).h},e.and=function(oe){for(var he=Math.max(this.g.length,oe.g.length),X=[],ge=0;ge<he;ge++)X[ge]=this.i(ge)&oe.i(ge);return new _(X,this.h&oe.h)},e.or=function(oe){for(var he=Math.max(this.g.length,oe.g.length),X=[],ge=0;ge<he;ge++)X[ge]=this.i(ge)|oe.i(ge);return new _(X,this.h|oe.h)},e.xor=function(oe){for(var he=Math.max(this.g.length,oe.g.length),X=[],ge=0;ge<he;ge++)X[ge]=this.i(ge)^oe.i(ge);return new _(X,this.h^oe.h)};function Te(oe){for(var he=oe.g.length+1,X=[],ge=0;ge<he;ge++)X[ge]=oe.i(ge)<<1|oe.i(ge-1)>>>31;return new _(X,oe.h)}function we(oe,he){var X=he>>5;he%=32;for(var ge=oe.g.length-X,be=[],ke=0;ke<ge;ke++)be[ke]=0<he?oe.i(ke+X)>>>he|oe.i(ke+X+1)<<32-he:oe.i(ke+X);return new _(be,oe.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,PG=s,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.A,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=I,_.fromString=D,Tm=_}).apply(typeof Gj<"u"?Gj:typeof self<"u"?self:typeof window<"u"?window:{});var FT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var RG,MG,s1,kG,bE,dk,DG,OG,LG;(function(){var e,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(R,K,ue){return R==Array.prototype||R==Object.prototype||(R[K]=ue.value),R};function r(R){R=[typeof globalThis=="object"&&globalThis,R,typeof window=="object"&&window,typeof self=="object"&&self,typeof FT=="object"&&FT];for(var K=0;K<R.length;++K){var ue=R[K];if(ue&&ue.Math==Math)return ue}throw Error("Cannot find global object")}var s=r(this);function c(R,K){if(K)e:{var ue=s;R=R.split(".");for(var Me=0;Me<R.length-1;Me++){var dt=R[Me];if(!(dt in ue))break e;ue=ue[dt]}R=R[R.length-1],Me=ue[R],K=K(Me),K!=Me&&K!=null&&t(ue,R,{configurable:!0,writable:!0,value:K})}}function f(R,K){R instanceof String&&(R+="");var ue=0,Me=!1,dt={next:function(){if(!Me&&ue<R.length){var It=ue++;return{value:K(It,R[It]),done:!1}}return Me=!0,{done:!0,value:void 0}}};return dt[Symbol.iterator]=function(){return dt},dt}c("Array.prototype.values",function(R){return R||function(){return f(this,function(K,ue){return ue})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var _=_||{},x=this||self;function a(R){var K=typeof R;return K=K!="object"?K:R?Array.isArray(R)?"array":K:"null",K=="array"||K=="object"&&typeof R.length=="number"}function I(R){var K=typeof R;return K=="object"&&R!=null||K=="function"}function D(R,K,ue){return R.call.apply(R.bind,arguments)}function O(R,K,ue){if(!R)throw Error();if(2<arguments.length){var Me=Array.prototype.slice.call(arguments,2);return function(){var dt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(dt,Me),R.apply(K,dt)}}return function(){return R.apply(K,arguments)}}function F(R,K,ue){return F=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?D:O,F.apply(null,arguments)}function Z(R,K){var ue=Array.prototype.slice.call(arguments,1);return function(){var Me=ue.slice();return Me.push.apply(Me,arguments),R.apply(this,Me)}}function J(R,K){function ue(){}ue.prototype=K.prototype,R.aa=K.prototype,R.prototype=new ue,R.prototype.constructor=R,R.Qb=function(Me,dt,It){for(var en=Array(arguments.length-2),ii=2;ii<arguments.length;ii++)en[ii-2]=arguments[ii];return K.prototype[dt].apply(Me,en)}}function re(R){const K=R.length;if(0<K){const ue=Array(K);for(let Me=0;Me<K;Me++)ue[Me]=R[Me];return ue}return[]}function ne(R,K){for(let ue=1;ue<arguments.length;ue++){const Me=arguments[ue];if(a(Me)){const dt=R.length||0,It=Me.length||0;R.length=dt+It;for(let en=0;en<It;en++)R[dt+en]=Me[en]}else R.push(Me)}}class G{constructor(K,ue){this.i=K,this.j=ue,this.h=0,this.g=null}get(){let K;return 0<this.h?(this.h--,K=this.g,this.g=K.next,K.next=null):K=this.i(),K}}function Y(R){return/^[\s\xa0]*$/.test(R)}function Q(){var R=x.navigator;return R&&(R=R.userAgent)?R:""}function de(R){return de[" "](R),R}de[" "]=function(){};var Te=Q().indexOf("Gecko")!=-1&&!(Q().toLowerCase().indexOf("webkit")!=-1&&Q().indexOf("Edge")==-1)&&!(Q().indexOf("Trident")!=-1||Q().indexOf("MSIE")!=-1)&&Q().indexOf("Edge")==-1;function we(R,K,ue){for(const Me in R)K.call(ue,R[Me],Me,R)}function oe(R,K){for(const ue in R)K.call(void 0,R[ue],ue,R)}function he(R){const K={};for(const ue in R)K[ue]=R[ue];return K}const X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ge(R,K){let ue,Me;for(let dt=1;dt<arguments.length;dt++){Me=arguments[dt];for(ue in Me)R[ue]=Me[ue];for(let It=0;It<X.length;It++)ue=X[It],Object.prototype.hasOwnProperty.call(Me,ue)&&(R[ue]=Me[ue])}}function be(R){var K=1;R=R.split(":");const ue=[];for(;0<K&&R.length;)ue.push(R.shift()),K--;return R.length&&ue.push(R.join(":")),ue}function ke(R){x.setTimeout(()=>{throw R},0)}function Ee(){var R=Rt;let K=null;return R.g&&(K=R.g,R.g=R.g.next,R.g||(R.h=null),K.next=null),K}class zt{constructor(){this.h=this.g=null}add(K,ue){const Me=Ut.get();Me.set(K,ue),this.h?this.h.next=Me:this.g=Me,this.h=Me}}var Ut=new G(()=>new Qt,R=>R.reset());class Qt{constructor(){this.next=this.g=this.h=null}set(K,ue){this.h=K,this.g=ue,this.next=null}reset(){this.next=this.g=this.h=null}}let kt,ft=!1,Rt=new zt,Yt=()=>{const R=x.Promise.resolve(void 0);kt=()=>{R.then(ht)}};var ht=()=>{for(var R;R=Ee();){try{R.h.call(R.g)}catch(ue){ke(ue)}var K=Ut;K.j(R),100>K.h&&(K.h++,R.next=K.g,K.g=R)}ft=!1};function At(){this.s=this.s,this.C=this.C}At.prototype.s=!1,At.prototype.ma=function(){this.s||(this.s=!0,this.N())},At.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function wt(R,K){this.type=R,this.g=this.target=K,this.defaultPrevented=!1}wt.prototype.h=function(){this.defaultPrevented=!0};var Xt=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var R=!1,K=Object.defineProperty({},"passive",{get:function(){R=!0}});try{const ue=()=>{};x.addEventListener("test",ue,K),x.removeEventListener("test",ue,K)}catch{}return R}();function Ft(R,K){if(wt.call(this,R?R.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,R){var ue=this.type=R.type,Me=R.changedTouches&&R.changedTouches.length?R.changedTouches[0]:null;if(this.target=R.target||R.srcElement,this.g=K,K=R.relatedTarget){if(Te){e:{try{de(K.nodeName);var dt=!0;break e}catch{}dt=!1}dt||(K=null)}}else ue=="mouseover"?K=R.fromElement:ue=="mouseout"&&(K=R.toElement);this.relatedTarget=K,Me?(this.clientX=Me.clientX!==void 0?Me.clientX:Me.pageX,this.clientY=Me.clientY!==void 0?Me.clientY:Me.pageY,this.screenX=Me.screenX||0,this.screenY=Me.screenY||0):(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0),this.button=R.button,this.key=R.key||"",this.ctrlKey=R.ctrlKey,this.altKey=R.altKey,this.shiftKey=R.shiftKey,this.metaKey=R.metaKey,this.pointerId=R.pointerId||0,this.pointerType=typeof R.pointerType=="string"?R.pointerType:Sn[R.pointerType]||"",this.state=R.state,this.i=R,R.defaultPrevented&&Ft.aa.h.call(this)}}J(Ft,wt);var Sn={2:"touch",3:"pen",4:"mouse"};Ft.prototype.h=function(){Ft.aa.h.call(this);var R=this.i;R.preventDefault?R.preventDefault():R.returnValue=!1};var qn="closure_listenable_"+(1e6*Math.random()|0),Qn=0;function Gt(R,K,ue,Me,dt){this.listener=R,this.proxy=null,this.src=K,this.type=ue,this.capture=!!Me,this.ha=dt,this.key=++Qn,this.da=this.fa=!1}function Cn(R){R.da=!0,R.listener=null,R.proxy=null,R.src=null,R.ha=null}function hn(R){this.src=R,this.g={},this.h=0}hn.prototype.add=function(R,K,ue,Me,dt){var It=R.toString();R=this.g[It],R||(R=this.g[It]=[],this.h++);var en=Nr(R,K,Me,dt);return-1<en?(K=R[en],ue||(K.fa=!1)):(K=new Gt(K,this.src,It,!!Me,dt),K.fa=ue,R.push(K)),K};function Rn(R,K){var ue=K.type;if(ue in R.g){var Me=R.g[ue],dt=Array.prototype.indexOf.call(Me,K,void 0),It;(It=0<=dt)&&Array.prototype.splice.call(Me,dt,1),It&&(Cn(K),R.g[ue].length==0&&(delete R.g[ue],R.h--))}}function Nr(R,K,ue,Me){for(var dt=0;dt<R.length;++dt){var It=R[dt];if(!It.da&&It.listener==K&&It.capture==!!ue&&It.ha==Me)return dt}return-1}var jn="closure_lm_"+(1e6*Math.random()|0),gr={};function Fr(R,K,ue,Me,dt){if(Array.isArray(K)){for(var It=0;It<K.length;It++)Fr(R,K[It],ue,Me,dt);return null}return ue=an(ue),R&&R[qn]?R.K(K,ue,I(Me)?!!Me.capture:!!Me,dt):dr(R,K,ue,!1,Me,dt)}function dr(R,K,ue,Me,dt,It){if(!K)throw Error("Invalid event type");var en=I(dt)?!!dt.capture:!!dt,ii=st(R);if(ii||(R[jn]=ii=new hn(R)),ue=ii.add(K,ue,Me,en,It),ue.proxy)return ue;if(Me=rr(),ue.proxy=Me,Me.src=R,Me.listener=ue,R.addEventListener)Xt||(dt=en),dt===void 0&&(dt=!1),R.addEventListener(K.toString(),Me,dt);else if(R.attachEvent)R.attachEvent(ut(K.toString()),Me);else if(R.addListener&&R.removeListener)R.addListener(Me);else throw Error("addEventListener and attachEvent are unavailable.");return ue}function rr(){function R(ue){return K.call(R.src,R.listener,ue)}const K=Ye;return R}function Ue(R,K,ue,Me,dt){if(Array.isArray(K))for(var It=0;It<K.length;It++)Ue(R,K[It],ue,Me,dt);else Me=I(Me)?!!Me.capture:!!Me,ue=an(ue),R&&R[qn]?(R=R.i,K=String(K).toString(),K in R.g&&(It=R.g[K],ue=Nr(It,ue,Me,dt),-1<ue&&(Cn(It[ue]),Array.prototype.splice.call(It,ue,1),It.length==0&&(delete R.g[K],R.h--)))):R&&(R=st(R))&&(K=R.g[K.toString()],R=-1,K&&(R=Nr(K,ue,Me,dt)),(ue=-1<R?K[R]:null)&&Xe(ue))}function Xe(R){if(typeof R!="number"&&R&&!R.da){var K=R.src;if(K&&K[qn])Rn(K.i,R);else{var ue=R.type,Me=R.proxy;K.removeEventListener?K.removeEventListener(ue,Me,R.capture):K.detachEvent?K.detachEvent(ut(ue),Me):K.addListener&&K.removeListener&&K.removeListener(Me),(ue=st(K))?(Rn(ue,R),ue.h==0&&(ue.src=null,K[jn]=null)):Cn(R)}}}function ut(R){return R in gr?gr[R]:gr[R]="on"+R}function Ye(R,K){if(R.da)R=!0;else{K=new Ft(K,this);var ue=R.listener,Me=R.ha||R.src;R.fa&&Xe(R),R=ue.call(Me,K)}return R}function st(R){return R=R[jn],R instanceof hn?R:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function an(R){return typeof R=="function"?R:(R[Mt]||(R[Mt]=function(K){return R.handleEvent(K)}),R[Mt])}function qt(){At.call(this),this.i=new hn(this),this.M=this,this.F=null}J(qt,At),qt.prototype[qn]=!0,qt.prototype.removeEventListener=function(R,K,ue,Me){Ue(this,R,K,ue,Me)};function mn(R,K){var ue,Me=R.F;if(Me)for(ue=[];Me;Me=Me.F)ue.push(Me);if(R=R.M,Me=K.type||K,typeof K=="string")K=new wt(K,R);else if(K instanceof wt)K.target=K.target||R;else{var dt=K;K=new wt(Me,R),ge(K,dt)}if(dt=!0,ue)for(var It=ue.length-1;0<=It;It--){var en=K.g=ue[It];dt=Ln(en,Me,!0,K)&&dt}if(en=K.g=R,dt=Ln(en,Me,!0,K)&&dt,dt=Ln(en,Me,!1,K)&&dt,ue)for(It=0;It<ue.length;It++)en=K.g=ue[It],dt=Ln(en,Me,!1,K)&&dt}qt.prototype.N=function(){if(qt.aa.N.call(this),this.i){var R=this.i,K;for(K in R.g){for(var ue=R.g[K],Me=0;Me<ue.length;Me++)Cn(ue[Me]);delete R.g[K],R.h--}}this.F=null},qt.prototype.K=function(R,K,ue,Me){return this.i.add(String(R),K,!1,ue,Me)},qt.prototype.L=function(R,K,ue,Me){return this.i.add(String(R),K,!0,ue,Me)};function Ln(R,K,ue,Me){if(K=R.i.g[String(K)],!K)return!0;K=K.concat();for(var dt=!0,It=0;It<K.length;++It){var en=K[It];if(en&&!en.da&&en.capture==ue){var ii=en.listener,ps=en.ha||en.src;en.fa&&Rn(R.i,en),dt=ii.call(ps,Me)!==!1&&dt}}return dt&&!Me.defaultPrevented}function fr(R,K,ue){if(typeof R=="function")ue&&(R=F(R,ue));else if(R&&typeof R.handleEvent=="function")R=F(R.handleEvent,R);else throw Error("Invalid listener argument");return 2147483647<Number(K)?-1:x.setTimeout(R,K||0)}function fi(R){R.g=fr(()=>{R.g=null,R.i&&(R.i=!1,fi(R))},R.l);const K=R.h;R.h=null,R.m.apply(null,K)}class ir extends At{constructor(K,ue){super(),this.m=K,this.l=ue,this.h=null,this.i=!1,this.g=null}j(K){this.h=arguments,this.g?this.i=!0:fi(this)}N(){super.N(),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ci(R){At.call(this),this.h=R,this.g={}}J(Ci,At);var ss=[];function Tn(R){we(R.g,function(K,ue){this.g.hasOwnProperty(ue)&&Xe(K)},R),R.g={}}Ci.prototype.N=function(){Ci.aa.N.call(this),Tn(this)},Ci.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var or=x.JSON.stringify,dn=x.JSON.parse,Js=class{stringify(R){return x.JSON.stringify(R,void 0)}parse(R){return x.JSON.parse(R,void 0)}};function Ai(){}Ai.prototype.h=null;function fo(R){return R.h||(R.h=R.i())}function wa(){}var nn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Jn(){wt.call(this,"d")}J(Jn,wt);function ti(){wt.call(this,"c")}J(ti,wt);var Mi={},Ts=null;function Es(){return Ts=Ts||new qt}Mi.La="serverreachability";function Ls(R){wt.call(this,Mi.La,R)}J(Ls,wt);function $s(R){const K=Es();mn(K,new Ls(K))}Mi.STAT_EVENT="statevent";function Lo(R,K){wt.call(this,Mi.STAT_EVENT,R),this.stat=K}J(Lo,wt);function jr(R){const K=Es();mn(K,new Lo(K,R))}Mi.Ma="timingevent";function Wa(R,K){wt.call(this,Mi.Ma,R),this.size=K}J(Wa,wt);function ni(R,K){if(typeof R!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){R()},K)}function xi(){this.g=!0}xi.prototype.xa=function(){this.g=!1};function Tl(R,K,ue,Me,dt,It){R.info(function(){if(R.g)if(It)for(var en="",ii=It.split("&"),ps=0;ps<ii.length;ps++){var Ur=ii[ps].split("=");if(1<Ur.length){var As=Ur[0];Ur=Ur[1];var Ps=As.split("_");en=2<=Ps.length&&Ps[1]=="type"?en+(As+"="+Ur+"&"):en+(As+"=redacted&")}}else en=null;else en=It;return"XMLHTTP REQ ("+Me+") [attempt "+dt+"]: "+K+`
`+ue+`
`+en})}function Ta(R,K,ue,Me,dt,It,en){R.info(function(){return"XMLHTTP RESP ("+Me+") [ attempt "+dt+"]: "+K+`
`+ue+`
`+It+" "+en})}function po(R,K,ue,Me){R.info(function(){return"XMLHTTP TEXT ("+K+"): "+Xu(R,ue)+(Me?" "+Me:"")})}function Fi(R,K){R.info(function(){return"TIMEOUT: "+K})}xi.prototype.info=function(){};function Xu(R,K){if(!R.g)return K;if(!K)return null;try{var ue=JSON.parse(K);if(ue){for(R=0;R<ue.length;R++)if(Array.isArray(ue[R])){var Me=ue[R];if(!(2>Me.length)){var dt=Me[1];if(Array.isArray(dt)&&!(1>dt.length)){var It=dt[0];if(It!="noop"&&It!="stop"&&It!="close")for(var en=1;en<dt.length;en++)dt[en]=""}}}}return or(ue)}catch{return K}}var je={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},te={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},le;function xe(){}J(xe,Ai),xe.prototype.g=function(){return new XMLHttpRequest},xe.prototype.i=function(){return{}},le=new xe;function Oe(R,K,ue,Me){this.j=R,this.i=K,this.l=ue,this.R=Me||1,this.U=new Ci(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new De}function De(){this.i=null,this.g="",this.h=!1}var Ge={},rt={};function qe(R,K,ue){R.L=1,R.v=Wc(zo(K)),R.m=ue,R.P=!0,tt(R,null)}function tt(R,K){R.F=Date.now(),Wt(R),R.A=zo(R.v);var ue=R.A,Me=R.R;Array.isArray(Me)||(Me=[String(Me)]),ug(ue.i,"t",Me),R.C=0,ue=R.j.J,R.h=new De,R.g=nu(R.j,ue?K:null,!R.m),0<R.O&&(R.M=new ir(F(R.Y,R,R.g),R.O)),K=R.U,ue=R.g,Me=R.ca;var dt="readystatechange";Array.isArray(dt)||(dt&&(ss[0]=dt.toString()),dt=ss);for(var It=0;It<dt.length;It++){var en=Fr(ue,dt[It],Me||K.handleEvent,!1,K.h||K);if(!en)break;K.g[en.key]=en}K=R.H?he(R.H):{},R.m?(R.u||(R.u="POST"),K["Content-Type"]="application/x-www-form-urlencoded",R.g.ea(R.A,R.u,R.m,K)):(R.u="GET",R.g.ea(R.A,R.u,null,K)),$s(),Tl(R.i,R.u,R.A,R.l,R.R,R.m)}Oe.prototype.ca=function(R){R=R.target;const K=this.M;K&&na(R)==3?K.j():this.Y(R)},Oe.prototype.Y=function(R){try{if(R==this.g)e:{const Ps=na(this.g);var K=this.g.Ba();const uc=this.g.Z();if(!(3>Ps)&&(Ps!=3||this.g&&(this.h.h||this.g.oa()||sc(this.g)))){this.J||Ps!=4||K==7||(K==8||0>=uc?$s(3):$s(2)),wn(this);var ue=this.g.Z();this.X=ue;t:if(yt(this)){var Me=sc(this.g);R="";var dt=Me.length,It=na(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){An(this),ar(this);var en="";break t}this.h.i=new x.TextDecoder}for(K=0;K<dt;K++)this.h.h=!0,R+=this.h.i.decode(Me[K],{stream:!(It&&K==dt-1)});Me.length=0,this.h.g+=R,this.C=0,en=this.h.g}else en=this.g.oa();if(this.o=ue==200,Ta(this.i,this.u,this.A,this.l,this.R,Ps,ue),this.o){if(this.T&&!this.K){t:{if(this.g){var ii,ps=this.g;if((ii=ps.g?ps.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Y(ii)){var Ur=ii;break t}}Ur=null}if(ue=Ur)po(this.i,this.l,ue,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,lr(this,ue);else{this.o=!1,this.s=3,jr(12),An(this),ar(this);break e}}if(this.P){ue=!0;let as;for(;!this.J&&this.C<en.length;)if(as=vt(this,en),as==rt){Ps==4&&(this.s=4,jr(14),ue=!1),po(this.i,this.l,null,"[Incomplete Response]");break}else if(as==Ge){this.s=4,jr(15),po(this.i,this.l,en,"[Invalid Chunk]"),ue=!1;break}else po(this.i,this.l,as,null),lr(this,as);if(yt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ps!=4||en.length!=0||this.h.h||(this.s=1,jr(16),ue=!1),this.o=this.o&&ue,!ue)po(this.i,this.l,en,"[Invalid Chunked Response]"),An(this),ar(this);else if(0<en.length&&!this.W){this.W=!0;var As=this.j;As.g==this&&As.ba&&!As.M&&(As.j.info("Great, no buffering proxy detected. Bytes received: "+en.length),fs(As),As.M=!0,jr(11))}}else po(this.i,this.l,en,null),lr(this,en);Ps==4&&An(this),this.o&&!this.J&&(Ps==4?fg(this.j,this):(this.o=!1,Wt(this)))}else eh(this.g),ue==400&&0<en.indexOf("Unknown SID")?(this.s=3,jr(12)):(this.s=0,jr(13)),An(this),ar(this)}}}catch{}finally{}};function yt(R){return R.g?R.u=="GET"&&R.L!=2&&R.j.Ca:!1}function vt(R,K){var ue=R.C,Me=K.indexOf(`
`,ue);return Me==-1?rt:(ue=Number(K.substring(ue,Me)),isNaN(ue)?Ge:(Me+=1,Me+ue>K.length?rt:(K=K.slice(Me,Me+ue),R.C=Me+ue,K)))}Oe.prototype.cancel=function(){this.J=!0,An(this)};function Wt(R){R.S=Date.now()+R.I,pn(R,R.I)}function pn(R,K){if(R.B!=null)throw Error("WatchDog timer not null");R.B=ni(F(R.ba,R),K)}function wn(R){R.B&&(x.clearTimeout(R.B),R.B=null)}Oe.prototype.ba=function(){this.B=null;const R=Date.now();0<=R-this.S?(Fi(this.i,this.A),this.L!=2&&($s(),jr(17)),An(this),this.s=2,ar(this)):pn(this,this.S-R)};function ar(R){R.j.G==0||R.J||fg(R.j,R)}function An(R){wn(R);var K=R.M;K&&typeof K.ma=="function"&&K.ma(),R.M=null,Tn(R.U),R.g&&(K=R.g,R.g=null,K.abort(),K.ma())}function lr(R,K){try{var ue=R.j;if(ue.G!=0&&(ue.g==R||pi(ue.h,R))){if(!R.K&&pi(ue.h,R)&&ue.G==3){try{var Me=ue.Da.g.parse(K)}catch{Me=null}if(Array.isArray(Me)&&Me.length==3){var dt=Me;if(dt[0]==0){e:if(!ue.u){if(ue.g)if(ue.g.F+3e3<R.F)ra(ue),ac(ue);else break e;zs(ue),jr(18)}}else ue.za=dt[1],0<ue.za-ue.T&&37500>dt[2]&&ue.F&&ue.v==0&&!ue.C&&(ue.C=ni(F(ue.Za,ue),6e3));if(1>=cr(ue.h)&&ue.ca){try{ue.ca()}catch{}ue.ca=void 0}}else Fo(ue,11)}else if((R.K||ue.g==R)&&ra(ue),!Y(K))for(dt=ue.Da.g.parse(K),K=0;K<dt.length;K++){let Ur=dt[K];if(ue.T=Ur[0],Ur=Ur[1],ue.G==2)if(Ur[0]=="c"){ue.K=Ur[1],ue.ia=Ur[2];const As=Ur[3];As!=null&&(ue.la=As,ue.j.info("VER="+ue.la));const Ps=Ur[4];Ps!=null&&(ue.Aa=Ps,ue.j.info("SVER="+ue.Aa));const uc=Ur[5];uc!=null&&typeof uc=="number"&&0<uc&&(Me=1.5*uc,ue.L=Me,ue.j.info("backChannelRequestTimeoutMs_="+Me)),Me=ue;const as=R.g;if(as){const hc=as.g?as.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hc){var It=Me.h;It.g||hc.indexOf("spdy")==-1&&hc.indexOf("quic")==-1&&hc.indexOf("h2")==-1||(It.j=It.l,It.g=new Set,It.h&&(mi(It,It.h),It.h=null))}if(Me.D){const md=as.g?as.g.getResponseHeader("X-HTTP-Session-Id"):null;md&&(Me.ya=md,oi(Me.I,Me.D,md))}}ue.G=3,ue.l&&ue.l.ua(),ue.ba&&(ue.R=Date.now()-R.F,ue.j.info("Handshake RTT: "+ue.R+"ms")),Me=ue;var en=R;if(Me.qa=pd(Me,Me.J?Me.ia:null,Me.W),en.K){Gi(Me.h,en);var ii=en,ps=Me.L;ps&&(ii.I=ps),ii.B&&(wn(ii),Wt(ii)),Me.g=en}else Cs(Me);0<ue.i.length&&Ea(ue)}else Ur[0]!="stop"&&Ur[0]!="close"||Fo(ue,7);else ue.G==3&&(Ur[0]=="stop"||Ur[0]=="close"?Ur[0]=="stop"?Fo(ue,7):fd(ue):Ur[0]!="noop"&&ue.l&&ue.l.ta(Ur),ue.v=0)}}$s(4)}catch{}}var ln=class{constructor(R,K){this.g=R,this.map=K}};function Zr(R){this.l=R||10,x.PerformanceNavigationTiming?(R=x.performance.getEntriesByType("navigation"),R=0<R.length&&(R[0].nextHopProtocol=="hq"||R[0].nextHopProtocol=="h2")):R=!!(x.chrome&&x.chrome.loadTimes&&x.chrome.loadTimes()&&x.chrome.loadTimes().wasFetchedViaSpdy),this.j=R?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function _r(R){return R.h?!0:R.g?R.g.size>=R.j:!1}function cr(R){return R.h?1:R.g?R.g.size:0}function pi(R,K){return R.h?R.h==K:R.g?R.g.has(K):!1}function mi(R,K){R.g?R.g.add(K):R.h=K}function Gi(R,K){R.h&&R.h==K?R.h=null:R.g&&R.g.has(K)&&R.g.delete(K)}Zr.prototype.cancel=function(){if(this.i=Ss(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const R of this.g.values())R.cancel();this.g.clear()}};function Ss(R){if(R.h!=null)return R.i.concat(R.h.D);if(R.g!=null&&R.g.size!==0){let K=R.i;for(const ue of R.g.values())K=K.concat(ue.D);return K}return re(R.i)}function qs(R){if(R.V&&typeof R.V=="function")return R.V();if(typeof Map<"u"&&R instanceof Map||typeof Set<"u"&&R instanceof Set)return Array.from(R.values());if(typeof R=="string")return R.split("");if(a(R)){for(var K=[],ue=R.length,Me=0;Me<ue;Me++)K.push(R[Me]);return K}K=[],ue=0;for(Me in R)K[ue++]=R[Me];return K}function tc(R){if(R.na&&typeof R.na=="function")return R.na();if(!R.V||typeof R.V!="function"){if(typeof Map<"u"&&R instanceof Map)return Array.from(R.keys());if(!(typeof Set<"u"&&R instanceof Set)){if(a(R)||typeof R=="string"){var K=[];R=R.length;for(var ue=0;ue<R;ue++)K.push(ue);return K}K=[],ue=0;for(const Me in R)K[ue++]=Me;return K}}}function ad(R,K){if(R.forEach&&typeof R.forEach=="function")R.forEach(K,void 0);else if(a(R)||typeof R=="string")Array.prototype.forEach.call(R,K,void 0);else for(var ue=tc(R),Me=qs(R),dt=Me.length,It=0;It<dt;It++)K.call(void 0,Me[It],ue&&ue[It],R)}var ld=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ku(R,K){if(R){R=R.split("&");for(var ue=0;ue<R.length;ue++){var Me=R[ue].indexOf("="),dt=null;if(0<=Me){var It=R[ue].substring(0,Me);dt=R[ue].substring(Me+1)}else It=R[ue];K(It,dt?decodeURIComponent(dt.replace(/\+/g," ")):"")}}}function Mn(R){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,R instanceof Mn){this.h=R.h,ea(this,R.j),this.o=R.o,this.g=R.g,Gc(this,R.s),this.l=R.l;var K=R.i,ue=new Zc;ue.i=K.i,K.g&&(ue.g=new Map(K.g),ue.h=K.h),cd(this,ue),this.m=R.m}else R&&(K=String(R).match(ld))?(this.h=!1,ea(this,K[1]||"",!0),this.o=nc(K[2]||""),this.g=nc(K[3]||"",!0),Gc(this,K[4]),this.l=nc(K[5]||"",!0),cd(this,K[6]||"",!0),this.m=nc(K[7]||"")):(this.h=!1,this.i=new Zc(null,this.h))}Mn.prototype.toString=function(){var R=[],K=this.j;K&&R.push(rc(K,Hc,!0),":");var ue=this.g;return(ue||K=="file")&&(R.push("//"),(K=this.o)&&R.push(rc(K,Hc,!0),"@"),R.push(encodeURIComponent(String(ue)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ue=this.s,ue!=null&&R.push(":",String(ue))),(ue=this.l)&&(this.g&&ue.charAt(0)!="/"&&R.push("/"),R.push(rc(ue,ue.charAt(0)=="/"?ud:Qu,!0))),(ue=this.i.toString())&&R.push("?",ue),(ue=this.m)&&R.push("#",rc(ue,lg)),R.join("")};function zo(R){return new Mn(R)}function ea(R,K,ue){R.j=ue?nc(K,!0):K,R.j&&(R.j=R.j.replace(/:$/,""))}function Gc(R,K){if(K){if(K=Number(K),isNaN(K)||0>K)throw Error("Bad port number "+K);R.s=K}else R.s=null}function cd(R,K,ue){K instanceof Zc?(R.i=K,hg(R.i,R.h)):(ue||(K=rc(K,hd)),R.i=new Zc(K,R.h))}function oi(R,K,ue){R.i.set(K,ue)}function Wc(R){return oi(R,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),R}function nc(R,K){return R?K?decodeURI(R.replace(/%25/g,"%2525")):decodeURIComponent(R):""}function rc(R,K,ue){return typeof R=="string"?(R=encodeURI(R).replace(K,ep),ue&&(R=R.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R):null}function ep(R){return R=R.charCodeAt(0),"%"+(R>>4&15).toString(16)+(R&15).toString(16)}var Hc=/[#\/\?@]/g,Qu=/[#\?:]/g,ud=/[#\?]/g,hd=/[#\?@]/g,lg=/#/g;function Zc(R,K){this.h=this.g=null,this.i=R||null,this.j=!!K}function Eo(R){R.g||(R.g=new Map,R.h=0,R.i&&Ku(R.i,function(K,ue){R.add(decodeURIComponent(K.replace(/\+/g," ")),ue)}))}e=Zc.prototype,e.add=function(R,K){Eo(this),this.i=null,R=Xc(this,R);var ue=this.g.get(R);return ue||this.g.set(R,ue=[]),ue.push(K),this.h+=1,this};function ur(R,K){Eo(R),K=Xc(R,K),R.g.has(K)&&(R.i=null,R.h-=R.g.get(K).length,R.g.delete(K))}function cg(R,K){return Eo(R),K=Xc(R,K),R.g.has(K)}e.forEach=function(R,K){Eo(this),this.g.forEach(function(ue,Me){ue.forEach(function(dt){R.call(K,dt,Me,this)},this)},this)},e.na=function(){Eo(this);const R=Array.from(this.g.values()),K=Array.from(this.g.keys()),ue=[];for(let Me=0;Me<K.length;Me++){const dt=R[Me];for(let It=0;It<dt.length;It++)ue.push(K[Me])}return ue},e.V=function(R){Eo(this);let K=[];if(typeof R=="string")cg(this,R)&&(K=K.concat(this.g.get(Xc(this,R))));else{R=Array.from(this.g.values());for(let ue=0;ue<R.length;ue++)K=K.concat(R[ue])}return K},e.set=function(R,K){return Eo(this),this.i=null,R=Xc(this,R),cg(this,R)&&(this.h-=this.g.get(R).length),this.g.set(R,[K]),this.h+=1,this},e.get=function(R,K){return R?(R=this.V(R),0<R.length?String(R[0]):K):K};function ug(R,K,ue){ur(R,K),0<ue.length&&(R.i=null,R.g.set(Xc(R,K),re(ue)),R.h+=ue.length)}e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const R=[],K=Array.from(this.g.keys());for(var ue=0;ue<K.length;ue++){var Me=K[ue];const It=encodeURIComponent(String(Me)),en=this.V(Me);for(Me=0;Me<en.length;Me++){var dt=It;en[Me]!==""&&(dt+="="+encodeURIComponent(String(en[Me]))),R.push(dt)}}return this.i=R.join("&")};function Xc(R,K){return K=String(K),R.j&&(K=K.toLowerCase()),K}function hg(R,K){K&&!R.j&&(Eo(R),R.i=null,R.g.forEach(function(ue,Me){var dt=Me.toLowerCase();Me!=dt&&(ur(this,Me),ug(this,dt,ue))},R)),R.j=K}function u0(R,K){const ue=new xi;if(x.Image){const Me=new Image;Me.onload=Z(No,ue,"TestLoadImage: loaded",!0,K,Me),Me.onerror=Z(No,ue,"TestLoadImage: error",!1,K,Me),Me.onabort=Z(No,ue,"TestLoadImage: abort",!1,K,Me),Me.ontimeout=Z(No,ue,"TestLoadImage: timeout",!1,K,Me),x.setTimeout(function(){Me.ontimeout&&Me.ontimeout()},1e4),Me.src=R}else K(!1)}function tp(R,K){const ue=new xi,Me=new AbortController,dt=setTimeout(()=>{Me.abort(),No(ue,"TestPingServer: timeout",!1,K)},1e4);fetch(R,{signal:Me.signal}).then(It=>{clearTimeout(dt),It.ok?No(ue,"TestPingServer: ok",!0,K):No(ue,"TestPingServer: server error",!1,K)}).catch(()=>{clearTimeout(dt),No(ue,"TestPingServer: error",!1,K)})}function No(R,K,ue,Me,dt){try{dt&&(dt.onload=null,dt.onerror=null,dt.onabort=null,dt.ontimeout=null),Me(ue)}catch{}}function So(){this.g=new Js}function dg(R,K,ue){const Me=ue||"";try{ad(R,function(dt,It){let en=dt;I(dt)&&(en=or(dt)),K.push(Me+It+"="+encodeURIComponent(en))})}catch(dt){throw K.push(Me+"type="+encodeURIComponent("_badmap")),dt}}function Kc(R){this.l=R.Ub||null,this.j=R.eb||!1}J(Kc,Ai),Kc.prototype.g=function(){return new Qc(this.l,this.j)},Kc.prototype.i=function(R){return function(){return R}}({});function Qc(R,K){qt.call(this),this.D=R,this.o=K,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}J(Qc,qt),e=Qc.prototype,e.open=function(R,K){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=R,this.A=K,this.readyState=1,Lt(this)},e.send=function(R){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const K={headers:this.u,method:this.B,credentials:this.m,cache:void 0};R&&(K.body=R),(this.D||x).fetch(new Request(this.A,K)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ta(this)),this.readyState=0},e.Sa=function(R){if(this.g&&(this.l=R,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=R.headers,this.readyState=2,Lt(this)),this.g&&(this.readyState=3,Lt(this),this.g)))if(this.responseType==="arraybuffer")R.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof x.ReadableStream<"u"&&"body"in R){if(this.j=R.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Yc(this)}else R.text().then(this.Ra.bind(this),this.ga.bind(this))};function Yc(R){R.j.read().then(R.Pa.bind(R)).catch(R.ga.bind(R))}e.Pa=function(R){if(this.g){if(this.o&&R.value)this.response.push(R.value);else if(!this.o){var K=R.value?R.value:new Uint8Array(0);(K=this.v.decode(K,{stream:!R.done}))&&(this.response=this.responseText+=K)}R.done?ta(this):Lt(this),this.readyState==3&&Yc(this)}},e.Ra=function(R){this.g&&(this.response=this.responseText=R,ta(this))},e.Qa=function(R){this.g&&(this.response=R,ta(this))},e.ga=function(){this.g&&ta(this)};function ta(R){R.readyState=4,R.l=null,R.j=null,R.v=null,Lt(R)}e.setRequestHeader=function(R,K){this.u.append(R,K)},e.getResponseHeader=function(R){return this.h&&this.h.get(R.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const R=[],K=this.h.entries();for(var ue=K.next();!ue.done;)ue=ue.value,R.push(ue[0]+": "+ue[1]),ue=K.next();return R.join(`\r
`)};function Lt(R){R.onreadystatechange&&R.onreadystatechange.call(R)}Object.defineProperty(Qc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(R){this.m=R?"include":"same-origin"}});function ic(R){let K="";return we(R,function(ue,Me){K+=Me,K+=":",K+=ue,K+=`\r
`}),K}function dd(R,K,ue){e:{for(Me in ue){var Me=!1;break e}Me=!0}Me||(ue=ic(ue),typeof R=="string"?ue!=null&&encodeURIComponent(String(ue)):oi(R,K,ue))}function ai(R){qt.call(this),this.headers=new Map,this.o=R||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}J(ai,qt);var er=/^https?$/i,eo=["POST","PUT"];e=ai.prototype,e.Ha=function(R){this.J=R},e.ea=function(R,K,ue,Me){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+R);K=K?K.toUpperCase():"GET",this.D=R,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():le.g(),this.v=this.o?fo(this.o):fo(le),this.g.onreadystatechange=F(this.Ea,this);try{this.B=!0,this.g.open(K,String(R),!0),this.B=!1}catch(It){Jc(this,It);return}if(R=ue||"",ue=new Map(this.headers),Me)if(Object.getPrototypeOf(Me)===Object.prototype)for(var dt in Me)ue.set(dt,Me[dt]);else if(typeof Me.keys=="function"&&typeof Me.get=="function")for(const It of Me.keys())ue.set(It,Me.get(It));else throw Error("Unknown input type for opt_headers: "+String(Me));Me=Array.from(ue.keys()).find(It=>It.toLowerCase()=="content-type"),dt=x.FormData&&R instanceof x.FormData,!(0<=Array.prototype.indexOf.call(eo,K,void 0))||Me||dt||ue.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[It,en]of ue)this.g.setRequestHeader(It,en);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Wn(this),this.u=!0,this.g.send(R),this.u=!1}catch(It){Jc(this,It)}};function Jc(R,K){R.h=!1,R.g&&(R.j=!0,R.g.abort(),R.j=!1),R.l=K,R.m=5,Yu(R),mo(R)}function Yu(R){R.A||(R.A=!0,mn(R,"complete"),mn(R,"error"))}e.abort=function(R){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=R||7,mn(this,"complete"),mn(this,"abort"),mo(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),mo(this,!0)),ai.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Ju(this):this.bb())},e.bb=function(){Ju(this)};function Ju(R){if(R.h&&typeof _<"u"&&(!R.v[1]||na(R)!=4||R.Z()!=2)){if(R.u&&na(R)==4)fr(R.Ea,0,R);else if(mn(R,"readystatechange"),na(R)==4){R.h=!1;try{const en=R.Z();e:switch(en){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var K=!0;break e;default:K=!1}var ue;if(!(ue=K)){var Me;if(Me=en===0){var dt=String(R.D).match(ld)[1]||null;!dt&&x.self&&x.self.location&&(dt=x.self.location.protocol.slice(0,-1)),Me=!er.test(dt?dt.toLowerCase():"")}ue=Me}if(ue)mn(R,"complete"),mn(R,"success");else{R.m=6;try{var It=2<na(R)?R.g.statusText:""}catch{It=""}R.l=It+" ["+R.Z()+"]",Yu(R)}}finally{mo(R)}}}}function mo(R,K){if(R.g){Wn(R);const ue=R.g,Me=R.v[0]?()=>{}:null;R.g=null,R.v=null,K||mn(R,"ready");try{ue.onreadystatechange=Me}catch{}}}function Wn(R){R.I&&(x.clearTimeout(R.I),R.I=null)}e.isActive=function(){return!!this.g};function na(R){return R.g?R.g.readyState:0}e.Z=function(){try{return 2<na(this)?this.g.status:-1}catch{return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},e.Oa=function(R){if(this.g){var K=this.g.responseText;return R&&K.indexOf(R)==0&&(K=K.substring(R.length)),dn(K)}};function sc(R){try{if(!R.g)return null;if("response"in R.g)return R.g.response;switch(R.H){case"":case"text":return R.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in R.g)return R.g.mozResponseArrayBuffer}return null}catch{return null}}function eh(R){const K={};R=(R.g&&2<=na(R)&&R.g.getAllResponseHeaders()||"").split(`\r
`);for(let Me=0;Me<R.length;Me++){if(Y(R[Me]))continue;var ue=be(R[Me]);const dt=ue[0];if(ue=ue[1],typeof ue!="string")continue;ue=ue.trim();const It=K[dt]||[];K[dt]=It,It.push(ue)}oe(K,function(Me){return Me.join(", ")})}e.Ba=function(){return this.m},e.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function oc(R,K,ue){return ue&&ue.internalChannelParams&&ue.internalChannelParams[R]||K}function Is(R){this.Aa=0,this.i=[],this.j=new xi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=oc("failFast",!1,R),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=oc("baseRetryDelayMs",5e3,R),this.cb=oc("retryDelaySeedMs",1e4,R),this.Wa=oc("forwardChannelMaxRetries",2,R),this.wa=oc("forwardChannelRequestTimeoutMs",2e4,R),this.pa=R&&R.xmlHttpFactory||void 0,this.Xa=R&&R.Tb||void 0,this.Ca=R&&R.useFetchStreams||!1,this.L=void 0,this.J=R&&R.supportsCrossDomainXhr||!1,this.K="",this.h=new Zr(R&&R.concurrentRequestLimit),this.Da=new So,this.P=R&&R.fastHandshake||!1,this.O=R&&R.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=R&&R.Rb||!1,R&&R.xa&&this.j.xa(),R&&R.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&R&&R.detectBufferingProxy||!1,this.ja=void 0,R&&R.longPollingTimeout&&0<R.longPollingTimeout&&(this.ja=R.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}e=Is.prototype,e.la=8,e.G=1,e.connect=function(R,K,ue,Me){jr(0),this.W=R,this.H=K||{},ue&&Me!==void 0&&(this.H.OSID=ue,this.H.OAID=Me),this.F=this.X,this.I=pd(this,null,this.W),Ea(this)};function fd(R){if(lc(R),R.G==3){var K=R.U++,ue=zo(R.I);if(oi(ue,"SID",R.K),oi(ue,"RID",K),oi(ue,"TYPE","terminate"),Ha(R,ue),K=new Oe(R,R.j,K),K.L=2,K.v=Wc(zo(ue)),ue=!1,x.navigator&&x.navigator.sendBeacon)try{ue=x.navigator.sendBeacon(K.v.toString(),"")}catch{}!ue&&x.Image&&(new Image().src=K.v,ue=!0),ue||(K.g=nu(K.j,null),K.g.ea(K.v)),K.F=Date.now(),Wt(K)}tu(R)}function ac(R){R.g&&(fs(R),R.g.cancel(),R.g=null)}function lc(R){ac(R),R.u&&(x.clearTimeout(R.u),R.u=null),ra(R),R.h.cancel(),R.s&&(typeof R.s=="number"&&x.clearTimeout(R.s),R.s=null)}function Ea(R){if(!_r(R.h)&&!R.s){R.s=!0;var K=R.Ga;kt||Yt(),ft||(kt(),ft=!0),Rt.add(K,R),R.B=0}}function np(R,K){return cr(R.h)>=R.h.j-(R.s?1:0)?!1:R.s?(R.i=K.D.concat(R.i),!0):R.G==1||R.G==2||R.B>=(R.Va?0:R.Wa)?!1:(R.s=ni(F(R.Ga,R,K),cc(R,R.B)),R.B++,!0)}e.Ga=function(R){if(this.s)if(this.s=null,this.G==1){if(!R){this.U=Math.floor(1e5*Math.random()),R=this.U++;const dt=new Oe(this,this.j,R);let It=this.o;if(this.S&&(It?(It=he(It),ge(It,this.S)):It=this.S),this.m!==null||this.O||(dt.H=It,It=null),this.P)e:{for(var K=0,ue=0;ue<this.i.length;ue++){t:{var Me=this.i[ue];if("__data__"in Me.map&&(Me=Me.map.__data__,typeof Me=="string")){Me=Me.length;break t}Me=void 0}if(Me===void 0)break;if(K+=Me,4096<K){K=ue;break e}if(K===4096||ue===this.i.length-1){K=ue+1;break e}}K=1e3}else K=1e3;K=eu(this,dt,K),ue=zo(this.I),oi(ue,"RID",R),oi(ue,"CVER",22),this.D&&oi(ue,"X-HTTP-Session-Id",this.D),Ha(this,ue),It&&(this.O?K="headers="+encodeURIComponent(String(ic(It)))+"&"+K:this.m&&dd(ue,this.m,It)),mi(this.h,dt),this.Ua&&oi(ue,"TYPE","init"),this.P?(oi(ue,"$req",K),oi(ue,"SID","null"),dt.T=!0,qe(dt,ue,null)):qe(dt,ue,K),this.G=2}}else this.G==3&&(R?th(this,R):this.i.length==0||_r(this.h)||th(this))};function th(R,K){var ue;K?ue=K.l:ue=R.U++;const Me=zo(R.I);oi(Me,"SID",R.K),oi(Me,"RID",ue),oi(Me,"AID",R.T),Ha(R,Me),R.m&&R.o&&dd(Me,R.m,R.o),ue=new Oe(R,R.j,ue,R.B+1),R.m===null&&(ue.H=R.o),K&&(R.i=K.D.concat(R.i)),K=eu(R,ue,1e3),ue.I=Math.round(.5*R.wa)+Math.round(.5*R.wa*Math.random()),mi(R.h,ue),qe(ue,Me,K)}function Ha(R,K){R.H&&we(R.H,function(ue,Me){oi(K,Me,ue)}),R.l&&ad({},function(ue,Me){oi(K,Me,ue)})}function eu(R,K,ue){ue=Math.min(R.i.length,ue);var Me=R.l?F(R.l.Na,R.l,R):null;e:{var dt=R.i;let It=-1;for(;;){const en=["count="+ue];It==-1?0<ue?(It=dt[0].g,en.push("ofs="+It)):It=0:en.push("ofs="+It);let ii=!0;for(let ps=0;ps<ue;ps++){let Ur=dt[ps].g;const As=dt[ps].map;if(Ur-=It,0>Ur)It=Math.max(0,dt[ps].g-100),ii=!1;else try{dg(As,en,"req"+Ur+"_")}catch{Me&&Me(As)}}if(ii){Me=en.join("&");break e}}}return R=R.i.splice(0,ue),K.D=R,Me}function Cs(R){if(!R.g&&!R.u){R.Y=1;var K=R.Fa;kt||Yt(),ft||(kt(),ft=!0),Rt.add(K,R),R.v=0}}function zs(R){return R.g||R.u||3<=R.v?!1:(R.Y++,R.u=ni(F(R.Fa,R),cc(R,R.v)),R.v++,!0)}e.Fa=function(){if(this.u=null,bi(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var R=2*this.R;this.j.info("BP detection timer enabled: "+R),this.A=ni(F(this.ab,this),R)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,jr(10),ac(this),bi(this))};function fs(R){R.A!=null&&(x.clearTimeout(R.A),R.A=null)}function bi(R){R.g=new Oe(R,R.j,"rpc",R.Y),R.m===null&&(R.g.H=R.o),R.g.O=0;var K=zo(R.qa);oi(K,"RID","rpc"),oi(K,"SID",R.K),oi(K,"AID",R.T),oi(K,"CI",R.F?"0":"1"),!R.F&&R.ja&&oi(K,"TO",R.ja),oi(K,"TYPE","xmlhttp"),Ha(R,K),R.m&&R.o&&dd(K,R.m,R.o),R.L&&(R.g.I=R.L);var ue=R.g;R=R.ia,ue.L=1,ue.v=Wc(zo(K)),ue.m=null,ue.P=!0,tt(ue,R)}e.Za=function(){this.C!=null&&(this.C=null,ac(this),zs(this),jr(19))};function ra(R){R.C!=null&&(x.clearTimeout(R.C),R.C=null)}function fg(R,K){var ue=null;if(R.g==K){ra(R),fs(R),R.g=null;var Me=2}else if(pi(R.h,K))ue=K.D,Gi(R.h,K),Me=1;else return;if(R.G!=0){if(K.o)if(Me==1){ue=K.m?K.m.length:0,K=Date.now()-K.F;var dt=R.B;Me=Es(),mn(Me,new Wa(Me,ue)),Ea(R)}else Cs(R);else if(dt=K.s,dt==3||dt==0&&0<K.X||!(Me==1&&np(R,K)||Me==2&&zs(R)))switch(ue&&0<ue.length&&(K=R.h,K.i=K.i.concat(ue)),dt){case 1:Fo(R,5);break;case 4:Fo(R,10);break;case 3:Fo(R,6);break;default:Fo(R,2)}}}function cc(R,K){let ue=R.Ta+Math.floor(Math.random()*R.cb);return R.isActive()||(ue*=2),ue*K}function Fo(R,K){if(R.j.info("Error code "+K),K==2){var ue=F(R.fb,R),Me=R.Xa;const dt=!Me;Me=new Mn(Me||"//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||ea(Me,"https"),Wc(Me),dt?u0(Me.toString(),ue):tp(Me.toString(),ue)}else jr(2);R.G=0,R.l&&R.l.sa(K),tu(R),lc(R)}e.fb=function(R){R?(this.j.info("Successfully pinged google.com"),jr(2)):(this.j.info("Failed to ping google.com"),jr(1))};function tu(R){if(R.G=0,R.ka=[],R.l){const K=Ss(R.h);(K.length!=0||R.i.length!=0)&&(ne(R.ka,K),ne(R.ka,R.i),R.h.i.length=0,re(R.i),R.i.length=0),R.l.ra()}}function pd(R,K,ue){var Me=ue instanceof Mn?zo(ue):new Mn(ue);if(Me.g!="")K&&(Me.g=K+"."+Me.g),Gc(Me,Me.s);else{var dt=x.location;Me=dt.protocol,K=K?K+"."+dt.hostname:dt.hostname,dt=+dt.port;var It=new Mn(null);Me&&ea(It,Me),K&&(It.g=K),dt&&Gc(It,dt),ue&&(It.l=ue),Me=It}return ue=R.D,K=R.ya,ue&&K&&oi(Me,ue,K),oi(Me,"VER",R.la),Ha(R,Me),Me}function nu(R,K,ue){if(K&&!R.J)throw Error("Can't create secondary domain capable XhrIo object.");return K=R.Ca&&!R.pa?new ai(new Kc({eb:ue})):new ai(R.pa),K.Ha(R.J),K}e.isActive=function(){return!!this.l&&this.l.isActive(this)};function Za(){}e=Za.prototype,e.ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){};function El(){}El.prototype.g=function(R,K){return new os(R,K)};function os(R,K){qt.call(this),this.g=new Is(K),this.l=R,this.h=K&&K.messageUrlParams||null,R=K&&K.messageHeaders||null,K&&K.clientProtocolHeaderRequired&&(R?R["X-Client-Protocol"]="webchannel":R={"X-Client-Protocol":"webchannel"}),this.g.o=R,R=K&&K.initMessageHeaders||null,K&&K.messageContentType&&(R?R["X-WebChannel-Content-Type"]=K.messageContentType:R={"X-WebChannel-Content-Type":K.messageContentType}),K&&K.va&&(R?R["X-WebChannel-Client-Profile"]=K.va:R={"X-WebChannel-Client-Profile":K.va}),this.g.S=R,(R=K&&K.Sb)&&!Y(R)&&(this.g.m=R),this.v=K&&K.supportsCrossDomainXhr||!1,this.u=K&&K.sendRawJson||!1,(K=K&&K.httpSessionIdParam)&&!Y(K)&&(this.g.D=K,R=this.h,R!==null&&K in R&&(R=this.h,K in R&&delete R[K])),this.j=new Xa(this)}J(os,qt),os.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},os.prototype.close=function(){fd(this.g)},os.prototype.o=function(R){var K=this.g;if(typeof R=="string"){var ue={};ue.__data__=R,R=ue}else this.u&&(ue={},ue.__data__=or(R),R=ue);K.i.push(new ln(K.Ya++,R)),K.G==3&&Ea(K)},os.prototype.N=function(){this.g.l=null,delete this.j,fd(this.g),delete this.g,os.aa.N.call(this)};function ru(R){Jn.call(this),R.__headers__&&(this.headers=R.__headers__,this.statusCode=R.__status__,delete R.__headers__,delete R.__status__);var K=R.__sm__;if(K){e:{for(const ue in K){R=ue;break e}R=void 0}(this.i=R)&&(R=this.i,K=K!==null&&R in K?K[R]:void 0),this.data=K}else this.data=R}J(ru,Jn);function iu(){ti.call(this),this.status=1}J(iu,ti);function Xa(R){this.g=R}J(Xa,Za),Xa.prototype.ua=function(){mn(this.g,"a")},Xa.prototype.ta=function(R){mn(this.g,new ru(R))},Xa.prototype.sa=function(R){mn(this.g,new iu)},Xa.prototype.ra=function(){mn(this.g,"b")},El.prototype.createWebChannel=El.prototype.g,os.prototype.send=os.prototype.o,os.prototype.open=os.prototype.m,os.prototype.close=os.prototype.close,LG=function(){return new El},OG=function(){return Es()},DG=Mi,dk={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},je.NO_ERROR=0,je.TIMEOUT=8,je.HTTP_ERROR=6,bE=je,te.COMPLETE="complete",kG=te,wa.EventType=nn,nn.OPEN="a",nn.CLOSE="b",nn.ERROR="c",nn.MESSAGE="d",qt.prototype.listen=qt.prototype.K,s1=wa,MG=Kc,ai.prototype.listenOnce=ai.prototype.L,ai.prototype.getLastError=ai.prototype.Ka,ai.prototype.getLastErrorCode=ai.prototype.Ba,ai.prototype.getStatus=ai.prototype.Z,ai.prototype.getResponseJson=ai.prototype.Oa,ai.prototype.getResponseText=ai.prototype.oa,ai.prototype.send=ai.prototype.ea,ai.prototype.setWithCredentials=ai.prototype.Ha,RG=ai}).apply(typeof FT<"u"?FT:typeof self<"u"?self:typeof window<"u"?window:{});const Wj="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ho.UNAUTHENTICATED=new Ho(null),Ho.GOOGLE_CREDENTIALS=new Ho("google-credentials-uid"),Ho.FIRST_PARTY=new Ho("first-party-uid"),Ho.MOCK_USER=new Ho("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yy="10.13.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bm=new HD("@firebase/firestore");function Vv(){return Bm.logLevel}function Un(e,...t){if(Bm.logLevel<=Qr.DEBUG){const r=t.map(a5);Bm.debug(`Firestore (${Yy}): ${e}`,...r)}}function Zh(e,...t){if(Bm.logLevel<=Qr.ERROR){const r=t.map(a5);Bm.error(`Firestore (${Yy}): ${e}`,...r)}}function Iy(e,...t){if(Bm.logLevel<=Qr.WARN){const r=t.map(a5);Bm.warn(`Firestore (${Yy}): ${e}`,...r)}}function a5(e){if(typeof e=="string")return e;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(e)}catch{return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tr(e="Unexpected state"){const t=`FIRESTORE (${Yy}) INTERNAL ASSERTION FAILED: `+e;throw Zh(t),new Error(t)}function Ni(e,t){e||Tr()}function Ar(e,t){return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pn extends Wu{constructor(t,r){super(t,r),this.code=t,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bh{constructor(){this.promise=new Promise((t,r)=>{this.resolve=t,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zG{constructor(t,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Xhe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,r){t.enqueueRetryable(()=>r(Ho.UNAUTHENTICATED))}shutdown(){}}class Khe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,r){this.changeListener=r,t.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class Qhe{constructor(t){this.t=t,this.currentUser=Ho.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,r){let s=this.i;const c=a=>this.i!==s?(s=this.i,r(a)):Promise.resolve();let f=new Bh;this.o=()=>{this.i++,this.currentUser=this.u(),f.resolve(),f=new Bh,t.enqueueRetryable(()=>c(this.currentUser))};const _=()=>{const a=f;t.enqueueRetryable(async()=>{await a.promise,await c(this.currentUser)})},x=a=>{Un("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.auth.addAuthTokenListener(this.o),_()};this.t.onInit(a=>x(a)),setTimeout(()=>{if(!this.auth){const a=this.t.getImmediate({optional:!0});a?x(a):(Un("FirebaseAuthCredentialsProvider","Auth not yet detected"),f.resolve(),f=new Bh)}},0),_()}getToken(){const t=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(s=>this.i!==t?(Un("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Ni(typeof s.accessToken=="string"),new zG(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Ni(t===null||typeof t=="string"),new Ho(t)}}class Yhe{constructor(t,r,s){this.l=t,this.h=r,this.P=s,this.type="FirstParty",this.user=Ho.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Jhe{constructor(t,r,s){this.l=t,this.h=r,this.P=s}getToken(){return Promise.resolve(new Yhe(this.l,this.h,this.P))}start(t,r){t.enqueueRetryable(()=>r(Ho.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ede{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class tde{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,r){const s=f=>{f.error!=null&&Un("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${f.error.message}`);const _=f.token!==this.R;return this.R=f.token,Un("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?r(f.token):Promise.resolve()};this.o=f=>{t.enqueueRetryable(()=>s(f))};const c=f=>{Un("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=f,this.appCheck.addTokenListener(this.o)};this.A.onInit(f=>c(f)),setTimeout(()=>{if(!this.appCheck){const f=this.A.getImmediate({optional:!0});f?c(f):Un("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(r=>r?(Ni(typeof r.token=="string"),this.R=r.token,new ede(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nde(e){const t=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(r);else for(let s=0;s<e;s++)r[s]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NG{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/t.length)*t.length;let s="";for(;s.length<20;){const c=nde(40);for(let f=0;f<c.length;++f)s.length<20&&c[f]<r&&(s+=t.charAt(c[f]%t.length))}return s}}function si(e,t){return e<t?-1:e>t?1:0}function Cy(e,t,r){return e.length===t.length&&e.every((s,c)=>r(s,t[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(t,r){if(this.seconds=t,this.nanoseconds=r,r<0)throw new Pn(Zt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new Pn(Zt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(t<-62135596800)throw new Pn(Zt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Pn(Zt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ho.fromMillis(Date.now())}static fromDate(t){return ho.fromMillis(t.getTime())}static fromMillis(t){const r=Math.floor(t/1e3),s=Math.floor(1e6*(t-1e3*r));return new ho(r,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?si(this.nanoseconds,t.nanoseconds):si(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Cr(t)}static min(){return new Cr(new ho(0,0))}static max(){return new Cr(new ho(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(t,r,s){r===void 0?r=0:r>t.length&&Tr(),s===void 0?s=t.length-r:s>t.length-r&&Tr(),this.segments=t,this.offset=r,this.len=s}get length(){return this.len}isEqual(t){return _x.comparator(this,t)===0}child(t){const r=this.segments.slice(this.offset,this.limit());return t instanceof _x?t.forEach(s=>{r.push(s)}):r.push(t),this.construct(r)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==t.get(r))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==t.get(r))return!1;return!0}forEach(t){for(let r=this.offset,s=this.limit();r<s;r++)t(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,r){const s=Math.min(t.length,r.length);for(let c=0;c<s;c++){const f=t.get(c),_=r.get(c);if(f<_)return-1;if(f>_)return 1}return t.length<r.length?-1:t.length>r.length?1:0}}class Ji extends _x{construct(t,r,s){return new Ji(t,r,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const r=[];for(const s of t){if(s.indexOf("//")>=0)throw new Pn(Zt.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);r.push(...s.split("/").filter(c=>c.length>0))}return new Ji(r)}static emptyPath(){return new Ji([])}}const rde=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Po extends _x{construct(t,r,s){return new Po(t,r,s)}static isValidIdentifier(t){return rde.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Po.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Po(["__name__"])}static fromServerFormat(t){const r=[];let s="",c=0;const f=()=>{if(s.length===0)throw new Pn(Zt.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(s),s=""};let _=!1;for(;c<t.length;){const x=t[c];if(x==="\\"){if(c+1===t.length)throw new Pn(Zt.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const a=t[c+1];if(a!=="\\"&&a!=="."&&a!=="`")throw new Pn(Zt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);s+=a,c+=2}else x==="`"?(_=!_,c++):x!=="."||_?(s+=x,c++):(f(),c++)}if(f(),_)throw new Pn(Zt.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Po(r)}static emptyPath(){return new Po([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(t){this.path=t}static fromPath(t){return new nr(Ji.fromString(t))}static fromName(t){return new nr(Ji.fromString(t).popFirst(5))}static empty(){return new nr(Ji.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Ji.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,r){return Ji.comparator(t.path,r.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new nr(new Ji(t.slice()))}}function ide(e,t){const r=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,c=Cr.fromTimestamp(s===1e9?new ho(r+1,0):new ho(r,s));return new zf(c,nr.empty(),t)}function sde(e){return new zf(e.readTime,e.key,-1)}class zf{constructor(t,r,s){this.readTime=t,this.documentKey=r,this.largestBatchId=s}static min(){return new zf(Cr.min(),nr.empty(),-1)}static max(){return new zf(Cr.max(),nr.empty(),-1)}}function ode(e,t){let r=e.readTime.compareTo(t.readTime);return r!==0?r:(r=nr.comparator(e.documentKey,t.documentKey),r!==0?r:si(e.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ade="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class lde{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rb(e){if(e.code!==Zt.FAILED_PRECONDITION||e.message!==ade)throw e;Un("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(t){return this.next(void 0,t)}next(t,r){return this.callbackAttached&&Tr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(t,this.result):new tn((s,c)=>{this.nextCallback=f=>{this.wrapSuccess(t,f).next(s,c)},this.catchCallback=f=>{this.wrapFailure(r,f).next(s,c)}})}toPromise(){return new Promise((t,r)=>{this.next(t,r)})}wrapUserFunction(t){try{const r=t();return r instanceof tn?r:tn.resolve(r)}catch(r){return tn.reject(r)}}wrapSuccess(t,r){return t?this.wrapUserFunction(()=>t(r)):tn.resolve(r)}wrapFailure(t,r){return t?this.wrapUserFunction(()=>t(r)):tn.reject(r)}static resolve(t){return new tn((r,s)=>{r(t)})}static reject(t){return new tn((r,s)=>{s(t)})}static waitFor(t){return new tn((r,s)=>{let c=0,f=0,_=!1;t.forEach(x=>{++c,x.next(()=>{++f,_&&f===c&&r()},a=>s(a))}),_=!0,f===c&&r()})}static or(t){let r=tn.resolve(!1);for(const s of t)r=r.next(c=>c?tn.resolve(c):s());return r}static forEach(t,r){const s=[];return t.forEach((c,f)=>{s.push(r.call(this,c,f))}),this.waitFor(s)}static mapArray(t,r){return new tn((s,c)=>{const f=t.length,_=new Array(f);let x=0;for(let a=0;a<f;a++){const I=a;r(t[I]).next(D=>{_[I]=D,++x,x===f&&s(_)},D=>c(D))}})}static doWhile(t,r){return new tn((s,c)=>{const f=()=>{t()===!0?r().next(()=>{f()},c):s()};f()})}}function cde(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function ib(e){return e.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l5{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=s=>this.ie(s),this.se=s=>r.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}l5.oe=-1;function eC(e){return e==null}function SS(e){return e===0&&1/e==-1/0}function ude(e){return typeof e=="number"&&Number.isInteger(e)&&!SS(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hj(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function sg(e,t){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function FG(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(t,r){this.comparator=t,this.root=r||Co.EMPTY}insert(t,r){return new bs(this.comparator,this.root.insert(t,r,this.comparator).copy(null,null,Co.BLACK,null,null))}remove(t){return new bs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Co.BLACK,null,null))}get(t){let r=this.root;for(;!r.isEmpty();){const s=this.comparator(t,r.key);if(s===0)return r.value;s<0?r=r.left:s>0&&(r=r.right)}return null}indexOf(t){let r=0,s=this.root;for(;!s.isEmpty();){const c=this.comparator(t,s.key);if(c===0)return r+s.left.size;c<0?s=s.left:(r+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((r,s)=>(t(r,s),!1))}toString(){const t=[];return this.inorderTraversal((r,s)=>(t.push(`${r}:${s}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new BT(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new BT(this.root,t,this.comparator,!1)}getReverseIterator(){return new BT(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new BT(this.root,t,this.comparator,!0)}}class BT{constructor(t,r,s,c){this.isReverse=c,this.nodeStack=[];let f=1;for(;!t.isEmpty();)if(f=r?s(t.key,r):1,r&&c&&(f*=-1),f<0)t=this.isReverse?t.left:t.right;else{if(f===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const r={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Co{constructor(t,r,s,c,f){this.key=t,this.value=r,this.color=s??Co.RED,this.left=c??Co.EMPTY,this.right=f??Co.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,s,c,f){return new Co(t??this.key,r??this.value,s??this.color,c??this.left,f??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,s){let c=this;const f=s(t,c.key);return c=f<0?c.copy(null,null,null,c.left.insert(t,r,s),null):f===0?c.copy(null,r,null,null,null):c.copy(null,null,null,null,c.right.insert(t,r,s)),c.fixUp()}removeMin(){if(this.left.isEmpty())return Co.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let s,c=this;if(r(t,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(t,r),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),r(t,c.key)===0){if(c.right.isEmpty())return Co.EMPTY;s=c.right.min(),c=c.copy(s.key,s.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(t,r))}return c.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Co.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Co.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Tr();const t=this.left.check();if(t!==this.right.check())throw Tr();return t+(this.isRed()?0:1)}}Co.EMPTY=null,Co.RED=!0,Co.BLACK=!1;Co.EMPTY=new class{constructor(){this.size=0}get key(){throw Tr()}get value(){throw Tr()}get color(){throw Tr()}get left(){throw Tr()}get right(){throw Tr()}copy(t,r,s,c,f){return this}insert(t,r,s){return new Co(t,r)}remove(t,r){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(t){this.comparator=t,this.data=new bs(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((r,s)=>(t(r),!1))}forEachInRange(t,r){const s=this.data.getIteratorFrom(t[0]);for(;s.hasNext();){const c=s.getNext();if(this.comparator(c.key,t[1])>=0)return;r(c.key)}}forEachWhile(t,r){let s;for(s=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();s.hasNext();)if(!t(s.getNext().key))return}firstAfterOrEqual(t){const r=this.data.getIteratorFrom(t);return r.hasNext()?r.getNext().key:null}getIterator(){return new Zj(this.data.getIterator())}getIteratorFrom(t){return new Zj(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let r=this;return r.size<t.size&&(r=t,t=this),t.forEach(s=>{r=r.add(s)}),r}isEqual(t){if(!(t instanceof Mo)||this.size!==t.size)return!1;const r=this.data.getIterator(),s=t.data.getIterator();for(;r.hasNext();){const c=r.getNext().key,f=s.getNext().key;if(this.comparator(c,f)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(r=>{t.push(r)}),t}toString(){const t=[];return this.forEach(r=>t.push(r)),"SortedSet("+t.toString()+")"}copy(t){const r=new Mo(this.comparator);return r.data=t,r}}class Zj{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(t){this.fields=t,t.sort(Po.comparator)}static empty(){return new ll([])}unionWith(t){let r=new Mo(Po.comparator);for(const s of this.fields)r=r.add(s);for(const s of t)r=r.add(s);return new ll(r.toArray())}covers(t){for(const r of this.fields)if(r.isPrefixOf(t))return!0;return!1}isEqual(t){return Cy(this.fields,t.fields,(r,s)=>r.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BG extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(t){this.binaryString=t}static fromBase64String(t){const r=function(c){try{return atob(c)}catch(f){throw typeof DOMException<"u"&&f instanceof DOMException?new BG("Invalid base64 string: "+f):f}}(t);return new Do(r)}static fromUint8Array(t){const r=function(c){let f="";for(let _=0;_<c.length;++_)f+=String.fromCharCode(c[_]);return f}(t);return new Do(r)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const s=new Uint8Array(r.length);for(let c=0;c<r.length;c++)s[c]=r.charCodeAt(c);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return si(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Do.EMPTY_BYTE_STRING=new Do("");const hde=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nf(e){if(Ni(!!e),typeof e=="string"){let t=0;const r=hde.exec(e);if(Ni(!!r),r[1]){let c=r[1];c=(c+"000000000").substr(0,9),t=Number(c)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:js(e.seconds),nanos:js(e.nanos)}}function js(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function jm(e){return typeof e=="string"?Do.fromBase64String(e):Do.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c5(e){var t,r;return((r=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function u5(e){const t=e.mapValue.fields.__previous_value__;return c5(t)?u5(t):t}function yx(e){const t=Nf(e.mapValue.fields.__local_write_time__.timestampValue);return new ho(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dde{constructor(t,r,s,c,f,_,x,a,I){this.databaseId=t,this.appId=r,this.persistenceKey=s,this.host=c,this.ssl=f,this.forceLongPolling=_,this.autoDetectLongPolling=x,this.longPollingOptions=a,this.useFetchStreams=I}}class vx{constructor(t,r){this.projectId=t,this.database=r||"(default)"}static empty(){return new vx("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof vx&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jT={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Um(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?c5(e)?4:pde(e)?9007199254740991:fde(e)?10:11:Tr()}function Vu(e,t){if(e===t)return!0;const r=Um(e);if(r!==Um(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return yx(e).isEqual(yx(t));case 3:return function(c,f){if(typeof c.timestampValue=="string"&&typeof f.timestampValue=="string"&&c.timestampValue.length===f.timestampValue.length)return c.timestampValue===f.timestampValue;const _=Nf(c.timestampValue),x=Nf(f.timestampValue);return _.seconds===x.seconds&&_.nanos===x.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(c,f){return jm(c.bytesValue).isEqual(jm(f.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(c,f){return js(c.geoPointValue.latitude)===js(f.geoPointValue.latitude)&&js(c.geoPointValue.longitude)===js(f.geoPointValue.longitude)}(e,t);case 2:return function(c,f){if("integerValue"in c&&"integerValue"in f)return js(c.integerValue)===js(f.integerValue);if("doubleValue"in c&&"doubleValue"in f){const _=js(c.doubleValue),x=js(f.doubleValue);return _===x?SS(_)===SS(x):isNaN(_)&&isNaN(x)}return!1}(e,t);case 9:return Cy(e.arrayValue.values||[],t.arrayValue.values||[],Vu);case 10:case 11:return function(c,f){const _=c.mapValue.fields||{},x=f.mapValue.fields||{};if(Hj(_)!==Hj(x))return!1;for(const a in _)if(_.hasOwnProperty(a)&&(x[a]===void 0||!Vu(_[a],x[a])))return!1;return!0}(e,t);default:return Tr()}}function xx(e,t){return(e.values||[]).find(r=>Vu(r,t))!==void 0}function Ay(e,t){if(e===t)return 0;const r=Um(e),s=Um(t);if(r!==s)return si(r,s);switch(r){case 0:case 9007199254740991:return 0;case 1:return si(e.booleanValue,t.booleanValue);case 2:return function(f,_){const x=js(f.integerValue||f.doubleValue),a=js(_.integerValue||_.doubleValue);return x<a?-1:x>a?1:x===a?0:isNaN(x)?isNaN(a)?0:-1:1}(e,t);case 3:return Xj(e.timestampValue,t.timestampValue);case 4:return Xj(yx(e),yx(t));case 5:return si(e.stringValue,t.stringValue);case 6:return function(f,_){const x=jm(f),a=jm(_);return x.compareTo(a)}(e.bytesValue,t.bytesValue);case 7:return function(f,_){const x=f.split("/"),a=_.split("/");for(let I=0;I<x.length&&I<a.length;I++){const D=si(x[I],a[I]);if(D!==0)return D}return si(x.length,a.length)}(e.referenceValue,t.referenceValue);case 8:return function(f,_){const x=si(js(f.latitude),js(_.latitude));return x!==0?x:si(js(f.longitude),js(_.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Kj(e.arrayValue,t.arrayValue);case 10:return function(f,_){var x,a,I,D;const O=f.fields||{},F=_.fields||{},Z=(x=O.value)===null||x===void 0?void 0:x.arrayValue,J=(a=F.value)===null||a===void 0?void 0:a.arrayValue,re=si(((I=Z==null?void 0:Z.values)===null||I===void 0?void 0:I.length)||0,((D=J==null?void 0:J.values)===null||D===void 0?void 0:D.length)||0);return re!==0?re:Kj(Z,J)}(e.mapValue,t.mapValue);case 11:return function(f,_){if(f===jT.mapValue&&_===jT.mapValue)return 0;if(f===jT.mapValue)return 1;if(_===jT.mapValue)return-1;const x=f.fields||{},a=Object.keys(x),I=_.fields||{},D=Object.keys(I);a.sort(),D.sort();for(let O=0;O<a.length&&O<D.length;++O){const F=si(a[O],D[O]);if(F!==0)return F;const Z=Ay(x[a[O]],I[D[O]]);if(Z!==0)return Z}return si(a.length,D.length)}(e.mapValue,t.mapValue);default:throw Tr()}}function Xj(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return si(e,t);const r=Nf(e),s=Nf(t),c=si(r.seconds,s.seconds);return c!==0?c:si(r.nanos,s.nanos)}function Kj(e,t){const r=e.values||[],s=t.values||[];for(let c=0;c<r.length&&c<s.length;++c){const f=Ay(r[c],s[c]);if(f)return f}return si(r.length,s.length)}function Py(e){return fk(e)}function fk(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(r){const s=Nf(r);return`time(${s.seconds},${s.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(r){return jm(r).toBase64()}(e.bytesValue):"referenceValue"in e?function(r){return nr.fromName(r).toString()}(e.referenceValue):"geoPointValue"in e?function(r){return`geo(${r.latitude},${r.longitude})`}(e.geoPointValue):"arrayValue"in e?function(r){let s="[",c=!0;for(const f of r.values||[])c?c=!1:s+=",",s+=fk(f);return s+"]"}(e.arrayValue):"mapValue"in e?function(r){const s=Object.keys(r.fields||{}).sort();let c="{",f=!0;for(const _ of s)f?f=!1:c+=",",c+=`${_}:${fk(r.fields[_])}`;return c+"}"}(e.mapValue):Tr()}function Qj(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function pk(e){return!!e&&"integerValue"in e}function h5(e){return!!e&&"arrayValue"in e}function Yj(e){return!!e&&"nullValue"in e}function Jj(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function wE(e){return!!e&&"mapValue"in e}function fde(e){var t,r;return((r=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function R1(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return sg(e.mapValue.fields,(r,s)=>t.mapValue.fields[r]=R1(s)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=R1(e.arrayValue.values[r]);return t}return Object.assign({},e)}function pde(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(t){this.value=t}static empty(){return new Na({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let r=this.value;for(let s=0;s<t.length-1;++s)if(r=(r.mapValue.fields||{})[t.get(s)],!wE(r))return null;return r=(r.mapValue.fields||{})[t.lastSegment()],r||null}}set(t,r){this.getFieldsMap(t.popLast())[t.lastSegment()]=R1(r)}setAll(t){let r=Po.emptyPath(),s={},c=[];t.forEach((_,x)=>{if(!r.isImmediateParentOf(x)){const a=this.getFieldsMap(r);this.applyChanges(a,s,c),s={},c=[],r=x.popLast()}_?s[x.lastSegment()]=R1(_):c.push(x.lastSegment())});const f=this.getFieldsMap(r);this.applyChanges(f,s,c)}delete(t){const r=this.field(t.popLast());wE(r)&&r.mapValue.fields&&delete r.mapValue.fields[t.lastSegment()]}isEqual(t){return Vu(this.value,t.value)}getFieldsMap(t){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let s=0;s<t.length;++s){let c=r.mapValue.fields[t.get(s)];wE(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},r.mapValue.fields[t.get(s)]=c),r=c}return r.mapValue.fields}applyChanges(t,r,s){sg(r,(c,f)=>t[c]=f);for(const c of s)delete t[c]}clone(){return new Na(R1(this.value))}}function jG(e){const t=[];return sg(e.fields,(r,s)=>{const c=new Po([r]);if(wE(s)){const f=jG(s.mapValue).fields;if(f.length===0)t.push(c);else for(const _ of f)t.push(c.child(_))}else t.push(c)}),new ll(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(t,r,s,c,f,_,x){this.key=t,this.documentType=r,this.version=s,this.readTime=c,this.createTime=f,this.data=_,this.documentState=x}static newInvalidDocument(t){return new Xo(t,0,Cr.min(),Cr.min(),Cr.min(),Na.empty(),0)}static newFoundDocument(t,r,s,c){return new Xo(t,1,r,Cr.min(),s,c,0)}static newNoDocument(t,r){return new Xo(t,2,r,Cr.min(),Cr.min(),Na.empty(),0)}static newUnknownDocument(t,r){return new Xo(t,3,r,Cr.min(),Cr.min(),Na.empty(),2)}convertToFoundDocument(t,r){return!this.createTime.isEqual(Cr.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Na.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Na.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Cr.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Xo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Xo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IS{constructor(t,r){this.position=t,this.inclusive=r}}function eU(e,t,r){let s=0;for(let c=0;c<e.position.length;c++){const f=t[c],_=e.position[c];if(f.field.isKeyField()?s=nr.comparator(nr.fromName(_.referenceValue),r.key):s=Ay(_,r.data.field(f.field)),f.dir==="desc"&&(s*=-1),s!==0)break}return s}function tU(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!Vu(e.position[r],t.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bx{constructor(t,r="asc"){this.field=t,this.dir=r}}function mde(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let UG=class{};class Ys extends UG{constructor(t,r,s){super(),this.field=t,this.op=r,this.value=s}static create(t,r,s){return t.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(t,r,s):new _de(t,r,s):r==="array-contains"?new xde(t,s):r==="in"?new bde(t,s):r==="not-in"?new wde(t,s):r==="array-contains-any"?new Tde(t,s):new Ys(t,r,s)}static createKeyFieldInFilter(t,r,s){return r==="in"?new yde(t,s):new vde(t,s)}matches(t){const r=t.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(Ay(r,this.value)):r!==null&&Um(this.value)===Um(r)&&this.matchesComparison(Ay(r,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Tr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $c extends UG{constructor(t,r){super(),this.filters=t,this.op=r,this.ae=null}static create(t,r){return new $c(t,r)}matches(t){return VG(this)?this.filters.find(r=>!r.matches(t))===void 0:this.filters.find(r=>r.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,r)=>t.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function VG(e){return e.op==="and"}function $G(e){return gde(e)&&VG(e)}function gde(e){for(const t of e.filters)if(t instanceof $c)return!1;return!0}function mk(e){if(e instanceof Ys)return e.field.canonicalString()+e.op.toString()+Py(e.value);if($G(e))return e.filters.map(t=>mk(t)).join(",");{const t=e.filters.map(r=>mk(r)).join(",");return`${e.op}(${t})`}}function qG(e,t){return e instanceof Ys?function(s,c){return c instanceof Ys&&s.op===c.op&&s.field.isEqual(c.field)&&Vu(s.value,c.value)}(e,t):e instanceof $c?function(s,c){return c instanceof $c&&s.op===c.op&&s.filters.length===c.filters.length?s.filters.reduce((f,_,x)=>f&&qG(_,c.filters[x]),!0):!1}(e,t):void Tr()}function GG(e){return e instanceof Ys?function(r){return`${r.field.canonicalString()} ${r.op} ${Py(r.value)}`}(e):e instanceof $c?function(r){return r.op.toString()+" {"+r.getFilters().map(GG).join(" ,")+"}"}(e):"Filter"}class _de extends Ys{constructor(t,r,s){super(t,r,s),this.key=nr.fromName(s.referenceValue)}matches(t){const r=nr.comparator(t.key,this.key);return this.matchesComparison(r)}}class yde extends Ys{constructor(t,r){super(t,"in",r),this.keys=WG("in",r)}matches(t){return this.keys.some(r=>r.isEqual(t.key))}}class vde extends Ys{constructor(t,r){super(t,"not-in",r),this.keys=WG("not-in",r)}matches(t){return!this.keys.some(r=>r.isEqual(t.key))}}function WG(e,t){var r;return(((r=t.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(s=>nr.fromName(s.referenceValue))}class xde extends Ys{constructor(t,r){super(t,"array-contains",r)}matches(t){const r=t.data.field(this.field);return h5(r)&&xx(r.arrayValue,this.value)}}class bde extends Ys{constructor(t,r){super(t,"in",r)}matches(t){const r=t.data.field(this.field);return r!==null&&xx(this.value.arrayValue,r)}}class wde extends Ys{constructor(t,r){super(t,"not-in",r)}matches(t){if(xx(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=t.data.field(this.field);return r!==null&&!xx(this.value.arrayValue,r)}}class Tde extends Ys{constructor(t,r){super(t,"array-contains-any",r)}matches(t){const r=t.data.field(this.field);return!(!h5(r)||!r.arrayValue.values)&&r.arrayValue.values.some(s=>xx(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ede{constructor(t,r=null,s=[],c=[],f=null,_=null,x=null){this.path=t,this.collectionGroup=r,this.orderBy=s,this.filters=c,this.limit=f,this.startAt=_,this.endAt=x,this.ue=null}}function nU(e,t=null,r=[],s=[],c=null,f=null,_=null){return new Ede(e,t,r,s,c,f,_)}function d5(e){const t=Ar(e);if(t.ue===null){let r=t.path.canonicalString();t.collectionGroup!==null&&(r+="|cg:"+t.collectionGroup),r+="|f:",r+=t.filters.map(s=>mk(s)).join(","),r+="|ob:",r+=t.orderBy.map(s=>function(f){return f.field.canonicalString()+f.dir}(s)).join(","),eC(t.limit)||(r+="|l:",r+=t.limit),t.startAt&&(r+="|lb:",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Py(s)).join(",")),t.endAt&&(r+="|ub:",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Py(s)).join(",")),t.ue=r}return t.ue}function f5(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!mde(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!qG(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!tU(e.startAt,t.startAt)&&tU(e.endAt,t.endAt)}function gk(e){return nr.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(t,r=null,s=[],c=[],f=null,_="F",x=null,a=null){this.path=t,this.collectionGroup=r,this.explicitOrderBy=s,this.filters=c,this.limit=f,this.limitType=_,this.startAt=x,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Sde(e,t,r,s,c,f,_,x){return new Jy(e,t,r,s,c,f,_,x)}function tC(e){return new Jy(e)}function rU(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function HG(e){return e.collectionGroup!==null}function M1(e){const t=Ar(e);if(t.ce===null){t.ce=[];const r=new Set;for(const f of t.explicitOrderBy)t.ce.push(f),r.add(f.field.canonicalString());const s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(_){let x=new Mo(Po.comparator);return _.filters.forEach(a=>{a.getFlattenedFilters().forEach(I=>{I.isInequality()&&(x=x.add(I.field))})}),x})(t).forEach(f=>{r.has(f.canonicalString())||f.isKeyField()||t.ce.push(new bx(f,s))}),r.has(Po.keyField().canonicalString())||t.ce.push(new bx(Po.keyField(),s))}return t.ce}function Fu(e){const t=Ar(e);return t.le||(t.le=Ide(t,M1(e))),t.le}function Ide(e,t){if(e.limitType==="F")return nU(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(c=>{const f=c.dir==="desc"?"asc":"desc";return new bx(c.field,f)});const r=e.endAt?new IS(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new IS(e.startAt.position,e.startAt.inclusive):null;return nU(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}}function _k(e,t){const r=e.filters.concat([t]);return new Jy(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function CS(e,t,r){return new Jy(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function nC(e,t){return f5(Fu(e),Fu(t))&&e.limitType===t.limitType}function ZG(e){return`${d5(Fu(e))}|lt:${e.limitType}`}function P_(e){return`Query(target=${function(r){let s=r.path.canonicalString();return r.collectionGroup!==null&&(s+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(s+=`, filters: [${r.filters.map(c=>GG(c)).join(", ")}]`),eC(r.limit)||(s+=", limit: "+r.limit),r.orderBy.length>0&&(s+=`, orderBy: [${r.orderBy.map(c=>function(_){return`${_.field.canonicalString()} (${_.dir})`}(c)).join(", ")}]`),r.startAt&&(s+=", startAt: ",s+=r.startAt.inclusive?"b:":"a:",s+=r.startAt.position.map(c=>Py(c)).join(",")),r.endAt&&(s+=", endAt: ",s+=r.endAt.inclusive?"a:":"b:",s+=r.endAt.position.map(c=>Py(c)).join(",")),`Target(${s})`}(Fu(e))}; limitType=${e.limitType})`}function rC(e,t){return t.isFoundDocument()&&function(s,c){const f=c.key.path;return s.collectionGroup!==null?c.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(f):nr.isDocumentKey(s.path)?s.path.isEqual(f):s.path.isImmediateParentOf(f)}(e,t)&&function(s,c){for(const f of M1(s))if(!f.field.isKeyField()&&c.data.field(f.field)===null)return!1;return!0}(e,t)&&function(s,c){for(const f of s.filters)if(!f.matches(c))return!1;return!0}(e,t)&&function(s,c){return!(s.startAt&&!function(_,x,a){const I=eU(_,x,a);return _.inclusive?I<=0:I<0}(s.startAt,M1(s),c)||s.endAt&&!function(_,x,a){const I=eU(_,x,a);return _.inclusive?I>=0:I>0}(s.endAt,M1(s),c))}(e,t)}function Cde(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function XG(e){return(t,r)=>{let s=!1;for(const c of M1(e)){const f=Ade(c,t,r);if(f!==0)return f;s=s||c.field.isKeyField()}return 0}}function Ade(e,t,r){const s=e.field.isKeyField()?nr.comparator(t.key,r.key):function(f,_,x){const a=_.data.field(f),I=x.data.field(f);return a!==null&&I!==null?Ay(a,I):Tr()}(e.field,t,r);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return Tr()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(t,r){this.mapKeyFn=t,this.equalsFn=r,this.inner={},this.innerSize=0}get(t){const r=this.mapKeyFn(t),s=this.inner[r];if(s!==void 0){for(const[c,f]of s)if(this.equalsFn(c,t))return f}}has(t){return this.get(t)!==void 0}set(t,r){const s=this.mapKeyFn(t),c=this.inner[s];if(c===void 0)return this.inner[s]=[[t,r]],void this.innerSize++;for(let f=0;f<c.length;f++)if(this.equalsFn(c[f][0],t))return void(c[f]=[t,r]);c.push([t,r]),this.innerSize++}delete(t){const r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return!1;for(let c=0;c<s.length;c++)if(this.equalsFn(s[c][0],t))return s.length===1?delete this.inner[r]:s.splice(c,1),this.innerSize--,!0;return!1}forEach(t){sg(this.inner,(r,s)=>{for(const[c,f]of s)t(c,f)})}isEmpty(){return FG(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pde=new bs(nr.comparator);function Xh(){return Pde}const KG=new bs(nr.comparator);function o1(...e){let t=KG;for(const r of e)t=t.insert(r.key,r);return t}function QG(e){let t=KG;return e.forEach((r,s)=>t=t.insert(r,s.overlayedDocument)),t}function mm(){return k1()}function YG(){return k1()}function k1(){return new e0(e=>e.toString(),(e,t)=>e.isEqual(t))}const Rde=new bs(nr.comparator),Mde=new Mo(nr.comparator);function Hr(...e){let t=Mde;for(const r of e)t=t.add(r);return t}const kde=new Mo(si);function Dde(){return kde}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p5(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:SS(t)?"-0":t}}function JG(e){return{integerValue:""+e}}function Ode(e,t){return ude(t)?JG(t):p5(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC{constructor(){this._=void 0}}function Lde(e,t,r){return e instanceof wx?function(c,f){const _={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return f&&c5(f)&&(f=u5(f)),f&&(_.fields.__previous_value__=f),{mapValue:_}}(r,t):e instanceof Ry?tW(e,t):e instanceof My?nW(e,t):function(c,f){const _=eW(c,f),x=iU(_)+iU(c.Pe);return pk(_)&&pk(c.Pe)?JG(x):p5(c.serializer,x)}(e,t)}function zde(e,t,r){return e instanceof Ry?tW(e,t):e instanceof My?nW(e,t):r}function eW(e,t){return e instanceof AS?function(s){return pk(s)||function(f){return!!f&&"doubleValue"in f}(s)}(t)?t:{integerValue:0}:null}class wx extends iC{}class Ry extends iC{constructor(t){super(),this.elements=t}}function tW(e,t){const r=rW(t);for(const s of e.elements)r.some(c=>Vu(c,s))||r.push(s);return{arrayValue:{values:r}}}class My extends iC{constructor(t){super(),this.elements=t}}function nW(e,t){let r=rW(t);for(const s of e.elements)r=r.filter(c=>!Vu(c,s));return{arrayValue:{values:r}}}class AS extends iC{constructor(t,r){super(),this.serializer=t,this.Pe=r}}function iU(e){return js(e.integerValue||e.doubleValue)}function rW(e){return h5(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m5{constructor(t,r){this.field=t,this.transform=r}}function Nde(e,t){return e.field.isEqual(t.field)&&function(s,c){return s instanceof Ry&&c instanceof Ry||s instanceof My&&c instanceof My?Cy(s.elements,c.elements,Vu):s instanceof AS&&c instanceof AS?Vu(s.Pe,c.Pe):s instanceof wx&&c instanceof wx}(e.transform,t.transform)}class Fde{constructor(t,r){this.version=t,this.transformResults=r}}class Zl{constructor(t,r){this.updateTime=t,this.exists=r}static none(){return new Zl}static exists(t){return new Zl(void 0,t)}static updateTime(t){return new Zl(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function TE(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}class sC{}function iW(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new g5(e.key,Zl.none()):new sb(e.key,e.data,Zl.none());{const r=e.data,s=Na.empty();let c=new Mo(Po.comparator);for(let f of t.fields)if(!c.has(f)){let _=r.field(f);_===null&&f.length>1&&(f=f.popLast(),_=r.field(f)),_===null?s.delete(f):s.set(f,_),c=c.add(f)}return new Yf(e.key,s,new ll(c.toArray()),Zl.none())}}function Bde(e,t,r){e instanceof sb?function(c,f,_){const x=c.value.clone(),a=oU(c.fieldTransforms,f,_.transformResults);x.setAll(a),f.convertToFoundDocument(_.version,x).setHasCommittedMutations()}(e,t,r):e instanceof Yf?function(c,f,_){if(!TE(c.precondition,f))return void f.convertToUnknownDocument(_.version);const x=oU(c.fieldTransforms,f,_.transformResults),a=f.data;a.setAll(sW(c)),a.setAll(x),f.convertToFoundDocument(_.version,a).setHasCommittedMutations()}(e,t,r):function(c,f,_){f.convertToNoDocument(_.version).setHasCommittedMutations()}(0,t,r)}function D1(e,t,r,s){return e instanceof sb?function(f,_,x,a){if(!TE(f.precondition,_))return x;const I=f.value.clone(),D=aU(f.fieldTransforms,a,_);return I.setAll(D),_.convertToFoundDocument(_.version,I).setHasLocalMutations(),null}(e,t,r,s):e instanceof Yf?function(f,_,x,a){if(!TE(f.precondition,_))return x;const I=aU(f.fieldTransforms,a,_),D=_.data;return D.setAll(sW(f)),D.setAll(I),_.convertToFoundDocument(_.version,D).setHasLocalMutations(),x===null?null:x.unionWith(f.fieldMask.fields).unionWith(f.fieldTransforms.map(O=>O.field))}(e,t,r,s):function(f,_,x){return TE(f.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):x}(e,t,r)}function jde(e,t){let r=null;for(const s of e.fieldTransforms){const c=t.data.field(s.field),f=eW(s.transform,c||null);f!=null&&(r===null&&(r=Na.empty()),r.set(s.field,f))}return r||null}function sU(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(s,c){return s===void 0&&c===void 0||!(!s||!c)&&Cy(s,c,(f,_)=>Nde(f,_))}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class sb extends sC{constructor(t,r,s,c=[]){super(),this.key=t,this.value=r,this.precondition=s,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class Yf extends sC{constructor(t,r,s,c,f=[]){super(),this.key=t,this.data=r,this.fieldMask=s,this.precondition=c,this.fieldTransforms=f,this.type=1}getFieldMask(){return this.fieldMask}}function sW(e){const t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const s=e.data.field(r);t.set(r,s)}}),t}function oU(e,t,r){const s=new Map;Ni(e.length===r.length);for(let c=0;c<r.length;c++){const f=e[c],_=f.transform,x=t.data.field(f.field);s.set(f.field,zde(_,x,r[c]))}return s}function aU(e,t,r){const s=new Map;for(const c of e){const f=c.transform,_=r.data.field(c.field);s.set(c.field,Lde(f,_,t))}return s}class g5 extends sC{constructor(t,r){super(),this.key=t,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ude extends sC{constructor(t,r){super(),this.key=t,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vde{constructor(t,r,s,c){this.batchId=t,this.localWriteTime=r,this.baseMutations=s,this.mutations=c}applyToRemoteDocument(t,r){const s=r.mutationResults;for(let c=0;c<this.mutations.length;c++){const f=this.mutations[c];f.key.isEqual(t.key)&&Bde(f,t,s[c])}}applyToLocalView(t,r){for(const s of this.baseMutations)s.key.isEqual(t.key)&&(r=D1(s,t,r,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(t.key)&&(r=D1(s,t,r,this.localWriteTime));return r}applyToLocalDocumentSet(t,r){const s=YG();return this.mutations.forEach(c=>{const f=t.get(c.key),_=f.overlayedDocument;let x=this.applyToLocalView(_,f.mutatedFields);x=r.has(c.key)?null:x;const a=iW(_,x);a!==null&&s.set(c.key,a),_.isValidDocument()||_.convertToNoDocument(Cr.min())}),s}keys(){return this.mutations.reduce((t,r)=>t.add(r.key),Hr())}isEqual(t){return this.batchId===t.batchId&&Cy(this.mutations,t.mutations,(r,s)=>sU(r,s))&&Cy(this.baseMutations,t.baseMutations,(r,s)=>sU(r,s))}}class _5{constructor(t,r,s,c){this.batch=t,this.commitVersion=r,this.mutationResults=s,this.docVersions=c}static from(t,r,s){Ni(t.mutations.length===s.length);let c=function(){return Rde}();const f=t.mutations;for(let _=0;_<f.length;_++)c=c.insert(f[_].key,s[_].version);return new _5(t,r,s,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $de{constructor(t,r){this.largestBatchId=t,this.mutation=r}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qde{constructor(t,r){this.count=t,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zs,ei;function Gde(e){switch(e){default:return Tr();case Zt.CANCELLED:case Zt.UNKNOWN:case Zt.DEADLINE_EXCEEDED:case Zt.RESOURCE_EXHAUSTED:case Zt.INTERNAL:case Zt.UNAVAILABLE:case Zt.UNAUTHENTICATED:return!1;case Zt.INVALID_ARGUMENT:case Zt.NOT_FOUND:case Zt.ALREADY_EXISTS:case Zt.PERMISSION_DENIED:case Zt.FAILED_PRECONDITION:case Zt.ABORTED:case Zt.OUT_OF_RANGE:case Zt.UNIMPLEMENTED:case Zt.DATA_LOSS:return!0}}function oW(e){if(e===void 0)return Zh("GRPC error has no .code"),Zt.UNKNOWN;switch(e){case Zs.OK:return Zt.OK;case Zs.CANCELLED:return Zt.CANCELLED;case Zs.UNKNOWN:return Zt.UNKNOWN;case Zs.DEADLINE_EXCEEDED:return Zt.DEADLINE_EXCEEDED;case Zs.RESOURCE_EXHAUSTED:return Zt.RESOURCE_EXHAUSTED;case Zs.INTERNAL:return Zt.INTERNAL;case Zs.UNAVAILABLE:return Zt.UNAVAILABLE;case Zs.UNAUTHENTICATED:return Zt.UNAUTHENTICATED;case Zs.INVALID_ARGUMENT:return Zt.INVALID_ARGUMENT;case Zs.NOT_FOUND:return Zt.NOT_FOUND;case Zs.ALREADY_EXISTS:return Zt.ALREADY_EXISTS;case Zs.PERMISSION_DENIED:return Zt.PERMISSION_DENIED;case Zs.FAILED_PRECONDITION:return Zt.FAILED_PRECONDITION;case Zs.ABORTED:return Zt.ABORTED;case Zs.OUT_OF_RANGE:return Zt.OUT_OF_RANGE;case Zs.UNIMPLEMENTED:return Zt.UNIMPLEMENTED;case Zs.DATA_LOSS:return Zt.DATA_LOSS;default:return Tr()}}(ei=Zs||(Zs={}))[ei.OK=0]="OK",ei[ei.CANCELLED=1]="CANCELLED",ei[ei.UNKNOWN=2]="UNKNOWN",ei[ei.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ei[ei.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ei[ei.NOT_FOUND=5]="NOT_FOUND",ei[ei.ALREADY_EXISTS=6]="ALREADY_EXISTS",ei[ei.PERMISSION_DENIED=7]="PERMISSION_DENIED",ei[ei.UNAUTHENTICATED=16]="UNAUTHENTICATED",ei[ei.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ei[ei.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ei[ei.ABORTED=10]="ABORTED",ei[ei.OUT_OF_RANGE=11]="OUT_OF_RANGE",ei[ei.UNIMPLEMENTED=12]="UNIMPLEMENTED",ei[ei.INTERNAL=13]="INTERNAL",ei[ei.UNAVAILABLE=14]="UNAVAILABLE",ei[ei.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wde(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hde=new Tm([4294967295,4294967295],0);function lU(e){const t=Wde().encode(e),r=new PG;return r.update(t),new Uint8Array(r.digest())}function cU(e){const t=new DataView(e.buffer),r=t.getUint32(0,!0),s=t.getUint32(4,!0),c=t.getUint32(8,!0),f=t.getUint32(12,!0);return[new Tm([r,s],0),new Tm([c,f],0)]}class y5{constructor(t,r,s){if(this.bitmap=t,this.padding=r,this.hashCount=s,r<0||r>=8)throw new a1(`Invalid padding: ${r}`);if(s<0)throw new a1(`Invalid hash count: ${s}`);if(t.length>0&&this.hashCount===0)throw new a1(`Invalid hash count: ${s}`);if(t.length===0&&r!==0)throw new a1(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*t.length-r,this.Te=Tm.fromNumber(this.Ie)}Ee(t,r,s){let c=t.add(r.multiply(Tm.fromNumber(s)));return c.compare(Hde)===1&&(c=new Tm([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;const r=lU(t),[s,c]=cU(r);for(let f=0;f<this.hashCount;f++){const _=this.Ee(s,c,f);if(!this.de(_))return!1}return!0}static create(t,r,s){const c=t%8==0?0:8-t%8,f=new Uint8Array(Math.ceil(t/8)),_=new y5(f,c,r);return s.forEach(x=>_.insert(x)),_}insert(t){if(this.Ie===0)return;const r=lU(t),[s,c]=cU(r);for(let f=0;f<this.hashCount;f++){const _=this.Ee(s,c,f);this.Ae(_)}}Ae(t){const r=Math.floor(t/8),s=t%8;this.bitmap[r]|=1<<s}}class a1 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC{constructor(t,r,s,c,f){this.snapshotVersion=t,this.targetChanges=r,this.targetMismatches=s,this.documentUpdates=c,this.resolvedLimboDocuments=f}static createSynthesizedRemoteEventForCurrentChange(t,r,s){const c=new Map;return c.set(t,ob.createSynthesizedTargetChangeForCurrentChange(t,r,s)),new oC(Cr.min(),c,new bs(si),Xh(),Hr())}}class ob{constructor(t,r,s,c,f){this.resumeToken=t,this.current=r,this.addedDocuments=s,this.modifiedDocuments=c,this.removedDocuments=f}static createSynthesizedTargetChangeForCurrentChange(t,r,s){return new ob(s,r,Hr(),Hr(),Hr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EE{constructor(t,r,s,c){this.Re=t,this.removedTargetIds=r,this.key=s,this.Ve=c}}class aW{constructor(t,r){this.targetId=t,this.me=r}}class lW{constructor(t,r,s=Do.EMPTY_BYTE_STRING,c=null){this.state=t,this.targetIds=r,this.resumeToken=s,this.cause=c}}class uU{constructor(){this.fe=0,this.ge=dU(),this.pe=Do.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=Hr(),r=Hr(),s=Hr();return this.ge.forEach((c,f)=>{switch(f){case 0:t=t.add(c);break;case 2:r=r.add(c);break;case 1:s=s.add(c);break;default:Tr()}}),new ob(this.pe,this.ye,t,r,s)}Ce(){this.we=!1,this.ge=dU()}Fe(t,r){this.we=!0,this.ge=this.ge.insert(t,r)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,Ni(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class Zde{constructor(t){this.Le=t,this.Be=new Map,this.ke=Xh(),this.qe=hU(),this.Qe=new bs(si)}Ke(t){for(const r of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(r,t.Ve):this.Ue(r,t.key,t.Ve);for(const r of t.removedTargetIds)this.Ue(r,t.key,t.Ve)}We(t){this.forEachTarget(t,r=>{const s=this.Ge(r);switch(t.state){case 0:this.ze(r)&&s.De(t.resumeToken);break;case 1:s.Oe(),s.Se||s.Ce(),s.De(t.resumeToken);break;case 2:s.Oe(),s.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(s.Ne(),s.De(t.resumeToken));break;case 4:this.ze(r)&&(this.je(r),s.De(t.resumeToken));break;default:Tr()}})}forEachTarget(t,r){t.targetIds.length>0?t.targetIds.forEach(r):this.Be.forEach((s,c)=>{this.ze(c)&&r(c)})}He(t){const r=t.targetId,s=t.me.count,c=this.Je(r);if(c){const f=c.target;if(gk(f))if(s===0){const _=new nr(f.path);this.Ue(r,_,Xo.newNoDocument(_,Cr.min()))}else Ni(s===1);else{const _=this.Ye(r);if(_!==s){const x=this.Ze(t),a=x?this.Xe(x,t,_):1;if(a!==0){this.je(r);const I=a===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,I)}}}}}Ze(t){const r=t.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:s="",padding:c=0},hashCount:f=0}=r;let _,x;try{_=jm(s).toUint8Array()}catch(a){if(a instanceof BG)return Iy("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{x=new y5(_,c,f)}catch(a){return Iy(a instanceof a1?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return x.Ie===0?null:x}Xe(t,r,s){return r.me.count===s-this.nt(t,r.targetId)?0:2}nt(t,r){const s=this.Le.getRemoteKeysForTarget(r);let c=0;return s.forEach(f=>{const _=this.Le.tt(),x=`projects/${_.projectId}/databases/${_.database}/documents/${f.path.canonicalString()}`;t.mightContain(x)||(this.Ue(r,f,null),c++)}),c}rt(t){const r=new Map;this.Be.forEach((f,_)=>{const x=this.Je(_);if(x){if(f.current&&gk(x.target)){const a=new nr(x.target.path);this.ke.get(a)!==null||this.it(_,a)||this.Ue(_,a,Xo.newNoDocument(a,t))}f.be&&(r.set(_,f.ve()),f.Ce())}});let s=Hr();this.qe.forEach((f,_)=>{let x=!0;_.forEachWhile(a=>{const I=this.Je(a);return!I||I.purpose==="TargetPurposeLimboResolution"||(x=!1,!1)}),x&&(s=s.add(f))}),this.ke.forEach((f,_)=>_.setReadTime(t));const c=new oC(t,r,this.Qe,this.ke,s);return this.ke=Xh(),this.qe=hU(),this.Qe=new bs(si),c}$e(t,r){if(!this.ze(t))return;const s=this.it(t,r.key)?2:0;this.Ge(t).Fe(r.key,s),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(t))}Ue(t,r,s){if(!this.ze(t))return;const c=this.Ge(t);this.it(t,r)?c.Fe(r,1):c.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(t)),s&&(this.ke=this.ke.insert(r,s))}removeTarget(t){this.Be.delete(t)}Ye(t){const r=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+r.addedDocuments.size-r.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let r=this.Be.get(t);return r||(r=new uU,this.Be.set(t,r)),r}st(t){let r=this.qe.get(t);return r||(r=new Mo(si),this.qe=this.qe.insert(t,r)),r}ze(t){const r=this.Je(t)!==null;return r||Un("WatchChangeAggregator","Detected inactive target",t),r}Je(t){const r=this.Be.get(t);return r&&r.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new uU),this.Le.getRemoteKeysForTarget(t).forEach(r=>{this.Ue(t,r,null)})}it(t,r){return this.Le.getRemoteKeysForTarget(t).has(r)}}function hU(){return new bs(nr.comparator)}function dU(){return new bs(nr.comparator)}const Xde={asc:"ASCENDING",desc:"DESCENDING"},Kde={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Qde={and:"AND",or:"OR"};class Yde{constructor(t,r){this.databaseId=t,this.useProto3Json=r}}function yk(e,t){return e.useProto3Json||eC(t)?t:{value:t}}function PS(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function cW(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Jde(e,t){return PS(e,t.toTimestamp())}function Bu(e){return Ni(!!e),Cr.fromTimestamp(function(r){const s=Nf(r);return new ho(s.seconds,s.nanos)}(e))}function v5(e,t){return vk(e,t).canonicalString()}function vk(e,t){const r=function(c){return new Ji(["projects",c.projectId,"databases",c.database])}(e).child("documents");return t===void 0?r:r.child(t)}function uW(e){const t=Ji.fromString(e);return Ni(mW(t)),t}function xk(e,t){return v5(e.databaseId,t.path)}function fR(e,t){const r=uW(t);if(r.get(1)!==e.databaseId.projectId)throw new Pn(Zt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new Pn(Zt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new nr(dW(r))}function hW(e,t){return v5(e.databaseId,t)}function efe(e){const t=uW(e);return t.length===4?Ji.emptyPath():dW(t)}function bk(e){return new Ji(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function dW(e){return Ni(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function fU(e,t,r){return{name:xk(e,t),fields:r.value.mapValue.fields}}function tfe(e,t){let r;if("targetChange"in t){t.targetChange;const s=function(I){return I==="NO_CHANGE"?0:I==="ADD"?1:I==="REMOVE"?2:I==="CURRENT"?3:I==="RESET"?4:Tr()}(t.targetChange.targetChangeType||"NO_CHANGE"),c=t.targetChange.targetIds||[],f=function(I,D){return I.useProto3Json?(Ni(D===void 0||typeof D=="string"),Do.fromBase64String(D||"")):(Ni(D===void 0||D instanceof Buffer||D instanceof Uint8Array),Do.fromUint8Array(D||new Uint8Array))}(e,t.targetChange.resumeToken),_=t.targetChange.cause,x=_&&function(I){const D=I.code===void 0?Zt.UNKNOWN:oW(I.code);return new Pn(D,I.message||"")}(_);r=new lW(s,c,f,x||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const c=fR(e,s.document.name),f=Bu(s.document.updateTime),_=s.document.createTime?Bu(s.document.createTime):Cr.min(),x=new Na({mapValue:{fields:s.document.fields}}),a=Xo.newFoundDocument(c,f,_,x),I=s.targetIds||[],D=s.removedTargetIds||[];r=new EE(I,D,a.key,a)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const c=fR(e,s.document),f=s.readTime?Bu(s.readTime):Cr.min(),_=Xo.newNoDocument(c,f),x=s.removedTargetIds||[];r=new EE([],x,_.key,_)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const c=fR(e,s.document),f=s.removedTargetIds||[];r=new EE([],f,c,null)}else{if(!("filter"in t))return Tr();{t.filter;const s=t.filter;s.targetId;const{count:c=0,unchangedNames:f}=s,_=new qde(c,f),x=s.targetId;r=new aW(x,_)}}return r}function nfe(e,t){let r;if(t instanceof sb)r={update:fU(e,t.key,t.value)};else if(t instanceof g5)r={delete:xk(e,t.key)};else if(t instanceof Yf)r={update:fU(e,t.key,t.data),updateMask:hfe(t.fieldMask)};else{if(!(t instanceof Ude))return Tr();r={verify:xk(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(s=>function(f,_){const x=_.transform;if(x instanceof wx)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(x instanceof Ry)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:x.elements}};if(x instanceof My)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:x.elements}};if(x instanceof AS)return{fieldPath:_.field.canonicalString(),increment:x.Pe};throw Tr()}(0,s))),t.precondition.isNone||(r.currentDocument=function(c,f){return f.updateTime!==void 0?{updateTime:Jde(c,f.updateTime)}:f.exists!==void 0?{exists:f.exists}:Tr()}(e,t.precondition)),r}function rfe(e,t){return e&&e.length>0?(Ni(t!==void 0),e.map(r=>function(c,f){let _=c.updateTime?Bu(c.updateTime):Bu(f);return _.isEqual(Cr.min())&&(_=Bu(f)),new Fde(_,c.transformResults||[])}(r,t))):[]}function ife(e,t){return{documents:[hW(e,t.path)]}}function sfe(e,t){const r={structuredQuery:{}},s=t.path;let c;t.collectionGroup!==null?(c=s,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(c=s.popLast(),r.structuredQuery.from=[{collectionId:s.lastSegment()}]),r.parent=hW(e,c);const f=function(I){if(I.length!==0)return pW($c.create(I,"and"))}(t.filters);f&&(r.structuredQuery.where=f);const _=function(I){if(I.length!==0)return I.map(D=>function(F){return{field:R_(F.field),direction:lfe(F.dir)}}(D))}(t.orderBy);_&&(r.structuredQuery.orderBy=_);const x=yk(e,t.limit);return x!==null&&(r.structuredQuery.limit=x),t.startAt&&(r.structuredQuery.startAt=function(I){return{before:I.inclusive,values:I.position}}(t.startAt)),t.endAt&&(r.structuredQuery.endAt=function(I){return{before:!I.inclusive,values:I.position}}(t.endAt)),{_t:r,parent:c}}function ofe(e){let t=efe(e.parent);const r=e.structuredQuery,s=r.from?r.from.length:0;let c=null;if(s>0){Ni(s===1);const D=r.from[0];D.allDescendants?c=D.collectionId:t=t.child(D.collectionId)}let f=[];r.where&&(f=function(O){const F=fW(O);return F instanceof $c&&$G(F)?F.getFilters():[F]}(r.where));let _=[];r.orderBy&&(_=function(O){return O.map(F=>function(J){return new bx(M_(J.field),function(ne){switch(ne){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(J.direction))}(F))}(r.orderBy));let x=null;r.limit&&(x=function(O){let F;return F=typeof O=="object"?O.value:O,eC(F)?null:F}(r.limit));let a=null;r.startAt&&(a=function(O){const F=!!O.before,Z=O.values||[];return new IS(Z,F)}(r.startAt));let I=null;return r.endAt&&(I=function(O){const F=!O.before,Z=O.values||[];return new IS(Z,F)}(r.endAt)),Sde(t,c,_,f,x,"F",a,I)}function afe(e,t){const r=function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Tr()}}(t.purpose);return r==null?null:{"goog-listen-tags":r}}function fW(e){return e.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const s=M_(r.unaryFilter.field);return Ys.create(s,"==",{doubleValue:NaN});case"IS_NULL":const c=M_(r.unaryFilter.field);return Ys.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const f=M_(r.unaryFilter.field);return Ys.create(f,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=M_(r.unaryFilter.field);return Ys.create(_,"!=",{nullValue:"NULL_VALUE"});default:return Tr()}}(e):e.fieldFilter!==void 0?function(r){return Ys.create(M_(r.fieldFilter.field),function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Tr()}}(r.fieldFilter.op),r.fieldFilter.value)}(e):e.compositeFilter!==void 0?function(r){return $c.create(r.compositeFilter.filters.map(s=>fW(s)),function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return Tr()}}(r.compositeFilter.op))}(e):Tr()}function lfe(e){return Xde[e]}function cfe(e){return Kde[e]}function ufe(e){return Qde[e]}function R_(e){return{fieldPath:e.canonicalString()}}function M_(e){return Po.fromServerFormat(e.fieldPath)}function pW(e){return e instanceof Ys?function(r){if(r.op==="=="){if(Jj(r.value))return{unaryFilter:{field:R_(r.field),op:"IS_NAN"}};if(Yj(r.value))return{unaryFilter:{field:R_(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(Jj(r.value))return{unaryFilter:{field:R_(r.field),op:"IS_NOT_NAN"}};if(Yj(r.value))return{unaryFilter:{field:R_(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:R_(r.field),op:cfe(r.op),value:r.value}}}(e):e instanceof $c?function(r){const s=r.getFilters().map(c=>pW(c));return s.length===1?s[0]:{compositeFilter:{op:ufe(r.op),filters:s}}}(e):Tr()}function hfe(e){const t=[];return e.fields.forEach(r=>t.push(r.canonicalString())),{fieldPaths:t}}function mW(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(t,r,s,c,f=Cr.min(),_=Cr.min(),x=Do.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=r,this.purpose=s,this.sequenceNumber=c,this.snapshotVersion=f,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=x,this.expectedCount=a}withSequenceNumber(t){return new pf(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,r){return new pf(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new pf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new pf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dfe{constructor(t){this.ct=t}}function ffe(e){const t=ofe({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?CS(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pfe{constructor(){this.un=new mfe}addToCollectionParentIndex(t,r){return this.un.add(r),tn.resolve()}getCollectionParents(t,r){return tn.resolve(this.un.getEntries(r))}addFieldIndex(t,r){return tn.resolve()}deleteFieldIndex(t,r){return tn.resolve()}deleteAllFieldIndexes(t){return tn.resolve()}createTargetIndexes(t,r){return tn.resolve()}getDocumentsMatchingTarget(t,r){return tn.resolve(null)}getIndexType(t,r){return tn.resolve(0)}getFieldIndexes(t,r){return tn.resolve([])}getNextCollectionGroupToUpdate(t){return tn.resolve(null)}getMinOffset(t,r){return tn.resolve(zf.min())}getMinOffsetFromCollectionGroup(t,r){return tn.resolve(zf.min())}updateCollectionGroup(t,r,s){return tn.resolve()}updateIndexEntries(t,r){return tn.resolve()}}class mfe{constructor(){this.index={}}add(t){const r=t.lastSegment(),s=t.popLast(),c=this.index[r]||new Mo(Ji.comparator),f=!c.has(s);return this.index[r]=c.add(s),f}has(t){const r=t.lastSegment(),s=t.popLast(),c=this.index[r];return c&&c.has(s)}getEntries(t){return(this.index[t]||new Mo(Ji.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new ky(0)}static kn(){return new ky(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gfe{constructor(){this.changes=new e0(t=>t.toString(),(t,r)=>t.isEqual(r)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,r){this.assertNotApplied(),this.changes.set(t,Xo.newInvalidDocument(t).setReadTime(r))}getEntry(t,r){this.assertNotApplied();const s=this.changes.get(r);return s!==void 0?tn.resolve(s):this.getFromCache(t,r)}getEntries(t,r){return this.getAllFromCache(t,r)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _fe{constructor(t,r){this.overlayedDocument=t,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yfe{constructor(t,r,s,c){this.remoteDocumentCache=t,this.mutationQueue=r,this.documentOverlayCache=s,this.indexManager=c}getDocument(t,r){let s=null;return this.documentOverlayCache.getOverlay(t,r).next(c=>(s=c,this.remoteDocumentCache.getEntry(t,r))).next(c=>(s!==null&&D1(s.mutation,c,ll.empty(),ho.now()),c))}getDocuments(t,r){return this.remoteDocumentCache.getEntries(t,r).next(s=>this.getLocalViewOfDocuments(t,s,Hr()).next(()=>s))}getLocalViewOfDocuments(t,r,s=Hr()){const c=mm();return this.populateOverlays(t,c,r).next(()=>this.computeViews(t,r,c,s).next(f=>{let _=o1();return f.forEach((x,a)=>{_=_.insert(x,a.overlayedDocument)}),_}))}getOverlayedDocuments(t,r){const s=mm();return this.populateOverlays(t,s,r).next(()=>this.computeViews(t,r,s,Hr()))}populateOverlays(t,r,s){const c=[];return s.forEach(f=>{r.has(f)||c.push(f)}),this.documentOverlayCache.getOverlays(t,c).next(f=>{f.forEach((_,x)=>{r.set(_,x)})})}computeViews(t,r,s,c){let f=Xh();const _=k1(),x=function(){return k1()}();return r.forEach((a,I)=>{const D=s.get(I.key);c.has(I.key)&&(D===void 0||D.mutation instanceof Yf)?f=f.insert(I.key,I):D!==void 0?(_.set(I.key,D.mutation.getFieldMask()),D1(D.mutation,I,D.mutation.getFieldMask(),ho.now())):_.set(I.key,ll.empty())}),this.recalculateAndSaveOverlays(t,f).next(a=>(a.forEach((I,D)=>_.set(I,D)),r.forEach((I,D)=>{var O;return x.set(I,new _fe(D,(O=_.get(I))!==null&&O!==void 0?O:null))}),x))}recalculateAndSaveOverlays(t,r){const s=k1();let c=new bs((_,x)=>_-x),f=Hr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,r).next(_=>{for(const x of _)x.keys().forEach(a=>{const I=r.get(a);if(I===null)return;let D=s.get(a)||ll.empty();D=x.applyToLocalView(I,D),s.set(a,D);const O=(c.get(x.batchId)||Hr()).add(a);c=c.insert(x.batchId,O)})}).next(()=>{const _=[],x=c.getReverseIterator();for(;x.hasNext();){const a=x.getNext(),I=a.key,D=a.value,O=YG();D.forEach(F=>{if(!f.has(F)){const Z=iW(r.get(F),s.get(F));Z!==null&&O.set(F,Z),f=f.add(F)}}),_.push(this.documentOverlayCache.saveOverlays(t,I,O))}return tn.waitFor(_)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(t,r){return this.remoteDocumentCache.getEntries(t,r).next(s=>this.recalculateAndSaveOverlays(t,s))}getDocumentsMatchingQuery(t,r,s,c){return function(_){return nr.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(t,r.path):HG(r)?this.getDocumentsMatchingCollectionGroupQuery(t,r,s,c):this.getDocumentsMatchingCollectionQuery(t,r,s,c)}getNextDocuments(t,r,s,c){return this.remoteDocumentCache.getAllFromCollectionGroup(t,r,s,c).next(f=>{const _=c-f.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,r,s.largestBatchId,c-f.size):tn.resolve(mm());let x=-1,a=f;return _.next(I=>tn.forEach(I,(D,O)=>(x<O.largestBatchId&&(x=O.largestBatchId),f.get(D)?tn.resolve():this.remoteDocumentCache.getEntry(t,D).next(F=>{a=a.insert(D,F)}))).next(()=>this.populateOverlays(t,I,f)).next(()=>this.computeViews(t,a,I,Hr())).next(D=>({batchId:x,changes:QG(D)})))})}getDocumentsMatchingDocumentQuery(t,r){return this.getDocument(t,new nr(r)).next(s=>{let c=o1();return s.isFoundDocument()&&(c=c.insert(s.key,s)),c})}getDocumentsMatchingCollectionGroupQuery(t,r,s,c){const f=r.collectionGroup;let _=o1();return this.indexManager.getCollectionParents(t,f).next(x=>tn.forEach(x,a=>{const I=function(O,F){return new Jy(F,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)}(r,a.child(f));return this.getDocumentsMatchingCollectionQuery(t,I,s,c).next(D=>{D.forEach((O,F)=>{_=_.insert(O,F)})})}).next(()=>_))}getDocumentsMatchingCollectionQuery(t,r,s,c){let f;return this.documentOverlayCache.getOverlaysForCollection(t,r.path,s.largestBatchId).next(_=>(f=_,this.remoteDocumentCache.getDocumentsMatchingQuery(t,r,s,f,c))).next(_=>{f.forEach((a,I)=>{const D=I.getKey();_.get(D)===null&&(_=_.insert(D,Xo.newInvalidDocument(D)))});let x=o1();return _.forEach((a,I)=>{const D=f.get(a);D!==void 0&&D1(D.mutation,I,ll.empty(),ho.now()),rC(r,I)&&(x=x.insert(a,I))}),x})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vfe{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,r){return tn.resolve(this.hr.get(r))}saveBundleMetadata(t,r){return this.hr.set(r.id,function(c){return{id:c.id,version:c.version,createTime:Bu(c.createTime)}}(r)),tn.resolve()}getNamedQuery(t,r){return tn.resolve(this.Pr.get(r))}saveNamedQuery(t,r){return this.Pr.set(r.name,function(c){return{name:c.name,query:ffe(c.bundledQuery),readTime:Bu(c.readTime)}}(r)),tn.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xfe{constructor(){this.overlays=new bs(nr.comparator),this.Ir=new Map}getOverlay(t,r){return tn.resolve(this.overlays.get(r))}getOverlays(t,r){const s=mm();return tn.forEach(r,c=>this.getOverlay(t,c).next(f=>{f!==null&&s.set(c,f)})).next(()=>s)}saveOverlays(t,r,s){return s.forEach((c,f)=>{this.ht(t,r,f)}),tn.resolve()}removeOverlaysForBatchId(t,r,s){const c=this.Ir.get(s);return c!==void 0&&(c.forEach(f=>this.overlays=this.overlays.remove(f)),this.Ir.delete(s)),tn.resolve()}getOverlaysForCollection(t,r,s){const c=mm(),f=r.length+1,_=new nr(r.child("")),x=this.overlays.getIteratorFrom(_);for(;x.hasNext();){const a=x.getNext().value,I=a.getKey();if(!r.isPrefixOf(I.path))break;I.path.length===f&&a.largestBatchId>s&&c.set(a.getKey(),a)}return tn.resolve(c)}getOverlaysForCollectionGroup(t,r,s,c){let f=new bs((I,D)=>I-D);const _=this.overlays.getIterator();for(;_.hasNext();){const I=_.getNext().value;if(I.getKey().getCollectionGroup()===r&&I.largestBatchId>s){let D=f.get(I.largestBatchId);D===null&&(D=mm(),f=f.insert(I.largestBatchId,D)),D.set(I.getKey(),I)}}const x=mm(),a=f.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((I,D)=>x.set(I,D)),!(x.size()>=c)););return tn.resolve(x)}ht(t,r,s){const c=this.overlays.get(s.key);if(c!==null){const _=this.Ir.get(c.largestBatchId).delete(s.key);this.Ir.set(c.largestBatchId,_)}this.overlays=this.overlays.insert(s.key,new $de(r,s));let f=this.Ir.get(r);f===void 0&&(f=Hr(),this.Ir.set(r,f)),this.Ir.set(r,f.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bfe{constructor(){this.sessionToken=Do.EMPTY_BYTE_STRING}getSessionToken(t){return tn.resolve(this.sessionToken)}setSessionToken(t,r){return this.sessionToken=r,tn.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x5{constructor(){this.Tr=new Mo(vo.Er),this.dr=new Mo(vo.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,r){const s=new vo(t,r);this.Tr=this.Tr.add(s),this.dr=this.dr.add(s)}Rr(t,r){t.forEach(s=>this.addReference(s,r))}removeReference(t,r){this.Vr(new vo(t,r))}mr(t,r){t.forEach(s=>this.removeReference(s,r))}gr(t){const r=new nr(new Ji([])),s=new vo(r,t),c=new vo(r,t+1),f=[];return this.dr.forEachInRange([s,c],_=>{this.Vr(_),f.push(_.key)}),f}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){const r=new nr(new Ji([])),s=new vo(r,t),c=new vo(r,t+1);let f=Hr();return this.dr.forEachInRange([s,c],_=>{f=f.add(_.key)}),f}containsKey(t){const r=new vo(t,0),s=this.Tr.firstAfterOrEqual(r);return s!==null&&t.isEqual(s.key)}}class vo{constructor(t,r){this.key=t,this.wr=r}static Er(t,r){return nr.comparator(t.key,r.key)||si(t.wr,r.wr)}static Ar(t,r){return si(t.wr,r.wr)||nr.comparator(t.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wfe{constructor(t,r){this.indexManager=t,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new Mo(vo.Er)}checkEmpty(t){return tn.resolve(this.mutationQueue.length===0)}addMutationBatch(t,r,s,c){const f=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new Vde(f,r,s,c);this.mutationQueue.push(_);for(const x of c)this.br=this.br.add(new vo(x.key,f)),this.indexManager.addToCollectionParentIndex(t,x.key.path.popLast());return tn.resolve(_)}lookupMutationBatch(t,r){return tn.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(t,r){const s=r+1,c=this.vr(s),f=c<0?0:c;return tn.resolve(this.mutationQueue.length>f?this.mutationQueue[f]:null)}getHighestUnacknowledgedBatchId(){return tn.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return tn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,r){const s=new vo(r,0),c=new vo(r,Number.POSITIVE_INFINITY),f=[];return this.br.forEachInRange([s,c],_=>{const x=this.Dr(_.wr);f.push(x)}),tn.resolve(f)}getAllMutationBatchesAffectingDocumentKeys(t,r){let s=new Mo(si);return r.forEach(c=>{const f=new vo(c,0),_=new vo(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([f,_],x=>{s=s.add(x.wr)})}),tn.resolve(this.Cr(s))}getAllMutationBatchesAffectingQuery(t,r){const s=r.path,c=s.length+1;let f=s;nr.isDocumentKey(f)||(f=f.child(""));const _=new vo(new nr(f),0);let x=new Mo(si);return this.br.forEachWhile(a=>{const I=a.key.path;return!!s.isPrefixOf(I)&&(I.length===c&&(x=x.add(a.wr)),!0)},_),tn.resolve(this.Cr(x))}Cr(t){const r=[];return t.forEach(s=>{const c=this.Dr(s);c!==null&&r.push(c)}),r}removeMutationBatch(t,r){Ni(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let s=this.br;return tn.forEach(r.mutations,c=>{const f=new vo(c.key,r.batchId);return s=s.delete(f),this.referenceDelegate.markPotentiallyOrphaned(t,c.key)}).next(()=>{this.br=s})}On(t){}containsKey(t,r){const s=new vo(r,0),c=this.br.firstAfterOrEqual(s);return tn.resolve(r.isEqual(c&&c.key))}performConsistencyCheck(t){return this.mutationQueue.length,tn.resolve()}Fr(t,r){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){const r=this.vr(t);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tfe{constructor(t){this.Mr=t,this.docs=function(){return new bs(nr.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,r){const s=r.key,c=this.docs.get(s),f=c?c.size:0,_=this.Mr(r);return this.docs=this.docs.insert(s,{document:r.mutableCopy(),size:_}),this.size+=_-f,this.indexManager.addToCollectionParentIndex(t,s.path.popLast())}removeEntry(t){const r=this.docs.get(t);r&&(this.docs=this.docs.remove(t),this.size-=r.size)}getEntry(t,r){const s=this.docs.get(r);return tn.resolve(s?s.document.mutableCopy():Xo.newInvalidDocument(r))}getEntries(t,r){let s=Xh();return r.forEach(c=>{const f=this.docs.get(c);s=s.insert(c,f?f.document.mutableCopy():Xo.newInvalidDocument(c))}),tn.resolve(s)}getDocumentsMatchingQuery(t,r,s,c){let f=Xh();const _=r.path,x=new nr(_.child("")),a=this.docs.getIteratorFrom(x);for(;a.hasNext();){const{key:I,value:{document:D}}=a.getNext();if(!_.isPrefixOf(I.path))break;I.path.length>_.length+1||ode(sde(D),s)<=0||(c.has(D.key)||rC(r,D))&&(f=f.insert(D.key,D.mutableCopy()))}return tn.resolve(f)}getAllFromCollectionGroup(t,r,s,c){Tr()}Or(t,r){return tn.forEach(this.docs,s=>r(s))}newChangeBuffer(t){return new Efe(this)}getSize(t){return tn.resolve(this.size)}}class Efe extends gfe{constructor(t){super(),this.cr=t}applyChanges(t){const r=[];return this.changes.forEach((s,c)=>{c.isValidDocument()?r.push(this.cr.addEntry(t,c)):this.cr.removeEntry(s)}),tn.waitFor(r)}getFromCache(t,r){return this.cr.getEntry(t,r)}getAllFromCache(t,r){return this.cr.getEntries(t,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sfe{constructor(t){this.persistence=t,this.Nr=new e0(r=>d5(r),f5),this.lastRemoteSnapshotVersion=Cr.min(),this.highestTargetId=0,this.Lr=0,this.Br=new x5,this.targetCount=0,this.kr=ky.Bn()}forEachTarget(t,r){return this.Nr.forEach((s,c)=>r(c)),tn.resolve()}getLastRemoteSnapshotVersion(t){return tn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return tn.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),tn.resolve(this.highestTargetId)}setTargetsMetadata(t,r,s){return s&&(this.lastRemoteSnapshotVersion=s),r>this.Lr&&(this.Lr=r),tn.resolve()}Kn(t){this.Nr.set(t.target,t);const r=t.targetId;r>this.highestTargetId&&(this.kr=new ky(r),this.highestTargetId=r),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,r){return this.Kn(r),this.targetCount+=1,tn.resolve()}updateTargetData(t,r){return this.Kn(r),tn.resolve()}removeTargetData(t,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,tn.resolve()}removeTargets(t,r,s){let c=0;const f=[];return this.Nr.forEach((_,x)=>{x.sequenceNumber<=r&&s.get(x.targetId)===null&&(this.Nr.delete(_),f.push(this.removeMatchingKeysForTargetId(t,x.targetId)),c++)}),tn.waitFor(f).next(()=>c)}getTargetCount(t){return tn.resolve(this.targetCount)}getTargetData(t,r){const s=this.Nr.get(r)||null;return tn.resolve(s)}addMatchingKeys(t,r,s){return this.Br.Rr(r,s),tn.resolve()}removeMatchingKeys(t,r,s){this.Br.mr(r,s);const c=this.persistence.referenceDelegate,f=[];return c&&r.forEach(_=>{f.push(c.markPotentiallyOrphaned(t,_))}),tn.waitFor(f)}removeMatchingKeysForTargetId(t,r){return this.Br.gr(r),tn.resolve()}getMatchingKeysForTargetId(t,r){const s=this.Br.yr(r);return tn.resolve(s)}containsKey(t,r){return tn.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ife{constructor(t,r){this.qr={},this.overlays={},this.Qr=new l5(0),this.Kr=!1,this.Kr=!0,this.$r=new bfe,this.referenceDelegate=t(this),this.Ur=new Sfe(this),this.indexManager=new pfe,this.remoteDocumentCache=function(c){return new Tfe(c)}(s=>this.referenceDelegate.Wr(s)),this.serializer=new dfe(r),this.Gr=new vfe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let r=this.overlays[t.toKey()];return r||(r=new xfe,this.overlays[t.toKey()]=r),r}getMutationQueue(t,r){let s=this.qr[t.toKey()];return s||(s=new wfe(r,this.referenceDelegate),this.qr[t.toKey()]=s),s}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,r,s){Un("MemoryPersistence","Starting transaction:",t);const c=new Cfe(this.Qr.next());return this.referenceDelegate.zr(),s(c).next(f=>this.referenceDelegate.jr(c).next(()=>f)).toPromise().then(f=>(c.raiseOnCommittedEvent(),f))}Hr(t,r){return tn.or(Object.values(this.qr).map(s=>()=>s.containsKey(t,r)))}}class Cfe extends lde{constructor(t){super(),this.currentSequenceNumber=t}}class b5{constructor(t){this.persistence=t,this.Jr=new x5,this.Yr=null}static Zr(t){return new b5(t)}get Xr(){if(this.Yr)return this.Yr;throw Tr()}addReference(t,r,s){return this.Jr.addReference(s,r),this.Xr.delete(s.toString()),tn.resolve()}removeReference(t,r,s){return this.Jr.removeReference(s,r),this.Xr.add(s.toString()),tn.resolve()}markPotentiallyOrphaned(t,r){return this.Xr.add(r.toString()),tn.resolve()}removeTarget(t,r){this.Jr.gr(r.targetId).forEach(c=>this.Xr.add(c.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(t,r.targetId).next(c=>{c.forEach(f=>this.Xr.add(f.toString()))}).next(()=>s.removeTargetData(t,r))}zr(){this.Yr=new Set}jr(t){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return tn.forEach(this.Xr,s=>{const c=nr.fromPath(s);return this.ei(t,c).next(f=>{f||r.removeEntry(c,Cr.min())})}).next(()=>(this.Yr=null,r.apply(t)))}updateLimboDocument(t,r){return this.ei(t,r).next(s=>{s?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(t){return 0}ei(t,r){return tn.or([()=>tn.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(t,r),()=>this.persistence.Hr(t,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5{constructor(t,r,s,c){this.targetId=t,this.fromCache=r,this.$i=s,this.Ui=c}static Wi(t,r){let s=Hr(),c=Hr();for(const f of r.docChanges)switch(f.type){case 0:s=s.add(f.doc.key);break;case 1:c=c.add(f.doc.key)}return new w5(t,r.fromCache,s,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Afe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pfe{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return xle()?8:cde(Jo())>0?6:4}()}initialize(t,r){this.Ji=t,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(t,r,s,c){const f={result:null};return this.Yi(t,r).next(_=>{f.result=_}).next(()=>{if(!f.result)return this.Zi(t,r,c,s).next(_=>{f.result=_})}).next(()=>{if(f.result)return;const _=new Afe;return this.Xi(t,r,_).next(x=>{if(f.result=x,this.zi)return this.es(t,r,_,x.size)})}).next(()=>f.result)}es(t,r,s,c){return s.documentReadCount<this.ji?(Vv()<=Qr.DEBUG&&Un("QueryEngine","SDK will not create cache indexes for query:",P_(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),tn.resolve()):(Vv()<=Qr.DEBUG&&Un("QueryEngine","Query:",P_(r),"scans",s.documentReadCount,"local documents and returns",c,"documents as results."),s.documentReadCount>this.Hi*c?(Vv()<=Qr.DEBUG&&Un("QueryEngine","The SDK decides to create cache indexes for query:",P_(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Fu(r))):tn.resolve())}Yi(t,r){if(rU(r))return tn.resolve(null);let s=Fu(r);return this.indexManager.getIndexType(t,s).next(c=>c===0?null:(r.limit!==null&&c===1&&(r=CS(r,null,"F"),s=Fu(r)),this.indexManager.getDocumentsMatchingTarget(t,s).next(f=>{const _=Hr(...f);return this.Ji.getDocuments(t,_).next(x=>this.indexManager.getMinOffset(t,s).next(a=>{const I=this.ts(r,x);return this.ns(r,I,_,a.readTime)?this.Yi(t,CS(r,null,"F")):this.rs(t,I,r,a)}))})))}Zi(t,r,s,c){return rU(r)||c.isEqual(Cr.min())?tn.resolve(null):this.Ji.getDocuments(t,s).next(f=>{const _=this.ts(r,f);return this.ns(r,_,s,c)?tn.resolve(null):(Vv()<=Qr.DEBUG&&Un("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),P_(r)),this.rs(t,_,r,ide(c,-1)).next(x=>x))})}ts(t,r){let s=new Mo(XG(t));return r.forEach((c,f)=>{rC(t,f)&&(s=s.add(f))}),s}ns(t,r,s,c){if(t.limit===null)return!1;if(s.size!==r.size)return!0;const f=t.limitType==="F"?r.last():r.first();return!!f&&(f.hasPendingWrites||f.version.compareTo(c)>0)}Xi(t,r,s){return Vv()<=Qr.DEBUG&&Un("QueryEngine","Using full collection scan to execute query:",P_(r)),this.Ji.getDocumentsMatchingQuery(t,r,zf.min(),s)}rs(t,r,s,c){return this.Ji.getDocumentsMatchingQuery(t,s,c).next(f=>(r.forEach(_=>{f=f.insert(_.key,_)}),f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rfe{constructor(t,r,s,c){this.persistence=t,this.ss=r,this.serializer=c,this.os=new bs(si),this._s=new e0(f=>d5(f),f5),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(s)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new yfe(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>t.collect(r,this.os))}}function Mfe(e,t,r,s){return new Rfe(e,t,r,s)}async function gW(e,t){const r=Ar(e);return await r.persistence.runTransaction("Handle user change","readonly",s=>{let c;return r.mutationQueue.getAllMutationBatches(s).next(f=>(c=f,r.ls(t),r.mutationQueue.getAllMutationBatches(s))).next(f=>{const _=[],x=[];let a=Hr();for(const I of c){_.push(I.batchId);for(const D of I.mutations)a=a.add(D.key)}for(const I of f){x.push(I.batchId);for(const D of I.mutations)a=a.add(D.key)}return r.localDocuments.getDocuments(s,a).next(I=>({hs:I,removedBatchIds:_,addedBatchIds:x}))})})}function kfe(e,t){const r=Ar(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const c=t.batch.keys(),f=r.cs.newChangeBuffer({trackRemovals:!0});return function(x,a,I,D){const O=I.batch,F=O.keys();let Z=tn.resolve();return F.forEach(J=>{Z=Z.next(()=>D.getEntry(a,J)).next(re=>{const ne=I.docVersions.get(J);Ni(ne!==null),re.version.compareTo(ne)<0&&(O.applyToRemoteDocument(re,I),re.isValidDocument()&&(re.setReadTime(I.commitVersion),D.addEntry(re)))})}),Z.next(()=>x.mutationQueue.removeMutationBatch(a,O))}(r,s,t,f).next(()=>f.apply(s)).next(()=>r.mutationQueue.performConsistencyCheck(s)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(s,c,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(x){let a=Hr();for(let I=0;I<x.mutationResults.length;++I)x.mutationResults[I].transformResults.length>0&&(a=a.add(x.batch.mutations[I].key));return a}(t))).next(()=>r.localDocuments.getDocuments(s,c))})}function _W(e){const t=Ar(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",r=>t.Ur.getLastRemoteSnapshotVersion(r))}function Dfe(e,t){const r=Ar(e),s=t.snapshotVersion;let c=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const _=r.cs.newChangeBuffer({trackRemovals:!0});c=r.os;const x=[];t.targetChanges.forEach((D,O)=>{const F=c.get(O);if(!F)return;x.push(r.Ur.removeMatchingKeys(f,D.removedDocuments,O).next(()=>r.Ur.addMatchingKeys(f,D.addedDocuments,O)));let Z=F.withSequenceNumber(f.currentSequenceNumber);t.targetMismatches.get(O)!==null?Z=Z.withResumeToken(Do.EMPTY_BYTE_STRING,Cr.min()).withLastLimboFreeSnapshotVersion(Cr.min()):D.resumeToken.approximateByteSize()>0&&(Z=Z.withResumeToken(D.resumeToken,s)),c=c.insert(O,Z),function(re,ne,G){return re.resumeToken.approximateByteSize()===0||ne.snapshotVersion.toMicroseconds()-re.snapshotVersion.toMicroseconds()>=3e8?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(F,Z,D)&&x.push(r.Ur.updateTargetData(f,Z))});let a=Xh(),I=Hr();if(t.documentUpdates.forEach(D=>{t.resolvedLimboDocuments.has(D)&&x.push(r.persistence.referenceDelegate.updateLimboDocument(f,D))}),x.push(Ofe(f,_,t.documentUpdates).next(D=>{a=D.Ps,I=D.Is})),!s.isEqual(Cr.min())){const D=r.Ur.getLastRemoteSnapshotVersion(f).next(O=>r.Ur.setTargetsMetadata(f,f.currentSequenceNumber,s));x.push(D)}return tn.waitFor(x).next(()=>_.apply(f)).next(()=>r.localDocuments.getLocalViewOfDocuments(f,a,I)).next(()=>a)}).then(f=>(r.os=c,f))}function Ofe(e,t,r){let s=Hr(),c=Hr();return r.forEach(f=>s=s.add(f)),t.getEntries(e,s).next(f=>{let _=Xh();return r.forEach((x,a)=>{const I=f.get(x);a.isFoundDocument()!==I.isFoundDocument()&&(c=c.add(x)),a.isNoDocument()&&a.version.isEqual(Cr.min())?(t.removeEntry(x,a.readTime),_=_.insert(x,a)):!I.isValidDocument()||a.version.compareTo(I.version)>0||a.version.compareTo(I.version)===0&&I.hasPendingWrites?(t.addEntry(a),_=_.insert(x,a)):Un("LocalStore","Ignoring outdated watch update for ",x,". Current version:",I.version," Watch version:",a.version)}),{Ps:_,Is:c}})}function Lfe(e,t){const r=Ar(e);return r.persistence.runTransaction("Get next mutation batch","readonly",s=>(t===void 0&&(t=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(s,t)))}function zfe(e,t){const r=Ar(e);return r.persistence.runTransaction("Allocate target","readwrite",s=>{let c;return r.Ur.getTargetData(s,t).next(f=>f?(c=f,tn.resolve(c)):r.Ur.allocateTargetId(s).next(_=>(c=new pf(t,_,"TargetPurposeListen",s.currentSequenceNumber),r.Ur.addTargetData(s,c).next(()=>c))))}).then(s=>{const c=r.os.get(s.targetId);return(c===null||s.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(r.os=r.os.insert(s.targetId,s),r._s.set(t,s.targetId)),s})}async function wk(e,t,r){const s=Ar(e),c=s.os.get(t),f=r?"readwrite":"readwrite-primary";try{r||await s.persistence.runTransaction("Release target",f,_=>s.persistence.referenceDelegate.removeTarget(_,c))}catch(_){if(!ib(_))throw _;Un("LocalStore",`Failed to update sequence numbers for target ${t}: ${_}`)}s.os=s.os.remove(t),s._s.delete(c.target)}function pU(e,t,r){const s=Ar(e);let c=Cr.min(),f=Hr();return s.persistence.runTransaction("Execute query","readwrite",_=>function(a,I,D){const O=Ar(a),F=O._s.get(D);return F!==void 0?tn.resolve(O.os.get(F)):O.Ur.getTargetData(I,D)}(s,_,Fu(t)).next(x=>{if(x)return c=x.lastLimboFreeSnapshotVersion,s.Ur.getMatchingKeysForTargetId(_,x.targetId).next(a=>{f=a})}).next(()=>s.ss.getDocumentsMatchingQuery(_,t,r?c:Cr.min(),r?f:Hr())).next(x=>(Nfe(s,Cde(t),x),{documents:x,Ts:f})))}function Nfe(e,t,r){let s=e.us.get(t)||Cr.min();r.forEach((c,f)=>{f.readTime.compareTo(s)>0&&(s=f.readTime)}),e.us.set(t,s)}class mU{constructor(){this.activeTargetIds=Dde()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ffe{constructor(){this.so=new mU,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,r,s){}addLocalQueryTarget(t){return this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,r,s){this.oo[t]=r}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new mU,Promise.resolve()}handleUserChange(t,r,s){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bfe{_o(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Un("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ho)t(0)}lo(){Un("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ho)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let UT=null;function pR(){return UT===null?UT=function(){return 268435456+Math.round(2147483648*Math.random())}():UT++,"0x"+UT.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jfe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ufe{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go="WebChannelConnection";class Vfe extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const s=r.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),f=encodeURIComponent(this.databaseId.database);this.Do=s+"://"+r.host,this.vo=`projects/${c}/databases/${f}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${f}`}get Fo(){return!1}Mo(r,s,c,f,_){const x=pR(),a=this.xo(r,s.toUriEncodedString());Un("RestConnection",`Sending RPC '${r}' ${x}:`,a,c);const I={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(I,f,_),this.No(r,a,I,c).then(D=>(Un("RestConnection",`Received RPC '${r}' ${x}: `,D),D),D=>{throw Iy("RestConnection",`RPC '${r}' ${x} failed with error: `,D,"url: ",a,"request:",c),D})}Lo(r,s,c,f,_,x){return this.Mo(r,s,c,f,_)}Oo(r,s,c){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Yy}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((f,_)=>r[_]=f),c&&c.headers.forEach((f,_)=>r[_]=f)}xo(r,s){const c=jfe[r];return`${this.Do}/v1/${s}:${c}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,r,s,c){const f=pR();return new Promise((_,x)=>{const a=new RG;a.setWithCredentials(!0),a.listenOnce(kG.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case bE.NO_ERROR:const D=a.getResponseJson();Un(Go,`XHR for RPC '${t}' ${f} received:`,JSON.stringify(D)),_(D);break;case bE.TIMEOUT:Un(Go,`RPC '${t}' ${f} timed out`),x(new Pn(Zt.DEADLINE_EXCEEDED,"Request time out"));break;case bE.HTTP_ERROR:const O=a.getStatus();if(Un(Go,`RPC '${t}' ${f} failed with status:`,O,"response text:",a.getResponseText()),O>0){let F=a.getResponseJson();Array.isArray(F)&&(F=F[0]);const Z=F==null?void 0:F.error;if(Z&&Z.status&&Z.message){const J=function(ne){const G=ne.toLowerCase().replace(/_/g,"-");return Object.values(Zt).indexOf(G)>=0?G:Zt.UNKNOWN}(Z.status);x(new Pn(J,Z.message))}else x(new Pn(Zt.UNKNOWN,"Server responded with status "+a.getStatus()))}else x(new Pn(Zt.UNAVAILABLE,"Connection failed."));break;default:Tr()}}finally{Un(Go,`RPC '${t}' ${f} completed.`)}});const I=JSON.stringify(c);Un(Go,`RPC '${t}' ${f} sending request:`,c),a.send(r,"POST",I,s,15)})}Bo(t,r,s){const c=pR(),f=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],_=LG(),x=OG(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},I=this.longPollingOptions.timeoutSeconds;I!==void 0&&(a.longPollingTimeout=Math.round(1e3*I)),this.useFetchStreams&&(a.xmlHttpFactory=new MG({})),this.Oo(a.initMessageHeaders,r,s),a.encodeInitMessageHeaders=!0;const D=f.join("");Un(Go,`Creating RPC '${t}' stream ${c}: ${D}`,a);const O=_.createWebChannel(D,a);let F=!1,Z=!1;const J=new Ufe({Io:ne=>{Z?Un(Go,`Not sending because RPC '${t}' stream ${c} is closed:`,ne):(F||(Un(Go,`Opening RPC '${t}' stream ${c} transport.`),O.open(),F=!0),Un(Go,`RPC '${t}' stream ${c} sending:`,ne),O.send(ne))},To:()=>O.close()}),re=(ne,G,Y)=>{ne.listen(G,Q=>{try{Y(Q)}catch(de){setTimeout(()=>{throw de},0)}})};return re(O,s1.EventType.OPEN,()=>{Z||(Un(Go,`RPC '${t}' stream ${c} transport opened.`),J.yo())}),re(O,s1.EventType.CLOSE,()=>{Z||(Z=!0,Un(Go,`RPC '${t}' stream ${c} transport closed`),J.So())}),re(O,s1.EventType.ERROR,ne=>{Z||(Z=!0,Iy(Go,`RPC '${t}' stream ${c} transport errored:`,ne),J.So(new Pn(Zt.UNAVAILABLE,"The operation could not be completed")))}),re(O,s1.EventType.MESSAGE,ne=>{var G;if(!Z){const Y=ne.data[0];Ni(!!Y);const Q=Y,de=Q.error||((G=Q[0])===null||G===void 0?void 0:G.error);if(de){Un(Go,`RPC '${t}' stream ${c} received error:`,de);const Te=de.status;let we=function(X){const ge=Zs[X];if(ge!==void 0)return oW(ge)}(Te),oe=de.message;we===void 0&&(we=Zt.INTERNAL,oe="Unknown error status: "+Te+" with message "+de.message),Z=!0,J.So(new Pn(we,oe)),O.close()}else Un(Go,`RPC '${t}' stream ${c} received:`,Y),J.bo(Y)}}),re(x,DG.STAT_EVENT,ne=>{ne.stat===dk.PROXY?Un(Go,`RPC '${t}' stream ${c} detected buffering proxy`):ne.stat===dk.NOPROXY&&Un(Go,`RPC '${t}' stream ${c} detected no buffering proxy`)}),setTimeout(()=>{J.wo()},0),J}}function mR(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aC(e){return new Yde(e,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yW{constructor(t,r,s=1e3,c=1.5,f=6e4){this.ui=t,this.timerId=r,this.ko=s,this.qo=c,this.Qo=f,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();const r=Math.floor(this.Ko+this.zo()),s=Math.max(0,Date.now()-this.Uo),c=Math.max(0,r-s);c>0&&Un("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${s} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vW{constructor(t,r,s,c,f,_,x,a){this.ui=t,this.Ho=s,this.Jo=c,this.connection=f,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=x,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new yW(t,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(t,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():r&&r.code===Zt.RESOURCE_EXHAUSTED?(Zh(r.toString()),Zh("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===Zt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.mo(r)}l_(){}auth(){this.state=1;const t=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,c])=>{this.Yo===r&&this.P_(s,c)},s=>{t(()=>{const c=new Pn(Zt.UNKNOWN,"Fetching auth token failed: "+s.message);return this.I_(c)})})}P_(t,r){const s=this.h_(this.Yo);this.stream=this.T_(t,r),this.stream.Eo(()=>{s(()=>this.listener.Eo())}),this.stream.Ro(()=>{s(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(c=>{s(()=>this.I_(c))}),this.stream.onMessage(c=>{s(()=>++this.e_==1?this.E_(c):this.onNext(c))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(t){return Un("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return r=>{this.ui.enqueueAndForget(()=>this.Yo===t?r():(Un("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $fe extends vW{constructor(t,r,s,c,f,_){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,s,c,_),this.serializer=f}T_(t,r){return this.connection.Bo("Listen",t,r)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();const r=tfe(this.serializer,t),s=function(f){if(!("targetChange"in f))return Cr.min();const _=f.targetChange;return _.targetIds&&_.targetIds.length?Cr.min():_.readTime?Bu(_.readTime):Cr.min()}(t);return this.listener.d_(r,s)}A_(t){const r={};r.database=bk(this.serializer),r.addTarget=function(f,_){let x;const a=_.target;if(x=gk(a)?{documents:ife(f,a)}:{query:sfe(f,a)._t},x.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){x.resumeToken=cW(f,_.resumeToken);const I=yk(f,_.expectedCount);I!==null&&(x.expectedCount=I)}else if(_.snapshotVersion.compareTo(Cr.min())>0){x.readTime=PS(f,_.snapshotVersion.toTimestamp());const I=yk(f,_.expectedCount);I!==null&&(x.expectedCount=I)}return x}(this.serializer,t);const s=afe(this.serializer,t);s&&(r.labels=s),this.a_(r)}R_(t){const r={};r.database=bk(this.serializer),r.removeTarget=t,this.a_(r)}}class qfe extends vW{constructor(t,r,s,c,f,_){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,s,c,_),this.serializer=f}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,r){return this.connection.Bo("Write",t,r)}E_(t){return Ni(!!t.streamToken),this.lastStreamToken=t.streamToken,Ni(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){Ni(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();const r=rfe(t.writeResults,t.commitTime),s=Bu(t.commitTime);return this.listener.g_(s,r)}p_(){const t={};t.database=bk(this.serializer),this.a_(t)}m_(t){const r={streamToken:this.lastStreamToken,writes:t.map(s=>nfe(this.serializer,s))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gfe extends class{}{constructor(t,r,s,c){super(),this.authCredentials=t,this.appCheckCredentials=r,this.connection=s,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new Pn(Zt.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,r,s,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,_])=>this.connection.Mo(t,vk(r,s),c,f,_)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Zt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new Pn(Zt.UNKNOWN,f.toString())})}Lo(t,r,s,c,f){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([_,x])=>this.connection.Lo(t,vk(r,s),c,_,x,f)).catch(_=>{throw _.name==="FirebaseError"?(_.code===Zt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new Pn(Zt.UNKNOWN,_.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Wfe{constructor(t,r){this.asyncQueue=t,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){const r=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Zh(r),this.D_=!1):Un("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hfe{constructor(t,r,s,c,f){this.localStore=t,this.datastore=r,this.asyncQueue=s,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=f,this.k_._o(_=>{s.enqueueAndForget(async()=>{og(this)&&(Un("RemoteStore","Restarting streams for network reachability change."),await async function(a){const I=Ar(a);I.L_.add(4),await ab(I),I.q_.set("Unknown"),I.L_.delete(4),await lC(I)}(this))})}),this.q_=new Wfe(s,c)}}async function lC(e){if(og(e))for(const t of e.B_)await t(!0)}async function ab(e){for(const t of e.B_)await t(!1)}function xW(e,t){const r=Ar(e);r.N_.has(t.targetId)||(r.N_.set(t.targetId,t),I5(r)?S5(r):t0(r).r_()&&E5(r,t))}function T5(e,t){const r=Ar(e),s=t0(r);r.N_.delete(t),s.r_()&&bW(r,t),r.N_.size===0&&(s.r_()?s.o_():og(r)&&r.q_.set("Unknown"))}function E5(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Cr.min())>0){const r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}t0(e).A_(t)}function bW(e,t){e.Q_.xe(t),t0(e).R_(t)}function S5(e){e.Q_=new Zde({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),t0(e).start(),e.q_.v_()}function I5(e){return og(e)&&!t0(e).n_()&&e.N_.size>0}function og(e){return Ar(e).L_.size===0}function wW(e){e.Q_=void 0}async function Zfe(e){e.q_.set("Online")}async function Xfe(e){e.N_.forEach((t,r)=>{E5(e,t)})}async function Kfe(e,t){wW(e),I5(e)?(e.q_.M_(t),S5(e)):e.q_.set("Unknown")}async function Qfe(e,t,r){if(e.q_.set("Online"),t instanceof lW&&t.state===2&&t.cause)try{await async function(c,f){const _=f.cause;for(const x of f.targetIds)c.N_.has(x)&&(await c.remoteSyncer.rejectListen(x,_),c.N_.delete(x),c.Q_.removeTarget(x))}(e,t)}catch(s){Un("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),s),await RS(e,s)}else if(t instanceof EE?e.Q_.Ke(t):t instanceof aW?e.Q_.He(t):e.Q_.We(t),!r.isEqual(Cr.min()))try{const s=await _W(e.localStore);r.compareTo(s)>=0&&await function(f,_){const x=f.Q_.rt(_);return x.targetChanges.forEach((a,I)=>{if(a.resumeToken.approximateByteSize()>0){const D=f.N_.get(I);D&&f.N_.set(I,D.withResumeToken(a.resumeToken,_))}}),x.targetMismatches.forEach((a,I)=>{const D=f.N_.get(a);if(!D)return;f.N_.set(a,D.withResumeToken(Do.EMPTY_BYTE_STRING,D.snapshotVersion)),bW(f,a);const O=new pf(D.target,a,I,D.sequenceNumber);E5(f,O)}),f.remoteSyncer.applyRemoteEvent(x)}(e,r)}catch(s){Un("RemoteStore","Failed to raise snapshot:",s),await RS(e,s)}}async function RS(e,t,r){if(!ib(t))throw t;e.L_.add(1),await ab(e),e.q_.set("Offline"),r||(r=()=>_W(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{Un("RemoteStore","Retrying IndexedDB access"),await r(),e.L_.delete(1),await lC(e)})}function TW(e,t){return t().catch(r=>RS(e,r,t))}async function cC(e){const t=Ar(e),r=Ff(t);let s=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;Yfe(t);)try{const c=await Lfe(t.localStore,s);if(c===null){t.O_.length===0&&r.o_();break}s=c.batchId,Jfe(t,c)}catch(c){await RS(t,c)}EW(t)&&SW(t)}function Yfe(e){return og(e)&&e.O_.length<10}function Jfe(e,t){e.O_.push(t);const r=Ff(e);r.r_()&&r.V_&&r.m_(t.mutations)}function EW(e){return og(e)&&!Ff(e).n_()&&e.O_.length>0}function SW(e){Ff(e).start()}async function epe(e){Ff(e).p_()}async function tpe(e){const t=Ff(e);for(const r of e.O_)t.m_(r.mutations)}async function npe(e,t,r){const s=e.O_.shift(),c=_5.from(s,t,r);await TW(e,()=>e.remoteSyncer.applySuccessfulWrite(c)),await cC(e)}async function rpe(e,t){t&&Ff(e).V_&&await async function(s,c){if(function(_){return Gde(_)&&_!==Zt.ABORTED}(c.code)){const f=s.O_.shift();Ff(s).s_(),await TW(s,()=>s.remoteSyncer.rejectFailedWrite(f.batchId,c)),await cC(s)}}(e,t),EW(e)&&SW(e)}async function _U(e,t){const r=Ar(e);r.asyncQueue.verifyOperationInProgress(),Un("RemoteStore","RemoteStore received new credentials");const s=og(r);r.L_.add(3),await ab(r),s&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.L_.delete(3),await lC(r)}async function ipe(e,t){const r=Ar(e);t?(r.L_.delete(2),await lC(r)):t||(r.L_.add(2),await ab(r),r.q_.set("Unknown"))}function t0(e){return e.K_||(e.K_=function(r,s,c){const f=Ar(r);return f.w_(),new $fe(s,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,c)}(e.datastore,e.asyncQueue,{Eo:Zfe.bind(null,e),Ro:Xfe.bind(null,e),mo:Kfe.bind(null,e),d_:Qfe.bind(null,e)}),e.B_.push(async t=>{t?(e.K_.s_(),I5(e)?S5(e):e.q_.set("Unknown")):(await e.K_.stop(),wW(e))})),e.K_}function Ff(e){return e.U_||(e.U_=function(r,s,c){const f=Ar(r);return f.w_(),new qfe(s,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,c)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:epe.bind(null,e),mo:rpe.bind(null,e),f_:tpe.bind(null,e),g_:npe.bind(null,e)}),e.B_.push(async t=>{t?(e.U_.s_(),await cC(e)):(await e.U_.stop(),e.O_.length>0&&(Un("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))})),e.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(t,r,s,c,f){this.asyncQueue=t,this.timerId=r,this.targetTimeMs=s,this.op=c,this.removalCallback=f,this.deferred=new Bh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(_=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,r,s,c,f){const _=Date.now()+s,x=new C5(t,r,_,c,f);return x.start(s),x}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Pn(Zt.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function A5(e,t){if(Zh("AsyncQueue",`${t}: ${e}`),ib(e))return new Pn(Zt.UNAVAILABLE,`${t}: ${e}`);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(t){this.comparator=t?(r,s)=>t(r,s)||nr.comparator(r.key,s.key):(r,s)=>nr.comparator(r.key,s.key),this.keyedMap=o1(),this.sortedSet=new bs(this.comparator)}static emptySet(t){return new ly(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const r=this.keyedMap.get(t);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((r,s)=>(t(r),!1))}add(t){const r=this.delete(t.key);return r.copy(r.keyedMap.insert(t.key,t),r.sortedSet.insert(t,null))}delete(t){const r=this.get(t);return r?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(r)):this}isEqual(t){if(!(t instanceof ly)||this.size!==t.size)return!1;const r=this.sortedSet.getIterator(),s=t.sortedSet.getIterator();for(;r.hasNext();){const c=r.getNext().key,f=s.getNext().key;if(!c.isEqual(f))return!1}return!0}toString(){const t=[];return this.forEach(r=>{t.push(r.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,r){const s=new ly;return s.comparator=this.comparator,s.keyedMap=t,s.sortedSet=r,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yU{constructor(){this.W_=new bs(nr.comparator)}track(t){const r=t.doc.key,s=this.W_.get(r);s?t.type!==0&&s.type===3?this.W_=this.W_.insert(r,t):t.type===3&&s.type!==1?this.W_=this.W_.insert(r,{type:s.type,doc:t.doc}):t.type===2&&s.type===2?this.W_=this.W_.insert(r,{type:2,doc:t.doc}):t.type===2&&s.type===0?this.W_=this.W_.insert(r,{type:0,doc:t.doc}):t.type===1&&s.type===0?this.W_=this.W_.remove(r):t.type===1&&s.type===2?this.W_=this.W_.insert(r,{type:1,doc:s.doc}):t.type===0&&s.type===1?this.W_=this.W_.insert(r,{type:2,doc:t.doc}):Tr():this.W_=this.W_.insert(r,t)}G_(){const t=[];return this.W_.inorderTraversal((r,s)=>{t.push(s)}),t}}class Dy{constructor(t,r,s,c,f,_,x,a,I){this.query=t,this.docs=r,this.oldDocs=s,this.docChanges=c,this.mutatedKeys=f,this.fromCache=_,this.syncStateChanged=x,this.excludesMetadataChanges=a,this.hasCachedResults=I}static fromInitialDocuments(t,r,s,c,f){const _=[];return r.forEach(x=>{_.push({type:0,doc:x})}),new Dy(t,r,ly.emptySet(r),_,s,c,!0,!1,f)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&nC(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const r=this.docChanges,s=t.docChanges;if(r.length!==s.length)return!1;for(let c=0;c<r.length;c++)if(r[c].type!==s[c].type||!r[c].doc.isEqual(s[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class spe{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(t=>t.J_())}}class ope{constructor(){this.queries=vU(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,s){const c=Ar(r),f=c.queries;c.queries=vU(),f.forEach((_,x)=>{for(const a of x.j_)a.onError(s)})})(this,new Pn(Zt.ABORTED,"Firestore shutting down"))}}function vU(){return new e0(e=>ZG(e),nC)}async function P5(e,t){const r=Ar(e);let s=3;const c=t.query;let f=r.queries.get(c);f?!f.H_()&&t.J_()&&(s=2):(f=new spe,s=t.J_()?0:1);try{switch(s){case 0:f.z_=await r.onListen(c,!0);break;case 1:f.z_=await r.onListen(c,!1);break;case 2:await r.onFirstRemoteStoreListen(c)}}catch(_){const x=A5(_,`Initialization of query '${P_(t.query)}' failed`);return void t.onError(x)}r.queries.set(c,f),f.j_.push(t),t.Z_(r.onlineState),f.z_&&t.X_(f.z_)&&M5(r)}async function R5(e,t){const r=Ar(e),s=t.query;let c=3;const f=r.queries.get(s);if(f){const _=f.j_.indexOf(t);_>=0&&(f.j_.splice(_,1),f.j_.length===0?c=t.J_()?0:1:!f.H_()&&t.J_()&&(c=2))}switch(c){case 0:return r.queries.delete(s),r.onUnlisten(s,!0);case 1:return r.queries.delete(s),r.onUnlisten(s,!1);case 2:return r.onLastRemoteStoreUnlisten(s);default:return}}function ape(e,t){const r=Ar(e);let s=!1;for(const c of t){const f=c.query,_=r.queries.get(f);if(_){for(const x of _.j_)x.X_(c)&&(s=!0);_.z_=c}}s&&M5(r)}function lpe(e,t,r){const s=Ar(e),c=s.queries.get(t);if(c)for(const f of c.j_)f.onError(r);s.queries.delete(t)}function M5(e){e.Y_.forEach(t=>{t.next()})}var Tk,xU;(xU=Tk||(Tk={})).ea="default",xU.Cache="cache";class k5{constructor(t,r,s){this.query=t,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=s||{}}X_(t){if(!this.options.includeMetadataChanges){const s=[];for(const c of t.docChanges)c.type!==3&&s.push(c);t=new Dy(t.query,t.docs,t.oldDocs,s,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let r=!1;return this.na?this.ia(t)&&(this.ta.next(t),r=!0):this.sa(t,this.onlineState)&&(this.oa(t),r=!0),this.ra=t,r}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),r=!0),r}sa(t,r){if(!t.fromCache||!this.J_())return!0;const s=r!=="Offline";return(!this.options._a||!s)&&(!t.docs.isEmpty()||t.hasCachedResults||r==="Offline")}ia(t){if(t.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(t){t=Dy.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==Tk.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IW{constructor(t){this.key=t}}class CW{constructor(t){this.key=t}}class cpe{constructor(t,r){this.query=t,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Hr(),this.mutatedKeys=Hr(),this.Aa=XG(t),this.Ra=new ly(this.Aa)}get Va(){return this.Ta}ma(t,r){const s=r?r.fa:new yU,c=r?r.Ra:this.Ra;let f=r?r.mutatedKeys:this.mutatedKeys,_=c,x=!1;const a=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,I=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(t.inorderTraversal((D,O)=>{const F=c.get(D),Z=rC(this.query,O)?O:null,J=!!F&&this.mutatedKeys.has(F.key),re=!!Z&&(Z.hasLocalMutations||this.mutatedKeys.has(Z.key)&&Z.hasCommittedMutations);let ne=!1;F&&Z?F.data.isEqual(Z.data)?J!==re&&(s.track({type:3,doc:Z}),ne=!0):this.ga(F,Z)||(s.track({type:2,doc:Z}),ne=!0,(a&&this.Aa(Z,a)>0||I&&this.Aa(Z,I)<0)&&(x=!0)):!F&&Z?(s.track({type:0,doc:Z}),ne=!0):F&&!Z&&(s.track({type:1,doc:F}),ne=!0,(a||I)&&(x=!0)),ne&&(Z?(_=_.add(Z),f=re?f.add(D):f.delete(D)):(_=_.delete(D),f=f.delete(D)))}),this.query.limit!==null)for(;_.size>this.query.limit;){const D=this.query.limitType==="F"?_.last():_.first();_=_.delete(D.key),f=f.delete(D.key),s.track({type:1,doc:D})}return{Ra:_,fa:s,ns:x,mutatedKeys:f}}ga(t,r){return t.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(t,r,s,c){const f=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;const _=t.fa.G_();_.sort((D,O)=>function(Z,J){const re=ne=>{switch(ne){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Tr()}};return re(Z)-re(J)}(D.type,O.type)||this.Aa(D.doc,O.doc)),this.pa(s),c=c!=null&&c;const x=r&&!c?this.ya():[],a=this.da.size===0&&this.current&&!c?1:0,I=a!==this.Ea;return this.Ea=a,_.length!==0||I?{snapshot:new Dy(this.query,t.Ra,f,_,t.mutatedKeys,a===0,I,!1,!!s&&s.resumeToken.approximateByteSize()>0),wa:x}:{wa:x}}Z_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new yU,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),t.modifiedDocuments.forEach(r=>{}),t.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=t.current)}ya(){if(!this.current)return[];const t=this.da;this.da=Hr(),this.Ra.forEach(s=>{this.Sa(s.key)&&(this.da=this.da.add(s.key))});const r=[];return t.forEach(s=>{this.da.has(s)||r.push(new CW(s))}),this.da.forEach(s=>{t.has(s)||r.push(new IW(s))}),r}ba(t){this.Ta=t.Ts,this.da=Hr();const r=this.ma(t.documents);return this.applyChanges(r,!0)}Da(){return Dy.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class upe{constructor(t,r,s){this.query=t,this.targetId=r,this.view=s}}class hpe{constructor(t){this.key=t,this.va=!1}}class dpe{constructor(t,r,s,c,f,_){this.localStore=t,this.remoteStore=r,this.eventManager=s,this.sharedClientState=c,this.currentUser=f,this.maxConcurrentLimboResolutions=_,this.Ca={},this.Fa=new e0(x=>ZG(x),nC),this.Ma=new Map,this.xa=new Set,this.Oa=new bs(nr.comparator),this.Na=new Map,this.La=new x5,this.Ba={},this.ka=new Map,this.qa=ky.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function fpe(e,t,r=!0){const s=DW(e);let c;const f=s.Fa.get(t);return f?(s.sharedClientState.addLocalQueryTarget(f.targetId),c=f.view.Da()):c=await AW(s,t,r,!0),c}async function ppe(e,t){const r=DW(e);await AW(r,t,!0,!1)}async function AW(e,t,r,s){const c=await zfe(e.localStore,Fu(t)),f=c.targetId,_=r?e.sharedClientState.addLocalQueryTarget(f):"not-current";let x;return s&&(x=await mpe(e,t,f,_==="current",c.resumeToken)),e.isPrimaryClient&&r&&xW(e.remoteStore,c),x}async function mpe(e,t,r,s,c){e.Ka=(O,F,Z)=>async function(re,ne,G,Y){let Q=ne.view.ma(G);Q.ns&&(Q=await pU(re.localStore,ne.query,!1).then(({documents:oe})=>ne.view.ma(oe,Q)));const de=Y&&Y.targetChanges.get(ne.targetId),Te=Y&&Y.targetMismatches.get(ne.targetId)!=null,we=ne.view.applyChanges(Q,re.isPrimaryClient,de,Te);return wU(re,ne.targetId,we.wa),we.snapshot}(e,O,F,Z);const f=await pU(e.localStore,t,!0),_=new cpe(t,f.Ts),x=_.ma(f.documents),a=ob.createSynthesizedTargetChangeForCurrentChange(r,s&&e.onlineState!=="Offline",c),I=_.applyChanges(x,e.isPrimaryClient,a);wU(e,r,I.wa);const D=new upe(t,r,_);return e.Fa.set(t,D),e.Ma.has(r)?e.Ma.get(r).push(t):e.Ma.set(r,[t]),I.snapshot}async function gpe(e,t,r){const s=Ar(e),c=s.Fa.get(t),f=s.Ma.get(c.targetId);if(f.length>1)return s.Ma.set(c.targetId,f.filter(_=>!nC(_,t))),void s.Fa.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(c.targetId),s.sharedClientState.isActiveQueryTarget(c.targetId)||await wk(s.localStore,c.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(c.targetId),r&&T5(s.remoteStore,c.targetId),Ek(s,c.targetId)}).catch(rb)):(Ek(s,c.targetId),await wk(s.localStore,c.targetId,!0))}async function _pe(e,t){const r=Ar(e),s=r.Fa.get(t),c=r.Ma.get(s.targetId);r.isPrimaryClient&&c.length===1&&(r.sharedClientState.removeLocalQueryTarget(s.targetId),T5(r.remoteStore,s.targetId))}async function ype(e,t,r){const s=Spe(e);try{const c=await function(_,x){const a=Ar(_),I=ho.now(),D=x.reduce((Z,J)=>Z.add(J.key),Hr());let O,F;return a.persistence.runTransaction("Locally write mutations","readwrite",Z=>{let J=Xh(),re=Hr();return a.cs.getEntries(Z,D).next(ne=>{J=ne,J.forEach((G,Y)=>{Y.isValidDocument()||(re=re.add(G))})}).next(()=>a.localDocuments.getOverlayedDocuments(Z,J)).next(ne=>{O=ne;const G=[];for(const Y of x){const Q=jde(Y,O.get(Y.key).overlayedDocument);Q!=null&&G.push(new Yf(Y.key,Q,jG(Q.value.mapValue),Zl.exists(!0)))}return a.mutationQueue.addMutationBatch(Z,I,G,x)}).next(ne=>{F=ne;const G=ne.applyToLocalDocumentSet(O,re);return a.documentOverlayCache.saveOverlays(Z,ne.batchId,G)})}).then(()=>({batchId:F.batchId,changes:QG(O)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(c.batchId),function(_,x,a){let I=_.Ba[_.currentUser.toKey()];I||(I=new bs(si)),I=I.insert(x,a),_.Ba[_.currentUser.toKey()]=I}(s,c.batchId,r),await lb(s,c.changes),await cC(s.remoteStore)}catch(c){const f=A5(c,"Failed to persist write");r.reject(f)}}async function PW(e,t){const r=Ar(e);try{const s=await Dfe(r.localStore,t);t.targetChanges.forEach((c,f)=>{const _=r.Na.get(f);_&&(Ni(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?_.va=!0:c.modifiedDocuments.size>0?Ni(_.va):c.removedDocuments.size>0&&(Ni(_.va),_.va=!1))}),await lb(r,s,t)}catch(s){await rb(s)}}function bU(e,t,r){const s=Ar(e);if(s.isPrimaryClient&&r===0||!s.isPrimaryClient&&r===1){const c=[];s.Fa.forEach((f,_)=>{const x=_.view.Z_(t);x.snapshot&&c.push(x.snapshot)}),function(_,x){const a=Ar(_);a.onlineState=x;let I=!1;a.queries.forEach((D,O)=>{for(const F of O.j_)F.Z_(x)&&(I=!0)}),I&&M5(a)}(s.eventManager,t),c.length&&s.Ca.d_(c),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}async function vpe(e,t,r){const s=Ar(e);s.sharedClientState.updateQueryState(t,"rejected",r);const c=s.Na.get(t),f=c&&c.key;if(f){let _=new bs(nr.comparator);_=_.insert(f,Xo.newNoDocument(f,Cr.min()));const x=Hr().add(f),a=new oC(Cr.min(),new Map,new bs(si),_,x);await PW(s,a),s.Oa=s.Oa.remove(f),s.Na.delete(t),D5(s)}else await wk(s.localStore,t,!1).then(()=>Ek(s,t,r)).catch(rb)}async function xpe(e,t){const r=Ar(e),s=t.batch.batchId;try{const c=await kfe(r.localStore,t);MW(r,s,null),RW(r,s),r.sharedClientState.updateMutationState(s,"acknowledged"),await lb(r,c)}catch(c){await rb(c)}}async function bpe(e,t,r){const s=Ar(e);try{const c=await function(_,x){const a=Ar(_);return a.persistence.runTransaction("Reject batch","readwrite-primary",I=>{let D;return a.mutationQueue.lookupMutationBatch(I,x).next(O=>(Ni(O!==null),D=O.keys(),a.mutationQueue.removeMutationBatch(I,O))).next(()=>a.mutationQueue.performConsistencyCheck(I)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(I,D,x)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(I,D)).next(()=>a.localDocuments.getDocuments(I,D))})}(s.localStore,t);MW(s,t,r),RW(s,t),s.sharedClientState.updateMutationState(t,"rejected",r),await lb(s,c)}catch(c){await rb(c)}}function RW(e,t){(e.ka.get(t)||[]).forEach(r=>{r.resolve()}),e.ka.delete(t)}function MW(e,t,r){const s=Ar(e);let c=s.Ba[s.currentUser.toKey()];if(c){const f=c.get(t);f&&(r?f.reject(r):f.resolve(),c=c.remove(t)),s.Ba[s.currentUser.toKey()]=c}}function Ek(e,t,r=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.Ma.get(t))e.Fa.delete(s),r&&e.Ca.$a(s,r);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach(s=>{e.La.containsKey(s)||kW(e,s)})}function kW(e,t){e.xa.delete(t.path.canonicalString());const r=e.Oa.get(t);r!==null&&(T5(e.remoteStore,r),e.Oa=e.Oa.remove(t),e.Na.delete(r),D5(e))}function wU(e,t,r){for(const s of r)s instanceof IW?(e.La.addReference(s.key,t),wpe(e,s)):s instanceof CW?(Un("SyncEngine","Document no longer in limbo: "+s.key),e.La.removeReference(s.key,t),e.La.containsKey(s.key)||kW(e,s.key)):Tr()}function wpe(e,t){const r=t.key,s=r.path.canonicalString();e.Oa.get(r)||e.xa.has(s)||(Un("SyncEngine","New document in limbo: "+r),e.xa.add(s),D5(e))}function D5(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const r=new nr(Ji.fromString(t)),s=e.qa.next();e.Na.set(s,new hpe(r)),e.Oa=e.Oa.insert(r,s),xW(e.remoteStore,new pf(Fu(tC(r.path)),s,"TargetPurposeLimboResolution",l5.oe))}}async function lb(e,t,r){const s=Ar(e),c=[],f=[],_=[];s.Fa.isEmpty()||(s.Fa.forEach((x,a)=>{_.push(s.Ka(a,t,r).then(I=>{var D;if((I||r)&&s.isPrimaryClient){const O=I?!I.fromCache:(D=r==null?void 0:r.targetChanges.get(a.targetId))===null||D===void 0?void 0:D.current;s.sharedClientState.updateQueryState(a.targetId,O?"current":"not-current")}if(I){c.push(I);const O=w5.Wi(a.targetId,I);f.push(O)}}))}),await Promise.all(_),s.Ca.d_(c),await async function(a,I){const D=Ar(a);try{await D.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>tn.forEach(I,F=>tn.forEach(F.$i,Z=>D.persistence.referenceDelegate.addReference(O,F.targetId,Z)).next(()=>tn.forEach(F.Ui,Z=>D.persistence.referenceDelegate.removeReference(O,F.targetId,Z)))))}catch(O){if(!ib(O))throw O;Un("LocalStore","Failed to update sequence numbers: "+O)}for(const O of I){const F=O.targetId;if(!O.fromCache){const Z=D.os.get(F),J=Z.snapshotVersion,re=Z.withLastLimboFreeSnapshotVersion(J);D.os=D.os.insert(F,re)}}}(s.localStore,f))}async function Tpe(e,t){const r=Ar(e);if(!r.currentUser.isEqual(t)){Un("SyncEngine","User change. New user:",t.toKey());const s=await gW(r.localStore,t);r.currentUser=t,function(f,_){f.ka.forEach(x=>{x.forEach(a=>{a.reject(new Pn(Zt.CANCELLED,_))})}),f.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,s.removedBatchIds,s.addedBatchIds),await lb(r,s.hs)}}function Epe(e,t){const r=Ar(e),s=r.Na.get(t);if(s&&s.va)return Hr().add(s.key);{let c=Hr();const f=r.Ma.get(t);if(!f)return c;for(const _ of f){const x=r.Fa.get(_);c=c.unionWith(x.view.Va)}return c}}function DW(e){const t=Ar(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=PW.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Epe.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=vpe.bind(null,t),t.Ca.d_=ape.bind(null,t.eventManager),t.Ca.$a=lpe.bind(null,t.eventManager),t}function Spe(e){const t=Ar(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=xpe.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=bpe.bind(null,t),t}class TU{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=aC(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return Mfe(this.persistence,new Pfe,t.initialUser,this.serializer)}createPersistence(t){return new Ife(b5.Zr,this.serializer)}createSharedClientState(t){return new Ffe}async terminate(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Ipe{async initialize(t,r){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>bU(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Tpe.bind(null,this.syncEngine),await ipe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new ope}()}createDatastore(t){const r=aC(t.databaseInfo.databaseId),s=function(f){return new Vfe(f)}(t.databaseInfo);return function(f,_,x,a){return new Gfe(f,_,x,a)}(t.authCredentials,t.appCheckCredentials,s,r)}createRemoteStore(t){return function(s,c,f,_,x){return new Hfe(s,c,f,_,x)}(this.localStore,this.datastore,t.asyncQueue,r=>bU(this.syncEngine,r,0),function(){return gU.D()?new gU:new Bfe}())}createSyncEngine(t,r){return function(c,f,_,x,a,I,D){const O=new dpe(c,f,_,x,a,I);return D&&(O.Qa=!0),O}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}async terminate(){var t,r;await async function(c){const f=Ar(c);Un("RemoteStore","RemoteStore shutting down."),f.L_.add(5),await ab(f),f.k_.shutdown(),f.q_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O5{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ga(this.observer.next,t)}error(t){this.observer.error?this.Ga(this.observer.error,t):Zh("Uncaught Error in snapshot listener:",t.toString())}za(){this.muted=!0}Ga(t,r){this.muted||setTimeout(()=>{this.muted||t(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cpe{constructor(t,r,s,c){this.authCredentials=t,this.appCheckCredentials=r,this.asyncQueue=s,this.databaseInfo=c,this.user=Ho.UNAUTHENTICATED,this.clientId=NG.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,async f=>{Un("FirestoreClient","Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(s,f=>(Un("FirestoreClient","Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Pn(Zt.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Bh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=A5(r,"Failed to shutdown persistence");t.reject(s)}}),t.promise}}async function gR(e,t){e.asyncQueue.verifyOperationInProgress(),Un("FirestoreClient","Initializing OfflineComponentProvider");const r=e.configuration;await t.initialize(r);let s=r.initialUser;e.setCredentialChangeListener(async c=>{s.isEqual(c)||(await gW(t.localStore,c),s=c)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function EU(e,t){e.asyncQueue.verifyOperationInProgress();const r=await Ppe(e);Un("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(s=>_U(t.remoteStore,s)),e.setAppCheckTokenChangeListener((s,c)=>_U(t.remoteStore,c)),e._onlineComponents=t}function Ape(e){return e.name==="FirebaseError"?e.code===Zt.FAILED_PRECONDITION||e.code===Zt.UNIMPLEMENTED:!(typeof DOMException<"u"&&e instanceof DOMException)||e.code===22||e.code===20||e.code===11}async function Ppe(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Un("FirestoreClient","Using user provided OfflineComponentProvider");try{await gR(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!Ape(r))throw r;Iy("Error using user provided cache. Falling back to memory cache: "+r),await gR(e,new TU)}}else Un("FirestoreClient","Using default OfflineComponentProvider"),await gR(e,new TU);return e._offlineComponents}async function OW(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Un("FirestoreClient","Using user provided OnlineComponentProvider"),await EU(e,e._uninitializedComponentsProvider._online)):(Un("FirestoreClient","Using default OnlineComponentProvider"),await EU(e,new Ipe))),e._onlineComponents}function Rpe(e){return OW(e).then(t=>t.syncEngine)}async function MS(e){const t=await OW(e),r=t.eventManager;return r.onListen=fpe.bind(null,t.syncEngine),r.onUnlisten=gpe.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=ppe.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=_pe.bind(null,t.syncEngine),r}function Mpe(e,t,r={}){const s=new Bh;return e.asyncQueue.enqueueAndForget(async()=>function(f,_,x,a,I){const D=new O5({next:F=>{_.enqueueAndForget(()=>R5(f,O));const Z=F.docs.has(x);!Z&&F.fromCache?I.reject(new Pn(Zt.UNAVAILABLE,"Failed to get document because the client is offline.")):Z&&F.fromCache&&a&&a.source==="server"?I.reject(new Pn(Zt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):I.resolve(F)},error:F=>I.reject(F)}),O=new k5(tC(x.path),D,{includeMetadataChanges:!0,_a:!0});return P5(f,O)}(await MS(e),e.asyncQueue,t,r,s)),s.promise}function kpe(e,t,r={}){const s=new Bh;return e.asyncQueue.enqueueAndForget(async()=>function(f,_,x,a,I){const D=new O5({next:F=>{_.enqueueAndForget(()=>R5(f,O)),F.fromCache&&a.source==="server"?I.reject(new Pn(Zt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):I.resolve(F)},error:F=>I.reject(F)}),O=new k5(x,D,{includeMetadataChanges:!0,_a:!0});return P5(f,O)}(await MS(e),e.asyncQueue,t,r,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LW(e){const t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SU=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zW(e,t,r){if(!r)throw new Pn(Zt.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Dpe(e,t,r,s){if(t===!0&&s===!0)throw new Pn(Zt.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function IU(e){if(!nr.isDocumentKey(e))throw new Pn(Zt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function CU(e){if(nr.isDocumentKey(e))throw new Pn(Zt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function uC(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{const t=function(s){return s.constructor?s.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":Tr()}function $a(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Pn(Zt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=uC(e);throw new Pn(Zt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function Ope(e,t){if(t<=0)throw new Pn(Zt.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(t){var r,s;if(t.host===void 0){if(t.ssl!==void 0)throw new Pn(Zt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(r=t.ssl)===null||r===void 0||r;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new Pn(Zt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Dpe("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=LW((s=t.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(f){if(f.timeoutSeconds!==void 0){if(isNaN(f.timeoutSeconds))throw new Pn(Zt.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (must not be NaN)`);if(f.timeoutSeconds<5)throw new Pn(Zt.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (minimum allowed value is 5)`);if(f.timeoutSeconds>30)throw new Pn(Zt.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(s,c){return s.timeoutSeconds===c.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class hC{constructor(t,r,s,c){this._authCredentials=t,this._appCheckCredentials=r,this._databaseId=s,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new AU({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Pn(Zt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new Pn(Zt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new AU(t),t.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new Xhe;switch(s.type){case"firstParty":return new Jhe(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Pn(Zt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const s=SU.get(r);s&&(Un("ComponentProvider","Removing Datastore"),SU.delete(r),s.terminate())}(this),Promise.resolve()}}function Lpe(e,t,r,s={}){var c;const f=(e=$a(e,hC))._getSettings(),_=`${t}:${r}`;if(f.host!=="firestore.googleapis.com"&&f.host!==_&&Iy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},f),{host:_,ssl:!1})),s.mockUserToken){let x,a;if(typeof s.mockUserToken=="string")x=s.mockUserToken,a=Ho.MOCK_USER;else{x=$q(s.mockUserToken,(c=e._app)===null||c===void 0?void 0:c.options.projectId);const I=s.mockUserToken.sub||s.mockUserToken.user_id;if(!I)throw new Pn(Zt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Ho(I)}e._authCredentials=new Khe(new zG(x,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(t,r,s){this.converter=r,this._query=s,this.type="query",this.firestore=t}withConverter(t){return new rd(this.firestore,t,this._query)}}class Ko{constructor(t,r,s){this.converter=r,this._key=s,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rf(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ko(this.firestore,t,this._key)}}class Rf extends rd{constructor(t,r,s){super(t,r,tC(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ko(this.firestore,null,new nr(t))}withConverter(t){return new Rf(this.firestore,t,this._path)}}function vi(e,t,...r){if(e=Os(e),zW("collection","path",t),e instanceof hC){const s=Ji.fromString(t,...r);return CU(s),new Rf(e,null,s)}{if(!(e instanceof Ko||e instanceof Rf))throw new Pn(Zt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(Ji.fromString(t,...r));return CU(s),new Rf(e.firestore,null,s)}}function Zn(e,t,...r){if(e=Os(e),arguments.length===1&&(t=NG.newId()),zW("doc","path",t),e instanceof hC){const s=Ji.fromString(t,...r);return IU(s),new Ko(e,null,new nr(s))}{if(!(e instanceof Ko||e instanceof Rf))throw new Pn(Zt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(Ji.fromString(t,...r));return IU(s),new Ko(e.firestore,e instanceof Rf?e.converter:null,new nr(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zpe{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new yW(this,"async_queue_retry"),this.Eu=()=>{const r=mR();r&&Un("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()};const t=mR();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.du(),this.Au(t)}enterRestrictedMode(t){if(!this.cu){this.cu=!0,this.Iu=t||!1;const r=mR();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Eu)}}enqueue(t){if(this.du(),this.cu)return new Promise(()=>{});const r=new Bh;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(t().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.uu.push(t),this.Ru()))}async Ru(){if(this.uu.length!==0){try{await this.uu[0](),this.uu.shift(),this.t_.reset()}catch(t){if(!ib(t))throw t;Un("AsyncQueue","Operation failed with retryable error: "+t)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}}Au(t){const r=this.au.then(()=>(this.Pu=!0,t().catch(s=>{this.hu=s,this.Pu=!1;const c=function(_){let x=_.message||"";return _.stack&&(x=_.stack.includes(_.message)?_.stack:_.message+`
`+_.stack),x}(s);throw Zh("INTERNAL UNHANDLED ERROR: ",c),s}).then(s=>(this.Pu=!1,s))));return this.au=r,r}enqueueAfterDelay(t,r,s){this.du(),this.Tu.indexOf(t)>-1&&(r=0);const c=C5.createAndSchedule(this,t,r,s,f=>this.Vu(f));return this.lu.push(c),c}du(){this.hu&&Tr()}verifyOperationInProgress(){}async mu(){let t;do t=this.au,await t;while(t!==this.au)}fu(t){for(const r of this.lu)if(r.timerId===t)return!0;return!1}gu(t){return this.mu().then(()=>{this.lu.sort((r,s)=>r.targetTimeMs-s.targetTimeMs);for(const r of this.lu)if(r.skipDelay(),t!=="all"&&r.timerId===t)break;return this.mu()})}pu(t){this.Tu.push(t)}Vu(t){const r=this.lu.indexOf(t);this.lu.splice(r,1)}}function PU(e){return function(r,s){if(typeof r!="object"||r===null)return!1;const c=r;for(const f of s)if(f in c&&typeof c[f]=="function")return!0;return!1}(e,["next","error","complete"])}class Kh extends hC{constructor(t,r,s,c){super(t,r,s,c),this.type="firestore",this._queue=function(){return new zpe}(),this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||NW(this),this._firestoreClient.terminate()}}function Npe(e,t){const r=typeof e=="object"?e:XD(),s=typeof e=="string"?e:"(default)",c=KI(r,"firestore").getImmediate({identifier:s});if(!c._initialized){const f=jq("firestore");f&&Lpe(c,...f)}return c}function dC(e){return e._firestoreClient||NW(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function NW(e){var t,r,s;const c=e._freezeSettings(),f=function(x,a,I,D){return new dde(x,a,I,D.host,D.ssl,D.experimentalForceLongPolling,D.experimentalAutoDetectLongPolling,LW(D.experimentalLongPollingOptions),D.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,c);e._firestoreClient=new Cpe(e._authCredentials,e._appCheckCredentials,e._queue,f),!((r=c.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((s=c.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:c.localCache.kind,_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oy{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Oy(Do.fromBase64String(t))}catch(r){throw new Pn(Zt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(t){return new Oy(Do.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{constructor(...t){for(let r=0;r<t.length;++r)if(t[r].length===0)throw new Pn(Zt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Po(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(t,r){if(!isFinite(t)||t<-90||t>90)throw new Pn(Zt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(r)||r<-180||r>180)throw new Pn(Zt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=t,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return si(this._lat,t._lat)||si(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z5{constructor(t){this._values=(t||[]).map(r=>r)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(s,c){if(s.length!==c.length)return!1;for(let f=0;f<s.length;++f)if(s[f]!==c[f])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fpe=/^__.*__$/;class Bpe{constructor(t,r,s){this.data=t,this.fieldMask=r,this.fieldTransforms=s}toMutation(t,r){return this.fieldMask!==null?new Yf(t,this.data,this.fieldMask,r,this.fieldTransforms):new sb(t,this.data,r,this.fieldTransforms)}}class FW{constructor(t,r,s){this.data=t,this.fieldMask=r,this.fieldTransforms=s}toMutation(t,r){return new Yf(t,this.data,this.fieldMask,r,this.fieldTransforms)}}function BW(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Tr()}}class pC{constructor(t,r,s,c,f,_){this.settings=t,this.databaseId=r,this.serializer=s,this.ignoreUndefinedProperties=c,f===void 0&&this.yu(),this.fieldTransforms=f||[],this.fieldMask=_||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(t){return new pC(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(t){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(t),c=this.Su({path:s,Du:!1});return c.vu(t),c}Cu(t){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(t),c=this.Su({path:s,Du:!1});return c.yu(),c}Fu(t){return this.Su({path:void 0,Du:!0})}Mu(t){return kS(t,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(t){return this.fieldMask.find(r=>t.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>t.isPrefixOf(r.field))!==void 0}yu(){if(this.path)for(let t=0;t<this.path.length;t++)this.vu(this.path.get(t))}vu(t){if(t.length===0)throw this.Mu("Document fields must not be empty");if(BW(this.wu)&&Fpe.test(t))throw this.Mu('Document fields cannot begin and end with "__"')}}class jpe{constructor(t,r,s){this.databaseId=t,this.ignoreUndefinedProperties=r,this.serializer=s||aC(t)}Nu(t,r,s,c=!1){return new pC({wu:t,methodName:r,Ou:s,path:Po.emptyPath(),Du:!1,xu:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function mC(e){const t=e._freezeSettings(),r=aC(e._databaseId);return new jpe(e._databaseId,!!t.ignoreUndefinedProperties,r)}function jW(e,t,r,s,c,f={}){const _=e.Nu(f.merge||f.mergeFields?2:0,t,r,c);j5("Data must be an object, but it was:",_,s);const x=VW(s,_);let a,I;if(f.merge)a=new ll(_.fieldMask),I=_.fieldTransforms;else if(f.mergeFields){const D=[];for(const O of f.mergeFields){const F=Sk(t,O,r);if(!_.contains(F))throw new Pn(Zt.INVALID_ARGUMENT,`Field '${F}' is specified in your field mask but missing from your input data.`);qW(D,F)||D.push(F)}a=new ll(D),I=_.fieldTransforms.filter(O=>a.covers(O.field))}else a=null,I=_.fieldTransforms;return new Bpe(new Na(x),a,I)}class gC extends n0{_toFieldTransform(t){if(t.wu!==2)throw t.wu===1?t.Mu(`${this._methodName}() can only appear at the top level of your update data`):t.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof gC}}function UW(e,t,r){return new pC({wu:3,Ou:t.settings.Ou,methodName:e._methodName,Du:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class N5 extends n0{_toFieldTransform(t){return new m5(t.path,new wx)}isEqual(t){return t instanceof N5}}class F5 extends n0{constructor(t,r){super(t),this.Lu=r}_toFieldTransform(t){const r=UW(this,t,!0),s=this.Lu.map(f=>ag(f,r)),c=new Ry(s);return new m5(t.path,c)}isEqual(t){return t instanceof F5&&Sy(this.Lu,t.Lu)}}class B5 extends n0{constructor(t,r){super(t),this.Lu=r}_toFieldTransform(t){const r=UW(this,t,!0),s=this.Lu.map(f=>ag(f,r)),c=new My(s);return new m5(t.path,c)}isEqual(t){return t instanceof B5&&Sy(this.Lu,t.Lu)}}function Upe(e,t,r,s){const c=e.Nu(1,t,r);j5("Data must be an object, but it was:",c,s);const f=[],_=Na.empty();sg(s,(a,I)=>{const D=U5(t,a,r);I=Os(I);const O=c.Cu(D);if(I instanceof gC)f.push(D);else{const F=ag(I,O);F!=null&&(f.push(D),_.set(D,F))}});const x=new ll(f);return new FW(_,x,c.fieldTransforms)}function Vpe(e,t,r,s,c,f){const _=e.Nu(1,t,r),x=[Sk(t,s,r)],a=[c];if(f.length%2!=0)throw new Pn(Zt.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let F=0;F<f.length;F+=2)x.push(Sk(t,f[F])),a.push(f[F+1]);const I=[],D=Na.empty();for(let F=x.length-1;F>=0;--F)if(!qW(I,x[F])){const Z=x[F];let J=a[F];J=Os(J);const re=_.Cu(Z);if(J instanceof gC)I.push(Z);else{const ne=ag(J,re);ne!=null&&(I.push(Z),D.set(Z,ne))}}const O=new ll(I);return new FW(D,O,_.fieldTransforms)}function $pe(e,t,r,s=!1){return ag(r,e.Nu(s?4:3,t))}function ag(e,t){if($W(e=Os(e)))return j5("Unsupported field value:",t,e),VW(e,t);if(e instanceof n0)return function(s,c){if(!BW(c.wu))throw c.Mu(`${s._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Mu(`${s._methodName}() is not currently supported inside arrays`);const f=s._toFieldTransform(c);f&&c.fieldTransforms.push(f)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Du&&t.wu!==4)throw t.Mu("Nested arrays are not supported");return function(s,c){const f=[];let _=0;for(const x of s){let a=ag(x,c.Fu(_));a==null&&(a={nullValue:"NULL_VALUE"}),f.push(a),_++}return{arrayValue:{values:f}}}(e,t)}return function(s,c){if((s=Os(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Ode(c.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const f=ho.fromDate(s);return{timestampValue:PS(c.serializer,f)}}if(s instanceof ho){const f=new ho(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:PS(c.serializer,f)}}if(s instanceof L5)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Oy)return{bytesValue:cW(c.serializer,s._byteString)};if(s instanceof Ko){const f=c.databaseId,_=s.firestore._databaseId;if(!_.isEqual(f))throw c.Mu(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${f.projectId}/${f.database}`);return{referenceValue:v5(s.firestore._databaseId||c.databaseId,s._key.path)}}if(s instanceof z5)return function(_,x){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:_.toArray().map(a=>{if(typeof a!="number")throw x.Mu("VectorValues must only contain numeric values.");return p5(x.serializer,a)})}}}}}}(s,c);throw c.Mu(`Unsupported field value: ${uC(s)}`)}(e,t)}function VW(e,t){const r={};return FG(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sg(e,(s,c)=>{const f=ag(c,t.bu(s));f!=null&&(r[s]=f)}),{mapValue:{fields:r}}}function $W(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof ho||e instanceof L5||e instanceof Oy||e instanceof Ko||e instanceof n0||e instanceof z5)}function j5(e,t,r){if(!$W(r)||!function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)}(r)){const s=uC(r);throw s==="an object"?t.Mu(e+" a custom object"):t.Mu(e+" "+s)}}function Sk(e,t,r){if((t=Os(t))instanceof fC)return t._internalPath;if(typeof t=="string")return U5(e,t);throw kS("Field path arguments must be of type string or ",e,!1,void 0,r)}const qpe=new RegExp("[~\\*/\\[\\]]");function U5(e,t,r){if(t.search(qpe)>=0)throw kS(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new fC(...t.split("."))._internalPath}catch{throw kS(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function kS(e,t,r,s,c){const f=s&&!s.isEmpty(),_=c!==void 0;let x=`Function ${t}() called with invalid data`;r&&(x+=" (via `toFirestore()`)"),x+=". ";let a="";return(f||_)&&(a+=" (found",f&&(a+=` in field ${s}`),_&&(a+=` in document ${c}`),a+=")"),new Pn(Zt.INVALID_ARGUMENT,x+e+a)}function qW(e,t){return e.some(r=>r.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GW{constructor(t,r,s,c,f){this._firestore=t,this._userDataWriter=r,this._key=s,this._document=c,this._converter=f}get id(){return this._key.path.lastSegment()}get ref(){return new Ko(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Gpe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const r=this._document.data.field(_C("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r)}}}class Gpe extends GW{data(){return super.data()}}function _C(e,t){return typeof t=="string"?U5(e,t):t instanceof fC?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WW(e){if(e.limitType==="L"&&e.explicitOrderBy.length===0)throw new Pn(Zt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class V5{}class $5 extends V5{}function co(e,t,...r){let s=[];t instanceof V5&&s.push(t),s=s.concat(r),function(f){const _=f.filter(a=>a instanceof q5).length,x=f.filter(a=>a instanceof yC).length;if(_>1||_>0&&x>0)throw new Pn(Zt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const c of s)e=c._apply(e);return e}class yC extends $5{constructor(t,r,s){super(),this._field=t,this._op=r,this._value=s,this.type="where"}static _create(t,r,s){return new yC(t,r,s)}_apply(t){const r=this._parse(t);return HW(t._query,r),new rd(t.firestore,t.converter,_k(t._query,r))}_parse(t){const r=mC(t.firestore);return function(f,_,x,a,I,D,O){let F;if(I.isKeyField()){if(D==="array-contains"||D==="array-contains-any")throw new Pn(Zt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${D}' queries on documentId().`);if(D==="in"||D==="not-in"){MU(O,D);const Z=[];for(const J of O)Z.push(RU(a,f,J));F={arrayValue:{values:Z}}}else F=RU(a,f,O)}else D!=="in"&&D!=="not-in"&&D!=="array-contains-any"||MU(O,D),F=$pe(x,_,O,D==="in"||D==="not-in");return Ys.create(I,D,F)}(t._query,"where",r,t.firestore._databaseId,this._field,this._op,this._value)}}function yi(e,t,r){const s=t,c=_C("where",e);return yC._create(c,s,r)}class q5 extends V5{constructor(t,r){super(),this.type=t,this._queryConstraints=r}static _create(t,r){return new q5(t,r)}_parse(t){const r=this._queryConstraints.map(s=>s._parse(t)).filter(s=>s.getFilters().length>0);return r.length===1?r[0]:$c.create(r,this._getOperator())}_apply(t){const r=this._parse(t);return r.getFilters().length===0?t:(function(c,f){let _=c;const x=f.getFlattenedFilters();for(const a of x)HW(_,a),_=_k(_,a)}(t._query,r),new rd(t.firestore,t.converter,_k(t._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class G5 extends $5{constructor(t,r){super(),this._field=t,this._direction=r,this.type="orderBy"}static _create(t,r){return new G5(t,r)}_apply(t){const r=function(c,f,_){if(c.startAt!==null)throw new Pn(Zt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(c.endAt!==null)throw new Pn(Zt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new bx(f,_)}(t._query,this._field,this._direction);return new rd(t.firestore,t.converter,function(c,f){const _=c.explicitOrderBy.concat([f]);return new Jy(c.path,c.collectionGroup,_,c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(t._query,r))}}function Tx(e,t="asc"){const r=t,s=_C("orderBy",e);return G5._create(s,r)}class W5 extends $5{constructor(t,r,s){super(),this.type=t,this._limit=r,this._limitType=s}static _create(t,r,s){return new W5(t,r,s)}_apply(t){return new rd(t.firestore,t.converter,CS(t._query,this._limit,this._limitType))}}function H5(e){return Ope("limit",e),W5._create("limit",e,"F")}function RU(e,t,r){if(typeof(r=Os(r))=="string"){if(r==="")throw new Pn(Zt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!HG(t)&&r.indexOf("/")!==-1)throw new Pn(Zt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const s=t.path.child(Ji.fromString(r));if(!nr.isDocumentKey(s))throw new Pn(Zt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Qj(e,new nr(s))}if(r instanceof Ko)return Qj(e,r._key);throw new Pn(Zt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uC(r)}.`)}function MU(e,t){if(!Array.isArray(e)||e.length===0)throw new Pn(Zt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function HW(e,t){const r=function(c,f){for(const _ of c)for(const x of _.getFlattenedFilters())if(f.indexOf(x.op)>=0)return x.op;return null}(e.filters,function(c){switch(c){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(r!==null)throw r===t.op?new Pn(Zt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Pn(Zt.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}class Wpe{convertValue(t,r="none"){switch(Um(t)){case 0:return null;case 1:return t.booleanValue;case 2:return js(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,r);case 5:return t.stringValue;case 6:return this.convertBytes(jm(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,r);case 11:return this.convertObject(t.mapValue,r);case 10:return this.convertVectorValue(t.mapValue);default:throw Tr()}}convertObject(t,r){return this.convertObjectMap(t.fields,r)}convertObjectMap(t,r="none"){const s={};return sg(t,(c,f)=>{s[c]=this.convertValue(f,r)}),s}convertVectorValue(t){var r,s,c;const f=(c=(s=(r=t.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||s===void 0?void 0:s.values)===null||c===void 0?void 0:c.map(_=>js(_.doubleValue));return new z5(f)}convertGeoPoint(t){return new L5(js(t.latitude),js(t.longitude))}convertArray(t,r){return(t.values||[]).map(s=>this.convertValue(s,r))}convertServerTimestamp(t,r){switch(r){case"previous":const s=u5(t);return s==null?null:this.convertValue(s,r);case"estimate":return this.convertTimestamp(yx(t));default:return null}}convertTimestamp(t){const r=Nf(t);return new ho(r.seconds,r.nanos)}convertDocumentKey(t,r){const s=Ji.fromString(t);Ni(mW(s));const c=new vx(s.get(1),s.get(3)),f=new nr(s.popFirst(5));return c.isEqual(r)||Zh(`Document ${f} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZW(e,t,r){let s;return s=e?e.toFirestore(t):t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l1{constructor(t,r){this.hasPendingWrites=t,this.fromCache=r}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class XW extends GW{constructor(t,r,s,c,f,_){super(t,r,s,c,_),this._firestore=t,this._firestoreImpl=t,this.metadata=f}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const r=new SE(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,r={}){if(this._document){const s=this._document.data.field(_C("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s,r.serverTimestamps)}}}class SE extends XW{data(t={}){return super.data(t)}}class KW{constructor(t,r,s,c){this._firestore=t,this._userDataWriter=r,this._snapshot=c,this.metadata=new l1(c.hasPendingWrites,c.fromCache),this.query=s}get docs(){const t=[];return this.forEach(r=>t.push(r)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,r){this._snapshot.docs.forEach(s=>{t.call(r,new SE(this._firestore,this._userDataWriter,s.key,s,new l1(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const r=!!t.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new Pn(Zt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(c,f){if(c._snapshot.oldDocs.isEmpty()){let _=0;return c._snapshot.docChanges.map(x=>{const a=new SE(c._firestore,c._userDataWriter,x.doc.key,x.doc,new l1(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);return x.doc,{type:"added",doc:a,oldIndex:-1,newIndex:_++}})}{let _=c._snapshot.oldDocs;return c._snapshot.docChanges.filter(x=>f||x.type!==3).map(x=>{const a=new SE(c._firestore,c._userDataWriter,x.doc.key,x.doc,new l1(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);let I=-1,D=-1;return x.type!==0&&(I=_.indexOf(x.doc.key),_=_.delete(x.doc.key)),x.type!==1&&(_=_.add(x.doc),D=_.indexOf(x.doc.key)),{type:Hpe(x.type),doc:a,oldIndex:I,newIndex:D}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function Hpe(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Tr()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $i(e){e=$a(e,Ko);const t=$a(e.firestore,Kh);return Mpe(dC(t),e._key).then(r=>QW(t,e,r))}class Z5 extends Wpe{constructor(t){super(),this.firestore=t}convertBytes(t){return new Oy(t)}convertReference(t){const r=this.convertDocumentKey(t,this.firestore._databaseId);return new Ko(this.firestore,null,r)}}function _a(e){e=$a(e,rd);const t=$a(e.firestore,Kh),r=dC(t),s=new Z5(t);return WW(e._query),kpe(r,e._query).then(c=>new KW(t,s,e,c))}function Em(e,t,r){e=$a(e,Ko);const s=$a(e.firestore,Kh),c=ZW(e.converter,t);return vC(s,[jW(mC(s),"setDoc",e._key,c,e.converter!==null,r).toMutation(e._key,Zl.none())])}function Yi(e,t,r,...s){e=$a(e,Ko);const c=$a(e.firestore,Kh),f=mC(c);let _;return _=typeof(t=Os(t))=="string"||t instanceof fC?Vpe(f,"updateDoc",e._key,t,r,s):Upe(f,"updateDoc",e._key,t),vC(c,[_.toMutation(e._key,Zl.exists(!0))])}function O1(e){return vC($a(e.firestore,Kh),[new g5(e._key,Zl.none())])}function Ex(e,t){const r=$a(e.firestore,Kh),s=Zn(e),c=ZW(e.converter,t);return vC(r,[jW(mC(e.firestore),"addDoc",s._key,c,e.converter!==null,{}).toMutation(s._key,Zl.exists(!1))]).then(()=>s)}function jh(e,...t){var r,s,c;e=Os(e);let f={includeMetadataChanges:!1,source:"default"},_=0;typeof t[_]!="object"||PU(t[_])||(f=t[_],_++);const x={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(PU(t[_])){const O=t[_];t[_]=(r=O.next)===null||r===void 0?void 0:r.bind(O),t[_+1]=(s=O.error)===null||s===void 0?void 0:s.bind(O),t[_+2]=(c=O.complete)===null||c===void 0?void 0:c.bind(O)}let a,I,D;if(e instanceof Ko)I=$a(e.firestore,Kh),D=tC(e._key.path),a={next:O=>{t[_]&&t[_](QW(I,e,O))},error:t[_+1],complete:t[_+2]};else{const O=$a(e,rd);I=$a(O.firestore,Kh),D=O._query;const F=new Z5(I);a={next:Z=>{t[_]&&t[_](new KW(I,F,O,Z))},error:t[_+1],complete:t[_+2]},WW(e._query)}return function(F,Z,J,re){const ne=new O5(re),G=new k5(Z,ne,J);return F.asyncQueue.enqueueAndForget(async()=>P5(await MS(F),G)),()=>{ne.za(),F.asyncQueue.enqueueAndForget(async()=>R5(await MS(F),G))}}(dC(I),D,x,a)}function vC(e,t){return function(s,c){const f=new Bh;return s.asyncQueue.enqueueAndForget(async()=>ype(await Rpe(s),c,f)),f.promise}(dC(e),t)}function QW(e,t,r){const s=r.docs.get(t._key),c=new Z5(e);return new XW(e,c,t._key,s,new l1(r.hasPendingWrites,r.fromCache),t.converter)}function DS(){return new N5("serverTimestamp")}function cy(...e){return new F5("arrayUnion",e)}function Ik(...e){return new B5("arrayRemove",e)}(function(t,r=!0){(function(c){Yy=c})(ig),zm(new Lf("firestore",(s,{instanceIdentifier:c,options:f})=>{const _=s.getProvider("app").getImmediate(),x=new Kh(new Qhe(s.getProvider("auth-internal")),new tde(s.getProvider("app-check-internal")),function(I,D){if(!Object.prototype.hasOwnProperty.apply(I.options,["projectId"]))throw new Pn(Zt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vx(I.options.projectId,D)}(_,c),_);return f=Object.assign({useFetchStreams:r},f),x._setSettings(f),x},"PUBLIC").setMultipleInstances(!0)),zu(Wj,"4.7.1",t),zu(Wj,"4.7.1","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YW="firebasestorage.googleapis.com",JW="storageBucket",Zpe=2*60*1e3,Xpe=10*60*1e3,Kpe=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Wu{constructor(t,r,s=0){super(_R(t),`Firebase Storage: ${r} (${_R(t)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ws.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return _R(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ns;(function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ns||(ns={}));function _R(e){return"storage/"+e}function X5(){const e="An unknown error occurred, please check the error payload for server response.";return new ws(ns.UNKNOWN,e)}function Qpe(e){return new ws(ns.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")}function Ype(e){return new ws(ns.QUOTA_EXCEEDED,"Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Jpe(){const e="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ws(ns.UNAUTHENTICATED,e)}function eme(){return new ws(ns.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function tme(e){return new ws(ns.UNAUTHORIZED,"User does not have permission to access '"+e+"'.")}function e2(){return new ws(ns.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function t2(){return new ws(ns.CANCELED,"User canceled the upload/download.")}function nme(e){return new ws(ns.INVALID_URL,"Invalid URL '"+e+"'.")}function rme(e){return new ws(ns.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function ime(){return new ws(ns.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+JW+"' property when initializing the app?")}function n2(){return new ws(ns.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function sme(){return new ws(ns.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function ome(){return new ws(ns.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function ame(e){return new ws(ns.UNSUPPORTED_ENVIRONMENT,`${e} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ck(e){return new ws(ns.INVALID_ARGUMENT,e)}function r2(){return new ws(ns.APP_DELETED,"The Firebase app was deleted.")}function lme(e){return new ws(ns.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function L1(e,t){return new ws(ns.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function $v(e){throw new ws(ns.INTERNAL_ERROR,"Internal error: "+e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(t,r){this.bucket=t,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,r){let s;try{s=cl.makeFromUrl(t,r)}catch{return new cl(t,"")}if(s.path==="")return s;throw rme(t)}static makeFromUrl(t,r){let s=null;const c="([A-Za-z0-9.\\-_]+)";function f(de){de.path.charAt(de.path.length-1)==="/"&&(de.path_=de.path_.slice(0,-1))}const _="(/(.*))?$",x=new RegExp("^gs://"+c+_,"i"),a={bucket:1,path:3};function I(de){de.path_=decodeURIComponent(de.path)}const D="v[A-Za-z0-9_]+",O=r.replace(/[.]/g,"\\."),F="(/([^?#]*).*)?$",Z=new RegExp(`^https?://${O}/${D}/b/${c}/o${F}`,"i"),J={bucket:1,path:3},re=r===YW?"(?:storage.googleapis.com|storage.cloud.google.com)":r,ne="([^?#]*)",G=new RegExp(`^https?://${re}/${c}/${ne}`,"i"),Q=[{regex:x,indices:a,postModify:f},{regex:Z,indices:J,postModify:I},{regex:G,indices:{bucket:1,path:2},postModify:I}];for(let de=0;de<Q.length;de++){const Te=Q[de],we=Te.regex.exec(t);if(we){const oe=we[Te.indices.bucket];let he=we[Te.indices.path];he||(he=""),s=new cl(oe,he),Te.postModify(s);break}}if(s==null)throw nme(t);return s}}class cme{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ume(e,t,r){let s=1,c=null,f=null,_=!1,x=0;function a(){return x===2}let I=!1;function D(...ne){I||(I=!0,t.apply(null,ne))}function O(ne){c=setTimeout(()=>{c=null,e(Z,a())},ne)}function F(){f&&clearTimeout(f)}function Z(ne,...G){if(I){F();return}if(ne){F(),D.call(null,ne,...G);return}if(a()||_){F(),D.call(null,ne,...G);return}s<64&&(s*=2);let Q;x===1?(x=2,Q=0):Q=(s+Math.random())*1e3,O(Q)}let J=!1;function re(ne){J||(J=!0,F(),!I&&(c!==null?(ne||(x=2),clearTimeout(c),O(0)):ne||(x=1)))}return O(0),f=setTimeout(()=>{_=!0,re(!0)},r),re}function hme(e){e(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dme(e){return e!==void 0}function fme(e){return typeof e=="function"}function pme(e){return typeof e=="object"&&!Array.isArray(e)}function xC(e){return typeof e=="string"||e instanceof String}function kU(e){return K5()&&e instanceof Blob}function K5(){return typeof Blob<"u"}function DU(e,t,r,s){if(s<t)throw Ck(`Invalid value for '${e}'. Expected ${t} or greater.`);if(s>r)throw Ck(`Invalid value for '${e}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cb(e,t,r){let s=t;return r==null&&(s=`https://${t}`),`${r}://${s}/v0${e}`}function i2(e){const t=encodeURIComponent;let r="?";for(const s in e)if(e.hasOwnProperty(s)){const c=t(s)+"="+t(e[s]);r=r+c+"&"}return r=r.slice(0,-1),r}var Sm;(function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"})(Sm||(Sm={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(e,t){const r=e>=500&&e<600,c=[408,429].indexOf(e)!==-1,f=t.indexOf(e)!==-1;return r||c||f}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mme{constructor(t,r,s,c,f,_,x,a,I,D,O,F=!0){this.url_=t,this.method_=r,this.headers_=s,this.body_=c,this.successCodes_=f,this.additionalRetryCodes_=_,this.callback_=x,this.errorCallback_=a,this.timeout_=I,this.progressCallback_=D,this.connectionFactory_=O,this.retry=F,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Z,J)=>{this.resolve_=Z,this.reject_=J,this.start_()})}start_(){const t=(s,c)=>{if(c){s(!1,new VT(!1,null,!0));return}const f=this.connectionFactory_();this.pendingConnection_=f;const _=x=>{const a=x.loaded,I=x.lengthComputable?x.total:-1;this.progressCallback_!==null&&this.progressCallback_(a,I)};this.progressCallback_!==null&&f.addUploadProgressListener(_),f.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&f.removeUploadProgressListener(_),this.pendingConnection_=null;const x=f.getErrorCode()===Sm.NO_ERROR,a=f.getStatus();if(!x||s2(a,this.additionalRetryCodes_)&&this.retry){const D=f.getErrorCode()===Sm.ABORT;s(!1,new VT(!1,null,D));return}const I=this.successCodes_.indexOf(a)!==-1;s(!0,new VT(I,f))})},r=(s,c)=>{const f=this.resolve_,_=this.reject_,x=c.connection;if(c.wasSuccessCode)try{const a=this.callback_(x,x.getResponse());dme(a)?f(a):f()}catch(a){_(a)}else if(x!==null){const a=X5();a.serverResponse=x.getErrorText(),this.errorCallback_?_(this.errorCallback_(x,a)):_(a)}else if(c.canceled){const a=this.appDelete_?r2():t2();_(a)}else{const a=e2();_(a)}};this.canceled_?r(!1,new VT(!1,null,!0)):this.backoffId_=ume(t,r,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&hme(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class VT{constructor(t,r,s){this.wasSuccessCode=t,this.connection=r,this.canceled=!!s}}function gme(e,t){t!==null&&t.length>0&&(e.Authorization="Firebase "+t)}function _me(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function yme(e,t){t&&(e["X-Firebase-GMPID"]=t)}function vme(e,t){t!==null&&(e["X-Firebase-AppCheck"]=t)}function xme(e,t,r,s,c,f,_=!0){const x=i2(e.urlParams),a=e.url+x,I=Object.assign({},e.headers);return yme(I,t),gme(I,r),_me(I,f),vme(I,s),new mme(a,e.method,I,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,c,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bme(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function wme(...e){const t=bme();if(t!==void 0){const r=new t;for(let s=0;s<e.length;s++)r.append(e[s]);return r.getBlob()}else{if(K5())return new Blob(e);throw new ws(ns.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Tme(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.mozSlice?e.mozSlice(t,r):e.slice?e.slice(t,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eme(e){if(typeof atob>"u")throw ame("base-64");return atob(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zc={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class yR{constructor(t,r){this.data=t,this.contentType=r||null}}function o2(e,t){switch(e){case zc.RAW:return new yR(a2(t));case zc.BASE64:case zc.BASE64URL:return new yR(l2(e,t));case zc.DATA_URL:return new yR(Ime(t),Cme(t))}throw X5()}function a2(e){const t=[];for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);if(s<=127)t.push(s);else if(s<=2047)t.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(r<e.length-1&&(e.charCodeAt(r+1)&64512)===56320))t.push(239,191,189);else{const f=s,_=e.charCodeAt(++r);s=65536|(f&1023)<<10|_&1023,t.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?t.push(239,191,189):t.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(t)}function Sme(e){let t;try{t=decodeURIComponent(e)}catch{throw L1(zc.DATA_URL,"Malformed data URL.")}return a2(t)}function l2(e,t){switch(e){case zc.BASE64:{const c=t.indexOf("-")!==-1,f=t.indexOf("_")!==-1;if(c||f)throw L1(e,"Invalid character '"+(c?"-":"_")+"' found: is it base64url encoded?");break}case zc.BASE64URL:{const c=t.indexOf("+")!==-1,f=t.indexOf("/")!==-1;if(c||f)throw L1(e,"Invalid character '"+(c?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=Eme(t)}catch(c){throw c.message.includes("polyfill")?c:L1(e,"Invalid character found")}const s=new Uint8Array(r.length);for(let c=0;c<r.length;c++)s[c]=r.charCodeAt(c);return s}class c2{constructor(t){this.base64=!1,this.contentType=null;const r=t.match(/^data:([^,]+)?,/);if(r===null)throw L1(zc.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=r[1]||null;s!=null&&(this.base64=Ame(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=t.substring(t.indexOf(",")+1)}}function Ime(e){const t=new c2(e);return t.base64?l2(zc.BASE64,t.rest):Sme(t.rest)}function Cme(e){return new c2(e).contentType}function Ame(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mh{constructor(t,r){let s=0,c="";kU(t)?(this.data_=t,s=t.size,c=t.type):t instanceof ArrayBuffer?(r?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),s=this.data_.length):t instanceof Uint8Array&&(r?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),s=t.length),this.size_=s,this.type_=c}size(){return this.size_}type(){return this.type_}slice(t,r){if(kU(this.data_)){const s=this.data_,c=Tme(s,t,r);return c===null?null:new Mh(c)}else{const s=new Uint8Array(this.data_.buffer,t,r-t);return new Mh(s,!0)}}static getBlob(...t){if(K5()){const r=t.map(s=>s instanceof Mh?s.data_:s);return new Mh(wme.apply(null,r))}else{const r=t.map(_=>xC(_)?o2(zc.RAW,_).data:_.data_);let s=0;r.forEach(_=>{s+=_.byteLength});const c=new Uint8Array(s);let f=0;return r.forEach(_=>{for(let x=0;x<_.length;x++)c[f++]=_[x]}),new Mh(c,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u2(e){let t;try{t=JSON.parse(e)}catch{return null}return pme(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pme(e){if(e.length===0)return null;const t=e.lastIndexOf("/");return t===-1?"":e.slice(0,t)}function Rme(e,t){const r=t.split("/").filter(s=>s.length>0).join("/");return e.length===0?r:e+"/"+r}function h2(e){const t=e.lastIndexOf("/",e.length-2);return t===-1?e:e.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mme(e,t){return t}class ma{constructor(t,r,s,c){this.server=t,this.local=r||t,this.writable=!!s,this.xform=c||Mme}}let $T=null;function kme(e){return!xC(e)||e.length<2?e:h2(e)}function Q5(){if($T)return $T;const e=[];e.push(new ma("bucket")),e.push(new ma("generation")),e.push(new ma("metageneration")),e.push(new ma("name","fullPath",!0));function t(f,_){return kme(_)}const r=new ma("name");r.xform=t,e.push(r);function s(f,_){return _!==void 0?Number(_):_}const c=new ma("size");return c.xform=s,e.push(c),e.push(new ma("timeCreated")),e.push(new ma("updated")),e.push(new ma("md5Hash",null,!0)),e.push(new ma("cacheControl",null,!0)),e.push(new ma("contentDisposition",null,!0)),e.push(new ma("contentEncoding",null,!0)),e.push(new ma("contentLanguage",null,!0)),e.push(new ma("contentType",null,!0)),e.push(new ma("metadata","customMetadata",!0)),$T=e,$T}function Dme(e,t){function r(){const s=e.bucket,c=e.fullPath,f=new cl(s,c);return t._makeStorageReference(f)}Object.defineProperty(e,"ref",{get:r})}function Ome(e,t,r){const s={};s.type="file";const c=r.length;for(let f=0;f<c;f++){const _=r[f];s[_.local]=_.xform(s,t[_.server])}return Dme(s,e),s}function d2(e,t,r){const s=u2(t);return s===null?null:Ome(e,s,r)}function Lme(e,t,r,s){const c=u2(t);if(c===null||!xC(c.downloadTokens))return null;const f=c.downloadTokens;if(f.length===0)return null;const _=encodeURIComponent;return f.split(",").map(I=>{const D=e.bucket,O=e.fullPath,F="/b/"+_(D)+"/o/"+_(O),Z=cb(F,r,s),J=i2({alt:"media",token:I});return Z+J})[0]}function f2(e,t){const r={},s=t.length;for(let c=0;c<s;c++){const f=t[c];f.writable&&(r[f.server]=e[f.local])}return JSON.stringify(r)}class r0{constructor(t,r,s,c){this.url=t,this.method=r,this.handler=s,this.timeout=c,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uh(e){if(!e)throw X5()}function Y5(e,t){function r(s,c){const f=d2(e,c,t);return Uh(f!==null),f}return r}function zme(e,t){function r(s,c){const f=d2(e,c,t);return Uh(f!==null),Lme(f,c,e.host,e._protocol)}return r}function ub(e){function t(r,s){let c;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?c=eme():c=Jpe():r.getStatus()===402?c=Ype(e.bucket):r.getStatus()===403?c=tme(e.path):c=s,c.status=r.getStatus(),c.serverResponse=s.serverResponse,c}return t}function p2(e){const t=ub(e);function r(s,c){let f=t(s,c);return s.getStatus()===404&&(f=Qpe(e.path)),f.serverResponse=c.serverResponse,f}return r}function Nme(e,t,r){const s=t.fullServerUrl(),c=cb(s,e.host,e._protocol),f="GET",_=e.maxOperationRetryTime,x=new r0(c,f,Y5(e,r),_);return x.errorHandler=p2(t),x}function Fme(e,t,r){const s=t.fullServerUrl(),c=cb(s,e.host,e._protocol),f="GET",_=e.maxOperationRetryTime,x=new r0(c,f,zme(e,r),_);return x.errorHandler=p2(t),x}function Bme(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}function m2(e,t,r){const s=Object.assign({},r);return s.fullPath=e.path,s.size=t.size(),s.contentType||(s.contentType=Bme(null,t)),s}function g2(e,t,r,s,c){const f=t.bucketOnlyServerUrl(),_={"X-Goog-Upload-Protocol":"multipart"};function x(){let Q="";for(let de=0;de<2;de++)Q=Q+Math.random().toString().slice(2);return Q}const a=x();_["Content-Type"]="multipart/related; boundary="+a;const I=m2(t,s,c),D=f2(I,r),O="--"+a+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+D+`\r
--`+a+`\r
Content-Type: `+I.contentType+`\r
\r
`,F=`\r
--`+a+"--",Z=Mh.getBlob(O,s,F);if(Z===null)throw n2();const J={name:I.fullPath},re=cb(f,e.host,e._protocol),ne="POST",G=e.maxUploadRetryTime,Y=new r0(re,ne,Y5(e,r),G);return Y.urlParams=J,Y.headers=_,Y.body=Z.uploadData(),Y.errorHandler=ub(t),Y}class OS{constructor(t,r,s,c){this.current=t,this.total=r,this.finalized=!!s,this.metadata=c||null}}function J5(e,t){let r=null;try{r=e.getResponseHeader("X-Goog-Upload-Status")}catch{Uh(!1)}return Uh(!!r&&(t||["active"]).indexOf(r)!==-1),r}function jme(e,t,r,s,c){const f=t.bucketOnlyServerUrl(),_=m2(t,s,c),x={name:_.fullPath},a=cb(f,e.host,e._protocol),I="POST",D={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${s.size()}`,"X-Goog-Upload-Header-Content-Type":_.contentType,"Content-Type":"application/json; charset=utf-8"},O=f2(_,r),F=e.maxUploadRetryTime;function Z(re){J5(re);let ne;try{ne=re.getResponseHeader("X-Goog-Upload-URL")}catch{Uh(!1)}return Uh(xC(ne)),ne}const J=new r0(a,I,Z,F);return J.urlParams=x,J.headers=D,J.body=O,J.errorHandler=ub(t),J}function Ume(e,t,r,s){const c={"X-Goog-Upload-Command":"query"};function f(I){const D=J5(I,["active","final"]);let O=null;try{O=I.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Uh(!1)}O||Uh(!1);const F=Number(O);return Uh(!isNaN(F)),new OS(F,s.size(),D==="final")}const _="POST",x=e.maxUploadRetryTime,a=new r0(r,_,f,x);return a.headers=c,a.errorHandler=ub(t),a}const OU=256*1024;function Vme(e,t,r,s,c,f,_,x){const a=new OS(0,0);if(_?(a.current=_.current,a.total=_.total):(a.current=0,a.total=s.size()),s.size()!==a.total)throw sme();const I=a.total-a.current;let D=I;c>0&&(D=Math.min(D,c));const O=a.current,F=O+D;let Z="";D===0?Z="finalize":I===D?Z="upload, finalize":Z="upload";const J={"X-Goog-Upload-Command":Z,"X-Goog-Upload-Offset":`${a.current}`},re=s.slice(O,F);if(re===null)throw n2();function ne(de,Te){const we=J5(de,["active","final"]),oe=a.current+D,he=s.size();let X;return we==="final"?X=Y5(t,f)(de,Te):X=null,new OS(oe,he,we==="final",X)}const G="POST",Y=t.maxUploadRetryTime,Q=new r0(r,G,ne,Y);return Q.headers=J,Q.body=re.uploadData(),Q.progressCallback=x||null,Q.errorHandler=ub(e),Q}const Da={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function vR(e){switch(e){case"running":case"pausing":case"canceling":return Da.RUNNING;case"paused":return Da.PAUSED;case"success":return Da.SUCCESS;case"canceled":return Da.CANCELED;case"error":return Da.ERROR;default:return Da.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $me{constructor(t,r,s){if(fme(t)||r!=null||s!=null)this.next=t,this.error=r??void 0,this.complete=s??void 0;else{const f=t;this.next=f.next,this.error=f.error,this.complete=f.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v_(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}class qme{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Sm.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Sm.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Sm.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,r,s,c){if(this.sent_)throw $v("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(r,t,!0),c!==void 0)for(const f in c)c.hasOwnProperty(f)&&this.xhr_.setRequestHeader(f,c[f].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw $v("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw $v("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw $v("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw $v("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class Gme extends qme{initXhr(){this.xhr_.responseType="text"}}function om(){return new Gme}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wme{constructor(t,r,s=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=r,this._metadata=s,this._mappings=Q5(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=c=>{if(this._request=void 0,this._chunkMultiplier=1,c._codeEquals(ns.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const f=this.isExponentialBackoffExpired();if(s2(c.status,[]))if(f)c=e2();else{this.sleepTime=Math.max(this.sleepTime*2,Kpe),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=c,this._transition("error")}},this._metadataErrorHandler=c=>{this._request=void 0,c._codeEquals(ns.CANCELED)?this.completeTransitions_():(this._error=c,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((c,f)=>{this._resolve=c,this._reject=f,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const t=this._transferred;return r=>this._updateProgress(t+r)}_shouldDoResumable(t){return t.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(t){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([r,s])=>{switch(this._state){case"running":t(r,s);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((t,r)=>{const s=jme(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(s,om,t,r);this._request=c,c.getPromise().then(f=>{this._request=void 0,this._uploadUrl=f,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const t=this._uploadUrl;this._resolveToken((r,s)=>{const c=Ume(this._ref.storage,this._ref._location,t,this._blob),f=this._ref.storage._makeRequest(c,om,r,s);this._request=f,f.getPromise().then(_=>{_=_,this._request=void 0,this._updateProgress(_.current),this._needToFetchStatus=!1,_.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const t=OU*this._chunkMultiplier,r=new OS(this._transferred,this._blob.size()),s=this._uploadUrl;this._resolveToken((c,f)=>{let _;try{_=Vme(this._ref._location,this._ref.storage,s,this._blob,t,this._mappings,r,this._makeProgressCallback())}catch(a){this._error=a,this._transition("error");return}const x=this._ref.storage._makeRequest(_,om,c,f,!1);this._request=x,x.getPromise().then(a=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(a.current),a.finalized?(this._metadata=a.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){OU*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((t,r)=>{const s=Nme(this._ref.storage,this._ref._location,this._mappings),c=this._ref.storage._makeRequest(s,om,t,r);this._request=c,c.getPromise().then(f=>{this._request=void 0,this._metadata=f,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((t,r)=>{const s=g2(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(s,om,t,r);this._request=c,c.getPromise().then(f=>{this._request=void 0,this._metadata=f,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(t){const r=this._transferred;this._transferred=t,this._transferred!==r&&this._notifyObservers()}_transition(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const r=this._state==="paused";this._state=t,r&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=t2(),this._state=t,this._notifyObservers();break;case"error":this._state=t,this._notifyObservers();break;case"success":this._state=t,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const t=vR(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}on(t,r,s,c){const f=new $me(r||void 0,s||void 0,c||void 0);return this._addObserver(f),()=>{this._removeObserver(f)}}then(t,r){return this._promise.then(t,r)}catch(t){return this.then(null,t)}_addObserver(t){this._observers.push(t),this._notifyObserver(t)}_removeObserver(t){const r=this._observers.indexOf(t);r!==-1&&this._observers.splice(r,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(r=>{this._notifyObserver(r)})}_finishPromise(){if(this._resolve!==void 0){let t=!0;switch(vR(this._state)){case Da.SUCCESS:v_(this._resolve.bind(null,this.snapshot))();break;case Da.CANCELED:case Da.ERROR:const r=this._reject;v_(r.bind(null,this._error))();break;default:t=!1;break}t&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(t){switch(vR(this._state)){case Da.RUNNING:case Da.PAUSED:t.next&&v_(t.next.bind(t,this.snapshot))();break;case Da.SUCCESS:t.complete&&v_(t.complete.bind(t))();break;case Da.CANCELED:case Da.ERROR:t.error&&v_(t.error.bind(t,this._error))();break;default:t.error&&v_(t.error.bind(t,this._error))()}}resume(){const t=this._state==="paused"||this._state==="pausing";return t&&this._transition("running"),t}pause(){const t=this._state==="running";return t&&this._transition("pausing"),t}cancel(){const t=this._state==="running"||this._state==="pausing";return t&&this._transition("canceling"),t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(t,r){this._service=t,r instanceof cl?this._location=r:this._location=cl.makeFromUrl(r,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,r){return new Vm(t,r)}get root(){const t=new cl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return h2(this._location.path)}get storage(){return this._service}get parent(){const t=Pme(this._location.path);if(t===null)return null;const r=new cl(this._location.bucket,t);return new Vm(this._service,r)}_throwIfRoot(t){if(this._location.path==="")throw lme(t)}}function Hme(e,t,r){e._throwIfRoot("uploadBytes");const s=g2(e.storage,e._location,Q5(),new Mh(t,!0),r);return e.storage.makeRequestWithTokens(s,om).then(c=>({metadata:c,ref:e}))}function Zme(e,t,r){return e._throwIfRoot("uploadBytesResumable"),new Wme(e,new Mh(t),r)}function Xme(e,t,r=zc.RAW,s){e._throwIfRoot("uploadString");const c=o2(r,t),f=Object.assign({},s);return f.contentType==null&&c.contentType!=null&&(f.contentType=c.contentType),Hme(e,c.data,f)}function Kme(e){e._throwIfRoot("getDownloadURL");const t=Fme(e.storage,e._location,Q5());return e.storage.makeRequestWithTokens(t,om).then(r=>{if(r===null)throw ome();return r})}function Qme(e,t){const r=Rme(e._location.path,t),s=new cl(e._location.bucket,r);return new Vm(e.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yme(e){return/^[A-Za-z]+:\/\//.test(e)}function Jme(e,t){return new Vm(e,t)}function _2(e,t){if(e instanceof eO){const r=e;if(r._bucket==null)throw ime();const s=new Vm(r,r._bucket);return t!=null?_2(s,t):s}else return t!==void 0?Qme(e,t):e}function ege(e,t){if(t&&Yme(t)){if(e instanceof eO)return Jme(e,t);throw Ck("To use ref(service, url), the first argument must be a Storage instance.")}else return _2(e,t)}function LU(e,t){const r=t==null?void 0:t[JW];return r==null?null:cl.makeFromBucketSpec(r,e)}function tge(e,t,r,s={}){e.host=`${t}:${r}`,e._protocol="http";const{mockUserToken:c}=s;c&&(e._overrideAuthToken=typeof c=="string"?c:$q(c,e.app.options.projectId))}class eO{constructor(t,r,s,c,f){this.app=t,this._authProvider=r,this._appCheckProvider=s,this._url=c,this._firebaseVersion=f,this._bucket=null,this._host=YW,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Zpe,this._maxUploadRetryTime=Xpe,this._requests=new Set,c!=null?this._bucket=cl.makeFromBucketSpec(c,this._host):this._bucket=LU(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=cl.makeFromBucketSpec(this._url,t):this._bucket=LU(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){DU("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){DU("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const r=await t.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Vm(this,t)}_makeRequest(t,r,s,c,f=!0){if(this._deleted)return new cme(r2());{const _=xme(t,this._appId,s,c,r,this._firebaseVersion,f);return this._requests.add(_),_.getPromise().then(()=>this._requests.delete(_),()=>this._requests.delete(_)),_}}async makeRequestWithTokens(t,r){const[s,c]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,r,s,c).getPromise()}}const zU="@firebase/storage",NU="0.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y2="storage";function nge(e,t,r,s){return e=Os(e),Xme(e,t,r,s)}function rge(e,t,r){return e=Os(e),Zme(e,t,r)}function v2(e){return e=Os(e),Kme(e)}function x2(e,t){return e=Os(e),ege(e,t)}function b2(e=XD(),t){e=Os(e);const s=KI(e,y2).getImmediate({identifier:t}),c=jq("storage");return c&&ige(s,...c),s}function ige(e,t,r,s={}){tge(e,t,r,s)}function sge(e,{instanceIdentifier:t}){const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),c=e.getProvider("app-check-internal");return new eO(r,s,c,t,ig)}function oge(){zm(new Lf(y2,sge,"PUBLIC").setMultipleInstances(!0)),zu(zU,NU,""),zu(zU,NU,"esm2017")}oge();const age={apiKey:"AIzaSyC2wTEeSiz_09FzWarn52vwzSlzfHXjATE",authDomain:"quests-b5b92.firebaseapp.com",databaseURL:"https://quests-b5b92-default-rtdb.firebaseio.com",projectId:"quests-b5b92",storageBucket:"quests-b5b92.appspot.com",messagingSenderId:"388972050284",appId:"1:388972050284:web:38dfdb79a67edcf0756549",measurementId:"G-Y1P89CPKCY"},tO=Wq(age),$t=Hhe(tO),yn=Npe(tO),lge=b2(tO),cge=async(e,t,r)=>{try{const s=await Oue($t,e,t),c=s.user.uid;return await Em(Zn(yn,"users",c),{name:r,email:e,profilePhoto:await nO(),bio:"",isActive:!0,lastActive:Date.now(),receiverId:c,senderId:c,isPrivate:!1}),s}catch(s){console.error("Error signing up:",s)}},w2=new Ru,uge=async()=>{try{const t=(await CG($t,w2)).user,r=Zn(yn,"users",t.uid);return(await $i(r)).exists()||await Em(r,{name:t.displayName||"Unnamed",email:t.email,profilePhoto:t.photoURL||await nO(),bio:"",isActive:!0,receiverId:t.uid,senderId:t.uid,isPrivate:!1}),t}catch(e){throw console.error("Error signing up with Google:",e),e}},hge=async()=>{try{const e=await CG($t,w2),r=Ru.credentialFromResult(e).accessToken,s=e.user;return await Ak(s.uid,{isActive:!0,lastActive:Date.now()}),console.log("User signed in with Google:",s),s}catch(e){console.error("Error signing in with Google:",e)}},dge=async(e,t)=>{var r;try{const s=await Lue($t,e,t),c=(r=s.user)==null?void 0:r.uid;return c?await Yi(Zn(yn,"users",c),{isActive:!0,lastActive:Date.now()}):console.error("User ID is not available"),s}catch(s){console.error("Error signing in:",s)}},fge=async e=>{const t=b2(),r=x2(t,`profile_photos/${$t.currentUser.uid}`),s=rge(r,e);return new Promise((c,f)=>{s.on("state_changed",_=>{},_=>{console.error("Error uploading image:",_),f(_)},async()=>{try{const _=await v2(s.snapshot.ref);c(_)}catch(_){console.error("Error getting download URL:",_),f(_)}})})},Ak=async(e,t)=>{try{console.log("Updating user profile:",e,t),await Yi(Zn(yn,"users",e),t),console.log("User profile updated successfully")}catch(r){console.error("Error updating user profile:",r)}},nO=async()=>"https://firebasestorage.googleapis.com/v0/b/quests-b5b92.appspot.com/o/profile_photos%2Fdefault.jpg?alt=media&token=e7424067-7007-4a70-a405-b56c83f0d9d2",uy=async e=>{try{const t=await $i(Zn(yn,"users",e));if(t.exists())return t.data();console.log("No such document!")}catch(t){console.error("Error fetching user data:",t)}};var T2={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},FU=Gr.createContext&&Gr.createContext(T2),pge=["attr","size","title"];function mge(e,t){if(e==null)return{};var r=gge(e,t),s,c;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(c=0;c<f.length;c++)s=f[c],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}function gge(e,t){if(e==null)return{};var r={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;r[s]=e[s]}return r}function LS(){return LS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},LS.apply(this,arguments)}function BU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,s)}return r}function zS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BU(Object(r),!0).forEach(function(s){_ge(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BU(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function _ge(e,t,r){return t=yge(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function yge(e){var t=vge(e,"string");return typeof t=="symbol"?t:t+""}function vge(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function E2(e){return e&&e.map((t,r)=>Gr.createElement(t.tag,zS({key:r},t.attr),E2(t.child)))}function S2(e){return t=>Gr.createElement(xge,LS({attr:zS({},e.attr)},t),E2(e.child))}function xge(e){var t=r=>{var{attr:s,size:c,title:f}=e,_=mge(e,pge),x=c||r.size||"1em",a;return r.className&&(a=r.className),e.className&&(a=(a?a+" ":"")+e.className),Gr.createElement("svg",LS({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,s,_,{className:a,style:zS(zS({color:e.color||r.color},r.style),e.style),height:x,width:x,xmlns:"http://www.w3.org/2000/svg"}),f&&Gr.createElement("title",null,f),e.children)};return FU!==void 0?Gr.createElement(FU.Consumer,null,r=>t(r)):t(T2)}function I2(e){return S2({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(e)}function C2(e){return S2({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(e)}const bge=()=>{const e=Qm(),[t,r]=W.useState(!1),[s,c]=W.useState(""),f={email:"",password:""},_=WD({email:iy().email("Invalid email address").required("Required"),password:iy().required("Required")}),x=(D,{setSubmitting:O})=>{c(""),dge(D.email,D.password).then(F=>{const Z=F.user;console.log("User signed in:",Z.uid),e("/home")}).catch(F=>{console.error("Error signing in:",F),c("Incorrect username or password")}).finally(()=>{O(!1)})},a=()=>{r(!t)},I=async()=>{try{await hge()&&e("/home")}catch(D){console.error("Error signing in with Google:",D),c("Error signing in with Google")}};return N.jsxs("section",{className:"login-container",children:[N.jsxs("div",{className:"login-form-container",children:[N.jsx("h1",{children:"Login"}),N.jsxs("p",{className:"linktoregister",children:["Not a user? ",N.jsx(RI,{to:"/register",className:"gotoregister",style:{color:"rgb(10,145,255)"},children:"Create an account here"})]}),N.jsx(Sq,{initialValues:f,validationSchema:_,onSubmit:x,children:({isSubmitting:D,errors:O,touched:F})=>N.jsxs(jD,{className:"login-form",children:[N.jsx(A1,{type:"email",name:"email",placeholder:"Email Address"}),N.jsxs("div",{className:"password-container",children:[N.jsx(A1,{type:t?"text":"password",name:"password",placeholder:"Password"}),N.jsx("span",{className:"password-toggle",onClick:a,role:"button","aria-label":"Toggle password visibility",children:t?N.jsx(I2,{}):N.jsx(C2,{})})]}),N.jsx("div",{className:"error-container",children:O.email&&F.email||O.password&&F.password?N.jsx("div",{className:"error-message",children:O.email||O.password}):s?N.jsx("div",{className:"error-message",children:s}):null}),N.jsxs("div",{className:"buttons",children:[N.jsx("button",{className:"google-login-btn",onClick:I,type:"button",children:N.jsx("img",{src:"/google-logo.png",alt:"Google",className:"google-logo"})}),N.jsx("button",{className:"loginbtn",type:"submit",disabled:D,children:"Login"})]})]})})]}),N.jsxs("div",{className:"blue-rectangle",children:[N.jsx("img",{className:"questsimg",src:"/Questslogo white.png",alt:"Quests logo"}),N.jsx("h3",{children:"Welcome Back!"}),N.jsx("p",{children:"We're glad to see you again. Log in to continue where you left off."})]})]})},wge=()=>{const e=Qm(),[t,r]=W.useState(!1),[s,c]=W.useState(""),f={name:"",email:"",password:""},_=WD({name:iy().required("Name required"),email:iy().email("Invalid email address").required("Email required"),password:iy().min(6,"Password must be at least 6 characters").required("Password required")}),x=async(I,{setSubmitting:D,setErrors:O})=>{try{c("");const F=await cge(I.email,I.password,I.name);if(!F||!F.user)throw new Error("Failed to sign up");const Z=F.user;console.log("User signed up successfully:",Z);const J=await nO();await Em(Zn(yn,"users",Z.uid),{name:I.name,email:I.email,profilePhoto:J,bio:"",isActive:!0}),console.log("User data added to Firestore"),e("/login")}catch(F){console.error("Error signing up:",F),c("Failed to sign up. Please check your details and try again.")}finally{D(!1)}},a=async()=>{try{c("");const I=await uge();console.log("Google user signed up:",I),e("/login")}catch(I){console.error("Error signing up with Google:",I),c("Error signing up with Google")}};return N.jsxs("section",{className:"register-container",children:[N.jsxs("div",{className:"register-form-container",children:[N.jsx("h2",{className:"createacc",children:"Create New Account"}),N.jsxs("p",{className:"aauser",children:["Already a user? ",N.jsx(RI,{to:"/login",style:{color:"rgb(10,145,255)"},children:"Login here."})]}),N.jsx(Sq,{initialValues:f,validationSchema:_,onSubmit:x,children:({isSubmitting:I,errors:D,touched:O})=>N.jsxs(jD,{className:"register-form",children:[N.jsx(A1,{className:"username",type:"text",name:"name",placeholder:"Name"}),N.jsx(A1,{type:"email",name:"email",placeholder:"Email"}),N.jsxs("div",{className:"password-container",children:[N.jsx(A1,{type:t?"text":"password",name:"password",placeholder:"Password"}),N.jsx("div",{className:"password-toggle",onClick:()=>r(!t),role:"button","aria-label":"Toggle password visibility",children:t?N.jsx(I2,{}):N.jsx(C2,{})})]}),N.jsx("div",{className:"error-container",children:D.name&&O.name||D.email&&O.email||D.password&&O.password?N.jsx("div",{className:"error-message",children:D.name||D.email||D.password}):s?N.jsx("div",{className:"error-message",children:s}):null}),N.jsxs("div",{className:"button-container",children:[N.jsx("button",{className:"google-register-btn",onClick:a,type:"button",children:N.jsx("img",{src:"/google-logo.png",alt:"Google",className:"google-logo"})}),N.jsx("button",{className:"register-btn",type:"submit",disabled:I,children:"Register"})]})]})})]}),N.jsxs("div",{className:"blue-rectangle",children:[N.jsx("img",{className:"questsimg",src:"/Questslogo white.png",alt:"Quests logo"}),N.jsx("h3",{children:"Welcome!"}),N.jsx("p",{children:"Join our community today and unlock a world of possibilities. Connect, share, and grow with us!"})]})]})},Sx={black:"#000",white:"#fff"},x_={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},b_={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},w_={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},T_={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},E_={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},qv={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Tge={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function Qh(e){let t="https://mui.com/production-error/?code="+e;for(let r=1;r<arguments.length;r+=1)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}const bC="$$material";function NS(){return NS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},NS.apply(null,arguments)}function A2(e){var t=Object.create(null);return function(r){return t[r]===void 0&&(t[r]=e(r)),t[r]}}var Ege=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,Sge=A2(function(e){return Ege.test(e)||e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)<91}),Ige=!1;function Cge(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function Age(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var Pge=function(){function e(r){var s=this;this._insertTag=function(c){var f;s.tags.length===0?s.insertionPoint?f=s.insertionPoint.nextSibling:s.prepend?f=s.container.firstChild:f=s.before:f=s.tags[s.tags.length-1].nextSibling,s.container.insertBefore(c,f),s.tags.push(c)},this.isSpeedy=r.speedy===void 0?!Ige:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(s){s.forEach(this._insertTag)},t.insert=function(s){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Age(this));var c=this.tags[this.tags.length-1];if(this.isSpeedy){var f=Cge(c);try{f.insertRule(s,f.cssRules.length)}catch{}}else c.appendChild(document.createTextNode(s));this.ctr++},t.flush=function(){this.tags.forEach(function(s){var c;return(c=s.parentNode)==null?void 0:c.removeChild(s)}),this.tags=[],this.ctr=0},e}(),Wo="-ms-",FS="-moz-",hi="-webkit-",P2="comm",rO="rule",iO="decl",Rge="@import",R2="@keyframes",Mge="@layer",kge=Math.abs,wC=String.fromCharCode,Dge=Object.assign;function Oge(e,t){return Ao(e,0)^45?(((t<<2^Ao(e,0))<<2^Ao(e,1))<<2^Ao(e,2))<<2^Ao(e,3):0}function M2(e){return e.trim()}function Lge(e,t){return(e=t.exec(e))?e[0]:e}function di(e,t,r){return e.replace(t,r)}function Pk(e,t){return e.indexOf(t)}function Ao(e,t){return e.charCodeAt(t)|0}function Ix(e,t,r){return e.slice(t,r)}function Su(e){return e.length}function sO(e){return e.length}function qT(e,t){return t.push(e),e}function zge(e,t){return e.map(t).join("")}var TC=1,Ly=1,k2=0,qa=0,Xs=0,i0="";function EC(e,t,r,s,c,f,_){return{value:e,root:t,parent:r,type:s,props:c,children:f,line:TC,column:Ly,length:_,return:""}}function Gv(e,t){return Dge(EC("",null,null,"",null,null,0),e,{length:-e.length},t)}function Nge(){return Xs}function Fge(){return Xs=qa>0?Ao(i0,--qa):0,Ly--,Xs===10&&(Ly=1,TC--),Xs}function pl(){return Xs=qa<k2?Ao(i0,qa++):0,Ly++,Xs===10&&(Ly=1,TC++),Xs}function ju(){return Ao(i0,qa)}function IE(){return qa}function hb(e,t){return Ix(i0,e,t)}function Cx(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function D2(e){return TC=Ly=1,k2=Su(i0=e),qa=0,[]}function O2(e){return i0="",e}function CE(e){return M2(hb(qa-1,Rk(e===91?e+2:e===40?e+1:e)))}function Bge(e){for(;(Xs=ju())&&Xs<33;)pl();return Cx(e)>2||Cx(Xs)>3?"":" "}function jge(e,t){for(;--t&&pl()&&!(Xs<48||Xs>102||Xs>57&&Xs<65||Xs>70&&Xs<97););return hb(e,IE()+(t<6&&ju()==32&&pl()==32))}function Rk(e){for(;pl();)switch(Xs){case e:return qa;case 34:case 39:e!==34&&e!==39&&Rk(Xs);break;case 40:e===41&&Rk(e);break;case 92:pl();break}return qa}function Uge(e,t){for(;pl()&&e+Xs!==57;)if(e+Xs===84&&ju()===47)break;return"/*"+hb(t,qa-1)+"*"+wC(e===47?e:pl())}function Vge(e){for(;!Cx(ju());)pl();return hb(e,qa)}function $ge(e){return O2(AE("",null,null,null,[""],e=D2(e),0,[0],e))}function AE(e,t,r,s,c,f,_,x,a){for(var I=0,D=0,O=_,F=0,Z=0,J=0,re=1,ne=1,G=1,Y=0,Q="",de=c,Te=f,we=s,oe=Q;ne;)switch(J=Y,Y=pl()){case 40:if(J!=108&&Ao(oe,O-1)==58){Pk(oe+=di(CE(Y),"&","&\f"),"&\f")!=-1&&(G=-1);break}case 34:case 39:case 91:oe+=CE(Y);break;case 9:case 10:case 13:case 32:oe+=Bge(J);break;case 92:oe+=jge(IE()-1,7);continue;case 47:switch(ju()){case 42:case 47:qT(qge(Uge(pl(),IE()),t,r),a);break;default:oe+="/"}break;case 123*re:x[I++]=Su(oe)*G;case 125*re:case 59:case 0:switch(Y){case 0:case 125:ne=0;case 59+D:G==-1&&(oe=di(oe,/\f/g,"")),Z>0&&Su(oe)-O&&qT(Z>32?UU(oe+";",s,r,O-1):UU(di(oe," ","")+";",s,r,O-2),a);break;case 59:oe+=";";default:if(qT(we=jU(oe,t,r,I,D,c,x,Q,de=[],Te=[],O),f),Y===123)if(D===0)AE(oe,t,we,we,de,f,O,x,Te);else switch(F===99&&Ao(oe,3)===110?100:F){case 100:case 108:case 109:case 115:AE(e,we,we,s&&qT(jU(e,we,we,0,0,c,x,Q,c,de=[],O),Te),c,Te,O,x,s?de:Te);break;default:AE(oe,we,we,we,[""],Te,0,x,Te)}}I=D=Z=0,re=G=1,Q=oe="",O=_;break;case 58:O=1+Su(oe),Z=J;default:if(re<1){if(Y==123)--re;else if(Y==125&&re++==0&&Fge()==125)continue}switch(oe+=wC(Y),Y*re){case 38:G=D>0?1:(oe+="\f",-1);break;case 44:x[I++]=(Su(oe)-1)*G,G=1;break;case 64:ju()===45&&(oe+=CE(pl())),F=ju(),D=O=Su(Q=oe+=Vge(IE())),Y++;break;case 45:J===45&&Su(oe)==2&&(re=0)}}return f}function jU(e,t,r,s,c,f,_,x,a,I,D){for(var O=c-1,F=c===0?f:[""],Z=sO(F),J=0,re=0,ne=0;J<s;++J)for(var G=0,Y=Ix(e,O+1,O=kge(re=_[J])),Q=e;G<Z;++G)(Q=M2(re>0?F[G]+" "+Y:di(Y,/&\f/g,F[G])))&&(a[ne++]=Q);return EC(e,t,r,c===0?rO:x,a,I,D)}function qge(e,t,r){return EC(e,t,r,P2,wC(Nge()),Ix(e,2,-2),0)}function UU(e,t,r,s){return EC(e,t,r,iO,Ix(e,0,s),Ix(e,s+1,-1),s)}function hy(e,t){for(var r="",s=sO(e),c=0;c<s;c++)r+=t(e[c],c,e,t)||"";return r}function Gge(e,t,r,s){switch(e.type){case Mge:if(e.children.length)break;case Rge:case iO:return e.return=e.return||e.value;case P2:return"";case R2:return e.return=e.value+"{"+hy(e.children,s)+"}";case rO:e.value=e.props.join(",")}return Su(r=hy(e.children,s))?e.return=e.value+"{"+r+"}":""}function Wge(e){var t=sO(e);return function(r,s,c,f){for(var _="",x=0;x<t;x++)_+=e[x](r,s,c,f)||"";return _}}function Hge(e){return function(t){t.root||(t=t.return)&&e(t)}}var Zge=function(t,r,s){for(var c=0,f=0;c=f,f=ju(),c===38&&f===12&&(r[s]=1),!Cx(f);)pl();return hb(t,qa)},Xge=function(t,r){var s=-1,c=44;do switch(Cx(c)){case 0:c===38&&ju()===12&&(r[s]=1),t[s]+=Zge(qa-1,r,s);break;case 2:t[s]+=CE(c);break;case 4:if(c===44){t[++s]=ju()===58?"&\f":"",r[s]=t[s].length;break}default:t[s]+=wC(c)}while(c=pl());return t},Kge=function(t,r){return O2(Xge(D2(t),r))},VU=new WeakMap,Qge=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var r=t.value,s=t.parent,c=t.column===s.column&&t.line===s.line;s.type!=="rule";)if(s=s.parent,!s)return;if(!(t.props.length===1&&r.charCodeAt(0)!==58&&!VU.get(s))&&!c){VU.set(t,!0);for(var f=[],_=Kge(r,f),x=s.props,a=0,I=0;a<_.length;a++)for(var D=0;D<x.length;D++,I++)t.props[I]=f[a]?_[a].replace(/&\f/g,x[D]):x[D]+" "+_[a]}}},Yge=function(t){if(t.type==="decl"){var r=t.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(t.return="",t.value="")}};function L2(e,t){switch(Oge(e,t)){case 5103:return hi+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return hi+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return hi+e+FS+e+Wo+e+e;case 6828:case 4268:return hi+e+Wo+e+e;case 6165:return hi+e+Wo+"flex-"+e+e;case 5187:return hi+e+di(e,/(\w+).+(:[^]+)/,hi+"box-$1$2"+Wo+"flex-$1$2")+e;case 5443:return hi+e+Wo+"flex-item-"+di(e,/flex-|-self/,"")+e;case 4675:return hi+e+Wo+"flex-line-pack"+di(e,/align-content|flex-|-self/,"")+e;case 5548:return hi+e+Wo+di(e,"shrink","negative")+e;case 5292:return hi+e+Wo+di(e,"basis","preferred-size")+e;case 6060:return hi+"box-"+di(e,"-grow","")+hi+e+Wo+di(e,"grow","positive")+e;case 4554:return hi+di(e,/([^-])(transform)/g,"$1"+hi+"$2")+e;case 6187:return di(di(di(e,/(zoom-|grab)/,hi+"$1"),/(image-set)/,hi+"$1"),e,"")+e;case 5495:case 3959:return di(e,/(image-set\([^]*)/,hi+"$1$`$1");case 4968:return di(di(e,/(.+:)(flex-)?(.*)/,hi+"box-pack:$3"+Wo+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+hi+e+e;case 4095:case 3583:case 4068:case 2532:return di(e,/(.+)-inline(.+)/,hi+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Su(e)-1-t>6)switch(Ao(e,t+1)){case 109:if(Ao(e,t+4)!==45)break;case 102:return di(e,/(.+:)(.+)-([^]+)/,"$1"+hi+"$2-$3$1"+FS+(Ao(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Pk(e,"stretch")?L2(di(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(Ao(e,t+1)!==115)break;case 6444:switch(Ao(e,Su(e)-3-(~Pk(e,"!important")&&10))){case 107:return di(e,":",":"+hi)+e;case 101:return di(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+hi+(Ao(e,14)===45?"inline-":"")+"box$3$1"+hi+"$2$3$1"+Wo+"$2box$3")+e}break;case 5936:switch(Ao(e,t+11)){case 114:return hi+e+Wo+di(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return hi+e+Wo+di(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return hi+e+Wo+di(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return hi+e+Wo+e+e}return e}var Jge=function(t,r,s,c){if(t.length>-1&&!t.return)switch(t.type){case iO:t.return=L2(t.value,t.length);break;case R2:return hy([Gv(t,{value:di(t.value,"@","@"+hi)})],c);case rO:if(t.length)return zge(t.props,function(f){switch(Lge(f,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return hy([Gv(t,{props:[di(f,/:(read-\w+)/,":"+FS+"$1")]})],c);case"::placeholder":return hy([Gv(t,{props:[di(f,/:(plac\w+)/,":"+hi+"input-$1")]}),Gv(t,{props:[di(f,/:(plac\w+)/,":"+FS+"$1")]}),Gv(t,{props:[di(f,/:(plac\w+)/,Wo+"input-$1")]})],c)}return""})}},e_e=[Jge],t_e=function(t){var r=t.key;if(r==="css"){var s=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(s,function(re){var ne=re.getAttribute("data-emotion");ne.indexOf(" ")!==-1&&(document.head.appendChild(re),re.setAttribute("data-s",""))})}var c=t.stylisPlugins||e_e,f={},_,x=[];_=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(re){for(var ne=re.getAttribute("data-emotion").split(" "),G=1;G<ne.length;G++)f[ne[G]]=!0;x.push(re)});var a,I=[Qge,Yge];{var D,O=[Gge,Hge(function(re){D.insert(re)})],F=Wge(I.concat(c,O)),Z=function(ne){return hy($ge(ne),F)};a=function(ne,G,Y,Q){D=Y,Z(ne?ne+"{"+G.styles+"}":G.styles),Q&&(J.inserted[G.name]=!0)}}var J={key:r,sheet:new Pge({key:r,container:_,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:f,registered:{},insert:a};return J.sheet.hydrate(x),J},n_e=!0;function r_e(e,t,r){var s="";return r.split(" ").forEach(function(c){e[c]!==void 0?t.push(e[c]+";"):s+=c+" "}),s}var z2=function(t,r,s){var c=t.key+"-"+r.name;(s===!1||n_e===!1)&&t.registered[c]===void 0&&(t.registered[c]=r.styles)},N2=function(t,r,s){z2(t,r,s);var c=t.key+"-"+r.name;if(t.inserted[r.name]===void 0){var f=r;do t.insert(r===f?"."+c:"",f,t.sheet,!0),f=f.next;while(f!==void 0)}};function i_e(e){for(var t=0,r,s=0,c=e.length;c>=4;++s,c-=4)r=e.charCodeAt(s)&255|(e.charCodeAt(++s)&255)<<8|(e.charCodeAt(++s)&255)<<16|(e.charCodeAt(++s)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,t=(r&65535)*1540483477+((r>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(c){case 3:t^=(e.charCodeAt(s+2)&255)<<16;case 2:t^=(e.charCodeAt(s+1)&255)<<8;case 1:t^=e.charCodeAt(s)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var s_e={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},o_e=!1,a_e=/[A-Z]|^ms/g,l_e=/_EMO_([^_]+?)_([^]*?)_EMO_/g,F2=function(t){return t.charCodeAt(1)===45},$U=function(t){return t!=null&&typeof t!="boolean"},xR=A2(function(e){return F2(e)?e:e.replace(a_e,"-$&").toLowerCase()}),qU=function(t,r){switch(t){case"animation":case"animationName":if(typeof r=="string")return r.replace(l_e,function(s,c,f){return Iu={name:c,styles:f,next:Iu},c})}return s_e[t]!==1&&!F2(t)&&typeof r=="number"&&r!==0?r+"px":r},c_e="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function Ax(e,t,r){if(r==null)return"";var s=r;if(s.__emotion_styles!==void 0)return s;switch(typeof r){case"boolean":return"";case"object":{var c=r;if(c.anim===1)return Iu={name:c.name,styles:c.styles,next:Iu},c.name;var f=r;if(f.styles!==void 0){var _=f.next;if(_!==void 0)for(;_!==void 0;)Iu={name:_.name,styles:_.styles,next:Iu},_=_.next;var x=f.styles+";";return x}return u_e(e,t,r)}case"function":{if(e!==void 0){var a=Iu,I=r(e);return Iu=a,Ax(e,t,I)}break}}var D=r;if(t==null)return D;var O=t[D];return O!==void 0?O:D}function u_e(e,t,r){var s="";if(Array.isArray(r))for(var c=0;c<r.length;c++)s+=Ax(e,t,r[c])+";";else for(var f in r){var _=r[f];if(typeof _!="object"){var x=_;t!=null&&t[x]!==void 0?s+=f+"{"+t[x]+"}":$U(x)&&(s+=xR(f)+":"+qU(f,x)+";")}else{if(f==="NO_COMPONENT_SELECTOR"&&o_e)throw new Error(c_e);if(Array.isArray(_)&&typeof _[0]=="string"&&(t==null||t[_[0]]===void 0))for(var a=0;a<_.length;a++)$U(_[a])&&(s+=xR(f)+":"+qU(f,_[a])+";");else{var I=Ax(e,t,_);switch(f){case"animation":case"animationName":{s+=xR(f)+":"+I+";";break}default:s+=f+"{"+I+"}"}}}}return s}var GU=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Iu;function oO(e,t,r){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var s=!0,c="";Iu=void 0;var f=e[0];if(f==null||f.raw===void 0)s=!1,c+=Ax(r,t,f);else{var _=f;c+=_[0]}for(var x=1;x<e.length;x++)if(c+=Ax(r,t,e[x]),s){var a=f;c+=a[x]}GU.lastIndex=0;for(var I="",D;(D=GU.exec(c))!==null;)I+="-"+D[1];var O=i_e(c)+I;return{name:O,styles:c,next:Iu}}var h_e=function(t){return t()},B2=jE.useInsertionEffect?jE.useInsertionEffect:!1,d_e=B2||h_e,WU=B2||W.useLayoutEffect,j2=W.createContext(typeof HTMLElement<"u"?t_e({key:"css"}):null);j2.Provider;var U2=function(t){return W.forwardRef(function(r,s){var c=W.useContext(j2);return t(r,c,s)})},aO=W.createContext({}),f_e=U2(function(e,t){var r=e.styles,s=oO([r],void 0,W.useContext(aO)),c=W.useRef();return WU(function(){var f=t.key+"-global",_=new t.sheet.constructor({key:f,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),x=!1,a=document.querySelector('style[data-emotion="'+f+" "+s.name+'"]');return t.sheet.tags.length&&(_.before=t.sheet.tags[0]),a!==null&&(x=!0,a.setAttribute("data-emotion",f),_.hydrate([a])),c.current=[_,x],function(){_.flush()}},[t]),WU(function(){var f=c.current,_=f[0],x=f[1];if(x){f[1]=!1;return}if(s.next!==void 0&&N2(t,s.next,!0),_.tags.length){var a=_.tags[_.tags.length-1].nextElementSibling;_.before=a,_.flush()}t.insert("",s,_,!1)},[t,s.name]),null});function p_e(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return oO(t)}var lO=function(){var t=p_e.apply(void 0,arguments),r="animation-"+t.name;return{name:r,styles:"@keyframes "+r+"{"+t.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},m_e=Sge,g_e=function(t){return t!=="theme"},HU=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?m_e:g_e},ZU=function(t,r,s){var c;if(r){var f=r.shouldForwardProp;c=t.__emotion_forwardProp&&f?function(_){return t.__emotion_forwardProp(_)&&f(_)}:f}return typeof c!="function"&&s&&(c=t.__emotion_forwardProp),c},__e=!1,y_e=function(t){var r=t.cache,s=t.serialized,c=t.isStringTag;return z2(r,s,c),d_e(function(){return N2(r,s,c)}),null},v_e=function e(t,r){var s=t.__emotion_real===t,c=s&&t.__emotion_base||t,f,_;r!==void 0&&(f=r.label,_=r.target);var x=ZU(t,r,s),a=x||HU(c),I=!a("as");return function(){var D=arguments,O=s&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(f!==void 0&&O.push("label:"+f+";"),D[0]==null||D[0].raw===void 0)O.push.apply(O,D);else{O.push(D[0][0]);for(var F=D.length,Z=1;Z<F;Z++)O.push(D[Z],D[0][Z])}var J=U2(function(re,ne,G){var Y=I&&re.as||c,Q="",de=[],Te=re;if(re.theme==null){Te={};for(var we in re)Te[we]=re[we];Te.theme=W.useContext(aO)}typeof re.className=="string"?Q=r_e(ne.registered,de,re.className):re.className!=null&&(Q=re.className+" ");var oe=oO(O.concat(de),ne.registered,Te);Q+=ne.key+"-"+oe.name,_!==void 0&&(Q+=" "+_);var he=I&&x===void 0?HU(Y):a,X={};for(var ge in re)I&&ge==="as"||he(ge)&&(X[ge]=re[ge]);return X.className=Q,G&&(X.ref=G),W.createElement(W.Fragment,null,W.createElement(y_e,{cache:ne,serialized:oe,isStringTag:typeof Y=="string"}),W.createElement(Y,X))});return J.displayName=f!==void 0?f:"Styled("+(typeof c=="string"?c:c.displayName||c.name||"Component")+")",J.defaultProps=t.defaultProps,J.__emotion_real=J,J.__emotion_base=c,J.__emotion_styles=O,J.__emotion_forwardProp=x,Object.defineProperty(J,"toString",{value:function(){return _===void 0&&__e?"NO_COMPONENT_SELECTOR":"."+_}}),J.withComponent=function(re,ne){return e(re,NS({},r,ne,{shouldForwardProp:ZU(J,ne,!0)})).apply(void 0,O)},J}},x_e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Mk=v_e.bind();x_e.forEach(function(e){Mk[e]=Mk(e)});var V2={exports:{}},b_e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",w_e=b_e,T_e=w_e;function $2(){}function q2(){}q2.resetWarningCache=$2;var E_e=function(){function e(s,c,f,_,x,a){if(a!==T_e){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:q2,resetWarningCache:$2};return r.PropTypes=r,r};V2.exports=E_e();var S_e=V2.exports;const qr=Gy(S_e);function I_e(e){return e==null||Object.keys(e).length===0}function C_e(e){const{styles:t,defaultTheme:r={}}=e,s=typeof t=="function"?c=>t(I_e(c)?r:c):t;return N.jsx(f_e,{styles:s})}/**
 * @mui/styled-engine v6.0.2
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function A_e(e,t){return Mk(e,t)}const P_e=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))};function Mu(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function G2(e){if(!Mu(e))return e;const t={};return Object.keys(e).forEach(r=>{t[r]=G2(e[r])}),t}function Qo(e,t,r={clone:!0}){const s=r.clone?{...e}:e;return Mu(e)&&Mu(t)&&Object.keys(t).forEach(c=>{Mu(t[c])&&Object.prototype.hasOwnProperty.call(e,c)&&Mu(e[c])?s[c]=Qo(e[c],t[c],r):r.clone?s[c]=Mu(t[c])?G2(t[c]):t[c]:s[c]=t[c]}),s}const R_e=e=>{const t=Object.keys(e).map(r=>({key:r,val:e[r]}))||[];return t.sort((r,s)=>r.val-s.val),t.reduce((r,s)=>({...r,[s.key]:s.val}),{})};function M_e(e){const{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:r="px",step:s=5,...c}=e,f=R_e(t),_=Object.keys(f);function x(F){return`@media (min-width:${typeof t[F]=="number"?t[F]:F}${r})`}function a(F){return`@media (max-width:${(typeof t[F]=="number"?t[F]:F)-s/100}${r})`}function I(F,Z){const J=_.indexOf(Z);return`@media (min-width:${typeof t[F]=="number"?t[F]:F}${r}) and (max-width:${(J!==-1&&typeof t[_[J]]=="number"?t[_[J]]:Z)-s/100}${r})`}function D(F){return _.indexOf(F)+1<_.length?I(F,_[_.indexOf(F)+1]):x(F)}function O(F){const Z=_.indexOf(F);return Z===0?x(_[1]):Z===_.length-1?a(_[Z]):I(F,_[_.indexOf(F)+1]).replace("@media","@media not all and")}return{keys:_,values:f,up:x,down:a,between:I,only:D,not:O,unit:r,...c}}function k_e(e,t){if(!e.containerQueries)return t;const r=Object.keys(t).filter(s=>s.startsWith("@container")).sort((s,c)=>{var _,x;const f=/min-width:\s*([0-9.]+)/;return+(((_=s.match(f))==null?void 0:_[1])||0)-+(((x=c.match(f))==null?void 0:x[1])||0)});return r.length?r.reduce((s,c)=>{const f=t[c];return delete s[c],s[c]=f,s},{...t}):t}function D_e(e,t){return t==="@"||t.startsWith("@")&&(e.some(r=>t.startsWith(`@${r}`))||!!t.match(/^@\d/))}function O_e(e,t){const r=t.match(/^@([^/]+)?\/?(.+)?$/);if(!r)return null;const[,s,c]=r,f=Number.isNaN(+s)?s||0:+s;return e.containerQueries(c).up(f)}function L_e(e){const t=(f,_)=>f.replace("@media",_?`@container ${_}`:"@container");function r(f,_){f.up=(...x)=>t(e.breakpoints.up(...x),_),f.down=(...x)=>t(e.breakpoints.down(...x),_),f.between=(...x)=>t(e.breakpoints.between(...x),_),f.only=(...x)=>t(e.breakpoints.only(...x),_),f.not=(...x)=>{const a=t(e.breakpoints.not(...x),_);return a.includes("not all and")?a.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):a}}const s={},c=f=>(r(s,f),s);return r(c),{...e,containerQueries:c}}const z_e={borderRadius:4};function z1(e,t){return t?Qo(e,t,{clone:!1}):e}const SC={xs:0,sm:600,md:900,lg:1200,xl:1536},XU={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${SC[e]}px)`},N_e={containerQueries:e=>({up:t=>{let r=typeof t=="number"?t:SC[t]||t;return typeof r=="number"&&(r=`${r}px`),e?`@container ${e} (min-width:${r})`:`@container (min-width:${r})`}})};function Yh(e,t,r){const s=e.theme||{};if(Array.isArray(t)){const f=s.breakpoints||XU;return t.reduce((_,x,a)=>(_[f.up(f.keys[a])]=r(t[a]),_),{})}if(typeof t=="object"){const f=s.breakpoints||XU;return Object.keys(t).reduce((_,x)=>{if(D_e(f.keys,x)){const a=O_e(s.containerQueries?s:N_e,x);a&&(_[a]=r(t[x],x))}else if(Object.keys(f.values||SC).includes(x)){const a=f.up(x);_[a]=r(t[x],x)}else{const a=x;_[a]=t[a]}return _},{})}return r(t)}function F_e(e={}){var r;return((r=e.keys)==null?void 0:r.reduce((s,c)=>{const f=e.up(c);return s[f]={},s},{}))||{}}function B_e(e,t){return e.reduce((r,s)=>{const c=r[s];return(!c||Object.keys(c).length===0)&&delete r[s],r},t)}function Xn(e){if(typeof e!="string")throw new Error(Qh(7));return e.charAt(0).toUpperCase()+e.slice(1)}function IC(e,t,r=!0){if(!t||typeof t!="string")return null;if(e&&e.vars&&r){const s=`vars.${t}`.split(".").reduce((c,f)=>c&&c[f]?c[f]:null,e);if(s!=null)return s}return t.split(".").reduce((s,c)=>s&&s[c]!=null?s[c]:null,e)}function BS(e,t,r,s=r){let c;return typeof e=="function"?c=e(r):Array.isArray(e)?c=e[r]||s:c=IC(e,r)||s,t&&(c=t(c,s,e)),c}function Vs(e){const{prop:t,cssProperty:r=e.prop,themeKey:s,transform:c}=e,f=_=>{if(_[t]==null)return null;const x=_[t],a=_.theme,I=IC(a,s)||{};return Yh(_,x,O=>{let F=BS(I,c,O);return O===F&&typeof O=="string"&&(F=BS(I,c,`${t}${O==="default"?"":Xn(O)}`,O)),r===!1?F:{[r]:F}})};return f.propTypes={},f.filterProps=[t],f}function j_e(e){const t={};return r=>(t[r]===void 0&&(t[r]=e(r)),t[r])}const U_e={m:"margin",p:"padding"},V_e={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},KU={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},$_e=j_e(e=>{if(e.length>2)if(KU[e])e=KU[e];else return[e];const[t,r]=e.split(""),s=U_e[t],c=V_e[r]||"";return Array.isArray(c)?c.map(f=>s+f):[s+c]}),cO=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],uO=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...cO,...uO];function db(e,t,r,s){const c=IC(e,t,!0)??r;return typeof c=="number"||typeof c=="string"?f=>typeof f=="string"?f:typeof c=="string"?`calc(${f} * ${c})`:c*f:Array.isArray(c)?f=>{if(typeof f=="string")return f;const _=Math.abs(f),x=c[_];return f>=0?x:typeof x=="number"?-x:`-${x}`}:typeof c=="function"?c:()=>{}}function hO(e){return db(e,"spacing",8)}function fb(e,t){return typeof t=="string"||t==null?t:e(t)}function q_e(e,t){return r=>e.reduce((s,c)=>(s[c]=fb(t,r),s),{})}function G_e(e,t,r,s){if(!t.includes(r))return null;const c=$_e(r),f=q_e(c,s),_=e[r];return Yh(e,_,f)}function W2(e,t){const r=hO(e.theme);return Object.keys(e).map(s=>G_e(e,t,s,r)).reduce(z1,{})}function Rs(e){return W2(e,cO)}Rs.propTypes={};Rs.filterProps=cO;function Ms(e){return W2(e,uO)}Ms.propTypes={};Ms.filterProps=uO;function H2(e=8,t=hO({spacing:e})){if(e.mui)return e;const r=(...s)=>(s.length===0?[1]:s).map(f=>{const _=t(f);return typeof _=="number"?`${_}px`:_}).join(" ");return r.mui=!0,r}function CC(...e){const t=e.reduce((s,c)=>(c.filterProps.forEach(f=>{s[f]=c}),s),{}),r=s=>Object.keys(s).reduce((c,f)=>t[f]?z1(c,t[f](s)):c,{});return r.propTypes={},r.filterProps=e.reduce((s,c)=>s.concat(c.filterProps),[]),r}function Ul(e){return typeof e!="number"?e:`${e}px solid`}function Jl(e,t){return Vs({prop:e,themeKey:"borders",transform:t})}const W_e=Jl("border",Ul),H_e=Jl("borderTop",Ul),Z_e=Jl("borderRight",Ul),X_e=Jl("borderBottom",Ul),K_e=Jl("borderLeft",Ul),Q_e=Jl("borderColor"),Y_e=Jl("borderTopColor"),J_e=Jl("borderRightColor"),eye=Jl("borderBottomColor"),tye=Jl("borderLeftColor"),nye=Jl("outline",Ul),rye=Jl("outlineColor"),AC=e=>{if(e.borderRadius!==void 0&&e.borderRadius!==null){const t=db(e.theme,"shape.borderRadius",4),r=s=>({borderRadius:fb(t,s)});return Yh(e,e.borderRadius,r)}return null};AC.propTypes={};AC.filterProps=["borderRadius"];CC(W_e,H_e,Z_e,X_e,K_e,Q_e,Y_e,J_e,eye,tye,AC,nye,rye);const PC=e=>{if(e.gap!==void 0&&e.gap!==null){const t=db(e.theme,"spacing",8),r=s=>({gap:fb(t,s)});return Yh(e,e.gap,r)}return null};PC.propTypes={};PC.filterProps=["gap"];const RC=e=>{if(e.columnGap!==void 0&&e.columnGap!==null){const t=db(e.theme,"spacing",8),r=s=>({columnGap:fb(t,s)});return Yh(e,e.columnGap,r)}return null};RC.propTypes={};RC.filterProps=["columnGap"];const MC=e=>{if(e.rowGap!==void 0&&e.rowGap!==null){const t=db(e.theme,"spacing",8),r=s=>({rowGap:fb(t,s)});return Yh(e,e.rowGap,r)}return null};MC.propTypes={};MC.filterProps=["rowGap"];const iye=Vs({prop:"gridColumn"}),sye=Vs({prop:"gridRow"}),oye=Vs({prop:"gridAutoFlow"}),aye=Vs({prop:"gridAutoColumns"}),lye=Vs({prop:"gridAutoRows"}),cye=Vs({prop:"gridTemplateColumns"}),uye=Vs({prop:"gridTemplateRows"}),hye=Vs({prop:"gridTemplateAreas"}),dye=Vs({prop:"gridArea"});CC(PC,RC,MC,iye,sye,oye,aye,lye,cye,uye,hye,dye);function dy(e,t){return t==="grey"?t:e}const fye=Vs({prop:"color",themeKey:"palette",transform:dy}),pye=Vs({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:dy}),mye=Vs({prop:"backgroundColor",themeKey:"palette",transform:dy});CC(fye,pye,mye);function ol(e){return e<=1&&e!==0?`${e*100}%`:e}const gye=Vs({prop:"width",transform:ol}),dO=e=>{if(e.maxWidth!==void 0&&e.maxWidth!==null){const t=r=>{var c,f,_,x,a;const s=((_=(f=(c=e.theme)==null?void 0:c.breakpoints)==null?void 0:f.values)==null?void 0:_[r])||SC[r];return s?((a=(x=e.theme)==null?void 0:x.breakpoints)==null?void 0:a.unit)!=="px"?{maxWidth:`${s}${e.theme.breakpoints.unit}`}:{maxWidth:s}:{maxWidth:ol(r)}};return Yh(e,e.maxWidth,t)}return null};dO.filterProps=["maxWidth"];const _ye=Vs({prop:"minWidth",transform:ol}),yye=Vs({prop:"height",transform:ol}),vye=Vs({prop:"maxHeight",transform:ol}),xye=Vs({prop:"minHeight",transform:ol});Vs({prop:"size",cssProperty:"width",transform:ol});Vs({prop:"size",cssProperty:"height",transform:ol});const bye=Vs({prop:"boxSizing"});CC(gye,dO,_ye,yye,vye,xye,bye);const pb={border:{themeKey:"borders",transform:Ul},borderTop:{themeKey:"borders",transform:Ul},borderRight:{themeKey:"borders",transform:Ul},borderBottom:{themeKey:"borders",transform:Ul},borderLeft:{themeKey:"borders",transform:Ul},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Ul},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:AC},color:{themeKey:"palette",transform:dy},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:dy},backgroundColor:{themeKey:"palette",transform:dy},p:{style:Ms},pt:{style:Ms},pr:{style:Ms},pb:{style:Ms},pl:{style:Ms},px:{style:Ms},py:{style:Ms},padding:{style:Ms},paddingTop:{style:Ms},paddingRight:{style:Ms},paddingBottom:{style:Ms},paddingLeft:{style:Ms},paddingX:{style:Ms},paddingY:{style:Ms},paddingInline:{style:Ms},paddingInlineStart:{style:Ms},paddingInlineEnd:{style:Ms},paddingBlock:{style:Ms},paddingBlockStart:{style:Ms},paddingBlockEnd:{style:Ms},m:{style:Rs},mt:{style:Rs},mr:{style:Rs},mb:{style:Rs},ml:{style:Rs},mx:{style:Rs},my:{style:Rs},margin:{style:Rs},marginTop:{style:Rs},marginRight:{style:Rs},marginBottom:{style:Rs},marginLeft:{style:Rs},marginX:{style:Rs},marginY:{style:Rs},marginInline:{style:Rs},marginInlineStart:{style:Rs},marginInlineEnd:{style:Rs},marginBlock:{style:Rs},marginBlockStart:{style:Rs},marginBlockEnd:{style:Rs},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:PC},rowGap:{style:MC},columnGap:{style:RC},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:ol},maxWidth:{style:dO},minWidth:{transform:ol},height:{transform:ol},maxHeight:{transform:ol},minHeight:{transform:ol},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function wye(...e){const t=e.reduce((s,c)=>s.concat(Object.keys(c)),[]),r=new Set(t);return e.every(s=>r.size===Object.keys(s).length)}function Tye(e,t){return typeof e=="function"?e(t):e}function Eye(){function e(r,s,c,f){const _={[r]:s,theme:c},x=f[r];if(!x)return{[r]:s};const{cssProperty:a=r,themeKey:I,transform:D,style:O}=x;if(s==null)return null;if(I==="typography"&&s==="inherit")return{[r]:s};const F=IC(c,I)||{};return O?O(_):Yh(_,s,J=>{let re=BS(F,D,J);return J===re&&typeof J=="string"&&(re=BS(F,D,`${r}${J==="default"?"":Xn(J)}`,J)),a===!1?re:{[a]:re}})}function t(r){const{sx:s,theme:c={}}=r||{};if(!s)return null;const f=c.unstable_sxConfig??pb;function _(x){let a=x;if(typeof x=="function")a=x(c);else if(typeof x!="object")return x;if(!a)return null;const I=F_e(c.breakpoints),D=Object.keys(I);let O=I;return Object.keys(a).forEach(F=>{const Z=Tye(a[F],c);if(Z!=null)if(typeof Z=="object")if(f[F])O=z1(O,e(F,Z,c,f));else{const J=Yh({theme:c},Z,re=>({[F]:re}));wye(J,Z)?O[F]=t({sx:Z,theme:c}):O=z1(O,J)}else O=z1(O,e(F,Z,c,f))}),k_e(c,B_e(D,O))}return Array.isArray(s)?s.map(_):_(s)}return t}const mb=Eye();mb.filterProps=["sx"];function Sye(e,t){var s;const r=this;if(r.vars){if(!((s=r.colorSchemes)!=null&&s[e])||typeof r.getColorSchemeSelector!="function")return{};let c=r.getColorSchemeSelector(e);return(c.includes("data-")||c.includes("."))&&(c=`*:where(${c.replace(/\s*&$/,"")}) &`),{[c]:t}}return r.palette.mode===e?t:{}}function fO(e={},...t){const{breakpoints:r={},palette:s={},spacing:c,shape:f={},..._}=e,x=M_e(r),a=H2(c);let I=Qo({breakpoints:x,direction:"ltr",components:{},palette:{mode:"light",...s},spacing:a,shape:{...z_e,...f}},_);return I=L_e(I),I.applyStyles=Sye,I=t.reduce((D,O)=>Qo(D,O),I),I.unstable_sxConfig={...pb,..._==null?void 0:_.unstable_sxConfig},I.unstable_sx=function(O){return mb({sx:O,theme:this})},I}function Iye(e){return Object.keys(e).length===0}function Z2(e=null){const t=W.useContext(aO);return!t||Iye(t)?e:t}const Cye=fO();function pO(e=Cye){return Z2(e)}function Aye({styles:e,themeId:t,defaultTheme:r={}}){const s=pO(r),c=typeof e=="function"?e(t&&s[t]||s):e;return N.jsx(C_e,{styles:c})}const Pye=e=>{var s;const t={systemProps:{},otherProps:{}},r=((s=e==null?void 0:e.theme)==null?void 0:s.unstable_sxConfig)??pb;return Object.keys(e).forEach(c=>{r[c]?t.systemProps[c]=e[c]:t.otherProps[c]=e[c]}),t};function Rye(e){const{sx:t,...r}=e,{systemProps:s,otherProps:c}=Pye(r);let f;return Array.isArray(t)?f=[s,...t]:typeof t=="function"?f=(..._)=>{const x=t(..._);return Mu(x)?{...s,...x}:s}:f={...s,...t},{...c,sx:f}}const QU=e=>e,Mye=()=>{let e=QU;return{configure(t){e=t},generate(t){return e(t)},reset(){e=QU}}},kye=Mye();function X2(e){var t,r,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var c=e.length;for(t=0;t<c;t++)e[t]&&(r=X2(e[t]))&&(s&&(s+=" "),s+=r)}else for(r in e)e[r]&&(s&&(s+=" "),s+=r);return s}function Mr(){for(var e,t,r=0,s="",c=arguments.length;r<c;r++)(e=arguments[r])&&(t=X2(e))&&(s&&(s+=" "),s+=t);return s}const Dye={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Si(e,t,r="Mui"){const s=Dye[t];return s?`${r}-${s}`:`${kye.generate(e)}-${t}`}function Ii(e,t,r="Mui"){const s={};return t.forEach(c=>{s[c]=Si(e,c,r)}),s}var Pi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mO=Symbol.for("react.element"),gO=Symbol.for("react.portal"),kC=Symbol.for("react.fragment"),DC=Symbol.for("react.strict_mode"),OC=Symbol.for("react.profiler"),LC=Symbol.for("react.provider"),zC=Symbol.for("react.context"),Oye=Symbol.for("react.server_context"),NC=Symbol.for("react.forward_ref"),FC=Symbol.for("react.suspense"),BC=Symbol.for("react.suspense_list"),jC=Symbol.for("react.memo"),UC=Symbol.for("react.lazy"),Lye=Symbol.for("react.offscreen"),K2;K2=Symbol.for("react.module.reference");function ec(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case mO:switch(e=e.type,e){case kC:case OC:case DC:case FC:case BC:return e;default:switch(e=e&&e.$$typeof,e){case Oye:case zC:case NC:case UC:case jC:case LC:return e;default:return t}}case gO:return t}}}Pi.ContextConsumer=zC;Pi.ContextProvider=LC;Pi.Element=mO;Pi.ForwardRef=NC;Pi.Fragment=kC;Pi.Lazy=UC;Pi.Memo=jC;Pi.Portal=gO;Pi.Profiler=OC;Pi.StrictMode=DC;Pi.Suspense=FC;Pi.SuspenseList=BC;Pi.isAsyncMode=function(){return!1};Pi.isConcurrentMode=function(){return!1};Pi.isContextConsumer=function(e){return ec(e)===zC};Pi.isContextProvider=function(e){return ec(e)===LC};Pi.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===mO};Pi.isForwardRef=function(e){return ec(e)===NC};Pi.isFragment=function(e){return ec(e)===kC};Pi.isLazy=function(e){return ec(e)===UC};Pi.isMemo=function(e){return ec(e)===jC};Pi.isPortal=function(e){return ec(e)===gO};Pi.isProfiler=function(e){return ec(e)===OC};Pi.isStrictMode=function(e){return ec(e)===DC};Pi.isSuspense=function(e){return ec(e)===FC};Pi.isSuspenseList=function(e){return ec(e)===BC};Pi.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===kC||e===OC||e===DC||e===FC||e===BC||e===Lye||typeof e=="object"&&e!==null&&(e.$$typeof===UC||e.$$typeof===jC||e.$$typeof===LC||e.$$typeof===zC||e.$$typeof===NC||e.$$typeof===K2||e.getModuleId!==void 0)};Pi.typeOf=ec;const zye=fO();function bR(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}function kk(e,t,r){return Fye(t)?r:t[e]||t}const GT=Symbol("mui.processed_props");function WT(e,t,r){if(GT in e)return e[GT];const s={...e,theme:kk(t,e.theme,r)};return e[GT]=s,s[GT]=s,s}function Nye(e){return e?(t,r)=>r[e]:null}function PE(e,t){var s;const r=typeof e=="function"?e(t):e;if(Array.isArray(r))return r.flatMap(c=>PE(c,t));if(Array.isArray(r==null?void 0:r.variants)){const{variants:c,...f}=r;let _=f,x;e:for(let a=0;a<c.length;a+=1){const I=c[a];if(typeof I.props=="function"){if(x??(x={...t,...t.ownerState,ownerState:t.ownerState}),!I.props(x))continue}else for(const D in I.props)if(t[D]!==I.props[D]&&((s=t.ownerState)==null?void 0:s[D])!==I.props[D])continue e;Array.isArray(_)||(_=[_]),typeof I.style=="function"?(x??(x={...t,...t.ownerState,ownerState:t.ownerState}),_.push(I.style(x))):_.push(I.style)}return _}return r}function Q2(e={}){const{themeId:t,defaultTheme:r=zye,rootShouldForwardProp:s=bR,slotShouldForwardProp:c=bR}=e,f=x=>mb(WT(x,t,r));return f.__mui_systemSx=!0,(x,a={})=>{P_e(x,we=>we.filter(oe=>!(oe!=null&&oe.__mui_systemSx)));const{name:I,slot:D,skipVariantsResolver:O,skipSx:F,overridesResolver:Z=Nye(jye(D)),...J}=a,re=O!==void 0?O:D&&D!=="Root"&&D!=="root"||!1,ne=F||!1;let G,Y=bR;D==="Root"||D==="root"?Y=s:D?Y=c:Bye(x)&&(Y=void 0);const Q=A_e(x,{shouldForwardProp:Y,label:G,...J}),de=we=>typeof we=="function"&&we.__emotion_real!==we||Mu(we)?oe=>PE(we,WT(oe,t,r)):we,Te=(we,...oe)=>{let he=de(we);const X=oe?oe.map(de):[];I&&Z&&X.push(ke=>{const Ee=kk(t,ke.theme,r);if(!Ee.components||!Ee.components[I]||!Ee.components[I].styleOverrides)return null;const zt=Ee.components[I].styleOverrides,Ut={},Qt=WT(ke,t,r);for(const kt in zt)Ut[kt]=PE(zt[kt],Qt);return Z(ke,Ut)}),I&&!re&&X.push(ke=>{var Ut,Qt;const Ee=kk(t,ke.theme,r),zt=(Qt=(Ut=Ee==null?void 0:Ee.components)==null?void 0:Ut[I])==null?void 0:Qt.variants;return zt?PE({variants:zt},WT(ke,t,r)):null}),ne||X.push(f);const ge=X.length-oe.length;if(Array.isArray(we)&&ge>0){const ke=new Array(ge).fill("");he=[...we,...ke],he.raw=[...we.raw,...ke]}const be=Q(he,...X);return x.muiName&&(be.muiName=x.muiName),be};return Q.withConfig&&(Te.withConfig=Q.withConfig),Te}}function Fye(e){for(const t in e)return!1;return!0}function Bye(e){return typeof e=="string"&&e.charCodeAt(0)>96}function jye(e){return e&&e.charAt(0).toLowerCase()+e.slice(1)}const Hu=Q2();function Px(e,t){const r={...t};for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const c=s;if(c==="components"||c==="slots")r[c]={...e[c],...r[c]};else if(c==="componentsProps"||c==="slotProps"){const f=e[c],_=t[c];if(!_)r[c]=f||{};else if(!f)r[c]=_;else{r[c]={..._};for(const x in f)if(Object.prototype.hasOwnProperty.call(f,x)){const a=x;r[c][a]=Px(f[a],_[a])}}}else r[c]===void 0&&(r[c]=e[c])}return r}function Y2(e){const{theme:t,name:r,props:s}=e;return!t||!t.components||!t.components[r]||!t.components[r].defaultProps?s:Px(t.components[r].defaultProps,s)}function Uye({props:e,name:t,defaultTheme:r,themeId:s}){let c=pO(r);return s&&(c=c[s]||c),Y2({theme:c,name:t,props:e})}const Bf=typeof window<"u"?W.useLayoutEffect:W.useEffect;function Vye(e,t,r,s,c){const[f,_]=W.useState(()=>c&&r?r(e).matches:s?s(e).matches:t);return Bf(()=>{if(!r)return;const x=r(e),a=()=>{_(x.matches)};return a(),x.addEventListener("change",a),()=>{x.removeEventListener("change",a)}},[e,r]),f}const J2=W.useSyncExternalStore;function $ye(e,t,r,s,c){const f=W.useCallback(()=>t,[t]),_=W.useMemo(()=>{if(c&&r)return()=>r(e).matches;if(s!==null){const{matches:D}=s(e);return()=>D}return f},[f,e,s,c,r]),[x,a]=W.useMemo(()=>{if(r===null)return[f,()=>()=>{}];const D=r(e);return[()=>D.matches,O=>(D.addEventListener("change",O),()=>{D.removeEventListener("change",O)})]},[f,r,e]);return J2(a,x,_)}function YU(e,t={}){const r=Z2(),s=typeof window<"u"&&typeof window.matchMedia<"u",{defaultMatches:c=!1,matchMedia:f=s?window.matchMedia:null,ssrMatchMedia:_=null,noSsr:x=!1}=Y2({name:"MuiUseMediaQuery",props:t,theme:r});let a=typeof e=="function"?e(r):e;return a=a.replace(/^@media( ?)/m,""),(J2!==void 0?$ye:Vye)(a,c,f,_,x)}function qye(e,t=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER){return Math.max(t,Math.min(e,r))}function _O(e,t=0,r=1){return qye(e,t,r)}function Gye(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let r=e.match(t);return r&&r[0].length===1&&(r=r.map(s=>s+s)),r?`rgb${r.length===4?"a":""}(${r.map((s,c)=>c<3?parseInt(s,16):Math.round(parseInt(s,16)/255*1e3)/1e3).join(", ")})`:""}function jf(e){if(e.type)return e;if(e.charAt(0)==="#")return jf(Gye(e));const t=e.indexOf("("),r=e.substring(0,t);if(!["rgb","rgba","hsl","hsla","color"].includes(r))throw new Error(Qh(9,e));let s=e.substring(t+1,e.length-1),c;if(r==="color"){if(s=s.split(" "),c=s.shift(),s.length===4&&s[3].charAt(0)==="/"&&(s[3]=s[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(c))throw new Error(Qh(10,c))}else s=s.split(",");return s=s.map(f=>parseFloat(f)),{type:r,values:s,colorSpace:c}}const Wye=e=>{const t=jf(e);return t.values.slice(0,3).map((r,s)=>t.type.includes("hsl")&&s!==0?`${r}%`:r).join(" ")},c1=(e,t)=>{try{return Wye(e)}catch{return e}};function VC(e){const{type:t,colorSpace:r}=e;let{values:s}=e;return t.includes("rgb")?s=s.map((c,f)=>f<3?parseInt(c,10):c):t.includes("hsl")&&(s[1]=`${s[1]}%`,s[2]=`${s[2]}%`),t.includes("color")?s=`${r} ${s.join(" ")}`:s=`${s.join(", ")}`,`${t}(${s})`}function eH(e){e=jf(e);const{values:t}=e,r=t[0],s=t[1]/100,c=t[2]/100,f=s*Math.min(c,1-c),_=(I,D=(I+r/30)%12)=>c-f*Math.max(Math.min(D-3,9-D,1),-1);let x="rgb";const a=[Math.round(_(0)*255),Math.round(_(8)*255),Math.round(_(4)*255)];return e.type==="hsla"&&(x+="a",a.push(t[3])),VC({type:x,values:a})}function Dk(e){e=jf(e);let t=e.type==="hsl"||e.type==="hsla"?jf(eH(e)).values:e.values;return t=t.map(r=>(e.type!=="color"&&(r/=255),r<=.03928?r/12.92:((r+.055)/1.055)**2.4)),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function Hye(e,t){const r=Dk(e),s=Dk(t);return(Math.max(r,s)+.05)/(Math.min(r,s)+.05)}function $l(e,t){return e=jf(e),t=_O(t),(e.type==="rgb"||e.type==="hsl")&&(e.type+="a"),e.type==="color"?e.values[3]=`/${t}`:e.values[3]=t,VC(e)}function HT(e,t,r){try{return $l(e,t)}catch{return e}}function yO(e,t){if(e=jf(e),t=_O(t),e.type.includes("hsl"))e.values[2]*=1-t;else if(e.type.includes("rgb")||e.type.includes("color"))for(let r=0;r<3;r+=1)e.values[r]*=1-t;return VC(e)}function Li(e,t,r){try{return yO(e,t)}catch{return e}}function vO(e,t){if(e=jf(e),t=_O(t),e.type.includes("hsl"))e.values[2]+=(100-e.values[2])*t;else if(e.type.includes("rgb"))for(let r=0;r<3;r+=1)e.values[r]+=(255-e.values[r])*t;else if(e.type.includes("color"))for(let r=0;r<3;r+=1)e.values[r]+=(1-e.values[r])*t;return VC(e)}function zi(e,t,r){try{return vO(e,t)}catch{return e}}function Zye(e,t=.15){return Dk(e)>.5?yO(e,t):vO(e,t)}function ZT(e,t,r){try{return Zye(e,t)}catch{return e}}function Ok(...e){return e.reduce((t,r)=>r==null?t:function(...c){t.apply(this,c),r.apply(this,c)},()=>{})}function tH(e,t=166){let r;function s(...c){const f=()=>{e.apply(this,c)};clearTimeout(r),r=setTimeout(f,t)}return s.clear=()=>{clearTimeout(r)},s}function wR(e,t){var r,s,c;return W.isValidElement(e)&&t.indexOf(e.type.muiName??((c=(s=(r=e.type)==null?void 0:r._payload)==null?void 0:s.value)==null?void 0:c.muiName))!==-1}function ml(e){return e&&e.ownerDocument||document}function $m(e){return ml(e).defaultView||window}function Lk(e,t){typeof e=="function"?e(t):e&&(e.current=t)}let JU=0;function Xye(e){const[t,r]=W.useState(e),s=e||t;return W.useEffect(()=>{t==null&&(JU+=1,r(`mui-${JU}`))},[t]),s}const eV=jE.useId;function xO(e){if(eV!==void 0){const t=eV();return e??t}return Xye(e)}function jS({controlled:e,default:t,name:r,state:s="value"}){const{current:c}=W.useRef(e!==void 0),[f,_]=W.useState(t),x=c?e:f,a=W.useCallback(I=>{c||_(I)},[]);return[x,a]}function Z_(e){const t=W.useRef(e);return Bf(()=>{t.current=e}),W.useRef((...r)=>(0,t.current)(...r)).current}function Oo(...e){return W.useMemo(()=>e.every(t=>t==null)?null:t=>{e.forEach(r=>{Lk(r,t)})},e)}const tV={};function nH(e,t){const r=W.useRef(tV);return r.current===tV&&(r.current=e(t)),r}const Kye=[];function Qye(e){W.useEffect(e,Kye)}class bO{constructor(){kv(this,"currentId",null);kv(this,"clear",()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)});kv(this,"disposeEffect",()=>this.clear)}static create(){return new bO}start(t,r){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,r()},t)}}function rH(){const e=nH(bO.create).current;return Qye(e.disposeEffect),e}function nV(e){try{return e.matches(":focus-visible")}catch{}return!1}function iH(e){const t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}const sH=e=>{const t=W.useRef({});return W.useEffect(()=>{t.current=e}),t.current};function Ri(e,t,r=void 0){const s={};for(const c in e){const f=e[c];let _="",x=!0;for(let a=0;a<f.length;a+=1){const I=f[a];I&&(_+=(x===!0?"":" ")+t(I),x=!1,r&&r[I]&&(_+=" "+r[I]))}s[c]=_}return s}function Yye(e){return typeof e=="string"}function oH(e,t,r){return e===void 0||Yye(e)?t:{...t,ownerState:{...t.ownerState,...r}}}function aH(e,t=[]){if(e===void 0)return{};const r={};return Object.keys(e).filter(s=>s.match(/^on[A-Z]/)&&typeof e[s]=="function"&&!t.includes(s)).forEach(s=>{r[s]=e[s]}),r}function rV(e){if(e===void 0)return{};const t={};return Object.keys(e).filter(r=>!(r.match(/^on[A-Z]/)&&typeof e[r]=="function")).forEach(r=>{t[r]=e[r]}),t}function lH(e){const{getSlotProps:t,additionalProps:r,externalSlotProps:s,externalForwardedProps:c,className:f}=e;if(!t){const Z=Mr(r==null?void 0:r.className,f,c==null?void 0:c.className,s==null?void 0:s.className),J={...r==null?void 0:r.style,...c==null?void 0:c.style,...s==null?void 0:s.style},re={...r,...c,...s};return Z.length>0&&(re.className=Z),Object.keys(J).length>0&&(re.style=J),{props:re,internalRef:void 0}}const _=aH({...c,...s}),x=rV(s),a=rV(c),I=t(_),D=Mr(I==null?void 0:I.className,r==null?void 0:r.className,f,c==null?void 0:c.className,s==null?void 0:s.className),O={...I==null?void 0:I.style,...r==null?void 0:r.style,...c==null?void 0:c.style,...s==null?void 0:s.style},F={...I,...r,...a,...x};return D.length>0&&(F.className=D),Object.keys(O).length>0&&(F.style=O),{props:F,internalRef:I.ref}}function cH(e,t,r){return typeof e=="function"?e(t,r):e}function US(e){var O;const{elementType:t,externalSlotProps:r,ownerState:s,skipResolvingSlotProps:c=!1,...f}=e,_=c?{}:cH(r,s),{props:x,internalRef:a}=lH({...f,externalSlotProps:_}),I=Oo(a,_==null?void 0:_.ref,(O=e.additionalProps)==null?void 0:O.ref);return oH(t,{...x,ref:I},s)}function gb(e){return!e||!W.isValidElement(e)?null:e.props.propertyIsEnumerable("ref")?e.props.ref:e.ref}const Jye=W.createContext(),e0e=()=>W.useContext(Jye)??!1,t0e=W.createContext(void 0);function n0e(e){const{theme:t,name:r,props:s}=e;if(!t||!t.components||!t.components[r])return s;const c=t.components[r];return c.defaultProps?Px(c.defaultProps,s):!c.styleOverrides&&!c.variants?Px(c,s):s}function r0e({props:e,name:t}){const r=W.useContext(t0e);return n0e({props:e,name:t,theme:{components:r}})}function i0e(e=""){function t(...s){if(!s.length)return"";const c=s[0];return typeof c=="string"&&!c.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${e?`${e}-`:""}${c}${t(...s.slice(1))})`:`, ${c}`}return(s,...c)=>`var(--${e?`${e}-`:""}${s}${t(...c)})`}const iV=(e,t,r,s=[])=>{let c=e;t.forEach((f,_)=>{_===t.length-1?Array.isArray(c)?c[Number(f)]=r:c&&typeof c=="object"&&(c[f]=r):c&&typeof c=="object"&&(c[f]||(c[f]=s.includes(f)?[]:{}),c=c[f])})},s0e=(e,t,r)=>{function s(c,f=[],_=[]){Object.entries(c).forEach(([x,a])=>{(!r||r&&!r([...f,x]))&&a!=null&&(typeof a=="object"&&Object.keys(a).length>0?s(a,[...f,x],Array.isArray(a)?[..._,x]:_):t([...f,x],a,_))})}s(e)},o0e=(e,t)=>typeof t=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(s=>e.includes(s))||e[e.length-1].toLowerCase().indexOf("opacity")>=0?t:`${t}px`:t;function TR(e,t){const{prefix:r,shouldSkipGeneratingVar:s}=t||{},c={},f={},_={};return s0e(e,(x,a,I)=>{if((typeof a=="string"||typeof a=="number")&&(!s||!s(x,a))){const D=`--${r?`${r}-`:""}${x.join("-")}`,O=o0e(x,a);Object.assign(c,{[D]:O}),iV(f,x,`var(${D})`,I),iV(_,x,`var(${D}, ${O})`,I)}},x=>x[0]==="vars"),{css:c,vars:f,varsWithDefaults:_}}function a0e(e,t={}){const{getSelector:r=ne,disableCssColorScheme:s,colorSchemeSelector:c}=t,{colorSchemes:f={},components:_,defaultColorScheme:x="light",...a}=e,{vars:I,css:D,varsWithDefaults:O}=TR(a,t);let F=O;const Z={},{[x]:J,...re}=f;if(Object.entries(re||{}).forEach(([Q,de])=>{const{vars:Te,css:we,varsWithDefaults:oe}=TR(de,t);F=Qo(F,oe),Z[Q]={css:we,vars:Te}}),J){const{css:Q,vars:de,varsWithDefaults:Te}=TR(J,t);F=Qo(F,Te),Z[x]={css:Q,vars:de}}function ne(Q,de){var we,oe;let Te=c;if(c==="class"&&(Te=".%s"),c==="data"&&(Te="[data-%s]"),c!=null&&c.startsWith("data-")&&!c.includes("%s")&&(Te=`[${c}="%s"]`),Q){if(Te==="media")return e.defaultColorScheme===Q?":root":{[`@media (prefers-color-scheme: ${((oe=(we=f[Q])==null?void 0:we.palette)==null?void 0:oe.mode)||Q})`]:{":root":de}};if(Te)return e.defaultColorScheme===Q?`:root, ${Te.replace("%s",String(Q))}`:Te.replace("%s",String(Q))}return":root"}return{vars:F,generateThemeVars:()=>{let Q={...I};return Object.entries(Z).forEach(([,{vars:de}])=>{Q=Qo(Q,de)}),Q},generateStyleSheets:()=>{var he,X;const Q=[],de=e.defaultColorScheme||"light";function Te(ge,be){Object.keys(be).length&&Q.push(typeof ge=="string"?{[ge]:{...be}}:ge)}Te(r(void 0,{...D}),D);const{[de]:we,...oe}=Z;if(we){const{css:ge}=we,be=(X=(he=f[de])==null?void 0:he.palette)==null?void 0:X.mode,ke=!s&&be?{colorScheme:be,...ge}:{...ge};Te(r(de,{...ke}),ke)}return Object.entries(oe).forEach(([ge,{css:be}])=>{var zt,Ut;const ke=(Ut=(zt=f[ge])==null?void 0:zt.palette)==null?void 0:Ut.mode,Ee=!s&&ke?{colorScheme:ke,...be}:{...be};Te(r(ge,{...Ee}),Ee)}),Q}}}function l0e(e){return function(r){return e==="media"?`@media (prefers-color-scheme: ${r})`:e?e.startsWith("data-")&&!e.includes("%s")?`[${e}="${r}"] &`:e==="class"?`.${r} &`:e==="data"?`[data-${r}] &`:`${e.replace("%s",r)} &`:"&"}}const sV={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Sx.white,default:Sx.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},ER={text:{primary:Sx.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Sx.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function oV(e,t,r,s){const c=s.light||s,f=s.dark||s*1.5;e[t]||(e.hasOwnProperty(r)?e[t]=e[r]:t==="light"?e.light=vO(e.main,c):t==="dark"&&(e.dark=yO(e.main,f)))}function c0e(e="light"){return e==="dark"?{main:w_[200],light:w_[50],dark:w_[400]}:{main:w_[700],light:w_[400],dark:w_[800]}}function u0e(e="light"){return e==="dark"?{main:b_[200],light:b_[50],dark:b_[400]}:{main:b_[500],light:b_[300],dark:b_[700]}}function h0e(e="light"){return e==="dark"?{main:x_[500],light:x_[300],dark:x_[700]}:{main:x_[700],light:x_[400],dark:x_[800]}}function d0e(e="light"){return e==="dark"?{main:T_[400],light:T_[300],dark:T_[700]}:{main:T_[700],light:T_[500],dark:T_[900]}}function f0e(e="light"){return e==="dark"?{main:E_[400],light:E_[300],dark:E_[700]}:{main:E_[800],light:E_[500],dark:E_[900]}}function p0e(e="light"){return e==="dark"?{main:qv[400],light:qv[300],dark:qv[700]}:{main:"#ed6c02",light:qv[500],dark:qv[900]}}function wO(e){const{mode:t="light",contrastThreshold:r=3,tonalOffset:s=.2,...c}=e,f=e.primary||c0e(t),_=e.secondary||u0e(t),x=e.error||h0e(t),a=e.info||d0e(t),I=e.success||f0e(t),D=e.warning||p0e(t);function O(re){return Hye(re,ER.text.primary)>=r?ER.text.primary:sV.text.primary}const F=({color:re,name:ne,mainShade:G=500,lightShade:Y=300,darkShade:Q=700})=>{if(re={...re},!re.main&&re[G]&&(re.main=re[G]),!re.hasOwnProperty("main"))throw new Error(Qh(11,ne?` (${ne})`:"",G));if(typeof re.main!="string")throw new Error(Qh(12,ne?` (${ne})`:"",JSON.stringify(re.main)));return oV(re,"light",Y,s),oV(re,"dark",Q,s),re.contrastText||(re.contrastText=O(re.main)),re},Z={dark:ER,light:sV};return Qo({common:{...Sx},mode:t,primary:F({color:f,name:"primary"}),secondary:F({color:_,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:F({color:x,name:"error"}),warning:F({color:D,name:"warning"}),info:F({color:a,name:"info"}),success:F({color:I,name:"success"}),grey:Tge,contrastThreshold:r,getContrastText:O,augmentColor:F,tonalOffset:s,...Z[t]},c)}function m0e(e){const t={};return Object.entries(e).forEach(s=>{const[c,f]=s;typeof f=="object"&&(t[c]=`${f.fontStyle?`${f.fontStyle} `:""}${f.fontVariant?`${f.fontVariant} `:""}${f.fontWeight?`${f.fontWeight} `:""}${f.fontStretch?`${f.fontStretch} `:""}${f.fontSize||""}${f.lineHeight?`/${f.lineHeight} `:""}${f.fontFamily||""}`)}),t}function g0e(e,t){return{toolbar:{minHeight:56,[e.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[e.up("sm")]:{minHeight:64}},...t}}function _0e(e){return Math.round(e*1e5)/1e5}const aV={textTransform:"uppercase"},lV='"Roboto", "Helvetica", "Arial", sans-serif';function y0e(e,t){const{fontFamily:r=lV,fontSize:s=14,fontWeightLight:c=300,fontWeightRegular:f=400,fontWeightMedium:_=500,fontWeightBold:x=700,htmlFontSize:a=16,allVariants:I,pxToRem:D,...O}=typeof t=="function"?t(e):t,F=s/14,Z=D||(ne=>`${ne/a*F}rem`),J=(ne,G,Y,Q,de)=>({fontFamily:r,fontWeight:ne,fontSize:Z(G),lineHeight:Y,...r===lV?{letterSpacing:`${_0e(Q/G)}em`}:{},...de,...I}),re={h1:J(c,96,1.167,-1.5),h2:J(c,60,1.2,-.5),h3:J(f,48,1.167,0),h4:J(f,34,1.235,.25),h5:J(f,24,1.334,0),h6:J(_,20,1.6,.15),subtitle1:J(f,16,1.75,.15),subtitle2:J(_,14,1.57,.1),body1:J(f,16,1.5,.15),body2:J(f,14,1.43,.15),button:J(_,14,1.75,.4,aV),caption:J(f,12,1.66,.4),overline:J(f,12,2.66,1,aV),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return Qo({htmlFontSize:a,pxToRem:Z,fontFamily:r,fontSize:s,fontWeightLight:c,fontWeightRegular:f,fontWeightMedium:_,fontWeightBold:x,...re},O,{clone:!1})}const v0e=.2,x0e=.14,b0e=.12;function us(...e){return[`${e[0]}px ${e[1]}px ${e[2]}px ${e[3]}px rgba(0,0,0,${v0e})`,`${e[4]}px ${e[5]}px ${e[6]}px ${e[7]}px rgba(0,0,0,${x0e})`,`${e[8]}px ${e[9]}px ${e[10]}px ${e[11]}px rgba(0,0,0,${b0e})`].join(",")}const w0e=["none",us(0,2,1,-1,0,1,1,0,0,1,3,0),us(0,3,1,-2,0,2,2,0,0,1,5,0),us(0,3,3,-2,0,3,4,0,0,1,8,0),us(0,2,4,-1,0,4,5,0,0,1,10,0),us(0,3,5,-1,0,5,8,0,0,1,14,0),us(0,3,5,-1,0,6,10,0,0,1,18,0),us(0,4,5,-2,0,7,10,1,0,2,16,1),us(0,5,5,-3,0,8,10,1,0,3,14,2),us(0,5,6,-3,0,9,12,1,0,3,16,2),us(0,6,6,-3,0,10,14,1,0,4,18,3),us(0,6,7,-4,0,11,15,1,0,4,20,3),us(0,7,8,-4,0,12,17,2,0,5,22,4),us(0,7,8,-4,0,13,19,2,0,5,24,4),us(0,7,9,-4,0,14,21,2,0,5,26,4),us(0,8,9,-5,0,15,22,2,0,6,28,5),us(0,8,10,-5,0,16,24,2,0,6,30,5),us(0,8,11,-5,0,17,26,2,0,6,32,5),us(0,9,11,-5,0,18,28,2,0,7,34,6),us(0,9,12,-6,0,19,29,2,0,7,36,6),us(0,10,13,-6,0,20,31,3,0,8,38,7),us(0,10,13,-6,0,21,33,3,0,8,40,7),us(0,10,14,-6,0,22,35,3,0,8,42,7),us(0,11,14,-7,0,23,36,3,0,9,44,8),us(0,11,15,-7,0,24,38,3,0,9,46,8)],T0e={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},E0e={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function cV(e){return`${Math.round(e)}ms`}function S0e(e){if(!e)return 0;const t=e/36;return Math.min(Math.round((4+15*t**.25+t/5)*10),3e3)}function I0e(e){const t={...T0e,...e.easing},r={...E0e,...e.duration};return{getAutoHeightDuration:S0e,create:(c=["all"],f={})=>{const{duration:_=r.standard,easing:x=t.easeInOut,delay:a=0,...I}=f;return(Array.isArray(c)?c:[c]).map(D=>`${D} ${typeof _=="string"?_:cV(_)} ${x} ${typeof a=="string"?a:cV(a)}`).join(",")},...e,easing:t,duration:r}}const C0e={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function zk(e={},...t){const{breakpoints:r,mixins:s={},spacing:c,palette:f={},transitions:_={},typography:x={},shape:a,...I}=e;if(e.vars)throw new Error(Qh(20));const D=wO(f),O=fO(e);let F=Qo(O,{mixins:g0e(O.breakpoints,s),palette:D,shadows:w0e.slice(),typography:y0e(D,x),transitions:I0e(_),zIndex:{...C0e}});return F=Qo(F,I),F=t.reduce((Z,J)=>Qo(Z,J),F),F.unstable_sxConfig={...pb,...I==null?void 0:I.unstable_sxConfig},F.unstable_sx=function(J){return mb({sx:J,theme:this})},F}function Nk(e){let t;return e<1?t=5.11916*e**2:t=4.5*Math.log(e+1)+2,Math.round(t*10)/1e3}const A0e=[...Array(25)].map((e,t)=>{if(t===0)return;const r=Nk(t);return`linear-gradient(rgba(255 255 255 / ${r}), rgba(255 255 255 / ${r}))`});function uH(e){return{inputPlaceholder:e==="dark"?.5:.42,inputUnderline:e==="dark"?.7:.42,switchTrackDisabled:e==="dark"?.2:.12,switchTrack:e==="dark"?.3:.38}}function hH(e){return e==="dark"?A0e:[]}function P0e(e){const{palette:t={mode:"light"},opacity:r,overlays:s,...c}=e,f=wO(t);return{palette:f,opacity:{...uH(f.mode),...r},overlays:s||hH(f.mode),...c}}function R0e(e){var t;return!!e[0].match(/(cssVarPrefix|colorSchemeSelector|typography|mixins|breakpoints|direction|transitions)/)||!!e[0].match(/sxConfig$/)||e[0]==="palette"&&!!((t=e[1])!=null&&t.match(/(mode|contrastThreshold|tonalOffset)/))}const M0e=e=>[...[...Array(24)].map((t,r)=>`--${e?`${e}-`:""}overlays-${r+1}`),`--${e?`${e}-`:""}palette-AppBar-darkBg`,`--${e?`${e}-`:""}palette-AppBar-darkColor`],k0e=e=>(t,r)=>{const s=e.colorSchemeSelector;let c=s;if(s==="class"&&(c=".%s"),s==="data"&&(c="[data-%s]"),s!=null&&s.startsWith("data-")&&!s.includes("%s")&&(c=`[${s}="%s"]`),e.defaultColorScheme===t){if(t==="dark"){const f={};return M0e(e.cssVarPrefix).forEach(_=>{f[_]=r[_],delete r[_]}),c==="media"?{":root":r,"@media (prefers-color-scheme: dark)":{":root":f}}:c?{[c.replace("%s",t)]:f,[`:root, ${c.replace("%s",t)}`]:r}:{":root":{...r,...f}}}if(c&&c!=="media")return`:root, ${c.replace("%s",String(t))}`}else if(t){if(c==="media")return{[`@media (prefers-color-scheme: ${String(t)})`]:{":root":r}};if(c)return c.replace("%s",String(t))}return":root"};function D0e(e){return Mu(e)||typeof e>"u"||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||Array.isArray(e)}function O0e(e={}){const t={...e};function r(s){const c=Object.entries(s);for(let f=0;f<c.length;f++){const[_,x]=c[f];!D0e(x)||_.startsWith("unstable_")?delete s[_]:Mu(x)&&(s[_]={...x},r(s[_]))}}return r(t),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(t,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function L0e(e,t){t.forEach(r=>{e[r]||(e[r]={})})}function jt(e,t,r){!e[t]&&r&&(e[t]=r)}function u1(e){return!e||!e.startsWith("hsl")?e:eH(e)}function Eh(e,t){`${t}Channel`in e||(e[`${t}Channel`]=c1(u1(e[t]),`MUI: Can't create \`palette.${t}Channel\` because \`palette.${t}\` is not one of these formats: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color().
To suppress this warning, you need to explicitly provide the \`palette.${t}Channel\` as a string (in rgb format, for example "12 12 12") or undefined if you want to remove the channel token.`))}function z0e(e){return typeof e=="number"?`${e}px`:typeof e=="string"||typeof e=="function"||Array.isArray(e)?e:"8px"}const vu=e=>{try{return e()}catch{}},N0e=(e="mui")=>i0e(e);function SR(e,t,r,s){if(!t)return;t=t===!0?{}:t;const c=s==="dark"?"dark":"light";if(!r){e[s]=P0e({...t,palette:{mode:c,...t==null?void 0:t.palette}});return}const{palette:f,..._}=zk({...r,palette:{mode:c,...t==null?void 0:t.palette}});return e[s]={...t,palette:f,opacity:{...uH(c),...t==null?void 0:t.opacity},overlays:(t==null?void 0:t.overlays)||hH(c)},_}function F0e(e={},...t){const{colorSchemes:r={light:!0},defaultColorScheme:s,disableCssColorScheme:c=!1,cssVarPrefix:f="mui",shouldSkipGeneratingVar:_=R0e,colorSchemeSelector:x=r.light&&r.dark?"media":void 0,...a}=e,I=Object.keys(r)[0],D=s||(r.light&&I!=="light"?"light":I),O=N0e(f),{[D]:F,light:Z,dark:J,...re}=r,ne={...re};let G=F;if((D==="dark"&&!("dark"in r)||D==="light"&&!("light"in r))&&(G=!0),!G)throw new Error(Qh(21,D));const Y=SR(ne,G,a,D);Z&&!ne.light&&SR(ne,Z,void 0,"light"),J&&!ne.dark&&SR(ne,J,void 0,"dark");let Q={defaultColorScheme:D,...Y,cssVarPrefix:f,colorSchemeSelector:x,getCssVar:O,colorSchemes:ne,font:{...m0e(Y.typography),...Y.font},spacing:z0e(a.spacing)};Object.keys(Q.colorSchemes).forEach(he=>{const X=Q.colorSchemes[he].palette,ge=be=>{const ke=be.split("-"),Ee=ke[1],zt=ke[2];return O(be,X[Ee][zt])};if(X.mode==="light"&&(jt(X.common,"background","#fff"),jt(X.common,"onBackground","#000")),X.mode==="dark"&&(jt(X.common,"background","#000"),jt(X.common,"onBackground","#fff")),L0e(X,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),X.mode==="light"){jt(X.Alert,"errorColor",Li(X.error.light,.6)),jt(X.Alert,"infoColor",Li(X.info.light,.6)),jt(X.Alert,"successColor",Li(X.success.light,.6)),jt(X.Alert,"warningColor",Li(X.warning.light,.6)),jt(X.Alert,"errorFilledBg",ge("palette-error-main")),jt(X.Alert,"infoFilledBg",ge("palette-info-main")),jt(X.Alert,"successFilledBg",ge("palette-success-main")),jt(X.Alert,"warningFilledBg",ge("palette-warning-main")),jt(X.Alert,"errorFilledColor",vu(()=>X.getContrastText(X.error.main))),jt(X.Alert,"infoFilledColor",vu(()=>X.getContrastText(X.info.main))),jt(X.Alert,"successFilledColor",vu(()=>X.getContrastText(X.success.main))),jt(X.Alert,"warningFilledColor",vu(()=>X.getContrastText(X.warning.main))),jt(X.Alert,"errorStandardBg",zi(X.error.light,.9)),jt(X.Alert,"infoStandardBg",zi(X.info.light,.9)),jt(X.Alert,"successStandardBg",zi(X.success.light,.9)),jt(X.Alert,"warningStandardBg",zi(X.warning.light,.9)),jt(X.Alert,"errorIconColor",ge("palette-error-main")),jt(X.Alert,"infoIconColor",ge("palette-info-main")),jt(X.Alert,"successIconColor",ge("palette-success-main")),jt(X.Alert,"warningIconColor",ge("palette-warning-main")),jt(X.AppBar,"defaultBg",ge("palette-grey-100")),jt(X.Avatar,"defaultBg",ge("palette-grey-400")),jt(X.Button,"inheritContainedBg",ge("palette-grey-300")),jt(X.Button,"inheritContainedHoverBg",ge("palette-grey-A100")),jt(X.Chip,"defaultBorder",ge("palette-grey-400")),jt(X.Chip,"defaultAvatarColor",ge("palette-grey-700")),jt(X.Chip,"defaultIconColor",ge("palette-grey-700")),jt(X.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),jt(X.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),jt(X.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),jt(X.LinearProgress,"primaryBg",zi(X.primary.main,.62)),jt(X.LinearProgress,"secondaryBg",zi(X.secondary.main,.62)),jt(X.LinearProgress,"errorBg",zi(X.error.main,.62)),jt(X.LinearProgress,"infoBg",zi(X.info.main,.62)),jt(X.LinearProgress,"successBg",zi(X.success.main,.62)),jt(X.LinearProgress,"warningBg",zi(X.warning.main,.62)),jt(X.Skeleton,"bg",`rgba(${ge("palette-text-primaryChannel")} / 0.11)`),jt(X.Slider,"primaryTrack",zi(X.primary.main,.62)),jt(X.Slider,"secondaryTrack",zi(X.secondary.main,.62)),jt(X.Slider,"errorTrack",zi(X.error.main,.62)),jt(X.Slider,"infoTrack",zi(X.info.main,.62)),jt(X.Slider,"successTrack",zi(X.success.main,.62)),jt(X.Slider,"warningTrack",zi(X.warning.main,.62));const be=ZT(X.background.default,.8);jt(X.SnackbarContent,"bg",be),jt(X.SnackbarContent,"color",vu(()=>X.getContrastText(be))),jt(X.SpeedDialAction,"fabHoverBg",ZT(X.background.paper,.15)),jt(X.StepConnector,"border",ge("palette-grey-400")),jt(X.StepContent,"border",ge("palette-grey-400")),jt(X.Switch,"defaultColor",ge("palette-common-white")),jt(X.Switch,"defaultDisabledColor",ge("palette-grey-100")),jt(X.Switch,"primaryDisabledColor",zi(X.primary.main,.62)),jt(X.Switch,"secondaryDisabledColor",zi(X.secondary.main,.62)),jt(X.Switch,"errorDisabledColor",zi(X.error.main,.62)),jt(X.Switch,"infoDisabledColor",zi(X.info.main,.62)),jt(X.Switch,"successDisabledColor",zi(X.success.main,.62)),jt(X.Switch,"warningDisabledColor",zi(X.warning.main,.62)),jt(X.TableCell,"border",zi(HT(X.divider,1),.88)),jt(X.Tooltip,"bg",HT(X.grey[700],.92))}if(X.mode==="dark"){jt(X.Alert,"errorColor",zi(X.error.light,.6)),jt(X.Alert,"infoColor",zi(X.info.light,.6)),jt(X.Alert,"successColor",zi(X.success.light,.6)),jt(X.Alert,"warningColor",zi(X.warning.light,.6)),jt(X.Alert,"errorFilledBg",ge("palette-error-dark")),jt(X.Alert,"infoFilledBg",ge("palette-info-dark")),jt(X.Alert,"successFilledBg",ge("palette-success-dark")),jt(X.Alert,"warningFilledBg",ge("palette-warning-dark")),jt(X.Alert,"errorFilledColor",vu(()=>X.getContrastText(X.error.dark))),jt(X.Alert,"infoFilledColor",vu(()=>X.getContrastText(X.info.dark))),jt(X.Alert,"successFilledColor",vu(()=>X.getContrastText(X.success.dark))),jt(X.Alert,"warningFilledColor",vu(()=>X.getContrastText(X.warning.dark))),jt(X.Alert,"errorStandardBg",Li(X.error.light,.9)),jt(X.Alert,"infoStandardBg",Li(X.info.light,.9)),jt(X.Alert,"successStandardBg",Li(X.success.light,.9)),jt(X.Alert,"warningStandardBg",Li(X.warning.light,.9)),jt(X.Alert,"errorIconColor",ge("palette-error-main")),jt(X.Alert,"infoIconColor",ge("palette-info-main")),jt(X.Alert,"successIconColor",ge("palette-success-main")),jt(X.Alert,"warningIconColor",ge("palette-warning-main")),jt(X.AppBar,"defaultBg",ge("palette-grey-900")),jt(X.AppBar,"darkBg",ge("palette-background-paper")),jt(X.AppBar,"darkColor",ge("palette-text-primary")),jt(X.Avatar,"defaultBg",ge("palette-grey-600")),jt(X.Button,"inheritContainedBg",ge("palette-grey-800")),jt(X.Button,"inheritContainedHoverBg",ge("palette-grey-700")),jt(X.Chip,"defaultBorder",ge("palette-grey-700")),jt(X.Chip,"defaultAvatarColor",ge("palette-grey-300")),jt(X.Chip,"defaultIconColor",ge("palette-grey-300")),jt(X.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),jt(X.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),jt(X.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),jt(X.LinearProgress,"primaryBg",Li(X.primary.main,.5)),jt(X.LinearProgress,"secondaryBg",Li(X.secondary.main,.5)),jt(X.LinearProgress,"errorBg",Li(X.error.main,.5)),jt(X.LinearProgress,"infoBg",Li(X.info.main,.5)),jt(X.LinearProgress,"successBg",Li(X.success.main,.5)),jt(X.LinearProgress,"warningBg",Li(X.warning.main,.5)),jt(X.Skeleton,"bg",`rgba(${ge("palette-text-primaryChannel")} / 0.13)`),jt(X.Slider,"primaryTrack",Li(X.primary.main,.5)),jt(X.Slider,"secondaryTrack",Li(X.secondary.main,.5)),jt(X.Slider,"errorTrack",Li(X.error.main,.5)),jt(X.Slider,"infoTrack",Li(X.info.main,.5)),jt(X.Slider,"successTrack",Li(X.success.main,.5)),jt(X.Slider,"warningTrack",Li(X.warning.main,.5));const be=ZT(X.background.default,.98);jt(X.SnackbarContent,"bg",be),jt(X.SnackbarContent,"color",vu(()=>X.getContrastText(be))),jt(X.SpeedDialAction,"fabHoverBg",ZT(X.background.paper,.15)),jt(X.StepConnector,"border",ge("palette-grey-600")),jt(X.StepContent,"border",ge("palette-grey-600")),jt(X.Switch,"defaultColor",ge("palette-grey-300")),jt(X.Switch,"defaultDisabledColor",ge("palette-grey-600")),jt(X.Switch,"primaryDisabledColor",Li(X.primary.main,.55)),jt(X.Switch,"secondaryDisabledColor",Li(X.secondary.main,.55)),jt(X.Switch,"errorDisabledColor",Li(X.error.main,.55)),jt(X.Switch,"infoDisabledColor",Li(X.info.main,.55)),jt(X.Switch,"successDisabledColor",Li(X.success.main,.55)),jt(X.Switch,"warningDisabledColor",Li(X.warning.main,.55)),jt(X.TableCell,"border",Li(HT(X.divider,1),.68)),jt(X.Tooltip,"bg",HT(X.grey[700],.92))}Eh(X.background,"default"),Eh(X.background,"paper"),Eh(X.common,"background"),Eh(X.common,"onBackground"),Eh(X,"divider"),Object.keys(X).forEach(be=>{const ke=X[be];ke&&typeof ke=="object"&&(ke.main&&jt(X[be],"mainChannel",c1(u1(ke.main))),ke.light&&jt(X[be],"lightChannel",c1(u1(ke.light))),ke.dark&&jt(X[be],"darkChannel",c1(u1(ke.dark))),ke.contrastText&&jt(X[be],"contrastTextChannel",c1(u1(ke.contrastText))),be==="text"&&(Eh(X[be],"primary"),Eh(X[be],"secondary")),be==="action"&&(ke.active&&Eh(X[be],"active"),ke.selected&&Eh(X[be],"selected")))})}),Q=t.reduce((he,X)=>Qo(he,X),Q);const de={prefix:f,disableCssColorScheme:c,shouldSkipGeneratingVar:_,getSelector:k0e(Q)},{vars:Te,generateThemeVars:we,generateStyleSheets:oe}=a0e(Q,de);return Q.vars=Te,Object.entries(Q.colorSchemes[Q.defaultColorScheme]).forEach(([he,X])=>{Q[he]=X}),Q.generateThemeVars=we,Q.generateStyleSheets=oe,Q.generateSpacing=function(){return H2(a.spacing,hO(this))},Q.getColorSchemeSelector=l0e(x),Q.spacing=Q.generateSpacing(),Q.shouldSkipGeneratingVar=_,Q.unstable_sxConfig={...pb,...a==null?void 0:a.unstable_sxConfig},Q.unstable_sx=function(X){return mb({sx:X,theme:this})},Q.toRuntimeSource=O0e,Q}function uV(e,t,r){e.colorSchemes&&r&&(e.colorSchemes[t]={...r!==!0&&r,palette:wO({...r===!0?{}:r.palette,mode:t})})}function B0e(e={},...t){const{palette:r,cssVariables:s=!1,colorSchemes:c=r?void 0:{light:!0},defaultColorScheme:f=r==null?void 0:r.mode,..._}=e,x=f||"light",a=c==null?void 0:c[x],I={...c,...r?{[x]:{...typeof a!="boolean"&&a,palette:r}}:void 0};if(s===!1){if(!("colorSchemes"in e))return zk(e,...t);let D=r;"palette"in e||I[x]&&(I[x]!==!0?D=I[x].palette:x==="dark"&&(D={mode:"dark"}));const O=zk({...e,palette:D},...t);return O.defaultColorScheme=x,O.colorSchemes=I,O.palette.mode==="light"&&(O.colorSchemes.light={...I.light!==!0&&I.light,palette:O.palette},uV(O,"dark",I.dark)),O.palette.mode==="dark"&&(O.colorSchemes.dark={...I.dark!==!0&&I.dark,palette:O.palette},uV(O,"light",I.light)),O}return!r&&!("light"in I)&&x==="light"&&(I.light=!0),F0e({..._,colorSchemes:I,defaultColorScheme:x,...typeof s!="boolean"&&s},...t)}const $C=B0e();function TO(){const e=pO($C);return e[bC]||e}function j0e({props:e,name:t}){return Uye({props:e,name:t,defaultTheme:$C,themeId:bC})}function dH(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}const Ga=e=>dH(e)&&e!=="classes",Kn=Q2({themeId:bC,defaultTheme:$C,rootShouldForwardProp:Ga});function U0e(e){return N.jsx(Aye,{...e,defaultTheme:$C,themeId:bC})}function V0e(e){return function(r){return N.jsx(U0e,{styles:typeof e=="function"?s=>e({theme:s,...r}):e})}}function $0e(){return Rye}const hV={theme:void 0};function rs(e){let t,r;return s=>{let c=t;return(c===void 0||s.theme!==r)&&(hV.theme=s.theme,c=e(hV),t=c,r=s.theme),c}}function is(e){return r0e(e)}function q0e(e){return Si("MuiSvgIcon",e)}Ii("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const G0e=e=>{const{color:t,fontSize:r,classes:s}=e,c={root:["root",t!=="inherit"&&`color${Xn(t)}`,`fontSize${Xn(r)}`]};return Ri(c,q0e,s)},W0e=Kn("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.color!=="inherit"&&t[`color${Xn(r.color)}`],t[`fontSize${Xn(r.fontSize)}`]]}})(rs(({theme:e})=>{var t,r,s,c,f,_,x,a,I,D,O,F,Z,J;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:(c=(t=e.transitions)==null?void 0:t.create)==null?void 0:c.call(t,"fill",{duration:(s=(r=(e.vars??e).transitions)==null?void 0:r.duration)==null?void 0:s.shorter}),variants:[{props:re=>!re.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:((_=(f=e.typography)==null?void 0:f.pxToRem)==null?void 0:_.call(f,20))||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:((a=(x=e.typography)==null?void 0:x.pxToRem)==null?void 0:a.call(x,24))||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:((D=(I=e.typography)==null?void 0:I.pxToRem)==null?void 0:D.call(I,35))||"2.1875rem"}},...Object.entries((e.vars??e).palette).filter(([,re])=>re&&re.main).map(([re])=>{var ne,G;return{props:{color:re},style:{color:(G=(ne=(e.vars??e).palette)==null?void 0:ne[re])==null?void 0:G.main}}}),{props:{color:"action"},style:{color:(F=(O=(e.vars??e).palette)==null?void 0:O.action)==null?void 0:F.active}},{props:{color:"disabled"},style:{color:(J=(Z=(e.vars??e).palette)==null?void 0:Z.action)==null?void 0:J.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}})),VS=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiSvgIcon"}),{children:c,className:f,color:_="inherit",component:x="svg",fontSize:a="medium",htmlColor:I,inheritViewBox:D=!1,titleAccess:O,viewBox:F="0 0 24 24",...Z}=s,J=W.isValidElement(c)&&c.type==="svg",re={...s,color:_,component:x,fontSize:a,instanceFontSize:t.fontSize,inheritViewBox:D,viewBox:F,hasSvgAsChild:J},ne={};D||(ne.viewBox=F);const G=G0e(re);return N.jsxs(W0e,{as:x,className:Mr(G.root,f),focusable:"false",color:I,"aria-hidden":O?void 0:!0,role:O?"img":void 0,ref:r,...ne,...Z,...J&&c.props,ownerState:re,children:[J?c.props.children:c,O?N.jsx("title",{children:O}):null]})});VS&&(VS.muiName="SvgIcon");function id(e,t){function r(s,c){return N.jsx(VS,{"data-testid":`${t}Icon`,ref:c,...s,children:e})}return r.muiName=VS.muiName,W.memo(W.forwardRef(r))}function fH(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.includes(s))continue;r[s]=e[s]}return r}function Fk(e,t){return Fk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Fk(e,t)}function pH(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Fk(e,t)}const dV={disabled:!1},$S=Gr.createContext(null);var H0e=function(t){return t.scrollTop},h1="unmounted",rm="exited",im="entering",k_="entered",Bk="exiting",Zu=function(e){pH(t,e);function t(s,c){var f;f=e.call(this,s,c)||this;var _=c,x=_&&!_.isMounting?s.enter:s.appear,a;return f.appearStatus=null,s.in?x?(a=rm,f.appearStatus=im):a=k_:s.unmountOnExit||s.mountOnEnter?a=h1:a=rm,f.state={status:a},f.nextCallback=null,f}t.getDerivedStateFromProps=function(c,f){var _=c.in;return _&&f.status===h1?{status:rm}:null};var r=t.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(c){var f=null;if(c!==this.props){var _=this.state.status;this.props.in?_!==im&&_!==k_&&(f=im):(_===im||_===k_)&&(f=Bk)}this.updateStatus(!1,f)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var c=this.props.timeout,f,_,x;return f=_=x=c,c!=null&&typeof c!="number"&&(f=c.exit,_=c.enter,x=c.appear!==void 0?c.appear:_),{exit:f,enter:_,appear:x}},r.updateStatus=function(c,f){if(c===void 0&&(c=!1),f!==null)if(this.cancelNextCallback(),f===im){if(this.props.unmountOnExit||this.props.mountOnEnter){var _=this.props.nodeRef?this.props.nodeRef.current:DT.findDOMNode(this);_&&H0e(_)}this.performEnter(c)}else this.performExit();else this.props.unmountOnExit&&this.state.status===rm&&this.setState({status:h1})},r.performEnter=function(c){var f=this,_=this.props.enter,x=this.context?this.context.isMounting:c,a=this.props.nodeRef?[x]:[DT.findDOMNode(this),x],I=a[0],D=a[1],O=this.getTimeouts(),F=x?O.appear:O.enter;if(!c&&!_||dV.disabled){this.safeSetState({status:k_},function(){f.props.onEntered(I)});return}this.props.onEnter(I,D),this.safeSetState({status:im},function(){f.props.onEntering(I,D),f.onTransitionEnd(F,function(){f.safeSetState({status:k_},function(){f.props.onEntered(I,D)})})})},r.performExit=function(){var c=this,f=this.props.exit,_=this.getTimeouts(),x=this.props.nodeRef?void 0:DT.findDOMNode(this);if(!f||dV.disabled){this.safeSetState({status:rm},function(){c.props.onExited(x)});return}this.props.onExit(x),this.safeSetState({status:Bk},function(){c.props.onExiting(x),c.onTransitionEnd(_.exit,function(){c.safeSetState({status:rm},function(){c.props.onExited(x)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(c,f){f=this.setNextCallback(f),this.setState(c,f)},r.setNextCallback=function(c){var f=this,_=!0;return this.nextCallback=function(x){_&&(_=!1,f.nextCallback=null,c(x))},this.nextCallback.cancel=function(){_=!1},this.nextCallback},r.onTransitionEnd=function(c,f){this.setNextCallback(f);var _=this.props.nodeRef?this.props.nodeRef.current:DT.findDOMNode(this),x=c==null&&!this.props.addEndListener;if(!_||x){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[_,this.nextCallback],I=a[0],D=a[1];this.props.addEndListener(I,D)}c!=null&&setTimeout(this.nextCallback,c)},r.render=function(){var c=this.state.status;if(c===h1)return null;var f=this.props,_=f.children;f.in,f.mountOnEnter,f.unmountOnExit,f.appear,f.enter,f.exit,f.timeout,f.addEndListener,f.onEnter,f.onEntering,f.onEntered,f.onExit,f.onExiting,f.onExited,f.nodeRef;var x=fH(f,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Gr.createElement($S.Provider,{value:null},typeof _=="function"?_(c,x):Gr.cloneElement(Gr.Children.only(_),x))},t}(Gr.Component);Zu.contextType=$S;Zu.propTypes={};function S_(){}Zu.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:S_,onEntering:S_,onEntered:S_,onExit:S_,onExiting:S_,onExited:S_};Zu.UNMOUNTED=h1;Zu.EXITED=rm;Zu.ENTERING=im;Zu.ENTERED=k_;Zu.EXITING=Bk;function Z0e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function EO(e,t){var r=function(f){return t&&W.isValidElement(f)?t(f):f},s=Object.create(null);return e&&W.Children.map(e,function(c){return c}).forEach(function(c){s[c.key]=r(c)}),s}function X0e(e,t){e=e||{},t=t||{};function r(D){return D in t?t[D]:e[D]}var s=Object.create(null),c=[];for(var f in e)f in t?c.length&&(s[f]=c,c=[]):c.push(f);var _,x={};for(var a in t){if(s[a])for(_=0;_<s[a].length;_++){var I=s[a][_];x[s[a][_]]=r(I)}x[a]=r(a)}for(_=0;_<c.length;_++)x[c[_]]=r(c[_]);return x}function gm(e,t,r){return r[t]!=null?r[t]:e.props[t]}function K0e(e,t){return EO(e.children,function(r){return W.cloneElement(r,{onExited:t.bind(null,r),in:!0,appear:gm(r,"appear",e),enter:gm(r,"enter",e),exit:gm(r,"exit",e)})})}function Q0e(e,t,r){var s=EO(e.children),c=X0e(t,s);return Object.keys(c).forEach(function(f){var _=c[f];if(W.isValidElement(_)){var x=f in t,a=f in s,I=t[f],D=W.isValidElement(I)&&!I.props.in;a&&(!x||D)?c[f]=W.cloneElement(_,{onExited:r.bind(null,_),in:!0,exit:gm(_,"exit",e),enter:gm(_,"enter",e)}):!a&&x&&!D?c[f]=W.cloneElement(_,{in:!1}):a&&x&&W.isValidElement(I)&&(c[f]=W.cloneElement(_,{onExited:r.bind(null,_),in:I.props.in,exit:gm(_,"exit",e),enter:gm(_,"enter",e)}))}}),c}var Y0e=Object.values||function(e){return Object.keys(e).map(function(t){return e[t]})},J0e={component:"div",childFactory:function(t){return t}},SO=function(e){pH(t,e);function t(s,c){var f;f=e.call(this,s,c)||this;var _=f.handleExited.bind(Z0e(f));return f.state={contextValue:{isMounting:!0},handleExited:_,firstRender:!0},f}var r=t.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(c,f){var _=f.children,x=f.handleExited,a=f.firstRender;return{children:a?K0e(c,x):Q0e(c,_,x),firstRender:!1}},r.handleExited=function(c,f){var _=EO(this.props.children);c.key in _||(c.props.onExited&&c.props.onExited(f),this.mounted&&this.setState(function(x){var a=NS({},x.children);return delete a[c.key],{children:a}}))},r.render=function(){var c=this.props,f=c.component,_=c.childFactory,x=fH(c,["component","childFactory"]),a=this.state.contextValue,I=Y0e(this.state.children).map(_);return delete x.appear,delete x.enter,delete x.exit,f===null?Gr.createElement($S.Provider,{value:a},I):Gr.createElement($S.Provider,{value:a},Gr.createElement(f,x,I))},t}(Gr.Component);SO.propTypes={};SO.defaultProps=J0e;const mH=e=>e.scrollTop;function qS(e,t){const{timeout:r,easing:s,style:c={}}=e;return{duration:c.transitionDuration??(typeof r=="number"?r:r[t.mode]||0),easing:c.transitionTimingFunction??(typeof s=="object"?s[t.mode]:s),delay:c.transitionDelay}}function eve(e){return Si("MuiPaper",e)}Ii("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const tve=e=>{const{square:t,elevation:r,variant:s,classes:c}=e,f={root:["root",s,!t&&"rounded",s==="elevation"&&`elevation${r}`]};return Ri(f,eve,c)},nve=Kn("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],!r.square&&t.rounded,r.variant==="elevation"&&t[`elevation${r.elevation}`]]}})(rs(({theme:e})=>({backgroundColor:(e.vars||e).palette.background.paper,color:(e.vars||e).palette.text.primary,transition:e.transitions.create("box-shadow"),variants:[{props:({ownerState:t})=>!t.square,style:{borderRadius:e.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(e.vars||e).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),rve=W.forwardRef(function(t,r){var Z;const s=is({props:t,name:"MuiPaper"}),c=TO(),{className:f,component:_="div",elevation:x=1,square:a=!1,variant:I="elevation",...D}=s,O={...s,component:_,elevation:x,square:a,variant:I},F=tve(O);return N.jsx(nve,{as:_,ownerState:O,className:Mr(F.root,f),ref:r,...D,style:{...I==="elevation"&&{"--Paper-shadow":(c.vars||c).shadows[x],...c.vars&&{"--Paper-overlay":(Z=c.vars.overlays)==null?void 0:Z[x]},...!c.vars&&c.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${$l("#fff",Nk(x))}, ${$l("#fff",Nk(x))})`}},...D.style}})});function ql(e,t){const{className:r,elementType:s,ownerState:c,externalForwardedProps:f,getSlotOwnerState:_,internalForwardedProps:x,...a}=t,{component:I,slots:D={[e]:void 0},slotProps:O={[e]:void 0},...F}=f,Z=D[e]||s,J=cH(O[e],c),{props:{component:re,...ne},internalRef:G}=lH({className:r,...a,externalForwardedProps:e==="root"?F:void 0,externalSlotProps:J}),Y=Oo(G,J==null?void 0:J.ref,t.ref),Q=_?_(ne):{},de={...c,...Q},Te=e==="root"?re||I:re,we=oH(Z,{...e==="root"&&!I&&!D[e]&&x,...e!=="root"&&!D[e]&&x,...ne,...Te&&{as:Te},ref:Y},de);return Object.keys(Q).forEach(oe=>{delete we[oe]}),[Z,we]}class GS{constructor(){kv(this,"mountEffect",()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())});this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}static create(){return new GS}static use(){const t=nH(GS.create).current,[r,s]=W.useState(!1);return t.shouldMount=r,t.setShouldMount=s,W.useEffect(t.mountEffect,[r]),t}mount(){return this.mounted||(this.mounted=sve(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}start(...t){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.start(...t)})}stop(...t){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.stop(...t)})}pulsate(...t){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.pulsate(...t)})}}function ive(){return GS.use()}function sve(){let e,t;const r=new Promise((s,c)=>{e=s,t=c});return r.resolve=e,r.reject=t,r}function ove(e){const{className:t,classes:r,pulsate:s=!1,rippleX:c,rippleY:f,rippleSize:_,in:x,onExited:a,timeout:I}=e,[D,O]=W.useState(!1),F=Mr(t,r.ripple,r.rippleVisible,s&&r.ripplePulsate),Z={width:_,height:_,top:-(_/2)+f,left:-(_/2)+c},J=Mr(r.child,D&&r.childLeaving,s&&r.childPulsate);return!x&&!D&&O(!0),W.useEffect(()=>{if(!x&&a!=null){const re=setTimeout(a,I);return()=>{clearTimeout(re)}}},[a,x,I]),N.jsx("span",{className:F,style:Z,children:N.jsx("span",{className:J})})}const Fl=Ii("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),jk=550,ave=80,lve=lO`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,cve=lO`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,uve=lO`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,hve=Kn("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),dve=Kn(ove,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${Fl.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${lve};
    animation-duration: ${jk}ms;
    animation-timing-function: ${({theme:e})=>e.transitions.easing.easeInOut};
  }

  &.${Fl.ripplePulsate} {
    animation-duration: ${({theme:e})=>e.transitions.duration.shorter}ms;
  }

  & .${Fl.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${Fl.childLeaving} {
    opacity: 0;
    animation-name: ${cve};
    animation-duration: ${jk}ms;
    animation-timing-function: ${({theme:e})=>e.transitions.easing.easeInOut};
  }

  & .${Fl.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${uve};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:e})=>e.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,fve=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiTouchRipple"}),{center:c=!1,classes:f={},className:_,...x}=s,[a,I]=W.useState([]),D=W.useRef(0),O=W.useRef(null);W.useEffect(()=>{O.current&&(O.current(),O.current=null)},[a]);const F=W.useRef(!1),Z=rH(),J=W.useRef(null),re=W.useRef(null),ne=W.useCallback(de=>{const{pulsate:Te,rippleX:we,rippleY:oe,rippleSize:he,cb:X}=de;I(ge=>[...ge,N.jsx(dve,{classes:{ripple:Mr(f.ripple,Fl.ripple),rippleVisible:Mr(f.rippleVisible,Fl.rippleVisible),ripplePulsate:Mr(f.ripplePulsate,Fl.ripplePulsate),child:Mr(f.child,Fl.child),childLeaving:Mr(f.childLeaving,Fl.childLeaving),childPulsate:Mr(f.childPulsate,Fl.childPulsate)},timeout:jk,pulsate:Te,rippleX:we,rippleY:oe,rippleSize:he},D.current)]),D.current+=1,O.current=X},[f]),G=W.useCallback((de={},Te={},we=()=>{})=>{const{pulsate:oe=!1,center:he=c||Te.pulsate,fakeElement:X=!1}=Te;if((de==null?void 0:de.type)==="mousedown"&&F.current){F.current=!1;return}(de==null?void 0:de.type)==="touchstart"&&(F.current=!0);const ge=X?null:re.current,be=ge?ge.getBoundingClientRect():{width:0,height:0,left:0,top:0};let ke,Ee,zt;if(he||de===void 0||de.clientX===0&&de.clientY===0||!de.clientX&&!de.touches)ke=Math.round(be.width/2),Ee=Math.round(be.height/2);else{const{clientX:Ut,clientY:Qt}=de.touches&&de.touches.length>0?de.touches[0]:de;ke=Math.round(Ut-be.left),Ee=Math.round(Qt-be.top)}if(he)zt=Math.sqrt((2*be.width**2+be.height**2)/3),zt%2===0&&(zt+=1);else{const Ut=Math.max(Math.abs((ge?ge.clientWidth:0)-ke),ke)*2+2,Qt=Math.max(Math.abs((ge?ge.clientHeight:0)-Ee),Ee)*2+2;zt=Math.sqrt(Ut**2+Qt**2)}de!=null&&de.touches?J.current===null&&(J.current=()=>{ne({pulsate:oe,rippleX:ke,rippleY:Ee,rippleSize:zt,cb:we})},Z.start(ave,()=>{J.current&&(J.current(),J.current=null)})):ne({pulsate:oe,rippleX:ke,rippleY:Ee,rippleSize:zt,cb:we})},[c,ne,Z]),Y=W.useCallback(()=>{G({},{pulsate:!0})},[G]),Q=W.useCallback((de,Te)=>{if(Z.clear(),(de==null?void 0:de.type)==="touchend"&&J.current){J.current(),J.current=null,Z.start(0,()=>{Q(de,Te)});return}J.current=null,I(we=>we.length>0?we.slice(1):we),O.current=Te},[Z]);return W.useImperativeHandle(r,()=>({pulsate:Y,start:G,stop:Q}),[Y,G,Q]),N.jsx(hve,{className:Mr(Fl.root,f.root,_),ref:re,...x,children:N.jsx(SO,{component:null,exit:!0,children:a})})});function pve(e){return Si("MuiButtonBase",e)}const mve=Ii("MuiButtonBase",["root","disabled","focusVisible"]),gve=e=>{const{disabled:t,focusVisible:r,focusVisibleClassName:s,classes:c}=e,_=Ri({root:["root",t&&"disabled",r&&"focusVisible"]},pve,c);return r&&s&&(_.root+=` ${s}`),_},_ve=Kn("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${mve.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),IO=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiButtonBase"}),{action:c,centerRipple:f=!1,children:_,className:x,component:a="button",disabled:I=!1,disableRipple:D=!1,disableTouchRipple:O=!1,focusRipple:F=!1,focusVisibleClassName:Z,LinkComponent:J="a",onBlur:re,onClick:ne,onContextMenu:G,onDragLeave:Y,onFocus:Q,onFocusVisible:de,onKeyDown:Te,onKeyUp:we,onMouseDown:oe,onMouseLeave:he,onMouseUp:X,onTouchEnd:ge,onTouchMove:be,onTouchStart:ke,tabIndex:Ee=0,TouchRippleProps:zt,touchRippleRef:Ut,type:Qt,...kt}=s,ft=W.useRef(null),Rt=ive(),Yt=Oo(Rt.ref,Ut),[ht,At]=W.useState(!1);I&&ht&&At(!1),W.useImperativeHandle(c,()=>({focusVisible:()=>{At(!0),ft.current.focus()}}),[]);const wt=Rt.shouldMount&&!D&&!I;W.useEffect(()=>{ht&&F&&!D&&Rt.pulsate()},[D,F,ht,Rt]);function Xt(st,Mt,an=O){return Z_(qt=>(Mt&&Mt(qt),an||Rt[st](qt),!0))}const Ft=Xt("start",oe),Sn=Xt("stop",G),qn=Xt("stop",Y),Qn=Xt("stop",X),Gt=Xt("stop",st=>{ht&&st.preventDefault(),he&&he(st)}),Cn=Xt("start",ke),hn=Xt("stop",ge),Rn=Xt("stop",be),Nr=Xt("stop",st=>{nV(st.target)||At(!1),re&&re(st)},!1),jn=Z_(st=>{ft.current||(ft.current=st.currentTarget),nV(st.target)&&(At(!0),de&&de(st)),Q&&Q(st)}),gr=()=>{const st=ft.current;return a&&a!=="button"&&!(st.tagName==="A"&&st.href)},Fr=Z_(st=>{F&&!st.repeat&&ht&&st.key===" "&&Rt.stop(st,()=>{Rt.start(st)}),st.target===st.currentTarget&&gr()&&st.key===" "&&st.preventDefault(),Te&&Te(st),st.target===st.currentTarget&&gr()&&st.key==="Enter"&&!I&&(st.preventDefault(),ne&&ne(st))}),dr=Z_(st=>{F&&st.key===" "&&ht&&!st.defaultPrevented&&Rt.stop(st,()=>{Rt.pulsate(st)}),we&&we(st),ne&&st.target===st.currentTarget&&gr()&&st.key===" "&&!st.defaultPrevented&&ne(st)});let rr=a;rr==="button"&&(kt.href||kt.to)&&(rr=J);const Ue={};rr==="button"?(Ue.type=Qt===void 0?"button":Qt,Ue.disabled=I):(!kt.href&&!kt.to&&(Ue.role="button"),I&&(Ue["aria-disabled"]=I));const Xe=Oo(r,ft),ut={...s,centerRipple:f,component:a,disabled:I,disableRipple:D,disableTouchRipple:O,focusRipple:F,tabIndex:Ee,focusVisible:ht},Ye=gve(ut);return N.jsxs(_ve,{as:rr,className:Mr(Ye.root,x),ownerState:ut,onBlur:Nr,onClick:ne,onContextMenu:Sn,onFocus:jn,onKeyDown:Fr,onKeyUp:dr,onMouseDown:Ft,onMouseLeave:Gt,onMouseUp:Qn,onDragLeave:qn,onTouchEnd:hn,onTouchMove:Rn,onTouchStart:Cn,ref:Xe,tabIndex:I?-1:Ee,type:Qt,...Ue,...kt,children:[_,wt?N.jsx(fve,{ref:Yt,center:f,...zt}):null]})});function yve(e){return Si("MuiIconButton",e)}const vve=Ii("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),xve=e=>{const{classes:t,disabled:r,color:s,edge:c,size:f}=e,_={root:["root",r&&"disabled",s!=="default"&&`color${Xn(s)}`,c&&`edge${Xn(c)}`,`size${Xn(f)}`]};return Ri(_,yve,t)},bve=Kn(IO,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.color!=="default"&&t[`color${Xn(r.color)}`],r.edge&&t[`edge${Xn(r.edge)}`],t[`size${Xn(r.size)}`]]}})(rs(({theme:e})=>({textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(e.vars||e).palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),variants:[{props:{disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:$l(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),rs(({theme:e})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}})),...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${(e.vars||e).palette[t].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:$l((e.vars||e).palette[t].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}})),{props:{size:"small"},style:{padding:5,fontSize:e.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:e.typography.pxToRem(28)}}],[`&.${vve.disabled}`]:{backgroundColor:"transparent",color:(e.vars||e).palette.action.disabled}}))),_m=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiIconButton"}),{edge:c=!1,children:f,className:_,color:x="default",disabled:a=!1,disableFocusRipple:I=!1,disableRipple:D=!1,size:O="medium",...F}=s,Z={...s,edge:c,color:x,disabled:a,disableFocusRipple:I,disableRipple:D,size:O},J=xve(Z);return N.jsx(bve,{className:Mr(J.root,_),centerRipple:!0,focusRipple:!I,disabled:a,disableRipple:D,ref:r,...F,ownerState:Z,children:f})});function wve(e){return Si("MuiTypography",e)}Ii("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const Tve={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},Eve=$0e(),Sve=e=>{const{align:t,gutterBottom:r,noWrap:s,paragraph:c,variant:f,classes:_}=e,x={root:["root",f,e.align!=="inherit"&&`align${Xn(t)}`,r&&"gutterBottom",s&&"noWrap",c&&"paragraph"]};return Ri(x,wve,_)},Ive=Kn("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.variant&&t[r.variant],r.align!=="inherit"&&t[`align${Xn(r.align)}`],r.noWrap&&t.noWrap,r.gutterBottom&&t.gutterBottom,r.paragraph&&t.paragraph]}})(rs(({theme:e})=>{var t;return{margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(e.typography).filter(([r,s])=>r!=="inherit"&&s&&typeof s=="object").map(([r,s])=>({props:{variant:r},style:s})),...Object.entries(e.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{color:(e.vars||e).palette[r].main}})),...Object.entries(((t=e.palette)==null?void 0:t.text)||{}).filter(([,r])=>typeof r=="string").map(([r])=>({props:{color:`text${Xn(r)}`},style:{color:(e.vars||e).palette.text[r]}})),{props:({ownerState:r})=>r.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:r})=>r.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:r})=>r.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:r})=>r.paragraph,style:{marginBottom:16}}]}})),fV={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},pV=W.forwardRef(function(t,r){const{color:s,...c}=is({props:t,name:"MuiTypography"}),f=!Tve[s],_=Eve({...c,...f&&{color:s}}),{align:x="inherit",className:a,component:I,gutterBottom:D=!1,noWrap:O=!1,paragraph:F=!1,variant:Z="body1",variantMapping:J=fV,...re}=_,ne={..._,align:x,color:s,className:a,component:I,gutterBottom:D,noWrap:O,paragraph:F,variant:Z,variantMapping:J},G=I||(F?"p":J[Z]||fV[Z])||"span",Y=Sve(ne);return N.jsx(Ive,{as:G,ref:r,className:Mr(Y.root,a),...re,ownerState:ne,style:{...x!=="inherit"&&{"--Typography-textAlign":x},...re.style}})});function Cve(e){return typeof e=="function"?e():e}const Ave=W.forwardRef(function(t,r){const{children:s,container:c,disablePortal:f=!1}=t,[_,x]=W.useState(null),a=Oo(gb(s),r);if(Bf(()=>{f||x(Cve(c)||document.body)},[c,f]),Bf(()=>{if(_&&!f)return Lk(r,_),()=>{Lk(r,null)}},[r,_,f]),f){if(W.isValidElement(s)){const I={ref:a};return W.cloneElement(s,I)}return N.jsx(W.Fragment,{children:s})}return N.jsx(W.Fragment,{children:_&&II.createPortal(s,_)})});function XT(e){return parseInt(e,10)||0}const Pve={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function Rve(e){return e==null||Object.keys(e).length===0||e.outerHeightStyle===0&&!e.overflowing}const Mve=W.forwardRef(function(t,r){const{onChange:s,maxRows:c,minRows:f=1,style:_,value:x,...a}=t,{current:I}=W.useRef(x!=null),D=W.useRef(null),O=Oo(r,D),F=W.useRef(null),Z=W.useRef(null),J=W.useCallback(()=>{const G=D.current,Q=$m(G).getComputedStyle(G);if(Q.width==="0px")return{outerHeightStyle:0,overflowing:!1};const de=Z.current;de.style.width=Q.width,de.value=G.value||t.placeholder||"x",de.value.slice(-1)===`
`&&(de.value+=" ");const Te=Q.boxSizing,we=XT(Q.paddingBottom)+XT(Q.paddingTop),oe=XT(Q.borderBottomWidth)+XT(Q.borderTopWidth),he=de.scrollHeight;de.value="x";const X=de.scrollHeight;let ge=he;f&&(ge=Math.max(Number(f)*X,ge)),c&&(ge=Math.min(Number(c)*X,ge)),ge=Math.max(ge,X);const be=ge+(Te==="border-box"?we+oe:0),ke=Math.abs(ge-he)<=1;return{outerHeightStyle:be,overflowing:ke}},[c,f,t.placeholder]),re=W.useCallback(()=>{const G=J();if(Rve(G))return;const Y=G.outerHeightStyle,Q=D.current;F.current!==Y&&(F.current=Y,Q.style.height=`${Y}px`),Q.style.overflow=G.overflowing?"hidden":""},[J]);Bf(()=>{const G=()=>{re()};let Y;const Q=tH(G),de=D.current,Te=$m(de);Te.addEventListener("resize",Q);let we;return typeof ResizeObserver<"u"&&(we=new ResizeObserver(G),we.observe(de)),()=>{Q.clear(),cancelAnimationFrame(Y),Te.removeEventListener("resize",Q),we&&we.disconnect()}},[J,re]),Bf(()=>{re()});const ne=G=>{I||re(),s&&s(G)};return N.jsxs(W.Fragment,{children:[N.jsx("textarea",{value:x,onChange:ne,ref:O,rows:f,style:_,...a}),N.jsx("textarea",{"aria-hidden":!0,className:t.className,readOnly:!0,ref:Z,tabIndex:-1,style:{...Pve.shadow,..._,paddingTop:0,paddingBottom:0}})]})});function Uk(e){return typeof e=="string"}function Jf({props:e,states:t,muiFormControl:r}){return t.reduce((s,c)=>(s[c]=e[c],r&&typeof e[c]>"u"&&(s[c]=r[c]),s),{})}const CO=W.createContext(void 0);function sd(){return W.useContext(CO)}function mV(e){return e!=null&&!(Array.isArray(e)&&e.length===0)}function WS(e,t=!1){return e&&(mV(e.value)&&e.value!==""||t&&mV(e.defaultValue)&&e.defaultValue!=="")}function kve(e){return e.startAdornment}function Dve(e){return Si("MuiInputBase",e)}const zy=Ii("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var gV;const qC=(e,t)=>{const{ownerState:r}=e;return[t.root,r.formControl&&t.formControl,r.startAdornment&&t.adornedStart,r.endAdornment&&t.adornedEnd,r.error&&t.error,r.size==="small"&&t.sizeSmall,r.multiline&&t.multiline,r.color&&t[`color${Xn(r.color)}`],r.fullWidth&&t.fullWidth,r.hiddenLabel&&t.hiddenLabel]},GC=(e,t)=>{const{ownerState:r}=e;return[t.input,r.size==="small"&&t.inputSizeSmall,r.multiline&&t.inputMultiline,r.type==="search"&&t.inputTypeSearch,r.startAdornment&&t.inputAdornedStart,r.endAdornment&&t.inputAdornedEnd,r.hiddenLabel&&t.inputHiddenLabel]},Ove=e=>{const{classes:t,color:r,disabled:s,error:c,endAdornment:f,focused:_,formControl:x,fullWidth:a,hiddenLabel:I,multiline:D,readOnly:O,size:F,startAdornment:Z,type:J}=e,re={root:["root",`color${Xn(r)}`,s&&"disabled",c&&"error",a&&"fullWidth",_&&"focused",x&&"formControl",F&&F!=="medium"&&`size${Xn(F)}`,D&&"multiline",Z&&"adornedStart",f&&"adornedEnd",I&&"hiddenLabel",O&&"readOnly"],input:["input",s&&"disabled",J==="search"&&"inputTypeSearch",D&&"inputMultiline",F==="small"&&"inputSizeSmall",I&&"inputHiddenLabel",Z&&"inputAdornedStart",f&&"inputAdornedEnd",O&&"readOnly"]};return Ri(re,Dve,t)},WC=Kn("div",{name:"MuiInputBase",slot:"Root",overridesResolver:qC})(rs(({theme:e})=>({...e.typography.body1,color:(e.vars||e).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${zy.disabled}`]:{color:(e.vars||e).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:t})=>t.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:t,size:r})=>t.multiline&&r==="small",style:{paddingTop:1}},{props:({ownerState:t})=>t.fullWidth,style:{width:"100%"}}]}))),HC=Kn("input",{name:"MuiInputBase",slot:"Input",overridesResolver:GC})(rs(({theme:e})=>{const t=e.palette.mode==="light",r={color:"currentColor",...e.vars?{opacity:e.vars.opacity.inputPlaceholder}:{opacity:t?.42:.5},transition:e.transitions.create("opacity",{duration:e.transitions.duration.shorter})},s={opacity:"0 !important"},c=e.vars?{opacity:e.vars.opacity.inputPlaceholder}:{opacity:t?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&::-ms-input-placeholder":r,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${zy.formControl} &`]:{"&::-webkit-input-placeholder":s,"&::-moz-placeholder":s,"&::-ms-input-placeholder":s,"&:focus::-webkit-input-placeholder":c,"&:focus::-moz-placeholder":c,"&:focus::-ms-input-placeholder":c},[`&.${zy.disabled}`]:{opacity:1,WebkitTextFillColor:(e.vars||e).palette.text.disabled},variants:[{props:({ownerState:f})=>!f.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:f})=>f.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),_V=V0e({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),Lve=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiInputBase"}),{"aria-describedby":c,autoComplete:f,autoFocus:_,className:x,color:a,components:I={},componentsProps:D={},defaultValue:O,disabled:F,disableInjectingGlobalStyles:Z,endAdornment:J,error:re,fullWidth:ne=!1,id:G,inputComponent:Y="input",inputProps:Q={},inputRef:de,margin:Te,maxRows:we,minRows:oe,multiline:he=!1,name:X,onBlur:ge,onChange:be,onClick:ke,onFocus:Ee,onKeyDown:zt,onKeyUp:Ut,placeholder:Qt,readOnly:kt,renderSuffix:ft,rows:Rt,size:Yt,slotProps:ht={},slots:At={},startAdornment:wt,type:Xt="text",value:Ft,...Sn}=s,qn=Q.value!=null?Q.value:Ft,{current:Qn}=W.useRef(qn!=null),Gt=W.useRef(),Cn=W.useCallback(ir=>{},[]),hn=Oo(Gt,de,Q.ref,Cn),[Rn,Nr]=W.useState(!1),jn=sd(),gr=Jf({props:s,muiFormControl:jn,states:["color","disabled","error","hiddenLabel","size","required","filled"]});gr.focused=jn?jn.focused:Rn,W.useEffect(()=>{!jn&&F&&Rn&&(Nr(!1),ge&&ge())},[jn,F,Rn,ge]);const Fr=jn&&jn.onFilled,dr=jn&&jn.onEmpty,rr=W.useCallback(ir=>{WS(ir)?Fr&&Fr():dr&&dr()},[Fr,dr]);Bf(()=>{Qn&&rr({value:qn})},[qn,rr,Qn]);const Ue=ir=>{Ee&&Ee(ir),Q.onFocus&&Q.onFocus(ir),jn&&jn.onFocus?jn.onFocus(ir):Nr(!0)},Xe=ir=>{ge&&ge(ir),Q.onBlur&&Q.onBlur(ir),jn&&jn.onBlur?jn.onBlur(ir):Nr(!1)},ut=(ir,...Ci)=>{if(!Qn){const ss=ir.target||Gt.current;if(ss==null)throw new Error(Qh(1));rr({value:ss.value})}Q.onChange&&Q.onChange(ir,...Ci),be&&be(ir,...Ci)};W.useEffect(()=>{rr(Gt.current)},[]);const Ye=ir=>{Gt.current&&ir.currentTarget===ir.target&&Gt.current.focus(),ke&&ke(ir)};let st=Y,Mt=Q;he&&st==="input"&&(Rt?Mt={type:void 0,minRows:Rt,maxRows:Rt,...Mt}:Mt={type:void 0,maxRows:we,minRows:oe,...Mt},st=Mve);const an=ir=>{rr(ir.animationName==="mui-auto-fill-cancel"?Gt.current:{value:"x"})};W.useEffect(()=>{jn&&jn.setAdornedStart(!!wt)},[jn,wt]);const qt={...s,color:gr.color||"primary",disabled:gr.disabled,endAdornment:J,error:gr.error,focused:gr.focused,formControl:jn,fullWidth:ne,hiddenLabel:gr.hiddenLabel,multiline:he,size:gr.size,startAdornment:wt,type:Xt},mn=Ove(qt),Ln=At.root||I.Root||WC,fr=ht.root||D.root||{},fi=At.input||I.Input||HC;return Mt={...Mt,...ht.input??D.input},N.jsxs(W.Fragment,{children:[!Z&&typeof _V=="function"&&(gV||(gV=N.jsx(_V,{}))),N.jsxs(Ln,{...fr,ref:r,onClick:Ye,...Sn,...!Uk(Ln)&&{ownerState:{...qt,...fr.ownerState}},className:Mr(mn.root,fr.className,x,kt&&"MuiInputBase-readOnly"),children:[wt,N.jsx(CO.Provider,{value:null,children:N.jsx(fi,{"aria-invalid":gr.error,"aria-describedby":c,autoComplete:f,autoFocus:_,defaultValue:O,disabled:gr.disabled,id:G,onAnimationStart:an,name:X,placeholder:Qt,readOnly:kt,required:gr.required,rows:Rt,value:qn,onKeyDown:zt,onKeyUp:Ut,type:Xt,...Mt,...!Uk(fi)&&{as:st,ownerState:{...qt,...Mt.ownerState}},ref:hn,className:Mr(mn.input,Mt.className,kt&&"MuiInputBase-readOnly"),onBlur:Xe,onChange:ut,onFocus:Ue})}),J,ft?ft({...gr,startAdornment:wt}):null]})]})}),AO=Lve;function zve(e){return Si("MuiInput",e)}const Wv={...zy,...Ii("MuiInput",["root","underline","input"])};function Nve(e){return Si("MuiOutlinedInput",e)}const xu={...zy,...Ii("MuiOutlinedInput",["root","notchedOutline","input"])};function Fve(e){return Si("MuiFilledInput",e)}const Yp={...zy,...Ii("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},Bve=id(N.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),jve={entering:{opacity:1},entered:{opacity:1}},Uve=W.forwardRef(function(t,r){const s=TO(),c={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen},{addEndListener:f,appear:_=!0,children:x,easing:a,in:I,onEnter:D,onEntered:O,onEntering:F,onExit:Z,onExited:J,onExiting:re,style:ne,timeout:G=c,TransitionComponent:Y=Zu,...Q}=t,de=W.useRef(null),Te=Oo(de,gb(x),r),we=zt=>Ut=>{if(zt){const Qt=de.current;Ut===void 0?zt(Qt):zt(Qt,Ut)}},oe=we(F),he=we((zt,Ut)=>{mH(zt);const Qt=qS({style:ne,timeout:G,easing:a},{mode:"enter"});zt.style.webkitTransition=s.transitions.create("opacity",Qt),zt.style.transition=s.transitions.create("opacity",Qt),D&&D(zt,Ut)}),X=we(O),ge=we(re),be=we(zt=>{const Ut=qS({style:ne,timeout:G,easing:a},{mode:"exit"});zt.style.webkitTransition=s.transitions.create("opacity",Ut),zt.style.transition=s.transitions.create("opacity",Ut),Z&&Z(zt)}),ke=we(J),Ee=zt=>{f&&f(de.current,zt)};return N.jsx(Y,{appear:_,in:I,nodeRef:de,onEnter:he,onEntered:X,onEntering:oe,onExit:be,onExited:ke,onExiting:ge,addEndListener:Ee,timeout:G,...Q,children:(zt,Ut)=>W.cloneElement(x,{style:{opacity:0,visibility:zt==="exited"&&!I?"hidden":void 0,...jve[zt],...ne,...x.props.style},ref:Te,...Ut})})});function Vve(e){return Si("MuiBackdrop",e)}Ii("MuiBackdrop",["root","invisible"]);const $ve=e=>{const{classes:t,invisible:r}=e;return Ri({root:["root",r&&"invisible"]},Vve,t)},qve=Kn("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.invisible&&t.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),Gve=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiBackdrop"}),{children:c,className:f,component:_="div",invisible:x=!1,open:a,components:I={},componentsProps:D={},slotProps:O={},slots:F={},TransitionComponent:Z,transitionDuration:J,...re}=s,ne={...s,component:_,invisible:x},G=$ve(ne),Y={transition:Z,root:I.Root,...F},Q={...D,...O},de={slots:Y,slotProps:Q},[Te,we]=ql("root",{elementType:qve,externalForwardedProps:de,className:Mr(G.root,f),ownerState:ne}),[oe,he]=ql("transition",{elementType:Uve,externalForwardedProps:de,ownerState:ne});return delete he.ownerState,N.jsx(oe,{in:a,timeout:J,...re,...he,children:N.jsx(Te,{"aria-hidden":!0,...we,classes:G,ref:r,children:c})})});function Wve(e){const{badgeContent:t,invisible:r=!1,max:s=99,showZero:c=!1}=e,f=sH({badgeContent:t,max:s});let _=r;r===!1&&t===0&&!c&&(_=!0);const{badgeContent:x,max:a=s}=_?f:e,I=x&&Number(x)>a?`${a}+`:x;return{badgeContent:x,invisible:_,max:a,displayValue:I}}function Hve(e){return Si("MuiBadge",e)}const Yd=Ii("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),IR=10,CR=4,Zve=e=>{const{color:t,anchorOrigin:r,invisible:s,overlap:c,variant:f,classes:_={}}=e,x={root:["root"],badge:["badge",f,s&&"invisible",`anchorOrigin${Xn(r.vertical)}${Xn(r.horizontal)}`,`anchorOrigin${Xn(r.vertical)}${Xn(r.horizontal)}${Xn(c)}`,`overlap${Xn(c)}`,t!=="default"&&`color${Xn(t)}`]};return Ri(x,Hve,_)},Xve=Kn("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,t)=>t.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Kve=Kn("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.badge,t[r.variant],t[`anchorOrigin${Xn(r.anchorOrigin.vertical)}${Xn(r.anchorOrigin.horizontal)}${Xn(r.overlap)}`],r.color!=="default"&&t[`color${Xn(r.color)}`],r.invisible&&t.invisible]}})(rs(({theme:e})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:IR*2,lineHeight:1,padding:"0 6px",height:IR*2,borderRadius:IR,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen}),variants:[...Object.entries(e.palette).filter(([,t])=>t&&t.main&&t.contrastText).map(([t])=>({props:{color:t},style:{backgroundColor:(e.vars||e).palette[t].main,color:(e.vars||e).palette[t].contrastText}})),{props:{variant:"dot"},style:{borderRadius:CR,height:CR*2,minWidth:CR*2,padding:0}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})}}]}))),Qve=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiBadge"}),{anchorOrigin:c={vertical:"top",horizontal:"right"},className:f,classes:_,component:x,components:a={},componentsProps:I={},children:D,overlap:O="rectangular",color:F="default",invisible:Z=!1,max:J=99,badgeContent:re,slots:ne,slotProps:G,showZero:Y=!1,variant:Q="standard",...de}=s,{badgeContent:Te,invisible:we,max:oe,displayValue:he}=Wve({max:J,invisible:Z,badgeContent:re,showZero:Y}),X=sH({anchorOrigin:c,color:F,overlap:O,variant:Q,badgeContent:re}),ge=we||Te==null&&Q!=="dot",{color:be=F,overlap:ke=O,anchorOrigin:Ee=c,variant:zt=Q}=ge?X:s,Ut=zt!=="dot"?he:void 0,Qt={...s,badgeContent:Te,invisible:ge,max:oe,displayValue:Ut,showZero:Y,anchorOrigin:Ee,color:be,overlap:ke,variant:zt},kt=Zve(Qt),ft=(ne==null?void 0:ne.root)??a.Root??Xve,Rt=(ne==null?void 0:ne.badge)??a.Badge??Kve,Yt=(G==null?void 0:G.root)??I.root,ht=(G==null?void 0:G.badge)??I.badge,At=US({elementType:ft,externalSlotProps:Yt,externalForwardedProps:de,additionalProps:{ref:r,as:x},ownerState:Qt,className:Mr(Yt==null?void 0:Yt.className,kt.root,f)}),wt=US({elementType:Rt,externalSlotProps:ht,ownerState:Qt,className:Mr(kt.badge,ht==null?void 0:ht.className)});return N.jsxs(ft,{...At,children:[D,N.jsx(Rt,{...wt,children:Ut})]})});function Yve(e){return Si("MuiButton",e)}const I_=Ii("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),Jve=W.createContext({}),e1e=W.createContext(void 0),t1e=e=>{const{color:t,disableElevation:r,fullWidth:s,size:c,variant:f,classes:_}=e,x={root:["root",f,`${f}${Xn(t)}`,`size${Xn(c)}`,`${f}Size${Xn(c)}`,`color${Xn(t)}`,r&&"disableElevation",s&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${Xn(c)}`],endIcon:["icon","endIcon",`iconSize${Xn(c)}`]},a=Ri(x,Yve,_);return{..._,...a}},gH=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],n1e=Kn(IO,{shouldForwardProp:e=>Ga(e)||e==="classes",name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t[`${r.variant}${Xn(r.color)}`],t[`size${Xn(r.size)}`],t[`${r.variant}Size${Xn(r.size)}`],r.color==="inherit"&&t.colorInherit,r.disableElevation&&t.disableElevation,r.fullWidth&&t.fullWidth]}})(rs(({theme:e})=>{var s,c;const t=e.palette.mode==="light"?e.palette.grey[300]:e.palette.grey[800],r=e.palette.mode==="light"?e.palette.grey.A100:e.palette.grey[700];return{...e.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create(["background-color","box-shadow","border-color","color"],{duration:e.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${I_.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(e.vars||e).shadows[2],"&:hover":{boxShadow:(e.vars||e).shadows[4],"@media (hover: none)":{boxShadow:(e.vars||e).shadows[2]}},"&:active":{boxShadow:(e.vars||e).shadows[8]},[`&.${I_.focusVisible}`]:{boxShadow:(e.vars||e).shadows[6]},[`&.${I_.disabled}`]:{color:(e.vars||e).palette.action.disabled,boxShadow:(e.vars||e).shadows[0],backgroundColor:(e.vars||e).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${I_.disabled}`]:{border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(e.palette).filter(([,f])=>f&&f.main&&f.dark&&f.contrastText).map(([f])=>({props:{color:f},style:{"--variant-textColor":(e.vars||e).palette[f].main,"--variant-outlinedColor":(e.vars||e).palette[f].main,"--variant-outlinedBorder":e.vars?`rgba(${e.vars.palette[f].mainChannel} / 0.5)`:$l(e.palette[f].main,.5),"--variant-containedColor":(e.vars||e).palette[f].contrastText,"--variant-containedBg":(e.vars||e).palette[f].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(e.vars||e).palette[f].dark,"--variant-textBg":e.vars?`rgba(${e.vars.palette[f].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:$l(e.palette[f].main,e.palette.action.hoverOpacity),"--variant-outlinedBorder":(e.vars||e).palette[f].main,"--variant-outlinedBg":e.vars?`rgba(${e.vars.palette[f].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:$l(e.palette[f].main,e.palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{"--variant-containedColor":e.vars?e.vars.palette.text.primary:(c=(s=e.palette).getContrastText)==null?void 0:c.call(s,t),"--variant-containedBg":e.vars?e.vars.palette.Button.inheritContainedBg:t,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":e.vars?e.vars.palette.Button.inheritContainedHoverBg:r,"--variant-textBg":e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:$l(e.palette.text.primary,e.palette.action.hoverOpacity),"--variant-outlinedBg":e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:$l(e.palette.text.primary,e.palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:e.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:e.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:e.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:e.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:e.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:e.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${I_.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${I_.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}}]}})),r1e=Kn("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.startIcon,t[`iconSize${Xn(r.size)}`]]}})({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},...gH]}),i1e=Kn("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.endIcon,t[`iconSize${Xn(r.size)}`]]}})({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},...gH]}),am=W.forwardRef(function(t,r){const s=W.useContext(Jve),c=W.useContext(e1e),f=Px(s,t),_=is({props:f,name:"MuiButton"}),{children:x,color:a="primary",component:I="button",className:D,disabled:O=!1,disableElevation:F=!1,disableFocusRipple:Z=!1,endIcon:J,focusVisibleClassName:re,fullWidth:ne=!1,size:G="medium",startIcon:Y,type:Q,variant:de="text",...Te}=_,we={..._,color:a,component:I,disabled:O,disableElevation:F,disableFocusRipple:Z,fullWidth:ne,size:G,type:Q,variant:de},oe=t1e(we),he=Y&&N.jsx(r1e,{className:oe.startIcon,ownerState:we,children:Y}),X=J&&N.jsx(i1e,{className:oe.endIcon,ownerState:we,children:J}),ge=c||"";return N.jsxs(n1e,{ownerState:we,className:Mr(s.className,oe.root,D,ge),component:I,disabled:O,focusRipple:!Z,focusVisibleClassName:Mr(oe.focusVisible,re),ref:r,type:Q,...Te,classes:oe,children:[he,x,X]})});function s1e(e){return Si("PrivateSwitchBase",e)}Ii("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const o1e=e=>{const{classes:t,checked:r,disabled:s,edge:c}=e,f={root:["root",r&&"checked",s&&"disabled",c&&`edge${Xn(c)}`],input:["input"]};return Ri(f,s1e,t)},a1e=Kn(IO)({padding:9,borderRadius:"50%",variants:[{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e==="start"&&t.size!=="small",style:{marginLeft:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e==="end"&&t.size!=="small",style:{marginRight:-12}}]}),l1e=Kn("input",{shouldForwardProp:Ga})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),c1e=W.forwardRef(function(t,r){const{autoFocus:s,checked:c,checkedIcon:f,className:_,defaultChecked:x,disabled:a,disableFocusRipple:I=!1,edge:D=!1,icon:O,id:F,inputProps:Z,inputRef:J,name:re,onBlur:ne,onChange:G,onFocus:Y,readOnly:Q,required:de=!1,tabIndex:Te,type:we,value:oe,...he}=t,[X,ge]=jS({controlled:c,default:!!x,name:"SwitchBase",state:"checked"}),be=sd(),ke=Rt=>{Y&&Y(Rt),be&&be.onFocus&&be.onFocus(Rt)},Ee=Rt=>{ne&&ne(Rt),be&&be.onBlur&&be.onBlur(Rt)},zt=Rt=>{if(Rt.nativeEvent.defaultPrevented)return;const Yt=Rt.target.checked;ge(Yt),G&&G(Rt,Yt)};let Ut=a;be&&typeof Ut>"u"&&(Ut=be.disabled);const Qt=we==="checkbox"||we==="radio",kt={...t,checked:X,disabled:Ut,disableFocusRipple:I,edge:D},ft=o1e(kt);return N.jsxs(a1e,{component:"span",className:Mr(ft.root,_),centerRipple:!0,focusRipple:!I,disabled:Ut,tabIndex:null,role:void 0,onFocus:ke,onBlur:Ee,ownerState:kt,ref:r,...he,children:[N.jsx(l1e,{autoFocus:s,checked:c,defaultChecked:x,className:ft.input,disabled:Ut,id:Qt?F:void 0,name:re,onChange:zt,readOnly:Q,ref:J,required:de,ownerState:kt,tabIndex:Te,type:we,...we==="checkbox"&&oe===void 0?{}:{value:oe},...Z}),X?f:O]})});function u1e(e){const t=ml(e);return t.body===e?$m(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}function N1(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function yV(e){return parseInt($m(e).getComputedStyle(e).paddingRight,10)||0}function h1e(e){const r=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName)!==-1,s=e.tagName==="INPUT"&&e.getAttribute("type")==="hidden";return r||s}function vV(e,t,r,s,c){const f=[t,r,...s];[].forEach.call(e.children,_=>{const x=f.indexOf(_)===-1,a=!h1e(_);x&&a&&N1(_,c)})}function AR(e,t){let r=-1;return e.some((s,c)=>t(s)?(r=c,!0):!1),r}function d1e(e,t){const r=[],s=e.container;if(!t.disableScrollLock){if(u1e(s)){const _=iH(ml(s));r.push({value:s.style.paddingRight,property:"padding-right",el:s}),s.style.paddingRight=`${yV(s)+_}px`;const x=ml(s).querySelectorAll(".mui-fixed");[].forEach.call(x,a=>{r.push({value:a.style.paddingRight,property:"padding-right",el:a}),a.style.paddingRight=`${yV(a)+_}px`})}let f;if(s.parentNode instanceof DocumentFragment)f=ml(s).body;else{const _=s.parentElement,x=$m(s);f=(_==null?void 0:_.nodeName)==="HTML"&&x.getComputedStyle(_).overflowY==="scroll"?_:s}r.push({value:f.style.overflow,property:"overflow",el:f},{value:f.style.overflowX,property:"overflow-x",el:f},{value:f.style.overflowY,property:"overflow-y",el:f}),f.style.overflow="hidden"}return()=>{r.forEach(({value:f,el:_,property:x})=>{f?_.style.setProperty(x,f):_.style.removeProperty(x)})}}function f1e(e){const t=[];return[].forEach.call(e.children,r=>{r.getAttribute("aria-hidden")==="true"&&t.push(r)}),t}class p1e{constructor(){this.modals=[],this.containers=[]}add(t,r){let s=this.modals.indexOf(t);if(s!==-1)return s;s=this.modals.length,this.modals.push(t),t.modalRef&&N1(t.modalRef,!1);const c=f1e(r);vV(r,t.mount,t.modalRef,c,!0);const f=AR(this.containers,_=>_.container===r);return f!==-1?(this.containers[f].modals.push(t),s):(this.containers.push({modals:[t],container:r,restore:null,hiddenSiblings:c}),s)}mount(t,r){const s=AR(this.containers,f=>f.modals.indexOf(t)!==-1),c=this.containers[s];c.restore||(c.restore=d1e(c,r))}remove(t,r=!0){const s=this.modals.indexOf(t);if(s===-1)return s;const c=AR(this.containers,_=>_.modals.indexOf(t)!==-1),f=this.containers[c];if(f.modals.splice(f.modals.indexOf(t),1),this.modals.splice(s,1),f.modals.length===0)f.restore&&f.restore(),t.modalRef&&N1(t.modalRef,r),vV(f.container,t.mount,t.modalRef,f.hiddenSiblings,!1),this.containers.splice(c,1);else{const _=f.modals[f.modals.length-1];_.modalRef&&N1(_.modalRef,!1)}return s}isTopModal(t){return this.modals.length>0&&this.modals[this.modals.length-1]===t}}const m1e=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function g1e(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?e.contentEditable==="true"||(e.nodeName==="AUDIO"||e.nodeName==="VIDEO"||e.nodeName==="DETAILS")&&e.getAttribute("tabindex")===null?0:e.tabIndex:t}function _1e(e){if(e.tagName!=="INPUT"||e.type!=="radio"||!e.name)return!1;const t=s=>e.ownerDocument.querySelector(`input[type="radio"]${s}`);let r=t(`[name="${e.name}"]:checked`);return r||(r=t(`[name="${e.name}"]`)),r!==e}function y1e(e){return!(e.disabled||e.tagName==="INPUT"&&e.type==="hidden"||_1e(e))}function v1e(e){const t=[],r=[];return Array.from(e.querySelectorAll(m1e)).forEach((s,c)=>{const f=g1e(s);f===-1||!y1e(s)||(f===0?t.push(s):r.push({documentOrder:c,tabIndex:f,node:s}))}),r.sort((s,c)=>s.tabIndex===c.tabIndex?s.documentOrder-c.documentOrder:s.tabIndex-c.tabIndex).map(s=>s.node).concat(t)}function x1e(){return!0}function b1e(e){const{children:t,disableAutoFocus:r=!1,disableEnforceFocus:s=!1,disableRestoreFocus:c=!1,getTabbable:f=v1e,isEnabled:_=x1e,open:x}=e,a=W.useRef(!1),I=W.useRef(null),D=W.useRef(null),O=W.useRef(null),F=W.useRef(null),Z=W.useRef(!1),J=W.useRef(null),re=Oo(gb(t),J),ne=W.useRef(null);W.useEffect(()=>{!x||!J.current||(Z.current=!r)},[r,x]),W.useEffect(()=>{if(!x||!J.current)return;const Q=ml(J.current);return J.current.contains(Q.activeElement)||(J.current.hasAttribute("tabIndex")||J.current.setAttribute("tabIndex","-1"),Z.current&&J.current.focus()),()=>{c||(O.current&&O.current.focus&&(a.current=!0,O.current.focus()),O.current=null)}},[x]),W.useEffect(()=>{if(!x||!J.current)return;const Q=ml(J.current),de=oe=>{ne.current=oe,!(s||!_()||oe.key!=="Tab")&&Q.activeElement===J.current&&oe.shiftKey&&(a.current=!0,D.current&&D.current.focus())},Te=()=>{var X,ge;const oe=J.current;if(oe===null)return;if(!Q.hasFocus()||!_()||a.current){a.current=!1;return}if(oe.contains(Q.activeElement)||s&&Q.activeElement!==I.current&&Q.activeElement!==D.current)return;if(Q.activeElement!==F.current)F.current=null;else if(F.current!==null)return;if(!Z.current)return;let he=[];if((Q.activeElement===I.current||Q.activeElement===D.current)&&(he=f(J.current)),he.length>0){const be=!!((X=ne.current)!=null&&X.shiftKey&&((ge=ne.current)==null?void 0:ge.key)==="Tab"),ke=he[0],Ee=he[he.length-1];typeof ke!="string"&&typeof Ee!="string"&&(be?Ee.focus():ke.focus())}else oe.focus()};Q.addEventListener("focusin",Te),Q.addEventListener("keydown",de,!0);const we=setInterval(()=>{Q.activeElement&&Q.activeElement.tagName==="BODY"&&Te()},50);return()=>{clearInterval(we),Q.removeEventListener("focusin",Te),Q.removeEventListener("keydown",de,!0)}},[r,s,c,_,x,f]);const G=Q=>{O.current===null&&(O.current=Q.relatedTarget),Z.current=!0,F.current=Q.target;const de=t.props.onFocus;de&&de(Q)},Y=Q=>{O.current===null&&(O.current=Q.relatedTarget),Z.current=!0};return N.jsxs(W.Fragment,{children:[N.jsx("div",{tabIndex:x?0:-1,onFocus:Y,ref:I,"data-testid":"sentinelStart"}),W.cloneElement(t,{ref:re,onFocus:G}),N.jsx("div",{tabIndex:x?0:-1,onFocus:Y,ref:D,"data-testid":"sentinelEnd"})]})}function w1e(e){return typeof e=="function"?e():e}function T1e(e){return e?e.props.hasOwnProperty("in"):!1}const E1e=new p1e;function S1e(e){const{container:t,disableEscapeKeyDown:r=!1,disableScrollLock:s=!1,manager:c=E1e,closeAfterTransition:f=!1,onTransitionEnter:_,onTransitionExited:x,children:a,onClose:I,open:D,rootRef:O}=e,F=W.useRef({}),Z=W.useRef(null),J=W.useRef(null),re=Oo(J,O),[ne,G]=W.useState(!D),Y=T1e(a);let Q=!0;(e["aria-hidden"]==="false"||e["aria-hidden"]===!1)&&(Q=!1);const de=()=>ml(Z.current),Te=()=>(F.current.modalRef=J.current,F.current.mount=Z.current,F.current),we=()=>{c.mount(Te(),{disableScrollLock:s}),J.current&&(J.current.scrollTop=0)},oe=Z_(()=>{const Qt=w1e(t)||de().body;c.add(Te(),Qt),J.current&&we()}),he=W.useCallback(()=>c.isTopModal(Te()),[c]),X=Z_(Qt=>{Z.current=Qt,Qt&&(D&&he()?we():J.current&&N1(J.current,Q))}),ge=W.useCallback(()=>{c.remove(Te(),Q)},[Q,c]);W.useEffect(()=>()=>{ge()},[ge]),W.useEffect(()=>{D?oe():(!Y||!f)&&ge()},[D,ge,Y,f,oe]);const be=Qt=>kt=>{var ft;(ft=Qt.onKeyDown)==null||ft.call(Qt,kt),!(kt.key!=="Escape"||kt.which===229||!he())&&(r||(kt.stopPropagation(),I&&I(kt,"escapeKeyDown")))},ke=Qt=>kt=>{var ft;(ft=Qt.onClick)==null||ft.call(Qt,kt),kt.target===kt.currentTarget&&I&&I(kt,"backdropClick")};return{getRootProps:(Qt={})=>{const kt=aH(e);delete kt.onTransitionEnter,delete kt.onTransitionExited;const ft={...kt,...Qt};return{role:"presentation",...ft,onKeyDown:be(ft),ref:re}},getBackdropProps:(Qt={})=>{const kt=Qt;return{"aria-hidden":!0,...kt,onClick:ke(kt),open:D}},getTransitionProps:()=>{const Qt=()=>{G(!1),_&&_()},kt=()=>{G(!0),x&&x(),f&&ge()};return{onEnter:Ok(Qt,a==null?void 0:a.props.onEnter),onExited:Ok(kt,a==null?void 0:a.props.onExited)}},rootRef:re,portalRef:X,isTopModal:he,exited:ne,hasTransition:Y}}function I1e(e){return Si("MuiModal",e)}Ii("MuiModal",["root","hidden","backdrop"]);const C1e=e=>{const{open:t,exited:r,classes:s}=e;return Ri({root:["root",!t&&r&&"hidden"],backdrop:["backdrop"]},I1e,s)},A1e=Kn("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,!r.open&&r.exited&&t.hidden]}})(rs(({theme:e})=>({position:"fixed",zIndex:(e.vars||e).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:t})=>!t.open&&t.exited,style:{visibility:"hidden"}}]}))),P1e=Kn(Gve,{name:"MuiModal",slot:"Backdrop",overridesResolver:(e,t)=>t.backdrop})({zIndex:-1}),R1e=W.forwardRef(function(t,r){const s=is({name:"MuiModal",props:t}),{BackdropComponent:c=P1e,BackdropProps:f,classes:_,className:x,closeAfterTransition:a=!1,children:I,container:D,component:O,components:F={},componentsProps:Z={},disableAutoFocus:J=!1,disableEnforceFocus:re=!1,disableEscapeKeyDown:ne=!1,disablePortal:G=!1,disableRestoreFocus:Y=!1,disableScrollLock:Q=!1,hideBackdrop:de=!1,keepMounted:Te=!1,onBackdropClick:we,onClose:oe,onTransitionEnter:he,onTransitionExited:X,open:ge,slotProps:be={},slots:ke={},theme:Ee,...zt}=s,Ut={...s,closeAfterTransition:a,disableAutoFocus:J,disableEnforceFocus:re,disableEscapeKeyDown:ne,disablePortal:G,disableRestoreFocus:Y,disableScrollLock:Q,hideBackdrop:de,keepMounted:Te},{getRootProps:Qt,getBackdropProps:kt,getTransitionProps:ft,portalRef:Rt,isTopModal:Yt,exited:ht,hasTransition:At}=S1e({...Ut,rootRef:r}),wt={...Ut,exited:ht},Xt=C1e(wt),Ft={};if(I.props.tabIndex===void 0&&(Ft.tabIndex="-1"),At){const{onEnter:Rn,onExited:Nr}=ft();Ft.onEnter=Rn,Ft.onExited=Nr}const Sn={slots:{root:F.Root,backdrop:F.Backdrop,...ke},slotProps:{...Z,...be}},[qn,Qn]=ql("root",{elementType:A1e,externalForwardedProps:Sn,getSlotProps:Qt,additionalProps:{ref:r,as:O},ownerState:wt,className:Mr(x,Xt==null?void 0:Xt.root,!wt.open&&wt.exited&&(Xt==null?void 0:Xt.hidden))}),[Gt,Cn]=ql("backdrop",{elementType:c,externalForwardedProps:Sn,additionalProps:f,getSlotProps:Rn=>kt({...Rn,onClick:Nr=>{we&&we(Nr),Rn!=null&&Rn.onClick&&Rn.onClick(Nr)}}),className:Mr(f==null?void 0:f.className,Xt==null?void 0:Xt.backdrop),ownerState:wt}),hn=Oo(f==null?void 0:f.ref,Cn.ref);return!Te&&!ge&&(!At||ht)?null:N.jsx(Ave,{ref:Rt,container:D,disablePortal:G,children:N.jsxs(qn,{...Qn,...zt,children:[!de&&c?N.jsx(Gt,{...Cn,ref:hn}):null,N.jsx(b1e,{disableEnforceFocus:re,disableAutoFocus:J,disableRestoreFocus:Y,isEnabled:Yt,open:ge,children:W.cloneElement(I,Ft)})]})})}),M1e=e=>{const{classes:t,disableUnderline:r,startAdornment:s,endAdornment:c,size:f,hiddenLabel:_,multiline:x}=e,a={root:["root",!r&&"underline",s&&"adornedStart",c&&"adornedEnd",f==="small"&&`size${Xn(f)}`,_&&"hiddenLabel",x&&"multiline"],input:["input"]},I=Ri(a,Fve,t);return{...t,...I}},k1e=Kn(WC,{shouldForwardProp:e=>Ga(e)||e==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[...qC(e,t),!r.disableUnderline&&t.underline]}})(rs(({theme:e})=>{const t=e.palette.mode==="light",r=t?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",s=t?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",c=t?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",f=t?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:e.vars?e.vars.palette.FilledInput.bg:s,borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),"&:hover":{backgroundColor:e.vars?e.vars.palette.FilledInput.hoverBg:c,"@media (hover: none)":{backgroundColor:e.vars?e.vars.palette.FilledInput.bg:s}},[`&.${Yp.focused}`]:{backgroundColor:e.vars?e.vars.palette.FilledInput.bg:s},[`&.${Yp.disabled}`]:{backgroundColor:e.vars?e.vars.palette.FilledInput.disabledBg:f},variants:[{props:({ownerState:_})=>!_.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Yp.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Yp.error}`]:{"&::before, &::after":{borderBottomColor:(e.vars||e).palette.error.main}},"&::before":{borderBottom:`1px solid ${e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / ${e.vars.opacity.inputUnderline})`:r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Yp.disabled}, .${Yp.error}):before`]:{borderBottom:`1px solid ${(e.vars||e).palette.text.primary}`},[`&.${Yp.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(e.palette).filter(([,_])=>_&&_.main).map(([_])=>{var x;return{props:{disableUnderline:!1,color:_},style:{"&::after":{borderBottom:`2px solid ${(x=(e.vars||e).palette[_])==null?void 0:x.main}`}}}}),{props:({ownerState:_})=>_.startAdornment,style:{paddingLeft:12}},{props:({ownerState:_})=>_.endAdornment,style:{paddingRight:12}},{props:({ownerState:_})=>_.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:_,size:x})=>_.multiline&&x==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:_})=>_.multiline&&_.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:_})=>_.multiline&&_.hiddenLabel&&_.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),D1e=Kn(HC,{name:"MuiFilledInput",slot:"Input",overridesResolver:GC})(rs(({theme:e})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!e.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:e.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:e.palette.mode==="light"?null:"#fff",caretColor:e.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...e.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[e.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:t})=>t.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:t})=>t.startAdornment,style:{paddingLeft:0}},{props:({ownerState:t})=>t.endAdornment,style:{paddingRight:0}},{props:({ownerState:t})=>t.hiddenLabel&&t.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:t})=>t.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),HS=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiFilledInput"}),{disableUnderline:c=!1,components:f={},componentsProps:_,fullWidth:x=!1,hiddenLabel:a,inputComponent:I="input",multiline:D=!1,slotProps:O,slots:F={},type:Z="text",...J}=s,re={...s,disableUnderline:c,fullWidth:x,inputComponent:I,multiline:D,type:Z},ne=M1e(s),G={root:{ownerState:re},input:{ownerState:re}},Y=O??_?Qo(G,O??_):G,Q=F.root??f.Root??k1e,de=F.input??f.Input??D1e;return N.jsx(AO,{slots:{root:Q,input:de},componentsProps:Y,fullWidth:x,inputComponent:I,multiline:D,ref:r,type:Z,...J,classes:ne})});HS&&(HS.muiName="Input");function O1e(e){return Si("MuiFormControl",e)}Ii("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const L1e=e=>{const{classes:t,margin:r,fullWidth:s}=e,c={root:["root",r!=="none"&&`margin${Xn(r)}`,s&&"fullWidth"]};return Ri(c,O1e,t)},z1e=Kn("div",{name:"MuiFormControl",slot:"Root",overridesResolver:({ownerState:e},t)=>({...t.root,...t[`margin${Xn(e.margin)}`],...e.fullWidth&&t.fullWidth})})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),N1e=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiFormControl"}),{children:c,className:f,color:_="primary",component:x="div",disabled:a=!1,error:I=!1,focused:D,fullWidth:O=!1,hiddenLabel:F=!1,margin:Z="none",required:J=!1,size:re="medium",variant:ne="outlined",...G}=s,Y={...s,color:_,component:x,disabled:a,error:I,fullWidth:O,hiddenLabel:F,margin:Z,required:J,size:re,variant:ne},Q=L1e(Y),[de,Te]=W.useState(()=>{let Ee=!1;return c&&W.Children.forEach(c,zt=>{if(!wR(zt,["Input","Select"]))return;const Ut=wR(zt,["Select"])?zt.props.input:zt;Ut&&kve(Ut.props)&&(Ee=!0)}),Ee}),[we,oe]=W.useState(()=>{let Ee=!1;return c&&W.Children.forEach(c,zt=>{wR(zt,["Input","Select"])&&(WS(zt.props,!0)||WS(zt.props.inputProps,!0))&&(Ee=!0)}),Ee}),[he,X]=W.useState(!1);a&&he&&X(!1);const ge=D!==void 0&&!a?D:he;let be;const ke=W.useMemo(()=>({adornedStart:de,setAdornedStart:Te,color:_,disabled:a,error:I,filled:we,focused:ge,fullWidth:O,hiddenLabel:F,size:re,onBlur:()=>{X(!1)},onEmpty:()=>{oe(!1)},onFilled:()=>{oe(!0)},onFocus:()=>{X(!0)},registerEffect:be,required:J,variant:ne}),[de,_,a,I,we,ge,O,F,be,J,re,ne]);return N.jsx(CO.Provider,{value:ke,children:N.jsx(z1e,{as:x,ownerState:Y,className:Mr(Q.root,f),ref:r,...G,children:c})})});function F1e(e){return Si("MuiFormControlLabel",e)}const d1=Ii("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),B1e=e=>{const{classes:t,disabled:r,labelPlacement:s,error:c,required:f}=e,_={root:["root",r&&"disabled",`labelPlacement${Xn(s)}`,c&&"error",f&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",c&&"error"]};return Ri(_,F1e,t)},j1e=Kn("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{[`& .${d1.label}`]:t.label},t.root,t[`labelPlacement${Xn(r.labelPlacement)}`]]}})(rs(({theme:e})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${d1.disabled}`]:{cursor:"default"},[`& .${d1.label}`]:{[`&.${d1.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:t})=>t==="start"||t==="top"||t==="bottom",style:{marginLeft:16}}]}))),U1e=Kn("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})(rs(({theme:e})=>({[`&.${d1.error}`]:{color:(e.vars||e).palette.error.main}}))),V1e=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiFormControlLabel"}),{checked:c,className:f,componentsProps:_={},control:x,disabled:a,disableTypography:I,inputRef:D,label:O,labelPlacement:F="end",name:Z,onChange:J,required:re,slots:ne={},slotProps:G={},value:Y,...Q}=s,de=sd(),Te=a??x.props.disabled??(de==null?void 0:de.disabled),we=re??x.props.required,oe={disabled:Te,required:we};["checked","name","onChange","value","inputRef"].forEach(Ut=>{typeof x.props[Ut]>"u"&&typeof s[Ut]<"u"&&(oe[Ut]=s[Ut])});const he=Jf({props:s,muiFormControl:de,states:["error"]}),X={...s,disabled:Te,labelPlacement:F,required:we,error:he.error},ge=B1e(X),be={slots:ne,slotProps:{..._,...G}},[ke,Ee]=ql("typography",{elementType:pV,externalForwardedProps:be,ownerState:X});let zt=O;return zt!=null&&zt.type!==pV&&!I&&(zt=N.jsx(ke,{component:"span",...Ee,className:Mr(ge.label,Ee==null?void 0:Ee.className),children:zt})),N.jsxs(j1e,{className:Mr(ge.root,f),ownerState:X,ref:r,...Q,children:[W.cloneElement(x,oe),we?N.jsxs("div",{children:[zt,N.jsxs(U1e,{ownerState:X,"aria-hidden":!0,className:ge.asterisk,children:["","*"]})]}):zt]})});function $1e(e){return Si("MuiFormGroup",e)}Ii("MuiFormGroup",["root","row","error"]);const q1e=e=>{const{classes:t,row:r,error:s}=e;return Ri({root:["root",r&&"row",s&&"error"]},$1e,t)},G1e=Kn("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.row&&t.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),W1e=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiFormGroup"}),{className:c,row:f=!1,..._}=s,x=sd(),a=Jf({props:s,muiFormControl:x,states:["error"]}),I={...s,row:f,error:a.error},D=q1e(I);return N.jsx(G1e,{className:Mr(D.root,c),ownerState:I,ref:r,..._})});function H1e(e){return Si("MuiFormHelperText",e)}const xV=Ii("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var bV;const Z1e=e=>{const{classes:t,contained:r,size:s,disabled:c,error:f,filled:_,focused:x,required:a}=e,I={root:["root",c&&"disabled",f&&"error",s&&`size${Xn(s)}`,r&&"contained",x&&"focused",_&&"filled",a&&"required"]};return Ri(I,H1e,t)},X1e=Kn("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.size&&t[`size${Xn(r.size)}`],r.contained&&t.contained,r.filled&&t.filled]}})(rs(({theme:e})=>({color:(e.vars||e).palette.text.secondary,...e.typography.caption,textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${xV.disabled}`]:{color:(e.vars||e).palette.text.disabled},[`&.${xV.error}`]:{color:(e.vars||e).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:t})=>t.contained,style:{marginLeft:14,marginRight:14}}]}))),K1e=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiFormHelperText"}),{children:c,className:f,component:_="p",disabled:x,error:a,filled:I,focused:D,margin:O,required:F,variant:Z,...J}=s,re=sd(),ne=Jf({props:s,muiFormControl:re,states:["variant","size","disabled","error","filled","focused","required"]}),G={...s,component:_,contained:ne.variant==="filled"||ne.variant==="outlined",variant:ne.variant,size:ne.size,disabled:ne.disabled,error:ne.error,filled:ne.filled,focused:ne.focused,required:ne.required};delete G.ownerState;const Y=Z1e(G);return N.jsx(X1e,{as:_,className:Mr(Y.root,f),ref:r,...J,ownerState:G,children:c===" "?bV||(bV=N.jsx("span",{className:"notranslate",children:""})):c})});function Q1e(e){return Si("MuiFormLabel",e)}const F1=Ii("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),Y1e=e=>{const{classes:t,color:r,focused:s,disabled:c,error:f,filled:_,required:x}=e,a={root:["root",`color${Xn(r)}`,c&&"disabled",f&&"error",_&&"filled",s&&"focused",x&&"required"],asterisk:["asterisk",f&&"error"]};return Ri(a,Q1e,t)},J1e=Kn("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:({ownerState:e},t)=>({...t.root,...e.color==="secondary"&&t.colorSecondary,...e.filled&&t.filled})})(rs(({theme:e})=>({color:(e.vars||e).palette.text.secondary,...e.typography.body1,lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t},style:{[`&.${F1.focused}`]:{color:(e.vars||e).palette[t].main}}})),{props:{},style:{[`&.${F1.disabled}`]:{color:(e.vars||e).palette.text.disabled},[`&.${F1.error}`]:{color:(e.vars||e).palette.error.main}}}]}))),exe=Kn("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})(rs(({theme:e})=>({[`&.${F1.error}`]:{color:(e.vars||e).palette.error.main}}))),txe=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiFormLabel"}),{children:c,className:f,color:_,component:x="label",disabled:a,error:I,filled:D,focused:O,required:F,...Z}=s,J=sd(),re=Jf({props:s,muiFormControl:J,states:["color","required","focused","disabled","error","filled"]}),ne={...s,color:re.color||"primary",component:x,disabled:re.disabled,error:re.error,filled:re.filled,focused:re.focused,required:re.required},G=Y1e(ne);return N.jsxs(J1e,{as:x,ownerState:ne,className:Mr(G.root,f),ref:r,...Z,children:[c,re.required&&N.jsxs(exe,{ownerState:ne,"aria-hidden":!0,className:G.asterisk,children:["","*"]})]})});function Vk(e){return`scale(${e}, ${e**2})`}const nxe={entering:{opacity:1,transform:Vk(1)},entered:{opacity:1,transform:"none"}},PR=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),$k=W.forwardRef(function(t,r){const{addEndListener:s,appear:c=!0,children:f,easing:_,in:x,onEnter:a,onEntered:I,onEntering:D,onExit:O,onExited:F,onExiting:Z,style:J,timeout:re="auto",TransitionComponent:ne=Zu,...G}=t,Y=rH(),Q=W.useRef(),de=TO(),Te=W.useRef(null),we=Oo(Te,gb(f),r),oe=Ut=>Qt=>{if(Ut){const kt=Te.current;Qt===void 0?Ut(kt):Ut(kt,Qt)}},he=oe(D),X=oe((Ut,Qt)=>{mH(Ut);const{duration:kt,delay:ft,easing:Rt}=qS({style:J,timeout:re,easing:_},{mode:"enter"});let Yt;re==="auto"?(Yt=de.transitions.getAutoHeightDuration(Ut.clientHeight),Q.current=Yt):Yt=kt,Ut.style.transition=[de.transitions.create("opacity",{duration:Yt,delay:ft}),de.transitions.create("transform",{duration:PR?Yt:Yt*.666,delay:ft,easing:Rt})].join(","),a&&a(Ut,Qt)}),ge=oe(I),be=oe(Z),ke=oe(Ut=>{const{duration:Qt,delay:kt,easing:ft}=qS({style:J,timeout:re,easing:_},{mode:"exit"});let Rt;re==="auto"?(Rt=de.transitions.getAutoHeightDuration(Ut.clientHeight),Q.current=Rt):Rt=Qt,Ut.style.transition=[de.transitions.create("opacity",{duration:Rt,delay:kt}),de.transitions.create("transform",{duration:PR?Rt:Rt*.666,delay:PR?kt:kt||Rt*.333,easing:ft})].join(","),Ut.style.opacity=0,Ut.style.transform=Vk(.75),O&&O(Ut)}),Ee=oe(F),zt=Ut=>{re==="auto"&&Y.start(Q.current||0,Ut),s&&s(Te.current,Ut)};return N.jsx(ne,{appear:c,in:x,nodeRef:Te,onEnter:X,onEntered:ge,onEntering:he,onExit:ke,onExited:Ee,onExiting:be,addEndListener:zt,timeout:re==="auto"?null:re,...G,children:(Ut,Qt)=>W.cloneElement(f,{style:{opacity:0,transform:Vk(.75),visibility:Ut==="exited"&&!x?"hidden":void 0,...nxe[Ut],...J,...f.props.style},ref:we,...Qt})})});$k&&($k.muiSupportAuto=!0);const rxe=e=>{const{classes:t,disableUnderline:r}=e,c=Ri({root:["root",!r&&"underline"],input:["input"]},zve,t);return{...t,...c}},ixe=Kn(WC,{shouldForwardProp:e=>Ga(e)||e==="classes",name:"MuiInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[...qC(e,t),!r.disableUnderline&&t.underline]}})(rs(({theme:e})=>{let r=e.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return e.vars&&(r=`rgba(${e.vars.palette.common.onBackgroundChannel} / ${e.vars.opacity.inputUnderline})`),{position:"relative",variants:[{props:({ownerState:s})=>s.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:s})=>!s.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Wv.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Wv.error}`]:{"&::before, &::after":{borderBottomColor:(e.vars||e).palette.error.main}},"&::before":{borderBottom:`1px solid ${r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Wv.disabled}, .${Wv.error}):before`]:{borderBottom:`2px solid ${(e.vars||e).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${r}`}},[`&.${Wv.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(e.palette).filter(([,s])=>s&&s.main).map(([s])=>({props:{color:s,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(e.vars||e).palette[s].main}`}}}))]}})),sxe=Kn(HC,{name:"MuiInput",slot:"Input",overridesResolver:GC})({}),ZS=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiInput"}),{disableUnderline:c=!1,components:f={},componentsProps:_,fullWidth:x=!1,inputComponent:a="input",multiline:I=!1,slotProps:D,slots:O={},type:F="text",...Z}=s,J=rxe(s),ne={root:{ownerState:{disableUnderline:c}}},G=D??_?Qo(D??_,ne):ne,Y=O.root??f.Root??ixe,Q=O.input??f.Input??sxe;return N.jsx(AO,{slots:{root:Y,input:Q},slotProps:G,fullWidth:x,inputComponent:a,multiline:I,ref:r,type:F,...Z,classes:J})});ZS&&(ZS.muiName="Input");function oxe(e){return Si("MuiInputLabel",e)}Ii("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const axe=e=>{const{classes:t,formControl:r,size:s,shrink:c,disableAnimation:f,variant:_,required:x}=e,a={root:["root",r&&"formControl",!f&&"animated",c&&"shrink",s&&s!=="normal"&&`size${Xn(s)}`,_],asterisk:[x&&"asterisk"]},I=Ri(a,oxe,t);return{...t,...I}},lxe=Kn(txe,{shouldForwardProp:e=>Ga(e)||e==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{[`& .${F1.asterisk}`]:t.asterisk},t.root,r.formControl&&t.formControl,r.size==="small"&&t.sizeSmall,r.shrink&&t.shrink,!r.disableAnimation&&t.animated,r.focused&&t.focused,t[r.variant]]}})(rs(({theme:e})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:t})=>t.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:t})=>t.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:t})=>!t.disableAnimation,style:{transition:e.transitions.create(["color","transform","max-width"],{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:t,ownerState:r})=>t==="filled"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:t,ownerState:r,size:s})=>t==="filled"&&r.shrink&&s==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:t,ownerState:r})=>t==="outlined"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),cxe=W.forwardRef(function(t,r){const s=is({name:"MuiInputLabel",props:t}),{disableAnimation:c=!1,margin:f,shrink:_,variant:x,className:a,...I}=s,D=sd();let O=_;typeof O>"u"&&D&&(O=D.filled||D.focused||D.adornedStart);const F=Jf({props:s,muiFormControl:D,states:["size","variant","required","focused"]}),Z={...s,disableAnimation:c,formControl:D,shrink:O,size:F.size,variant:F.variant,required:F.required,focused:F.focused},J=axe(Z);return N.jsx(lxe,{"data-shrink":O,ref:r,className:Mr(J.root,a),...I,ownerState:Z,classes:J})}),uxe=W.createContext({});function hxe(e){return Si("MuiList",e)}Ii("MuiList",["root","padding","dense","subheader"]);const dxe=e=>{const{classes:t,disablePadding:r,dense:s,subheader:c}=e;return Ri({root:["root",!r&&"padding",s&&"dense",c&&"subheader"]},hxe,t)},fxe=Kn("ul",{name:"MuiList",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,!r.disablePadding&&t.padding,r.dense&&t.dense,r.subheader&&t.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:e})=>!e.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:e})=>e.subheader,style:{paddingTop:0}}]}),pxe=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiList"}),{children:c,className:f,component:_="ul",dense:x=!1,disablePadding:a=!1,subheader:I,...D}=s,O=W.useMemo(()=>({dense:x}),[x]),F={...s,component:_,dense:x,disablePadding:a},Z=dxe(F);return N.jsx(uxe.Provider,{value:O,children:N.jsxs(fxe,{as:_,className:Mr(Z.root,f),ref:r,ownerState:F,...D,children:[I,c]})})});function RR(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function wV(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function _H(e,t){if(t===void 0)return!0;let r=e.innerText;return r===void 0&&(r=e.textContent),r=r.trim().toLowerCase(),r.length===0?!1:t.repeating?r[0]===t.keys[0]:r.startsWith(t.keys.join(""))}function Hv(e,t,r,s,c,f){let _=!1,x=c(e,t,t?r:!1);for(;x;){if(x===e.firstChild){if(_)return!1;_=!0}const a=s?!1:x.disabled||x.getAttribute("aria-disabled")==="true";if(!x.hasAttribute("tabindex")||!_H(x,f)||a)x=c(e,x,r);else return x.focus(),!0}return!1}const mxe=W.forwardRef(function(t,r){const{actions:s,autoFocus:c=!1,autoFocusItem:f=!1,children:_,className:x,disabledItemsFocusable:a=!1,disableListWrap:I=!1,onKeyDown:D,variant:O="selectedMenu",...F}=t,Z=W.useRef(null),J=W.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});Bf(()=>{c&&Z.current.focus()},[c]),W.useImperativeHandle(s,()=>({adjustStyleForScrollbar:(Q,{direction:de})=>{const Te=!Z.current.style.width;if(Q.clientHeight<Z.current.clientHeight&&Te){const we=`${iH(ml(Q))}px`;Z.current.style[de==="rtl"?"paddingLeft":"paddingRight"]=we,Z.current.style.width=`calc(100% + ${we})`}return Z.current}}),[]);const re=Q=>{const de=Z.current,Te=Q.key;if(Q.ctrlKey||Q.metaKey||Q.altKey){D&&D(Q);return}const oe=ml(de).activeElement;if(Te==="ArrowDown")Q.preventDefault(),Hv(de,oe,I,a,RR);else if(Te==="ArrowUp")Q.preventDefault(),Hv(de,oe,I,a,wV);else if(Te==="Home")Q.preventDefault(),Hv(de,null,I,a,RR);else if(Te==="End")Q.preventDefault(),Hv(de,null,I,a,wV);else if(Te.length===1){const he=J.current,X=Te.toLowerCase(),ge=performance.now();he.keys.length>0&&(ge-he.lastTime>500?(he.keys=[],he.repeating=!0,he.previousKeyMatched=!0):he.repeating&&X!==he.keys[0]&&(he.repeating=!1)),he.lastTime=ge,he.keys.push(X);const be=oe&&!he.repeating&&_H(oe,he);he.previousKeyMatched&&(be||Hv(de,oe,!1,a,RR,he))?Q.preventDefault():he.previousKeyMatched=!1}D&&D(Q)},ne=Oo(Z,r);let G=-1;W.Children.forEach(_,(Q,de)=>{if(!W.isValidElement(Q)){G===de&&(G+=1,G>=_.length&&(G=-1));return}Q.props.disabled||(O==="selectedMenu"&&Q.props.selected||G===-1)&&(G=de),G===de&&(Q.props.disabled||Q.props.muiSkipListHighlight||Q.type.muiSkipListHighlight)&&(G+=1,G>=_.length&&(G=-1))});const Y=W.Children.map(_,(Q,de)=>{if(de===G){const Te={};return f&&(Te.autoFocus=!0),Q.props.tabIndex===void 0&&O==="selectedMenu"&&(Te.tabIndex=0),W.cloneElement(Q,Te)}return Q});return N.jsx(pxe,{role:"menu",ref:ne,className:x,onKeyDown:re,tabIndex:c?0:-1,...F,children:Y})});function gxe(e){return Si("MuiPopover",e)}Ii("MuiPopover",["root","paper"]);function TV(e,t){let r=0;return typeof t=="number"?r=t:t==="center"?r=e.height/2:t==="bottom"&&(r=e.height),r}function EV(e,t){let r=0;return typeof t=="number"?r=t:t==="center"?r=e.width/2:t==="right"&&(r=e.width),r}function SV(e){return[e.horizontal,e.vertical].map(t=>typeof t=="number"?`${t}px`:t).join(" ")}function MR(e){return typeof e=="function"?e():e}const _xe=e=>{const{classes:t}=e;return Ri({root:["root"],paper:["paper"]},gxe,t)},yxe=Kn(R1e,{name:"MuiPopover",slot:"Root",overridesResolver:(e,t)=>t.root})({}),yH=Kn(rve,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,t)=>t.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),vxe=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiPopover"}),{action:c,anchorEl:f,anchorOrigin:_={vertical:"top",horizontal:"left"},anchorPosition:x,anchorReference:a="anchorEl",children:I,className:D,container:O,elevation:F=8,marginThreshold:Z=16,open:J,PaperProps:re={},slots:ne={},slotProps:G={},transformOrigin:Y={vertical:"top",horizontal:"left"},TransitionComponent:Q=$k,transitionDuration:de="auto",TransitionProps:{onEntering:Te,...we}={},disableScrollLock:oe=!1,...he}=s,X=(G==null?void 0:G.paper)??re,ge=W.useRef(),be={...s,anchorOrigin:_,anchorReference:a,elevation:F,marginThreshold:Z,externalPaperSlotProps:X,transformOrigin:Y,TransitionComponent:Q,transitionDuration:de,TransitionProps:we},ke=_xe(be),Ee=W.useCallback(()=>{if(a==="anchorPosition")return x;const Cn=MR(f),Rn=(Cn&&Cn.nodeType===1?Cn:ml(ge.current).body).getBoundingClientRect();return{top:Rn.top+TV(Rn,_.vertical),left:Rn.left+EV(Rn,_.horizontal)}},[f,_.horizontal,_.vertical,x,a]),zt=W.useCallback(Cn=>({vertical:TV(Cn,Y.vertical),horizontal:EV(Cn,Y.horizontal)}),[Y.horizontal,Y.vertical]),Ut=W.useCallback(Cn=>{const hn={width:Cn.offsetWidth,height:Cn.offsetHeight},Rn=zt(hn);if(a==="none")return{top:null,left:null,transformOrigin:SV(Rn)};const Nr=Ee();let jn=Nr.top-Rn.vertical,gr=Nr.left-Rn.horizontal;const Fr=jn+hn.height,dr=gr+hn.width,rr=$m(MR(f)),Ue=rr.innerHeight-Z,Xe=rr.innerWidth-Z;if(Z!==null&&jn<Z){const ut=jn-Z;jn-=ut,Rn.vertical+=ut}else if(Z!==null&&Fr>Ue){const ut=Fr-Ue;jn-=ut,Rn.vertical+=ut}if(Z!==null&&gr<Z){const ut=gr-Z;gr-=ut,Rn.horizontal+=ut}else if(dr>Xe){const ut=dr-Xe;gr-=ut,Rn.horizontal+=ut}return{top:`${Math.round(jn)}px`,left:`${Math.round(gr)}px`,transformOrigin:SV(Rn)}},[f,a,Ee,zt,Z]),[Qt,kt]=W.useState(J),ft=W.useCallback(()=>{const Cn=ge.current;if(!Cn)return;const hn=Ut(Cn);hn.top!==null&&(Cn.style.top=hn.top),hn.left!==null&&(Cn.style.left=hn.left),Cn.style.transformOrigin=hn.transformOrigin,kt(!0)},[Ut]);W.useEffect(()=>(oe&&window.addEventListener("scroll",ft),()=>window.removeEventListener("scroll",ft)),[f,oe,ft]);const Rt=(Cn,hn)=>{Te&&Te(Cn,hn),ft()},Yt=()=>{kt(!1)};W.useEffect(()=>{J&&ft()}),W.useImperativeHandle(c,()=>J?{updatePosition:()=>{ft()}}:null,[J,ft]),W.useEffect(()=>{if(!J)return;const Cn=tH(()=>{ft()}),hn=$m(f);return hn.addEventListener("resize",Cn),()=>{Cn.clear(),hn.removeEventListener("resize",Cn)}},[f,J,ft]);let ht=de;de==="auto"&&!Q.muiSupportAuto&&(ht=void 0);const At=O||(f?ml(MR(f)).body:void 0),wt={slots:ne,slotProps:{...G,paper:X}},[Xt,Ft]=ql("paper",{elementType:yH,externalForwardedProps:wt,additionalProps:{elevation:F,className:Mr(ke.paper,X==null?void 0:X.className),style:Qt?X.style:{...X.style,opacity:0}},ownerState:be}),[Sn,{slotProps:qn,...Qn}]=ql("root",{elementType:yxe,externalForwardedProps:wt,additionalProps:{slotProps:{backdrop:{invisible:!0}},container:At,open:J},ownerState:be,className:Mr(ke.root,D)}),Gt=Oo(ge,Ft.ref);return N.jsx(Sn,{...Qn,...!Uk(Sn)&&{slotProps:qn,disableScrollLock:oe},...he,ref:r,children:N.jsx(Q,{appear:!0,in:J,onEntering:Rt,onExited:Yt,timeout:ht,...we,children:N.jsx(Xt,{...Ft,ref:Gt,children:I})})})});function xxe(e){return Si("MuiMenu",e)}Ii("MuiMenu",["root","paper","list"]);const bxe={vertical:"top",horizontal:"right"},wxe={vertical:"top",horizontal:"left"},Txe=e=>{const{classes:t}=e;return Ri({root:["root"],paper:["paper"],list:["list"]},xxe,t)},Exe=Kn(vxe,{shouldForwardProp:e=>Ga(e)||e==="classes",name:"MuiMenu",slot:"Root",overridesResolver:(e,t)=>t.root})({}),Sxe=Kn(yH,{name:"MuiMenu",slot:"Paper",overridesResolver:(e,t)=>t.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),Ixe=Kn(mxe,{name:"MuiMenu",slot:"List",overridesResolver:(e,t)=>t.list})({outline:0}),Cxe=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiMenu"}),{autoFocus:c=!0,children:f,className:_,disableAutoFocusItem:x=!1,MenuListProps:a={},onClose:I,open:D,PaperProps:O={},PopoverClasses:F,transitionDuration:Z="auto",TransitionProps:{onEntering:J,...re}={},variant:ne="selectedMenu",slots:G={},slotProps:Y={},...Q}=s,de=e0e(),Te={...s,autoFocus:c,disableAutoFocusItem:x,MenuListProps:a,onEntering:J,PaperProps:O,transitionDuration:Z,TransitionProps:re,variant:ne},we=Txe(Te),oe=c&&!x&&D,he=W.useRef(null),X=(Qt,kt)=>{he.current&&he.current.adjustStyleForScrollbar(Qt,{direction:de?"rtl":"ltr"}),J&&J(Qt,kt)},ge=Qt=>{Qt.key==="Tab"&&(Qt.preventDefault(),I&&I(Qt,"tabKeyDown"))};let be=-1;W.Children.map(f,(Qt,kt)=>{W.isValidElement(Qt)&&(Qt.props.disabled||(ne==="selectedMenu"&&Qt.props.selected||be===-1)&&(be=kt))});const ke=G.paper??Sxe,Ee=Y.paper??O,zt=US({elementType:G.root,externalSlotProps:Y.root,ownerState:Te,className:[we.root,_]}),Ut=US({elementType:ke,externalSlotProps:Ee,ownerState:Te,className:we.paper});return N.jsx(Exe,{onClose:I,anchorOrigin:{vertical:"bottom",horizontal:de?"right":"left"},transformOrigin:de?bxe:wxe,slots:{paper:ke,root:G.root},slotProps:{root:zt,paper:Ut},open:D,ref:r,transitionDuration:Z,TransitionProps:{onEntering:X,...re},ownerState:Te,...Q,classes:F,children:N.jsx(Ixe,{onKeyDown:ge,actions:he,autoFocus:c&&(be===-1||x),autoFocusItem:oe,variant:ne,...a,className:Mr(we.list,a.className),children:f})})});function Axe(e){return Si("MuiNativeSelect",e)}const PO=Ii("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),Pxe=e=>{const{classes:t,variant:r,disabled:s,multiple:c,open:f,error:_}=e,x={select:["select",r,s&&"disabled",c&&"multiple",_&&"error"],icon:["icon",`icon${Xn(r)}`,f&&"iconOpen",s&&"disabled"]};return Ri(x,Axe,t)},vH=Kn("select")(({theme:e})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${PO.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(e.vars||e).palette.background.paper},variants:[{props:({ownerState:t})=>t.variant!=="filled"&&t.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(e.vars||e).shape.borderRadius,"&:focus":{borderRadius:(e.vars||e).shape.borderRadius},"&&&":{paddingRight:32}}}]})),Rxe=Kn(vH,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Ga,overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.select,t[r.variant],r.error&&t.error,{[`&.${PO.multiple}`]:t.multiple}]}})({}),xH=Kn("svg")(({theme:e})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(e.vars||e).palette.action.active,[`&.${PO.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:({ownerState:t})=>t.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),Mxe=Kn(xH,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.icon,r.variant&&t[`icon${Xn(r.variant)}`],r.open&&t.iconOpen]}})({}),kxe=W.forwardRef(function(t,r){const{className:s,disabled:c,error:f,IconComponent:_,inputRef:x,variant:a="standard",...I}=t,D={...t,disabled:c,variant:a,error:f},O=Pxe(D);return N.jsxs(W.Fragment,{children:[N.jsx(Rxe,{ownerState:D,className:Mr(O.select,s),disabled:c,ref:x||r,...I}),t.multiple?null:N.jsx(Mxe,{as:_,ownerState:D,className:O.icon})]})});var IV;const Dxe=Kn("fieldset",{shouldForwardProp:Ga})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),Oxe=Kn("legend",{shouldForwardProp:Ga})(rs(({theme:e})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:t})=>!t.withLabel,style:{padding:0,lineHeight:"11px",transition:e.transitions.create("width",{duration:150,easing:e.transitions.easing.easeOut})}},{props:({ownerState:t})=>t.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:e.transitions.create("max-width",{duration:50,easing:e.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:t})=>t.withLabel&&t.notched,style:{maxWidth:"100%",transition:e.transitions.create("max-width",{duration:100,easing:e.transitions.easing.easeOut,delay:50})}}]})));function Lxe(e){const{children:t,classes:r,className:s,label:c,notched:f,..._}=e,x=c!=null&&c!=="",a={...e,notched:f,withLabel:x};return N.jsx(Dxe,{"aria-hidden":!0,className:s,ownerState:a,..._,children:N.jsx(Oxe,{ownerState:a,children:x?N.jsx("span",{children:c}):IV||(IV=N.jsx("span",{className:"notranslate",children:""}))})})}const zxe=e=>{const{classes:t}=e,s=Ri({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},Nve,t);return{...t,...s}},Nxe=Kn(WC,{shouldForwardProp:e=>Ga(e)||e==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:qC})(rs(({theme:e})=>{const t=e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(e.vars||e).shape.borderRadius,[`&:hover .${xu.notchedOutline}`]:{borderColor:(e.vars||e).palette.text.primary},[`&.${xu.focused} .${xu.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(e.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{[`&.${xu.focused} .${xu.notchedOutline}`]:{borderColor:(e.vars||e).palette[r].main}}})),{props:{},style:{"@media (hover: none)":{[`&:hover .${xu.notchedOutline}`]:{borderColor:e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:t}},[`&.${xu.error} .${xu.notchedOutline}`]:{borderColor:(e.vars||e).palette.error.main},[`&.${xu.disabled} .${xu.notchedOutline}`]:{borderColor:(e.vars||e).palette.action.disabled}}},{props:({ownerState:r})=>r.startAdornment,style:{paddingLeft:14}},{props:({ownerState:r})=>r.endAdornment,style:{paddingRight:14}},{props:({ownerState:r})=>r.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:r,size:s})=>r.multiline&&s==="small",style:{padding:"8.5px 14px"}}]}})),Fxe=Kn(Lxe,{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(e,t)=>t.notchedOutline})(rs(({theme:e})=>{const t=e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:t}})),Bxe=Kn(HC,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:GC})(rs(({theme:e})=>({padding:"16.5px 14px",...!e.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:e.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:e.palette.mode==="light"?null:"#fff",caretColor:e.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...e.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[e.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:t})=>t.multiline,style:{padding:0}},{props:({ownerState:t})=>t.startAdornment,style:{paddingLeft:0}},{props:({ownerState:t})=>t.endAdornment,style:{paddingRight:0}}]}))),XS=W.forwardRef(function(t,r){var s;const c=is({props:t,name:"MuiOutlinedInput"}),{components:f={},fullWidth:_=!1,inputComponent:x="input",label:a,multiline:I=!1,notched:D,slots:O={},type:F="text",...Z}=c,J=zxe(c),re=sd(),ne=Jf({props:c,muiFormControl:re,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),G={...c,color:ne.color||"primary",disabled:ne.disabled,error:ne.error,focused:ne.focused,formControl:re,fullWidth:_,hiddenLabel:ne.hiddenLabel,multiline:I,size:ne.size,type:F},Y=O.root??f.Root??Nxe,Q=O.input??f.Input??Bxe;return N.jsx(AO,{slots:{root:Y,input:Q},renderSuffix:de=>N.jsx(Fxe,{ownerState:G,className:J.notchedOutline,label:a!=null&&a!==""&&ne.required?s||(s=N.jsxs(W.Fragment,{children:[a,"","*"]})):a,notched:typeof D<"u"?D:!!(de.startAdornment||de.filled||de.focused)}),fullWidth:_,inputComponent:x,multiline:I,ref:r,type:F,...Z,classes:{...J,notchedOutline:null}})});XS&&(XS.muiName="Input");const jxe=id(N.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),Uxe=id(N.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Vxe=Kn("span",{shouldForwardProp:Ga})({position:"relative",display:"flex"}),$xe=Kn(jxe)({transform:"scale(1)"}),qxe=Kn(Uxe)(rs(({theme:e})=>({left:0,position:"absolute",transform:"scale(0)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.shortest})}}]})));function bH(e){const{checked:t=!1,classes:r={},fontSize:s}=e,c={...e,checked:t};return N.jsxs(Vxe,{className:r.root,ownerState:c,children:[N.jsx($xe,{fontSize:s,className:r.background,ownerState:c}),N.jsx(qxe,{fontSize:s,className:r.dot,ownerState:c})]})}const wH=W.createContext(void 0);function Gxe(){return W.useContext(wH)}function Wxe(e){return Si("MuiRadio",e)}const CV=Ii("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Hxe=e=>{const{classes:t,color:r,size:s}=e,c={root:["root",`color${Xn(r)}`,s!=="medium"&&`size${Xn(s)}`]};return{...t,...Ri(c,Wxe,t)}},Zxe=Kn(c1e,{shouldForwardProp:e=>Ga(e)||e==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.size!=="medium"&&t[`size${Xn(r.size)}`],t[`color${Xn(r.color)}`]]}})(rs(({theme:e})=>({color:(e.vars||e).palette.text.secondary,[`&.${CV.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:$l(e.palette.action.active,e.palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:$l(e.palette[t].main,e.palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t},style:{[`&.${CV.checked}`]:{color:(e.vars||e).palette[t].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function Xxe(e,t){return typeof t=="object"&&t!==null?e===t:String(e)===String(t)}const AV=N.jsx(bH,{checked:!0}),PV=N.jsx(bH,{}),Kxe=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiRadio"}),{checked:c,checkedIcon:f=AV,color:_="primary",icon:x=PV,name:a,onChange:I,size:D="medium",className:O,disableRipple:F=!1,...Z}=s,J={...s,disableRipple:F,color:_,size:D},re=Hxe(J),ne=Gxe();let G=c;const Y=Ok(I,ne&&ne.onChange);let Q=a;return ne&&(typeof G>"u"&&(G=Xxe(ne.value,s.value)),typeof Q>"u"&&(Q=ne.name)),N.jsx(Zxe,{type:"radio",icon:W.cloneElement(x,{fontSize:PV.props.fontSize??D}),checkedIcon:W.cloneElement(f,{fontSize:AV.props.fontSize??D}),ownerState:J,classes:re,name:Q,checked:G,onChange:Y,ref:r,className:Mr(re.root,O),...Z})});function Qxe(e){return Si("MuiRadioGroup",e)}Ii("MuiRadioGroup",["root","row","error"]);const Yxe=e=>{const{classes:t,row:r,error:s}=e;return Ri({root:["root",r&&"row",s&&"error"]},Qxe,t)},Jxe=W.forwardRef(function(t,r){const{actions:s,children:c,className:f,defaultValue:_,name:x,onChange:a,value:I,...D}=t,O=W.useRef(null),F=Yxe(t),[Z,J]=jS({controlled:I,default:_,name:"RadioGroup"});W.useImperativeHandle(s,()=>({focus:()=>{let Y=O.current.querySelector("input:not(:disabled):checked");Y||(Y=O.current.querySelector("input:not(:disabled)")),Y&&Y.focus()}}),[]);const re=Oo(r,O),ne=xO(x),G=W.useMemo(()=>({name:ne,onChange(Y){J(Y.target.value),a&&a(Y,Y.target.value)},value:Z}),[ne,a,J,Z]);return N.jsx(wH.Provider,{value:G,children:N.jsx(W1e,{role:"radiogroup",ref:re,className:Mr(F.root,f),...D,children:c})})});function ebe(e){return Si("MuiSelect",e)}const Zv=Ii("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var RV;const tbe=Kn(vH,{name:"MuiSelect",slot:"Select",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{[`&.${Zv.select}`]:t.select},{[`&.${Zv.select}`]:t[r.variant]},{[`&.${Zv.error}`]:t.error},{[`&.${Zv.multiple}`]:t.multiple}]}})({[`&.${Zv.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),nbe=Kn(xH,{name:"MuiSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.icon,r.variant&&t[`icon${Xn(r.variant)}`],r.open&&t.iconOpen]}})({}),rbe=Kn("input",{shouldForwardProp:e=>dH(e)&&e!=="classes",name:"MuiSelect",slot:"NativeInput",overridesResolver:(e,t)=>t.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function MV(e,t){return typeof t=="object"&&t!==null?e===t:String(e)===String(t)}function ibe(e){return e==null||typeof e=="string"&&!e.trim()}const sbe=e=>{const{classes:t,variant:r,disabled:s,multiple:c,open:f,error:_}=e,x={select:["select",r,s&&"disabled",c&&"multiple",_&&"error"],icon:["icon",`icon${Xn(r)}`,f&&"iconOpen",s&&"disabled"],nativeInput:["nativeInput"]};return Ri(x,ebe,t)},obe=W.forwardRef(function(t,r){var ss;const{"aria-describedby":s,"aria-label":c,autoFocus:f,autoWidth:_,children:x,className:a,defaultOpen:I,defaultValue:D,disabled:O,displayEmpty:F,error:Z=!1,IconComponent:J,inputRef:re,labelId:ne,MenuProps:G={},multiple:Y,name:Q,onBlur:de,onChange:Te,onClose:we,onFocus:oe,onOpen:he,open:X,readOnly:ge,renderValue:be,SelectDisplayProps:ke={},tabIndex:Ee,type:zt,value:Ut,variant:Qt="standard",...kt}=t,[ft,Rt]=jS({controlled:Ut,default:D,name:"Select"}),[Yt,ht]=jS({controlled:X,default:I,name:"Select"}),At=W.useRef(null),wt=W.useRef(null),[Xt,Ft]=W.useState(null),{current:Sn}=W.useRef(X!=null),[qn,Qn]=W.useState(),Gt=Oo(r,re),Cn=W.useCallback(Tn=>{wt.current=Tn,Tn&&Ft(Tn)},[]),hn=Xt==null?void 0:Xt.parentNode;W.useImperativeHandle(Gt,()=>({focus:()=>{wt.current.focus()},node:At.current,value:ft}),[ft]),W.useEffect(()=>{I&&Yt&&Xt&&!Sn&&(Qn(_?null:hn.clientWidth),wt.current.focus())},[Xt,_]),W.useEffect(()=>{f&&wt.current.focus()},[f]),W.useEffect(()=>{if(!ne)return;const Tn=ml(wt.current).getElementById(ne);if(Tn){const or=()=>{getSelection().isCollapsed&&wt.current.focus()};return Tn.addEventListener("click",or),()=>{Tn.removeEventListener("click",or)}}},[ne]);const Rn=(Tn,or)=>{Tn?he&&he(or):we&&we(or),Sn||(Qn(_?null:hn.clientWidth),ht(Tn))},Nr=Tn=>{Tn.button===0&&(Tn.preventDefault(),wt.current.focus(),Rn(!0,Tn))},jn=Tn=>{Rn(!1,Tn)},gr=W.Children.toArray(x),Fr=Tn=>{const or=gr.find(dn=>dn.props.value===Tn.target.value);or!==void 0&&(Rt(or.props.value),Te&&Te(Tn,or))},dr=Tn=>or=>{let dn;if(or.currentTarget.hasAttribute("tabindex")){if(Y){dn=Array.isArray(ft)?ft.slice():[];const Js=ft.indexOf(Tn.props.value);Js===-1?dn.push(Tn.props.value):dn.splice(Js,1)}else dn=Tn.props.value;if(Tn.props.onClick&&Tn.props.onClick(or),ft!==dn&&(Rt(dn),Te)){const Js=or.nativeEvent||or,Ai=new Js.constructor(Js.type,Js);Object.defineProperty(Ai,"target",{writable:!0,value:{value:dn,name:Q}}),Te(Ai,Tn)}Y||Rn(!1,or)}},rr=Tn=>{ge||[" ","ArrowUp","ArrowDown","Enter"].includes(Tn.key)&&(Tn.preventDefault(),Rn(!0,Tn))},Ue=Xt!==null&&Yt,Xe=Tn=>{!Ue&&de&&(Object.defineProperty(Tn,"target",{writable:!0,value:{value:ft,name:Q}}),de(Tn))};delete kt["aria-invalid"];let ut,Ye;const st=[];let Mt=!1;(WS({value:ft})||F)&&(be?ut=be(ft):Mt=!0);const an=gr.map(Tn=>{if(!W.isValidElement(Tn))return null;let or;if(Y){if(!Array.isArray(ft))throw new Error(Qh(2));or=ft.some(dn=>MV(dn,Tn.props.value)),or&&Mt&&st.push(Tn.props.children)}else or=MV(ft,Tn.props.value),or&&Mt&&(Ye=Tn.props.children);return W.cloneElement(Tn,{"aria-selected":or?"true":"false",onClick:dr(Tn),onKeyUp:dn=>{dn.key===" "&&dn.preventDefault(),Tn.props.onKeyUp&&Tn.props.onKeyUp(dn)},role:"option",selected:or,value:void 0,"data-value":Tn.props.value})});Mt&&(Y?st.length===0?ut=null:ut=st.reduce((Tn,or,dn)=>(Tn.push(or),dn<st.length-1&&Tn.push(", "),Tn),[]):ut=Ye);let qt=qn;!_&&Sn&&Xt&&(qt=hn.clientWidth);let mn;typeof Ee<"u"?mn=Ee:mn=O?null:0;const Ln=ke.id||(Q?`mui-component-select-${Q}`:void 0),fr={...t,variant:Qt,value:ft,open:Ue,error:Z},fi=sbe(fr),ir={...G.PaperProps,...(ss=G.slotProps)==null?void 0:ss.paper},Ci=xO();return N.jsxs(W.Fragment,{children:[N.jsx(tbe,{as:"div",ref:Cn,tabIndex:mn,role:"combobox","aria-controls":Ci,"aria-disabled":O?"true":void 0,"aria-expanded":Ue?"true":"false","aria-haspopup":"listbox","aria-label":c,"aria-labelledby":[ne,Ln].filter(Boolean).join(" ")||void 0,"aria-describedby":s,onKeyDown:rr,onMouseDown:O||ge?null:Nr,onBlur:Xe,onFocus:oe,...ke,ownerState:fr,className:Mr(ke.className,fi.select,a),id:Ln,children:ibe(ut)?RV||(RV=N.jsx("span",{className:"notranslate",children:""})):ut}),N.jsx(rbe,{"aria-invalid":Z,value:Array.isArray(ft)?ft.join(","):ft,name:Q,ref:At,"aria-hidden":!0,onChange:Fr,tabIndex:-1,disabled:O,className:fi.nativeInput,autoFocus:f,...kt,ownerState:fr}),N.jsx(nbe,{as:J,className:fi.icon,ownerState:fr}),N.jsx(Cxe,{id:`menu-${Q||""}`,anchorEl:hn,open:Ue,onClose:jn,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...G,MenuListProps:{"aria-labelledby":ne,role:"listbox","aria-multiselectable":Y?"true":void 0,disableListWrap:!0,id:Ci,...G.MenuListProps},slotProps:{...G.slotProps,paper:{...ir,style:{minWidth:qt,...ir!=null?ir.style:null}}},children:an})]})}),abe=e=>{const{classes:t}=e;return t},RO={name:"MuiSelect",overridesResolver:(e,t)=>t.root,shouldForwardProp:e=>Ga(e)&&e!=="variant",slot:"Root"},lbe=Kn(ZS,RO)(""),cbe=Kn(XS,RO)(""),ube=Kn(HS,RO)(""),TH=W.forwardRef(function(t,r){const s=j0e({name:"MuiSelect",props:t}),{autoWidth:c=!1,children:f,classes:_={},className:x,defaultOpen:a=!1,displayEmpty:I=!1,IconComponent:D=Bve,id:O,input:F,inputProps:Z,label:J,labelId:re,MenuProps:ne,multiple:G=!1,native:Y=!1,onClose:Q,onOpen:de,open:Te,renderValue:we,SelectDisplayProps:oe,variant:he="outlined",...X}=s,ge=Y?kxe:obe,be=sd(),ke=Jf({props:s,muiFormControl:be,states:["variant","error"]}),Ee=ke.variant||he,zt={...s,variant:Ee,classes:_},Ut=abe(zt),{root:Qt,...kt}=Ut,ft=F||{standard:N.jsx(lbe,{ownerState:zt}),outlined:N.jsx(cbe,{label:J,ownerState:zt}),filled:N.jsx(ube,{ownerState:zt})}[Ee],Rt=Oo(r,gb(ft));return N.jsx(W.Fragment,{children:W.cloneElement(ft,{inputComponent:ge,inputProps:{children:f,error:ke.error,IconComponent:D,variant:Ee,type:void 0,multiple:G,...Y?{id:O}:{autoWidth:c,defaultOpen:a,displayEmpty:I,labelId:re,MenuProps:ne,onClose:Q,onOpen:de,open:Te,renderValue:we,SelectDisplayProps:{id:O,...oe}},...Z,classes:Z?Qo(kt,Z.classes):kt,...F?F.props.inputProps:{}},...(G&&Y||I)&&Ee==="outlined"?{notched:!0}:{},ref:Rt,className:Mr(ft.props.className,x,Ut.root),...!F&&{variant:Ee},...X})})});TH.muiName="Select";function hbe(e){return Si("MuiTextField",e)}Ii("MuiTextField",["root"]);const dbe={standard:ZS,filled:HS,outlined:XS},fbe=e=>{const{classes:t}=e;return Ri({root:["root"]},hbe,t)},pbe=Kn(N1e,{name:"MuiTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),EH=W.forwardRef(function(t,r){const s=is({props:t,name:"MuiTextField"}),{autoComplete:c,autoFocus:f=!1,children:_,className:x,color:a="primary",defaultValue:I,disabled:D=!1,error:O=!1,FormHelperTextProps:F,fullWidth:Z=!1,helperText:J,id:re,InputLabelProps:ne,inputProps:G,InputProps:Y,inputRef:Q,label:de,maxRows:Te,minRows:we,multiline:oe=!1,name:he,onBlur:X,onChange:ge,onFocus:be,placeholder:ke,required:Ee=!1,rows:zt,select:Ut=!1,SelectProps:Qt,slots:kt={},slotProps:ft={},type:Rt,value:Yt,variant:ht="outlined",...At}=s,wt={...s,autoFocus:f,color:a,disabled:D,error:O,fullWidth:Z,multiline:oe,required:Ee,select:Ut,variant:ht},Xt=fbe(wt),Ft=xO(re),Sn=J&&Ft?`${Ft}-helper-text`:void 0,qn=de&&Ft?`${Ft}-label`:void 0,Qn=dbe[ht],Gt={slots:kt,slotProps:{input:Y,inputLabel:ne,htmlInput:G,formHelperText:F,select:Qt,...ft}},Cn={},hn=Gt.slotProps.inputLabel;ht==="outlined"&&(hn&&typeof hn.shrink<"u"&&(Cn.notched=hn.shrink),Cn.label=de),Ut&&((!Qt||!Qt.native)&&(Cn.id=void 0),Cn["aria-describedby"]=void 0);const[Rn,Nr]=ql("input",{elementType:Qn,externalForwardedProps:Gt,additionalProps:Cn,ownerState:wt}),[jn,gr]=ql("inputLabel",{elementType:cxe,externalForwardedProps:Gt,ownerState:wt}),[Fr,dr]=ql("htmlInput",{elementType:"input",externalForwardedProps:Gt,ownerState:wt}),[rr,Ue]=ql("formHelperText",{elementType:K1e,externalForwardedProps:Gt,ownerState:wt}),[Xe,ut]=ql("select",{elementType:TH,externalForwardedProps:Gt,ownerState:wt}),Ye=N.jsx(Rn,{"aria-describedby":Sn,autoComplete:c,autoFocus:f,defaultValue:I,fullWidth:Z,multiline:oe,name:he,rows:zt,maxRows:Te,minRows:we,type:Rt,value:Yt,id:Ft,inputRef:Q,onBlur:X,onChange:ge,onFocus:be,placeholder:ke,inputProps:dr,slots:{input:kt.htmlInput?Fr:void 0},...Nr});return N.jsxs(pbe,{className:Mr(Xt.root,x),disabled:D,error:O,fullWidth:Z,ref:r,required:Ee,color:a,variant:ht,ownerState:wt,...At,children:[de!=null&&de!==""&&N.jsx(jn,{htmlFor:Ft,id:qn,...gr,children:de}),Ut?N.jsx(Xe,{"aria-describedby":Sn,id:Ft,labelId:qn,value:Yt,input:Ye,...ut,children:_}):Ye,J&&N.jsx(rr,{id:Sn,...Ue,children:J})]})}),SH=id(N.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),kV=id([N.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),N.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt"),mbe=id(N.jsx("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2z"}),"Crop"),gbe=id(N.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),_be=id(N.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),ybe=id(N.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo"),vbe=W.createContext(null),xbe=W.createContext({}),bbe=W.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),wbe=typeof window<"u",Tbe=wbe?W.useLayoutEffect:W.useEffect;function IH(e){const t=W.useRef(null);return t.current===null&&(t.current=e()),t.current}class Ebe extends W.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=r.offsetHeight||0,s.width=r.offsetWidth||0,s.top=r.offsetTop,s.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Sbe({children:e,isPresent:t}){const r=W.useId(),s=W.useRef(null),c=W.useRef({width:0,height:0,top:0,left:0}),{nonce:f}=W.useContext(bbe);return W.useInsertionEffect(()=>{const{width:_,height:x,top:a,left:I}=c.current;if(t||!s.current||!_||!x)return;s.current.dataset.motionPopId=r;const D=document.createElement("style");return f&&(D.nonce=f),document.head.appendChild(D),D.sheet&&D.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${_}px !important;
            height: ${x}px !important;
            top: ${a}px !important;
            left: ${I}px !important;
          }
        `),()=>{document.head.removeChild(D)}},[t]),N.jsx(Ebe,{isPresent:t,childRef:s,sizeRef:c,children:W.cloneElement(e,{ref:s})})}const Ibe=({children:e,initial:t,isPresent:r,onExitComplete:s,custom:c,presenceAffectsLayout:f,mode:_})=>{const x=IH(Cbe),a=W.useId(),I=W.useMemo(()=>({id:a,initial:t,isPresent:r,custom:c,onExitComplete:D=>{x.set(D,!0);for(const O of x.values())if(!O)return;s&&s()},register:D=>(x.set(D,!1),()=>x.delete(D))}),f?[Math.random()]:[r]);return W.useMemo(()=>{x.forEach((D,O)=>x.set(O,!1))},[r]),W.useEffect(()=>{!r&&!x.size&&s&&s()},[r]),_==="popLayout"&&(e=N.jsx(Sbe,{isPresent:r,children:e})),N.jsx(vbe.Provider,{value:I,children:e})};function Cbe(){return new Map}const KT=e=>e.key||"";function DV(e){const t=[];return W.Children.forEach(e,r=>{W.isValidElement(r)&&t.push(r)}),t}const Abe=({children:e,exitBeforeEnter:t,custom:r,initial:s=!0,onExitComplete:c,presenceAffectsLayout:f=!0,mode:_="sync"})=>{const x=W.useMemo(()=>DV(e),[e]),a=x.map(KT),I=W.useRef(!0),D=W.useRef(x),O=IH(()=>new Map),[F,Z]=W.useState(x),[J,re]=W.useState(x);Tbe(()=>{I.current=!1,D.current=x;for(let Y=0;Y<J.length;Y++){const Q=KT(J[Y]);a.includes(Q)?O.delete(Q):O.get(Q)!==!0&&O.set(Q,!1)}},[J,a.length,a.join("-")]);const ne=[];if(x!==F){let Y=[...x];for(let Q=0;Q<J.length;Q++){const de=J[Q],Te=KT(de);a.includes(Te)||(Y.splice(Q,0,de),ne.push(de))}_==="wait"&&ne.length&&(Y=ne),re(DV(Y)),Z(x);return}const{forceRender:G}=W.useContext(xbe);return N.jsx(N.Fragment,{children:J.map(Y=>{const Q=KT(Y),de=x===J||a.includes(Q),Te=()=>{if(O.has(Q))O.set(Q,!0);else return;let we=!0;O.forEach(oe=>{oe||(we=!1)}),we&&(G==null||G(),re(D.current),c&&c())};return N.jsx(Ibe,{isPresent:de,initial:!I.current||s?void 0:!1,custom:de?void 0:r,presenceAffectsLayout:f,mode:_,onExitComplete:de?void 0:Te,children:Y},Q)})})};var MO=yb(),kr=e=>_b(e,MO),kO=yb();kr.write=e=>_b(e,kO);var ZC=yb();kr.onStart=e=>_b(e,ZC);var DO=yb();kr.onFrame=e=>_b(e,DO);var OO=yb();kr.onFinish=e=>_b(e,OO);var fy=[];kr.setTimeout=(e,t)=>{const r=kr.now()+t,s=()=>{const f=fy.findIndex(_=>_.cancel==s);~f&&fy.splice(f,1),gf-=~f?1:0},c={time:r,handler:e,cancel:s};return fy.splice(CH(r),0,c),gf+=1,AH(),c};var CH=e=>~(~fy.findIndex(t=>t.time>e)||~fy.length);kr.cancel=e=>{ZC.delete(e),DO.delete(e),OO.delete(e),MO.delete(e),kO.delete(e)};kr.sync=e=>{qk=!0,kr.batchedUpdates(e),qk=!1};kr.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function s(...c){t=c,kr.onStart(r)}return s.handler=e,s.cancel=()=>{ZC.delete(r),t=null},s};var LO=typeof window<"u"?window.requestAnimationFrame:()=>{};kr.use=e=>LO=e;kr.now=typeof performance<"u"?()=>performance.now():Date.now;kr.batchedUpdates=e=>e();kr.catch=console.error;kr.frameLoop="always";kr.advance=()=>{kr.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):RH()};var mf=-1,gf=0,qk=!1;function _b(e,t){qk?(t.delete(e),e(0)):(t.add(e),AH())}function AH(){mf<0&&(mf=0,kr.frameLoop!=="demand"&&LO(PH))}function Pbe(){mf=-1}function PH(){~mf&&(LO(PH),kr.batchedUpdates(RH))}function RH(){const e=mf;mf=kr.now();const t=CH(mf);if(t&&(MH(fy.splice(0,t),r=>r.handler()),gf-=t),!gf){Pbe();return}ZC.flush(),MO.flush(e?Math.min(64,mf-e):16.667),DO.flush(),kO.flush(),OO.flush()}function yb(){let e=new Set,t=e;return{add(r){gf+=t==e&&!e.has(r)?1:0,e.add(r)},delete(r){return gf-=t==e&&e.has(r)?1:0,e.delete(r)},flush(r){t.size&&(e=new Set,gf-=t.size,MH(t,s=>s(r)&&e.add(s)),gf+=e.size,t=e)}}}function MH(e,t){e.forEach(r=>{try{t(r)}catch(s){kr.catch(s)}})}var Rbe=Object.defineProperty,Mbe=(e,t)=>{for(var r in t)Rbe(e,r,{get:t[r],enumerable:!0})},qc={};Mbe(qc,{assign:()=>Dbe,colors:()=>Mf,createStringInterpolator:()=>NO,skipAnimation:()=>DH,to:()=>kH,willAdvance:()=>FO});function Gk(){}var kbe=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),gn={arr:Array.isArray,obj:e=>!!e&&e.constructor.name==="Object",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",und:e=>e===void 0};function Ch(e,t){if(gn.arr(e)){if(!gn.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}var Yr=(e,t)=>e.forEach(t);function $u(e,t,r){if(gn.arr(e)){for(let s=0;s<e.length;s++)t.call(r,e[s],`${s}`);return}for(const s in e)e.hasOwnProperty(s)&&t.call(r,e[s],s)}var ul=e=>gn.und(e)?[]:gn.arr(e)?e:[e];function B1(e,t){if(e.size){const r=Array.from(e);e.clear(),Yr(r,t)}}var f1=(e,...t)=>B1(e,r=>r(...t)),zO=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),NO,kH,Mf=null,DH=!1,FO=Gk,Dbe=e=>{e.to&&(kH=e.to),e.now&&(kr.now=e.now),e.colors!==void 0&&(Mf=e.colors),e.skipAnimation!=null&&(DH=e.skipAnimation),e.createStringInterpolator&&(NO=e.createStringInterpolator),e.requestAnimationFrame&&kr.use(e.requestAnimationFrame),e.batchedUpdates&&(kr.batchedUpdates=e.batchedUpdates),e.willAdvance&&(FO=e.willAdvance),e.frameLoop&&(kr.frameLoop=e.frameLoop)},j1=new Set,Gl=[],kR=[],KS=0,XC={get idle(){return!j1.size&&!Gl.length},start(e){KS>e.priority?(j1.add(e),kr.onStart(Obe)):(OH(e),kr(Wk))},advance:Wk,sort(e){if(KS)kr.onFrame(()=>XC.sort(e));else{const t=Gl.indexOf(e);~t&&(Gl.splice(t,1),LH(e))}},clear(){Gl=[],j1.clear()}};function Obe(){j1.forEach(OH),j1.clear(),kr(Wk)}function OH(e){Gl.includes(e)||LH(e)}function LH(e){Gl.splice(Lbe(Gl,t=>t.priority>e.priority),0,e)}function Wk(e){const t=kR;for(let r=0;r<Gl.length;r++){const s=Gl[r];KS=s.priority,s.idle||(FO(s),s.advance(e),s.idle||t.push(s))}return KS=0,kR=Gl,kR.length=0,Gl=t,Gl.length>0}function Lbe(e,t){const r=e.findIndex(t);return r<0?e.length:r}var zbe=(e,t,r)=>Math.min(Math.max(r,e),t),Nbe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Nc="[-+]?\\d*\\.?\\d+",QS=Nc+"%";function KC(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}var Fbe=new RegExp("rgb"+KC(Nc,Nc,Nc)),Bbe=new RegExp("rgba"+KC(Nc,Nc,Nc,Nc)),jbe=new RegExp("hsl"+KC(Nc,QS,QS)),Ube=new RegExp("hsla"+KC(Nc,QS,QS,Nc)),Vbe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,$be=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,qbe=/^#([0-9a-fA-F]{6})$/,Gbe=/^#([0-9a-fA-F]{8})$/;function Wbe(e){let t;return typeof e=="number"?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=qbe.exec(e))?parseInt(t[1]+"ff",16)>>>0:Mf&&Mf[e]!==void 0?Mf[e]:(t=Fbe.exec(e))?(C_(t[1])<<24|C_(t[2])<<16|C_(t[3])<<8|255)>>>0:(t=Bbe.exec(e))?(C_(t[1])<<24|C_(t[2])<<16|C_(t[3])<<8|zV(t[4]))>>>0:(t=Vbe.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=Gbe.exec(e))?parseInt(t[1],16)>>>0:(t=$be.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=jbe.exec(e))?(OV(LV(t[1]),QT(t[2]),QT(t[3]))|255)>>>0:(t=Ube.exec(e))?(OV(LV(t[1]),QT(t[2]),QT(t[3]))|zV(t[4]))>>>0:null}function DR(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function OV(e,t,r){const s=r<.5?r*(1+t):r+t-r*t,c=2*r-s,f=DR(c,s,e+1/3),_=DR(c,s,e),x=DR(c,s,e-1/3);return Math.round(f*255)<<24|Math.round(_*255)<<16|Math.round(x*255)<<8}function C_(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function LV(e){return(parseFloat(e)%360+360)%360/360}function zV(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(t*255)}function QT(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function NV(e){let t=Wbe(e);if(t===null)return e;t=t||0;const r=(t&4278190080)>>>24,s=(t&16711680)>>>16,c=(t&65280)>>>8,f=(t&255)/255;return`rgba(${r}, ${s}, ${c}, ${f})`}var Rx=(e,t,r)=>{if(gn.fun(e))return e;if(gn.arr(e))return Rx({range:e,output:t,extrapolate:r});if(gn.str(e.output[0]))return NO(e);const s=e,c=s.output,f=s.range||[0,1],_=s.extrapolateLeft||s.extrapolate||"extend",x=s.extrapolateRight||s.extrapolate||"extend",a=s.easing||(I=>I);return I=>{const D=Zbe(I,f);return Hbe(I,f[D],f[D+1],c[D],c[D+1],a,_,x,s.map)}};function Hbe(e,t,r,s,c,f,_,x,a){let I=a?a(e):e;if(I<t){if(_==="identity")return I;_==="clamp"&&(I=t)}if(I>r){if(x==="identity")return I;x==="clamp"&&(I=r)}return s===c?s:t===r?e<=t?s:c:(t===-1/0?I=-I:r===1/0?I=I-t:I=(I-t)/(r-t),I=f(I),s===-1/0?I=-I:c===1/0?I=I+s:I=I*(c-s)+s,I)}function Zbe(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}var Xbe=(e,t="end")=>r=>{r=t==="end"?Math.min(r,.999):Math.max(r,.001);const s=r*e,c=t==="end"?Math.floor(s):Math.ceil(s);return zbe(0,1,c/e)},YS=1.70158,YT=YS*1.525,FV=YS+1,BV=2*Math.PI/3,jV=2*Math.PI/4.5,JT=e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,Kbe={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e===0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e===1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>FV*e*e*e-YS*e*e,easeOutBack:e=>1+FV*Math.pow(e-1,3)+YS*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*((YT+1)*2*e-YT)/2:(Math.pow(2*e-2,2)*((YT+1)*(e*2-2)+YT)+2)/2,easeInElastic:e=>e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*BV),easeOutElastic:e=>e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*BV)+1,easeInOutElastic:e=>e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*jV))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*jV)/2+1,easeInBounce:e=>1-JT(1-e),easeOutBounce:JT,easeInOutBounce:e=>e<.5?(1-JT(1-2*e))/2:(1+JT(2*e-1))/2,steps:Xbe},Mx=Symbol.for("FluidValue.get"),Ny=Symbol.for("FluidValue.observers"),Vl=e=>!!(e&&e[Mx]),Oa=e=>e&&e[Mx]?e[Mx]():e,UV=e=>e[Ny]||null;function Qbe(e,t){e.eventObserved?e.eventObserved(t):e(t)}function kx(e,t){const r=e[Ny];r&&r.forEach(s=>{Qbe(s,t)})}var zH=class{constructor(e){if(!e&&!(e=this.get))throw Error("Unknown getter");Ybe(this,e)}},Ybe=(e,t)=>NH(e,Mx,t);function s0(e,t){if(e[Mx]){let r=e[Ny];r||NH(e,Ny,r=new Set),r.has(t)||(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function Dx(e,t){const r=e[Ny];if(r&&r.has(t)){const s=r.size-1;s?r.delete(t):e[Ny]=null,e.observerRemoved&&e.observerRemoved(s,t)}}var NH=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),RE=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Jbe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,VV=new RegExp(`(${RE.source})(%|[a-z]+)`,"i"),ewe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,QC=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,FH=e=>{const[t,r]=twe(e);if(!t||zO())return e;const s=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(s)return s.trim();if(r&&r.startsWith("--")){const c=window.getComputedStyle(document.documentElement).getPropertyValue(r);return c||e}else{if(r&&QC.test(r))return FH(r);if(r)return r}return e},twe=e=>{const t=QC.exec(e);if(!t)return[,];const[,r,s]=t;return[r,s]},OR,nwe=(e,t,r,s,c)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(s)}, ${c})`,BH=e=>{OR||(OR=Mf?new RegExp(`(${Object.keys(Mf).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map(f=>Oa(f).replace(QC,FH).replace(Jbe,NV).replace(OR,NV)),r=t.map(f=>f.match(RE).map(Number)),c=r[0].map((f,_)=>r.map(x=>{if(!(_ in x))throw Error('The arity of each "output" value must be equal');return x[_]})).map(f=>Rx({...e,output:f}));return f=>{var a;const _=!VV.test(t[0])&&((a=t.find(I=>VV.test(I)))==null?void 0:a.replace(RE,""));let x=0;return t[0].replace(RE,()=>`${c[x++](f)}${_||""}`).replace(ewe,nwe)}},BO="react-spring: ",jH=e=>{const t=e;let r=!1;if(typeof t!="function")throw new TypeError(`${BO}once requires a function parameter`);return(...s)=>{r||(t(...s),r=!0)}},rwe=jH(console.warn);function iwe(){rwe(`${BO}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var swe=jH(console.warn);function owe(){swe(`${BO}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function YC(e){return gn.str(e)&&(e[0]=="#"||/\d/.test(e)||!zO()&&QC.test(e)||e in(Mf||{}))}var jO=zO()?W.useEffect:W.useLayoutEffect,awe=()=>{const e=W.useRef(!1);return jO(()=>(e.current=!0,()=>{e.current=!1}),[]),e};function UH(){const e=W.useState()[1],t=awe();return()=>{t.current&&e(Math.random())}}function lwe(e,t){const[r]=W.useState(()=>({inputs:t,result:e()})),s=W.useRef(),c=s.current;let f=c;return f?t&&f.inputs&&cwe(t,f.inputs)||(f={inputs:t,result:e()}):f=r,W.useEffect(()=>{s.current=f,c==r&&(r.inputs=r.result=void 0)},[f]),f.result}function cwe(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}var VH=e=>W.useEffect(e,uwe),uwe=[];function $V(e){const t=W.useRef();return W.useEffect(()=>{t.current=e}),t.current}var Ox=Symbol.for("Animated:node"),hwe=e=>!!e&&e[Ox]===e,Eu=e=>e&&e[Ox],UO=(e,t)=>kbe(e,Ox,t),JC=e=>e&&e[Ox]&&e[Ox].getPayload(),$H=class{constructor(){UO(this,this)}getPayload(){return this.payload||[]}},vb=class extends $H{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,gn.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new vb(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return gn.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value===e?!1:(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,gn.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},Lx=class extends vb{constructor(e){super(0),this._string=null,this._toString=Rx({output:[e,e]})}static create(e){return new Lx(e)}getValue(){const e=this._string;return e??(this._string=this._toString(this._value))}setValue(e){if(gn.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else if(super.setValue(e))this._string=null;else return!1;return!0}reset(e){e&&(this._toString=Rx({output:[this.getValue(),e]})),this._value=0,super.reset()}},JS={dependencies:null},eA=class extends $H{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return $u(this.source,(r,s)=>{hwe(r)?t[s]=r.getValue(e):Vl(r)?t[s]=Oa(r):e||(t[s]=r)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&Yr(this.payload,e=>e.reset())}_makePayload(e){if(e){const t=new Set;return $u(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){JS.dependencies&&Vl(e)&&JS.dependencies.add(e);const t=JC(e);t&&Yr(t,r=>this.add(r))}},qH=class extends eA{constructor(e){super(e)}static create(e){return new qH(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const t=this.getPayload();return e.length==t.length?t.map((r,s)=>r.setValue(e[s])).some(Boolean):(super.setValue(e.map(dwe)),!0)}};function dwe(e){return(YC(e)?Lx:vb).create(e)}function Hk(e){const t=Eu(e);return t?t.constructor:gn.arr(e)?qH:YC(e)?Lx:vb}var qV=(e,t)=>{const r=!gn.fun(e)||e.prototype&&e.prototype.isReactComponent;return W.forwardRef((s,c)=>{const f=W.useRef(null),_=r&&W.useCallback(J=>{f.current=mwe(c,J)},[c]),[x,a]=pwe(s,t),I=UH(),D=()=>{const J=f.current;if(r&&!J)return;(J?t.applyAnimatedValues(J,x.getValue(!0)):!1)===!1&&I()},O=new fwe(D,a),F=W.useRef();jO(()=>(F.current=O,Yr(a,J=>s0(J,O)),()=>{F.current&&(Yr(F.current.deps,J=>Dx(J,F.current)),kr.cancel(F.current.update))})),W.useEffect(D,[]),VH(()=>()=>{const J=F.current;Yr(J.deps,re=>Dx(re,J))});const Z=t.getComponentProps(x.getValue());return W.createElement(e,{...Z,ref:_})})},fwe=class{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){e.type=="change"&&kr.write(this.update)}};function pwe(e,t){const r=new Set;return JS.dependencies=r,e.style&&(e={...e,style:t.createAnimatedStyle(e.style)}),e=new eA(e),JS.dependencies=null,[e,r]}function mwe(e,t){return e&&(gn.fun(e)?e(t):e.current=t),t}var GV=Symbol.for("AnimatedComponent"),gwe=(e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:r=c=>new eA(c),getComponentProps:s=c=>c}={})=>{const c={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:s},f=_=>{const x=WV(_)||"Anonymous";return gn.str(_)?_=f[_]||(f[_]=qV(_,c)):_=_[GV]||(_[GV]=qV(_,c)),_.displayName=`Animated(${x})`,_};return $u(e,(_,x)=>{gn.arr(e)&&(x=WV(_)),f[x]=f(_)}),{animated:f}},WV=e=>gn.str(e)?e:e&&gn.str(e.displayName)?e.displayName:gn.fun(e)&&e.name||null;function lm(e,...t){return gn.fun(e)?e(...t):e}var U1=(e,t)=>e===!0||!!(t&&e&&(gn.fun(e)?e(t):ul(e).includes(t))),GH=(e,t)=>gn.obj(e)?t&&e[t]:e,WH=(e,t)=>e.default===!0?e[t]:e.default?e.default[t]:void 0,_we=e=>e,VO=(e,t=_we)=>{let r=ywe;e.default&&e.default!==!0&&(e=e.default,r=Object.keys(e));const s={};for(const c of r){const f=t(e[c],c);gn.und(f)||(s[c]=f)}return s},ywe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],vwe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function xwe(e){const t={};let r=0;if($u(e,(s,c)=>{vwe[c]||(t[c]=s,r++)}),r)return t}function HH(e){const t=xwe(e);if(t){const r={to:t};return $u(e,(s,c)=>c in t||(r[c]=s)),r}return{...e}}function zx(e){return e=Oa(e),gn.arr(e)?e.map(zx):YC(e)?qc.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function bwe(e){for(const t in e)return!0;return!1}function Zk(e){return gn.fun(e)||gn.arr(e)&&gn.obj(e[0])}function wwe(e,t){var r;(r=e.ref)==null||r.delete(e),t==null||t.delete(e)}function Twe(e,t){var r;t&&e.ref!==t&&((r=e.ref)==null||r.delete(e),t.add(e),e.ref=t)}var Ewe={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},Xk={...Ewe.default,mass:1,damping:1,easing:Kbe.linear,clamp:!1},Swe=class{constructor(){this.velocity=0,Object.assign(this,Xk)}};function Iwe(e,t,r){r&&(r={...r},HV(r,t),t={...r,...t}),HV(e,t),Object.assign(e,t);for(const _ in Xk)e[_]==null&&(e[_]=Xk[_]);let{frequency:s,damping:c}=e;const{mass:f}=e;return gn.und(s)||(s<.01&&(s=.01),c<0&&(c=0),e.tension=Math.pow(2*Math.PI/s,2)*f,e.friction=4*Math.PI*c*f/s),e}function HV(e,t){if(!gn.und(t.decay))e.duration=void 0;else{const r=!gn.und(t.tension)||!gn.und(t.friction);(r||!gn.und(t.frequency)||!gn.und(t.damping)||!gn.und(t.mass))&&(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}}var ZV=[],Cwe=class{constructor(){this.changed=!1,this.values=ZV,this.toValues=null,this.fromValues=ZV,this.config=new Swe,this.immediate=!1}};function ZH(e,{key:t,props:r,defaultProps:s,state:c,actions:f}){return new Promise((_,x)=>{let a,I,D=U1(r.cancel??(s==null?void 0:s.cancel),t);if(D)Z();else{gn.und(r.pause)||(c.paused=U1(r.pause,t));let J=s==null?void 0:s.pause;J!==!0&&(J=c.paused||U1(J,t)),a=lm(r.delay||0,t),J?(c.resumeQueue.add(F),f.pause()):(f.resume(),F())}function O(){c.resumeQueue.add(F),c.timeouts.delete(I),I.cancel(),a=I.time-kr.now()}function F(){a>0&&!qc.skipAnimation?(c.delayed=!0,I=kr.setTimeout(Z,a),c.pauseQueue.add(O),c.timeouts.add(I)):Z()}function Z(){c.delayed&&(c.delayed=!1),c.pauseQueue.delete(O),c.timeouts.delete(I),e<=(c.cancelId||0)&&(D=!0);try{f.start({...r,callId:e,cancel:D},_)}catch(J){x(J)}}})}var $O=(e,t)=>t.length==1?t[0]:t.some(r=>r.cancelled)?py(e.get()):t.every(r=>r.noop)?XH(e.get()):Dc(e.get(),t.every(r=>r.finished)),XH=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),Dc=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),py=e=>({value:e,cancelled:!0,finished:!1});function KH(e,t,r,s){const{callId:c,parentId:f,onRest:_}=t,{asyncTo:x,promise:a}=r;return!f&&e===x&&!t.reset?a:r.promise=(async()=>{r.asyncId=c,r.asyncTo=e;const I=VO(t,(ne,G)=>G==="onRest"?void 0:ne);let D,O;const F=new Promise((ne,G)=>(D=ne,O=G)),Z=ne=>{const G=c<=(r.cancelId||0)&&py(s)||c!==r.asyncId&&Dc(s,!1);if(G)throw ne.result=G,O(ne),ne},J=(ne,G)=>{const Y=new XV,Q=new KV;return(async()=>{if(qc.skipAnimation)throw Nx(r),Q.result=Dc(s,!1),O(Q),Q;Z(Y);const de=gn.obj(ne)?{...ne}:{...G,to:ne};de.parentId=c,$u(I,(we,oe)=>{gn.und(de[oe])&&(de[oe]=we)});const Te=await s.start(de);return Z(Y),r.paused&&await new Promise(we=>{r.resumeQueue.add(we)}),Te})()};let re;if(qc.skipAnimation)return Nx(r),Dc(s,!1);try{let ne;gn.arr(e)?ne=(async G=>{for(const Y of G)await J(Y)})(e):ne=Promise.resolve(e(J,s.stop.bind(s))),await Promise.all([ne.then(D),F]),re=Dc(s.get(),!0,!1)}catch(ne){if(ne instanceof XV)re=ne.result;else if(ne instanceof KV)re=ne.result;else throw ne}finally{c==r.asyncId&&(r.asyncId=f,r.asyncTo=f?x:void 0,r.promise=f?a:void 0)}return gn.fun(_)&&kr.batchedUpdates(()=>{_(re,s,s.item)}),re})()}function Nx(e,t){B1(e.timeouts,r=>r.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}var XV=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},KV=class extends Error{constructor(){super("SkipAnimationSignal")}},Kk=e=>e instanceof qO,Awe=1,qO=class extends zH{constructor(){super(...arguments),this.id=Awe++,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=Eu(this);return e&&e.getValue()}to(...e){return qc.to(this,e)}interpolate(...e){return iwe(),qc.to(this,e)}toJSON(){return this.get()}observerAdded(e){e==1&&this._attach()}observerRemoved(e){e==0&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){kx(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||XC.sort(this),kx(this,{type:"priority",parent:this,priority:e})}},qm=Symbol.for("SpringPhase"),QH=1,Qk=2,Yk=4,LR=e=>(e[qm]&QH)>0,Jd=e=>(e[qm]&Qk)>0,Xv=e=>(e[qm]&Yk)>0,QV=(e,t)=>t?e[qm]|=Qk|QH:e[qm]&=~Qk,YV=(e,t)=>t?e[qm]|=Yk:e[qm]&=~Yk,Pwe=class extends qO{constructor(e,t){if(super(),this.animation=new Cwe,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!gn.und(e)||!gn.und(t)){const r=gn.obj(e)?{...e}:{...t,from:e};gn.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(Jd(this)||this._state.asyncTo)||Xv(this)}get goal(){return Oa(this.animation.to)}get velocity(){const e=Eu(this);return e instanceof vb?e.lastVelocity||0:e.getPayload().map(t=>t.lastVelocity||0)}get hasAnimated(){return LR(this)}get isAnimating(){return Jd(this)}get isPaused(){return Xv(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1;const s=this.animation;let{toValues:c}=s;const{config:f}=s,_=JC(s.to);!_&&Vl(s.to)&&(c=ul(Oa(s.to))),s.values.forEach((I,D)=>{if(I.done)return;const O=I.constructor==Lx?1:_?_[D].lastPosition:c[D];let F=s.immediate,Z=O;if(!F){if(Z=I.lastPosition,f.tension<=0){I.done=!0;return}let J=I.elapsedTime+=e;const re=s.fromValues[D],ne=I.v0!=null?I.v0:I.v0=gn.arr(f.velocity)?f.velocity[D]:f.velocity;let G;const Y=f.precision||(re==O?.005:Math.min(1,Math.abs(O-re)*.001));if(gn.und(f.duration))if(f.decay){const Q=f.decay===!0?.998:f.decay,de=Math.exp(-(1-Q)*J);Z=re+ne/(1-Q)*(1-de),F=Math.abs(I.lastPosition-Z)<=Y,G=ne*de}else{G=I.lastVelocity==null?ne:I.lastVelocity;const Q=f.restVelocity||Y/10,de=f.clamp?0:f.bounce,Te=!gn.und(de),we=re==O?I.v0>0:re<O;let oe,he=!1;const X=1,ge=Math.ceil(e/X);for(let be=0;be<ge&&(oe=Math.abs(G)>Q,!(!oe&&(F=Math.abs(O-Z)<=Y,F)));++be){Te&&(he=Z==O||Z>O==we,he&&(G=-G*de,Z=O));const ke=-f.tension*1e-6*(Z-O),Ee=-f.friction*.001*G,zt=(ke+Ee)/f.mass;G=G+zt*X,Z=Z+G*X}}else{let Q=1;f.duration>0&&(this._memoizedDuration!==f.duration&&(this._memoizedDuration=f.duration,I.durationProgress>0&&(I.elapsedTime=f.duration*I.durationProgress,J=I.elapsedTime+=e)),Q=(f.progress||0)+J/this._memoizedDuration,Q=Q>1?1:Q<0?0:Q,I.durationProgress=Q),Z=re+f.easing(Q)*(O-re),G=(Z-I.lastPosition)/e,F=Q==1}I.lastVelocity=G,Number.isNaN(Z)&&(console.warn("Got NaN while animating:",this),F=!0)}_&&!_[D].done&&(F=!1),F?I.done=!0:t=!1,I.setValue(Z,f.round)&&(r=!0)});const x=Eu(this),a=x.getValue();if(t){const I=Oa(s.to);(a!==I||r)&&!f.decay?(x.setValue(I),this._onChange(I)):r&&f.decay&&this._onChange(a),this._stop()}else r&&this._onChange(a)}set(e){return kr.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Jd(this)){const{to:e,config:t}=this.animation;kr.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return gn.und(e)?(r=this.queue||[],this.queue=[]):r=[gn.obj(e)?e:{...t,to:e}],Promise.all(r.map(s=>this._update(s))).then(s=>$O(this,s))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),Nx(this._state,e&&this._lastCallId),kr.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){e.type=="change"?this._start():e.type=="priority"&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:r,from:s}=e;r=gn.obj(r)?r[t]:r,(r==null||Zk(r))&&(r=void 0),s=gn.obj(s)?s[t]:s,s==null&&(s=void 0);const c={to:r,from:s};return LR(this)||(e.reverse&&([r,s]=[s,r]),s=Oa(s),gn.und(s)?Eu(this)||this._set(r):this._set(s)),c}_update({...e},t){const{key:r,defaultProps:s}=this;e.default&&Object.assign(s,VO(e,(_,x)=>/^on/.test(x)?GH(_,r):_)),e8(this,e,"onProps"),Qv(this,"onProps",e,this);const c=this._prepareNode(e);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const f=this._state;return ZH(++this._lastCallId,{key:r,props:e,defaultProps:s,state:f,actions:{pause:()=>{Xv(this)||(YV(this,!0),f1(f.pauseQueue),Qv(this,"onPause",Dc(this,Kv(this,this.animation.to)),this))},resume:()=>{Xv(this)&&(YV(this,!1),Jd(this)&&this._resume(),f1(f.resumeQueue),Qv(this,"onResume",Dc(this,Kv(this,this.animation.to)),this))},start:this._merge.bind(this,c)}}).then(_=>{if(e.loop&&_.finished&&!(t&&_.noop)){const x=YH(e);if(x)return this._update(x,!0)}return _})}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(py(this));const s=!gn.und(e.to),c=!gn.und(e.from);if(s||c)if(t.callId>this._lastToId)this._lastToId=t.callId;else return r(py(this));const{key:f,defaultProps:_,animation:x}=this,{to:a,from:I}=x;let{to:D=a,from:O=I}=e;c&&!s&&(!t.default||gn.und(D))&&(D=O),t.reverse&&([D,O]=[O,D]);const F=!Ch(O,I);F&&(x.from=O),O=Oa(O);const Z=!Ch(D,a);Z&&this._focus(D);const J=Zk(t.to),{config:re}=x,{decay:ne,velocity:G}=re;(s||c)&&(re.velocity=0),t.config&&!J&&Iwe(re,lm(t.config,f),t.config!==_.config?lm(_.config,f):void 0);let Y=Eu(this);if(!Y||gn.und(D))return r(Dc(this,!0));const Q=gn.und(t.reset)?c&&!t.default:!gn.und(O)&&U1(t.reset,f),de=Q?O:this.get(),Te=zx(D),we=gn.num(Te)||gn.arr(Te)||YC(Te),oe=!J&&(!we||U1(_.immediate||t.immediate,f));if(Z){const be=Hk(D);if(be!==Y.constructor)if(oe)Y=this._set(Te);else throw Error(`Cannot animate between ${Y.constructor.name} and ${be.name}, as the "to" prop suggests`)}const he=Y.constructor;let X=Vl(D),ge=!1;if(!X){const be=Q||!LR(this)&&F;(Z||be)&&(ge=Ch(zx(de),Te),X=!ge),(!Ch(x.immediate,oe)&&!oe||!Ch(re.decay,ne)||!Ch(re.velocity,G))&&(X=!0)}if(ge&&Jd(this)&&(x.changed&&!Q?X=!0:X||this._stop(a)),!J&&((X||Vl(a))&&(x.values=Y.getPayload(),x.toValues=Vl(D)?null:he==Lx?[1]:ul(Te)),x.immediate!=oe&&(x.immediate=oe,!oe&&!Q&&this._set(a)),X)){const{onRest:be}=x;Yr(Mwe,Ee=>e8(this,t,Ee));const ke=Dc(this,Kv(this,a));f1(this._pendingCalls,ke),this._pendingCalls.add(r),x.changed&&kr.batchedUpdates(()=>{var Ee;x.changed=!Q,be==null||be(ke,this),Q?lm(_.onRest,ke):(Ee=x.onStart)==null||Ee.call(x,ke,this)})}Q&&this._set(de),J?r(KH(t.to,t,this._state,this)):X?this._start():Jd(this)&&!Z?this._pendingCalls.add(r):r(XH(de))}_focus(e){const t=this.animation;e!==t.to&&(UV(this)&&this._detach(),t.to=e,UV(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;Vl(t)&&(s0(t,this),Kk(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;Vl(e)&&Dx(e,this)}_set(e,t=!0){const r=Oa(e);if(!gn.und(r)){const s=Eu(this);if(!s||!Ch(r,s.getValue())){const c=Hk(r);!s||s.constructor!=c?UO(this,c.create(r)):s.setValue(r),s&&kr.batchedUpdates(()=>{this._onChange(r,t)})}}return Eu(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,Qv(this,"onStart",Dc(this,Kv(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),lm(this.animation.onChange,e,this)),lm(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;Eu(this).reset(Oa(e.to)),e.immediate||(e.fromValues=e.values.map(t=>t.lastPosition)),Jd(this)||(QV(this,!0),Xv(this)||this._resume())}_resume(){qc.skipAnimation?this.finish():XC.start(this)}_stop(e,t){if(Jd(this)){QV(this,!1);const r=this.animation;Yr(r.values,c=>{c.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),kx(this,{type:"idle",parent:this});const s=t?py(this.get()):Dc(this.get(),Kv(this,e??r.to));f1(this._pendingCalls,s),r.changed&&(r.changed=!1,Qv(this,"onRest",s,this))}}};function Kv(e,t){const r=zx(t),s=zx(e.get());return Ch(s,r)}function YH(e,t=e.loop,r=e.to){const s=lm(t);if(s){const c=s!==!0&&HH(s),f=(c||e).reverse,_=!c||c.reset;return Fx({...e,loop:t,default:!1,pause:void 0,to:!f||Zk(r)?r:void 0,from:_?e.from:void 0,reset:_,...c})}}function Fx(e){const{to:t,from:r}=e=HH(e),s=new Set;return gn.obj(t)&&JV(t,s),gn.obj(r)&&JV(r,s),e.keys=s.size?Array.from(s):null,e}function Rwe(e){const t=Fx(e);return gn.und(t.default)&&(t.default=VO(t)),t}function JV(e,t){$u(e,(r,s)=>r!=null&&t.add(s))}var Mwe=["onStart","onRest","onChange","onPause","onResume"];function e8(e,t,r){e.animation[r]=t[r]!==WH(t,r)?GH(t[r],e.key):void 0}function Qv(e,t,...r){var s,c,f,_;(c=(s=e.animation)[t])==null||c.call(s,...r),(_=(f=e.defaultProps)[t])==null||_.call(f,...r)}var kwe=["onStart","onChange","onRest"],Dwe=1,Owe=class{constructor(t,r){this.id=Dwe++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),r&&(this._flush=r),t&&this.start({default:!0,...t})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(t=>t.idle&&!t.isDelayed&&!t.isPaused)}get item(){return this._item}set item(t){this._item=t}get(){const t={};return this.each((r,s)=>t[s]=r.get()),t}set(t){for(const r in t){const s=t[r];gn.und(s)||this.springs[r].set(s)}}update(t){return t&&this.queue.push(Fx(t)),this}start(t){let{queue:r}=this;return t?r=ul(t).map(Fx):this.queue=[],this._flush?this._flush(this,r):(rZ(this,r),Jk(this,r))}stop(t,r){if(t!==!!t&&(r=t),r){const s=this.springs;Yr(ul(r),c=>s[c].stop(!!t))}else Nx(this._state,this._lastAsyncId),this.each(s=>s.stop(!!t));return this}pause(t){if(gn.und(t))this.start({pause:!0});else{const r=this.springs;Yr(ul(t),s=>r[s].pause())}return this}resume(t){if(gn.und(t))this.start({pause:!1});else{const r=this.springs;Yr(ul(t),s=>r[s].resume())}return this}each(t){$u(this.springs,t)}_onFrame(){const{onStart:t,onChange:r,onRest:s}=this._events,c=this._active.size>0,f=this._changed.size>0;(c&&!this._started||f&&!this._started)&&(this._started=!0,B1(t,([a,I])=>{I.value=this.get(),a(I,this,this._item)}));const _=!c&&this._started,x=f||_&&s.size?this.get():null;f&&r.size&&B1(r,([a,I])=>{I.value=x,a(I,this,this._item)}),_&&(this._started=!1,B1(s,([a,I])=>{I.value=x,a(I,this,this._item)}))}eventObserved(t){if(t.type=="change")this._changed.add(t.parent),t.idle||this._active.add(t.parent);else if(t.type=="idle")this._active.delete(t.parent);else return;kr.onFrame(this._onFrame)}};function Jk(e,t){return Promise.all(t.map(r=>JH(e,r))).then(r=>$O(e,r))}async function JH(e,t,r){const{keys:s,to:c,from:f,loop:_,onRest:x,onResolve:a}=t,I=gn.obj(t.default)&&t.default;_&&(t.loop=!1),c===!1&&(t.to=null),f===!1&&(t.from=null);const D=gn.arr(c)||gn.fun(c)?c:void 0;D?(t.to=void 0,t.onRest=void 0,I&&(I.onRest=void 0)):Yr(kwe,re=>{const ne=t[re];if(gn.fun(ne)){const G=e._events[re];t[re]=({finished:Y,cancelled:Q})=>{const de=G.get(ne);de?(Y||(de.finished=!1),Q&&(de.cancelled=!0)):G.set(ne,{value:null,finished:Y||!1,cancelled:Q||!1})},I&&(I[re]=t[re])}});const O=e._state;t.pause===!O.paused?(O.paused=t.pause,f1(t.pause?O.pauseQueue:O.resumeQueue)):O.paused&&(t.pause=!0);const F=(s||Object.keys(e.springs)).map(re=>e.springs[re].start(t)),Z=t.cancel===!0||WH(t,"cancel")===!0;(D||Z&&O.asyncId)&&F.push(ZH(++e._lastAsyncId,{props:t,state:O,actions:{pause:Gk,resume:Gk,start(re,ne){Z?(Nx(O,e._lastAsyncId),ne(py(e))):(re.onRest=x,ne(KH(D,re,O,e)))}}})),O.paused&&await new Promise(re=>{O.resumeQueue.add(re)});const J=$O(e,await Promise.all(F));if(_&&J.finished&&!(r&&J.noop)){const re=YH(t,_,c);if(re)return rZ(e,[re]),JH(e,re,!0)}return a&&kr.batchedUpdates(()=>a(J,e,e.item)),J}function t8(e,t){const r={...e.springs};return t&&Yr(ul(t),s=>{gn.und(s.keys)&&(s=Fx(s)),gn.obj(s.to)||(s={...s,to:void 0}),nZ(r,s,c=>tZ(c))}),eZ(e,r),r}function eZ(e,t){$u(t,(r,s)=>{e.springs[s]||(e.springs[s]=r,s0(r,e))})}function tZ(e,t){const r=new Pwe;return r.key=e,t&&s0(r,t),r}function nZ(e,t,r){t.keys&&Yr(t.keys,s=>{(e[s]||(e[s]=r(s)))._prepareNode(t)})}function rZ(e,t){Yr(t,r=>{nZ(e.springs,r,s=>tZ(s,e))})}var tA=({children:e,...t})=>{const r=W.useContext(eI),s=t.pause||!!r.pause,c=t.immediate||!!r.immediate;t=lwe(()=>({pause:s,immediate:c}),[s,c]);const{Provider:f}=eI;return W.createElement(f,{value:t},e)},eI=Lwe(tA,{});tA.Provider=eI.Provider;tA.Consumer=eI.Consumer;function Lwe(e,t){return Object.assign(e,W.createContext(t)),e.Provider._context=e,e.Consumer._context=e,e}var zwe=()=>{const e=[],t=function(s){owe();const c=[];return Yr(e,(f,_)=>{if(gn.und(s))c.push(f.start());else{const x=r(s,f,_);x&&c.push(f.start(x))}}),c};t.current=e,t.add=function(s){e.includes(s)||e.push(s)},t.delete=function(s){const c=e.indexOf(s);~c&&e.splice(c,1)},t.pause=function(){return Yr(e,s=>s.pause(...arguments)),this},t.resume=function(){return Yr(e,s=>s.resume(...arguments)),this},t.set=function(s){Yr(e,(c,f)=>{const _=gn.fun(s)?s(f,c):s;_&&c.set(_)})},t.start=function(s){const c=[];return Yr(e,(f,_)=>{if(gn.und(s))c.push(f.start());else{const x=this._getProps(s,f,_);x&&c.push(f.start(x))}}),c},t.stop=function(){return Yr(e,s=>s.stop(...arguments)),this},t.update=function(s){return Yr(e,(c,f)=>c.update(this._getProps(s,c,f))),this};const r=function(s,c,f){return gn.fun(s)?s(f,c):s};return t._getProps=r,t};function Nwe(e,t,r){const s=gn.fun(t)&&t;s&&!r&&(r=[]);const c=W.useMemo(()=>s||arguments.length==3?zwe():void 0,[]),f=W.useRef(0),_=UH(),x=W.useMemo(()=>({ctrls:[],queue:[],flush(G,Y){const Q=t8(G,Y);return f.current>0&&!x.queue.length&&!Object.keys(Q).some(Te=>!G.springs[Te])?Jk(G,Y):new Promise(Te=>{eZ(G,Q),x.queue.push(()=>{Te(Jk(G,Y))}),_()})}}),[]),a=W.useRef([...x.ctrls]),I=[],D=$V(e)||0;W.useMemo(()=>{Yr(a.current.slice(e,D),G=>{wwe(G,c),G.stop(!0)}),a.current.length=e,O(D,e)},[e]),W.useMemo(()=>{O(0,Math.min(D,e))},r);function O(G,Y){for(let Q=G;Q<Y;Q++){const de=a.current[Q]||(a.current[Q]=new Owe(null,x.flush)),Te=s?s(Q,de):t[Q];Te&&(I[Q]=Rwe(Te))}}const F=a.current.map((G,Y)=>t8(G,I[Y])),Z=W.useContext(tA),J=$V(Z),re=Z!==J&&bwe(Z);jO(()=>{f.current++,x.ctrls=a.current;const{queue:G}=x;G.length&&(x.queue=[],Yr(G,Y=>Y())),Yr(a.current,(Y,Q)=>{c==null||c.add(Y),re&&Y.start({default:Z});const de=I[Q];de&&(Twe(Y,de.ref),Y.ref?Y.queue.push(de):Y.start(de))})}),VH(()=>()=>{Yr(x.ctrls,G=>G.stop(!0))});const ne=F.map(G=>({...G}));return c?[ne,c]:ne}function xb(e,t){const r=gn.fun(e),[[s],c]=Nwe(1,r?e:[e],r?[]:t);return r||arguments.length==2?[s,c]:s}var Fwe=class extends qO{constructor(e,t){super(),this.source=e,this.idle=!0,this._active=new Set,this.calc=Rx(...t);const r=this._get(),s=Hk(r);UO(this,s.create(r))}advance(e){const t=this._get(),r=this.get();Ch(t,r)||(Eu(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&n8(this._active)&&zR(this)}_get(){const e=gn.arr(this.source)?this.source.map(Oa):ul(Oa(this.source));return this.calc(...e)}_start(){this.idle&&!n8(this._active)&&(this.idle=!1,Yr(JC(this),e=>{e.done=!1}),qc.skipAnimation?(kr.batchedUpdates(()=>this.advance()),zR(this)):XC.start(this))}_attach(){let e=1;Yr(ul(this.source),t=>{Vl(t)&&s0(t,this),Kk(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){Yr(ul(this.source),e=>{Vl(e)&&Dx(e,this)}),this._active.clear(),zR(this)}eventObserved(e){e.type=="change"?e.idle?this.advance():(this._active.add(e.parent),this._start()):e.type=="idle"?this._active.delete(e.parent):e.type=="priority"&&(this.priority=ul(this.source).reduce((t,r)=>Math.max(t,(Kk(r)?r.priority:0)+1),0))}};function Bwe(e){return e.idle!==!1}function n8(e){return!e.size||Array.from(e).every(Bwe)}function zR(e){e.idle||(e.idle=!0,Yr(JC(e),t=>{t.done=!0}),kx(e,{type:"idle",parent:e}))}qc.assign({createStringInterpolator:BH,to:(e,t)=>new Fwe(e,t)});var iZ=/^--/;function jwe(e,t){return t==null||typeof t=="boolean"||t===""?"":typeof t=="number"&&t!==0&&!iZ.test(e)&&!(V1.hasOwnProperty(e)&&V1[e])?t+"px":(""+t).trim()}var r8={};function Uwe(e,t){if(!e.nodeType||!e.setAttribute)return!1;const r=e.nodeName==="filter"||e.parentNode&&e.parentNode.nodeName==="filter",{style:s,children:c,scrollTop:f,scrollLeft:_,viewBox:x,...a}=t,I=Object.values(a),D=Object.keys(a).map(O=>r||e.hasAttribute(O)?O:r8[O]||(r8[O]=O.replace(/([A-Z])/g,F=>"-"+F.toLowerCase())));c!==void 0&&(e.textContent=c);for(const O in s)if(s.hasOwnProperty(O)){const F=jwe(O,s[O]);iZ.test(O)?e.style.setProperty(O,F):e.style[O]=F}D.forEach((O,F)=>{e.setAttribute(O,I[F])}),f!==void 0&&(e.scrollTop=f),_!==void 0&&(e.scrollLeft=_),x!==void 0&&e.setAttribute("viewBox",x)}var V1={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vwe=(e,t)=>e+t.charAt(0).toUpperCase()+t.substring(1),$we=["Webkit","Ms","Moz","O"];V1=Object.keys(V1).reduce((e,t)=>($we.forEach(r=>e[Vwe(r,t)]=e[t]),e),V1);var qwe=/^(matrix|translate|scale|rotate|skew)/,Gwe=/^(translate)/,Wwe=/^(rotate|skew)/,NR=(e,t)=>gn.num(e)&&e!==0?e+t:e,ME=(e,t)=>gn.arr(e)?e.every(r=>ME(r,t)):gn.num(e)?e===t:parseFloat(e)===t,Hwe=class extends eA{constructor({x:e,y:t,z:r,...s}){const c=[],f=[];(e||t||r)&&(c.push([e||0,t||0,r||0]),f.push(_=>[`translate3d(${_.map(x=>NR(x,"px")).join(",")})`,ME(_,0)])),$u(s,(_,x)=>{if(x==="transform")c.push([_||""]),f.push(a=>[a,a===""]);else if(qwe.test(x)){if(delete s[x],gn.und(_))return;const a=Gwe.test(x)?"px":Wwe.test(x)?"deg":"";c.push(ul(_)),f.push(x==="rotate3d"?([I,D,O,F])=>[`rotate3d(${I},${D},${O},${NR(F,a)})`,ME(F,0)]:I=>[`${x}(${I.map(D=>NR(D,a)).join(",")})`,ME(I,x.startsWith("scale")?1:0)])}}),c.length&&(s.transform=new Zwe(c,f)),super(s)}},Zwe=class extends zH{constructor(e,t){super(),this.inputs=e,this.transforms=t,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let e="",t=!0;return Yr(this.inputs,(r,s)=>{const c=Oa(r[0]),[f,_]=this.transforms[s](gn.arr(c)?c:r.map(Oa));e+=" "+f,t=t&&_}),t?"none":e}observerAdded(e){e==1&&Yr(this.inputs,t=>Yr(t,r=>Vl(r)&&s0(r,this)))}observerRemoved(e){e==0&&Yr(this.inputs,t=>Yr(t,r=>Vl(r)&&Dx(r,this)))}eventObserved(e){e.type=="change"&&(this._value=null),kx(this,e)}},Xwe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];qc.assign({batchedUpdates:II.unstable_batchedUpdates,createStringInterpolator:BH,colors:Nbe});var Kwe=gwe(Xwe,{applyAnimatedValues:Uwe,createAnimatedStyle:e=>new Hwe(e),getComponentProps:({scrollTop:e,scrollLeft:t,...r})=>r}),sZ=Kwe.animated;function e4(e,t){return e.map(function(r,s){return r+t[s]})}function GO(e,t){return e.map(function(r,s){return r-t[s]})}function t4(e){return Math.hypot.apply(Math,e)}function Qwe(e,t,r){var s=t4(t),c=s===0?0:1/s,f=r===0?0:1/r,_=f*s,x=t.map(function(D){return f*D}),a=t.map(function(D){return c*D}),I=t4(e);return{velocities:x,velocity:_,distance:I,direction:a}}function n4(e){return Math.sign?Math.sign(e):+(e>0)-+(e<0)||+e}function Ywe(e,t,r){return Math.max(t,Math.min(e,r))}function Jwe(e,t){return Math.pow(e,t*5)}function i8(e,t,r){return t===0||Math.abs(t)===1/0?Jwe(e,r):e*t*r/(t+r*e)}function s8(e,t,r,s){return s===void 0&&(s=.15),s===0?Ywe(e,t,r):e<t?-i8(t-e,r-t,s)+t:e>r?+i8(e-r,r-t,s)+r:e}function eTe(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function tTe(e,t,r){return t&&eTe(e.prototype,t),e}function ya(){return ya=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ya.apply(this,arguments)}function oZ(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function nTe(e,t){if(e==null)return{};var r={},s=Object.keys(e),c,f;for(f=0;f<s.length;f++)c=s[f],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function Sh(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rTe(e,t){if(e){if(typeof e=="string")return o8(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o8(e,t)}}function o8(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=e[r];return s}function nA(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=rTe(e))||t){r&&(e=r);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return r=e[Symbol.iterator](),r.next.bind(r)}function aZ(){}function lZ(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.length===0?aZ:t.length===1?t[0]:function(){for(var s,c=nA(t),f;!(f=c()).done;){var _=f.value;s=_.apply(this,arguments)||s}return s}}function uf(e,t){if(e===void 0){if(t===void 0)throw new Error("Must define fallback value if undefined is expected");e=t}return Array.isArray(e)?e:[e,e]}function a8(e){if(typeof e=="function"){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return e.apply(void 0,r)}else return e}function WO(e,t){e===void 0&&(e={});for(var r={},s=0,c=Object.entries(t);s<c.length;s++){var f=c[s],_=f[0],x=f[1];switch(typeof x){case"function":r[_]=x.call(r,e[_],_,e);break;case"object":r[_]=WO(e[_],x);break;case"boolean":x&&(r[_]=e[_]);break}}return r}function iTe(){try{return"constructor"in GestureEvent}catch{return!1}}function cZ(){return typeof window<"u"&&"ontouchstart"in window}function sTe(){return typeof window<"u"&&"onpointerdown"in window}function uZ(e){return"pointerId"in e?null:e.type==="touchend"?e.changedTouches:e.targetTouches}function hZ(e){return Array.from(uZ(e)).map(function(t){return t.identifier})}function l8(e){var t="buttons"in e?e.buttons:0,r=e.shiftKey,s=e.altKey,c=e.metaKey,f=e.ctrlKey;return{buttons:t,shiftKey:r,altKey:s,metaKey:c,ctrlKey:f}}var oTe=function(t){return t};function c8(e,t){t===void 0&&(t=oTe);var r=uZ(e),s=r?r[0]:e,c=s.clientX,f=s.clientY;return t([c,f])}var aTe=180,lTe=.15,cTe=.5,uTe=50,hTe=250,dTe={threshold:function(t){return t===void 0&&(t=0),uf(t)},rubberband:function(t){switch(t===void 0&&(t=0),t){case!0:return uf(lTe);case!1:return uf(0);default:return uf(t)}},enabled:function(t){return t===void 0&&(t=!0),t},triggerAllEvents:function(t){return t===void 0&&(t=!1),t},initial:function(t){return t===void 0&&(t=0),typeof t=="function"?t:uf(t)},transform:!0},dZ=ya({},dTe,{axis:!0,lockDirection:function(t){return t===void 0&&(t=!1),t},bounds:function(t){if(t===void 0&&(t={}),typeof t=="function")return function(O){return dZ.bounds(t(O))};var r=t,s=r.left,c=s===void 0?-1/0:s,f=r.right,_=f===void 0?1/0:f,x=r.top,a=x===void 0?-1/0:x,I=r.bottom,D=I===void 0?1/0:I;return[[c,_],[a,D]]}}),fTe=typeof window<"u"&&window.document&&window.document.createElement,pTe={enabled:function(t){return t===void 0&&(t=!0),t},domTarget:!0,window:function(e){function t(r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return e===void 0&&(e=fTe?window:void 0),e}),eventOptions:function(t){var r=t===void 0?{}:t,s=r.passive,c=s===void 0?!0:s,f=r.capture,_=f===void 0?!1:f;return{passive:c,capture:_}},transform:!0},mTe=ya({},dZ,{useTouch:function(t){t===void 0&&(t=!1);var r=cZ(),s=sTe();return!!(t&&r||r&&!s)},experimental_preventWindowScrollY:function(t){return t===void 0&&(t=!1),t},threshold:function(t,r,s){var c=s.filterTaps,f=c===void 0?!1:c,_=s.lockDirection,x=_===void 0?!1:_,a=s.axis,I=a===void 0?void 0:a,D=uf(t,f?3:x||I?1:0);return this.filterTaps=f,D},swipeVelocity:function(t){return t===void 0&&(t=cTe),uf(t)},swipeDistance:function(t){return t===void 0&&(t=uTe),uf(t)},swipeDuration:function(t){return t===void 0&&(t=hTe),t},delay:function(t){switch(t===void 0&&(t=0),t){case!0:return aTe;case!1:return 0;default:return t}}});function gTe(e){return e===void 0&&(e={}),WO(e,pTe)}function _Te(e){return e===void 0&&(e={}),WO(e,mTe)}function yTe(e){var t=e.domTarget,r=e.eventOptions,s=e.window,c=e.enabled,f=nTe(e,["domTarget","eventOptions","window","enabled"]),_=gTe({domTarget:t,eventOptions:r,window:s,enabled:c});return _.drag=_Te(f),_}function Yv(e){return ya({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_threshold:[0,0],_lastEventType:void 0,_dragStarted:!1,_dragPreventScroll:!1,_dragIsTap:!0,_dragDelayed:!1,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:aZ,canceled:!1,memo:void 0,args:void 0},e)}function fZ(){var e={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1,locked:!1},t=Yv({_pointerId:void 0,axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,tap:!1,swipe:[0,0]}),r=Yv({_pointerIds:[],da:[0,0],vdva:[0,0],origin:void 0,turns:0}),s=Yv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),c=Yv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),f=Yv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:e,drag:t,pinch:r,wheel:s,move:c,scroll:f}}var sm=new Map,vTe=function(t){return t},xTe=function(){function e(r,s){var c=this;s===void 0&&(s=[]),this.controller=r,this.args=s,this.debounced=!0,this.setTimeout=function(f,_){var x;_===void 0&&(_=140),clearTimeout(c.controller.timeouts[c.stateKey]);for(var a=arguments.length,I=new Array(a>2?a-2:0),D=2;D<a;D++)I[D-2]=arguments[D];c.controller.timeouts[c.stateKey]=(x=window).setTimeout.apply(x,[f,_].concat(I))},this.clearTimeout=function(){clearTimeout(c.controller.timeouts[c.stateKey])},this.fireGestureHandler=function(f){if(f===void 0&&(f=!1),c.state._blocked)return c.debounced||(c.state._active=!1,c.clean()),null;if(!f&&!c.state.intentional&&!c.config.triggerAllEvents)return null;if(c.state.intentional){var _=c.state.active,x=c.state._active;c.state.active=x,c.state.first=x&&!_,c.state.last=_&&!x,c.controller.state.shared[c.ingKey]=x}var a=c.controller.pointerIds.size||c.controller.touchIds.size,I=c.controller.state.shared.buttons>0||a>0,D=ya({},c.controller.state.shared,c.state,c.mapStateValues(c.state),{locked:!!document.pointerLockElement,touches:a,down:I}),O=c.handler(D);return c.state.memo=O!==void 0?O:c.state.memo,D},this.controller=r,this.args=s}var t=e.prototype;return t.updateSharedState=function(s){Object.assign(this.controller.state.shared,s)},t.updateGestureState=function(s){Object.assign(this.state,s)},t.checkIntentionality=function(s,c){return{_intentional:s,_blocked:!1}},t.getMovement=function(s){var c=this.config.rubberband,f=this.state,_=f._bounds,x=f._initial,a=f._active,I=f._intentional,D=f.lastOffset,O=f.movement,F=f._threshold,Z=this.getInternalMovement(s,this.state),J=I[0]===!1?u8(Z[0],F[0]):I[0],re=I[1]===!1?u8(Z[1],F[1]):I[1],ne=this.checkIntentionality([J,re],Z);if(ne._blocked)return ya({},ne,{_movement:Z,delta:[0,0]});var G=ne._intentional,Y=Z,Q=[G[0]!==!1?Z[0]-G[0]:0,G[1]!==!1?Z[1]-G[1]:0],de=e4(Q,D),Te=a?c:[0,0];return Q=h8(_,e4(Q,x),Te),ya({},ne,{intentional:G[0]!==!1||G[1]!==!1,_initial:x,_movement:Y,movement:Q,values:s,offset:h8(_,de,Te),delta:GO(Q,O)})},t.clean=function(){this.clearTimeout()},tTe(e,[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}},{key:"transform",get:function(){return this.config.transform||this.controller.config.transform||vTe}}]),e}();function u8(e,t){return Math.abs(e)>=t?n4(e)*t:!1}function h8(e,t,r){var s=t[0],c=t[1],f=r[0],_=r[1],x=e[0],a=x[0],I=x[1],D=e[1],O=D[0],F=D[1];return[s8(s,a,I,f),s8(c,O,F,_)]}function FR(e,t,r){var s=e.state,c=t.timeStamp,f=t.type,_=s.values,x=r?0:c-s.startTime;return{_lastEventType:f,event:t,timeStamp:c,elapsedTime:x,previous:_}}function bTe(e,t,r,s){var c=e.state,f=e.config,_=e.stateKey,x=e.args,a=e.transform,I=c.offset,D=r.timeStamp,O=f.initial,F=f.bounds,Z=f.threshold,J=GO(a(Z),a([0,0])).map(Math.abs),re=ya({},fZ()[_],{_active:!0,args:x,values:t,initial:t,_threshold:J,offset:I,lastOffset:I,startTime:D});return ya({},re,{_initial:a8(O,re),_bounds:a8(F,re)})}var wTe=function(t){var r=this;this.classes=t,this.pointerIds=new Set,this.touchIds=new Set,this.supportsTouchEvents=cZ(),this.supportsGestureEvents=iTe(),this.bind=function(){for(var s=arguments.length,c=new Array(s),f=0;f<s;f++)c[f]=arguments[f];for(var _={},x=nA(r.classes),a;!(a=x()).done;){var I=a.value;new I(r,c).addBindings(_)}var D=function(Z){bu(_,Z,function(J){return r.nativeRefs[Z](ya({},r.state.shared,{event:J,args:c}))})};for(var O in r.nativeRefs)D(O);return r.config.domTarget?ATe(r,_):PTe(r,_)},this.effect=function(){return r.config.domTarget&&r.bind(),r.clean},this.clean=function(){var s=mZ(r.config),c=r.config.eventOptions;s&&bb(s,pZ(r.domListeners),c),Object.values(r.timeouts).forEach(clearTimeout),STe(r)},this.classes=t,this.state=fZ(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function TTe(e,t){"pointerId"in t?e.pointerIds.add(t.pointerId):e.touchIds=new Set(hZ(t))}function ETe(e,t){"pointerId"in t?e.pointerIds.delete(t.pointerId):hZ(t).forEach(function(r){return e.touchIds.delete(r)})}function STe(e){var t=e.config,r=t.window,s=t.eventOptions,c=e.windowListeners;if(r){for(var f in c){var _=c[f];bb(r,_,s)}e.windowListeners={}}}function ITe(e,t,r){var s=e.config,c=e.windowListeners;r===void 0&&(r=s.eventOptions),s.window&&(bb(s.window,c[t],r),delete c[t])}function CTe(e,t,r,s){var c=e.config,f=e.windowListeners;r===void 0&&(r=[]),s===void 0&&(s=c.eventOptions),c.window&&(bb(c.window,f[t],s),gZ(c.window,f[t]=r,s))}function ATe(e,t){var r=e.config,s=e.domListeners,c=mZ(r);if(!c)throw new Error("domTarget must be defined");var f=r.eventOptions;bb(c,pZ(s),f);for(var _=0,x=Object.entries(t);_<x.length;_++){var a=x[_],I=a[0],D=a[1],O=I.slice(2).toLowerCase();s.push([O,lZ.apply(void 0,D)])}gZ(c,s,f)}function PTe(e,t){for(var r=e.config,s={},c=r.eventOptions.capture?"Capture":"",f=0,_=Object.entries(t);f<_.length;f++){var x=_[f],a=x[0],I=x[1],D=Array.isArray(I)?I:[I],O=a+c;s[O]=lZ.apply(void 0,D)}return s}function pZ(e){return e===void 0&&(e=[]),e.splice(0,e.length)}function mZ(e){var t=e.domTarget;return t&&"current"in t?t.current:t}function bu(e,t,r){e[t]||(e[t]=[]),e[t].push(r)}function gZ(e,t,r){t===void 0&&(t=[]),r===void 0&&(r={});for(var s=nA(t),c;!(c=s()).done;){var f=c.value,_=f[0],x=f[1];e.addEventListener(_,x,r)}}function bb(e,t,r){t===void 0&&(t=[]),r===void 0&&(r={});for(var s=nA(t),c;!(c=s()).done;){var f=c.value,_=f[0],x=f[1];e.removeEventListener(_,x,r)}}function RTe(e,t,r){r===void 0&&(r={});var s=kTe(e),c=Gr.useMemo(function(){return new wTe(s)},[]);return c.config=t,c.handlers=e,c.nativeRefs=r,Gr.useEffect(c.effect,[]),c.config.domTarget?MTe:c.bind}function MTe(){}function kTe(e){var t=new Set;return e.drag&&t.add(sm.get("drag")),e.wheel&&t.add(sm.get("wheel")),e.scroll&&t.add(sm.get("scroll")),e.move&&t.add(sm.get("move")),e.pinch&&t.add(sm.get("pinch")),e.hover&&t.add(sm.get("hover")),t}var DTe=function(e){oZ(t,e);function t(){return e.apply(this,arguments)||this}var r=t.prototype;return r.getInternalMovement=function(c,f){return GO(c,f.initial)},r.checkIntentionality=function(c,f){if(c[0]===!1&&c[1]===!1)return{_intentional:c,axis:this.state.axis};var _=f.map(Math.abs),x=_[0],a=_[1],I=this.state.axis||(x>a?"x":x<a?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:c,_blocked:!1,axis:I}:I?this.config.axis&&I!==this.config.axis?{_intentional:c,_blocked:!0,axis:I}:(c[I==="x"?1:0]=!1,{_intentional:c,_blocked:!1,axis:I}):{_intentional:[!1,!1],_blocked:!1,axis:I}},r.getKinematics=function(c,f){var _=this.getMovement(c);if(!_._blocked){var x=f.timeStamp-this.state.timeStamp;Object.assign(_,Qwe(_.movement,_.delta,x))}return _},r.mapStateValues=function(c){return{xy:c.values,vxvy:c.velocities}},t}(xTe),OTe=3;function d8(e){"persist"in e&&typeof e.persist=="function"&&e.persist()}var LTe=function(e){oZ(t,e);function t(){var s;return s=e.apply(this,arguments)||this,s.ingKey="dragging",s.stateKey="drag",s.setPointerCapture=function(c){if(!(s.config.useTouch||document.pointerLockElement)){var f=c.target,_=c.pointerId;f&&"setPointerCapture"in f&&f.setPointerCapture(_),s.updateGestureState({_dragTarget:f,_dragPointerId:_})}},s.releasePointerCapture=function(){if(!(s.config.useTouch||document.pointerLockElement)){var c=s.state,f=c._dragTarget,_=c._dragPointerId;if(_&&f&&"releasePointerCapture"in f&&(!("hasPointerCapture"in f)||f.hasPointerCapture(_)))try{f.releasePointerCapture(_)}catch{}}},s.preventScroll=function(c){s.state._dragPreventScroll&&c.cancelable&&c.preventDefault()},s.getEventId=function(c){return s.config.useTouch?c.changedTouches[0].identifier:c.pointerId},s.isValidEvent=function(c){return s.state._pointerId===s.getEventId(c)},s.shouldPreventWindowScrollY=s.config.experimental_preventWindowScrollY&&s.controller.supportsTouchEvents,s.setUpWindowScrollDetection=function(c){d8(c),CTe(s.controller,s.stateKey,[["touchmove",s.preventScroll],["touchend",s.clean.bind(Sh(s))],["touchcancel",s.clean.bind(Sh(s))]],{passive:!1}),s.setTimeout(s.startDrag.bind(Sh(s)),250,c)},s.setUpDelayedDragTrigger=function(c){s.state._dragDelayed=!0,d8(c),s.setTimeout(s.startDrag.bind(Sh(s)),s.config.delay,c)},s.setStartState=function(c){var f=c8(c,s.transform);s.updateSharedState(l8(c)),s.updateGestureState(ya({},bTe(Sh(s),f,c),FR(Sh(s),c,!0),{_pointerId:s.getEventId(c)})),s.updateGestureState(s.getMovement(f))},s.onDragStart=function(c){TTe(s.controller,c),!(!s.enabled||s.state._active)&&(s.setStartState(c),s.setPointerCapture(c),s.shouldPreventWindowScrollY?s.setUpWindowScrollDetection(c):s.config.delay>0?s.setUpDelayedDragTrigger(c):s.startDrag(c,!0))},s.onDragChange=function(c){if(!(s.state.canceled||!s.state._active||!s.isValidEvent(c)||s.state._lastEventType===c.type&&c.timeStamp===s.state.timeStamp)){var f;if(document.pointerLockElement){var _=c.movementX,x=c.movementY;f=e4(s.transform([_,x]),s.state.values)}else f=c8(c,s.transform);var a=s.getKinematics(f,c);if(!s.state._dragStarted){if(s.state._dragDelayed){s.startDrag(c);return}if(s.shouldPreventWindowScrollY)if(!s.state._dragPreventScroll&&a.axis)if(a.axis==="x")s.startDrag(c);else{s.state._active=!1;return}else return;else return}var I=l8(c);s.updateSharedState(I);var D=FR(Sh(s),c),O=t4(a._movement),F=s.state._dragIsTap;F&&O>=OTe&&(F=!1),s.updateGestureState(ya({},D,a,{_dragIsTap:F})),s.fireGestureHandler()}},s.onDragEnd=function(c){if(ETe(s.controller,c),!!s.isValidEvent(c)&&(s.clean(),!!s.state._active)){s.state._active=!1;var f=s.state._dragIsTap,_=s.state.velocities,x=_[0],a=_[1],I=s.state.movement,D=I[0],O=I[1],F=s.state._intentional,Z=F[0],J=F[1],re=s.config.swipeVelocity,ne=re[0],G=re[1],Y=s.config.swipeDistance,Q=Y[0],de=Y[1],Te=s.config.swipeDuration,we=ya({},FR(Sh(s),c),s.getMovement(s.state.values)),oe=[0,0];we.elapsedTime<Te&&(Z!==!1&&Math.abs(x)>ne&&Math.abs(D)>Q&&(oe[0]=n4(x)),J!==!1&&Math.abs(a)>G&&Math.abs(O)>de&&(oe[1]=n4(a))),s.updateSharedState({buttons:0}),s.updateGestureState(ya({},we,{tap:f,swipe:oe})),s.fireGestureHandler(s.config.filterTaps&&f===!0)}},s.clean=function(){e.prototype.clean.call(Sh(s)),s.state._dragStarted=!1,s.releasePointerCapture(),ITe(s.controller,s.stateKey)},s.onCancel=function(){s.state.canceled||(s.updateGestureState({canceled:!0,_active:!1}),s.updateSharedState({buttons:0}),setTimeout(function(){return s.fireGestureHandler()},0))},s.onClick=function(c){s.state._dragIsTap||c.stopPropagation()},s}var r=t.prototype;return r.startDrag=function(c,f){f===void 0&&(f=!1),!(!this.state._active||this.state._dragStarted)&&(f||this.setStartState(c),this.updateGestureState({_dragStarted:!0,_dragPreventScroll:!0,cancel:this.onCancel}),this.clearTimeout(),this.fireGestureHandler())},r.addBindings=function(c){if(this.config.useTouch?(bu(c,"onTouchStart",this.onDragStart),bu(c,"onTouchMove",this.onDragChange),bu(c,"onTouchEnd",this.onDragEnd),bu(c,"onTouchCancel",this.onDragEnd)):(bu(c,"onPointerDown",this.onDragStart),bu(c,"onPointerMove",this.onDragChange),bu(c,"onPointerUp",this.onDragEnd),bu(c,"onPointerCancel",this.onDragEnd)),this.config.filterTaps){var f=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";bu(c,f,this.onClick)}},t}(DTe);function zTe(e,t){var r,s=[],c,f=!1;function _(){for(var x=arguments.length,a=new Array(x),I=0;I<x;I++)a[I]=arguments[I];return f&&r===this&&t(a,s)||(c=e.apply(this,a),f=!0,r=this,s=a),c}return _}function kE(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,s,c;if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(s=r;s--!==0;)if(!kE(e[s],t[s]))return!1;return!0}var f;if(typeof Map=="function"&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(f=e.entries();!(s=f.next()).done;)if(!t.has(s.value[0]))return!1;for(f=e.entries();!(s=f.next()).done;)if(!kE(s.value[1],t.get(s.value[0])))return!1;return!0}if(typeof Set=="function"&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(f=e.entries();!(s=f.next()).done;)if(!t.has(s.value[0]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(c=Object.keys(e),r=c.length,r!==Object.keys(t).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,c[s]))return!1;if(typeof Element<"u"&&e instanceof Element)return!1;for(s=r;s--!==0;)if(!(c[s]==="_owner"&&e.$$typeof)&&!kE(e[c[s]],t[c[s]]))return!1;return!0}return e!==e&&t!==t}function NTe(e,t){try{return kE(e,t)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}}function wb(e,t){t===void 0&&(t={}),sm.set("drag",LTe);var r=W.useRef();return r.current||(r.current=zTe(yTe,NTe)),RTe({drag:e},r.current(t))}const _Z=W.createContext(),o0=()=>W.useContext(_Z),FTe=({children:e})=>{const[t,r]=W.useState([]),[s,c]=W.useState(null);W.useEffect(()=>{c(Date.now())},[]),W.useEffect(()=>{if(s){const _=vi(yn,"quests"),x=co(_,yi("createdAt",">",new Date(s))),a=jh(x,I=>{I.docChanges().forEach(D=>{if(D.type==="added"){const O=D.doc.data();f(`New quest available: ${O.title}`,"info")}})});return()=>a()}},[s]);const f=W.useCallback((_,x)=>{const a=Date.now();r(I=>[...I,{id:a,message:_,type:x,show:!0}]),setTimeout(()=>{r(I=>I.map(D=>D.id===a?{...D,show:!1}:D))},3e3),setTimeout(()=>{r(I=>I.filter(D=>D.id!==a))},3500)},[]);return N.jsxs(_Z.Provider,{value:{notifications:t,showNotification:f},children:[e,N.jsx("div",{className:"notification-container",children:t.map(_=>N.jsx("div",{className:`notification ${_.type} ${_.show?"show":"hide"}`,children:_.message},_.id))})]})};var yZ={exports:{}};(function(e,t){var r={};(function(s,c){e.exports=c()})(yJ,function(){var s,c,f;function _(a,I){if(!s)s=I;else if(!c)c=I;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",O={};s(O),f=I(O),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}_(["exports"],function(a){var I="3.6.0";let D;const O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(D==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{D=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):i}catch{D=i}}return D},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!O.API_URL)return null;try{const i=new URL(O.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function F(i){return O.API_URL_REGEX.test(i)}function Z(i){return i.indexOf("mapbox:")===0}function J(i){return O.API_CDN_URL_REGEX.test(i)}function re(i){return O.API_SPRITE_REGEX.test(i)}function ne(i){return O.API_STYLE_REGEX.test(i)&&!re(i)}const G={create:"create",load:"load",fullLoad:"fullLoad"},Y={mark(i){performance.mark(i)},measure(i,n,o){performance.measure(i,n,o)}};function Q(i){const n=i.name.split("?")[0];return J(n)&&n.includes("mapbox-gl.js")?"javascript":J(n)&&n.includes("mapbox-gl.css")?"css":function(o){return O.API_FONTS_REGEX.test(o)}(n)?"fontRange":re(n)?"sprite":ne(n)?"style":function(o){return O.API_TILEJSON_REGEX.test(o)}(n)?"tilejson":"other"}function de(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Te={},we={};Object.defineProperty(we,"__esModule",{value:!0}),we.setMatrixArrayType=function(i){we.ARRAY_TYPE=he=i},we.toRadian=function(i){return i*ge},we.equals=function(i,n){return Math.abs(i-n)<=oe*Math.max(1,Math.abs(i),Math.abs(n))},we.RANDOM=we.ARRAY_TYPE=we.EPSILON=void 0;var oe=1e-6;we.EPSILON=oe;var he=typeof Float32Array<"u"?Float32Array:Array;we.ARRAY_TYPE=he;var X=Math.random;we.RANDOM=X;var ge=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,n=arguments.length;n--;)i+=arguments[n]*arguments[n];return Math.sqrt(i)});var be={};function ke(i){return ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ke(i)}Object.defineProperty(be,"__esModule",{value:!0}),be.create=function(){var i=new Ee.ARRAY_TYPE(4);return Ee.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},be.clone=function(i){var n=new Ee.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},be.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},be.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},be.fromValues=function(i,n,o,u){var h=new Ee.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=o,h[3]=u,h},be.set=function(i,n,o,u,h){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i},be.transpose=function(i,n){if(i===n){var o=n[1];i[1]=n[2],i[2]=o}else i[0]=n[0],i[1]=n[2],i[2]=n[1],i[3]=n[3];return i},be.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o*p-h*u;return m?(i[0]=p*(m=1/m),i[1]=-u*m,i[2]=-h*m,i[3]=o*m,i):null},be.adjoint=function(i,n){var o=n[0];return i[0]=n[3],i[1]=-n[1],i[2]=-n[2],i[3]=o,i},be.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},be.multiply=Ut,be.rotate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w+p*v,i[1]=h*w+m*v,i[2]=u*-v+p*w,i[3]=h*-v+m*w,i},be.scale=function(i,n,o){var u=n[1],h=n[2],p=n[3],m=o[0],v=o[1];return i[0]=n[0]*m,i[1]=u*m,i[2]=h*v,i[3]=p*v,i},be.fromRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=-o,i[3]=u,i},be.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i},be.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},be.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},be.LDU=function(i,n,o,u){return i[2]=u[2]/u[0],o[0]=u[0],o[1]=u[1],o[3]=u[3]-i[2]*o[1],[i,n,o]},be.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i},be.subtract=Qt,be.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},be.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=n[0],v=n[1],w=n[2],E=n[3];return Math.abs(o-m)<=Ee.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(u-v)<=Ee.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-w)<=Ee.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-E)<=Ee.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},be.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i},be.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i},be.sub=be.mul=void 0;var Ee=function(i,n){if(i&&i.__esModule)return i;if(i===null||ke(i)!=="object"&&typeof i!="function")return{default:i};var o=zt(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(we);function zt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(zt=function(u){return u?o:n})(i)}function Ut(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[0],w=o[1],E=o[2],C=o[3];return i[0]=u*v+p*w,i[1]=h*v+m*w,i[2]=u*E+p*C,i[3]=h*E+m*C,i}function Qt(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i}be.mul=Ut,be.sub=Qt;var kt={};function ft(i){return ft=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ft(i)}Object.defineProperty(kt,"__esModule",{value:!0}),kt.create=function(){var i=new Rt.ARRAY_TYPE(6);return Rt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},kt.clone=function(i){var n=new Rt.ARRAY_TYPE(6);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n},kt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i},kt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},kt.fromValues=function(i,n,o,u,h,p){var m=new Rt.ARRAY_TYPE(6);return m[0]=i,m[1]=n,m[2]=o,m[3]=u,m[4]=h,m[5]=p,m},kt.set=function(i,n,o,u,h,p,m){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i},kt.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=o*p-u*h;return w?(i[0]=p*(w=1/w),i[1]=-u*w,i[2]=-h*w,i[3]=o*w,i[4]=(h*v-p*m)*w,i[5]=(u*m-o*v)*w,i):null},kt.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},kt.multiply=ht,kt.rotate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=Math.sin(o),C=Math.cos(o);return i[0]=u*C+p*E,i[1]=h*C+m*E,i[2]=u*-E+p*C,i[3]=h*-E+m*C,i[4]=v,i[5]=w,i},kt.scale=function(i,n,o){var u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=o[0],E=o[1];return i[0]=n[0]*w,i[1]=u*w,i[2]=h*E,i[3]=p*E,i[4]=m,i[5]=v,i},kt.translate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=o[0],C=o[1];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=u*E+p*C+v,i[5]=h*E+m*C+w,i},kt.fromRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=-o,i[3]=u,i[4]=0,i[5]=0,i},kt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i[4]=0,i[5]=0,i},kt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=n[0],i[5]=n[1],i},kt.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},kt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},kt.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i},kt.subtract=At,kt.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i},kt.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i[4]=n[4]+o[4]*u,i[5]=n[5]+o[5]*u,i},kt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]},kt.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=n[0],E=n[1],C=n[2],P=n[3],M=n[4],z=n[5];return Math.abs(o-w)<=Rt.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(u-E)<=Rt.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-C)<=Rt.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-P)<=Rt.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-M)<=Rt.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(v-z)<=Rt.EPSILON*Math.max(1,Math.abs(v),Math.abs(z))},kt.sub=kt.mul=void 0;var Rt=function(i,n){if(i&&i.__esModule)return i;if(i===null||ft(i)!=="object"&&typeof i!="function")return{default:i};var o=Yt(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(we);function Yt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Yt=function(u){return u?o:n})(i)}function ht(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=o[0],C=o[1],P=o[2],M=o[3],z=o[4],j=o[5];return i[0]=u*E+p*C,i[1]=h*E+m*C,i[2]=u*P+p*M,i[3]=h*P+m*M,i[4]=u*z+p*j+v,i[5]=h*z+m*j+w,i}function At(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i[4]=n[4]-o[4],i[5]=n[5]-o[5],i}kt.mul=ht,kt.sub=At;var wt={};function Xt(i){return Xt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Xt(i)}Object.defineProperty(wt,"__esModule",{value:!0}),wt.create=function(){var i=new Ft.ARRAY_TYPE(9);return Ft.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},wt.fromMat4=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[4],i[4]=n[5],i[5]=n[6],i[6]=n[8],i[7]=n[9],i[8]=n[10],i},wt.clone=function(i){var n=new Ft.ARRAY_TYPE(9);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n},wt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},wt.fromValues=function(i,n,o,u,h,p,m,v,w){var E=new Ft.ARRAY_TYPE(9);return E[0]=i,E[1]=n,E[2]=o,E[3]=u,E[4]=h,E[5]=p,E[6]=m,E[7]=v,E[8]=w,E},wt.set=function(i,n,o,u,h,p,m,v,w,E){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i[8]=E,i},wt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},wt.transpose=function(i,n){if(i===n){var o=n[1],u=n[2],h=n[5];i[1]=n[3],i[2]=n[6],i[3]=o,i[5]=n[7],i[6]=u,i[7]=h}else i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8];return i},wt.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=C*m-v*E,M=-C*p+v*w,z=E*p-m*w,j=o*P+u*M+h*z;return j?(i[0]=P*(j=1/j),i[1]=(-C*u+h*E)*j,i[2]=(v*u-h*m)*j,i[3]=M*j,i[4]=(C*o-h*w)*j,i[5]=(-v*o+h*p)*j,i[6]=z*j,i[7]=(-E*o+u*w)*j,i[8]=(m*o-u*p)*j,i):null},wt.adjoint=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8];return i[0]=m*C-v*E,i[1]=h*E-u*C,i[2]=u*v-h*m,i[3]=v*w-p*C,i[4]=o*C-h*w,i[5]=h*p-o*v,i[6]=p*E-m*w,i[7]=u*w-o*E,i[8]=o*m-u*p,i},wt.determinant=function(i){var n=i[3],o=i[4],u=i[5],h=i[6],p=i[7],m=i[8];return i[0]*(m*o-u*p)+i[1]*(-m*n+u*h)+i[2]*(p*n-o*h)},wt.multiply=qn,wt.translate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=o[0],z=o[1];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=w,i[6]=M*u+z*m+E,i[7]=M*h+z*v+C,i[8]=M*p+z*w+P,i},wt.rotate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=Math.sin(o),z=Math.cos(o);return i[0]=z*u+M*m,i[1]=z*h+M*v,i[2]=z*p+M*w,i[3]=z*m-M*u,i[4]=z*v-M*h,i[5]=z*w-M*p,i[6]=E,i[7]=C,i[8]=P,i},wt.scale=function(i,n,o){var u=o[0],h=o[1];return i[0]=u*n[0],i[1]=u*n[1],i[2]=u*n[2],i[3]=h*n[3],i[4]=h*n[4],i[5]=h*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},wt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=n[0],i[7]=n[1],i[8]=1,i},wt.fromRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=0,i[3]=-o,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},wt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},wt.fromMat2d=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=0,i[3]=n[2],i[4]=n[3],i[5]=0,i[6]=n[4],i[7]=n[5],i[8]=1,i},wt.fromQuat=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o+o,v=u+u,w=h+h,E=o*m,C=u*m,P=u*v,M=h*m,z=h*v,j=h*w,V=p*m,$=p*v,ee=p*w;return i[0]=1-P-j,i[3]=C-ee,i[6]=M+$,i[1]=C+ee,i[4]=1-E-j,i[7]=z-V,i[2]=M-$,i[5]=z+V,i[8]=1-E-P,i},wt.normalFromMat4=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=n[9],M=n[10],z=n[11],j=n[12],V=n[13],$=n[14],ee=n[15],pe=o*v-u*m,fe=o*w-h*m,me=o*E-p*m,Ce=u*w-h*v,Ae=u*E-p*v,Le=h*E-p*w,$e=C*V-P*j,Ze=C*$-M*j,nt=C*ee-z*j,Ke=P*$-M*V,at=P*ee-z*V,bt=M*ee-z*$,lt=pe*bt-fe*at+me*Ke+Ce*nt-Ae*Ze+Le*$e;return lt?(i[0]=(v*bt-w*at+E*Ke)*(lt=1/lt),i[1]=(w*nt-m*bt-E*Ze)*lt,i[2]=(m*at-v*nt+E*$e)*lt,i[3]=(h*at-u*bt-p*Ke)*lt,i[4]=(o*bt-h*nt+p*Ze)*lt,i[5]=(u*nt-o*at-p*$e)*lt,i[6]=(V*Le-$*Ae+ee*Ce)*lt,i[7]=($*me-j*Le-ee*fe)*lt,i[8]=(j*Ae-V*me+ee*pe)*lt,i):null},wt.projection=function(i,n,o){return i[0]=2/n,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/o,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},wt.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},wt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},wt.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i[6]=n[6]+o[6],i[7]=n[7]+o[7],i[8]=n[8]+o[8],i},wt.subtract=Qn,wt.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7]*o,i[8]=n[8]*o,i},wt.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i[4]=n[4]+o[4]*u,i[5]=n[5]+o[5]*u,i[6]=n[6]+o[6]*u,i[7]=n[7]+o[7]*u,i[8]=n[8]+o[8]*u,i},wt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]},wt.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],C=i[8],P=n[0],M=n[1],z=n[2],j=n[3],V=n[4],$=n[5],ee=n[6],pe=n[7],fe=n[8];return Math.abs(o-P)<=Ft.EPSILON*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(u-M)<=Ft.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(h-z)<=Ft.EPSILON*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(p-j)<=Ft.EPSILON*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(m-V)<=Ft.EPSILON*Math.max(1,Math.abs(m),Math.abs(V))&&Math.abs(v-$)<=Ft.EPSILON*Math.max(1,Math.abs(v),Math.abs($))&&Math.abs(w-ee)<=Ft.EPSILON*Math.max(1,Math.abs(w),Math.abs(ee))&&Math.abs(E-pe)<=Ft.EPSILON*Math.max(1,Math.abs(E),Math.abs(pe))&&Math.abs(C-fe)<=Ft.EPSILON*Math.max(1,Math.abs(C),Math.abs(fe))},wt.sub=wt.mul=void 0;var Ft=function(i,n){if(i&&i.__esModule)return i;if(i===null||Xt(i)!=="object"&&typeof i!="function")return{default:i};var o=Sn(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(we);function Sn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Sn=function(u){return u?o:n})(i)}function qn(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=o[0],z=o[1],j=o[2],V=o[3],$=o[4],ee=o[5],pe=o[6],fe=o[7],me=o[8];return i[0]=M*u+z*m+j*E,i[1]=M*h+z*v+j*C,i[2]=M*p+z*w+j*P,i[3]=V*u+$*m+ee*E,i[4]=V*h+$*v+ee*C,i[5]=V*p+$*w+ee*P,i[6]=pe*u+fe*m+me*E,i[7]=pe*h+fe*v+me*C,i[8]=pe*p+fe*w+me*P,i}function Qn(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i[4]=n[4]-o[4],i[5]=n[5]-o[5],i[6]=n[6]-o[6],i[7]=n[7]-o[7],i[8]=n[8]-o[8],i}wt.mul=qn,wt.sub=Qn;var Gt={};function Cn(i){return Cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Cn(i)}Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var i=new hn.ARRAY_TYPE(16);return hn.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},Gt.clone=function(i){var n=new hn.ARRAY_TYPE(16);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],n},Gt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},Gt.fromValues=function(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V){var $=new hn.ARRAY_TYPE(16);return $[0]=i,$[1]=n,$[2]=o,$[3]=u,$[4]=h,$[5]=p,$[6]=m,$[7]=v,$[8]=w,$[9]=E,$[10]=C,$[11]=P,$[12]=M,$[13]=z,$[14]=j,$[15]=V,$},Gt.set=function(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i[8]=E,i[9]=C,i[10]=P,i[11]=M,i[12]=z,i[13]=j,i[14]=V,i[15]=$,i},Gt.identity=Nr,Gt.transpose=function(i,n){if(i===n){var o=n[1],u=n[2],h=n[3],p=n[6],m=n[7],v=n[11];i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=o,i[6]=n[9],i[7]=n[13],i[8]=u,i[9]=p,i[11]=n[14],i[12]=h,i[13]=m,i[14]=v}else i[0]=n[0],i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=n[1],i[5]=n[5],i[6]=n[9],i[7]=n[13],i[8]=n[2],i[9]=n[6],i[10]=n[10],i[11]=n[14],i[12]=n[3],i[13]=n[7],i[14]=n[11],i[15]=n[15];return i},Gt.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=n[9],M=n[10],z=n[11],j=n[12],V=n[13],$=n[14],ee=n[15],pe=o*v-u*m,fe=o*w-h*m,me=o*E-p*m,Ce=u*w-h*v,Ae=u*E-p*v,Le=h*E-p*w,$e=C*V-P*j,Ze=C*$-M*j,nt=C*ee-z*j,Ke=P*$-M*V,at=P*ee-z*V,bt=M*ee-z*$,lt=pe*bt-fe*at+me*Ke+Ce*nt-Ae*Ze+Le*$e;return lt?(i[0]=(v*bt-w*at+E*Ke)*(lt=1/lt),i[1]=(h*at-u*bt-p*Ke)*lt,i[2]=(V*Le-$*Ae+ee*Ce)*lt,i[3]=(M*Ae-P*Le-z*Ce)*lt,i[4]=(w*nt-m*bt-E*Ze)*lt,i[5]=(o*bt-h*nt+p*Ze)*lt,i[6]=($*me-j*Le-ee*fe)*lt,i[7]=(C*Le-M*me+z*fe)*lt,i[8]=(m*at-v*nt+E*$e)*lt,i[9]=(u*nt-o*at-p*$e)*lt,i[10]=(j*Ae-V*me+ee*pe)*lt,i[11]=(P*me-C*Ae-z*pe)*lt,i[12]=(v*Ze-m*Ke-w*$e)*lt,i[13]=(o*Ke-u*Ze+h*$e)*lt,i[14]=(V*fe-j*Ce-$*pe)*lt,i[15]=(C*Ce-P*fe+M*pe)*lt,i):null},Gt.adjoint=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=n[9],M=n[10],z=n[11],j=n[12],V=n[13],$=n[14],ee=n[15];return i[0]=v*(M*ee-z*$)-P*(w*ee-E*$)+V*(w*z-E*M),i[1]=-(u*(M*ee-z*$)-P*(h*ee-p*$)+V*(h*z-p*M)),i[2]=u*(w*ee-E*$)-v*(h*ee-p*$)+V*(h*E-p*w),i[3]=-(u*(w*z-E*M)-v*(h*z-p*M)+P*(h*E-p*w)),i[4]=-(m*(M*ee-z*$)-C*(w*ee-E*$)+j*(w*z-E*M)),i[5]=o*(M*ee-z*$)-C*(h*ee-p*$)+j*(h*z-p*M),i[6]=-(o*(w*ee-E*$)-m*(h*ee-p*$)+j*(h*E-p*w)),i[7]=o*(w*z-E*M)-m*(h*z-p*M)+C*(h*E-p*w),i[8]=m*(P*ee-z*V)-C*(v*ee-E*V)+j*(v*z-E*P),i[9]=-(o*(P*ee-z*V)-C*(u*ee-p*V)+j*(u*z-p*P)),i[10]=o*(v*ee-E*V)-m*(u*ee-p*V)+j*(u*E-p*v),i[11]=-(o*(v*z-E*P)-m*(u*z-p*P)+C*(u*E-p*v)),i[12]=-(m*(P*$-M*V)-C*(v*$-w*V)+j*(v*M-w*P)),i[13]=o*(P*$-M*V)-C*(u*$-h*V)+j*(u*M-h*P),i[14]=-(o*(v*$-w*V)-m*(u*$-h*V)+j*(u*w-h*v)),i[15]=o*(v*M-w*P)-m*(u*M-h*P)+C*(u*w-h*v),i},Gt.determinant=function(i){var n=i[0],o=i[1],u=i[2],h=i[3],p=i[4],m=i[5],v=i[6],w=i[7],E=i[8],C=i[9],P=i[10],M=i[11],z=i[12],j=i[13],V=i[14],$=i[15];return(n*m-o*p)*(P*$-M*V)-(n*v-u*p)*(C*$-M*j)+(n*w-h*p)*(C*V-P*j)+(o*v-u*m)*(E*$-M*z)-(o*w-h*m)*(E*V-P*z)+(u*w-h*v)*(E*j-C*z)},Gt.multiply=jn,Gt.translate=function(i,n,o){var u,h,p,m,v,w,E,C,P,M,z,j,V=o[0],$=o[1],ee=o[2];return n===i?(i[12]=n[0]*V+n[4]*$+n[8]*ee+n[12],i[13]=n[1]*V+n[5]*$+n[9]*ee+n[13],i[14]=n[2]*V+n[6]*$+n[10]*ee+n[14],i[15]=n[3]*V+n[7]*$+n[11]*ee+n[15]):(h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=n[9],z=n[10],j=n[11],i[0]=u=n[0],i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=w,i[6]=E,i[7]=C,i[8]=P,i[9]=M,i[10]=z,i[11]=j,i[12]=u*V+v*$+P*ee+n[12],i[13]=h*V+w*$+M*ee+n[13],i[14]=p*V+E*$+z*ee+n[14],i[15]=m*V+C*$+j*ee+n[15]),i},Gt.scale=function(i,n,o){var u=o[0],h=o[1],p=o[2];return i[0]=n[0]*u,i[1]=n[1]*u,i[2]=n[2]*u,i[3]=n[3]*u,i[4]=n[4]*h,i[5]=n[5]*h,i[6]=n[6]*h,i[7]=n[7]*h,i[8]=n[8]*p,i[9]=n[9]*p,i[10]=n[10]*p,i[11]=n[11]*p,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},Gt.rotate=function(i,n,o,u){var h,p,m,v,w,E,C,P,M,z,j,V,$,ee,pe,fe,me,Ce,Ae,Le,$e,Ze,nt,Ke,at=u[0],bt=u[1],lt=u[2],St=Math.hypot(at,bt,lt);return St<hn.EPSILON?null:(at*=St=1/St,bt*=St,lt*=St,h=Math.sin(o),p=Math.cos(o),w=n[1],E=n[2],C=n[3],M=n[5],z=n[6],j=n[7],$=n[9],ee=n[10],pe=n[11],fe=at*at*(m=1-p)+p,Ae=at*bt*m-lt*h,Le=bt*bt*m+p,$e=lt*bt*m+at*h,Ze=at*lt*m+bt*h,nt=bt*lt*m-at*h,Ke=lt*lt*m+p,i[0]=(v=n[0])*fe+(P=n[4])*(me=bt*at*m+lt*h)+(V=n[8])*(Ce=lt*at*m-bt*h),i[1]=w*fe+M*me+$*Ce,i[2]=E*fe+z*me+ee*Ce,i[3]=C*fe+j*me+pe*Ce,i[4]=v*Ae+P*Le+V*$e,i[5]=w*Ae+M*Le+$*$e,i[6]=E*Ae+z*Le+ee*$e,i[7]=C*Ae+j*Le+pe*$e,i[8]=v*Ze+P*nt+V*Ke,i[9]=w*Ze+M*nt+$*Ke,i[10]=E*Ze+z*nt+ee*Ke,i[11]=C*Ze+j*nt+pe*Ke,n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i)},Gt.rotateX=function(i,n,o){var u=Math.sin(o),h=Math.cos(o),p=n[4],m=n[5],v=n[6],w=n[7],E=n[8],C=n[9],P=n[10],M=n[11];return n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[4]=p*h+E*u,i[5]=m*h+C*u,i[6]=v*h+P*u,i[7]=w*h+M*u,i[8]=E*h-p*u,i[9]=C*h-m*u,i[10]=P*h-v*u,i[11]=M*h-w*u,i},Gt.rotateY=function(i,n,o){var u=Math.sin(o),h=Math.cos(o),p=n[0],m=n[1],v=n[2],w=n[3],E=n[8],C=n[9],P=n[10],M=n[11];return n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h-E*u,i[1]=m*h-C*u,i[2]=v*h-P*u,i[3]=w*h-M*u,i[8]=p*u+E*h,i[9]=m*u+C*h,i[10]=v*u+P*h,i[11]=w*u+M*h,i},Gt.rotateZ=function(i,n,o){var u=Math.sin(o),h=Math.cos(o),p=n[0],m=n[1],v=n[2],w=n[3],E=n[4],C=n[5],P=n[6],M=n[7];return n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h+E*u,i[1]=m*h+C*u,i[2]=v*h+P*u,i[3]=w*h+M*u,i[4]=E*h-p*u,i[5]=C*h-m*u,i[6]=P*h-v*u,i[7]=M*h-w*u,i},Gt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i},Gt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=n[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromRotation=function(i,n,o){var u,h,p,m=o[0],v=o[1],w=o[2],E=Math.hypot(m,v,w);return E<hn.EPSILON?null:(m*=E=1/E,v*=E,w*=E,u=Math.sin(n),h=Math.cos(n),i[0]=m*m*(p=1-h)+h,i[1]=v*m*p+w*u,i[2]=w*m*p-v*u,i[3]=0,i[4]=m*v*p-w*u,i[5]=v*v*p+h,i[6]=w*v*p+m*u,i[7]=0,i[8]=m*w*p+v*u,i[9]=v*w*p-m*u,i[10]=w*w*p+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},Gt.fromXRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=o,i[7]=0,i[8]=0,i[9]=-o,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromYRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=0,i[2]=-o,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=o,i[9]=0,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromZRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=0,i[3]=0,i[4]=-o,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.fromRotationTranslation=gr,Gt.fromQuat2=function(i,n){var o=new hn.ARRAY_TYPE(3),u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=u*u+h*h+p*p+m*m;return P>0?(o[0]=2*(v*m+C*u+w*p-E*h)/P,o[1]=2*(w*m+C*h+E*u-v*p)/P,o[2]=2*(E*m+C*p+v*h-w*u)/P):(o[0]=2*(v*m+C*u+w*p-E*h),o[1]=2*(w*m+C*h+E*u-v*p),o[2]=2*(E*m+C*p+v*h-w*u)),gr(i,n,o),i},Gt.getTranslation=function(i,n){return i[0]=n[12],i[1]=n[13],i[2]=n[14],i},Gt.getScaling=Fr,Gt.getRotation=function(i,n){var o=new hn.ARRAY_TYPE(3);Fr(o,n);var u=1/o[0],h=1/o[1],p=1/o[2],m=n[0]*u,v=n[1]*h,w=n[2]*p,E=n[4]*u,C=n[5]*h,P=n[6]*p,M=n[8]*u,z=n[9]*h,j=n[10]*p,V=m+C+j,$=0;return V>0?($=2*Math.sqrt(V+1),i[3]=.25*$,i[0]=(P-z)/$,i[1]=(M-w)/$,i[2]=(v-E)/$):m>C&&m>j?($=2*Math.sqrt(1+m-C-j),i[3]=(P-z)/$,i[0]=.25*$,i[1]=(v+E)/$,i[2]=(M+w)/$):C>j?($=2*Math.sqrt(1+C-m-j),i[3]=(M-w)/$,i[0]=(v+E)/$,i[1]=.25*$,i[2]=(P+z)/$):($=2*Math.sqrt(1+j-m-C),i[3]=(v-E)/$,i[0]=(M+w)/$,i[1]=(P+z)/$,i[2]=.25*$),i},Gt.fromRotationTranslationScale=function(i,n,o,u){var h=n[0],p=n[1],m=n[2],v=n[3],w=h+h,E=p+p,C=m+m,P=h*w,M=h*E,z=h*C,j=p*E,V=p*C,$=m*C,ee=v*w,pe=v*E,fe=v*C,me=u[0],Ce=u[1],Ae=u[2];return i[0]=(1-(j+$))*me,i[1]=(M+fe)*me,i[2]=(z-pe)*me,i[3]=0,i[4]=(M-fe)*Ce,i[5]=(1-(P+$))*Ce,i[6]=(V+ee)*Ce,i[7]=0,i[8]=(z+pe)*Ae,i[9]=(V-ee)*Ae,i[10]=(1-(P+j))*Ae,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i},Gt.fromRotationTranslationScaleOrigin=function(i,n,o,u,h){var p=n[0],m=n[1],v=n[2],w=n[3],E=p+p,C=m+m,P=v+v,M=p*E,z=p*C,j=p*P,V=m*C,$=m*P,ee=v*P,pe=w*E,fe=w*C,me=w*P,Ce=u[0],Ae=u[1],Le=u[2],$e=h[0],Ze=h[1],nt=h[2],Ke=(1-(V+ee))*Ce,at=(z+me)*Ce,bt=(j-fe)*Ce,lt=(z-me)*Ae,St=(1-(M+ee))*Ae,ot=($+pe)*Ae,gt=(j+fe)*Le,Pt=($-pe)*Le,ct=(1-(M+V))*Le;return i[0]=Ke,i[1]=at,i[2]=bt,i[3]=0,i[4]=lt,i[5]=St,i[6]=ot,i[7]=0,i[8]=gt,i[9]=Pt,i[10]=ct,i[11]=0,i[12]=o[0]+$e-(Ke*$e+lt*Ze+gt*nt),i[13]=o[1]+Ze-(at*$e+St*Ze+Pt*nt),i[14]=o[2]+nt-(bt*$e+ot*Ze+ct*nt),i[15]=1,i},Gt.fromQuat=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o+o,v=u+u,w=h+h,E=o*m,C=u*m,P=u*v,M=h*m,z=h*v,j=h*w,V=p*m,$=p*v,ee=p*w;return i[0]=1-P-j,i[1]=C+ee,i[2]=M-$,i[3]=0,i[4]=C-ee,i[5]=1-E-j,i[6]=z+V,i[7]=0,i[8]=M+$,i[9]=z-V,i[10]=1-E-P,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Gt.frustum=function(i,n,o,u,h,p,m){var v=1/(o-n),w=1/(h-u),E=1/(p-m);return i[0]=2*p*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*p*w,i[6]=0,i[7]=0,i[8]=(o+n)*v,i[9]=(h+u)*w,i[10]=(m+p)*E,i[11]=-1,i[12]=0,i[13]=0,i[14]=m*p*2*E,i[15]=0,i},Gt.perspectiveNO=dr,Gt.perspectiveZO=function(i,n,o,u,h){var p,m=1/Math.tan(n/2);return i[0]=m/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=h*(p=1/(u-h)),i[14]=h*u*p):(i[10]=-1,i[14]=-u),i},Gt.perspectiveFromFieldOfView=function(i,n,o,u){var h=Math.tan(n.upDegrees*Math.PI/180),p=Math.tan(n.downDegrees*Math.PI/180),m=Math.tan(n.leftDegrees*Math.PI/180),v=Math.tan(n.rightDegrees*Math.PI/180),w=2/(m+v),E=2/(h+p);return i[0]=w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=E,i[6]=0,i[7]=0,i[8]=-(m-v)*w*.5,i[9]=(h-p)*E*.5,i[10]=u/(o-u),i[11]=-1,i[12]=0,i[13]=0,i[14]=u*o/(o-u),i[15]=0,i},Gt.orthoNO=rr,Gt.orthoZO=function(i,n,o,u,h,p,m){var v=1/(n-o),w=1/(u-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=E,i[11]=0,i[12]=(n+o)*v,i[13]=(h+u)*w,i[14]=p*E,i[15]=1,i},Gt.lookAt=function(i,n,o,u){var h,p,m,v,w,E,C,P,M,z,j=n[0],V=n[1],$=n[2],ee=u[0],pe=u[1],fe=u[2],me=o[0],Ce=o[1],Ae=o[2];return Math.abs(j-me)<hn.EPSILON&&Math.abs(V-Ce)<hn.EPSILON&&Math.abs($-Ae)<hn.EPSILON?Nr(i):(C=j-me,P=V-Ce,M=$-Ae,h=pe*(M*=z=1/Math.hypot(C,P,M))-fe*(P*=z),p=fe*(C*=z)-ee*M,m=ee*P-pe*C,(z=Math.hypot(h,p,m))?(h*=z=1/z,p*=z,m*=z):(h=0,p=0,m=0),v=P*m-M*p,w=M*h-C*m,E=C*p-P*h,(z=Math.hypot(v,w,E))?(v*=z=1/z,w*=z,E*=z):(v=0,w=0,E=0),i[0]=h,i[1]=v,i[2]=C,i[3]=0,i[4]=p,i[5]=w,i[6]=P,i[7]=0,i[8]=m,i[9]=E,i[10]=M,i[11]=0,i[12]=-(h*j+p*V+m*$),i[13]=-(v*j+w*V+E*$),i[14]=-(C*j+P*V+M*$),i[15]=1,i)},Gt.targetTo=function(i,n,o,u){var h=n[0],p=n[1],m=n[2],v=u[0],w=u[1],E=u[2],C=h-o[0],P=p-o[1],M=m-o[2],z=C*C+P*P+M*M;z>0&&(C*=z=1/Math.sqrt(z),P*=z,M*=z);var j=w*M-E*P,V=E*C-v*M,$=v*P-w*C;return(z=j*j+V*V+$*$)>0&&(j*=z=1/Math.sqrt(z),V*=z,$*=z),i[0]=j,i[1]=V,i[2]=$,i[3]=0,i[4]=P*$-M*V,i[5]=M*j-C*$,i[6]=C*V-P*j,i[7]=0,i[8]=C,i[9]=P,i[10]=M,i[11]=0,i[12]=h,i[13]=p,i[14]=m,i[15]=1,i},Gt.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},Gt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},Gt.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i[6]=n[6]+o[6],i[7]=n[7]+o[7],i[8]=n[8]+o[8],i[9]=n[9]+o[9],i[10]=n[10]+o[10],i[11]=n[11]+o[11],i[12]=n[12]+o[12],i[13]=n[13]+o[13],i[14]=n[14]+o[14],i[15]=n[15]+o[15],i},Gt.subtract=Ue,Gt.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7]*o,i[8]=n[8]*o,i[9]=n[9]*o,i[10]=n[10]*o,i[11]=n[11]*o,i[12]=n[12]*o,i[13]=n[13]*o,i[14]=n[14]*o,i[15]=n[15]*o,i},Gt.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i[4]=n[4]+o[4]*u,i[5]=n[5]+o[5]*u,i[6]=n[6]+o[6]*u,i[7]=n[7]+o[7]*u,i[8]=n[8]+o[8]*u,i[9]=n[9]+o[9]*u,i[10]=n[10]+o[10]*u,i[11]=n[11]+o[11]*u,i[12]=n[12]+o[12]*u,i[13]=n[13]+o[13]*u,i[14]=n[14]+o[14]*u,i[15]=n[15]+o[15]*u,i},Gt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]&&i[9]===n[9]&&i[10]===n[10]&&i[11]===n[11]&&i[12]===n[12]&&i[13]===n[13]&&i[14]===n[14]&&i[15]===n[15]},Gt.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],C=i[8],P=i[9],M=i[10],z=i[11],j=i[12],V=i[13],$=i[14],ee=i[15],pe=n[0],fe=n[1],me=n[2],Ce=n[3],Ae=n[4],Le=n[5],$e=n[6],Ze=n[7],nt=n[8],Ke=n[9],at=n[10],bt=n[11],lt=n[12],St=n[13],ot=n[14],gt=n[15];return Math.abs(o-pe)<=hn.EPSILON*Math.max(1,Math.abs(o),Math.abs(pe))&&Math.abs(u-fe)<=hn.EPSILON*Math.max(1,Math.abs(u),Math.abs(fe))&&Math.abs(h-me)<=hn.EPSILON*Math.max(1,Math.abs(h),Math.abs(me))&&Math.abs(p-Ce)<=hn.EPSILON*Math.max(1,Math.abs(p),Math.abs(Ce))&&Math.abs(m-Ae)<=hn.EPSILON*Math.max(1,Math.abs(m),Math.abs(Ae))&&Math.abs(v-Le)<=hn.EPSILON*Math.max(1,Math.abs(v),Math.abs(Le))&&Math.abs(w-$e)<=hn.EPSILON*Math.max(1,Math.abs(w),Math.abs($e))&&Math.abs(E-Ze)<=hn.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ze))&&Math.abs(C-nt)<=hn.EPSILON*Math.max(1,Math.abs(C),Math.abs(nt))&&Math.abs(P-Ke)<=hn.EPSILON*Math.max(1,Math.abs(P),Math.abs(Ke))&&Math.abs(M-at)<=hn.EPSILON*Math.max(1,Math.abs(M),Math.abs(at))&&Math.abs(z-bt)<=hn.EPSILON*Math.max(1,Math.abs(z),Math.abs(bt))&&Math.abs(j-lt)<=hn.EPSILON*Math.max(1,Math.abs(j),Math.abs(lt))&&Math.abs(V-St)<=hn.EPSILON*Math.max(1,Math.abs(V),Math.abs(St))&&Math.abs($-ot)<=hn.EPSILON*Math.max(1,Math.abs($),Math.abs(ot))&&Math.abs(ee-gt)<=hn.EPSILON*Math.max(1,Math.abs(ee),Math.abs(gt))},Gt.sub=Gt.mul=Gt.ortho=Gt.perspective=void 0;var hn=function(i,n){if(i&&i.__esModule)return i;if(i===null||Cn(i)!=="object"&&typeof i!="function")return{default:i};var o=Rn(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(we);function Rn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Rn=function(u){return u?o:n})(i)}function Nr(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function jn(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=n[9],z=n[10],j=n[11],V=n[12],$=n[13],ee=n[14],pe=n[15],fe=o[0],me=o[1],Ce=o[2],Ae=o[3];return i[0]=fe*u+me*v+Ce*P+Ae*V,i[1]=fe*h+me*w+Ce*M+Ae*$,i[2]=fe*p+me*E+Ce*z+Ae*ee,i[3]=fe*m+me*C+Ce*j+Ae*pe,i[4]=(fe=o[4])*u+(me=o[5])*v+(Ce=o[6])*P+(Ae=o[7])*V,i[5]=fe*h+me*w+Ce*M+Ae*$,i[6]=fe*p+me*E+Ce*z+Ae*ee,i[7]=fe*m+me*C+Ce*j+Ae*pe,i[8]=(fe=o[8])*u+(me=o[9])*v+(Ce=o[10])*P+(Ae=o[11])*V,i[9]=fe*h+me*w+Ce*M+Ae*$,i[10]=fe*p+me*E+Ce*z+Ae*ee,i[11]=fe*m+me*C+Ce*j+Ae*pe,i[12]=(fe=o[12])*u+(me=o[13])*v+(Ce=o[14])*P+(Ae=o[15])*V,i[13]=fe*h+me*w+Ce*M+Ae*$,i[14]=fe*p+me*E+Ce*z+Ae*ee,i[15]=fe*m+me*C+Ce*j+Ae*pe,i}function gr(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=u+u,w=h+h,E=p+p,C=u*v,P=u*w,M=u*E,z=h*w,j=h*E,V=p*E,$=m*v,ee=m*w,pe=m*E;return i[0]=1-(z+V),i[1]=P+pe,i[2]=M-ee,i[3]=0,i[4]=P-pe,i[5]=1-(C+V),i[6]=j+$,i[7]=0,i[8]=M+ee,i[9]=j-$,i[10]=1-(C+z),i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i}function Fr(i,n){var o=n[4],u=n[5],h=n[6],p=n[8],m=n[9],v=n[10];return i[0]=Math.hypot(n[0],n[1],n[2]),i[1]=Math.hypot(o,u,h),i[2]=Math.hypot(p,m,v),i}function dr(i,n,o,u,h){var p,m=1/Math.tan(n/2);return i[0]=m/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+u)*(p=1/(u-h)),i[14]=2*h*u*p):(i[10]=-1,i[14]=-2*u),i}function rr(i,n,o,u,h,p,m){var v=1/(n-o),w=1/(u-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(n+o)*v,i[13]=(h+u)*w,i[14]=(m+p)*E,i[15]=1,i}function Ue(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i[4]=n[4]-o[4],i[5]=n[5]-o[5],i[6]=n[6]-o[6],i[7]=n[7]-o[7],i[8]=n[8]-o[8],i[9]=n[9]-o[9],i[10]=n[10]-o[10],i[11]=n[11]-o[11],i[12]=n[12]-o[12],i[13]=n[13]-o[13],i[14]=n[14]-o[14],i[15]=n[15]-o[15],i}Gt.perspective=dr,Gt.ortho=rr,Gt.mul=jn,Gt.sub=Ue;var Xe={},ut={};function Ye(i){return Ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ye(i)}Object.defineProperty(ut,"__esModule",{value:!0}),ut.create=an,ut.clone=function(i){var n=new st.ARRAY_TYPE(3);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n},ut.length=qt,ut.fromValues=function(i,n,o){var u=new st.ARRAY_TYPE(3);return u[0]=i,u[1]=n,u[2]=o,u},ut.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i},ut.set=function(i,n,o,u){return i[0]=n,i[1]=o,i[2]=u,i},ut.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i},ut.subtract=mn,ut.multiply=Ln,ut.divide=fr,ut.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i},ut.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i},ut.min=function(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i[2]=Math.min(n[2],o[2]),i},ut.max=function(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i[2]=Math.max(n[2],o[2]),i},ut.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i},ut.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i},ut.scaleAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i},ut.distance=fi,ut.squaredDistance=ir,ut.squaredLength=Ci,ut.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i},ut.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i},ut.normalize=function(i,n){var o=n[0],u=n[1],h=n[2],p=o*o+u*u+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=n[0]*p,i[1]=n[1]*p,i[2]=n[2]*p,i},ut.dot=ss,ut.cross=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=o[0],v=o[1],w=o[2];return i[0]=h*w-p*v,i[1]=p*m-u*w,i[2]=u*v-h*m,i},ut.lerp=function(i,n,o,u){var h=n[0],p=n[1],m=n[2];return i[0]=h+u*(o[0]-h),i[1]=p+u*(o[1]-p),i[2]=m+u*(o[2]-m),i},ut.hermite=function(i,n,o,u,h,p){var m=p*p,v=m*(2*p-3)+1,w=m*(p-2)+p,E=m*(p-1),C=m*(3-2*p);return i[0]=n[0]*v+o[0]*w+u[0]*E+h[0]*C,i[1]=n[1]*v+o[1]*w+u[1]*E+h[1]*C,i[2]=n[2]*v+o[2]*w+u[2]*E+h[2]*C,i},ut.bezier=function(i,n,o,u,h,p){var m=1-p,v=m*m,w=p*p,E=v*m,C=3*p*v,P=3*w*m,M=w*p;return i[0]=n[0]*E+o[0]*C+u[0]*P+h[0]*M,i[1]=n[1]*E+o[1]*C+u[1]*P+h[1]*M,i[2]=n[2]*E+o[2]*C+u[2]*P+h[2]*M,i},ut.random=function(i,n){n=n||1;var o=2*st.RANDOM()*Math.PI,u=2*st.RANDOM()-1,h=Math.sqrt(1-u*u)*n;return i[0]=Math.cos(o)*h,i[1]=Math.sin(o)*h,i[2]=u*n,i},ut.transformMat4=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=o[3]*u+o[7]*h+o[11]*p+o[15];return i[0]=(o[0]*u+o[4]*h+o[8]*p+o[12])/(m=m||1),i[1]=(o[1]*u+o[5]*h+o[9]*p+o[13])/m,i[2]=(o[2]*u+o[6]*h+o[10]*p+o[14])/m,i},ut.transformMat3=function(i,n,o){var u=n[0],h=n[1],p=n[2];return i[0]=u*o[0]+h*o[3]+p*o[6],i[1]=u*o[1]+h*o[4]+p*o[7],i[2]=u*o[2]+h*o[5]+p*o[8],i},ut.transformQuat=function(i,n,o){var u=o[0],h=o[1],p=o[2],m=n[0],v=n[1],w=n[2],E=h*w-p*v,C=p*m-u*w,P=u*v-h*m,M=h*P-p*C,z=p*E-u*P,j=u*C-h*E,V=2*o[3];return C*=V,P*=V,z*=2,j*=2,i[0]=m+(E*=V)+(M*=2),i[1]=v+C+z,i[2]=w+P+j,i},ut.rotateX=function(i,n,o,u){var h=[],p=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],p[0]=h[0],p[1]=h[1]*Math.cos(u)-h[2]*Math.sin(u),p[2]=h[1]*Math.sin(u)+h[2]*Math.cos(u),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},ut.rotateY=function(i,n,o,u){var h=[],p=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],p[0]=h[2]*Math.sin(u)+h[0]*Math.cos(u),p[1]=h[1],p[2]=h[2]*Math.cos(u)-h[0]*Math.sin(u),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},ut.rotateZ=function(i,n,o,u){var h=[],p=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],p[0]=h[0]*Math.cos(u)-h[1]*Math.sin(u),p[1]=h[0]*Math.sin(u)+h[1]*Math.cos(u),p[2]=h[2],i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},ut.angle=function(i,n){var o=i[0],u=i[1],h=i[2],p=n[0],m=n[1],v=n[2],w=Math.sqrt(o*o+u*u+h*h)*Math.sqrt(p*p+m*m+v*v),E=w&&ss(i,n)/w;return Math.acos(Math.min(Math.max(E,-1),1))},ut.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},ut.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},ut.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]},ut.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=n[0],m=n[1],v=n[2];return Math.abs(o-p)<=st.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(u-m)<=st.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(h-v)<=st.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))},ut.forEach=ut.sqrLen=ut.len=ut.sqrDist=ut.dist=ut.div=ut.mul=ut.sub=void 0;var st=function(i,n){if(i&&i.__esModule)return i;if(i===null||Ye(i)!=="object"&&typeof i!="function")return{default:i};var o=Mt(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(we);function Mt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Mt=function(u){return u?o:n})(i)}function an(){var i=new st.ARRAY_TYPE(3);return st.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function qt(i){return Math.hypot(i[0],i[1],i[2])}function mn(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i}function Ln(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i[2]=n[2]*o[2],i}function fr(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i[2]=n[2]/o[2],i}function fi(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2])}function ir(i,n){var o=n[0]-i[0],u=n[1]-i[1],h=n[2]-i[2];return o*o+u*u+h*h}function Ci(i){var n=i[0],o=i[1],u=i[2];return n*n+o*o+u*u}function ss(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]}ut.sub=mn,ut.mul=Ln,ut.div=fr,ut.dist=fi,ut.sqrDist=ir,ut.len=qt,ut.sqrLen=Ci;var Tn,or=(Tn=an(),function(i,n,o,u,h,p){var m,v;for(n||(n=3),o||(o=0),v=u?Math.min(u*n+o,i.length):i.length,m=o;m<v;m+=n)Tn[0]=i[m],Tn[1]=i[m+1],Tn[2]=i[m+2],h(Tn,Tn,p),i[m]=Tn[0],i[m+1]=Tn[1],i[m+2]=Tn[2];return i});ut.forEach=or;var dn={};function Js(i){return Js=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Js(i)}Object.defineProperty(dn,"__esModule",{value:!0}),dn.create=wa,dn.clone=function(i){var n=new Ai.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},dn.fromValues=function(i,n,o,u){var h=new Ai.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=o,h[3]=u,h},dn.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},dn.set=function(i,n,o,u,h){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i},dn.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i},dn.subtract=nn,dn.multiply=Jn,dn.divide=ti,dn.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i[3]=Math.ceil(n[3]),i},dn.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i[3]=Math.floor(n[3]),i},dn.min=function(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i[2]=Math.min(n[2],o[2]),i[3]=Math.min(n[3],o[3]),i},dn.max=function(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i[2]=Math.max(n[2],o[2]),i[3]=Math.max(n[3],o[3]),i},dn.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i[3]=Math.round(n[3]),i},dn.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i},dn.scaleAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i},dn.distance=Mi,dn.squaredDistance=Ts,dn.length=Es,dn.squaredLength=Ls,dn.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=-n[3],i},dn.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i[3]=1/n[3],i},dn.normalize=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o*o+u*u+h*h+p*p;return m>0&&(m=1/Math.sqrt(m)),i[0]=o*m,i[1]=u*m,i[2]=h*m,i[3]=p*m,i},dn.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},dn.cross=function(i,n,o,u){var h=o[0]*u[1]-o[1]*u[0],p=o[0]*u[2]-o[2]*u[0],m=o[0]*u[3]-o[3]*u[0],v=o[1]*u[2]-o[2]*u[1],w=o[1]*u[3]-o[3]*u[1],E=o[2]*u[3]-o[3]*u[2],C=n[0],P=n[1],M=n[2],z=n[3];return i[0]=P*E-M*w+z*v,i[1]=-C*E+M*m-z*p,i[2]=C*w-P*m+z*h,i[3]=-C*v+P*p-M*h,i},dn.lerp=function(i,n,o,u){var h=n[0],p=n[1],m=n[2],v=n[3];return i[0]=h+u*(o[0]-h),i[1]=p+u*(o[1]-p),i[2]=m+u*(o[2]-m),i[3]=v+u*(o[3]-v),i},dn.random=function(i,n){var o,u,h,p,m,v;n=n||1;do m=(o=2*Ai.RANDOM()-1)*o+(u=2*Ai.RANDOM()-1)*u;while(m>=1);do v=(h=2*Ai.RANDOM()-1)*h+(p=2*Ai.RANDOM()-1)*p;while(v>=1);var w=Math.sqrt((1-m)/v);return i[0]=n*o,i[1]=n*u,i[2]=n*h*w,i[3]=n*p*w,i},dn.transformMat4=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3];return i[0]=o[0]*u+o[4]*h+o[8]*p+o[12]*m,i[1]=o[1]*u+o[5]*h+o[9]*p+o[13]*m,i[2]=o[2]*u+o[6]*h+o[10]*p+o[14]*m,i[3]=o[3]*u+o[7]*h+o[11]*p+o[15]*m,i},dn.transformQuat=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=o[0],v=o[1],w=o[2],E=o[3],C=E*u+v*p-w*h,P=E*h+w*u-m*p,M=E*p+m*h-v*u,z=-m*u-v*h-w*p;return i[0]=C*E+z*-m+P*-w-M*-v,i[1]=P*E+z*-v+M*-m-C*-w,i[2]=M*E+z*-w+C*-v-P*-m,i[3]=n[3],i},dn.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},dn.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},dn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},dn.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=n[0],v=n[1],w=n[2],E=n[3];return Math.abs(o-m)<=Ai.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(u-v)<=Ai.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-w)<=Ai.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-E)<=Ai.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},dn.forEach=dn.sqrLen=dn.len=dn.sqrDist=dn.dist=dn.div=dn.mul=dn.sub=void 0;var Ai=function(i,n){if(i&&i.__esModule)return i;if(i===null||Js(i)!=="object"&&typeof i!="function")return{default:i};var o=fo(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(we);function fo(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(fo=function(u){return u?o:n})(i)}function wa(){var i=new Ai.ARRAY_TYPE(4);return Ai.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function nn(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i}function Jn(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i[2]=n[2]*o[2],i[3]=n[3]*o[3],i}function ti(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i[2]=n[2]/o[2],i[3]=n[3]/o[3],i}function Mi(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2],n[3]-i[3])}function Ts(i,n){var o=n[0]-i[0],u=n[1]-i[1],h=n[2]-i[2],p=n[3]-i[3];return o*o+u*u+h*h+p*p}function Es(i){return Math.hypot(i[0],i[1],i[2],i[3])}function Ls(i){var n=i[0],o=i[1],u=i[2],h=i[3];return n*n+o*o+u*u+h*h}dn.sub=nn,dn.mul=Jn,dn.div=ti,dn.dist=Mi,dn.sqrDist=Ts,dn.len=Es,dn.sqrLen=Ls;var $s=function(){var i=wa();return function(n,o,u,h,p,m){var v,w;for(o||(o=4),u||(u=0),w=h?Math.min(h*o+u,n.length):n.length,v=u;v<w;v+=o)i[0]=n[v],i[1]=n[v+1],i[2]=n[v+2],i[3]=n[v+3],p(i,i,m),n[v]=i[0],n[v+1]=i[1],n[v+2]=i[2],n[v+3]=i[3];return n}}();function Lo(i){return Lo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Lo(i)}dn.forEach=$s,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.create=po,Xe.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},Xe.setAxisAngle=Fi,Xe.getAxisAngle=function(i,n){var o=2*Math.acos(n[3]),u=Math.sin(o/2);return u>jr.EPSILON?(i[0]=n[0]/u,i[1]=n[1]/u,i[2]=n[2]/u):(i[0]=1,i[1]=0,i[2]=0),o},Xe.getAngle=function(i,n){var o=De(i,n);return Math.acos(2*o*o-1)},Xe.multiply=Xu,Xe.rotateX=function(i,n,o){o*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w+m*v,i[1]=h*w+p*v,i[2]=p*w-h*v,i[3]=m*w-u*v,i},Xe.rotateY=function(i,n,o){o*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w-p*v,i[1]=h*w+m*v,i[2]=p*w+u*v,i[3]=m*w-h*v,i},Xe.rotateZ=function(i,n,o){o*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w+h*v,i[1]=h*w-u*v,i[2]=p*w+m*v,i[3]=m*w-p*v,i},Xe.calculateW=function(i,n){var o=n[0],u=n[1],h=n[2];return i[0]=o,i[1]=u,i[2]=h,i[3]=Math.sqrt(Math.abs(1-o*o-u*u-h*h)),i},Xe.exp=je,Xe.ln=te,Xe.pow=function(i,n,o){return te(i,n),Oe(i,i,o),je(i,i),i},Xe.slerp=le,Xe.random=function(i){var n=jr.RANDOM(),o=jr.RANDOM(),u=jr.RANDOM(),h=Math.sqrt(1-n),p=Math.sqrt(n);return i[0]=h*Math.sin(2*Math.PI*o),i[1]=h*Math.cos(2*Math.PI*o),i[2]=p*Math.sin(2*Math.PI*u),i[3]=p*Math.cos(2*Math.PI*u),i},Xe.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o*o+u*u+h*h+p*p,v=m?1/m:0;return i[0]=-o*v,i[1]=-u*v,i[2]=-h*v,i[3]=p*v,i},Xe.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i},Xe.fromMat3=xe,Xe.fromEuler=function(i,n,o,u){var h=.5*Math.PI/180;n*=h,o*=h,u*=h;var p=Math.sin(n),m=Math.cos(n),v=Math.sin(o),w=Math.cos(o),E=Math.sin(u),C=Math.cos(u);return i[0]=p*w*C-m*v*E,i[1]=m*v*C+p*w*E,i[2]=m*w*E-p*v*C,i[3]=m*w*C+p*v*E,i},Xe.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},Xe.setAxes=Xe.sqlerp=Xe.rotationTo=Xe.equals=Xe.exactEquals=Xe.normalize=Xe.sqrLen=Xe.squaredLength=Xe.len=Xe.length=Xe.lerp=Xe.dot=Xe.scale=Xe.mul=Xe.add=Xe.set=Xe.copy=Xe.fromValues=Xe.clone=void 0;var jr=Ta(we),Wa=Ta(wt),ni=Ta(ut),xi=Ta(dn);function Tl(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Tl=function(u){return u?o:n})(i)}function Ta(i,n){if(i&&i.__esModule)return i;if(i===null||Lo(i)!=="object"&&typeof i!="function")return{default:i};var o=Tl(n);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}function po(){var i=new jr.ARRAY_TYPE(4);return jr.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Fi(i,n,o){o*=.5;var u=Math.sin(o);return i[0]=u*n[0],i[1]=u*n[1],i[2]=u*n[2],i[3]=Math.cos(o),i}function Xu(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[0],w=o[1],E=o[2],C=o[3];return i[0]=u*C+m*v+h*E-p*w,i[1]=h*C+m*w+p*v-u*E,i[2]=p*C+m*E+u*w-h*v,i[3]=m*C-u*v-h*w-p*E,i}function je(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=Math.sqrt(o*o+u*u+h*h),v=Math.exp(p),w=m>0?v*Math.sin(m)/m:0;return i[0]=o*w,i[1]=u*w,i[2]=h*w,i[3]=v*Math.cos(m),i}function te(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=Math.sqrt(o*o+u*u+h*h),v=m>0?Math.atan2(m,p)/m:0;return i[0]=o*v,i[1]=u*v,i[2]=h*v,i[3]=.5*Math.log(o*o+u*u+h*h+p*p),i}function le(i,n,o,u){var h,p,m,v,w,E=n[0],C=n[1],P=n[2],M=n[3],z=o[0],j=o[1],V=o[2],$=o[3];return(p=E*z+C*j+P*V+M*$)<0&&(p=-p,z=-z,j=-j,V=-V,$=-$),1-p>jr.EPSILON?(h=Math.acos(p),m=Math.sin(h),v=Math.sin((1-u)*h)/m,w=Math.sin(u*h)/m):(v=1-u,w=u),i[0]=v*E+w*z,i[1]=v*C+w*j,i[2]=v*P+w*V,i[3]=v*M+w*$,i}function xe(i,n){var o,u=n[0]+n[4]+n[8];if(u>0)o=Math.sqrt(u+1),i[3]=.5*o,i[0]=(n[5]-n[7])*(o=.5/o),i[1]=(n[6]-n[2])*o,i[2]=(n[1]-n[3])*o;else{var h=0;n[4]>n[0]&&(h=1),n[8]>n[3*h+h]&&(h=2);var p=(h+1)%3,m=(h+2)%3;o=Math.sqrt(n[3*h+h]-n[3*p+p]-n[3*m+m]+1),i[h]=.5*o,i[3]=(n[3*p+m]-n[3*m+p])*(o=.5/o),i[p]=(n[3*p+h]+n[3*h+p])*o,i[m]=(n[3*m+h]+n[3*h+m])*o}return i}Xe.clone=xi.clone,Xe.fromValues=xi.fromValues,Xe.copy=xi.copy,Xe.set=xi.set,Xe.add=xi.add,Xe.mul=Xu;var Oe=xi.scale;Xe.scale=Oe;var De=xi.dot;Xe.dot=De,Xe.lerp=xi.lerp;var Ge=xi.length;Xe.length=Ge,Xe.len=Ge;var rt=xi.squaredLength;Xe.squaredLength=rt,Xe.sqrLen=rt;var qe=xi.normalize;Xe.normalize=qe,Xe.exactEquals=xi.exactEquals,Xe.equals=xi.equals;var tt,yt,vt,Wt=(tt=ni.create(),yt=ni.fromValues(1,0,0),vt=ni.fromValues(0,1,0),function(i,n,o){var u=ni.dot(n,o);return u<-.999999?(ni.cross(tt,yt,n),ni.len(tt)<1e-6&&ni.cross(tt,vt,n),ni.normalize(tt,tt),Fi(i,tt,Math.PI),i):u>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(ni.cross(tt,n,o),i[0]=tt[0],i[1]=tt[1],i[2]=tt[2],i[3]=1+u,qe(i,i))});Xe.rotationTo=Wt;var pn,wn,ar=(pn=po(),wn=po(),function(i,n,o,u,h,p){return le(pn,n,h,p),le(wn,o,u,p),le(i,pn,wn,2*p*(1-p)),i});Xe.sqlerp=ar;var An,lr=(An=Wa.create(),function(i,n,o,u){return An[0]=o[0],An[3]=o[1],An[6]=o[2],An[1]=u[0],An[4]=u[1],An[7]=u[2],An[2]=-n[0],An[5]=-n[1],An[8]=-n[2],qe(i,xe(i,An))});Xe.setAxes=lr;var ln={};function Zr(i){return Zr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Zr(i)}Object.defineProperty(ln,"__esModule",{value:!0}),ln.create=function(){var i=new _r.ARRAY_TYPE(8);return _r.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},ln.clone=function(i){var n=new _r.ARRAY_TYPE(8);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n},ln.fromValues=function(i,n,o,u,h,p,m,v){var w=new _r.ARRAY_TYPE(8);return w[0]=i,w[1]=n,w[2]=o,w[3]=u,w[4]=h,w[5]=p,w[6]=m,w[7]=v,w},ln.fromRotationTranslationValues=function(i,n,o,u,h,p,m){var v=new _r.ARRAY_TYPE(8);v[0]=i,v[1]=n,v[2]=o,v[3]=u;var w=.5*h,E=.5*p,C=.5*m;return v[4]=w*u+E*o-C*n,v[5]=E*u+C*i-w*o,v[6]=C*u+w*n-E*i,v[7]=-w*i-E*n-C*o,v},ln.fromRotationTranslation=Ss,ln.fromTranslation=function(i,n){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*n[0],i[5]=.5*n[1],i[6]=.5*n[2],i[7]=0,i},ln.fromRotation=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},ln.fromMat4=function(i,n){var o=cr.create();pi.getRotation(o,n);var u=new _r.ARRAY_TYPE(3);return pi.getTranslation(u,n),Ss(i,o,u),i},ln.copy=qs,ln.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},ln.set=function(i,n,o,u,h,p,m,v,w){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i},ln.getDual=function(i,n){return i[0]=n[4],i[1]=n[5],i[2]=n[6],i[3]=n[7],i},ln.setDual=function(i,n){return i[4]=n[0],i[5]=n[1],i[6]=n[2],i[7]=n[3],i},ln.getTranslation=function(i,n){var o=n[4],u=n[5],h=n[6],p=n[7],m=-n[0],v=-n[1],w=-n[2],E=n[3];return i[0]=2*(o*E+p*m+u*w-h*v),i[1]=2*(u*E+p*v+h*m-o*w),i[2]=2*(h*E+p*w+o*v-u*m),i},ln.translate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=.5*o[0],w=.5*o[1],E=.5*o[2],C=n[4],P=n[5],M=n[6],z=n[7];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=m*v+h*E-p*w+C,i[5]=m*w+p*v-u*E+P,i[6]=m*E+u*w-h*v+M,i[7]=-u*v-h*w-p*E+z,i},ln.rotateX=function(i,n,o){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=v*m+C*u+w*p-E*h,M=w*m+C*h+E*u-v*p,z=E*m+C*p+v*h-w*u,j=C*m-v*u-w*h-E*p;return cr.rotateX(i,n,o),i[4]=P*(m=i[3])+j*(u=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+j*h+z*u-P*p,i[6]=z*m+j*p+P*h-M*u,i[7]=j*m-P*u-M*h-z*p,i},ln.rotateY=function(i,n,o){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=v*m+C*u+w*p-E*h,M=w*m+C*h+E*u-v*p,z=E*m+C*p+v*h-w*u,j=C*m-v*u-w*h-E*p;return cr.rotateY(i,n,o),i[4]=P*(m=i[3])+j*(u=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+j*h+z*u-P*p,i[6]=z*m+j*p+P*h-M*u,i[7]=j*m-P*u-M*h-z*p,i},ln.rotateZ=function(i,n,o){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=v*m+C*u+w*p-E*h,M=w*m+C*h+E*u-v*p,z=E*m+C*p+v*h-w*u,j=C*m-v*u-w*h-E*p;return cr.rotateZ(i,n,o),i[4]=P*(m=i[3])+j*(u=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+j*h+z*u-P*p,i[6]=z*m+j*p+P*h-M*u,i[7]=j*m-P*u-M*h-z*p,i},ln.rotateByQuatAppend=function(i,n,o){var u=o[0],h=o[1],p=o[2],m=o[3],v=n[0],w=n[1],E=n[2],C=n[3];return i[0]=v*m+C*u+w*p-E*h,i[1]=w*m+C*h+E*u-v*p,i[2]=E*m+C*p+v*h-w*u,i[3]=C*m-v*u-w*h-E*p,i[4]=(v=n[4])*m+(C=n[7])*u+(w=n[5])*p-(E=n[6])*h,i[5]=w*m+C*h+E*u-v*p,i[6]=E*m+C*p+v*h-w*u,i[7]=C*m-v*u-w*h-E*p,i},ln.rotateByQuatPrepend=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[0],w=o[1],E=o[2],C=o[3];return i[0]=u*C+m*v+h*E-p*w,i[1]=h*C+m*w+p*v-u*E,i[2]=p*C+m*E+u*w-h*v,i[3]=m*C-u*v-h*w-p*E,i[4]=u*(C=o[7])+m*(v=o[4])+h*(E=o[6])-p*(w=o[5]),i[5]=h*C+m*w+p*v-u*E,i[6]=p*C+m*E+u*w-h*v,i[7]=m*C-u*v-h*w-p*E,i},ln.rotateAroundAxis=function(i,n,o,u){if(Math.abs(u)<_r.EPSILON)return qs(i,n);var h=Math.hypot(o[0],o[1],o[2]);u*=.5;var p=Math.sin(u),m=p*o[0]/h,v=p*o[1]/h,w=p*o[2]/h,E=Math.cos(u),C=n[0],P=n[1],M=n[2],z=n[3];i[0]=C*E+z*m+P*w-M*v,i[1]=P*E+z*v+M*m-C*w,i[2]=M*E+z*w+C*v-P*m,i[3]=z*E-C*m-P*v-M*w;var j=n[4],V=n[5],$=n[6],ee=n[7];return i[4]=j*E+ee*m+V*w-$*v,i[5]=V*E+ee*v+$*m-j*w,i[6]=$*E+ee*w+j*v-V*m,i[7]=ee*E-j*m-V*v-$*w,i},ln.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i[6]=n[6]+o[6],i[7]=n[7]+o[7],i},ln.multiply=tc,ln.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7]*o,i},ln.lerp=function(i,n,o,u){var h=1-u;return ad(n,o)<0&&(u=-u),i[0]=n[0]*h+o[0]*u,i[1]=n[1]*h+o[1]*u,i[2]=n[2]*h+o[2]*u,i[3]=n[3]*h+o[3]*u,i[4]=n[4]*h+o[4]*u,i[5]=n[5]*h+o[5]*u,i[6]=n[6]*h+o[6]*u,i[7]=n[7]*h+o[7]*u,i},ln.invert=function(i,n){var o=Ku(n);return i[0]=-n[0]/o,i[1]=-n[1]/o,i[2]=-n[2]/o,i[3]=n[3]/o,i[4]=-n[4]/o,i[5]=-n[5]/o,i[6]=-n[6]/o,i[7]=n[7]/o,i},ln.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i[4]=-n[4],i[5]=-n[5],i[6]=-n[6],i[7]=n[7],i},ln.normalize=function(i,n){var o=Ku(n);if(o>0){o=Math.sqrt(o);var u=n[0]/o,h=n[1]/o,p=n[2]/o,m=n[3]/o,v=n[4],w=n[5],E=n[6],C=n[7],P=u*v+h*w+p*E+m*C;i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=(v-u*P)/o,i[5]=(w-h*P)/o,i[6]=(E-p*P)/o,i[7]=(C-m*P)/o}return i},ln.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},ln.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]},ln.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],C=n[0],P=n[1],M=n[2],z=n[3],j=n[4],V=n[5],$=n[6],ee=n[7];return Math.abs(o-C)<=_r.EPSILON*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(u-P)<=_r.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(h-M)<=_r.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(p-z)<=_r.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(m-j)<=_r.EPSILON*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(v-V)<=_r.EPSILON*Math.max(1,Math.abs(v),Math.abs(V))&&Math.abs(w-$)<=_r.EPSILON*Math.max(1,Math.abs(w),Math.abs($))&&Math.abs(E-ee)<=_r.EPSILON*Math.max(1,Math.abs(E),Math.abs(ee))},ln.sqrLen=ln.squaredLength=ln.len=ln.length=ln.dot=ln.mul=ln.setReal=ln.getReal=void 0;var _r=Gi(we),cr=Gi(Xe),pi=Gi(Gt);function mi(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(mi=function(u){return u?o:n})(i)}function Gi(i,n){if(i&&i.__esModule)return i;if(i===null||Zr(i)!=="object"&&typeof i!="function")return{default:i};var o=mi(n);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}function Ss(i,n,o){var u=.5*o[0],h=.5*o[1],p=.5*o[2],m=n[0],v=n[1],w=n[2],E=n[3];return i[0]=m,i[1]=v,i[2]=w,i[3]=E,i[4]=u*E+h*w-p*v,i[5]=h*E+p*m-u*w,i[6]=p*E+u*v-h*m,i[7]=-u*m-h*v-p*w,i}function qs(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i}function tc(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[4],w=o[5],E=o[6],C=o[7],P=n[4],M=n[5],z=n[6],j=n[7],V=o[0],$=o[1],ee=o[2],pe=o[3];return i[0]=u*pe+m*V+h*ee-p*$,i[1]=h*pe+m*$+p*V-u*ee,i[2]=p*pe+m*ee+u*$-h*V,i[3]=m*pe-u*V-h*$-p*ee,i[4]=u*C+m*v+h*E-p*w+P*pe+j*V+M*ee-z*$,i[5]=h*C+m*w+p*v-u*E+M*pe+j*$+z*V-P*ee,i[6]=p*C+m*E+u*w-h*v+z*pe+j*ee+P*$-M*V,i[7]=m*C-u*v-h*w-p*E+j*pe-P*V-M*$-z*ee,i}ln.getReal=cr.copy,ln.setReal=cr.copy,ln.mul=tc;var ad=cr.dot;ln.dot=ad;var ld=cr.length;ln.length=ld,ln.len=ld;var Ku=cr.squaredLength;ln.squaredLength=Ku,ln.sqrLen=Ku;var Mn={};function zo(i){return zo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zo(i)}Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.create=cd,Mn.clone=function(i){var n=new ea.ARRAY_TYPE(2);return n[0]=i[0],n[1]=i[1],n},Mn.fromValues=function(i,n){var o=new ea.ARRAY_TYPE(2);return o[0]=i,o[1]=n,o},Mn.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i},Mn.set=function(i,n,o){return i[0]=n,i[1]=o,i},Mn.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i},Mn.subtract=oi,Mn.multiply=Wc,Mn.divide=nc,Mn.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i},Mn.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i},Mn.min=function(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i},Mn.max=function(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i},Mn.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i},Mn.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i},Mn.scaleAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i},Mn.distance=rc,Mn.squaredDistance=ep,Mn.length=Hc,Mn.squaredLength=Qu,Mn.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i},Mn.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i},Mn.normalize=function(i,n){var o=n[0],u=n[1],h=o*o+u*u;return h>0&&(h=1/Math.sqrt(h)),i[0]=n[0]*h,i[1]=n[1]*h,i},Mn.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]},Mn.cross=function(i,n,o){var u=n[0]*o[1]-n[1]*o[0];return i[0]=i[1]=0,i[2]=u,i},Mn.lerp=function(i,n,o,u){var h=n[0],p=n[1];return i[0]=h+u*(o[0]-h),i[1]=p+u*(o[1]-p),i},Mn.random=function(i,n){n=n||1;var o=2*ea.RANDOM()*Math.PI;return i[0]=Math.cos(o)*n,i[1]=Math.sin(o)*n,i},Mn.transformMat2=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[2]*h,i[1]=o[1]*u+o[3]*h,i},Mn.transformMat2d=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[2]*h+o[4],i[1]=o[1]*u+o[3]*h+o[5],i},Mn.transformMat3=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[3]*h+o[6],i[1]=o[1]*u+o[4]*h+o[7],i},Mn.transformMat4=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[4]*h+o[12],i[1]=o[1]*u+o[5]*h+o[13],i},Mn.rotate=function(i,n,o,u){var h=n[0]-o[0],p=n[1]-o[1],m=Math.sin(u),v=Math.cos(u);return i[0]=h*v-p*m+o[0],i[1]=h*m+p*v+o[1],i},Mn.angle=function(i,n){var o=i[0],u=i[1],h=n[0],p=n[1],m=Math.sqrt(o*o+u*u)*Math.sqrt(h*h+p*p);return Math.acos(Math.min(Math.max(m&&(o*h+u*p)/m,-1),1))},Mn.zero=function(i){return i[0]=0,i[1]=0,i},Mn.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},Mn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]},Mn.equals=function(i,n){var o=i[0],u=i[1],h=n[0],p=n[1];return Math.abs(o-h)<=ea.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(u-p)<=ea.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))},Mn.forEach=Mn.sqrLen=Mn.sqrDist=Mn.dist=Mn.div=Mn.mul=Mn.sub=Mn.len=void 0;var ea=function(i,n){if(i&&i.__esModule)return i;if(i===null||zo(i)!=="object"&&typeof i!="function")return{default:i};var o=Gc(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(we);function Gc(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Gc=function(u){return u?o:n})(i)}function cd(){var i=new ea.ARRAY_TYPE(2);return ea.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function oi(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i}function Wc(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i}function nc(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i}function rc(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1])}function ep(i,n){var o=n[0]-i[0],u=n[1]-i[1];return o*o+u*u}function Hc(i){return Math.hypot(i[0],i[1])}function Qu(i){var n=i[0],o=i[1];return n*n+o*o}Mn.len=Hc,Mn.sub=oi,Mn.mul=Wc,Mn.div=nc,Mn.dist=rc,Mn.sqrDist=ep,Mn.sqrLen=Qu;var ud=function(){var i=cd();return function(n,o,u,h,p,m){var v,w;for(o||(o=2),u||(u=0),w=h?Math.min(h*o+u,n.length):n.length,v=u;v<w;v+=o)i[0]=n[v],i[1]=n[v+1],p(i,i,m),n[v]=i[0],n[v+1]=i[1];return n}}();function hd(i){return hd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},hd(i)}Mn.forEach=ud,Object.defineProperty(Te,"__esModule",{value:!0}),a.aB=Te.vec4=a.$=Te.vec3=Te.vec2=Te.quat2=a.aw=Te.quat=a.ae=Te.mat4=a.bE=Te.mat3=Te.mat2d=a.aD=Te.mat2=Te.glMatrix=void 0;var lg=So(we);Te.glMatrix=lg;var Zc=So(be);a.aD=Te.mat2=Zc;var Eo=So(kt);Te.mat2d=Eo;var ur=So(wt);a.bE=Te.mat3=ur;var cg=So(Gt);a.ae=Te.mat4=cg;var ug=So(Xe);a.aw=Te.quat=ug;var Xc=So(ln);Te.quat2=Xc;var hg=So(Mn);Te.vec2=hg;var u0=So(ut);a.$=Te.vec3=u0;var tp=So(dn);function No(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(No=function(u){return u?o:n})(i)}function So(i,n){if(i&&i.__esModule)return i;if(i===null||hd(i)!=="object"&&typeof i!="function")return{default:i};var o=No(n);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}a.aB=Te.vec4=tp;var dg=Kc;function Kc(i,n,o,u){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=o,this.p2y=u}Kc.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,n){if(n===void 0&&(n=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,u=0;u<8;u++){var h=this.sampleCurveX(o)-i;if(Math.abs(h)<n)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=h/p}var m=0,v=1;for(o=i,u=0;u<20&&(h=this.sampleCurveX(o),!(Math.abs(h-i)<n));u++)i>h?m=o:v=o,o=.5*(v-m)+m;return o},solve:function(i,n){return this.sampleCurveY(this.solveCurveX(i,n))}};var Qc=de(dg),Yc=ta;function ta(i,n){this.x=i,this.y=n}ta.prototype={clone:function(){return new ta(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,n){return this.clone()._rotateAround(i,n)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var n=i.x-this.x,o=i.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,n){return Math.atan2(this.x*n-this.y*i,this.x*i+this.y*n)},_matMult:function(i){var n=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=n,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var n=Math.cos(i),o=Math.sin(i),u=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=u,this},_rotateAround:function(i,n){var o=Math.cos(i),u=Math.sin(i),h=n.y+u*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-u*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ta.convert=function(i){return i instanceof ta?i:Array.isArray(i)?new ta(i[0],i[1]):i};var Lt=de(Yc);function ic(i,n){if(Array.isArray(i)){if(!Array.isArray(n)||i.length!==n.length)return!1;for(let o=0;o<i.length;o++)if(!ic(i[o],n[o]))return!1;return!0}if(typeof i=="object"&&i!==null&&n!==null){if(typeof n!="object"||Object.keys(i).length!==Object.keys(n).length)return!1;for(const o in i)if(!ic(i[o],n[o]))return!1;return!0}return i===n}const dd=Math.PI/180,ai=180/Math.PI;function er(i){return i*dd}function eo(i){return i*ai}const Jc=[[0,0],[1,0],[1,1],[0,1]];function Yu(i){if(i<=0)return 0;if(i>=1)return 1;const n=i*i,o=n*i;return 4*(i<.5?o:3*(i-n)+o-.75)}function Ju(i,n,o,u){const h=new Qc(i,n,o,u);return function(p){return h.solve(p)}}const mo=Ju(.25,.1,.25,1);function Wn(i,n,o){return Math.min(o,Math.max(n,i))}function na(i,n,o){return(o=Wn((o-i)/(n-i),0,1))*o*(3-2*o)}function sc(i,n,o){const u=o-n,h=((i-n)%u+u)%u+n;return h===n?o:h}function eh(i,n,o){if(!i.length)return o(null,[]);let u=i.length;const h=new Array(i.length);let p=null;i.forEach((m,v)=>{n(m,(w,E)=>{w&&(p=w),h[v]=E,--u==0&&o(p,h)})})}function oc(i){const n=[];for(const o in i)n.push(i[o]);return n}function Is(i,...n){for(const o of n)for(const u in o)i[u]=o[u];return i}let fd=1;function ac(){return fd++}function lc(){return function i(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ea(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function np(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function th(i,n){i.forEach(o=>{n[o]&&(n[o]=n[o].bind(n))})}function Ha(i,n){return i.indexOf(n,i.length-n.length)!==-1}function eu(i,n,o){const u={};for(const h in i)u[h]=n.call(this,i[h],h,i);return u}function Cs(i,n,o){const u={};for(const h in i)n.call(this,i[h],h,i)&&(u[h]=i[h]);return u}function zs(i){return Array.isArray(i)?i.map(zs):typeof i=="object"&&i?eu(i,zs):i}const fs={};function bi(i){fs[i]||(typeof console<"u"&&console.warn(i),fs[i]=!0)}function ra(i,n,o){return(o.y-i.y)*(n.x-i.x)>(n.y-i.y)*(o.x-i.x)}function fg(i){let n=0;for(let o,u,h=0,p=i.length,m=p-1;h<p;m=h++)o=i[h],u=i[m],n+=(u.x-o.x)*(o.y+u.y);return n}function cc([i,n,o]){const u=er(n+90),h=er(o);return{x:i*Math.cos(u)*Math.sin(h),y:i*Math.sin(u)*Math.sin(h),z:i*Math.cos(h),azimuthal:n,polar:o}}function Fo(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function tu(i){const n={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,h,p)=>{const m=h||p;return n[u]=!m||m.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let pd,nu,Za,El,os,ru,iu=null;function Xa(i){try{const n=self[i];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}function R(i,n){return[i[4*n],i[4*n+1],i[4*n+2],i[4*n+3]]}function K(i,n,o,u){for(;n<o;){const h=n+o>>1;i[h]<u?n=h+1:o=h}return n}function ue(i,n,o,u){for(;n<o;){const h=n+o>>1;i[h]<=u?n=h+1:o=h}return n}function Me(i){return i>0?1/(1.001-i):1+i}function dt(i){return i>0?1-1/(1.001-i):-i}function It(){return pd==null&&(pd=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),pd}const en={now:()=>El!==void 0?El:performance.now(),setNow(i){El=i},restoreNow(){El=void 0},frame(i){const n=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(i,n=0){const{width:o,height:u}=i;os||(os=document.createElement("canvas"));const h=os.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>os.width||u>os.height)&&(os.width=o,os.height=u),h.clearRect(-n,-n,o+2*n,u+2*n),h.drawImage(i,0,0,o,u),h.getImageData(-n,-n,o+2*n,u+2*n)},resolveURL:i=>(nu||(nu=document.createElement("a")),nu.href=i,nu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Za==null&&(Za=window.matchMedia("(prefers-reduced-motion: reduce)")),Za.matches)},hasCanvasFingerprintNoise(){if(ru!==void 0)return ru;if(!It())return ru=!1,!1;const i=new OffscreenCanvas(85,1),n=i.getContext("2d",{willReadFrequently:!0});let o=0;for(let h=0;h<i.width;++h)n.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,n.fillRect(h,0,1,1);const u=n.getImageData(0,0,i.width,i.height);o=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&o++!==u.data[h])return ru=!0,!0;return ru=!1,!1}};function ii(i,n){const o=i.indexOf("?");if(o<0)return`${i}?${new URLSearchParams(n).toString()}`;const u=new URLSearchParams(i.slice(o));for(const h in n)u.set(h,n[h]);return`${i.slice(0,o)}?${u.toString()}`}function ps(i,n={persistentParams:[]}){const o=i.indexOf("?");if(o<0)return i;const u=new URLSearchParams,h=new URLSearchParams(i.slice(o));for(const m of n.persistentParams){const v=h.get(m);v&&u.set(m,v)}const p=u.toString();return`${i.slice(0,o)}${p.length>0?`?${p}`:""}`}const Ur="mapbox-tiles";let As=500,Ps=50;const uc=["language","worldview","jobid"];let as,hc;function md(){try{return caches}catch{}}function rp(){const i=md();i&&!as&&(as=i.open(Ur))}let pg=1/0;const mg={supported:!1,testSupport:function(i){!gg&&gd&&(Cb?h0(i):ip=i)}};let ip,gd,gg=!1,Cb=!1;const Ab=typeof self<"u"?self:{};function h0(i){const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,gd),i.isContextLost())return;mg.supported=!0}catch{}i.deleteTexture(n),gg=!0}Ab.document&&(gd=Ab.document.createElement("img"),gd.onload=function(){ip&&h0(ip),ip=null,Cb=!0},gd.onerror=function(){gg=!0,ip=null},gd.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const sp={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(sp);class _g extends Error{constructor(n,o,u){o===401&&F(u)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const d0=Fo()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Sl=function(i,n){if(!(/^file:/.test(o=i.url)||/^file:/.test(d0())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,h){const p=new AbortController,m=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:d0(),referrerPolicy:u.referrerPolicy,signal:p.signal});let v=!1,w=!1;const E=(C=m.url).indexOf("sku=")>0&&F(C);var C;u.type==="json"&&m.headers.set("Accept","application/json");const P=(z,j,V)=>{if(w)return;if(z&&z.message!=="SecurityError"&&bi(z.toString()),j&&V)return M(j);const $=Date.now();fetch(m).then(ee=>{if(ee.ok){const pe=E?ee.clone():null;return M(ee,pe,$)}return h(new _g(ee.statusText,ee.status,u.url))}).catch(ee=>{ee.name!=="AbortError"&&h(new Error(`${ee.message} ${u.url}`))})},M=(z,j,V)=>{(u.type==="arrayBuffer"?z.arrayBuffer():u.type==="json"?z.json():z.text()).then($=>{w||(j&&V&&function(ee,pe,fe){if(rp(),!as)return;const me=tu(pe.headers.get("Cache-Control")||"");if(me["no-store"])return;const Ce={status:pe.status,statusText:pe.statusText,headers:new Headers};pe.headers.forEach(($e,Ze)=>Ce.headers.set(Ze,$e)),me["max-age"]&&Ce.headers.set("Expires",new Date(fe+1e3*me["max-age"]).toUTCString());const Ae=Ce.headers.get("Expires");if(!Ae||new Date(Ae).getTime()-fe<42e4)return;let Le=ps(ee.url,{persistentParams:uc});if(pe.status===206){const $e=ee.headers.get("Range");if(!$e)return;Ce.status=200,Le=ii(Le,{range:$e})}(function($e,Ze){if(hc===void 0)try{new Response(new ReadableStream),hc=!0}catch{hc=!1}hc?Ze($e.body):$e.blob().then(Ze)})(pe,$e=>{const Ze=new Response((nt=pe.status)!==200&&nt!==404&&[101,103,204,205,304].includes(nt)?null:$e,Ce);var nt;rp(),as&&as.then(Ke=>Ke.put(Le,Ze)).catch(Ke=>bi(Ke.message))})}(m,j,V),v=!0,h(null,$,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch($=>{w||h(new Error($.message))})};return E?function(z,j){if(rp(),!as)return j(null);as.then(V=>{let $=ps(z.url,{persistentParams:uc});const ee=z.headers.get("Range");ee&&($=ii($,{range:ee})),V.match($).then(pe=>{const fe=function(me){if(!me)return!1;const Ce=new Date(me.headers.get("Expires")||0),Ae=tu(me.headers.get("Cache-Control")||"");return Ce>Date.now()&&!Ae["no-cache"]}(pe);V.delete($),fe&&V.put($,pe.clone()),j(null,pe,fe)}).catch(j)}).catch(j)}(m,P):P(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(i,n);if(Fo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,n,void 0,!0)}var o;return function(u,h){const p=new XMLHttpRequest;p.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in u.headers)p.setRequestHeader(m,u.headers[m]);return u.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=u.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(u.type==="json")try{m=JSON.parse(p.response)}catch(v){return h(v)}h(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new _g(p.statusText,p.status,u.url))},p.send(u.body),{cancel:()=>p.abort()}}(i,n)},nh=function(i,n){return Sl(Is(i,{type:"arrayBuffer"}),n)};function pA(i){const n=document.createElement("a");return n.href=i,n.protocol===location.protocol&&n.host===location.host}const Pb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let op,_d;op=[],_d=0;const ap=function(i,n){if(mg.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),_d>=O.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return op.push(p),p}_d++;let o=!1;const u=()=>{if(!o)for(o=!0,_d--;op.length&&_d<O.MAX_PARALLEL_IMAGE_REQUESTS;){const p=op.shift(),{requestParameters:m,callback:v,cancelled:w}=p;w||(p.cancel=ap(m,v).cancel)}},h=nh(i,(p,m,v,w)=>{u(),p?n(p):m&&(self.createImageBitmap?function(E,C){const P=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(P).then(M=>{C(null,M)}).catch(M=>{C(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,C)=>n(E,C,v,w)):function(E,C){const P=new Image;P.onload=()=>{C(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=Pb})},P.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?URL.createObjectURL(M):Pb}(m,(E,C)=>n(E,C,v,w)))});return{cancel:()=>{h.cancel(),u()}}},f0="01",p0="NO_ACCESS_TOKEN",mA=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Sa(i){const n=i.match(mA);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function rh(i){const n=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${n}`}const m0="mapbox.eventData";function Rb(i){if(!i)return null;const n=i.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(n[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ih{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const o=Rb(O.ACCESS_TOKEN);let u="";return u=o&&o.u?btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):O.ACCESS_TOKEN||"",n?`${m0}.${n}:${u}`:`${m0}:${u}`}fetchEventData(){const n=Xa("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{const h=localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));const p=localStorage.getItem(u);p&&(this.anonId=p)}catch{bi("Unable to read from LocalStorage")}}saveEventData(){const n=Xa("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid"),h=this.anonId;if(n&&h)try{localStorage.setItem(u,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{bi("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,o,u,h){if(!O.EVENTS_URL)return;const p=Sa(O.EVENTS_URL);p.params.push(`access_token=${h||O.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(n).toISOString()},v=o?Is(m,o):m,w={url:rh(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=function(E,C){return Sl(Is(E,{method:"POST"}),C)}(w,E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(h)})}queueRequest(n,o){this.queue.push(n),this.processRequests(o)}}const Mb=new class extends ih{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,n){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(i)&&i.some(o=>Z(o)||F(o))&&this.queueRequest(Date.now(),n)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Rb(O.ACCESS_TOKEN),o=n?n.u:O.ACCESS_TOKEN;let u=o!==this.eventData.tokenU;np(this.anonId)||(this.anonId=lc(),u=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),m=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;u=u||v>=1||v<-1||p.getDate()!==m.getDate()}else u=!0;u?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:f0,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=o)},i):this.processRequests()}},g0=Mb.postTurnstileEvent.bind(Mb),yd=new class extends ih{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,n,o,u){this.skuToken=n,this.errorCb=u,O.EVENTS_URL&&(o||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(p0)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),np(this.anonId)||(this.anonId=lc()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:f0,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},i))}remove(){this.errorCb=null}},kb=yd.postMapLoadEvent.bind(yd),lp=new class extends ih{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let n=this.mapInstanceIdMap.get(i);return n||(n=lc(),this.mapInstanceIdMap.set(i,n)),n}getEventId(i){const n=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,n+1),n}postStyleLoadEvent(i,n){const{map:o,style:u,importedStyles:h}=n;if(!O.EVENTS_URL||!i&&!O.ACCESS_TOKEN)return;const p=this.getMapInstanceId(o),m={mapInstanceId:p,eventId:this.getEventId(p),style:u};h.length&&(m.importedStyles=h),this.queueRequest({timestamp:Date.now(),payload:m},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:o}=this.queue.shift();this.postEvent(n,o,()=>{},i)}},Db=lp.postStyleLoadEvent.bind(lp),Ob=new class extends ih{constructor(){super("gljs.performance")}postPerformanceEvent(i,n){O.EVENTS_URL&&(i||O.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:o}=this.queue.shift(),u=function(h){const p=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),v=function(z){const j={};if(z){for(const V in z)if(V!=="other")for(const $ of z[V]){const ee=`${V}ResolveRangeMin`,pe=`${V}ResolveRangeMax`,fe=`${V}RequestCount`,me=`${V}RequestCachedCount`;j[ee]=Math.min(j[ee]||1/0,$.startTime),j[pe]=Math.max(j[pe]||-1/0,$.responseEnd);const Ce=Ae=>{j[Ae]===void 0&&(j[Ae]=0),++j[Ae]};$.transferSize!==void 0&&$.transferSize===0&&Ce(me),Ce(fe)}}return j}(function(z,j){const V={};if(z)for(const $ of z){const ee=j($);V[ee]===void 0&&(V[ee]=[]),V[ee].push($)}return V}(p,Q)),w=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,C=E?E.effectiveType:void 0,P={counters:[],metadata:[],attributes:[]},M=(z,j,V)=>{V!=null&&z.push({name:j,value:V.toString()})};for(const z in v)M(P.counters,z,v[z]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(M(P.counters,"interactionRangeMin",h.interactionRange[0]),M(P.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const z of Object.keys(G)){const j=G[z],V=m.find($=>$.name===j);V&&M(P.counters,j,V.startTime)}return M(P.counters,"visibilityHidden",h.visibilityHidden),M(P.attributes,"style",function(z){if(z)for(const j of z){const V=j.name.split("?")[0];if(ne(V)){const $=V.split("/").slice(-2);if($.length===2)return`mapbox://styles/${$[0]}/${$[1]}`}}}(p)),M(P.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),M(P.attributes,"fogEnabled",h.fogEnabled?"true":"false"),M(P.attributes,"projection",h.projection),M(P.attributes,"zoom",h.zoom),M(P.metadata,"devicePixelRatio",w),M(P.metadata,"connectionEffectiveType",C),M(P.metadata,"navigatorUserAgent",navigator.userAgent),M(P.metadata,"screenWidth",window.screen.width),M(P.metadata,"screenHeight",window.screen.height),M(P.metadata,"windowWidth",window.innerWidth),M(P.metadata,"windowHeight",window.innerHeight),M(P.metadata,"mapWidth",h.width/w),M(P.metadata,"mapHeight",h.height/w),M(P.metadata,"webglRenderer",h.renderer),M(P.metadata,"webglVendor",h.vendor),M(P.metadata,"sdkVersion",I),M(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(o);for(const h of u.metadata);for(const h of u.counters);for(const h of u.attributes);this.postEvent(n,u,()=>{},i)}},gA=Ob.postPerformanceEvent.bind(Ob),cp=new class extends ih{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,n,o,u){if(!O.API_URL||!O.SESSION_PATH)return;const h=Sa(O.API_URL+O.SESSION_PATH);h.params.push(`sku=${n||""}`),h.params.push(`access_token=${u||O.ACCESS_TOKEN||""}`);const p={url:rh(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,v){return Sl(Is(m,{method:"GET"}),v)}(p,m=>{this.pendingRequest=null,o(m),this.saveEventData(),this.processRequests(u)})}getSessionAPI(i,n,o,u){this.skuToken=n,this.errorCb=u,O.SESSION_PATH&&O.API_URL&&(o||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(p0)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||this.getSession(o,this.skuToken,u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},i)}remove(){this.errorCb=null}},_0=cp.getSessionAPI.bind(cp),up=new Set;var sh={exports:{}},vd={exports:function(i,n){var o,u,h,p,m,v,w,E;for(u=i.length-(o=3&i.length),h=n,m=3432918353,v=461845907,E=0;E<u;)w=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,h=27492+(65535&(p=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,o){case 3:w^=(255&i.charCodeAt(E+2))<<16;case 2:w^=(255&i.charCodeAt(E+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(E)))*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}},_A={exports:function(i,n){for(var o,u=i.length,h=n^u,p=0;u>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:h^=(255&i.charCodeAt(p+2))<<16;case 2:h^=(255&i.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}},Lb=vd.exports,yA=_A.exports;sh.exports=Lb,sh.exports.murmur3=Lb,sh.exports.murmur2=yA;var yg=de(sh.exports);class Il{constructor(n,...o){Is(this,o[0]||{}),this.type=n}}class hp extends Il{constructor(n,o={}){super("error",Is({error:n},o))}}function vg(i,n,o){o[i]&&o[i].indexOf(n)!==-1||(o[i]=o[i]||[],o[i].push(n))}function y0(i,n,o){if(o&&o[i]){const u=o[i].indexOf(n);u!==-1&&o[i].splice(u,1)}}class oh{on(n,o){return this._listeners=this._listeners||{},vg(n,o,this._listeners),this}off(n,o){return y0(n,o,this._listeners),y0(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},vg(n,o,this._oneTimeListeners),this):new Promise(u=>this.once(n,u))}fire(n,o){const u=typeof n=="string"?new Il(n,o):n,h=u.type;if(this.listens(h)){u.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of p)w.call(this,u);const m=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of m)y0(h,w,this._oneTimeListeners),w.call(this,u);const v=this._eventedParent;v&&(Is(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(u))}else u instanceof hp&&console.error(u.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}a.G=void 0;var zb={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function xg(i){return(i=Math.round(i))<0?0:i>255?255:i}function v0(i){return xg(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function bg(i){return(n=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:n>1?1:n;var n}function x0(i,n,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(n-i)*o*6:2*o<1?n:3*o<2?i+(n-i)*(2/3-o)*6:i}try{a.G={}.parseCSSColor=function(i){var n,o=i.replace(/ /g,"").toLowerCase();if(o in zb)return zb[o].slice();if(o[0]==="#")return o.length===4?(n=parseInt(o.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:o.length===7&&(n=parseInt(o.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var u=o.indexOf("("),h=o.indexOf(")");if(u!==-1&&h+1===o.length){var p=o.substr(0,u),m=o.substr(u+1,h-(u+1)).split(","),v=1;switch(p){case"rgba":if(m.length!==4)return null;v=bg(m.pop());case"rgb":return m.length!==3?null:[v0(m[0]),v0(m[1]),v0(m[2]),v];case"hsla":if(m.length!==4)return null;v=bg(m.pop());case"hsl":if(m.length!==3)return null;var w=(parseFloat(m[0])%360+360)%360/360,E=bg(m[1]),C=bg(m[2]),P=C<=.5?C*(E+1):C+E-C*E,M=2*C-P;return[xg(255*x0(M,P,w+1/3)),xg(255*x0(M,P,w)),xg(255*x0(M,P,w-1/3)),v];default:return null}}return null}}catch{}class Er{constructor(n,o,u,h=1){this.r=n,this.g=o,this.b=u,this.a=h}static parse(n){if(!n)return;if(n instanceof Er)return n;if(typeof n!="string")return;const o=a.G(n);return o?new Er(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[n,o,u,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(o)},${Math.round(u)},${h})`}toRenderColor(n){const{r:o,g:u,b:h,a:p}=this;return new vA(n,o,u,h,p)}}class vA{constructor(n,o,u,h,p){if(n){const m=n.image.height,v=m*m;o=p===0?0:o/p*(m-1),u=p===0?0:u/p*(m-1),h=p===0?0:h/p*(m-1);const w=Math.floor(o),E=Math.floor(u),C=Math.floor(h),P=Math.ceil(o),M=Math.ceil(u),z=Math.ceil(h),j=o-w,V=u-E,$=h-C,ee=n.image.data,pe=4*(w+E*v+C*m),fe=4*(w+E*v+z*m),me=4*(w+M*v+C*m),Ce=4*(w+M*v+z*m),Ae=4*(P+E*v+C*m),Le=4*(P+E*v+z*m),$e=4*(P+M*v+C*m),Ze=4*(P+M*v+z*m);if(pe<0||Ze>=ee.length)throw new Error("out of range");this.r=xn(xn(xn(ee[pe],ee[fe],$),xn(ee[me],ee[Ce],$),V),xn(xn(ee[Ae],ee[Le],$),xn(ee[$e],ee[Ze],$),V),j)/255*p,this.g=xn(xn(xn(ee[pe+1],ee[fe+1],$),xn(ee[me+1],ee[Ce+1],$),V),xn(xn(ee[Ae+1],ee[Le+1],$),xn(ee[$e+1],ee[Ze+1],$),V),j)/255*p,this.b=xn(xn(xn(ee[pe+2],ee[fe+2],$),xn(ee[me+2],ee[Ce+2],$),V),xn(xn(ee[Ae+2],ee[Le+2],$),xn(ee[$e+2],ee[Ze+2],$),V),j)/255*p,this.a=p}else this.r=o,this.g=u,this.b=h,this.a=p}toArray(){const{r:n,g:o,b:u,a:h}=this;return h===0?[0,0,0,0]:[255*n/h,255*o/h,255*u/h,h]}toArray01(){const{r:n,g:o,b:u,a:h}=this;return h===0?[0,0,0,0]:[n/h,o/h,u/h,h]}toArray01Scaled(n){const{r:o,g:u,b:h,a:p}=this;return p===0?[0,0,0]:[o/p*n,u/p*n,h/p*n]}toArray01PremultipliedAlpha(){const{r:n,g:o,b:u,a:h}=this;return[n,o,u,h]}toArray01Linear(){const{r:n,g:o,b:u,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(n/h,2.2),Math.pow(o/h,2.2),Math.pow(u/h,2.2),h]}}function xn(i,n,o){return i*(1-o)+n*o}function b0(i,n,o){return i.map((u,h)=>xn(u,n[h],o))}Er.black=new Er(0,0,0,1),Er.white=new Er(1,1,1,1),Er.transparent=new Er(0,0,0,0),Er.red=new Er(1,0,0,1),Er.blue=new Er(0,0,1,1);var dp=Object.freeze({__proto__:null,array:b0,color:function(i,n,o){return new Er(xn(i.r,n.r,o),xn(i.g,n.g,o),xn(i.b,n.b,o),xn(i.a,n.a,o))},number:xn});function xd(i,...n){for(const o of n)for(const u in o)i[u]=o[u];return i}class Cl extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}class w0{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[u,h]of o)this.bindings[u]=h}concat(n){return new w0(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const ia={kind:"null"},Jt={kind:"number"},yr={kind:"string"},Ir={kind:"boolean"},Ia={kind:"color"},bd={kind:"object"},br={kind:"value"},wg={kind:"collator"},wd={kind:"formatted"},ah={kind:"resolvedImage"};function to(i,n){return{kind:"array",itemType:i,N:n}}function ki(i){if(i.kind==="array"){const n=ki(i.itemType);return typeof i.N=="number"?`array<${n}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${n}>`}return i.kind}const T0=[ia,Jt,yr,Ir,Ia,wd,bd,to(br),ah];function fp(i,n){if(n.kind==="error")return null;if(i.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!fp(i.itemType,n.itemType))&&(typeof i.N!="number"||i.N===n.N))return null}else{if(i.kind===n.kind)return null;if(i.kind==="value"){for(const o of T0)if(!fp(o,n))return null}}return`Expected ${ki(i)} but found ${ki(n)} instead.`}function Ca(i,n){return n.some(o=>o.kind===i.kind)}function pp(i,n){return n.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}class Tg{constructor(n,o,u){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Eg{constructor(n,o,u,h,p){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=u,this.fontStack=h,this.textColor=p}}class go{constructor(n){this.sections=n}static fromString(n){return new go([new Eg(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof go?n:go.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){n.push(["image",o.image.namePrimary]);continue}n.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),n.push(u)}return n}}class sa{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,o){return n?new sa({namePrimary:n,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Nb(i,n,o,u){return typeof i=="number"&&i>=0&&i<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[i,n,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[i,n,o,u]:[i,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Td(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Er||i instanceof Tg||i instanceof go||i instanceof sa)return!0;if(Array.isArray(i)){for(const n of i)if(!Td(n))return!1;return!0}if(typeof i=="object"){for(const n in i)if(!Td(i[n]))return!1;return!0}return!1}function ls(i){if(i===null)return ia;if(typeof i=="string")return yr;if(typeof i=="boolean")return Ir;if(typeof i=="number")return Jt;if(i instanceof Er)return Ia;if(i instanceof Tg)return wg;if(i instanceof go)return wd;if(i instanceof sa)return ah;if(Array.isArray(i)){const n=i.length;let o;for(const u of i){const h=ls(u);if(o){if(o===h)continue;o=br;break}o=h}return to(o||br,n)}return bd}function Ka(i){const n=typeof i;return i===null?"":n==="string"||n==="number"||n==="boolean"?String(i):i instanceof Er||i instanceof go||i instanceof sa?i.toString():JSON.stringify(i)}class Qa{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Td(n[1]))return o.error("invalid value");const u=n[1];let h=ls(u);const p=o.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Qa(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Er?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof go?this.value.serialize():this.value}}class ms{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const E0={string:yr,number:Jt,boolean:Ir,object:bd};class oa{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let u,h=1;const p=n[0];if(p==="array"){let v,w;if(n.length>2){const E=n[1];if(typeof E!="string"||!(E in E0)||E==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);v=E0[E],h++}else v=br;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);w=n[2],h++}u=to(v,w)}else u=E0[p];const m=[];for(;h<n.length;h++){const v=o.parse(n[h],h,br);if(!v)return null;m.push(v)}return new oa(u,m)}evaluate(n){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(n);if(!fp(this.type,ls(u)))return u;if(o===this.args.length-1)throw new ms(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${ki(ls(u))} but was expected to be of type ${ki(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const h=n.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(u=>u.serialize()))}}class lh{constructor(n){this.type=wd,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const h=[];let p=!1;for(let m=1;m<=n.length-1;++m){const v=n[m];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=o.parse(v["font-scale"],1,Jt),!w))return null;let E=null;if(v["text-font"]&&(E=o.parse(v["text-font"],1,to(yr)),!E))return null;let C=null;if(v["text-color"]&&(C=o.parse(v["text-color"],1,Ia),!C))return null;const P=h[h.length-1];P.scale=w,P.font=E,P.textColor=C}else{const w=o.parse(n[m],1,br);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new lh(h)}evaluate(n){return new go(this.sections.map(o=>{const u=o.content.evaluate(n);return ls(u)===ah?new Eg("",u,null,null,null):new Eg(Ka(u),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),n.push(u)}return n}}class dc{constructor(n,o){this.type=ah,this.inputPrimary=n,this.inputSecondary=o}static parse(n,o){if(n.length<2)return o.error("Expected two or more arguments.");const u=o.parse(n[1],1,yr);if(!u)return o.error("No image name provided.");if(n.length===2)return new dc(u);const h=o.parse(n[2],1,yr);return h?new dc(u,h):o.error("Secondary image variant is not a string.")}evaluate(n){const o=sa.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return o&&n.availableImages&&(o.available=n.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&n.availableImages&&(o.available=n.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function su(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}const xA={"to-boolean":Ir,"to-color":Ia,"to-number":Jt,"to-string":yr};class fc{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[0],h=[];let p=ia;if(u==="to-array"){if(!Array.isArray(n[1]))return null;const m=n[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);p=to(o.expectedType.itemType,m)}else{if(!(m>0&&Td(n[1][0])))return null;p=to(ls(n[1][0]),m)}for(let v=0;v<m;v++){const w=n[1][v];let E;if(su(w)==="array")E=o.parse(w,void 0,p.itemType);else{const C=su(w);if(C!==p.itemType.kind)return o.error(`Expected ${p.itemType.kind} but found ${C}.`);E=o.registry.literal.parse(["literal",w===void 0?null:w],o)}if(!E)return null;h.push(E)}}else{if((u==="to-boolean"||u==="to-string")&&n.length!==2)return o.error("Expected one argument.");p=xA[u];for(let m=1;m<n.length;m++){const v=o.parse(n[m],m,br);if(!v)return null;h.push(v)}}return new fc(p,h)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,u;for(const h of this.args){if(o=h.evaluate(n),u=null,o instanceof Er)return o;if(typeof o=="string"){const p=n.parseColor(o);if(p)return p}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Nb(o[0],o[1],o[2],o[3]),!u))return new Er(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ms(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(n),o===null)return 0;const h=Number(o);if(!isNaN(h))return h}throw new ms(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?go.fromString(Ka(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?sa.fromString(Ka(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(o=>o.evaluate(n)):Ka(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new lh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new dc(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{n.push(o.serialize())}),n}}const bA=["Unknown","Point","LineString","Polygon"];class S0{constructor(n,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bA[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-n[0])+this.featureDistanceData.bearing[1]*(h*o-n[1])}return 0}parseColor(n){let o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=Er.parse(n)),o}getConfig(n){return this.options?this.options.get(n):null}}class Bo{constructor(n,o,u,h,p){this.name=n,this.type=o,this._evaluate=u,this.args=h,this._overloadIndex=p}evaluate(n){if(!this._evaluate){const o=Bo.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,o){const u=n[0],h=Bo.definitions[u];if(!h)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[];let w=null,E=-1;for(const[C,P]of m){if(Array.isArray(C)&&C.length!==n.length-1)continue;v.push(C),E++,w=new ew(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const M=[];let z=!1;for(let j=1;j<n.length;j++){const V=n[j],$=Array.isArray(C)?C[j-1]:C.type,ee=w.parse(V,1+M.length,$);if(!ee){z=!0;break}M.push(ee)}if(!z)if(Array.isArray(C)&&C.length!==M.length)w.error(`Expected ${C.length} arguments, but found ${M.length} instead.`);else{for(let j=0;j<M.length;j++){const V=Array.isArray(C)?C[j]:C.type,$=M[j];w.concat(j+1).checkSubtype(V,$.type)}if(w.errors.length===0)return new Bo(u,p,P,M,E)}}if(v.length===1)o.errors.push(...w.errors);else{const C=(v.length?v:m.map(([M])=>M)).map(wA).join(" | "),P=[];for(let M=1;M<n.length;M++){const z=o.parse(n[M],1+P.length);if(!z)return null;P.push(ki(z.type))}o.error(`Expected arguments of type ${C}, but found (${P.join(", ")}) instead.`)}return null}static register(n,o){Bo.definitions=o;for(const u in o)n[u]=Bo}}function wA(i){return Array.isArray(i)?`(${i.map(ki).join(", ")})`:`(${ki(i.type)}...)`}class mp{constructor(n,o,u){this.type=wg,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const u=n[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Ir);if(!h)return null;const p=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Ir);if(!p)return null;let m=null;return u.locale&&(m=o.parse(u.locale,1,yr),!m)?null:new mp(h,p,m)}evaluate(n){return new Tg(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function Sr(i,n,o=0,u=i.length-1,h=Fb){for(;u>o;){if(u-o>600){const w=u-o+1,E=n-o+1,C=Math.log(w),P=.5*Math.exp(2*C/3),M=.5*Math.sqrt(C*P*(w-P)/w)*(E-w/2<0?-1:1);Sr(i,n,Math.max(o,Math.floor(n-E*P/w+M)),Math.min(u,Math.floor(n+(w-E)*P/w+M)),h)}const p=i[n];let m=o,v=u;for(Ed(i,o,n),h(i[u],p)>0&&Ed(i,o,u);m<v;){for(Ed(i,m,v),m++,v--;h(i[m],p)<0;)m++;for(;h(i[v],p)>0;)v--}h(i[o],p)===0?Ed(i,o,v):(v++,Ed(i,v,u)),v<=n&&(o=v+1),n<=v&&(u=v-1)}}function Ed(i,n,o){const u=i[n];i[n]=i[o],i[o]=u}function Fb(i,n){return i<n?-1:i>n?1:0}function TA(i){let n=0;for(let o,u,h=0,p=i.length,m=p-1;h<p;m=h++)o=i[h],u=i[m],n+=(u.x-o.x)*(o.y+u.y);return n}function gp(i,n){i[0]=Math.min(i[0],n[0]),i[1]=Math.min(i[1],n[1]),i[2]=Math.max(i[2],n[0]),i[3]=Math.max(i[3],n[1])}function ou(i,n){return!(i[0]<=n[0]||i[2]>=n[2]||i[1]<=n[1]||i[3]>=n[3])}function Sg(i,n,o){const u=i[0]-n[0],h=i[1]-n[1],p=i[0]-o[0],m=i[1]-o[1];return u*m-p*h==0&&u*p<=0&&h*m<=0}function pc(i,n,o=!1){let u=!1;for(let v=0,w=n.length;v<w;v++){const E=n[v];for(let C=0,P=E.length,M=P-1;C<P;M=C++){const z=E[M],j=E[C];if(Sg(i,z,j))return o;(p=z)[1]>(h=i)[1]!=(m=j)[1]>h[1]&&h[0]<(m[0]-p[0])*(h[1]-p[1])/(m[1]-p[1])+p[0]&&(u=!u)}}var h,p,m;return u}function Bb(i,n,o,u){const h=u[0]-o[0],p=u[1]-o[1],m=(i[0]-o[0])*p-h*(i[1]-o[1]),v=(n[0]-o[0])*p-h*(n[1]-o[1]);return m>0&&v<0||m<0&&v>0}function _p(i,n,o,u){return(h=[u[0]-o[0],u[1]-o[1]])[0]*(p=[n[0]-i[0],n[1]-i[1]])[1]-h[1]*p[0]!=0&&!(!Bb(i,n,o,u)||!Bb(o,u,i,n));var h,p}const no=8192;function EA(i,n){const o=(180+i[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(o*h*no),Math.round(u*h*no)]}function jb(i,n){for(let o=0;o<n.length;o++)if(pc(i,n[o]))return!0;return!1}function yp(i,n,o){for(const u of o)for(let h=0,p=u.length,m=p-1;h<p;m=h++)if(_p(i,n,u[m],u[h]))return!0;return!1}function Ig(i,n){for(let o=0;o<i.length;++o)if(!pc(i[o],n))return!1;for(let o=0;o<i.length-1;++o)if(yp(i[o],i[o+1],n))return!1;return!0}function SA(i,n){for(let o=0;o<n.length;o++)if(Ig(i,n[o]))return!0;return!1}function I0(i,n,o){const u=[];for(let h=0;h<i.length;h++){const p=[];for(let m=0;m<i[h].length;m++){const v=EA(i[h][m],o);gp(n,v),p.push(v)}u.push(p)}return u}function Ub(i,n,o){const u=[];for(let h=0;h<i.length;h++){const p=I0(i[h],n,o);u.push(p)}return u}function C0(i,n,o,u){if(i[0]<o[0]||i[0]>o[2]){const h=.5*u;let p=i[0]-o[0]>h?-u:o[0]-i[0]>h?u:0;p===0&&(p=i[0]-o[2]>h?-u:o[2]-i[0]>h?u:0),i[0]+=p}gp(n,i)}function Cg(i,n,o,u){const h=Math.pow(2,u.z)*no,p=[u.x*no,u.y*no],m=[];if(!i)return m;for(const v of i)for(const w of v){const E=[w.x+p[0],w.y+p[1]];C0(E,n,o,h),m.push(E)}return m}function Vb(i,n,o,u){const h=Math.pow(2,u.z)*no,p=[u.x*no,u.y*no],m=[];if(!i)return m;for(const w of i){const E=[];for(const C of w){const P=[C.x+p[0],C.y+p[1]];gp(n,P),E.push(P)}m.push(E)}if(n[2]-n[0]<=h/2){(v=n)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of m)for(const E of w)C0(E,n,o,h)}var v;return m}class Al{constructor(n,o){this.type=Ir,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Td(n[1])){const u=n[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const p=u.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Al(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Al(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Al(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const v=I0(u.coordinates,p,m),w=Cg(o.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!pc(E,v))return!1}if(u.type==="MultiPolygon"){const v=Ub(u.coordinates,p,m),w=Cg(o.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!jb(E,v))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const v=I0(u.coordinates,p,m),w=Vb(o.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!Ig(E,v))return!1}if(u.type==="MultiPolygon"){const v=Ub(u.coordinates,p,m),w=Vb(o.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!SA(E,v))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ag={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},$b=1/298.257223563,qb=$b*(2-$b),vp=Math.PI/180;class xp{static fromTile(n,o,u){const h=Math.PI*(1-2*(n+.5)/Math.pow(2,o)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/vp;return new xp(p,u)}static get units(){return Ag}constructor(n,o){if(n===void 0)throw new Error("No latitude given.");if(o&&!Ag[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Ag).join(", ")}`);const u=6378.137*vp*(o?Ag[o]:1),h=Math.cos(n*vp),p=1/(1-qb*(1-h*h)),m=Math.sqrt(p);this.kx=u*m*h,this.ky=u*m*p*(1-qb)}distance(n,o){const u=aa(n[0]-o[0])*this.kx,h=(n[1]-o[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(n,o){const u=aa(o[0]-n[0])*this.kx;return Math.atan2(u,(o[1]-n[1])*this.ky)/vp}destination(n,o,u){const h=u*vp;return this.offset(n,Math.sin(h)*o,Math.cos(h)*o)}offset(n,o,u){return[n[0]+o/this.kx,n[1]+u/this.ky]}lineDistance(n){let o=0;for(let u=0;u<n.length-1;u++)o+=this.distance(n[u],n[u+1]);return o}area(n){let o=0;for(let u=0;u<n.length;u++){const h=n[u];for(let p=0,m=h.length,v=m-1;p<m;v=p++)o+=aa(h[p][0]-h[v][0])*(h[p][1]+h[v][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(n,o){let u=0;if(o<=0)return n[0];for(let h=0;h<n.length-1;h++){const p=n[h],m=n[h+1],v=this.distance(p,m);if(u+=v,u>o)return A0(p,m,(o-(u-v))/v)}return n[n.length-1]}pointToSegmentDistance(n,o,u){let[h,p]=o,m=aa(u[0]-h)*this.kx,v=(u[1]-p)*this.ky;if(m!==0||v!==0){const w=(aa(n[0]-h)*this.kx*m+(n[1]-p)*this.ky*v)/(m*m+v*v);w>1?(h=u[0],p=u[1]):w>0&&(h+=m/this.kx*w,p+=v/this.ky*w)}return m=aa(n[0]-h)*this.kx,v=(n[1]-p)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(n,o){let u=1/0,h=n[0][0],p=n[0][1],m=0,v=0;for(let w=0;w<n.length-1;w++){let E=n[w][0],C=n[w][1],P=aa(n[w+1][0]-E)*this.kx,M=(n[w+1][1]-C)*this.ky,z=0;P===0&&M===0||(z=(aa(o[0]-E)*this.kx*P+(o[1]-C)*this.ky*M)/(P*P+M*M),z>1?(E=n[w+1][0],C=n[w+1][1]):z>0&&(E+=P/this.kx*z,C+=M/this.ky*z)),P=aa(o[0]-E)*this.kx,M=(o[1]-C)*this.ky;const j=P*P+M*M;j<u&&(u=j,h=E,p=C,m=w,v=z)}return{point:[h,p],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(n,o,u){let h=this.pointOnLine(u,n),p=this.pointOnLine(u,o);if(h.index>p.index||h.index===p.index&&h.t>p.t){const E=h;h=p,p=E}const m=[h.point],v=h.index+1,w=p.index;!Gb(u[v],m[0])&&v<=w&&m.push(u[v]);for(let E=v+1;E<=w;E++)m.push(u[E]);return Gb(u[w],p.point)||m.push(p.point),m}lineSliceAlong(n,o,u){let h=0;const p=[];for(let m=0;m<u.length-1;m++){const v=u[m],w=u[m+1],E=this.distance(v,w);if(h+=E,h>n&&p.length===0&&p.push(A0(v,w,(n-(h-E))/E)),h>=o)return p.push(A0(v,w,(o-(h-E))/E)),p;h>n&&p.push(w)}return p}bufferPoint(n,o){const u=o/this.ky,h=o/this.kx;return[n[0]-h,n[1]-u,n[0]+h,n[1]+u]}bufferBBox(n,o){const u=o/this.ky,h=o/this.kx;return[n[0]-h,n[1]-u,n[2]+h,n[3]+u]}insideBBox(n,o){return aa(n[0]-o[0])>=0&&aa(n[0]-o[2])<=0&&n[1]>=o[1]&&n[1]<=o[3]}}function Gb(i,n){return i[0]===n[0]&&i[1]===n[1]}function A0(i,n,o){const u=aa(n[0]-i[0]);return[i[0]+u*o,i[1]+(n[1]-i[1])*o]}function aa(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}class au{constructor(n=[],o=(u,h)=>u<h?-1:u>h?1:0){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:u}=this,h=o[n];for(;n>0;){const p=n-1>>1,m=o[p];if(u(h,m)>=0)break;o[n]=m,n=p}o[n]=h}_down(n){const{data:o,compare:u}=this,h=this.length>>1,p=o[n];for(;n<h;){let m=1+(n<<1);const v=m+1;if(v<this.length&&u(o[v],o[m])<0&&(m=v),u(o[m],p)>=0)break;o[n]=o[m],n=m}o[n]=p}}var Dt=8192;function Wb(i,n){return n.dist-i.dist}const bp=100,P0=50;function Hb(i){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==i.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==i[o])return!1;return!0}function Pg(i){return i[1]-i[0]+1}function mc(i,n){const o=i[1]>=i[0]&&i[1]<n;return o||console.warn("Distance Expression: Index is out of range"),o}function R0(i,n){if(i[0]>i[1])return[null,null];const o=Pg(i);if(n){if(o===2)return[i,null];const u=Math.floor(o/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}{if(o===1)return[i,null];const u=Math.floor(o/2)-1;return[[i[0],i[0]+u],[i[0]+u+1,i[1]]]}}function la(i,n){const o=[1/0,1/0,-1/0,-1/0];if(!mc(n,i.length))return o;for(let u=n[0];u<=n[1];++u)gp(o,i[u]);return o}function Rg(i){const n=[1/0,1/0,-1/0,-1/0];for(let o=0;o<i.length;++o)for(let u=0;u<i[o].length;++u)gp(n,i[o][u]);return n}function Sd(i,n,o){if(Hb(i)||Hb(n))return NaN;let u=0,h=0;return i[2]<n[0]&&(u=n[0]-i[2]),i[0]>n[2]&&(u=i[0]-n[2]),i[1]>n[3]&&(h=i[1]-n[3]),i[3]<n[1]&&(h=n[1]-i[3]),o.distance([0,0],[u,h])}function Zb(i){return 360*i-180}function Xb(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function ca(i,n){const o=Math.pow(2,n.z),u=(i.y/Dt+n.y)/o;return[Zb((i.x/Dt+n.x)/o),Xb(u)]}function Kb(i,n){const o=[];for(let u=0;u<i.length;++u)o.push(ca(i[u],n));return o}function Qb(i,n,o){const u=o.pointOnLine(n,i).point;return o.distance(i,u)}function M0(i,n,o,u,h){const p=o.slice(u[0],u[1]+1);let m=1/0;for(let v=n[0];v<=n[1];++v)if((m=Math.min(m,Qb(i[v],p,h)))===0)return 0;return m}function Id(i,n,o,u,h){const p=Math.min(h.pointToSegmentDistance(i,o,u),h.pointToSegmentDistance(n,o,u)),m=Math.min(h.pointToSegmentDistance(o,i,n),h.pointToSegmentDistance(u,i,n));return Math.min(p,m)}function IA(i,n,o,u,h){if(!mc(n,i.length)||!mc(u,o.length))return NaN;let p=1/0;for(let m=n[0];m<n[1];++m)for(let v=u[0];v<u[1];++v){if(_p(i[m],i[m+1],o[v],o[v+1]))return 0;p=Math.min(p,Id(i[m],i[m+1],o[v],o[v+1],h))}return p}function CA(i,n,o,u,h){if(!mc(n,i.length)||!mc(u,o.length))return NaN;let p=1/0;for(let m=n[0];m<=n[1];++m)for(let v=u[0];v<=u[1];++v)if((p=Math.min(p,h.distance(i[m],o[v])))===0)return p;return p}function AA(i,n,o){if(pc(i,n,!0))return 0;let u=1/0;for(const h of n){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(u=Math.min(u,o.pointToSegmentDistance(i,h[p-1],h[0])))===0||(u=Math.min(u,Qb(i,h,o)))===0)return u}return u}function PA(i,n,o,u){if(!mc(n,i.length))return NaN;for(let p=n[0];p<=n[1];++p)if(pc(i[p],o,!0))return 0;let h=1/0;for(let p=n[0];p<n[1];++p)for(const m of o)for(let v=0,w=m.length,E=w-1;v<w;E=v++){if(_p(i[p],i[p+1],m[E],m[v]))return 0;h=Math.min(h,Id(i[p],i[p+1],m[E],m[v],u))}return h}function Yb(i,n){for(const o of i)for(let u=0;u<=o.length-1;++u)if(pc(o[u],n,!0))return!0;return!1}function Mg(i,n,o,u=1/0){const h=Rg(i),p=Rg(n);if(u!==1/0&&Sd(h,p,o)>=u)return u;if(ou(h,p)){if(Yb(i,n))return 0}else if(Yb(n,i))return 0;let m=u;for(const v of i)for(let w=0,E=v.length,C=E-1;w<E;C=w++)for(const P of n)for(let M=0,z=P.length,j=z-1;M<z;j=M++){if(_p(v[C],v[w],P[j],P[M]))return 0;m=Math.min(m,Id(v[C],v[w],P[j],P[M],o))}return m}function ch(i,n,o,u,h,p,m){if(p===null||m===null)return;const v=Sd(la(u,p),la(h,m),o);v<n&&i.push({dist:v,range1:p,range2:m})}function ua(i,n,o,u,h=1/0){let p=Math.min(u.distance(i[0],o[0][0]),h);if(p===0)return p;const m=new au([{dist:0,range1:[0,i.length-1],range2:[0,0]}],Wb),v=n?P0:bp,w=Rg(o);for(;m.length;){const E=m.pop();if(E.dist>=p)continue;const C=E.range1;if(Pg(C)<=v){if(!mc(C,i.length))return NaN;if(n){const P=PA(i,C,o,u);if((p=Math.min(p,P))===0)return p}else for(let P=C[0];P<=C[1];++P){const M=AA(i[P],o,u);if((p=Math.min(p,M))===0)return p}}else{const P=R0(C,n);if(P[0]!==null){const M=Sd(la(i,P[0]),w,u);M<p&&m.push({dist:M,range1:P[0],range2:[0,0]})}if(P[1]!==null){const M=Sd(la(i,P[1]),w,u);M<p&&m.push({dist:M,range1:P[1],range2:[0,0]})}}}return p}function wp(i,n,o,u,h,p=1/0){let m=Math.min(p,h.distance(i[0],o[0]));if(m===0)return m;const v=new au([{dist:0,range1:[0,i.length-1],range2:[0,o.length-1]}],Wb),w=n?P0:bp,E=u?P0:bp;for(;v.length;){const C=v.pop();if(C.dist>=m)continue;const P=C.range1,M=C.range2;if(Pg(P)<=w&&Pg(M)<=E){if(!mc(P,i.length)||!mc(M,o.length))return NaN;if(n&&u?m=Math.min(m,IA(i,P,o,M,h)):n||u?n&&!u?m=Math.min(m,M0(o,M,i,P,h)):!n&&u&&(m=Math.min(m,M0(i,P,o,M,h))):m=Math.min(m,CA(i,P,o,M,h)),m===0)return m}else{const z=R0(P,n),j=R0(M,u);ch(v,m,h,i,o,z[0],j[0]),ch(v,m,h,i,o,z[0],j[1]),ch(v,m,h,i,o,z[1],j[0]),ch(v,m,h,i,o,z[1],j[1])}}return m}function k0(i,n,o,u,h=1/0){let p=h;const m=la(i,[0,i.length-1]);for(const v of o)if(!(p!==1/0&&Sd(m,la(v,[0,v.length-1]),u)>=p)&&(p=Math.min(p,wp(i,n,v,!0,u,p)),p===0))return p;return p}function kg(i,n,o,u,h=1/0){let p=h;const m=la(i,[0,i.length-1]);for(const v of o){if(p!==1/0&&Sd(m,Rg(v),u)>=p)continue;const w=ua(i,n,v,u,p);if(isNaN(w))return w;if((p=Math.min(p,w))===0)return p}return p}function D0(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class uh{constructor(n,o){this.type=Jt,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(Td(n[1])){const u=n[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(D0(u.features[h].geometry.type))return new uh(u,u.features[h].geometry)}else if(u.type==="Feature"){if(D0(u.geometry.type))return new uh(u,u.geometry)}else if(D0(u.type))return new uh(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const o=n.geometry(),u=n.canonicalID();if(o!=null&&u!=null){if(n.geometryType()==="Point")return function(h,p,m){const v=[];for(const E of h)for(const C of E)v.push(ca(C,p));const w=new xp(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?wp(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",w):m.type==="MultiLineString"?k0(v,!1,m.coordinates,w):m.type==="Polygon"||m.type==="MultiPolygon"?kg(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,w):null}(o,u,this.geometries);if(n.geometryType()==="LineString")return function(h,p,m){const v=[];for(const E of h){const C=[];for(const P of E)C.push(ca(P,p));v.push(C)}const w=new xp(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return k0(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,w);if(m.type==="MultiLineString"){let E=1/0;for(let C=0;C<m.coordinates.length;C++){const P=k0(m.coordinates[C],!0,v,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}if(m.type==="Polygon"||m.type==="MultiPolygon"){let E=1/0;for(let C=0;C<v.length;C++){const P=kg(v[C],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return null}(o,u,this.geometries);if(n.geometryType()==="Polygon")return function(h,p,m){const v=[];for(const E of function(C,P){const M=C.length;if(M<=1)return[C];const z=[];let j,V;for(let $=0;$<M;$++){const ee=TA(C[$]);ee!==0&&(C[$].area=Math.abs(ee),V===void 0&&(V=ee<0),V===ee<0?(j&&z.push(j),j=[C[$]]):j.push(C[$]))}return j&&z.push(j),z}(h)){const C=[];for(let P=0;P<E.length;++P)C.push(Kb(E[P],p));v.push(C)}const w=new xp(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return kg(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,w);if(m.type==="MultiLineString"){let E=1/0;for(let C=0;C<m.coordinates.length;C++){const P=kg(m.coordinates[C],!0,v,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return m.type==="Polygon"||m.type==="MultiPolygon"?function(E,C,P){let M=1/0;for(const z of E)for(const j of C){const V=Mg(z,j,P,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,w):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Tp(i,n){switch(i){case"string":return Ka(n);case"number":return+n;case"boolean":return!!n;case"color":return Er.parse(n);case"formatted":return go.fromString(Ka(n));case"resolvedImage":return sa.fromString(Ka(n))}return n}function Jb(i,n,o,u){return u!==void 0&&(i=u*Math.round(i/u)),n!==void 0&&i<n&&(i=n),o!==void 0&&i>o&&(i=o),i}class lu{constructor(n,o,u){this.type=n,this.key=o,this.scope=u}static parse(n,o){let u=o.expectedType;if(u==null&&(u=br),n.length<2||n.length>3)return o.error("Invalid number of arguments for 'config' expression.");const h=o.parse(n[1],1);if(!(h instanceof Qa))return o.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const p=o.parse(n[2],2);return p instanceof Qa?new lu(u,Ka(h.value),Ka(p.value)):o.error("Scope of 'config' expression must be a string literal.")}return new lu(u,Ka(h.value))}evaluate(n){const o=[this.key,this.scope,n.scope].filter(Boolean).join(""),u=n.getConfig(o);if(!u)return null;const{type:h,value:p,values:m,minValue:v,maxValue:w,stepValue:E}=u,C=u.default.evaluate(n);let P=C;if(p){const M=n.scope;n.scope=(M||"").split("").slice(1).join(""),P=p.evaluate(n),n.scope=M}return h&&(P=Tp(h,P)),P===void 0||v===void 0&&w===void 0&&E===void 0||(typeof P=="number"?P=Jb(P,v,w,E):Array.isArray(P)&&(P=P.map(M=>typeof M=="number"?Jb(M,v,w,E):M))),p!==void 0&&P!==void 0&&m&&!m.includes(P)&&(P=C,h&&(P=Tp(h,P))),(h&&h!==this.type||P!==void 0&&ls(P)!==this.type)&&(P=Tp(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function Ep(i){if(i instanceof Bo&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Al||i instanceof uh)return!1;let n=!0;return i.eachChild(o=>{n&&!Ep(o)&&(n=!1)}),n}function Dg(i){if(i instanceof Bo&&i.name==="feature-state")return!1;let n=!0;return i.eachChild(o=>{n&&!Dg(o)&&(n=!1)}),n}function Sp(i){if(i instanceof lu)return new Set([i.key]);let n=new Set;return i.eachChild(o=>{n=new Set([...n,...Sp(o)])}),n}function Ip(i,n){if(i instanceof Bo&&n.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(u=>{o&&!Ip(u,n)&&(o=!1)}),o}class Cp{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=n[1];return o.scope.has(u)?new Cp(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Og{constructor(n,o=[],u,h=new w0,p=[],m,v){this.registry=n,this.path=o,this.key=o.map(w=>`[${w}]`).join(""),this.scope=h,this.errors=p,this.expectedType=u,this._scope=m,this.options=v}parse(n,o,u,h,p={}){return o||u?this.concat(o,u,h)._parse(n,p):this._parse(n,p)}_parse(n,o){function u(h,p,m){return m==="assert"?new oa(p,[h]):m==="coerce"?new fc(p,[h]):h}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(h){let p=h.parse(n,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,v=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else p=u(p,m,o.typeAnnotation||"coerce");else p=u(p,m,o.typeAnnotation||"assert")}if(!(p instanceof Qa)&&p.type.kind!=="resolvedImage"&&Ap(p)){const m=new S0(this._scope,this.options);try{p=new Qa(p.type,p.evaluate(m))}catch(v){return this.error(v.message),null}}return p}return fc.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,u){const h=typeof n=="number"?this.path.concat(n):this.path,p=u?this.scope.concat(u):this.scope;return new Og(this.registry,h,o||null,p,this.errors,this._scope,this.options)}error(n,...o){const u=`${this.key}${o.map(h=>`[${h}]`).join("")}`;this.errors.push(new Cl(u,n))}checkSubtype(n,o){const u=fp(n,o);return u&&this.error(u),u}}var ew=Og;function Ap(i){if(i instanceof Cp)return Ap(i.boundExpression);if(i instanceof Bo&&i.name==="error"||i instanceof mp||i instanceof Al||i instanceof uh||i instanceof lu)return!1;const n=i instanceof fc||i instanceof oa;let o=!0;return i.eachChild(u=>{o=n?o&&Ap(u):o&&u instanceof Qa}),!!o&&Ep(i)&&Ip(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function hh(i,n){const o=i.length-1;let u,h,p=0,m=o,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),u=i[v],h=i[v+1],u<=n){if(v===o||n<h)return v;p=v+1}else{if(!(u>n))throw new ms("Input is not a number.");m=v-1}return 0}class Cd{constructor(n,o,u){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[h,p]of u)this.labels.push(h),this.outputs.push(p)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(n[1],1,Jt);if(!u)return null;const h=[];let p=null;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(let m=1;m<n.length;m+=2){const v=m===1?-1/0:n[m],w=n[m+1],E=m,C=m+1;if(typeof v!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=o.parse(w,C,p);if(!P)return null;p=p||P.type,h.push([v,P])}return new Cd(p,u,h)}evaluate(n){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return u[0].evaluate(n);const p=o.length;return h>=o[p-1]?u[p-1].evaluate(n):u[hh(o,h)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}const tw=.95047,O0=1.08883,nw=4/29,cu=6/29,rw=3*cu*cu,RA=cu*cu*cu,MA=Math.PI/180,kA=180/Math.PI;function Lg(i){return i>RA?Math.pow(i,1/3):i/rw+nw}function L0(i){return i>cu?i*i*i:rw*(i-nw)}function z0(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function N0(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function iw(i){const n=N0(i.r),o=N0(i.g),u=N0(i.b),h=Lg((.4124564*n+.3575761*o+.1804375*u)/tw),p=Lg((.2126729*n+.7151522*o+.072175*u)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Lg((.0193339*n+.119192*o+.9503041*u)/O0)),alpha:i.a}}function sw(i){let n=(i.l+16)/116,o=isNaN(i.a)?n:n+i.a/500,u=isNaN(i.b)?n:n-i.b/200;return n=1*L0(n),o=tw*L0(o),u=O0*L0(u),new Er(z0(3.2404542*o-1.5371385*n-.4985314*u),z0(-.969266*o+1.8760108*n+.041556*u),z0(.0556434*o-.2040259*n+1.0572252*u),i.alpha)}function DA(i,n,o){const u=n-i;return i+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const Pp={forward:iw,reverse:sw,interpolate:function(i,n,o){return{l:xn(i.l,n.l,o),a:xn(i.a,n.a,o),b:xn(i.b,n.b,o),alpha:xn(i.alpha,n.alpha,o)}}},Rp={forward:function(i){const{l:n,a:o,b:u}=iw(i),h=Math.atan2(u,o)*kA;return{h:h<0?h+360:h,c:Math.sqrt(o*o+u*u),l:n,alpha:i.a}},reverse:function(i){const n=i.h*MA,o=i.c;return sw({l:i.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:i.alpha})},interpolate:function(i,n,o){return{h:DA(i.h,n.h,o),c:xn(i.c,n.c,o),l:xn(i.l,n.l,o),alpha:xn(i.alpha,n.alpha,o)}}};var Mp=Object.freeze({__proto__:null,hcl:Rp,lab:Pp});class ha{constructor(n,o,u,h,p){this.type=n,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(n,o,u,h){let p=0;if(n.name==="exponential")p=F0(o,n.base,u,h);else if(n.name==="linear")p=F0(o,1,u,h);else if(n.name==="cubic-bezier"){const m=n.controlPoints;p=new Qc(m[0],m[1],m[2],m[3]).solve(F0(o,1,u,h))}return p}static parse(n,o){let[u,h,p,...m]=n;if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(p=o.parse(p,2,Jt),!p)return null;const v=[];let w=null;u==="interpolate-hcl"||u==="interpolate-lab"?w=Ia:o.expectedType&&o.expectedType.kind!=="value"&&(w=o.expectedType);for(let E=0;E<m.length;E+=2){const C=m[E],P=m[E+1],M=E+3,z=E+4;if(typeof C!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(v.length&&v[v.length-1][0]>=C)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const j=o.parse(P,z,w);if(!j)return null;w=w||j.type,v.push([C,j])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new ha(w,u,h,p,v):o.error(`Type ${ki(w)} is not interpolatable.`)}evaluate(n){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return u[0].evaluate(n);const p=o.length;if(h>=o[p-1])return u[p-1].evaluate(n);const m=hh(o,h),v=ha.interpolationFactor(this.interpolation,h,o[m],o[m+1]),w=u[m].evaluate(n),E=u[m+1].evaluate(n);return this.operator==="interpolate"?dp[this.type.kind.toLowerCase()](w,E,v):this.operator==="interpolate-hcl"?Rp.reverse(Rp.interpolate(Rp.forward(w),Rp.forward(E),v)):Pp.reverse(Pp.interpolate(Pp.forward(w),Pp.forward(E),v))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,n,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function F0(i,n,o,u){const h=u-o,p=i-o;return h===0?0:n===1?p/h:(Math.pow(n,p)-1)/(Math.pow(n,h)-1)}class dh{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let u=null;const h=o.expectedType;h&&h.kind!=="value"&&(u=h);const p=[];for(const v of n.slice(1)){const w=o.parse(v,1+p.length,u,void 0,{typeAnnotation:"omit"});if(!w)return null;u=u||w.type,p.push(w)}const m=h&&p.some(v=>fp(h,v.type));return new dh(m?br:u,p)}evaluate(n){let o,u=null,h=0;for(const p of this.args){if(h++,u=p.evaluate(n),u&&u instanceof sa&&!u.available&&(o||(o=u),u=null,h===this.args.length))return o;if(u!==null)break}return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class zg{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const u=[];for(let p=1;p<n.length-1;p+=2){const m=n[p];if(typeof m!="string")return o.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=o.parse(n[p+1],p+1);if(!v)return null;u.push([m,v])}const h=o.parse(n[n.length-1],n.length-1,o.expectedType,u);return h?new zg(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,u]of this.bindings)n.push(o,u.serialize());return n.push(this.result.serialize()),n}}class Ng{constructor(n,o,u){this.type=n,this.index=o,this.input=u}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,Jt),h=o.parse(n[2],2,to(o.expectedType||br));return u&&h?new Ng(h.type.itemType,u,h):null}evaluate(n){const o=this.index.evaluate(n),u=this.input.evaluate(n);if(o<0)throw new ms(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new ms(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new ms(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class B0{constructor(n,o){this.type=Ir,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,br),h=o.parse(n[2],2,br);return u&&h?Ca(u.type,[Ir,yr,Jt,ia,br])?new B0(u,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(u.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(u==null)return!1;if(!pp(o,["boolean","string","number","null"]))throw new ms(`Expected first argument to be of type boolean, string, number or null, but found ${ki(ls(o))} instead.`);if(!pp(u,["string","array"]))throw new ms(`Expected second argument to be of type array or string, but found ${ki(ls(u))} instead.`);return u.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class kp{constructor(n,o,u){this.type=Jt,this.needle=n,this.haystack=o,this.fromIndex=u}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,br),h=o.parse(n[2],2,br);if(!u||!h)return null;if(!Ca(u.type,[Ir,yr,Jt,ia,br]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(u.type)} instead`);if(n.length===4){const p=o.parse(n[3],3,Jt);return p?new kp(u,h,p):null}return new kp(u,h)}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!pp(o,["boolean","string","number","null"]))throw new ms(`Expected first argument to be of type boolean, string, number or null, but found ${ki(ls(o))} instead.`);if(!pp(u,["string","array"]))throw new ms(`Expected second argument to be of type array or string, but found ${ki(ls(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return u.indexOf(o,h)}return u.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Fg{constructor(n,o,u,h,p,m){this.inputType=n,this.type=o,this.input=u,this.cases=h,this.outputs=p,this.otherwise=m}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const p={},m=[];for(let E=2;E<n.length-1;E+=2){let C=n[E];const P=n[E+1];Array.isArray(C)||(C=[C]);const M=o.concat(E);if(C.length===0)return M.error("Expected at least one branch label.");for(const j of C){if(typeof j!="number"&&typeof j!="string")return M.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return M.error("Numeric branch labels must be integer values.");if(u){if(M.checkSubtype(u,ls(j)))return null}else u=ls(j);if(p[String(j)]!==void 0)return M.error("Branch labels must be unique.");p[String(j)]=m.length}const z=o.parse(P,E,h);if(!z)return null;h=h||z.type,m.push(z)}const v=o.parse(n[1],1,br);if(!v)return null;const w=o.parse(n[n.length-1],n.length-1,h);return w?v.type.kind!=="value"&&o.concat(1).checkSubtype(u,v.type)?null:new Fg(u,h,v,p,m,w):null}evaluate(n){const o=this.input.evaluate(n);return(ls(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],h={};for(const m of o){const v=h[this.cases[m]];v===void 0?(h[this.cases[m]]=u.length,u.push([this.cases[m],[m]])):u[v][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,v]of u)n.push(v.length===1?p(v[0]):v.map(p)),n.push(this.outputs[m].serialize());return n.push(this.otherwise.serialize()),n}}class Bg{constructor(n,o,u){this.type=n,this.branches=o,this.otherwise=u}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const h=[];for(let m=1;m<n.length-1;m+=2){const v=o.parse(n[m],m,Ir);if(!v)return null;const w=o.parse(n[m+1],m+1,u);if(!w)return null;h.push([v,w]),u=u||w.type}const p=o.parse(n[n.length-1],n.length-1,u);return p?new Bg(u,h,p):null}evaluate(n){for(const[o,u]of this.branches)if(o.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,u]of this.branches)n(o),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class Dp{constructor(n,o,u,h){this.type=n,this.input=o,this.beginIndex=u,this.endIndex=h}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,br),h=o.parse(n[2],2,Jt);if(!u||!h)return null;if(!Ca(u.type,[to(br),yr,br]))return o.error(`Expected first argument to be of type array or string, but found ${ki(u.type)} instead`);if(n.length===4){const p=o.parse(n[3],3,Jt);return p?new Dp(u.type,u,h,p):null}return new Dp(u.type,u,h)}evaluate(n){const o=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!pp(o,["string","array"]))throw new ms(`Expected first argument to be of type array or string, but found ${ki(ls(o))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return o.slice(u,h)}return o.slice(u)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function jg(i,n){return i==="=="||i==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Ug(i,n,o,u){return u.compare(n,o)===0}function Ad(i,n,o){const u=i!=="=="&&i!=="!=";return class vZ{constructor(p,m,v){this.type=Ir,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const v=p[0];let w=m.parse(p[1],1,br);if(!w)return null;if(!jg(v,w.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${ki(w.type)}'.`);let E=m.parse(p[2],2,br);if(!E)return null;if(!jg(v,E.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${ki(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${ki(w.type)}' and '${ki(E.type)}'.`);u&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new oa(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new oa(w.type,[E])));let C=null;if(p.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(C=m.parse(p[3],3,wg),!C)return null}return new vZ(w,E,C)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(u&&this.hasUntypedArgument){const w=ls(m),E=ls(v);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new ms(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const w=ls(m),E=ls(v);if(w.kind!=="string"||E.kind!=="string")return n(p,m,v)}return this.collator?o(p,m,v,this.collator.evaluate(p)):n(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const OA=Ad("==",function(i,n,o){return n===o},Ug),ow=Ad("!=",function(i,n,o){return n!==o},function(i,n,o,u){return!Ug(0,n,o,u)}),LA=Ad("<",function(i,n,o){return n<o},function(i,n,o,u){return u.compare(n,o)<0}),zA=Ad(">",function(i,n,o){return n>o},function(i,n,o,u){return u.compare(n,o)>0}),NA=Ad("<=",function(i,n,o){return n<=o},function(i,n,o,u){return u.compare(n,o)<=0}),FA=Ad(">=",function(i,n,o){return n>=o},function(i,n,o,u){return u.compare(n,o)>=0});class j0{constructor(n,o,u,h,p,m){this.type=yr,this.number=n,this.locale=o,this.currency=u,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const u=o.parse(n[1],1,Jt);if(!u)return null;const h=n[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=o.parse(h.locale,1,yr),!p))return null;let m=null;if(h.currency&&(m=o.parse(h.currency,1,yr),!m))return null;let v=null;if(h.unit&&(v=o.parse(h.unit,1,yr),!v))return null;let w=null;if(h["min-fraction-digits"]&&(w=o.parse(h["min-fraction-digits"],1,Jt),!w))return null;let E=null;return h["max-fraction-digits"]&&(E=o.parse(h["max-fraction-digits"],1,Jt),!E)?null:new j0(u,p,m,v,w,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class U0{constructor(n){this.type=Jt,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=o.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${ki(u.type)} instead.`):new U0(u):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ms(`Expected value to be of type string or array, but found ${ki(ls(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(o=>{n.push(o.serialize())}),n}}function aw(i){return function(){i=1831565813+(i|=0)|0;let n=Math.imul(i^i>>>15,1|i);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const Pd={"==":OA,"!=":ow,">":zA,"<":LA,">=":FA,"<=":NA,array:oa,at:Ng,boolean:oa,case:Bg,coalesce:dh,collator:mp,format:lh,image:dc,in:B0,"index-of":kp,interpolate:ha,"interpolate-hcl":ha,"interpolate-lab":ha,length:U0,let:zg,literal:Qa,match:Fg,number:oa,"number-format":j0,object:oa,slice:Dp,step:Cd,string:oa,"to-boolean":fc,"to-color":fc,"to-number":fc,"to-string":fc,var:Cp,within:Al,distance:uh,config:lu};function lw(i,[n,o,u,h]){n=n.evaluate(i),o=o.evaluate(i),u=u.evaluate(i);const p=h?h.evaluate(i):1,m=Nb(n,o,u,p);if(m)throw new ms(m);return new Er(n/255*p,o/255*p,u/255*p,p)}function BA(i,[n,o,u,h]){n=n.evaluate(i),o=o.evaluate(i),u=u.evaluate(i);const p=h?h.evaluate(i):1,m=function(E,C,P,M){return typeof E=="number"&&E>=0&&E<=360?typeof C=="number"&&C>=0&&C<=100&&typeof P=="number"&&P>=0&&P<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[E,C,P,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[E,C,P,M]:[E,C,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[E,C,P,M]:[E,C,P]).join(", ")}]: 'h' must be between 0 and 360.`}(n,o,u,p);if(m)throw new ms(m);const v=`hsla(${n}, ${o}%, ${u}%, ${p})`,w=Er.parse(v);if(!w)throw new ms(`Failed to parse HSLA color: ${v}`);return w}function g(i,n){return i in n}function l(i,n){const o=n[i];return o===void 0?null:o}function d(i){return{type:i}}function y(i){return{result:"success",value:i}}function b(i){return{result:"error",value:i}}function T(i,n){return!!i&&!!i.parameters&&i.parameters.indexOf(n)>-1}function S(i){return i["property-type"]==="data-driven"}function A(i){return T(i.expression,"measure-light")}function k(i){return T(i.expression,"zoom")}function L(i){return!!i.expression&&i.expression.interpolated}function B(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function U(i){return i}function q(i,n){const o=n.type==="color",u=i.stops&&typeof i.stops[0][0]=="object",h=u||!(u||i.property!==void 0),p=i.type||(L(n)?"exponential":"interval");if(o&&((i=xd({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],Er.parse(E[1])])),i.default=Er.parse(i.default?i.default:n.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Mp[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let m,v,w;if(p==="exponential")m=ae;else if(p==="interval")m=se;else if(p==="categorical"){m=ie,v=Object.create(null);for(const E of i.stops)v[E[0]]=E[1];w=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=ce}if(u){const E={},C=[];for(let z=0;z<i.stops.length;z++){const j=i.stops[z],V=j[0].zoom;E[V]===void 0&&(E[V]={zoom:V,type:i.type,property:i.property,default:i.default,stops:[]},C.push(V)),E[V].stops.push([j[0].value,j[1]])}const P=[];for(const z of C)P.push([E[z].zoom,q(E[z],n)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:ha.interpolationFactor.bind(void 0,M),zoomStops:P.map(z=>z[0]),evaluate:({zoom:z},j)=>ae({stops:P,base:i.base},n,z).evaluate(z,j)}}if(h){const E=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ha.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(i,n,C,v,w)}}return{kind:"source",evaluate(E,C){const P=C&&C.properties?C.properties[i.property]:void 0;return P===void 0?H(i.default,n.default):m(i,n,P,v,w)}}}function H(i,n,o){return i!==void 0?i:n!==void 0?n:o!==void 0?o:void 0}function ie(i,n,o,u,h){return H(typeof o===h?u[o]:void 0,i.default,n.default)}function se(i,n,o){if(su(o)!=="number")return H(i.default,n.default);const u=i.stops.length;if(u===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[u-1][0])return i.stops[u-1][1];const h=hh(i.stops.map(p=>p[0]),o);return i.stops[h][1]}function ae(i,n,o){const u=i.base!==void 0?i.base:1;if(su(o)!=="number")return H(i.default,n.default);const h=i.stops.length;if(h===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[h-1][0])return i.stops[h-1][1];const p=hh(i.stops.map(C=>C[0]),o),m=function(C,P,M,z){const j=z-M,V=C-M;return j===0?0:P===1?V/j:(Math.pow(P,V)-1)/(Math.pow(P,j)-1)}(o,u,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],w=i.stops[p+1][1];let E=dp[n.type]||U;if(i.colorSpace&&i.colorSpace!=="rgb"){const C=Mp[i.colorSpace];E=(P,M)=>C.reverse(C.interpolate(C.forward(P),C.forward(M),m))}return typeof v.evaluate=="function"?{evaluate(...C){const P=v.evaluate.apply(void 0,C),M=w.evaluate.apply(void 0,C);if(P!==void 0&&M!==void 0)return E(P,M,m)}}:E(v,w,m)}function ce(i,n,o){return n.type==="color"?o=Er.parse(o):n.type==="formatted"?o=go.fromString(o.toString()):n.type==="resolvedImage"?o=sa.fromString(o.toString()):su(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),H(o,i.default,n.default)}Bo.register(Pd,{error:[{kind:"error"},[yr],(i,[n])=>{throw new ms(n.evaluate(i))}],typeof:[yr,[br],(i,[n])=>ki(ls(n.evaluate(i)))],"to-rgba":[to(Jt,4),[Ia],(i,[n])=>n.evaluate(i).toRenderColor(null).toArray()],rgb:[Ia,[Jt,Jt,Jt],lw],rgba:[Ia,[Jt,Jt,Jt,Jt],lw],hsl:[Ia,[Jt,Jt,Jt],BA],hsla:[Ia,[Jt,Jt,Jt,Jt],BA],has:{type:Ir,overloads:[[[yr],(i,[n])=>g(n.evaluate(i),i.properties())],[[yr,bd],(i,[n,o])=>g(n.evaluate(i),o.evaluate(i))]]},get:{type:br,overloads:[[[yr],(i,[n])=>l(n.evaluate(i),i.properties())],[[yr,bd],(i,[n,o])=>l(n.evaluate(i),o.evaluate(i))]]},"feature-state":[br,[yr],(i,[n])=>l(n.evaluate(i),i.featureState||{})],properties:[bd,[],i=>i.properties()],"geometry-type":[yr,[],i=>i.geometryType()],id:[br,[],i=>i.id()],zoom:[Jt,[],i=>i.globals.zoom],pitch:[Jt,[],i=>i.globals.pitch||0],"distance-from-center":[Jt,[],i=>i.distanceFromCenter()],"measure-light":[Jt,[yr],(i,[n])=>i.measureLight(n.evaluate(i))],"heatmap-density":[Jt,[],i=>i.globals.heatmapDensity||0],"line-progress":[Jt,[],i=>i.globals.lineProgress||0],"raster-value":[Jt,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[Jt,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[Jt,[],i=>i.globals.skyRadialProgress||0],accumulated:[br,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Jt,d(Jt),(i,n)=>{let o=0;for(const u of n)o+=u.evaluate(i);return o}],"*":[Jt,d(Jt),(i,n)=>{let o=1;for(const u of n)o*=u.evaluate(i);return o}],"-":{type:Jt,overloads:[[[Jt,Jt],(i,[n,o])=>n.evaluate(i)-o.evaluate(i)],[[Jt],(i,[n])=>-n.evaluate(i)]]},"/":[Jt,[Jt,Jt],(i,[n,o])=>n.evaluate(i)/o.evaluate(i)],"%":[Jt,[Jt,Jt],(i,[n,o])=>n.evaluate(i)%o.evaluate(i)],ln2:[Jt,[],()=>Math.LN2],pi:[Jt,[],()=>Math.PI],e:[Jt,[],()=>Math.E],"^":[Jt,[Jt,Jt],(i,[n,o])=>Math.pow(n.evaluate(i),o.evaluate(i))],sqrt:[Jt,[Jt],(i,[n])=>Math.sqrt(n.evaluate(i))],log10:[Jt,[Jt],(i,[n])=>Math.log(n.evaluate(i))/Math.LN10],ln:[Jt,[Jt],(i,[n])=>Math.log(n.evaluate(i))],log2:[Jt,[Jt],(i,[n])=>Math.log(n.evaluate(i))/Math.LN2],sin:[Jt,[Jt],(i,[n])=>Math.sin(n.evaluate(i))],cos:[Jt,[Jt],(i,[n])=>Math.cos(n.evaluate(i))],tan:[Jt,[Jt],(i,[n])=>Math.tan(n.evaluate(i))],asin:[Jt,[Jt],(i,[n])=>Math.asin(n.evaluate(i))],acos:[Jt,[Jt],(i,[n])=>Math.acos(n.evaluate(i))],atan:[Jt,[Jt],(i,[n])=>Math.atan(n.evaluate(i))],min:[Jt,d(Jt),(i,n)=>Math.min(...n.map(o=>o.evaluate(i)))],max:[Jt,d(Jt),(i,n)=>Math.max(...n.map(o=>o.evaluate(i)))],abs:[Jt,[Jt],(i,[n])=>Math.abs(n.evaluate(i))],round:[Jt,[Jt],(i,[n])=>{const o=n.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[Jt,[Jt],(i,[n])=>Math.floor(n.evaluate(i))],ceil:[Jt,[Jt],(i,[n])=>Math.ceil(n.evaluate(i))],"filter-==":[Ir,[yr,br],(i,[n,o])=>i.properties()[n.value]===o.value],"filter-id-==":[Ir,[br],(i,[n])=>i.id()===n.value],"filter-type-==":[Ir,[yr],(i,[n])=>i.geometryType()===n.value],"filter-<":[Ir,[yr,br],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Ir,[br],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o<u}],"filter->":[Ir,[yr,br],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u>h}],"filter-id->":[Ir,[br],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o>u}],"filter-<=":[Ir,[yr,br],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Ir,[br],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o<=u}],"filter->=":[Ir,[yr,br],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Ir,[br],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o>=u}],"filter-has":[Ir,[br],(i,[n])=>n.value in i.properties()],"filter-has-id":[Ir,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ir,[to(yr)],(i,[n])=>n.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ir,[to(br)],(i,[n])=>n.value.indexOf(i.id())>=0],"filter-in-small":[Ir,[yr,to(br)],(i,[n,o])=>o.value.indexOf(i.properties()[n.value])>=0],"filter-in-large":[Ir,[yr,to(br)],(i,[n,o])=>function(u,h,p,m){for(;p<=m;){const v=p+m>>1;if(h[v]===u)return!0;h[v]>u?m=v-1:p=v+1}return!1}(i.properties()[n.value],o.value,0,o.value.length-1)],all:{type:Ir,overloads:[[[Ir,Ir],(i,[n,o])=>n.evaluate(i)&&o.evaluate(i)],[d(Ir),(i,n)=>{for(const o of n)if(!o.evaluate(i))return!1;return!0}]]},any:{type:Ir,overloads:[[[Ir,Ir],(i,[n,o])=>n.evaluate(i)||o.evaluate(i)],[d(Ir),(i,n)=>{for(const o of n)if(o.evaluate(i))return!0;return!1}]]},"!":[Ir,[Ir],(i,[n])=>!n.evaluate(i)],"is-supported-script":[Ir,[yr],(i,[n])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(n.evaluate(i))}],upcase:[yr,[yr],(i,[n])=>n.evaluate(i).toUpperCase()],downcase:[yr,[yr],(i,[n])=>n.evaluate(i).toLowerCase()],concat:[yr,d(br),(i,n)=>n.map(o=>Ka(o.evaluate(i))).join("")],"resolved-locale":[yr,[wg],(i,[n])=>n.evaluate(i).resolvedLocale()],random:[Jt,[Jt,Jt,br],(i,n)=>{const[o,u,h]=n.map(m=>m.evaluate(i));if(o>u||o===u)return o;let p;if(typeof h=="string")p=function(m){let v=0;if(m.length===0)return v;for(let w=0;w<m.length;w++)v=(v<<5)-v+m.charCodeAt(w),v|=0;return v}(h);else{if(typeof h!="number")throw new ms(`Invalid seed input: ${h}`);p=h}return o+aw(p)()*(u-o)}]});class ye{constructor(n,o,u,h){this.expression=n,this._warningHistory={},this._evaluator=new S0(u,h),this._defaultValue=o?function(p){return p.type==="color"&&(B(p.default)||Array.isArray(p.default))?new Er(0,0,0,0):p.type==="color"?Er.parse(p.default)||null:p.default===void 0?null:p.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(n,o,u,h,p,m,v,w){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,u,h,p,m,v,w){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new ms(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${E.message}`)),this._defaultValue}}}function ve(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Pd}function _e(i,n,o,u){const h=new ew(Pd,[],n?function(m){const v={color:Ia,string:yr,number:Jt,enum:yr,boolean:Ir,formatted:wd,resolvedImage:ah};return m.type==="array"?to(v[m.value]||br,m.length):v[m.type]}(n):void 0,void 0,void 0,o,u),p=h.parse(i,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?y(new ye(p,n,o,u)):b(h.errors)}class Re{constructor(n,o,u){this.kind=n,this._styleExpression=o,this.isLightConstant=u,this.isStateDependent=n!=="constant"&&!Dg(o.expression),this.configDependencies=Sp(o.expression)}evaluateWithoutErrorHandling(n,o,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,h,p,m)}evaluate(n,o,u,h,p,m){return this._styleExpression.evaluate(n,o,u,h,p,m)}}class Se{constructor(n,o,u,h,p){this.kind=n,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!Dg(o.expression),this.isLightConstant=p,this.configDependencies=Sp(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,o,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,h,p,m)}evaluate(n,o,u,h,p,m){return this._styleExpression.evaluate(n,o,u,h,p,m)}interpolationFactor(n,o,u){return this.interpolationType?ha.interpolationFactor(this.interpolationType,n,o,u):0}}function Ie(i,n,o,u){if((i=_e(i,n,o,u)).result==="error")return i;const h=i.value.expression,p=Ep(h);if(!p&&!S(n))return b([new Cl("","data expressions not supported")]);const m=Ip(h,["zoom","pitch","distance-from-center"]);if(!m&&!k(n))return b([new Cl("","zoom expressions not supported")]);const v=Ip(h,["measure-light"]);if(!v&&!A(n))return b([new Cl("","measure-light expression not supported")]);const w=n.expression&&n.expression.relaxZoomRestriction,E=Ne(h);return E||m||w?E instanceof Cl?b([E]):E instanceof ha&&!L(n)?b([new Cl("",'"interpolate" expressions cannot be used with this property')]):y(E?new Se(p?"camera":"composite",i.value,E.labels,E instanceof ha?E.interpolation:void 0,v):new Re(p?"constant":"source",i.value,v)):b([new Cl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ze{constructor(n,o){this._parameters=n,this._specification=o,xd(this,q(this._parameters,this._specification))}static deserialize(n){return new ze(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Ne(i){let n=null;if(i instanceof zg)n=Ne(i.result);else if(i instanceof dh){for(const o of i.args)if(n=Ne(o),n)break}else(i instanceof Cd||i instanceof ha)&&i.input instanceof Bo&&i.input.name==="zoom"&&(n=i);return n instanceof Cl||i.eachChild(o=>{const u=Ne(o);u instanceof Cl?n=u:n&&u&&n!==u&&(n=new Cl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var We=Pe,Fe=3;function Pe(i,n,o){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(n=h[1])+2*(o=h[2]);for(var p=0;p<this.d*this.d;p++){var m=h[Fe+p],v=h[Fe+p+1];u.push(m===v?null:h.subarray(m,v))}var w=h[Fe+u.length+1];this.keys=h.subarray(h[Fe+u.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*o;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=i,this.padding=o,this.scale=n/i,this.uid=0;var C=o/n*i;this.min=-C,this.max=i+C}Pe.prototype.insert=function(i,n,o,u,h){this._forEachCell(n,o,u,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h)},Pe.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Pe.prototype._insertCell=function(i,n,o,u,h,p){this.cells[h].push(p)},Pe.prototype.query=function(i,n,o,u,h){var p=this.min,m=this.max;if(i<=p&&n<=p&&m<=o&&m<=u&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,n,o,u,this._queryCell,v,{},h),v},Pe.prototype._queryCell=function(i,n,o,u,h,p,m,v){var w=this.cells[h];if(w!==null)for(var E=this.keys,C=this.bboxes,P=0;P<w.length;P++){var M=w[P];if(m[M]===void 0){var z=4*M;(v?v(C[z+0],C[z+1],C[z+2],C[z+3]):i<=C[z+2]&&n<=C[z+3]&&o>=C[z+0]&&u>=C[z+1])?(m[M]=!0,p.push(E[M])):m[M]=!1}}},Pe.prototype._forEachCell=function(i,n,o,u,h,p,m,v){for(var w=this._convertToCellCoord(i),E=this._convertToCellCoord(n),C=this._convertToCellCoord(o),P=this._convertToCellCoord(u),M=w;M<=C;M++)for(var z=E;z<=P;z++){var j=this.d*z+M;if((!v||v(this._convertFromCellCoord(M),this._convertFromCellCoord(z),this._convertFromCellCoord(M+1),this._convertFromCellCoord(z+1)))&&h.call(this,i,n,o,u,j,p,m,v))return}},Pe.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Pe.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Pe.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,n=Fe+this.cells.length+1+1,o=0,u=0;u<this.cells.length;u++)o+=this.cells[u].length;var h=new Int32Array(n+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=n,m=0;m<i.length;m++){var v=i[m];h[Fe+m]=p,h.set(v,p),p+=v.length}return h[Fe+i.length]=p,h.set(this.keys,p),h[Fe+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var et=de(We);const Qe={};function Ve(i,n,o={}){Object.defineProperty(i,"_classRegistryKey",{value:n,writable:!1}),Qe[n]={klass:i,omit:o.omit||[]}}Ve(Object,"Object"),et.serialize=function(i,n){const o=i.toArrayBuffer();return n&&n.add(o),{buffer:o}},et.deserialize=function(i){return new et(i.buffer)},Object.defineProperty(et,"name",{value:"Grid"}),Ve(et,"Grid"),Ve(Er,"Color"),Ve(Error,"Error"),Ve(go,"Formatted"),Ve(Eg,"FormattedSection"),Ve(_g,"AJAXError"),Ve(sa,"ResolvedImage"),Ve(ze,"StylePropertyFunction"),Ve(ye,"StyleExpression",{omit:["_evaluator"]}),Ve(Se,"ZoomDependentExpression"),Ve(Re,"ZoomConstantExpression"),Ve(Bo,"CompoundExpression",{omit:["_evaluate"]});for(const i in Pd)Qe[Pd[i]._classRegistryKey]||Ve(Pd[i],`Expression${i}`);function xt(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function pt(i){return self.ImageBitmap&&i instanceof ImageBitmap}function He(i,n){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(xt(i)||pt(i))return n&&n.add(i),i;if(ArrayBuffer.isView(i)){const o=i;return n&&n.add(o.buffer),o}if(i instanceof ImageData)return n&&n.add(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const u of i)o.push(He(u,n));return o}if(i instanceof Map){const o={$name:"Map"};for(const[u,h]of i.entries())o[u]=He(h);return o}if(i instanceof Set){const o={$name:"Set"};let u=0;for(const h of i.values())o[++u]=He(h);return o}if(typeof i=="object"){const o=i.constructor,u=o._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const h=o.serialize?o.serialize(i,n):{};if(!o.serialize){for(const p in i)i.hasOwnProperty(p)&&(Qe[u].omit.indexOf(p)>=0||(h[p]=He(i[p],n)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof i)}function it(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||xt(i)||pt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(it);if(typeof i=="object"){const n=i.$name||"Object";if(n==="Map"){const h=new Map;for(const p of Object.keys(i))p!=="$name"&&h.set(p,it(i[p]));return h}if(n==="Set"){const h=new Set;for(const p of Object.keys(i))p!=="$name"&&h.add(it(i[p]));return h}const{klass:o}=Qe[n];if(!o)throw new Error(`can't deserialize unregistered class ${n}`);if(o.deserialize)return o.deserialize(i);const u=Object.create(o.prototype);for(const h of Object.keys(i))h!=="$name"&&(u[h]=it(i[h]));return u}throw new Error("can't deserialize object of type "+typeof i)}const Be={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function mt(i){for(const n of i)if(Vt(n.charCodeAt(0)))return!0;return!1}function _t(i){for(const n of i)if(!Bt(n.charCodeAt(0)))return!1;return!0}function Bt(i){return!(Be.Arabic(i)||Be["Arabic Supplement"](i)||Be["Arabic Extended-A"](i)||Be["Arabic Presentation Forms-A"](i)||Be["Arabic Presentation Forms-B"](i))}function Vt(i){return!(i!==746&&i!==747&&(i<4352||!(Be["Bopomofo Extended"](i)||Be.Bopomofo(i)||Be["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Be["CJK Compatibility Ideographs"](i)||Be["CJK Compatibility"](i)||Be["CJK Radicals Supplement"](i)||Be["CJK Strokes"](i)||!(!Be["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Be["CJK Unified Ideographs Extension A"](i)||Be["CJK Unified Ideographs"](i)||Be["Enclosed CJK Letters and Months"](i)||Be["Hangul Compatibility Jamo"](i)||Be["Hangul Jamo Extended-A"](i)||Be["Hangul Jamo Extended-B"](i)||Be["Hangul Jamo"](i)||Be["Hangul Syllables"](i)||Be.Hiragana(i)||Be["Ideographic Description Characters"](i)||Be.Kanbun(i)||Be["Kangxi Radicals"](i)||Be["Katakana Phonetic Extensions"](i)||Be.Katakana(i)&&i!==12540||!(!Be["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Be["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Be["Unified Canadian Aboriginal Syllabics"](i)||Be["Unified Canadian Aboriginal Syllabics Extended"](i)||Be["Vertical Forms"](i)||Be["Yijing Hexagram Symbols"](i)||Be["Yi Syllables"](i)||Be["Yi Radicals"](i))))}function rn(i){return!(Vt(i)||function(n){return!!(Be["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Be["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Be["Letterlike Symbols"](n)||Be["Number Forms"](n)||Be["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Be["Control Pictures"](n)&&n!==9251||Be["Optical Character Recognition"](n)||Be["Enclosed Alphanumerics"](n)||Be["Geometric Shapes"](n)||Be["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Be["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Be["CJK Symbols and Punctuation"](n)||Be.Katakana(n)||Be["Private Use Area"](n)||Be["CJK Compatibility Forms"](n)||Be["Small Form Variants"](n)||Be["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(i))}function Ht(i){return i>=1424&&i<=2303||Be["Arabic Presentation Forms-A"](i)||Be["Arabic Presentation Forms-B"](i)}function vn(i,n){return!(!n&&Ht(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Be.Khmer(i))}function Fn(i){for(const n of i)if(Ht(n.charCodeAt(0)))return!0;return!1}const bn="deferred",$n="loading",hr="loaded";let Xr=null,Lr="unavailable",pr=null;const Or=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Lr="error"),Xr&&Xr(i)};function Hn(){Yn.fire(new Il("pluginStateChange",{pluginStatus:Lr,pluginURL:pr}))}const Yn=new oh,Bn=function(){return Lr},xr=function(){if(Lr!==bn||!pr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Lr=$n,Hn(),pr&&nh({url:pr},i=>{i?Or(i):(Lr=hr,Hn())})},tr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Lr===hr||tr.applyArabicShaping!=null,isLoading:()=>Lr===$n,setState(i){Lr=i.pluginStatus,pr=i.pluginURL},isParsed:()=>tr.applyArabicShaping!=null&&tr.processBidirectionalText!=null&&tr.processStyledBidirectionalText!=null,getPluginURL:()=>pr};class In{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(o,u){for(const h of o)if(!vn(h.charCodeAt(0),u))return!1;return!0}(n,tr.isLoaded())}}class Bi{constructor(n,o,u,h){this.property=n,this.value=o,this.expression=function(p,m,v,w){if(B(p))return new ze(p,m);if(ve(p)||Array.isArray(p)&&p.length>0){const E=Ie(p,m,v,w);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));return E.value}{let E=p;return typeof p=="string"&&m.type==="color"&&(E=Er.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>E}}}(o===void 0?n.specification.default:o,n.specification,u,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,u){return this.property.possiblyEvaluate(this,n,o,u)}}class ji{constructor(n,o,u){this.property=n,this.value=new Bi(n,void 0,o,u)}transitioned(n,o){return new io(this.property,this.value,o,Is({},n.transition,this.transition),n.now)}untransitioned(){return new io(this.property,this.value,null,{},0)}}class ro{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return zs(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new ji(this._values[n].property,this._scope,this._options)),this._values[n].value=new Bi(this._values[n].property,o===null?void 0:zs(o),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,o){o&&(this._options=o);const u=this._properties.properties;if(n)for(const h in n){const p=n[h];if(Ha(h,"-transition")){const m=h.slice(0,-11);u[m]&&this.setTransition(m,p)}else u.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(n){return zs(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new ji(this._values[n].property)),this._values[n].transition=zs(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u);const h=this.getTransition(o);h!==void 0&&(n[`${o}-transition`]=h)}return n}transitioned(n,o){const u=new Gs(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(n,o._values[h]);return u}untransitioned(){const n=new Gs(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class io{constructor(n,o,u,h,p){const m=h.delay||0,v=h.duration||0;p=p||0,this.property=n,this.value=o,this.begin=p+m,this.end=this.begin+v,n.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(n,o,u){const h=n.now||0,p=this.value.possiblyEvaluate(n,o,u),m=this.prior;if(m){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return m.possiblyEvaluate(n,o,u);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(n,o,u),p,Yu(v))}}return p}}class Gs{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,u){const h=new Ws(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,o,u);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class so{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return zs(this._values[n].value)}setValue(n,o){this._values[n]=new Bi(this._values[n].property,o===null?void 0:zs(o),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u)}return n}possiblyEvaluate(n,o,u){const h=new Ws(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,o,u);return h}}class Ns{constructor(n,o,u){this.property=n,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,u,h){return this.property.evaluate(this.value,this.parameters,n,o,u,h)}}class Ws{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Et{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,u){const h=dp[this.specification.type];return h?h(n,o,u):n}}class on{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,u,h){return new Ns(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},u,h)}:n.expression,o)}interpolate(n,o,u){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new Ns(this,{kind:"constant",value:void 0},n.parameters);const h=dp[this.specification.type];return h?new Ns(this,{kind:"constant",value:h(n.value.value,o.value.value,u)},n.parameters):n}evaluate(n,o,u,h,p,m){return n.kind==="constant"?n.value:n.evaluate(o,u,h,p,m)}}class _o{constructor(n){this.specification=n}possiblyEvaluate(n,o,u,h){return!!n.expression.evaluate(o,null,{},u,h)}interpolate(){return!1}}class Vr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new In(0,{});for(const u in n){const h=n[u];h.specification.overridable&&this.overridableProperties.push(u);const p=this.defaultPropertyValues[u]=new Bi(h,void 0),m=this.defaultTransitionablePropertyValues[u]=new ji(h);this.defaultTransitioningPropertyValues[u]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=p.possiblyEvaluate(o)}}}Ve(on,"DataDrivenProperty"),Ve(Et,"DataConstantProperty"),Ve(_o,"ColorRampProperty");var Je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function gc(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ya(i){if(Array.isArray(i))return i.map(Ya);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const n={};for(const o in i)n[o]=Ya(i[o]);return n}return gc(i)}function _c(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const n of i.slice(1))if(!_c(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function yc(i,n="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};_c(i)||(i=Rd(i));const o=i;let u=!0;try{u=function(E){if(!uu(E))return E;let C=Ya(E);return $g(C),C=Vg(C),C}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const h=Je[`filter_${n}`],p=_e(u,h);let m=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,C,P)=>p.value.evaluate(E,C,{},P);let v=null,w=null;if(u!==o){const E=_e(o,h);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));v=(C,P,M,z,j)=>E.value.evaluate(C,P,{},M,void 0,void 0,z,j),w=!Ep(E.value.expression)}return{filter:m,dynamicFilter:v||void 0,needGeometry:qg(u),needFeature:!!w}}function Vg(i){if(!Array.isArray(i))return i;const n=function(o){if(V0.has(o[0])){for(let u=1;u<o.length;u++)if(uu(o[u]))return!0}return o}(i);return n===!0?n:n.map(o=>Vg(o))}function $g(i){let n=!1;const o=[];if(i[0]==="case"){for(let u=1;u<i.length-1;u+=2)n=n||uu(i[u]),o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="match"){n=n||uu(i[1]);for(let u=2;u<i.length-1;u+=2)o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="step"){n=n||uu(i[1]);for(let u=1;u<i.length-1;u+=2)o.push(i[u+1])}n&&(i.length=0,i.push("any",...o));for(let u=1;u<i.length;u++)$g(i[u])}function uu(i){if(!Array.isArray(i))return!1;if((n=i[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<i.length;o++)if(uu(i[o]))return!0;return!1}const V0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fh(i,n){return i<n?-1:i>n?1:0}function qg(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let n=1;n<i.length;n++)if(qg(i[n]))return!0;return!1}function Rd(i){if(!i)return!0;const n=i[0];return i.length<=1?n!=="any":n==="=="?jA(i[1],i[2],"=="):n==="!="?cw(jA(i[1],i[2],"==")):n==="<"||n===">"||n==="<="||n===">="?jA(i[1],i[2],n):n==="any"?(o=i.slice(1),["any"].concat(o.map(Rd))):n==="all"?["all"].concat(i.slice(1).map(Rd)):n==="none"?["all"].concat(i.slice(1).map(Rd).map(cw)):n==="in"?cL(i[1],i.slice(2)):n==="!in"?cw(cL(i[1],i.slice(2))):n==="has"?uL(i[1]):n!=="!has"||cw(uL(i[1]));var o}function jA(i,n,o){switch(i){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,i,n]}}function cL(i,n){if(n.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",i,["literal",n.sort(fh)]]:["filter-in-small",i,["literal",n]]}}function uL(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function cw(i){return["!",i]}const uw="";function hL(i,n){return n?`${i}${uw}${n}`:i}const dL="-transition",qX=new Set(["fill","line","background","hillshade","raster"]);class da extends oh{constructor(n,o,u,h,p){if(super(),this.id=n.id,this.fqid=hL(this.id,u),this.type=n.type,this.scope=u,this.lut=h,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),o.layout&&(this._unevaluatedLayout=new so(o.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint)){this._transitionablePaint=new ro(o.paint,this.scope,p);for(const m in n.paint)this.setPaintProperty(m,n.paint[m]);for(const m in n.layout)this.setLayoutProperty(m,n.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ws(o.paint)}}onAdd(n){}onRemove(n){}isDraped(n){return qX.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o){if(this.type==="custom"&&n==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[n]&&(u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return Ha(n,dL)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o){const u=this._transitionablePaint,h=u._properties.properties;if(Ha(n,dL)){const P=n.slice(0,-11);return h[P]&&u.setTransition(P,o||void 0),!1}if(!h[n])return!1;const p=u._values[n],m=p.value.isDataDriven(),v=p.value;u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const w=u._values[n].value,E=w.isDataDriven(),C=Ha(n,"pattern")||n==="line-dasharray";return E||m||C||this._handleOverridablePaintPropertyUpdate(n,v,w)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,o,u){return null}_handleOverridablePaintPropertyUpdate(n,o,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){return Cs({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof Ns&&S(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=yc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,o,u,h,p,m,v,w,E){}queryIntersectsMatchingFeature(n,o,u,h){}}const GX={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $0{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class li{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Pr(i,n=1){let o=0,u=0;return{members:i.map(h=>{const p=GX[h.type].BYTES_PER_ELEMENT,m=o=fL(o,Math.max(n,p)),v=h.components||1;return u=Math.max(u,p),o+=p*v,{name:h.name,type:h.type,components:v,offset:m}}),size:fL(o,Math.max(u,n)),alignment:n}}function fL(i,n){return Math.ceil(i/n)*n}class vc extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const h=2*n;return this.int16[h+0]=o,this.int16[h+1]=u,n}}vc.prototype.bytesPerElement=4,Ve(vc,"StructArrayLayout2i4");class hw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u)}emplace(n,o,u,h){const p=3*n;return this.int16[p+0]=o,this.int16[p+1]=u,this.int16[p+2]=h,n}}hw.prototype.bytesPerElement=6,Ve(hw,"StructArrayLayout3i6");class ph extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=4*n;return this.int16[m+0]=o,this.int16[m+1]=u,this.int16[m+2]=h,this.int16[m+3]=p,n}}ph.prototype.bytesPerElement=8,Ve(ph,"StructArrayLayout4i8");class UA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=5*n;return this.int16[v+0]=o,this.int16[v+1]=u,this.int16[v+2]=h,this.int16[v+3]=p,this.int16[v+4]=m,n}}UA.prototype.bytesPerElement=10,Ve(UA,"StructArrayLayout5i10");class VA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=6*n,C=12*n,P=3*n;return this.int16[E+0]=o,this.int16[E+1]=u,this.uint8[C+4]=h,this.uint8[C+5]=p,this.uint8[C+6]=m,this.uint8[C+7]=v,this.float32[P+2]=w,n}}VA.prototype.bytesPerElement=12,Ve(VA,"StructArrayLayout2i4ub1f12");class Md extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=4*n;return this.float32[m+0]=o,this.float32[m+1]=u,this.float32[m+2]=h,this.float32[m+3]=p,n}}Md.prototype.bytesPerElement=16,Ve(Md,"StructArrayLayout4f16");class kd extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u)}emplace(n,o,u,h){const p=3*n;return this.float32[p+0]=o,this.float32[p+1]=u,this.float32[p+2]=h,n}}kd.prototype.bytesPerElement=12,Ve(kd,"StructArrayLayout3f12");class Dd extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=6*n,w=3*n;return this.uint16[v+0]=o,this.uint16[v+1]=u,this.uint16[v+2]=h,this.uint16[v+3]=p,this.float32[w+2]=m,n}}Dd.prototype.bytesPerElement=12,Ve(Dd,"StructArrayLayout4ui1f12");class dw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=4*n;return this.uint16[m+0]=o,this.uint16[m+1]=u,this.uint16[m+2]=h,this.uint16[m+3]=p,n}}dw.prototype.bytesPerElement=8,Ve(dw,"StructArrayLayout4ui8");class fw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,h,p,m)}emplace(n,o,u,h,p,m,v){const w=6*n;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=h,this.int16[w+3]=p,this.int16[w+4]=m,this.int16[w+5]=v,n}}fw.prototype.bytesPerElement=12,Ve(fw,"StructArrayLayout6i12");class $A extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M){const z=this.length;return this.resize(z+1),this.emplace(z,n,o,u,h,p,m,v,w,E,C,P,M)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z){const j=12*n;return this.int16[j+0]=o,this.int16[j+1]=u,this.int16[j+2]=h,this.int16[j+3]=p,this.uint16[j+4]=m,this.uint16[j+5]=v,this.uint16[j+6]=w,this.uint16[j+7]=E,this.int16[j+8]=C,this.int16[j+9]=P,this.int16[j+10]=M,this.int16[j+11]=z,n}}$A.prototype.bytesPerElement=24,Ve($A,"StructArrayLayout4i4ui4i24");class qA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,h,p,m)}emplace(n,o,u,h,p,m,v){const w=10*n,E=5*n;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=h,this.float32[E+2]=p,this.float32[E+3]=m,this.float32[E+4]=v,n}}qA.prototype.bytesPerElement=20,Ve(qA,"StructArrayLayout3i3f20");class GA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}GA.prototype.bytesPerElement=4,Ve(GA,"StructArrayLayout1ul4");class Od extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const h=2*n;return this.uint16[h+0]=o,this.uint16[h+1]=u,n}}Od.prototype.bytesPerElement=4,Ve(Od,"StructArrayLayout2ui4");class WA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M,z){const j=this.length;return this.resize(j+1),this.emplace(j,n,o,u,h,p,m,v,w,E,C,P,M,z)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z,j){const V=20*n,$=10*n;return this.int16[V+0]=o,this.int16[V+1]=u,this.int16[V+2]=h,this.int16[V+3]=p,this.int16[V+4]=m,this.float32[$+3]=v,this.float32[$+4]=w,this.float32[$+5]=E,this.float32[$+6]=C,this.int16[V+14]=P,this.uint32[$+8]=M,this.uint16[V+18]=z,this.uint16[V+19]=j,n}}WA.prototype.bytesPerElement=40,Ve(WA,"StructArrayLayout5i4f1i1ul2ui40");class pw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=8*n;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=h,this.int16[E+4]=p,this.int16[E+5]=m,this.int16[E+6]=v,this.int16[E+7]=w,n}}pw.prototype.bytesPerElement=16,Ve(pw,"StructArrayLayout3i2i2i16");class HA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=4*n,w=8*n;return this.float32[v+0]=o,this.float32[v+1]=u,this.float32[v+2]=h,this.int16[w+6]=p,this.int16[w+7]=m,n}}HA.prototype.bytesPerElement=16,Ve(HA,"StructArrayLayout2f1f2i16");class ZA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=12*n,v=3*n;return this.uint8[m+0]=o,this.uint8[m+1]=u,this.float32[v+1]=h,this.float32[v+2]=p,n}}ZA.prototype.bytesPerElement=12,Ve(ZA,"StructArrayLayout2ub2f12");class Fs extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u)}emplace(n,o,u,h){const p=3*n;return this.uint16[p+0]=o,this.uint16[p+1]=u,this.uint16[p+2]=h,n}}Fs.prototype.bytesPerElement=6,Ve(Fs,"StructArrayLayout3ui6");class XA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,ee,pe,fe,me,Ce){const Ae=this.length;return this.resize(Ae+1),this.emplace(Ae,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,ee,pe,fe,me,Ce)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,ee,pe,fe,me,Ce,Ae){const Le=30*n,$e=15*n,Ze=60*n;return this.int16[Le+0]=o,this.int16[Le+1]=u,this.int16[Le+2]=h,this.float32[$e+2]=p,this.float32[$e+3]=m,this.uint16[Le+8]=v,this.uint16[Le+9]=w,this.uint32[$e+5]=E,this.uint32[$e+6]=C,this.uint32[$e+7]=P,this.uint16[Le+16]=M,this.uint16[Le+17]=z,this.uint16[Le+18]=j,this.float32[$e+10]=V,this.float32[$e+11]=$,this.uint8[Ze+48]=ee,this.uint8[Ze+49]=pe,this.uint8[Ze+50]=fe,this.uint32[$e+13]=me,this.int16[Le+28]=Ce,this.uint8[Ze+58]=Ae,n}}XA.prototype.bytesPerElement=60,Ve(XA,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class KA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,ee,pe,fe,me,Ce,Ae,Le,$e,Ze,nt,Ke,at,bt,lt,St,ot){const gt=this.length;return this.resize(gt+1),this.emplace(gt,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,ee,pe,fe,me,Ce,Ae,Le,$e,Ze,nt,Ke,at,bt,lt,St,ot)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,ee,pe,fe,me,Ce,Ae,Le,$e,Ze,nt,Ke,at,bt,lt,St,ot,gt){const Pt=20*n,ct=40*n,Nt=80*n;return this.float32[Pt+0]=o,this.float32[Pt+1]=u,this.int16[ct+4]=h,this.int16[ct+5]=p,this.int16[ct+6]=m,this.int16[ct+7]=v,this.int16[ct+8]=w,this.int16[ct+9]=E,this.int16[ct+10]=C,this.int16[ct+11]=P,this.int16[ct+12]=M,this.uint16[ct+13]=z,this.uint16[ct+14]=j,this.uint16[ct+15]=V,this.uint16[ct+16]=$,this.uint16[ct+17]=ee,this.uint16[ct+18]=pe,this.uint16[ct+19]=fe,this.uint16[ct+20]=me,this.uint16[ct+21]=Ce,this.uint16[ct+22]=Ae,this.uint16[ct+23]=Le,this.uint16[ct+24]=$e,this.uint16[ct+25]=Ze,this.uint16[ct+26]=nt,this.uint16[ct+27]=Ke,this.uint32[Pt+14]=at,this.float32[Pt+15]=bt,this.float32[Pt+16]=lt,this.float32[Pt+17]=St,this.float32[Pt+18]=ot,this.uint8[Nt+76]=gt,n}}KA.prototype.bytesPerElement=80,Ve(KA,"StructArrayLayout2f9i15ui1ul4f1ub80");class Gg extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}Gg.prototype.bytesPerElement=4,Ve(Gg,"StructArrayLayout1f4");class Op extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=5*n;return this.float32[v+0]=o,this.float32[v+1]=u,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=m,n}}Op.prototype.bytesPerElement=20,Ve(Op,"StructArrayLayout5f20");class QA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=7*n;return this.float32[E+0]=o,this.float32[E+1]=u,this.float32[E+2]=h,this.float32[E+3]=p,this.float32[E+4]=m,this.float32[E+5]=v,this.float32[E+6]=w,n}}QA.prototype.bytesPerElement=28,Ve(QA,"StructArrayLayout7f28");class YA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=6*n;return this.uint32[3*n+0]=o,this.uint16[m+2]=u,this.uint16[m+3]=h,this.uint16[m+4]=p,n}}YA.prototype.bytesPerElement=12,Ve(YA,"StructArrayLayout1ul3ui12");class q0 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}q0.prototype.bytesPerElement=2,Ve(q0,"StructArrayLayout1ui2");class G0 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const h=2*n;return this.float32[h+0]=o,this.float32[h+1]=u,n}}G0.prototype.bytesPerElement=8,Ve(G0,"StructArrayLayout2f8");class JA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$){const ee=this.length;return this.resize(ee+1),this.emplace(ee,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,ee){const pe=16*n;return this.float32[pe+0]=o,this.float32[pe+1]=u,this.float32[pe+2]=h,this.float32[pe+3]=p,this.float32[pe+4]=m,this.float32[pe+5]=v,this.float32[pe+6]=w,this.float32[pe+7]=E,this.float32[pe+8]=C,this.float32[pe+9]=P,this.float32[pe+10]=M,this.float32[pe+11]=z,this.float32[pe+12]=j,this.float32[pe+13]=V,this.float32[pe+14]=$,this.float32[pe+15]=ee,n}}JA.prototype.bytesPerElement=64,Ve(JA,"StructArrayLayout16f64");class mw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=10*n,C=5*n;return this.uint16[E+0]=o,this.uint16[E+1]=u,this.uint16[E+2]=h,this.uint16[E+3]=p,this.float32[C+2]=m,this.float32[C+3]=v,this.float32[C+4]=w,n}}mw.prototype.bytesPerElement=20,Ve(mw,"StructArrayLayout4ui3f20");class eP extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.int16[1*n+0]=o,n}}eP.prototype.bytesPerElement=2,Ve(eP,"StructArrayLayout1i2");class tP extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint8[1*n+0]=o,n}}tP.prototype.bytesPerElement=1,Ve(tP,"StructArrayLayout1ub1");class pL extends $0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pL.prototype.size=40;class nP extends WA{get(n){return new pL(this,n)}}Ve(nP,"CollisionBoxArray");class mL extends $0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}mL.prototype.size=60;class gL extends XA{get(n){return new mL(this,n)}}Ve(gL,"PlacedSymbolArray");class _L extends $0{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}_L.prototype.size=80;class yL extends KA{get(n){return new _L(this,n)}}Ve(yL,"SymbolInstanceArray");class vL extends Gg{getoffsetX(n){return this.float32[1*n+0]}}Ve(vL,"GlyphOffsetArray");class xL extends vc{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Ve(xL,"SymbolLineVertexArray");class bL extends $0{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bL.prototype.size=12;class wL extends YA{get(n){return new bL(this,n)}}Ve(wL,"FeatureIndexArray");class TL extends Od{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Ve(TL,"FillExtrusionCentroidArray");class EL extends $0{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}EL.prototype.size=8;class SL extends ph{get(n){return new EL(this,n)}}Ve(SL,"FillExtrusionWallArray");const WX=Pr([{name:"a_pos",components:2,type:"Int16"}],4),HX=Pr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class gi{constructor(n=[]){this.segments=n}_prepareSegment(n,o,u,h){let p=this.segments[this.segments.length-1];return n>gi.MAX_VERTEX_ARRAY_LENGTH&&bi(`Max vertices per segment is ${gi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!p||p.vertexLength+n>gi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(n,o,u,h){return this._prepareSegment(n,o.length,u.length,h)}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,u,h){return new gi([{vertexOffset:n,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function IL(i,n){return 256*(i=Wn(Math.floor(i),0,255))+Wn(Math.floor(n),0,255)}gi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ve(gi,"SegmentVector");const ZX=Pr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),XX=Pr([{name:"a_dash",components:4,type:"Uint16"}]);class W0{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,o,u,h){this.ids.push(CL(n)),this.positions.push(o,u,h)}eachPosition(n,o){const u=CL(n);let h=0,p=this.ids.length-1;for(;h<p;){const m=h+p>>1;this.ids[m]>=u?p=m:h=m+1}for(;this.ids[h]===u;)o(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(n,o){const u=new Float64Array(n.ids),h=new Uint32Array(n.positions);return rP(u,h,0,u.length-1),o&&(o.add(u.buffer),o.add(h.buffer)),{ids:u,positions:h}}static deserialize(n){const o=new W0;let u;o.ids=n.ids,o.positions=n.positions;for(const h of o.ids)h!==u&&o.uniqueIds.push(h),u=h;return o.indexed=!0,o}}function CL(i){const n=+i;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:yg(String(i))}function rP(i,n,o,u){for(;o<u;){const h=i[o+u>>1];let p=o-1,m=u+1;for(;;){do p++;while(i[p]<h);do m--;while(i[m]>h);if(p>=m)break;gw(i,p,m),gw(n,3*p,3*m),gw(n,3*p+1,3*m+1),gw(n,3*p+2,3*m+2)}m-o<u-m?(rP(i,n,o,m),o=m+1):(rP(i,n,m+1,u),u=m)}}function gw(i,n,o){const u=i[n];i[n]=i[o],i[o]=u}Ve(W0,"FeaturePositionMap");class mh{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}set(n,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class _w extends mh{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class jo extends mh{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class gh extends mh{constructor(n){super(n),this.current=[0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class iP extends mh{constructor(n){super(n),this.current=[0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class sP extends mh{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class AL extends mh{constructor(n){super(n),this.current=Er.transparent.toRenderColor(null)}set(n,o,u){this.fetchUniformLocation(n,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const KX=new Float32Array(16);class H0 extends mh{constructor(n){super(n),this.current=KX}set(n,o,u){if(this.fetchUniformLocation(n,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const QX=new Float32Array(9),YX=new Float32Array(4);class oP extends mh{constructor(n){super(n),this.current=YX}set(n,o,u){if(this.fetchUniformLocation(n,o)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function aP(i){return[IL(255*i.r,255*i.g),IL(255*i.b,255*i.a)]}class Z0{constructor(n,o,u,h){this.value=n,this.uniformNames=o.map(p=>`u_${p}`),this.type=u,this.context=h}setUniform(n,o,u,h,p){const m=h.constantOr(this.value);o.set(n,p,m instanceof Er?m.toRenderColor(this.context.lut):m)}getBinding(n,o){return this.type==="color"?new AL(n):new jo(n)}}class Wg{constructor(n,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,o,u,h,p){const m=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;m&&o.set(n,p,m)}getBinding(n,o){return o==="u_pattern"||o==="u_dash"?new sP(n):new jo(n)}}class _h{constructor(n,o,u,h){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(p=>({name:`a_${p}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,o,u,h,p,m,v){const w=this.paintVertexArray.length,E=this.expression.evaluate(new In(0,{brightness:m}),o,{},p,h,v);this.paintVertexArray.resize(n),this._setPaintValue(w,n,E,this.context)}updatePaintArray(n,o,u,h,p,m,v){const w=this.expression.evaluate({zoom:0,brightness:v},u,h,void 0,p);this._setPaintValue(n,o,w,this.context)}_setPaintValue(n,o,u,h){if(this.type==="color"){const p=aP(u.toRenderColor(h.lut));for(let m=n;m<o;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=n;p<o;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xc{constructor(n,o,u,h,p,m){this.expression=n,this.uniformNames=o.map(v=>`u_${v}_t`),this.type=u,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=o.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(n,o,u,h,p,m,v){const w=this.expression.evaluate(new In(this.context.zoom,{brightness:m}),o,{},p,h,v),E=this.expression.evaluate(new In(this.context.zoom+1,{brightness:m}),o,{},p,h,v),C=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(C,n,w,E,this.context)}updatePaintArray(n,o,u,h,p,m,v){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:v},u,h,void 0,p),E=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},u,h,void 0,p);this._setPaintValue(n,o,w,E,this.context)}_setPaintValue(n,o,u,h,p){if(this.type==="color"){const m=aP(u.toRenderColor(p.lut)),v=aP(u.toRenderColor(p.lut));for(let w=n;w<o;w++)this.paintVertexArray.emplace(w,m[0],m[1],v[0],v[1])}else{for(let m=n;m<o;m++)this.paintVertexArray.emplace(m,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,u,h,p){const m=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=Wn(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);o.set(n,p,v)}getBinding(n,o){return new jo(n)}}class Ld{constructor(n,o,u,h,p){this.expression=n,this.layerId=p,this.paintVertexAttributes=(u==="array"?XX:ZX).members;for(let m=0;m<o.length;++m);this.paintVertexArray=new h}populatePaintArray(n,o,u,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(p,n,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(n,o,u,h,p,m,v){this._setPaintValues(n,o,u.patterns&&u.patterns[this.layerId],m)}_setPaintValues(n,o,u,h){if(!h||!u)return;const p=h[u];if(!p)return;const{tl:m,br:v,pixelRatio:w}=p;for(let E=n;E<o;E++)this.paintVertexArray.emplace(E,m[0],m[1],v[0],v[1],w)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Lp{constructor(n,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const h=[];for(const p in n.paint._values){const m=n.paint.get(p);if(!u(p)||!(m instanceof Ns&&S(m.property.specification)))continue;const v=eK(p,n.type),w=m.value,E=m.property.specification.type,C=!!m.property.useIntegerZoom,P=p==="line-dasharray"||p.endsWith("pattern"),M=p==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||M)if(w.kind==="source"||M||P){const z=PL(p,E,"source");this.binders[p]=P?new Ld(w,v,E,z,n.id):new _h(w,v,E,z),h.push(`/a_${p}`)}else{const z=PL(p,E,"composite");this.binders[p]=new xc(w,v,E,C,o,z),h.push(`/z_${p}`)}else this.binders[p]=P?new Wg(w.value,v):new Z0(w.value,v,E,o),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof _h||o instanceof xc?o.maxValue:0}populatePaintArrays(n,o,u,h,p,m,v){for(const w in this.binders){const E=this.binders[w];E.context=this.context,(E instanceof _h||E instanceof xc||E instanceof Ld)&&E.populatePaintArray(n,o,u,h,p,m,v)}}setConstantPatternPositions(n){for(const o in this.binders){const u=this.binders[o];u instanceof Wg&&u.setConstantPatternPositions(n)}}updatePaintArrays(n,o,u,h,p,m,v,w){let E=!1;const C=Object.keys(n),P=C.length!==0,M=P?C:o.uniqueIds;this.context.lut=p.lut;for(const z in this.binders){const j=this.binders[z];if(j.context=this.context,(j instanceof _h||j instanceof xc||j instanceof Ld)&&(j.expression.isStateDependent===!0||j.expression.isLightConstant===!1)){const V=p.paint.get(z);j.expression=V.value;for(const $ of M){const ee=n[$.toString()];o.eachPosition($,(pe,fe,me)=>{const Ce=h.feature(pe);j.updatePaintArray(fe,me,Ce,ee,m,v,w)})}if(!P)for(const $ of u.uniqueIds){const ee=n[$.toString()];u.eachPosition($,(pe,fe,me)=>{const Ce=h.feature(pe);j.updatePaintArray(fe,me,Ce,ee,m,v,w)})}E=!0}}return E}defines(){const n=[];for(const o in this.binders){const u=this.binders[o];(u instanceof Z0||u instanceof Wg)&&n.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof _h||u instanceof xc||u instanceof Ld)for(let h=0;h<u.paintVertexAttributes.length;h++)n.push(u.paintVertexAttributes[h].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof Z0||u instanceof Wg||u instanceof xc)for(const h of u.uniformNames)n.push(h)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof Z0||h instanceof Wg||h instanceof xc)for(const p of h.uniformNames)o.push({name:p,property:u,binding:h.getBinding(n,p)})}return o}setUniforms(n,o,u,h,p){for(const{name:m,property:v,binding:w}of u)this.binders[v].setUniform(n,w,p,h.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof _h||o instanceof xc||o instanceof Ld)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(n){for(const o in this.binders){const u=this.binders[o];(u instanceof _h||u instanceof xc||u instanceof Ld)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof _h||o instanceof xc||o instanceof Ld)&&o.destroy()}}}class zd{constructor(n,o,u=()=>!0){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new Lp(h,o,u);this.needsUpload=!1,this._featureMap=new W0,this._featureMapWithoutIds=new W0,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,o,u,h,p,m,v,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(n,o,h,p,m,v,w);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,u,h,p,m){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,o,v,h,p,m||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const JX={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function eK(i,n){return JX[i]||[i.replace(`${n}-`,"").replace(/-/g,"_")]}const tK={"line-pattern":{source:Dd,composite:Dd},"fill-pattern":{source:Dd,composite:Dd},"fill-extrusion-pattern":{source:Dd,composite:Dd},"line-dasharray":{source:dw,composite:dw}},nK={color:{source:G0,composite:Md},number:{source:Gg,composite:G0}};function PL(i,n,o){const u=tK[i];return u&&u[o]||nK[n][o]}Ve(Z0,"ConstantBinder"),Ve(Wg,"PatternConstantBinder"),Ve(_h,"SourceExpressionBinder"),Ve(Ld,"PatternCompositeBinder"),Ve(xc,"CompositeExpressionBinder"),Ve(Lp,"ProgramConfiguration",{omit:["_buffers"]}),Ve(zd,"ProgramConfigurationSet");const Uo=Dt/Math.PI/2,lP=5,RL=6,rK=16383,Hg=64,cP=[Hg,32,16],Pl=-Uo,Rl=Uo;function Zg(i,n,o,u=Uo){return o=er(o),[i*Math.sin(o)*u,-n*u,i*Math.cos(o)*u]}function zp(i,n,o){return Zg(Math.cos(er(i)),Math.sin(er(i)),n,o)}const Xg=63710088e-1,uP=2*Math.PI*Xg;class wr{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new wr(sc(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,u=this.lat*o,h=n.lat*o,p=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((n.lng-this.lng)*o);return Xg*Math.acos(Math.min(p,1))}toBounds(n=0){const o=360*n/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Nd({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(n){return zp(this.lat,this.lng,Uo+n*Uo/Xg)}static convert(n){if(n instanceof wr)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new wr(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new wr(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Nd{constructor(n,o){if(n)if(o)this.setSouthWest(n).setNorthEast(o);else if(n.length===4){const u=n;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=n;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(n){return this._ne=n instanceof wr?new wr(n.lng,n.lat):wr.convert(n),this}setSouthWest(n){return this._sw=n instanceof wr?new wr(n.lng,n.lat):wr.convert(n),this}extend(n){const o=this._sw,u=this._ne;let h,p;if(n instanceof wr)h=n,p=n;else{if(!(n instanceof Nd))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Nd.convert(n)):this.extend(wr.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(wr.convert(n)):this;if(h=n._sw,p=n._ne,!h||!p)return this}return o||u?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new wr(h.lng,h.lat),this._ne=new wr(p.lng,p.lat)),this}getCenter(){return new wr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new wr(this.getWest(),this.getNorth())}getSouthEast(){return new wr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:u}=wr.convert(n);let h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(n){return!n||n instanceof Nd?n:new Nd(n)}}var ML={};(function(i,n){(function(o){function u(p,m,v){var w=h(256*p,256*(m=Math.pow(2,v)-m-1),v),E=h(256*(p+1),256*(m+1),v);return w[0]+","+w[1]+","+E[0]+","+E[1]}function h(p,m,v){var w=2*Math.PI*6378137/256/Math.pow(2,v);return[p*w-2*Math.PI*6378137/2,m*w-2*Math.PI*6378137/2]}o.getURL=function(p,m,v,w,E,C){return C=C||{},p+"?"+["bbox="+u(v,w,E),"format="+(C.format||"image/png"),"service="+(C.service||"WMS"),"version="+(C.version||"1.1.1"),"request="+(C.request||"GetMap"),"srs="+(C.srs||"EPSG:3857"),"width="+(C.width||256),"height="+(C.height||256),"layers="+m].join("&")},o.getTileBBox=u,o.getMercCoords=h,Object.defineProperty(o,"__esModule",{value:!0})})(n)})(0,ML);var iK=ML;class Np{constructor(n,o,u){this.z=n,this.x=o,this.y=u,this.key=Kg(0,n,n,o,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o){const u=iK.getTileBBox(this.x,this.y,this.z),h=function(p,m,v){let w,E="";for(let C=p;C>0;C--)w=1<<C-1,E+=(m&w?1:0)+(v&w?2:0);return E}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kL{constructor(n,o){this.wrap=n,this.canonical=o,this.key=Kg(n,o.z,o.z,o.x,o.y)}}class gs{constructor(n,o,u,h,p){this.overscaledZ=n,this.wrap=o,this.canonical=new Np(u,+h,+p),this.key=o===0&&n===u?this.canonical.key:Kg(o,n,u,h,p)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new gs(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gs(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return Kg(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-n;return Kg(this.wrap*+o,n,n,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new gs(o,this.wrap,o,u,h),new gs(o,this.wrap,o,u+1,h),new gs(o,this.wrap,o,u,h+1),new gs(o,this.wrap,o,u+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new gs(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kL(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Kg(i,n,o,u,h){const p=1<<Math.min(o,22);let m=p*(h%p)+u%p;return i&&o<22&&(m+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-o)))),16*(32*m+o)+(n-o)}const sK=[i=>{let n=i.canonical.x-1,o=i.wrap;return n<0&&(n=(1<<i.canonical.z)-1,o--),new gs(i.overscaledZ,o,i.canonical.z,n,i.canonical.y)},i=>{let n=i.canonical.x+1,o=i.wrap;return n===1<<i.canonical.z&&(n=0,o++),new gs(i.overscaledZ,o,i.canonical.z,n,i.canonical.y)},i=>new gs(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new gs(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];Ve(Np,"CanonicalTileID"),Ve(gs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const oK=0,aK=25.5;function hP(i){return uP*Math.cos(i*Math.PI/180)}function hu(i){return(180+i)/360}function du(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Vo(i,n){return i/hP(n)}function fa(i){return 360*i-180}function Hs(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function DL(i,n){return i*hP(Hs(n))}const Ui=85.051129;function OL(i){return Math.cos(er(Wn(i,-Ui,Ui)))}function Fp(i,n){const o=Wn(n,oK,aK),u=Math.pow(2,o);return OL(i)*uP/(512*u)}function LL(i){return 1/Math.cos(i*Math.PI/180)}function yw(i,n=0){const o=Math.exp(Math.PI*(1-(i.y+n/Dt)/(1<<i.z)*2));return 80150034*o/(o*o+1)/Dt/(1<<i.z)}class yo{constructor(n,o,u=0){this.x=+n,this.y=+o,this.z=+u}static fromLngLat(n,o=0){const u=wr.convert(n);return new yo(hu(u.lng),du(u.lat),Vo(o,u.lat))}toLngLat(){return new wr(fa(this.x),Hs(this.y))}toAltitude(){return DL(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/uP*LL(Hs(this.y))}}function dP(i,n,o,u,h,p,m,v,w){const E=(n+u)/2,C=(o+h)/2,P=new Lt(E,C);v(P),function(M,z,j,V,$,ee){const pe=j-$,fe=V-ee;return Math.abs((V-z)*pe-(j-M)*fe)/Math.hypot(pe,fe)}(P.x,P.y,p.x,p.y,m.x,m.y)>=w?(dP(i,n,o,E,C,p,P,v,w),dP(i,E,C,u,h,P,m,v,w)):i.push(m)}function zL(i,n,o){let u=i[0],h=u.x,p=u.y;n(u);const m=[u];for(let v=1;v<i.length;v++){const w=i[v],{x:E,y:C}=w;n(w),dP(m,h,p,E,C,u,w,n,o),h=E,p=C,u=w}return m}function fP(i,n,o,u){if(u(n,o)){const h=n.add(o)._mult(.5);fP(i,n,h,u),fP(i,h,o,u)}else i.push(o)}function lK(i,n){let o=i[0];const u=[o];for(let h=1;h<i.length;h++){const p=i[h];fP(u,o,p,n),o=p}return u}const pP=Math.pow(2,14)-1,NL=-pP-1;function cK(i,n){const o=Math.round(i.x*n),u=Math.round(i.y*n);return i.x=Wn(o,NL,pP),i.y=Wn(u,NL,pP),(o<i.x||o>i.x+1||u<i.y||u>i.y+1)&&bi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function bc(i,n,o){const u=i.loadGeometry(),h=i.extent,p=Dt/h;if(n&&o&&o.projection.isReprojectedInTileSpace){const m=1<<n.z,{scale:v,x:w,y:E,projection:C}=o,P=M=>{const z=fa((n.x+M.x/h)/m),j=Hs((n.y+M.y/h)/m),V=C.project(z,j);M.x=(V.x*v-w)*h,M.y=(V.y*v-E)*h};for(let M=0;M<u.length;M++)if(i.type!==1)u[M]=zL(u[M],P,1);else{const z=[];for(const j of u[M])j.x<0||j.x>=h||j.y<0||j.y>=h||(P(j),z.push(j));u[M]=z}}for(const m of u)for(const v of m)cK(v,p);return u}function yh(i,n){return{type:i.type,id:i.id,properties:i.properties,geometry:n?bc(i):[]}}function vw(i,n,o,u,h){i.emplaceBack(2*n+(u+1)/2,2*o+(h+1)/2)}function xw(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class mP{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new vc,this.indexArray=new Fs,this.segments=new gi,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(n,o){}populate(n,o,u,h){const p=this.layers[0],m=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:P,sourceLayerIndex:M}of n){const z=this.layers[0]._featureFilter.needGeometry,j=yh(E,z);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),j,u))continue;const V=v?v.evaluate(j,{},u):void 0,$={id:C,properties:E.properties,type:E.type,sourceLayerIndex:M,index:P,geometry:z?j.geometry:bc(E,u,h),patterns:{},sortKey:V};m.push($)}v&&m.sort((E,C)=>E.sortKey-C.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new fw,w=h.projection);for(const E of m){const{geometry:C,index:P,sourceLayerIndex:M}=E,z=n[P].feature;this.addFeature(E,C,P,o.availableImages,u,w,o.brightness),o.featureIndex.insert(z,C,P,M,this.index)}}update(n,o,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,u,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,WX.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,HX.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,o,u,h,p,m,v){for(const w of o)for(const E of w){const C=E.x,P=E.y;if(C<0||C>=Dt||P<0||P>=Dt)continue;if(m){const j=m.projectTilePoint(C,P,p),V=m.upVector(p,C,P),$=this.globeExtVertexArray;xw($,j,V),xw($,j,V),xw($,j,V),xw($,j,V)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),z=M.vertexLength;vw(this.layoutVertexArray,C,P,-1,-1),vw(this.layoutVertexArray,C,P,1,-1),vw(this.layoutVertexArray,C,P,1,1),vw(this.layoutVertexArray,C,P,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},h,p,v)}}function gP(i,n){for(let o=0;o<i.length;o++)if(Fd(n,i[o]))return!0;for(let o=0;o<n.length;o++)if(Fd(i,n[o]))return!0;return!!_P(i,n)}function uK(i,n,o){return!!Fd(i,n)||!!yP(n,i,o)}function FL(i,n){if(i.length===1)return jL(n,i[0]);for(let o=0;o<n.length;o++){const u=n[o];for(let h=0;h<u.length;h++)if(Fd(i,u[h]))return!0}for(let o=0;o<i.length;o++)if(jL(n,i[o]))return!0;for(let o=0;o<n.length;o++)if(_P(i,n[o]))return!0;return!1}function hK(i,n,o){if(i.length>1){if(_P(i,n))return!0;for(let u=0;u<n.length;u++)if(yP(n[u],i,o))return!0}for(let u=0;u<i.length;u++)if(yP(i[u],n,o))return!0;return!1}function _P(i,n){if(i.length===0||n.length===0)return!1;for(let o=0;o<i.length-1;o++){const u=i[o],h=i[o+1];for(let p=0;p<n.length-1;p++)if(dK(u,h,n[p],n[p+1]))return!0}return!1}function dK(i,n,o,u){return ra(i,o,u)!==ra(n,o,u)&&ra(i,n,o)!==ra(i,n,u)}function yP(i,n,o){const u=o*o;if(n.length===1)return i.distSqr(n[0])<u;for(let h=1;h<n.length;h++)if(BL(i,n[h-1],n[h])<u)return!0;return!1}function BL(i,n,o){const u=n.distSqr(o);if(u===0)return i.distSqr(n);const h=((i.x-n.x)*(o.x-n.x)+(i.y-n.y)*(o.y-n.y))/u;return i.distSqr(h<0?n:h>1?o:o.sub(n)._mult(h)._add(n))}function jL(i,n){let o,u,h,p=!1;for(let m=0;m<i.length;m++){o=i[m];for(let v=0,w=o.length-1;v<o.length;w=v++)u=o[v],h=o[w],u.y>n.y!=h.y>n.y&&n.x<(h.x-u.x)*(n.y-u.y)/(h.y-u.y)+u.x&&(p=!p)}return p}function Fd(i,n){let o=!1;for(let u=0,h=i.length-1;u<i.length;h=u++){const p=i[u],m=i[h];p.y>n.y!=m.y>n.y&&n.x<(m.x-p.x)*(n.y-p.y)/(m.y-p.y)+p.x&&(o=!o)}return o}function UL(i,n,o,u,h){for(const m of i)if(n<=m.x&&o<=m.y&&u>=m.x&&h>=m.y)return!0;const p=[new Lt(n,o),new Lt(n,h),new Lt(u,h),new Lt(u,o)];if(i.length>2){for(const m of p)if(Fd(i,m))return!0}for(let m=0;m<i.length-1;m++)if(fK(i[m],i[m+1],p))return!0;return!1}function fK(i,n,o){const u=o[0],h=o[2];if(i.x<u.x&&n.x<u.x||i.x>h.x&&n.x>h.x||i.y<u.y&&n.y<u.y||i.y>h.y&&n.y>h.y)return!1;const p=ra(i,n,o[0]);return p!==ra(i,n,o[1])||p!==ra(i,n,o[2])||p!==ra(i,n,o[3])}function Qg(i,n,o,u,h,p){let m=n.y-i.y,v=i.x-n.x;if(p=p||0){const w=m*m+v*v;if(w===0)return!0;const E=Math.sqrt(w);m/=E,v/=E}return!((o.x-i.x)*m+(o.y-i.y)*v-p<0||(u.x-i.x)*m+(u.y-i.y)*v-p<0||(h.x-i.x)*m+(h.y-i.y)*v-p<0)}function vP(i,n,o,u,h,p,m){return!(Qg(i,n,u,h,p,m)||Qg(n,o,u,h,p,m)||Qg(o,i,u,h,p,m)||Qg(u,h,i,n,o,m)||Qg(h,p,i,n,o,m)||Qg(p,u,i,n,o,m))}function Yg(i,n,o){const u=n.paint.get(i).value;return u.kind==="constant"?u.value:o.programConfigurations.get(n.id).getMaxValue(i)}function bw(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function VL(i,n,o,u,h){if(!n[0]&&!n[1])return i;const p=Lt.convert(n)._mult(h);o==="viewport"&&p._rotate(-u);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(p));return m}function $L(i,n,o,u){const h=Lt.convert(i)._mult(u);return n==="viewport"&&h._rotate(-o),h}let qL,GL;Ve(mP,"CircleBucket",{omit:["layers"]});class xP{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,u){const h=a.$.dot(o,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/h;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,u[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(n,o,u){if(a.$.equals(this.pos,n)||o===0)return u[0]=u[1]=u[2]=0,!1;const[h,p,m]=this.dir,v=this.pos[0]-n[0],w=this.pos[1]-n[1],E=this.pos[2]-n[2],C=h*h+p*p+m*m,P=2*(v*h+w*p+E*m),M=P*P-4*C*(v*v+w*w+E*E-o*o);if(M<0){const z=Math.max(-P/2,0),j=v+h*z,V=w+p*z,$=E+m*z,ee=Math.hypot(j,V,$);return u[0]=j*o/ee,u[1]=V*o/ee,u[2]=$*o/ee,!1}{const z=(-P-Math.sqrt(M))/(2*C);if(z<0){const j=Math.hypot(v,w,E);return u[0]=v*o/j,u[1]=w*o/j,u[2]=E*o/j,!1}return u[0]=v+h*z,u[1]=w+p*z,u[2]=E+m*z,!0}}}class bP{constructor(n,o,u,h,p){this.TL=n,this.TR=o,this.BR=u,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(n,o,u){const h=[-1,1,1],p=[1,1,1],m=[1,-1,1],v=[-1,-1,1],w=a.$.transformMat4(h,h,n),E=a.$.transformMat4(p,p,n),C=a.$.transformMat4(m,m,n),P=a.$.transformMat4(v,v,n);return new bP(w,E,C,P,o/u)}}function X0(i,n,o){let u=1/0,h=-1/0;const p=[];for(const m of i){a.$.sub(p,m,n);const v=a.$.dot(p,o);u=Math.min(u,v),h=Math.max(h,v)}return[u,h]}function WL(i,n){let o=!0;for(let u=0;u<i.planes.length;u++){const h=i.planes[u];let p=0;for(let m=0;m<n.length;m++)p+=a.$.dot(h,n[m])+h[3]>=0;if(p===0)return 0;p!==n.length&&(o=!1)}return o?2:1}function HL(i,n){for(const o of i.projections){const u=X0(n,i.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function ZL(i,n){let o=0;const u=[0,0,0,0];for(let h=0;h<i.length;h++)u[0]=i[h][0],u[1]=i[h][1],u[2]=i[h][2],u[3]=1,a.aB.dot(u,n)>=0&&o++;return o}class wP{constructor(n,o){this.points=n||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=ci.fromPoints(this.points),this.projections=[],this.frustumEdges=[a.$.sub([],this.points[2],this.points[3]),a.$.sub([],this.points[0],this.points[3]),a.$.sub([],this.points[4],this.points[0]),a.$.sub([],this.points[5],this.points[1]),a.$.sub([],this.points[6],this.points[2]),a.$.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],p=[u[2],0,-u[0]];this.projections.push({axis:h,projection:X0(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:X0(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(n,o,u,h){const p=Math.pow(2,u),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const C=a.aB.transformMat4([],E,n),P=1/C[3]/o*p;return a.aB.mul(C,C,[P,P,h?1/C[3]:P,P])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const C=a.$.sub([],m[E[0]],m[E[1]]),P=a.$.sub([],m[E[2]],m[E[1]]),M=a.$.normalize([],a.$.cross([],C,P)),z=-a.$.dot(M,m[E[1]]);return M.concat(z)}),w=[];for(let E=0;E<m.length;E++)w.push([m[E][0],m[E][1],m[E][2]]);return new wP(w,v)}intersectsPrecise(n,o,u){for(let h=0;h<o.length;h++)if(!ZL(n,o[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!ZL(n,this.planes[h]))return 0;for(const h of u)for(const p of this.frustumEdges){const m=a.$.cross([],h,p),v=a.$.length(m);if(v===0)continue;a.$.scale(m,m,1/v);const w=X0(this.points,this.points[0],m),E=X0(n,this.points[0],m);if(w[0]>E[1]||E[0]>w[1])return 0}return 1}containsPoint(n){for(const o of this.planes){const u=o[3];if(a.$.dot([o[0],o[1],o[2]],n)+u<0)return!1}return!0}}class ci{static fromPoints(n){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of n)a.$.min(o,o,h),a.$.max(u,u,h);return new ci(o,u)}static fromTileIdAndHeight(n,o,u){const h=1<<n.canonical.z,p=n.canonical.x,m=n.canonical.y;return new ci([p/h,m/h,o],[(p+1)/h,(m+1)/h,u])}static applyTransform(n,o){const u=n.getCorners();for(let h=0;h<u.length;++h)a.$.transformMat4(u[h],u[h],o);return ci.fromPoints(u)}static applyTransformFast(n,o){const u=[o[12],o[13],o[14]],h=[...u];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const v=o[4*m+p],w=v*n.min[m],E=v*n.max[m];u[p]+=Math.min(w,E),h[p]+=Math.max(w,E)}return new ci(u,h)}static projectAabbCorners(n,o){const u=n.getCorners();for(let h=0;h<u.length;++h)a.$.transformMat4(u[h],u[h],o);return u}constructor(n,o){this.min=n,this.max=o,this.center=a.$.scale([],a.$.add([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],u=a.$.clone(this.min),h=a.$.clone(this.max);for(let p=0;p<o.length;p++)u[p]=o[p]?this.min[p]:this.center[p],h[p]=o[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new ci(u,h)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?WL(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?WL(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,o){return o||this.intersects(n)?HL(n,this.getCorners()):0}intersectsPreciseFlat(n,o){return o||this.intersectsFlat(n)?HL(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let o=0;o<3;++o)if(this.min[o]>n.max[o]||n.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n.min[o]),this.max[o]=Math.max(this.max[o],n.max[o])}encapsulatePoint(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n[o]),this.max[o]=Math.max(this.max[o],n[o])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}Ve(ci,"Aabb");const pK=Pr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ww}=pK,XL=Pr([{name:"a_pos_3",components:3,type:"Int16"}]);var K0=Pr([{name:"a_pos",type:"Int16",components:2}]);function Tw(i){return i*Uo/Xg}const mK=[new ci([Pl,Pl,Pl],[Rl,Rl,Rl]),new ci([Pl,Pl,Pl],[0,0,Rl]),new ci([0,Pl,Pl],[Rl,0,Rl]),new ci([Pl,0,Pl],[0,Rl,Rl]),new ci([0,0,Pl],[Rl,Rl,Rl])];function KL(i,n,o,u=!0){const h=a.$.scale([],i._camera.position,i.worldSize),p=[n,o,1,1];a.aB.transformMat4(p,p,i.pixelMatrixInverse),a.aB.scale(p,p,1/p[3]);const m=a.$.sub([],p,h),v=a.$.normalize([],m),w=i.globeMatrix,E=[w[12],w[13],w[14]],C=a.$.sub([],E,h),P=a.$.length(C),M=a.$.normalize([],C),z=i.worldSize/(2*Math.PI),j=a.$.dot(M,v),V=Math.asin(z/P);if(V<Math.acos(j)){if(!u)return null;const Ke=[],at=[];a.$.scale(Ke,v,P/j),a.$.normalize(at,a.$.sub(at,Ke,C)),a.$.normalize(v,a.$.add(v,C,a.$.scale(v,at,Math.tan(V)*P)))}const $=[];new xP(h,v).closestPointOnSphere(E,z,$);const ee=a.$.normalize([],R(w,0)),pe=a.$.normalize([],R(w,1)),fe=a.$.normalize([],R(w,2)),me=a.$.dot(ee,$),Ce=a.$.dot(pe,$),Ae=a.$.dot(fe,$),Le=eo(Math.asin(-Ce/z));let $e=eo(Math.atan2(me,Ae));$e=i.center.lng+function(Ke,at){const bt=(at-Ke+180)%360-180;return bt<-180?bt+360:bt}(i.center.lng,$e);const Ze=hu($e),nt=Wn(du(Le),0,1);return new yo(Ze,nt)}class gK{constructor(n,o,u){this.a=a.$.sub([],n,u),this.b=a.$.sub([],o,u),this.center=u;const h=a.$.normalize([],this.a),p=a.$.normalize([],this.b);this.angle=Math.acos(a.$.dot(h,p))}}function TP(i,n){if(i.angle===0)return null;let o;return o=i.a[n]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[n]/i.a[n]/Math.sin(i.angle)-1/Math.tan(i.angle)),o<0||o>1?null:function(u,h,p,m){const v=Math.sin(p);return u*(Math.sin((1-m)*p)/v)+h*(Math.sin(m*p)/v)}(i.a[n],i.b[n],i.angle,Wn(o,0,1))+i.center[n]}function fu(i){if(i.z<=1)return mK[i.z+2*i.y+i.x];const n=EP(Ew(i));return ci.fromPoints(n)}function vh(i,n,o){return a.$.scale(i,i,1-o),a.$.scaleAndAdd(i,i,n,o)}function QL(i,n){const o=xh(n.zoom);if(o===0)return fu(i);const u=Ew(i),h=EP(u),p=hu(u.getWest())*n.worldSize,m=hu(u.getEast())*n.worldSize,v=du(u.getNorth())*n.worldSize,w=du(u.getSouth())*n.worldSize,E=[p,v,0],C=[m,v,0],P=[p,w,0],M=[m,w,0],z=a.ae.invert([],n.globeMatrix);return a.$.transformMat4(E,E,z),a.$.transformMat4(C,C,z),a.$.transformMat4(P,P,z),a.$.transformMat4(M,M,z),h[0]=vh(h[0],P,o),h[1]=vh(h[1],M,o),h[2]=vh(h[2],C,o),h[3]=vh(h[3],E,o),ci.fromPoints(h)}function YL(i,n,o){for(const u of i)a.$.transformMat4(u,u,n),a.$.scale(u,u,o)}function JL(i,n,o,u){const h=n/i.worldSize,p=i.globeMatrix;if(o.z<=1){const Ze=fu(o).getCorners();return YL(Ze,p,h),ci.fromPoints(Ze)}const m=Ew(o,u),v=EP(m,Uo+Tw(i._tileCoverLift));YL(v,p,h);const w=Number.MAX_VALUE,E=[-w,-w,-w],C=[w,w,w];if(m.contains(i.center)){for(const Ke of v)a.$.min(C,C,Ke),a.$.max(E,E,Ke);E[2]=0;const Ze=i.point,nt=[Ze.x*h,Ze.y*h,0];return a.$.min(C,C,nt),a.$.max(E,E,nt),new ci(C,E)}if(i._tileCoverLift>0){for(const Ze of v)a.$.min(C,C,Ze),a.$.max(E,E,Ze);return new ci(C,E)}const P=[p[12]*h,p[13]*h,p[14]*h],M=m.getCenter(),z=Wn(i.center.lat,-Ui,Ui),j=Wn(M.lat,-Ui,Ui),V=hu(i.center.lng),$=du(z);let ee=V-hu(M.lng);const pe=$-du(j);ee>.5?ee-=1:ee<-.5&&(ee+=1);let fe=0;if(Math.abs(ee)>Math.abs(pe))fe=ee>=0?1:3;else{fe=pe>=0?0:2;const Ze=[p[4]*h,p[5]*h,p[6]*h],nt=-Math.sin(er(pe>=0?m.getSouth():m.getNorth()))*Uo;a.$.scaleAndAdd(P,P,Ze,nt)}const me=v[fe],Ce=v[(fe+1)%4],Ae=new gK(me,Ce,P),Le=[TP(Ae,0)||me[0],TP(Ae,1)||me[1],TP(Ae,2)||me[2]],$e=xh(i.zoom);if($e>0){const Ze=function({x:Ke,y:at,z:bt},lt,St,ot,gt){const Pt=1/(1<<bt);let ct=Ke*Pt,Nt=ct+Pt,Ct=at*Pt,Tt=Ct+Pt,_n=0;const un=(ct+Nt)/2-ot;return un>.5?_n=-1:un<-.5&&(_n=1),ct=((ct+_n)*lt-(ot*=lt))*St+ot,Nt=((Nt+_n)*lt-ot)*St+ot,Ct=(Ct*lt-(gt*=lt))*St+gt,Tt=(Tt*lt-gt)*St+gt,[[ct,Tt,0],[Nt,Tt,0],[Nt,Ct,0],[ct,Ct,0]]}(o,n,i._pixelsPerMercatorPixel,V,$);for(let Ke=0;Ke<v.length;Ke++)vh(v[Ke],Ze[Ke],$e);const nt=a.$.add([],Ze[fe],Ze[(fe+1)%4]);a.$.scale(nt,nt,.5),vh(Le,nt,$e)}for(const Ze of v)a.$.min(C,C,Ze),a.$.max(E,E,Ze);return C[2]=Math.min(me[2],Ce[2]),a.$.min(C,C,Le),a.$.max(E,E,Le),new ci(C,E)}function Ew({x:i,y:n,z:o},u=!1){const h=1/(1<<o),p=new wr(fa(i*h),n===(1<<o)-1&&u?-90:Hs((n+1)*h)),m=new wr(fa((i+1)*h),n===0&&u?90:Hs(n*h));return new Nd(p,m)}function EP(i,n=Uo){const o=er(i.getNorth()),u=er(i.getSouth()),h=Math.cos(o),p=Math.cos(u),m=Math.sin(o),v=Math.sin(u),w=i.getWest(),E=i.getEast();return[Zg(p,v,w,n),Zg(p,v,E,n),Zg(h,m,E,n),Zg(h,m,w,n)]}function Q0(i,n,o,u){const h=1<<o.z,p=(i/Dt+o.x)/h;return zp(Hs((n/Dt+o.y)/h),fa(p),u)}function Sw({min:i,max:n}){return rK/Math.max(n[0]-i[0],n[1]-i[1],n[2]-i[2])}const ez=new Float64Array(16);function Y0(i){const n=Sw(i),o=a.ae.fromScaling(ez,[n,n,n]);return a.ae.translate(o,o,a.$.negate([],i.min))}function SP(i){const n=a.ae.fromTranslation(ez,i.min),o=1/Sw(i);return a.ae.scale(n,n,[o,o,o])}function IP(i){const n=Dt/(2*Math.PI);return i/(2*Math.PI)/n}function tz(i,n){return Dt/(512*Math.pow(2,i))*Sw(fu(n))}function nz(i,n,o,u,h){const p=IP(o),m=[i,n,-o/(2*Math.PI)],v=a.ae.identity(new Float64Array(16));return a.ae.translate(v,v,m),a.ae.scale(v,v,[p,p,p]),a.ae.rotateX(v,v,er(-h)),a.ae.rotateY(v,v,er(-u)),v}function xh(i){return na(lP,RL,i)}function rz(i,n){const o=zp(n.lat,n.lng),u=function(p){const m=zp(p._center.lat,p._center.lng),v=a.$.fromValues(0,1,0);let w=a.$.cross([],v,m);const E=a.ae.fromRotation([],-p.angle,m);w=a.$.transformMat4(w,w,E),a.ae.fromRotation(E,-p._pitch,w);const C=a.$.normalize([],m);return a.$.scale(C,C,Tw(p.cameraToCenterDistance/p.pixelsPerMeter)),a.$.transformMat4(C,C,E),a.$.add([],m,C)}(i),h=a.$.subtract([],u,o);return a.$.angle(h,o)}function CP(i,n){return rz(i,n)>Math.PI/2*1.01}const iz=er(85),_K=Math.cos(iz),yK=Math.sin(iz),vK=a.ae.create(),sz=i=>{const n=[];return i.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function oz(i,n,o,u,h,p,m,v,w){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(w*=i.pixelToTileUnitsFactor);const E=i.tileID.canonical,C=o.projection.upVectorScale(E,o.center.lat,o.worldSize).metersToTile;for(const P of n)for(const M of P){const z=M.add(v),j=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(z.x,z.y,!0):0,V=o.projection.projectTilePoint(z.x,z.y,E);if(j>0){const fe=o.projection.upVector(E,z.x,z.y);V.x+=fe[0]*C*j,V.y+=fe[1]*C*j,V.z+=fe[2]*C*j}const $=p?z:xK(V.x,V.y,V.z,u),ee=p?i.tilespaceRays.map(fe=>wK(fe,j)):i.queryGeometry.screenGeometry,pe=a.aB.transformMat4([],[V.x,V.y,V.z,1],u);if(!m&&p?w*=pe[3]/o.cameraToCenterDistance:m&&!p&&(w*=o.cameraToCenterDistance/pe[3]),p){const fe=Hs((M.y/Dt+E.y)/(1<<E.z));w/=o.projection.pixelsPerMeter(fe,1)/Vo(1,fe)}if(uK(ee,$,w))return!0}return!1}function xK(i,n,o,u){const h=a.aB.transformMat4([],[i,n,o,1],u);return new Lt(h[0]/h[3],h[1]/h[3])}const az=a.$.fromValues(0,0,0),bK=a.$.fromValues(0,0,1);function wK(i,n){const o=a.$.create();return az[2]=n,i.intersectsPlane(az,bK,o),new Lt(o[0],o[1])}class lz extends mP{}function cz(i,{width:n,height:o},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*o*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*o*u);return i.width=n,i.height=o,i.data=h,i}function uz(i,n,o){const{width:u,height:h}=n;u===i.width&&h===i.height||(AP(i,n,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,u),height:Math.min(i.height,h)},o,null),i.width=u,i.height=h,i.data=n.data)}function AP(i,n,o,u,h,p,m,v){if(h.width===0||h.height===0)return n;if(h.width>i.width||h.height>i.height||o.x>i.width-h.width||o.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||u.x>n.width-h.width||u.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const w=i.data,E=n.data,C=p===4&&v;for(let P=0;P<h.height;P++){const M=((o.y+P)*i.width+o.x)*p,z=((u.y+P)*n.width+u.x)*p;if(C)for(let j=0;j<h.width;j++){const V=M+j*p+3,$=z+j*p;E[$+0]=255,E[$+1]=255,E[$+2]=255,E[$+3]=w[V]}else if(m)for(let j=0;j<h.width;j++){const V=M+j*p,$=z+j*p,ee=w[V+3],pe=new Er(w[V+0]/255*ee,w[V+1]/255*ee,w[V+2]/255*ee,ee).toRenderColor(m).toArray();E[$+0]=pe[0],E[$+1]=pe[1],E[$+2]=pe[2],E[$+3]=pe[3]}else for(let j=0;j<h.width*p;j++)E[z+j]=w[M+j]}return n}Ve(lz,"HeatmapBucket",{omit:["layers"]});class Bd{constructor(n,o){cz(this,n,1,o)}resize(n){uz(this,new Bd(n),1)}clone(){return new Bd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,h,p){AP(n,o,u,h,p,1,null)}}class Ja{constructor(n,o){cz(this,n,4,o)}resize(n){uz(this,new Ja(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ja({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,h,p,m,v){AP(n,o,u,h,p,4,m,v)}}class hz{constructor(n,o){this.width=n.width,this.height=n.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}let dz,fz,pz,mz;function J0(i){const n={},o=i.resolution||256,u=i.clips?i.clips.length:1,h=i.image||new Ja({width:o,height:u}),p=(m,v,w)=>{n[i.evaluationKey]=w;const E=i.expression.evaluate(n);E&&(h.data[m+v+0]=Math.floor(255*E.r/E.a),h.data[m+v+1]=Math.floor(255*E.g/E.a),h.data[m+v+2]=Math.floor(255*E.b/E.a),h.data[m+v+3]=Math.floor(255*E.a))};if(i.clips)for(let m=0,v=0;m<u;++m,v+=4*o)for(let w=0,E=0;w<o;w++,E+=4){const C=w/(o-1),{start:P,end:M}=i.clips[m];p(v,E,P*(1-C)+M*C)}else for(let m=0,v=0;m<o;m++,v+=4)p(0,v,m/(o-1));return h}Ve(Bd,"AlphaImage"),Ve(Ja,"RGBAImage");const TK=Pr([{name:"a_pos",components:2,type:"Int16"}],4),{members:EK}=TK;function ev(i,n,o=2){const u=n&&n.length,h=u?n[0]*o:i.length;let p=gz(i,0,h,o,!0);const m=[];if(!p||p.next===p.prev)return m;let v,w,E;if(u&&(p=function(C,P,M,z){const j=[];for(let V=0,$=P.length;V<$;V++){const ee=gz(C,P[V]*z,V<$-1?P[V+1]*z:C.length,z,!1);ee===ee.next&&(ee.steiner=!0),j.push(kK(ee))}j.sort(PK);for(let V=0;V<j.length;V++)M=RK(j[V],M);return M}(i,n,p,o)),i.length>80*o){v=1/0,w=1/0;let C=-1/0,P=-1/0;for(let M=o;M<h;M+=o){const z=i[M],j=i[M+1];z<v&&(v=z),j<w&&(w=j),z>C&&(C=z),j>P&&(P=j)}E=Math.max(C-v,P-w),E=E!==0?32767/E:0}return tv(p,m,o,v,w,E,0),m}function gz(i,n,o,u,h){let p;if(h===function(m,v,w,E){let C=0;for(let P=v,M=w-E;P<w;P+=E)C+=(m[M]-m[P])*(m[P+1]+m[M+1]),M=P;return C}(i,n,o,u)>0)for(let m=n;m<o;m+=u)p=vz(m/u|0,i[m],i[m+1],p);else for(let m=o-u;m>=n;m-=u)p=vz(m/u|0,i[m],i[m+1],p);return p&&Iw(p,p.next)&&(rv(p),p=p.next),p}function Bp(i,n){if(!i)return i;n||(n=i);let o,u=i;do if(o=!1,u.steiner||!Iw(u,u.next)&&_s(u.prev,u,u.next)!==0)u=u.next;else{if(rv(u),u=n=u.prev,u===u.next)break;o=!0}while(o||u!==n);return n}function tv(i,n,o,u,h,p,m){if(!i)return;!m&&p&&function(w,E,C,P){let M=w;do M.z===0&&(M.z=PP(M.x,M.y,E,C,P)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==w);M.prevZ.nextZ=null,M.prevZ=null,function(z){let j,V=1;do{let $,ee=z;z=null;let pe=null;for(j=0;ee;){j++;let fe=ee,me=0;for(let Ae=0;Ae<V&&(me++,fe=fe.nextZ,fe);Ae++);let Ce=V;for(;me>0||Ce>0&&fe;)me!==0&&(Ce===0||!fe||ee.z<=fe.z)?($=ee,ee=ee.nextZ,me--):($=fe,fe=fe.nextZ,Ce--),pe?pe.nextZ=$:z=$,$.prevZ=pe,pe=$;ee=fe}pe.nextZ=null,V*=2}while(j>1)}(M)}(i,u,h,p);let v=i;for(;i.prev!==i.next;){const w=i.prev,E=i.next;if(p?IK(i,u,h,p):SK(i))n.push(w.i,i.i,E.i),rv(i),i=E.next,v=E.next;else if((i=E)===v){m?m===1?tv(i=CK(Bp(i),n),n,o,u,h,p,2):m===2&&AK(i,n,o,u,h,p):tv(Bp(i),n,o,u,h,p,1);break}}}function SK(i){const n=i.prev,o=i,u=i.next;if(_s(n,o,u)>=0)return!1;const h=n.x,p=o.x,m=u.x,v=n.y,w=o.y,E=u.y,C=h<p?h<m?h:m:p<m?p:m,P=v<w?v<E?v:E:w<E?w:E,M=h>p?h>m?h:m:p>m?p:m,z=v>w?v>E?v:E:w>E?w:E;let j=u.next;for(;j!==n;){if(j.x>=C&&j.x<=M&&j.y>=P&&j.y<=z&&Jg(h,v,p,w,m,E,j.x,j.y)&&_s(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function IK(i,n,o,u){const h=i.prev,p=i,m=i.next;if(_s(h,p,m)>=0)return!1;const v=h.x,w=p.x,E=m.x,C=h.y,P=p.y,M=m.y,z=v<w?v<E?v:E:w<E?w:E,j=C<P?C<M?C:M:P<M?P:M,V=v>w?v>E?v:E:w>E?w:E,$=C>P?C>M?C:M:P>M?P:M,ee=PP(z,j,n,o,u),pe=PP(V,$,n,o,u);let fe=i.prevZ,me=i.nextZ;for(;fe&&fe.z>=ee&&me&&me.z<=pe;){if(fe.x>=z&&fe.x<=V&&fe.y>=j&&fe.y<=$&&fe!==h&&fe!==m&&Jg(v,C,w,P,E,M,fe.x,fe.y)&&_s(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,me.x>=z&&me.x<=V&&me.y>=j&&me.y<=$&&me!==h&&me!==m&&Jg(v,C,w,P,E,M,me.x,me.y)&&_s(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;fe&&fe.z>=ee;){if(fe.x>=z&&fe.x<=V&&fe.y>=j&&fe.y<=$&&fe!==h&&fe!==m&&Jg(v,C,w,P,E,M,fe.x,fe.y)&&_s(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;me&&me.z<=pe;){if(me.x>=z&&me.x<=V&&me.y>=j&&me.y<=$&&me!==h&&me!==m&&Jg(v,C,w,P,E,M,me.x,me.y)&&_s(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function CK(i,n){let o=i;do{const u=o.prev,h=o.next.next;!Iw(u,h)&&_z(u,o,o.next,h)&&nv(u,h)&&nv(h,u)&&(n.push(u.i,o.i,h.i),rv(o),rv(o.next),o=i=h),o=o.next}while(o!==i);return Bp(o)}function AK(i,n,o,u,h,p){let m=i;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&DK(m,v)){let w=yz(m,v);return m=Bp(m,m.next),w=Bp(w,w.next),tv(m,n,o,u,h,p,0),void tv(w,n,o,u,h,p,0)}v=v.next}m=m.next}while(m!==i)}function PK(i,n){return i.x-n.x}function RK(i,n){const o=function(h,p){let m=p;const v=h.x,w=h.y;let E,C=-1/0;do{if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){const V=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(V<=v&&V>C&&(C=V,E=m.x<m.next.x?m:m.next,V===v))return E}m=m.next}while(m!==p);if(!E)return null;const P=E,M=E.x,z=E.y;let j=1/0;m=E;do{if(v>=m.x&&m.x>=M&&v!==m.x&&Jg(w<z?v:C,w,M,z,w<z?C:v,w,m.x,m.y)){const V=Math.abs(w-m.y)/(v-m.x);nv(m,h)&&(V<j||V===j&&(m.x>E.x||m.x===E.x&&MK(E,m)))&&(E=m,j=V)}m=m.next}while(m!==P);return E}(i,n);if(!o)return n;const u=yz(o,i);return Bp(u,u.next),Bp(o,o.next)}function MK(i,n){return _s(i.prev,i,n.prev)<0&&_s(n.next,i,i.next)<0}function PP(i,n,o,u,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-o)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function kK(i){let n=i,o=i;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==i);return o}function Jg(i,n,o,u,h,p,m,v){return(h-m)*(n-v)>=(i-m)*(p-v)&&(i-m)*(u-v)>=(o-m)*(n-v)&&(o-m)*(p-v)>=(h-m)*(u-v)}function DK(i,n){return i.next.i!==n.i&&i.prev.i!==n.i&&!function(o,u){let h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==u.i&&h.next.i!==u.i&&_z(h,h.next,o,u))return!0;h=h.next}while(h!==o);return!1}(i,n)&&(nv(i,n)&&nv(n,i)&&function(o,u){let h=o,p=!1;const m=(o.x+u.x)/2,v=(o.y+u.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&m<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==o);return p}(i,n)&&(_s(i.prev,i,n.prev)||_s(i,n.prev,n))||Iw(i,n)&&_s(i.prev,i,i.next)>0&&_s(n.prev,n,n.next)>0)}function _s(i,n,o){return(n.y-i.y)*(o.x-n.x)-(n.x-i.x)*(o.y-n.y)}function Iw(i,n){return i.x===n.x&&i.y===n.y}function _z(i,n,o,u){const h=Aw(_s(i,n,o)),p=Aw(_s(i,n,u)),m=Aw(_s(o,u,i)),v=Aw(_s(o,u,n));return h!==p&&m!==v||!(h!==0||!Cw(i,o,n))||!(p!==0||!Cw(i,u,n))||!(m!==0||!Cw(o,i,u))||!(v!==0||!Cw(o,n,u))}function Cw(i,n,o){return n.x<=Math.max(i.x,o.x)&&n.x>=Math.min(i.x,o.x)&&n.y<=Math.max(i.y,o.y)&&n.y>=Math.min(i.y,o.y)}function Aw(i){return i>0?1:i<0?-1:0}function nv(i,n){return _s(i.prev,i,i.next)<0?_s(i,n,i.next)>=0&&_s(i,i.prev,n)>=0:_s(i,n,i.prev)<0||_s(i,i.next,n)<0}function yz(i,n){const o=RP(i.i,i.x,i.y),u=RP(n.i,n.x,n.y),h=i.next,p=n.prev;return i.next=n,n.prev=i,o.next=h,h.prev=o,u.next=o,o.prev=u,p.next=u,u.prev=p,u}function vz(i,n,o,u){const h=RP(i,n,o);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function rv(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function RP(i,n,o){return{i,x:n,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Pw(i,n){const o=i.length;if(o<=1)return[i];const u=[];let h,p;for(let m=0;m<o;m++){const v=fg(i[m]);v!==0&&(i[m].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(h&&u.push(h),h=[i[m]]):h.push(i[m]))}if(h&&u.push(h),n>1)for(let m=0;m<u.length;m++)u[m].length<=n||(Sr(u[m],n,1,u[m].length-1,OK),u[m]=u[m].slice(0,n));return u}function OK(i,n){return n.area-i.area}function MP(i,n,o){const u=o.patternDependencies;let h=!1;for(const p of n){const m=p.paint.get(`${i}-pattern`);m.isConstant()||(h=!0);const v=m.constantOr(null);v&&(h=!0,u[v]=!0)}return h}function kP(i,n,o,u,h){const p=h.patternDependencies;for(const m of n){const v=m.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:u},o,{},h.availableImages);w=w&&w.name?w.name:w,p[w]=!0,o.patterns[m.id]=w}}return o}class Rw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vc,this.indexArray=new Fs,this.indexArray2=new Od,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new gi,this.segments2=new gi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection}updateFootprints(n,o){}populate(n,o,u,h){this.hasPattern=MP("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:C}of n){const P=this.layers[0]._featureFilter.needGeometry,M=yh(v,P);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),M,u))continue;const z=p?p.evaluate(M,{},u,o.availableImages):void 0,j={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:E,geometry:P?M.geometry:bc(v,u,h),patterns:{},sortKey:z};m.push(j)}p&&m.sort((v,w)=>v.sortKey-w.sortKey);for(const v of m){const{geometry:w,index:E,sourceLayerIndex:C}=v;if(this.hasPattern){const P=kP("fill",this.layers,v,this.zoom,o);this.patternFeatures.push(P)}else this.addFeature(v,w,E,u,{},o.availableImages,o.brightness);o.featureIndex.insert(n[E].feature,w,E,C,this.index)}}update(n,o,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,u,h,p)}addFeatures(n,o,u,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,u,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,EK),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,u,h,p,m=[],v){for(const w of Pw(o,500)){let E=0;for(const V of w)E+=V.length;const C=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),P=C.vertexLength,M=[],z=[];for(const V of w){if(V.length===0)continue;V!==w[0]&&z.push(M.length/2);const $=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),ee=$.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(ee+V.length-1,ee),M.push(V[0].x),M.push(V[0].y);for(let pe=1;pe<V.length;pe++)this.layoutVertexArray.emplaceBack(V[pe].x,V[pe].y),this.indexArray2.emplaceBack(ee+pe-1,ee+pe),M.push(V[pe].x),M.push(V[pe].y);$.vertexLength+=V.length,$.primitiveLength+=V.length}const j=ev(M,z);for(let V=0;V<j.length;V+=3)this.indexArray.emplaceBack(P+j[V],P+j[V+1],P+j[V+2]);C.vertexLength+=E,C.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,v)}}let xz,bz,wz,Tz;Ve(Rw,"FillBucket",{omit:["layers","patternFeatures"]});class DP{constructor(n,o,u,h){if(this.triangleCount=o.length/3,this.min=new Lt(0,0),this.max=new Lt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[p,m]=[n[0].clone(),n[0].clone()];for(let P=1;P<n.length;++P){const M=n[P];p.x=Math.min(p.x,M.x),p.y=Math.min(p.y,M.y),m.x=Math.max(m.x,M.x),m.y=Math.max(m.y,M.y)}if(h){const P=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/h);u=Math.max(u,P)}if(u===0)return;this.min=p,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const w=Math.max(v.x,v.y)/u;this.cellsX=Math.max(1,Math.ceil(v.x/w)),this.cellsY=Math.max(1,Math.ceil(v.y/w)),this.xScale=1/w,this.yScale=1/w;const E=[];for(let P=0;P<this.triangleCount;P++){const M=n[o[3*P+0]].sub(this.min),z=n[o[3*P+1]].sub(this.min),j=n[o[3*P+2]].sub(this.min),V=pu(Math.floor(Math.min(M.x,z.x,j.x)),this.xScale,this.cellsX),$=pu(Math.floor(Math.max(M.x,z.x,j.x)),this.xScale,this.cellsX),ee=pu(Math.floor(Math.min(M.y,z.y,j.y)),this.yScale,this.cellsY),pe=pu(Math.floor(Math.max(M.y,z.y,j.y)),this.yScale,this.cellsY),fe=new Lt(0,0),me=new Lt(0,0),Ce=new Lt(0,0),Ae=new Lt(0,0);for(let Le=ee;Le<=pe;++Le){fe.y=me.y=Le*w,Ce.y=Ae.y=(Le+1)*w;for(let $e=V;$e<=$;++$e)fe.x=Ce.x=$e*w,me.x=Ae.x=($e+1)*w,(vP(M,z,j,fe,me,Ae)||vP(M,z,j,fe,Ae,Ce))&&E.push({cellIdx:Le*this.cellsX+$e,triIdx:P})}}if(E.length===0)return;E.sort((P,M)=>P.cellIdx-M.cellIdx||P.triIdx-M.triIdx);let C=0;for(;C<E.length;){const P=E[C].cellIdx,M={start:this.payload.length,len:0};for(;C<E.length&&E[C].cellIdx===P;)++M.len,this.payload.push(E[C++].triIdx);this.cells[P]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,o){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const u=pu(n.x-this.min.x,this.xScale,this.cellsX),h=pu(n.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+u];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const v=this.payload[p.start+m],w=Math.floor(v/8),E=1<<v%8;if(!(this.lookup[w]&E)&&(this.lookup[w]|=E,o.push(v),o.length===this.triangleCount))return}}}query(n,o,u){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>o.x||n.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const h=pu(n.x-this.min.x,this.xScale,this.cellsX),p=pu(o.x-this.min.x,this.xScale,this.cellsX),m=pu(n.y-this.min.y,this.yScale,this.cellsY),v=pu(o.y-this.min.y,this.yScale,this.cellsY);for(let w=m;w<=v;w++)for(let E=h;E<=p;E++){const C=this.cells[w*this.cellsX+E];if(C)for(let P=0;P<C.len;P++){const M=this.payload[C.start+P],z=Math.floor(M/8),j=1<<M%8;if(!(this.lookup[z]&j)&&(this.lookup[z]|=j,u.push(M),u.length===this.triangleCount))return}}}}function pu(i,n,o){return Math.max(0,Math.min(o-1,Math.floor(i*n)))}Ve(DP,"TriangleGridIndex");class Ez{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(n,o){for(const u of this.footprints)o.push({footprint:u,id:n})}populate(n,o,u,h){const p=[];for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of n){const C=this.layers[0]._featureFilter.needGeometry,P=yh(m,C);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),P,u))continue;const M={id:v,properties:m.properties,type:m.type,sourceLayerIndex:E,index:w,geometry:C?P.geometry:bc(m,u,h),patterns:{}};p.push(M)}for(const m of p){const{geometry:v,index:w,sourceLayerIndex:E}=m;this.addFeature(m,v,w,u,{},o.availableImages,o.brightness),o.featureIndex.insert(n[w].feature,v,w,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,o,u,h,p){}destroy(){}addFeature(n,o,u,h,p,m=[],v){for(const w of Pw(o,2)){const E=[],C=[],P=[],M=new Lt(1/0,1/0),z=new Lt(-1/0,-1/0);for(const $ of w)if($.length!==0){$!==w[0]&&P.push(C.length/2);for(let ee=0;ee<$.length;ee++)C.push($[ee].x),C.push($[ee].y),E.push($[ee]),M.x=Math.min(M.x,$[ee].x),M.y=Math.min(M.y,$[ee].y),z.x=Math.max(z.x,$[ee].x),z.y=Math.max(z.y,$[ee].y)}const j=ev(C,P),V=new DP(E,j,8,256);this.footprints.push({vertices:E,indices:j,grid:V,min:M,max:z})}}}Ve(Ez,"ClipBucket",{omit:["layers"]});const LK=Pr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),zK=Pr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),NK=Pr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),FK=Pr([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),BK=Pr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),jK=Pr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:UK}=LK;var Mw={},VK=Yc,Sz=e_;function e_(i,n,o,u,h){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=u,this._values=h,i.readFields($K,this,n)}function $K(i,n,o){i==1?n.id=o.readVarint():i==2?function(u,h){for(var p=u.readVarint()+u.pos;u.pos<p;){var m=h._keys[u.readVarint()],v=h._values[u.readVarint()];h.properties[m]=v}}(o,n):i==3?n.type=o.readVarint():i==4&&(n._geometry=o.pos)}function qK(i){for(var n,o,u=0,h=0,p=i.length,m=p-1;h<p;m=h++)u+=((o=i[m]).x-(n=i[h]).x)*(n.y+o.y);return u}e_.types=["Unknown","Point","LineString","Polygon"],e_.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var n,o=i.readVarint()+i.pos,u=1,h=0,p=0,m=0,v=[];i.pos<o;){if(h<=0){var w=i.readVarint();u=7&w,h=w>>3}if(h--,u===1||u===2)p+=i.readSVarint(),m+=i.readSVarint(),u===1&&(n&&v.push(n),n=[]),n.push(new VK(p,m));else{if(u!==7)throw new Error("unknown command "+u);n&&n.push(n[0].clone())}}return n&&v.push(n),v},e_.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var n=i.readVarint()+i.pos,o=1,u=0,h=0,p=0,m=1/0,v=-1/0,w=1/0,E=-1/0;i.pos<n;){if(u<=0){var C=i.readVarint();o=7&C,u=C>>3}if(u--,o===1||o===2)(h+=i.readSVarint())<m&&(m=h),h>v&&(v=h),(p+=i.readSVarint())<w&&(w=p),p>E&&(E=p);else if(o!==7)throw new Error("unknown command "+o)}return[m,w,v,E]},e_.prototype.toGeoJSON=function(i,n,o){var u,h,p=this.extent*Math.pow(2,o),m=this.extent*i,v=this.extent*n,w=this.loadGeometry(),E=e_.types[this.type];function C(z){for(var j=0;j<z.length;j++){var V=z[j];z[j]=[360*(V.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<w.length;u++)P[u]=w[u][0];C(w=P);break;case 2:for(u=0;u<w.length;u++)C(w[u]);break;case 3:for(w=function(z){var j=z.length;if(j<=1)return[z];for(var V,$,ee=[],pe=0;pe<j;pe++){var fe=qK(z[pe]);fe!==0&&($===void 0&&($=fe<0),$===fe<0?(V&&ee.push(V),V=[z[pe]]):V.push(z[pe]))}return V&&ee.push(V),ee}(w),u=0;u<w.length;u++)for(h=0;h<w[u].length;h++)C(w[u][h])}w.length===1?w=w[0]:E="Multi"+E;var M={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(M.id=this.id),M};var GK=Sz,Iz=Cz;function Cz(i,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(WK,this,n),this.length=this._features.length}function WK(i,n,o){i===15?n.version=o.readVarint():i===1?n.name=o.readString():i===5?n.extent=o.readVarint():i===2?n._features.push(o.pos):i===3?n._keys.push(o.readString()):i===4&&n._values.push(function(u){for(var h=null,p=u.readVarint()+u.pos;u.pos<p;){var m=u.readVarint()>>3;h=m===1?u.readString():m===2?u.readFloat():m===3?u.readDouble():m===4?u.readVarint64():m===5?u.readVarint():m===6?u.readSVarint():m===7?u.readBoolean():null}return h}(o))}Cz.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var n=this._pbf.readVarint()+this._pbf.pos;return new GK(this._pbf,n,this.extent,this._keys,this._values)};var HK=Iz;function ZK(i,n,o){if(i===3){var u=new HK(o,o.readVarint()+o.pos);u.length&&(n[u.name]=u)}}var OP=Mw.VectorTile=function(i,n){this.layers=i.readFields(ZK,{},n)},kw=Mw.VectorTileFeature=Sz;Mw.VectorTileLayer=Iz;class jp extends Lt{constructor(n,o,u){super(n,o),this.z=u}}class Az extends jp{constructor(n,o,u,h){super(n,o,u),this.w=h}}function Dw(i,n,o,u){const h=[],p=u===0?(m,v,w,E,C,P)=>{m.push(new Lt(P,w+(P-v)/(E-v)*(C-w)))}:(m,v,w,E,C,P)=>{m.push(new Lt(v+(P-w)/(C-w)*(E-v),P))};for(const m of i){const v=[];for(const w of m){if(w.length<=2)continue;const E=[];for(let M=0;M<w.length-1;M++){const z=w[M].x,j=w[M].y,V=w[M+1].x,$=w[M+1].y,ee=u===0?z:j,pe=u===0?V:$;ee<n?pe>n&&p(E,z,j,V,$,n):ee>o?pe<o&&p(E,z,j,V,$,o):E.push(w[M]),pe<n&&ee>=n&&p(E,z,j,V,$,n),pe>o&&ee<=o&&p(E,z,j,V,$,o)}let C=w[w.length-1];const P=u===0?C.x:C.y;P>=n&&P<=o&&E.push(C),E.length&&(C=E[E.length-1],E[0].x===C.x&&E[0].y===C.y||E.push(E[0]),v.push(E))}v.length&&h.push(v)}return h}function Pz(i,n,o,u){const h=o==="x"?"y":"x",p=(u-i[o])/(n[o]-i[o]);i[h]=i[h]+(n[h]-i[h])*p,i[o]=u,i.hasOwnProperty("z")&&(i.z=xn(i.z,n.z,p)),i.hasOwnProperty("w")&&(i.w=xn(i.w,n.w,p))}function Rz(i,n,o,u){const h=o,p=u;for(const m of["x","y"]){let v=i,w=n;v[m]>=w[m]&&(v=n,w=i),v[m]<h&&w[m]>h&&Pz(v,w,m,h),v[m]<p&&w[m]>p&&Pz(w,v,m,p)}}const Ow=Number.MAX_SAFE_INTEGER;function Mz(i,n,o,u){return i.order<n||i.order===Ow||!(i.clipMask&o)||function(h,p){return p.length!==0&&p.find(m=>m===h)===void 0}(u,i.clipScope)}function Lw(i,n){return i.x-n.x||i.y-n.y}function kz(i,n){return Lw(i.min,n.min)===0&&Lw(i.max,n.max)===0}function LP(i,n){return!(i.min.x>n.max.x||i.max.x<n.min.x||i.min.y>n.max.y||i.max.y<n.min.y)}function zP(i,n){if(i.length!==n.length)return!1;for(let o=0;o<i.length;o++)if(i[o].sourceId!==n[o].sourceId||!kz(i[o],n[o])||i[o].order!==n[o].order||i[o].clipMask!==n[o].clipMask||!ic(i[o].clipScope,n[o].clipScope))return!1;return!0}function Dz(i,n,o){const u=1/Dt,h=1/(1<<o.canonical.z),p=(n.x*u+o.canonical.x)*h+o.wrap,m=(n.y*u+o.canonical.y)*h;return{min:new Lt((i.x*u+o.canonical.x)*h+o.wrap,(i.y*u+o.canonical.y)*h),max:new Lt(p,m)}}function XK(i,n,o){const u=1<<o.canonical.z,h=((n.x-o.wrap)*u-o.canonical.x)*Dt,p=(n.y*u-o.canonical.y)*Dt;return{min:new Lt(((i.x-o.wrap)*u-o.canonical.x)*Dt,(i.y*u-o.canonical.y)*Dt),max:new Lt(h,p)}}function Oz(i,n,o,u,h,p,m){const v=i.indices,w=i.vertices,E=[];for(let C=u;C<u+h;C+=3){const P=n[o[C+0]+p],M=n[o[C+1]+p],z=n[o[C+2]+p],j=Math.min(P.x,M.x,z.x),V=Math.max(P.x,M.x,z.x),$=Math.min(P.y,M.y,z.y),ee=Math.max(P.y,M.y,z.y);E.length=0,i.grid.query(new Lt(j,$),new Lt(V,ee),E);for(let pe=0;pe<E.length;pe++){const fe=E[pe];if(vP(w[v[3*fe+0]],w[v[3*fe+1]],w[v[3*fe+2]],P,M,z,m))return!0}}return!1}function Lz(i,n,o,u){if(!i||!o)return!1;let h=i.vertices;if(!n.canonical.equals(u.canonical)||n.wrap!==u.wrap){if(o.vertices.length<i.vertices.length)return Lz(o,u,i,n);const p=n.canonical,m=u.canonical,v=Math.pow(2,m.z-p.z);h=i.vertices.map(w=>new Lt((w.x+p.x*Dt)*v-m.x*Dt,(w.y+p.y*Dt)*v-m.y*Dt))}return Oz(o,h,i.indices,0,i.indices.length,0,0)}function zz(i,n,o,u){const h=Math.pow(2,u.z-o.z);return new Lt((i+o.x*Dt)*h-u.x*Dt,(n+o.y*Dt)*h-u.y*Dt)}function Nz(i,n){const o=[];n.footprint.grid.queryPoint(i,o);const u=n.footprint.indices,h=n.footprint.vertices;for(let p=0;p<o.length;p++){const m=o[p];if(Fd([h[u[3*m+0]],h[u[3*m+1]],h[u[3*m+2]]],i))return!0}return!1}class Fz{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const u=this.toIdx(n,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function Bz(i,n,o,u){let h=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(u[m])<1e-15){if(o[m]<i[m]||o[m]>n[m])return null}else{const v=1/u[m];let w=(i[m]-o[m])*v,E=(n[m]-o[m])*v;if(w>E){const C=w;w=E,E=C}if(w>h&&(h=w),E<p&&(p=E),h>p)return null}return h}function jz(i,n,o,u,h,p,m,v,w,E,C){const P=u-i,M=h-n,z=p-o,j=m-i,V=v-n,$=w-o,ee=C[1]*$-C[2]*V,pe=C[2]*j-C[0]*$,fe=C[0]*V-C[1]*j,me=P*ee+M*pe+z*fe;if(Math.abs(me)<1e-15)return null;const Ce=1/me,Ae=E[0]-i,Le=E[1]-n,$e=E[2]-o,Ze=(Ae*ee+Le*pe+$e*fe)*Ce;if(Ze<0||Ze>1)return null;const nt=Le*z-$e*M,Ke=$e*P-Ae*z,at=Ae*M-Le*P,bt=(C[0]*nt+C[1]*Ke+C[2]*at)*Ce;return bt<0||Ze+bt>1?null:(j*nt+V*Ke+$*at)*Ce}function Uz(i,n,o){return(i-n)/(o-n)}function Vz(i,n,o,u,h,p,m,v,w){const E=1<<o,C=p-u,P=m-h,M=(i+1)/E*C+u,z=(n+0)/E*P+h,j=(n+1)/E*P+h;v[0]=(i+0)/E*C+u,v[1]=z,w[0]=M,w[1]=j}class $z{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(p){const m=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,m));const E=1/w,C=(z,j,V,$,ee)=>{const pe=$?1:0,fe=(z+1)*V-pe,me=j*V,Ce=(j+1)*V-pe;ee[0]=z*V,ee[1]=me,ee[2]=fe,ee[3]=Ce};let P=new Fz(w);const M=[];for(let z=0;z<w*w;z++){C(z%w,Math.floor(z/w),E,!1,M);const j=jd(M[0],M[1],p),V=jd(M[2],M[1],p),$=jd(M[2],M[3],p),ee=jd(M[0],M[3],p);P.minimums.push(Math.min(j,V,$,ee)),P.maximums.push(Math.max(j,V,$,ee)),P.leaves.push(1)}for(v.push(P),w/=2;w>=1;w/=2){const z=v[v.length-1];P=new Fz(w);for(let j=0;j<w*w;j++){C(j%w,Math.floor(j/w),2,!0,M);const V=z.getElevation(M[0],M[1]),$=z.getElevation(M[2],M[1]),ee=z.getElevation(M[2],M[3]),pe=z.getElevation(M[0],M[3]),fe=z.isLeaf(M[0],M[1]),me=z.isLeaf(M[2],M[1]),Ce=z.isLeaf(M[2],M[3]),Ae=z.isLeaf(M[0],M[3]),Le=Math.min(V.min,$.min,ee.min,pe.min),$e=Math.max(V.max,$.max,ee.max,pe.max),Ze=fe&&me&&Ce&&Ae;P.maximums.push($e),P.minimums.push(Le),P.leaves.push($e-Le<=5&&Ze?1:0)}v.push(P)}return v}(this.dem),u=o.length-1,h=o[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(n,o,u,h,p,m,v=1){return Bz([n,o,-100],[u,h,this.maximums[0]*v],p,m)}raycast(n,o,u,h,p,m,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(n,o,u,h,p,m,v);if(w==null)return null;const E=[],C=[],P=[],M=[],z=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:j,t:V,nodex:$,nodey:ee,depth:pe}=z.pop();if(this.leaves[j]){Vz($,ee,pe,n,o,u,h,P,M);const me=1<<pe,Ce=($+0)/me,Ae=($+1)/me,Le=(ee+0)/me,$e=(ee+1)/me,Ze=jd(Ce,Le,this.dem)*v,nt=jd(Ae,Le,this.dem)*v,Ke=jd(Ae,$e,this.dem)*v,at=jd(Ce,$e,this.dem)*v,bt=jz(P[0],P[1],Ze,M[0],P[1],nt,M[0],M[1],Ke,p,m),lt=jz(M[0],M[1],Ke,P[0],M[1],at,P[0],P[1],Ze,p,m),St=Math.min(bt!==null?bt:Number.MAX_VALUE,lt!==null?lt:Number.MAX_VALUE);if(St!==Number.MAX_VALUE)return St;{const ot=a.$.scaleAndAdd([],p,m,V);if(qz(Ze,nt,at,Ke,Uz(ot[0],P[0],M[0]),Uz(ot[1],P[1],M[1]))>=ot[2])return V}continue}let fe=0;for(let me=0;me<this._siblingOffset.length;me++){Vz(($<<1)+this._siblingOffset[me][0],(ee<<1)+this._siblingOffset[me][1],pe+1,n,o,u,h,P,M),P[2]=-100,M[2]=this.maximums[this.childOffsets[j]+me]*v;const Ce=Bz(P,M,p,m);if(Ce!=null){const Ae=Ce;E[me]=Ae;let Le=!1;for(let $e=0;$e<fe&&!Le;$e++)Ae>=E[C[$e]]&&(C.splice($e,0,me),Le=!0);Le||(C[fe]=me),fe++}}for(let me=0;me<fe;me++){const Ce=C[me];z.push({idx:this.childOffsets[j]+Ce,t:E[Ce],nodex:($<<1)+this._siblingOffset[Ce][0],nodey:(ee<<1)+this._siblingOffset[Ce][1],depth:pe+1})}}return null}_addNode(n,o,u){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,u,h,p){if(n[h].isLeaf(o,u)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=h-1,v=n[m];let w=0,E=0;for(let C=0;C<this._siblingOffset.length;C++){const P=2*o+this._siblingOffset[C][0],M=2*u+this._siblingOffset[C][1],z=v.getElevation(P,M),j=v.isLeaf(P,M),V=this._addNode(z.min,z.max,j);j&&(w|=1<<C),E||(E=V)}for(let C=0;C<this._siblingOffset.length;C++)w&1<<C||this._construct(n,2*o+this._siblingOffset[C][0],2*u+this._siblingOffset[C][1],m,E+C)}}function qz(i,n,o,u,h,p){return xn(xn(i,o,p),xn(n,u,p),h)}function jd(i,n,o){const u=o.dim,h=Wn(i*u-.5,0,u-1),p=Wn(n*u-.5,0,u-1),m=Math.floor(h),v=Math.floor(p),w=Math.min(m+1,u-1),E=Math.min(v+1,u-1);return qz(o.get(m,v),o.get(w,v),o.get(m,E),o.get(w,E),h-m,p-v)}const KK={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function QK(i,n,o){return(256*i*256+256*n+o)/10-1e4}function YK(i,n,o){return 256*i+n+o/256-32768}class zw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,u,h=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return bi(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const p=this.dim=o.height-2,m=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let w=0;w<p;w++)m[this._idx(-1,w)]=m[this._idx(0,w)],m[this._idx(p,w)]=m[this._idx(p-1,w)],m[this._idx(w,-1)]=m[this._idx(w,0)],m[this._idx(w,p)]=m[this._idx(w,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const v=u==="terrarium"?YK:QK;for(let w=0;w<m.length;++w){const E=4*w;this.floatView[w]=v(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=en.now()}_buildQuadTree(){this._tree=new $z(this)}get(n,o,u=!1){u&&(n=Wn(n,-1,this.dim),o=Wn(o,-1,this.dim));const h=this._idx(n,o);return this.floatView[h]}set(n,o,u){const h=this._idx(n,o),p=this.floatView[h];return this.floatView[h]=u,u-p}static getUnpackVector(n){return KK[n]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const u=[0,0,0,0],h=zw.getUnpackVector(o);let p=Math.floor((n+h[3])/h[2]);return u[2]=p%256,p=Math.floor(p/256),u[1]=p%256,p=Math.floor(p/256),u[0]=p,u}getPixels(){return new hz({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,p=o*this.dim+this.dim,m=u*this.dim,v=u*this.dim+this.dim;switch(o){case-1:h=p-1;break;case 1:p=h+1}switch(u){case-1:m=v-1;break;case 1:v=m+1}const w=-o*this.dim,E=-u*this.dim;for(let C=m;C<v;C++)for(let P=h;P<p;P++){const M=4*this._idx(P,C),z=4*this._idx(P+w,C+E);this.pixels[M+0]=n.pixels[z+0],this.pixels[M+1]=n.pixels[z+1],this.pixels[M+2]=n.pixels[z+2],this.pixels[M+3]=n.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ve(zw,"DEMData"),Ve($z,"DemMinMaxQuadTree",{omit:["dem"]});class t_{constructor(n,o,u){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(n,o,u){const h=u||n.findDEMTileFor(o);if(!h||!h.dem)return;const p=h.dem,m=h.tileID,v=1<<o.canonical.z-m.canonical.z;return new t_(h,p.dim/Dt/v,[(o.canonical.x/v-m.canonical.x)*p.dim,(o.canonical.y/v-m.canonical.y)*p.dim])}tileCoordToPixel(n,o){const u=o*this._scale+this._offset[1],h=Math.floor(n*this._scale+this._offset[0]),p=Math.floor(u);return new Lt(h,p)}getElevationAt(n,o,u,h){const p=n*this._scale+this._offset[0],m=o*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(m),E=this._dem;return h=!!h,u?xn(xn(E.get(v,w,h),E.get(v,w+1,h),m-w),xn(E.get(v+1,w,h),E.get(v+1,w+1,h),m-w),p-v):E.get(v,w,h)}getElevationAtPixel(n,o,u){return this._dem.get(n,o,!!u)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Vo(1,n)*this._dem.stride}}const Gz={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},JK=kw.types,eQ=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],tQ=["fill-extrusion-flood-light-ground-radius"],nQ=Math.pow(2,13),rQ=Math.pow(2,15)-1,Wz=new Lt(0,1),Ud=2147483648;function iv(i,n,o,u,h,p,m,v){i.emplaceBack((n<<1)+m,(o<<1)+p,(Math.floor(u*nQ)<<1)+h,Math.round(v))}function sv(i,n,o,u){i.emplaceBack(n.x*Dt,n.y*Dt,o?0:1,u?1:0)}function Nw(i,n,o,u,h,p){i.emplaceBack(n.x,n.y,(o.x<<1)+u,(o.y<<1)+h,p)}function ov(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class Hz{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Zz{constructor(){this.centroidXY=new Lt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Lt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Lt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Lt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Xz{constructor(){this.acc=new Lt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,o){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=o.x,n.min.y=n.max.y=o.y)}appendEdge(n,o,u){this.accCount++,this.acc._add(o);let h=!!this.borders;o.x<n.min.x?(n.min.x=o.x,h=!0):o.x>n.max.x&&(n.max.x=o.x,h=!0),o.y<n.min.y?(n.min.y=o.y,h=!0):o.y>n.max.y&&(n.max.y=o.y,h=!0),((o.x===0||o.x===Dt)&&o.x===u.x)!=((o.y===0||o.y===Dt)&&o.y===u.y)&&this.processBorderOverlap(o,u),h&&this.checkBorderIntersection(o,u)}checkBorderIntersection(n,o){o.x<0!=n.x<0&&this.addBorderIntersection(0,xn(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>Dt!=n.x>Dt&&this.addBorderIntersection(1,xn(o.y,n.y,(Dt-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,xn(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>Dt!=n.y>Dt&&this.addBorderIntersection(3,xn(o.x,n.x,(Dt-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[n];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const u=n.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,n.y)}else{const u=n.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,n.x)}}centroid(){return this.accCount===0?new Lt(0,0):new Lt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,o)=>n+ +(o[0]!==Number.MAX_VALUE),0):0}}function Kz(i,n){const o=i.add(n)._unit(),u=Wn(i.x*o.x+i.y*o.y,-1,1);var h,p,m;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*rQ*((p=i).x*(m=n).y-p.y*m.x<0?-1:1)}const iQ=[i=>i.x<0,i=>i.x>Dt,i=>i.y<0,i=>i.y>Dt];function sQ(i,n,o,u){const h=[4];if(u===0)return h;o._mult(u);const p=i.sub(o),m=n.sub(o),v=[i,n,p,m];for(let w=0;w<4;w++)for(const E of v)if(iQ[w](E)){h.push(w);break}return h}class Qz{constructor(n){this.vertexArray=new UA,this.indexArray=new Fs,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut},o=>tQ.includes(o)),this._segments=new gi,this.hiddenByLandmarkVertexArray=new tP,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new gi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,o,u,h=!1){const p=n.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let w;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const E=n[0],C=n[1];w=Kz(E.sub(n[p-1])._perp()._unit(),C.sub(E)._perp()._unit())}for(let E=0;E<p;E++){const C=E===p-1?0:E+1,P=n[E],M=n[C],z=n[C===p-1?0:C+1],j=M.sub(P)._perp()._unit(),V=Kz(j,z.sub(M)._perp()._unit()),$=w,ee=V;if(NP(P,M,o)||h&&eN(P,o)&&eN(M,o)){w=V;continue}const pe=v.vertexLength;Nw(this.vertexArray,P,M,1,1,$),Nw(this.vertexArray,P,M,1,0,$),Nw(this.vertexArray,P,M,0,1,ee),Nw(this.vertexArray,P,M,0,0,ee),v.vertexLength+=4;const fe=sQ(P,M,j,u);for(const me of fe)this._segmentToGroundQuads[m].push({id:pe,region:me}),this._segmentToRegionTriCounts[m][me]+=2,v.primitiveLength+=2;w=V}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),o=n.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((h,p)=>h.region-p.region);for(let u=0;u<o;u++){const h=this._segmentToGroundQuads[u],p=n[u],m=this._segmentToRegionTriCounts[u];m.reduce((w,E)=>w+E,0);let v=0;for(let w=0;w<=4;w++){const E=m[w];if(E!==0){let C=this.regionSegments[w];C||(C=this.regionSegments[w]=new gi);const P={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:E};C.get().push(P)}v+=E}for(let w=0;w<h.length;w++){const E=h[w].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,o,u,h,p,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,o,u,h,p,m)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,zK.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,o,u,h,p,m){this.hasData()&&this.programConfigurations.updatePaintArrays(n,o,u,h,p,m)}updateHiddenByLandmark(n){if(!this.hasData())return;const o=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const u=n.flags&Ud?1:0;for(let h=n.groundVertexArrayOffset;h<o;++h)this.hiddenByLandmarkVertexArray.emplace(h,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,BK.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const o=this.regionSegments[n];o&&o.destroy()}}}}class Fw{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Fs,this.footprintVertices=new vc,this.footprintSegments=[],this.layoutVertexArray=new ph,this.centroidVertexArray=new TL,this.wallVertexArray=new SL,this.indexArray=new Fs,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut},o=>eQ.includes(o)),this.segments=new gi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new Qz(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,o){}populate(n,o,u,h){this.features=[],this.hasPattern=MP("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=yw(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:v,sourceLayerIndex:w}of n){const E=this.layers[0]._featureFilter.needGeometry,C=yh(p,E);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),C,u))continue;const P={id:m,sourceLayerIndex:w,index:v,geometry:E?C.geometry:bc(p,u,h),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(kP("fill-extrusion",this.layers,P,this.zoom,o));else if(this.wallMode)for(const z of P.geometry)this.addFeature(P,[z],v,u,{},o.availableImages,h,o.brightness);else this.addFeature(P,P.geometry,v,u,{},o.availableImages,h,o.brightness);o.featureIndex.insert(p,P.geometry,v,w,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,o,u,h,p,m){for(const v of this.features){const{geometry:w}=v;if(this.wallMode)for(const E of w)this.addFeature(v,[E],v.index,o,u,h,p,m);else this.addFeature(v,w,v.index,o,u,h,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,o,u,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,o,v,u,h,p),this.groundEffect.update(n,o,v,u,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,UK),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,FK.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,jK.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,NK.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,u,h,p,m,v,w){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,C=[new Lt(0,0),new Lt(Dt,Dt)],P=v.projection,M=P.name==="globe",z=this.wallMode||JK[n.type]==="Polygon",j=new Xz;j.centroidDataIndex=this.centroidData.length;const V=new Zz,$=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},h)<=0,ee=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},h);let pe;if(V.height=ee,V.vertexArrayOffset=this.layoutVertexArray.length,V.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new fw),this.wallMode){if(M)return void bi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;pe=function(nt){const Ke=nt[0].x===nt[nt.length-1].x&&nt[0].y===nt[nt.length-1].y;(function(un){let Kt=0;const Ot=un.length;for(let En=0;En<Ot;En++)Kt+=(un[(En+1)%Ot].x-un[En].x)*(un[(En+1)%Ot].y+un[En].y);return Kt>=0})(nt)||(nt=nt.reverse());const bt={isPolygon:Ke,geometry:[],joinNormals:[]},lt=[],St=[],ot=[];let gt=nt.length;if(gt<(Ke?3:2))return bt;for(;gt>=2&&nt[gt-1].equals(nt[gt-2]);)gt--;let Pt,ct,Nt,Ct,Tt,_n=0;for(;_n<gt-1&&nt[_n].equals(nt[_n+1]);)_n++;Ke&&(Pt=nt[gt-2],Tt=nt[_n].sub(Pt)._unit()._perp());for(let un=_n;un<gt;un++){if(Nt=un===gt-1?Ke?nt[_n+1]:void 0:nt[un+1],Nt&&nt[un].equals(Nt))continue;Tt&&(Ct=Tt),Pt&&(ct=Pt),Pt=nt[un],Tt=Nt?Nt.sub(Pt)._unit()._perp():Ct,Ct=Ct||Tt;const Kt=Ct.add(Tt);Kt.x===0&&Kt.y===0||Kt._unit();const Ot=Kt.x*Tt.x+Kt.y*Tt.y,En=Ot!==0?1/Ot:1/0,fn=Ct.x*Tt.y-Ct.y*Tt.x>0;let sn="miter";sn==="miter"&&En>2&&(sn="bevel");const Dn=(zn,On,Gn,mr)=>{const sr=new Lt(zn.x,zn.y),Br=new Lt(zn.x,zn.y);sr.x-=On.x*mr,sr.y-=On.y*mr,Br.x-=On.x*Math.max(Gn,1),Br.y-=On.y*Math.max(Gn,1),ot.push(On),lt.push(sr),St.push(Br)};if(sn==="miter")Kt._mult(En),Dn(Pt,Kt,1,0);else{const zn=-Math.sqrt(En*En-1),On=fn?zn:0,Gn=fn?0:zn;ct&&Dn(Pt,Ct,On,Gn),Nt&&Dn(Pt,Tt,On,Gn)}}return bt.geometry=[...lt,...St.reverse(),lt[0]],bt.joinNormals=[...ot,...ot.reverse(),ot[ot.length-1]],bt}(o[0]),o=[pe.geometry]}const fe=(nt,Ke)=>nt<(Ke.length-1)/2||nt===Ke.length-1,me=this.wallMode?[o]:Pw(o,500);for(let nt=me.length-1;nt>=0;nt--){const Ke=me[nt];(Ke.length===0||(Ce=Ke[0]).every(at=>at.x<=0)||Ce.every(at=>at.x>=Dt)||Ce.every(at=>at.y<=0)||Ce.every(at=>at.y>=Dt))&&me.splice(nt,1)}var Ce;let Ae;if(M)Ae=iN(me,C,h);else{Ae=[];for(const nt of me)Ae.push({polygon:nt,bounds:C})}const Le=z?this.edgeRadius:0,$e=Le>0&&this.zoom<17,Ze=(nt,Ke)=>{if(nt.length===0)return!1;const at=nt[nt.length-1];return Ke.x===at.x&&Ke.y===at.y};for(const{polygon:nt,bounds:Ke}of Ae){let at=0,bt=0;for(const gt of nt)z&&!gt[0].equals(gt[gt.length-1])&&gt.push(gt[0]),bt+=z?gt.length-1:gt.length;const lt=this.segments.prepareSegment((z?5:4)*bt,this.layoutVertexArray,this.indexArray);V.footprintSegIdx<0&&(V.footprintSegIdx=this.footprintSegments.length),V.polygonSegIdx<0&&(V.polygonSegIdx=this.polygonSegments.length);const St={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ot=new Hz;if(ot.vertexOffset=this.footprintVertices.length,ot.indexOffset=3*this.footprintIndices.length,ot.ringIndices=[],z){const gt=[],Pt=[];at=lt.vertexLength;for(let Nt=0;Nt<nt.length;Nt++){const Ct=nt[Nt];Ct.length&&Nt!==0&&Pt.push(gt.length/2);const Tt=[];let _n,un;_n=Ct[1].sub(Ct[0])._perp()._unit(),ot.ringIndices.push(Ct.length-1);for(let Kt=1;Kt<Ct.length;Kt++){const Ot=Ct[Kt],En=Ct[Kt===Ct.length-1?1:Kt+1],fn=Ot.clone();if(Le){un=En.sub(Ot)._perp()._unit();const sn=_n.add(un)._unit(),Dn=Le*Math.min(4,1/(_n.x*sn.x+_n.y*sn.y));fn.x+=Dn*sn.x,fn.y+=Dn*sn.y,fn.x=Math.round(fn.x),fn.y=Math.round(fn.y),_n=un}if(!$||Le!==0&&!$e||Ze(Tt,fn)||Tt.push(fn),iv(this.layoutVertexArray,fn.x,fn.y,0,0,1,1,0),this.wallMode){const sn=fe(Kt,Ct);sv(this.wallVertexArray,pe.joinNormals[Kt],sn,pe.isPolygon)}lt.vertexLength++,this.footprintVertices.emplaceBack(Ot.x,Ot.y),gt.push(Ot.x,Ot.y),M&&ov(this.layoutVertexExtArray,P.projectTilePoint(fn.x,fn.y,h),P.upVector(h,fn.x,fn.y))}$&&(Le===0||$e)&&(Tt.length!==0&&Ze(Tt,Tt[0])&&Tt.pop(),this.groundEffect.addData(Tt,Ke,E))}const ct=ev(gt,Pt);for(let Nt=0;Nt<ct.length;Nt+=3)this.footprintIndices.emplaceBack(ot.vertexOffset+ct[Nt+0],ot.vertexOffset+ct[Nt+1],ot.vertexOffset+ct[Nt+2]),this.indexArray.emplaceBack(at+ct[Nt],at+ct[Nt+2],at+ct[Nt+1]),lt.primitiveLength++;ot.indexCount+=ct.length,ot.vertexCount+=this.footprintVertices.length-ot.vertexOffset}for(let gt=0;gt<nt.length;gt++){const Pt=nt[gt];j.startRing(V,Pt[0]);let ct=Pt.length>4&&tN(Pt[Pt.length-2],Pt[0],Pt[1]),Nt=Le?oQ(Pt[Pt.length-2],Pt[0],Pt[1],Le):0;const Ct=[];let Tt,_n,un;_n=Pt[1].sub(Pt[0])._perp()._unit();let Kt=!0;for(let Ot=1,En=0;Ot<Pt.length;Ot++){let fn=Pt[Ot-1],sn=Pt[Ot];const Dn=Pt[Ot===Pt.length-1?1:Ot+1];if(j.appendEdge(V,sn,fn),NP(sn,fn,Ke)){Le&&(_n=Dn.sub(sn)._perp()._unit(),Kt=!Kt);continue}const zn=sn.sub(fn)._perp(),On=zn.x/(Math.abs(zn.x)+Math.abs(zn.y)),Gn=zn.y>0?1:0,mr=fn.dist(sn);if(En+mr>32768&&(En=0),Le){un=Dn.sub(sn)._perp()._unit();let Nn=Jz(fn,sn,Dn,Yz(_n,un),Le);isNaN(Nn)&&(Nn=0);const Rr=sn.sub(fn)._unit();fn=fn.add(Rr.mult(Nt))._round(),sn=sn.add(Rr.mult(-Nn))._round(),Nt=Nn,_n=un,$&&this.zoom>=17&&(Ze(Ct,fn)||Ct.push(fn),Ze(Ct,sn)||Ct.push(sn))}const sr=lt.vertexLength,Br=Pt.length>4&&tN(fn,sn,Dn);let $r=nN(En,ct,Kt);if(iv(this.layoutVertexArray,fn.x,fn.y,On,Gn,0,0,$r),iv(this.layoutVertexArray,fn.x,fn.y,On,Gn,0,1,$r),this.wallMode){const Nn=fe(Ot-1,Pt),Rr=pe.joinNormals[Ot-1];sv(this.wallVertexArray,Rr,!Nn,pe.isPolygon),sv(this.wallVertexArray,Rr,!Nn,pe.isPolygon)}if(En+=mr,$r=nN(En,Br,!Kt),ct=Br,iv(this.layoutVertexArray,sn.x,sn.y,On,Gn,0,0,$r),iv(this.layoutVertexArray,sn.x,sn.y,On,Gn,0,1,$r),this.wallMode){const Nn=fe(Ot,Pt),Rr=pe.joinNormals[Ot];sv(this.wallVertexArray,Rr,!Nn,pe.isPolygon),sv(this.wallVertexArray,Rr,!Nn,pe.isPolygon)}if(lt.vertexLength+=4,this.indexArray.emplaceBack(sr+0,sr+1,sr+2),this.indexArray.emplaceBack(sr+1,sr+3,sr+2),lt.primitiveLength+=2,Le){const Nn=at+(Ot===1?Pt.length-2:Ot-2),Rr=Ot===1?at:Nn+1;if(this.indexArray.emplaceBack(sr+1,Nn,sr+3),this.indexArray.emplaceBack(Nn,Rr,sr+3),lt.primitiveLength+=2,Tt===void 0&&(Tt=sr),!NP(Dn,Pt[Ot],Ke)){const Dr=Ot===Pt.length-1?Tt:lt.vertexLength;this.indexArray.emplaceBack(sr+2,sr+3,Dr),this.indexArray.emplaceBack(sr+3,Dr+1,Dr),this.indexArray.emplaceBack(sr+3,Rr,Dr+1),lt.primitiveLength+=3}Kt=!Kt}if(M){const Nn=this.layoutVertexExtArray,Rr=P.projectTilePoint(fn.x,fn.y,h),Dr=P.projectTilePoint(sn.x,sn.y,h),Jr=P.upVector(h,fn.x,fn.y),Di=P.upVector(h,sn.x,sn.y);ov(Nn,Rr,Jr),ov(Nn,Rr,Jr),ov(Nn,Dr,Di),ov(Nn,Dr,Di)}}z&&(at+=Pt.length-1),$&&Le&&this.zoom>=17&&(Ct.length!==0&&Ze(Ct,Ct[0])&&Ct.pop(),this.groundEffect.addData(Ct,Ke,E,Le>0))}this.footprintSegments.push(ot),St.triangleCount=this.indexArray.length-St.triangleArrayOffset,this.polygonSegments.push(St),++V.footprintSegLen,++V.polygonSegLen}if(V.vertexCount=this.layoutVertexArray.length-V.vertexArrayOffset,V.groundVertexCount=this.groundEffect.vertexArray.length-V.groundVertexArrayOffset,V.vertexCount!==0){if(V.centroidXY=j.borders?Wz:this.encodeCentroid(j,V),this.centroidData.push(V),j.borders){this.featuresOnBorder.push(j);const nt=this.featuresOnBorder.length-1;for(let Ke=0;Ke<j.borders.length;Ke++)j.borders[Ke][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ke].push(nt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,w),this.groundEffect.addPaintPropertiesData(n,u,p,m,h,w),this.maxHeight=Math.max(this.maxHeight,ee)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((o,u)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[u].borders[n][0])}splitToSubtiles(){const n=[];for(let v=0;v<this.centroidData.length;v++){const w=this.centroidData[v],E=+(w.min.y+w.max.y>Dt),C=2*E+(+(w.min.x+w.max.x>Dt)^E);for(let P=0;P<w.polygonSegLen;P++){const M=w.polygonSegIdx+P;n.push({centroidIdx:v,subtile:C,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const o=new Fs;n.sort((v,w)=>v.triangleSegmentIdx===w.triangleSegmentIdx?v.subtile-w.subtile:v.triangleSegmentIdx-w.triangleSegmentIdx);let u=0,h=0,p=0;for(const v of n){if(v.triangleSegmentIdx!==u)break;p++}const m=n.length;for(;h!==n.length;){u=n[h].triangleSegmentIdx;let v=0,w=h,E=h;for(let C=w;C<p&&n[C].subtile===v;C++)E++;for(;w!==p;){const C=n[w];v=C.subtile;const P=this.centroidData[C.centroidIdx].min.clone(),M=this.centroidData[C.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let j=w;j<E;j++){const V=n[j],$=this.polygonSegments[V.polygonSegmentIdx],ee=this.centroidData[V.centroidIdx].min,pe=this.centroidData[V.centroidIdx].max,fe=this.indexArray.uint16;for(let me=$.triangleArrayOffset;me<$.triangleArrayOffset+$.triangleCount;me++)o.emplaceBack(fe[3*me],fe[3*me+1],fe[3*me+2]);z.primitiveLength+=$.triangleCount,P.x=Math.min(P.x,ee.x),P.y=Math.min(P.y,ee.y),M.x=Math.max(M.x,pe.x),M.y=Math.max(M.y,pe.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:P,max:M}),w=E;for(let j=w;j<p&&n[j].subtile===n[w].subtile;j++)E++}h=p;for(let C=h;C<m&&n[C].triangleSegmentIdx===n[h].triangleSegmentIdx;C++)p++}o._trim(),this.indexArray=o}getVisibleSegments(n,o,u){const h=new gi;if(this.wallMode){for(const V of this.triangleSubSegments)h.segments.push(V.segment);return h}let p=0,m=0;const v=1<<n.canonical.z;if(o){const V=o.getMinMaxForTile(n);V&&(p=V.min,m=V.max)}m+=this.maxHeight;const w=n.toUnwrapped();let E;const C=[w.canonical.x/v+w.wrap,w.canonical.y/v],P=[(w.canonical.x+1)/v+w.wrap,(w.canonical.y+1)/v],M=(V,$,ee)=>[V[0]*(1-ee[0])+$[0]*ee[0],V[1]*(1-ee[1])+$[1]*ee[1]],z=[],j=[];for(const V of this.triangleSubSegments){z[0]=V.min.x/Dt,z[1]=V.min.y/Dt,j[0]=V.max.x/Dt,j[1]=V.max.y/Dt;const $=M(C,P,z),ee=M(C,P,j);if(new ci([$[0],$[1],p],[ee[0],ee[1],m]).intersectsPrecise(u)===0){E&&(h.segments.push(E),E=void 0);continue}const pe=V.segment;E&&E.vertexOffset!==pe.vertexOffset&&(h.segments.push(E),E=void 0),E?(E.vertexLength+=pe.vertexLength,E.primitiveLength+=pe.primitiveLength):E={vertexOffset:pe.vertexOffset,primitiveLength:pe.primitiveLength,vertexLength:pe.vertexLength,primitiveOffset:pe.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&h.segments.push(E),h}encodeCentroid(n,o){const u=n.centroid(),h=o.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Lt(Wn(u.x,1,Dt-1)<<3|p,Wn(u.y,1,Dt-1)<<3|m)}encodeBorderCentroid(n){if(!n.borders)return new Lt(0,0);const o=n.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const h=o[0][0]!==u?0:1;return new Lt(6|(o[0][0]!==u?0:65528),(o[h][0]+o[h][1])/2<<3|6)}{const h=o[2][0]!==u?2:3;return new Lt((o[h][0]+o[h][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(n){const o=this.centroidData[n.centroidDataIndex];o.flags&=Ud,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const o=n.vertexArrayOffset,u=n.vertexCount+n.vertexArrayOffset,h=n.flags&Ud?Wz:n.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==h.y||p!==h.x){for(let m=o;m<u;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(n.toUnwrapped());if(zP(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<u)continue;const v=Math.pow(2,m.footprintTileId.canonical.z-n.canonical.z);for(const w of this.centroidData)if(!(w.flags&Ud||m.min.x>w.max.x||w.min.x>m.max.x||m.min.y>w.max.y||w.min.y>m.max.y))for(let E=0;E<w.footprintSegLen;E++){const C=this.footprintSegments[w.footprintSegIdx+E];if(p.length=0,aQ(this.footprintVertices,C.vertexOffset,C.vertexCount,m.footprintTileId.canonical,n.canonical,p),Oz(m.footprint,p,this.footprintIndices.uint16,C.indexOffset,C.indexCount,-C.vertexOffset,-v)){w.flags|=Ud;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,o,u){let h=!1;for(let p=0;p<u.footprintSegLen;p++){const m=this.footprintSegments[u.footprintSegIdx+p];let v=0;for(const w of m.ringIndices){for(let E=v,C=w+v-1;E<w+v;C=E++){const P=this.footprintVertices.int16[2*(E+m.vertexOffset)+0],M=this.footprintVertices.int16[2*(E+m.vertexOffset)+1],z=this.footprintVertices.int16[2*(C+m.vertexOffset)+1];M>o!=z>o&&n<(this.footprintVertices.int16[2*(C+m.vertexOffset)+0]-P)*(o-M)/(z-M)+P&&(h=!h)}v=w}}return h}getHeightAtTileCoord(n,o){let u=Number.NEGATIVE_INFINITY,h=!0;const p=4*(n+Dt)*Dt+(o+Dt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&Ud)}:void 0}for(const m of this.centroidData)n>m.max.x||m.min.x>n||o>m.max.y||m.min.y>o||this.footprintContainsPoint(n,o,m)&&m&&m.height>u&&(u=m.height,this.partLookup[p]=m,h=!!(m.flags&Ud));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[p]=void 0}}function Yz(i,n){const o=i.add(n)._unit();return i.x*o.x+i.y*o.y}function oQ(i,n,o,u){const h=n.sub(i)._perp()._unit(),p=o.sub(n)._perp()._unit();return Jz(i,n,o,Yz(h,p),u)}function Jz(i,n,o,u,h){const p=Math.sqrt(1-u*u);return Math.min(i.dist(n)/3,n.dist(o)/3,h*p/u)}function NP(i,n,o){return i.x<o[0].x&&n.x<o[0].x||i.x>o[1].x&&n.x>o[1].x||i.y<o[0].y&&n.y<o[0].y||i.y>o[1].y&&n.y>o[1].y}function eN(i,n){return i.x<n[0].x||i.x>n[1].x||i.y<n[0].y||i.y>n[1].y}function tN(i,n,o){if(i.x<0||i.x>=Dt||n.x<0||n.x>=Dt||o.x<0||o.x>=Dt)return!1;const u=o.sub(n),h=u.perp(),p=i.sub(n);return(u.x*p.x+u.y*p.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function nN(i,n,o){const u=n?2|i:-3&i;return o?1|u:-2&u}function rN(){const i=Math.PI/32,n=Math.tan(i),o=Xg;return o*Math.sqrt(1+2*n*n)-o}function iN(i,n,o){const u=1<<o.z,h=fa(o.x/u),p=fa((o.x+1)/u),m=Hs(o.y/u),v=Hs((o.y+1)/u);return function(w,E,C,P,M=0,z){const j=[];if(!w.length||!C||!P)return j;const V=(Ae,Le)=>{for(const $e of Ae)j.push({polygon:$e,bounds:Le})},$=Math.ceil(Math.log2(C)),ee=Math.ceil(Math.log2(P)),pe=$-ee,fe=[];for(let Ae=0;Ae<Math.abs(pe);Ae++)fe.push(pe>0?0:1);for(let Ae=0;Ae<Math.min($,ee);Ae++)fe.push(0),fe.push(1);let me=w;if(me=Dw(me,E[0].y-M,E[1].y+M,1),me=Dw(me,E[0].x-M,E[1].x+M,0),!me.length)return j;const Ce=[];for(fe.length?Ce.push({polygons:me,bounds:E,depth:0}):V(me,E);Ce.length;){const Ae=Ce.pop(),Le=Ae.depth,$e=fe[Le],Ze=Ae.bounds[0],nt=Ae.bounds[1],Ke=$e===0?Ze.x:Ze.y,at=$e===0?nt.x:nt.y,bt=z?z($e,Ke,at):.5*(Ke+at),lt=Dw(Ae.polygons,Ke-M,bt+M,$e),St=Dw(Ae.polygons,bt-M,at+M,$e);if(lt.length){const ot=[Ze,new Lt($e===0?bt:nt.x,$e===1?bt:nt.y)];fe.length>Le+1?Ce.push({polygons:lt,bounds:ot,depth:Le+1}):V(lt,ot)}if(St.length){const ot=[new Lt($e===0?bt:Ze.x,$e===1?bt:Ze.y),nt];fe.length>Le+1?Ce.push({polygons:St,bounds:ot,depth:Le+1}):V(St,ot)}}return j}(i,n,Math.ceil((p-h)/11.25),Math.ceil((m-v)/11.25),1,(w,E,C)=>{if(w===0)return .5*(E+C);{const P=Hs((o.y+E/Dt)/u);return(du(.5*(Hs((o.y+C/Dt)/u)+P))*u-o.y)*Dt}})}function aQ(i,n,o,u,h,p){const m=Math.pow(2,u.z-h.z);for(let v=0;v<o;v++){let w=i.int16[2*(v+n)+0],E=i.int16[2*(v+n)+1];w=(w+h.x*Dt)*m-u.x*Dt,E=(E+h.y*Dt)*m-u.y*Dt,p.push(new Lt(w,E))}}let sN,oN;function av(i,n){return i.x*n.x+i.y*n.y}function aN(i,n){if(i.length===1){let o=0;const u=n[o++];let h;for(;!h||u.equals(h);)if(h=n[o++],!h)return 1/0;for(;o<n.length;o++){const p=n[o],m=i[0],v=h.sub(u),w=p.sub(u),E=m.sub(u),C=av(v,v),P=av(v,w),M=av(w,w),z=av(E,v),j=av(E,w),V=C*M-P*P,$=(M*z-P*j)/V,ee=(C*j-P*z)/V,pe=u.z*(1-$-ee)+h.z*$+p.z*ee;if(isFinite(pe))return pe}return 1/0}{let o=1/0;for(const u of n)o=Math.min(o,u.z);return o}}function lN(i,n,o,u,h,p,m,v){const w=m*h.getElevationAt(i,n,!0,!0),E=p[0]!==0,C=E?p[1]===0?m*(p[0]/7-450):m*function(P,M,z){const j=Math.floor(M[0]/8),V=Math.floor(M[1]/8),$=10*(M[0]-8*j),ee=10*(M[1]-8*V),pe=P.getElevationAt(j,V,!0,!0),fe=P.getMeterToDEM(z),me=Math.floor(.5*($*fe-1)),Ce=Math.floor(.5*(ee*fe-1)),Ae=P.tileCoordToPixel(j,V),Le=2*me+1,$e=2*Ce+1,Ze=function(St,ot,gt,Pt,ct){return[St.getElevationAtPixel(ot,gt,!0),St.getElevationAtPixel(ot+ct,gt,!0),St.getElevationAtPixel(ot,gt+ct,!0),St.getElevationAtPixel(ot+Pt,gt+ct,!0)]}(P,Ae.x-me,Ae.y-Ce,Le,$e),nt=Math.abs(Ze[0]-Ze[1]),Ke=Math.abs(Ze[2]-Ze[3]),at=Math.abs(Ze[0]-Ze[2])+Math.abs(Ze[1]-Ze[3]),bt=Math.min(.25,.5*fe*(nt+Ke)/Le),lt=Math.min(.25,.5*fe*at/$e);return pe+Math.max(bt*$,lt*ee)}(h,p,v):w;return{base:w+(o===0)?-1:o,top:E?Math.max(C+u,w+o+2):w+u}}Ve(Fw,"FillExtrusionBucket",{omit:["layers","features"]}),Ve(Zz,"PartData"),Ve(Hz,"FootprintSegment"),Ve(Xz,"BorderCentroidData"),Ve(Qz,"GroundEffect");const lQ=Pr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:cQ}=lQ,uQ=Pr([{name:"a_packed",components:4,type:"Float32"}]),{members:hQ}=uQ,dQ=Pr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:fQ}=dQ,pQ=Pr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),mQ=Pr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),gQ=Pr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Pr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cN=Pr([{name:"a_z_offset",components:1,type:"Float32"}],4),_Q=Pr([{name:"a_texb",components:2,type:"Uint16"}]),yQ=Pr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),vQ=Pr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Pr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uN=Pr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xQ=Pr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pr([{name:"triangle",components:3,type:"Uint16"}]),Pr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Pr([{type:"Float32",name:"offsetX"}]),Pr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class hN{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new Bd({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const u=this.getKey(n,o);return this.positions[u]}trim(){const n=this.width,o=this.height=Ea(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,u){const h=[];let p=n.length%2==1?-n[n.length-1]*u:0,m=n[0]*u,v=!0;h.push({left:p,right:m,isDash:v,zeroLength:n[0]===0});let w=n[0];for(let E=1;E<n.length;E++){v=!v;const C=n[E];p=w*u,w+=C,m=w*u,h.push({left:p,right:m,isDash:v,zeroLength:C===0})}return h}addRoundDash(n,o,u){const h=o/2;for(let p=-u;p<=u;p++){const m=this.width*(this.nextRow+u+p);let v=0,w=n[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=n[++v]);const C=Math.abs(E-w.left),P=Math.abs(E-w.right),M=Math.min(C,P);let z;const j=p/u*(h+1);if(w.isDash){const V=h-Math.abs(j);z=Math.sqrt(M*M+V*V)}else z=h-Math.sqrt(M*M+j*j);this.image.data[m+E]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(n,o){for(let w=n.length-1;w>=0;--w){const E=n[w],C=n[w+1];E.zeroLength?n.splice(w,1):C&&C.isDash===E.isDash&&(C.left=E.left,n.splice(w,1))}const u=n[0],h=n[n.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const p=this.width*this.nextRow;let m=0,v=n[m];for(let w=0;w<this.width;w++){w/v.right>1&&(v=n[++m]);const E=Math.abs(w-v.left),C=Math.abs(w-v.right),P=Math.min(E,C);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?P:-P)+o+128))}}addDash(n,o){const u=this.getKey(n,o);if(this.positions[u])return this.positions[u];const h=o==="round",p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return bi("LineAtlas out of space"),null;n.length===0&&n.push(1);let v=0;for(let C=0;C<n.length;C++)n[C]<0&&(bi("Negative value is found in line dasharray, replacing values with 0"),n[C]=0),v+=n[C];if(v!==0){const C=this.width/v,P=this.getDashRanges(n,this.width,C);h?this.addRoundDash(P,C,p):this.addRegularDash(P,o==="square"?.5*C:0)}const w=this.nextRow+p;this.nextRow+=m;const E={tl:[w,p],br:[v,0]};return this.positions[u]=E,E}}Ve(hN,"LineAtlas");const bQ=kw.types,wQ=Math.cos(Math.PI/180*37.5),TQ=Math.cos(Math.PI/180*5);class Bw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new VA,this.layoutVertexArray2=new Md,this.patternVertexArray=new kd,this.indexArray=new Fs,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new gi,this.maxLineLength=0,this.zOffsetVertexArray=new Gg,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:Dt/64}updateFootprints(n,o){}populate(n,o,u,h){this.hasPattern=MP("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),m=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!m.isConstant()||!!m.constantOr(0);const v=[];for(const{feature:P,id:M,index:z,sourceLayerIndex:j}of n){const V=this.layers[0]._featureFilter.needGeometry,$=yh(P,V);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),$,u))continue;const ee=p?p.evaluate($,{},u):void 0,pe={id:M,properties:P.properties,type:P.type,sourceLayerIndex:j,index:z,geometry:V?$.geometry:bc(P,u,h),patterns:{},sortKey:ee};v.push(pe)}p&&v.sort((P,M)=>P.sortKey-M.sortKey);const{lineAtlas:w,featureIndex:E}=o,C=this.addConstantDashes(w);for(const P of v){const{geometry:M,index:z,sourceLayerIndex:j}=P;if(C&&this.addFeatureDashes(P,w),this.hasPattern){const V=kP("line",this.layers,P,this.zoom,o);this.patternFeatures.push(V)}else this.addFeature(P,M,z,u,w.positions,o.availableImages,o.brightness);E.insert(n[z].feature,M,z,j,this.index)}}addConstantDashes(n){let o=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")o=!0;else{const m=p.value,v=h.value;if(!v)continue;n.addDash(v,m)}}return o}addFeatureDashes(n,o){const u=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let v,w;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:u},n);w=m.kind==="constant"?m.value:m.evaluate({zoom:u},n),o.addDash(v,w),n.patterns[h.id]=o.getKey(v,w)}}update(n,o,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,u,h,p)}addFeatures(n,o,u,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,u,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,hQ)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,fQ)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,cN.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,cQ),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,u,h,p,m,v){const w=this.layers[0].layout,E=w.get("line-join").evaluate(n,{}),C=w.get("line-cap").evaluate(n,{}),P=w.get("line-miter-limit"),M=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const z of o)this.addLine(z,n,h,E,C,P,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,v)}addLine(n,o,u,h,p,m,v){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const w={zoom:this.zoom,lineProgress:void 0},E=this.layers[0].layout,C=h==="none";if(this.patternJoinNone=this.hasPattern&&C,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ae=0;Ae<n.length-1;Ae++)this.totalDistance+=n[Ae].dist(n[Ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=bQ[o.type]==="Polygon";let M=n.length;for(;M>=2&&n[M-1].equals(n[M-2]);)M--;let z=0;for(;z<M-1&&n[z].equals(n[z+1]);)z++;if(M<(P?3:2))return;h==="bevel"&&(m=1.05);const j=this.overscaling<=16?15*Dt/(512*this.overscaling):0,V=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let $,ee,pe,fe,me,Ce;this.e1=this.e2=-1,P&&($=n[M-2],me=n[z].sub($)._unit()._perp());for(let Ae=z;Ae<M;Ae++){if(pe=Ae===M-1?P?n[z+1]:void 0:n[Ae+1],pe&&n[Ae].equals(pe))continue;if(me&&(fe=me),$&&(ee=$),$=n[Ae],this.hasZOffset){const ot=E.get("line-z-offset").value;if(ot.kind==="constant")Ce=ot.value;else{if(this.lineClips){const gt=this.totalDistance/(this.lineClips.end-this.lineClips.start);w.lineProgress=(gt*this.lineClips.start+this.distance+(ee?ee.dist($):0))/gt}else bi(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),w.lineProgress=0;Ce=ot.evaluate(w,o)}Ce=Ce||0}me=pe?pe.sub($)._unit()._perp():fe,fe=fe||me;const Le=ee&&pe;let $e=Le?h:P||C?"butt":p;const Ze=fe.x*me.x+fe.y*me.y;if(C){const ot=function(gt){if(gt.patternJoinNone){const Pt=gt.segmentPoints.length/2,ct=gt.lineSoFar-gt.segmentStart;for(let Nt=0;Nt<Pt;++Nt){const Ct=gt.segmentPoints[2*Nt+1],Tt=Math.round(gt.segmentPoints[2*Nt])+.5+.25*Ct;gt.patternVertexArray.emplaceBack(Tt,ct,gt.segmentStart),gt.patternVertexArray.emplaceBack(Tt,ct,gt.segmentStart)}gt.segmentPoints.length=0}gt.e1=gt.e2=-1};if(Le&&Ze<TQ){this.updateDistance(ee,$),this.addCurrentVertex($,fe,1,1,V,Ce),ot(this),this.addCurrentVertex($,me,-1,-1,V,Ce);continue}if(ee){if(!pe){this.updateDistance(ee,$),this.addCurrentVertex($,fe,1,1,V,Ce),ot(this);continue}$e="miter"}}let nt=fe.add(me);nt.x===0&&nt.y===0||nt._unit();const Ke=nt.x*me.x+nt.y*me.y,at=Ke!==0?1/Ke:1/0,bt=2*Math.sqrt(2-2*Ke),lt=Ke<wQ&&ee&&pe,St=fe.x*me.y-fe.y*me.x>0;if(lt&&Ae>z){const ot=$.dist(ee);if(ot>2*j){const gt=$.sub($.sub(ee)._mult(j/ot)._round());this.updateDistance(ee,gt),this.addCurrentVertex(gt,fe,0,0,V,Ce),ee=gt}}if(Le&&$e==="round"&&(at<v?$e="miter":at<=2&&($e="fakeround")),$e==="miter"&&at>m&&($e="bevel"),$e==="bevel"&&(at>2&&($e="flipbevel"),at<m&&($e="miter")),ee&&this.updateDistance(ee,$),$e==="miter")nt._mult(at),this.addCurrentVertex($,nt,0,0,V,Ce);else if($e==="flipbevel"){if(at>100)nt=me.mult(-1);else{const ot=at*fe.add(me).mag()/fe.sub(me).mag();nt._perp()._mult(ot*(St?-1:1))}this.addCurrentVertex($,nt,0,0,V,Ce),this.addCurrentVertex($,nt.mult(-1),0,0,V,Ce)}else if($e==="bevel"||$e==="fakeround"){const ot=-Math.sqrt(at*at-1),gt=St?ot:0,Pt=St?0:ot;if(ee&&this.addCurrentVertex($,fe,gt,Pt,V,Ce),$e==="fakeround"){const ct=Math.round(180*bt/Math.PI/20);for(let Nt=1;Nt<ct;Nt++){let Ct=Nt/ct;if(Ct!==.5){const _n=Ct-.5;Ct+=Ct*_n*(Ct-1)*((1.0904+Ze*(Ze*(3.55645-1.43519*Ze)-3.2452))*_n*_n+(.848013+Ze*(.215638*Ze-1.06021)))}const Tt=me.sub(fe)._mult(Ct)._add(fe)._unit()._mult(St?-1:1);this.addHalfVertex($,Tt.x,Tt.y,!1,St,0,V,Ce)}}pe&&this.addCurrentVertex($,me,-gt,-Pt,V,Ce)}else $e==="butt"?this.addCurrentVertex($,nt,0,0,V,Ce):$e==="square"?(ee||this.addCurrentVertex($,nt,-1,-1,V,Ce),this.addCurrentVertex($,nt,0,0,V,Ce),ee&&this.addCurrentVertex($,nt,1,1,V,Ce)):$e==="round"&&(ee&&(this.addCurrentVertex($,fe,0,0,V,Ce),this.addCurrentVertex($,fe,1,1,V,Ce,!0)),pe&&(this.addCurrentVertex($,me,-1,-1,V,Ce,!0),this.addCurrentVertex($,me,0,0,V,Ce)));if(lt&&Ae<M-1){const ot=$.dist(pe);if(ot>2*j){const gt=$.add(pe.sub($)._mult(j/ot)._round());this.updateDistance($,gt),this.addCurrentVertex(gt,me,0,0,V,Ce),$=gt}}}}addVerticesTo(n,o,u,h,p,m,v,w,E,C){const P=(o.w-n.w)/this.tessellationStep|0;if(P>1){this.lineSoFar=n.w;const M=(o.x-n.x)/P,z=(o.y-n.y)/P,j=(o.z-n.z)/P,V=(o.w-n.w)/P;for(let $=1;$<P;++$)n.x+=M,n.y+=z,n.z+=j,this.lineSoFar+=V,this.addHalfVertex(n,u,h,C,!1,v,E,n.z),this.addHalfVertex(n,p,m,C,!0,-w,E,n.z)}this.lineSoFar=o.w,this.addHalfVertex(o,u,h,C,!1,v,E,o.z),this.addHalfVertex(o,p,m,C,!0,-w,E,o.z)}addCurrentVertex(n,o,u,h,p,m,v=!1){const w=o.x+o.y*u,E=o.y-o.x*u,C=o.y*h-o.x,P=-o.y-o.x*h;if(m!=null){const z=Dt+10,j=m,V=new Az(n.x,n.y,j,this.lineSoFar),$=dN(n,-10,z),ee=this.lineSoFar;if(this.currentVertex)if($){const pe=this.currentVertexIsOutside,fe=this.currentVertex,me=new Az(n.x,n.y,j,this.lineSoFar);Rz(fe,me,-10,z),dN(me,-10,z)||(pe&&(this.e1=this.e2=-1,this.lineSoFar=fe.w,this.addHalfVertex(fe,w,E,v,!1,u,p,fe.z),this.addHalfVertex(fe,C,P,v,!0,-h,p,fe.z)),this.addVerticesTo(fe,me,w,E,C,P,u,h,p,v))}else{const pe=this.currentVertex;this.currentVertexIsOutside&&(Rz(pe,V,-10,z),this.e1=this.e2=-1,this.lineSoFar=pe.w,this.addHalfVertex(pe,w,E,v,!1,u,p,pe.z),this.addHalfVertex(pe,C,P,v,!0,-h,p,pe.z)),this.addVerticesTo(pe,V,w,E,C,P,u,h,p,v)}else $||(this.addHalfVertex(n,w,E,v,!1,u,p,m),this.addHalfVertex(n,C,P,v,!0,-h,p,m));this.currentVertex=V,this.currentVertexIsOutside=$,this.lineSoFar=ee}else this.addHalfVertex(n,w,E,v,!1,u,p,m),this.addHalfVertex(n,C,P,v,!0,-h,p,m)}addHalfVertex({x:n,y:o},u,h,p,m,v,w,E){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((n<<1)+(p?1:0),(o<<1)+(m?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),m?this.e2=C:this.e1=C,E!=null&&this.zOffsetVertexArray.emplaceBack(E)}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,o){this.distance+=n.dist(o),this.updateScaledDistance()}}function dN(i,n,o){return i.x<n||i.x>o||i.y<n||i.y>o}let fN,pN;function mN(i,n,o){return n*(Dt/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}function gN(i,n){return 1/mN(i,1,n.tileZoom)}function _N(i,n,o,u){return i.translatePosMatrix(u||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}Ve(Bw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const yN=i=>{const n=[];vN(i)&&n.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const o=i.paint.get("line-trim-offset");o[0]===0&&o[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const u=i.layout.get("line-join").constantOr("miter")==="none",h=!!i.paint.get("line-pattern").constantOr(1);return u&&h&&n.push("LINE_JOIN_NONE"),n};function vN(i){const n=i.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}class xN{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const u=n[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}var EQ={read:function(i,n,o,u,h){var p,m,v=8*h-u-1,w=(1<<v)-1,E=w>>1,C=-7,P=o?h-1:0,M=o?-1:1,z=i[n+P];for(P+=M,p=z&(1<<-C)-1,z>>=-C,C+=v;C>0;p=256*p+i[n+P],P+=M,C-=8);for(m=p&(1<<-C)-1,p>>=-C,C+=u;C>0;m=256*m+i[n+P],P+=M,C-=8);if(p===0)p=1-E;else{if(p===w)return m?NaN:1/0*(z?-1:1);m+=Math.pow(2,u),p-=E}return(z?-1:1)*m*Math.pow(2,p-u)},write:function(i,n,o,u,h,p){var m,v,w,E=8*p-h-1,C=(1<<E)-1,P=C>>1,M=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=u?0:p-1,j=u?1:-1,V=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(v=isNaN(n)?1:0,m=C):(m=Math.floor(Math.log(n)/Math.LN2),n*(w=Math.pow(2,-m))<1&&(m--,w*=2),(n+=m+P>=1?M/w:M*Math.pow(2,1-P))*w>=2&&(m++,w/=2),m+P>=C?(v=0,m=C):m+P>=1?(v=(n*w-1)*Math.pow(2,h),m+=P):(v=n*Math.pow(2,P-1)*Math.pow(2,h),m=0));h>=8;i[o+z]=255&v,z+=j,v/=256,h-=8);for(m=m<<h|v,E+=h;E>0;i[o+z]=255&m,z+=j,m/=256,E-=8);i[o+z-j]|=128*V}},bN=ui,jw=EQ;function ui(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ui.Varint=0,ui.Fixed64=1,ui.Bytes=2,ui.Fixed32=5;var FP=4294967296,wN=1/FP,TN=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function bh(i){return i.type===ui.Bytes?i.readVarint()+i.pos:i.pos+1}function n_(i,n,o){return o?4294967296*n+(i>>>0):4294967296*(n>>>0)+(i>>>0)}function EN(i,n,o){var u=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(u);for(var h=o.pos-1;h>=i;h--)o.buf[h+u]=o.buf[h]}function SQ(i,n){for(var o=0;o<i.length;o++)n.writeVarint(i[o])}function IQ(i,n){for(var o=0;o<i.length;o++)n.writeSVarint(i[o])}function CQ(i,n){for(var o=0;o<i.length;o++)n.writeFloat(i[o])}function AQ(i,n){for(var o=0;o<i.length;o++)n.writeDouble(i[o])}function PQ(i,n){for(var o=0;o<i.length;o++)n.writeBoolean(i[o])}function RQ(i,n){for(var o=0;o<i.length;o++)n.writeFixed32(i[o])}function MQ(i,n){for(var o=0;o<i.length;o++)n.writeSFixed32(i[o])}function kQ(i,n){for(var o=0;o<i.length;o++)n.writeFixed64(i[o])}function DQ(i,n){for(var o=0;o<i.length;o++)n.writeSFixed64(i[o])}function Uw(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+16777216*i[n+3]}function r_(i,n,o){i[o]=n,i[o+1]=n>>>8,i[o+2]=n>>>16,i[o+3]=n>>>24}function SN(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+(i[n+3]<<24)}ui.prototype={destroy:function(){this.buf=null},readFields:function(i,n,o){for(o=o||this.length;this.pos<o;){var u=this.readVarint(),h=u>>3,p=this.pos;this.type=7&u,i(h,n,this),this.pos===p&&this.skip(u)}return n},readMessage:function(i,n){return this.readFields(i,n,this.readVarint()+this.pos)},readFixed32:function(){var i=Uw(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=SN(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Uw(this.buf,this.pos)+Uw(this.buf,this.pos+4)*FP;return this.pos+=8,i},readSFixed64:function(){var i=Uw(this.buf,this.pos)+SN(this.buf,this.pos+4)*FP;return this.pos+=8,i},readFloat:function(){var i=jw.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=jw.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var n,o,u=this.buf;return n=127&(o=u[this.pos++]),o<128?n:(n|=(127&(o=u[this.pos++]))<<7,o<128?n:(n|=(127&(o=u[this.pos++]))<<14,o<128?n:(n|=(127&(o=u[this.pos++]))<<21,o<128?n:function(h,p,m){var v,w,E=m.buf;if(v=(112&(w=E[m.pos++]))>>4,w<128||(v|=(127&(w=E[m.pos++]))<<3,w<128)||(v|=(127&(w=E[m.pos++]))<<10,w<128)||(v|=(127&(w=E[m.pos++]))<<17,w<128)||(v|=(127&(w=E[m.pos++]))<<24,w<128)||(v|=(1&(w=E[m.pos++]))<<31,w<128))return n_(h,v,p);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(o=u[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,n=this.pos;return this.pos=i,i-n>=12&&TN?function(o,u,h){return TN.decode(o.subarray(u,h))}(this.buf,n,i):function(o,u,h){for(var p="",m=u;m<h;){var v,w,E,C=o[m],P=null,M=C>239?4:C>223?3:C>191?2:1;if(m+M>h)break;M===1?C<128&&(P=C):M===2?(192&(v=o[m+1]))==128&&(P=(31&C)<<6|63&v)<=127&&(P=null):M===3?(w=o[m+2],(192&(v=o[m+1]))==128&&(192&w)==128&&((P=(15&C)<<12|(63&v)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):M===4&&(w=o[m+2],E=o[m+3],(192&(v=o[m+1]))==128&&(192&w)==128&&(192&E)==128&&((P=(15&C)<<18|(63&v)<<12|(63&w)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,M=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),m+=M}return p}(this.buf,n,i)},readBytes:function(){var i=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,i);return this.pos=i,n},readPackedVarint:function(i,n){if(this.type!==ui.Bytes)return i.push(this.readVarint(n));var o=bh(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(n));return i},readPackedSVarint:function(i){if(this.type!==ui.Bytes)return i.push(this.readSVarint());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ui.Bytes)return i.push(this.readBoolean());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ui.Bytes)return i.push(this.readFloat());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ui.Bytes)return i.push(this.readDouble());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ui.Bytes)return i.push(this.readFixed32());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ui.Bytes)return i.push(this.readSFixed32());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ui.Bytes)return i.push(this.readFixed64());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ui.Bytes)return i.push(this.readSFixed64());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed64());return i},skip:function(i){var n=7&i;if(n===ui.Varint)for(;this.buf[this.pos++]>127;);else if(n===ui.Bytes)this.pos=this.readVarint()+this.pos;else if(n===ui.Fixed32)this.pos+=4;else{if(n!==ui.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(i,n){this.writeVarint(i<<3|n)},realloc:function(i){for(var n=this.length||16;n<this.pos+i;)n*=2;if(n!==this.length){var o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),r_(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),r_(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),r_(this.buf,-1&i,this.pos),r_(this.buf,Math.floor(i*wN),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),r_(this.buf,-1&i,this.pos),r_(this.buf,Math.floor(i*wN),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(n,o){var u,h;if(n>=0?(u=n%4294967296|0,h=n/4294967296|0):(h=~(-n/4294967296),4294967295^(u=~(-n%4294967296))?u=u+1|0:(u=0,h=h+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(p,m,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(u,0,o),function(p,m){var v=(7&p)<<4;m.buf[m.pos++]|=v|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(h,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var n=this.pos;this.pos=function(u,h,p){for(var m,v,w=0;w<h.length;w++){if((m=h.charCodeAt(w))>55295&&m<57344){if(!v){m>56319||w+1===h.length?(u[p++]=239,u[p++]=191,u[p++]=189):v=m;continue}if(m<56320){u[p++]=239,u[p++]=191,u[p++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(u[p++]=239,u[p++]=191,u[p++]=189,v=null);m<128?u[p++]=m:(m<2048?u[p++]=m>>6|192:(m<65536?u[p++]=m>>12|224:(u[p++]=m>>18|240,u[p++]=m>>12&63|128),u[p++]=m>>6&63|128),u[p++]=63&m|128)}return p}(this.buf,i,this.pos);var o=this.pos-n;o>=128&&EN(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),jw.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),jw.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var n=i.length;this.writeVarint(n),this.realloc(n);for(var o=0;o<n;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,n){this.pos++;var o=this.pos;i(n,this);var u=this.pos-o;u>=128&&EN(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeMessage:function(i,n,o){this.writeTag(i,ui.Bytes),this.writeRawMessage(n,o)},writePackedVarint:function(i,n){n.length&&this.writeMessage(i,SQ,n)},writePackedSVarint:function(i,n){n.length&&this.writeMessage(i,IQ,n)},writePackedBoolean:function(i,n){n.length&&this.writeMessage(i,PQ,n)},writePackedFloat:function(i,n){n.length&&this.writeMessage(i,CQ,n)},writePackedDouble:function(i,n){n.length&&this.writeMessage(i,AQ,n)},writePackedFixed32:function(i,n){n.length&&this.writeMessage(i,RQ,n)},writePackedSFixed32:function(i,n){n.length&&this.writeMessage(i,MQ,n)},writePackedFixed64:function(i,n){n.length&&this.writeMessage(i,kQ,n)},writePackedSFixed64:function(i,n){n.length&&this.writeMessage(i,DQ,n)},writeBytesField:function(i,n){this.writeTag(i,ui.Bytes),this.writeBytes(n)},writeFixed32Field:function(i,n){this.writeTag(i,ui.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(i,n){this.writeTag(i,ui.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(i,n){this.writeTag(i,ui.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(i,n){this.writeTag(i,ui.Fixed64),this.writeSFixed64(n)},writeVarintField:function(i,n){this.writeTag(i,ui.Varint),this.writeVarint(n)},writeSVarintField:function(i,n){this.writeTag(i,ui.Varint),this.writeSVarint(n)},writeStringField:function(i,n){this.writeTag(i,ui.Bytes),this.writeString(n)},writeFloatField:function(i,n){this.writeTag(i,ui.Fixed32),this.writeFloat(n)},writeDoubleField:function(i,n){this.writeTag(i,ui.Fixed64),this.writeDouble(n)},writeBooleanField:function(i,n){this.writeVarintField(i,!!n)}};var lv=de(bN);const OQ=["id","tile","layer","source","sourceLayer","state"];class IN{constructor(n,o,u,h,p){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=u,this._y=h,this.properties=n.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of OQ)this[o]!==void 0&&(n[o]=this[o]);return n}}class LQ{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,u){const h=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][h]=this.stateChanges[n][h]||{},Is(this.stateChanges[n][h],u),this.deletedStates[n]===null){this.deletedStates[n]={};for(const p in this.state[n])p!==h&&(this.deletedStates[n][p]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][h]===null){this.deletedStates[n][h]={};for(const p in this.state[n][h])u[p]||(this.deletedStates[n][h][p]=null)}else for(const p in u)this.deletedStates[n]&&this.deletedStates[n][h]&&this.deletedStates[n][h][p]===null&&delete this.deletedStates[n][h][p]}removeFeatureState(n,o,u){if(this.deletedStates[n]===null)return;const h=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},u&&o!==void 0)this.deletedStates[n][h]!==null&&(this.deletedStates[n][h]=this.deletedStates[n][h]||{},this.deletedStates[n][h][u]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][h])for(u in this.deletedStates[n][h]={},this.stateChanges[n][h])this.deletedStates[n][h][u]=null;else this.deletedStates[n][h]=null;else this.deletedStates[n]=null}getState(n,o){const u=String(o),h=Is({},(this.state[n]||{})[u],(this.stateChanges[n]||{})[u]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const p=this.deletedStates[n][o];if(p===null)return{};for(const m in p)delete h[m]}return h}initializeTileState(n,o){n.setFeatureState(this.state,o)}coalesceChanges(n,o){const u={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),Is(this.state[h][m],this.stateChanges[h][m]),p[m]=this.state[h][m];u[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const m in this.state[h])p[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(const v of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][v];p[m]=this.state[h][m]}u[h]=u[h]||{},Is(u[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const h in n)n[h].setFeatureState(u,o)}}class CN{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new et(Dt,16,0),this.featureIndexArray=new wL,this.promoteId=o,this.is3DTile=!1}insert(n,o,u,h,p,m=0,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,p,m);const E=this.grid;for(let C=0;C<o.length;C++){const P=o[C],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){const j=P[z];M[0]=Math.min(M[0],j.x),M[1]=Math.min(M[1],j.y),M[2]=Math.max(M[2],j.x),M[3]=Math.max(M[3],j.y)}v!==0&&(M[0]-=v,M[1]-=v,M[2]+=v,M[3]+=v),M[0]<Dt&&M[1]<Dt&&M[2]>=0&&M[3]>=0&&E.insert(w,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new OP(new lv(this.rawTileData)).layers,this.sourceLayerCoder=new xN(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o,u,h){this.loadVTLayers();const p=n.params||{},m=yc(p.filter),v=n.tileResult,w=n.transform,E=v.bufferedTilespaceBounds,C=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(j,V,$,ee)=>UL(v.bufferedTilespaceGeometry,j,V,$,ee));C.sort(zQ);let P=null;w.elevation&&C.length>0&&(P=t_.create(w.elevation,this.tileID));const M={};let z;for(let j=0;j<C.length;j++){const V=C[j];if(V===z)continue;z=V;const $=this.featureIndexArray.get(V);let ee=null;if(this.is3DTile){const pe=this.bucketLayerIDs[0][0],fe=o[pe];if(fe.type!=="model")continue;const{queryFeature:me,intersectionZ:Ce}=fe.queryIntersectsMatchingFeature(v,$.featureIndex,m,w);me&&this.appendToResult(M,pe,$.featureIndex,me,Ce)}else this.loadMatchingFeature(M,$,m,p.layers,p.availableImages,o,u,h,(pe,fe,me,Ce=0)=>(ee||(ee=bc(pe,this.tileID.canonical,n.tileTransform)),fe.queryIntersectsFeature(v,pe,me,ee,this.z,n.transform,n.pixelPosMatrix,P,Ce)))}return M}loadMatchingFeature(n,o,u,h,p,m,v,w,E){const{featureIndex:C,bucketIndex:P,sourceLayerIndex:M,layoutVertexArrayOffset:z}=o,j=this.bucketLayerIDs[P];if(h&&!function(pe,fe){for(let me=0;me<pe.length;me++)if(fe.indexOf(pe[me])>=0)return!0;return!1}(h,j))return;const V=this.sourceLayerCoder.decode(M),$=this.vtLayers[V].feature(C);if(u.needGeometry){const pe=yh($,!0);if(!u.filter(new In(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!u.filter(new In(this.tileID.overscaledZ),$))return;const ee=this.getId($,V);for(let pe=0;pe<j.length;pe++){const fe=j[pe];if(h&&h.indexOf(fe)<0)continue;const me=m[fe];if(!me)continue;let Ce={};ee!==void 0&&w&&(Ce=w.getState(me.sourceLayer||"_geojsonTileLayer",ee));const Ae=!E||E($,me,Ce,z);if(!Ae)continue;const Le=new IN($,this.z,this.x,this.y,ee),$e=Is({},v[fe]);$e.paint=AN($e.paint,me.paint,$,Ce,p),$e.layout=AN($e.layout,me.layout,$,Ce,p),Le.layer=$e,this.appendToResult(n,fe,C,Le,Ae)}}appendToResult(n,o,u,h,p){let m=n[o];m===void 0&&(m=n[o]=[]),m.push({featureIndex:u,feature:h,intersectionZ:p})}lookupSymbolFeatures(n,o,u,h,p,m,v,w){const E={};this.loadVTLayers();const C=yc(p);for(const P of n)this.loadMatchingFeature(E,{bucketIndex:u,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},C,m,v,w,o);return E}loadFeature(n){const{featureIndex:o,sourceLayerIndex:u}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),p=this.vtFeatures[h];if(p[o])return p[o];const m=this.vtLayers[h].feature(o);return p[o]=m,m}hasLayer(n){for(const o of this.bucketLayerIDs)for(const u of o)if(n===u)return!0;return!1}getId(n,o){let u=n.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];h!=null&&(u=n.properties[h]),typeof u=="boolean"&&(u=Number(u))}return u}}function AN(i,n,o,u,h){return eu(i,(p,m)=>{const v=n instanceof Ws?n.get(m):null;return v&&v.evaluate?v.evaluate(o,u,h):v})}function zQ(i,n){return n-i}Ve(CN,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var oo=24;const wc=128;function BP(i,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new In(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:h}=o;let p=0;for(;p<u.length&&u[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<u.length&&u[m]<i+1;)m++;m=Math.min(u.length-1,m);const v=u[p],w=u[m];return o.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:o.evaluate(new In(v)),maxSize:o.evaluate(new In(w)),interpolationType:h}}}function Vw(i,{uSize:n,uSizeT:o},{lowerSize:u,upperSize:h}){return i.kind==="source"?u/wc:i.kind==="composite"?xn(u/wc,h/wc,o):n}function i_(i,n){let o=0,u=0;if(i.kind==="constant")u=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:m}=i,v=h?Wn(ha.interpolationFactor(h,n,p,m),0,1):0;i.kind==="camera"?u=xn(i.minSize,i.maxSize,v):o=v}return{uSizeT:o,uSize:u}}var NQ=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:wc,evaluateSizeForFeature:Vw,evaluateSizeForZoom:i_,getSizeData:BP});function FQ(i,n,o){return i.sections.forEach(u=>{u.text=function(h,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),tr.applyArabicShaping&&(h=tr.applyArabicShaping(h)),h}(u.text,n,o)}),i}const cv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function BQ(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function jQ(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}const jP=3;function UQ(i,n,o){n.glyphs=[],i===1&&o.readMessage(VQ,n)}function VQ(i,n,o){if(i===3){const{id:u,bitmap:h,width:p,height:m,left:v,top:w,advance:E}=o.readMessage($Q,{});n.glyphs.push({id:u,bitmap:new Bd({width:p+2*jP,height:m+2*jP},h),metrics:{width:p,height:m,left:v,top:w,advance:E}})}else i===4?n.ascender=o.readSVarint():i===5&&(n.descender=o.readSVarint())}function $Q(i,n,o){i===1?n.id=o.readVarint():i===2?n.bitmap=o.readBytes():i===3?n.width=o.readVarint():i===4?n.height=o.readVarint():i===5?n.left=o.readSVarint():i===6?n.top=o.readSVarint():i===7&&(n.advance=o.readVarint())}const PN=jP,el={horizontal:1,vertical:2,horizontalOnly:3};class uv{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,o){const u=new uv;return u.scale=n||1,u.fontStack=o,u}static forImage(n){const o=new uv;return o.imageName=n,o}}class s_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){const u=new s_;for(let h=0;h<n.sections.length;h++){const p=n.sections[h];p.image?u.addImageSection(p):u.addTextSection(p,o)}return u}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(o,u){let h="";for(let p=0;p<o.length;p++){const m=o.charCodeAt(p+1)||null,v=o.charCodeAt(p-1)||null;h+=!u&&(m&&rn(m)&&!cv[o[p+1]]||v&&rn(v)&&!cv[o[p-1]])||!cv[o[p]]?o[p]:cv[o[p]]}return h}(this.text,n)}trim(){let n=0;for(let u=0;u<this.text.length&&$w[this.text.charCodeAt(u)];u++)n++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&$w[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const u=new s_;return u.text=this.text.substring(n,o),u.sectionIndex=this.sectionIndex.slice(n,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(uv.forText(n.scale,n.fontStack||o));const u=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(u)}addImageSection(n){const o=n.image?n.image.namePrimary:"";if(o.length===0)return void bi("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(uv.forImage(o)),this.sectionIndex.push(this.sections.length-1)):bi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function UP(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j){const V=s_.fromFeature(i,h);P===el.vertical&&V.verticalizePunctuation(M);let $=[];const ee=function(Ae,Le,$e,Ze,nt,Ke){if(!Ae)return[];const at=[],bt=function(gt,Pt,ct,Nt,Ct,Tt){let _n=0;for(let un=0;un<gt.length();un++){const Kt=gt.getSection(un);_n+=RN(gt.getCodePoint(un),Kt,Nt,Ct,Pt,Tt)}return _n/Math.max(1,Math.ceil(_n/ct))}(Ae,Le,$e,Ze,nt,Ke),lt=Ae.text.indexOf("")>=0;let St=0;for(let gt=0;gt<Ae.length();gt++){const Pt=Ae.getSection(gt),ct=Ae.getCodePoint(gt);if($w[ct]||(St+=RN(ct,Pt,Ze,nt,Le,Ke)),gt<Ae.length()-1){const Nt=!((ot=ct)<11904||!(Be["Bopomofo Extended"](ot)||Be.Bopomofo(ot)||Be["CJK Compatibility Forms"](ot)||Be["CJK Compatibility Ideographs"](ot)||Be["CJK Compatibility"](ot)||Be["CJK Radicals Supplement"](ot)||Be["CJK Strokes"](ot)||Be["CJK Symbols and Punctuation"](ot)||Be["CJK Unified Ideographs Extension A"](ot)||Be["CJK Unified Ideographs"](ot)||Be["Enclosed CJK Letters and Months"](ot)||Be["Halfwidth and Fullwidth Forms"](ot)||Be.Hiragana(ot)||Be["Ideographic Description Characters"](ot)||Be["Kangxi Radicals"](ot)||Be["Katakana Phonetic Extensions"](ot)||Be.Katakana(ot)||Be["Vertical Forms"](ot)||Be["Yi Radicals"](ot)||Be["Yi Syllables"](ot)));(qQ[ct]||Nt||Pt.imageName)&&at.push(kN(gt+1,St,bt,at,GQ(ct,Ae.getCodePoint(gt+1),Nt&&lt),!1))}}var ot;return DN(kN(Ae.length(),St,bt,at,0,!0))}(V,E,p,n,u,z),{processBidirectionalText:pe,processStyledBidirectionalText:fe}=tr;if(pe&&V.sections.length===1){const Ae=pe(V.toString(),ee);for(const Le of Ae){const $e=new s_;$e.text=Le,$e.sections=V.sections;for(let Ze=0;Ze<Le.length;Ze++)$e.sectionIndex.push(0);$.push($e)}}else if(fe){const Ae=fe(V.text,V.sectionIndex,ee);for(const Le of Ae){const $e=new s_;$e.text=Le[0],$e.sectionIndex=Le[1],$e.sections=V.sections,$.push($e)}}else $=function(Ae,Le){const $e=[],Ze=Ae.text;let nt=0;for(const Ke of Le)$e.push(Ae.substring(nt,Ke)),nt=Ke;return nt<Ze.length&&$e.push(Ae.substring(nt,Ze.length)),$e}(V,ee);const me=[],Ce={positionedLines:me,text:V.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ae,Le,$e,Ze,nt,Ke,at,bt,lt,St,ot,gt){let Pt=0,ct=0,Nt=0;const Ct=bt==="right"?1:bt==="left"?0:.5;let Tt=!1;for(const fn of nt){const sn=fn.getSections();for(const Dn of sn){if(Dn.imageName)continue;const zn=Le[Dn.fontStack];if(zn&&(Tt=zn.ascender!==void 0&&zn.descender!==void 0,!Tt))break}if(!Tt)break}let _n=0;for(const fn of nt){fn.trim();const sn=fn.getMaxScale(),Dn=(sn-1)*oo,zn={positionedGlyphs:[],lineOffset:0};Ae.positionedLines[_n]=zn;const On=zn.positionedGlyphs;let Gn=0;if(!fn.length()){ct+=Ke,++_n;continue}let mr=0,sr=0;for(let $r=0;$r<fn.length();$r++){const Nn=fn.getSection($r),Rr=fn.getSectionIndex($r),Dr=fn.getCodePoint($r);let Jr=Nn.scale,Di=null,Hi=null,Oi=null,wi=oo,Bs=0;const cs=!(lt===el.horizontal||!ot&&!Vt(Dr)||ot&&($w[Dr]||(un=Dr,Be.Arabic(un)||Be["Arabic Supplement"](un)||Be["Arabic Extended-A"](un)||Be["Arabic Presentation Forms-A"](un)||Be["Arabic Presentation Forms-B"](un))));if(Nn.imageName){const ao=Ze[Nn.imageName];if(!ao)continue;Oi=Nn.imageName,Ae.iconsInText=Ae.iconsInText||!0,Hi=ao.paddedRect;const Kr=ao.displaySize;Jr=Jr*oo/gt,Di={width:Kr[0],height:Kr[1],left:0,top:-PN,advance:cs?Kr[1]:Kr[0],localGlyph:!1},Bs=Tt?-Di.height*Jr:sn*oo-17-Kr[1]*Jr,wi=Di.advance;const pa=(cs?Kr[0]:Kr[1])*Jr-oo*sn;pa>0&&pa>Gn&&(Gn=pa)}else{const ao=$e[Nn.fontStack];if(!ao)continue;ao[Dr]&&(Hi=ao[Dr]);const Kr=Le[Nn.fontStack];if(!Kr)continue;const pa=Kr.glyphs[Dr];if(!pa)continue;if(Di=pa.metrics,wi=Dr!==8203?oo:0,Tt){const Ac=Kr.ascender!==void 0?Math.abs(Kr.ascender):0,Ol=Kr.descender!==void 0?Math.abs(Kr.descender):0,Ll=(Ac+Ol)*Jr;mr<Ll&&(mr=Ll,sr=(Ac-Ol)/2*Jr),Bs=-Ac*Jr}else Bs=(sn-Jr)*oo-17}cs?(Ae.verticalizable=!0,On.push({glyph:Dr,imageName:Oi,x:Pt,y:ct+Bs,vertical:cs,scale:Jr,localGlyph:Di.localGlyph,fontStack:Nn.fontStack,sectionIndex:Rr,metrics:Di,rect:Hi}),Pt+=wi*Jr+St):(On.push({glyph:Dr,imageName:Oi,x:Pt,y:ct+Bs,vertical:cs,scale:Jr,localGlyph:Di.localGlyph,fontStack:Nn.fontStack,sectionIndex:Rr,metrics:Di,rect:Hi}),Pt+=Di.advance*Jr+St)}On.length!==0&&(Nt=Math.max(Pt-St,Nt),Tt?ON(On,Ct,Gn,sr,Ke*sn/2):ON(On,Ct,Gn,0,Ke/2)),Pt=0;const Br=Ke*sn+Gn;zn.lineOffset=Math.max(Gn,Dn),ct+=Br,++_n}var un;const Kt=ct,{horizontalAlign:Ot,verticalAlign:En}=VP(at);(function(fn,sn,Dn,zn,On,Gn){const mr=(sn-Dn)*On,sr=-Gn*zn;for(const Br of fn)for(const $r of Br.positionedGlyphs)$r.x+=mr,$r.y+=sr})(Ae.positionedLines,Ct,Ot,En,Nt,Kt),Ae.top+=-En*Kt,Ae.bottom=Ae.top+Kt,Ae.left+=-Ot*Nt,Ae.right=Ae.left+Nt,Ae.hasBaseline=Tt}(Ce,n,o,u,$,m,v,w,P,E,M,j),!function(Ae){for(const Le of Ae)if(Le.positionedGlyphs.length!==0)return!1;return!0}(me)&&Ce}const $w={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qQ={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function RN(i,n,o,u,h,p){if(n.imageName){const m=u[n.imageName];return m?m.displaySize[0]*n.scale*oo/p+h:0}{const m=o[n.fontStack],v=m&&m.glyphs[i];return v?v.metrics.advance*n.scale+h:0}}function MN(i,n,o,u){const h=Math.pow(i-n,2);return u?i<n?h/2:2*h:h+Math.abs(o)*o}function GQ(i,n,o){let u=0;return i===10&&(u-=1e4),o&&(u+=150),i!==40&&i!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function kN(i,n,o,u,h,p){let m=null,v=MN(n,o,h,p);for(const w of u){const E=MN(n-w.x,o,h,p)+w.badness;E<=v&&(m=w,v=E)}return{index:i,x:n,priorBreak:m,badness:v}}function DN(i){return i?DN(i.priorBreak).concat(i.index):[]}function VP(i){let n=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function ON(i,n,o,u,h){if(!(n||o||u||h))return;const p=i.length-1,m=i[p],v=(m.x+m.metrics.advance*m.scale)*n;for(let w=0;w<=p;w++)i[w].x-=v,i[w].y+=o+u+h}function WQ(i,n,o,u){const{horizontalAlign:h,verticalAlign:p}=VP(u),m=o[0]-i.displaySize[0]*h,v=o[1]-i.displaySize[1]*p;return{imagePrimary:i,imageSecondary:n,top:v,bottom:v+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function LN(i,n,o,u,h,p){const m=i.imagePrimary;let v;if(m.content){const $=m.content,ee=m.pixelRatio||1;v=[$[0]/ee,$[1]/ee,m.displaySize[0]-$[2]/ee,m.displaySize[1]-$[3]/ee]}const w=n.left*p,E=n.right*p;let C,P,M,z;o==="width"||o==="both"?(z=h[0]+w-u[3],P=h[0]+E+u[1]):(z=h[0]+(w+E-m.displaySize[0])/2,P=z+m.displaySize[0]);const j=n.top*p,V=n.bottom*p;return o==="height"||o==="both"?(C=h[1]+j-u[0],M=h[1]+V+u[2]):(C=h[1]+(j+V-m.displaySize[1])/2,M=C+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:C,right:P,bottom:M,left:z,collisionPadding:v}}class wh extends Lt{constructor(n,o,u,h,p){super(n,o),this.angle=h,this.z=u,p!==void 0&&(this.segment=p)}clone(){return new wh(this.x,this.y,this.z,this.angle,this.segment)}}function zN(i,n,o,u,h){if(n.segment===void 0)return!0;let p=n,m=n.segment+1,v=0;for(;v>-o/2;){if(m--,m<0)return!1;v-=i[m].dist(p),p=i[m]}v+=i[m].dist(i[m+1]),m++;const w=[];let E=0;for(;v<o/2;){const C=i[m],P=i[m+1];if(!P)return!1;let M=i[m-1].angleTo(C)-C.angleTo(P);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:M}),E+=M;v-w[0].distance>u;)E-=w.shift().angleDelta;if(E>h)return!1;m++,v+=C.dist(P)}return!0}function NN(i){let n=0;for(let o=0;o<i.length-1;o++)n+=i[o].dist(i[o+1]);return n}function FN(i,n,o){return i?.6*n*o:0}function BN(i,n){return Math.max(i?i.right-i.left:0,n?n.right-n.left:0)}function HQ(i,n,o,u,h,p){const m=FN(o,h,p),v=BN(o,u)*p;let w=0;const E=NN(i)/2;for(let C=0;C<i.length-1;C++){const P=i[C],M=i[C+1],z=P.dist(M);if(w+z>E){const j=(E-w)/z,V=xn(P.x,M.x,j),$=xn(P.y,M.y,j),ee=new wh(V,$,0,M.angleTo(P),C);return!m||zN(i,ee,v,m,n)?ee:void 0}w+=z}}function ZQ(i,n,o,u,h,p,m,v,w){const E=FN(u,p,m),C=BN(u,h),P=C*m,M=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return n-P<n/4&&(n=P+n/4),jN(i,M?n/2*v%n:(C/2+2*p)*m*v%n,n,E,o,P,M,!1,w)}function jN(i,n,o,u,h,p,m,v,w){const E=p/2,C=NN(i);let P=0,M=n-o,z=[];for(let j=0;j<i.length-1;j++){const V=i[j],$=i[j+1],ee=V.dist($),pe=$.angleTo(V);for(;M+o<P+ee;){M+=o;const fe=(M-P)/ee,me=xn(V.x,$.x,fe),Ce=xn(V.y,$.y,fe);if(me>=0&&me<w&&Ce>=0&&Ce<w&&M-E>=0&&M+E<=C){const Ae=new wh(me,Ce,0,pe,j);u&&!zN(i,Ae,p,u,h)||z.push(Ae)}}P+=ee}return v||z.length||m||(z=jN(i,P/2,o,u,h,p,m,!0,w)),z}function UN(i,n,o,u,h){const p=[];for(let m=0;m<i.length;m++){const v=i[m];let w;for(let E=0;E<v.length-1;E++){let C=v[E],P=v[E+1];C.x<n&&P.x<n||(C.x<n?C=new Lt(n,C.y+(n-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<n&&(P=new Lt(n,C.y+(n-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<o&&P.y<o||(C.y<o?C=new Lt(C.x+(o-C.y)/(P.y-C.y)*(P.x-C.x),o)._round():P.y<o&&(P=new Lt(C.x+(o-C.y)/(P.y-C.y)*(P.x-C.x),o)._round()),C.x>=u&&P.x>=u||(C.x>=u?C=new Lt(u,C.y+(u-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=u&&(P=new Lt(u,C.y+(u-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=h&&P.y>=h||(C.y>=h?C=new Lt(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round():P.y>=h&&(P=new Lt(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round()),w&&C.equals(w[w.length-1])||(w=[C],p.push(w)),w.push(P)))))}}return p}function VN(i){let n=0,o=0;for(const m of i)n+=m.w*m.h,o=Math.max(o,m.w);i.sort((m,v)=>v.h-m.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let h=0,p=0;for(const m of i)for(let v=u.length-1;v>=0;v--){const w=u[v];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,p=Math.max(p,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===w.w&&m.h===w.h){const E=u.pop();v<u.length&&(u[v]=E)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(u.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:h,h:p,fill:n/(h*p)||0}}Ve(wh,"Anchor");const Aa=1;class $P{constructor(n,{pixelRatio:o,version:u,stretchX:h,stretchY:p,content:m}){this.paddedRect=n,this.pixelRatio=o,this.stretchX=h,this.stretchY=p,this.content=m,this.version=u}get tl(){return[this.paddedRect.x+Aa,this.paddedRect.y+Aa]}get br(){return[this.paddedRect.x+this.paddedRect.w-Aa,this.paddedRect.y+this.paddedRect.h-Aa]}get displaySize(){return[(this.paddedRect.w-2*Aa)/this.pixelRatio,(this.paddedRect.h-2*Aa)/this.pixelRatio]}}class $N{constructor(n,o,u){const h={},p={};this.haveRenderCallbacks=[];const m=[];this.addImages(n,h,m),this.addImages(o,p,m);const{w:v,h:w}=VN(m),E=new Ja({width:v||1,height:w||1});for(const C in n){const P=n[C],M=h[C].paddedRect;Ja.copy(P.data,E,{x:0,y:0},{x:M.x+Aa,y:M.y+Aa},P.data,u,P.sdf)}for(const C in o){const P=o[C],M=p[C].paddedRect,z=M.x+Aa,j=M.y+Aa,V=P.data.width,$=P.data.height;Ja.copy(P.data,E,{x:0,y:0},{x:z,y:j},P.data,u),Ja.copy(P.data,E,{x:0,y:$-1},{x:z,y:j-1},{width:V,height:1},u),Ja.copy(P.data,E,{x:0,y:0},{x:z,y:j+$},{width:V,height:1},u),Ja.copy(P.data,E,{x:V-1,y:0},{x:z-1,y:j},{width:1,height:$},u),Ja.copy(P.data,E,{x:0,y:0},{x:z+V,y:j},{width:1,height:$},u)}this.image=E,this.iconPositions=h,this.patternPositions=p}addImages(n,o,u){for(const h in n){const p=n[h],m={x:0,y:0,w:p.data.width+2*Aa,h:p.data.height+2*Aa};u.push(m),o[h]=new $P(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>n.hasImage(h,u)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h in n.getUpdatedImages(u))this.patchUpdatedImage(this.iconPositions[h],n.getImage(h,u),o),this.patchUpdatedImage(this.patternPositions[h],n.getImage(h,u),o)}patchUpdatedImage(n,o,u){if(!n||!o||n.version===o.version)return;n.version=o.version;const[h,p]=n.tl,m=!!Object.keys(this.patternPositions).length;u.update(o.data,{useMipmap:m},{x:h,y:p})}}Ve($P,"ImagePosition"),Ve($N,"ImageAtlas");const hv=1e20;function qN(i,n,o,u,h,p,m,v,w){for(let E=n;E<n+u;E++)GN(i,o*p+E,p,h,m,v,w);for(let E=o;E<o+h;E++)GN(i,E*p+n,1,u,m,v,w)}function GN(i,n,o,u,h,p,m){p[0]=0,m[0]=-hv,m[1]=hv,h[0]=i[n];for(let v=1,w=0,E=0;v<u;v++){h[v]=i[n+v*o];const C=v*v;do{const P=p[w];E=(h[v]-h[P]+C-P*P)/(v-P)/2}while(E<=m[w]&&--w>-1);w++,p[w]=v,m[w]=E,m[w+1]=hv}for(let v=0,w=0;v<u;v++){for(;m[w+1]<v;)w++;const E=p[w],C=v-E;i[n+v*o]=h[E]+C*C}}const Tc=2,qP={none:0,ideographs:1,all:2};class o_{constructor(n,o,u){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,o){this.urls[o]=n}getGlyphs(n,o,u){const h=[],p=this.urls[o]||O.GLYPHS_URL;for(const m in n)for(const v of n[m])h.push({stack:m,id:v});eh(h,({stack:m,id:v},w)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=E.glyphs[v];if(C!==void 0)return void w(null,{stack:m,id:v,glyph:C});if(C=this._tinySDF(E,m,v),C)return E.glyphs[v]=C,void w(null,{stack:m,id:v,glyph:C});const P=Math.floor(v/256);if(256*P>65535)return void w(new Error("glyphs > 65535 not supported"));if(E.ranges[P])return void w(null,{stack:m,id:v,glyph:C});let M=E.requests[P];M||(M=E.requests[P]=[],o_.loadGlyphRange(m,P,p,this.requestManager,(z,j)=>{if(j){E.ascender=j.ascender,E.descender=j.descender;for(const V in j.glyphs)this._doesCharSupportLocalGlyph(+V)||(E.glyphs[+V]=j.glyphs[+V]);E.ranges[P]=!0}for(const V of M)V(z,j);delete E.requests[P]})),M.push((z,j)=>{z?w(z):j&&w(null,{stack:m,id:v,glyph:j.glyphs[v]||null})})},(m,v)=>{if(m)u(m);else if(v){const w={};for(const{stack:E,id:C,glyph:P}of v)w[E]===void 0&&(w[E]={}),w[E].glyphs===void 0&&(w[E].glyphs={}),w[E].glyphs[C]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},w[E].ascender=this.entries[E].ascender,w[E].descender=this.entries[E].descender;u(null,w)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==qP.none&&(this.localGlyphMode===qP.all?!!this.localFontFamily:!!this.localFontFamily&&(Be["CJK Unified Ideographs"](n)||Be["Hangul Syllables"](n)||Be.Hiragana(n)||Be.Katakana(n)||Be["CJK Symbols and Punctuation"](n)||Be["CJK Unified Ideographs Extension A"](n)||Be["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,o,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let p=n.tinySDF;if(!p){let V="400";/bold/i.test(o)?V="900":/medium/i.test(o)?V="500":/light/i.test(o)&&(V="200"),p=n.tinySDF=new o_.TinySDF({fontFamily:h,fontWeight:V,fontSize:24*Tc,buffer:3*Tc,radius:8*Tc}),p.fontWeight=V}if(this.localGlyphs[p.fontWeight][u])return this.localGlyphs[p.fontWeight][u];const m=String.fromCodePoint(u),{data:v,width:w,height:E,glyphWidth:C,glyphHeight:P,glyphLeft:M,glyphTop:z,glyphAdvance:j}=p.draw(m);return this.localGlyphs[p.fontWeight][u]={id:u,bitmap:new Bd({width:w,height:E},v),metrics:{width:C/Tc,height:P/Tc,left:M/Tc,top:z/Tc-27,advance:j/Tc,localGlyph:!0}}}}o_.loadGlyphRange=function(i,n,o,u,h){const p=256*n,m=p+255,v=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",`${p}-${m}`),sp.Glyphs);nh(v,(w,E)=>{if(w)h(w);else if(E){const C={},P=function(M){return new lv(M).readFields(UQ,{})}(E);for(const M of P.glyphs)C[M.id]=M;h(null,{glyphs:C,ascender:P.ascender,descender:P.descender})}})},o_.TinySDF=class{constructor({fontSize:i=24,buffer:n=3,radius:o=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=n,this.cutoff=u,this.radius=o;const v=this.size=i+4*n,w=this._createCanvas(v),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${p} ${i}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const n=document.createElement("canvas");return n.width=n.height=i,n}draw(i){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(i),m=Math.ceil(o),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),w=Math.min(this.size-this.buffer,m+Math.ceil(u)),E=v+2*this.buffer,C=w+2*this.buffer,P=Math.max(E*C,0),M=new Uint8ClampedArray(P),z={data:M,width:E,height:C,glyphWidth:v,glyphHeight:w,glyphTop:m,glyphLeft:0,glyphAdvance:n};if(v===0||w===0)return z;const{ctx:j,buffer:V,gridInner:$,gridOuter:ee}=this;j.clearRect(V,V,v,w),j.fillText(i,V,V+m);const pe=j.getImageData(V,V,v,w);ee.fill(hv,0,P),$.fill(0,0,P);for(let fe=0;fe<w;fe++)for(let me=0;me<v;me++){const Ce=pe.data[4*(fe*v+me)+3]/255;if(Ce===0)continue;const Ae=(fe+V)*E+me+V;if(Ce===1)ee[Ae]=0,$[Ae]=hv;else{const Le=.5-Ce;ee[Ae]=Le>0?Le*Le:0,$[Ae]=Le<0?Le*Le:0}}qN(ee,0,0,E,C,E,this.f,this.v,this.z),qN($,V,V,v,w,E,this.f,this.v,this.z);for(let fe=0;fe<P;fe++){const me=Math.sqrt(ee[fe])-Math.sqrt($[fe]);M[fe]=Math.round(255-255*(me/this.radius+this.cutoff))}return z}};const Vd=Aa;function WN(i,n,o,u){const h=[],p=i.imagePrimary,m=p.pixelRatio,v=p.paddedRect.w-2*Vd,w=p.paddedRect.h-2*Vd,E=i.right-i.left,C=i.bottom-i.top,P=p.stretchX||[[0,v]],M=p.stretchY||[[0,w]],z=(Ke,at)=>Ke+at[1]-at[0],j=P.reduce(z,0),V=M.reduce(z,0),$=v-j,ee=w-V;let pe=0,fe=j,me=0,Ce=V,Ae=0,Le=$,$e=0,Ze=ee;if(p.content&&u){const Ke=p.content;pe=qw(P,0,Ke[0]),me=qw(M,0,Ke[1]),fe=qw(P,Ke[0],Ke[2]),Ce=qw(M,Ke[1],Ke[3]),Ae=Ke[0]-pe,$e=Ke[1]-me,Le=Ke[2]-Ke[0]-fe,Ze=Ke[3]-Ke[1]-Ce}const nt=(Ke,at,bt,lt)=>{const St=Gw(Ke.stretch-pe,fe,E,i.left),ot=Ww(Ke.fixed-Ae,Le,Ke.stretch,j),gt=Gw(at.stretch-me,Ce,C,i.top),Pt=Ww(at.fixed-$e,Ze,at.stretch,V),ct=Gw(bt.stretch-pe,fe,E,i.left),Nt=Ww(bt.fixed-Ae,Le,bt.stretch,j),Ct=Gw(lt.stretch-me,Ce,C,i.top),Tt=Ww(lt.fixed-$e,Ze,lt.stretch,V),_n=new Lt(St,gt),un=new Lt(ct,gt),Kt=new Lt(ct,Ct),Ot=new Lt(St,Ct),En=new Lt(ot/m,Pt/m),fn=new Lt(Nt/m,Tt/m),sn=n*Math.PI/180;if(sn){const sr=Math.sin(sn),Br=Math.cos(sn),$r=[Br,-sr,sr,Br];_n._matMult($r),un._matMult($r),Ot._matMult($r),Kt._matMult($r)}const Dn=Ke.stretch+Ke.fixed,zn=bt.stretch+bt.fixed,On=at.stretch+at.fixed,Gn=lt.stretch+lt.fixed,mr=i.imageSecondary;return{tl:_n,tr:un,bl:Ot,br:Kt,texPrimary:{x:p.paddedRect.x+Vd+Dn,y:p.paddedRect.y+Vd+On,w:zn-Dn,h:Gn-On},texSecondary:mr?{x:mr.paddedRect.x+Vd+Dn,y:mr.paddedRect.y+Vd+On,w:zn-Dn,h:Gn-On}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:En,pixelOffsetBR:fn,minFontScaleX:Le/m/E,minFontScaleY:Ze/m/C,isSDF:o}};if(u&&(p.stretchX||p.stretchY)){const Ke=HN(P,$,j),at=HN(M,ee,V);for(let bt=0;bt<Ke.length-1;bt++){const lt=Ke[bt],St=Ke[bt+1];for(let ot=0;ot<at.length-1;ot++)h.push(nt(lt,at[ot],St,at[ot+1]))}}else h.push(nt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function qw(i,n,o){let u=0;for(const h of i)u+=Math.max(n,Math.min(o,h[1]))-Math.max(n,Math.min(o,h[0]));return u}function HN(i,n,o){const u=[{fixed:-Vd,stretch:0}];for(const[h,p]of i){const m=u[u.length-1];u.push({fixed:h-m.stretch,stretch:m.stretch}),u.push({fixed:h-m.stretch,stretch:m.stretch+(p-h)})}return u.push({fixed:n+Vd,stretch:o}),u}function Gw(i,n,o,u){return i/n*o+u}function Ww(i,n,o,u){return i-n*o/u}function XQ(i,n,o,u){const h=n+i.positionedLines[u].lineOffset;return u===0?o+h/2:o+(h+(n+i.positionedLines[u-1].lineOffset))/2}function KQ(i,n=1,o=!1){let u=1/0,h=1/0,p=-1/0,m=-1/0;const v=i[0];for(let z=0;z<v.length;z++){const j=v[z];(!z||j.x<u)&&(u=j.x),(!z||j.y<h)&&(h=j.y),(!z||j.x>p)&&(p=j.x),(!z||j.y>m)&&(m=j.y)}const w=Math.min(p-u,m-h);let E=w/2;const C=new au([],QQ);if(w===0)return new Lt(u,h);for(let z=u;z<p;z+=w)for(let j=h;j<m;j+=w)C.push(new a_(z+E,j+E,E,i));let P=function(z){let j=0,V=0,$=0;const ee=z[0];for(let pe=0,fe=ee.length,me=fe-1;pe<fe;me=pe++){const Ce=ee[pe],Ae=ee[me],Le=Ce.x*Ae.y-Ae.x*Ce.y;V+=(Ce.x+Ae.x)*Le,$+=(Ce.y+Ae.y)*Le,j+=3*Le}return new a_(V/j,$/j,0,z)}(i),M=C.length;for(;C.length;){const z=C.pop();(z.d>P.d||!P.d)&&(P=z,o&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,M)),z.max-P.d<=n||(E=z.h/2,C.push(new a_(z.p.x-E,z.p.y-E,E,i)),C.push(new a_(z.p.x+E,z.p.y-E,E,i)),C.push(new a_(z.p.x-E,z.p.y+E,E,i)),C.push(new a_(z.p.x+E,z.p.y+E,E,i)),M+=4)}return o&&(console.log(`num probes: ${M}`),console.log(`best distance: ${P.d}`)),P.p}function QQ(i,n){return n.max-i.max}class a_{constructor(n,o,u,h){this.p=new Lt(n,o),this.h=u,this.d=function(p,m){let v=!1,w=1/0;for(let E=0;E<m.length;E++){const C=m[E];for(let P=0,M=C.length,z=M-1;P<M;z=P++){const j=C[P],V=C[z];j.y>p.y!=V.y>p.y&&p.x<(V.x-j.x)*(p.y-j.y)/(V.y-j.y)+j.x&&(v=!v),w=Math.min(w,BL(p,j,V))}}return(v?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const GP=Number.POSITIVE_INFINITY,YQ=Math.sqrt(2);function ZN(i,[n,o]){let u=0,h=0;if(o===GP){n<0&&(n=0);const p=n/YQ;switch(i){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-n;break;case"top":h=n-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=n;break;case"right":u=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),i){case"top-right":case"top-left":case"top":h=o-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-o}switch(i){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}}return[u,h]}function WP(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function JQ(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j){let V=p.textMaxSize.evaluate(n,{},P);V===void 0&&(V=m);const $=i.layers[0].layout,ee=$.get("icon-offset").evaluate(n,{},P),pe=KN(o.horizontal)||o.vertical,fe=M.name==="globe",me=oo,Ce=m/me,Ae=i.tilePixelRatio*V/me,Le=(St=i.overscaling,i.zoom>18&&St>2&&(St>>=1),Math.max(Dt/(512*St),1)*$.get("symbol-spacing")),$e=$.get("text-padding")*i.tilePixelRatio,Ze=$.get("icon-padding")*i.tilePixelRatio,nt=er($.get("text-max-angle")),Ke=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",at=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",bt=$.get("symbol-placement"),lt=Le/2;var St;const ot=$.get("icon-text-fit").evaluate(n,{},P),gt=$.get("icon-text-fit-padding").evaluate(n,{},P),Pt=ot!=="none";let ct;i.hasAnyIconTextFit===!1&&Pt&&(i.hasAnyIconTextFit=!0),u&&Pt&&(i.allowVerticalPlacement&&o.vertical&&(ct=LN(u,o.vertical,ot,gt,ee,Ce)),pe&&(u=LN(u,pe,ot,gt,ee,Ce)));const Nt=(Ct,Tt,_n)=>{if(Tt.x<0||Tt.x>=Dt||Tt.y<0||Tt.y>=Dt)return;let un=null;if(fe){const{x:Kt,y:Ot,z:En}=M.projectTilePoint(Tt.x,Tt.y,_n);un={anchor:new wh(Kt,Ot,En,0,void 0),up:M.upVector(_n,Tt.x,Tt.y)}}(function(Kt,Ot,En,fn,sn,Dn,zn,On,Gn,mr,sr,Br,$r,Nn,Rr,Dr,Jr,Di,Hi,Oi,wi,Bs,cs,ao,Kr,pa,Ac){const Ol=Kt.addToLineVertexArray(Ot,fn);let Ll,Hp,Zd,Zp,Mv,dB,fB,pB=0,mB=0,gB=0,_B=0,b3=-1,w3=-1;const _u={};let yB=yg("");const Xp=En?En.anchor:Ot,T3=Gn.layout.get("icon-text-fit").evaluate(wi,{},Kr)!=="none";let E3=0,S3=0;if(Gn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[E3,S3]=Gn.layout.get("text-offset").evaluate(wi,{},Kr).map(Ra=>Ra*oo):(E3=Gn.layout.get("text-radial-offset").evaluate(wi,{},Kr)*oo,S3=GP),Kt.allowVerticalPlacement&&sn.vertical){const Ra=sn.vertical;if(Rr)dB=HP(Ra),On&&(fB=HP(On));else{const Ma=Gn.layout.get("text-rotate").evaluate(wi,{},Kr)+90;Zd=Hw(mr,Xp,Ot,sr,Br,$r,Ra,Nn,Ma,Dr),On&&(Zp=Hw(mr,Xp,Ot,sr,Br,$r,On,Di,Ma))}}if(Dn){const Ra=Gn.layout.get("icon-rotate").evaluate(wi,{},Kr),Ma=WN(Dn,Ra,cs,T3),g_=On?WN(On,Ra,cs,T3):void 0;Hp=Hw(mr,Xp,Ot,sr,Br,$r,Dn,Di,Ra),pB=4*Ma.length;const vB=Kt.iconSizeData;let Kp=null;vB.kind==="source"?(Kp=[wc*Gn.layout.get("icon-size").evaluate(wi,{},Kr)],Kp[0]>$d&&bi(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${dv}. Reduce your "icon-size".`)):vB.kind==="composite"&&(Kp=[wc*Bs.compositeIconSizes[0].evaluate(wi,{},Kr),wc*Bs.compositeIconSizes[1].evaluate(wi,{},Kr)],(Kp[0]>$d||Kp[1]>$d)&&bi(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${dv}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,Ma,Kp,Oi,Hi,wi,!1,En,Ot,Ol.lineStartIndex,Ol.lineLength,-1,ao,Kr,pa,Ac),b3=Kt.icon.placedSymbolArray.length-1,g_&&(mB=4*g_.length,Kt.addSymbols(Kt.icon,g_,Kp,Oi,Hi,wi,el.vertical,En,Ot,Ol.lineStartIndex,Ol.lineLength,-1,ao,Kr,pa,Ac),w3=Kt.icon.placedSymbolArray.length-1)}for(const Ra in sn.horizontal){const Ma=sn.horizontal[Ra];Ll||(yB=yg(Ma.text),Rr?Mv=HP(Ma):Ll=Hw(mr,Xp,Ot,sr,Br,$r,Ma,Nn,Gn.layout.get("text-rotate").evaluate(wi,{},Kr),Dr));const g_=Ma.positionedLines.length===1;if(gB+=XN(Kt,En,Ot,Ma,zn,Gn,Rr,wi,Dr,Ol,sn.vertical?el.horizontal:el.horizontalOnly,g_?Object.keys(sn.horizontal):[Ra],_u,b3,Bs,ao,Kr,pa),g_)break}sn.vertical&&(_B+=XN(Kt,En,Ot,sn.vertical,zn,Gn,Rr,wi,Dr,Ol,el.vertical,["vertical"],_u,w3,Bs,ao,Kr,pa));let Xd=-1;const I3=(Ra,Ma)=>Ra?Math.max(Ra,Ma):Ma;Xd=I3(Mv,Xd),Xd=I3(dB,Xd),Xd=I3(fB,Xd);const fJ=Xd>-1?1:0;Kt.glyphOffsetArray.length>=65535&&bi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wi.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,wi.sortKey),Kt.symbolInstances.emplaceBack(Ot.x,Ot.y,Xp.x,Xp.y,Xp.z,_u.right>=0?_u.right:-1,_u.center>=0?_u.center:-1,_u.left>=0?_u.left:-1,_u.vertical>=0?_u.vertical:-1,b3,w3,yB,Ll!==void 0?Ll:Kt.collisionBoxArray.length,Ll!==void 0?Ll+1:Kt.collisionBoxArray.length,Zd!==void 0?Zd:Kt.collisionBoxArray.length,Zd!==void 0?Zd+1:Kt.collisionBoxArray.length,Hp!==void 0?Hp:Kt.collisionBoxArray.length,Hp!==void 0?Hp+1:Kt.collisionBoxArray.length,Zp||Kt.collisionBoxArray.length,Zp?Zp+1:Kt.collisionBoxArray.length,sr,gB,_B,pB,mB,fJ,0,E3,S3,Xd,0,T3?1:0)})(i,Tt,un,Ct,o,u,h,ct,i.layers[0],i.collisionBoxArray,n.index,n.sourceLayerIndex,i.index,$e,Ke,w,0,Ze,at,ee,n,p,E,C,P,z,j)};if(bt==="line")for(const Ct of UN(n.geometry,0,0,Dt,Dt)){const Tt=ZQ(Ct,Le,nt,o.vertical||pe,u,me,Ae,i.overscaling,Dt);for(const _n of Tt)pe&&eY(i,pe.text,lt,_n)||Nt(Ct,_n,P)}else if(bt==="line-center"){for(const Ct of n.geometry)if(Ct.length>1){const Tt=HQ(Ct,nt,o.vertical||pe,u,me,Ae);Tt&&Nt(Ct,Tt,P)}}else if(n.type==="Polygon")for(const Ct of Pw(n.geometry,0)){const Tt=KQ(Ct,16);Nt(Ct[0],new wh(Tt.x,Tt.y,0,0,void 0),P)}else if(n.type==="LineString")for(const Ct of n.geometry)Nt(Ct,new wh(Ct[0].x,Ct[0].y,0,0,void 0),P);else if(n.type==="Point")for(const Ct of n.geometry)for(const Tt of Ct)Nt([Tt],new wh(Tt.x,Tt.y,0,0,void 0),P)}const dv=255,$d=dv*wc;function XN(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,ee){const pe=function(Ce,Ae,Le,$e,Ze,nt,Ke,at){const bt=[];if(Ae.positionedLines.length===0)return bt;const lt=$e.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,St=function(Nt){const Ct=Nt[0],Tt=Nt[1],_n=Ct*Tt;return _n>0?[Ct,-Tt]:_n<0?[-Ct,Tt]:Ct===0?[Tt,Ct]:[Tt,-Ct]}(Le);let ot=Math.abs(Ae.top-Ae.bottom);for(const Nt of Ae.positionedLines)ot-=Nt.lineOffset;const gt=Ae.positionedLines.length,Pt=ot/gt;let ct=Ae.top-Le[1];for(let Nt=0;Nt<gt;++Nt){const Ct=Ae.positionedLines[Nt];ct=XQ(Ae,Pt,ct,Nt);for(const Tt of Ct.positionedGlyphs){if(!Tt.rect)continue;const _n=Tt.rect||{};let un=PN+1,Kt=!0,Ot=1,En=0;if(Tt.imageName){const Oi=Ke[Tt.imageName];if(!Oi)continue;if(Oi.sdf){bi("SDF images are not supported in formatted text and will be ignored.");continue}Kt=!1,Ot=Oi.pixelRatio,un=Aa/Ot}const fn=(Ze||at)&&Tt.vertical,sn=Tt.metrics.advance*Tt.scale/2,Dn=Tt.metrics,zn=Tt.rect;if(zn===null)continue;at&&Ae.verticalizable&&(En=Tt.imageName?sn-Tt.metrics.width*Tt.scale/2:0);const On=Ze?[Tt.x+sn,Tt.y]:[0,0];let Gn=[0,0],mr=[0,0],sr=!1;Ze||(fn?(mr=[Tt.x+sn+St[0],Tt.y+St[1]-En],sr=!0):Gn=[Tt.x+sn+Le[0],Tt.y+Le[1]-En]);const Br=zn.w*Tt.scale/(Ot*(Tt.localGlyph?Tc:1)),$r=zn.h*Tt.scale/(Ot*(Tt.localGlyph?Tc:1));let Nn,Rr,Dr,Jr;if(fn){const Oi=Tt.y-ct,wi=new Lt(-sn,sn-Oi),Bs=-Math.PI/2,cs=new Lt(...mr);Nn=new Lt(-sn+Gn[0],Gn[1]),Nn._rotateAround(Bs,wi)._add(cs),Nn.x+=-Oi+sn,Nn.y-=(Dn.left-un)*Tt.scale;const ao=Tt.imageName?Dn.advance*Tt.scale:oo*Tt.scale,Kr=String.fromCodePoint(Tt.glyph);BQ(Kr)?Nn.x+=(1-un)*Tt.scale:jQ(Kr)?Nn.x+=ao-Dn.height*Tt.scale+(-un-1)*Tt.scale:Nn.x+=Tt.imageName||Dn.width+2*un===zn.w&&Dn.height+2*un===zn.h?(ao-$r)/2:(ao-(Dn.height+2*un)*Tt.scale)/2,Rr=new Lt(Nn.x,Nn.y-Br),Dr=new Lt(Nn.x+$r,Nn.y),Jr=new Lt(Nn.x+$r,Nn.y-Br)}else{const Oi=(Dn.left-un)*Tt.scale-sn+Gn[0],wi=(-Dn.top-un)*Tt.scale+Gn[1],Bs=Oi+Br,cs=wi+$r;Nn=new Lt(Oi,wi),Rr=new Lt(Bs,wi),Dr=new Lt(Oi,cs),Jr=new Lt(Bs,cs)}if(lt){let Oi;Oi=Ze?new Lt(0,0):sr?new Lt(St[0],St[1]):new Lt(Le[0],Le[1]),Nn._rotateAround(lt,Oi),Rr._rotateAround(lt,Oi),Dr._rotateAround(lt,Oi),Jr._rotateAround(lt,Oi)}const Di=new Lt(0,0),Hi=new Lt(0,0);bt.push({tl:Nn,tr:Rr,bl:Dr,br:Jr,texPrimary:_n,texSecondary:void 0,writingMode:Ae.writingMode,glyphOffset:On,sectionIndex:Tt.sectionIndex,isSDF:Kt,pixelOffsetTL:Di,pixelOffsetBR:Hi,minFontScaleX:0,minFontScaleY:0})}}return bt}(0,u,w,p,m,v,h,i.allowVerticalPlacement),fe=i.textSizeData;let me=null;fe.kind==="source"?(me=[wc*p.layout.get("text-size").evaluate(v,{},$)],me[0]>$d&&bi(`${i.layerIds[0]}: Value for "text-size" is >= ${dv}. Reduce your "text-size".`)):fe.kind==="composite"&&(me=[wc*j.compositeTextSizes[0].evaluate(v,{},$),wc*j.compositeTextSizes[1].evaluate(v,{},$)],(me[0]>$d||me[1]>$d)&&bi(`${i.layerIds[0]}: Value for "text-size" is >= ${dv}. Reduce your "text-size".`)),i.addSymbols(i.text,pe,me,w,m,v,C,n,o,E.lineStartIndex,E.lineLength,z,V,$,ee,!1);for(const Ce of P)M[Ce]=i.text.placedSymbolArray.length-1;return 4*pe.length}function KN(i){for(const n in i)return i[n];return null}function Hw(i,n,o,u,h,p,m,v,w,E){let C=m.top,P=m.bottom,M=m.left,z=m.right;const j=m.collisionPadding;if(j&&(M-=j[0],C-=j[1],z+=j[2],P+=j[3]),w){const V=new Lt(M,C),$=new Lt(z,C),ee=new Lt(M,P),pe=new Lt(z,P),fe=er(w);let me=new Lt(0,0);E&&(me=new Lt(E[0],E[1])),V._rotateAround(fe,me),$._rotateAround(fe,me),ee._rotateAround(fe,me),pe._rotateAround(fe,me),M=Math.min(V.x,$.x,ee.x,pe.x),z=Math.max(V.x,$.x,ee.x,pe.x),C=Math.min(V.y,$.y,ee.y,pe.y),P=Math.max(V.y,$.y,ee.y,pe.y)}return i.emplaceBack(n.x,n.y,n.z,o.x,o.y,M,C,z,P,v,u,h,p),i.length-1}function HP(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const n=i.bottom-i.top;return n>0?Math.max(10,n):null}function eY(i,n,o,u){const h=i.compareText;if(n in h){const p=h[n];for(let m=p.length-1;m>=0;m--)if(u.dist(p[m])<o)return!0}else h[n]=[];return h[n].push(u),!1}function QN(i,n){const o=i.fovAboveCenter,u=i.elevation?i.elevation.getMinElevationBelowMSL()*n:0,h=(i._camera.position[2]*i.worldSize-u)/Math.cos(i._pitch),p=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-i._pitch-o,.01)),m=Math.sin(i._pitch)*p+h;return Math.min(1.01*m,h*(1/i._horizonShift))}function Up(i,n){if(!n.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:n};const o=Math.pow(2,-i.z),u=i.x*o,h=(i.x+1)*o,p=i.y*o,m=(i.y+1)*o,v=fa(u),w=fa(h),E=Hs(p),C=Hs(m),P=n.project(v,E),M=n.project(w,E),z=n.project(w,C),j=n.project(v,C);let V=Math.min(P.x,M.x,z.x,j.x),$=Math.min(P.y,M.y,z.y,j.y),ee=Math.max(P.x,M.x,z.x,j.x),pe=Math.max(P.y,M.y,z.y,j.y);const fe=o/16;function me(Ae,Le,$e,Ze,nt,Ke){const at=($e+nt)/2,bt=(Ze+Ke)/2,lt=n.project(fa(at),Hs(bt)),St=Math.max(0,V-lt.x,$-lt.y,lt.x-ee,lt.y-pe);V=Math.min(V,lt.x),ee=Math.max(ee,lt.x),$=Math.min($,lt.y),pe=Math.max(pe,lt.y),St>fe&&(me(Ae,lt,$e,Ze,at,bt),me(lt,Le,at,bt,nt,Ke))}me(P,M,u,p,h,p),me(M,z,h,p,h,m),me(z,j,h,m,u,m),me(j,P,u,m,u,p),V-=fe,$-=fe,ee+=fe,pe+=fe;const Ce=1/Math.max(ee-V,pe-$);return{scale:Ce,x:V*Ce,y:$*Ce,x2:ee*Ce,y2:pe*Ce,projection:n}}function YN(i,{x:n,y:o},u=0){return new Lt(((n-u)*i.scale-i.x)*Dt,(o*i.scale-i.y)*Dt)}const tY=a.ae.identity(new Float32Array(16));class qd{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new wr(0,0)}projectTilePoint(n,o,u){return{x:n,y:o,z:0}}locationPoint(n,o,u=!0){return n._coordinatePoint(n.locationCoordinate(o),u)}pixelsPerMeter(n,o){return Vo(1,n)*o}pixelSpaceConversion(n,o,u){return 1}farthestPixelDistance(n){return QN(n,n.pixelsPerMeter)}pointCoordinate(n,o,u,h){const p=n.horizonLineFromTop(!1),m=new Lt(o,Math.max(p,u));return n.rayIntersectionCoordinate(n.pointRayIntersection(m,h))}pointCoordinate3D(n,o,u){const h=new Lt(o,u);if(n.elevation)return n.elevation.pointCoordinate(h);{const p=this.pointCoordinate(n,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(n,o){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,o.x,o.y);const u=n.horizonLineFromTop();return o.y<u}createInversionMatrix(n,o){return tY}createTileMatrix(n,o,u){let h,p,m;const v=u.canonical,w=a.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Up(v,this);h=1,p=E.x+u.wrap*E.scale,m=E.y,a.ae.scale(w,w,[h/E.scale,h/E.scale,n.pixelsPerMeter/o])}else h=o/n.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*u.wrap)*h,m=v.y*h;return a.ae.translate(w,w,[p,m,0]),a.ae.scale(w,w,[h/Dt,h/Dt,1]),w}upVector(n,o,u){return[0,0,1]}upVectorScale(n,o,u){return{metersToTile:1}}}class nY extends qd{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,u]=this.parallels=n.parallels||[29.5,45.5],h=Math.sin(er(o));this.n=(h+Math.sin(er(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:u,c:h,r0:p}=this,m=er(n-this.center[0]),v=er(o),w=Math.sqrt(h-2*u*Math.sin(v))/u;return{x:w*Math.sin(m*u),y:w*Math.cos(m*u)-p,z:0}}unproject(n,o){const{n:u,c:h,r0:p}=this,m=p+o;let v=Math.atan2(n,Math.abs(m))*Math.sign(m);m*u<0&&(v-=Math.PI*Math.sign(n)*Math.sign(m));const w=er(this.center[0])*u;v=sc(v,-Math.PI-w,Math.PI-w);const E=Wn(eo(v/u)+this.center[0],-180,180),C=Math.asin(Wn((h-(n*n+m*m)*u*u)/(2*u),-1,1)),P=Wn(eo(C),-Ui,Ui);return new wr(E,P)}}const fv=1.340264,pv=-.081106,mv=893e-6,gv=.003796,Zw=Math.sqrt(3)/2;class rY extends qd{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const u=Math.asin(Zw*Math.sin(o)),h=u*u,p=h*h*h;return{x:.5*(n*Math.cos(u)/(Zw*(fv+3*pv*h+p*(7*mv+9*gv*h)))/Math.PI+.5),y:1-.5*(u*(fv+pv*h+p*(mv+gv*h))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,h=u*u,p=h*h*h;for(let C,P,M,z=0;z<12&&(P=u*(fv+pv*h+p*(mv+gv*h))-o,M=fv+3*pv*h+p*(7*mv+9*gv*h),C=P/M,u=Wn(u-C,-Math.PI/3,Math.PI/3),h=u*u,p=h*h*h,!(Math.abs(C)<1e-12));++z);const m=Zw*n*(fv+3*pv*h+p*(7*mv+9*gv*h))/Math.cos(u),v=Math.asin(Math.sin(u)/Zw),w=Wn(180*m/Math.PI,-180,180),E=Wn(180*v/Math.PI,-Ui,Ui);return new wr(w,E)}}class iY extends qd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const u=360*(n-.5),h=Wn(360*(.5-o),-Ui,Ui);return new wr(u,h)}}const l_=Math.PI/2;function Xw(i){return Math.tan((l_+i)/2)}class sY extends qd{constructor(n){super(n),this.center=n.center||[0,30];const[o,u]=this.parallels=n.parallels||[30,30];let h=er(o),p=er(u);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const m=Math.cos(h),v=Xw(h);this.n=h===p?Math.sin(h):Math.log(m/Math.cos(p))/Math.log(Xw(p)/v),this.f=m*Math.pow(Xw(h),this.n)/this.n}project(n,o){o=er(o),this.southernCenter&&(o=-o),n=er(n-this.center[0]);const u=1e-6,{n:h,f:p}=this;p>0?o<-l_+u&&(o=-l_+u):o>l_-u&&(o=l_-u);const m=p/Math.pow(Xw(o),h);let v=m*Math.sin(h*n),w=p-m*Math.cos(h*n);return v=.5*(v/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:v,y:this.southernCenter?w:1-w,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f:h}=this,p=h-o,m=Math.sign(p),v=Math.sign(u)*Math.sqrt(n*n+p*p);let w=Math.atan2(n,Math.abs(p))*m;p*u<0&&(w-=Math.PI*Math.sign(n)*m);const E=Wn(eo(w/u)+this.center[0],-180,180),C=Wn(eo(2*Math.atan(Math.pow(h/v,1/u))-l_),-Ui,Ui);return new wr(E,this.southernCenter?-C:C)}}class JN extends qd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:hu(n),y:du(o),z:0}}unproject(n,o){const u=fa(n),h=Hs(o);return new wr(u,h)}}const eF=er(Ui);class oY extends qd{project(n,o){const u=(o=er(o))*o,h=u*u;return{x:.5*((n=er(n))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,h=25,p=0,m=u*u;do{m=u*u;const E=m*m;p=(u*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-o)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),u=Wn(u-p,-eF,eF)}while(Math.abs(p)>1e-6&&--h>0);m=u*u;const v=Wn(eo(n/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),w=eo(u);return new wr(v,w)}}const tF=er(Ui);class aY extends qd{project(n,o){o=er(o),n=er(n);const u=Math.cos(o),h=2/Math.PI,p=Math.acos(u*Math.cos(n/2)),m=Math.sin(p)/p,v=.5*(n*h+2*u*Math.sin(n/2)/m)||0,w=.5*(o+Math.sin(o)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(n,o){let u=n=(2*n-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,p=25;const m=1e-6;let v=0,w=0;do{const E=Math.cos(h),C=Math.sin(h),P=2*C*E,M=C*C,z=E*E,j=Math.cos(u/2),V=Math.sin(u/2),$=2*j*V,ee=V*V,pe=1-z*j*j,fe=pe?1/pe:0,me=pe?Math.acos(E*j)*Math.sqrt(1/pe):0,Ce=.5*(2*me*E*V+2*u/Math.PI)-n,Ae=.5*(me*C+h)-o,Le=.5*fe*(z*ee+me*E*j*M)+1/Math.PI,$e=fe*($*P/4-me*C*V),Ze=.125*fe*(P*V-me*C*z*$),nt=.5*fe*(M*j+me*ee*E)+.5,Ke=$e*Ze-nt*Le;v=(Ae*$e-Ce*nt)/Ke,w=(Ce*Ze-Ae*Le)/Ke,u=Wn(u-v,-Math.PI,Math.PI),h=Wn(h-w,-tF,tF)}while((Math.abs(v)>m||Math.abs(w)>m)&&--p>0);return new wr(eo(u),eo(h))}}class nF extends qd{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(er(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:u,cosPhi:h}=this;return{x:er(n)*h*u+.5,y:-Math.sin(er(o))/h*u+.5,z:0}}unproject(n,o){const{scale:u,cosPhi:h}=this,p=-(o-.5)/u,m=Wn(eo((n-.5)/u)/h,-180,180),v=Math.asin(Wn(p*h,-1,1)),w=Wn(eo(v),-Ui,Ui);return new wr(m,w)}}class lY extends JN{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,u){const h=Q0(n,o,u),p=Y0(fu(u));return a.$.transformMat4(h,h,p),{x:h[0],y:h[1],z:h[2]}}locationPoint(n,o){const u=zp(o.lat,o.lng),h=a.$.normalize([],u),p=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude,m=Vo(1,0)*Dt*p;a.$.scaleAndAdd(u,u,h,m);const v=a.ae.identity(new Float64Array(16));return a.ae.multiply(v,n.pixelMatrix,n.globeMatrix),a.$.transformMat4(u,u,v),new Lt(u[0],u[1])}pixelsPerMeter(n,o){return Vo(1,0)*o}pixelSpaceConversion(n,o,u){const h=Vo(1,n)*o,p=xn(Vo(1,45)*o,h,u);return this.pixelsPerMeter(n,o)/p}createTileMatrix(n,o,u){const h=SP(fu(u.canonical));return a.ae.multiply(new Float64Array(16),n.globeMatrix,h)}createInversionMatrix(n,o){const{center:u}=n,h=Y0(fu(o));return a.ae.rotateY(h,h,er(u.lng)),a.ae.rotateX(h,h,er(u.lat)),a.ae.scale(h,h,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(n,o,u,h){return KL(n,o,u,!0)||new yo(0,0)}pointCoordinate3D(n,o,u){const h=this.pointCoordinate(n,o,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(n,o){return!KL(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=function(h,p){const m=h.cameraToCenterDistance,v=h._centerAltitude*p,w=h._camera,E=h._camera.forward(),C=a.$.add([],a.$.scale([],E,-m),[0,0,v]),P=h.worldSize/(2*Math.PI),M=[0,0,-P],z=h.width/h.height,j=Math.tan(h.fovAboveCenter),V=a.$.scale([],w.up(),j),$=a.$.scale([],w.right(),j*z),ee=a.$.normalize([],a.$.add([],a.$.add([],E,V),$)),pe=[];let fe;if(new xP(C,ee).closestPointOnSphere(M,P,pe)){const me=a.$.add([],pe,M),Ce=a.$.sub([],me,C);fe=Math.cos(h.fovAboveCenter)*a.$.length(Ce)}else{const me=a.$.sub([],C,M),Ce=a.$.sub([],M,C);a.$.normalize(Ce,Ce);const Ae=a.$.length(me)-P;fe=Math.sqrt(Ae*(Ae+2*P));const Le=Math.acos(fe/(P+Ae))-Math.acos(a.$.dot(E,Ce));fe*=Math.cos(Le)}return 1.01*fe}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),u=xh(n.zoom);if(u>0){const h=QN(n,Vo(1,n.center.lat)*n.worldSize),p=n.worldSize/(2*Math.PI),m=Math.max(n.width,n.height)/n.worldSize*Math.PI;return xn(o,h+p*(1-Math.cos(m)),Math.pow(u,10))}return o}upVector(n,o,u){return Q0(o,u,n,1)}upVectorScale(n){return{metersToTile:Tw(Sw(fu(n)))}}}function rF(i){const n=i.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(i.name){case"mercator":return new JN(i);case"equirectangular":return new iY(i);case"naturalEarth":return new oY(i);case"equalEarth":return new rY(i);case"winkelTripel":return new aY(i);case"albers":return o?new nF(i):new nY(i);case"lambertConformalConic":return o?new nF(i):new sY(i);case"globe":return new lY(i)}throw new Error(`Invalid projection name: ${i.name}`)}const cY=kw.types,uY=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kw(i,n,o,u,h,p,m,v,w,E,C,P,M){const z=v?Math.min($d,Math.round(v[0])):0,j=v?Math.min($d,Math.round(v[1])):0;i.emplaceBack(n,o,Math.round(32*u),Math.round(32*h),p,m,(z<<1)+(w?1:0),j,16*E,16*C,256*P,256*M)}function Qw(i,n,o){i.emplaceBack(n,o)}function Yw(i,n,o,u,h,p,m){i.emplaceBack(n,o,u,h,p,m)}function Jw(i,n,o,u,h){i.emplaceBack(n,o,u,h),i.emplaceBack(n,o,u,h),i.emplaceBack(n,o,u,h),i.emplaceBack(n,o,u,h)}function hY(i){for(const n of i.sections)if(Fn(n.text))return!0;return!1}class ZP{constructor(n){this.layoutVertexArray=new $A,this.indexArray=new Fs,this.programConfigurations=n,this.segments=new gi,this.dynamicLayoutVertexArray=new Md,this.opacityVertexArray=new GA,this.placedSymbolArray=new gL,this.iconTransitioningVertexArray=new Od,this.globeExtVertexArray=new qA,this.zOffsetVertexArray=new Gg}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,o,u,h,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,pQ.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,gQ.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,uY,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,_Q.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,mQ.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,cN.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ve(ZP,"SymbolBuffers");class XP{constructor(n,o,u){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new u,this.segments=new gi,this.collisionVertexArray=new ZA,this.collisionVertexArrayExt=new Md}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,yQ.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,vQ.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ve(XP,"CollisionBuffers");class c_{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=a.ae.identity([]),this.placementViewportMatrix=a.ae.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=BP(this.zoom,o["text-size"]),this.iconSizeData=BP(this.zoom,o["icon-size"]);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),p=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(m=>el[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new ZP(new zd(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^text/.test(n))),this.icon=new ZP(new zd(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^icon/.test(n))),this.glyphOffsetArray=new vL,this.lineVertexArray=new xL,this.symbolInstances=new yL}calculateGlyphDependencies(n,o,u,h,p){for(let m=0;m<n.length;m++){const v=n.codePointAt(m);if(v===void 0)break;if(o[v]=!0,h&&p&&v<=65535){const w=cv[n.charAt(m)];w&&(o[w.charCodeAt(0)]=!0)}}}updateFootprints(n,o){}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!zP(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(n,o,u,h){const p=this.layers[0],m=p.layout,v=this.projection.name==="globe",w=m.get("text-font"),E=m.get("text-field"),C=m.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof go&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),M=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!P&&!M)return;const j=o.iconDependencies,V=o.glyphDependencies,$=o.availableImages,ee=new In(this.zoom);for(const{feature:pe,id:fe,index:me,sourceLayerIndex:Ce}of n){const Ae=p._featureFilter.needGeometry,Le=yh(pe,Ae);if(!p._featureFilter.filter(ee,Le,u))continue;if(Ae||(Le.geometry=bc(pe,u,h)),v&&pe.type!==1&&u.z<=5){const Ke=Le.geometry,at=.98078528056,bt=(lt,St)=>{const ot=Q0(lt.x,lt.y,u,1),gt=Q0(St.x,St.y,u,1);return a.$.dot(ot,gt)<at};for(let lt=0;lt<Ke.length;lt++)Ke[lt]=lK(Ke[lt],bt)}let $e,Ze;if(P){const Ke=p.getValueAndResolveTokens("text-field",Le,u,$),at=go.factory(Ke);hY(at)&&(this.hasRTLText=!0),(!this.hasRTLText||Bn()==="unavailable"||this.hasRTLText&&tr.isParsed())&&($e=FQ(at,p,Le))}if(M){const Ke=p.getValueAndResolveTokens("icon-image",Le,u,$);Ze=Ke instanceof sa?Ke:sa.fromString(Ke)}if(!$e&&!Ze)continue;const nt=this.sortFeaturesByKey?z.evaluate(Le,{},u):void 0;if(this.features.push({id:fe,text:$e,icon:Ze,index:me,sourceLayerIndex:Ce,geometry:Le.geometry,properties:pe.properties,type:cY[pe.type],sortKey:nt}),Ze&&(j[Ze.namePrimary]=!0,Ze.nameSecondary&&(j[Ze.nameSecondary]=!0)),$e){const Ke=w.evaluate(Le,{},u).join(","),at=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(el.vertical)>=0;for(const bt of $e.sections)if(bt.image)j[bt.image.namePrimary]=!0;else{const lt=mt($e.toString()),St=bt.fontStack||Ke,ot=V[St]=V[St]||{};this.calculateGlyphDependencies(bt.text,ot,at,this.allowVerticalPlacement,lt)}}}m.get("symbol-placement")==="line"&&(this.features=function(pe){const fe={},me={},Ce=[];let Ae=0;function Le(Ke){Ce.push(pe[Ke]),Ae++}function $e(Ke,at,bt){const lt=me[Ke];return delete me[Ke],me[at]=lt,Ce[lt].geometry[0].pop(),Ce[lt].geometry[0]=Ce[lt].geometry[0].concat(bt[0]),lt}function Ze(Ke,at,bt){const lt=fe[at];return delete fe[at],fe[Ke]=lt,Ce[lt].geometry[0].shift(),Ce[lt].geometry[0]=bt[0].concat(Ce[lt].geometry[0]),lt}function nt(Ke,at,bt){const lt=bt?at[0][at[0].length-1]:at[0][0];return`${Ke}:${lt.x}:${lt.y}`}for(let Ke=0;Ke<pe.length;Ke++){const at=pe[Ke],bt=at.geometry,lt=at.text?at.text.toString():null;if(!lt){Le(Ke);continue}const St=nt(lt,bt),ot=nt(lt,bt,!0);if(St in me&&ot in fe&&me[St]!==fe[ot]){const gt=Ze(St,ot,bt),Pt=$e(St,ot,Ce[gt].geometry);delete fe[St],delete me[ot],me[nt(lt,Ce[Pt].geometry,!0)]=Pt,Ce[gt].geometry=null}else St in me?$e(St,ot,bt):ot in fe?Ze(St,ot,bt):(Le(Ke),fe[St]=Ae-1,me[ot]=Ae-1)}return Ce.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,fe)=>pe.sortKey-fe.sortKey)}update(n,o,u,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,o,v,u,h,p),this.icon.programConfigurations.updatePaintArrays(n,o,v,u,h,p)}updateZOffset(){const n=(p,m,v)=>{u+=m,u>p.length&&p.resize(u);for(let w=-m;w<0;w++)p.emplace(w+u,v)},o=(p,m,v)=>{h+=m,h>p.length&&p.resize(h);for(let w=-m;w<0;w++)p.emplace(w+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:w,numIconVertices:E}=m,C=m.zOffset,P=E>0;if((v>0||w>0)&&(n(this.text.zOffsetVertexArray,v,C),n(this.text.zOffsetVertexArray,w,C)),P){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:z}=m;M>=0&&o(this.icon.zOffsetVertexArray,E,C),z>=0&&o(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rF(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const u=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:h,y:p}of o)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$){const ee=n.indexArray,pe=n.layoutVertexArray,fe=n.globeExtVertexArray,me=n.segments.prepareSegment(4*o.length,pe,ee,this.canOverlap?m.sortKey:void 0),Ce=this.glyphOffsetArray.length,Ae=me.vertexLength,Le=this.allowVerticalPlacement&&v===el.vertical?Math.PI/2:0,$e=m.text&&m.text.sections;for(let nt=0;nt<o.length;nt++){const{tl:Ke,tr:at,bl:bt,br:lt,texPrimary:St,texSecondary:ot,pixelOffsetTL:gt,pixelOffsetBR:Pt,minFontScaleX:ct,minFontScaleY:Nt,glyphOffset:Ct,isSDF:Tt,sectionIndex:_n}=o[nt],un=me.vertexLength,Kt=Ct[1];if(Kw(pe,E.x,E.y,Ke.x,Kt+Ke.y,St.x,St.y,u,Tt,gt.x,gt.y,ct,Nt),Kw(pe,E.x,E.y,at.x,Kt+at.y,St.x+St.w,St.y,u,Tt,Pt.x,gt.y,ct,Nt),Kw(pe,E.x,E.y,bt.x,Kt+bt.y,St.x,St.y+St.h,u,Tt,gt.x,Pt.y,ct,Nt),Kw(pe,E.x,E.y,lt.x,Kt+lt.y,St.x+St.w,St.y+St.h,u,Tt,Pt.x,Pt.y,ct,Nt),w){const{x:Ot,y:En,z:fn}=w.anchor,[sn,Dn,zn]=w.up;Yw(fe,Ot,En,fn,sn,Dn,zn),Yw(fe,Ot,En,fn,sn,Dn,zn),Yw(fe,Ot,En,fn,sn,Dn,zn),Yw(fe,Ot,En,fn,sn,Dn,zn),Jw(n.dynamicLayoutVertexArray,Ot,En,fn,Le)}else Jw(n.dynamicLayoutVertexArray,E.x,E.y,E.z,Le);if($){const Ot=ot||St;Qw(n.iconTransitioningVertexArray,Ot.x,Ot.y),Qw(n.iconTransitioningVertexArray,Ot.x+Ot.w,Ot.y),Qw(n.iconTransitioningVertexArray,Ot.x,Ot.y+Ot.h),Qw(n.iconTransitioningVertexArray,Ot.x+Ot.w,Ot.y+Ot.h)}ee.emplaceBack(un,un+1,un+2),ee.emplaceBack(un+1,un+2,un+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),nt!==o.length-1&&_n===o[nt+1].sectionIndex||n.programConfigurations.populatePaintArrays(pe.length,m,m.index,{},z,j,V,$e&&$e[_n])}const Ze=w?w.anchor:E;n.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,E.x,E.y,Ce,this.glyphOffsetArray.length-Ce,Ae,C,P,E.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],v,0,!1,0,M,0)}_commitLayoutVertex(n,o,u,h,p,m,v){n.emplaceBack(o,u,h,p,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(n,o,u,h,p,m,v){const w=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=w.vertexLength,C=v.tileAnchorX,P=v.tileAnchorY;for(let z=0;z<4;z++)u.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,n.padding,v.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new Lt(n.x1,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new Lt(n.x2,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new Lt(n.x2,n.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new Lt(n.x1,n.y2)),w.vertexLength+=4;const M=u.indexArray;M.emplaceBack(E,E+1),M.emplaceBack(E+1,E+2),M.emplaceBack(E+2,E+3),M.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceTextSize(n,m,o,v);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceIconSize(n,o,m.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}generateCollisionDebugBuffers(n,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new XP(pw,uN.members,Od),this.iconCollisionBox=new XP(pw,uN.members,Od);const u=i_(this.iconSizeData,n),h=i_(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,n,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,n,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(u,n,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(u,n,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(n,o,u,h){const p=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),m=Vw(this.textSizeData,n,p)/oo;return this.tilePixelRatio*m}getSymbolInstanceIconSize(n,o,u){const h=this.icon.placedSymbolArray.get(u),p=Vw(this.iconSizeData,n,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(n,o,u,h){n.emplaceBack(o,-u,-u,h),n.emplaceBack(o,u,-u,h),n.emplaceBack(o,u,u,h),n.emplaceBack(o,-u,u,h)}_updateTextDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceTextSize(n,m,o,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceIconSize(n,o,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding,m.zOffset)}}updateCollisionDebugBuffers(n,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=i_(this.iconSizeData,n),h=i_(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,n,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,n,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(u,n,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(u,n,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,u,h,p,m,v,w,E){const C={};if(o<u){const{x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:ee,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me,featureIndex:Ce}=n.get(o);C.textBox={x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:ee,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me},C.textFeatureIndex=Ce}if(h<p){const{x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:ee,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me,featureIndex:Ce}=n.get(h);C.verticalTextBox={x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:ee,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me},C.verticalTextFeatureIndex=Ce}if(m<v){const{x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:ee,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me,featureIndex:Ce}=n.get(m);C.iconBox={x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:ee,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me},C.iconFeatureIndex=Ce}if(w<E){const{x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:ee,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me,featureIndex:Ce}=n.get(w);C.verticalIconBox={x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:ee,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me},C.verticalIconFeatureIndex=Ce}return C}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,o){const u=n.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs;for(let p=u.vertexStartIndex;p<h;p+=4)n.indexArray.emplaceBack(p,p+1,p+2),n.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),u=Math.cos(n),h=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(o*w.tileAnchorX+u*w.tileAnchorY)),p.push(w.featureIndex)}return m.sort((v,w)=>h[v]-h[w]||p[w]-p[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ve(c_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),c_.addDynamicAttributes=Jw;class Ml{constructor(n,o,u,h){this.context=n,this.format=u,this.texture=n.gl.createTexture(),this.update(o,h)}update(n,o,u){const{width:h,height:p}=n,{context:m}=this,{gl:v}=m;if(v.bindTexture(v.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!o||o.premultiply!==!1)),this.useMipmap=!!(o&&o.useMipmap),u||this.size&&this.size[0]===h&&this.size[1]===p){const{x:w,y:E}=u||{x:0,y:0};if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap)v.texSubImage2D(v.TEXTURE_2D,0,w,E,v.RGBA,v.UNSIGNED_BYTE,n);else{let C=this.format,P=v.UNSIGNED_BYTE;this.format===v.R32F&&(C=v.RED,P=v.FLOAT),v.texSubImage2D(v.TEXTURE_2D,0,w,E,h,p,C,P,n.data)}}else if(this.size=[h,p],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap){let w=this.format;this.format===v.R8&&(w=v.RED),v.texImage2D(v.TEXTURE_2D,0,this.format,w,v.UNSIGNED_BYTE,n)}else{let w=this.format,E=this.format,C=v.UNSIGNED_BYTE,P=!1;this.format===v.DEPTH_COMPONENT&&(w=v.DEPTH_COMPONENT16,C=v.UNSIGNED_SHORT),this.format===v.DEPTH_STENCIL&&(w=v.DEPTH24_STENCIL8,C=v.UNSIGNED_INT_24_8,P=!0),this.format===v.R8&&(E=v.RED),this.format===v.R32F&&(C=v.FLOAT,E=v.RED),!this.useMipmap&&P?v.texStorage2D(v.TEXTURE_2D,1,w,h,p):v.texImage2D(v.TEXTURE_2D,0,w,h,p,0,E,C,n.data)}this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,o,u=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!u?n===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(n,o,u,h){const{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),o!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),this.magFilter=o),n!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?n===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),u!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class eT{constructor(n,o){this.context=n,this.texture=o}bind(n,o){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,n),this.minFilter=n),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}}const kl=32,mu=33,Gd=new Uint16Array(8184);for(let i=0;i<2046;i++){let n=i+2,o=0,u=0,h=0,p=0,m=0,v=0;for(1&n?h=p=m=kl:o=u=v=kl;(n>>=1)>1;){const E=o+h>>1,C=u+p>>1;1&n?(h=o,p=u,o=m,u=v):(o=h,u=p,h=m,p=v),m=E,v=C}const w=4*i;Gd[w+0]=o,Gd[w+1]=u,Gd[w+2]=h,Gd[w+3]=p}const gu=new Uint16Array(2178),Wd=new Uint8Array(1089),tT=new Uint16Array(1089);function iF(i){return i===0?-.03125:i===32?.03125:0}var nT=Pr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Vp{constructor(n,o,u,h){this.id=Vp.uniqueIdxCounter,Vp.uniqueIdxCounter++,this.context=n;const p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||h||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Vp.uniqueIdxCounter,Vp.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Vp.uniqueIdxCounter=0;class u_{constructor(n,o,u){this.func=n,this.mask=o,this.range=u}}u_.ReadOnly=!1,u_.ReadWrite=!0,u_.disabled=new u_(519,u_.ReadOnly,[0,1]);const KP=7680;class QP{constructor(n,o,u,h,p,m){this.test=n,this.ref=o,this.mask=u,this.fail=h,this.depthFail=p,this.pass=m}}QP.disabled=new QP({func:519,mask:0},0,0,KP,KP,KP);const _v=771;class Pa{constructor(n,o,u,h){this.blendFunction=n,this.blendColor=o,this.mask=u,this.blendEquation=h}}Pa.Replace=[1,0,1,0],Pa.disabled=new Pa(Pa.Replace,Er.transparent,[!1,!1,!1,!1]),Pa.unblended=new Pa(Pa.Replace,Er.transparent,[!0,!0,!0,!0]),Pa.alphaBlended=new Pa([1,_v,1,_v],Er.transparent,[!0,!0,!0,!0]),Pa.alphaBlendedNonPremultiplied=new Pa([770,_v,770,_v],Er.transparent,[!0,!0,!0,!0]),Pa.multiply=new Pa([774,0,774,0],Er.transparent,[!0,!0,!0,!0]);const YP=1029,JP=2305;class Ec{constructor(n,o,u){this.enable=n,this.mode=o,this.frontFace=u}}Ec.disabled=new Ec(!1,YP,JP),Ec.backCCW=new Ec(!0,YP,JP),Ec.backCW=new Ec(!0,YP,2304),Ec.frontCW=new Ec(!0,1028,2304),Ec.frontCCW=new Ec(!0,1028,JP);var dY=Pr([{name:"a_index",type:"Int16",components:1}]);const sF={type:2,extent:Dt,loadGeometry:()=>[[new Lt(0,0),new Lt(Dt+1,0),new Lt(Dt+1,Dt+1),new Lt(0,Dt+1),new Lt(0,0)]]};class rT{constructor(n,o,u,h,p){this.tileID=n,this.uid=ac(),this.uses=0,this.tileSize=o,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<en.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Up(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,u){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(h,p){const m={};if(!p)return m;for(const v of h){const w=v.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(E=>w.filter(C=>C.id===E)[0]));for(const E of w)m[E.fqid]=v}}return m}(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof c_){if(this.hasSymbolBuckets=!0,!u)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof c_&&p.hasRTLText){this.hasRTLText=!0,tr.isLoading()||tr.isLoaded()||Bn()!=="deferred"||xr();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h],m=o.style.getOwnLayer(h);if(!m)continue;const v=m.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,v)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new nP}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(n)}const o=n.gl,u=this.imageAtlas;if(u&&!u.uploaded){const h=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new Ml(n,u.image,o.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ml(n,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ml(n,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(n,o,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,u),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const h=o.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,o)))}queryRenderedFeatures(n,o,u,h,p,m,v,w){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:m,params:p,tileTransform:this.tileTransform},n,o,u):{}}querySourceFeatures(n,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const h=u.loadVTLayers(),p=o?o.sourceLayer:"",m=h._geojsonTileLayer||h[p];if(!m)return;const v=yc(o&&o.filter),{z:w,x:E,y:C}=this.tileID.canonical,P={z:w,x:E,y:C};for(let M=0;M<m.length;M++){const z=m.feature(M);if(v.needGeometry){const $=yh(z,!0);if(!v.filter(new In(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!v.filter(new In(this.tileID.overscaledZ),z))continue;const j=u.getId(z,p),V=new IN(z,w,E,C,j);V.tile=P,n.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const u=tu(n.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const u=Date.now();let h=!1;if(this.expirationTime>u)h=!1;else if(o)if(this.expirationTime<o)h=!0;else{const p=this.expirationTime-o;p?this.expirationTime=u+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&o&&this.updateBuckets(n,o)}updateBuckets(n,o){if(!this.latestFeatureIndex)return;const u=this.latestFeatureIndex.loadVTLayers(),h=o.style.listImages(),p=o.style.getBrightness();for(const m in this.buckets){if(!o.style.hasLayer(m))continue;const v=this.buckets[m],w=v.layers[0].sourceLayer||"_geojsonTileLayer",E=u[w];let C={};if(n&&(C=n[w],!E||!C||Object.keys(C).length===0))continue;if(v.update(C,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),v instanceof Bw||v instanceof Rw){const M=o.style.getOwnSourceCache(v.layers[0].source);o._terrain&&o._terrain.enabled&&M&&v.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(M.id,this.tileID)}const P=o&&o.style&&o.style.getOwnLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<en.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=en.now()+n}setTexture(n,o){const u=o.context,h=u.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof Ml?this.texture.update(n,{useMipmap:!0}):(this.texture=new Ml(u,n,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(n,o){const u={};for(const h of o)u[h]=!0;this.dependencies[n]=u}hasDependency(n,o){for(const u of n){const h=this.dependencies[u];if(h){for(const p of o)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const u=bc(sF,this.tileID.canonical,this.tileTransform)[0],h=new vc,p=new q0;for(let m=0;m<u.length;m++){const{x:v,y:w}=u[m];h.emplaceBack(v,w),p.emplaceBack(m)}p.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(p),this._tileDebugBuffer=n.createVertexBuffer(h,K0.members),this._tileDebugSegments=gi.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const u=bc(sF,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const m=function(v,w){const E=Up(v,w),C=Math.pow(2,v.z);for(let $=0;$<mu;$++)for(let ee=0;ee<mu;ee++){const pe=fa((v.x+(ee+iF(ee))/kl)/C),fe=Hs((v.y+($+iF($))/kl)/C),me=w.project(pe,fe),Ce=$*mu+ee;gu[2*Ce+0]=Math.round((me.x*E.scale-E.x)*Dt),gu[2*Ce+1]=Math.round((me.y*E.scale-E.y)*Dt)}Wd.fill(0),tT.fill(0);for(let $=2045;$>=0;$--){const ee=4*$,pe=Gd[ee+0],fe=Gd[ee+1],me=Gd[ee+2],Ce=Gd[ee+3],Ae=pe+me>>1,Le=fe+Ce>>1,$e=Ae+Le-fe,Ze=Le+pe-Ae,nt=fe*mu+pe,Ke=Ce*mu+me,at=Le*mu+Ae,bt=Math.hypot((gu[2*nt+0]+gu[2*Ke+0])/2-gu[2*at+0],(gu[2*nt+1]+gu[2*Ke+1])/2-gu[2*at+1])>=16;Wd[at]=Wd[at]||(bt?1:0),$<1022&&(Wd[at]=Wd[at]||Wd[(fe+Ze>>1)*mu+(pe+$e>>1)]||Wd[(Ce+Ze>>1)*mu+(me+$e>>1)])}const P=new ph,M=new Fs;let z=0;function j($,ee){const pe=ee*mu+$;return tT[pe]===0&&(P.emplaceBack(gu[2*pe+0],gu[2*pe+1],$*Dt/kl,ee*Dt/kl),tT[pe]=++z),tT[pe]-1}function V($,ee,pe,fe,me,Ce){const Ae=$+pe>>1,Le=ee+fe>>1;if(Math.abs($-me)+Math.abs(ee-Ce)>1&&Wd[Le*mu+Ae])V(me,Ce,$,ee,Ae,Le),V(pe,fe,me,Ce,Ae,Le);else{const $e=j($,ee),Ze=j(pe,fe),nt=j(me,Ce);M.emplaceBack($e,Ze,nt)}}return V(0,0,kl,kl,kl,0),V(kl,kl,0,0,0,kl),{vertices:P,indices:M}}(this.tileID.canonical,o);h=m.vertices,p=m.indices}else{h=new ph,p=new Fs;for(const{x:v,y:w}of u)h.emplaceBack(v,w,0,0);const m=ev(h.int16,void 0,4);for(let v=0;v<m.length;v+=3)p.emplaceBack(m[v],m[v+1],m[v+2])}this._tileBoundsBuffer=n.createVertexBuffer(h,nT.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(p),this._tileBoundsSegments=gi.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(n,o){const u=o.projection;if(!u||u.name!=="globe"||o.freezeTileCoverage)return;const h=this.tileID.canonical,p=Y0(QL(h,o)),m=xh(o.zoom);let v;m>0&&(v=a.ae.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,h,o,p,v,m),this._makeGlobeTileDebugTextBuffer(n,h,o,p,v,m)}_globePoint(n,o,u,h,p,m,v){let w=Q0(n,o,u);if(m){const E=1<<u.z,C=hu(h.center.lng),P=du(h.center.lat),M=(u.x+.5)/E-C;let z=0;M>.5?z=-1:M<-.5&&(z=1);let j=(n/Dt+u.x)/E+z,V=(o/Dt+u.y)/E;j=(j-C)*h._pixelsPerMercatorPixel+C,V=(V-P)*h._pixelsPerMercatorPixel+P;const $=[j*h.worldSize,V*h.worldSize,0];a.$.transformMat4($,$,m),w=vh(w,$,v)}return a.$.transformMat4(w,w,p)}_makeGlobeTileDebugBorderBuffer(n,o,u,h,p,m){const v=new vc,w=new q0,E=new hw,C=(M,z,j,V,$)=>{const ee=(j-M)/($-1),pe=(V-z)/($-1),fe=v.length;for(let me=0;me<$;me++){const Ce=M+me*ee,Ae=z+me*pe;v.emplaceBack(Ce,Ae);const Le=this._globePoint(Ce,Ae,o,u,h,p,m);E.emplaceBack(Le[0],Le[1],Le[2]),w.emplaceBack(fe+me)}},P=Dt;C(0,0,P,0,16),C(P,0,P,P,16),C(P,P,0,P,16),C(0,P,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(w),this._tileDebugBuffer=n.createVertexBuffer(v,K0.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(E,XL.members),this._tileDebugSegments=gi.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugTextBuffer(n,o,u,h,p,m){const v=Dt/4,w=new vc,E=new Fs,C=new hw,P=25;E.reserve(32),w.reserve(P),C.reserve(P);const M=(z,j)=>P*z+j;for(let z=0;z<P;z++){const j=z*v;for(let V=0;V<P;V++){const $=V*v;w.emplaceBack($,j);const ee=this._globePoint($,j,o,u,h,p,m);C.emplaceBack(ee[0],ee[1],ee[2])}}for(let z=0;z<4;z++)for(let j=0;j<4;j++){const V=M(z,j),$=M(z,j+1),ee=M(z+1,j),pe=M(z+1,j+1);E.emplaceBack(V,$,ee),E.emplaceBack(ee,$,pe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(E),this._tileDebugTextBuffer=n.createVertexBuffer(w,K0.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(C,XL.members),this._tileDebugTextSegments=gi.simpleSegment(0,0,P,32)}destroy(n=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof Ml&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function fY(i,n,o){i===1?n.header_length=o.readFixed32():i===2?n.x=o.readVarint():i===3?n.y=o.readVarint():i===4?n.z=o.readVarint():i===5&&n.layers.push(function(u,h){return u.readFields(yY,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},h)}(o,o.readVarint()+o.pos))}function pY(i,n,o){i===1?(n.delta_filter=function(u,h){return u.readFields(mY,{block_size:0},h)}(o,o.readVarint()+o.pos),n.filter="delta_filter"):i===2?(o.readVarint(),n.filter="zigzag_filter"):i===3?(o.readVarint(),n.filter="bitshuffle_filter"):i===4&&(o.readVarint(),n.filter="byteshuffle_filter")}function mY(i,n,o){i===1&&(n.block_size=o.readVarint())}function gY(i,n,o){i===1?(o.readVarint(),n.codec="gzip_data"):i===2?(o.readVarint(),n.codec="jpeg_image"):i===3?(o.readVarint(),n.codec="webp_image"):i===4&&(o.readVarint(),n.codec="png_image")}function _Y(i,n,o){i===1?n.first_byte=o.readFixed64():i===2?n.last_byte=o.readFixed64():i===3?n.filters.push(function(u,h){return u.readFields(pY,{},h)}(o,o.readVarint()+o.pos)):i===4?n.codec=function(u,h){return u.readFields(gY,{},h)}(o,o.readVarint()+o.pos):i===5?n.deprecated_offset=o.readFloat():i===6?n.deprecated_scale=o.readFloat():i===7?n.bands.push(o.readString()):i===8?n.offset=o.readDouble():i===9&&(n.scale=o.readDouble())}function yY(i,n,o){i===1?n.version=o.readVarint():i===2?n.name=o.readString():i===3?n.units=o.readString():i===4?n.tilesize=o.readVarint():i===5?n.buffer=o.readVarint():i===6?n.pixel_format=o.readVarint():i===7&&n.data_index.push(function(u,h){return u.readFields(_Y,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},h)}(o,o.readVarint()+o.pos))}function vY(i,n,o){if(i===2)(function(u,h,p){u.readFields(xY,p,h)})(o,o.readVarint()+o.pos,n);else if(i===3)throw new Error("Not implemented")}function xY(i,n,o){if(i===1){let u=0;const h=o.readVarint()+o.pos;for(;o.pos<h;)n[u++]=o.readVarint()}}class bY{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const o=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,o),o}put(n,o){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,o)}}function wY(i,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let o=n[3];for(let u=2;u>=1;u--){const h=u===1?1:0,p=u===2?1:0;for(let m=0;m<n[0];m++){const v=n[1]*m;for(let w=h;w<n[1];w++){const E=n[2]*(w+v);for(let C=p;C<n[2];C++){const P=n[3]*(C+E);for(let M=0;M<n[3];M++){const z=P+M;i[z]+=i[z-o]}}}}o*=n[u]}return i}function TY(i){for(let n=0,o=i.length;n<o;n++)i[n]=i[n]>>>1^-(1&i[n]);return i}function EY(i,n){switch(n){case"uint32":return i;case"uint16":for(let o=0;o<i.length;o+=2){const u=i[o],h=i[o+1];i[o]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,i[o+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return i;case"uint8":for(let o=0;o<i.length;o+=4){const u=i[o],h=i[o+1],p=i[o+2],m=i[o+3];i[o+0]=(192&u)>>6|(192&h)>>4|(192&p)>>2|192&m,i[o+1]=(48&u)>>4|(48&h)>>2|48&p|(48&m)<<2,i[o+2]=(12&u)>>2|12&h|(12&p)<<2|(12&m)<<4,i[o+3]=3&u|(3&h)<<2|(3&p)<<4|(3&m)<<6}return i;default:throw new Error(`Invalid pixel format, "${n}"`)}}var tl=Uint8Array,yv=Uint16Array,SY=Int32Array,oF=new tl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),aF=new tl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),IY=new tl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lF=function(i,n){for(var o=new yv(31),u=0;u<31;++u)o[u]=n+=1<<i[u-1];var h=new SY(o[30]);for(u=1;u<30;++u)for(var p=o[u];p<o[u+1];++p)h[p]=p-o[u]<<5|u;return{b:o,r:h}},cF=lF(oF,2),uF=cF.b,CY=cF.r;uF[28]=258,CY[258]=28;for(var AY=lF(aF,0).b,hF=new yv(32768),Wi=0;Wi<32768;++Wi){var h_=(43690&Wi)>>1|(21845&Wi)<<1;hF[Wi]=((65280&(h_=(61680&(h_=(52428&h_)>>2|(13107&h_)<<2))>>4|(3855&h_)<<4))>>8|(255&h_)<<8)>>1}var vv=function(i,n,o){for(var u=i.length,h=0,p=new yv(n);h<u;++h)i[h]&&++p[i[h]-1];var m,v=new yv(n);for(h=1;h<n;++h)v[h]=v[h-1]+p[h-1]<<1;m=new yv(1<<n);var w=15-n;for(h=0;h<u;++h)if(i[h])for(var E=h<<4|i[h],C=n-i[h],P=v[i[h]-1]++<<C,M=P|(1<<C)-1;P<=M;++P)m[hF[P]>>w]=E;return m},xv=new tl(288);for(Wi=0;Wi<144;++Wi)xv[Wi]=8;for(Wi=144;Wi<256;++Wi)xv[Wi]=9;for(Wi=256;Wi<280;++Wi)xv[Wi]=7;for(Wi=280;Wi<288;++Wi)xv[Wi]=8;var dF=new tl(32);for(Wi=0;Wi<32;++Wi)dF[Wi]=5;var PY=vv(xv,9),RY=vv(dF,5),e3=function(i){for(var n=i[0],o=1;o<i.length;++o)i[o]>n&&(n=i[o]);return n},Sc=function(i,n,o){var u=n/8|0;return(i[u]|i[u+1]<<8)>>(7&n)&o},t3=function(i,n){var o=n/8|0;return(i[o]|i[o+1]<<8|i[o+2]<<16)>>(7&n)},MY=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ic=function(i,n,o){var u=new Error(n||MY[i]);if(u.code=i,Error.captureStackTrace&&Error.captureStackTrace(u,Ic),!o)throw u;return u},kY=new tl(0),DY=typeof TextDecoder<"u"&&new TextDecoder;try{DY.decode(kY,{stream:!0})}catch{}const OY={gzip_data:"gzip"};class Dl extends Error{constructor(n){super(n),this.name="MRTError"}}const LY={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},fF={uint32:1,uint16:2,uint8:4},zY={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let n3,r3;class bv{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const o=this.layers[n];if(!o)throw new Dl(`Layer '${n}' not found`);return o}getHeaderLength(n){const o=new Uint8Array(n),u=new DataView(n);if(o[0]!==13)throw new Dl("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(n){const o=new Uint8Array(n),u=this.getHeaderLength(n);if(o.length<u)throw new Dl(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const h=function(p,m){return p.readFields(fY,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new n3(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Dl(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new NY(p,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const o=[],u=this.getLayer(n.layerName);for(let h of n.blockIndices){const p=u.dataIndex[h],m=p.first_byte-n.firstByte,v=p.last_byte-n.firstByte;if(u._blocksInProgress.has(h))continue;const w={layerName:u.name,firstByte:m,lastByte:v,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(u.bandShape),buffer:u.buffer,codec:p.codec.codec,filters:p.filters.map(E=>E.filter)};u._blocksInProgress.add(h),o.push(w)}return new pF(o,()=>{o.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,p)=>{if(o.forEach(m=>u._blocksInProgress.delete(m.blockIndex)),h)throw h;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class NY{constructor({version:n,name:o,units:u,tilesize:h,pixel_format:p,buffer:m,data_index:v},w){if(this.version=n,this.version!==1)throw new Dl(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=o,this.units=u,this.tileSize=h,this.buffer=m,this.pixelFormat=LY[p],this.dataIndex=v,this.bandShape=[h+2*m,h+2*m,fF[this.pixelFormat]],this._decodedBlocks=new bY(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return fF[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const o=n.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,n.data)}getBlockForBand(n){let o=0;switch(typeof n){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[p,m]of h.bands.entries())if(m===n)return{bandIndex:o+p,blockIndex:u,blockBandIndex:p};o+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(n>=o&&n<o+h.bands.length)return{bandIndex:n,blockIndex:u,blockBandIndex:n-o};o+=h.bands.length}break;default:throw new Dl(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new Dl(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let o=1/0,u=-1/0;const h=[],p=new Set;for(const m of n){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new Dl(`Invalid band: ${JSON.stringify(m)}`);const w=this.dataIndex[v];h.includes(v)||h.push(v),p.add(v),o=Math.min(o,w.first_byte),u=Math.max(u,w.last_byte)}if(p.size>this.cacheSize)throw new Dl(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:h}}hasBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0}hasDataForBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(n){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(n),h=this._decodedBlocks.get(o.toString());if(!h)throw new Dl(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[o],m=this.bandShape.reduce((E,C)=>E*C,1),v=u*m,w=h.subarray(v,v+m);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset!==0?p.offset:p.deprecated_offset,scale:p.scale!==0?p.scale:p.deprecated_scale}}}bv.setPbf=function(i){n3=i};class pF{constructor(n,o,u){this.tasks=n,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,o){this._finalized||(this._onComplete(n,o),this._finalized=!0)}}bv.performDecoding=function(i,n){const o=new Uint8Array(i);return Promise.all(n.tasks.map(u=>{const{layerName:h,firstByte:p,lastByte:m,pixelFormat:v,blockShape:w,blockIndex:E,filters:C,codec:P}=u,M=o.subarray(p,m+1),z=new Uint32Array(w[0]*w[1]*w[2]);let j;if(P!=="gzip_data")throw new Dl(`Unhandled codec: ${P}`);return j=function(V,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve(((me=function(Le){Le[0]==31&&Le[1]==139&&Le[2]==8||Ic(6,"invalid gzip data");var $e=Le[3],Ze=10;4&$e&&(Ze+=2+(Le[10]|Le[11]<<8));for(var nt=($e>>3&1)+($e>>4&1);nt>0;nt-=!Le[Ze++]);return Ze+(2&$e)}(fe=V))+8>fe.length&&Ic(6,"invalid gzip data"),function(Le,$e,Ze,nt){var Ke=Le.length;if(!Ke||$e.f&&!$e.l)return Ze||new tl(0);var at=!Ze,bt=at||$e.i!=2,lt=$e.i;at&&(Ze=new tl(3*Ke));var St,ot,gt=function(Zd){var Zp=Ze.length;if(Zd>Zp){var Mv=new tl(Math.max(2*Zp,Zd));Mv.set(Ze),Ze=Mv}},Pt=$e.f||0,ct=$e.p||0,Nt=$e.b||0,Ct=$e.l,Tt=$e.d,_n=$e.m,un=$e.n,Kt=8*Ke;do{if(!Ct){Pt=Sc(Le,ct,1);var Ot=Sc(Le,ct+1,3);if(ct+=3,!Ot){var En=Le[(Nn=4+((ct+7)/8|0))-4]|Le[Nn-3]<<8,fn=Nn+En;if(fn>Ke){lt&&Ic(0);break}bt&&gt(Nt+En),Ze.set(Le.subarray(Nn,fn),Nt),$e.b=Nt+=En,$e.p=ct=8*fn,$e.f=Pt;continue}if(Ot==1)Ct=PY,Tt=RY,_n=9,un=5;else if(Ot==2){var sn=Sc(Le,ct,31)+257,Dn=Sc(Le,ct+10,15)+4,zn=sn+Sc(Le,ct+5,31)+1;ct+=14;for(var On=new tl(zn),Gn=new tl(19),mr=0;mr<Dn;++mr)Gn[IY[mr]]=Sc(Le,ct+3*mr,7);ct+=3*Dn;var sr=e3(Gn),Br=(1<<sr)-1,$r=vv(Gn,sr);for(mr=0;mr<zn;){var Nn,Rr=$r[Sc(Le,ct,Br)];if(ct+=15&Rr,(Nn=Rr>>4)<16)On[mr++]=Nn;else{var Dr=0,Jr=0;for(Nn==16?(Jr=3+Sc(Le,ct,3),ct+=2,Dr=On[mr-1]):Nn==17?(Jr=3+Sc(Le,ct,7),ct+=3):Nn==18&&(Jr=11+Sc(Le,ct,127),ct+=7);Jr--;)On[mr++]=Dr}}var Di=On.subarray(0,sn),Hi=On.subarray(sn);_n=e3(Di),un=e3(Hi),Ct=vv(Di,_n),Tt=vv(Hi,un)}else Ic(1);if(ct>Kt){lt&&Ic(0);break}}bt&&gt(Nt+131072);for(var Oi=(1<<_n)-1,wi=(1<<un)-1,Bs=ct;;Bs=ct){var cs=(Dr=Ct[t3(Le,ct)&Oi])>>4;if((ct+=15&Dr)>Kt){lt&&Ic(0);break}if(Dr||Ic(2),cs<256)Ze[Nt++]=cs;else{if(cs==256){Bs=ct,Ct=null;break}var ao=cs-254;cs>264&&(ao=Sc(Le,ct,(1<<(Ac=oF[mr=cs-257]))-1)+uF[mr],ct+=Ac);var Kr=Tt[t3(Le,ct)&wi],pa=Kr>>4;if(Kr||Ic(3),ct+=15&Kr,Hi=AY[pa],pa>3){var Ac=aF[pa];Hi+=t3(Le,ct)&(1<<Ac)-1,ct+=Ac}if(ct>Kt){lt&&Ic(0);break}bt&&gt(Nt+131072);var Ol=Nt+ao;if(Nt<Hi){var Ll=0-Hi,Hp=Math.min(Hi,Ol);for(Ll+Nt<0&&Ic(3);Nt<Hp;++Nt)Ze[Nt]=(void 0)[Ll+Nt]}for(;Nt<Ol;++Nt)Ze[Nt]=Ze[Nt-Hi]}}$e.l=Ct,$e.p=Bs,$e.b=Nt,$e.f=Pt,Ct&&(Pt=1,$e.m=_n,$e.d=Tt,$e.n=un)}while(!Pt);return Nt!=Ze.length&&at?(St=Ze,((ot=Nt)==null||ot>St.length)&&(ot=St.length),new tl(St.subarray(0,ot))):Ze.subarray(0,Nt)}(fe.subarray(me,-8),{i:2},new tl(((ee=fe)[(pe=ee.length)-4]|ee[pe-3]<<8|ee[pe-2]<<16|ee[pe-1]<<24)>>>0))));var ee,pe,fe,me;const Ce=OY[$];if(!Ce)throw new Error(`Unhandled codec: ${$}`);const Ae=new globalThis.DecompressionStream(Ce);return new Response(new Blob([V]).stream().pipeThrough(Ae)).arrayBuffer().then(Le=>new Uint8Array(Le))}(M,P).then(V=>(function($,ee){$.readFields(vY,ee)}(new n3(V),z),new zY[v](z.buffer))),j.then(V=>{for(let $=C.length-1;$>=0;$--)switch(C[$]){case"delta_filter":wY(V,w);break;case"zigzag_filter":TY(V);break;case"bitshuffle_filter":EY(V,v);break;default:throw new Dl(`Unhandled filter "${C[$]}"`)}return{layerName:h,blockIndex:E,data:V}}).catch(V=>{throw V})}))},bv.setPbf(lv);class mF extends rT{constructor(n,o,u,h,p){super(n,o,u,h,p),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,o){const u=o.context,h=u.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof Ml?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new Ml(u,n,h.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,o){const u=this._mrt=new bv(30),h=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=nh(h,(p,m,v,w)=>{if(p)o(p);else try{const E=u.getHeaderLength(m);if(E>n)return void(this.request=this.fetchHeader(E,o));u.parseHeader(m),this._isHeaderLoaded=!0;let C=0;for(const P of Object.values(u.layers))C=Math.max(C,P.dataIndex[P.dataIndex.length-1].last_byte);m.byteLength>=C&&(this.entireBuffer=m),o(null,this.entireBuffer||m,v,w)}catch(E){o(E)}}),this.request}fetchBand(n,o,u){const h=this._mrt;if(!this._isHeaderLoaded||!h)return void u(new Error("Tile header is not ready"));const p=this.actor;if(!p)return void u(new Error("Can't fetch tile band without an actor"));let m;const v=(P,M)=>{m.complete(P,M),P?u(P):(this.updateTextureDescriptor(n,o),u(null,this.textureDescriptor&&this.textureDescriptor.img))},w=(P,M)=>{if(P)return u(P);const z=p.send("decodeRasterArray",{buffer:M,task:m},v,void 0,!0);this._workQueue.push(()=>{z&&z.cancel(),m.cancel()})},E=h.getLayer(n);if(!E)return void u(new Error(`Unknown sourceLayer "${n}"`));if(E.hasDataForBand(o))return this.updateTextureDescriptor(n,o),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const C=E.getDataRange([o]);if(m=h.createDecodingTask(C),!m||m.tasks.length)if(this.flushQueues(),this.entireBuffer)w(null,this.entireBuffer.slice(C.firstByte,C.lastByte+1));else{const P=Object.assign({},this.requestParams,{headers:{Range:`bytes=${C.firstByte}-${C.lastByte}`}}),M=nh(P,w);this._fetchQueue.push(()=>{M.cancel(),m.cancel()})}else u(null)}updateNeeded(n,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,o){if(!this._mrt)return;const u=this._mrt.getLayer(n);if(!u||!u.hasBand(o)||!u.hasDataForBand(o))return;const{bytes:h,tileSize:p,buffer:m,offset:v,scale:w}=u.getBandView(o),E=p+2*m,C={data:h,width:E,height:E},P=this.texture;P&&P instanceof Ml&&P.update(C,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:o,img:C,buffer:m,offset:v,tileSize:p,format:u.pixelFormat,mix:[w,256*w,65536*w,16777216*w]}}}class FY{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,u){const h=n.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:o,timeout:void 0};if(u!==void 0&&(p.timeout=setTimeout(()=>{this.remove(n,p)},u)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const u=n.wrapped().key,h=o===void 0?0:this.data[u].indexOf(o),p=this.data[u][h];return this.data[u].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(p.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const u in this.data)for(const h of this.data[u])n(h.value)||o.push(h);for(const u of o)this.remove(u.value.tileID,u)}}class $p extends oh{constructor(n,o,u){super(),this.id=n,this._onlySymbols=u,o.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new FY(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new LQ,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(n),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return oc(this._tiles).map(n=>n.tileID).sort(gF).map(n=>n.key)}getRenderableIds(n,o){const u=[];for(const h in this._tiles)this._isIdRenderable(+h,n,o)&&u.push(this._tiles[h]);return n?u.sort((h,p)=>{const m=h.tileID,v=p.tileID,w=new Lt(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new Lt(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||E.y-w.y||E.x-w.x}).map(h=>h.tileID.key):u.map(h=>h.tileID).sort(gF).map(h=>h.key)}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o,u){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())&&(u||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const u=this._tiles[n];u&&(u.state!=="loading"&&(u.state=o),this._loadTile(u,this._tileLoaded.bind(this,u,n,o)))}_tileLoaded(n,o,u,h){if(h)if(n.state="errored",h.status!==404)this._source.fire(new hp(h,{tile:n}));else{if(this._source.fire(new Il("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=en.now(),u==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Il("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let h=0;h<o.length;h++){const p=o[h];if(n.neighboringTiles&&n.neighboringTiles[p]){const m=this.getTileByID(p);u(n,m),u(m,n)}}function u(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=p.tileID.canonical.x-h.tileID.canonical.x;const v=p.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),E=p.tileID.key;m===0&&v===0||Math.abs(v)>1||(Math.abs(m)>1&&(Math.abs(m+w)===1?m+=w:Math.abs(m-w)===1&&(m-=w)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,m,v),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,u,h){for(const p in this._tiles){let m=this._tiles[p];if(h[p]||!m.hasData()||m.tileID.overscaledZ<=o||m.tileID.overscaledZ>u)continue;let v=m.tileID;for(;m&&m.tileID.overscaledZ>o+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(v=E)}let w=v;for(;w.overscaledZ>o;)if(w=w.scaledTo(w.overscaledZ-1),n[w.key]){h[v.key]=v;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const u=this._loadedParentTiles[n.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=n.overscaledZ-1;u>=o;u--){const h=n.scaledTo(u),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const u=Math.ceil(n.width/o)+1,h=Math.ceil(n.height/o)+1,p=Math.floor(u*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const u={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+o),u[p.tileID.key]=p}this._tiles=u;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(n,o,u,h){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const p=this._source.type==="batched-model";let m;if(this.used||this.usedForTerrain){if(this._source.tileID)m=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new gs(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y));else if(this.tileCoverLift!==0){const E=n.clone();E.tileCoverLift=this.tileCoverLift,m=E.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.minzoom<=1&&n.projection.name==="globe"&&(m.push(new gs(1,0,1,0,0)),m.push(new gs(1,0,1,1,0)),m.push(new gs(1,0,1,0,1)),m.push(new gs(1,0,1,1,1)))}else if(m=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.hasTile){const E=this._source.hasTile.bind(this._source);m=m.filter(C=>E(C))}}else m=[];if(m.length>0&&this.castsShadows&&h&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!i3(this._source.type)){const E=n.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),C=Math.min(E,this._source.maxzoom);if(p){const P=n.extendTileCover(m,C);for(const M of P)m.push(M)}else{const P=n.extendTileCover(m,C,h);for(const M of P)this._shadowCasterTiles[M.key]=!0,m.push(M)}}const v=this._updateRetainedTiles(m);if(i3(this._source.type)&&m.length!==0){const E={},C={},P=Object.keys(v);for(const z of P){const j=v[z],V=this._tiles[z];if(!V||V.fadeEndTime&&V.fadeEndTime<=en.now())continue;const $=this.findLoadedParent(j,Math.max(j.overscaledZ-$p.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),E[$.tileID.key]=$.tileID),C[z]=j}const M=m[m.length-1].overscaledZ;for(const z in this._tiles){const j=this._tiles[z];if(v[z]||!j.hasData())continue;let V=j.tileID;for(;V.overscaledZ>M;){V=V.scaledTo(V.overscaledZ-1);const $=this._tiles[V.key];if($&&$.hasData()&&C[V.key]){v[z]=j.tileID;break}}}for(const z in E)v[z]||(this._coveredTiles[z]=!0,v[z]=E[z])}for(const E in v)this._tiles[E].clearFadeHold();const w=function(E,C){const P=[];for(const M in E)M in C||P.push(M);return P}(this._tiles,v);for(const E of w){const C=this._tiles[E];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const u={},h=n.reduce((E,C)=>Math.min(E,C.overscaledZ),1/0),p=n[0].overscaledZ,m=Math.max(p-$p.maxOverzooming,this._source.minzoom),v=Math.max(p+$p.maxUnderzooming,this._source.minzoom),w={};for(const E of n){const C=this._addTile(E);o[E.key]=E,C.hasData()||h<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,h,v,o);for(const E of n){let C=this._tiles[E.key];if(C.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const M=E.children(this._source.maxzoom)[0],z=this.getTile(M);if(z&&z.hasData()){o[M.key]=M;continue}}else{const M=E.children(this._source.maxzoom);if(o[M[0].key]&&o[M[1].key]&&o[M[2].key]&&o[M[3].key])continue}let P=C.wasRequested();for(let M=E.overscaledZ-1;M>=m;--M){const z=E.scaledTo(M);if(u[z.key]||(u[z.key]=!0,C=this.getTile(z),!C&&P&&(C=this._addTile(z)),C&&(o[z.key]=z,P=C.wasRequested(),C.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let u,h=this._tiles[n].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){u=this._loadedParentTiles[h.key];break}o.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(u=this._getLoadedTile(p),u)break;h=p}for(const p of o)this._loadedParentTiles[p]=u}}_addTile(n){let o=this._tiles[n.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const u=!!o;if(!u){const h=this.map?this.map.painter:null,p=this._source.tileSize*n.overscaleFactor();o=this._source.type==="raster-array"?new mF(n,p,this.transform.tileZoom,h,this._isRaster):new rT(n,p,this.transform.tileZoom,h,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,u||this._source.fire(new Il("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const u=o.getExpiryTimeout();u&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},u))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,u){const h=[],p=this.transform;if(!p)return h;const m=p.projection.name==="globe",v=hu(p.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(u&&E.clearQueryDebugViz(),E.holdingForFade())continue;let C;if(m){const P=E.tileID.canonical;if(P.z===0){const M=[Math.abs(Wn(v,...wv(P,-1))-v),Math.abs(Wn(v,...wv(P,1))-v)];C=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(Wn(v,...wv(P,-1))-v),Math.abs(Wn(v,...wv(P,0))-v),Math.abs(Wn(v,...wv(P,1))-v)];C=[M.indexOf(Math.min(...M))-1]}}else C=[0];for(const P of C){const M=n.containsTile(E,p,o,P);M&&h.push(M)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,o){const u=this.getRenderableIds(n,o).map(p=>this._tiles[p].tileID),h=this.transform.projection.name==="globe";for(const p of u)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=h?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return u}sortCoordinatesByDistance(n){const o=n.slice(),u=this.transform._camera.position,h=this.transform._camera.forward(),p={};for(const m of o){const v=1/(1<<m.canonical.z);p[m.key]=((m.canonical.x+.5)*v+m.wrap-u[0])*h[0]+((m.canonical.y+.5)*v-u[1])*h[1]-u[2]*h[2]}return o.sort((m,v)=>p[m.key]-p[v.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(i3(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=en.now())return!0}return!1}setFeatureState(n,o,u){this._state.updateState(n=n||"_geojsonTileLayer",o,u)}removeFeatureState(n,o,u){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,u)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,u){const h=this._tiles[n];h&&h.setDependencies(o,u)}reloadTilesForDependencies(n,o){for(const u in this._tiles)this._tiles[u].hasDependency(n,o)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(n,o))}_preloadTiles(n,o){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(n,o))};return void this._source.on("data",v)}const u=new Map,h=Array.isArray(n)?n:[n],p=this.map.painter.terrain,m=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of h){const w=v.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)u.set(E.key,E);this.usedForTerrain&&v.updateElevation(!1)}eh(Array.from(u.values()),(v,w)=>{const E=new rT(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,C=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(C,E)})},o)}}function gF(i,n){const o=Math.abs(2*i.wrap)-+(i.wrap<0),u=Math.abs(2*n.wrap)-+(n.wrap<0);return i.overscaledZ-n.overscaledZ||u-o||n.canonical.y-i.canonical.y||n.canonical.x-i.canonical.x}function i3(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function wv(i,n){const o=1<<i.z;return[i.x/o+n,(i.x+1)/o+n]}$p.maxOverzooming=10,$p.maxUnderzooming=3;const _F=()=>r3||(r3={layout:fN||(fN=new Vr({"line-cap":new on(Je.layout_line["line-cap"]),"line-join":new on(Je.layout_line["line-join"]),"line-miter-limit":new Et(Je.layout_line["line-miter-limit"]),"line-round-limit":new Et(Je.layout_line["line-round-limit"]),"line-sort-key":new on(Je.layout_line["line-sort-key"]),"line-z-offset":new on(Je.layout_line["line-z-offset"]),visibility:new Et(Je.layout_line.visibility)})),paint:pN||(pN=new Vr({"line-opacity":new on(Je.paint_line["line-opacity"]),"line-color":new on(Je.paint_line["line-color"]),"line-translate":new Et(Je.paint_line["line-translate"]),"line-translate-anchor":new Et(Je.paint_line["line-translate-anchor"]),"line-width":new on(Je.paint_line["line-width"]),"line-gap-width":new on(Je.paint_line["line-gap-width"]),"line-offset":new on(Je.paint_line["line-offset"]),"line-blur":new on(Je.paint_line["line-blur"]),"line-dasharray":new on(Je.paint_line["line-dasharray"]),"line-pattern":new on(Je.paint_line["line-pattern"]),"line-gradient":new _o(Je.paint_line["line-gradient"]),"line-trim-offset":new Et(Je.paint_line["line-trim-offset"]),"line-trim-fade-range":new Et(Je.paint_line["line-trim-fade-range"]),"line-trim-color":new Et(Je.paint_line["line-trim-color"]),"line-emissive-strength":new Et(Je.paint_line["line-emissive-strength"]),"line-border-width":new on(Je.paint_line["line-border-width"]),"line-border-color":new on(Je.paint_line["line-border-color"]),"line-occlusion-opacity":new Et(Je.paint_line["line-occlusion-opacity"])}))},r3);class BY extends on{possiblyEvaluate(n,o){return o=new In(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(n,o)}evaluate(n,o,u,h){return o=Is({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(n,o,u,h)}}let Tv,yF,vF,s3;function xF(i,n){return n>0?n+2*i:i}class bF{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:ia,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ve(bF,"FormatSectionOverride",{omit:["defaultValue"]});const o3=()=>s3||(s3={layout:yF||(yF=new Vr({"symbol-placement":new Et(Je.layout_symbol["symbol-placement"]),"symbol-spacing":new Et(Je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Et(Je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new on(Je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Et(Je.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Et(Je.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Et(Je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Et(Je.layout_symbol["icon-ignore-placement"]),"icon-optional":new Et(Je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Et(Je.layout_symbol["icon-rotation-alignment"]),"icon-size":new on(Je.layout_symbol["icon-size"]),"icon-text-fit":new on(Je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new on(Je.layout_symbol["icon-text-fit-padding"]),"icon-image":new on(Je.layout_symbol["icon-image"]),"icon-rotate":new on(Je.layout_symbol["icon-rotate"]),"icon-padding":new Et(Je.layout_symbol["icon-padding"]),"icon-keep-upright":new Et(Je.layout_symbol["icon-keep-upright"]),"icon-offset":new on(Je.layout_symbol["icon-offset"]),"icon-anchor":new on(Je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Et(Je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Et(Je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Et(Je.layout_symbol["text-rotation-alignment"]),"text-field":new on(Je.layout_symbol["text-field"]),"text-font":new on(Je.layout_symbol["text-font"]),"text-size":new on(Je.layout_symbol["text-size"]),"text-max-width":new on(Je.layout_symbol["text-max-width"]),"text-line-height":new on(Je.layout_symbol["text-line-height"]),"text-letter-spacing":new on(Je.layout_symbol["text-letter-spacing"]),"text-justify":new on(Je.layout_symbol["text-justify"]),"text-radial-offset":new on(Je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Et(Je.layout_symbol["text-variable-anchor"]),"text-anchor":new on(Je.layout_symbol["text-anchor"]),"text-max-angle":new Et(Je.layout_symbol["text-max-angle"]),"text-writing-mode":new Et(Je.layout_symbol["text-writing-mode"]),"text-rotate":new on(Je.layout_symbol["text-rotate"]),"text-padding":new Et(Je.layout_symbol["text-padding"]),"text-keep-upright":new Et(Je.layout_symbol["text-keep-upright"]),"text-transform":new on(Je.layout_symbol["text-transform"]),"text-offset":new on(Je.layout_symbol["text-offset"]),"text-allow-overlap":new Et(Je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Et(Je.layout_symbol["text-ignore-placement"]),"text-optional":new Et(Je.layout_symbol["text-optional"]),visibility:new Et(Je.layout_symbol.visibility)})),paint:vF||(vF=new Vr({"icon-opacity":new on(Je.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new on(Je.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new on(Je.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new on(Je.paint_symbol["text-emissive-strength"]),"icon-color":new on(Je.paint_symbol["icon-color"]),"icon-halo-color":new on(Je.paint_symbol["icon-halo-color"]),"icon-halo-width":new on(Je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new on(Je.paint_symbol["icon-halo-blur"]),"icon-translate":new Et(Je.paint_symbol["icon-translate"]),"icon-translate-anchor":new Et(Je.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new on(Je.paint_symbol["icon-image-cross-fade"]),"text-opacity":new on(Je.paint_symbol["text-opacity"]),"text-occlusion-opacity":new on(Je.paint_symbol["text-occlusion-opacity"]),"text-color":new on(Je.paint_symbol["text-color"],{runtimeType:Ia,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new on(Je.paint_symbol["text-halo-color"]),"text-halo-width":new on(Je.paint_symbol["text-halo-width"]),"text-halo-blur":new on(Je.paint_symbol["text-halo-blur"]),"text-translate":new Et(Je.paint_symbol["text-translate"]),"text-translate-anchor":new Et(Je.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Et(Je.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Et(Je.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Et(Je.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Et(Je.paint_symbol["icon-color-brightness-max"])}))},s3);class iT extends da{constructor(n,o,u,h){super(n,o3(),o,u,h),this._colorAdjustmentMatrix=a.ae.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,o){super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const p of u)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,o,u,h){return this._saturation===n&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(p,m,v,w){p=dt(p),m=Me(m);const E=a.ae.create(),C=p/3,P=1-2*C,M=[P,C,C,0,C,P,C,0,C,C,P,0,0,0,0,1],z=.5-.5*m,j=w-v;return a.ae.multiply(E,[j,0,0,0,0,j,0,0,0,0,j,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,z,z,z,1]),a.ae.multiply(E,E,M),E}(n,o,u,h),this._saturation=n,this._contrast=o,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,o,u,h){const p=this.layout.get(n).evaluate(o,{},u,h),m=this._unevaluatedLayout._values[n];return m.isDataDriven()||ve(m.value)||!p?p:function(v,w){return w.replace(/{([^{}]+)}/g,(E,C)=>C in v?String(v[C]):"")}(o.properties,p)}createBucket(n){return new c_(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of o3().paint.overridableProperties){if(!iT.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),u=new bF(o),h=new ye(u,o.property.specification,this.scope,this.options);let p=null;p=o.value.kind==="constant"||o.value.kind==="source"?new Re("source",h):new Se("composite",h,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new Ns(o.property,p,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&iT.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const u=n.get("text-field"),h=o3().paint.properties[o];let p=!1;const m=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(p=!0)};if(u.value.kind==="constant"&&u.value.value instanceof go)m(u.value.value.sections);else if(u.value.kind==="source"){const v=E=>{p||(E instanceof Qa&&ls(E.value)===wd?m(E.value.sections):E instanceof lh?m(E.sections):E.eachChild(v))},w=u.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramIds(){const n=this.paint.get("icon-opacity").constantOr(1)!==0,o=this.paint.get("text-opacity").constantOr(1)!==0,u=[];return n&&u.push("symbolIcon"),o&&u.push("symbolSDF"),u}getDefaultProgramParams(n,o,u){return{config:new Lp(this,{zoom:o,lut:u}),overrideFog:!1}}}let wF,TF,EF,SF;function sT(i,n,o,u,h,p,m,v){const w=[i,n,1,o,u,1,h,p,1],E=[m,v,1],C=a.bE.adjoint([],w),[P,M,z]=a.$.transformMat3(E,E,C);return a.bE.multiply(w,w,[P,0,0,0,M,0,0,0,z])}function IF(i,n,o,u,h,p,m,v){const w=function(E,C,P,M,z,j,V,$){const ee=sT(0,0,1,0,1,1,0,1),pe=sT(E,C,P,M,z,j,V,$),fe=a.bE.adjoint([],ee);return a.bE.multiply(pe,pe,fe)}(i,n,o,u,h,p,m,v);return[w[2]/w[8]/Dt,w[5]/w[8]/Dt]}function oT(i){return[i[0],Math.min(Math.max(i[1],-Ui),Ui)]}class CF extends oh{constructor(n,o,u,h){super(),this.id=n,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=o,this._dirty=!1}load(n,o){if(this._loaded=o||!1,this.fire(new Il("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=ap(this.map._requestManager.transformRequest(this.url,sp.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new hp(u)):h&&(this.image=h instanceof HTMLImageElement?en.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new eT(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Il("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof eT||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=n[0][1],u=n[0][1];for(const p of n)p[1]>u&&(u=p[1]),p[1]<o&&(o=p[1]);const h=(u+o)/2;if(h>Ui?this.onNorthPole=!0:h<-Ui&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=n.map(yo.fromLngLat);this.tileID=function(m){let v=1/0,w=1/0,E=-1/0,C=-1/0;for(const V of m)v=Math.min(v,V.x),w=Math.min(w,V.y),E=Math.max(E,V.x),C=Math.max(C,V.y);const P=Math.max(E-v,C-w),M=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),z=Math.pow(2,M);let j=Math.floor((v+E)/2*z);return j>1&&(j-=1),new Np(M,j,Math.floor((w+C)/2*z))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Il("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const $ in this.tiles){const ee=this.tiles[$];ee.state!=="loaded"&&(ee.state="loaded",ee.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=Up(new Np(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const ee=$[1].x-$[0].x,pe=$[1].y-$[0].y,fe=$[2].x-$[1].x,me=$[2].y-$[1].y,Ce=$[3].x-$[2].x,Ae=$[3].y-$[2].y,Le=$[0].x-$[3].x,$e=$[0].y-$[3].y,Ze=ee*me-fe*pe,nt=fe*Ae-Ce*me,Ke=Ce*$e-Le*Ae,at=Le*pe-ee*$e;return Ze>0&&nt>0&&Ke>0&&at>0||Ze<0&&nt<0&&Ke<0&&at<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Up(this.tileID,this.map.transform.projection),[p,m,v,w]=this.coordinates.map($=>{const ee=h.projection.project($[0],$[1]);return YN(h,ee)._round()});this.perspectiveTransform=IF(p.x,p.y,m.x,m.y,v.x,v.y,w.x,w.y);const E=this._boundsArray=new ph;E.emplaceBack(p.x,p.y,0,0),E.emplaceBack(m.x,m.y,Dt,0),E.emplaceBack(w.x,w.y,0,Dt),E.emplaceBack(v.x,v.y,Dt,Dt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(E,nT.members),this.boundsSegments=gi.simpleSegment(0,0,4,2);const C=[],P=function($){return[oT($[0]),oT($[1]),oT($[2]),oT($[3])]}(this.coordinates),[M,z,j,V]=function($){let ee=$[0][0],pe=ee,fe=$[0][1],me=fe;for(let Ce=1;Ce<$.length;Ce++)$[Ce][0]<ee?ee=$[Ce][0]:$[Ce][0]>pe&&(pe=$[Ce][0]),$[Ce][1]<fe?fe=$[Ce][1]:$[Ce][1]>me&&(me=$[Ce][1]);return[ee,fe,pe-ee,me-fe]}(P);{const $=new ph,[ee,pe,fe,me]=function(ot){let gt=ot[0].x,Pt=gt,ct=ot[0].y,Nt=ct;for(let Ct=1;Ct<ot.length;Ct++)ot[Ct].x<gt?gt=ot[Ct].x:ot[Ct].x>Pt&&(Pt=ot[Ct].x),ot[Ct].y<ct?ct=ot[Ct].y:ot[Ct].y>Nt&&(Nt=ot[Ct].y);return[gt,ct,Pt-gt,Nt-ct]}(u),Ce=ot=>[(ot.x-ee)/fe,(ot.y-pe)/me],[Ae,Le,$e,Ze]=u.map(Ce),nt=function(ot,gt,Pt,ct,Nt,Ct,Tt,_n){const un=sT(0,0,1,0,1,1,0,1),Kt=sT(ot,gt,Pt,ct,Nt,Ct,Tt,_n),Ot=a.bE.adjoint([],Kt);return a.bE.multiply(un,un,Ot)}(Ae[0],Ae[1],Le[0],Le[1],$e[0],$e[1],Ze[0],Ze[1]);this.elevatedGlobePerspectiveTransform=IF(Ae[0],Ae[1],Le[0],Le[1],$e[0],$e[1],Ze[0],Ze[1]);const Ke=(ot,gt)=>{C.push(ot.lng);const Pt=Math.round((ot.lng-M)/j*Dt),ct=Math.round((ot.lat-z)/V*Dt),Nt=Ce(gt),Ct=a.$.transformMat3([],[Nt[0],Nt[1],1],nt),Tt=Math.round(Ct[0]/Ct[2]*Dt),_n=Math.round(Ct[1]/Ct[2]*Dt);$.emplaceBack(Pt,ct,Tt,_n)},at=u[3].x-u[0].x,bt=u[3].y-u[0].y,lt=u[2].x-u[1].x,St=u[2].y-u[1].y;for(let ot=0;ot<65;ot++){const gt=ot/64,Pt=[u[0].x+gt*at,u[0].y+gt*bt],ct=[u[1].x+gt*lt,u[1].y+gt*St],Nt=ct[0]-Pt[0],Ct=ct[1]-Pt[1];for(let Tt=0;Tt<65;Tt++){const _n=Tt/64,un={x:Pt[0]+Nt*_n,y:Pt[1]+Ct*_n,z:0};Ke(o.projection.unproject(un.x,un.y),un)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer($,nT.members)}{this.maxLongitudeTriangleSize=0;let $=[],ee=new Fs;const pe=(fe,me,Ce)=>{ee.emplaceBack(fe,me,Ce);const Ae=C[fe],Le=C[me],$e=C[Ce],Ze=Math.min(Math.min(Ae,Le),$e),nt=Math.max(Math.max(Ae,Le),$e)-Ze;nt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=nt),$.push(Ze+nt/2)};for(let fe=0;fe<64;fe++)for(let me=0;me<64;me++){const Ce=65*fe+me,Ae=Ce+1,Le=Ce+65,$e=Le+1;pe(Ce,Le,Ae),pe(Ae,Le,$e)}[$,ee]=function(fe,me){const Ce=Array.from({length:fe.length},($e,Ze)=>Ze);Ce.sort(($e,Ze)=>fe[$e]-fe[Ze]);const Ae=[],Le=new Fs;for(let $e=0;$e<Ce.length;$e++){const Ze=Ce[$e];Ae.push(fe[Ze]);const nt=3*Ze,Ke=nt+1;Le.emplaceBack(me.uint16[nt],me.uint16[Ke],me.uint16[Ke+1])}return[Ae,Le]}($,ee),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(ee)}this.elevatedGlobeSegments=gi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,j/Dt,0,V/Dt,0,0,z,M,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof eT||(this.texture?this.texture.update(this.image):(this.texture=new Ml(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(o)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=n+180)+360*Math.round((u[0]-p)/360);var p;const m=new gi,v=(P,M)=>{m.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:o.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=w){const P=ue(u,0,u.length,h+w);return P===u.length||v(P,K(u,P+1,u.length,h+360-w)-P),m}h<u[0]&&(h+=360);const E=K(u,0,u.length,h-w);if(E===u.length)return v(0,u.length),m;v(0,E-0);const C=ue(u,E+1,u.length,h+w);return C!==u.length&&v(C,u.length-C),m}}const jY=(Math.pow(256,2)-1)/16907520;class AF extends da{constructor(n,o,u,h){super(n,{layout:EF||(EF=new Vr({visibility:new Et(Je.layout_raster.visibility)})),paint:SF||(SF=new Vr({"raster-opacity":new Et(Je.paint_raster["raster-opacity"]),"raster-color":new _o(Je.paint_raster["raster-color"]),"raster-color-mix":new Et(Je.paint_raster["raster-color-mix"]),"raster-color-range":new Et(Je.paint_raster["raster-color-range"]),"raster-hue-rotate":new Et(Je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Et(Je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Et(Je.paint_raster["raster-brightness-max"]),"raster-saturation":new Et(Je.paint_raster["raster-saturation"]),"raster-contrast":new Et(Je.paint_raster["raster-contrast"]),"raster-resampling":new Et(Je.paint_raster["raster-resampling"]),"raster-fade-duration":new Et(Je.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Et(Je.paint_raster["raster-emissive-strength"]),"raster-array-band":new Et(Je.paint_raster["raster-array-band"]),"raster-elevation":new Et(Je.paint_raster["raster-elevation"])}))},o,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof CF&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=J0({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let PF,RF,MF,kF,DF;class OF extends da{constructor(n,o,u,h){super(n,{layout:PF||(PF=new Vr({visibility:new Et(Je["layout_raster-particle"].visibility)})),paint:RF||(RF=new Vr({"raster-particle-array-band":new Et(Je["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Et(Je["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new _o(Je["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Et(Je["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Et(Je["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Et(Je["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Et(Je["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Et(Je["paint_raster-particle"]["raster-particle-elevation"])}))},o,u,h),this._updateColorRamp(),this.lastInvalidatedAt=en.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=J0({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=en.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class UY extends da{constructor(n,o){super(n,{},o,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function a3(i,n,o){const u=[0,0,1],h=a.aw.identity([]);return a.aw.rotateY(h,h,o?-er(i)+Math.PI:er(i)),a.aw.rotateX(h,h,-er(n)),a.$.transformQuat(u,u,h),a.$.normalize(u,u)}function LF(i,n){const o=aT(i.projection,i.zoom,i.width,i.height),u=function(p,m,v,w,E){const C=new wr(v.lng-180*Hd,v.lat),P=new wr(v.lng+180*Hd,v.lat),M=p.project(C.lng,C.lat),z=p.project(P.lng,P.lat),j=-Math.atan2(z.y-M.y,z.x-M.x),V=yo.fromLngLat(v);V.y=Wn(V.y,-1+Hd,1-Hd);const $=V.toLngLat(),ee=p.project($.lng,$.lat),pe=yo.fromLngLat($);pe.x+=Hd;const fe=pe.toLngLat(),me=p.project(fe.lng,fe.lat),Ce=FF(me.x-ee.x,me.y-ee.y,j),Ae=yo.fromLngLat($);Ae.y+=Hd;const Le=Ae.toLngLat(),$e=p.project(Le.lng,Le.lat),Ze=FF($e.x-ee.x,$e.y-ee.y,j),nt=Math.abs(Ce.x)/Math.abs(Ze.y),Ke=a.ae.identity([]);a.ae.rotateZ(Ke,Ke,-j*(1-(E?0:w)));const at=a.ae.identity([]);return a.ae.scale(at,at,[1,1-(1-nt)*w,1]),at[4]=-Ze.x/Ze.y*w,a.ae.rotateZ(at,at,j),a.ae.multiply(at,Ke,at),at}(i.projection,0,i.center,o,n),h=zF(i);return a.ae.scale(u,u,[h,h,1]),u}function zF(i){const n=i.projection,o=aT(i.projection,i.zoom,i.width,i.height),u=NF(n,i.center),h=NF(n,wr.convert(n.center));return Math.pow(2,u*o+(1-o)*h)}function aT(i,n,o,u,h=1/0){const p=i.range;if(!p)return 0;const m=Math.min(h,Math.max(o,u)),v=Math.log(m/1024)/Math.LN2;return na(p[0]+v,p[1]+v,n)}const Hd=1/4e4;function NF(i,n){const o=Wn(n.lat,-Ui,Ui),u=new wr(n.lng-180*Hd,o),h=new wr(n.lng+180*Hd,o),p=i.project(u.lng,o),m=i.project(h.lng,o),v=yo.fromLngLat(u),w=yo.fromLngLat(h),E=m.x-p.x,C=m.y-p.y,P=w.x-v.x,M=w.y-v.y,z=Math.sqrt((P*P+M*M)/(E*E+C*C));return Math.log(z)/Math.LN2}function FF(i,n,o){const u=Math.cos(o),h=Math.sin(o);return{x:i*u-n*h,y:i*h+n*u}}function BF(i,n,o){a.ae.identity(i),a.ae.rotateZ(i,i,er(n[2])),a.ae.rotateX(i,i,er(n[0])),a.ae.rotateY(i,i,er(n[1])),a.ae.scale(i,i,o),a.ae.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function lT(i,n,o,u,h,p,m,v){const w=[o[0]-n[0],o[1]-n[1],0],E=[u[0]-n[0],u[1]-n[1],0];if(a.$.length(w)<1e-12||a.$.length(E)<1e-12)return a.aw.identity(i);const C=a.$.cross([],w,E);a.$.normalize(C,C),a.$.subtract(E,u,n),w[2]=(p-h)*v,E[2]=(m-h)*v;const P=w;return a.$.cross(P,w,E),a.$.normalize(P,P),a.aw.rotationTo(i,C,P)}function l3(i,n,o=!1){const u=xh(n.zoom),h=function(p,m,v){const w=m.worldSize,E=[p[12],p[13],p[14]],C=Hs(E[1]/w),P=fa(E[0]/w),M=a.ae.identity([]),z=Vo(1,C)*w,j=Vo(1,0)*w*Fp(C,m.zoom),V=1/IP(w);let $=j*V;if(v){const me=aT(m.projection,m.zoom,m.width,m.height,1024);$=V*m.projection.pixelSpaceConversion(m.center.lat,w,me)}const ee=zp(C,P);a.$.add(ee,ee,a.$.scale([],a.$.normalize([],ee),z*$*E[2]));const pe=function(me){const Ce=[me[0],me[1],me[2]];let Ae=[0,1,0];const Le=a.$.cross([],Ae,Ce);return a.$.cross(Ae,Ce,Le),a.$.squaredLength(Ae)===0&&(Ae=[0,1,0],a.$.cross(Le,Ce,Ae)),a.$.normalize(Le,Le),a.$.normalize(Ae,Ae),a.$.normalize(Ce,Ce),[Le[0],Le[1],Le[2],0,Ae[0],Ae[1],Ae[2],0,Ce[0],Ce[1],Ce[2],0,me[0],me[1],me[2],1]}(ee);a.ae.scale(M,M,[$,$,$*z]),a.ae.translate(M,M,[-E[0],-E[1],-E[2]]);const fe=a.ae.multiply([],m.globeMatrix,pe);return a.ae.multiply(fe,fe,M),a.ae.multiply(fe,fe,p),fe}(i,n,o);if(u>0){const p=function(m,v){const w=v.worldSize,E=Vo(1,0)*w*Fp(v.center.lat,v.zoom)/IP(w),C=Vo(1,v.center.lat)*w,P=a.ae.identity([]);return a.ae.rotateY(P,P,er(v.center.lng)),a.ae.rotateX(P,P,er(v.center.lat)),a.ae.translate(P,P,[0,0,Uo]),a.ae.scale(P,P,[E,E,E*C]),a.ae.translate(P,P,[v.point.x-.5*w,v.point.y-.5*w,0]),a.ae.multiply(P,P,m),a.ae.multiply(P,v.globeMatrix,P)}(i,n);return function(m,v,w){const E=(j,V,$)=>{const ee=a.$.length(j),pe=a.$.length(V),fe=vh(j,V,$);return a.$.scale(fe,fe,1/a.$.length(fe)*xn(ee,pe,$))},C=E([m[0],m[1],m[2]],[v[0],v[1],v[2]],w),P=E([m[4],m[5],m[6]],[v[4],v[5],v[6]],w),M=E([m[8],m[9],m[10]],[v[8],v[9],v[10]],w),z=vh([m[12],m[13],m[14]],[v[12],v[13],v[14]],w);return[C[0],C[1],C[2],0,P[0],P[1],P[2],0,M[0],M[1],M[2],0,z[0],z[1],z[2],1]}(h,p,u)}return h}function jF(i,n,o,u){const h=ci.projectAabbCorners(u,o);let p=Number.MAX_VALUE,m=-1;for(let E=0;E<h.length;++E){const C=h[E];C[0]=(.5*C[0]+.5)*n.width,C[1]=(.5-.5*C[1])*n.height,C[2]<p&&(m=E,p=C[2])}const v=E=>new Lt(h[E][0],h[E][1]);let w;switch(m){case 0:case 6:w=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:w=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:w=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:w=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(gP(i,w))return p}const VY=Pr([{name:"a_pos_3f",components:3,type:"Float32"}]),$Y=Pr([{name:"a_color_3f",components:3,type:"Float32"}]),qY=Pr([{name:"a_color_4f",components:4,type:"Float32"}]),GY=Pr([{name:"a_uv_2f",components:2,type:"Float32"}]),WY=Pr([{name:"a_normal_3f",components:3,type:"Float32"}]),HY=Pr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),ZY=Pr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class cT{constructor(n,o,u,h){this.message=(n?`${n}: `:"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)}}function UF(i,n){const o=i.indexOf("://")===-1;try{return new URL(i,o&&n?"http://example.com":void 0),!0}catch{return!1}}class VF{constructor(n,o){this.feature=n,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class $F{constructor(){this.instancedDataArray=new JA,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class c3{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,o){}populate(n,o,u,h){this.tileToMeter=yw(u);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of n){const C=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),P=yh(m,p);if(!this.layers[0]._featureFilter.filter(new In(this.zoom),P,u))continue;const M={id:C,sourceLayerIndex:E,index:w,geometry:p?P.geometry:bc(m,u,h),properties:m.properties,type:m.type,patterns:{}},z=this.addFeature(M,M.geometry,P);z&&o.featureIndex.insert(m,M.geometry,w,E,this.index,this.instancesPerModel[z].instancedDataArray.length,Dt/32)}this.lookup=null}update(n,o,u,h){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const v in n)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],n[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const h of u.features){const p=this.layers[0],m=h.feature,v=this.canonical,w=p.paint.get("model-rotation").evaluate(m,{},v),E=p.paint.get("model-scale").evaluate(m,{},v),C=p.paint.get("model-translation").evaluate(m,{},v);a.$.exactEquals(h.rotation,w)&&a.$.exactEquals(h.scale,E)&&a.$.exactEquals(h.translation,C)||(this.evaluate(h,h.featureStates,u,!0),n=!0)}}return n}updateReplacement(n,o,u,h){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const p=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(zP(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const v in this.instancesPerModel){const w=this.instancesPerModel[v],E=w.instancedDataArray;for(const C of w.features){const P=C.instancedDataOffset,M=C.instancedDataCount;for(let z=0;z<M;z++){const j=16*(z+P);let V=E.float32[j+0];V=V>Dt?V-Dt:V;const $=Math.floor(V),ee=E.float32[j+1];let pe=!1;for(const fe of this.activeReplacements)if(!Mz(fe,u,Gz.Model,h)&&!(fe.min.x>$||$>fe.max.x||fe.min.y>ee||ee>fe.max.y)&&(pe=Nz(zz($,ee,n.canonical,fe.footprintTileId.canonical),fe),pe))break;E.float32[j]=pe?V+Dt:V,m=m||pe}}}return m}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=n.createVertexBuffer(u.instancedDataArray,HY.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const o of this.modelUris)n.removeModel(o,"")}addFeature(n,o,u){const h=this.layers[0],p=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!p)return bi(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;UF(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new $F);const m=this.instancesPerModel[p],v=m.instancedDataArray,w=new VF(u,v.length);for(const E of o)for(const C of E){if(C.x<0||C.x>=Dt||C.y<0||C.y>=Dt)continue;const P=(this.lookupDim-1)/Dt,M=this.lookupDim*(C.y*P|0)+C.x*P|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const z=v.length;v.resize(z+1),m.instancesEvaluatedElevation.push(0),v.float32[16*z]=C.x,v.float32[16*z+1]=C.y}return w.instancedDataCount=m.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(n.id&&(m.idToFeaturesIndex[n.id]=m.features.length),m.features.push(w),this.evaluate(w,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(n,o,u,h){const p=this.layers[0],m=n.feature,v=this.canonical,w=n.rotation=p.paint.get("model-rotation").evaluate(m,o,v),E=n.scale=p.paint.get("model-scale").evaluate(m,o,v),C=n.translation=p.paint.get("model-translation").evaluate(m,o,v),P=p.paint.get("model-color").evaluate(m,o,v);P.a=p.paint.get("model-color-mix-intensity").evaluate(m,o,v);const M=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),BF(M,w,E);const z=Math.round(100*P.a)+P.b/1.05;for(let j=0;j<n.instancedDataCount;++j){const V=n.instancedDataOffset+j,$=16*V,ee=u.instancedDataArray.float32;let pe=0;h&&(pe=ee[$+6]-u.instancesEvaluatedElevation[V]);const fe=0|ee[$+1];ee[$]=(0|ee[$])+P.r/1.05,ee[$+1]=fe+P.g/1.05,ee[$+2]=z,ee[$+3]=1/(v.z>10?this.tileToMeter:yw(v,fe)),ee[$+4]=C[0],ee[$+5]=C[1],ee[$+6]=C[2]+pe,ee[$+7]=M[0],ee[$+8]=M[1],ee[$+9]=M[2],ee[$+10]=M[4],ee[$+11]=M[5],ee[$+12]=M[6],ee[$+13]=M[8],ee[$+14]=M[9],ee[$+15]=M[10],u.instancesEvaluatedElevation[V]=C[2]}}}let qF,GF;Ve(c3,"ModelBucket",{omit:["layers"]}),Ve($F,"PerModelAttributes"),Ve(VF,"ModelFeature");const qp=64,d_={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function WF(i,n,o,u,h,p,m,v,w,E=!1){const C=o.zoom,P=o.project(u),M=Fp(u.lat,C),z=1/M;a.ae.identity(i),a.ae.translate(i,i,[P.x+m[0]*z,P.y+m[1]*z,m[2]]);let j=1,V=1;const $=o.worldSize;if(E){if(o.projection.name==="mercator"){let me=0;o.elevation&&(me=o.elevation.getAtPointOrZero(new yo(P.x/$,P.y/$),0));const Ce=a.aB.transformMat4([],[P.x,P.y,me,1],o.projMatrix)[3]/o.cameraToCenterDistance;j=Ce,V=Ce*Fp(o.center.lat,C)}else if(o.projection.name==="globe"){const me=l3(i,o),Ce=a.ae.multiply([],o.projMatrix,me),Ae=[0,0,0,1];a.aB.transformMat4(Ae,Ae,Ce);const Le=Ae[3]/o.cameraToCenterDistance,$e=xh(C),Ze=o.projection.pixelsPerMeter(u.lat,$)*Fp(u.lat,C),nt=o.projection.pixelsPerMeter(o.center.lat,$)*Fp(o.center.lat,C);j=Le/xn(Ze,OL(o.center.lat),$e),V=Le*M/Ze,j*=nt,V*=nt}}else j=z;a.ae.scale(i,i,[j,j,V]);const ee=[...i],pe=n.orientation,fe=[];if(BF(fe,[pe[0]+h[0],pe[1]+h[1],pe[2]+h[2]],p),a.ae.multiply(i,ee,fe),v&&o.elevation){let me=0;const Ce=[];if(w&&o.elevation){me=function($e,Ze,nt,Ke,at){const bt=Ze.elevation;if(!bt)return 0;const lt=ci.projectAabbCorners(nt,Ke),St=Vo(1,at.lat)*Ze.worldSize,ot=function(En,fn){const sn=[0,0,1],Dn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const zn of Dn){const On=En[zn.corners[0]],Gn=En[zn.corners[1]],mr=En[zn.corners[2]],sr=[Gn[0]-On[0],Gn[1]-On[1],fn*(Gn[2]-On[2])],Br=a.$.cross(sr,sr,[mr[0]-On[0],mr[1]-On[1],fn*(mr[2]-On[2])]);a.$.normalize(Br,Br),zn.dotProductWithUp=a.$.dot(Br,sn)}return Dn.sort((zn,On)=>zn.dotProductWithUp-On.dotProductWithUp),Dn[0].corners}(lt,St),gt=lt[ot[0]],Pt=lt[ot[1]],ct=lt[ot[2]],Nt=lt[ot[3]],Ct=bt.getAtPointOrZero(new yo(gt[0]/Ze.worldSize,gt[1]/Ze.worldSize),0),Tt=bt.getAtPointOrZero(new yo(Pt[0]/Ze.worldSize,Pt[1]/Ze.worldSize),0),_n=bt.getAtPointOrZero(new yo(ct[0]/Ze.worldSize,ct[1]/Ze.worldSize),0),un=bt.getAtPointOrZero(new yo(Nt[0]/Ze.worldSize,Nt[1]/Ze.worldSize),0),Kt=(Ct+un)/2,Ot=(Tt+_n)/2;return Kt>Ot?Tt<_n?lT($e,Pt,Nt,gt,Tt,un,Ct,St):lT($e,ct,gt,Nt,_n,Ct,un,St):Ct<un?lT($e,gt,Pt,ct,Ct,Tt,_n,St):lT($e,Nt,ct,Pt,un,_n,Tt,St),Math.max(Kt,Ot)}(Ce,o,n.aabb,i,u);const Ae=a.ae.fromQuat([],Ce),Le=a.ae.multiply([],Ae,fe);a.ae.multiply(i,ee,Le)}else me=o.elevation.getAtPointOrZero(new yo(P.x/$,P.y/$),0);me!==0&&(i[14]+=me)}}function Ev(i,n,o=!1){i.uploaded||(i.gfxTexture=new Ml(n,i.image,o?n.gl.R8:n.gl.RGBA,{useMipmap:i.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function XY(i,n,o){i.indexBuffer=n.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=n.createVertexBuffer(i.vertexArray,VY.members,!1,!0),i.normalArray&&(i.normalBuffer=n.createVertexBuffer(i.normalArray,WY.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=n.createVertexBuffer(i.texcoordArray,GY.members,!1,!0)),i.colorArray&&(i.colorBuffer=n.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?$Y:qY).members,!1,!0)),i.featureArray&&(i.pbrBuffer=n.createVertexBuffer(i.featureArray,ZY.members,!0)),i.segments=gi.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);const u=i.material;u.pbrMetallicRoughness.baseColorTexture&&Ev(u.pbrMetallicRoughness.baseColorTexture,n),u.pbrMetallicRoughness.metallicRoughnessTexture&&Ev(u.pbrMetallicRoughness.metallicRoughnessTexture,n),u.normalTexture&&Ev(u.normalTexture,n),u.occlusionTexture&&Ev(u.occlusionTexture,n,o),u.emissionTexture&&Ev(u.emissionTexture,n)}function u3(i,n,o){if(i.meshes)for(const u of i.meshes)XY(u,n,o);if(i.children)for(const u of i.children)u3(u,n,o)}function uT(i){if(i.meshes)for(const n of i.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(i.children)for(const n of i.children)uT(n)}function h3(i){if(i.meshes)for(const o of i.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((n=o.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(i.children)for(const o of i.children)h3(o)}class KY{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class QY{constructor(){this.tasks={},this.taskQueue=[],th(["process"],this),this.invoker=new KY(this.process),this.nextId=0}add(n,o){const u=this.nextId++,h=function({type:p,isSymbolTile:m,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-v:p==="maybePrepare"&&m?400-v:500:200-v:100-v}(o);if(h===0){try{n()}finally{}return null}return this.tasks[u]={fn:n,metadata:o,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let n=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<o&&(o=p.priority,n=h)}if(n===null)return null;const u=this.taskQueue[n];return this.taskQueue.splice(n,1),u}remove(){this.invoker.remove()}}class HF{constructor(n,o,u){this.target=n,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},th(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new QY}send(n,o,u,h,p=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=m,this.callbacks[v]=u);const w=new Set;return this.target.postMessage({id:v,type:n,hasCallback:!!u,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:He(o,w)},w),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(n){const o=n.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(o.mustQueue||Fo()){const h=this.callbacks[u],p=this.scheduler.add(()=>this.processTask(u,o),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[u]=p)}else this.processTask(u,o)}processTask(n,o){if(delete this.cancelCallbacks[n],o.type==="<response>"){const u=this.callbacks[n];delete this.callbacks[n],u&&(o.error?u(it(o.error)):u(null,it(o.data)))}else{const u=new Set,h=o.hasCallback?(m,v)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:m?He(m):null,data:He(v,u)},u)}:m=>{},p=it(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,h);else if(this.parent.getWorkerSource){const m=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,m[0],p.source,p.scope)[m[1]](p,h)}else h(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class f_{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=ac();const u=this.workerPool.acquire(this.id);for(let h=0;h<u.length;h++){const p=new f_.Actor(u[h],o,this.id);p.name=`Worker ${h}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,u){eh(this.actors,(h,p)=>{h.send(n,o,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}f_.Actor=HF;var Sv={workerUrl:"",workerClass:null,workerParams:void 0};function YY(){return Sv.workerClass!=null?new Sv.workerClass:new self.Worker(Sv.workerUrl,Sv.workerParams)}const d3="mapboxgl_preloaded_worker_pool";class Iv{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Iv.workerCount;)this.workers.push(new YY);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[d3]}numActive(){return Object.keys(this.active).length}}let Cv;function hT(){return Cv||(Cv=new Iv),Cv}Iv.workerCount=2;let dT,f3,Cc,p_,p3,m_=null;function ZF(){return Fo()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:f3||O.DRACO_URL}function XF(){if(Fo()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(p_)return p_;const i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return p_=WebAssembly.validate(i)?O.MESHOPT_SIMD_URL:O.MESHOPT_URL,p_}const fT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},JY={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Av={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function KF(i,n,o){const u=o.json.bufferViews.length,h=o.buffers.length;n.bufferView=u,o.json.bufferViews[u]={buffer:h,byteLength:i.byteLength},o.buffers[h]=i}const m3="KHR_draco_mesh_compression";function eJ(i,n){const o=i.extensions&&i.extensions[m3];if(!o)return;const u=new Cc.Decoder,h=eB(n,o.bufferView),p=new Cc.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=n.json.accessors[i.indices],v=fT[m.componentType],w=m.count*v.BYTES_PER_ELEMENT,E=Cc._malloc(w);v===Uint16Array?u.GetTrianglesUInt16Array(p,w,E):u.GetTrianglesUInt32Array(p,w,E),KF(Cc.memory.buffer.slice(E,E+w),m,n),Cc._free(E);for(const C of Object.keys(o.attributes)){const P=u.GetAttributeByUniqueId(p,o.attributes[C]),M=n.json.accessors[i.attributes[C]],z=JY[M.componentType],j=M.count*Av[M.type]*fT[M.componentType].BYTES_PER_ELEMENT,V=Cc._malloc(j);u.GetAttributeDataArrayForAllPoints(p,P,Cc[z],j,V),KF(Cc.memory.buffer.slice(V,V+j),M,n),Cc._free(V)}u.destroy(),p.destroy(),delete i.extensions[m3]}const pT="EXT_meshopt_compression";function tJ(i,n){if(!i.extensions||!i.extensions[pT])return;const o=i.extensions[pT],u=new Uint8Array(n.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),h=new Uint8Array(o.count*o.byteStride);p3.decodeGltfBuffer(h,o.count,o.byteStride,u,o.mode,o.filter),i.buffer=n.buffers.length,i.byteOffset=0,n.buffers[i.buffer]=h.buffer,delete i.extensions[pT]}const QF=1179937895,YF=new TextDecoder("utf8");function JF(i,n){return new URL(i,n).href}function nJ(i,n,o,u){return fetch(JF(i.uri,u)).then(h=>h.arrayBuffer()).then(h=>{n.buffers[o]=h})}function eB(i,n){const o=i.json.bufferViews[n];return new Uint8Array(i.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function rJ(i,n,o,u){if(i.uri){const h=JF(i.uri,u);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{n.images[o]=p})}if(i.bufferView!==void 0){const h=eB(n,i.bufferView),p=new Blob([h],{type:i.mimeType});return createImageBitmap(p).then(m=>{n.images[o]=m})}}function tB(i,n=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(i,n,1)[0]===QF){const C=new Uint32Array(i,n);let P=2;const M=(C[P++]>>2)-3,z=C[P++]>>2;if(P++,u.json=JSON.parse(YF.decode(C.subarray(P,P+z))),P+=z,P<M){const j=C[P++];P++;const V=n+(P<<2);u.buffers[0]=i.slice(V,V+j)}}else u.json=JSON.parse(YF.decode(new Uint8Array(i,n)));const{buffers:h,images:p,meshes:m,extensionsUsed:v,bufferViews:w}=u.json;let E=Promise.resolve();if(h){const C=[];for(let P=0;P<h.length;P++){const M=h[P];M.uri?C.push(nJ(M,u,P,o)):u.buffers[P]||(u.buffers[P]=null)}E=Promise.all(C)}return E.then(()=>{const C=[],P=v&&v.includes(m3),M=v&&v.includes(pT);if(P&&C.push(function(){if(!Cc)return dT||(dT=function(z){let j,V=null;function $(){j=new Uint8Array(V.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const pe={a:{a:ee,d:function(fe,me,Ce){return j.copyWithin(fe,me,me+Ce)},c:function(fe){const me=j.length,Ce=Math.max(fe>>>0,Math.ceil(1.2*me)),Ae=Math.ceil((Ce-me)/65536);try{return V.grow(Ae),$(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,pe):z.then(fe=>fe.arrayBuffer()).then(fe=>WebAssembly.instantiate(fe,pe))).then(fe=>{const{Rb:me,Qb:Ce,P:Ae,T:Le,X:$e,Ja:Ze,La:nt,Qa:Ke,Va:at,Wa:bt,eb:lt,jb:St,f:ot,e:gt,yb:Pt,zb:ct,Ab:Nt,Bb:Ct,Db:Tt,Gb:_n}=fe.instance.exports;V=gt;const un=(()=>{let Kt=0,Ot=0,En=0,fn=0;return sn=>{En&&(me(fn),me(Kt),Ot+=En,En=Kt=0),Kt||(Ot+=128,Kt=Ce(Ot));const Dn=sn.length+7&-8;let zn=Kt;Dn>=Ot&&(En=Dn,zn=fn=Ce(Dn));for(let On=0;On<sn.length;On++)j[zn+On]=sn[On];return zn}})();return $(),ot(),{memory:gt,_free:me,_malloc:Ce,Mesh:class{constructor(){this.ptr=Ae()}destroy(){Le(this.ptr)}},Decoder:class{constructor(){this.ptr=Ze()}destroy(){St(this.ptr)}DecodeArrayToMesh(Kt,Ot,En){const fn=un(Kt),sn=nt(this.ptr,fn,Ot,En.ptr);return!!$e(sn)}GetAttributeByUniqueId(Kt,Ot){return{ptr:Ke(this.ptr,Kt.ptr,Ot)}}GetTrianglesUInt16Array(Kt,Ot,En){at(this.ptr,Kt.ptr,Ot,En)}GetTrianglesUInt32Array(Kt,Ot,En){bt(this.ptr,Kt.ptr,Ot,En)}GetAttributeDataArrayForAllPoints(Kt,Ot,En,fn,sn){lt(this.ptr,Kt.ptr,Ot.ptr,En,fn,sn)}},DT_INT8:Pt(),DT_UINT8:ct(),DT_INT16:Nt(),DT_UINT16:Ct(),DT_UINT32:Tt(),DT_FLOAT32:_n()}})}(fetch(ZF())),dT.then(z=>{Cc=z,dT=void 0}))}()),M&&C.push(function(){if(p3)return;const z=function(j){let V;const $=WebAssembly.instantiateStreaming(j,{}).then(fe=>{V=fe.instance,V.exports.__wasm_call_ctors()}),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},pe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(fe,me,Ce,Ae,Le,$e){(function(Ze,nt,Ke,at,bt,lt,St){const ot=Ze.exports.sbrk,gt=at+3&-4,Pt=ot(gt*bt),ct=ot(lt.length),Nt=new Uint8Array(Ze.exports.memory.buffer);Nt.set(lt,ct);const Ct=nt(Pt,at,bt,ct,lt.length);if(Ct===0&&St&&St(Pt,gt,bt),Ke.set(Nt.subarray(Pt,Pt+at*bt)),ot(Pt-ot(0)),Ct!==0)throw new Error(`Malformed buffer data: ${Ct}`)})(V,V.exports[pe[Le]],fe,me,Ce,Ae,V.exports[ee[$e]])}}}(fetch(XF()));return z.ready.then(()=>{p3=z})}()),p)for(let z=0;z<p.length;z++)C.push(rJ(p[z],u,z,o));return(C.length?Promise.all(C):Promise.resolve()).then(()=>{if(P&&m)for(const{primitives:z}of m)for(const j of z)eJ(j,u);if(M&&m&&w)for(const z of w)tJ(z,u);return u})})}function Gp(i,n){const o=i.json.bufferViews[n.bufferView],u=fT[n.componentType];return new u(i.buffers[o.buffer],(n.byteOffset||0)+(o.byteOffset||0),n.count*(o.byteStride&&o.byteStride!==Av[n.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:Av[n.type]))}function g3(i,n,o,u){const h=fT[n.componentType],p=function(C){switch(C){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),m=i.json.bufferViews[n.bufferView],v=m.byteStride?m.byteStride/h.BYTES_PER_ELEMENT:Av[n.type],w=o.float32,E=w.length/o.capacity;for(let C=0,P=0;C<n.count*v;C+=v,P+=E)for(let M=0;M<E;M++)w[P+M]=u[C+M]*p;o._trim()}function iJ(i,n,o){const u=i.indices,h=i.attributes,p={};p.indexArray=new Fs;const m=n.json.accessors[u],v=m.count/3;p.indexArray.reserve(v);const w=Gp(n,m);for(let M=0;M<v;M++)p.indexArray.emplaceBack(w[3*M],w[3*M+1],w[3*M+2]);p.indexArray._trim(),p.vertexArray=new kd;const E=n.json.accessors[h.POSITION];p.vertexArray.reserve(E.count);const C=Gp(n,E);for(let M=0;M<E.count;M++)p.vertexArray.emplaceBack(C[3*M],C[3*M+1],C[3*M+2]);if(p.vertexArray._trim(),p.aabb=new ci(E.min,E.max),p.centroid=function(M,z){const j=[0,0,0],V=M.length;if(V>0){for(let $=0;$<V;$++){const ee=3*M[$];j[0]+=z[ee],j[1]+=z[ee+1],j[2]+=z[ee+2]}j[0]/=V,j[1]/=V,j[2]/=V}return j}(w,C),h.COLOR_0!==void 0){const M=n.json.accessors[h.COLOR_0],z=Av[M.type],j=Gp(n,M);p.colorArray=z===3?new kd:new Md,p.colorArray.resize(M.count),g3(n,M,p.colorArray,j)}if(h.NORMAL!==void 0){p.normalArray=new kd;const M=n.json.accessors[h.NORMAL];p.normalArray.resize(M.count);const z=Gp(n,M);g3(n,M,p.normalArray,z)}if(h.TEXCOORD_0!==void 0&&o.length>0){p.texcoordArray=new G0;const M=n.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(M.count);const z=Gp(n,M);g3(n,M,p.texcoordArray,z)}if(h._FEATURE_ID_RGBA4444!==void 0){const M=n.json.accessors[h._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Gp(n,M))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Gp(n,n.json.accessors[h._FEATURE_RGBA4444]).buffer));const P=i.material;return p.material=function(M,z){const{emissiveFactor:j=[0,0,0],alphaMode:V="OPAQUE",alphaCutoff:$=.5,normalTexture:ee,occlusionTexture:pe,emissiveTexture:fe,doubleSided:me}=M,{baseColorFactor:Ce=[1,1,1,1],metallicFactor:Ae=1,roughnessFactor:Le=1,baseColorTexture:$e,metallicRoughnessTexture:Ze}=M.pbrMetallicRoughness||{},nt=pe?z[pe.index]:void 0;if(pe&&pe.extensions&&pe.extensions.KHR_texture_transform&&nt){const Ke=pe.extensions.KHR_texture_transform;nt.offsetScale=[Ke.offset[0],Ke.offset[1],Ke.scale[0],Ke.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Er(...Ce),metallicFactor:Ae,roughnessFactor:Le,baseColorTexture:$e?z[$e.index]:void 0,metallicRoughnessTexture:Ze?z[Ze.index]:void 0},doubleSided:me,emissiveFactor:j,alphaMode:V,alphaCutoff:$,normalTexture:ee?z[ee.index]:void 0,occlusionTexture:nt,emissionTexture:fe?z[fe.index]:void 0,defined:M.defined===void 0}}(P!==void 0?n.json.materials[P]:{defined:!1},o),p}function nB(i,n,o){const{matrix:u,rotation:h,translation:p,scale:m,mesh:v,extras:w,children:E}=i,C={};if(C.matrix=u||a.ae.fromRotationTranslationScale([],h||[0,0,0,1],p||[0,0,0],m||[1,1,1]),v!==void 0){C.meshes=o[v];const P=C.anchor=[0,0];for(const M of C.meshes){const{min:z,max:j}=M.aabb;P[0]+=z[0]+j[0],P[1]+=z[1]+j[1]}P[0]=Math.floor(P[0]/C.meshes.length/2),P[1]=Math.floor(P[1]/C.meshes.length/2)}if(w&&(w.id&&(C.id=w.id),w.lights&&(C.lights=function(P){if(!P.length)return[];const M=function(ee){const pe=atob(ee),fe=new Uint8Array(pe.length);for(let me=0;me<pe.length;me++)fe[me]=pe.codePointAt(me);return fe}(P),z=[],j=M.length/24,V=new Uint16Array(M.buffer),$=new Float32Array(M.buffer);for(let ee=0;ee<j;ee++){const pe=V[2*ee*6]/30,fe=V[2*ee*6+1]/30,me=V[2*ee*6+10]/100,Ce=$[6*ee+1],Ae=$[6*ee+2],Le=$[6*ee+3],$e=$[6*ee+4],Ze=Le-Ce,nt=$e-Ae,Ke=Math.hypot(Ze,nt);z.push({pos:[Ce+.5*Ze,Ae+.5*nt,fe],normal:[nt/Ke,-Ze/Ke,0],width:Ke,height:pe,depth:me,points:[Ce,Ae,Le,$e]})}return z}(w.lights))),E){const P=[];for(const M of E)P.push(nB(n.json.nodes[M],n,o));C.children=P}return C}function sJ(i){if(i.vertices.length===0||i.indices.length===0)return null;const n=new DP(i.vertices,i.indices,8,256),[o,u]=[n.min.clone(),n.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:n,min:o,max:u}}function oJ(i){if(!i.extras||!i.extras.ground)return null;const n=i.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const o=n[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const m of o){if(!Array.isArray(m)||m.length!==2)continue;const v=m[0],w=m[1];typeof v=="number"&&typeof w=="number"&&u.push(new Lt(v,w))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let m=0;m<u.length;m++){const v=u[m],w=u[(m+1)%u.length],E=u[(m+2)%u.length];h+=(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)}h>0&&u.reverse();const p=ev(u.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:u,indices:p}}function aJ(i,n){const o=[],u=[];let h=0;const p=[];for(const m of i){h=o.length;const v=m.vertexArray.float32,w=m.indexArray.uint16;for(let E=0;E<m.vertexArray.length;E++)p[0]=v[3*E+0],p[1]=v[3*E+1],p[2]=v[3*E+2],a.$.transformMat4(p,p,n),o.push(new Lt(p[0],p[1]));for(let E=0;E<3*m.indexArray.length;E++)u.push(w[E]+h)}if(u.length%3!=0)return null;for(let m=0;m<u.length;m+=3){const v=o[u[m+0]],w=o[u[m+1]],E=o[u[m+2]];(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)>0&&([u[m+1],u[m+2]]=[u[m+2],u[m+1]])}return{vertices:o,indices:u}}function rB(i){const n=function(w,E){const C=[],P=WebGL2RenderingContext;if(w.json.textures)for(const M of w.json.textures){const z={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};M.sampler!==void 0&&Object.assign(z,w.json.samplers[M.sampler]),C.push({image:E[M.source],sampler:z,uploaded:!1})}return C}(i,i.images),o=function(w,E){const C=[];for(const P of w.json.meshes){const M=[];for(const z of P.primitives)M.push(iJ(z,w,E));C.push(M)}return C}(i,n),{scenes:u,scene:h,nodes:p}=i.json,m=u?u[h||0].nodes:p,v=[];for(const w of m)v.push(nB(p[w],i,o));return function(w,E,C){const P={},M=new Set;for(let z=0;z<w.length;z++){const j=C[E[z]];if(!j.extras)continue;const V=j.extras["mapbox:footprint:version"],$=j.extras["mapbox:footprint:id"];(V||$)&&M.add(z),V==="1.0.0"&&$&&(P[$]=z)}for(let z=0;z<w.length;z++){if(M.has(z))continue;const j=w[z],V=C[E[z]];if(!V.extras)continue;let $=null;j.id in P&&($=aJ(w[P[j.id]].meshes,j.matrix)),$||($=oJ(V)),$&&(j.footprint=sJ($))}if(M.size>0){const z=Array.from(M.values()).sort((j,V)=>j-V);for(let j=z.length-1;j>=0;j--)w.splice(z[j],1)}}(v,m,i.json.nodes),v}function lJ(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);const n=i.vertexArray.float32,o=i.aabb.min[0]-1,u=i.aabb.min[1]-1,h=qp/(i.aabb.max[0]-o+2),p=qp/(i.aabb.max[1]-u+2);for(let m=0;m<n.length;m+=3){const v=n[m+2],w=(n[m+0]-o)*h|0,E=(n[m+1]-u)*p|0;v>i.heightmap[E*qp+w]&&(i.heightmap[E*qp+w]=v)}}function cJ(i,n){const o={};o.indexArray=new Fs,o.indexArray.reserve(4*i.length),o.vertexArray=new kd,o.vertexArray.reserve(10*i.length),o.colorArray=new Md,o.vertexArray.reserve(10*i.length);let u=0;for(const m of i){const v=Math.min(10,Math.max(4,1.3*m.height))*n,w=[-m.normal[1],m.normal[0],0],E=Math.min(.29,.1*m.width/m.depth),C=m.width-2*m.depth*n*(E+.01),P=a.$.scaleAndAdd([],m.pos,w,C/2),M=a.$.scaleAndAdd([],m.pos,w,-C/2),z=[P[0],P[1],P[2]+m.height],j=[M[0],M[1],M[2]+m.height],V=a.$.scaleAndAdd([],m.normal,w,E);a.$.scale(V,V,v);const $=a.$.scaleAndAdd([],m.normal,w,-E);a.$.scale($,$,v),a.$.add(V,P,V),a.$.add($,M,$),P[2]+=.1,M[2]+=.1,o.vertexArray.emplaceBack(V[0],V[1],V[2]),o.vertexArray.emplaceBack($[0],$[1],$[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(M[0],M[1],M[2]),o.vertexArray.emplaceBack(z[0],z[1],z[2]),o.vertexArray.emplaceBack(j[0],j[1],j[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(M[0],M[1],M[2]),o.vertexArray.emplaceBack(V[0],V[1],V[2]),o.vertexArray.emplaceBack($[0],$[1],$[2]);const ee=C/v/2;o.colorArray.emplaceBack(-ee-E,-1,ee,.8),o.colorArray.emplaceBack(ee+E,-1,ee,.8),o.colorArray.emplaceBack(-ee,0,ee,1.3),o.colorArray.emplaceBack(ee,0,ee,1.3),o.colorArray.emplaceBack(ee+E,-.8,ee,.7),o.colorArray.emplaceBack(ee+E,-.8,ee,.7),o.colorArray.emplaceBack(0,0,ee,1.3),o.colorArray.emplaceBack(0,0,ee,1.3),o.colorArray.emplaceBack(ee+E,-1.2,ee,.8),o.colorArray.emplaceBack(ee+E,-1.2,ee,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const h={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=Er.white,h.pbrMetallicRoughness=p,o.material=h,o.aabb=new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}const _3=new Float32Array(262144),Wp=new Uint8Array(262144);function iB(i){let n=0;if(i.meshes)for(const o of i.meshes)n=Math.max(n,o.aabb.max[2]);if(i.children)for(const o of i.children)n=Math.max(n,iB(o));return n}function sB(i,n,o){if(i.meshes)for(const u of i.meshes)u.aabb.min[0]!==1/0&&o.insert(n,u.aabb.min[0],u.aabb.min[1],u.aabb.max[0],u.aabb.max[1]);if(i.children)for(const u of i.children)sB(u,n,o)}const oB=["","wall","door","roof","window","lamp","logo"];class aB{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:n.id,geometry:[],properties:{height:iB(n)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const o=new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==n&&(u.transformedAabb=ci.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),n++;this.aabb=o}return this.aabb}}class mT{constructor(n,o,u,h,p,m){this.id=o,this.modelTraits|=d_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=d_.HasMapboxMeshFeatures),h&&(this.modelTraits|=d_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const v of n)this.nodesInfo.push(new aB(v)),sB(v,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}updateFootprints(n,o){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&o.push({footprint:h.footprint,id:n})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const h=u.node;this.uploaded?this.updatePbrBuffer(h):u3(h,n,!0)}for(const u of o)uT(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let o=!1;if(!n.meshes)return o;for(const u of n.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(n,o,u){const h=n.transform.projectionOptions,p=n.style.getBrightness(),m=this.brightness!==p;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||Pv(u.paint.get("model-color").value,m)||Pv(u.paint.get("model-color-mix-intensity").value,m)||Pv(u.paint.get("model-roughness").value,m)||Pv(u.paint.get("model-emissive-strength").value,m)||Pv(u.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=h,this.brightness=p,!0)}evaluateScale(n,o){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const p of u){const m=p.feature;p.evaluatedScale=o.paint.get("model-scale").evaluate(m,{},h)}}evaluate(n){const o=this.getNodesInfo();for(const u of o){if(!u.node.meshes)continue;const h=u.feature,p=u.node.meshes&&u.node.meshes[0].featureData,m=u.evaluatedColor[2],v=u.evaluatedRMEA[2],w=this.id.canonical;if(u.hasTranslucentParts=!1,p){for(let E=0;E<oB.length;E++){const C=oB[E];C.length&&(h.properties.part=C);const P=n.paint.get("model-color").evaluate(h,{},w).toRenderColor(null),M=n.paint.get("model-color-mix-intensity").evaluate(h,{},w);u.evaluatedColor[E]=[P.r,P.g,P.b,M],u.evaluatedRMEA[E][0]=n.paint.get("model-roughness").evaluate(h,{},w),u.evaluatedRMEA[E][2]=n.paint.get("model-emissive-strength").evaluate(h,{},w),u.evaluatedRMEA[E][3]=P.a,u.emissionHeightBasedParams[E]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},w),!u.hasTranslucentParts&&P.a<1&&(u.hasTranslucentParts=!0)}delete h.properties.part,hJ(u,m!==u.evaluatedColor[2]||v!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(h,{},w);u.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},w),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,o,u,h){const p=n.findDEMTileFor(u);if(p&&(p.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=t_.create(n,u,p);if(!m)return;this.modelTraits&d_.HasMapboxMeshFeatures&&this.updateDEM(n,m,u,h);for(const v of this.getNodesInfo()){const w=v.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const E=w.footprint.vertices;let C=m.getElevationAt(E[0].x,E[0].y,!0,!0);for(let P=1;P<E.length;P++)C=Math.min(C,m.getElevationAt(E[P].x,E[P].y,!0,!0));w.elevation=C}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=o}}updateDEM(n,o,u,h){let p=o._dem._modifiedForSources[h];if(p===void 0&&(o._dem._modifiedForSources[h]=[],p=o._dem._modifiedForSources[h]),p.includes(u.canonical))return;const m=o._dem.dim;p.push(u.canonical);let v=!1;for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.grid)continue;const C=E.footprint.grid,P=o.tileCoordToPixel(C.min.x,C.min.y),M=o.tileCoordToPixel(C.max.x,C.max.y),z=Math.min(Math.min(m-M.y,P.x),Math.min(P.y,m-M.x));if(z<0)continue;const j=Wn(z,2,5);let V=Math.max(0,P.x-j),$=Math.max(0,P.y-j),ee=Math.min(M.x+j,m-1),pe=Math.min(M.y+j,m-1);for(let Ae=$;Ae<=pe;++Ae)for(let Le=V;Le<=ee;++Le)Wp[Ae*m+Le]=255;let fe=0,me=0;for(let Ae=0;Ae<C.cellsY;++Ae)for(let Le=0;Le<C.cellsX;++Le){if(!C.cells[Ae*C.cellsX+Le])continue;const $e=o.tileCoordToPixel(C.min.x+Le/C.xScale,C.min.y+Ae/C.yScale),Ze=o.tileCoordToPixel(C.min.x+(Le+1)/C.xScale,C.min.y+(Ae+1)/C.yScale);for(let nt=$e.y;nt<=Math.min(Ze.y+1,m-1);++nt)for(let Ke=$e.x;Ke<=Math.min(Ze.x+1,m-1);++Ke)Wp[nt*m+Ke]===255&&(Wp[nt*m+Ke]=0,fe+=o.getElevationAtPixel(Ke,nt),me++)}const Ce=fe/me;V=Math.max(1,P.x-j),$=Math.max(1,P.y-j),ee=Math.min(M.x+j,m-2),pe=Math.min(M.y+j,m-2),v=!0;for(let Ae=$;Ae<=pe;++Ae)for(let Le=V;Le<=ee;++Le)Wp[Ae*m+Le]===0&&(_3[Ae*m+Le]=o._dem.set(Le,Ae,Ce));for(let Ae=1;Ae<j;++Ae){V=Math.max(1,P.x-Ae),$=Math.max(1,P.y-Ae),ee=Math.min(M.x+Ae,m-2),pe=Math.min(M.y+Ae,m-2);for(let Le=$;Le<=pe;++Le)for(let $e=V;$e<=ee;++$e){const Ze=Le*m+$e;if(Wp[Ze]===255){let nt=0,Ke=0,at=-1,bt=-1;for(let lt=-1;lt<=1;++lt)for(let St=-1;St<=1;++St){const ot=(Le+lt)*m+$e+St;if(Wp[ot]>=Ae)continue;const gt=_3[ot],Pt=Math.abs(gt);Pt>Ke&&(nt=gt,Ke=Pt,at=St,bt=lt)}if(Ke>.1){const lt=1-(Ae+.5*Math.abs(at*bt))/j;let St=o._dem.get($e,Le)+nt*lt;const ot=o._dem.get($e+at,Le+bt),gt=o._dem.get($e-at,Le-bt,!0);(St-ot)*(St-gt)>0&&(St=(ot+gt)/2),_3[Ze]=o._dem.set($e,Le,St),Wp[Ze]=Ae}}}}}v&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=en.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const o of n)uT(o.node),h3(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped()),h=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const m=h[p].node;h[p].hiddenByReplacement=!!m.footprint&&!u.find(v=>v.footprint===m.footprint)}}getHeightAtTileCoord(n,o){const u=this.getNodesInfo(),h=[],p=[0,0,0],m=a.ae.identity([]);for(let v=0;v<this.nodesInfo.length;v++){const w=u[v],E=w.node.meshes[0],C=E.transformedAabb;if(n<C.min[0]||o<C.min[1]||n>C.max[0]||o>C.max[1])continue;if(w.node.hidden===!0)return{height:0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};a.ae.invert(m,w.node.matrix),p[0]=n,p[1]=o,a.$.transformMat4(p,p,m);const P=(p[0]-E.aabb.min[0])/(E.aabb.max[0]-E.aabb.min[0])*qp|0,M=Math.min(63,(p[1]-E.aabb.min[1])/(E.aabb.max[1]-E.aabb.min[1])*qp|0)*qp+Math.min(63,P),z=E.heightmap[M];if(!(z<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:z,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new Lt(n,o),new Lt(n,o),h),h.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function Pv(i,n){return!i.isLightConstant&&n}function uJ(i,n,o,u,h,p,m,v){let w=(61440&n|(61440&n)>>4)>>8,E=(3840&n|(3840&n)>>4)>>4,C=240&n|(240&n)>>4;o[3]>0&&(w=xn(w,255*o[0],o[3]),E=xn(E,255*o[1],o[3]),C=xn(C,255*o[2],o[3]));const P=w<<8|E,M=C<<8|Math.floor(255*u[3]),z=function(Ae){const Le=Wn(Ae,0,2);return Math.min(Math.round(.5*Le*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],j=Wn(h[0],0,1),V=Wn(h[1],0,1),$=Wn(h[2],0,1),ee=Wn(h[3],0,1);let pe,fe,me,Ce;if(j!==V&&m!==p&&V!==j){const Ae=m-p;fe=1/(Ae*(V-j)),me=-(p+Ae*j)/(Ae*(V-j));const Le=Wn(h[4],-1,1);Ce=Math.pow(10,Le),pe=255*$<<8|255*ee}else pe=65535,fe=0,me=1,Ce=1;if(i.emplaceBack(P,M,z,pe,fe,me,Ce),v){const Ae=v.length;v.clear();for(let Le=0;Le<Ae;Le++)v.emplaceBack(P,M,z,pe,fe,me,Ce)}}function hJ(i,n,o){const u=i.node;let h=0;const p=o&d_.HasMeshoptCompression;for(const m of u.meshes){if(u.lights&&u.lightMeshIndex===h||!m.featureData)continue;m.featureArray=new mw,m.featureArray.reserve(m.featureData.length);let v=n;for(const w of m.featureData){const E=p?65535&w:w>>16&65535,C=p?w>>16&65535:65535&w,P=(15&C)<8?15&C:0,M=i.evaluatedRMEA[P],z=i.evaluatedColor[P],j=i.emissionHeightBasedParams[P];let V;if(v&&P===2&&u.lights&&(V=new mw,V.resize(10*u.lights.length)),uJ(m.featureArray,E,z,M,j,m.aabb.min[2],m.aabb.max[2],V),V&&v){v=!1;const $=u.meshes[u.lightMeshIndex];$.featureArray=V,$.featureArray._trim()}}m.featureArray._trim(),h++}}function lB(i,n,o,u){const h=1<<i.z;n.lat=Hs((u/Dt+i.y)/h),n.lng=fa((o/Dt+i.x)/h)}Ve(mT,"Tiled3dModelBucket",{omit:["layers"]}),Ve(aB,"Tiled3dModelFeature");const dJ={circle:class extends da{constructor(i,n,o,u){super(i,{layout:qL||(qL=new Vr({"circle-sort-key":new on(Je.layout_circle["circle-sort-key"]),visibility:new Et(Je.layout_circle.visibility)})),paint:GL||(GL=new Vr({"circle-radius":new on(Je.paint_circle["circle-radius"]),"circle-color":new on(Je.paint_circle["circle-color"]),"circle-blur":new on(Je.paint_circle["circle-blur"]),"circle-opacity":new on(Je.paint_circle["circle-opacity"]),"circle-translate":new Et(Je.paint_circle["circle-translate"]),"circle-translate-anchor":new Et(Je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Et(Je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Et(Je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new on(Je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new on(Je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new on(Je.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Et(Je.paint_circle["circle-emissive-strength"])}))},n,o,u)}createBucket(i){return new mP(i)}queryRadius(i){const n=i;return Yg("circle-radius",this,n)+Yg("circle-stroke-width",this,n)+bw(this.paint.get("circle-translate"))}queryIntersectsFeature(i,n,o,u,h,p,m,v){const w=$L(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return oz(i,u,p,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,n,o){const u=sz(this);return{config:new Lp(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}},heatmap:class extends da{createBucket(i){return new lz(i)}constructor(i,n,o,u){super(i,{layout:dz||(dz=new Vr({visibility:new Et(Je.layout_heatmap.visibility)})),paint:fz||(fz=new Vr({"heatmap-radius":new on(Je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new on(Je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Et(Je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _o(Je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Et(Je.paint_heatmap["heatmap-opacity"])}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=J0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Yg("heatmap-radius",this,i)}queryIntersectsFeature(i,n,o,u,h,p,m,v){const w=this.paint.get("heatmap-radius").evaluate(n,o);return oz(i,u,p,m,v,!0,!0,new Lt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,n,o){return i==="heatmap"?{config:new Lp(this,{zoom:n,lut:o}),overrideFog:!1}:{}}},hillshade:class extends da{constructor(i,n,o,u){super(i,{layout:pz||(pz=new Vr({visibility:new Et(Je.layout_hillshade.visibility)})),paint:mz||(mz=new Vr({"hillshade-illumination-direction":new Et(Je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Et(Je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Et(Je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Et(Je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Et(Je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Et(Je.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Et(Je.paint_hillshade["hillshade-emissive-strength"])}))},n,o,u)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,n,o){return{overrideFog:!1}}},fill:class extends da{constructor(i,n,o,u){super(i,{layout:xz||(xz=new Vr({"fill-sort-key":new on(Je.layout_fill["fill-sort-key"]),visibility:new Et(Je.layout_fill.visibility)})),paint:bz||(bz=new Vr({"fill-antialias":new Et(Je.paint_fill["fill-antialias"]),"fill-opacity":new on(Je.paint_fill["fill-opacity"]),"fill-color":new on(Je.paint_fill["fill-color"]),"fill-outline-color":new on(Je.paint_fill["fill-outline-color"]),"fill-translate":new Et(Je.paint_fill["fill-translate"]),"fill-translate-anchor":new Et(Je.paint_fill["fill-translate-anchor"]),"fill-pattern":new on(Je.paint_fill["fill-pattern"]),"fill-emissive-strength":new Et(Je.paint_fill["fill-emissive-strength"])}))},n,o,u)}getProgramIds(){const i=this.paint.get("fill-pattern"),n=i&&i.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(i,n,o){return{config:new Lp(this,{zoom:n,lut:o}),overrideFog:!1}}recalculate(i,n){super.recalculate(i,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Rw(i)}queryRadius(){return bw(this.paint.get("fill-translate"))}queryIntersectsFeature(i,n,o,u,h,p){return!i.queryGeometry.isAboveHorizon&&FL(VL(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends da{constructor(i,n,o,u){super(i,{layout:sN||(sN=new Vr({visibility:new Et(Je["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Et(Je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:oN||(oN=new Vr({"fill-extrusion-opacity":new Et(Je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new on(Je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Et(Je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Et(Je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new on(Je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new on(Je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new on(Je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Et(Je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Et(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Et(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Et(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Et(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Et(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Et(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Et(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new on(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new on(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Et(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Et(Je["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Et(Je["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Et(Je["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Et(Je["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new on(Je["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new Et(Je["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Fw(i)}queryRadius(){return bw(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,n,o,u,h,p,m,v,w){const E=$L(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(n,o),P=this.paint.get("fill-extrusion-base").evaluate(n,o),M=[0,0],z=v&&p.elevation,j=p.elevation?p.elevation.exaggeration():1,V=i.tile.getBucket(this);if(z&&V instanceof Fw){const me=V.centroidVertexArray,Ce=w+1;Ce<me.length&&(M[0]=me.geta_centroid_pos0(Ce),M[1]=me.geta_centroid_pos1(Ce))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(u=iN([u],[new Lt(0,0),new Lt(Dt,Dt)],i.tileID.canonical).map(me=>me.polygon).flat());const $=z?v:null,[ee,pe]=function(me,Ce,Ae,Le,$e,Ze,nt,Ke,at,bt,lt){return me.projection.name==="globe"?function(St,ot,gt,Pt,ct,Nt,Ct,Tt,_n,un,Kt){const Ot=[],En=[],fn=St.projection.upVectorScale(Kt,St.center.lat,St.worldSize).metersToTile,sn=[0,0,0,1],Dn=[0,0,0,1],zn=(Gn,mr,sr,Br)=>{Gn[0]=mr,Gn[1]=sr,Gn[2]=Br,Gn[3]=1},On=rN();gt>0&&(gt+=On),Pt+=On;for(const Gn of ot){const mr=[],sr=[];for(const Br of Gn){const $r=Br.x+ct.x,Nn=Br.y+ct.y,Rr=St.projection.projectTilePoint($r,Nn,Kt),Dr=St.projection.upVector(Kt,Br.x,Br.y);let Jr=gt,Di=Pt;if(Ct){const Hi=lN($r,Nn,gt,Pt,Ct,Tt,_n,un);Jr+=Hi.base,Di+=Hi.top}gt!==0?zn(sn,Rr.x+Dr[0]*fn*Jr,Rr.y+Dr[1]*fn*Jr,Rr.z+Dr[2]*fn*Jr):zn(sn,Rr.x,Rr.y,Rr.z),zn(Dn,Rr.x+Dr[0]*fn*Di,Rr.y+Dr[1]*fn*Di,Rr.z+Dr[2]*fn*Di),a.$.transformMat4(sn,sn,Nt),a.$.transformMat4(Dn,Dn,Nt),mr.push(new jp(sn[0],sn[1],sn[2])),sr.push(new jp(Dn[0],Dn[1],Dn[2]))}Ot.push(mr),En.push(sr)}return[Ot,En]}(me,Ce,Ae,Le,$e,Ze,nt,Ke,at,bt,lt):nt?function(St,ot,gt,Pt,ct,Nt,Ct,Tt,_n){const un=[],Kt=[],Ot=[0,0,0,1];for(const En of St){const fn=[],sn=[];for(const Dn of En){const zn=Dn.x+Pt.x,On=Dn.y+Pt.y,Gn=lN(zn,On,ot,gt,Nt,Ct,Tt,_n);Ot[0]=zn,Ot[1]=On,Ot[2]=Gn.base,Ot[3]=1,a.aB.transformMat4(Ot,Ot,ct),Ot[3]=Math.max(Ot[3],1e-5);const mr=new jp(Ot[0]/Ot[3],Ot[1]/Ot[3],Ot[2]/Ot[3]);Ot[0]=zn,Ot[1]=On,Ot[2]=Gn.top,Ot[3]=1,a.aB.transformMat4(Ot,Ot,ct),Ot[3]=Math.max(Ot[3],1e-5);const sr=new jp(Ot[0]/Ot[3],Ot[1]/Ot[3],Ot[2]/Ot[3]);fn.push(mr),sn.push(sr)}un.push(fn),Kt.push(sn)}return[un,Kt]}(Ce,Ae,Le,$e,Ze,nt,Ke,at,bt):function(St,ot,gt,Pt,ct){const Nt=[],Ct=[],Tt=ct[8]*ot,_n=ct[9]*ot,un=ct[10]*ot,Kt=ct[11]*ot,Ot=ct[8]*gt,En=ct[9]*gt,fn=ct[10]*gt,sn=ct[11]*gt;for(const Dn of St){const zn=[],On=[];for(const Gn of Dn){const mr=Gn.x+Pt.x,sr=Gn.y+Pt.y,Br=ct[0]*mr+ct[4]*sr+ct[12],$r=ct[1]*mr+ct[5]*sr+ct[13],Nn=ct[2]*mr+ct[6]*sr+ct[14],Rr=ct[3]*mr+ct[7]*sr+ct[15],Dr=Br+Tt,Jr=$r+_n,Di=Nn+un,Hi=Math.max(Rr+Kt,1e-5),Oi=Br+Ot,wi=$r+En,Bs=Nn+fn,cs=Math.max(Rr+sn,1e-5);zn.push(new jp(Dr/Hi,Jr/Hi,Di/Hi)),On.push(new jp(Oi/cs,wi/cs,Bs/cs))}Nt.push(zn),Ct.push(On)}return[Nt,Ct]}(Ce,Ae,Le,$e,Ze)}(p,u,P,C,E,m,$,M,j,p.center.lat,i.tileID.canonical),fe=i.queryGeometry;return function(me,Ce,Ae){let Le=1/0;FL(Ae,Ce)&&(Le=aN(Ae,Ce[0]));for(let $e=0;$e<Ce.length;$e++){const Ze=Ce[$e],nt=me[$e];for(let Ke=0;Ke<Ze.length-1;Ke++){const at=Ze[Ke],bt=[at,Ze[Ke+1],nt[Ke+1],nt[Ke],at];gP(Ae,bt)&&(Le=Math.min(Le,aN(Ae,bt)))}}return Le!==1/0&&Le}(ee,pe,fe.isPointQuery()?fe.screenBounds:fe.screenGeometry)}},line:class extends da{constructor(i,n,o,u){const h=_F();super(i,h,n,o,u),h.layout&&(this.layout=new Ws(h.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Cd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,n){super.recalculate(i,n),this.paint._values["line-floorwidth"]=(()=>{if(Tv)return Tv;const o=_F();return Tv=new BY(o.paint.properties["line-width"].specification),Tv.useIntegerZoom=!0,Tv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Bw(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,n,o){const u=yN(this);return{config:new Lp(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}queryRadius(i){const n=i,o=xF(Yg("line-width",this,n),Yg("line-gap-width",this,n)),u=Yg("line-offset",this,n);return o/2+Math.abs(u)+bw(this.paint.get("line-translate"))}queryIntersectsFeature(i,n,o,u,h,p){if(i.queryGeometry.isAboveHorizon)return!1;const m=VL(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*xF(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),w=this.paint.get("line-offset").evaluate(n,o);return w&&(u=function(E,C){const P=[],M=new Lt(0,0);for(let z=0;z<E.length;z++){const j=E[z],V=[];for(let $=0;$<j.length;$++){const ee=j[$],pe=j[$+1],fe=$===0?M:ee.sub(j[$-1])._unit()._perp(),me=$===j.length-1?M:pe.sub(ee)._unit()._perp(),Ce=fe._add(me)._unit();Ce._mult(1/(Ce.x*me.x+Ce.y*me.y)),V.push(Ce._mult(C)._add(ee))}P.push(V)}return P}(u,w*i.pixelToTileUnitsFactor)),function(E,C,P){for(let M=0;M<C.length;M++){const z=C[M];if(E.length>=3){for(let j=0;j<z.length;j++)if(Fd(E,z[j]))return!0}if(hK(E,z,P))return!0}return!1}(m,u,v)}isTileClipped(){return!0}isDraped(i){const n=this.layout.get("line-z-offset");return n.isConstant()&&!n.constantOr(0)}},symbol:iT,background:class extends da{constructor(i,n,o,u){super(i,{layout:wF||(wF=new Vr({visibility:new Et(Je.layout_background.visibility)})),paint:TF||(TF=new Vr({"background-color":new Et(Je.paint_background["background-color"]),"background-pattern":new Et(Je.paint_background["background-pattern"]),"background-opacity":new Et(Je.paint_background["background-opacity"]),"background-emissive-strength":new Et(Je.paint_background["background-emissive-strength"])}))},n,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,n,o){return{overrideFog:!1}}},raster:AF,"raster-particle":OF,sky:class extends da{constructor(i,n,o,u){super(i,{layout:MF||(MF=new Vr({visibility:new Et(Je.layout_sky.visibility)})),paint:kF||(kF=new Vr({"sky-type":new Et(Je.paint_sky["sky-type"]),"sky-atmosphere-sun":new Et(Je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Et(Je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Et(Je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Et(Je.paint_sky["sky-gradient-radius"]),"sky-gradient":new _o(Je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Et(Je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Et(Je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Et(Je.paint_sky["sky-opacity"])}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=J0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(i,n){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,p=i.style.light,m=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&bi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?a3(m.azimuthal,90-m.polar,n):a3(u[0],90-u[1],n)}const o=this.paint.get("sky-gradient-center");return a3(o[0],90-o[1],n)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends da{constructor(i,n,o,u){super(i,{paint:DF||(DF=new Vr({}))},n,null)}},model:class extends da{constructor(i,n,o,u){super(i,{layout:qF||(qF=new Vr({visibility:new Et(Je.layout_model.visibility),"model-id":new on(Je.layout_model["model-id"])})),paint:GF||(GF=new Vr({"model-opacity":new Et(Je.paint_model["model-opacity"]),"model-rotation":new on(Je.paint_model["model-rotation"]),"model-scale":new on(Je.paint_model["model-scale"]),"model-translation":new on(Je.paint_model["model-translation"]),"model-color":new on(Je.paint_model["model-color"]),"model-color-mix-intensity":new on(Je.paint_model["model-color-mix-intensity"]),"model-type":new Et(Je.paint_model["model-type"]),"model-cast-shadows":new Et(Je.paint_model["model-cast-shadows"]),"model-receive-shadows":new Et(Je.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Et(Je.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new on(Je.paint_model["model-emissive-strength"]),"model-roughness":new on(Je.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new on(Je.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Et(Je.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Et(Je.paint_model["model-front-cutoff"])}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new c3(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof mT?Dt-1:0}queryIntersectsFeature(i,n,o,u,h,p){if(!this.modelManager)return!1;const m=this.modelManager,v=i.tile.getBucket(this);if(!(v&&v instanceof c3))return!1;const w=v;for(const E in w.instancesPerModel){const C=w.instancesPerModel[E],P=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(P)){const M=C.features[C.idToFeaturesIndex[P]],z=m.getModel(E,this.scope);if(!z)return!1;let j=a.ae.create();const V=new wr(0,0),$=w.canonical;let ee=Number.MAX_VALUE;for(let pe=0;pe<M.instancedDataCount;++pe){const fe=16*(M.instancedDataOffset+pe),me=C.instancedDataArray.float32,Ce=[me[fe+4],me[fe+5],me[fe+6]];lB($,V,me[fe],0|me[fe+1]),WF(j,z,p,V,M.rotation,M.scale,Ce,!1,!1,!1),p.projection.name==="globe"&&(j=l3(j,p));const Ae=a.ae.multiply([],p.projMatrix,j),Le=i.queryGeometry,$e=jF(Le.isPointQuery()?Le.screenBounds:Le.screenGeometry,p,Ae,z.aabb);$e!=null&&(ee=Math.min($e,ee))}return ee!==Number.MAX_VALUE&&ee}}return!1}_handleOverridablePaintPropertyUpdate(i,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){const n=this._transitionablePaint._values[i];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Se}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,n,o,u){const h=i.tile,p=h.getBucket(this);let m=null,v=Number.MAX_VALUE;if(!(p&&p instanceof mT))return{queryFeature:m,intersectionZ:v};const w=p.getNodesInfo()[n];if(w.hiddenByReplacement||!w.node.meshes||!o.filter(new In(h.tileID.overscaledZ),w.feature,h.tileID.canonical))return{queryFeature:m,intersectionZ:v};const E=w.node,C=u.calculatePosMatrix(h.tileID.toUnwrapped(),u.worldSize),P=w.evaluatedScale;let M=0;u.elevation&&E.elevation&&(M=E.elevation*u.elevation.exaggeration()),a.ae.translate(C,C,[(E.anchor?E.anchor[0]:0)*(P[0]-1),(E.anchor?E.anchor[1]:0)*(P[1]-1),M]),a.ae.scale(C,C,P),a.ae.multiply(C,C,E.matrix);const z=i.queryGeometry,j=z.isPointQuery()?z.screenBounds:z.screenGeometry,V=function(ee){const pe=a.ae.multiply([],C,ee.matrix),fe=a.ae.multiply(pe,u.expandedFarZProjMatrix,pe);for(let me=0;me<ee.meshes.length;++me){const Ce=ee.meshes[me];if(me===ee.lightMeshIndex)continue;const Ae=jF(j,u,fe,Ce.aabb);Ae!=null&&(v=Math.min(Ae,v))}if(ee.children)for(const me of ee.children)V(me)};if(V(E),v===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:v};const $=new wr(0,0);return lB(h.tileID.canonical,$,w.node.anchor[0],w.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[$.lng,$.lat]},properties:w.feature.properties,id:w.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:v}}},clip:class extends da{constructor(i,n,o,u){super(i,{layout:wz||(wz=new Vr({"clip-layer-types":new Et(Je.layout_clip["clip-layer-types"]),"clip-layer-scope":new Et(Je.layout_clip["clip-layer-scope"])})),paint:Tz||(Tz=new Vr({}))},n,o,u)}recalculate(i,n){super.recalculate(i,n)}createBucket(i){return new Ez(i)}isTileClipped(){return!0}is3D(){return!0}}};Ve(pF,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const cB=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class y3{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=cB[15&u];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(n,2,1),[v]=new Uint32Array(n,4,1);return new y3(v,m,p,n)}constructor(n,o=64,u=Float64Array,h){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const p=cB.indexOf(this.ArrayType),m=2*n*this.ArrayType.BYTES_PER_ELEMENT,v=n*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+w,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+w),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+w,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=n,this.coords[this._pos++]=o,u}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return v3(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:v}=this,w=[0,p.length-1,0],E=[];for(;w.length;){const C=w.pop()||0,P=w.pop()||0,M=w.pop()||0;if(P-M<=v){for(let $=M;$<=P;$++){const ee=m[2*$],pe=m[2*$+1];ee>=n&&ee<=u&&pe>=o&&pe<=h&&E.push(p[$])}continue}const z=M+P>>1,j=m[2*z],V=m[2*z+1];j>=n&&j<=u&&V>=o&&V<=h&&E.push(p[z]),(C===0?n<=j:o<=V)&&(w.push(M),w.push(z-1),w.push(1-C)),(C===0?u>=j:h>=V)&&(w.push(z+1),w.push(P),w.push(1-C))}return E}within(n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,v=[0,h.length-1,0],w=[],E=u*u;for(;v.length;){const C=v.pop()||0,P=v.pop()||0,M=v.pop()||0;if(P-M<=m){for(let $=M;$<=P;$++)hB(p[2*$],p[2*$+1],n,o)<=E&&w.push(h[$]);continue}const z=M+P>>1,j=p[2*z],V=p[2*z+1];hB(j,V,n,o)<=E&&w.push(h[z]),(C===0?n-u<=j:o-u<=V)&&(v.push(M),v.push(z-1),v.push(1-C)),(C===0?n+u>=j:o+u>=V)&&(v.push(z+1),v.push(P),v.push(1-C))}return w}}function v3(i,n,o,u,h,p){if(h-u<=o)return;const m=u+h>>1;uB(i,n,m,u,h,p),v3(i,n,o,u,m-1,1-p),v3(i,n,o,m+1,h,1-p)}function uB(i,n,o,u,h,p){for(;h>u;){if(h-u>600){const E=h-u+1,C=o-u+1,P=Math.log(E),M=.5*Math.exp(2*P/3),z=.5*Math.sqrt(P*M*(E-M)/E)*(C-E/2<0?-1:1);uB(i,n,o,Math.max(u,Math.floor(o-C*M/E+z)),Math.min(h,Math.floor(o+(E-C)*M/E+z)),p)}const m=n[2*o+p];let v=u,w=h;for(Rv(i,n,u,o),n[2*h+p]>m&&Rv(i,n,u,h);v<w;){for(Rv(i,n,v,w),v++,w--;n[2*v+p]<m;)v++;for(;n[2*w+p]>m;)w--}n[2*u+p]===m?Rv(i,n,u,w):(w++,Rv(i,n,w,h)),w<=o&&(u=w+1),o<=w&&(h=w-1)}}function Rv(i,n,o,u){x3(i,o,u),x3(n,2*o,2*u),x3(n,2*o+1,2*u+1)}function x3(i,n,o){const u=i[n];i[n]=i[o],i[o]=u}function hB(i,n,o,u){const h=i-o,p=n-u;return h*h+p*p}a.A=Dg,a.B=Ip,a.C=Er,a.D=Ep,a.E=oh,a.F=Bo,a.H=_c,a.I=Vp,a.J=B,a.K=A,a.L=function(i){const n=i.value;let o=[];if(!n)return o;const u=su(n);return u!=="string"?(o=o.concat([new cT(i.key,n,`string expected, "${u}" found`)]),o):(UF(n,!0)||(o=o.concat([new cT(i.key,n,`invalid url "${n}"`)])),o)},a.M=class{constructor(i,n,o,u){this.id=i,this.position=n!=null?new wr(n[0],n[1]):new wr(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,n){if(a.ae.multiply(i.matrix,n,i.matrix),i.meshes)for(const o of i.meshes){const u=ci.applyTransformFast(o.aabb,i.matrix);this.aabb.encapsulate(u)}if(i.children)for(const o of i.children)this._applyTransformations(o,i.matrix)}computeBoundsAndApplyParent(){const i=a.ae.identity([]);for(const n of this.nodes)this._applyTransformations(n,i)}computeModelMatrix(i,n,o,u,h,p,m=!1){WF(this.matrix,this,i.transform,this.position,n,o,u,h,p,m)}upload(i){if(!this.uploaded){for(const n of this.nodes)u3(n,i);for(const n of this.nodes)uT(n);this.uploaded=!0}}destroy(){for(const i of this.nodes)h3(i)}},a.N=Je,a.O=ro,a.P=Lt,a.Q=Is,a.R=sp,a.S=eP,a.T=Ml,a.U=Vr,a.V=cT,a.W=Et,a.X=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return cc(i.expression.evaluate(n))}interpolate(i,n,o){return{x:xn(i.x,n.x,o),y:xn(i.y,n.y,o),z:xn(i.z,n.z,o),azimuthal:xn(i.azimuthal,n.azimuthal,o),polar:xn(i.polar,n.polar,o)}}},a.Y=In,a.Z=Se,a._=yo,a.a=Pa,a.a$=bP,a.a0=na,a.a1=Ws,a.a2=xh,a.a3=xn,a.a4=Dt,a.a5=b0,a.a6=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return function([o,u]){const h=cc([1,o,u]);return{x:h.x,y:h.y,z:h.z}}(i.expression.evaluate(n))}interpolate(i,n,o){return{x:xn(i.x,n.x,o),y:xn(i.y,n.y,o),z:xn(i.z,n.z,o)}}},a.a7=H0,a.a8=_w,a.a9=gh,a.aA=function(i,n,o){i[4*n+0]=o[0],i[4*n+1]=o[1],i[4*n+2]=o[2],i[4*n+3]=o[3]},a.aC=function(i,n){const{x:o,y:u}=i.point,h=nz(o,u,i.worldSize/i._pixelsPerMercatorPixel,0,0);return a.ae.multiply(h,h,SP(fu(n)))},a.aE=i_,a.aF=el,a.aG=Vw,a.aH=function(i,n,o,u,h){const p=5*n+2;i.float32[p+0]=o,i.float32[p+1]=u,i.float32[p+2]=h},a.aI=Jw,a.aJ=wr,a.aK=rF,a.aL=kL,a.aM=wP,a.aN=zF,a.aO=Np,a.aP=JL,a.aQ=gs,a.aR=function(i,n,o,u,h,p,m,v,w){if(w.name==="globe")return JL(i,n,new Np(o,u,h),!1);const E=Up({z:o,x:u,y:h},w);return new ci([(p+E.x/E.scale)*n,n*(E.y/E.scale),m],[(p+E.x2/E.scale)*n,n*(E.y2/E.scale),v])},a.aS=function(i,n,o){let u=0;for(let h=0;h<2;++h)i[h]>0&&(u+=(i[h]-0)*(i[h]-0)),n[h]<0&&(u+=(0-n[h])*(0-n[h]));return u},a.aT=Ui,a.aU=xP,a.aV=RL,a.aW=function(i){const n=a.ae.identity(new Float64Array(16));a.ae.multiply(n,i.pixelMatrix,i.globeMatrix);const o=[0,Pl,0],u=[0,Rl,0];return a.$.transformMat4(o,o,n),a.$.transformMat4(u,u,n),[o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!CP(i,new wr(i.center.lat,90)),u[0]>0&&u[0]<=i.width&&u[1]>0&&u[1]<=i.height&&!CP(i,new wr(i.center.lat,-90))]},a.aX=function(i,n){const{scale:o}=i.tileTransform,u=o*Dt/(i.tileSize*Math.pow(2,n.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return a.aD.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[u,u])},a.aY=aT,a.aZ=LF,a.a_=function(i){const n=LF(i,!0);return a.aD.invert([],[n[0],n[1],n[4],n[5]])},a.aa=AL,a.ab=jo,a.ac=er,a.ad=function(i,n,o){const u=Math.sqrt(i*i+n*n+o*o),h=u>0?Math.acos(o/u)*ai:0;let p=i!==0||n!==0?Math.atan2(-n,-i)*ai+90:0;return p<0&&(p+=360),[u,p,h]},a.af=u_,a.ag=Ec,a.ah=QP,a.ai=function(i,n){const o={};for(let u=0;u<n.length;u++){const h=n[u];h in i&&(o[h]=i[h])}return o},a.aj=Nd,a.ak=hu,a.al=du,a.am=hL,a.an=function(i){pg++,pg>Ps&&(i.getActor().send("enforceCacheSizeLimit",As),pg=0)},a.ao=g0,a.ap=class{constructor(i){this.entries={},this.scheduler=i}request(i,n,o,u){const h=this.entries[i]=this.entries[i]||{callbacks:[]};if(h.result){const[p,m]=h.result;return this.scheduler?this.scheduler.add(()=>{u(p,m)},n):u(p,m),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=o((p,m)=>{h.result=[p,m];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,m)},n):v(p,m);setTimeout(()=>delete this.entries[i],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==u),h.callbacks.length||(h.cancel(),delete this.entries[i]))}}},a.aq=function(i,n,o){const u=JSON.stringify(i.request);return i.data&&(this.deduped.entries[u]={result:[null,i.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const p=nh(i.request,(m,v,w,E)=>{m?h(m):v&&h(null,{vectorTile:o?void 0:new OP(new lv(v)),rawData:v,cacheControl:w,expires:E})});return()=>{p.cancel(),h()}},n)},a.ar=iP,a.as=class extends mh{constructor(i){super(i),this.current=QX}set(i,n,o){if(this.fetchUniformLocation(i,n)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},a.at=sP,a.au=Wn,a.av=sc,a.ax=R,a.ay=Vo,a.az=Hs,a.b=gi,a.b$=sK,a.b0=function(i){const{x:n,y:o}=i.point,{lng:u,lat:h}=i._center;return nz(n,o,i.worldSize,u,h)},a.b1=eo,a.b2=Kg,a.b3=lP,a.b4=function(i){const n=Math.round((i+45+360)%360/90)%4;return Jc[n]},a.b5=45,a.b6=hP,a.b7=yw,a.b8=ci,a.b9=cc,a.bA=rT,a.bB=hz,a.bC=function(i,n){return[Math.pow(i[0],2.2)*n,Math.pow(i[1],2.2)*n,Math.pow(i[2],2.2)*n]},a.bD=mN,a.bF=tz,a.bG=dt,a.bH=Me,a.bI=256,a.bJ=function(i,n){const o=[0,0,0],u=Y0(fu(n.canonical));return a.$.transformMat4(o,o,u),a.$.transformMat4(o,o,i),o},a.bK=i=>({u_camera_to_center_distance:new jo(i),u_extrude_scale:new oP(i),u_device_pixel_ratio:new jo(i),u_matrix:new H0(i),u_inv_rot_matrix:new H0(i),u_merc_center:new gh(i),u_tile_id:new iP(i),u_zoom_transition:new jo(i),u_up_dir:new iP(i),u_emissive_strength:new jo(i)}),a.bL=i=>({u_matrix:new H0(i),u_pixels_to_tile_units:new oP(i),u_device_pixel_ratio:new jo(i),u_units_to_pixels:new gh(i),u_dash_image:new _w(i),u_gradient_image:new _w(i),u_image_height:new jo(i),u_texsize:new gh(i),u_tile_units_to_pixels:new jo(i),u_alpha_discard_threshold:new jo(i),u_trim_offset:new gh(i),u_trim_fade_range:new gh(i),u_trim_color:new sP(i),u_emissive_strength:new jo(i)}),a.bM=i=>({u_matrix:new H0(i),u_texsize:new gh(i),u_pixels_to_tile_units:new oP(i),u_device_pixel_ratio:new jo(i),u_image:new _w(i),u_units_to_pixels:new gh(i),u_tile_units_to_pixels:new jo(i),u_alpha_discard_threshold:new jo(i),u_trim_offset:new gh(i)}),a.bN=HA,a.bO=xQ,a.bP=oo,a.bQ=NQ,a.bR=ZN,a.bS=VP,a.bT=sz,a.bU=(i,n,o,u,h,p)=>{const m=i.transform,v=m.projection.name==="globe";let w;if(p.paint.get("circle-pitch-alignment")==="map")if(v){const C=tz(m.zoom,n.canonical)*m._pixelsPerMercatorPixel;w=Float32Array.from([C,0,0,C])}else w=m.calculatePixelsToTileUnitsMatrix(o);else w=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(m.projection),u_matrix:i.translatePosMatrix(n.projMatrix,o,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:en.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:vK,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){E.u_inv_rot_matrix=u,E.u_merc_center=h,E.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],E.u_zoom_transition=xh(m.zoom);const C=h[0]*Dt,P=h[1]*Dt;E.u_up_dir=m.projection.upVector(new Np(0,0,0),C,P)}return E},a.bV=yN,a.bW=(i,n,o,u,h,p)=>{const m=i.transform;return{u_matrix:_N(i,n,o,u),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:gN(n,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p}},a.bX=(i,n,o,u,h,p,m)=>{const v=i.transform,w=v.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:_N(i,n,o,u),u_pixels_to_tile_units:w,u_device_pixel_ratio:p,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:vN(o)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:gN(n,i.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength")}},a.bY=Ea,a.bZ=J0,a.b_=rN,a.ba=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},a.bb=Yu,a.bc=function(i,n,o){const u=xh(o.zoom),h=i.style.map._antialias,p=n.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return u===0&&!h&&!p},a.bd=function(i){const n=i.pixelsPerMeter,o=n/Vo(1,i.center.lat),u=a.ae.identity(new Float64Array(16));return a.ae.translate(u,u,[i.point.x,i.point.y,0]),a.ae.scale(u,u,[o,o,n]),Float32Array.from(u)},a.be=Ew,a.bf=function(i){const n=Ui-5;i=Wn(i,-n,n)/n*90;const o=Math.pow(Math.abs(Math.sin(er(i))),3);return Math.round(o*(cP.length-1))},a.bg=function(i,n,o,u){const h=n.getNorth(),p=n.getSouth(),m=n.getWest(),v=n.getEast(),w=1<<i.z,E=v-m,C=h-p,P=E/Hg,M=-C/cP[o],z=[0,P,0,M,0,0,h,m,0];if(i.z>0){const j=180/u;a.bE.multiply(z,z,[j/E+1,0,0,0,j/C+1,0,-.5*j/P,.5*j/M,1])}return z[2]=w,z[5]=i.x,z[8]=i.y,z},a.bh=Y0,a.bi=fu,a.bj=function(i,n,o){const u=a.ae.identity(new Float64Array(16)),h=(n/(1<<i)-.5)*Math.PI*2;return a.ae.rotateY(u,o.globeMatrix,h),Float32Array.from(u)},a.bk=It,a.bl=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.bm=AF,a.bn=OF,a.bo=CF,a.bp=function(i,n){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let u=0;u<i.length;u++){const h=document.createElement("source");pA(i[u])||(o.crossOrigin="Anonymous"),h.src=i[u],o.appendChild(h)}return{cancel:()=>{}}},a.bq=eT,a.br=th,a.bs=class{isDataAvailableAtPoint(i){const n=this._source();if(this.isUsingMockSource()||!n||i.y<0||i.y>1)return!1;const o=n.getSource().maxzoom,u=1<<o,h=Math.floor(i.x),p=Math.floor((i.x-h)*u),m=Math.floor(i.y*u),v=this.findDEMTileFor(new gs(o,h,o,p,m));return!(!v||!v.dem)}getAtPointOrZero(i,n=0){return this.getAtPoint(i,n)||0}getAtPoint(i,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const u=this._source();if(!u||i.y<0||i.y>1)return n;const h=u.getSource().maxzoom,p=1<<h,m=Math.floor(i.x),v=i.x-m,w=new gs(h,m,h,Math.floor(v*p),Math.floor(i.y*p)),E=this.findDEMTileFor(w);if(!E||!E.dem)return n;const C=E.dem,P=1<<E.tileID.canonical.z,M=(v*P-E.tileID.canonical.x)*C.dim,z=(i.y*P-E.tileID.canonical.y)*C.dim,j=Math.floor(M),V=Math.floor(z);return(o?this.exaggeration():1)*xn(xn(C.get(j,V),C.get(j,V+1),z-V),xn(C.get(j+1,V),C.get(j+1,V+1),z-V),M-j)}getAtTileOffset(i,n,o){const u=1<<i.canonical.z;return this.getAtPointOrZero(new yo(i.wrap+(i.canonical.x+n/Dt)/u,(i.canonical.y+o/Dt)/u))}getAtTileOffsetFunc(i,n,o,u){return h=>{const p=this.getAtTileOffset(i,h.x,h.y),m=u.upVector(i.canonical,h.x,h.y),v=u.upVectorScale(i.canonical,n,o).metersToTile;return a.$.scale(m,m,p*v),m}}getForTilePoints(i,n,o,u){if(this.isUsingMockSource())return!1;const h=t_.create(this,i,u);return!!h&&(n.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],o)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(i);if(!n||!n.dem)return null;const o=n.dem.tree,u=n.tileID,h=1<<i.canonical.z-u.canonical.z;let p=i.canonical.x/h-u.canonical.x,m=i.canonical.y/h-u.canonical.y,v=0;for(let w=0;w<i.canonical.z-u.canonical.z&&!o.leaves[v];w++){p*=2,m*=2;const E=2*Math.floor(m)+Math.floor(p);v=o.childOffsets[v]+E,p%=1,m%=1}return{min:this.exaggeration()*o.minimums[v],max:this.exaggeration()*o.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const i=this.visibleDemTiles;if(i.length===0)return null;let n=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of i){const p=this.getMinMaxForTile(h.tileID);p&&(o=Math.min(o,p.min),u=Math.max(u,p.max),n=!0)}return n?{min:o,max:u}:null}},a.bt=K0,a.bu=Tw,a.bv=vc,a.bw=Fs,a.bx=$p,a.by=f_,a.bz=hT,a.c=rB,a.c$=function(i,n,o,u){return i.type==="custom"?new UY(i,n):new dJ[i.type](i,n,o,u)},a.c0=Fw,a.c1=Ud,a.c2=450,a.c3=7,a.c4=jY,a.c5=mF,a.c6=256,a.c7=QL,a.c8=SP,a.c9=Pr,a.cA=UL,a.cB=function(i,n,o=0){return a.$.fromValues(((n.x-o)*i.scale-i.x)*Dt,(n.y*i.scale-i.y)*Dt,DL(n.z,n.y))},a.cC=function(i){let n=1/0,o=1/0,u=-1/0,h=-1/0;for(const p of i)n=Math.min(n,p.x),o=Math.min(o,p.y),u=Math.max(u,p.x),h=Math.max(h,p.y);return{min:new Lt(n,o),max:new Lt(u,h)}},a.cD=Fd,a.cE=zL,a.cF=Uo,a.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.cH=UN,a.cI=gP,a.cJ=Mz,a.cK=zz,a.cL=Nz,a.cM=WP,a.cN=y3,a.cO=function(i){return i({pluginStatus:Lr,pluginURL:pr}),Yn.on("pluginStateChange",i),i},a.cP=o_,a.cQ=qP,a.cR=d0,a.cS=Or,a.cT=Z,a.cU=ps,a.cV=yg,a.cW=zs,a.cX=function(i){const n=i.indexOf(uw);return n>=0?i.slice(0,n):i},a.cY=function(i){return i.indexOf(uw)>=0},a.cZ=function(i){const n=i.indexOf(uw);return n>=0?i.slice(n+1):""},a.c_=function(i){const n=[],o=i.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},a.ca=kd,a.cb=Op,a.cc=1,a.cd=_v,a.ce=0,a.cf=QA,a.cg=function(i,n,o,u,h){return Wn((i-n)/(o-n)*(h-u)+u,u,h)},a.ch=aw,a.ci=Fp,a.cj=class{constructor(i,n,o,u){this.context=i,this.format=u,this.size=o,this.texture=i.gl.createTexture();const[h,p,m]=this.size,{gl:v}=i;v.bindTexture(v.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1);let w=this.format,E=v.UNSIGNED_BYTE;this.format===v.DEPTH_COMPONENT&&(w=v.DEPTH_COMPONENT16,E=v.UNSIGNED_SHORT),this.format===v.R8&&(u=v.RED),this.format===v.R32F&&(E=v.FLOAT,u=v.RED),v.texImage3D(v.TEXTURE_3D,0,w,h,p,m,0,u,E,n.data)}bind(i,n){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),i!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,i),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,i),this.minFilter=i),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},a.ck=l3,a.cl=[1,1,1],a.cm=t_,a.cn=d_,a.co=Od,a.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Lt(1/0,1/0),max:new Lt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,n=!1){const o=Dz(new Lt(0,0),new Lt(Dt,Dt),i),u=[];if(n&&!LP(o,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!LP(o,h))continue;const p=XK(h.min,h.max,i);u.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(i){this._setSources(i.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const o=[];for(const u of n.cache.getVisibleCoordinates()){const h=n.cache.getTile(u).buckets[n.layer];h&&h.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(i){const n=i.getFootprints();if(n.length===0)return;const o=i.getOrder(),u=i.getClipMask(),h=i.getClipScope();for(const p of n){if(!p.footprint)continue;const m=Dz(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:o,clipMask:u,clipScope:h})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,o)=>n.priority-o.priority||Lw(n.min,o.min)||Lw(n.max,o.max)||n.order-o.order||n.clipMask-o.clipMask||function(u,h){const p=(m,v)=>m+v;return u.length-h.length||u.reduce(p,"").localeCompare(h.reduce(p,""))}(n.clipScope,o.clipScope));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let n=0;for(;!i&&n!==this._activeRegions.length;){const o=this._activeRegions[n],u=this._prevRegions[n];i=o.priority!==u.priority||!kz(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!ic(o.clipScope,u.clipScope),++n}}if(i){++this._updateTime;for(const o of this._activeRegions)o.order!==Ow&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const n=o=>{const u=this._activeRegions;if(o>=u.length)return o;const h=u[o].priority;for(;o<u.length&&u[o].priority===h;)++o;return o};if(this._sourceIds.length>1){let o=0,u=n(o);for(;o!==u;){let h=o;const p=o;for(;h!==u;){const m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let v=0;v<p;v++){const w=this._activeRegions[v];if(!w.hiddenByOverlap&&m.order===Ow&&LP(m,w)&&(m.hiddenByOverlap=Lz(m.footprint,m.tileId,w.footprint,w.tileId),m.hiddenByOverlap))break}++h}o=u,u=n(o)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=i.length-1;n>=0;n--)this._addSource(i[n]);this._computeReplacement()}},a.cq=ph,a.cr=nT,a.cs=q0,a.ct=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,n){const o=new vc,u=new Fs,h=[],p=i+1+2,m=n[0]+1,v=n[0]+1+(1+n.length),w=(E,C,P)=>{let M=E===p-1?E-2:E===0?E:E-1;return M+=P?24575:0,[M,C]};for(let E=0;E<p;++E)o.emplaceBack(...w(E,0,!0));for(let E=0;E<m;++E)for(let C=0;C<p;++C)o.emplaceBack(...w(C,E,(C===0||C===p-1)&&!0));for(let E=0;E<n.length;++E){const C=n[E];for(let P=0;P<p;++P)o.emplaceBack(...w(P,C,!0))}for(let E=0;E<n.length;++E){const C=u.length,P=n[E]+1+2,M=new Fs;for(let V=0;V<P-1;V++){const $=V===P-2,ee=$?p*(v-n.length+E-V):p;for(let pe=0;pe<p-1;pe++){const fe=V*p+pe;V===0||$||pe===0||pe===p-2?(M.emplaceBack(fe+1,fe,fe+ee),M.emplaceBack(fe+ee,fe+ee+1,fe+1)):(u.emplaceBack(fe+1,fe,fe+ee),u.emplaceBack(fe+ee,fe+ee+1,fe+1))}}const z=gi.simpleSegment(0,C,o.length,u.length-C);for(let V=0;V<M.uint16.length;V+=3)u.emplaceBack(M.uint16[V],M.uint16[V+1],M.uint16[V+2]);const j=gi.simpleSegment(0,C,o.length,u.length-C);h.push({withoutSkirts:z,withSkirts:j})}return{vertices:o,indices:u,segments:h}}_createGrid(i){const n=this._fillGridMeshWithLods(Hg,cP);this._gridSegments=n.segments,this._gridBuffer=i.createVertexBuffer(n.vertices,K0.members),this._gridIndexBuffer=i.createIndexBuffer(n.indices,!0)}_createPoles(i){const n=new Fs;for(let m=0;m<=Hg;m++)n.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=i.createIndexBuffer(n,!0);const o=new Op,u=new Op,h=new Op,p=new Op;this._poleSegments=[];for(let m=0,v=0;m<lP;m++){const w=360/(1<<m);o.emplaceBack(0,-Uo,0,.5,0),u.emplaceBack(0,-Uo,0,.5,1),h.emplaceBack(0,-Uo,0,.5,.5),p.emplaceBack(0,-Uo,0,.5,.5);for(let E=0;E<=Hg;E++){let C=E/Hg,P=0;const M=xn(0,w,C),[z,j,V]=Zg(_K,yK,M,Uo);o.emplaceBack(z,j,V,C,P),u.emplaceBack(z,j,V,C,1-P);const $=er(M);C=.5+.5*Math.sin($),P=.5+.5*Math.cos($),h.emplaceBack(z,j,V,C,P),p.emplaceBack(z,j,V,C,1-P)}this._poleSegments.push(gi.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(o,ww,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(u,ww,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(h,ww,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(p,ww,!1)}getGridBuffers(i,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},a.cu=function(i){return up.has(i)},a.cv=Ow,a.cw=Gz,a.cx=function(i,n,o=0,u=!0){const h=new Lt(o,o),p=i.sub(h),m=n.add(h),v=[p,new Lt(m.x,p.y),m,new Lt(p.x,m.y)];return u&&v.push(p.clone()),v},a.cy=function(i,n){const o=[];for(let u=0;u<i.length;u++){const h=sc(u-1,-1,i.length-1),p=sc(u+1,-1,i.length-1),m=i[u],v=i[p],w=i[h].sub(m).unit(),E=v.sub(m).unit(),C=E.angleWithSep(w.x,w.y),P=w.add(E).unit().mult(-1*n/Math.sin(C/2));o.push(m.add(P))}return o},a.cz=YN,a.d=ic,a.d$=bv,a.d0=Cs,a.d1=Yn,a.d2=Sl,a.d3=Ju,a.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.d5=mo,a.d6=LL,a.d7=zp,a.d8=function([i,n,o]){const u=Math.hypot(i,n,o),h=Math.atan2(i,o),p=.5*Math.PI-Math.acos(-n/u);return new wr(eo(h),eo(p))},a.d9=fa,a.dA=function(){hT().acquire(d3)},a.dB=function(){const i=Cv;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(d3),Cv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.dC=Iv,a.dD=function(i){const n=md();if(!n)return;const o=n.delete(Ur);i&&o.catch(i).then(()=>i())},a.dE=Sv,a.dF=ZF,a.dG=function(i){f3=en.resolveURL(i),m_||(m_=new f_(hT(),new oh)),m_.broadcast("setDracoUrl",f3)},a.dH=XF,a.dI=function(i){p_=en.resolveURL(i),m_||(m_=new f_(hT(),new oh)),m_.broadcast("setMeshoptUrl",p_)},a.dJ=oc,a.dK=Ve,a.dL=Bd,a.dM=Tc,a.dN=Up,a.dO=nP,a.dP=xN,a.dQ=CN,a.dR=hN,a.dS=eu,a.dT=$N,a.dU=c_,a.dV=function(i,n,o,u,h,p,m,v,w,E,C){i.createArrays(),i.tilePixelRatio=Dt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const P=i.layers[0].layout,M=i.layers[0]._unevaluatedLayout._values,z={};if(i.textSizeData.kind==="composite"){const{minZoom:ee,maxZoom:pe}=i.textSizeData;z.compositeTextSizes=[M["text-size"].possiblyEvaluate(new In(ee),v),M["text-size"].possiblyEvaluate(new In(pe),v)]}if(i.iconSizeData.kind==="composite"){const{minZoom:ee,maxZoom:pe}=i.iconSizeData;z.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new In(ee),v),M["icon-size"].possiblyEvaluate(new In(pe),v)]}z.layoutTextSize=M["text-size"].possiblyEvaluate(new In(w+1),v),z.layoutIconSize=M["icon-size"].possiblyEvaluate(new In(w+1),v),z.textMaxSize=M["text-size"].possiblyEvaluate(new In(18),v);const j=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",V=P.get("text-size");let $=!1;for(const ee of i.features)if(ee.icon&&ee.icon.nameSecondary){$=!0;break}for(const ee of i.features){const pe=P.get("text-font").evaluate(ee,{},v).join(","),fe=V.evaluate(ee,{},v),me=z.layoutTextSize.evaluate(ee,{},v),Ce=(z.layoutIconSize.evaluate(ee,{},v),{horizontal:{},vertical:void 0}),Ae=ee.text;let Le,$e=[0,0];if(Ae){const Ke=Ae.toString(),at=P.get("text-letter-spacing").evaluate(ee,{},v)*oo,bt=P.get("text-line-height").evaluate(ee,{},v)*oo,lt=_t(Ke)?at:0,St=P.get("text-anchor").evaluate(ee,{},v),ot=P.get("text-variable-anchor");if(!ot){const Ct=P.get("text-radial-offset").evaluate(ee,{},v);$e=Ct?ZN(St,[Ct*oo,GP]):P.get("text-offset").evaluate(ee,{},v).map(Tt=>Tt*oo)}let gt=j?"center":P.get("text-justify").evaluate(ee,{},v);const Pt=P.get("symbol-placement")==="point",ct=Pt?P.get("text-max-width").evaluate(ee,{},v)*oo:1/0,Nt=Ct=>{i.allowVerticalPlacement&&mt(Ke)&&(Ce.vertical=UP(Ae,n,o,h,pe,ct,bt,St,Ct,lt,$e,el.vertical,!0,me,fe))};if(!j&&ot){const Ct=gt==="auto"?ot.map(_n=>WP(_n)):[gt];let Tt=!1;for(let _n=0;_n<Ct.length;_n++){const un=Ct[_n];if(!Ce.horizontal[un])if(Tt)Ce.horizontal[un]=Ce.horizontal[0];else{const Kt=UP(Ae,n,o,h,pe,ct,bt,"center",un,lt,$e,el.horizontal,!1,me,fe);Kt&&(Ce.horizontal[un]=Kt,Tt=Kt.positionedLines.length===1)}}Nt("left")}else{if(gt==="auto"&&(gt=WP(St)),Pt||P.get("text-writing-mode").indexOf("horizontal")>=0||!mt(Ke)){const Ct=UP(Ae,n,o,h,pe,ct,bt,St,gt,lt,$e,el.horizontal,!1,me,fe);Ct&&(Ce.horizontal[gt]=Ct)}Nt(Pt?"left":gt)}}let Ze=!1;if(ee.icon&&ee.icon.namePrimary){const Ke=u[ee.icon.namePrimary];Ke&&(Le=WQ(h[ee.icon.namePrimary],ee.icon.nameSecondary?h[ee.icon.nameSecondary]:void 0,P.get("icon-offset").evaluate(ee,{},v),P.get("icon-anchor").evaluate(ee,{},v)),Ze=Ke.sdf,i.sdfIcons===void 0?i.sdfIcons=Ke.sdf:i.sdfIcons!==Ke.sdf&&bi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==i.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const nt=KN(Ce.horizontal)||Ce.vertical;i.iconsInText||(i.iconsInText=!!nt&&nt.iconsInText),(nt||Le)&&JQ(i,ee,Ce,Le,u,z,me,0,$e,Ze,m,v,E,C,$)}p&&i.generateCollisionDebugBuffers(w,i.collisionBoxArray)},a.dW=Bw,a.dX=Rw,a.dY=OP,a.dZ=lv,a.d_=zw,a.da=Xg,a.db=O,a.dc=CP,a.dd=rz,a.de=function(i){const n=[0,0,0],o=a.ae.identity(new Float64Array(16));return a.ae.multiply(o,i.pixelMatrix,i.globeMatrix),a.$.transformMat4(n,n,o),new Lt(n[0],n[1])},a.df=Y,a.dg=G,a.dh=function(i){const n=i.navigator?i.navigator.userAgent:null;return!!function(o){if(iu==null){const u=o.navigator?o.navigator.userAgent:null;iu=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return iu}(i)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.di=ac,a.dj=class{constructor(i,n,o){this._transformRequestFn=i,this._customAccessToken=n,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const i=function(){let n="";for(let o=0;o<10;o++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",f0,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,n){return this._transformRequestFn&&this._transformRequestFn(i,n)||{url:i}}normalizeStyleURL(i,n){if(!Z(i))return i;const o=Sa(i);return o.params.push(`sdk=js-${I}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeGlyphsURL(i,n){if(!Z(i))return i;const o=Sa(i);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeModelURL(i,n){if(!Z(i))return i;const o=Sa(i);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeSourceURL(i,n,o,u){if(!Z(i))return i;const h=Sa(i);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),o&&h.params.push(`language=${o}`),u&&h.params.push(`worldview=${u}`),this._makeAPIURL(h,this._customAccessToken||n)}normalizeSpriteURL(i,n,o,u){const h=Sa(i);return Z(i)?(h.path=`/styles/v1${h.path}/sprite${n}${o}`,this._makeAPIURL(h,this._customAccessToken||u)):(h.path+=`${n}${o}`,rh(h))}normalizeTileURL(i,n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Z(i))return i;const u=Sa(i);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||o&&u.authority!=="raster"&&o===512?"@2x":""}${mg.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${O.RASTER_URL_PREFIX}${u.path}`:u.authority==="rasterarrays"?u.path=`/${O.RASTERARRAYS_URL_PREFIX}${u.path}`:u.authority==="3dtiles"?u.path=`/${O.TILES3D_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${O.TILE_URL_VERSION}${u.path}`);const h=this._customAccessToken||function(p){for(const m of p){const v=m.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(u.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,h)}canonicalizeTileURL(i,n){const o=Sa(i);if(!o.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!o.path.match(/\.[\w]+$/))return i;let u="mapbox://";o.path.match(/^\/raster\/v1\//)?u+=`raster/${o.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:o.path.match(/^\/rasterarrays\/v1\//)?u+=`rasterarrays/${o.path.replace(`/${O.RASTERARRAYS_URL_PREFIX}/`,"")}`:u+=`tiles/${o.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let h=o.params;return n&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(u+=`?${h.join("&")}`),u}canonicalizeTileset(i,n){const o=!!n&&Z(n),u=[];for(const h of i.tiles||[])F(h)?u.push(this.canonicalizeTileURL(h,o)):u.push(h);return u}_makeAPIURL(i,n){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Sa(O.API_URL);if(i.protocol=u.protocol,i.authority=u.authority,i.protocol==="http"){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(u.path!=="/"&&(i.path=`${u.path}${i.path}`),!O.REQUIRE_ACCESS_TOKEN)return rh(i);if(n=n||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${n||""}`),rh(i)}},a.dk=function(i,n){n?up.add(i):up.delete(i)},a.dl=mg,a.dm=gA,a.dn=_0,a.dp=p0,a.dq=kb,a.dr=Db,a.ds=function(i){up.delete(i)},a.dt=cp,a.du=yd,a.dv=eh,a.dw=I,a.dx=function(i,n){As=i,Ps=n},a.dy=function(i,n,o=!1){if(Lr===bn||Lr===$n||Lr===hr)throw new Error("setRTLTextPlugin cannot be called multiple times.");pr=en.resolveURL(i),Lr=bn,Xr=n,Hn(),o||xr()},a.dz=Bn,a.e=en,a.e0=kw,a.e1=Mw,a.e2=Yc,a.e3=bN,a.e4=de,a.e5=nh,a.e6=function(i){let n=0;if(new Uint32Array(i,0,1)[0]!==QF){const o=new Uint32Array(i,0,7),[,,u,h,p,m]=o;n=o.byteLength+h+p+m+p,(u!==i.byteLength||n>=i.byteLength)&&bi("Invalid b3dm header information.")}return tB(i,n)},a.e7=function(i,n){const o=rB(i);for(const u of o){for(const h of u.meshes)lJ(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(cJ(u.lights,n)))}return o},a.e8=mT,a.e9=HF,a.ea=tr,a.eb=function(i){rp(),as&&as.then(n=>{n.keys().then(o=>{for(let u=0;u<o.length-i;u++)n.delete(o[u])})})},a.f=hp,a.g=Il,a.h=function(i,n){return Sl(Is(i,{type:"json"}),n)},a.i=ap,a.j=Ja,a.k=VN,a.l=function(i){return fetch(i).then(n=>n.arrayBuffer()).then(n=>tB(n,0,i))},a.m=$P,a.n=class extends cT{},a.o=su,a.p=dY,a.q=xd,a.r=S,a.s=L,a.t=k,a.u=gc,a.v=ve,a.w=bi,a.x=Ya,a.y=Ie,a.z=_e}),_(["./shared"],function(a){function I(je){const te=je?je.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function D(je){if(typeof je=="number"||typeof je=="boolean"||typeof je=="string"||je==null)return JSON.stringify(je);if(Array.isArray(je)){let le="[";for(const xe of je)le+=`${D(xe)},`;return`${le}]`}let te="{";for(const le of Object.keys(je).sort())te+=`${le}:${D(je[le])},`;return`${te}}`}function O(je){let te="";for(const le of a.cG)te+=`/${D(je[le])}`;return te}class F{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,le){this._layerConfigs={},this._layers={},this.update(te,[],le)}update(te,le,xe){this._options=xe;for(const De of te)this._layerConfigs[De.id]=De,(this._layers[De.id]=a.c$(De,this.scope,null,this._options)).compileFilter(),this.keyCache[De.id]&&delete this.keyCache[De.id];for(const De of le)delete this.keyCache[De],delete this._layerConfigs[De],delete this._layers[De];this.familiesBySource={};const Oe=function(De,Ge){const rt={};for(let tt=0;tt<De.length;tt++){const yt=Ge&&Ge[De[tt].id]||O(De[tt]);Ge&&(Ge[De[tt].id]=yt);let vt=rt[yt];vt||(vt=rt[yt]=[]),vt.push(De[tt])}const qe=[];for(const tt in rt)qe.push(rt[tt]);return qe}(a.dJ(this._layerConfigs),this.keyCache);for(const De of Oe){const Ge=De.map(Wt=>this._layers[Wt.id]),rt=Ge[0];if(rt.visibility==="none")continue;const qe=rt.source||"";let tt=this.familiesBySource[qe];tt||(tt=this.familiesBySource[qe]={});const yt=rt.sourceLayer||"_geojsonTileLayer";let vt=tt[yt];vt||(vt=tt[yt]=[]),vt.push(Ge)}}}const Z=1*a.dM;class J{constructor(te){const le={},xe=[];for(const rt in te){const qe=te[rt],tt=le[rt]={};for(const yt in qe.glyphs){const vt=qe.glyphs[+yt];if(!vt||vt.bitmap.width===0||vt.bitmap.height===0)continue;const Wt=vt.metrics.localGlyph?Z:1,pn={x:0,y:0,w:vt.bitmap.width+2*Wt,h:vt.bitmap.height+2*Wt};xe.push(pn),tt[yt]=pn}}const{w:Oe,h:De}=a.k(xe),Ge=new a.dL({width:Oe||1,height:De||1});for(const rt in te){const qe=te[rt];for(const tt in qe.glyphs){const yt=qe.glyphs[+tt];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const vt=le[rt][tt],Wt=yt.metrics.localGlyph?Z:1;a.dL.copy(yt.bitmap,Ge,{x:0,y:0},{x:vt.x+Wt,y:vt.y+Wt},yt.bitmap)}}this.image=Ge,this.positions=le}}a.dK(J,"GlyphAtlas");class re{constructor(te){this.tileID=new a.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=a.dN(te.tileID.canonical,te.projection),this.projection=te.projection,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep}parse(te,le,xe,Oe,De){this.status="parsing",this.data=te,this.collisionBoxArray=new a.dO;const Ge=new a.dP(Object.keys(te.layers).sort()),rt=new a.dQ(this.tileID,this.promoteId);rt.bucketLayerIDs=[];const qe={},tt=new a.dR(256,256),yt={featureIndex:rt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:tt,availableImages:xe,brightness:this.brightness},vt=le.familiesBySource[this.source];for(const ln in vt){const Zr=te.layers[ln];if(!Zr)continue;let _r=!1,cr=!1,pi=!1;for(const Ss of vt[ln])Ss[0].type==="symbol"?_r=!0:cr=!0,Ss[0].is3D()&&Ss[0].type!=="model"&&(pi=!0);if(this.extraShadowCaster&&!pi||this.isSymbolTile===!0&&!_r||this.isSymbolTile===!1&&!cr)continue;Zr.version===1&&a.w(`Vector tile source "${this.source}" layer "${ln}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const mi=Ge.encode(ln),Gi=[];for(let Ss=0;Ss<Zr.length;Ss++){const qs=Zr.feature(Ss),tc=rt.getId(qs,ln);Gi.push({feature:qs,id:tc,index:Ss,sourceLayerIndex:mi})}for(const Ss of vt[ln]){const qs=Ss[0];(!this.extraShadowCaster||qs.is3D()&&qs.type!=="model")&&(this.isSymbolTile!==void 0&&qs.type==="symbol"!==this.isSymbolTile||qs.minzoom&&this.zoom<Math.floor(qs.minzoom)||qs.maxzoom&&this.zoom>=qs.maxzoom||qs.visibility!=="none"&&(ne(Ss,this.zoom,yt.brightness,xe),(qe[qs.id]=qs.createBucket({index:rt.bucketLayerIDs.length,layers:Ss,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Gi,yt,this.tileID.canonical,this.tileTransform),rt.bucketLayerIDs.push(Ss.map(tc=>tc.id))))}}let Wt,pn,wn,ar;tt.trim();const An={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},lr=()=>{if(Wt)return this.status="done",De(Wt);if(this.extraShadowCaster)this.status="done",De(null,{buckets:a.dJ(qe).filter(ln=>!ln.isEmpty()),featureIndex:rt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:yt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(pn&&wn&&ar){const ln=new J(pn),Zr=new a.dT(wn,ar,this.lut);for(const _r in qe){const cr=qe[_r];cr instanceof a.dU?(ne(cr.layers,this.zoom,yt.brightness,xe),a.dV(cr,pn,ln.positions,wn,Zr.iconPositions,this.showCollisionBoxes,xe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):cr.hasPattern&&(cr instanceof a.dW||cr instanceof a.dX||cr instanceof a.c0)&&(ne(cr.layers,this.zoom,yt.brightness,xe),cr.addFeatures(yt,this.tileID.canonical,Zr.patternPositions,xe,this.tileTransform,this.brightness))}this.status="done",De(null,{buckets:a.dJ(qe).filter(_r=>!_r.isEmpty()),featureIndex:rt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ln.image,lineAtlas:tt,imageAtlas:Zr,brightness:yt.brightness})}};if(!this.extraShadowCaster){const ln=a.dS(yt.glyphDependencies,cr=>Object.keys(cr).map(Number));Object.keys(ln).length?Oe.send("getGlyphs",{uid:this.uid,stacks:ln,scope:this.scope},(cr,pi)=>{Wt||(Wt=cr,pn=pi,lr())},void 0,!1,An):pn={};const Zr=Object.keys(yt.iconDependencies);Zr.length?Oe.send("getImages",{icons:Zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(cr,pi)=>{Wt||(Wt=cr,wn=pi,lr())},void 0,!1,An):wn={};const _r=Object.keys(yt.patternDependencies);_r.length?Oe.send("getImages",{icons:_r,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(cr,pi)=>{Wt||(Wt=cr,ar=pi,lr())},void 0,!1,An):ar={}}lr()}}function ne(je,te,le,xe){const Oe=new a.Y(te,{brightness:le});for(const De of je)De.recalculate(Oe,xe)}class G extends a.E{constructor(te,le,xe,Oe,De,Ge){super(),this.actor=te,this.layerIndex=le,this.availableImages=xe,this.loadVectorData=De||a.aq,this.loading={},this.loaded={},this.deduped=new a.ap(te.scheduler),this.isSpriteLoaded=Oe,this.scheduler=te.scheduler,this.brightness=Ge}loadTile(te,le){const xe=te.uid,Oe=te&&te.request,De=Oe&&Oe.collectResourceTiming,Ge=this.loading[xe]=new re(te);Ge.abort=this.loadVectorData(te,(rt,qe)=>{const tt=!this.loading[xe];if(delete this.loading[xe],tt||rt||!qe)return Ge.status="done",tt||(this.loaded[xe]=Ge),le(rt);const yt=qe.rawData,vt={};qe.expires&&(vt.expires=qe.expires),qe.cacheControl&&(vt.cacheControl=qe.cacheControl),Ge.vectorTile=qe.vectorTile||new a.dY(new a.dZ(yt));const Wt=()=>{Ge.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,(pn,wn)=>{if(pn||!wn)return le(pn);const ar={};if(De){const An=I(Oe);An.length>0&&(ar.resourceTiming=JSON.parse(JSON.stringify(An)))}le(null,a.Q({rawTileData:yt.slice(0)},wn,vt,ar))})};this.isSpriteLoaded?Wt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Wt,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):Wt()}),this.loaded=this.loaded||{},this.loaded[xe]=Ge})}reloadTile(te,le){const xe=this.loaded,Oe=te.uid;if(xe&&xe[Oe]){const De=xe[Oe];De.showCollisionBoxes=te.showCollisionBoxes,De.projection=te.projection,De.brightness=te.brightness,De.tileTransform=a.dN(te.tileID.canonical,te.projection),De.extraShadowCaster=te.extraShadowCaster,De.lut=te.lut;const Ge=(rt,qe)=>{const tt=De.reloadCallback;tt&&(delete De.reloadCallback,De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,tt)),le(rt,qe)};De.status==="parsing"?De.reloadCallback=Ge:De.status==="done"&&(De.vectorTile?De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,Ge):Ge())}else le(null,void 0)}abortTile(te,le){const xe=te.uid,Oe=this.loading[xe];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[xe]),le()}removeTile(te,le){const xe=this.loaded,Oe=te.uid;xe&&xe[Oe]&&delete xe[Oe],le()}}class Y{loadTile(te,le){const{uid:xe,encoding:Oe,rawImageData:De,padding:Ge}=te,rt=ImageBitmap&&De instanceof ImageBitmap?this.getImageData(De,Ge):De;le(null,new a.d_(xe,rt,Oe,Ge<1))}getImageData(te,le){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const xe=this.offscreenCanvasContext.getImageData(-le,-le,te.width+2*le,te.height+2*le);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}a.d$.setPbf(a.dZ);class Q{decodeRasterArray({task:te,buffer:le},xe){a.d$.performDecoding(le,te).then(Oe=>{xe(null,Oe)},Oe=>{xe(Oe)})}}const de=a.e0.prototype.toGeoJSON;let Te=class{constructor(je){this._feature=je,this.extent=a.a4,this.type=je.type,this.properties=je.tags,"id"in je&&!isNaN(je.id)&&(this.id=parseInt(je.id,10))}loadGeometry(){if(this._feature.type===1){const je=[];for(const te of this._feature.geometry)je.push([new a.P(te[0],te[1])]);return je}{const je=[];for(const te of this._feature.geometry){const le=[];for(const xe of te)le.push(new a.P(xe[0],xe[1]));je.push(le)}return je}}toGeoJSON(je,te,le){return de.call(this,je,te,le)}},we=class{constructor(je){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.a4,this.length=je.length,this._features=je}feature(je){return new Te(this._features[je])}};const oe=64/4096,he=128;class X{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],le){for(const xe of te){const Oe=xe.id;if(Oe==null)continue;let De=this.features.get(Oe);De&&this.updateCache(De,le),xe.geometry?(De=be(xe),this.updateCache(De,le),this.features.set(Oe,De)):this.features.delete(Oe),this.updateCache(De,le)}}updateCache(te,le){for(const{canonical:xe,uid:Oe}of Object.values(le)){const{z:De,x:Ge,y:rt}=xe;ge(te,Math.pow(2,De),Ge,rt)&&delete le[Oe]}}getTile(te,le,xe){const Oe=Math.pow(2,te),De=[];for(const Ge of this.features.values())ge(Ge,Oe,le,xe)&&De.push(Ut(Ge,Oe,le,xe));return{features:De}}getFeatures(){return[...this.features.values()]}}function ge({minX:je,minY:te,maxX:le,maxY:xe},Oe,De,Ge){return je<(De+1+oe)/Oe&&te<(Ge+1+oe)/Oe&&le>(De-oe)/Oe&&xe>(Ge-oe)/Oe}function be(je){const{id:te,geometry:le,properties:xe}=je;if(!le)return;if(le.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Oe,coordinates:De}=le,Ge={id:te,type:1,geometry:[],tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},rt=Ge.geometry;if(Oe==="Point")ke(De,rt,Ge);else if(Oe==="MultiPoint")for(const qe of De)ke(qe,rt,Ge);else if(Oe==="LineString")Ge.type=2,Ee(De,rt,Ge);else if(Oe==="MultiLineString")Ge.type=2,zt(De,rt,Ge);else if(Oe==="Polygon")Ge.type=3,zt(De,rt,Ge,!0);else{if(Oe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ge.type=3;for(const qe of De)zt(qe,rt,Ge,!0)}return Ge}function ke([je,te],le,xe){const Oe=a.ak(je);let De=a.al(te);De=De<0?0:De>1?1:De,le.push(Oe,De),xe.minX=Math.min(xe.minX,Oe),xe.minY=Math.min(xe.minY,De),xe.maxX=Math.max(xe.maxX,Oe),xe.maxY=Math.max(xe.maxY,De)}function Ee(je,te,le,xe=!1,Oe=!1){const De=[];for(const Ge of je)ke(Ge,De,le);te.push(De),xe&&function(Ge,rt){let qe=0;for(let tt=0,yt=Ge.length,vt=yt-2;tt<yt;vt=tt,tt+=2)qe+=(Ge[tt]-Ge[vt])*(Ge[tt+1]+Ge[vt+1]);if(qe>0===rt)for(let tt=0,yt=Ge.length;tt<yt/2;tt+=2){const vt=Ge[tt],Wt=Ge[tt+1];Ge[tt]=Ge[yt-2-tt],Ge[tt+1]=Ge[yt-1-tt],Ge[yt-2-tt]=vt,Ge[yt-1-tt]=Wt}}(De,Oe)}function zt(je,te,le,xe=!1){for(let Oe=0;Oe<je.length;Oe++)Ee(je[Oe],te,le,xe,Oe===0)}function Ut(je,te,le,xe){const{id:Oe,type:De,geometry:Ge,tags:rt}=je,qe=[];if(De===1)(function(tt,yt,vt,Wt,pn){for(let wn=0;wn<tt.length;wn+=2){const ar=Math.round(a.a4*(tt[wn+0]*yt-vt)),An=Math.round(a.a4*(tt[wn+1]*yt-Wt));pn.push([ar,An])}})(Ge,te,le,xe,qe);else for(const tt of Ge)Qt(tt,te,le,xe,qe);return{id:Oe,type:De,geometry:qe,tags:rt}}function Qt(je,te,le,xe,Oe){const De=-he,Ge=a.a4+he;let rt;for(let qe=0;qe<je.length-2;qe+=2){let tt=Math.round(a.a4*(je[qe+0]*te-le)),yt=Math.round(a.a4*(je[qe+1]*te-xe)),vt=Math.round(a.a4*(je[qe+2]*te-le)),Wt=Math.round(a.a4*(je[qe+3]*te-xe));const pn=vt-tt,wn=Wt-yt;tt<De&&vt<De||(tt<De?(yt+=Math.round(wn*((De-tt)/pn)),tt=De):vt<De&&(Wt=yt+Math.round(wn*((De-tt)/pn)),vt=De),yt<De&&Wt<De||(yt<De?(tt+=Math.round(pn*((De-yt)/wn)),yt=De):Wt<De&&(vt=tt+Math.round(pn*((De-yt)/wn)),Wt=De),tt>=Ge&&vt>=Ge||(tt>=Ge?(yt+=Math.round(wn*((Ge-tt)/pn)),tt=Ge):vt>=Ge&&(Wt=yt+Math.round(wn*((Ge-tt)/pn)),vt=Ge),yt>=Ge&&Wt>=Ge||(yt>=Ge?(tt+=Math.round(pn*((Ge-yt)/wn)),yt=Ge):Wt>=Ge&&(vt=tt+Math.round(pn*((Ge-yt)/wn)),Wt=Ge),rt&&tt===rt[rt.length-1][0]&&yt===rt[rt.length-1][1]||(rt=[[tt,yt]],Oe.push(rt)),rt.push([vt,Wt])))))}}var kt={exports:{}},ft=a.e2,Rt=a.e1.VectorTileFeature,Yt=ht;function ht(je,te){this.options=te||{},this.features=je,this.length=je.length}function At(je,te){this.id=typeof je.id=="number"?je.id:void 0,this.type=je.type,this.rawGeometry=je.type===1?[je.geometry]:je.geometry,this.properties=je.tags,this.extent=te||4096}ht.prototype.feature=function(je){return new At(this.features[je],this.options.extent)},At.prototype.loadGeometry=function(){var je=this.rawGeometry;this.geometry=[];for(var te=0;te<je.length;te++){for(var le=je[te],xe=[],Oe=0;Oe<le.length;Oe++)xe.push(new ft(le[Oe][0],le[Oe][1]));this.geometry.push(xe)}return this.geometry},At.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var je=this.geometry,te=1/0,le=-1/0,xe=1/0,Oe=-1/0,De=0;De<je.length;De++)for(var Ge=je[De],rt=0;rt<Ge.length;rt++){var qe=Ge[rt];te=Math.min(te,qe.x),le=Math.max(le,qe.x),xe=Math.min(xe,qe.y),Oe=Math.max(Oe,qe.y)}return[te,xe,le,Oe]},At.prototype.toGeoJSON=Rt.prototype.toGeoJSON;var wt=a.e3,Xt=Yt;function Ft(je){var te=new wt;return function(le,xe){for(var Oe in le.layers)xe.writeMessage(3,Sn,le.layers[Oe])}(je,te),te.finish()}function Sn(je,te){var le;te.writeVarintField(15,je.version||1),te.writeStringField(1,je.name||""),te.writeVarintField(5,je.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<je.length;le++)xe.feature=je.feature(le),te.writeMessage(2,qn,xe);var Oe=xe.keys;for(le=0;le<Oe.length;le++)te.writeStringField(3,Oe[le]);var De=xe.values;for(le=0;le<De.length;le++)te.writeMessage(4,Rn,De[le])}function qn(je,te){var le=je.feature;le.id!==void 0&&te.writeVarintField(1,le.id),te.writeMessage(2,Qn,je),te.writeVarintField(3,le.type),te.writeMessage(4,hn,le)}function Qn(je,te){var le=je.feature,xe=je.keys,Oe=je.values,De=je.keycache,Ge=je.valuecache;for(var rt in le.properties){var qe=le.properties[rt],tt=De[rt];if(qe!==null){tt===void 0&&(xe.push(rt),De[rt]=tt=xe.length-1),te.writeVarint(tt);var yt=typeof qe;yt!=="string"&&yt!=="boolean"&&yt!=="number"&&(qe=JSON.stringify(qe));var vt=yt+":"+qe,Wt=Ge[vt];Wt===void 0&&(Oe.push(qe),Ge[vt]=Wt=Oe.length-1),te.writeVarint(Wt)}}}function Gt(je,te){return(te<<3)+(7&je)}function Cn(je){return je<<1^je>>31}function hn(je,te){for(var le=je.loadGeometry(),xe=je.type,Oe=0,De=0,Ge=le.length,rt=0;rt<Ge;rt++){var qe=le[rt],tt=1;xe===1&&(tt=qe.length),te.writeVarint(Gt(1,tt));for(var yt=xe===3?qe.length-1:qe.length,vt=0;vt<yt;vt++){vt===1&&xe!==1&&te.writeVarint(Gt(2,yt-1));var Wt=qe[vt].x-Oe,pn=qe[vt].y-De;te.writeVarint(Cn(Wt)),te.writeVarint(Cn(pn)),Oe+=Wt,De+=pn}xe===3&&te.writeVarint(Gt(7,1))}}function Rn(je,te){var le=typeof je;le==="string"?te.writeStringField(1,je):le==="boolean"?te.writeBooleanField(7,je):le==="number"&&(je%1!=0?te.writeDoubleField(3,je):je<0?te.writeSVarintField(6,je):te.writeVarintField(5,je))}kt.exports=Ft,kt.exports.fromVectorTileJs=Ft,kt.exports.fromGeojsonVt=function(je,te){te=te||{};var le={};for(var xe in je)le[xe]=new Xt(je[xe].features,te),le[xe].name=xe,le[xe].version=te.version,le[xe].extent=te.extent;return Ft({layers:le})},kt.exports.GeoJSONWrapper=Xt;var Nr=a.e4(kt.exports);const jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:je=>je},gr=Math.fround||(Fr=new Float32Array(1),je=>(Fr[0]=+je,Fr[0]));var Fr;const dr=3,rr=5,Ue=6;class Xe{constructor(te){this.options=Object.assign(Object.create(jn),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:le,minZoom:xe,maxZoom:Oe}=this.options;le&&console.time("total time");const De=`prepare ${te.length} points`;le&&console.time(De),this.points=te;const Ge=[];for(let qe=0;qe<te.length;qe++){const tt=te[qe];if(!tt.geometry)continue;const[yt,vt]=tt.geometry.coordinates,Wt=gr(st(yt)),pn=gr(Mt(vt));Ge.push(Wt,pn,1/0,qe,-1,1),this.options.reduce&&Ge.push(0)}let rt=this.trees[Oe+1]=this._createTree(Ge);le&&console.timeEnd(De);for(let qe=Oe;qe>=xe;qe--){const tt=+Date.now();rt=this.trees[qe]=this._createTree(this._cluster(rt,qe)),le&&console.log("z%d: %d clusters in %dms",qe,rt.numItems,+Date.now()-tt)}return le&&console.timeEnd("total time"),this}getClusters(te,le){let xe=((te[0]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,te[1]));let De=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)xe=-180,De=180;else if(xe>De){const vt=this.getClusters([xe,Oe,180,Ge],le),Wt=this.getClusters([-180,Oe,De,Ge],le);return vt.concat(Wt)}const rt=this.trees[this._limitZoom(le)],qe=rt.range(st(xe),Mt(Ge),st(De),Mt(Oe)),tt=rt.data,yt=[];for(const vt of qe){const Wt=this.stride*vt;yt.push(tt[Wt+rr]>1?ut(tt,Wt,this.clusterProps):this.points[tt[Wt+dr]])}return yt}getChildren(te){const le=this._getOriginId(te),xe=this._getOriginZoom(te),Oe="No cluster with the specified id.",De=this.trees[xe];if(!De)throw new Error(Oe);const Ge=De.data;if(le*this.stride>=Ge.length)throw new Error(Oe);const rt=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),qe=De.within(Ge[le*this.stride],Ge[le*this.stride+1],rt),tt=[];for(const yt of qe){const vt=yt*this.stride;Ge[vt+4]===te&&tt.push(Ge[vt+rr]>1?ut(Ge,vt,this.clusterProps):this.points[Ge[vt+dr]])}if(tt.length===0)throw new Error(Oe);return tt}getLeaves(te,le,xe){const Oe=[];return this._appendLeaves(Oe,te,le=le||10,xe=xe||0,0),Oe}getTile(te,le,xe){const Oe=this.trees[this._limitZoom(te)],De=Math.pow(2,te),{extent:Ge,radius:rt}=this.options,qe=rt/Ge,tt=(xe-qe)/De,yt=(xe+1+qe)/De,vt={features:[]};return this._addTileFeatures(Oe.range((le-qe)/De,tt,(le+1+qe)/De,yt),Oe.data,le,xe,De,vt),le===0&&this._addTileFeatures(Oe.range(1-qe/De,tt,1,yt),Oe.data,De,xe,De,vt),le===De-1&&this._addTileFeatures(Oe.range(0,tt,qe/De,yt),Oe.data,-1,xe,De,vt),vt.features.length?vt:null}getClusterExpansionZoom(te){let le=this._getOriginZoom(te)-1;for(;le<=this.options.maxZoom;){const xe=this.getChildren(te);if(le++,xe.length!==1)break;te=xe[0].properties.cluster_id}return le}_appendLeaves(te,le,xe,Oe,De){const Ge=this.getChildren(le);for(const rt of Ge){const qe=rt.properties;if(qe&&qe.cluster?De+qe.point_count<=Oe?De+=qe.point_count:De=this._appendLeaves(te,qe.cluster_id,xe,Oe,De):De<Oe?De++:te.push(rt),te.length===xe)break}return De}_createTree(te){const le=new a.cN(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<te.length;xe+=this.stride)le.add(te[xe],te[xe+1]);return le.finish(),le.data=te,le}_addTileFeatures(te,le,xe,Oe,De,Ge){for(const rt of te){const qe=rt*this.stride,tt=le[qe+rr]>1;let yt,vt,Wt;if(tt)yt=Ye(le,qe,this.clusterProps),vt=le[qe],Wt=le[qe+1];else{const ar=this.points[le[qe+dr]];yt=ar.properties;const[An,lr]=ar.geometry.coordinates;vt=st(An),Wt=Mt(lr)}const pn={type:1,geometry:[[Math.round(this.options.extent*(vt*De-xe)),Math.round(this.options.extent*(Wt*De-Oe))]],tags:yt};let wn;wn=tt||this.options.generateId?le[qe+dr]:this.points[le[qe+dr]].id,wn!==void 0&&(pn.id=wn),Ge.features.push(pn)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,le){const{radius:xe,extent:Oe,reduce:De,minPoints:Ge}=this.options,rt=xe/(Oe*Math.pow(2,le)),qe=te.data,tt=[],yt=this.stride;for(let vt=0;vt<qe.length;vt+=yt){if(qe[vt+2]<=le)continue;qe[vt+2]=le;const Wt=qe[vt],pn=qe[vt+1],wn=te.within(qe[vt],qe[vt+1],rt),ar=qe[vt+rr];let An=ar;for(const lr of wn){const ln=lr*yt;qe[ln+2]>le&&(An+=qe[ln+rr])}if(An>ar&&An>=Ge){let lr,ln=Wt*ar,Zr=pn*ar,_r=-1;const cr=(vt/yt<<5)+(le+1)+this.points.length;for(const pi of wn){const mi=pi*yt;if(qe[mi+2]<=le)continue;qe[mi+2]=le;const Gi=qe[mi+rr];ln+=qe[mi]*Gi,Zr+=qe[mi+1]*Gi,qe[mi+4]=cr,De&&(lr||(lr=this._map(qe,vt,!0),_r=this.clusterProps.length,this.clusterProps.push(lr)),De(lr,this._map(qe,mi)))}qe[vt+4]=cr,tt.push(ln/An,Zr/An,1/0,cr,-1,An),De&&tt.push(_r)}else{for(let lr=0;lr<yt;lr++)tt.push(qe[vt+lr]);if(An>1)for(const lr of wn){const ln=lr*yt;if(!(qe[ln+2]<=le)){qe[ln+2]=le;for(let Zr=0;Zr<yt;Zr++)tt.push(qe[ln+Zr])}}}}return tt}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,le,xe){if(te[le+rr]>1){const Ge=this.clusterProps[te[le+Ue]];return xe?Object.assign({},Ge):Ge}const Oe=this.points[te[le+dr]].properties,De=this.options.map(Oe);return xe&&De===Oe?Object.assign({},De):De}}function ut(je,te,le){return{type:"Feature",id:je[te+dr],properties:Ye(je,te,le),geometry:{type:"Point",coordinates:[(xe=je[te],360*(xe-.5)),an(je[te+1])]}};var xe}function Ye(je,te,le){const xe=je[te+rr],Oe=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,De=je[te+Ue],Ge=De===-1?{}:Object.assign({},le[De]);return Object.assign(Ge,{cluster:!0,cluster_id:je[te+dr],point_count:xe,point_count_abbreviated:Oe})}function st(je){return je/360+.5}function Mt(je){const te=Math.sin(je*Math.PI/180),le=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return le<0?0:le>1?1:le}function an(je){const te=(180-360*je)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function qt(je,te,le,xe){let Oe=xe;const De=te+(le-te>>1);let Ge,rt=le-te;const qe=je[te],tt=je[te+1],yt=je[le],vt=je[le+1];for(let Wt=te+3;Wt<le;Wt+=3){const pn=mn(je[Wt],je[Wt+1],qe,tt,yt,vt);if(pn>Oe)Ge=Wt,Oe=pn;else if(pn===Oe){const wn=Math.abs(Wt-De);wn<rt&&(Ge=Wt,rt=wn)}}Oe>xe&&(Ge-te>3&&qt(je,te,Ge,xe),je[Ge+2]=Oe,le-Ge>3&&qt(je,Ge,le,xe))}function mn(je,te,le,xe,Oe,De){let Ge=Oe-le,rt=De-xe;if(Ge!==0||rt!==0){const qe=((je-le)*Ge+(te-xe)*rt)/(Ge*Ge+rt*rt);qe>1?(le=Oe,xe=De):qe>0&&(le+=Ge*qe,xe+=rt*qe)}return Ge=je-le,rt=te-xe,Ge*Ge+rt*rt}function Ln(je,te,le,xe){const Oe={id:je??null,type:te,geometry:le,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")fr(Oe,le);else if(te==="Polygon")fr(Oe,le[0]);else if(te==="MultiLineString")for(const De of le)fr(Oe,De);else if(te==="MultiPolygon")for(const De of le)fr(Oe,De[0]);return Oe}function fr(je,te){for(let le=0;le<te.length;le+=3)je.minX=Math.min(je.minX,te[le]),je.minY=Math.min(je.minY,te[le+1]),je.maxX=Math.max(je.maxX,te[le]),je.maxY=Math.max(je.maxY,te[le+1])}function fi(je,te,le,xe){if(!te.geometry)return;const Oe=te.geometry.coordinates;if(Oe&&Oe.length===0)return;const De=te.geometry.type,Ge=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let rt=[],qe=te.id;if(le.promoteId?qe=te.properties[le.promoteId]:le.generateId&&(qe=xe||0),De==="Point")ir(Oe,rt);else if(De==="MultiPoint")for(const tt of Oe)ir(tt,rt);else if(De==="LineString")Ci(Oe,rt,Ge,!1);else if(De==="MultiLineString"){if(le.lineMetrics){for(const tt of Oe)rt=[],Ci(tt,rt,Ge,!1),je.push(Ln(qe,"LineString",rt,te.properties));return}ss(Oe,rt,Ge,!1)}else if(De==="Polygon")ss(Oe,rt,Ge,!0);else{if(De!=="MultiPolygon"){if(De==="GeometryCollection"){for(const tt of te.geometry.geometries)fi(je,{id:qe,geometry:tt,properties:te.properties},le,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const tt of Oe){const yt=[];ss(tt,yt,Ge,!0),rt.push(yt)}}je.push(Ln(qe,De,rt,te.properties))}function ir(je,te){te.push(Tn(je[0]),or(je[1]),0)}function Ci(je,te,le,xe){let Oe,De,Ge=0;for(let qe=0;qe<je.length;qe++){const tt=Tn(je[qe][0]),yt=or(je[qe][1]);te.push(tt,yt,0),qe>0&&(Ge+=xe?(Oe*yt-tt*De)/2:Math.sqrt(Math.pow(tt-Oe,2)+Math.pow(yt-De,2))),Oe=tt,De=yt}const rt=te.length-3;te[2]=1,qt(te,0,rt,le),te[rt+2]=1,te.size=Math.abs(Ge),te.start=0,te.end=te.size}function ss(je,te,le,xe){for(let Oe=0;Oe<je.length;Oe++){const De=[];Ci(je[Oe],De,le,xe),te.push(De)}}function Tn(je){return je/360+.5}function or(je){const te=Math.sin(je*Math.PI/180),le=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return le<0?0:le>1?1:le}function dn(je,te,le,xe,Oe,De,Ge,rt){if(xe/=te,De>=(le/=te)&&Ge<xe)return je;if(Ge<le||De>=xe)return null;const qe=[];for(const tt of je){const yt=tt.geometry;let vt=tt.type;const Wt=Oe===0?tt.minX:tt.minY,pn=Oe===0?tt.maxX:tt.maxY;if(Wt>=le&&pn<xe){qe.push(tt);continue}if(pn<le||Wt>=xe)continue;let wn=[];if(vt==="Point"||vt==="MultiPoint")Js(yt,wn,le,xe,Oe);else if(vt==="LineString")Ai(yt,wn,le,xe,Oe,!1,rt.lineMetrics);else if(vt==="MultiLineString")wa(yt,wn,le,xe,Oe,!1);else if(vt==="Polygon")wa(yt,wn,le,xe,Oe,!0);else if(vt==="MultiPolygon")for(const ar of yt){const An=[];wa(ar,An,le,xe,Oe,!0),An.length&&wn.push(An)}if(wn.length){if(rt.lineMetrics&&vt==="LineString"){for(const ar of wn)qe.push(Ln(tt.id,vt,ar,tt.tags));continue}vt!=="LineString"&&vt!=="MultiLineString"||(wn.length===1?(vt="LineString",wn=wn[0]):vt="MultiLineString"),vt!=="Point"&&vt!=="MultiPoint"||(vt=wn.length===3?"Point":"MultiPoint"),qe.push(Ln(tt.id,vt,wn,tt.tags))}}return qe.length?qe:null}function Js(je,te,le,xe,Oe){for(let De=0;De<je.length;De+=3){const Ge=je[De+Oe];Ge>=le&&Ge<=xe&&nn(te,je[De],je[De+1],je[De+2])}}function Ai(je,te,le,xe,Oe,De,Ge){let rt=fo(je);const qe=Oe===0?Jn:ti;let tt,yt,vt=je.start;for(let An=0;An<je.length-3;An+=3){const lr=je[An],ln=je[An+1],Zr=je[An+2],_r=je[An+3],cr=je[An+4],pi=Oe===0?lr:ln,mi=Oe===0?_r:cr;let Gi=!1;Ge&&(tt=Math.sqrt(Math.pow(lr-_r,2)+Math.pow(ln-cr,2))),pi<le?mi>le&&(yt=qe(rt,lr,ln,_r,cr,le),Ge&&(rt.start=vt+tt*yt)):pi>xe?mi<xe&&(yt=qe(rt,lr,ln,_r,cr,xe),Ge&&(rt.start=vt+tt*yt)):nn(rt,lr,ln,Zr),mi<le&&pi>=le&&(yt=qe(rt,lr,ln,_r,cr,le),Gi=!0),mi>xe&&pi<=xe&&(yt=qe(rt,lr,ln,_r,cr,xe),Gi=!0),!De&&Gi&&(Ge&&(rt.end=vt+tt*yt),te.push(rt),rt=fo(je)),Ge&&(vt+=tt)}let Wt=je.length-3;const pn=je[Wt],wn=je[Wt+1],ar=Oe===0?pn:wn;ar>=le&&ar<=xe&&nn(rt,pn,wn,je[Wt+2]),Wt=rt.length-3,De&&Wt>=3&&(rt[Wt]!==rt[0]||rt[Wt+1]!==rt[1])&&nn(rt,rt[0],rt[1],rt[2]),rt.length&&te.push(rt)}function fo(je){const te=[];return te.size=je.size,te.start=je.start,te.end=je.end,te}function wa(je,te,le,xe,Oe,De){for(const Ge of je)Ai(Ge,te,le,xe,Oe,De,!1)}function nn(je,te,le,xe){je.push(te,le,xe)}function Jn(je,te,le,xe,Oe,De){const Ge=(De-te)/(xe-te);return nn(je,De,le+(Oe-le)*Ge,1),Ge}function ti(je,te,le,xe,Oe,De){const Ge=(De-le)/(Oe-le);return nn(je,te+(xe-te)*Ge,De,1),Ge}function Mi(je,te){const le=[];for(let xe=0;xe<je.length;xe++){const Oe=je[xe],De=Oe.type;let Ge;if(De==="Point"||De==="MultiPoint"||De==="LineString")Ge=Ts(Oe.geometry,te);else if(De==="MultiLineString"||De==="Polygon"){Ge=[];for(const rt of Oe.geometry)Ge.push(Ts(rt,te))}else if(De==="MultiPolygon"){Ge=[];for(const rt of Oe.geometry){const qe=[];for(const tt of rt)qe.push(Ts(tt,te));Ge.push(qe)}}le.push(Ln(Oe.id,De,Ge,Oe.tags))}return le}function Ts(je,te){const le=[];le.size=je.size,je.start!==void 0&&(le.start=je.start,le.end=je.end);for(let xe=0;xe<je.length;xe+=3)le.push(je[xe]+te,je[xe+1],je[xe+2]);return le}function Es(je,te){if(je.transformed)return je;const le=1<<je.z,xe=je.x,Oe=je.y;for(const De of je.features){const Ge=De.geometry,rt=De.type;if(De.geometry=[],rt===1)for(let qe=0;qe<Ge.length;qe+=2)De.geometry.push(Ls(Ge[qe],Ge[qe+1],te,le,xe,Oe));else for(let qe=0;qe<Ge.length;qe++){const tt=[];for(let yt=0;yt<Ge[qe].length;yt+=2)tt.push(Ls(Ge[qe][yt],Ge[qe][yt+1],te,le,xe,Oe));De.geometry.push(tt)}}return je.transformed=!0,je}function Ls(je,te,le,xe,Oe,De){return[Math.round(le*(je*xe-Oe)),Math.round(le*(te*xe-De))]}function $s(je,te,le,xe,Oe){const De=te===Oe.maxZoom?0:Oe.tolerance/((1<<te)*Oe.extent),Ge={features:[],numPoints:0,numSimplified:0,numFeatures:je.length,source:null,x:le,y:xe,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const rt of je)Lo(Ge,rt,De,Oe);return Ge}function Lo(je,te,le,xe){const Oe=te.geometry,De=te.type,Ge=[];if(je.minX=Math.min(je.minX,te.minX),je.minY=Math.min(je.minY,te.minY),je.maxX=Math.max(je.maxX,te.maxX),je.maxY=Math.max(je.maxY,te.maxY),De==="Point"||De==="MultiPoint")for(let rt=0;rt<Oe.length;rt+=3)Ge.push(Oe[rt],Oe[rt+1]),je.numPoints++,je.numSimplified++;else if(De==="LineString")jr(Ge,Oe,je,le,!1,!1);else if(De==="MultiLineString"||De==="Polygon")for(let rt=0;rt<Oe.length;rt++)jr(Ge,Oe[rt],je,le,De==="Polygon",rt===0);else if(De==="MultiPolygon")for(let rt=0;rt<Oe.length;rt++){const qe=Oe[rt];for(let tt=0;tt<qe.length;tt++)jr(Ge,qe[tt],je,le,!0,tt===0)}if(Ge.length){let rt=te.tags||null;if(De==="LineString"&&xe.lineMetrics){rt={};for(const tt in te.tags)rt[tt]=te.tags[tt];rt.mapbox_clip_start=Oe.start/Oe.size,rt.mapbox_clip_end=Oe.end/Oe.size}const qe={geometry:Ge,type:De==="Polygon"||De==="MultiPolygon"?3:De==="LineString"||De==="MultiLineString"?2:1,tags:rt};te.id!==null&&(qe.id=te.id),je.features.push(qe)}}function jr(je,te,le,xe,Oe,De){const Ge=xe*xe;if(xe>0&&te.size<(Oe?Ge:xe))return void(le.numPoints+=te.length/3);const rt=[];for(let qe=0;qe<te.length;qe+=3)(xe===0||te[qe+2]>Ge)&&(le.numSimplified++,rt.push(te[qe],te[qe+1])),le.numPoints++;Oe&&function(qe,tt){let yt=0;for(let vt=0,Wt=qe.length,pn=Wt-2;vt<Wt;pn=vt,vt+=2)yt+=(qe[vt]-qe[pn])*(qe[vt+1]+qe[pn+1]);if(yt>0===tt)for(let vt=0,Wt=qe.length;vt<Wt/2;vt+=2){const pn=qe[vt],wn=qe[vt+1];qe[vt]=qe[Wt-2-vt],qe[vt+1]=qe[Wt-1-vt],qe[Wt-2-vt]=pn,qe[Wt-1-vt]=wn}}(rt,De),je.push(rt)}const Wa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ni{constructor(te,le){const xe=(le=this.options=function(De,Ge){for(const rt in Ge)De[rt]=Ge[rt];return De}(Object.create(Wa),le)).debug;if(xe&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Oe=function(De,Ge){const rt=[];if(De.type==="FeatureCollection")for(let qe=0;qe<De.features.length;qe++)fi(rt,De.features[qe],Ge,qe);else fi(rt,De.type==="Feature"?De:{geometry:De},Ge);return rt}(te,le);this.tiles={},this.tileCoords=[],xe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Oe=function(De,Ge){const rt=Ge.buffer/Ge.extent;let qe=De;const tt=dn(De,1,-1-rt,rt,0,-1,2,Ge),yt=dn(De,1,1-rt,2+rt,0,-1,2,Ge);return(tt||yt)&&(qe=dn(De,1,-rt,1+rt,0,-1,2,Ge)||[],tt&&(qe=Mi(tt,1).concat(qe)),yt&&(qe=qe.concat(Mi(yt,-1)))),qe}(Oe,le),Oe.length&&this.splitTile(Oe,0,0,0),xe&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,le,xe,Oe,De,Ge,rt){const qe=[te,le,xe,Oe],tt=this.options,yt=tt.debug;for(;qe.length;){Oe=qe.pop(),xe=qe.pop(),le=qe.pop(),te=qe.pop();const vt=1<<le,Wt=xi(le,xe,Oe);let pn=this.tiles[Wt];if(!pn&&(yt>1&&console.time("creation"),pn=this.tiles[Wt]=$s(te,le,xe,Oe,tt),this.tileCoords.push({z:le,x:xe,y:Oe}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,xe,Oe,pn.numFeatures,pn.numPoints,pn.numSimplified),console.timeEnd("creation"));const Gi=`z${le}`;this.stats[Gi]=(this.stats[Gi]||0)+1,this.total++}if(pn.source=te,De==null){if(le===tt.indexMaxZoom||pn.numPoints<=tt.indexMaxPoints)continue}else{if(le===tt.maxZoom||le===De)continue;if(De!=null){const Gi=De-le;if(xe!==Ge>>Gi||Oe!==rt>>Gi)continue}}if(pn.source=null,te.length===0)continue;yt>1&&console.time("clipping");const wn=.5*tt.buffer/tt.extent,ar=.5-wn,An=.5+wn,lr=1+wn;let ln=null,Zr=null,_r=null,cr=null,pi=dn(te,vt,xe-wn,xe+An,0,pn.minX,pn.maxX,tt),mi=dn(te,vt,xe+ar,xe+lr,0,pn.minX,pn.maxX,tt);te=null,pi&&(ln=dn(pi,vt,Oe-wn,Oe+An,1,pn.minY,pn.maxY,tt),Zr=dn(pi,vt,Oe+ar,Oe+lr,1,pn.minY,pn.maxY,tt),pi=null),mi&&(_r=dn(mi,vt,Oe-wn,Oe+An,1,pn.minY,pn.maxY,tt),cr=dn(mi,vt,Oe+ar,Oe+lr,1,pn.minY,pn.maxY,tt),mi=null),yt>1&&console.timeEnd("clipping"),qe.push(ln||[],le+1,2*xe,2*Oe),qe.push(Zr||[],le+1,2*xe,2*Oe+1),qe.push(_r||[],le+1,2*xe+1,2*Oe),qe.push(cr||[],le+1,2*xe+1,2*Oe+1)}}getTile(te,le,xe){te=+te,le=+le,xe=+xe;const Oe=this.options,{extent:De,debug:Ge}=Oe;if(te<0||te>24)return null;const rt=1<<te,qe=xi(te,le=le+rt&rt-1,xe);if(this.tiles[qe])return Es(this.tiles[qe],De);Ge>1&&console.log("drilling down to z%d-%d-%d",te,le,xe);let tt,yt=te,vt=le,Wt=xe;for(;!tt&&yt>0;)yt--,vt>>=1,Wt>>=1,tt=this.tiles[xi(yt,vt,Wt)];return tt&&tt.source?(Ge>1&&(console.log("found parent tile z%d-%d-%d",yt,vt,Wt),console.time("drilling down")),this.splitTile(tt.source,yt,vt,Wt,te,le,xe),Ge>1&&console.timeEnd("drilling down"),this.tiles[qe]?Es(this.tiles[qe],De):null):null}}function xi(je,te,le){return 32*((1<<je)*le+te)+je}function Tl(je,te){const le=je.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);const xe=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!xe)return te(null,null);const Oe=new we(xe.features);let De=Nr(Oe);De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),te(null,{vectorTile:Oe,rawData:De.buffer})}class Ta extends G{constructor(te,le,xe,Oe,De,Ge){super(te,le,xe,Oe,Tl,Ge),De&&(this.loadGeoJSON=De),this._dynamicIndex=new X}loadData(te,le){const xe=te&&te.request,Oe=xe&&xe.collectResourceTiming;this.loadGeoJSON(te,(De,Ge)=>{if(De||!Ge)return le(De);if(typeof Ge!="object")return le(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const qe=a.z(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(qe.result==="error")throw new Error(qe.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));Ge.features=Ge.features.filter(tt=>qe.value.evaluate({zoom:0},tt))}te.dynamic?(Ge.type==="Feature"&&(Ge={type:"FeatureCollection",features:[Ge]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ge.features,this.loaded),te.cluster&&(Ge.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new Xe(function({superclusterOptions:qe,clusterProperties:tt}){if(!tt||!qe)return qe;const yt={},vt={},Wt={accumulated:null,zoom:0},pn={properties:null},wn=Object.keys(tt);for(const ar of wn){const[An,lr]=tt[ar],ln=a.z(lr),Zr=a.z(typeof An=="string"?[An,["accumulated"],["get",ar]]:An);yt[ar]=ln.value,vt[ar]=Zr.value}return qe.map=ar=>{pn.properties=ar;const An={};for(const lr of wn)An[lr]=yt[lr].evaluate(Wt,pn);return An},qe.reduce=(ar,An)=>{pn.properties=An;for(const lr of wn)Wt.accumulated=ar[lr],ar[lr]=vt[lr].evaluate(Wt,pn)},qe}(te)).load(Ge.features):te.dynamic?this._dynamicIndex:function(qe,tt){return new ni(qe,tt)}(Ge,te.geojsonVtOptions)}catch(qe){return le(qe)}const rt={};if(Oe){const qe=I(xe);qe&&(rt.resourceTiming={},rt.resourceTiming[te.source]=JSON.parse(JSON.stringify(qe)))}le(null,rt)}})}reloadTile(te,le){const xe=this.loaded;return xe&&xe[te.uid]?te.partial?le(null,void 0):super.reloadTile(te,le):this.loadTile(te,le)}loadGeoJSON(te,le){if(te.request)a.h(te.request,le);else{if(typeof te.data!="string")return le(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return le(null,JSON.parse(te.data))}catch{return le(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(xe){le(xe)}}getClusterChildren(te,le){try{le(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(xe){le(xe)}}getClusterLeaves(te,le){try{le(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(xe){le(xe)}}}class po{constructor(te,le){this.tileID=new a.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=le}parse(te,le,xe,Oe){this.status="parsing";const De=new a.aQ(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),Ge={},rt=le.familiesBySource[xe.source],qe=new a.dQ(De,xe.promoteId);return qe.bucketLayerIDs=[],qe.is3DTile=!0,a.e6(te).then(tt=>{if(!tt)return Oe(new Error("Could not parse tile"));const yt=a.e7(tt,1/a.b7(xe.tileID.canonical)),vt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("MAPBOX_mesh_features")||tt.json.asset.extras&&tt.json.asset.extras.MAPBOX_mesh_features,Wt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("EXT_meshopt_compression"),pn=new a.Y(this.zoom,{brightness:this.brightness});for(const wn in rt)for(const ar of rt[wn]){const An=ar[0];qe.bucketLayerIDs.push(ar.map(ln=>ln.id)),An.recalculate(pn,[]);const lr=new a.e8(yt,De,vt,Wt,this.brightness,qe);vt||(lr.needsUpload=!0),Ge[An.fqid]=lr,lr.evaluate(An)}this.status="done",Oe(null,{buckets:Ge,featureIndex:qe})}).catch(tt=>Oe(new Error(tt.message)))}}class Fi{constructor(te,le,xe,Oe,De,Ge){this.actor=te,this.layerIndex=le,this.brightness=Ge,this.loading={},this.loaded={}}loadTile(te,le){const xe=te.uid,Oe=this.loading[xe]=new po(te,this.brightness);a.e5(te.request,(De,Ge)=>{const rt=!this.loading[xe];return delete this.loading[xe],rt||De?(Oe.status="done",rt||(this.loaded[xe]=Oe),le(De)):Ge&&Ge.byteLength!==0?void Oe.parse(Ge,this.layerIndex,te,(qe,tt)=>{Oe.status="done",this.loaded=this.loaded||{},this.loaded[xe]=Oe,qe||!tt?le(qe):le(null,tt)}):(Oe.status="done",this.loaded[xe]=Oe,le())})}reloadTile(te,le){const xe=this.loaded,Oe=te.uid;if(xe&&xe[Oe]){const De=xe[Oe];De.projection=te.projection,De.brightness=te.brightness;const Ge=(rt,qe)=>{De.reloadCallback&&(delete De.reloadCallback,this.loadTile(te,le)),le(rt,qe)};De.status==="parsing"?De.reloadCallback=Ge:De.status==="done"&&this.loadTile(te,le)}}abortTile(te,le){const xe=te.uid;this.loading[xe]&&delete this.loading[xe],le()}removeTile(te,le){const xe=this.loaded,Oe=te.uid;xe&&xe[Oe]&&delete xe[Oe],le()}}class Xu{constructor(te){this.self=te,this.actor=new a.e9(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.aK({name:"mercator"}),this.workerSourceTypes={vector:G,geojson:Ta,"batched-model":Fi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(le,xe)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=xe},this.self.registerRTLTextPlugin=le=>{if(a.ea.isParsed())throw new Error("RTL text plugin already registered.");a.ea.applyArabicShaping=le.applyArabicShaping,a.ea.processBidirectionalText=le.processBidirectionalText,a.ea.processStyledBidirectionalText=le.processStyledBidirectionalText}}clearCaches(te,le,xe){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],delete this.rasterArrayWorkerSource,xe()}checkIfReady(te,le,xe){xe()}setReferrer(te,le){this.referrer=le}spriteLoaded(te,{scope:le,isLoaded:xe}){if(this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.isSpriteLoaded[te][le]=xe,this.workerSources[te]&&this.workerSources[te][le])for(const Oe in this.workerSources[te][le]){const De=this.workerSources[te][le][Oe];for(const Ge in De){const rt=De[Ge];rt instanceof G&&(rt.isSpriteLoaded=xe,rt.fire(new a.g("isSpriteLoaded")))}}}setImages(te,{scope:le,images:xe},Oe){if(this.availableImages[te]||(this.availableImages[te]={}),this.availableImages[te][le]=xe,this.workerSources[te]&&this.workerSources[te][le]){for(const De in this.workerSources[te][le]){const Ge=this.workerSources[te][le][De];for(const rt in Ge)Ge[rt].availableImages=xe}Oe()}else Oe()}setProjection(te,le){this.projections[te]=a.aK(le)}setBrightness(te,le,xe){this.brightness=le,xe()}setLayers(te,le,xe){this.getLayerIndex(te,le.scope).replace(le.layers,le.options),xe()}updateLayers(te,le,xe){this.getLayerIndex(te,le.scope).update(le.layers,le.removedIds,le.options),xe()}loadTile(te,le,xe){le.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,le.type,le.source,le.scope).loadTile(le,xe)}loadDEMTile(te,le,xe){this.getDEMWorkerSource(te,le.source,le.scope).loadTile(le,xe)}decodeRasterArray(te,le,xe){this.getRasterArrayWorkerSource().decodeRasterArray(le,xe)}reloadTile(te,le,xe){le.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,le.type,le.source,le.scope).reloadTile(le,xe)}abortTile(te,le,xe){this.getWorkerSource(te,le.type,le.source,le.scope).abortTile(le,xe)}removeTile(te,le,xe){this.getWorkerSource(te,le.type,le.source,le.scope).removeTile(le,xe)}removeSource(te,le,xe){if(!(this.workerSources[te]&&this.workerSources[te][le.scope]&&this.workerSources[te][le.scope][le.type]&&this.workerSources[te][le.scope][le.type][le.source]))return;const Oe=this.workerSources[te][le.scope][le.type][le.source];delete this.workerSources[te][le.scope][le.type][le.source],Oe.removeSource!==void 0?Oe.removeSource(le,xe):xe()}loadWorkerSource(te,le,xe){try{this.self.importScripts(le.url),xe()}catch(Oe){xe(Oe.toString())}}syncRTLPluginState(te,le,xe){try{a.ea.setState(le);const Oe=a.ea.getPluginURL();if(a.ea.isLoaded()&&!a.ea.isParsed()&&Oe!=null){this.self.importScripts(Oe);const De=a.ea.isParsed();xe(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Oe}`),De)}}catch(Oe){xe(Oe.toString())}}setDracoUrl(te,le){this.dracoUrl=le}getAvailableImages(te,le){this.availableImages[te]||(this.availableImages[te]={});let xe=this.availableImages[te][le];return xe||(xe=[]),xe}getLayerIndex(te,le){this.layerIndexes[te]||(this.layerIndexes[te]={});let xe=this.layerIndexes[te][le];return xe||(xe=this.layerIndexes[te][le]=new F,xe.scope=le),xe}getWorkerSource(te,le,xe,Oe){return this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][Oe]||(this.workerSources[te][Oe]={}),this.workerSources[te][Oe][le]||(this.workerSources[te][Oe][le]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.workerSources[te][Oe][le][xe]||(this.workerSources[te][Oe][le][xe]=new this.workerSourceTypes[le]({send:(De,Ge,rt,qe,tt,yt)=>{this.actor.send(De,Ge,rt,te,tt,yt)},scheduler:this.actor.scheduler},this.getLayerIndex(te,Oe),this.getAvailableImages(te,Oe),this.isSpriteLoaded[te][Oe],void 0,this.brightness)),this.workerSources[te][Oe][le][xe]}getDEMWorkerSource(te,le,xe){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][xe]||(this.demWorkerSources[te][xe]={}),this.demWorkerSources[te][xe][le]||(this.demWorkerSources[te][xe][le]=new Y),this.demWorkerSources[te][xe][le]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Q),this.rasterArrayWorkerSource}enforceCacheSizeLimit(te,le){a.eb(le)}getWorkerPerformanceMetrics(te,le,xe){xe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Xu(self)),Xu}),_(["./shared"],function(a){var I=D;function D(g){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,T=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(T);try{b=new Worker(S),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(S),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var T=b.getImageData(0,0,1,1);return T&&T.width===y.width}()?(O[d=l&&l.failIfMajorPerformanceCaveat]===void 0&&(O[d]=function(y){var b,T=function(S){var A=document.createElement("canvas"),k=Object.create(D.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=S,A.getContext("webgl2",k)}(y);if(!T)return!1;try{b=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!b||T.isContextLost())&&(T.shaderSource(b,"void main() {}"),T.compileShader(b),T.getShaderParameter(b,T.COMPILE_STATUS)===!0)}(d)),O[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var d}(g)}var O={};function F(g,l,d){const y=document.createElement(g);return l!=null&&(y.className=l),d&&d.appendChild(y),y}function Z(g,l,d){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(l))y.setAttributeNS(null,b,String(l[b]));return d&&d.appendChild(y),y}D.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const J=typeof document<"u"?document.documentElement&&document.documentElement.style:null,re=J&&J.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ne;function G(){J&&re&&(ne=J[re],J[re]="none")}function Y(){J&&re&&(J[re]=ne)}function Q(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",Q,!0)}function de(){window.addEventListener("click",Q,!0),window.setTimeout(()=>{window.removeEventListener("click",Q,!0)},0)}function Te(g,l){const d=g.getBoundingClientRect();return he(g,d,l)}function we(g,l){const d=g.getBoundingClientRect(),y=[];for(let b=0;b<l.length;b++)y.push(he(g,d,l[b]));return y}function oe(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function he(g,l,d){const y=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new a.P((d.clientX-l.left)*y,(d.clientY-l.top)*y)}class X{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,d){this._updatedSourceCaches[l]=d,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const d=l.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(l.id),this.setDirty()}removeLayer(l){const d=l.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][l.id]=l,this._updatedLayers[d].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const d in this._updatedLayers)l[d]=l[d]||{},l[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)l[d]=l[d]||{},l[d].removedIds=Object.keys(this._removedLayers[d]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const ge={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class be{constructor(l,d,y,b,T,S){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.instanceCount=S,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||T||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let y=0;y<this.attributes.length;y++){const b=d.attributes[this.attributes[y].name];b!==void 0&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,d,y){for(let b=0;b<this.attributes.length;b++){const T=this.attributes[b],S=d.attributes[T.name];S!==void 0&&l.vertexAttribPointer(S,T.components,l[ge[T.type]],!1,this.itemSize,T.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(l,d,y){for(let b=0;b<this.attributes.length;b++){const T=d.attributes[this.attributes[b].name];T!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(T,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ke{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ee extends ke{getDefault(){return a.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class zt extends ke{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Ut extends ke{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Qt extends ke{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class kt extends ke{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ft extends ke{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Rt extends ke{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Yt extends ke{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class ht extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class At extends ke{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class wt extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class Xt extends ke{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Ft extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class Sn extends ke{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class qn extends ke{getDefault(){return a.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Qn extends ke{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class Gt extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class Cn extends ke{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class hn extends ke{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Rn=class extends ke{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Nr extends ke{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class jn extends ke{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class gr extends ke{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Fr extends ke{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class dr extends ke{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class rr extends ke{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ue extends ke{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Xe extends ke{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class ut extends ke{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Ye extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class st extends ke{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Mt extends ke{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class an extends Mt{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class qt extends Mt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class mn extends Mt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Ln extends qt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class fr{constructor(l,d,y,b,T){this.context=l,this.width=d,this.height=y;const S=this.framebuffer=l.gl.createFramebuffer();b&&(this.colorAttachment=new an(l,S)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new qt(l,S):new mn(l,S))}destroy(){const l=this.context.gl;if(this.colorAttachment){const d=this.colorAttachment.get();d&&l.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&l.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&l.deleteTexture(d)}l.deleteFramebuffer(this.framebuffer)}}class fi{constructor(l,d){this.gl=l,this.clearColor=new Ee(this),this.clearDepth=new zt(this),this.clearStencil=new Ut(this),this.colorMask=new Qt(this),this.depthMask=new kt(this),this.stencilMask=new ft(this),this.stencilFunc=new Rt(this),this.stencilOp=new Yt(this),this.stencilTest=new ht(this),this.depthRange=new At(this),this.depthTest=new wt(this),this.depthFunc=new Xt(this),this.blend=new Ft(this),this.blendFunc=new Sn(this),this.blendColor=new qn(this),this.blendEquation=new Qn(this),this.cullFace=new Gt(this),this.cullFaceSide=new Cn(this),this.frontFace=new hn(this),this.program=new Rn(this),this.activeTexture=new Nr(this),this.viewport=new jn(this),this.bindFramebuffer=new gr(this),this.bindRenderbuffer=new Fr(this),this.bindTexture=new dr(this),this.bindVertexBuffer=new rr(this),this.bindElementBuffer=new Ue(this),this.bindVertexArrayOES=new Xe(this),this.pixelStoreUnpack=new ut(this),this.pixelStoreUnpackPremultiplyAlpha=new Ye(this),this.pixelStoreUnpackFlipY=new st(this),this.options=d?{...d}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d,y){return new a.I(this,l,d,y)}createVertexBuffer(l,d,y,b,T){return new be(this,l,d,y,b,T)}createRenderbuffer(l,d,y){const b=this.gl,T=b.createRenderbuffer();return this.bindRenderbuffer.set(T),b.renderbufferStorage(b.RENDERBUFFER,l,d,y),this.bindRenderbuffer.set(null),T}createFramebuffer(l,d,y,b){return new fr(this,l,d,y,b)}clear({color:l,depth:d,stencil:y,colorMask:b}){const T=this.gl;let S=0;l&&(S|=T.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(b||[!0,!0,!0,!0])),d!==void 0&&(S|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),y!==void 0&&(S|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),T.clear(S)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){a.d(l.blendFunction,a.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ir{constructor(l,d,y,b){const T={width:y[0],height:y[1],data:null},S=l.gl;this.targetColorTexture=new a.T(l,T,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new a.T(l,T,S.RGBA,{useMipmap:!1}),this.context=l,this.updateParticleTexture(d,b),this.lastInvalidatedAt=0}updateParticleTexture(l,d){if(this.particleTextureDimension===d.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,b=d.width*d.height;this.particleTexture0=new a.T(this.context,d,y.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,d,y.RGBA,{premultiply:!1,useMipmap:!1});const T=new a.S;T.reserve(b);for(let S=0;S<b;S++)T.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(T,a.p.members,!0),this.particleSegment=a.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=d.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=a.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Ci extends a.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,d){return a.l(this.requestManager.transformRequest(d,a.R.Model).url).then(y=>{if(!y)return;const b=a.c(y),T=new a.M(l,void 0,void 0,b);return T.computeBoundsAndApplyParent(),T}).catch(y=>{if(y&&y.status===404)return null;this.fire(new a.f(new Error(`Could not load model ${l} from ${d}: ${y.message}`)))})}load(l,d){this.models[d]||(this.models[d]={});const y=Object.keys(l);this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+y.length;const b=[];for(const T of y)b.push(this.loadModel(T,l[T]));Promise.allSettled(b).then(T=>{for(let S=0;S<T.length;S++){const{status:A,value:k}=T[S];A==="fulfilled"&&k&&(this.models[d][y[S]]={model:k,numReferences:1})}this.numModelsLoading[d]-=y.length,this.fire(new a.g("data",{dataType:"style"}))}).catch(T=>{this.fire(new a.f(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,d){return!!this.getModel(l,d)}getModel(l,d){return this.models[d]||(this.models[d]={}),this.models[d][l]?this.models[d][l].model:void 0}addModel(l,d,y){this.models[y]||(this.models[y]={}),this.hasModel(l,y)&&this.models[y][l].numReferences++,this.load({[l]:this.requestManager.normalizeModelURL(d)},y)}addModels(l,d){this.models[d]||(this.models[d]={});const y={};for(const b in l)this.models[d][b]={},y[b]=this.requestManager.normalizeModelURL(l[b]);this.load(y,d)}addModelsFromBucket(l,d){this.models[d]||(this.models[d]={});const y={};for(const b of l)this.hasModel(b,d)?this.models[d][b].numReferences++:y[b]=this.requestManager.normalizeModelURL(b);this.load(y,d)}removeModel(l,d){if(this.models[d]&&this.models[d][l]&&(this.models[d][l].numReferences--,this.models[d][l].numReferences===0)){const y=this.models[d][l].model;delete this.models[d][l],y.destroy()}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,d){this.models[d]||(this.models[d]={});for(const y in this.models[d])this.models[d][y].model&&this.models[d][y].model.upload(l.context)}}function ss(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class Tn extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new a.j({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,d){if(this.loaded[d]!==l&&(this.loaded[d]=l,l)){for(const{ids:y,callback:b}of this.requestors)this._notify(y,d,b);this.requestors=[]}}hasImage(l,d){return!!this.getImage(l,d)}getImage(l,d){return this.images[d][l]}addImage(l,d,y){this._validate(l,y)&&(this.images[d][l]=y)}_validate(l,d){let y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,d){if(!l)return!0;let y=0;for(const b of l){if(b[0]<y||b[1]<b[0]||d<b[1])return!1;y=b[1]}return!0}_validateContent(l,d){return!(l&&(l.length!==4||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d,y){y.version=this.images[d][l].version+1,this.images[d][l]=y,this.updatedImages[d][l]=!0}removeImage(l,d){const y=this.images[d][l];delete this.images[d][l],delete this.patterns[d][l],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,d,y){let b=!0;const T=!!this.loaded[d];if(!T)for(const S of l)this.images[d][S]||(b=!1);T||b?this._notify(l,d,y):this.requestors.push({ids:l,scope:d,callback:y})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,d,y){const b={};for(const T of l){this.images[d][T]||this.fire(new a.g("styleimagemissing",{id:T}));const S=this.images[d][T];S?b[T]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:a.w(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,b)}getPixelSize(l){const{width:d,height:y}=this.atlasImage[l];return{width:d,height:y}}getPattern(l,d,y){const b=this.patterns[d][l],T=this.getImage(l,d);if(!T)return null;if(b&&b.position.version===T.version)return b.position;if(b)b.position.version=T.version;else{const S={w:T.data.width+2,h:T.data.height+2,x:0,y:0},A=new a.m(S,T);this.patterns[d][l]={bin:S,position:A}}return this._updatePatternAtlas(d,y),this.patterns[d][l].position}bind(l,d){const y=l.gl;let b=this.atlasTexture[d];b?this.dirty&&(b.update(this.atlasImage[d]),this.dirty=!1):(b=new a.T(l,this.atlasImage[d],y.RGBA),this.atlasTexture[d]=b),b.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(l,d){const y=[];for(const A in this.patterns[l])y.push(this.patterns[l][A].bin);const{w:b,h:T}=a.k(y),S=this.atlasImage[l];S.resize({width:b||1,height:T||1});for(const A in this.patterns[l]){const{bin:k}=this.patterns[l][A],L=k.x+1,B=k.y+1,U=this.images[l][A].data,q=U.width,H=U.height;a.j.copy(U,S,{x:0,y:0},{x:L,y:B},{width:q,height:H},d),a.j.copy(U,S,{x:0,y:H-1},{x:L,y:B-1},{width:q,height:1},d),a.j.copy(U,S,{x:0,y:0},{x:L,y:B+H},{width:q,height:1},d),a.j.copy(U,S,{x:q-1,y:0},{x:L-1,y:B},{width:1,height:H},d),a.j.copy(U,S,{x:0,y:0},{x:L+q,y:B},{width:1,height:H},d)}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,d){for(const y of l){if(this.callbackDispatchedThisFrame[d][y])continue;this.callbackDispatchedThisFrame[d][y]=!0;const b=this.images[d][y];ss(b)&&this.updateImage(y,d,b)}}}function or(g){const l=g.key,d=g.value,y=g.valueSpec||{},b=g.objectElementValidators||{},T=g.style,S=g.styleSpec;let A=[];const k=a.o(d);if(k!=="object")return[new a.V(l,d,`object expected, ${k} found`)];for(const L in d){const B=L.split(".")[0];let U;b[B]?U=b[B]:y[B]?U=Fi:b["*"]?U=b["*"]:y["*"]&&(U=Fi),U?A=A.concat(U({key:(l&&`${l}.`)+L,value:d[L],valueSpec:y[B]||y["*"],style:T,styleSpec:S,object:d,objectKey:L},d)):A.push(new a.n(l,d[L],`unknown property "${L}"`))}for(const L in y)b[L]||y[L].required&&y[L].default===void 0&&d[L]===void 0&&A.push(new a.V(l,d,`missing required property "${L}"`));return A}function dn(g){const l=g.value,d=g.valueSpec,y=g.style,b=g.styleSpec,T=g.key,S=g.arrayElementValidator||Fi;if(a.o(l)!=="array")return[new a.V(T,l,`array expected, ${a.o(l)} found`)];if(d.length&&l.length!==d.length)return[new a.V(T,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new a.V(T,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let A={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};b.$version<7&&(A.function=d.function),a.o(d.value)==="object"&&(A=d.value);let k=[];for(let L=0;L<l.length;L++)k=k.concat(S({array:l,arrayIndex:L,value:l[L],valueSpec:A,style:y,styleSpec:b,key:`${T}[${L}]`},!0));return k}function Js(g){const l=g.key,d=g.value,y=g.valueSpec;let b=a.o(d);if(b==="number"&&d!=d&&(b="NaN"),b!=="number")return[new a.V(l,d,`number expected, ${b} found`)];if("minimum"in y){let T=y.minimum;if(a.o(y.minimum)==="array"&&(T=y.minimum[g.arrayIndex]),d<T)return[new a.V(l,d,`${d} is less than the minimum value ${T}`)]}if("maximum"in y){let T=y.maximum;if(a.o(y.maximum)==="array"&&(T=y.maximum[g.arrayIndex]),d>T)return[new a.V(l,d,`${d} is greater than the maximum value ${T}`)]}return[]}function Ai(g){const l=g.valueSpec,d=a.u(g.value.type);let y,b,T,S={};const A=d!=="categorical"&&g.value.property===void 0,k=!A,L=a.o(g.value.stops)==="array"&&a.o(g.value.stops[0])==="array"&&a.o(g.value.stops[0][0])==="object",B=or({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(H){if(d==="identity")return[new a.V(H.key,H.value,'identity function may not have a "stops" property')];let ie=[];const se=H.value;return ie=ie.concat(dn({key:H.key,value:se,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:U})),a.o(se)==="array"&&se.length===0&&ie.push(new a.V(H.key,se,"array must have at least one stop")),ie},default:function(H){return Fi({key:H.key,value:H.value,valueSpec:l,style:H.style,styleSpec:H.styleSpec})}}});return d==="identity"&&A&&B.push(new a.V(g.key,g.value,'missing required property "property"')),d==="identity"||g.value.stops||B.push(new a.V(g.key,g.value,'missing required property "stops"')),d==="exponential"&&g.valueSpec.expression&&!a.s(g.valueSpec)&&B.push(new a.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(k&&!a.r(g.valueSpec)?B.push(new a.V(g.key,g.value,"property functions not supported")):A&&!a.t(g.valueSpec)&&B.push(new a.V(g.key,g.value,"zoom functions not supported"))),d!=="categorical"&&!L||g.value.property!==void 0||B.push(new a.V(g.key,g.value,'"property" property is required')),B;function U(H){let ie=[];const se=H.value,ae=H.key;if(a.o(se)!=="array")return[new a.V(ae,se,`array expected, ${a.o(se)} found`)];if(se.length!==2)return[new a.V(ae,se,`array length 2 expected, length ${se.length} found`)];if(L){if(a.o(se[0])!=="object")return[new a.V(ae,se,`object expected, ${a.o(se[0])} found`)];if(se[0].zoom===void 0)return[new a.V(ae,se,"object stop key must have zoom")];if(se[0].value===void 0)return[new a.V(ae,se,"object stop key must have value")];const ce=a.u(se[0].zoom);if(typeof ce!="number")return[new a.V(ae,se[0].zoom,"stop zoom values must be numbers")];if(T&&T>ce)return[new a.V(ae,se[0].zoom,"stop zoom values must appear in ascending order")];ce!==T&&(T=ce,b=void 0,S={}),ie=ie.concat(or({key:`${ae}[0]`,value:se[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Js,value:q}}))}else ie=ie.concat(q({key:`${ae}[0]`,value:se[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},se));return a.v(a.x(se[1]))?ie.concat([new a.V(`${ae}[1]`,se[1],"expressions are not allowed in function stops.")]):ie.concat(Fi({key:`${ae}[1]`,value:se[1],valueSpec:l,style:H.style,styleSpec:H.styleSpec}))}function q(H,ie){const se=a.o(H.value),ae=a.u(H.value),ce=H.value!==null?H.value:ie;if(y){if(se!==y)return[new a.V(H.key,ce,`${se} stop domain type must match previous stop domain type ${y}`)]}else y=se;if(se!=="number"&&se!=="string"&&se!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new a.V(H.key,ce,"stop domain value must be a number, string, or boolean")];if(se!=="number"&&d!=="categorical"){let ye=`number expected, ${se} found`;return a.r(l)&&d===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(H.key,ce,ye)]}return d!=="categorical"||se!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?d!=="categorical"&&se==="number"&&typeof ae=="number"&&typeof b=="number"&&b!==void 0&&ae<b?[new a.V(H.key,ce,"stop domain values must appear in ascending order")]:(b=ae,d==="categorical"&&ae in S?[new a.V(H.key,ce,"stop domain values must be unique")]:(S[ae]=!0,[])):[new a.V(H.key,ce,`integer expected, found ${String(ae)}`)]}}function fo(g){const l=(g.expressionContext==="property"?a.y:a.z)(a.x(g.value),g.valueSpec);if(l.result==="error")return l.value.map(y=>new a.V(`${g.key}${y.key}`,g.value,y.message));const d=l.value.expression||l.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!d.outputDefined())return[new a.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!a.A(d))return[new a.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return wa(d,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!a.B(d,["zoom","feature-state"]))return[new a.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!a.D(d))return[new a.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wa(g,l){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const b of l.valueSpec.expression.parameters)d.delete(b);if(d.size===0)return[];const y=[];return g instanceof a.F&&d.has(g.name)?[new a.V(l.key,l.value,`["${g.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(g.eachChild(b=>{y.push(...wa(b,l))}),y)}function nn(g){const l=g.key,d=g.value,y=g.valueSpec,b=[];return Array.isArray(y.values)?y.values.indexOf(a.u(d))===-1&&b.push(new a.V(l,d,`expected one of [${y.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(y.values).indexOf(a.u(d))===-1&&b.push(new a.V(l,d,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function Jn(g){return a.H(a.x(g.value))?fo(a.q({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):ti(g)}function ti(g){const l=g.value,d=g.key;if(a.o(l)!=="array")return[new a.V(d,l,`array expected, ${a.o(l)} found`)];const y=g.styleSpec;let b,T=[];if(l.length<1)return[new a.V(d,l,"filter array must have at least 1 element")];switch(T=T.concat(nn({key:`${d}[0]`,value:l[0],valueSpec:y.filter_operator,style:g.style,styleSpec:g.styleSpec})),a.u(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&a.u(l[1])==="$type"&&T.push(new a.V(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&T.push(new a.V(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(b=a.o(l[1]),b!=="string"&&T.push(new a.V(`${d}[1]`,l[1],`string expected, ${b} found`)));for(let S=2;S<l.length;S++)b=a.o(l[S]),a.u(l[1])==="$type"?T=T.concat(nn({key:`${d}[${S}]`,value:l[S],valueSpec:y.geometry_type,style:g.style,styleSpec:g.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&T.push(new a.V(`${d}[${S}]`,l[S],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let S=1;S<l.length;S++)T=T.concat(ti({key:`${d}[${S}]`,value:l[S],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":b=a.o(l[1]),l.length!==2?T.push(new a.V(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):b!=="string"&&T.push(new a.V(`${d}[1]`,l[1],`string expected, ${b} found`))}return T}function Mi(g,l){const d=g.key,y=g.style,b=g.layer,T=g.styleSpec,S=g.value,A=g.objectKey,k=T[`${l}_${g.layerType}`];if(!k)return[];const L=A.match(/^(.*)-transition$/);if(l==="paint"&&L&&k[L[1]]&&k[L[1]].transition)return Fi({key:d,value:S,valueSpec:T.transition,style:y,styleSpec:T});const B=g.valueSpec||k[A];if(!B)return[new a.n(d,S,`unknown property "${A}"`)];let U;if(a.o(S)==="string"&&a.r(B)&&!B.tokens&&(U=/^{([^}]+)}$/.exec(S))){const H=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new a.V(d,S,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${H}.`)]}const q=[];if(g.layerType==="symbol")A!=="text-field"||!y||y.glyphs||y.imports||q.push(new a.V(d,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&a.J(a.x(S))&&a.u(S.type)==="identity"&&q.push(new a.V(d,S,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&l==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&a.r(B)&&(a.K(B)||a.t(B))){const H=a.y(a.x(S),B),ie=H.value.expression||H.value._styleExpression.expression;ie&&!a.B(ie,["measure-light"])&&(A==="model-emissive-strength"&&a.D(ie)&&a.A(ie)||q.push(new a.V(d,S,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Fi({key:g.key,value:S,valueSpec:B,style:y,styleSpec:T,expressionContext:"property",propertyType:l,propertyKey:A}))}function Ts(g){return Mi(g,"paint")}function Es(g){return Mi(g,"layout")}function Ls(g){let l=[];const d=g.value,y=g.key,b=g.style,T=g.styleSpec;d.type||d.ref||l.push(new a.V(y,d,'either "type" or "ref" is required'));let S=a.u(d.type);const A=a.u(d.ref);if(d.id){const k=a.u(d.id);for(let L=0;L<g.arrayIndex;L++){const B=b.layers[L];a.u(B.id)===k&&l.push(new a.V(y,d.id,`duplicate layer id "${d.id}", previously used at line ${B.id.__line__}`))}}if("ref"in d){let k;["type","source","source-layer","filter","layout"].forEach(L=>{L in d&&l.push(new a.V(y,d[L],`"${L}" is prohibited for ref layers`))}),b.layers.forEach(L=>{a.u(L.id)===A&&(k=L)}),k?k.ref?l.push(new a.V(y,d.ref,"ref cannot reference another ref layer")):S=a.u(k.type):typeof A=="string"&&l.push(new a.V(y,d.ref,`ref layer "${A}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(d.source){const k=b.sources&&b.sources[d.source],L=k&&a.u(k.type);k?L==="vector"&&S==="raster"?l.push(new a.V(y,d.source,`layer "${d.id}" requires a raster source`)):L==="raster"&&S!=="raster"?l.push(new a.V(y,d.source,`layer "${d.id}" requires a vector source`)):L!=="vector"||d["source-layer"]?L==="raster-dem"&&S!=="hillshade"?l.push(new a.V(y,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!d.paint||!d.paint["line-gradient"]&&!d.paint["line-trim-offset"]||L==="geojson"&&k.lineMetrics?S==="raster-particle"&&L!=="raster-array"&&l.push(new a.V(y,d.source,`layer "${d.id}" requires a 'raster-array' source.`)):l.push(new a.V(y,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new a.V(y,d.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new a.V(y,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new a.V(y,d.source,`source "${d.source}" not found`))}else l.push(new a.V(y,d,'missing required property "source"'));return l=l.concat(or({key:y,value:d,valueSpec:T.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fi({key:`${y}.type`,value:d.type,valueSpec:T.layer.type,style:g.style,styleSpec:g.styleSpec,object:d,objectKey:"type"}),filter:k=>Jn(a.q({layerType:S},k)),layout:k=>or({layer:d,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>Es(a.q({layerType:S},L))}}),paint:k=>or({layer:d,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>Ts(a.q({layerType:S,layer:d},L))}})}})),l}function $s(g){const l=g.value,d=g.key,y=a.o(l);return y!=="string"?[new a.V(d,l,`string expected, ${y} found`)]:[]}const Lo={promoteId:function({key:g,value:l}){if(a.o(l)==="string")return $s({key:g,value:l});{const d=[];for(const y in l)d.push(...$s({key:`${g}.${y}`,value:l[y]}));return d}}};function jr(g){const l=g.value,d=g.key,y=g.styleSpec,b=g.style;if(!l.type)return[new a.V(d,l,'"type" is required')];const T=a.u(l.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&(l.url||l.tiles||S.push(new a.n(d,l,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(or({key:d,value:l,valueSpec:y[`source_${T.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:Lo})),S;case"geojson":if(S=or({key:d,value:l,valueSpec:y.source_geojson,style:b,styleSpec:y,objectElementValidators:Lo}),l.cluster)for(const A in l.clusterProperties){const[k,L]=l.clusterProperties[A],B=typeof k=="string"?[k,["accumulated"],["get",A]]:k;S.push(...fo({key:`${d}.${A}.map`,value:L,expressionContext:"cluster-map"})),S.push(...fo({key:`${d}.${A}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return S;case"video":return or({key:d,value:l,valueSpec:y.source_video,style:b,styleSpec:y});case"image":return or({key:d,value:l,valueSpec:y.source_image,style:b,styleSpec:y});case"canvas":return[new a.V(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return nn({key:`${d}.type`,value:l.type,valueSpec:{values:Wa(y)},style:b,styleSpec:y})}}function Wa(g){return g.source.reduce((l,d)=>{const y=g[d];return y.type.type==="enum"&&(l=l.concat(Object.keys(y.type.values))),l},[])}function ni(g){const l=g.value,d=g.styleSpec,y=d.light,b=g.style;let T=[];const S=a.o(l);if(l===void 0)return T;if(S!=="object")return T=T.concat([new a.V("light",l,`object expected, ${S} found`)]),T;for(const A in l){const k=A.match(/^(.*)-transition$/);T=T.concat(k&&y[k[1]]&&y[k[1]].transition?Fi({key:A,value:l[A],valueSpec:d.transition,style:b,styleSpec:d}):y[A]?Fi({key:A,value:l[A],valueSpec:y[A],style:b,styleSpec:d}):[new a.V(A,l[A],`unknown property "${A}"`)])}return T}function xi(g){const l=g.value;let d=[];if(!l)return d;const y=a.o(l);if(y!=="object")return d=d.concat([new a.V("light-3d",l,`object expected, ${y} found`)]),d;const b=g.styleSpec,T=b["light-3d"],S=g.key,A=g.style,k=g.style.lights;for(const U of["type","id"])if(!(U in l))return d=d.concat([new a.V("light-3d",l,`missing property ${U} on light`)]),d;if(l.type&&k)for(let U=0;U<g.arrayIndex;U++){const q=a.u(l.type),H=k[U];a.u(H.type)===q&&d.push(new a.V(S,l.id,`duplicate light type "${l.type}", previously defined at line ${H.id.__line__}`))}const L=`properties_light_${l.type}`;if(!(L in b))return d=d.concat([new a.V("light-3d",l,`Invalid light type ${l.type}`)]),d;const B=b[L];for(const U in l)if(U==="properties"){const q=l[U],H=a.o(q);if(H!=="object")return d=d.concat([new a.V("properties",q,`object expected, ${H} found`)]),d;for(const ie in q)d=d.concat(B[ie]?Fi({key:ie,value:q[ie],valueSpec:B[ie],style:A,styleSpec:b}):[new a.n(g.key,q[ie],`unknown property "${ie}"`)])}else{const q=U.match(/^(.*)-transition$/);d=d.concat(q&&T[q[1]]&&T[q[1]].transition?Fi({key:U,value:l[U],valueSpec:b.transition,style:A,styleSpec:b}):T[U]?Fi({key:U,value:l[U],valueSpec:T[U],style:A,styleSpec:b}):[new a.n(U,l[U],`unknown property "${U}"`)])}return d}function Tl(g){const l=g.value,d=g.key,y=g.style,b=g.styleSpec,T=b.terrain;let S=[];const A=a.o(l);if(l===void 0||A==="null")return S;if(A!=="object")return S=S.concat([new a.V("terrain",l,`object expected, ${A} found`)]),S;for(const k in l){const L=k.match(/^(.*)-transition$/);S=S.concat(L&&T[L[1]]&&T[L[1]].transition?Fi({key:k,value:l[k],valueSpec:b.transition,style:y,styleSpec:b}):T[k]?Fi({key:k,value:l[k],valueSpec:T[k],style:y,styleSpec:b}):[new a.n(k,l[k],`unknown property "${k}"`)])}if(l.source){const k=y.sources&&y.sources[l.source],L=k&&a.u(k.type);k?L!=="raster-dem"&&S.push(new a.V(d,l.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):S.push(new a.V(d,l.source,`source "${l.source}" not found`))}else S.push(new a.V(d,l,'terrain is missing required property "source"'));return S}function Ta(g){const l=g.value,d=g.style,y=g.styleSpec,b=y.fog;let T=[];const S=a.o(l);if(l===void 0)return T;if(S!=="object")return T=T.concat([new a.V("fog",l,`object expected, ${S} found`)]),T;for(const A in l){const k=A.match(/^(.*)-transition$/);T=T.concat(k&&b[k[1]]&&b[k[1]].transition?Fi({key:A,value:l[A],valueSpec:y.transition,style:d,styleSpec:y}):b[A]?Fi({key:A,value:l[A],valueSpec:b[A],style:d,styleSpec:y}):[new a.n(A,l[A],`unknown property "${A}"`)])}return T}const po={"*":()=>[],array:dn,boolean:function(g){const l=g.value,d=g.key,y=a.o(l);return y!=="boolean"?[new a.V(d,l,`boolean expected, ${y} found`)]:[]},number:Js,color:function(g){const l=g.key,d=g.value,y=a.o(d);return y!=="string"?[new a.V(l,d,`color expected, ${y} found`)]:a.G(d)===null?[new a.V(l,d,`color expected, "${d}" found`)]:[]},enum:nn,filter:Jn,function:Ai,layer:Ls,object:or,source:jr,model:a.L,light:ni,"light-3d":xi,terrain:Tl,fog:Ta,string:$s,formatted:function(g){return $s(g).length===0?[]:fo(g)},resolvedImage:function(g){return $s(g).length===0?[]:fo(g)},projection:function(g){const l=g.value,d=g.styleSpec,y=d.projection,b=g.style;let T=[];const S=a.o(l);if(S==="object")for(const A in l)T=T.concat(Fi({key:A,value:l[A],valueSpec:y[A],style:b,styleSpec:d}));else S!=="string"&&(T=T.concat([new a.V("projection",l,`object or string expected, ${S} found`)]));return T},import:function(g){const{value:l,styleSpec:d}=g,{data:y,...b}=l;Object.defineProperty(b,"__line__",{value:l.__line__,enumerable:!1});let T=or(a.q({},g,{value:b,valueSpec:d.import}));return a.u(b.id)===""&&T.push(new a.V(`${g.key}.id`,b,"import id can't be an empty string")),y&&(T=T.concat(je(y,d,{key:`${g.key}.data`}))),T}};function Fi(g,l=!1){const d=g.value,y=g.valueSpec,b=g.styleSpec;if(y.expression&&a.J(a.u(d)))return Ai(g);if(y.expression&&a.v(a.x(d)))return fo(g);if(y.type&&po[y.type]){const T=po[y.type](g);return l===!0&&T.length>0&&a.o(g.value)==="array"?fo(g):T}return or(a.q({},g,{valueSpec:y.type?b[y.type]:y}))}function Xu(g){const l=g.value,d=g.key,y=$s(g);return y.length||(l.indexOf("{fontstack}")===-1&&y.push(new a.V(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&y.push(new a.V(d,l,'"glyphs" url must include a "{range}" token'))),y}function je(g,l=a.N,d={}){return Fi({key:d.key||"",value:g,valueSpec:l.$root,styleSpec:l,style:g,objectElementValidators:{glyphs:Xu,"*":()=>[]}})}function te(g,l=a.N){return Wt(je(g,l))}const le=g=>Wt(jr(g)),xe=g=>Wt(ni(g)),Oe=g=>Wt(xi(g)),De=g=>Wt(Tl(g)),Ge=g=>Wt(Ta(g)),rt=g=>Wt(Ls(g)),qe=g=>Wt(Jn(g)),tt=g=>Wt(Ts(g)),yt=g=>Wt(Es(g)),vt=g=>Wt(a.L(g));function Wt(g){return g.slice().sort((l,d)=>l.line&&d.line?l.line-d.line:0)}function pn(g,l){let d=!1;if(l&&l.length)for(const y of l)y instanceof a.n?a.w(y.message):(g.fire(new a.f(new Error(y.message))),d=!0);return d}let wn;class ar extends a.E{constructor(l,d="flat"){super(),this._transitionable=new a.O(wn||(wn=new a.U({anchor:new a.W(a.N.light.anchor),position:new a.X(a.N.light.position),color:new a.W(a.N.light.color),intensity:new a.W(a.N.light.intensity)}))),this.setLight(l,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d,y={}){this._validate(xe,l,y)||(this._transitionable.setTransitionOrValue(l),this.id=d)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,y){return(!y||y.validate!==!1)&&pn(this,l.call(te,a.Q({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}const An=new a.U({source:new a.W(a.N.terrain.source),exaggeration:new a.W(a.N.terrain.exaggeration)});let lr=class extends a.E{constructor(g,l,d,y){super(),this.scope=d,this._transitionable=new a.O(An,d,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g,l){this._transitionable.setTransitionOrValue(g,l)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new a.Y(g)).get("exaggeration")}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof a.Z}};const ln=45,Zr=65,_r=.05;function cr(g,l,d,y){const b=a.a0(ln,Zr,d),[T,S]=pi(g,y);let A=1-Math.min(1,Math.exp((l-T)/(S-T)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*b*g.alpha}function pi(g,l){const d=.5/Math.tan(.5*l);return[g.range[0]+d,g.range[1]+d]}function mi(g,l,d,y,b){const T=a.$.transformMat4([],[l,d,y],b.mercatorFogMatrix);return cr(g,a.$.length(T),b.pitch,b._fov)}function Gi(g,l,d,y,b,T,S){const A=[[d,y,0],[b,y,0],[b,T,0],[d,T,0]];let k=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const B of A){const U=a.$.transformMat4([],B,l),q=a.$.length(U);k=Math.min(k,q),L=Math.max(L,q)}return[cr(g,k,S.pitch,S._fov),cr(g,L,S.pitch,S._fov)]}const Ss=new a.U({range:new a.W(a.N.fog.range),color:new a.W(a.N.fog.color),"high-color":new a.W(a.N.fog["high-color"]),"space-color":new a.W(a.N.fog["space-color"]),"horizon-blend":new a.W(a.N.fog["horizon-blend"]),"star-intensity":new a.W(a.N.fog["star-intensity"]),"vertical-range":new a.W(a.N.fog["vertical-range"])});class qs extends a.E{constructor(l,d,y,b){super(),this._transitionable=new a.O(Ss,y,new Map(b)),this.set(l,b),this._transitioning=this._transitionable.untransitioned(),this._transform=d,this.properties=new a.a1(Ss),this.scope=y}get state(){const l=this._transform,d=l.projection.name==="globe",y=a.a2(l.zoom),b=this.properties.get("range"),T=[.5,3];return{range:d?[a.a3(T[0],b[0],y),a.a3(T[1],b[1],y)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,d,y={}){if(this._validate(Ge,l,y))return;const b=a.Q({},l);for(const T of Object.keys(a.N.fog))b[T]===void 0&&(b[T]=a.N.fog[T].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,d)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.a0(ln,Zr,l))*d.a}getOpacityAtLatLng(l,d){return this._transform.projection.supportsFog?function(y,b,T){const S=a._.fromLngLat(b),A=T.elevation?T.elevation.getAtPointOrZero(S):0;return mi(y,S.x,S.y,A,T)}(this.state,l,d):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Gi(this.state,d,0,0,a.a4,a.a4,this._transform)}getOpacityForBounds(l,d,y,b,T){return this._transform.projection.supportsFog?Gi(this.state,l,d,y,b,T,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?pi(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const y of d){const b=l.points[y];let T;if(b[2]>=0)T=b;else{const S=l.points[y-4];T=a.a5(S,b,S[2]/(S[2]-b[2]))}if(mi(this.state,T[0],T[1],0,this._transform)>=_r)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,y){return(!y||y.validate!==!1)&&pn(this,l.call(te,a.Q({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}class tc extends a.E{constructor(l,d,y,b){super(),this.scope=y,this._options=l,this.properties=new a.a1(d),this._transitionable=new a.O(d,y,new Map(b)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,d){this._options=l,this._transitionable.setTransitionOrValue(l.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let ad,ld;var Ku=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Mn=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,zo=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ea="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,cd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,oi=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Wc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,nc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,rc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ep=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Hc=[];Eo(Ku,Hc),Eo(zo,Hc),Eo(Mn,Hc);const Qu={"_prelude_fog.vertex.glsl":cd,"_prelude_terrain.vertex.glsl":Gc,"_prelude_shadow.vertex.glsl":rc,"_prelude_fog.fragment.glsl":oi,"_prelude_shadow.fragment.glsl":ep,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Wc,"_prelude_raster_particle.glsl":nc},ud={};ur("",Gc),ur(oi,cd),ur(ep,rc),ur(Wc,""),ur(nc,"");const hd=ur(Mn,zo),lg=Ku;var Zc={background:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ur("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ur(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ur(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ur("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ur("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ur("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ur(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ur(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ur(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ur("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ur("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ur(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:ur(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:ur(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:ur(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ur("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ur(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ea),skyboxGradient:ur(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ea),skyboxCapture:ur(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ur(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ur(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ur(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ur(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:ur("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Eo(g,l){const d=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of d)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=y.split(" ");for(const T of b)l.includes(T)||l.push(T)}}function ur(g,l){const d=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(L=>{const B=L.split(" ");return B[B.length-1]}),b=[...new Set(b)]);const T={},S=[],A=[];if(g=g.replace(d,(L,B)=>(A.push(B),"")),(l=l.replace(d,(L,B)=>(S.push(B),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let k=[...Hc];Eo(g,k),Eo(l,k);for(const L of[...S,...A])Qu[L]||console.error(`Undefined include: ${L}`),ud[L]||(ud[L]=[],Eo(Qu[L],ud[L])),k=[...k,...ud[L]];return{fragmentSource:g=g.replace(y,(L,B,U,q,H)=>(T[H]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
in ${U} ${q} ${H};
#else
uniform ${U} ${q} u_${H};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${H}
    ${U} ${q} ${H} = u_${H};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${U} ${q} ${H};
#endif
`:B==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(y,(L,B,U,q,H)=>{const ie=q==="float"?"vec2":q,se=H.match(/color/)?"color":ie;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${H}
in ${U} ${q} a_${H};
#endif
`:T[H]?B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${U} ${ie} a_${H};
out ${U} ${q} ${H};
#else
uniform ${U} ${q} u_${H};
#endif
`:B==="initialize"?se==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = a_${H};
#else
    ${U} ${q} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${H} = unpack_mix_${se}(a_${H}, u_${H}_t);
#else
    ${U} ${q} ${H} = u_${H};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    in ${U} ${q} a_${H};
    out ${U} ${q} ${H};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${H} = a_${H};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${H}
uniform lowp float u_${H}_t;
in ${U} ${ie} a_${H};
#else
uniform ${U} ${q} u_${H};
#endif
`:B==="define-instanced"?se==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${H}0;
in vec4 a_${H}1;
in vec4 a_${H}2;
in vec4 a_${H}3;
#else
uniform ${U} ${q} u_${H};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${ie} a_${H};
#else
uniform ${U} ${q} u_${H};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${H}
    ${U} ${q} ${H} = a_${H};
#endif
`:se==="vec4"?`
#ifndef HAS_UNIFORM_u_${H}
    ${U} ${q} ${H} = a_${H};
#else
    ${U} ${q} ${H} = u_${H};
#endif
`:`
#ifndef HAS_UNIFORM_u_${H}
    ${U} ${q} ${H} = unpack_mix_${se}(a_${H}, u_${H}_t);
#else
    ${U} ${q} ${H} = u_${H};
#endif
`}),staticAttributes:b,usedDefines:k,vertexIncludes:S,fragmentIncludes:A}}class cg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,d,y,b,T,S,A,k){this.context=l;let L=this.boundPaintVertexBuffers.length!==b.length;for(let U=0;!L&&U<b.length;U++)this.boundPaintVertexBuffers[U]!==b[U]&&(L=!0);let B=this.boundDynamicVertexBuffers.length!==A.length;for(let U=0;!B&&U<A.length;U++)this.boundDynamicVertexBuffers[U]!==A[U]&&(B=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||L||B||this.boundIndexBuffer!==T||this.boundVertexOffset!==S)this.freshBind(d,y,b,T,S,A,k);else{l.bindVertexArrayOES.set(this.vao);for(const U of A)U&&(U.bind(),k&&U.instanceCount&&U.setVertexAttribDivisor(l.gl,d,k));T&&T.dynamicDraw&&T.bind()}}freshBind(l,d,y,b,T,S,A){const k=l.numAttributes,L=this.context,B=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=S,d.enableAttributes(B,l),d.bind(),d.setVertexAttribPointers(B,l,T);for(const U of y)U.enableAttributes(B,l),U.bind(),U.setVertexAttribPointers(B,l,T);for(const U of S)U&&(U.enableAttributes(B,l),U.bind(),U.setVertexAttribPointers(B,l,T),A&&U.instanceCount&&U.setVertexAttribDivisor(B,l,A));b&&b.bind(),L.currentNumAttributes=k}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ug(g,l){const d=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new a._(0,y/d).toLngLat().lat,new a._(0,(y+1)/d).toLngLat().lat]}function Xc(g,l,d,y,b,T,S){const A=g.context,k=A.gl,L=d.hillshadeFBO;if(!L)return;g.prepareDrawTile();const B=g.isTileAffectedByFog(l),U=g.getOrCreateProgram("hillshade",{overrideFog:B});A.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get());const q=((ae,ce,ye,ve)=>{const _e=ye.paint.get("hillshade-shadow-color"),Re=ye.paint.get("hillshade-highlight-color"),Se=ye.paint.get("hillshade-accent-color"),Ie=ye.paint.get("hillshade-emissive-strength");let ze=a.ac(ye.paint.get("hillshade-illumination-direction"));if(ye.paint.get("hillshade-illumination-anchor")==="viewport")ze-=ae.transform.angle;else if(ae.style&&ae.style.enable3dLights()&&ae.style.directionalLight){const We=ae.style.directionalLight.properties.get("direction"),Fe=a.ad(We.x,We.y,We.z);ze=a.ac(Fe[1])}const Ne=!ae.options.moving;return{u_matrix:ve||ae.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Ne),u_image:0,u_latrange:ug(0,ce.tileID),u_light:[ye.paint.get("hillshade-exaggeration"),ze],u_shadow:_e.toRenderColor(ye.lut),u_highlight:Re.toRenderColor(ye.lut),u_emissive_strength:Ie,u_accent:Se.toRenderColor(ye.lut)}})(g,d,y,g.terrain?l.projMatrix:null);g.uploadCommonUniforms(A,U,l.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:ie,tileBoundsSegments:se}=g.getTileBoundsBuffers(d);U.draw(g,k.TRIANGLES,b,T,S,a.ag.disabled,q,y.id,H,ie,se)}function hg(g,l,d){if(!l.needsDEMTextureUpload)return;const y=g.context,b=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(d.stride);const T=d.getPixels();l.demTexture?l.demTexture.update(T,{premultiply:!1}):l.demTexture=new a.T(y,T,b.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function u0(g,l,d){const y=g.context,b=y.gl;if(!l.dem)return;const T=l.dem;if(y.activeTexture.set(b.TEXTURE1),hg(g,l,T),!l.demTexture)return;l.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const S=T.dim;y.activeTexture.set(b.TEXTURE0);let A=l.hillshadeFBO;if(!A){const q=new a.T(y,{width:S,height:S,data:null},b.RGBA);q.bind(b.LINEAR,b.CLAMP_TO_EDGE),A=l.hillshadeFBO=y.createFramebuffer(S,S,!0,"renderbuffer"),A.colorAttachment.set(q.texture)}y.bindFramebuffer.set(A.framebuffer),y.viewport.set([0,0,S,S]);const{tileBoundsBuffer:k,tileBoundsIndexBuffer:L,tileBoundsSegments:B}=g.getMercatorTileBoundsBuffers(),U=[];g.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(g,b.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,((q,H)=>{const ie=H.stride,se=a.ae.create();return a.ae.ortho(se,0,a.a4,-a.a4,0,0,1),a.ae.translate(se,se,[0,-a.a4,0]),{u_matrix:se,u_image:1,u_dimension:[ie,ie],u_zoom:q.overscaledZ}})(l.tileID,T),d.id,k,L,B),l.needsHillshadePrepare=!1}function tp(g,l,d,y,b){const T=function(A,k){if(A)return b(A);if(k){if(g.url&&k.tiles&&g.tiles&&delete g.tiles,k.variants){if(!Array.isArray(k.variants))return b(new Error("variants must be an array"));for(const B of k.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return b(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){k=a.Q(k,B);break}}}const L=a.ai(a.Q(k,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(L.vectorLayers=k.vector_layers,L.vectorLayerIds=L.vectorLayers.map(B=>B.id)),k.raster_layers&&(L.rasterLayers=k.raster_layers,L.rasterLayerIds=L.rasterLayers.map(B=>B.id)),L.tiles=l.canonicalizeTileset(L,g.url),b(null,L)}},S=function(A,k,L){if(!A)return null;if(!k&&!L)return A;L=L||A.worldview_default;const B=Object.values(A.language||{});if(B.length===0)return null;const U=Object.values(A.worldview||{});if(U.length===0)return null;const q=B.every(ie=>ie===k),H=U.every(ie=>ie===L);return q&&H?A:k in(A.language_options||{})||L in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null}(g.data,d,y);return S?a.e.frame(()=>T(null,S)):g.url?a.h(l.transformRequest(l.normalizeSourceURL(g.url,null,d,y),a.R.Source),T):a.e.frame(()=>{const{data:A,...k}=g;T(null,k)})}class No{constructor(l,d,y){this.bounds=a.aj.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),y=Math.floor(a.ak(this.bounds.getWest())*d),b=Math.floor(a.al(this.bounds.getNorth())*d),T=Math.ceil(a.ak(this.bounds.getEast())*d),S=Math.ceil(a.al(this.bounds.getSouth())*d);return l.x>=y&&l.x<T&&l.y>=b&&l.y<S}}class So extends a.E{constructor(l,d,y,b){super(),this.id=l,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.Q({type:"raster"},d),a.Q(this,a.ai(d,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._tileJSONRequest=tp(this._options,this.map._requestManager,null,null,(d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new a.f(d)):y&&(a.Q(this,y),y.bounds&&(this.tileBounds=new No(y.bounds,this.minzoom,this.maxzoom)),a.ao(y.tiles),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(d)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){const y=a.e.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);l.request=a.i(this.map._requestManager.transformRequest(b,a.R.Tile),(T,S,A,k)=>(delete l.request,l.aborted?(l.state="unloaded",d(null)):T?(l.state="errored",d(T)):S?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:A,expires:k}),l.setTexture(S,this.map.painter),l.state="loaded",a.an(this.dispatcher),void d(null)):d(null)))}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d&&d()}unloadTile(l,d){l.texture&&l.texture instanceof a.T?(l.destroy(!0),l.texture&&l.texture instanceof a.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),d&&d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class dg extends a.E{constructor(l,d,y,b){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.Q(this,a.ai(d,["url","scheme","tileSize","promoteId"])),this._options=a.Q({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new a.ap}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=tp(this._options,this.map._requestManager,d,y,(b,T)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),y&&y.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new a.f(b))):T&&(a.Q(this,T),T.bounds&&(this.tileBounds=new No(T.bounds,this.minzoom,this.maxzoom)),a.ao(T.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(b)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}loadTile(l,d){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),b=this.map._requestManager.transformRequest(y,a.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,S={request:b,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,lut:T?{image:T.image.clone()}:null,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=d:l.request=l.actor.send("reloadTile",S,A.bind(this));else if(l.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",S,A.bind(this),void 0,!0);else{const k=a.aq.call({deduped:this._deduped},S,(L,B)=>{L||!B?A.call(this,L):(S.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},l.actor&&l.actor.send("loadTile",S,A.bind(this),void 0,!0))},!0);l.request={cancel:k}}function A(k,L){return delete l.request,l.aborted?d(null):k&&k.status!==404?d(k):(L&&L.resourceTiming&&(l.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&l.setExpiryData(L),l.loadVectorData(L,this.map.painter),a.an(this.dispatcher),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,d){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Kc=(g,l,d)=>({u_matrix:g,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:d}),Qc=(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:T,u_image0:0,u_frustum_tl:S,u_frustum_tr:A,u_frustum_br:k,u_frustum_bl:L,u_globe_pos:B,u_globe_radius:U,u_viewport:q,u_grid_matrix:se?Float32Array.from(se):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:ie});class Yc{constructor(l=0,d=0,y=0,b=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=y,this.right=b}interpolate(l,d,y){return d.top!=null&&l.top!=null&&(this.top=a.a3(l.top,d.top,y)),d.bottom!=null&&l.bottom!=null&&(this.bottom=a.a3(l.bottom,d.bottom,y)),d.left!=null&&l.left!=null&&(this.left=a.a3(l.left,d.left,y)),d.right!=null&&l.right!=null&&(this.right=a.a3(l.right,d.right,y)),this}getCenter(l,d){const y=a.au((this.left+l-this.right)/2,0,l),b=a.au((this.top+d-this.bottom)/2,0,d);return new a.P(y,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Yc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ta(g,l){const d=a.ax(g,3);a.ae.fromQuat(g,l),a.aA(g,3,d)}function Lt(g,l){const d=a.aw.identity([]);return a.aw.rotateZ(d,d,-l),a.aw.rotateX(d,d,-g),d}function ic(g,l){const d=[g[0],g[1],0],y=[l[0],l[1],0];if(a.$.length(d)>=1e-15){const S=a.$.normalize([],d);a.$.scale(y,S,a.$.dot(y,S)),l[0]=y[0],l[1]=y[1]}const b=a.$.cross([],l,g);if(a.$.len(b)<1e-15)return null;const T=Math.atan2(-b[1],b[0]);return Lt(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),T)}class dd{constructor(l,d){this.position=l,this.orientation=d}get position(){return this._position}set position(l){if(l){const d=l instanceof a._?l:new a._(l[0],l[1],l[2]);this._renderWorldCopies&&(d.x=a.av(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(l,d){if(this.orientation=null,!this.position)return;const y=this.position,b=this._elevation?this._elevation.getAtPointOrZero(a._.fromLngLat(l)):0,T=a._.fromLngLat(l,b),S=[T.x-y.x,T.y-y.y,T.z-y.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=ic(S,d)}setPitchBearing(l,d){this.orientation=Lt(a.ac(l),a.ac(-d))}}class ai{constructor(l,d){this._transform=a.ae.identity([]),this.orientation=d,this.position=l}get mercatorPosition(){const l=this.position;return new a._(l[0],l[1],l[2])}get position(){const l=a.ax(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var d;l&&a.aA(this._transform,3,[(d=l)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||a.aw.identity([]),l&&ta(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,d){this._orientation=Lt(l,d),ta(this._transform,this._orientation)}forward(){const l=a.ax(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=a.ax(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=a.ax(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,d){const y=new Float64Array(16);return a.ae.invert(y,this.getWorldToCamera(l,d)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,d,y){const b=this.position;a.$.scale(b,b,-l);const T=new Float64Array(16);return a.ae.fromScaling(T,[y,y,y]),a.ae.translate(T,T,b),T[10]*=d,T}getWorldToCamera(l,d){const y=new Float64Array(16),b=new Float64Array(4),T=this.position;return a.aw.conjugate(b,this._orientation),a.$.scale(T,T,-l),a.ae.fromQuat(y,b),a.ae.translate(y,y,T),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=d,y[9]*=d,y[10]*=d,y[11]*=d,y}getCameraToClipPerspective(l,d,y,b){const T=new Float64Array(16);return a.ae.perspective(T,l,d,y,b),T}getCameraToClipOrthographic(l,d,y,b,T,S){const A=new Float64Array(16);return a.ae.ortho(A,l,d,y,b,T,S),A}getDistanceToElevation(l,d=!1){const y=l===0?0:a.ay(l,d?a.az(this.position[1]):this.position[1]),b=this.forward();return(y-this.position[2])/b[2]}clone(){return new ai([...this.position],[...this.orientation])}}const er={unknown:0,flipRequired:1,flipNotRequired:2},eo=Math.tan(85*Math.PI/180);function Jc(g,l,d,y,b,T,S){const A=a.ae.create();if(d)if(T.name==="globe"){const k=a.aC(b,l);a.ae.multiply(A,A,k)}else{const k=a.aD.invert([],S);A[0]=k[0],A[1]=k[1],A[4]=k[2],A[5]=k[3],y||a.ae.rotateZ(A,A,b.angle)}else a.ae.multiply(A,b.labelPlaneMatrix,g);return A}function Yu(g,l,d,y,b,T,S){const A=Jc(g,l,d,y,b,T,S);return T.name==="globe"&&d||(A[2]=A[6]=A[10]=A[14]=0),A}function Ju(g,l,d,y,b,T,S){if(d){if(T.name==="globe"){const A=Jc(g,l,d,y,b,T,S);return a.ae.invert(A,A),a.ae.multiply(A,g,A),A}{const A=a.ae.clone(g),k=a.ae.identity([]);return k[0]=S[0],k[1]=S[1],k[4]=S[2],k[5]=S[3],a.ae.multiply(A,A,k),y||a.ae.rotateZ(A,A,-b.angle),A}}return b.glCoordMatrix}function mo(g,l,d,y){const b=[g,l,d,1];d?a.aB.transformMat4(b,b,y):np(b,b,y);const T=b[3];return b[0]/=T,b[1]/=T,b[2]/=T,b}function Wn(g,l){return Math.min(.5+g/l*.5,1.5)}function na(g,l){const d=g[0]/g[3],y=g[1]/g[3];return d>=-l[0]&&d<=l[0]&&y>=-l[1]&&y<=l[1]}function sc(g,l,d,y,b,T,S,A,k,L){const B=d.transform,U=y?g.textSizeData:g.iconSizeData,q=a.aE(U,d.transform.zoom),H=B.projection.name==="globe",ie=[256/d.width*2+1,256/d.height*2+1],se=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;se.clear();let ae=null;H&&(ae=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const ce=g.lineVertexArray,ye=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,ve=d.transform.width/d.transform.height;let _e,Re=!1;for(let Se=0;Se<ye.length;Se++){const Ie=ye.get(Se),{numGlyphs:ze,writingMode:Ne}=Ie;if(Ne!==a.aF.vertical||Re||_e===a.aF.horizontal||(Re=!0),_e=Ne,(Ie.hidden||Ne===a.aF.vertical)&&!Re){Ea(ze,se);continue}Re=!1;const We=new a.P(Ie.tileAnchorX,Ie.tileAnchorY);let{x:Fe,y:Pe,z:et}=B.projection.projectTilePoint(We.x,We.y,L.canonical);if(k){const[Bt,Vt,rn]=k(We);Fe+=Bt,Pe+=Vt,et+=rn}const Qe=[Fe,Pe,et,1];if(a.aB.transformMat4(Qe,Qe,l),!na(Qe,ie)){Ea(ze,se);continue}const Ve=Qe[3],xt=Wn(d.transform.getCameraToCenterDistance(B.projection),Ve),pt=a.aG(U,q,Ie),He=S?pt/xt:pt*xt,it=mo(Fe,Pe,et,b);if(it[3]<=0){Ea(ze,se);continue}let Be={};const mt=S?null:k,_t=Is(Ie,He,!1,A,l,b,T,g.glyphOffsetArray,ce,se,ae,it,We,Be,ve,mt,B.projection,L,S);Re=_t.useVertical,mt&&_t.needsFlipping&&(Be={}),(_t.notEnoughRoom||Re||_t.needsFlipping&&Is(Ie,He,!0,A,l,b,T,g.glyphOffsetArray,ce,se,ae,it,We,Be,ve,mt,B.projection,L,S).notEnoughRoom)&&Ea(ze,se)}y?(g.text.dynamicLayoutVertexBuffer.updateData(se),ae&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(ae)):(g.icon.dynamicLayoutVertexBuffer.updateData(se),ae&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(ae))}function eh(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se){const{lineStartIndex:ae,glyphStartIndex:ce,segment:ye}=A,ve=ce+A.numGlyphs,_e=ae+A.lineLength,Re=l.getoffsetX(ce),Se=l.getoffsetX(ve-1),Ie=lc(g*Re,d,y,b,T,S,ye,ae,_e,k,L,B,U,q,!0,H,ie,se);if(!Ie)return null;const ze=lc(g*Se,d,y,b,T,S,ye,ae,_e,k,L,B,U,q,!0,H,ie,se);return ze?{first:Ie,last:ze}:null}function oc(g,l,d,y){return g===a.aF.horizontal&&Math.abs(y)>Math.abs(d)?{useVertical:!0}:g===a.aF.vertical?y>0?{needsFlipping:!0}:null:l!==er.unknown&&function(b,T){return b===0||Math.abs(T/b)>eo}(d,y)?l===er.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function Is(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se,ae,ce,ye){const ve=l/24,_e=g.lineOffsetX*ve,Re=g.lineOffsetY*ve,{lineStartIndex:Se,glyphStartIndex:Ie,numGlyphs:ze,segment:Ne,writingMode:We,flipState:Fe}=g,Pe=Se+g.lineLength,et=Qe=>{if(B){const[He,it,Be]=Qe.up,mt=L.length;a.aH(B,mt+0,He,it,Be),a.aH(B,mt+1,He,it,Be),a.aH(B,mt+2,He,it,Be),a.aH(B,mt+3,He,it,Be)}const[Ve,xt,pt]=Qe.point;a.aI(L,Ve,xt,pt,Qe.angle)};if(ze>1){const Qe=eh(ve,A,_e,Re,d,U,q,g,k,T,H,se,!1,ae,ce,ye);if(!Qe)return{notEnoughRoom:!0};if(y&&!d){let[Ve,xt,pt]=Qe.first.point,[He,it,Be]=Qe.last.point;[Ve,xt]=mo(Ve,xt,pt,S),[He,it]=mo(He,it,Be,S);const mt=oc(We,Fe,(He-Ve)*ie,it-xt);if(g.flipState=mt&&mt.needsFlipping?er.flipRequired:er.flipNotRequired,mt)return mt}et(Qe.first);for(let Ve=Ie+1;Ve<Ie+ze-1;Ve++){const xt=lc(ve*A.getoffsetX(Ve),_e,Re,d,U,q,Ne,Se,Pe,k,T,H,se,!1,!1,ae,ce,ye);if(!xt)return L.length-=4*(Ve-Ie),{notEnoughRoom:!0};et(xt)}et(Qe.last)}else{if(y&&!d){const Ve=mo(q.x,q.y,0,b),xt=Se+Ne+1,pt=new a.P(k.getx(xt),k.gety(xt)),He=mo(pt.x,pt.y,0,b),it=He[3]>0?He:ac(q,pt,Ve,1,b,void 0,ae,ce.canonical),Be=oc(We,Fe,(it[0]-Ve[0])*ie,it[1]-Ve[1]);if(g.flipState=Be&&Be.needsFlipping?er.flipRequired:er.flipNotRequired,Be)return Be}const Qe=lc(ve*A.getoffsetX(Ie),_e,Re,d,U,q,Ne,Se,Pe,k,T,H,se,!1,!1,ae,ce,ye);if(!Qe)return{notEnoughRoom:!0};et(Qe)}return{}}function fd(g,l,d,y,b){const{x:T,y:S,z:A}=y.projectTilePoint(g.x,g.y,l);if(!b)return mo(T,S,A,d);const[k,L,B]=b(g);return mo(T+k,S+L,A+B,d)}function ac(g,l,d,y,b,T,S,A){const k=fd(g.sub(l)._unit()._add(g),A,b,S,T);return a.$.sub(k,d,k),a.$.normalize(k,k),a.$.scaleAndAdd(k,d,k,y)}function lc(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se,ae,ce){const ye=y?g-l:g+l;let ve=ye>0?1:-1,_e=0;y&&(ve*=-1,_e=Math.PI),ve<0&&(_e+=Math.PI);let Re=A+S+(ve>0?0:1)|0,Se=b,Ie=b,ze=0,Ne=0;const We=Math.abs(ye),Fe=[],Pe=[];let et=T,Qe=et;const Ve=()=>ac(Qe,et,Ie,We-ze+1,B,q,se,ae.canonical);for(;ze+Ne<=We;){if(Re+=ve,Re<A||Re>=k)return null;if(Ie=Se,Qe=et,Fe.push(Ie),H&&Pe.push(Qe),et=new a.P(L.getx(Re),L.gety(Re)),Se=U[Re],!Se){const Vt=fd(et,ae.canonical,B,se,q);Se=Vt[3]>0?U[Re]=Vt:Ve()}ze+=Ne,Ne=a.$.distance(Ie,Se)}ie&&q&&(U[Re]&&(Se=Ve(),Ne=a.$.distance(Ie,Se)),U[Re]=Se);const xt=(We-ze)/Ne,pt=et.sub(Qe)._mult(xt)._add(Qe),He=a.$.sub([],Se,Ie),it=a.$.scaleAndAdd([],Ie,He,xt);let Be=[0,0,1],mt=He[0],_t=He[1];if(ce&&(Be=se.upVector(ae.canonical,pt.x,pt.y),Be[0]!==0||Be[1]!==0||Be[2]!==1)){const Vt=[Be[2],0,-Be[0]],rn=a.$.cross([],Be,Vt);a.$.normalize(Vt,Vt),a.$.normalize(rn,rn),mt=a.$.dot(He,Vt),_t=a.$.dot(He,rn)}if(d){const Vt=a.$.cross([],Be,He);a.$.normalize(Vt,Vt),a.$.scaleAndAdd(it,it,Vt,d*ve)}const Bt=_e+Math.atan2(_t,mt);return Fe.push(it),H&&Pe.push(pt),{point:it,angle:Bt,path:Fe,tilePath:Pe,up:Be}}function Ea(g,l){const d=l.length,y=d+4*g;l.resize(y),l.float32.fill(-1/0,4*d,4*y)}function np(g,l,d){const y=l[0],b=l[1];return g[0]=d[0]*y+d[4]*b+d[12],g[1]=d[1]*y+d[5]*b+d[13],g[3]=d[3]*y+d[7]*b+d[15],g}const th=(g,l,d)=>(1-d)*g+d*l,Ha=g=>g*g*g*g*g;class eu{constructor(l,d,y,b,T,S,A){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=y??0,this._maxPitch=b??60,this.setProjection(S),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new a.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Yc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ai,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new eu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,d=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(l||y)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return a.ai(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=a.aK(this.projectionOptions);const y=this.getProjection(),b=!a.d(d,y);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.aK({name:"mercator"});const d=l!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.av(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const d=-l*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=a.aD.create(),a.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=a.au(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=a.ac(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let b=0,T=0;for(let S=0;S<d.length;S++){const A=new a.P(d[S][0]*this.width,y+d[S][1]*(this.height-y)),k=l.pointCoordinate(A);if(!k)continue;const L=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);b+=k[3]*L,T+=L}return T===0?NaN:b/T}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(l),T=this._mercatorZfromZoom(this._maxZoom),S=Math.max(b-y,T);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let y;y=l.z<this._camera.position[2]?[d.x,d.y,d.z]:[l.x,l.y,l.z];const b=a.$.length(a.$.sub([],this._camera.position,y));return a.au(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let d=!1;if(l.orientation&&!a.aw.exactEquals(l.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(l.orientation)),l.position){const y=[l.position.x,l.position.y,l.position.z];a.$.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,d=new dd;return d.position=new a._(l[0],l[1],l[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(l){if(!a.aw.length(l))return!1;a.aw.normalize(l,l);const d=a.$.transformQuat([],[0,0,-1],l),y=a.$.transformQuat([],[0,-1,0],l);if(y[2]<0)return!1;const b=ic(d,y);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(l){const d=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;l[2]=a.au(l[2],b/y,b/d),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,y){this._unmodified=!1,this._edgeInsets.interpolate(l,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new a.aL(0,l)];if(this.renderWorldCopies){const y=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),T=this.pointCoordinate(new a.P(this.width,this.height)),S=this.pointCoordinate(new a.P(0,this.height)),A=Math.floor(Math.min(y.x,b.x,T.x,S.x)),k=Math.floor(Math.max(y.x,b.x,T.x,S.x)),L=1;for(let B=A-L;B<=k+L;B++)B!==0&&d.push(new a.aL(B,l))}return d}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(l,d,y){let b=[];const T=y!==void 0,S=!T;if(S&&this.zoom<d||T&&y[0]===0&&y[1]===0)return b;const A=new Set,k=(B,U,q,H,ie)=>{const se=a.b2(U,B,q,H,ie);A.has(se)||(b.push(new a.aQ(B,U,q,H,ie)),A.add(se))};for(let B=0;B<l.length;B++){const U=l[B];if(S&&U.canonical.z!==d)continue;const q=U.canonical,H=U.overscaledZ,ie=U.wrap,se=1<<q.z,ae=q.x+1<se,ce=q.x>0,ye=q.y+1<se,ve=q.y>0,_e=U.wrap-(ce?0:1),Re=U.wrap+(ae?0:1),Se=ce?q.x-1:se-1,Ie=ae?q.x+1:0;if(T)y[0]<0?(k(H,Re,q.z,Ie,q.y),y[1]<0&&ye&&(k(H,ie,q.z,q.x,q.y+1),k(H,Re,q.z,Ie,q.y+1)),y[1]>0&&ve&&(k(H,ie,q.z,q.x,q.y-1),k(H,Re,q.z,Ie,q.y-1))):y[0]>0?(k(H,_e,q.z,Se,q.y),y[1]<0&&ye&&(k(H,ie,q.z,q.x,q.y+1),k(H,_e,q.z,Se,q.y+1)),y[1]>0&&ve&&(k(H,ie,q.z,q.x,q.y-1),k(H,_e,q.z,Se,q.y-1))):y[1]<0&&ye?k(H,ie,q.z,q.x,q.y+1):ve&&k(H,ie,q.z,q.x,q.y-1);else{const ze=U.visibleQuadrants;1&ze&&(k(H,_e,q.z,Se,q.y),ve&&(k(H,ie,q.z,q.x,q.y-1),k(H,_e,q.z,Se,q.y-1))),2&ze&&(k(H,Re,q.z,Ie,q.y),ve&&(k(H,ie,q.z,q.x,q.y-1),k(H,Re,q.z,Ie,q.y-1))),4&ze&&(k(H,_e,q.z,Se,q.y),ye&&(k(H,ie,q.z,q.x,q.y+1),k(H,_e,q.z,Se,q.y+1))),8&ze&&(k(H,Re,q.z,Ie,q.y),ye&&(k(H,ie,q.z,q.x,q.y+1),k(H,Re,q.z,Ie,q.y+1)))}}const L=[];for(const B of b)b.some(U=>B.isChildOf(U))||L.push(B);if(b=L.filter(B=>!l.some(U=>!!(B.overscaledZ<d&&U.isChildOf(B))||B.equals(U)||B.isChildOf(U))),S){const B=1<<d,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=[B*U.x,B*U.y],H=4,ie=H*H;b=b.filter(se=>{const ae=se.canonical.x+.5-q[0],ce=se.canonical.y+.5-q[1];return ae*ae+ce*ce<ie})}return b}coveringTiles(l){let d=this.coveringZoomLevel(l);const y=d,b=this.elevation&&this.elevation.exaggeration(),T=b&&!l.isTerrainDEM,S=this.projection.name==="mercator";if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);const A=this.locationCoordinate(this.center),k=this.center.lat,L=1<<d,B=[L*A.x,L*A.y,0],U=this.projection.name==="globe",q=!U,H=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,q),ie=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),se=L*a.ay(1,this.center.lat),ae=this._camera.position[2]/a.ay(1,this.center.lat),ce=[L*ie.x,L*ie.y,ae*(q?1:se)],ye=U||b,ve=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),_e=this.isLODDisabled(!0)?d:0;let Re;if(this._elevation&&l.isTerrainDEM)Re=1e4*this._elevation.exaggeration();else if(this._elevation){const He=this._elevation.getMinMaxForVisibleTiles();Re=He?He.max:this._centerAltitude}else Re=this._centerAltitude;const Se=l.isTerrainDEM?-Re:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?a.aN(this):1,ze=He=>{const Be=new a._(He.x+25e-6,He.y,He.z),mt=new a._(He.x,He.y+25e-6,He.z),_t=He.toLngLat(),Bt=Be.toLngLat(),Vt=mt.toLngLat(),rn=this.locationCoordinate(_t),Ht=this.locationCoordinate(Bt),vn=this.locationCoordinate(Vt),Fn=Math.hypot(Ht.x-rn.x,Ht.y-rn.y),bn=Math.hypot(vn.x-rn.x,vn.y-rn.y);return Math.sqrt(Fn*bn)*Ie/25e-6},Ne=He=>{const it=Re,Be=Se;return{aabb:a.aR(this,L,0,0,0,He,Be,it,this.projection),zoom:0,x:0,y:0,minZ:Be,maxZ:it,wrap:He,fullyVisible:!1}},We=[];let Fe=[];const Pe=d,et=l.reparseOverscaled?y:d,Qe=(ae-this._centerAltitude)*se,Ve=He=>{if(!this._elevation||!He.tileID||!S)return;const it=this._elevation.getMinMaxForTile(He.tileID),Be=He.aabb;it?(Be.min[2]=it.min,Be.max[2]=it.max,Be.center[2]=(Be.min[2]+Be.max[2])/2):(He.shouldSplit=pt(He),He.shouldSplit||(Be.min[2]=Be.max[2]=Be.center[2]=this._centerAltitude))},xt=(He,it)=>{if(.707*it<He)return 1;const Be=it/He;return Be/(1.4144271570014144+(Math.pow(1.1,Be-1.4144271570014144+1)-1)/(1.1-1)-1)},pt=He=>{if(He.zoom<_e)return!0;if(He.zoom===Pe)return!1;if(He.shouldSplit!=null)return He.shouldSplit;const it=He.aabb.distanceX(ce),Be=He.aabb.distanceY(ce);let mt=Qe,_t=1;if(U){mt=He.aabb.distanceZ(ce);const bn=Math.pow(2,He.zoom),$n=a.az((He.y+1)/bn),hr=a.az(He.y/bn),Xr=Math.min(Math.max(k,$n),hr),Lr=a.b6(Xr)/a.b6(k);if(_t=Xr===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Lr/this._mercatorScaleRatio),this.zoom<=a.b3&&He.zoom===Pe-1&&Lr>=.9)return!0}else if(T&&(mt=He.aabb.distanceZ(ce)*se),this.projection.isReprojectedInTileSpace&&y<=5){const bn=Math.pow(2,He.zoom),$n=ze(new a._((He.x+.5)/bn,(He.y+.5)/bn));_t=$n>.85?1:$n}if(!S){const bn=Math.sqrt(it*it+Be*Be+mt*mt);let $n=(1<<Pe-He.zoom)*ve*_t;return $n*=xt(Math.max(mt,Qe),bn),bn<$n}let Bt=Number.MAX_VALUE,Vt=0;const rn=He.aabb.getCorners(),Ht=[];for(const bn of rn){a.$.sub(Ht,bn,ce),U||(T?Ht[2]*=se:Ht[2]=Qe);const $n=a.$.dot(Ht,this._camera.forward());$n<Bt&&(Bt=$n,Vt=Math.abs(Ht[2]))}let vn=(1<<Pe-He.zoom)*ve*_t;if(vn*=xt(Math.max(Vt,Qe),Bt),Bt<vn)return!0;const Fn=He.aabb.closestPoint(B);return Fn[0]===B[0]&&Fn[1]===B[1]};if(this.renderWorldCopies)for(let He=1;He<=3;He++)We.push(Ne(-He)),We.push(Ne(He));for(We.push(Ne(0));We.length>0;){const He=We.pop(),it=He.x,Be=He.y;let mt=He.fullyVisible;const _t=()=>this.projection.name==="globe"&&(He.y===0||He.y===(1<<He.zoom)-1);if(!mt){let Bt=ye?He.aabb.intersects(H):He.aabb.intersectsFlat(H);if(Bt===0&&_t()){const Vt=new a.aO(He.zoom,it,Be);Bt=a.aP(this,L,Vt,!0).intersects(H)}if(Bt===0)continue;mt=Bt===2}if(He.zoom!==Pe&&pt(He))for(let Bt=0;Bt<4;Bt++){const Vt=(it<<1)+Bt%2,rn=(Be<<1)+(Bt>>1),Ht={aabb:S?He.aabb.quadrant(Bt):a.aR(this,L,He.zoom+1,Vt,rn,He.wrap,He.minZ,He.maxZ,this.projection),zoom:He.zoom+1,x:Vt,y:rn,wrap:He.wrap,fullyVisible:mt,tileID:void 0,shouldSplit:void 0,minZ:He.minZ,maxZ:He.maxZ};T&&!U&&(Ht.tileID=new a.aQ(He.zoom+1===Pe?et:He.zoom+1,He.wrap,He.zoom+1,Vt,rn),Ve(Ht)),We.push(Ht)}else{const Bt=He.zoom===Pe?et:He.zoom;if(l.minzoom&&l.minzoom>Bt)continue;let Vt=0;if(!mt){let Fn=ye?He.aabb.intersectsPrecise(H):He.aabb.intersectsPreciseFlat(H);if(Fn===0&&_t()){const bn=new a.aO(He.zoom,it,Be);Fn=a.aP(this,L,bn,!0).intersectsPrecise(H)}if(Fn===0)continue;if(l.calculateQuadrantVisibility)if(H.containsPoint(He.aabb.center))Vt=15;else for(let bn=0;bn<4;bn++)He.aabb.quadrant(bn).intersects(H)!==0&&(Vt|=1<<bn)}const rn=B[0]-(.5+it+(He.wrap<<He.zoom))*(1<<d-He.zoom),Ht=B[1]-.5-Be,vn=He.tileID?He.tileID:new a.aQ(Bt,He.wrap,He.zoom,it,Be);l.calculateQuadrantVisibility&&(vn.visibleQuadrants=Vt),Fe.push({tileID:vn,distanceSq:rn*rn+Ht*Ht})}}if(this.fogCullDistSq){const He=this.fogCullDistSq,it=this.horizonLineFromTop();Fe=Fe.filter(Be=>{const mt=[0,0,0,1],_t=[a.a4,a.a4,0,1],Bt=this.calculateFogTileMatrix(Be.tileID.toUnwrapped());a.aB.transformMat4(mt,mt,Bt),a.aB.transformMat4(_t,_t,Bt);const Vt=a.aB.min([],mt,_t),rn=a.aB.max([],mt,_t),Ht=a.aS(Vt,rn);if(Ht===0)return!0;let vn=!1;const Fn=this._elevation;if(Fn&&Ht>He&&it!==0){const bn=this.calculateProjMatrix(Be.tileID.toUnwrapped());let $n;l.isTerrainDEM||($n=Fn.getMinMaxForTile(Be.tileID)),$n||($n={min:Se,max:Re});const hr=a.b4(this.rotation),Xr=[hr[0]*a.a4,hr[1]*a.a4,$n.max];a.$.transformMat4(Xr,Xr,bn),vn=(1-Xr[1])*this.height*.5<it}return Ht<He||vn})}return Fe.sort((He,it)=>He.distanceSq-it.distanceSq).map(He=>He.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=a.au(l.lat,-a.aT,a.aT),y=this.projection.project(l.lng,d);return new a.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,d){let y,b;const T=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;y=(d.x-T.x)/A,b=(d.y-T.y)/A}else{const A=this.pointCoordinate(d),k=this.pointCoordinate(T);y=A.x-k.x,b=A.y-k.y}const S=this.locationCoordinate(l);this.setLocation(new a._(S.x-y,S.y-b))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,d){const y=d?a.ay(d,l.lat):void 0,b=this.projection.project(l.lng,l.lat);return new a._(b.x,b.y,y)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,d){const y=d??this._centerAltitude,b=[l.x,l.y,0,1],T=[l.x,l.y,1,1];a.aB.transformMat4(b,b,this.pixelMatrixInverse),a.aB.transformMat4(T,T,this.pixelMatrixInverse);const S=T[3];a.aB.scale(b,b,1/b[3]),a.aB.scale(T,T,1/S);const A=b[2],k=T[2];return{p0:b,p1:T,t:A===k?0:(y-A)/(k-A)}}screenPointToMercatorRay(l){const d=[l.x,l.y,0,1],y=[l.x,l.y,1,1];return a.aB.transformMat4(d,d,this.pixelMatrixInverse),a.aB.transformMat4(y,y,this.pixelMatrixInverse),a.aB.scale(d,d,1/d[3]),a.aB.scale(y,y,1/y[3]),d[2]=a.ay(d[2],this._center.lat)*this.worldSize,y[2]=a.ay(y[2],this._center.lat)*this.worldSize,a.aB.scale(d,d,1/this.worldSize),a.aB.scale(y,y,1/this.worldSize),new a.aU([d[0],d[1],d[2]],a.$.normalize([],a.$.sub([],y,d)))}rayIntersectionCoordinate(l){const{p0:d,p1:y,t:b}=l,T=a.ay(d[2],this._center.lat),S=a.ay(y[2],this._center.lat);return new a._(a.a3(d[0],y[0],b)/this.worldSize,a.a3(d[1],y[1],b)/this.worldSize,a.a3(T,S,b))}pointCoordinate(l,d=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,d)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let d=this.projection.pointCoordinate3D(this,l.x,l.y);if(d)return new a._(d[0],d[1],d[2]);let y=0,b=this.horizonLineFromTop();if(l.y>b)return this.pointCoordinate(l);const T=.02*b,S=l.clone();for(let A=0;A<10&&b-y>T;A++){S.y=a.a3(y,b,.66);const k=this.projection.pointCoordinate3D(this,S.x,S.y);k?(b=S.y,d=k):y=S.y}return d?new a._(d[0],d[1],d[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=a.aV)return!this.isPointAboveHorizon(l);const d=this.pointCoordinate(l);return d.y>=0&&d.y<=1}_coordinatePoint(l,d){const y=d&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,b=[l.x*this.worldSize,l.y*this.worldSize,y+l.toAltitude(),1];return a.aB.transformMat4(b,b,this.pixelMatrix),b[3]>0?new a.P(b[0]/b[3],b[1]/b[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:d}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=this.pointLocation3D(new a.P(d,l)),S=this.pointLocation3D(new a.P(b,l)),A=this.pointLocation3D(new a.P(b,y)),k=this.pointLocation3D(new a.P(d,y));let L=Math.min(T.lng,S.lng,A.lng,k.lng),B=Math.max(T.lng,S.lng,A.lng,k.lng),U=Math.min(T.lat,S.lat,A.lat,k.lat),q=Math.max(T.lat,S.lat,A.lat,k.lat);const H=Math.pow(2,-this.zoom)/16*270,ie=this.projection.name==="globe"?1:4,se=(ae,ce,ye,ve,_e)=>{const Re=(ae+ye)/2,Se=(ce+ve)/2,Ie=new a.P(Re,Se),{lng:ze,lat:Ne}=this.pointLocation3D(Ie),We=Math.max(0,L-ze,U-Ne,ze-B,Ne-q);L=Math.min(L,ze),B=Math.max(B,ze),U=Math.min(U,Ne),q=Math.max(q,Ne),(_e<ie||We>H)&&(se(ae,ce,Re,Se,_e+1),se(Re,Se,ye,ve,_e+1))};if(se(d,l,b,l,1),se(b,l,b,y,1),se(b,y,d,y,1),se(d,y,d,l,1),this.projection.name==="globe"){const[ae,ce]=a.aW(this);ae?(q=90,B=180,L=-180):ce&&(U=-90,B=180,L=-180)}return new a.aj(new a.aJ(L,U),new a.aJ(B,q))}_getBoundsRectangular(l,d){const{top:y,left:b}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,A=new a.P(b,y),k=new a.P(S,y),L=new a.P(S,T),B=new a.P(b,T);let U=this.pointCoordinate(A,l),q=this.pointCoordinate(k,l);const H=this.pointCoordinate(L,d),ie=this.pointCoordinate(B,d),se=(ae,ce)=>(ce.y-ae.y)/(ce.x-ae.x);return U.y>1&&q.y>=0?U=new a._((1-ie.y)/se(ie,U)+ie.x,1):U.y<0&&q.y<=1&&(U=new a._(-ie.y/se(ie,U)+ie.x,0)),q.y>1&&U.y>=0?q=new a._((1-H.y)/se(H,q)+H.x,1):q.y<0&&U.y<=1&&(q=new a._(-H.y/se(H,q)+H.x,0)),new a.aj().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(ie)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=l.visibleDemTiles.reduce((y,b)=>{if(b.dem){const T=b.dem.tree;y.min=Math.min(y.min,T.minimums[0]),y.max=Math.max(y.max,T.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*l.exaggeration(),d.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-d*(1-this._horizonShift);return l?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-a.aT,this.maxLat=a.aT,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.ak(this.minLng)*this.tileSize,this.worldMaxX=a.ak(this.maxLng)*this.tileSize,this.worldMinY=a.al(this.maxLat)*this.tileSize,this.worldMaxY=a.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,d){return this.projection.createTileMatrix(this,d,l)}calculateDistanceTileData(l){const d=l.key,y=this._distanceTileDataCache;if(y[d])return y[d];const b=l.canonical,T=1/this.height,S=this.cameraWorldSize,A=S/this.zoomScale(b.z),k=(b.x+Math.pow(2,b.z)*l.wrap)*A,L=b.y*A,B=this.point;B.x*=S/this.worldSize,B.y*=S/this.worldSize;const U=this.angle,q=Math.sin(-U),H=-Math.cos(-U);return y[d]={bearing:[q,H],center:[(B.x-k)*T,(B.y-L)*T],scale:A/a.a4*T},y[d]}calculateFogTileMatrix(l){const d=l.key,y=this._fogTileMatrixCache;if(y[d])return y[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return a.ae.multiply(b,this.worldToFogMatrix,b),y[d]=new Float32Array(b),y[d]}calculateProjMatrix(l,d=!1,y=!1){const b=l.key;let T;if(T=y?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,T[b])return T[b];const S=this.calculatePosMatrix(l,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,a.ae.multiply(S,A,S),T[b]=new Float32Array(S),T[b]}calculatePixelsToTileUnitsMatrix(l){const d=l.tileID.key,y=this._pixelsToTileUnitsCache;if(y[d])return y[d];const b=a.aX(l,this);return y[d]=b,y[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,d=a.ae.fromScaling([],[l,l,l]);return a.ae.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const d=a.ay(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),b=this._camera.forward(),T=a.ay(1,this._center.lat);y[2]/=T,b[2]/=T,a.$.normalize(b,b);const S=l.raycast(y,b,l.exaggeration());if(S){const A=a.$.scaleAndAdd([],y,b,S),k=new a._(A[0],A[1],a.ay(A[2],a.az(A[1]))),L=(k.z+a.$.length([k.x-y[0],k.y-y[1],k.z-y[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const d=this._elevation,y=a.ay(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(y),T=d.getAtPointOrZero(new a._(...b)),S=this.pixelsPerMeter/this.worldSize*T,A=this._minimumHeightOverTerrain(),k=b[2]-S;if(k<=A)if(k<0||l){const L=this.locationCoordinate(this._center,this._centerAltitude),B=[b[0],b[1],L.z-b[2]],U=a.$.length(B);B[2]-=(A-k)/this._pixelsPerMercatorPixel;const q=a.$.length(B);if(q===0)return;a.$.scale(B,B,U/q*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],L.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const q=this.center;return q.lat=a.au(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(q.lng=a.au(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const d=this._unmodified,{x:y,y:b}=this.point;let T=0,S=y,A=b;const k=this.width/2,L=this.height/2,B=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(b-L<B&&(A=B+L),b+L>U&&(A=U-L),U-B<this.height&&(T=Math.max(T,this.height/(U-B)),A=(U+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,ie=this.worldSize/2-(q+H)/2;S=(y+ie+this.worldSize)%this.worldSize-ie,S-k<q&&(S=q+k),S+k>H&&(S=H-k),H-q<this.width&&(T=Math.max(T,this.width/(H-q)),S=(H+q)/2)}S===y&&A===b||(this.center=this.unproject(new a.P(S,A))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.ay(1,this.center.lat)/a.ay(1,a.b5));const b=a.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?y:1,S=this._camera.getWorldToCamera(this.worldSize,T);let A;const k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-l.x/this.width,k[9]=2*l.y/this.height,this.isOrthographic){let Ne=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),We=Ne*this.aspect,Fe=-We,Pe=-Ne;We-=l.x,Fe-=l.x,Ne+=l.y,Pe+=l.y,A=this._camera.getCameraToClipOrthographic(Fe,We,Pe,Ne,this._nearZ,this._farZ),((et,Qe,Ve,xt)=>{for(let pt=0;pt<16;pt++)et[pt]=th(Qe[pt],Ve[pt],xt)})(A,A,k,Ha(this.pitch>=15?1:this.pitch/15))}else A=k;const L=a.ae.mul([],k,S);let B=a.ae.mul([],A,S);if(this.projection.isReprojectedInTileSpace){const Ne=this.locationCoordinate(this.center),We=a.ae.identity([]);a.ae.translate(We,We,[Ne.x*this.worldSize,Ne.y*this.worldSize,0]),a.ae.multiply(We,We,a.aZ(this)),a.ae.translate(We,We,[-Ne.x*this.worldSize,-Ne.y*this.worldSize,0]),a.ae.multiply(B,B,We),a.ae.multiply(L,L,We),this.inverseAdjustmentMatrix=a.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.ae.scale([],B,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=B,this.invProjMatrix=a.ae.invert(new Float64Array(16),this.projMatrix),d){const Ne=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ne[8]=2*-l.x/this.width,Ne[9]=2*l.y/this.height,this.expandedFarZProjMatrix=a.ae.mul([],Ne,S)}else this.expandedFarZProjMatrix=this.projMatrix;const U=a.ae.invert([],A);this.frustumCorners=a.a$.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const q=new Float32Array(16);a.ae.identity(q),a.ae.scale(q,q,[1,-1,1]),a.ae.rotateX(q,q,this._pitch),a.ae.rotateZ(q,q,this.angle);const H=a.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.ae.clone(H);const ie=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-l.x/this.width,H[9]=2*(l.y+ie)/this.height,this.skyboxMatrix=a.ae.multiply(q,H,q);const se=this.point,ae=se.x,ce=se.y,ye=this.width%2/2,ve=this.height%2/2,_e=Math.cos(this.angle),Re=Math.sin(this.angle),Se=ae-Math.round(ae)+_e*ye+Re*ve,Ie=ce-Math.round(ce)+_e*ve+Re*ye,ze=new Float64Array(B);if(a.ae.translate(ze,ze,[Se>.5?Se-1:Se,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=ze,B=a.ae.create(),a.ae.scale(B,B,[this.width/2,-this.height/2,1]),a.ae.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=a.ae.create(),a.ae.scale(B,B,[1,-1,1]),a.ae.translate(B,B,[-1,-1,0]),a.ae.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=a.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},B=a.ae.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.b0(this);const Ne=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.$.transformMat4(Ne,Ne,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,y=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,T=[l,l,d];a.$.scale(T,T,b),a.$.scale(y,y,-1),a.$.multiply(y,y,T);const S=a.ae.create();a.ae.translate(S,S,y),a.ae.scale(S,S,T),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,d,b)}_computeCameraPosition(l){const d=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),b=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-l/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-y[0]*T,b.y/this.worldSize-y[1]*T,l/this.worldSize*this._centerAltitude-y[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],b=l[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(T=Math.min((d-y)/b,1)),this._camera.position=a.$.scaleAndAdd([],this._camera.position,l,T),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,d=this._camera.forward(),{pitch:y,bearing:b}=this._camera.getPitchBearing(),T=a.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.ac(this._maxPitch)),A=Math.max((l[2]-T)/Math.cos(y),S),k=this._zoomFromMercatorZ(A);a.$.scaleAndAdd(l,l,d,A),this._pitch=a.au(y,a.ac(this.minPitch),a.ac(this.maxPitch)),this.angle=a.av(b,-Math.PI,Math.PI),this._setZoom(a.au(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a._(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let d=0,y=a.aV,b=0,T=1/0;for(;y-d>1e-6&&y>d;){const S=d+.5*(y-d),A=this.tileSize*Math.pow(2,S),k=this.getCameraToCenterDistance(this.projection,S,A),L=this.scaleZoom(k/(l*this.tileSize)),B=Math.abs(S-L);B<T&&(T=B,b=S),S<L?d=S:y=S}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,d){const y=Math.min(l.x,d.x),b=Math.max(l.x,d.x),T=Math.min(l.y,d.y),S=Math.max(l.y,d.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new a.P(y,T),new a.P(b,S),new a.P(y,S),new a.P(b,T)],k=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const B of A){const U=this.pointRayIntersection(B);if(U.t<0)return!0;const q=this.rayIntersectionCoordinate(U);if(q.x<k||q.y<0||q.x>L||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(l,d){const y=a.$.length(a.$.sub([],this._camera.position,l)),b=this._zoomFromMercatorZ(y)+d;return y-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([d,y,b],T){const S=[d,y,b,1];a.aB.transformMat4(S,S,T);const A=S[3]=Math.max(S[3],1e-6);return S[0]/=A,S[1]/=A,S[2]/=A,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,l))}}getCameraToCenterDistance(l,d=this.zoom,y=this.worldSize){const b=a.aY(l,d,this.width,this.height,1024),T=l.pixelSpaceConversion(this.center.lat,y,b);let S=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(S=th(1,S,Ha(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.ae.multiply(l,l,this.globeMatrix),l}getFrustum(l){return a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}const Cs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},zs=(g,l)=>{if(l>0&&g.terrain&&a.w("Cutoff is currently disabled on terrain"),l<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=g.transform,y=Math.max(Math.abs(d._zoom-(g.minCutoffZoom-1)),1),b=d.isLODDisabled(!1)?a.a0(60,45,d.pitch):a.a0(30,15,d.pitch),T=d._farZ-d._nearZ,S=l*d.height,A=((1-(k=b))*d.cameraToCenterDistance+k*(d._farZ+S))*y;var k;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(A-d._nearZ)/T,(A-S-d._nearZ)/T]}}},fs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class bi{constructor(l,d){this.aabb=l,this.lastCascade=d}}class ra{add(l,d){const y=this.receivers[l.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],d.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],d.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],d.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],d.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],d.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],d.max[2])):this.receivers[l.key]=new bi(d,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,d,y){const b=a.b8.fromPoints(l.points);let T=0;for(const S in this.receivers){const A=this.receivers[S];if(!A||!b.intersectsAabb(A.aabb))continue;A.aabb.min=b.closestPoint(A.aabb.min),A.aabb.max=b.closestPoint(A.aabb.max);const k=A.aabb.getCorners();for(let L=0;L<y.length;L++){let B=!0;for(const U of k){const q=[U[0]*d,U[1]*d,U[2]];if(a.$.transformMat4(q,q,y[L].matrix),q[0]<-1||q[0]>1||q[1]<-1||q[1]>1){B=!1;break}}if(A.lastCascade=L,T=Math.max(T,L),B)break}}return T+1}}class fg{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ra,this._depthMode=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(fs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(fs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),l.tp.registerParameter(fs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,d){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const b=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||b<=0||(this._shadowLayerCount=y.style.order.reduce((ie,se)=>{const ae=y.style._mergedLayers[se];return ie+(ae.hasShadowPass()&&!ae.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=y.context,S=fs.shadowMapResolution,A=fs.shadowMapResolution;if(this._cascades.length===0||fs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ie=0;ie<fs.cascadeCount;++ie){const se=y._shadowMapDebug,ae=T.gl,ce=T.createFramebuffer(S,A,se,"texture"),ye=new a.T(T,{width:S,height:A,data:null},ae.DEPTH_COMPONENT);if(ce.depthAttachment.set(ye.texture),se){const ve=new a.T(T,{width:S,height:A,data:null},ae.RGBA);ce.colorAttachment.set(ve.texture)}this._cascades.push({framebuffer:ce,texture:ye,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.aM,scale:0})}}this.shadowDirection=Fo(d);let k=0;if(l.elevation){const ie=l.elevation,se=[1e4,-1e4];ie.visibleDemTiles.filter(ae=>ae.dem).forEach(ae=>{const ce=ae.dem.tree;se[0]=Math.min(se[0],ce.minimums[0]),se[1]=Math.max(se[1],ce.maximums[0])}),se[0]!==1e4&&(k=(se[1]-se[0])*ie.exaggeration())}const L=1.5*l.cameraToCenterDistance,B=3*L,U=new Float64Array(16);for(let ie=0;ie<this._cascades.length;++ie){const se=this._cascades[ie];let ae=l.height/50,ce=1;fs.cascadeCount===1?ce=B:ie===0?ce=L:(ae=L,ce=B);const[ye,ve]=pd(l,this.shadowDirection,ae,ce,fs.shadowMapResolution,k);se.scale=l.scale,se.matrix=ye,se.boundingSphereRadius=ve,a.ae.invert(U,se.matrix),se.frustum=a.aM.fromInvProjectionMatrix(U,1,0,!0),se.far=ce}const q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[q].far,this._cascades[q].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/fs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=fs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Cs.ShadowMap0,this._uniformValues.u_shadowmap_1=Cs.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const H=y.transform.elevation;for(const ie of this._groundShadowTiles){let se={min:0,max:0};if(H){const ae=H.getMinMaxForTile(ie);ae&&(se=ae)}this.addShadowReceiver(ie.toUnwrapped(),se.min,se.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,d){if(!this.enabled)return;const y=this.painter,b=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),b.viewport.set([0,0,fs.shadowMapResolution,fs.shadowMapResolution]);for(let T=0;T<this._numCascadesToRender;++T){y.currentShadowCascade=T,b.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),b.clear({color:a.C.white,depth:1});for(const S of l.order){const A=l._mergedLayers[S];if(!A.hasShadowPass()||A.isHidden(y.transform.zoom))continue;const k=l.getLayerSourceCache(A),L=k?d[k.id]:void 0;(A.type==="model"||L&&L.length)&&y.renderLayer(y,k,A,L)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const l=this.painter,d=l.style,y=l.context,b=d.directionalLight,T=d.ambientLight;if(!b||!T)return;const S=[],A=zs(l,l.longestCutoffRange);A.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const k=tu(d,b,T),L=new a.af(y.gl.LEQUAL,a.af.ReadOnly,l.depthRangeFor3D);for(const B of this._groundShadowTiles){const U=B.toUnwrapped(),q=l.isTileAffectedByFog(B),H=l.getOrCreateProgram("groundShadow",{defines:S,overrideFog:q});this.setupShadows(U,H),l.uploadCommonUniforms(y,H,U,null,A);const ie={u_matrix:l.transform.calculateProjMatrix(U),u_ground_shadow_factor:k};H.draw(l,y.gl.TRIANGLES,L,a.ah.disabled,a.a.multiply,a.ag.disabled,ie,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?a.a.unblended:a.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const d=this.painter.transform,y=d.calculatePosMatrix(l,d.worldSize);return a.ae.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(l){return a.ae.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,d,y,b=0){if(!this.enabled)return;const T=this.painter.transform,S=this.painter.context,A=S.gl,k=this._uniformValues,L=new Float64Array(16),B=T.calculatePosMatrix(l,T.worldSize);for(let U=0;U<this._cascades.length;U++)a.ae.multiply(L,this._cascades[U].matrix,B),k[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),S.activeTexture.set(A.TEXTURE0+Cs.ShadowMap0+U),this._cascades[U].texture.bind(A.NEAREST,A.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const U=a.b7(l.canonical),q=2/T.tileSize*a.a4/fs.shadowMapResolution,H=q*this._cascades[0].boundingSphereRadius,ie=q*this._cascades[this._cascades.length-1].boundingSphereRadius,se=(y==="vector-tile"?1:3)/Math.pow(2,b-l.canonical.z-(1-T.zoom+Math.floor(T.zoom)));k.u_shadow_normal_offset=[U,H*se,ie*se],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(S,k)}setupShadowsFromMatrix(l,d,y=!1){if(!this.enabled)return;const b=this.painter.context,T=b.gl,S=this._uniformValues,A=new Float64Array(16);for(let k=0;k<fs.cascadeCount;k++)a.ae.multiply(A,this._cascades[k].matrix,l),S[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),b.activeTexture.set(T.TEXTURE0+Cs.ShadowMap0+k),this._cascades[k].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=y,y){const k=fs.normalOffset;S.u_shadow_normal_offset=[1,k,k],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(b,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,d,y,b){if(b[2]>=0)return{};const T=function(k,L,B){const U=B/(1<<k.canonical.z);return new a.b8([k.canonical.x*U+k.wrap*B,k.canonical.y*U+k.wrap*B,0],[(k.canonical.x+1)*U+k.wrap*B,(k.canonical.y+1)*U+k.wrap*B,L])}(l,d,y).getCorners(),S=d/-b[2];b[0]<0?(a.$.add(T[0],T[0],[b[0]*S,0,0]),a.$.add(T[3],T[3],[b[0]*S,0,0])):b[0]>0&&(a.$.add(T[1],T[1],[b[0]*S,0,0]),a.$.add(T[2],T[2],[b[0]*S,0,0])),b[1]<0?(a.$.add(T[0],T[0],[0,b[1]*S,0]),a.$.add(T[1],T[1],[0,b[1]*S,0])):b[1]>0&&(a.$.add(T[2],T[2],[0,b[1]*S,0]),a.$.add(T[3],T[3],[0,b[1]*S,0]));const A={};return A.vertices=T,A.planes=[cc(T[1],T[0],T[4]),cc(T[2],T[1],T[5]),cc(T[3],T[2],T[6]),cc(T[0],T[3],T[7])],A}addShadowReceiver(l,d,y){this._receivers.add(l,a.b8.fromTileIdAndHeight(l,d,y))}getMaxCascadeForTile(l){const d=this._receivers.get(l);return d&&d.lastCascade?d.lastCascade:0}}function cc(g,l,d){const y=a.$.sub([],d,l),b=a.$.sub([],g,l),T=a.$.cross([],y,b),S=a.$.length(T);return S===0?[0,0,1,0]:(a.$.scale(T,T,1/S),[T[0],T[1],T[2],-a.$.dot(T,l)])}function Fo(g){const l=g.properties.get("direction"),d=a.ad(l.x,l.y,l.z);d[2]=a.au(d[2],0,75);const y=a.b9([d[0],d[1],d[2]]);return a.$.fromValues(y.x,y.y,y.z)}function tu(g,l,d){const y=l.properties.get("color"),b=l.properties.get("intensity"),T=l.properties.get("direction"),S=[T.x,T.y,T.z],A=d.properties.get("color"),k=d.properties.get("intensity"),L=Math.max(a.$.dot([0,0,1],S),0),B=[0,0,0];a.$.scale(B,A.toRenderColor(g.getLut(l.scope)).toArray01Linear().slice(0,3),k);const U=[0,0,0];return a.$.scale(U,y.toRenderColor(g.getLut(d.scope)).toArray01Linear().slice(0,3),L*b),a.ba([B[0]>0?B[0]/(B[0]+U[0]):0,B[1]>0?B[1]/(B[1]+U[1]):0,B[2]>0?B[2]/(B[2]+U[2]):0])}function pd(g,l,d,y,b,T){const S=g.zoom,A=g.scale,k=g.worldSize,L=1/k,B=g.aspect,U=Math.sqrt(1+B*B)*Math.tan(.5*g.fovX),q=U*U,H=y-d,ie=y+d;let se,ae;q>H/ie?(se=y,ae=y*U):(se=.5*ie*(1+q),ae=.5*Math.sqrt(H*H+2*(y*y+d*d)*q+ie*ie*q*q));const ce=g.projection.pixelsPerMeter(g.center.lat,k),ye=g._camera.getCameraToWorldMercator(),ve=[0,0,-se*L];a.$.transformMat4(ve,ve,ye);let _e=ae*L;const Re=g._edgeInsets;if(!(Re.left===0&&Re.top===0&&Re.right===0&&Re.bottom===0||Re.left===Re.right&&Re.top===Re.bottom)){const mt=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?ce:1),_t=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,d,y);_t[8]=2*-g.centerOffset.x/g.width,_t[9]=2*g.centerOffset.y/g.height;const Bt=new Float64Array(16);a.ae.mul(Bt,_t,mt);const Vt=new Float64Array(16);a.ae.invert(Vt,Bt);const rn=a.aM.fromInvProjectionMatrix(Vt,k,S,!0);for(const Ht of rn.points){const vn=((Se=Ht)[0]/=A,Se[1]/=A,Se[2]=a.ay(Se[2],g._center.lat),Se);_e=Math.max(_e,a.$.len(a.$.subtract([],ve,vn)))}}var Se;_e*=b/(b-1);const Ie=Math.acos(l[2]),ze=Math.atan2(-l[0],-l[1]),Ne=new ai;Ne.position=ve,Ne.setPitchBearing(Ie,ze);const We=Ne.getWorldToCamera(k,ce),Fe=_e*k,Pe=Math.min(g._mercatorZfromZoom(17)*k*-2,-2*Fe),et=Ne.getCameraToClipOrthographic(-Fe,Fe,-Fe,Fe,Pe,(Fe+T*ce)/l[2]),Qe=new Float64Array(16);a.ae.multiply(Qe,et,We);const Ve=a.$.fromValues(Math.floor(1e6*ve[0])/1e6*k,Math.floor(1e6*ve[1])/1e6*k,0),xt=.5*b,pt=[0,0,0];a.$.transformMat4(pt,Ve,Qe),a.$.scale(pt,pt,xt);const He=[Math.floor(pt[0]),Math.floor(pt[1]),Math.floor(pt[2])],it=[0,0,0];a.$.sub(it,pt,He),a.$.scale(it,it,-1/xt);const Be=new Float64Array(16);return a.ae.identity(Be),a.ae.translate(Be,Be,it),a.ae.multiply(Qe,Be,Qe),[Qe,Fe]}function nu(g,l){return g!=null&&l!=null&&!(!g.hasData()||!l.hasData())&&g.demTexture!=null&&l.demTexture!=null&&g.tileID.key!==l.tileID.key}const Za=new class{constructor(){this.operations={}}newMorphing(g,l,d,y,b){if(g in this.operations){const T=this.operations[g];T.to.tileID.key!==d.tileID.key&&(T.queued=d)}else this.operations[g]={startTime:y,phase:0,duration:b,from:l,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const d=this.operations[l];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},El={0:null,1:"TERRAIN_VERTEX_MORPHING"};function os(g,l,d){if(l===0)return 0;const y=l<1&&d===514?.25/l:1;return 6*Math.pow(1.5,22-g)*Math.max(l,1)*y}function ru(g,l){const d=1<<g.z;return!l&&(g.x===0||g.x===d-1)||g.y===0||g.y===d-1}const iu=g=>({u_matrix:g});function Xa(g,l,d,y,b){if(b>0){const T=a.e.now(),S=(T-g.timeAdded)/b,A=l?(T-l.timeAdded)/b:-1,k=d.getSource(),L=y.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),B=!l||Math.abs(l.tileID.overscaledZ-L)>Math.abs(g.tileID.overscaledZ-L),U=B&&g.refreshedUponExpiration?1:a.au(B?S:1-A,0,1);return g.refreshedUponExpiration&&S>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class R extends So{constructor(l,d,y,b){super(l,d,y,b),this.type="raster-array",this.maxzoom=22,this._options=a.Q({type:"raster-array"},d)}triggerRepaint(l){const d=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);d&&d.enabled&&y&&d._clearRenderCacheForTile(y.id,l.tileID),this.map.triggerRepaint()}loadTile(l,d){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(y,a.R.Tile);l.requestParams=b,l.actor||(l.actor=this.dispatcher.getActor()),l.request=l.fetchHeader(void 0,(T,S,A,k)=>{if(delete l.request,l.aborted)return l.state="unloaded",d(null);if(T)return T.code===20?void 0:(l.state="errored",d(T));this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:A,expires:k}),l.state="empty",d(null)})}unloadTile(l,d){const y=l.texture;y&&y instanceof a.T?(l.destroy(!0),this.map.painter.saveTileTexture(y)):(l.destroy(),l.flushQueues(),l._isHeaderLoaded=!1,delete l._mrt,delete l.textureDescriptor),l.fbo&&(l.fbo.destroy(),delete l.fbo),delete l.request,delete l.requestParams,delete l.neighboringTiles,l.state="unloaded"}prepareTile(l,d,y){l._isHeaderLoaded&&(l.state!=="empty"&&(l.state="reloading"),l.fetchBand(d,y,(b,T)=>{if(b)return l.state="errored",this.fire(new a.f(b)),void this.triggerRepaint(l);T&&(l.setTexture(T,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;const d=this.rasterLayers.find(({id:T})=>T===l),y=d&&d.fields,b=y&&y.bands&&y.bands;return b?b[0]:0}getTextureDescriptor(l,d,y){if(!l)return;const b=d.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let T=null;d instanceof a.bm?T=d.paint.get("raster-array-band"):d instanceof a.bn&&(T=d.paint.get("raster-particle-array-band"));const S=T||this.getInitialBand(b);if(S!=null)if(l.textureDescriptor){if(!l.updateNeeded(b,S)||y)return Object.assign({},l.textureDescriptor,{texture:l.texture})}else this.prepareTile(l,b,S)}}const K={vector:dg,raster:So,"raster-dem":class extends So{constructor(g,l,d,y){super(g,l,d,y),this.type="raster-dem",this.maxzoom=22,this._options=a.Q({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(b,T){b&&(g.state="errored",l(b)),T&&(g.dem=T,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=a.i(this.map._requestManager.transformRequest(d,a.R.Tile),(function(b,T,S,A){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(b)g.state="errored",l(b);else if(T){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:S,expires:A});const k=ImageBitmap&&T instanceof ImageBitmap&&a.bk(),L=1-(T.width-a.bl(T.width))/2;L<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const B=k?T:a.e.getImageData(T,L),U={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:L};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",U,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const l=g.canonical,d=Math.pow(2,l.z),y=(l.x-1+d)%d,b=l.x===0?g.wrap-1:g.wrap,T=(l.x+1+d)%d,S=l.x+1===d?g.wrap+1:g.wrap,A={};return A[new a.aQ(g.overscaledZ,b,l.z,y,l.y).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,S,l.z,T,l.y).key]={backfilled:!1},l.y>0&&(A[new a.aQ(g.overscaledZ,b,l.z,y,l.y-1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,S,l.z,T,l.y-1).key]={backfilled:!1}),l.y+1<d&&(A[new a.aQ(g.overscaledZ,b,l.z,y,l.y+1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,S,l.z,T,l.y+1).key]={backfilled:!1}),A}},"raster-array":R,geojson:class extends a.E{constructor(g,l,d,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(y),this._data=l.data,this._options=a.Q({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.minzoom!==void 0&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const b=a.a4/this.tileSize;this.workerOptions=a.Q({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*b,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*b,extent:a.a4,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:a.a4,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*b,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new a.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new a.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const l=new Map;for(const d of this._data.features)l.set(d.id,d);for(const d of g.features)l.set(d.id,d);this._data.features=[...l.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterLeaves(g,l,d,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:l,offset:d},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.g("dataloading",{dataType:"source"})),this._loaded=!1;const l=a.Q({append:g},this.workerOptions);l.scope=this.scope;const d=this._data;typeof d=="string"?(l.request=this.map._requestManager.transformRequest(a.e.resolveURL(d),a.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(d),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(y,b)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new a.f(y));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(T.resourceTiming=b.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new a.g("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,b=this._partialReload,T={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y?{image:y.image.clone()}:null,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:b};g.request=this.actor.send(d,T,(S,A)=>b&&!A?(g.state="loaded",l(null)):(delete g.request,g.destroy(),g.aborted?l(null):S?l(S):(g.loadVectorData(A,this.map.painter,d==="reloadTile"),l(null))),void 0,d==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,l){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.bo{constructor(g,l,d,y){super(g,l,d,y),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,a.R.Source).url);a.bp(this.urls,(l,d)=>{this._loaded=!0,l?this.fire(new a.f(l)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new a.f(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(g,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.bo,model:class extends a.E{constructor(g,l,d,y){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const g=[];for(const l in this._options.models){const d=this._options.models[l],y=a.l(this.map._requestManager.transformRequest(d.uri,a.R.Model).url).then(b=>{if(!b)return;const T=a.c(b),S=new a.M(l,d.position,d.orientation,T);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(b=>{this.fire(new a.f(new Error(`Could not load model ${l} from ${d.uri}: ${b.message}`)))});g.push(y)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new a.f(new Error(`Could not load models: ${l.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,l){}serialize(){return{type:"model"}}},"batched-model":class extends a.E{constructor(g,l,d,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=tp(this._options,this.map._requestManager,l,d,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.f(y))):b&&(a.Q(this,b),b.bounds&&(this.tileBounds=new No(b.bounds,this.minzoom,this.maxzoom)),a.ao(b.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(d,a.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=l;else{if(g.buckets){const T=Object.values(g.buckets);for(const S of T)S.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,b.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,b.bind(this),void 0,!0);function b(T,S){return g.aborted?l(null):T&&T.status!==404?l(T):(S&&(S.resourceTiming&&(g.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(S),g.buckets={...g.buckets,...S.buckets},S.featureIndex&&(g.latestFeatureIndex=S.featureIndex)),g.state="loaded",void l(null))}}serialize(){return a.Q({},this._options)}},canvas:class extends a.bo{constructor(g,l,d,y){super(g,l,d,y),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new a.f(new a.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new a.f(new a.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new a.f(new a.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof a.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends a.E{constructor(g,l,d,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=l,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new No(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),a.Q(this,a.ai(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:d,z:y}=g.canonical;return this._implementation.hasTile({x:l,y:d,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:d,y,z:b}=g.tileID.canonical,T=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y,z:b},{signal:T.signal})).then((function(S){return delete g.request,g.aborted?(g.state="unloaded",l(null)):S===void 0?(g.state="errored",l(null)):S===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement}(S)?(this.loadTileData(g,S),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(g.state="errored",l(S))}),g.request.cancel=()=>T.abort()}loadTileData(g,l){g.setTexture(l,this.map.painter)}unloadTile(g,l){if(g.texture&&g.texture instanceof a.T?(g.destroy(!0),g.texture&&g.texture instanceof a.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:d,y,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:d,y,z:b})}l&&l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=a.am(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}}},ue=function(g,l,d,y){const b=new K[l.type](g,l,d,y);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return a.br(["load","abort","unload","serialize","prepare"],b),b};class Me extends a.bx{constructor(l){const d={type:"raster-dem",maxzoom:l.transform.maxZoom},y=new a.by(a.bz(),null),b=ue("mock-dem",d,y,l.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,d){l.state="loaded",d(null)}}class dt extends a.bx{constructor(l){const d=ue("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new a.by(a.bz(),null),l.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,d,y){if(l.freezeTileCoverage)return;this.transform=l;const b=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,S)=>{if(T[S.key]="",!this._tiles[S.key]){const A=new a.bA(S,this._source.tileSize*S.overscaleFactor(),l.tileZoom);A.state="loaded",this._tiles[S.key]=A}return T},{});for(const T in this._tiles)T in b||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(l){const d=this.proxyCachedFBO[l];if(d!==void 0){const y=Object.values(d);this.renderCachePool.push(...y),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class It extends a.aQ{constructor(l,d,y){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=d,this.projMatrix=y}}class en extends a.bs{constructor(l,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,b,T]=function(k){const L=new a.bv,B=new a.bw,U=131;L.reserve(17161),B.reserve(33800);const q=a.a4/128,H=a.a4+q/2,ie=H+q;for(let ae=-q;ae<ie;ae+=q)for(let ce=-q;ce<ie;ce+=q){const ye=ce<0||ce>H||ae<0||ae>H?24575:0,ve=a.au(Math.round(ce),0,a.a4),_e=a.au(Math.round(ae),0,a.a4);L.emplaceBack(ve+ye,_e)}const se=(ae,ce)=>{const ye=ce*U+ae;B.emplaceBack(ye+1,ye,ye+U),B.emplaceBack(ye+U,ye+U+1,ye+1)};for(let ae=1;ae<129;ae++)for(let ce=1;ce<129;ce++)se(ce,ae);return[0,129].forEach(ae=>{for(let ce=0;ce<130;ce++)se(ce,ae),se(ae,ce)}),[L,B,32768]}(),S=l.context;this.gridBuffer=S.createVertexBuffer(y,a.bt.members),this.gridIndexBuffer=S.createIndexBuffer(b),this.gridSegments=a.b.simpleSegment(0,0,y.length,b.length),this.gridNoSkirtSegments=a.b.simpleSegment(0,0,y.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new dt(d.map),this.orthoMatrix=a.ae.create(),a.ae.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.a4,0,a.a4,0,1);const A=S.gl;this._overlapStencilMode=new a.ah({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Me(d.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,d,y){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const b=l.terrain.properties,T=l.terrain.drapeRenderMode===0,S=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.e.now();const A=l.terrain&&l.terrain.scope,k=b.get("source"),L=T?this._mockSourceCache:l.getSourceCache(k,A);if(!L)return void a.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=L,this._exaggeration=S?this.calculateExaggeration(d):b.get("exaggeration"),!d.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(d,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),d.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(l){const d=this._previousCameraAltitude,y=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=y;const b=d!=null?y-d:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const T=l.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(T);let A=T-this._previousZoom;const k=this._previousUpdateTimestamp;let L=T;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(T-L)>.5&&(A=.5*(T-L+A)),A*b<0&&(L+=A)),this._evaluationZoom=L;const B=S.getExaggeration(L),U=B===S.getExaggeration(Math.max(0,L-.1));if(U&&Math.abs(B-this._exaggeration)<.01)return B;let q=Math.min(.1,.00375*(this._updateTimestamp-k));return(U||B<.1||Math.abs(A)<1e-4)&&(q=Math.min(.2,4*q)),a.a3(this._exaggeration,B,q)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(a._.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(k=>{const L=d.getTileByID(k).tileID;return L.projMatrix=y.calculateProjMatrix(L.toUnwrapped()),L});(function(k,L){const B=L.transform.pointCoordinate(L.transform.getCameraPoint()),U=new a.P(B.x,B.y);k.sort((q,H)=>{if(H.overscaledZ-q.overscaledZ)return H.overscaledZ-q.overscaledZ;const ie=new a.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),se=new a.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),ae=U.mult(1<<q.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(ie)-ae.distSqr(se)})})(b,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},b.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const k in S){const L=S[k];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,l[k],T),L.usedForTerrain))continue;const B=l[k];L.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[d.id]=b.map(k=>new It(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const L=this.terrainTileForTile[k.key];if(!L)continue;const B=L.tileID.key;B in A||(this._visibleDemTiles.push(L),A[B]=B)}}_assignTerrainTiles(l){this._initializing||l.forEach(d=>{if(this.terrainTileForTile[d.key])return;const y=this._findTileCoveringTileID(d,this.sourceCache);y&&(this.terrainTileForTile[d.key]=y)})}_prepareDEMTextures(){const l=this.painter.context,d=l.gl;for(const y in this.terrainTileForTile){const b=this.terrainTileForTile[y],T=b.dem;!T||b.demTexture&&!b.needsDEMTextureUpload||(l.activeTexture.set(d.TEXTURE1),hg(this.painter,b,T))}}_prepareDemTileUniforms(l,d,y,b){if(!d||d.demTexture==null)return!1;const T=l.tileID.canonical,S=Math.pow(2,d.tileID.canonical.z-T.z),A=b||"";return y[`u_dem_tl${A}`]=[T.x*S%1,T.y*S%1],y[`u_dem_scale${A}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0;const d=this._visibleDemTiles.reduce((y,b)=>{if(!b.dem)return y;const T=b.dem.tree.minimums[0];return T>0&&l++,y+T},0);return l?d/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,d=l.gl;l.activeTexture.set(d.TEXTURE2);const y=this._getLoadedAreaMinimum(),[b,T]=(()=>{const A=new a.bB({width:1,height:1},new Float32Array([y]));return[d.R32F,A]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(T,{premultiply:!1}):S=this._emptyDEMTexture=new a.T(l,T,b,{premultiply:!1}),S}setupElevationDraw(l,d,y){const b=this.painter.context,T=b.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let A=null,k=null,L=1;if(y&&y.morphing&&this._useVertexMorphing){const H=y.morphing.srcDemTile,ie=y.morphing.dstDemTile;L=y.morphing.phase,H&&ie&&(this._prepareDemTileUniforms(l,H,S,"_prev")&&(k=H),this._prepareDemTileUniforms(l,ie,S)&&(A=ie))}const B=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let U=null;var q;if(this.enabled?k&&A?(U=A.demTexture,b.activeTexture.set(T.TEXTURE4),k.demTexture.bind(B(k),T.CLAMP_TO_EDGE),S.u_dem_lerp=L):(A=this.terrainTileForTile[l.tileID.key],U=this._prepareDemTileUniforms(l,A,S)?A.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,b.activeTexture.set(T.TEXTURE2),U&&(S.u_dem_size=(q=U).size[0]===1?1:q.size[0]-2,U.bind(B(A),T.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,d,S),y&&y.useMeterToDem&&A){const H=(1<<A.tileID.canonical.z)*a.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=H}if(y&&y.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),d.setTerrainUniformValues(b,S),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,l.tileID.canonical,y&&y.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,H)}}globeUniformValues(l,d,y){const b=l.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,a.a4,0),u_tile_br_up:b.upVector(d,a.a4,a.a4),u_tile_bl_up:b.upVector(d,0,a.a4),u_tile_up_scale:y?a.bu(1):b.upVectorScale(d,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const d=this.painter,y=this.painter.context;l.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,T,S,A,k){if(b.transform.projection.name==="globe")(function(L,B,U,q,H){const ie=L.context,se=ie.gl;let ae,ce;const ye=L.transform,ve=a.bc(L,ie,ye),_e=(et,Qe)=>{if(ce===Qe)return;const Ve=[El[Qe],"PROJECTION_GLOBE_VIEW"];ve&&Ve.push("CUSTOM_ANTIALIASING");const xt=L.isTileAffectedByFog(et);ae=L.getOrCreateProgram("globeRaster",{defines:Ve,overrideFog:xt}),ce=Qe},Re=L.colorModeForRenderPass(),Se=new a.af(se.LEQUAL,a.af.ReadWrite,L.depthRangeFor3D);Za.update(H);const Ie=a.bd(ye),ze=[a.ak(ye.center.lng),a.al(ye.center.lat)],Ne=L.globeSharedBuffers,We=[ye.width*a.e.devicePixelRatio,ye.height*a.e.devicePixelRatio],Fe=Float32Array.from(ye.globeMatrix),Pe={useDenormalizedUpVectorScale:!0};{const et=L.transform,Qe=os(et.zoom,B.exaggeration(),B.sourceCache._source.tileSize);ce=-1;const Ve=se.TRIANGLES;for(const xt of q){const pt=U.getTile(xt),He=a.ah.disabled,it=B.prevTerrainTileForTile[xt.key],Be=B.terrainTileForTile[xt.key];nu(it,Be)&&Za.newMorphing(xt.key,it,Be,H,250),ie.activeTexture.set(se.TEXTURE0),pt.texture&&pt.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);const mt=Za.getMorphValuesForProxy(xt.key),_t=mt?1:0;mt&&a.q(Pe,{morphing:{srcDemTile:mt.from,dstDemTile:mt.to,phase:a.bb(mt.phase)}});const Bt=a.be(xt.canonical),Vt=a.bf(Bt.getCenter().lat),rn=a.bg(xt.canonical,Bt,Vt,et.worldSize/et._pixelsPerMercatorPixel),Ht=a.bh(a.bi(xt.canonical)),vn=Qc(et.expandedFarZProjMatrix,Fe,Ie,Ht,a.a2(et.zoom),ze,et.frustumCorners.TL,et.frustumCorners.TR,et.frustumCorners.BR,et.frustumCorners.BL,et.globeCenterInViewSpace,et.globeRadius,We,Qe,et._farZ,rn);if(_e(xt,_t),ae&&(B.setupElevationDraw(pt,ae,Pe),L.uploadCommonUniforms(ie,ae,xt.toUnwrapped()),Ne)){const[Fn,bn,$n]=Ne.getGridBuffers(Vt,Qe!==0);ae.draw(L,Ve,Se,He,Re,a.ag.backCCW,vn,"globe_raster",Fn,bn,$n)}}}if(Ne&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ve&&et.push("CUSTOM_ANTIALIASING"),ae=L.getOrCreateProgram("globeRaster",{defines:et});for(const Qe of q){const{x:Ve,y:xt,z:pt}=Qe.canonical,He=xt===0,it=xt===(1<<pt)-1,[Be,mt,_t,Bt]=Ne.getPoleBuffers(pt,!1);if(Bt&&(He||it)){const Vt=U.getTile(Qe);ie.activeTexture.set(se.TEXTURE0),Vt.texture&&Vt.texture.bind(se.LINEAR,se.CLAMP_TO_EDGE);let rn=a.bj(pt,Ve,ye);const Ht=a.bh(a.bi(Qe.canonical)),vn=(Fn,bn)=>Fn.draw(L,se.TRIANGLES,Se,a.ah.disabled,Re,a.ag.disabled,Qc(ye.expandedFarZProjMatrix,rn,rn,Ht,0,ze,ye.frustumCorners.TL,ye.frustumCorners.TR,ye.frustumCorners.BR,ye.frustumCorners.BL,ye.globeCenterInViewSpace,ye.globeRadius,We,0,ye._farZ),"globe_pole_raster",bn,_t,Bt);B.setupElevationDraw(Vt,ae,Pe),L.uploadCommonUniforms(ie,ae,Qe.toUnwrapped()),He&&L.renderDefaultNorthPole&&vn(ae,Be),it&&L.renderDefaultSouthPole&&(rn=a.ae.scale(a.ae.create(),rn,[1,-1,1]),vn(ae,mt))}}}})(b,T,S,A,k);else{const L=b.context,B=L.gl;let U,q;const H=b.shadowRenderer,ie=zs(b,b.longestCutoffRange),se=Re=>{if(q===Re)return;const Se=[];Se.push(El[Re]),ie.shouldRenderCutoff&&Se.push("RENDER_CUTOFF"),U=b.getOrCreateProgram("terrainRaster",{defines:Se}),q=Re},ae=b.colorModeForRenderPass(),ce=new a.af(B.LEQUAL,a.af.ReadWrite,b.depthRangeFor3D);Za.update(k);const ye=b.transform,ve=os(ye.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let _e=[0,0,0];if(H){const Re=b.style.directionalLight,Se=b.style.ambientLight;Re&&Se&&(_e=tu(b.style,Re,Se))}{q=-1;const Re=B.TRIANGLES,[Se,Ie]=[T.gridIndexBuffer,T.gridSegments];for(const ze of A){const Ne=S.getTile(ze),We=a.ah.disabled,Fe=T.prevTerrainTileForTile[ze.key],Pe=T.terrainTileForTile[ze.key];nu(Fe,Pe)&&Za.newMorphing(ze.key,Fe,Pe,k,250),L.activeTexture.set(B.TEXTURE0),Ne.texture&&Ne.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const et=Za.getMorphValuesForProxy(ze.key),Qe=et?1:0;let Ve;et&&(Ve={morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:a.bb(et.phase)}});const xt=Kc(ze.projMatrix,ru(ze.canonical,ye.renderWorldCopies)?ve/10:ve,_e);if(se(Qe),!U)continue;T.setupElevationDraw(Ne,U,Ve);const pt=ze.toUnwrapped();H&&H.setupShadows(pt,U),b.uploadCommonUniforms(L,U,pt,null,ie),U.draw(b,Re,ce,We,ae,a.ag.backCCW,xt,"terrain_raster",T.gridBuffer,Se,Ie)}}}}(d,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const d=this.painter,y=this.painter.context,b=this.proxySourceCache,T=this.proxiedCoords[b.id],S=this._drapedRenderBatches.shift(),A=d.style.order,k=[];let L=0;for(const B of T){const U=b.getTileByID(B.proxyTileKey),q=b.proxyCachedFBO[B.key]?b.proxyCachedFBO[B.key][l]:void 0,H=q!==void 0?b.renderCache[q]:this.pool[L++],ie=q!==void 0;if(U.texture=H.tex,ie&&!H.dirty){k.push(U.tileID);continue}let se;y.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(y.clear({color:a.C.transparent,stencil:0}),H.dirty=!1);for(let ae=S.start;ae<=S.end;++ae){const ce=d.style._mergedLayers[A[ae]];if(ce.isHidden(d.transform.zoom))continue;const ye=d.style.getLayerSourceCache(ce),ve=ye?this.proxyToSource[B.key][ye.id]:[B];if(!ve)continue;const _e=ve;y.viewport.set([0,0,H.fb.width,H.fb.height]),se!==(ye?ye.id:null)&&(this._setupStencil(H,ve,ce,ye),se=ye?ye.id:null),d.renderLayer(d,ye,ce,_e)}if(this._drapedRenderBatches.length===0)for(const ae of this._pendingGroundEffectLayers){const ce=d.style._mergedLayers[A[ae]];if(ce.isHidden(d.transform.zoom))continue;const ye=d.style.getLayerSourceCache(ce),ve=ye?this.proxyToSource[B.key][ye.id]:[B];if(!ve)continue;const _e=ve;y.viewport.set([0,0,H.fb.width,H.fb.height]),se!==(ye?ye.id:null)&&(this._setupStencil(H,ve,ce,ye),se=ye?ye.id:null),d.renderLayer(d,ye,ce,_e)}this.renderedToTile?(H.dirty=!0,k.push(U.tileID)):ie||--L,L===5&&(L=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),S.end+1}postRender(){}isLayerOrderingCorrect(l){const d=l.order.length;let y=-1,b=d;for(let T=0;T<d;++T)this._style.isLayerDraped(l._mergedLayers[l.order[T]])?y=Math.max(y,T):b=Math.min(b,T);return b>y}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{l=Math.min(l,d.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,d,y){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const S=T.tileID,A=1<<S.overscaledZ,{x:k,y:L}=S.canonical,B=k/A,U=(k+1)/A,q=L/A,H=(L+1)/A;return{minx:B,miny:q,maxx:U,maxy:H,t:T.dem.tree.raycastRoot(B,q,U,H,l,d,y),tile:T}});b.sort((T,S)=>(T.t!==null?T.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const T of b){if(T.t==null)return null;const S=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,l,d,y);if(S!=null)return S}return null}_createFBO(){const l=this.painter.context,d=l.gl,y=this.drapeBufferSize;l.activeTexture.set(d.TEXTURE0);const b=new a.T(l,{width:y[0],height:y[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const T=l.createFramebuffer(y[0],y[1],!0,null);return T.colorAttachment.set(b.texture),T.depthAttachment=new Ln(l,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:T,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const d=this._style._mergedLayers[l],y=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!y&&d.shouldRedrape():!y&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const y of this._style.getSources())if(y instanceof dg){l=!0;break}if(!l)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(T&&!d[T.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof a.Z){d[T.id]=!0;for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][T.id];if(A)for(const k of A)this._clearRenderCacheForTile(T.id,k)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof So){l=!0;break}if(!l)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(!T||d[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const S=b.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const k=this.proxyToSource[A.key][T.id];if(k)for(const L of k){const B=Xa(T.getTile(L),T.findLoadedParent(L,0),T,this.painter.transform,S);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(T.id,L)}}}}_setupDrapedRenderBatches(){const l=this._style.order,d=l.length;if(d===0)return;const y=[];this._pendingGroundEffectLayers=[];let b,T=0,S=this._style._mergedLayers[l[T]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++T<d;)S=this._style._mergedLayers[l[T]];for(;T<d;++T){const A=this._style._mergedLayers[l[T]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?b===void 0&&(b=T):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),b!==void 0&&(y.push({start:b,end:T-1}),b=void 0)))}if(b!==void 0&&y.push({start:b,end:T-1}),y.length!==0){const A=y[y.length-1];this._pendingGroundEffectLayers.every(k=>k>A.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(l){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const S=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let A=0;A<S.length;++A){const k=Object.values(S[A]);d.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,b=this._tilesDirty;for(let S=y.length-1;S>=0;S--){const A=y[S];if(d.getTileByID(A.key),d.proxyCachedFBO[A.key]!==void 0){const k=l[A.key],L=this.proxyToSource[A.key];let B=0;for(const U in L){const q=L[U],H=k[U];if(!H||H.length!==q.length||q.some((ie,se)=>ie!==H[se]||b[U]&&b[U].hasOwnProperty(ie.key))){B=-1;break}++B}for(const U in d.proxyCachedFBO[A.key])d.renderCache[d.proxyCachedFBO[A.key][U]].dirty=B<0||B!==Object.values(k).length}}const T=[...this._drapedRenderBatches];T.sort((S,A)=>A.end-A.start-(S.end-S.start));for(const S of T)for(const A of y){if(d.proxyCachedFBO[A.key])continue;let k=d.renderCachePool.pop();k===void 0&&d.renderCache.length<50&&(k=d.renderCache.length,d.renderCache.push(this._createFBO())),k!==void 0&&(d.proxyCachedFBO[A.key]={},d.proxyCachedFBO[A.key][S.start]=k,d.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(l,d,y,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,S=T.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let A;if(y.isTileClipped())A=d.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):a.ah.disabled}_renderTileClippingMasks(l,d){const y=this.painter,b=this.painter.context,T=b.gl;y._tileClippingMaskIDs={},b.setColorMode(a.a.disabled),b.setDepthMode(a.af.disabled);const S=y.getOrCreateProgram("clippingMask");for(const A of l){const k=y._tileClippingMaskIDs[A.key]=--d;S.draw(y,T.TRIANGLES,a.af.disabled,new a.ah({func:T.ALWAYS,mask:0},k,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.ag.disabled,iu(A.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(l){const d=this.painter.transform;if(l.x<0||l.x>d.width||l.y<0||l.y>d.height)return null;const y=[l.x,l.y,1,1];a.aB.transformMat4(y,y,d.pixelMatrixInverse),a.aB.scale(y,y,1/y[3]),y[0]/=d.worldSize,y[1]/=d.worldSize;const b=d._camera.position,T=a.ay(1,d.center.lat),S=[b[0],b[1],b[2]/T,0],A=a.$.subtract([],y.slice(0,3),S);a.$.normalize(A,A);const k=this.raycast(S,A,this._exaggeration);return k!==null&&k?(a.$.scaleAndAdd(S,S,A,k),S[3]=S[2],S[2]*=T,S):null}_setupProxiedCoordsForOrtho(l,d,y){if(l.getSource()instanceof a.bo)return this._setupProxiedCoordsForImageSource(l,d,y);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const b=this.proxiedCoords[l.id]=[],T=this.proxyCoords;for(let k=0;k<T.length;k++){const L=T[k],B=this._findTileCoveringTileID(L,l);if(B){const U=this._createProxiedId(L,B,y[L.key]&&y[L.key][l.id]);b.push(U),this.proxyToSource[L.key][l.id]=[U]}}let S=!1;const A=new Set;for(let k=0;k<d.length;k++){const L=l.getTile(d[k]);if(!L||!L.hasData())continue;const B=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==L.tileID.canonical.z){const U=this.proxyToSource[B.tileID.key][l.id],q=this._createProxiedId(B.tileID,L,y[B.tileID.key]&&y[B.tileID.key][l.id]);U?U.splice(U.length-1,0,q):this.proxyToSource[B.tileID.key][l.id]=[q];const H=this.proxyToSource[B.tileID.key][l.id];A.has(H)||A.add(H),b.push(q),S=!0}}if(this._sourceTilesOverlap[l.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const k of A)k.sort((L,B)=>B.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(l,d,y){if(!l.getSource().loaded())return;const b=this.proxiedCoords[l.id]=[],T=this.proxyCoords,S=l.getSource(),A=S.tileID;if(!A)return;const k=new a.P(A.x,A.y)._div(1<<A.z),L=S.coordinates.map(a._.fromLngLat).reduce((U,q)=>(U.min.x=Math.min(U.min.x,q.x-k.x),U.min.y=Math.min(U.min.y,q.y-k.y),U.max.x=Math.max(U.max.x,q.x-k.x),U.max.y=Math.max(U.max.y,q.y-k.y),U),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(U,q)=>{const H=U.wrap+U.canonical.x/(1<<U.canonical.z),ie=U.canonical.y/(1<<U.canonical.z),se=a.a4/(1<<U.canonical.z),ae=q.wrap+q.canonical.x/(1<<q.canonical.z),ce=q.canonical.y/(1<<q.canonical.z);return H+se<ae+L.min.x||H>ae+L.max.x||ie+se<ce+L.min.y||ie>ce+L.max.y};for(let U=0;U<T.length;U++){const q=T[U];for(let H=0;H<d.length;H++){const ie=l.getTile(d[H]);if(!ie||!ie.hasData()||B(q,ie.tileID))continue;const se=this._createProxiedId(q,ie,y[q.key]&&y[q.key][l.id]),ae=this.proxyToSource[q.key][l.id];ae?ae.push(se):this.proxyToSource[q.key][l.id]=[se],b.push(se)}}}_createProxiedId(l,d,y){let b=this.orthoMatrix;if(y){const T=y.find(S=>S.key===d.tileID.key);if(T)return T}if(d.tileID.key!==l.key){const T=l.canonical.z-d.tileID.canonical.z;let S,A,k;b=a.ae.create();const L=d.tileID.wrap-l.wrap<<l.overscaledZ;T>0?(S=a.a4>>T,A=S*((d.tileID.canonical.x<<T)-l.canonical.x+L),k=S*((d.tileID.canonical.y<<T)-l.canonical.y)):(S=a.a4<<-T,A=a.a4*(d.tileID.canonical.x-(l.canonical.x+L<<-T)),k=a.a4*(d.tileID.canonical.y-(l.canonical.y<<-T))),a.ae.ortho(b,0,S,0,S,0,1),a.ae.translate(b,b,[A,k,0])}return new It(d.tileID,l.key,b)}_findTileCoveringTileID(l,d){let y=d.getTile(l);if(y&&y.hasData())return y;const b=this._findCoveringTileCache[d.id],T=b[l.key];if(y=T?d.getTileByID(T):null,y&&y.hasData()||T===null)return y;let S=y?y.tileID:l,A=S.overscaledZ;const k=d.getSource().minzoom,L=[];if(!T){const U=d.getSource().maxzoom;if(l.canonical.z>=U){const q=l.canonical.z-U;d.getSource().reparseOverscaled?(A=Math.max(l.canonical.z+2,d.transform.tileZoom),S=new a.aQ(A,l.wrap,U,l.canonical.x>>q,l.canonical.y>>q)):q!==0&&(A=U,S=new a.aQ(A,l.wrap,U,l.canonical.x>>q,l.canonical.y>>q))}S.key!==l.key&&(L.push(S.key),y=d.getTile(S))}const B=U=>{L.forEach(q=>{b[q]=U}),L.length=0};for(A-=1;A>=k&&(!y||!y.hasData());A--){y&&B(y.tileID.key);const U=S.calculateScaledKey(A);if(y=d.getTileByID(U),y&&y.hasData())break;const q=b[U];if(q===null)break;q===void 0?L.push(U):y=d.getTileByID(q)}return B(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,d){let y=this._tilesDirty[l];y||(y=this._tilesDirty[l]={}),y[d.key]=!0}}function ii(g,l,d){const y=function(A,k,L){const B=a.$.dot(k,A),U=a.$.dot(L,[.2126,.7152,.0722]),q=(ie,se,ae)=>(1-ae)*ie+ae*se,H=q(1-.3*Math.min(U,1),1,Math.min(B+1,1));return q(.92,1,Math.asin(a.au(k[2],-1,1))/Math.PI+.5)*H}(g,[0,0,1],l),b=[0,0,0];a.$.scale(b,d.slice(0,3),y);const T=[0,0,0];a.$.scale(T,l.slice(0,3),g[2]);const S=[0,0,0];return a.$.add(S,b,T),a.ba(S)}const ps=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ur=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class As{static cacheKey(l,d,y,b){let T=`${d}${b?b.cacheKey:""}`;for(const S of y)l.usedDefines.includes(S)&&(T+=`/${S}`);return T}constructor(l,d,y,b,T,S){const A=l.gl;this.program=A.createProgram(),this.configuration=b,this.name=d,this.fixedDefines=[...S];const k=b?b.getBinderAttributes():[],L=(y.staticAttributes||[]).concat(k);let B=b?b.defines():[];B=B.concat(S.map(ae=>`#define ${ae}`));const U=`#version 300 es
`;let q=U+B.concat("precision mediump float;",lg,hd.fragmentSource).join(`
`);for(const ae of y.fragmentIncludes)q+=`
${Qu[ae]}`;q+=`
${y.fragmentSource}`;let H=U+B.concat("precision highp float;",lg,hd.vertexSource).join(`
`);for(const ae of y.vertexIncludes)H+=`
${Qu[ae]}`;H+=`
${y.vertexSource}`;const ie=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(ie,q),A.compileShader(ie),A.attachShader(this.program,ie);const se=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(se,H),A.compileShader(se),A.attachShader(this.program,se),this.attributes={},this.numAttributes=L.length;for(let ae=0;ae<this.numAttributes;ae++)if(L[ae]){const ce=L[ae].startsWith("a_")?L[ae]:`a_${L[ae]}`;A.bindAttribLocation(this.program,ae,ce),this.attributes[ce]=ae}A.linkProgram(this.program),A.deleteShader(se),A.deleteShader(ie),this.fixedUniforms=T(l),this.binderUniforms=b?b.getUniforms(l):[],(S.includes("TERRAIN")||d.indexOf("symbol")!==-1||d.indexOf("circle")!==-1)&&(this.terrainUniforms=(ae=>({u_dem:new a.a8(ae),u_dem_prev:new a.a8(ae),u_dem_tl:new a.a9(ae),u_dem_scale:new a.ab(ae),u_dem_tl_prev:new a.a9(ae),u_dem_scale_prev:new a.ab(ae),u_dem_size:new a.ab(ae),u_dem_lerp:new a.ab(ae),u_exaggeration:new a.ab(ae),u_depth:new a.a8(ae),u_depth_size_inv:new a.a9(ae),u_depth_range_unpack:new a.a9(ae),u_occluder_half_size:new a.ab(ae),u_occlusion_depth_offset:new a.ab(ae),u_meter_to_dem:new a.ab(ae),u_label_plane_matrix_inv:new a.a7(ae)}))(l)),S.includes("GLOBE")&&(this.globeUniforms=(ae=>({u_tile_tl_up:new a.ar(ae),u_tile_tr_up:new a.ar(ae),u_tile_br_up:new a.ar(ae),u_tile_bl_up:new a.ar(ae),u_tile_up_scale:new a.ab(ae)}))(l)),S.includes("FOG")&&(this.fogUniforms=(ae=>({u_fog_matrix:new a.a7(ae),u_fog_range:new a.a9(ae),u_fog_color:new a.at(ae),u_fog_horizon_blend:new a.ab(ae),u_fog_vertical_limit:new a.a9(ae),u_fog_temporal_offset:new a.ab(ae),u_frustum_tl:new a.ar(ae),u_frustum_tr:new a.ar(ae),u_frustum_br:new a.ar(ae),u_frustum_bl:new a.ar(ae),u_globe_pos:new a.ar(ae),u_globe_radius:new a.ab(ae),u_globe_transition:new a.ab(ae),u_is_globe:new a.a8(ae),u_viewport:new a.a9(ae)}))(l)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ae=>({u_cutoff_params:new a.at(ae)}))(l)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ae=>({u_lighting_ambient_color:new a.ar(ae),u_lighting_directional_dir:new a.ar(ae),u_lighting_directional_color:new a.ar(ae),u_ground_radiance:new a.ar(ae)}))(l)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ae=>({u_light_matrix_0:new a.a7(ae),u_light_matrix_1:new a.a7(ae),u_fade_range:new a.a9(ae),u_shadow_normal_offset:new a.ar(ae),u_shadow_intensity:new a.ab(ae),u_shadow_texel_size:new a.ab(ae),u_shadow_map_resolution:new a.ab(ae),u_shadow_direction:new a.ar(ae),u_shadow_bias:new a.ar(ae),u_shadowmap_0:new a.a8(ae),u_shadowmap_1:new a.a8(ae)}))(l))}}setTerrainUniformValues(l,d){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setGlobeUniformValues(l,d){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setFogUniformValues(l,d){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setCutoffUniformValues(l,d){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setLightsUniformValues(l,d){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setShadowUniformValues(l,d){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}_drawDebugWireframe(l,d,y,b,T,S,A,k,L,B){const U=l.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const q=l.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||l._terrain&&l._terrain.renderingToTexture||!ps.includes(this.name))||!(!U.layers3D||!Ur.includes(this.name))))return;const H=q.gl,ie=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,T,q);if(!ie)return;const se=[...this.fixedDefines];se.push("DEBUG_WIREFRAME");const ae=l.getOrCreateProgram(this.name,{config:this.configuration,defines:se});q.program.set(ae.program);const ce=(_e,Re,Se)=>{if(Re[_e]&&Se[_e])for(const Ie in Re[_e])Se[_e][Ie]&&Se[_e][Ie].set(Se.program,Ie,Re[_e][Ie].current)};L&&L.setUniforms(ae.program,q,ae.binderUniforms,A,{zoom:k}),ce("fixedUniforms",this,ae),ce("terrainUniforms",this,ae),ce("globeUniforms",this,ae),ce("fogUniforms",this,ae),ce("lightsUniforms",this,ae),ce("shadowUniforms",this,ae),ie.bind(),q.setColorMode(new a.a([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],a.C.transparent,[!0,!0,!0,!1])),q.setDepthMode(new a.af(d.func===H.LESS?H.LEQUAL:d.func,a.af.ReadOnly,d.range)),q.setStencilMode(a.ah.disabled);const ye=3*S.primitiveLength*2,ve=3*S.primitiveOffset*2*2;B&&B>1?H.drawElementsInstanced(H.LINES,ye,H.UNSIGNED_SHORT,ve,B):H.drawElements(H.LINES,ye,H.UNSIGNED_SHORT,ve),T.bind(),q.program.set(this.program),q.setDepthMode(d),q.setStencilMode(y),q.setColorMode(b)}draw(l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se,ae){const ce=l.context,ye=ce.gl;if(this.failedToCreate)return;ce.program.set(this.program),ce.setDepthMode(y),ce.setStencilMode(b),ce.setColorMode(T),ce.setCullFace(S);for(const Re of Object.keys(this.fixedUniforms))this.fixedUniforms[Re].set(this.program,Re,A[Re]);ie&&ie.setUniforms(this.program,ce,this.binderUniforms,q,{zoom:H});const ve={[ye.POINTS]:1,[ye.LINES]:2,[ye.TRIANGLES]:3,[ye.LINE_STRIP]:1}[d],_e=ae&&ae>0?1:void 0;for(const Re of U.get()){const Se=Re.vaos||(Re.vaos={});(Se[k]||(Se[k]=new cg)).bind(ce,this,L,ie?ie.getPaintVertexBuffers():[],B,Re.vertexOffset,se||[],_e),ae&&ae>1?ye.drawElementsInstanced(d,Re.primitiveLength*ve,ye.UNSIGNED_SHORT,Re.primitiveOffset*ve*2,ae):B?ye.drawElements(d,Re.primitiveLength*ve,ye.UNSIGNED_SHORT,Re.primitiveOffset*ve*2):ye.drawArrays(d,Re.vertexOffset,Re.vertexLength),d===ye.TRIANGLES&&B&&this._drawDebugWireframe(l,y,b,T,B,Re,q,H,ie,ae)}}}function Ps(g,l){const d=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,g.transform.tileZoom)/d,b=y*(l.tileID.canonical.x+l.tileID.wrap*d),T=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.bD(l,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T]}}const uc=a.ae.create(),as=(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se,ae,ce)=>{const ye=l.style.light,ve=ye.properties.get("position"),_e=[ve.x,ve.y,ve.z],Re=a.bE.create();ye.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(Re,-l.transform.angle),a.$.transformMat3(_e,_e,Re));const Se=ye.properties.get("color"),Ie=l.transform,ze={u_matrix:g,u_lightpos:_e,u_lightintensity:ye.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_vertical_gradient:+d,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:uc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:T,u_alignment:S,u_width_scale:A,u_flood_light_color:H,u_vertical_scale:ie,u_flood_light_intensity:se,u_ground_shadow_factor:ae,u_emissive_strength:ce};return Ie.projection.name==="globe"&&(ze.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],ze.u_zoom_transition=B,ze.u_inv_rot_matrix=q,ze.u_merc_center=U,ze.u_up_dir=Ie.projection.upVector(new a.aO(0,0,0),U[0]*a.a4,U[1]*a.a4),ze.u_height_lift=L),ze},hc=(g,l,d,y,b)=>({u_matrix:g,u_edge_radius:l,u_alignment:d,u_width_scale:y,u_vertical_scale:b}),md=(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se)=>{const ae=as(g,l,d,y,b,T,S,A,k,B,U,q,H,ie,se,1,[0,0,0],0),ce={u_height_factor:-Math.pow(2,k.overscaledZ)/L.tileSize/8};return a.Q(ae,Ps(l,L),ce)},rp=(g,l)=>({u_matrix:g,u_emissive_strength:l}),pg=(g,l,d,y)=>a.Q(rp(g,l),Ps(d,y)),mg=(g,l,d)=>({u_matrix:g,u_world:d,u_emissive_strength:l}),ip=(g,l,d,y,b)=>a.Q(pg(g,l,d,y),{u_world:b}),gd=(g,l,d,y)=>{const b=a.a4/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(y),u_extrude_scale:[l.pixelsToGLUnits[0]/b,l.pixelsToGLUnits[1]/b]}},gg=(g,l,d=1)=>({u_matrix:g,u_color:l.toRenderColor(null),u_overlay:0,u_overlay_scale:d}),Cb=a.ae.create(),Ab=(g,l,d,y,b,T,S)=>{const A=g.transform,k=A.projection.name==="globe",L=k?a.bF(A.zoom,l.canonical)*A._pixelsPerMercatorPixel:a.bD(d,1,T),B={u_matrix:l.projMatrix,u_extrude_scale:L,u_intensity:S,u_inv_rot_matrix:Cb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){B.u_inv_rot_matrix=y,B.u_merc_center=b,B.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],B.u_zoom_transition=a.a2(A.zoom);const U=b[0]*a.a4,q=b[1]*a.a4;B.u_up_dir=A.projection.upVector(new a.aO(0,0,0),U,q)}return B};function h0(g,[l,d,y,b],[T,S]){if(T===S)return[0,0,0,0];const A=255*(g-1)/(g*(S-T));return[l*A,d*A,y*A,b*A]}function sp(g,l,[d,y]){return d===y?0:.5/g+(l-d)*(g-1)/(g*(y-d))}const _g=(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se,ae,ce,ye,ve,_e)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:d,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:L,u_fade_t:B.mix,u_opacity:B.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:a.bG(U.paint.get("raster-saturation")),u_contrast_factor:a.bH(U.paint.get("raster-contrast")),u_spin_weights:d0(U.paint.get("raster-hue-rotate")),u_perspective_transform:q,u_raster_elevation:H,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:k,u_colorization_mix:h0(a.bI,se,ce),u_colorization_offset:sp(a.bI,ae,ce),u_color_ramp:ie,u_texture_offset:[ve/(ye+2*ve),ye/(ye+2*ve)],u_texture_res:[ye+2*ve,ye+2*ve],u_emissive_strength:_e});function d0(g){g*=Math.PI/180;const l=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const Sl=.05,nh=(g,l,d,y,b,T,S,A,k,L,B,U)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:d,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:L,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:k}),pA=(g,l,d,y,b,T,S,A,k,L)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_tile_offset:d,u_velocity:y,u_color_ramp:T,u_velocity_res:b,u_max_speed:S,u_uv_offset:A,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Sl,Sl]}),Pb=(g,l,d,y,b,T,S,A,k,L)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_velocity:d,u_velocity_res:y,u_max_speed:b,u_speed_factor:T,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Sl,Sl]}),op=a.ae.create(),_d=(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se,ae,ce)=>{const ye=b.transform,ve={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ye.getCameraToCenterDistance(se),u_rotate_symbol:+d,u_aspect_ratio:ye.width/ye.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+k,u_pitch_with_map:+y,u_texsize:L,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:op,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:op,u_up_vector:[0,-1,0],u_color_adj_mat:ae,u_icon_transition:ce||0};return se.name==="globe"&&(ve.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],ve.u_zoom_transition=U,ve.u_inv_rot_matrix=H,ve.u_merc_center=q,ve.u_camera_forward=ye._camera.forward(),ve.u_ecef_origin=a.bJ(ye.globeMatrix,B.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(ye.globeMatrix),ve.u_up_vector=ie),ve},ap=(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se,ae)=>a.Q(_d(g,l,d,y,b,T,S,A,k,L,U,q,H,ie,se,ae),{u_gamma_scale:y?b.transform.getCameraToCenterDistance(ae)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:a.e.devicePixelRatio,u_is_halo:+B,undefined:void 0}),f0=(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se)=>a.Q(ap(g,l,d,y,b,T,S,A,!0,k,!0,B,U,q,H,ie,se),{u_texsize_icon:L,u_texture_icon:1}),p0=(g,l,d,y)=>({u_matrix:g,u_emissive_strength:l,u_opacity:d,u_color:y}),mA=(g,l,d,y,b,T,S,A)=>a.Q(function(k,L,B,U,q){const{width:H,height:ie}=U.imageManager.getPixelSize(L),se=Math.pow(2,q.tileID.overscaledZ),ae=q.tileSize*Math.pow(2,U.transform.tileZoom)/se,ce=ae*(q.tileID.canonical.x+q.tileID.wrap*se),ye=ae*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[H,ie],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/a.bD(q,1,U.transform.tileZoom),u_pixel_coord_upper:[ce>>16,ye>>16],u_pixel_coord_lower:[65535&ce,65535&ye]}}(0,T,S,y,A),{u_matrix:g,u_emissive_strength:l,u_opacity:d}),Sa=new Float32Array(a.ae.identity([])),rh=(g,l,d,y,b,T,S,A,k,L,B,U,q,H=[0,0,0],ie)=>{const se=b.style.light,ae=se.properties.get("position"),ce=[-ae.x,-ae.y,ae.z],ye=a.bE.create();se.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(ye,-b.transform.angle),a.$.transformMat3(ce,ce,ye));const ve=B.alphaMode==="MASK",_e=se.properties.get("color").toRenderColor(null),Re=q.paint.get("model-ambient-occlusion-intensity"),Se=q.paint.get("model-color").constantOr(a.C.white).toRenderColor(null),Ie=q.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:l,u_normal_matrix:d,u_node_matrix:y||Sa,u_lightpos:ce,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_camera_pos:H,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+ve,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:k,u_roughnessFactor:L,u_baseColorTexture:Cs.BaseColor,u_metallicRoughnessTexture:Cs.MetallicRoughness,u_normalTexture:Cs.Normal,u_occlusionTexture:Cs.Occlusion,u_emissionTexture:Cs.Emission,u_lutTexture:Cs.LUT,u_color_mix:[Se.r,Se.g,Se.b,Ie],u_aoIntensity:Re,u_emissive_strength:U,u_occlusionTextureTransform:ie||[0,0,0,0]}},m0=(g,l=Sa,d=Sa)=>({u_matrix:g,u_instance:l,u_node_matrix:d}),Rb={fillExtrusion:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_opacity:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_flood_light_color:new a.ar(g),u_vertical_scale:new a.ab(g),u_flood_light_intensity:new a.ab(g),u_ground_shadow_factor:new a.ar(g),u_emissive_strength:new a.ab(g)}),fillExtrusionDepth:g=>({u_matrix:new a.a7(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_vertical_scale:new a.ab(g)}),fillExtrusionPattern:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_height_factor:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g),u_opacity:new a.ab(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new a.a7(g),u_opacity:new a.ab(g),u_ao_pass:new a.ab(g),u_meter_to_tile:new a.ab(g),u_ao:new a.a9(g),u_flood_light_intensity:new a.ab(g),u_flood_light_color:new a.ar(g),u_attenuation:new a.ab(g),u_edge_radius:new a.ab(g),u_fb:new a.a8(g),u_fb_size:new a.ab(g)}),fill:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g)}),fillPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),fillOutline:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g)}),fillOutlinePattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),circle:a.bK,collisionBox:g=>({u_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_extrude_scale:new a.a9(g)}),collisionCircle:g=>({u_matrix:new a.a7(g),u_inv_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_viewport_size:new a.a9(g)}),debug:g=>({u_color:new a.aa(g),u_matrix:new a.a7(g),u_overlay:new a.a8(g),u_overlay_scale:new a.ab(g)}),clippingMask:g=>({u_matrix:new a.a7(g)}),heatmap:g=>({u_extrude_scale:new a.ab(g),u_intensity:new a.ab(g),u_matrix:new a.a7(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_up_dir:new a.ar(g)}),heatmapTexture:g=>({u_image:new a.a8(g),u_color_ramp:new a.a8(g),u_opacity:new a.ab(g)}),hillshade:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_latrange:new a.a9(g),u_light:new a.a9(g),u_shadow:new a.aa(g),u_highlight:new a.aa(g),u_emissive_strength:new a.ab(g),u_accent:new a.aa(g)}),hillshadePrepare:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_dimension:new a.a9(g),u_zoom:new a.ab(g)}),line:a.bL,linePattern:a.bM,raster:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_brightness_low:new a.ab(g),u_brightness_high:new a.ab(g),u_saturation_factor:new a.ab(g),u_contrast_factor:new a.ab(g),u_spin_weights:new a.ar(g),u_perspective_transform:new a.a9(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g),u_colorization_mix:new a.at(g),u_colorization_offset:new a.ab(g),u_color_ramp:new a.a8(g),u_texture_offset:new a.a9(g),u_texture_res:new a.a9(g),u_emissive_strength:new a.ab(g)}),rasterParticle:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g)}),rasterParticleTexture:g=>({u_texture:new a.a8(g),u_opacity:new a.ab(g)}),rasterParticleDraw:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_tile_offset:new a.a9(g),u_velocity:new a.a8(g),u_color_ramp:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),rasterParticleUpdate:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_velocity:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_speed_factor:new a.ab(g),u_reset_rate:new a.ab(g),u_rand_seed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_texture:new a.a8(g),u_icon_transition:new a.ab(g),u_color_adj_mat:new a.a7(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texture:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_is_halo:new a.a8(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texsize_icon:new a.a9(g),u_texture:new a.a8(g),u_texture_icon:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_is_halo:new a.a8(g)}),background:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_color:new a.aa(g)}),backgroundPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_image:new a.a8(g),u_pattern_tl:new a.a9(g),u_pattern_br:new a.a9(g),u_texsize:new a.a9(g),u_pattern_size:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),terrainRaster:g=>({u_matrix:new a.a7(g),u_image0:new a.a8(g),u_skirt_height:new a.ab(g),u_ground_shadow_factor:new a.ar(g)}),skybox:g=>({u_matrix:new a.a7(g),u_sun_direction:new a.ar(g),u_cubemap:new a.a8(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxGradient:g=>({u_matrix:new a.a7(g),u_color_ramp:new a.a8(g),u_center_direction:new a.ar(g),u_radius:new a.ab(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxCapture:g=>({u_matrix_3f:new a.as(g),u_sun_direction:new a.ar(g),u_sun_intensity:new a.ab(g),u_color_tint_r:new a.at(g),u_color_tint_m:new a.at(g),u_luminance:new a.ab(g)}),globeRaster:g=>({u_proj_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_image0:new a.a8(g),u_grid_matrix:new a.as(g),u_skirt_height:new a.ab(g),u_far_z_cutoff:new a.ab(g),u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_globe_pos:new a.ar(g),u_globe_radius:new a.ab(g),u_viewport:new a.a9(g)}),globeAtmosphere:g=>({u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_horizon:new a.ab(g),u_transition:new a.ab(g),u_fadeout_range:new a.ab(g),u_color:new a.at(g),u_high_color:new a.at(g),u_space_color:new a.at(g),u_temporal_offset:new a.ab(g),u_horizon_angle:new a.ab(g)}),model:g=>({u_matrix:new a.a7(g),u_lighting_matrix:new a.a7(g),u_normal_matrix:new a.a7(g),u_node_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_camera_pos:new a.ar(g),u_opacity:new a.ab(g),u_baseColorFactor:new a.at(g),u_emissiveFactor:new a.at(g),u_metallicFactor:new a.ab(g),u_roughnessFactor:new a.ab(g),u_baseTextureIsAlpha:new a.a8(g),u_alphaMask:new a.a8(g),u_alphaCutoff:new a.ab(g),u_baseColorTexture:new a.a8(g),u_metallicRoughnessTexture:new a.a8(g),u_normalTexture:new a.a8(g),u_occlusionTexture:new a.a8(g),u_emissionTexture:new a.a8(g),u_lutTexture:new a.a8(g),u_color_mix:new a.at(g),u_aoIntensity:new a.ab(g),u_emissive_strength:new a.ab(g),u_occlusionTextureTransform:new a.at(g)}),modelDepth:g=>({u_matrix:new a.a7(g),u_instance:new a.a7(g),u_node_matrix:new a.a7(g)}),groundShadow:g=>({u_matrix:new a.a7(g),u_ground_shadow_factor:new a.ar(g)}),stars:g=>({u_matrix:new a.a7(g),u_up:new a.ar(g),u_right:new a.ar(g),u_intensity_multiplier:new a.ab(g)}),occlusion:g=>({u_matrix:new a.a7(g),u_anchorPos:new a.ar(g),u_screenSizePx:new a.a9(g),u_occluderSizePx:new a.a9(g),u_color:new a.at(g)})};function ih(g,l,d){const y=l.createTileMatrix(g,g.worldSize,d.toUnwrapped());return a.ae.multiply(new Float32Array(16),g.projMatrix,y)}function Mb(g,l,d){if(l.projection.name===d.projection.name)return g.projMatrix;const y=d.clone();return y.setProjection(l.projection),ih(y,l.getProjection(),g)}function g0(g,l,d){return l.name===d.projection.name?g.projMatrix:ih(d,l,g)}let yd;function kb(g,l,d,y,b,T,S){const A=g.context,k=A.gl,L=g.transform,B=g.getOrCreateProgram("collisionBox"),U=[];let q=0,H=0;for(let _e=0;_e<y.length;_e++){const Re=y[_e],Se=l.getTile(Re),Ie=Se.getBucket(d);if(!Ie)continue;const ze=Mb(Re,Ie,L);let Ne=ze;b[0]===0&&b[1]===0||(Ne=g.translatePosMatrix(ze,Se,b,T));const We=S?Ie.textCollisionBox:Ie.iconCollisionBox,Fe=Ie.collisionCircleArray;if(Fe.length>0){const Pe=a.ae.create(),et=Ne;a.ae.mul(Pe,Ie.placementInvProjMatrix,L.glCoordMatrix),a.ae.mul(Pe,Pe,Ie.placementViewportMatrix),U.push({circleArray:Fe,circleOffset:H,transform:et,invTransform:Pe,projection:Ie.getProjection()}),q+=Fe.length/4,H=q}We&&(g.terrain&&g.terrain.setupElevationDraw(Se,B),B.draw(g,k.LINES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,gd(Ne,L,Se,Ie.getProjection()),d.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,L.zoom,null,[We.collisionVertexBuffer,We.collisionVertexBufferExt]))}if(!S||!U.length)return;const ie=g.getOrCreateProgram("collisionCircle"),se=new a.bN;se.resize(4*q),se._trim();let ae=0;for(const _e of U)for(let Re=0;Re<_e.circleArray.length/4;Re++){const Se=4*Re,Ie=_e.circleArray[Se+0],ze=_e.circleArray[Se+1],Ne=_e.circleArray[Se+2],We=_e.circleArray[Se+3];se.emplace(ae++,Ie,ze,Ne,We,0),se.emplace(ae++,Ie,ze,Ne,We,1),se.emplace(ae++,Ie,ze,Ne,We,2),se.emplace(ae++,Ie,ze,Ne,We,3)}(!yd||yd.length<2*q)&&(yd=function(_e){const Re=2*_e,Se=new a.bw;Se.resize(Re),Se._trim();for(let Ie=0;Ie<Re;Ie++){const ze=6*Ie;Se.uint16[ze+0]=4*Ie+0,Se.uint16[ze+1]=4*Ie+1,Se.uint16[ze+2]=4*Ie+2,Se.uint16[ze+3]=4*Ie+2,Se.uint16[ze+4]=4*Ie+3,Se.uint16[ze+5]=4*Ie+0}return Se}(q));const ce=A.createIndexBuffer(yd,!0),ye=A.createVertexBuffer(se,a.bO.members,!0);for(const _e of U){const Re={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(ve=L).getCameraToCenterDistance(_e.projection),u_viewport_size:[ve.width,ve.height]};ie.draw(g,k.TRIANGLES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,Re,d.id,ye,ce,a.b.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,L.zoom)}var ve;ye.destroy(),ce.destroy()}const lp=a.ae.create();function Db(g){const l=g._camera.getWorldToCamera(g.worldSize,1),d=a.ae.multiply([],l,g.globeMatrix);a.ae.invert(d,d);const y=[0,0,0],b=[0,1,0,0];return a.aB.transformMat4(b,b,d),y[0]=b[0],y[1]=b[1],y[2]=b[2],a.$.normalize(y,y),y}function Ob({width:g,height:l,anchor:d,textOffset:y,textScale:b},T){const{horizontalAlign:S,verticalAlign:A}=a.bS(d),k=-(S-.5)*g,L=-(A-.5)*l,B=a.bR(d,y);return new a.P((k/b+B[0])*T,(L/b+B[1])*T)}function gA(g,l,d,y,b,T,S,A,k,L,B){const U=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,H=g.icon.dynamicLayoutVertexArray,ie={},se=g.getProjection(),ae=g0(A,se,T),ce=T.elevation,ye=se.upVectorScale(A.canonical,T.center.lat,T.worldSize).metersToTile;q.clear();for(let ve=0;ve<U.length;ve++){const _e=U.get(ve),{tileAnchorX:Re,tileAnchorY:Se,numGlyphs:Ie}=_e,ze=_e.hidden||!_e.crossTileID||g.allowVerticalPlacement&&!_e.placedOrientation?null:y[_e.crossTileID];if(ze){let Ne=0,We=0,Fe=0;if(ce){const Be=ce?ce.getAtTileOffset(A,Re,Se):0,[mt,_t,Bt]=se.upVector(A.canonical,Re,Se);Ne=Be*mt*ye,We=Be*_t*ye,Fe=Be*Bt*ye}let[Pe,et,Qe,Ve]=mo(_e.projectedAnchorX+Ne,_e.projectedAnchorY+We,_e.projectedAnchorZ+Fe,d?ae:S);const xt=Wn(T.getCameraToCenterDistance(se),Ve);let pt=b.evaluateSizeForFeature(g.textSizeData,L,_e)*xt/a.bP;d&&(pt*=g.tilePixelRatio/k);const He=Ob(ze,pt);d?({x:Pe,y:et,z:Qe}=se.projectTilePoint(Re+He.x,Se+He.y,A.canonical),[Pe,et,Qe]=mo(Pe+Ne,et+We,Qe+Fe,S)):(l&&He._rotate(-T.angle),Pe+=He.x,et+=He.y,Qe=0);const it=g.allowVerticalPlacement&&_e.placedOrientation===a.aF.vertical?Math.PI/2:0;for(let Be=0;Be<Ie;Be++)a.aI(q,Pe,et,Qe,it);B&&_e.associatedIconIndex>=0&&(ie[_e.associatedIconIndex]={x:Pe,y:et,z:Qe,angle:it})}else Ea(Ie,q)}if(B){H.clear();const ve=g.icon.placedSymbolArray;for(let _e=0;_e<ve.length;_e++){const Re=ve.get(_e),{numGlyphs:Se}=Re,Ie=ie[_e];if(Re.hidden||!Ie)Ea(Se,H);else{const{x:ze,y:Ne,z:We,angle:Fe}=Ie;for(let Pe=0;Pe<Se;Pe++)a.aI(H,ze,Ne,We,Fe)}}g.icon.dynamicLayoutVertexBuffer.updateData(H)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function cp(g,l,d,y,b,T,S={}){const A=d.paint.get("icon-translate"),k=d.paint.get("text-translate"),L=d.paint.get("icon-translate-anchor"),B=d.paint.get("text-translate-anchor"),U=d.layout.get("icon-rotation-alignment"),q=d.layout.get("text-rotation-alignment"),H=d.layout.get("icon-pitch-alignment"),ie=d.layout.get("text-pitch-alignment"),se=d.layout.get("icon-keep-upright"),ae=d.layout.get("text-keep-upright"),ce=d.paint.get("icon-color-saturation"),ye=d.paint.get("icon-color-contrast"),ve=d.paint.get("icon-color-brightness-min"),_e=d.paint.get("icon-color-brightness-max");d.paint.get("icon-occlusion-opacity").constantOr(0),d.paint.get("text-occlusion-opacity").constantOr(0);const Re=g.context,Se=Re.gl,Ie=g.transform,ze=U==="map",Ne=q==="map",We=H==="map",Fe=ie==="map",Pe=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let et=!1;const Qe=g.depthModeForSublayer(0,a.af.ReadOnly),Ve=[a.ak(Ie.center.lng),a.al(Ie.center.lat)],xt=d.layout.get("text-variable-anchor"),pt=Ie.projection.name==="globe",He=[],it=[0,-1,0];for(const Be of y){const mt=l.getTile(Be),_t=mt.getBucket(d);if(!_t||_t.projection.name==="mercator"&&pt||_t.fullyClipped)continue;const Bt=_t.projection.name==="globe",Vt=Bt?a.a2(Ie.zoom):0,rn=g0(Be,_t.getProjection(),Ie),Ht=Ie.calculatePixelsToTileUnitsMatrix(mt),vn=xt&&_t.hasTextData(),Fn=_t.hasIconTextFit()&&vn&&_t.hasIconData(),bn=_t.getProjection().createInversionMatrix(Ie,Be.canonical),$n=xr=>{Ie.depthOcclusionForSymbolsAndCircles&&(d.hasInitialOcclusionOpacityProperties||g.terrain)&&(xr.push("DEPTH_D24"),xr.push("DEPTH_OCCLUSION"))},hr=()=>{const xr=ze&&d.layout.get("symbol-placement")!=="point",tr=[];$n(tr);const In=xr||Fn,Bi=d.paint.get("icon-image-cross-fade").constantOr(0);g.terrainRenderModeElevated()&&We&&tr.push("PITCH_WITH_MAP_TERRAIN"),Bt&&(tr.push("PROJECTION_GLOBE_VIEW"),In&&tr.push("PROJECTED_POS_ON_VIEWPORT")),Bi>0&&tr.push("ICON_TRANSITION"),_t.icon.zOffsetVertexBuffer&&tr.push("Z_OFFSET"),ce===0&&ye===0&&ve===0&&_e===1||tr.push("COLOR_ADJUSTMENT");const ji=_t.icon.programConfigurations.get(d.id),ro=g.getOrCreateProgram(_t.sdfIcons?"symbolSDF":"symbolIcon",{config:ji,defines:tr});let io;const Gs=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0],so=_t.iconSizeData,Ns=a.aE(so,Ie.zoom),Ws=We||Ie.pitch!==0,Et=Jc(rn,mt.tileID.canonical,We,ze,Ie,_t.getProjection(),Ht),on=Ju(rn,mt.tileID.canonical,We,ze,Ie,_t.getProjection(),Ht),_o=g.translatePosMatrix(on,mt,A,L,!0),Vr=g.translatePosMatrix(rn,mt,A,L),Je=In?lp:Et,gc=ze&&!We&&!xr;let Ya=it;!pt&&!Ie.mercatorFromTransition||ze||(Ya=Db(Ie));const _c=Bt?Ya:it;if(_t.sdfIcons&&!_t.iconsInText)io=ap(so.kind,Ns,gc,We,g,Vr,Je,_o,!1,Gs,!0,Be,Vt,Ve,bn,_c,_t.getProjection());else{const fh=d.getColorAdjustmentMatrix(ce,ye,ve,_e);io=_d(so.kind,Ns,gc,We,g,Vr,Je,_o,!1,Gs,Be,Vt,Ve,bn,_c,_t.getProjection(),fh,Bi)}const yc=mt.imageAtlasTexture?mt.imageAtlasTexture:null,Vg=d.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear,$g=_t.sdfIcons||g.options.rotating||g.options.zooming||Vg||Ws?Se.LINEAR:Se.NEAREST,uu=_t.sdfIcons&&d.paint.get("icon-halo-width").constantOr(1)!==0,V0=g.terrain&&We&&xr?a.ae.invert(a.ae.create(),Et):lp;if(xr&&_t.icon){const fh=Ie.elevation,qg=fh?fh.getAtTileOffsetFunc(Be,Ie.center.lat,Ie.worldSize,_t.getProjection()):null,Rd=Yu(rn,mt.tileID.canonical,We,ze,Ie,_t.getProjection(),Ht);sc(_t,rn,g,!1,Rd,on,We,se,qg,Be)}return{program:ro,buffers:_t.icon,uniformValues:io,atlasTexture:yc,atlasTextureIcon:null,atlasInterpolation:$g,atlasInterpolationIcon:null,isSDF:_t.sdfIcons,hasHalo:uu,tile:mt,labelPlaneMatrixInv:V0}},Xr=()=>{const xr=Ne&&d.layout.get("symbol-placement")!=="point",tr=[],In=xr||xt||Fn;g.terrainRenderModeElevated()&&Fe&&tr.push("PITCH_WITH_MAP_TERRAIN"),Bt&&(tr.push("PROJECTION_GLOBE_VIEW"),In&&tr.push("PROJECTED_POS_ON_VIEWPORT")),_t.text.zOffsetVertexBuffer&&tr.push("Z_OFFSET"),$n(tr);const Bi=_t.text.programConfigurations.get(d.id),ji=g.getOrCreateProgram(_t.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Bi,defines:tr});let ro,io=[0,0],Gs=null;const so=_t.textSizeData;_t.iconsInText&&(io=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0],Gs=mt.imageAtlasTexture?mt.imageAtlasTexture:null,ro=Fe||Ie.pitch!==0||g.options.rotating||g.options.zooming||so.kind==="composite"||so.kind==="camera"?Se.LINEAR:Se.NEAREST);const Ns=mt.glyphAtlasTexture?mt.glyphAtlasTexture.size:[0,0],Ws=a.aE(so,Ie.zoom),Et=Jc(rn,mt.tileID.canonical,Fe,Ne,Ie,_t.getProjection(),Ht),on=Ju(rn,mt.tileID.canonical,Fe,Ne,Ie,_t.getProjection(),Ht),_o=g.translatePosMatrix(on,mt,k,B,!0),Vr=g.translatePosMatrix(rn,mt,k,B),Je=In?lp:Et,gc=Ne&&!Fe&&!xr;let Ya=it;!pt&&!Ie.mercatorFromTransition||Ne||(Ya=Db(Ie));const _c=Bt?Ya:it;let yc;yc=_t.iconsInText?f0(so.kind,Ws,gc,Fe,g,Vr,Je,_o,Ns,io,Be,Vt,Ve,bn,_c,_t.getProjection()):ap(so.kind,Ws,gc,Fe,g,Vr,Je,_o,!0,Ns,!0,Be,Vt,Ve,bn,_c,_t.getProjection());const Vg=mt.glyphAtlasTexture?mt.glyphAtlasTexture:null,$g=Se.LINEAR,uu=d.paint.get("text-halo-width").constantOr(1)!==0,V0=g.terrain&&Fe&&xr?a.ae.invert(a.ae.create(),Et):lp;if(xr&&_t.text){const fh=Ie.elevation,qg=fh?fh.getAtTileOffsetFunc(Be,Ie.center.lat,Ie.worldSize,_t.getProjection()):null,Rd=Yu(rn,mt.tileID.canonical,Fe,Ne,Ie,_t.getProjection(),Ht);sc(_t,rn,g,!0,Rd,on,Fe,ae,qg,Be)}return{program:ji,buffers:_t.text,uniformValues:yc,atlasTexture:Vg,atlasTextureIcon:Gs,atlasInterpolation:$g,atlasInterpolationIcon:ro,isSDF:!0,hasHalo:uu,tile:mt,labelPlaneMatrixInv:V0}},Lr=_t.icon.segments.get().length,pr=_t.text.segments.get().length,Or=Lr&&!S.onlyText?hr():null,Hn=pr&&!S.onlyIcons?Xr():null,Yn=d.paint.get("icon-opacity").constantOr(1),Bn=d.paint.get("text-opacity").constantOr(1);if(Pe&&_t.canOverlap){et=!0;const xr=Yn&&!S.onlyText?_t.icon.segments.get():[],tr=Bn&&!S.onlyIcons?_t.text.segments.get():[];for(const In of xr)He.push({segments:new a.b([In]),sortKey:In.sortKey,state:Or});for(const In of tr)He.push({segments:new a.b([In]),sortKey:In.sortKey,state:Hn})}else S.onlyText||He.push({segments:Yn?_t.icon.segments:new a.b([]),sortKey:0,state:Or}),S.onlyIcons||He.push({segments:Bn?_t.text.segments:new a.b([]),sortKey:0,state:Hn})}et&&He.sort((Be,mt)=>Be.sortKey-mt.sortKey);for(const Be of He){const mt=Be.state;if(mt)if(g.terrain?g.terrain.setupElevationDraw(mt.tile,mt.program,{useDepthForOcclusion:Ie.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:mt.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Ie.depthOcclusionForSymbolsAndCircles,mt.program),Re.activeTexture.set(Se.TEXTURE0),mt.atlasTexture&&mt.atlasTexture.bind(mt.atlasInterpolation,Se.CLAMP_TO_EDGE,!0),mt.atlasTextureIcon&&(Re.activeTexture.set(Se.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,Se.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,mt.program),mt.hasHalo){const _t=mt.uniformValues;_t.u_is_halo=1,_0(mt.buffers,Be.segments,d,g,mt.program,Qe,b,T,_t,2),_t.u_is_halo=0}else{if(mt.isSDF){const _t=mt.uniformValues;mt.hasHalo&&(_t.u_is_halo=1,_0(mt.buffers,Be.segments,d,g,mt.program,Qe,b,T,_t,1)),_t.u_is_halo=0}_0(mt.buffers,Be.segments,d,g,mt.program,Qe,b,T,mt.uniformValues,1)}}}function _0(g,l,d,y,b,T,S,A,k,L){const B=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];b.draw(y,y.context.gl.TRIANGLES,T,S,A,a.ag.disabled,k,d.id,g.layoutVertexBuffer,g.indexBuffer,l,d.paint,y.transform.zoom,g.programConfigurations.get(d.id),B,L)}function up(g,l,d,y,b,T,S){const A=g.context.gl,k=d.paint.get("fill-pattern"),L=k&&k.constantOr(1);let B,U,q,H,ie;S?(U=L&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):(U=L?"fillPattern":"fill",B=A.TRIANGLES);for(const se of y){const ae=l.getTile(se);if(L&&!ae.patternsLoaded())continue;const ce=ae.getBucket(d);if(!ce)continue;g.prepareDrawTile();const ye=ce.programConfigurations.get(d.id),ve=g.isTileAffectedByFog(se),_e=g.getOrCreateProgram(U,{config:ye,overrideFog:ve});L&&(g.context.activeTexture.set(A.TEXTURE0),ae.imageAtlasTexture&&ae.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ye.updatePaintBuffers());const Re=k.constantOr(null);if(Re&&ae.imageAtlas){const ze=ae.imageAtlas.patternPositions[Re.toString()];ze&&ye.setConstantPatternPositions(ze)}const Se=g.translatePosMatrix(se.projMatrix,ae,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),Ie=d.paint.get("fill-emissive-strength");if(S){H=ce.indexBuffer2,ie=ce.segments2;const ze=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];q=U==="fillOutlinePattern"&&L?ip(Se,Ie,g,ae,ze):mg(Se,Ie,ze)}else H=ce.indexBuffer,ie=ce.segments,q=L?pg(Se,Ie,g,ae):rp(Se,Ie);g.uploadCommonUniforms(g.context,_e,se.toUnwrapped()),_e.draw(g,B,b,g.stencilModeForClipping(se),T,a.ag.disabled,q,d.id,ce.layoutVertexBuffer,H,ie,d.paint,g.transform.zoom,ye,void 0)}}function sh(g,l,d,y,b,T,S,A){d.resetLayerRenderingStats(g);const k=g.context,L=k.gl,B=g.transform,U=d.paint.get("fill-extrusion-pattern"),q=U.constantOr(1),H=d.paint.get("fill-extrusion-opacity"),ie=g.style.enable3dLights(),se=d.paint.get(ie&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),se],ce=d.layout.get("fill-extrusion-edge-radius"),ye=ce>0&&!d.paint.get("fill-extrusion-rounded-roof"),ve=ye?0:ce,_e=B.projection.name==="globe"?a.b_():0,Re=B.projection.name==="globe",Se=Re?a.a2(B.zoom):0,Ie=[a.ak(B.center.lng),a.al(B.center.lat)],ze=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(d.lut).toArray01().slice(0,3),Ne=d.paint.get("fill-extrusion-flood-light-intensity"),We=d.paint.get("fill-extrusion-vertical-scale"),Fe=d.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Pe=zs(g,d.paint.get("fill-extrusion-cutoff-fade-range")),et=d.paint.get("fill-extrusion-emissive-strength"),Qe=[];Re&&Qe.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&Qe.push("FAUX_AO"),ye&&Qe.push("ZERO_ROOF_RADIUS"),A&&Qe.push("HAS_CENTROID"),Ne>0&&Qe.push("FLOOD_LIGHT"),Pe.shouldRenderCutoff&&Qe.push("RENDER_CUTOFF"),Fe&&Qe.push("RENDER_WALL_MODE");const Ve=(()=>{const Bt=d.paint.get("fill-extrusion-line-alignment");switch(Bt){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return a.w(`Unsupported value for fill-extrusion-line-alignment: ${Bt}`),0}})();let xt;const pt=g.renderPass==="shadow",He=g.shadowRenderer,it=pt&&!!He;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let Be=[0,0,0];if(He){const Bt=g.style.directionalLight,Vt=g.style.ambientLight;Bt&&Vt&&(Be=tu(g.style,Bt,Vt)),xt=Qe.concat(["SHADOWS_SINGLE_CASCADE"])}const mt=it?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",_t=d.getLayerRenderingStats();for(const Bt of y){const Vt=l.getTile(Bt),rn=Vt.getBucket(d);if(!rn||rn.projection.name!==B.projection.name)continue;let Ht=!1;He&&(Ht=He.getMaxCascadeForTile(Bt.toUnwrapped())===0);const vn=g.isTileAffectedByFog(Bt),Fn=rn.programConfigurations.get(d.id),bn=g.getOrCreateProgram(mt,{config:Fn,defines:Ht?xt:Qe,overrideFog:vn});if(g.terrain&&g.terrain.setupElevationDraw(Vt,bn,{useMeterToDem:!0}),!rn.centroidVertexBuffer){const Hn=bn.attributes.a_centroid_pos;Hn!==void 0&&L.vertexAttrib2f(Hn,0,0)}!pt&&He&&He.setupShadows(Vt.tileID.toUnwrapped(),bn,"vector-tile",Vt.tileID.overscaledZ),q&&(g.context.activeTexture.set(L.TEXTURE0),Vt.imageAtlasTexture&&Vt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Fn.updatePaintBuffers());const $n=U.constantOr(null);if($n&&Vt.imageAtlas){const Hn=Vt.imageAtlas.patternPositions[$n.toString()];Hn&&Fn.setConstantPatternPositions(Hn)}const hr=d.paint.get("fill-extrusion-vertical-gradient"),Xr=1/rn.tileToMeter;let Lr;if(pt&&He){if(Il(Vt.tileID,rn,g))continue;const Hn=He.calculateShadowPassMatrixFromTile(Vt.tileID.toUnwrapped());Lr=hc(Hn,ve,Ve,Xr,We)}else{const Hn=g.translatePosMatrix(Bt.expandedProjMatrix,Vt,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Yn=B.projection.createInversionMatrix(B,Bt.canonical);Lr=q?md(Hn,g,hr,H,ae,ve,Ve,Xr,Bt,Vt,_e,Se,Ie,Yn,ze,We):as(Hn,g,hr,H,ae,ve,Ve,Xr,Bt,_e,Se,Ie,Yn,ze,We,Ne,Be,et)}g.uploadCommonUniforms(k,bn,Bt.toUnwrapped(),null,Pe);let pr=rn.segments;if(B.projection.name==="mercator"&&!pt&&(pr=rn.getVisibleSegments(Vt.tileID,g.terrain,g.transform.getFrustum(0)),!pr.get().length))continue;if(_t)if(pt)for(const Hn of pr.get())_t.numRenderedVerticesInShadowPass+=Hn.primitiveLength;else for(const Hn of pr.get())_t.numRenderedVerticesInTransparentPass+=Hn.primitiveLength;const Or=[];(g.terrain||A)&&Or.push(rn.centroidVertexBuffer),Re&&Or.push(rn.layoutVertexExtBuffer),Fe&&Or.push(rn.wallVertexBuffer),bn.draw(g,k.gl.TRIANGLES,b,T,S,a.ag.backCCW,Lr,d.id,rn.layoutVertexBuffer,rn.indexBuffer,pr,d.paint,g.transform.zoom,Fn,Or)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function vd(g,l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se,ae,ce,ye){const ve=g.context,_e=ve.gl,Re=g.transform,Se=g.transform.zoom,Ie=[],ze=zs(g,d.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(Ie.push("CLEAR_SUBPASS"),ye&&(Ie.push("CLEAR_FROM_TEXTURE"),ve.activeTexture.set(_e.TEXTURE0),ye.bind(_e.LINEAR,_e.CLAMP_TO_EDGE))):L==="sdf"&&Ie.push("SDF_SUBPASS"),ae&&Ie.push("HAS_CENTROID"),ze.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF");const Ne=d.layout.get("fill-extrusion-edge-radius"),We=(Fe,Pe,et,Qe,Ve)=>{const xt=Pe.programConfigurations.get(d.id),pt=g.isTileAffectedByFog(Fe),He=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:xt,defines:Ie,overrideFog:pt}),it=((mt,_t,Bt,Vt,rn,Ht,vn,Fn,bn,$n,hr)=>({u_matrix:_t,u_opacity:Bt,u_ao_pass:Vt?1:0,u_meter_to_tile:rn,u_ao:Ht,u_flood_light_intensity:vn,u_flood_light_color:Fn,u_attenuation:bn,u_edge_radius:$n,u_fb:0,u_fb_size:hr}))(0,Qe,B,k,Ve,[U,q*Ve],H,ie,se,Se>=17?0:Ne*Ve,ye?ye.size[0]:0),Be=[];ae&&Be.push(Pe.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(ve,He,Fe.toUnwrapped(),null,ze),He.draw(g,ve.gl.TRIANGLES,b,T,S,A,it,d.id,Pe.vertexBuffer,Pe.indexBuffer,et,d.paint,Se,xt,Be)};for(const Fe of y){const Pe=l.getTile(Fe),et=Pe.getBucket(d);if(!et||et.projection.name!==Re.projection.name||!et.groundEffect||et.groundEffect&&!et.groundEffect.hasData())continue;const Qe=et.groundEffect,Ve=1/et.tileToMeter;{const xt=g.translatePosMatrix(Fe.projMatrix,Pe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),pt=Qe.getDefaultSegment();We(Fe,Qe,pt,xt,Ve)}if(ce)for(let xt=0;xt<4;xt++){const pt=a.b$[xt](Fe),He=l.getTile(pt);if(!He)continue;const it=He.getBucket(d);if(!it||it.projection.name!==Re.projection.name||!it.groundEffect||it.groundEffect&&!it.groundEffect.hasData())continue;const Be=it.groundEffect;let mt,_t;xt===0?(mt=[-a.a4,0,0],_t=1):xt===1?(mt=[a.a4,0,0],_t=0):xt===2?(mt=[0,-a.a4,0],_t=3):(mt=[0,a.a4,0],_t=2);const Bt=Be.regionSegments[_t];if(!Bt)continue;const Vt=new Float32Array(16);a.ae.translate(Vt,Fe.projMatrix,mt),We(Fe,Be,Bt,g.translatePosMatrix(Vt,Pe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Ve)}}}function _A(g,l,d,y,b,T,S){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const A=T?T.findDEMTileFor(d):null;if(!(A&&A.dem||S))return;const k=ce=>new a.P(Math.ceil((ce+a.c2)*a.c3),0),L=ce=>{const ye=l.getSource().minzoom,ve=Re=>{const Se=l.getTileByID(Re);if(Se&&Se.hasData())return Se.getBucket(b)},_e=[0,-1,1];for(const Re of _e){if(ce.overscaledZ+Re<ye)continue;const Se=ve(ce.calculateScaledKey(ce.overscaledZ+Re));if(Se)return Se}},B=[0,0,0],U=(ce,ye)=>(B[0]=Math.min(ce.min.y,ye.min.y),B[1]=Math.max(ce.max.y,ye.max.y),B[2]=a.a4-ye.min.x>ce.max.x?ye.min.x-a.a4:ce.max.x,B),q=(ce,ye)=>(B[0]=Math.min(ce.min.x,ye.min.x),B[1]=Math.max(ce.max.x,ye.max.x),B[2]=a.a4-ye.min.y>ce.max.y?ye.min.y-a.a4:ce.max.y,B),H=[(ce,ye)=>U(ce,ye),(ce,ye)=>U(ye,ce),(ce,ye)=>q(ce,ye),(ce,ye)=>q(ye,ce)],ie=(ce,ye,ve,_e,Re,Se,Ie)=>{if(!T)return 0;const ze=[[Se?ve:ce,Se?ce:ve,0],[Se?ve:ye,Se?ye:ve,0]],Ne=Ie<0?a.a4+Ie:Ie,We=[Se?Ne:(ce+ye)/2,Se?(ce+ye)/2:Ne,0];return ve===0&&Ie<0||ve!==0&&Ie>0?T.getForTilePoints(Re,[We],!0,_e):ze.push(We),T.getForTilePoints(d,ze,!0,A),Math.max(ze[0][2],ze[1][2],We[2])/T.exaggeration()};for(let ce=0;ce<4;ce++){const ye=y.borderFeatureIndices[ce];if(ye.length===0)continue;const ve=a.b$[ce](d),_e=L(ve);if(!(_e&&_e instanceof a.c0)||y.borderDoneWithNeighborZ[ce]===_e.canonical.z)continue;_e.centroidVertexArray.length===0&&_e.createCentroidsBuffer();const Re=T?T.findDEMTileFor(ve):null;if(!(Re&&Re.dem||S))continue;const Se=(ce<2?1:5)-ce,Ie=_e.borderDoneWithNeighborZ[Se]!==y.canonical.z,ze=_e.borderFeatureIndices[Se];let Ne=0;if(y.canonical.z!==_e.canonical.z){for(const We of ye)y.showCentroid(y.featuresOnBorder[We]);if(Ie)for(const We of ze)_e.showCentroid(_e.featuresOnBorder[We]);y.borderDoneWithNeighborZ[ce]=_e.canonical.z,_e.borderDoneWithNeighborZ[Se]=y.canonical.z}for(const We of ye){const Fe=y.featuresOnBorder[We],Pe=y.centroidData[Fe.centroidDataIndex],et=Fe.borders[ce];let Qe;for(;Ne<ze.length;){Qe=_e.featuresOnBorder[ze[Ne]];const Ve=Qe.borders[Se];if(Ve[1]>et[0]+3||Ve[0]>et[0]-3)break;_e.showCentroid(Qe),Ne++}if(Qe&&Ne<ze.length){const Ve=Ne;let xt=0;for(;!(Qe.borders[Se][0]>et[1]-3)&&(xt++,++Ne!==ze.length);)Qe=_e.featuresOnBorder[ze[Ne]];if(Qe=_e.featuresOnBorder[ze[Ve]],xt>1){const it=Qe.borders[Se];Math.abs(et[0]-it[0])<3&&Math.abs(et[1]-it[1])<3&&(xt=1,Ne=Ve+1)}else if(xt===0){y.showCentroid(Fe);continue}const pt=_e.centroidData[Qe.centroidDataIndex];S&&xt===1&&(((se=Pe).flags|(ae=pt).flags)&a.c1?(se.flags|=a.c1,ae.flags|=a.c1):(se.flags&=~a.c1,ae.flags&=~a.c1));const He=Fe.intersectsCount()>1||Qe.intersectsCount()>1;if(xt>1)Ne=Ve,Pe.centroidXY=pt.centroidXY=new a.P(0,0);else if(Re&&Re.dem&&!He){const it=H[ce](Pe,pt),Be=ce%2?a.a4-1:0,mt=ie(it[0],Math.min(a.a4-1,it[1]),Be,Re,ve,ce<2,it[2]);Pe.centroidXY=pt.centroidXY=k(mt)}else He?Pe.centroidXY=pt.centroidXY=new a.P(0,0):(Pe.centroidXY=y.encodeBorderCentroid(Fe),pt.centroidXY=_e.encodeBorderCentroid(Qe));y.writeCentroidToBuffer(Pe),_e.writeCentroidToBuffer(pt)}else y.showCentroid(Fe)}y.borderDoneWithNeighborZ[ce]=_e.canonical.z,_e.borderDoneWithNeighborZ[Se]=y.canonical.z}var se,ae;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const Lb=[1,0,0],yA=[0,1,0],yg=[0,0,1];function Il(g,l,d){const y=d.transform,b=d.shadowRenderer;if(!b)return!0;const T=g.toUnwrapped(),S=y.tileSize*b._cascades[d.currentShadowCascade].scale;let A=l.maxHeight;if(y.elevation){const se=y.elevation.getMinMaxForTile(g);se&&(A+=se.max)}const k=[...b.shadowDirection];k[2]=-k[2];const L=b.computeSimplifiedTileShadowVolume(T,A,S,k);if(!L)return!1;const B=[Lb,yA,yg,k,[k[0],0,k[2]],[0,k[1],k[2]]],U=y.projection.name==="globe",q=y.scaleZoom(S),H=a.aM.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,q,!U),ie=b.getCurrentCascadeFrustum();return H.intersectsPrecise(L.vertices,L.planes,B)===0||ie.intersectsPrecise(L.vertices,L.planes,B)===0}function hp(g){return[g[0]*a.c4,g[1]*a.c4,g[2]*a.c4,0]}function vg(g,l,d,y,b,T,S,A,k){const L=y.getSource(),B=d.globeSharedBuffers;if(!B)return;let U,q,H;if(l&&(U=y.getTile(l)),L instanceof a.bo?(q=L.texture,H=a.bj(0,0,d.transform)):U&&l&&(q=U.texture,H=a.bj(l.canonical.z,l.canonical.x,d.transform)),!q||!H)return;g||(H=a.ae.scale(a.ae.create(),H,[1,-1,1]));const ie=d.context,se=ie.gl,ae=b.paint.get("raster-resampling")==="nearest"?se.NEAREST:se.LINEAR,ce=d.colorModeForDrapableLayerRenderPass(T),ye=S.defines;ye.push("GLOBE_POLES");const ve=new a.af(se.LEQUAL,a.af.ReadWrite,d.depthRangeFor3D),_e=Float32Array.from(d.transform.expandedFarZProjMatrix),Re=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0))));d.terrain&&d.terrain.prepareDrawTile(),ie.activeTexture.set(se.TEXTURE0),q.bind(ae,se.CLAMP_TO_EDGE),ie.activeTexture.set(se.TEXTURE1),q.bind(ae,se.CLAMP_TO_EDGE),q.useMipmap&&ie.extTextureFilterAnisotropic&&d.transform.pitch>20&&se.texParameterf(se.TEXTURE_2D,ie.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ie.extTextureFilterAnisotropicMax);const[Se,Ie,ze,Ne]=l?B.getPoleBuffers(l.canonical.z,!1):B.getPoleBuffers(0,!0),We=b.paint.get("raster-elevation");let Fe;g?(Fe=Se,d.renderDefaultNorthPole=We!==0):(Fe=Ie,d.renderDefaultSouthPole=We!==0);const Pe=hp(S.mix),et=((Ve,xt,pt,He,it,Be,mt,_t,Bt,Vt,rn,Ht,vn)=>_g(Ve,xt,pt,new Float32Array(16),new Float32Array(9),[0,0],He,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Be,[0,0],_t,2,Vt,rn,Ht,1,0,vn))(_e,Re,H,a.a2(d.transform.zoom),0,b,0,We,0,Pe,S.offset,S.range,T),Qe=d.getOrCreateProgram("raster",{defines:ye});d.uploadCommonUniforms(ie,Qe,null),Qe.draw(d,se.TRIANGLES,ve,k,ce,A,et,b.id,Fe,ze,Ne)}function y0(g){const l=g._nearZ,d=g.projection.farthestPixelDistance(g),y=d-l,b=.2*g.height,T=l+b;return[l,d,(T-b-l)/y,(T-l)/y]}function oh(g,l,d,y){if(g)return l instanceof R&&g instanceof a.c5?l.getTextureDescriptor(g,d,!0):{texture:g.texture,mix:hp(y.mix),offset:y.offset,buffer:0,tileSize:1}}function zb(g,l,d){if(!g)return null;const y=l.getTextureDescriptor(g,d,!0);if(!y)return null;let{texture:b,mix:T,offset:S,tileSize:A,buffer:k,format:L}=y;if(!b||!L)return null;let B=!1;return L==="uint32"&&(B=!0,T[3]=0,T=h0(a.c6,T,[0,d.paint.get("raster-particle-max-speed")]),S=sp(a.c6,S,[0,d.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[k/(A+2*k),A/(A+2*k)],tileSize:A,scalarData:B,scale:T,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function xg(g){const l=g._nearZ,d=g.projection.farthestPixelDistance(g),y=d-l,b=.2*g.height,T=l+b;return[l,d,(T-b-l)/y,(T-l)/y]}const v0=new a.C(1,0,0,1),bg=new a.C(0,1,0,1),x0=new a.C(0,0,1,1),Er=new a.C(1,0,1,1),vA=new a.C(0,1,1,1);function xn(g,l,d,y,b,T,S){const A=g.context,k=g.transform,L=A.gl,B=k.projection.name==="globe",U=B?["PROJECTION_GLOBE_VIEW"]:[];let q=a.ae.clone(d.projMatrix);if(B&&a.a2(k.zoom)>0){const Pe=a.c7(d.canonical,k),et=a.c8(Pe);q=a.ae.multiply(new Float32Array(16),k.globeMatrix,et),a.ae.multiply(q,k.projMatrix,q)}const H=a.ae.create();H[12]+=2*b/(a.e.devicePixelRatio*k.width),H[13]+=2*T/(a.e.devicePixelRatio*k.height),a.ae.multiply(q,H,q);const ie=g.getOrCreateProgram("debug",{defines:U}),se=l.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(se,ie);const ae=a.af.disabled,ce=a.ah.disabled,ye=g.colorModeForRenderPass(),ve="$debug";A.activeTexture.set(L.TEXTURE0),g.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),B?se._makeGlobeTileDebugBuffers(g.context,k):se._makeDebugTileBoundsBuffers(g.context,k.projection);const _e=se._tileDebugBuffer||g.debugBuffer,Re=se._tileDebugIndexBuffer||g.debugIndexBuffer,Se=se._tileDebugSegments||g.debugSegments;if(ie.draw(g,L.LINE_STRIP,ae,ce,ye,a.ag.disabled,gg(q,y),ve,_e,Re,Se,null,null,null,[se._globeTileDebugBorderBuffer]),S){const Pe=se.latestRawTileData,et=Math.floor((Pe&&Pe.byteLength||0)/1024);let Qe=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Qe+=` => ${d.overscaledZ}`),Qe+=` ${se.state}`,Qe+=` ${et}kb`,function(Ve,xt){Ve.initDebugOverlayCanvas();const pt=Ve.debugOverlayCanvas,He=Ve.context.gl,it=Ve.debugOverlayCanvas.getContext("2d");it.clearRect(0,0,pt.width,pt.height),it.shadowColor="white",it.shadowBlur=2,it.lineWidth=1.5,it.strokeStyle="white",it.textBaseline="top",it.font="bold 36px Open Sans, sans-serif",it.fillText(xt,5,5),it.strokeText(xt,5,5),Ve.debugOverlayTexture.update(pt),Ve.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(g,Qe)}const Ie=l.getTile(d).tileSize,ze=512/Math.min(Ie,512)*(d.overscaledZ/k.zoom)*.5,Ne=se._tileDebugTextBuffer||g.debugBuffer,We=se._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Fe=se._tileDebugTextSegments||g.debugSegments;ie.draw(g,L.TRIANGLES,ae,ce,a.a.alphaBlended,a.ag.disabled,gg(q,a.C.transparent,ze),ve,Ne,We,Fe,null,null,null,[se._globeTileDebugTextBuffer])}function b0(g,l,d,y){xd(g,0,l+d/2,g.transform.width,d,y)}function dp(g,l,d,y){xd(g,l-d/2,0,d,g.transform.height,y)}function xd(g,l,d,y,b,T){const S=g.context,A=S.gl;A.enable(A.SCISSOR_TEST),A.scissor(l*a.e.devicePixelRatio,d*a.e.devicePixelRatio,y*a.e.devicePixelRatio,b*a.e.devicePixelRatio),S.clear({color:T}),A.disable(A.SCISSOR_TEST)}const Cl=a.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:w0}=Cl;function ia(g,l,d,y){g.emplaceBack(l,d,y)}class Jt{constructor(l){this.vertexArray=new a.ca,this.indices=new a.bw,ia(this.vertexArray,-1,-1,1),ia(this.vertexArray,1,-1,1),ia(this.vertexArray,-1,1,1),ia(this.vertexArray,1,1,1),ia(this.vertexArray,-1,-1,-1),ia(this.vertexArray,1,-1,-1),ia(this.vertexArray,-1,1,-1),ia(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,w0),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=a.b.simpleSegment(0,0,36,12)}}function yr(g,l,d,y,b,T){const S=g.context.gl,A=l.paint.get("sky-atmosphere-color"),k=l.paint.get("sky-atmosphere-halo-color"),L=l.paint.get("sky-atmosphere-sun-intensity"),B=((U,q,H,ie,se)=>({u_matrix_3f:U,u_sun_direction:q,u_sun_intensity:H,u_color_tint_r:[ie.r,ie.g,ie.b,ie.a],u_color_tint_m:[se.r,se.g,se.b,se.a],u_luminance:5e-5}))(a.bE.fromMat4(a.bE.create(),y),b,L,A,k);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+T,l.skyboxTexture,0),d.draw(g,S.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.frontCW,B,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Ir=a.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ia{constructor(l){const d=new a.cb;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const y=new a.bw;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(d,Ir.members),this.indexBuffer=l.createIndexBuffer(y),this.segments=a.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const bd=a.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class br{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class wg{constructor(l){this.colorModeAlphaBlendedWriteRGB=new a.a([a.cc,a.cd,a.cc,a.cd],a.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new a.a([a.cc,a.ce,a.cc,a.ce],a.C.transparent,[!1,!1,!1,!0]),this.params=new br,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){const d=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ia(d);const y=this.params.sizeRange,b=this.params.intensityRange,T=function(B){const U=a.ch(30),q=[];for(let H=0;H<B;++H){const ie=2*Math.PI*U(),se=Math.acos(1-2*U())-.5*Math.PI;q.push(a.$.fromValues(Math.cos(se)*Math.cos(ie),Math.cos(se)*Math.sin(ie),Math.sin(se)))}return q}(this.params.starsCount),S=a.ch(300),A=new a.cf,k=new a.bw;let L=0;for(let B=0;B<T.length;++B){const U=a.$.scale([],T[B],200),q=Math.max(0,1+.01*y*(1*S()-.5)),H=Math.max(0,1+.01*b*(1*S()-.5));A.emplaceBack(U[0],U[1],U[2],-1,-1,q,H),A.emplaceBack(U[0],U[1],U[2],1,-1,q,H),A.emplaceBack(U[0],U[1],U[2],1,1,q,H),A.emplaceBack(U[0],U[1],U[2],-1,1,q,H),k.emplaceBack(L+0,L+1,L+2),k.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=d.createVertexBuffer(A,bd.members),this.starsIdx=d.createIndexBuffer(k),this.starsSegments=a.b.simpleSegment(0,0,A.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,d){const y=l.context,b=y.gl,T=l.transform,S=new a.af(b.LEQUAL,a.af.ReadOnly,[0,1]),A=a.a2(T.zoom),k=l.style.getLut(d.scope),L=d.properties.get("color").toRenderColor(k).toArray01(),B=d.properties.get("high-color").toRenderColor(k).toArray01(),U=d.properties.get("space-color").toRenderColor(k).toArray01PremultipliedAlpha(),q=5e-4,H=a.cg(d.properties.get("horizon-blend"),0,1,q,.25),ie=a.bc(l,y,T)&&H===q?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,se=l.frameCounter/1e3%1,ae=a.$.length(T.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(ae,2)-Math.pow(ie,2)),ye=Math.acos(ce/ae),ve=_e=>{const Re=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];_e&&Re.push("ALPHA_PASS");const Se=l.getOrCreateProgram("globeAtmosphere",{defines:Re}),Ie=((Ne,We,Fe,Pe,et,Qe,Ve,xt,pt,He,it,Be)=>({u_frustum_tl:Ne,u_frustum_tr:We,u_frustum_br:Fe,u_frustum_bl:Pe,u_horizon:et,u_transition:Qe,u_fadeout_range:Ve,u_color:xt,u_high_color:pt,u_space_color:He,u_temporal_offset:it,u_horizon_angle:Be}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,A,H,L,B,U,se,ye);l.uploadCommonUniforms(y,Se);const ze=this.atmosphereBuffer;ze&&Se.draw(l,b.TRIANGLES,S,a.ah.disabled,_e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,a.ag.backCW,Ie,_e?"atmosphere_glow_alpha":"atmosphere_glow",ze.vertexBuffer,ze.indexBuffer,ze.segments)};ve(!1),ve(!0)}drawStars(l,d){const y=a.au(d.properties.get("star-intensity"),0,1);if(y===0)return;const b=l.context,T=b.gl,S=l.transform,A=l.getOrCreateProgram("stars"),k=a.aw.identity([]);a.aw.rotateX(k,k,-S._pitch),a.aw.rotateZ(k,k,-S.angle),a.aw.rotateX(k,k,a.ac(S._center.lat)),a.aw.rotateY(k,k,-a.ac(S._center.lng));const L=a.ae.fromQuat(new Float32Array(16),k),B=a.ae.multiply([],S.starsProjMatrix,L),U=a.bE.fromMat4([],L),q=a.bE.invert([],U),H=[0,1,0];a.$.transformMat3(H,H,q),a.$.scale(H,H,this.params.sizeMultiplier);const ie=[1,0,0];a.$.transformMat3(ie,ie,q),a.$.scale(ie,ie,this.params.sizeMultiplier);const se=(ae=H,ce=ie,ye=y,{u_matrix:Float32Array.from(B),u_up:ae,u_right:ce,u_intensity_multiplier:ye});var ae,ce,ye;l.uploadCommonUniforms(b,A),this.starsVx&&this.starsIdx&&A.draw(l,T.TRIANGLES,a.af.disabled,a.ah.disabled,this.colorModeAlphaBlendedWriteRGB,a.ag.disabled,se,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function wd(g,l){const d=[...g],y=l.cameraWorldSizeForFog/l.worldSize,b=a.ae.identity([]);return a.ae.scale(b,b,[y,y,1]),a.ae.multiply(d,b,d),a.ae.multiply(d,l.worldToFogMatrix,d),d}function ah(g,l,d,y,b){const T=d.material,S=y.context,{baseColorTexture:A,metallicRoughnessTexture:k}=T.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:B,emissionTexture:U}=T;function q(H,ie,se){if(H&&(g.push(ie),S.activeTexture.set(S.gl.TEXTURE0+se),H.gfxTexture)){const{minFilter:ae,magFilter:ce,wrapS:ye,wrapT:ve}=H.sampler;H.gfxTexture.bindExtraParam(ae,ce,ye,ve)}}q(A,"HAS_TEXTURE_u_baseColorTexture",Cs.BaseColor),q(k,"HAS_TEXTURE_u_metallicRoughnessTexture",Cs.MetallicRoughness),q(L,"HAS_TEXTURE_u_normalTexture",Cs.Normal),q(B,"HAS_TEXTURE_u_occlusionTexture",Cs.Occlusion),q(U,"HAS_TEXTURE_u_emissionTexture",Cs.Emission),b&&(b.texture||(b.texture=new a.cj(y.context,b.image,[b.image.height,b.image.height,b.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Cs.LUT),b.texture&&b.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),d.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(d.texcoordBuffer)),d.colorBuffer&&(g.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(d.colorBuffer)),d.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(d.normalBuffer)),d.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(d.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function to(g,l,d,y,b,T){const S=d.paint.get("model-opacity"),A=l.context,k=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,l.depthRangeFor3D),L=l.transform,B=g.mesh,U=B.material,q=U.pbrMetallicRoughness,H=l.style.fog;let ie;ie=l.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:a.ae.multiply([],y.zScaleMatrix,g.nodeModelMatrix),a.ae.multiply(ie,y.negCameraPosMatrix,ie);const se=a.ae.invert([],ie);a.ae.transpose(se,se);const ae=d.paint.get("model-emissive-strength").constantOr(0),ce=rh(new Float32Array(g.worldViewProjection),new Float32Array(ie),new Float32Array(se),null,l,S,q.baseColorFactor.toRenderColor(null),U.emissiveFactor,q.metallicFactor,q.roughnessFactor,U,ae,d),ye={defines:[]},ve=[];ah(ye.defines,ve,B,l,d.lut);const _e=l.shadowRenderer;_e&&(_e.useNormalOffset=!1);let Re=null;if(H){const ze=wd(g.nodeModelMatrix,l.transform);if(Re=new Float32Array(ze),L.projection.name!=="globe"){const Ne=B.aabb.min,We=B.aabb.max,[Fe,Pe]=H.getOpacityForBounds(ze,Ne[0],Ne[1],We[0],We[1]);ye.overrideFog=Fe>=_r||Pe>=_r}}const Se=zs(l,d.paint.get("model-cutoff-fade-range"));Se.shouldRenderCutoff&&ye.defines.push("RENDER_CUTOFF");const Ie=l.getOrCreateProgram("model",ye);l.uploadCommonUniforms(A,Ie,null,Re,Se),l.renderPass!=="shadow"&&_e&&_e.setupShadowsFromMatrix(g.nodeModelMatrix,Ie),Ie.draw(l,A.gl.TRIANGLES,k,b,T,B.material.doubleSided?a.ag.disabled:a.ag.backCCW,ce,d.id,B.vertexBuffer,B.indexBuffer,B.segments,d.paint,l.transform.zoom,void 0,ve)}function ki(g,l,d,y,b,T,S){let A;A=g.projection.name==="globe"?a.ck(d,g):[...d],a.ae.multiply(A,A,l.matrix);const k=a.ae.multiply([],y,A);if(l.meshes)for(const L of l.meshes){if(L.material.alphaMode!=="BLEND"){S.push({mesh:L,depth:0,modelIndex:b,worldViewProjection:k,nodeModelMatrix:A});continue}const B=a.$.transformMat4([],L.centroid,k);B[2]>0&&T.push({mesh:L,depth:B[2],modelIndex:b,worldViewProjection:k,nodeModelMatrix:A})}if(l.children)for(const L of l.children)ki(g,L,d,y,b,T,S)}function T0(g,l,d,y){const b=d.shadowRenderer;if(!b)return;const T=b.getShadowPassDepthMode(),S=b.getShadowPassColorMode(),A=b.calculateShadowPassMatrixFromMatrix(l),k=m0(A);d.getOrCreateProgram("modelDepth",{defines:d._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,T,a.ah.disabled,S,a.ag.backCCW,k,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,d.transform.zoom,void 0,void 0)}function fp(g,l,d){const y=l.updateZoomBasedPaintProperties(),b=function(T,S,A){let k,L,B,U=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&U>0){const q=T.terrain,H=q.findDEMTileFor(A);H&&H.dem?k=a.cm.create(q,A,H):U=0}if(U===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),U===S.validForExaggeration&&(U===0||k&&k._demTile&&k._demTile.tileID===S.validForDEMTile.id&&k._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const q in S.instancesPerModel){const H=S.instancesPerModel[q];for(let ie=0;ie<H.instancedDataArray.length;++ie){const se=(k?U*k.getElevationAt(0|H.instancedDataArray.float32[16*ie],0|H.instancedDataArray.float32[16*ie+1],!0,!0):0)+H.instancesEvaluatedElevation[ie];H.instancedDataArray.float32[16*ie+6]=se,L=L?Math.min(S.terrainElevationMin,se):se,B=B?Math.max(S.terrainElevationMax,se):se}}return S.terrainElevationMin=L||0,S.terrainElevationMax=B||0,S.validForExaggeration=U,S.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,l,d);(y||b)&&(l.uploaded=!1,l.upload(g.context))}const Ca={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.b8([0,0,0],[a.a4,a.a4,0])};function pp(g,l){const d=1<<g.canonical.z,y=l.getFreeCameraOptions().position,b=l.elevation,T=g.canonical.x/d,S=(g.canonical.x+1)/d,A=g.canonical.y/d,k=(g.canonical.y+1)/d;let L=l._centerAltitude;if(b){const H=b.getMinMaxForTile(g);H&&H.max>L&&(L=H.max)}const B=a.au(y.x,T,S)-y.x,U=a.au(y.y,A,k)-y.y,q=a.ay(L,l.center.lat)-y.z;return l._zoomFromMercatorZ(Math.sqrt(B*B+U*U+q*q))}function Tg(g,l,d,y,b,T,S){const A=g.context,k=g.renderPass==="shadow",L=g.shadowRenderer,B=k&&L?L.getShadowPassDepthMode():new a.af(A.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),U=g.isTileAffectedByFog(T);if(d.meshes)for(const q of d.meshes){const H=["MODEL_POSITION_ON_GPU"],ie=[];let se,ae,ce;y.instancedDataArray.length>20&&H.push("INSTANCED_ARRAYS");const ye=zs(g,l.paint.get("model-cutoff-fade-range"));if(ye.shouldRenderCutoff&&H.push("RENDER_CUTOFF"),k&&L)se=g.getOrCreateProgram("modelDepth",{defines:H}),ae=m0(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(d.matrix)),ce=L.getShadowPassColorMode();else{ah(H,ie,q,g,l.lut),se=g.getOrCreateProgram("model",{defines:H,overrideFog:U});const _e=q.material,Re=_e.pbrMetallicRoughness,Se=l.paint.get("model-opacity"),Ie=l.paint.get("model-emissive-strength").constantOr(0);ae=rh(T.expandedProjMatrix,Float32Array.from(d.matrix),new Float32Array(16),null,g,Se,Re.baseColorFactor.toRenderColor(null),_e.emissiveFactor,Re.metallicFactor,Re.roughnessFactor,_e,Ie,l,b),L&&(S.shadowUniformsInitialized?se.setShadowUniformValues(A,L.getShadowUniformValues()):(L.setupShadows(T.toUnwrapped(),se,"model-tile",T.overscaledZ),S.shadowUniformsInitialized=!0)),ce=ye.shouldRenderCutoff||Se<1||_e.alphaMode!=="OPAQUE"?a.a.alphaBlended:a.a.unblended}g.uploadCommonUniforms(A,se,T.toUnwrapped(),null,ye);const ve=q.material.doubleSided?a.ag.disabled:a.ag.backCCW;if(y.instancedDataArray.length>20)ie.push(y.instancedDataBuffer),se.draw(g,A.gl.TRIANGLES,B,a.ah.disabled,ce,ve,ae,l.id,q.vertexBuffer,q.indexBuffer,q.segments,l.paint,g.transform.zoom,void 0,ie,y.instancedDataArray.length);else{const _e=k?"u_instance":"u_normal_matrix";for(let Re=0;Re<y.instancedDataArray.length;++Re)ae[_e]=new Float32Array(y.instancedDataArray.arrayBuffer,64*Re,16),se.draw(g,A.gl.TRIANGLES,B,a.ah.disabled,ce,ve,ae,l.id,q.vertexBuffer,q.indexBuffer,q.segments,l.paint,g.transform.zoom,void 0,ie)}}if(d.children)for(const q of d.children)Tg(g,l,q,y,b,T,S)}const Eg=[1,-1,1];function go(g,l,d,y){if(!d.modelManager)return!0;const b=d.modelManager;if(!d.shadowRenderer)return!0;const T=d.shadowRenderer,S=l.aabb;let A=!0,k=g.maxHeight;if(k===0){let B=0;for(const U in g.instancesPerModel){const q=b.getModel(U,y);q?B=Math.max(B,Math.max(Math.max(q.aabb.max[0],q.aabb.max[1]),q.aabb.max[2])):A=!1}k=g.maxScale*B*1.41+g.maxVerticalOffset,A&&(g.maxHeight=k)}S.max[2]=k,S.min[2]+=g.terrainElevationMin,S.max[2]+=g.terrainElevationMax,a.$.transformMat4(S.min,S.min,l.tileMatrix),a.$.transformMat4(S.max,S.max,l.tileMatrix);const L=S.intersects(T.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=L===2),L===0}function sa(g,l){const d=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],b=g.uniformValues.u_cutoff_params[2],T=g.uniformValues.u_cutoff_params[3];return y===d||T===b?1:a.au(((l-d)/(y-d)-b)/(T-b),0,1)}function Nb(g,l,d,y){if(l.pitch<20)return 1;const b=l.getWorldToCameraMatrix(),T=a.ae.multiply([],b,g),S=[...d.min,1];let A=a.aB.transformMat4([],S,T),k=A,L=A;S[1]=d.max[1],A=a.aB.transformMat4([],S,T),k=A[1]<k[1]?A:k,L=A[1]>L[1]?A:L,S[0]=d.max[0],A=a.aB.transformMat4([],S,T),k=A[1]<k[1]?A:k,L=A[1]>L[1]?A:L,S[1]=d.min[1],A=a.aB.transformMat4([],S,T),k=A[1]<k[1]?A:k,L=A[1]>L[1]?A:L;const B=a.au(y[0],0,1),U=100*l.pixelsPerMeter*a.au(y[1],0,1),q=a.au(y[2],0,1),H=a.$.lerp([],k,L,B),ie=Math.tan(.5*l.fovX),se=-H[2]*ie;if(U===0)return H[1]<-Math.abs(se)?q:1;const ae=(-Math.abs(se)-H[1])/U,ce=(ve,_e,Re)=>(1-Re)*ve+Re*_e,ye=a.au(ce(1,q,ae),q,1);return ce(1,ye,a.au((l.pitch-20)/20,0,1))}class Td{}class ls{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,d,y){{const U=this._storage.get(d.id);if(U)return U.lastUsedFrameIdx=l,U.buf}const b=y.gl,T=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),S=new ArrayBuffer(T),A=new Int16Array(S);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const k=new a.co;for(let U=0;U<T/2;U+=3){const q=A[U],H=A[U+1],ie=A[U+2];k.emplaceBack(q,H),k.emplaceBack(H,ie),k.emplaceBack(ie,q)}const L=y.bindVertexArrayOES.current,B=new Td;return B.buf=new a.I(y,k),B.lastUsedFrameIdx=l,this._storage.set(d.id,B),y.bindVertexArrayOES.set(L),B.buf}update(l){for(const[d,y]of this._storage)l-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(d))}destroy(){for(const[l,d]of this._storage)d.buf.destroy(),this._storage.delete(l)}}class Ka{constructor(l){this.occluderSize=30,this.depthOffset=-1e-4,l.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Qa={symbol:function(g,l,d,y,b){if(g.renderPass!=="translucent")return;const T=a.ah.disabled,S=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(L,B,U,q,H,ie,se){const ae=B.transform,ce=H==="map",ye=ie==="map";for(const ve of L){const _e=q.getTile(ve),Re=_e.getBucket(U);if(!Re||!Re.text||!Re.text.segments.get().length)continue;const Se=a.aE(Re.textSizeData,ae.zoom),Ie=g0(ve,Re.getProjection(),ae),ze=ae.calculatePixelsToTileUnitsMatrix(_e),Ne=Jc(Ie,_e.tileID.canonical,ye,ce,ae,Re.getProjection(),ze),We=Re.hasIconTextFit()&&Re.hasIconData();if(Se){const Fe=Math.pow(2,ae.zoom-_e.tileID.overscaledZ);gA(Re,ce,ye,se,a.bQ,ae,Ne,ve,Fe,Se,We)}}}(y,g,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b);const A=d.paint.get("icon-opacity").constantOr(1)!==0,k=d.paint.get("text-opacity").constantOr(1)!==0;d.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(A||k)?cp(g,l,d,y,T,S):(A&&cp(g,l,d,y,T,S,{onlyIcons:!0}),k&&cp(g,l,d,y,T,S,{onlyText:!0})),l.map.showCollisionBoxes&&(kb(g,l,d,y,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),kb(g,l,d,y,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("circle-opacity"),T=d.paint.get("circle-stroke-width"),S=d.paint.get("circle-stroke-opacity"),A=d.layout.get("circle-sort-key").constantOr(1)!==void 0,k=d.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(T.constantOr(1)===0||S.constantOr(1)===0))return;const L=g.context,B=L.gl,U=g.transform,q=g.depthModeForSublayer(0,a.af.ReadOnly),H=a.ah.disabled,ie=g.colorModeForDrapableLayerRenderPass(k),se=U.projection.name==="globe",ae=[a.ak(U.center.lng),a.al(U.center.lat)],ce=[];for(let ve=0;ve<y.length;ve++){const _e=y[ve],Re=l.getTile(_e),Se=Re.getBucket(d);if(!Se||Se.projection.name!==U.projection.name)continue;const Ie=Se.programConfigurations.get(d.id),ze=a.bT(d),Ne=g.isTileAffectedByFog(_e);se&&ze.push("PROJECTION_GLOBE_VIEW"),ze.push("DEPTH_D24"),g.terrain&&U.depthOcclusionForSymbolsAndCircles&&ze.push("DEPTH_OCCLUSION");const We=g.getOrCreateProgram("circle",{config:Ie,defines:ze,overrideFog:Ne}),Fe=Se.layoutVertexBuffer,Pe=Se.globeExtVertexBuffer,et=Se.indexBuffer,Qe=U.projection.createInversionMatrix(U,_e.canonical),Ve={programConfiguration:Ie,program:We,layoutVertexBuffer:Fe,globeExtVertexBuffer:Pe,indexBuffer:et,uniformValues:a.bU(g,_e,Re,Qe,ae,d),tile:Re};if(A){const xt=Se.segments.get();for(const pt of xt)ce.push({segments:new a.b([pt]),sortKey:pt.sortKey,state:Ve})}else ce.push({segments:Se.segments,sortKey:0,state:Ve})}A&&ce.sort((ve,_e)=>ve.sortKey-_e.sortKey);const ye={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const ve of ce){const{programConfiguration:_e,program:Re,layoutVertexBuffer:Se,globeExtVertexBuffer:Ie,indexBuffer:ze,uniformValues:Ne,tile:We}=ve.state,Fe=ve.segments;g.terrain&&g.terrain.setupElevationDraw(We,Re,ye),g.uploadCommonUniforms(L,Re,We.tileID.toUnwrapped()),Re.draw(g,B.TRIANGLES,q,H,ie,a.ag.disabled,Ne,d.id,Se,ze,Fe,d.paint,U.zoom,_e,[Ie])}},heatmap:function(g,l,d,y){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const b=g.context,T=b.gl,S=a.ah.disabled,A=new a.a([T.ONE,T.ONE,T.ONE,T.ONE],a.C.transparent,[!0,!0,!0,!0]);(function(H,ie,se,ae){const ce=H.gl,ye=ie.width*ae,ve=ie.height*ae;H.activeTexture.set(ce.TEXTURE1),H.viewport.set([0,0,ye,ve]);let _e=se.heatmapFbo;if(!_e||_e&&(_e.width!==ye||_e.height!==ve)){_e&&_e.destroy();const Re=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Re),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),_e=se.heatmapFbo=H.createFramebuffer(ye,ve,!0,null),function(Se,Ie,ze,Ne,We,Fe){const Pe=Se.gl;Pe.texImage2D(Pe.TEXTURE_2D,0,Se.extRenderToTextureHalfFloat?Pe.RGBA16F:Pe.RGBA,We,Fe,0,Pe.RGBA,Se.extRenderToTextureHalfFloat?Pe.HALF_FLOAT:Pe.UNSIGNED_BYTE,null),Ne.colorAttachment.set(ze)}(H,0,Re,_e,ye,ve)}else ce.bindTexture(ce.TEXTURE_2D,_e.colorAttachment.get()),H.bindFramebuffer.set(_e.framebuffer)})(b,g,d,g.transform.projection.name==="globe"?.5:.25),b.clear({color:a.C.transparent});const k=g.transform,L=k.projection.name==="globe",B=L?["PROJECTION_GLOBE_VIEW"]:[],U=L?a.ag.frontCCW:a.ag.disabled,q=[a.ak(k.center.lng),a.al(k.center.lat)];for(let H=0;H<y.length;H++){const ie=y[H];if(l.hasRenderableParent(ie))continue;const se=l.getTile(ie),ae=se.getBucket(d);if(!ae||ae.projection.name!==k.projection.name)continue;const ce=g.isTileAffectedByFog(ie),ye=ae.programConfigurations.get(d.id),ve=g.getOrCreateProgram("heatmap",{config:ye,defines:B,overrideFog:ce}),{zoom:_e}=g.transform;g.terrain&&g.terrain.setupElevationDraw(se,ve),g.uploadCommonUniforms(b,ve,ie.toUnwrapped());const Re=k.projection.createInversionMatrix(k,ie.canonical);ve.draw(g,T.TRIANGLES,a.af.disabled,S,A,U,Ab(g,ie,se,Re,q,_e,d.paint.get("heatmap-intensity")),d.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,d.paint,g.transform.zoom,ye,L?[ae.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,T){const S=b.context,A=S.gl,k=T.heatmapFbo;if(!k)return;S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,k.colorAttachment.get()),S.activeTexture.set(A.TEXTURE1);let L=T.colorRampTexture;L||(L=T.colorRampTexture=new a.T(S,T.colorRamp,A.RGBA)),L.bind(A.LINEAR,A.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,A.TRIANGLES,a.af.disabled,a.ah.disabled,b.colorModeForRenderPass(),a.ag.disabled,((B,U,q,H)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,T),T.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,T.paint,b.transform.zoom)}(g,d))},line:function(g,l,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("line-opacity"),T=d.paint.get("line-width");if(b.constantOr(1)===0||T.constantOr(1)===0)return;const S=d.paint.get("line-emissive-strength"),A=d.paint.get("line-occlusion-opacity"),k=g.context,L=k.gl,B=d.layout.get("line-z-offset"),U=!B.isConstant()||!!B.constantOr(0),q=U?new a.af(g.depthOcclusion?L.GREATER:L.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly),H=g.colorModeForDrapableLayerRenderPass(S),ie=g.terrain&&g.terrain.renderingToTexture,se=ie?1:a.e.devicePixelRatio,ae=d.paint.get("line-dasharray"),ce=ae.constantOr(1),ye=d.layout.get("line-cap"),ve=ae.constantOr(null),_e=ye.constantOr(null),Re=d.paint.get("line-pattern"),Se=Re.constantOr(1),Ie=Re.constantOr(null),ze=d.paint.get("line-opacity").constantOr(1);let Ne=!Se&&ze!==1||g.depthOcclusion&&A>0&&A<1;const We=d.paint.get("line-gradient"),Fe=Se?"linePattern":"line",Pe=a.bV(d);let et;if(ie&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Ne=!1),A!==0&&g.depthOcclusion){const Ve=d.paint._values["line-opacity"];Ve&&Ve.value&&Ve.value.kind==="constant"?et=Ve.value:a.w(`Occlusion opacity for layer ${d.id} is supported only when line-opacity isn't data-driven.`)}if(U&&(g.forceTerrainMode=!0),!U&&A!==0&&g.terrain&&!ie)return void a.w(`Occlusion opacity for layer ${d.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Qe=Ne&&U?g.stencilModeFor3D():a.ah.disabled;for(const Ve of y){const xt=l.getTile(Ve);if(Se&&!xt.patternsLoaded())continue;const pt=xt.getBucket(d);if(!pt)continue;g.prepareDrawTile();const He=pt.programConfigurations.get(d.id),it=g.isTileAffectedByFog(Ve),Be=g.getOrCreateProgram(Fe,{config:He,defines:U?[...Pe,"ELEVATED"]:Pe,overrideFog:it});if(Ie&&xt.imageAtlas){const Ht=xt.imageAtlas.patternPositions[Ie.toString()];Ht&&He.setConstantPatternPositions(Ht)}if(!Se&&ve&&_e&&xt.lineAtlas){const Ht=xt.lineAtlas.getDash(ve,_e);Ht&&He.setConstantPatternPositions(Ht)}let[mt,_t]=d.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&mt!==_t&&(mt===0&&(mt-=1),_t===1&&(_t+=1));const Bt=ie?Ve.projMatrix:null,Vt=Se?a.bW(g,xt,d,Bt,se,[mt,_t]):a.bX(g,xt,d,Bt,pt.lineClipsArray.length,se,[mt,_t]);if(We){const Ht=pt.gradients[d.id];let vn=Ht.texture;if(d.gradientVersion!==Ht.version){let Fn=256;if(d.stepInterpolant){const bn=l.getSource().maxzoom,$n=Ve.canonical.z===bn?Math.ceil(1<<g.transform.maxZoom-Ve.canonical.z):1;Fn=a.au(a.bY(pt.maxLineLength/a.a4*1024*$n),256,k.maxTextureSize)}Ht.gradient=a.bZ({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Fn,image:Ht.gradient||void 0,clips:pt.lineClipsArray}),Ht.texture?Ht.texture.update(Ht.gradient):Ht.texture=new a.T(k,Ht.gradient,L.RGBA),Ht.version=d.gradientVersion,vn=Ht.texture}k.activeTexture.set(L.TEXTURE1),vn.bind(d.stepInterpolant?L.NEAREST:L.LINEAR,L.CLAMP_TO_EDGE)}ce&&(k.activeTexture.set(L.TEXTURE0),xt.lineAtlasTexture&&xt.lineAtlasTexture.bind(L.LINEAR,L.REPEAT),He.updatePaintBuffers()),Se&&(k.activeTexture.set(L.TEXTURE0),xt.imageAtlasTexture&&xt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),He.updatePaintBuffers()),U&&g.terrain.setupElevationDraw(xt,Be),g.uploadCommonUniforms(k,Be,Ve.toUnwrapped());const rn=Ht=>{et!=null&&(et.value=ze*A),Be.draw(g,L.TRIANGLES,q,Ht,H,a.ag.disabled,Vt,d.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,d.paint,g.transform.zoom,He,[pt.layoutVertexBuffer2,pt.patternVertexBuffer,pt.zOffsetVertexBuffer]),et!=null&&(et.value=ze)};if(Ne&&!U){const Ht=g.stencilModeForClipping(Ve).ref;Ht===0&&ie&&k.clear({stencil:0});const vn={func:L.EQUAL,mask:255};Vt.u_alpha_discard_threshold=.8,rn(new a.ah(vn,Ht,255,L.KEEP,L.KEEP,L.INVERT)),Vt.u_alpha_discard_threshold=0,rn(new a.ah(vn,Ht,255,L.KEEP,L.KEEP,L.KEEP))}else Ne&&U&&(Vt.u_alpha_discard_threshold=.001),rn(U?Qe:g.stencilModeForClipping(Ve))}Ne&&(g.resetStencilClippingMasks(),ie&&k.clear({stencil:0})),A===0||g.depthOcclusion||ie||g.layersWithOcclusionOpacity.push(g.currentLayer),U&&(g.forceTerrainMode=!1)},fill:function(g,l,d,y){const b=d.paint.get("fill-color"),T=d.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const S=d.paint.get("fill-emissive-strength"),A=g.colorModeForDrapableLayerRenderPass(S),k=d.paint.get("fill-pattern"),L=g.opaquePassEnabledForLayer()&&!k.constantOr(1)&&b.constantOr(a.C.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===L){const B=g.depthModeForSublayer(1,g.renderPass==="opaque"?a.af.ReadWrite:a.af.ReadOnly);up(g,l,d,y,B,A,!1)}if(g.renderPass==="translucent"&&d.paint.get("fill-antialias")){const B=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,a.af.ReadOnly);up(g,l,d,y,B,A,!0)}},"fill-extrusion":function(g,l,d,y){const b=d.paint.get("fill-extrusion-opacity"),T=g.context,S=T.gl,A=g.terrain,k=A&&A.renderingToTexture;if(b===0)return;const L=g.conflationActive&&g.style.isLayerClipped(d,l.getSource()),B=g.style.order.indexOf(d.fqid);if(L&&function(U,q,H,ie,se){for(const ae of ie){const ce=q.getTile(ae).getBucket(H);ce&&(ce.updateReplacement(ae,U.replacementSource,se),ce.uploadCentroid(U.context))}}(g,l,d,y,B),A||L)for(const U of y){const q=l.getTile(U).getBucket(d);q&&_A(g.context,l,U,q,d,A,L)}if(g.renderPass==="shadow"&&g.shadowRenderer){const U=g.shadowRenderer;if(A&&b<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.Z)return;const q=U.getShadowPassDepthMode(),H=U.getShadowPassColorMode();sh(g,l,d,y,q,a.ah.disabled,H,L)}else if(g.renderPass==="translucent"){const U=!d.paint.get("fill-extrusion-pattern").constantOr(1),q=d.paint.get("fill-extrusion-color").constantOr(a.C.white);if(!k&&q.a!==0){const H=new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D);b===1&&U?sh(g,l,d,y,H,a.ah.disabled,a.a.unblended,L):(sh(g,l,d,y,H,a.ah.disabled,a.a.disabled,L),sh(g,l,d,y,H,g.stencilModeFor3D(),g.colorModeForRenderPass(),L),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&U&&(!A&&g.transform.projection.name!=="globe"||k)){const H=d.paint.get("fill-extrusion-opacity"),ie=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),se=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ae=d.paint.get("fill-extrusion-flood-light-intensity"),ce=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(d.lut).toArray01().slice(0,3),ye=ie>0&&se>0,ve=ae>0,_e=(Se,Ie,ze)=>(1-ze)*Se+ze*Ie,Re=Se=>{const Ie=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!0),ze=d.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=_e(.1,3,ze),We=g._showOverdrawInspector;if(!We){const Fe=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Pe=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);vd(g,l,d,y,Ie,Fe,Pe,a.ag.disabled,Se,"sdf",H,ie,se,ae,ce,Ne,L,!1)}{const Fe=We?a.ah.disabled:new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Pe=We?g.colorModeForRenderPass():new a.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],a.C.transparent,[!0,!0,!0,!0]);vd(g,l,d,y,Ie,Fe,Pe,a.ag.disabled,Se,"color",H,ie,se,ae,ce,Ne,L,!1)}};if(k){const Se=(Ie,ze,Ne)=>{const We=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!1),Fe=d.paint.get(Ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pe=_e(.1,3,Fe);{const et=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0]);vd(g,l,d,y,We,a.ah.disabled,et,a.ag.disabled,Ie,"clear",H,ie,se,ae,ce,Pe,L,ze)}{const et=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Qe=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);vd(g,l,d,y,We,et,Qe,a.ag.disabled,Ie,"sdf",H,ie,se,ae,ce,Pe,L,ze)}{const et=Ie?S.ZERO:S.ONE_MINUS_DST_ALPHA,Qe=new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ve=new a.a([et,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],a.C.transparent,[!0,!0,!0,!0]);vd(g,l,d,y,We,Qe,Ve,a.ag.disabled,Ie,"color",H,ie,se,ae,ce,Pe,L,ze)}{const et=new a.a([S.ONE,S.ONE,S.ONE,Ie?S.ZERO:S.ONE],a.C.transparent,[!1,!1,!1,!0],Ie?S.FUNC_ADD:S.MAX);vd(g,l,d,y,We,a.ah.disabled,et,a.ag.disabled,Ie,"clear",H,ie,se,ae,ce,Pe,L,ze,Ne)}};if(ye||ve){let Ie;if(g.prepareDrawTile(),A){const ze=A.drapeBufferSize[0],Ne=A.drapeBufferSize[1];Ie=A.framebufferCopyTexture,Ie&&(!Ie||Ie.size[0]===ze&&Ie.size[1]===Ne)||(Ie&&Ie.destroy(),Ie=A.framebufferCopyTexture=new a.T(T,new a.j({width:ze,height:Ne}),S.RGBA)),Ie.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,ze,Ne,0)}ye&&Se(!0,!1,Ie),ve&&Se(!1,!0,Ie)}}else ye&&Re(!0),ve&&Re(!1),(ye||ve)&&g.resetStencilClippingMasks()}}},hillshade:function(g,l,d,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const b=g.context,T=g.terrain&&g.terrain.renderingToTexture,[S,A]=g.renderPass!=="translucent"||T?[{},y]:g.stencilConfigForOverlap(y);for(const k of A){const L=l.getTile(k);if(L.needsHillshadePrepare&&g.renderPass==="offscreen")u0(g,L,d);else if(g.renderPass==="translucent"){const B=g.depthModeForSublayer(0,a.af.ReadOnly),U=d.paint.get("hillshade-emissive-strength"),q=g.colorModeForDrapableLayerRenderPass(U),H=T&&g.terrain?g.terrain.stencilModeForRTTOverlap(k):S[k.overscaledZ];Xc(g,k,L,d,B,H,q)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,d,y,b,T){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const S=g.transform.projection.name==="globe",A=d.paint.get("raster-elevation")!==0,k=A&&S;if(g.renderElevatedRasterBackface&&!k)return;const L=g.context,B=L.gl,U=l.getSource(),q=function(Se,Ie,ze,Ne){const We=Ie.paint.get("raster-color"),Fe=Se.type==="raster-array",Pe=[],et=Ie.paint.get("raster-resampling"),Qe=Ie.paint.get("raster-color-mix");let Ve=Ie.paint.get("raster-color-range");const xt=[Qe[0],Qe[1],Qe[2],0],pt=Qe[3];let He=et==="nearest"?Ne.NEAREST:Ne.LINEAR;if(Fe&&(Pe.push("RASTER_ARRAY"),We||Pe.push("RASTER_COLOR"),et==="linear"&&Pe.push("RASTER_ARRAY_LINEAR"),He=Ne.NEAREST,!Ve&&Se.rasterLayers)){const it=Se.rasterLayers.find(({id:Be})=>Be===Ie.sourceLayer);it&&it.fields&&it.fields.range&&(Ve=it.fields.range)}if(Ve=Ve||[0,1],We){Pe.push("RASTER_COLOR"),ze.activeTexture.set(Ne.TEXTURE2),Ie.updateColorRamp(Ve);let it=Ie.colorRampTexture;it||(it=Ie.colorRampTexture=new a.T(ze,Ie.colorRamp,Ne.RGBA)),it.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}return{mix:xt,range:Ve,offset:pt,defines:Pe,resampling:He}}(U,d,L,B);if(U instanceof a.bo&&!y.length&&!S)return;const H=d.paint.get("raster-emissive-strength"),ie=g.colorModeForDrapableLayerRenderPass(H),se=g.terrain&&g.terrain.renderingToTexture,ae=!g.options.moving,ce=d.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(U instanceof a.bo&&!y.length&&(U.onNorthPole||U.onSouthPole)){const Se=A?g.stencilModeFor3D():a.ah.disabled;return void vg(!!U.onNorthPole,null,g,l,d,H,q,a.ag.disabled,Se)}if(!y.length)return;const[ye,ve]=U instanceof a.bo||se?[{},y]:g.stencilConfigForOverlap(y),_e=ve[ve.length-1].overscaledZ;k&&q.defines.push("PROJECTION_GLOBE_VIEW"),A&&q.defines.push("RENDER_CUTOFF");const Re=(Se,Ie,ze)=>{for(const Ne of Se){const We=Ne.toUnwrapped(),Fe=l.getTile(Ne);if(se&&(!Fe||!Fe.hasData()))continue;L.activeTexture.set(B.TEXTURE0);const Pe=oh(Fe,U,d,q);if(!Pe||!Pe.texture)continue;const{texture:et,mix:Qe,offset:Ve,tileSize:xt,buffer:pt}=Pe;let He,it;se?(He=a.af.disabled,it=Ne.projMatrix):A?(He=new a.af(B.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),it=S?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(We,ae)):(He=g.depthModeForSublayer(Ne.overscaledZ-_e,d.paint.get("raster-opacity")===1?a.af.ReadWrite:a.af.ReadOnly,B.LESS),it=g.transform.calculateProjMatrix(We,ae));const Be=g.terrain&&se?g.terrain.stencilModeForRTTOverlap(Ne):ye[Ne.overscaledZ],mt=T?0:d.paint.get("raster-fade-duration");Fe.registerFadeDuration(mt);const _t=l.findLoadedParent(Ne,0),Bt=Xa(Fe,_t,l,g.transform,mt);let Vt,rn;g.terrain&&g.terrain.prepareDrawTile(),L.activeTexture.set(B.TEXTURE0),et.bind(ce,B.CLAMP_TO_EDGE),L.activeTexture.set(B.TEXTURE1),_t?(_t.texture&&_t.texture.bind(ce,B.CLAMP_TO_EDGE),Vt=Math.pow(2,_t.tileID.overscaledZ-Fe.tileID.overscaledZ),rn=[Fe.tileID.canonical.x*Vt%1,Fe.tileID.canonical.y*Vt%1]):et.bind(ce,B.CLAMP_TO_EDGE),et.useMipmap&&L.extTextureFilterAnisotropic&&g.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Ht=g.transform;let vn;const Fn=A?y0(Ht):[0,0,0,0];let bn,$n,hr,Xr,Lr,pr=0;if(k&&U instanceof a.bo&&U.coordinates.length>3)bn=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0)))),$n=Float32Array.from(Ht.globeMatrix),hr=Float32Array.from(a.bd(Ht)),Xr=[a.ak(Ht.center.lng),a.al(Ht.center.lat)],vn=U.elevatedGlobePerspectiveTransform,Lr=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){const Bn=a.be(Ne.canonical);pr=a.bf(Bn.getCenter().lat),bn=Float32Array.from(a.bh(a.bi(Ne.canonical))),$n=Float32Array.from(Ht.globeMatrix),hr=Float32Array.from(a.bd(Ht)),Xr=[a.ak(Ht.center.lng),a.al(Ht.center.lat)],vn=[0,0],Lr=Float32Array.from(a.bg(Ne.canonical,Bn,pr,Ht.worldSize/Ht._pixelsPerMercatorPixel))}else vn=U instanceof a.bo?U.perspectiveTransform:[0,0],bn=new Float32Array(16),$n=new Float32Array(9),hr=new Float32Array(16),Xr=[0,0],Lr=new Float32Array(9);const Or=_g(it,bn,$n,hr,Lr,rn||[0,0],a.a2(g.transform.zoom),Xr,Fn,Vt||1,Bt,d,vn,A?d.paint.get("raster-elevation"):0,2,Qe,Ve,q.range,xt,pt,H),Hn=g.isTileAffectedByFog(Ne),Yn=g.getOrCreateProgram("raster",{defines:q.defines,overrideFog:Hn});if(g.uploadCommonUniforms(L,Yn,We),U instanceof a.bo){const Bn=U.elevatedGlobeVertexBuffer,xr=U.elevatedGlobeIndexBuffer;if(se||!S)U.boundsBuffer&&U.boundsSegments&&Yn.draw(g,B.TRIANGLES,He,a.ah.disabled,ie,a.ag.disabled,Or,d.id,U.boundsBuffer,g.quadTriangleIndexBuffer,U.boundsSegments);else if(Bn&&xr){const tr=Ht.zoom<=a.b3?U.elevatedGlobeSegments:U.getSegmentsForLongitude(Ht.center.lng);tr&&Yn.draw(g,B.TRIANGLES,He,a.ah.disabled,ie,Ie,Or,d.id,Bn,xr,tr)}}else if(k){He=new a.af(B.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D);const Bn=g.globeSharedBuffers;if(Bn){const[xr,tr,In]=Bn.getGridBuffers(pr,!1);Yn.draw(g,B.TRIANGLES,He,ze||Be,g.colorModeForRenderPass(),Ie,Or,d.id,xr,tr,In)}}else{const{tileBoundsBuffer:Bn,tileBoundsIndexBuffer:xr,tileBoundsSegments:tr}=g.getTileBoundsBuffers(Fe);Yn.draw(g,B.TRIANGLES,He,Be,ie,a.ag.disabled,Or,d.id,Bn,xr,tr)}}if(!(U instanceof a.bo)&&k)for(const Ne of Se){const We=Ne.canonical.y===(1<<Ne.canonical.z)-1;Ne.canonical.y===0&&vg(!0,Ne,g,l,d,H,q,Ie,ze||a.ah.disabled),We&&vg(!1,Ne,g,l,d,H,q,Ie===a.ag.frontCW?a.ag.backCW:a.ag.frontCW,ze||a.ah.disabled)}};k?Re(ve,g.renderElevatedRasterBackface?a.ag.backCW:a.ag.frontCW,g.stencilModeFor3D()):Re(ve,a.ag.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,l,d,y,b,T){g.renderPass==="offscreen"&&function(S,A,k,L){if(!L.length)return;const B=S.context,U=B.gl,q=A.getSource();if(!(q instanceof R))return;const H=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count")));let ie=k.particlePositionRGBAImage;if(!ie||ie.width!==H){const ve=function(_e){const Re=_e*_e,Se=new Uint8Array(4*Re),Ie=function(Ne){return Ne|=0,Ne=Math.imul(2747636419^Ne,2654435769),Ne=Math.imul(Ne^Ne>>>16,2654435769),((Ne=Math.imul(Ne^Ne>>>16,2654435769))>>>0)/4294967296},ze=1/1.1;for(let Ne=0;Ne<Re;Ne++){const We=ze*(Ie(2*Ne+0)+Sl),Fe=ze*(Ie(2*Ne+1)+Sl),Pe=255*We%1,et=255*Fe%1,Qe=Pe,Ve=Fe-et/255,xt=et;Se[4*Ne+0]=255*(We-Pe/255),Se[4*Ne+1]=255*Qe,Se[4*Ne+2]=255*Ve,Se[4*Ne+3]=255*xt}return Se}(H);ie=k.particlePositionRGBAImage=new a.j({width:H,height:H},ve)}let se=k.particleFramebuffer;se?se.width!==H&&(se.destroy(),se=k.particleFramebuffer=B.createFramebuffer(H,H,!0,null)):se=k.particleFramebuffer=B.createFramebuffer(H,H,!0,null);const ae=[];for(const ve of L){const _e=A.getTile(ve);if(!(_e instanceof a.c5))continue;const Re=zb(_e,q,k);if(!Re)continue;const Se=[_e.tileSize,_e.tileSize];let Ie=k.tileFramebuffer;Ie||(Ie=k.tileFramebuffer=B.createFramebuffer(Se[0],Se[1],!0,null));let ze=_e.rasterParticleState;ze||(ze=_e.rasterParticleState=new ir(B,ve,Se,ie));const Ne=ze.update(k.lastInvalidatedAt);ze.particleTextureDimension!==H&&ze.updateParticleTexture(ve,ie);const We=ze.targetColorTexture;ze.targetColorTexture=ze.backgroundColorTexture,ze.backgroundColorTexture=We;const Fe=ze.particleTexture0;ze.particleTexture0=ze.particleTexture1,ze.particleTexture1=Fe,ae.push([ve,Re,ze,Ne])}if(ae.length===0)return;const ce=a.e.now(),ye=k.previousDrawTimestamp?.001*(ce-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=ce,k.hasColorMap()){B.activeTexture.set(U.TEXTURE0+2);let ve=k.colorRampTexture;ve||(ve=k.colorRampTexture=new a.T(B,k.colorRamp,U.RGBA)),ve.bind(U.LINEAR,U.CLAMP_TO_EDGE)}B.bindFramebuffer.set(k.tileFramebuffer.framebuffer),function(ve,_e,Re){const Se=ve.context,Ie=Se.gl,ze=_e.tileFramebuffer;Se.activeTexture.set(Ie.TEXTURE0);const Ne={u_texture:0,u_opacity:1.05*(Fe=_e.paint.get("raster-particle-fade-opacity-factor"))/(Fe+.05)},We=ve.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Fe;for(const Pe of Re){const[,,et,Qe]=Pe;ze.colorAttachment.set(et.targetColorTexture.texture),Se.viewport.set([0,0,ze.width,ze.height]),Se.clear({color:a.C.transparent}),Qe&&(et.backgroundColorTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE),We.draw(ve,Ie.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,Ne,_e.id,ve.viewportBuffer,ve.quadTriangleIndexBuffer,ve.viewportSegments))}}(S,k,ae),function(ve,_e,Re,Se){const Ie=ve.context,ze=Ie.gl,Ne=Re.tileFramebuffer,We=ve.transform.projection.name==="globe",Fe=Re.paint.get("raster-particle-max-speed");for(const Pe of Se){const[et,Qe,Ve]=Pe;Ie.activeTexture.set(ze.TEXTURE0+0),Qe.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Ne.colorAttachment.set(Ve.targetColorTexture.texture);const xt=ve.getOrCreateProgram("rasterParticleDraw",{defines:Qe.defines,overrideFog:!1});Ie.activeTexture.set(ze.TEXTURE0+1);const pt=Qe.scalarData?[]:[0,1,2,3].map(Be=>a.b$[Be](et));pt.push(et);const He=et.canonical.x,it=et.canonical.y;for(const Be of pt){const mt=_e.getTile(We?Be.wrapped():Be);if(!mt)continue;const _t=mt.rasterParticleState;if(!_t)continue;const Bt=Be.canonical.x+(1<<Be.canonical.z)*(Be.wrap-et.wrap),Vt=Be.canonical.y;_t.particleTexture0.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const rn=pA(1,_t.particleTexture0.size[0],[Bt-He,Vt-it],0,Qe.texture.size,2,Fe,Qe.textureOffset,Qe.scale,Qe.offset);xt.draw(ve,ze.POINTS,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,rn,Re.id,_t.particleIndexBuffer,void 0,_t.particleSegment)}}}(S,A,k,ae),B.bindFramebuffer.set(k.particleFramebuffer.framebuffer),function(ve,_e,Re,Se){const Ie=ve.context,ze=Ie.gl,Ne=_e.paint.get("raster-particle-max-speed"),We=Se*_e.paint.get("raster-particle-speed-factor")*.15,Fe=function(et){return Math.pow(et,6)}(.01+1*_e.paint.get("raster-particle-reset-rate-factor")),Pe=_e.particleFramebuffer;Ie.viewport.set([0,0,Pe.width,Pe.height]);for(const et of Re){const[,Qe,Ve]=et;Ie.activeTexture.set(ze.TEXTURE0+0),Qe.texture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Ie.activeTexture.set(ze.TEXTURE0+1);const xt=Ve.particleTexture0;xt.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);const pt=Pb(1,xt.size[0],0,Qe.texture.size,Ne,We,Fe,Qe.textureOffset,Qe.scale,Qe.offset);Pe.colorAttachment.set(Ve.particleTexture1.texture),Ie.clear({color:a.C.transparent}),ve.getOrCreateProgram("rasterParticleUpdate",{defines:Qe.defines}).draw(ve,ze.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,pt,_e.id,ve.viewportBuffer,ve.quadTriangleIndexBuffer,ve.viewportSegments)}}(S,k,ae,ye)}(g,l,d,y),g.renderPass==="translucent"&&(function(S,A,k,L,B){const U=S.context,q=U.gl,H=A.getSource().tileSize,ie=5*(1-a.a0(a.aV,a.aV+1,S.transform.zoom))*H+k.paint.get("raster-particle-elevation"),se=!S.options.moving,ae=S.transform.projection.name==="globe";if(!L.length)return;const[ce,ye]=S.stencilConfigForOverlap(L),ve=[];ae&&ve.push("PROJECTION_GLOBE_VIEW");const _e=S.stencilModeFor3D();for(const Re of ye){const Se=Re.toUnwrapped(),Ie=A.getTile(Re);if(!Ie.rasterParticleState)continue;const ze=Ie.rasterParticleState,Ne=100;Ie.registerFadeDuration(Ne);const We=A.findLoadedParent(Re,0),Fe=Xa(Ie,We,A,S.transform,Ne);let Pe,et;S.terrain&&S.terrain.prepareDrawTile(),U.activeTexture.set(q.TEXTURE0),ze.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),U.activeTexture.set(q.TEXTURE1),We&&We.rasterParticleState?(We.rasterParticleState.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Pe=Math.pow(2,We.tileID.overscaledZ-Ie.tileID.overscaledZ),et=[Ie.tileID.canonical.x*Pe%1,Ie.tileID.canonical.y*Pe%1]):ze.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const Qe=ae?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Se,se),Ve=S.transform,xt=xg(Ve),pt=a.be(Re.canonical),He=a.bf(pt.getCenter().lat);let it,Be,mt,_t,Bt;ae?(it=Float32Array.from(a.bh(a.bi(Re.canonical))),Be=Float32Array.from(Ve.globeMatrix),mt=Float32Array.from(a.bd(Ve)),_t=[a.ak(Ve.center.lng),a.al(Ve.center.lat)],Bt=Float32Array.from(a.bg(Re.canonical,pt,He,Ve.worldSize/Ve._pixelsPerMercatorPixel))):(it=new Float32Array(16),Be=new Float32Array(9),mt=new Float32Array(16),_t=[0,0],Bt=new Float32Array(9));const Vt=nh(Qe,it,Be,mt,Bt,et||[0,0],a.a2(S.transform.zoom),_t,xt,Pe||1,Fe,ie),rn=S.isTileAffectedByFog(Re),Ht=S.getOrCreateProgram("rasterParticle",{defines:ve,overrideFog:rn});if(S.uploadCommonUniforms(U,Ht,Se),ae){const vn=new a.af(q.LEQUAL,a.af.ReadOnly,S.depthRangeFor3D),Fn=0,bn=S.globeSharedBuffers;if(bn){const[$n,hr,Xr]=bn.getGridBuffers(He,Fn!==0);Ht.draw(S,q.TRIANGLES,vn,_e,a.a.alphaBlended,S.renderElevatedRasterBackface?a.ag.frontCCW:a.ag.backCCW,Vt,k.id,$n,hr,Xr)}}else{const vn=S.depthModeForSublayer(0,a.af.ReadOnly),Fn=ce[Re.overscaledZ],{tileBoundsBuffer:bn,tileBoundsIndexBuffer:$n,tileBoundsSegments:hr}=S.getTileBoundsBuffers(Ie);Ht.draw(S,q.TRIANGLES,vn,Fn,a.a.alphaBlended,a.ag.disabled,Vt,k.id,bn,$n,hr)}}S.resetStencilClippingMasks()}(g,l,d,y),g.style.map.triggerRepaint())},background:function(g,l,d,y){const b=d.paint.get("background-color"),T=d.paint.get("background-opacity"),S=d.paint.get("background-emissive-strength");if(T===0)return;const A=g.context,k=A.gl,L=g.transform,B=L.tileSize,U=d.paint.get("background-pattern");let q;if(U!==void 0&&(U===null||(q=g.imageManager.getPattern(U.toString(),d.scope,g.style.getLut(d.scope)),!q)))return;const H=!U&&b.a===1&&T===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==H)return;const ie=a.ah.disabled,se=g.depthModeForSublayer(0,H==="opaque"?a.af.ReadWrite:a.af.ReadOnly),ae=g.colorModeForDrapableLayerRenderPass(S),ce=U?"backgroundPattern":"background";let ye,ve=y;ve||(ye=g.getBackgroundTiles(),ve=Object.values(ye).map(_e=>_e.tileID)),U&&(A.activeTexture.set(k.TEXTURE0),g.imageManager.bind(g.context,d.scope));for(const _e of ve){const Re=g.isTileAffectedByFog(_e),Se=g.getOrCreateProgram(ce,{overrideFog:Re}),Ie=_e.toUnwrapped(),ze=y?_e.projMatrix:g.transform.calculateProjMatrix(Ie);g.prepareDrawTile();const Ne=l?l.getTile(_e):ye?ye[_e.key]:new a.bA(_e,B,L.zoom,g),We=U?mA(ze,S,T,g,0,d.scope,q,{tileID:_e,tileSize:B}):p0(ze,S,T,b.toRenderColor(d.lut));g.uploadCommonUniforms(A,Se,Ie);const{tileBoundsBuffer:Fe,tileBoundsIndexBuffer:Pe,tileBoundsSegments:et}=g.getTileBoundsBuffers(Ne);Se.draw(g,k.TRIANGLES,se,ie,ae,a.ag.disabled,We,d.id,Fe,Pe,et)}},sky:function(g,l,d){const y=g._atmosphere?a.a2(g.transform.zoom):1,b=d.paint.get("sky-opacity")*y;if(b===0)return;const T=g.context,S=d.paint.get("sky-type"),A=new a.af(T.gl.LEQUAL,a.af.ReadOnly,[0,1]),k=g.frameCounter/1e3%1;S==="atmosphere"?g.renderPass==="offscreen"?d.needsSkyboxCapture(g)&&(function(L,B,U,q){const H=L.context,ie=H.gl;let se=B.skyboxFbo;if(!se){se=B.skyboxFbo=H.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new Jt(H),B.skyboxTexture=H.gl.createTexture(),ie.bindTexture(ie.TEXTURE_CUBE_MAP,B.skyboxTexture),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MAG_FILTER,ie.LINEAR);for(let ve=0;ve<6;++ve)ie.texImage2D(ie.TEXTURE_CUBE_MAP_POSITIVE_X+ve,0,ie.RGBA,32,32,0,ie.RGBA,ie.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(se.framebuffer),H.viewport.set([0,0,32,32]);const ae=B.getCenter(L,!0),ce=L.getOrCreateProgram("skyboxCapture"),ye=new Float64Array(16);a.ae.identity(ye),a.ae.rotateY(ye,ye,.5*-Math.PI),yr(L,B,ce,ye,ae,0),a.ae.identity(ye),a.ae.rotateY(ye,ye,.5*Math.PI),yr(L,B,ce,ye,ae,1),a.ae.identity(ye),a.ae.rotateX(ye,ye,.5*-Math.PI),yr(L,B,ce,ye,ae,2),a.ae.identity(ye),a.ae.rotateX(ye,ye,.5*Math.PI),yr(L,B,ce,ye,ae,3),a.ae.identity(ye),yr(L,B,ce,ye,ae,4),a.ae.identity(ye),a.ae.rotateY(ye,ye,Math.PI),yr(L,B,ce,ye,ae,5),H.viewport.set([0,0,L.width,L.height])}(g,d),d.markSkyboxValid(g)):g.renderPass==="sky"&&function(L,B,U,q,H){const ie=L.context,se=ie.gl,ae=L.transform,ce=L.getOrCreateProgram("skybox");ie.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,B.skyboxTexture);const ye=((ve,_e,Re,Se,Ie)=>({u_matrix:ve,u_sun_direction:_e,u_cubemap:0,u_opacity:Se,u_temporal_offset:Ie}))(ae.skyboxMatrix,B.getCenter(L,!1),0,q,H);L.uploadCommonUniforms(ie,ce),ce.draw(L,se.TRIANGLES,U,a.ah.disabled,L.colorModeForRenderPass(),a.ag.backCW,ye,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(g,d,A,b,k):S==="gradient"&&g.renderPass==="sky"&&function(L,B,U,q,H){const ie=L.context,se=ie.gl,ae=L.transform,ce=L.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Jt(ie)),ie.activeTexture.set(se.TEXTURE0);let ye=B.colorRampTexture;ye||(ye=B.colorRampTexture=new a.T(ie,B.colorRamp,se.RGBA)),ye.bind(se.LINEAR,se.CLAMP_TO_EDGE);const ve=((_e,Re,Se,Ie,ze)=>({u_matrix:_e,u_color_ramp:0,u_center_direction:Re,u_radius:a.ac(Se),u_opacity:Ie,u_temporal_offset:ze}))(ae.skyboxMatrix,B.getCenter(L,!1),B.paint.get("sky-gradient-radius"),q,H);L.uploadCommonUniforms(ie,ce),ce.draw(L,se.TRIANGLES,U,a.ah.disabled,L.colorModeForRenderPass(),a.ag.backCW,ve,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(g,d,A,b,k)},debug:function(g,l,d,y,b,T){for(let S=0;S<d.length;S++)if(b){const L=new a.C(y.r*.8,y.g*.8,y.b*.8,1);xn(g,l,d[S],y,-1,-1,T),xn(g,l,d[S],y,-1,1,T),xn(g,l,d[S],y,1,1,T),xn(g,l,d[S],y,1,-1,T),xn(g,l,d[S],L,0,0,T)}else xn(g,l,d[S],y,0,0,T)},custom:function(g,l,d,y){const b=g.context,T=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&d.isDraped(l)){if(g.renderPass==="offscreen"){const S=T.prerender;if(S){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const A=g.transform.pointMerc;S.call(T,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else S.call(T,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const A=T.renderToTile;if(A){const k=y[0].canonical,L=new a._(k.x+y[0].wrap*(1<<k.z),k.y,k.z);b.setDepthMode(a.af.disabled),b.setStencilMode(a.ah.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),A.call(T,b.gl,L),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(a.ah.disabled);const S=T.renderingMode==="3d"?new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly);if(b.setDepthMode(S),g.transform.projection.name==="globe"){const A=g.transform.pointMerc;T.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else T.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,l,d,y){if(g.renderPass==="opaque")return;const b=d.paint.get("model-opacity");if(b===0)return;const T=d.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!T||g.terrain&&b<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof a.Z))return;const S=g.shadowRenderer,A=d.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,A||(S.enabled=!1));const k=()=>{S&&(S.useNormalOffset=!0,A||(S.enabled=!0))},L=l.getSource();if(g.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(ce,ye,ve,_e,Re){const Se=ce.transform;if(Se.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${Se.projection.name} projection is not yet implemented`);const Ie=Se.getFreeCameraOptions().position;if(!ce.modelManager)return;const ze=ce.modelManager;ve.modelManager=ze;const Ne=ce.shadowRenderer;if(!ve._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const We=ve._unevaluatedLayout._values["model-id"],Fe={...ve.layout.get("model-id").parameters},Pe=ce.style.order.indexOf(ve.fqid);for(const et of _e){const Qe=ye.getTile(et).getBucket(ve);if(!Qe||Qe.projection.name!==Se.projection.name)continue;const Ve=Qe.getModelUris();Ve&&!Qe.modelsRequested&&(ze.addModelsFromBucket(Ve,Re),Qe.modelsRequested=!0);const xt=pp(et,Se);Fe.zoom=xt;const pt=We.possiblyEvaluate(Fe);if(fp(ce,Qe,et),Ca.shadowUniformsInitialized=!1,Ca.useSingleShadowCascade=!!Ne&&Ne.getMaxCascadeForTile(et.toUnwrapped())===0,ce.renderPass==="shadow"&&Ne){if(ce.currentShadowCascade===1&&Qe.isInsideFirstShadowMapFrustum)continue;const Be=Se.calculatePosMatrix(et.toUnwrapped(),Se.worldSize);if(Ca.tileMatrix.set(Be),Ca.shadowTileMatrix=Float32Array.from(Ne.calculateShadowPassMatrixFromMatrix(Be)),Ca.aabb.min.fill(0),Ca.aabb.max[0]=Ca.aabb.max[1]=a.a4,Ca.aabb.max[2]=0,go(Qe,Ca,ce,ve.scope))continue}const He=1<<et.canonical.z,it=[((Ie.x-et.wrap)*He-et.canonical.x)*a.a4,(Ie.y*He-et.canonical.y)*a.a4,Ie.z*He*a.a4];ce.conflationActive&&Object.keys(Qe.instancesPerModel).length>0&&ce.style.isLayerClipped(ve,ye.getSource())&&Qe.updateReplacement(et,ce.replacementSource,Pe,Re)&&(Qe.uploaded=!1,Qe.upload(ce.context));for(let Be in Qe.instancesPerModel){const mt=Qe.instancesPerModel[Be];mt.features.length>0&&(Be=pt.evaluate(mt.features[0].feature,{}));const _t=ze.getModel(Be,Re);if(_t&&_t.uploaded)for(const Bt of _t.nodes)Tg(ce,ve,Bt,mt,it,et,Ca)}}}(g,l,d,y,L.type==="vector"?d.scope:""),void k();if(!L.loaded())return;if(L.type==="batched-model")return function(ce,ye,ve,_e){ve.resetLayerRenderingStats(ce);const Re=ce.context,Se=ce.transform,Ie=ce.style.fog,ze=ce.shadowRenderer;if(Se.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Se.projection.name} projection is not yet implemented`);const Ne=ce.transform.getFreeCameraOptions().position,We=a.$.scale([],[Ne.x,Ne.y,Ne.z],ce.transform.worldSize);a.$.negate(We,We);const Fe=a.ae.identity([]),Pe=a.ci(Se.center.lat,Se.zoom),et=a.ae.fromScaling([],[1,1,1/Pe]);a.ae.translate(Fe,Fe,We);const Qe=ve.paint.get("model-opacity"),Ve=new a.af(Re.gl.LEQUAL,a.af.ReadWrite,ce.depthRangeFor3D),xt=new a.af(Re.gl.LEQUAL,a.af.ReadOnly,ce.depthRangeFor3D),pt=new a.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),He=ce.renderPass==="shadow",it=He&&ze?ze.getCurrentCascadeFrustum():Se.getFrustum(Se.scaleZoom(Se.worldSize)),Be=ve.paint.get("model-front-cutoff"),mt=Be[2]<1,_t=zs(ce,ve.paint.get("model-cutoff-fade-range")),Bt=ve.getLayerRenderingStats();(function(Vt,rn,Ht,vn){const Fn=Vt.terrain?Vt.terrain.exaggeration():0,bn=Vt.transform.zoom;for(const $n of vn){const hr=rn.getTile($n).getBucket(Ht);hr&&(Vt.conflationActive&&hr.updateReplacement($n,Vt.replacementSource),hr.evaluateScale(Vt,Ht),Vt.terrain&&Fn>0&&hr.elevationUpdate(Vt.terrain,Fn,$n,Ht.source),hr.needsReEvaluation(Vt,bn,Ht)&&hr.evaluate(Ht))}})(ce,ye,ve,_e),function(){let Vt,rn,Ht;mt?(Vt=_e.length-1,rn=-1,Ht=-1):(Vt=0,rn=_e.length,Ht=1);for(let vn=Vt;vn!==rn;vn+=Ht){const Fn=_e[vn],bn=ye.getTile(Fn).getBucket(ve);if(!bn||!bn.uploaded)continue;let $n=!1;ze&&($n=ze.getMaxCascadeForTile(Fn.toUnwrapped())===0);const hr=Se.calculatePosMatrix(Fn.toUnwrapped(),Se.worldSize),Xr=bn.modelTraits,Lr=[];for(const pr of bn.getNodesInfo()){if(pr.hiddenByReplacement||!pr.node.meshes)continue;const Or=pr.node;let Hn=0;ce.terrain&&Or.elevation&&(Hn=Or.elevation*ce.terrain.exaggeration());const Yn=pr.evaluatedScale;if(Yn[0]<=1&&Yn[1]<=1&&Yn[2]<=1&&(()=>{const Gs=pr.aabb;return pt.min=[...Gs.min],pt.max=[...Gs.max],pt.min[2]+=Hn,pt.max[2]+=Hn,a.$.transformMat4(pt.min,pt.min,hr),a.$.transformMat4(pt.max,pt.max,hr),pt})().intersects(it)===0)continue;const Bn=[...hr],xr=Or.anchor?Or.anchor[0]:0,tr=Or.anchor?Or.anchor[1]:0;a.ae.translate(Bn,Bn,[xr*(Yn[0]-1),tr*(Yn[1]-1),Hn]),a.$.exactEquals(Yn,a.cl)||a.ae.scale(Bn,Bn,Yn);const In=a.ae.multiply([],Bn,Or.matrix),Bi=a.ae.multiply([],Se.expandedFarZProjMatrix,In),ji=a.ae.multiply([],Se.expandedFarZProjMatrix,Bn),ro=a.aB.transformMat4([],[xr,tr,Hn,1],Bi)[2];Or.hidden=!1;let io=Qe;He||(mt&&(io*=Nb(Bn,Se,pr.aabb,Be)),io*=sa(_t,ro)),io!==0?Lr.push({nodeInfo:pr,depth:ro,opacity:io,wvpForNode:Bi,wvpForTile:ji,nodeModelMatrix:In,tileModelMatrix:Bn}):Or.hidden=!0}He||Lr.sort((pr,Or)=>!mt||pr.opacity===1&&Or.opacity===1?pr.depth<Or.depth?-1:1:pr.opacity===1?-1:Or.opacity===1?1:pr.depth>Or.depth?-1:1);for(const pr of Lr){const Or=pr.nodeInfo,Hn=Or.node;let Yn=a.ae.multiply([],et,pr.tileModelMatrix);a.ae.multiply(Yn,Fe,Yn);const Bn=a.ae.invert([],Yn);a.ae.transpose(Bn,Bn),a.ae.scale(Bn,Bn,Eg),Yn=a.ae.multiply(Yn,Yn,Hn.matrix);const xr=ce.renderPass==="light-beam",tr=Xr&a.cn.HasMapboxMeshFeatures,In=tr?0:Or.evaluatedRMEA[0][2];for(let Bi=0;Bi<Hn.meshes.length;++Bi){const ji=Hn.meshes[Bi],ro=Bi===Hn.lightMeshIndex;let io=pr.wvpForNode;if(ro){if(!xr&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}io=pr.wvpForTile}else if(xr)continue;const Gs={defines:[]},so=[];if(ah(Gs.defines,so,ji,ce,ve.lut),tr||Gs.defines.push("DIFFUSE_SHADED"),$n&&Gs.defines.push("SHADOWS_SINGLE_CASCADE"),Bt&&(He?Bt.numRenderedVerticesInShadowPass+=ji.vertexArray.length:Bt.numRenderedVerticesInTransparentPass+=ji.vertexArray.length),He){T0(ji,pr.nodeModelMatrix,ce,ve);continue}let Ns=null;if(Ie){const Je=wd(pr.nodeModelMatrix,ce.transform);if(Ns=new Float32Array(Je),Se.projection.name!=="globe"){const gc=ji.aabb.min,Ya=ji.aabb.max,[_c,yc]=Ie.getOpacityForBounds(Je,gc[0],gc[1],Ya[0],Ya[1]);Gs.overrideFog=_c>=_r||yc>=_r}}const Ws=ji.material;let Et;Ws.occlusionTexture&&Ws.occlusionTexture.offsetScale&&(Et=Ws.occlusionTexture.offsetScale,Gs.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!He&&ze&&(ze.useNormalOffset=!!ji.normalBuffer);const on=ce.getOrCreateProgram("model",Gs);!He&&ze&&ze.setupShadowsFromMatrix(pr.tileModelMatrix,on,ze.useNormalOffset),ce.uploadCommonUniforms(Re,on,null,Ns);const _o=Ws.pbrMetallicRoughness;_o.metallicFactor=.9,_o.roughnessFactor=.5;const Vr=rh(new Float32Array(io),new Float32Array(Yn),new Float32Array(Bn),new Float32Array(Hn.matrix),ce,pr.opacity,_o.baseColorFactor.toRenderColor(null),Ws.emissiveFactor,_o.metallicFactor,_o.roughnessFactor,Ws,In,ve,[0,0,0],Et);!ro&&(Or.hasTranslucentParts||pr.opacity<1)&&on.draw(ce,Re.gl.TRIANGLES,Ve,a.ah.disabled,a.a.disabled,a.ag.backCCW,Vr,ve.id,ji.vertexBuffer,ji.indexBuffer,ji.segments,ve.paint,ce.transform.zoom,void 0,so),on.draw(ce,Re.gl.TRIANGLES,ro?xt:Ve,a.ah.disabled,ro||pr.opacity<1||Or.hasTranslucentParts?a.a.alphaBlended:a.a.unblended,a.ag.backCCW,Vr,ve.id,ji.vertexBuffer,ji.indexBuffer,ji.segments,ve.paint,ce.transform.zoom,void 0,so)}}}}()}(g,l,d,y),void k();if(L.type!=="model")return;const B=L.getModels(),U=[],q=g.transform.getFreeCameraOptions().position,H=a.$.scale([],[q.x,q.y,q.z],g.transform.worldSize);a.$.negate(H,H);const ie=[],se=[];let ae=0;for(const ce of B){const ye=d.paint.get("model-rotation").constantOr(null),ve=d.paint.get("model-scale").constantOr(null),_e=d.paint.get("model-translation").constantOr(null);ce.computeModelMatrix(g,ye,ve,_e,!0,!0,!1);const Re=a.ae.identity([]),Se=a.ci(ce.position.lat,g.transform.zoom),Ie=a.ae.fromScaling([],[1,1,1/Se]);a.ae.translate(Re,Re,H),U.push({zScaleMatrix:Ie,negCameraPosMatrix:Re});for(const ze of ce.nodes)ki(g.transform,ze,ce.matrix,g.transform.expandedFarZProjMatrix,ae,ie,se);ae++}if(ie.sort((ce,ye)=>ye.depth-ce.depth),g.renderPass!=="shadow"){if(b===1)for(const ce of se)to(ce,g,d,U[ce.modelIndex],a.ah.disabled,g.colorModeForRenderPass());else{for(const ce of se)to(ce,g,d,U[ce.modelIndex],a.ah.disabled,a.a.disabled);for(const ce of se)to(ce,g,d,U[ce.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const ce of ie)to(ce,g,d,U[ce.modelIndex],a.ah.disabled,g.colorModeForRenderPass());k()}else{for(const ce of se)T0(ce.mesh,ce.nodeModelMatrix,g,d);for(const ce of ie)T0(ce.mesh,ce.nodeModelMatrix,g,d);k()}}},ms={model:function(g,l,d){const y=l.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(d.modelManager&&d.modelManager.upload(d,y.type==="vector"?g.scope:""));if(y.type==="batched-model"||y.type!=="model")return;const b=y.getModels();for(const T of b)T.upload(d.context)},raster:function(g,l,d){const y=l.getSource();if(!(y instanceof R&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=g.paint.get("raster-array-band")||y.getInitialBand(b);if(T==null)return;const S=l.getIds().map(A=>l.getTileByID(A));for(const A of S)A.updateNeeded(b,T)&&y.prepareTile(A,b,T)},"raster-particle":function(g,l,d){const y=l.getSource();if(!(y instanceof R&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=g.paint.get("raster-particle-array-band")||y.getInitialBand(b);if(T==null)return;const S=l.getIds().map(A=>l.getTileByID(A));for(const A of S)A.updateNeeded(b,T)&&y.prepareTile(A,b,T)}};class E0{constructor(l,d,y,b){this.context=new fi(l,d),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=a.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const A of T)this._debugParams.enabledLayers[A]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const A of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new Ka(b),this.setup(),this.numSublayers=a.bx.maxUnderzooming+a.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new fg(this),this._wireframeDebugCache=new ls,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new a.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,S,l.RGBA)}updateTerrain(l,d){const y=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new en(this,l));const b=this._terrain;this.transform.elevation=y?b:null,b.update(l,this.transform,d),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(l){const d=l.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,b]=d.getFovAdjustedRange(this.transform._fov);if(y>b)return void(this.transform.fogCullDistSq=null);const T=y+.78*(b-y);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new en(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,d){if(this.width=l*a.e.devicePixelRatio,this.height=d*a.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const l=this.context,d=new a.bv;d.emplaceBack(0,0),d.emplaceBack(a.a4,0),d.emplaceBack(0,a.a4),d.emplaceBack(a.a4,a.a4),this.tileExtentBuffer=l.createVertexBuffer(d,a.bt.members),this.tileExtentSegments=a.b.simpleSegment(0,0,4,2);const y=new a.bv;y.emplaceBack(0,0),y.emplaceBack(a.a4,0),y.emplaceBack(0,a.a4),y.emplaceBack(a.a4,a.a4),this.debugBuffer=l.createVertexBuffer(y,a.bt.members),this.debugSegments=a.b.simpleSegment(0,0,4,5);const b=new a.bv;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,a.bt.members),this.viewportSegments=a.b.simpleSegment(0,0,4,2);const T=new a.cq;T.emplaceBack(0,0,0,0),T.emplaceBack(a.a4,0,a.a4,0),T.emplaceBack(0,a.a4,0,a.a4),T.emplaceBack(a.a4,a.a4,a.a4,a.a4),this.mercatorBoundsBuffer=l.createVertexBuffer(T,a.cr.members),this.mercatorBoundsSegments=a.b.simpleSegment(0,0,4,2);const S=new a.bw;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S);const A=new a.cs;for(const L of[0,1,3,2,0])A.emplaceBack(L);this.debugIndexBuffer=l.createIndexBuffer(A),this.emptyTexture=new a.T(l,new a.j({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=a.ae.create();const k=this.context.gl;this.stencilClearMode=new a.ah({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,a.af.disabled,this.stencilClearMode,a.a.disabled,a.ag.disabled,iu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,d,y){if(!d||this.currentStencilSource===d.id||!l.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const k of y)if(this._tileClippingMaskIDs[k.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=d.id;const b=this.context,T=b.gl;this.nextStencilID+y.length>256&&this.clearStencil(),b.setColorMode(a.a.disabled),b.setDepthMode(a.af.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of y){const k=d.getTile(A),L=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=this.getTileBoundsBuffers(k);S.draw(this,T.TRIANGLES,a.af.disabled,new a.ah({func:T.ALWAYS,mask:0},L,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.ag.disabled,iu(A.projMatrix),"$clipping",B,U,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new a.ah({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const d=this.context.gl;return new a.ah({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,y=l.sort((S,A)=>A.overscaledZ-S.overscaledZ),b=y[y.length-1].overscaledZ,T=y[0].overscaledZ-b+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const S={};for(let A=0;A<T;A++)S[A+b]=new a.ah({func:d.GEQUAL,mask:255},A+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[S,y]}return[{[b]:a.ah.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new a.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new a.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.a.unblended:a.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new a.a([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new a.C(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,d,y,b=!1){if(this.depthOcclusion)return new a.af(this.context.gl.GREATER,a.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return a.af.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new a.af(y||this.context.gl.LEQUAL,d,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const l=this.context.gl,d=Math.ceil(this.width),y=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),T=l.getParameter(l.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===d&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),d!==0&&y!==0&&(this.depthFBO=new fr(this.context,d,y,!1,"texture"),this.depthTexture=new a.T(this.context,{width:d,height:y,data:null},l.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),l.bindTexture(l.TEXTURE_2D,T),this.depthFBO&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),l.blitFramebuffer(0,0,d,y,0,0,d,y,l.DEPTH_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,d)=>l+d/this._fpsHistory.length,0))}render(l,d){const y=a.e.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=d;const b=this.style._mergedLayers,T=this.style.order.filter(Fe=>{const Pe=b[Fe];return!(Pe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Pe.type]});let S=!1,A=!1;for(const Fe of T){const Pe=b[Fe];Pe.type==="circle"&&(S=!0),Pe.type==="symbol"&&(Pe.hasInitialOcclusionOpacityProperties?A=!0:S=!0)}const k=T.map(Fe=>b[Fe]),L=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(a.e.now()),this.imageManager.beginFrame();let B=0,U=!1;for(const Fe in L){const Pe=L[Fe];Pe.used&&(Pe.prepare(this.context),Pe.getSource().usedInConflation&&++B)}let q=!1;for(const Fe of k)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(q=!0),this.prepareLayer(Fe));const H={},ie={},se={},ae={},ce={};for(const Fe in L){const Pe=L[Fe];H[Fe]=Pe.getVisibleCoordinates(),ie[Fe]=H[Fe].slice().reverse(),se[Fe]=Pe.getVisibleCoordinates(!0).reverse(),ae[Fe]=Pe.getShadowCasterCoordinates(),ce[Fe]=Pe.sortCoordinatesByDistance(H[Fe])}const ye=Fe=>{const Pe=this.style.getLayerSourceCache(Fe);return Pe&&Pe.used?Pe.getSource():null};if(B||q){const Fe=[],Pe=[];let et=0;for(const Qe of k)this.isSourceForClippingOrConflation(Qe,ye(Qe))&&(Fe.push(Qe),Pe.push(et)),et++;if(Fe&&(q||Fe.length>1)){const Qe=[];for(let Ve=0;Ve<Fe.length;Ve++){const xt=Fe[Ve],pt=Pe[Ve],He=this.style.getLayerSourceCache(xt);if(!He||!He.used||!He.getSource().usedInConflation&&xt.type!=="clip")continue;let it=a.cv,Be=a.cw.None;const mt=[];if(xt.type==="clip"){it=pt;for(const _t of xt.layout.get("clip-layer-types"))Be|=_t==="model"?a.cw.Model:_t==="symbol"?a.cw.Symbol:a.cw.FillExtrusion;for(const _t of xt.layout.get("clip-layer-scope"))mt.push(_t)}Qe.push({layer:xt.fqid,cache:He,order:it,clipMask:Be,clipScope:mt})}this.replacementSource.setSources(Qe),U=!0}}U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<k.length;Fe++){const Pe=k[Fe],et=Pe.cutoffRange();if(this.longestCutoffRange=Math.max(et,this.longestCutoffRange),et>0){const Qe=ye(Pe);Qe&&(this.minCutoffZoom=Math.max(Qe.minzoom,this.minCutoffZoom)),Pe.minzoom&&(this.minCutoffZoom=Math.max(Pe.minzoom,this.minCutoffZoom))}Pe.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const ve=this.style&&this.style.fog;ve?(this._fogVisible=ve.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ve.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(se),this.opaquePassCutoff=0);const _e=this._shadowRenderer;if(_e){_e.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in L)for(const Pe of H[Fe]){let et={min:0,max:0};this.terrain&&(et=this.terrain.getMinMaxForTile(Pe)||et),_e.addShadowReceiver(Pe.toUnwrapped(),et.min,et.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new wg(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!a.cu(this.context.gl))return;this.renderPass="offscreen";for(const Fe of k){const Pe=l.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const et=Pe?ie[Pe.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||et&&et.length)&&this.renderLayer(this,Pe,Fe,et)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Re=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Se=(()=>{if(d.showOverdrawInspector)return a.C.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const Pe=this.style.getLut(Fe.scope);if(!Re){const et=Fe.properties.get("color").toRenderColor(Pe).toArray01();return new a.C(...et)}if(Re){const et=Fe.properties.get("space-color").toRenderColor(Pe).toArray01();return new a.C(...et)}}return a.C.transparent})();if(this.context.clear({color:Se,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=k[this.currentLayer],Pe=l.getLayerSourceCache(Fe);if(Fe.isSky())continue;const et=Pe?(Fe.is3D()?ce:ie)[Pe.id]:void 0;this._renderTileClippingMasks(Fe,Pe,et),this.renderLayer(this,Pe,Fe,et)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Re&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.a2(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const Fe=k[this.currentLayer],Pe=l.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,Pe,Fe,Pe?ie[Pe.id]:void 0)}function Ie(Fe,Pe){let et;return Pe&&(et=(Fe.type==="symbol"?se:Fe.is3D()?ce:ie)[Pe.id]),et}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<T.length;){const Fe=k[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){const Pe=l.getLayerSourceCache(Fe);this.renderLayer(this,Pe,Fe,Ie(Fe,Pe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ze=0;_e&&(ze=_e.getShadowCastingLayerCount());let Ne=!1,We=-1;for(let Fe=0;Fe<T.length;++Fe){const Pe=k[Fe];Pe.isHidden(this.transform.zoom)||Pe.is3D()&&(We=Fe)}for(A&&We===-1&&(S=!0);this.currentLayer<T.length;){const Fe=k[this.currentLayer],Pe=l.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(S&&!Ne&&this.terrain&&!this.transform.isOrthographic&&(Ne=!0,this.blitDepth()),A&&We!==-1&&this.currentLayer===We+1&&!this.transform.isOrthographic&&this.blitDepth(),Fe.is3D()||this.terrain||this._renderTileClippingMasks(Fe,Pe,Pe?H[Pe.id]:void 0),this.renderLayer(this,Pe,Fe,Ie(Fe,Pe)),!this.terrain&&_e&&ze>0&&Fe.hasShadowPass()&&--ze==0&&(_e.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const et=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=et;this.currentLayer++){const Qe=k[this.currentLayer];if(!Qe.hasLightBeamPass())continue;const Ve=l.getLayerSourceCache(Qe);this.renderLayer(this,Ve,Qe,Ve?ie[Ve.id]:void 0)}this.currentLayer=et,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const et=this.currentLayer;this.depthOcclusion=!0;for(const Qe of this.layersWithOcclusionOpacity){this.currentLayer=Qe;const Ve=k[this.currentLayer],xt=l.getLayerSourceCache(Ve),pt=xt?ie[xt.id]:void 0;Ve.is3D()||this.terrain||this._renderTileClippingMasks(Ve,xt,xt?H[xt.id]:void 0),this.renderLayer(this,xt,Ve,pt)}this.depthOcclusion=!1,this.currentLayer=et,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;k.forEach(Pe=>{const et=l.getLayerSourceCache(Pe);et&&!Pe.isHidden(this.transform.zoom)&&et.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<et.getSource().maxzoom)&&(Fe=et)}),Fe&&this.options.showTileBoundaries&&Qa.debug(this,Fe,Fe.getVisibleCoordinates(),a.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Qa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Fe){const Pe=Fe.transform.padding;b0(Fe,Fe.transform.height-(Pe.top||0),3,v0),b0(Fe,Pe.bottom||0,3,bg),dp(Fe,Pe.left||0,3,x0),dp(Fe,Fe.transform.width-(Pe.right||0),3,Er);const et=Fe.transform.centerPoint;(function(Qe,Ve,xt,pt){xd(Qe,Ve-1,xt-10,2,20,pt),xd(Qe,Ve-10,xt-1,20,2,pt)})(Fe,et.x,Fe.transform.height-et.y,vA)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);const{unsupportedLayers:d}=this.transform.projection,y=!d||!d.includes(l.type);if(ms[l.type]&&(y||this.terrain&&l.type==="custom")){const b=this.style.getLayerSourceCache(l);ms[l.type](l,b,this)}this.gpuTimingEnd()}renderLayer(l,d,y,b){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||b&&b.length)&&(this.id=y.id,this.gpuTimingStart(y),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(y.type)&&(!l.terrain||y.type!=="custom")||y.type==="clip"||Qa[y.type](l,d,y,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,y=this.context.gl;let b=this.gpuTimers[l.id];b||(b=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:y.createQuery()}),b.calls++,y.beginQuery(d.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,d=this.context.gl,y=d.createQuery();this.deferredRenderGpuTimeQueries.push(y),d.beginQuery(l.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const d={};for(const y in l){const b=l[y],T=this.context.extTimerQuery,S=T.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(b.query),d[y]=S}return d}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery,y=this.context.gl;let b=0;for(const T of l)b+=d.getQueryParameter(T,y.QUERY_RESULT)/1e6,d.deleteQueryEXT(T);return b}translatePosMatrix(l,d,y,b,T){if(!y[0]&&!y[1])return l;const S=T?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(S){const L=Math.sin(S),B=Math.cos(S);y=[y[0]*B-y[1]*L,y[0]*L+y[1]*B]}const A=[T?y[0]:a.bD(d,y[0],this.transform.zoom),T?y[1]:a.bD(d,y[1],this.transform.zoom),0],k=new Float32Array(16);return a.ae.translate(k,l,A),k}saveTileTexture(l){const d=l.size[0],y=this._tileTextures[d];y?y.push(l):this._tileTextures[d]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,d,y){const b=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,T=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||T.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?T.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):T.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||b||d!==void 0&&!d||T.push("FOG","FOG_DITHERING"),b&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(l,d){this.cache=this.cache||{};const y=d&&d.defines||[],b=d&&d.config,T=this.currentGlobalDefines(l,d&&d.overrideFog,d&&d.overrideRtt).concat(y),S=As.cacheKey(Zc[l],l,T,b);return this.cache[S]||(this.cache[S]=new As(this.context,l,Zc[l],b,Rb[l],T)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,d){if(this.style.enable3dLights()){const y=this.style.directionalLight,b=this.style.ambientLight;if(y&&b){const T=((S,A,k)=>{const L=S.properties.get("direction"),B=S.properties.get("color").toRenderColor(k.getLut(S.scope)).toArray01(),U=S.properties.get("intensity"),q=A.properties.get("color").toRenderColor(k.getLut(A.scope)).toArray01(),H=A.properties.get("intensity"),ie=[L.x,L.y,L.z],se=a.bC(q,H),ae=a.bC(B,U);return{u_lighting_ambient_color:se,u_lighting_directional_dir:ie,u_lighting_directional_color:ae,u_ground_radiance:ii(ie,ae,se)}})(y,b,this.style);d.setLightsUniformValues(l,T)}}}uploadCommonUniforms(l,d,y,b,T){if(this.uploadCommonLightUniforms(l,d),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const A=S.getOpacity(this.transform.pitch),k=((L,B,U,q,H,ie,se,ae,ce,ye,ve,_e)=>{const Re=L.transform,Se=B.properties.get("color").toRenderColor(L.style.getLut(B.scope)).toArray01();Se[3]=q;const Ie=L.frameCounter/1e3%1,[ze,Ne]=B.properties.get("vertical-range");return{u_fog_matrix:U?Re.calculateFogTileMatrix(U):_e||L.identityMat,u_fog_range:B.getFovAdjustedRange(Re._fov),u_fog_color:Se,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ze,Ne),Ne],u_fog_temporal_offset:Ie,u_frustum_tl:H,u_frustum_tr:ie,u_frustum_br:se,u_frustum_bl:ae,u_globe_pos:ce,u_globe_radius:ye,u_viewport:ve,u_globe_transition:a.a2(Re.zoom),u_is_globe:+(Re.projection.name==="globe")}})(this,S,y,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.e.devicePixelRatio,this.transform.height*a.e.devicePixelRatio],b);d.setFogUniformValues(l,k)}T&&d.setCutoffUniformValues(l,T.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,d=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const b of y)d[b.key]=l[b.key]||new a.bA(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,d){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||l.sourceLayer!=="building")&&l.type!=="clip"&&(!d||d.type!=="batched-model"))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[l.key];return d||(this._cachedTileFogOpacities[l.key]=d=this.style.fog.getOpacityForTile(l)),d[0]>=_r||d[1]>=_r}setupDepthForOcclusion(l,d,y){const b=this.context,T=b.gl,S=!!y;var A;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(T.TEXTURE3),l&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),b.activeTexture.set(T.TEXTURE0),S||d.setTerrainUniformValues(b,y)}}class oa{constructor(l,d,y,b){this.screenBounds=l,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(l,d){let y,b;if(l instanceof a.P||typeof l[0]=="number"){const T=a.P.convert(l);y=[T],b=d.isPointAboveHorizon(T)}else{const T=a.P.convert(l[0]),S=a.P.convert(l[1]);y=[T,S],b=a.cx(T,S).every(A=>d.isPointAboveHorizon(A))}return new oa(y,d.getCameraPoint(),b,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return a.cx(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cx(d,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<y.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),a.cy(b,l)}bufferedCameraGeometryGlobe(l){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cx(d,y,l),T=this.cameraPoint.clone();switch(3*((T.y>d.y)+(T.y>y.y))+((T.x>d.x)+(T.x>y.x))){case 0:b[0]=T,b[4]=T.clone();break;case 1:b.splice(1,0,T);break;case 2:b[1]=T;break;case 3:b.splice(4,0,T);break;case 5:b.splice(2,0,T);break;case 6:b[3]=T;break;case 7:b.splice(3,0,T);break;case 8:b[2]=T}return b}containsTile(l,d,y,b=0){const T=l.queryPadding/d._pixelsPerMercatorPixel+1,S=y?this._bufferedCameraMercator(T,d):this._bufferedScreenMercator(T,d);let A=l.tileID.wrap+(S.unwrapped?b:0);const k=S.polygon.map(ae=>a.cz(l.tileTransform,ae,A));if(!a.cA(k,0,0,a.a4,a.a4))return;A=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const L=this.screenGeometryMercator.polygon.map(ae=>a.cB(l.tileTransform,ae,A)),B=L.map(ae=>new a.P(ae[0],ae[1])),U=d.getFreeCameraOptions().position||new a._(0,0,0),q=a.cB(l.tileTransform,U,A),H=L.map(ae=>{const ce=a.$.sub(ae,ae,q);return a.$.normalize(ce,ce),new a.aU(q,ce)}),ie=a.bD(l,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:H,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(se=a.cC(k),se.min.x=a.au(se.min.x,0,a.a4),se.min.y=a.au(se.min.y,0,a.a4),se.max.x=a.au(se.max.x,0,a.a4),se.max.y=a.au(se.max.y,0,a.a4),se),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:ie};var se}_bufferedScreenMercator(l,d){const y=su(l);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),d):{polygon:this.bufferedScreenGeometry(l).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[y]=b,b}}_bufferedCameraMercator(l,d){const y=su(l);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),d):{polygon:this.bufferedCameraGeometry(l).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[y]=b,b}}_projectAndResample(l,d){const y=function(T,S){const A=a.ae.multiply([],S.pixelMatrix,S.globeMatrix),k=[0,-a.cF,0,1],L=[0,a.cF,0,1],B=[0,0,0,1];a.aB.transformMat4(k,k,A),a.aB.transformMat4(L,L,A),a.aB.transformMat4(B,B,A);const U=new a.P(k[0]/k[3],k[1]/k[3]),q=new a.P(L[0]/L[3],L[1]/L[3]),H=a.cD(T,U)&&k[3]<B[3],ie=a.cD(T,q)&&L[3]<B[3];if(!H&&!ie)return null;const se=function(Ie,ze,Ne){for(let We=1;We<Ie.length;We++){const Fe=dc(ze.pointCoordinate3D(Ie[We-1]).x),Pe=dc(ze.pointCoordinate3D(Ie[We]).x);if(Ne<0){if(Fe<Pe)return{idx:We,t:-Fe/(Pe-1-Fe)}}else if(Pe<Fe)return{idx:We,t:(1-Fe)/(Pe+1-Fe)}}return null}(T,S,H?-1:1);if(!se)return null;const{idx:ae,t:ce}=se;let ye=ae>1?lh(T.slice(0,ae),S):[],ve=ae<T.length?lh(T.slice(ae),S):[];ye=ye.map(Ie=>new a.P(dc(Ie.x),Ie.y)),ve=ve.map(Ie=>new a.P(dc(Ie.x),Ie.y));const _e=[...ye];_e.length===0&&_e.push(ve[ve.length-1]);const Re=a.a3(_e[_e.length-1].y,(ve.length===0?ye[0]:ve[0]).y,ce);let Se;return Se=H?[new a.P(0,Re),new a.P(0,0),new a.P(1,0),new a.P(1,Re)]:[new a.P(1,Re),new a.P(1,1),new a.P(0,1),new a.P(0,Re)],_e.push(...Se),ve.length===0?_e.push(ye[0]):_e.push(...ve),{polygon:_e.map(Ie=>new a._(Ie.x,Ie.y)),unwrapped:!1}}(l,d);if(y)return y;const b=function(T,S){let A=!1,k=-1/0,L=0;for(let U=0;U<T.length-1;U++)T[U].x>k&&(k=T[U].x,L=U);for(let U=0;U<T.length-1;U++){const q=(L+U)%(T.length-1),H=T[q],ie=T[q+1];Math.abs(H.x-ie.x)>.5&&(H.x<ie.x?(H.x+=1,q===0&&(T[T.length-1].x+=1)):(ie.x+=1,q+1===T.length-1&&(T[0].x+=1)),A=!0)}const B=a.ak(S.center.lng);return A&&B<Math.abs(B-1)&&T.forEach(U=>{U.x-=1}),{polygon:T,unwrapped:A}}(lh(l,d).map(T=>new a.P(dc(T.x),T.y)),d);return{polygon:b.polygon.map(T=>new a._(T.x,T.y)),unwrapped:b.unwrapped}}}function lh(g,l){return a.cE(g,d=>{const y=l.pointCoordinate3D(d);d.x=y.x,d.y=y.y},1/256)}function dc(g){return g<0?1+g%1:g%1}function su(g){return 100*g|0}function xA(g,l){const d=a.ae.identity([]);return a.ae.scale(d,d,[.5*g.width,.5*-g.height,1]),a.ae.translate(d,d,[1,-1,0]),a.ae.multiply(d,d,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(d)}function fc(g,l,d,y,b,T,S,A=!1){const k=g.tilesIn(y,S,A);k.sort(S0);const L=[];for(const U of k)L.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(l,d,g._state,U,b,T,xA(g.transform,U.tile.tileID),A)});const B=function(U){const q={},H={};for(const ie of U){const se=ie.queryResults,ae=ie.wrappedTileID,ce=H[ae]=H[ae]||{};for(const ye in se){const ve=se[ye],_e=ce[ye]=ce[ye]||{},Re=q[ye]=q[ye]||[];for(const Se of ve)_e[Se.featureIndex]||(_e[Se.featureIndex]=!0,Re.push(Se))}}return q}(L);for(const U in B)B[U].forEach(q=>{const H=q.feature,ie=H.layer;ie&&ie.type!=="background"&&ie.type!=="sky"&&ie.type!=="slot"&&(H.source=ie.source,ie["source-layer"]&&(H.sourceLayer=ie["source-layer"]),H.state=H.id!==void 0?g.getFeatureState(ie["source-layer"],H.id):{})});return B}function bA(g,l){const d=g.getRenderableIds().map(T=>g.getTileByID(T)),y=[],b={};for(let T=0;T<d.length;T++){const S=d[T],A=S.tileID.canonical.key;b[A]||(b[A]=!0,S.querySourceFeatures(y,l))}return y}function S0(g,l){const d=g.tileID,y=l.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}class Bo{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const l=!1,d=!1;for(const y in this.style._mergedLayers){const b=this.style._mergedLayers[y];if(b.type==="fill-extrusion")this.layers.push({layer:b,visible:l,visibilityChanged:d});else if(b.type==="model"){const T=this.style.getLayerSource(b);T&&T.type==="batched-model"&&this.layers.push({layer:b,visible:l,visibilityChanged:d})}}}onNewFrame(l){this.layersGotHidden=!1;for(const d of this.layers){const y=d.layer;let b=!1;y.type==="fill-extrusion"?b=!y.isHidden(l)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="model"&&(b=!y.isHidden(l)&&y.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!b&&d.visible,d.visible=b}}updateZOffset(l,d){this.currentBuildingBuckets=[];for(const b of this.layers){const T=b.layer,S=this.style.getLayerSourceCache(T);let A=1;T.type==="fill-extrusion"&&(A=b.visible?T.paint.get("fill-extrusion-vertical-scale"):0);let k=S?S.getTile(d):null;if(!k&&S&&d.canonical.z>S.getSource().minzoom){let L=d.scaledTo(Math.min(S.getSource().maxzoom,d.overscaledZ-1));for(;L.overscaledZ>=S.getSource().minzoom&&(k=S.getTile(L),!k&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:k?k.getBucket(T):null,tileID:k?k.tileID:d,verticalScale:A})}l.hasAnyZOffset=!1;let y=!1;for(let b=0;b<l.symbolInstances.length;b++){const T=l.symbolInstances.get(b),S=T.zOffset,A=this._getHeightAtTileOffset(d,T.tileAnchorX,T.tileAnchorY);T.zOffset=A!==Number.NEGATIVE_INFINITY?A:S,y||S===T.zOffset||(y=!0),l.hasAnyZOffset||T.zOffset===0||(l.hasAnyZOffset=!0)}y&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,d,y,b){let T=d,S=y;if(l.canonical.z!==b.canonical.z){const A=b.canonical,k=1/(1<<l.canonical.z-A.z);T=(d+l.canonical.x*a.a4)*k-A.x*a.a4|0,S=(y+l.canonical.y*a.a4)*k-A.y*a.a4|0}return{tileX:T,tileY:S}}_getHeightAtTileOffset(l,d,y){let b,T;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:A,tileID:k,verticalScale:L}=this.currentBuildingBuckets[S];if(!A)continue;const{tileX:B,tileY:U}=this._mapCoordToOverlappingTile(l,d,y,k),q=A.getHeightAtTileCoord(B,U);q&&q.height!==void 0&&(q.hidden?b=q.height:T=Math.max(q.height*L,T||0))}if(T!==void 0)return T;for(let S=0;S<this.layers.length;++S){const A=this.layers[S];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:k,tileID:L}=this.currentBuildingBuckets[S];if(!k)continue;const{tileX:B,tileY:U}=this._mapCoordToOverlappingTile(l,d,y,L),q=k.getHeightAtTileCoord(B,U);if(q&&!q.hidden)return q.height===void 0&&b!==void 0?Math.min(q.maxHeight,b)*q.verticalScale:q.height?q.height*q.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function wA(g,l){const d={};for(const y in g)y!=="ref"&&(d[y]=g[y]);return a.cG.forEach(y=>{y in l&&(d[y]=l[y])}),d}function mp(g){g=g.slice();const l=Object.create(null);for(let d=0;d<g.length;d++)l[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=wA(g[d],l[g[d].ref]));return g}const Sr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ed(g,l,d){d.push({command:Sr.addSource,args:[g,l[g]]})}function Fb(g,l,d){l.push({command:Sr.removeSource,args:[g]}),d[g]=!0}function TA(g,l,d,y){Fb(g,d,y),Ed(g,l,d)}function gp(g,l,d){let y;for(y in g[d])if(g[d].hasOwnProperty(y)&&y!=="data"&&!a.d(g[d][y],l[d][y]))return!1;for(y in l[d])if(l[d].hasOwnProperty(y)&&y!=="data"&&!a.d(g[d][y],l[d][y]))return!1;return!0}function ou(g,l,d,y,b,T){let S;for(S in l=l||{},g=g||{})g.hasOwnProperty(S)&&(a.d(g[S],l[S])||d.push({command:T,args:[y,S,l[S],b]}));for(S in l)l.hasOwnProperty(S)&&!g.hasOwnProperty(S)&&(a.d(g[S],l[S])||d.push({command:T,args:[y,S,l[S],b]}))}function Sg(g){return g.id}function pc(g,l){return g[l.id]=l,g}class Bb{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=a.au(l,0,1);let d=1,y=this._distances[d];const b=l*this.paddedLength+this.padding;for(;y<b&&d<this._distances.length;)y=this._distances[++d];const T=d-1,S=this._distances[T],A=y-S,k=A>0?(b-S)/A:0;return this.points[T].mult(1-k).add(this.points[d].mult(k))}}class _p{constructor(l,d,y){const b=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(d/y);for(let S=0;S<this.xCellCount*this.yCellCount;S++)b.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,y,b,T){this._forEachCell(d,y,b,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(T)}insertCircle(l,d,y,b){this._forEachCell(d-b,y-b,d+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(y),this.circles.push(b)}_insertBoxCell(l,d,y,b,T,S){this.boxCells[T].push(S)}_insertCircleCell(l,d,y,b,T,S){this.circleCells[T].push(S)}_query(l,d,y,b,T,S){if(y<0||l>this.width||b<0||d>this.height)return!T&&[];const A=[];if(l<=0&&d<=0&&this.width<=y&&this.height<=b){if(T)return!0;for(let k=0;k<this.boxKeys.length;k++)A.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const L=this.circles[3*k],B=this.circles[3*k+1],U=this.circles[3*k+2];A.push({key:this.circleKeys[k],x1:L-U,y1:B-U,x2:L+U,y2:B+U})}return S?A.filter(S):A}return this._forEachCell(l,d,y,b,this._queryCell,A,{hitTest:T,seenUids:{box:{},circle:{}}},S),T?A.length>0:A}_queryCircle(l,d,y,b,T){const S=l-y,A=l+y,k=d-y,L=d+y;if(A<0||S>this.width||L<0||k>this.height)return!b&&[];const B=[];return this._forEachCell(S,k,A,L,this._queryCellCircle,B,{hitTest:b,circle:{x:l,y:d,radius:y},seenUids:{box:{},circle:{}}},T),b?B.length>0:B}query(l,d,y,b,T){return this._query(l,d,y,b,!1,T)}hitTest(l,d,y,b,T){return this._query(l,d,y,b,!0,T)}hitTestCircle(l,d,y,b){return this._queryCircle(l,d,y,!0,b)}_queryCell(l,d,y,b,T,S,A,k){const L=A.seenUids,B=this.boxCells[T];if(B!==null){const q=this.bboxes;for(const H of B)if(!L.box[H]){L.box[H]=!0;const ie=4*H;if(l<=q[ie+2]&&d<=q[ie+3]&&y>=q[ie+0]&&b>=q[ie+1]&&(!k||k(this.boxKeys[H]))){if(A.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[H],x1:q[ie],y1:q[ie+1],x2:q[ie+2],y2:q[ie+3]})}}}const U=this.circleCells[T];if(U!==null){const q=this.circles;for(const H of U)if(!L.circle[H]){L.circle[H]=!0;const ie=3*H;if(this._circleAndRectCollide(q[ie],q[ie+1],q[ie+2],l,d,y,b)&&(!k||k(this.circleKeys[H]))){if(A.hitTest)return S.push(!0),!0;{const se=q[ie],ae=q[ie+1],ce=q[ie+2];S.push({key:this.circleKeys[H],x1:se-ce,y1:ae-ce,x2:se+ce,y2:ae+ce})}}}}}_queryCellCircle(l,d,y,b,T,S,A,k){const L=A.circle,B=A.seenUids,U=this.boxCells[T];if(U!==null){const H=this.bboxes;for(const ie of U)if(!B.box[ie]){B.box[ie]=!0;const se=4*ie;if(this._circleAndRectCollide(L.x,L.y,L.radius,H[se+0],H[se+1],H[se+2],H[se+3])&&(!k||k(this.boxKeys[ie])))return S.push(!0),!0}}const q=this.circleCells[T];if(q!==null){const H=this.circles;for(const ie of q)if(!B.circle[ie]){B.circle[ie]=!0;const se=3*ie;if(this._circlesCollide(H[se],H[se+1],H[se+2],L.x,L.y,L.radius)&&(!k||k(this.circleKeys[ie])))return S.push(!0),!0}}}_forEachCell(l,d,y,b,T,S,A,k){const L=this._convertToXCellCoord(l),B=this._convertToYCellCoord(d),U=this._convertToXCellCoord(y),q=this._convertToYCellCoord(b);for(let H=L;H<=U;H++)for(let ie=B;ie<=q;ie++)if(T.call(this,l,d,y,b,this.xCellCount*ie+H,S,A,k))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,y,b,T,S){const A=b-l,k=T-d,L=y+S;return L*L>A*A+k*k}_circleAndRectCollide(l,d,y,b,T,S,A){const k=(S-b)/2,L=Math.abs(l-(b+k));if(L>k+y)return!1;const B=(A-T)/2,U=Math.abs(d-(T+B));if(U>B+y)return!1;if(L<=k||U<=B)return!0;const q=L-k,H=U-B;return q*q+H*H<=y*y}}const no=100;class EA{constructor(l,d,y=new _p(l.width+200,l.height+200,25),b=new _p(l.width+200,l.height+200,25)){this.transform=l,this.grid=y,this.ignoredGrid=b,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+no,this.screenBottomBoundary=l.height+no,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=d}placeCollisionBox(l,d,y,b,T,S,A,k){let L=y.projectedAnchorX,B=y.projectedAnchorY,U=y.projectedAnchorZ;const q=y.elevation,H=y.tileID,ie=l.getProjection();if(q&&H){const[Se,Ie,ze]=ie.upVector(H.canonical,y.tileAnchorX,y.tileAnchorY),Ne=ie.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=Se*q*Ne,B+=Ie*q*Ne,U+=ze*q*Ne}const se=this.projectAndGetPerspectiveRatio(A,L,B,U,y.tileID,ie.name==="globe"||!!q||this.transform.pitch>0,ie),ae=S*se.perspectiveRatio,ce=(y.x1*d+b.x-y.padding)*ae+se.point.x,ye=(y.y1*d+b.y-y.padding)*ae+se.point.y,ve=(y.x2*d+b.x+y.padding)*ae+se.point.x,_e=(y.y2*d+b.y+y.padding)*ae+se.point.y,Re=se.perspectiveRatio<=.55||se.occluded;return!this.isInsideGrid(ce,ye,ve,_e)||!T&&this.grid.hitTest(ce,ye,ve,_e,k)||Re?{box:[],offscreen:!1,occluded:se.occluded}:{box:[ce,ye,ve,_e],offscreen:this.isOffscreen(ce,ye,ve,_e),occluded:!1}}placeCollisionCircles(l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se){const ae=[],ce=this.transform.elevation,ye=l.getProjection(),ve=ce?ce.getAtTileOffsetFunc(se,this.transform.center.lat,this.transform.worldSize,ye):null,_e=new a.P(y.tileAnchorX,y.tileAnchorY);let{x:Re,y:Se,z:Ie}=ye.projectTilePoint(_e.x,_e.y,se.canonical);if(ve){const[pt,He,it]=ve(_e);Re+=pt,Se+=He,Ie+=it}const ze=ye.name==="globe",Ne=this.projectAndGetPerspectiveRatio(A,Re,Se,Ie,se,ze||!!ce||this.transform.pitch>0,ye),{perspectiveRatio:We}=Ne,Fe=(U?S/We:S*We)/a.bP,Pe=mo(Re,Se,Ie,k),et=Ne.signedDistanceFromCamera>0?eh(Fe,T,y.lineOffsetX*Fe,y.lineOffsetY*Fe,!1,Pe,_e,y,b,k,{},ce&&!U?ve:null,U&&!!ce,ye,se,U):null;let Qe=!1,Ve=!1,xt=!0;if(et&&!Ne.occluded){const pt=.5*H*We+ie,He=new a.P(-100,-100),it=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Be=new Bb,{first:mt,last:_t}=et,Bt=mt.path.length;let Vt=[];for(let vn=Bt-1;vn>=1;vn--)Vt.push(mt.path[vn]);for(let vn=1;vn<_t.path.length;vn++)Vt.push(_t.path[vn]);const rn=2.5*pt;L&&(Vt=Vt.map(([vn,Fn,bn],$n)=>(ve&&!ze&&(bn=ve($n<Bt-1?mt.tilePath[Bt-1-$n]:_t.tilePath[$n-Bt+2])[2]),mo(vn,Fn,bn,L))),Vt.some(vn=>vn[3]<=0)&&(Vt=[]));let Ht=[];if(Vt.length>0){let vn=1/0,Fn=-1/0,bn=1/0,$n=-1/0;for(const hr of Vt)vn=Math.min(vn,hr[0]),bn=Math.min(bn,hr[1]),Fn=Math.max(Fn,hr[0]),$n=Math.max($n,hr[1]);Fn>=He.x&&vn<=it.x&&$n>=He.y&&bn<=it.y&&(Ht=[Vt.map(hr=>new a.P(hr[0],hr[1]))],(vn<He.x||Fn>it.x||bn<He.y||$n>it.y)&&(Ht=a.cH(Ht,He.x,He.y,it.x,it.y)))}for(const vn of Ht){Be.reset(vn,.25*pt);let Fn=0;Fn=Be.length<=.5*pt?1:Math.ceil(Be.paddedLength/rn)+1;for(let bn=0;bn<Fn;bn++){const $n=bn/Math.max(Fn-1,1),hr=Be.lerp($n),Xr=hr.x+no,Lr=hr.y+no;ae.push(Xr,Lr,pt,0);const pr=Xr-pt,Or=Lr-pt,Hn=Xr+pt,Yn=Lr+pt;if(xt=xt&&this.isOffscreen(pr,Or,Hn,Yn),Ve=Ve||this.isInsideGrid(pr,Or,Hn,Yn),!d&&this.grid.hitTestCircle(Xr,Lr,pt,q)&&(Qe=!0,!B))return{circles:[],offscreen:!1,collisionDetected:Qe,occluded:!1}}}}return{circles:!B&&Qe||!Ve?[]:ae,offscreen:xt,collisionDetected:Qe,occluded:Ne.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,b=1/0,T=-1/0,S=-1/0;for(const B of l){const U=new a.P(B.x+no,B.y+no);y=Math.min(y,U.x),b=Math.min(b,U.y),T=Math.max(T,U.x),S=Math.max(S,U.y),d.push(U)}const A=this.grid.query(y,b,T,S).concat(this.ignoredGrid.query(y,b,T,S)),k={},L={};for(const B of A){const U=B.key;if(k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]={}),k[U.bucketInstanceId][U.featureIndex])continue;const q=[new a.P(B.x1,B.y1),new a.P(B.x2,B.y1),new a.P(B.x2,B.y2),new a.P(B.x1,B.y2)];a.cI(d,q)&&(k[U.bucketInstanceId][U.featureIndex]=!0,L[U.bucketInstanceId]===void 0&&(L[U.bucketInstanceId]=[]),L[U.bucketInstanceId].push(U.featureIndex))}return L}insertCollisionBox(l,d,y,b,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:T},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,y,b,T){const S=d?this.ignoredGrid:this.grid,A={bucketInstanceId:y,featureIndex:b,collisionGroupID:T};for(let k=0;k<l.length;k+=4)S.insertCircle(A,l[k],l[k+1],l[k+2])}projectAndGetPerspectiveRatio(l,d,y,b,T,S,A){const k=[d,y,b,1];let L=!1;b||this.transform.pitch>0?(a.aB.transformMat4(k,k,l),this.fogState&&T&&A.name!=="globe"&&(L=function(q,H,ie,se,ae,ce){const ye=ce.calculateFogTileMatrix(ae),ve=[H,ie,se];return a.$.transformMat4(ve,ve,ye),cr(q,a.$.length(ve),ce.pitch,ce._fov)}(this.fogState,d,y,b,T.toUnwrapped(),this.transform)>.9)):np(k,k,l);const B=k[3];return{point:new a.P((k[0]/B+1)/2*this.transform.width+no,(-k[1]/B+1)/2*this.transform.height+no),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/B*.5,1.5),signedDistanceFromCamera:B,occluded:S&&k[2]>B||L}}isOffscreen(l,d,y,b){return y<no||l>=this.screenRightBoundary||b<no||d>this.screenBottomBoundary}isInsideGrid(l,d,y,b){return y>=0&&l<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=a.ae.identity([]);return a.ae.translate(l,l,[-100,-100,0]),l}}class jb{constructor(l,d,y,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):b&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class yp{constructor(l,d,y,b,T,S=!1){this.text=new jb(l?l.text:null,d,y,T),this.icon=new jb(l?l.icon:null,d,b,T),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ig{constructor(l,d,y,b=!1){this.text=l,this.icon=d,this.skipFade=y,this.clipped=b}}class SA{constructor(){this.invProjMatrix=a.ae.create(),this.viewportMatrix=a.ae.create(),this.circles=[]}}class I0{constructor(l,d,y,b,T){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=T}}class Ub{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[l]}}function C0(g,l,d,y,b){const{horizontalAlign:T,verticalAlign:S}=a.bS(g),A=-(T-.5)*l,k=-(S-.5)*d,L=a.bR(g,y);return new a.P(A+L[0]*b,k+L[1]*b)}function Cg(g,l,d,y,b){const T=new a.P(g,l);return d&&T._rotate(y?b:-b),T}class Vb{constructor(l,d,y,b,T,S){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new EA(this.transform,T),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Ub(y),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,y,b){const T=y.getBucket(d),S=y.latestFeatureIndex;if(!T||!S||d.fqid!==T.layerIds[0])return;const A=T.layers[0].layout,k=y.collisionBoxArray,L=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),B=y.tileSize/a.a4,U=y.tileID.toUnwrapped();this.transform.setProjection(T.projection);const q=(H=y.tileID,ie=T.getProjection(),se=this.transform,ie.name===this.projection?se.calculateProjMatrix(H.toUnwrapped()):ih(se,ie,H));var H,ie,se;const ae=A.get("text-pitch-alignment")==="map",ce=A.get("text-rotation-alignment")==="map";d.compileFilter();const ye=d.dynamicFilter(),ve=d.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(y),Re=Yu(q,y.tileID.canonical,ae,ce,this.transform,T.getProjection(),_e);let Se=null;if(ae){const Ne=Ju(q,y.tileID.canonical,ae,ce,this.transform,T.getProjection(),_e);Se=a.ae.multiply([],this.transform.labelPlaneMatrix,Ne)}let Ie=null;ye&&y.latestFeatureIndex&&(Ie={unwrappedTileID:U,dynamicFilter:ye,dynamicFilterNeedsFeature:ve,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new I0(T.bucketInstanceId,S,T.sourceLayerIndex,T.index,y.tileID);const ze={bucket:T,layout:A,posMatrix:q,textLabelPlaneMatrix:Re,labelToScreenMatrix:Se,clippingData:Ie,scale:L,textPixelRatio:B,holdingForFade:y.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:a.aE(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.aE(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(b)for(const Ne of T.sortKeyRanges){const{sortKey:We,symbolInstanceStart:Fe,symbolInstanceEnd:Pe}=Ne;l.push({sortKey:We,symbolInstanceStart:Fe,symbolInstanceEnd:Pe,parameters:ze})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(l,d,y,b,T,S,A,k,L,B,U,q,H,ie,se,ae,ce,ye){const{textOffset0:ve,textOffset1:_e,crossTileID:Re}=q,Se=[ve,_e],Ie=C0(l,y,b,Se,T),ze=this.collisionIndex.placeCollisionBox(ie,T,d,Cg(Ie.x,Ie.y,S,A,this.transform.angle),U,k,L,B.predicate);if(ae){const Ne=ie.getSymbolInstanceIconSize(ye,this.transform.zoom,q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ie,Ne,ae,Cg(Ie.x,Ie.y,S,A,this.transform.angle),U,k,L,B.predicate).box.length===0)return}if(ze.box.length>0){let Ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[Re]&&this.prevPlacement.placements[Re]&&this.prevPlacement.placements[Re].text&&(Ne=this.prevPlacement.variableOffsets[Re].anchor),this.variableOffsets[Re]={textOffset:Se,width:y,height:b,anchor:l,textScale:T,prevAnchor:Ne},this.markUsedJustification(ie,l,q,se),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,se,q),this.placedOrientations[Re]=se),{shift:Ie,placedGlyphBoxes:ze}}}placeLayerBucketPart(l,d,y,b){const{bucket:T,layout:S,posMatrix:A,textLabelPlaneMatrix:k,labelToScreenMatrix:L,clippingData:B,textPixelRatio:U,holdingForFade:q,collisionBoxArray:H,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:se,collisionGroup:ae}=l.parameters,ce=S.get("text-optional"),ye=S.get("icon-optional"),ve=S.get("text-allow-overlap"),_e=S.get("icon-allow-overlap"),Re=S.get("text-rotation-alignment")==="map",Se=S.get("text-pitch-alignment")==="map",Ie=S.get("symbol-z-order")==="viewport-y",ze=S.get("symbol-z-elevate");this.transform.setProjection(T.projection);let Ne=ve&&(_e||!T.hasIconData()||ye),We=_e&&(ve||!T.hasTextData()||ce);!T.collisionArrays&&H&&T.deserializeCollisionBoxes(H),y&&b&&T.updateCollisionDebugBuffers(this.transform.zoom,H);const Fe=(Pe,et,Qe)=>{const{crossTileID:Ve,numVerticalGlyphVertices:xt}=Pe;if(B){const Hn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Yn=null;if(B.dynamicFilterNeedsFeature){const Bn=this.retainedQueryData[T.bucketInstanceId];Yn=B.featureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:Bn.bucketIndex,sourceLayerIndex:Bn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,B.dynamicFilter)(Hn,Yn,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new a.P(Pe.tileAnchorX,Pe.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Ve]=new Ig(!1,!1,!1,!0),void d.add(Ve)}if(d.has(Ve))return;if(q)return void(this.placements[Ve]=new Ig(!1,!1,!1));let pt=!1,He=!1,it=!0,Be=!1,mt=!1,_t=null,Bt={box:null,offscreen:null,occluded:null},Vt={box:null,offscreen:null,occluded:null},rn=null,Ht=null,vn=null,Fn=0,bn=0,$n=0;Qe.textFeatureIndex?Fn=Qe.textFeatureIndex:Pe.useRuntimeCollisionCircles&&(Fn=Pe.featureIndex),Qe.verticalTextFeatureIndex&&(bn=Qe.verticalTextFeatureIndex);const hr=Hn=>{Hn.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Yn=this.transform.elevation;Hn.elevation=Pe.zOffset+(Yn?Yn.getAtTileOffset(Hn.tileID,Hn.tileAnchorX,Hn.tileAnchorY):0)},Xr=Qe.textBox;if(Xr){hr(Xr);const Hn=Bn=>{let xr=a.aF.horizontal;if(T.allowVerticalPlacement&&!Bn&&this.prevPlacement){const tr=this.prevPlacement.placedOrientations[Ve];tr&&(this.placedOrientations[Ve]=tr,xr=tr,this.markUsedOrientation(T,xr,Pe))}return xr},Yn=(Bn,xr)=>{if(T.allowVerticalPlacement&&xt>0&&Qe.verticalTextBox){for(const tr of T.writingModes)if(tr===a.aF.vertical?(Bt=xr(),Vt=Bt):Bt=Bn(),Bt&&Bt.box&&Bt.box.length)break}else Bt=Bn()};if(S.get("text-variable-anchor")){let Bn=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ve]){const In=this.prevPlacement.variableOffsets[Ve];Bn.indexOf(In.anchor)>0&&(Bn=Bn.filter(Bi=>Bi!==In.anchor),Bn.unshift(In.anchor))}const xr=(In,Bi,ji)=>{const ro=T.getSymbolInstanceTextSize(ie,Pe,this.transform.zoom,et),io=(In.x2-In.x1)*ro+2*In.padding,Gs=(In.y2-In.y1)*ro+2*In.padding,so=Pe.hasIconTextFit&&!_e?Bi:null;so&&hr(so);let Ns={box:[],offscreen:!1,occluded:!1};const Ws=ve?2*Bn.length:Bn.length;for(let Et=0;Et<Ws;++Et){const on=this.attemptAnchorPlacement(Bn[Et%Bn.length],In,io,Gs,ro,Re,Se,U,A,ae,Et>=Bn.length,Pe,et,T,ji,so,ie,se);if(on&&(Ns=on.placedGlyphBoxes,Ns&&Ns.box&&Ns.box.length)){pt=!0,_t=on.shift;break}}return Ns};Yn(()=>xr(Xr,Qe.iconBox,a.aF.horizontal),()=>{const In=Qe.verticalTextBox;return In&&hr(In),T.allowVerticalPlacement&&!(Bt&&Bt.box&&Bt.box.length)&&xt>0&&In?xr(In,Qe.verticalIconBox,a.aF.vertical):{box:null,offscreen:null,occluded:null}}),Bt&&(pt=Bt.box,it=Bt.offscreen,Be=Bt.occluded);const tr=Hn(!(!Bt||!Bt.box));if(!pt&&this.prevPlacement){const In=this.prevPlacement.variableOffsets[Ve];In&&(this.variableOffsets[Ve]=In,this.markUsedJustification(T,In.anchor,Pe,tr))}}else{const Bn=(xr,tr)=>{const In=T.getSymbolInstanceTextSize(ie,Pe,this.transform.zoom,et),Bi=this.collisionIndex.placeCollisionBox(T,In,xr,new a.P(0,0),ve,U,A,ae.predicate);return Bi&&Bi.box&&Bi.box.length&&(this.markUsedOrientation(T,tr,Pe),this.placedOrientations[Ve]=tr),Bi};Yn(()=>Bn(Xr,a.aF.horizontal),()=>{const xr=Qe.verticalTextBox;return T.allowVerticalPlacement&&xt>0&&xr?(hr(xr),Bn(xr,a.aF.vertical)):{box:null,offscreen:null,occluded:null}}),Hn(!!(Bt&&Bt.box&&Bt.box.length))}}if(rn=Bt,pt=rn&&rn.box&&rn.box.length>0,it=rn&&rn.offscreen,Be=rn&&rn.occluded,Pe.useRuntimeCollisionCircles){const Hn=T.text.placedSymbolArray.get(Pe.centerJustifiedTextSymbolIndex>=0?Pe.centerJustifiedTextSymbolIndex:Pe.verticalPlacedTextSymbolIndex),Yn=a.aG(T.textSizeData,ie,Hn),Bn=S.get("text-padding");Ht=this.collisionIndex.placeCollisionCircles(T,ve,Hn,T.lineVertexArray,T.glyphOffsetArray,Yn,A,k,L,y,Se,ae.predicate,Pe.collisionCircleDiameter*Yn/a.bP,Bn,this.retainedQueryData[T.bucketInstanceId].tileID),pt=ve||Ht.circles.length>0&&!Ht.collisionDetected,it=it&&Ht.offscreen,Be=Ht.occluded}if(Qe.iconFeatureIndex&&($n=Qe.iconFeatureIndex),Qe.iconBox){const Hn=Yn=>{hr(Yn);const Bn=Pe.hasIconTextFit&&_t?Cg(_t.x,_t.y,Re,Se,this.transform.angle):new a.P(0,0),xr=T.getSymbolInstanceIconSize(se,this.transform.zoom,Pe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,xr,Yn,Bn,_e,U,A,ae.predicate)};Vt&&Vt.box&&Vt.box.length&&Qe.verticalIconBox?(vn=Hn(Qe.verticalIconBox),He=vn.box.length>0):(vn=Hn(Qe.iconBox),He=vn.box.length>0),it=it&&vn.offscreen,mt=vn.occluded}const Lr=ce||Pe.numHorizontalGlyphVertices===0&&xt===0,pr=ye||Pe.numIconVertices===0;if(Lr||pr?pr?Lr||(He=He&&pt):pt=He&&pt:He=pt=He&&pt,pt&&rn&&rn.box&&this.collisionIndex.insertCollisionBox(rn.box,S.get("text-ignore-placement"),T.bucketInstanceId,Vt&&Vt.box&&bn?bn:Fn,ae.ID),He&&vn&&this.collisionIndex.insertCollisionBox(vn.box,S.get("icon-ignore-placement"),T.bucketInstanceId,$n,ae.ID),Ht&&(pt&&this.collisionIndex.insertCollisionCircles(Ht.circles,S.get("text-ignore-placement"),T.bucketInstanceId,Fn,ae.ID),y)){const Hn=T.bucketInstanceId;let Yn=this.collisionCircleArrays[Hn];Yn===void 0&&(Yn=this.collisionCircleArrays[Hn]=new SA);for(let Bn=0;Bn<Ht.circles.length;Bn+=4)Yn.circles.push(Ht.circles[Bn+0]),Yn.circles.push(Ht.circles[Bn+1]),Yn.circles.push(Ht.circles[Bn+2]),Yn.circles.push(Ht.collisionDetected?1:0)}const Or=T.projection.name!=="globe";Ne=Ne&&(Or||!Be),We=We&&(Or||!mt),this.placements[Ve]=new Ig(pt||Ne,He||We,it||T.justReloaded),d.add(Ve)};if(ze&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),Ie){const Pe=T.getSortedSymbolIndexes(this.transform.angle);for(let et=Pe.length-1;et>=0;--et){const Qe=Pe[et];Fe(T.symbolInstances.get(Qe),Qe,T.collisionArrays[Qe])}T.hasAnyZOffset&&a.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Pe=T.getSortedIndexesByZOffset();for(let et=0;et<Pe.length;++et){const Qe=Pe[et];Fe(T.symbolInstances.get(Qe),Qe,T.collisionArrays[Qe])}}else for(let Pe=l.symbolInstanceStart;Pe<l.symbolInstanceEnd;Pe++)Fe(T.symbolInstances.get(Pe),Pe,T.collisionArrays[Pe]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[T.bucketInstanceId];a.ae.invert(Pe.invProjMatrix,A),Pe.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(l,d,y,b){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:k,crossTileID:L}=y,B=a.cM(d),U=b===a.aF.vertical?k:B==="left"?T:B==="center"?S:B==="right"?A:-1;T>=0&&(l.text.placedSymbolArray.get(T).crossTileID=U>=0&&T!==U?0:L),S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=U>=0&&S!==U?0:L),A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=U>=0&&A!==U?0:L),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=U>=0&&k!==U?0:L)}markUsedOrientation(l,d,y){const b=d===a.aF.horizontal||d===a.aF.horizontalOnly?d:0,T=d===a.aF.vertical?d:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L}=y,B=l.text.placedSymbolArray;S>=0&&(B.get(S).placedOrientation=b),A>=0&&(B.get(A).placedOrientation=b),k>=0&&(B.get(k).placedOrientation=b),L>=0&&(B.get(L).placedOrientation=T)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(l):1,T=d?d.opacities:{},S=d?d.variableOffsets:{},A=d?d.placedOrientations:{};for(const k in this.placements){const L=this.placements[k],B=T[k];B?(this.opacities[k]=new yp(B,b,L.text,L.icon,null,L.clipped),y=y||L.text!==B.text.placed||L.icon!==B.icon.placed):(this.opacities[k]=new yp(null,b,L.text,L.icon,L.skipFade,L.clipped),y=y||L.text||L.icon)}for(const k in T){const L=T[k];if(!this.opacities[k]){const B=new yp(L,b,!1,!1);B.isHidden()||(this.opacities[k]=B,y=y||L.text.placed||L.icon.placed)}}for(const k in S)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=S[k]);for(const k in A)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=A[k]);y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d,y,b){const T=new Set;for(const S of d){const A=S.getBucket(l);A&&S.latestFeatureIndex&&l.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,T,S.collisionBoxArray,y,b,S.tileID,l.scope),A.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(A,S.tileID),A.updateZOffset()))}}updateBucketOpacities(l,d,y,b,T,S,A){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const k=l.layers[0].layout,L=!!l.layers[0].dynamicFilter(),B=new yp(null,0,!1,!1,!0),U=k.get("text-allow-overlap"),q=k.get("icon-allow-overlap"),H=k.get("text-variable-anchor"),ie=k.get("text-rotation-alignment")==="map",se=k.get("text-pitch-alignment")==="map",ae=new yp(null,0,U&&(q||!l.hasIconData()||k.get("icon-optional")),q&&(U||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const ce=(ve,_e,Re)=>{for(let Se=0;Se<_e/4;Se++)ve.opacityVertexArray.emplaceBack(Re)};let ye=0;T&&l.updateReplacement(S,T);for(let ve=0;ve<l.symbolInstances.length;ve++){const _e=l.symbolInstances.get(ve),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:Se,crossTileID:Ie,numIconVertices:ze,tileAnchorX:Ne,tileAnchorY:We}=_e,Fe=d.has(Ie);let Pe=this.opacities[Ie];Fe?Pe=B:Pe||(Pe=ae,this.opacities[Ie]=Pe),d.add(Ie);const et=Re>0||Se>0,Qe=ze>0,Ve=this.placedOrientations[Ie],xt=Ve===a.aF.vertical,pt=Ve===a.aF.horizontal||Ve===a.aF.horizontalOnly;!et&&!Qe||Pe.isHidden()||ye++;let He=!1;if((et||Qe)&&T)for(const it of l.activeReplacements){if(a.cJ(it,b,a.cw.Symbol,A)||it.min.x>Ne||Ne>it.max.x||it.min.y>We||We>it.max.y)continue;const Be=a.cK(Ne,We,S.canonical,it.footprintTileId.canonical);if(He=a.cL(Be,it),He)break}if(et){const it=He?au:aa(Pe.text);ce(l.text,Re,xt?au:it),ce(l.text,Se,pt?au:it);const Be=Pe.text.isHidden(),{leftJustifiedTextSymbolIndex:mt,centerJustifiedTextSymbolIndex:_t,rightJustifiedTextSymbolIndex:Bt,verticalPlacedTextSymbolIndex:Vt}=_e,rn=l.text.placedSymbolArray,Ht=Be||xt?1:0;mt>=0&&(rn.get(mt).hidden=Ht),_t>=0&&(rn.get(_t).hidden=Ht),Bt>=0&&(rn.get(Bt).hidden=Ht),Vt>=0&&(rn.get(Vt).hidden=Be||pt?1:0);const vn=this.variableOffsets[Ie];vn&&this.markUsedJustification(l,vn.anchor,_e,Ve);const Fn=this.placedOrientations[Ie];Fn&&(this.markUsedJustification(l,"left",_e,Fn),this.markUsedOrientation(l,Fn,_e))}if(Qe){const it=He?au:aa(Pe.icon),{placedIconSymbolIndex:Be,verticalPlacedIconSymbolIndex:mt}=_e,_t=l.icon.placedSymbolArray,Bt=Pe.icon.isHidden()?1:0;Be>=0&&(ce(l.icon,ze,xt?au:it),_t.get(Be).hidden=Bt),mt>=0&&(ce(l.icon,_e.numVerticalIconVertices,pt?au:it),_t.get(mt).hidden=Bt)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const it=l.collisionArrays[ve];if(it){let Be=new a.P(0,0),mt=!0;if(it.textBox||it.verticalTextBox){if(H){const Bt=this.variableOffsets[Ie];Bt?(Be=C0(Bt.anchor,Bt.width,Bt.height,Bt.textOffset,Bt.textScale),ie&&Be._rotate(se?this.transform.angle:-this.transform.angle)):mt=!1}L&&(mt=!Pe.clipped),it.textBox&&Al(l.textCollisionBox.collisionVertexArray,Pe.text.placed,!mt||xt,Be.x,Be.y),it.verticalTextBox&&Al(l.textCollisionBox.collisionVertexArray,Pe.text.placed,!mt||pt,Be.x,Be.y)}const _t=mt&&!!(!pt&&it.verticalIconBox);it.iconBox&&Al(l.iconCollisionBox.collisionVertexArray,Pe.icon.placed,_t,_e.hasIconTextFit?Be.x:0,_e.hasIconTextFit?Be.y:0),it.verticalIconBox&&Al(l.iconCollisionBox.collisionVertexArray,Pe.icon.placed,!_t,_e.hasIconTextFit?Be.x:0,_e.hasIconTextFit?Be.y:0)}}}if(l.fullyClipped=ye===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const ve=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=ve.invProjMatrix,l.placementViewportMatrix=ve.viewportMatrix,l.collisionCircleArray=ve.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function Al(g,l,d,y,b){g.emplaceBack(l?1:0,d?1:0,y||0,b||0),g.emplaceBack(l?1:0,d?1:0,y||0,b||0),g.emplaceBack(l?1:0,d?1:0,y||0,b||0),g.emplaceBack(l?1:0,d?1:0,y||0,b||0)}const Ag=Math.pow(2,25),$b=Math.pow(2,24),qb=Math.pow(2,17),vp=Math.pow(2,16),xp=Math.pow(2,9),Gb=Math.pow(2,8),A0=Math.pow(2,1);function aa(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const l=g.placed?1:0,d=Math.floor(127*g.opacity);return d*Ag+l*$b+d*qb+l*vp+d*xp+l*Gb+d*A0+l}const au=0;class Dt{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,d,y,b,T){const S=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(S,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,k)=>A.sortKey-k.sortKey));this._currentPartIndex<S.length;){const A=S[this._currentPartIndex];if(d.placeLayerBucketPart(A,this._seenCrossTileIDs,y,A.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class Wb{constructor(l,d,y,b,T,S,A,k,L){this.placement=new Vb(l,T,S,A,k,L),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(l,d,y,b){const T=a.e.now(),S=()=>{const A=a.e.now()-T;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=d[l[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=k)&&(!A.maxzoom||A.maxzoom>k)){const L=A,B=L.layout.get("symbol-z-elevate"),U=this._inProgressLayer=this._inProgressLayer||new Dt(L),q=a.am(A.source,A.scope);if(U.continuePlacement(B?b[q]:y[q],this.placement,this._showCollisionBoxes,A,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const bp=512/a.a4/2;class P0{constructor(l,d,y){this.tileID=l,this.bucketInstanceId=y,this.index=new a.cN(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=l.canonical.x*a.a4,T=l.canonical.y*a.a4;for(let S=0;S<d.length;S++){const{key:A,crossTileID:k,tileAnchorX:L,tileAnchorY:B}=d.get(S),U=Math.floor((b+L)*bp),q=Math.floor((T+B)*bp);this.index.add(U,q),this.keys.push(A),this.crossTileIDs.push(k)}this.index.finish()}findMatches(l,d,y){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),T=bp/Math.pow(2,d.canonical.z-this.tileID.canonical.z),S=d.canonical.x*a.a4,A=d.canonical.y*a.a4;for(let k=0;k<l.length;k++){const L=l.get(k);if(L.crossTileID)continue;const{key:B,tileAnchorX:U,tileAnchorY:q}=L,H=Math.floor((S+U)*T),ie=Math.floor((A+q)*T),se=this.index.range(H-b,ie-b,H+b,ie+b);for(const ae of se){const ce=this.crossTileIDs[ae];if(this.keys[ae]===B&&!y.has(ce)){y.add(ce),L.crossTileID=ce;break}}}}}class Hb{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Pg{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(d!==0)for(const y in this.indexes){const b=this.indexes[y],T={};for(const S in b){const A=b[S];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+d),T[A.tileID.key]=A}this.indexes[y]=T}this.lng=l}addBucket(l,d,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const b=this.usedCrossTileIDs[l.overscaledZ];for(const T in this.indexes){const S=this.indexes[T];if(Number(T)>l.overscaledZ)for(const A in S){const k=S[A];k.tileID.isChildOf(l)&&k.findMatches(d.symbolInstances,l,b)}else{const A=S[l.scaledTo(Number(T)).key];A&&A.findMatches(d.symbolInstances,l,b)}}for(let T=0;T<d.symbolInstances.length;T++){const S=d.symbolInstances.get(T);S.crossTileID||(S.crossTileID=y.generate(),b.add(S.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new P0(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const y of d.crossTileIDs)this.usedCrossTileIDs[l].delete(y)}removeStaleBuckets(l){let d=!1;for(const y in this.indexes){const b=this.indexes[y];for(const T in b)l[b[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[T]),delete b[T],d=!0)}return d}}class mc{constructor(){this.layerIndexes={},this.crossTileIDs=new Hb,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,y,b){let T=this.layerIndexes[l.fqid];T===void 0&&(T=this.layerIndexes[l.fqid]=new Pg);let S=!1;const A={};b.name!=="globe"&&T.handleWrapJump(y);for(const k of d){const L=k.getBucket(l);L&&l.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(k.tileID,L,this.crossTileIDs)&&(S=!0),A[L.bucketInstanceId]=!0)}return T.removeStaleBuckets(A)&&(S=!0),S}pruneUnusedLayers(l){const d={};l.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const R0=new a.U({data:new a.W(a.N.colorTheme.data)}),la=(g,l)=>pn(g,l&&l.filter(d=>d.identifier!=="source.canvas")),Rg=a.ai(Sr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Sd=a.ai(Sr,["setCenter","setZoom","setBearing","setPitch"]),Zb={version:8,layers:[],sources:{}},Xb={duration:300,delay:0};class ca extends a.E{constructor(l,d={}){super(),this.map=l,this.scope=d.scope||"",this.globalId=null,this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=a.Q({},Xb),this._buildingIndex=new Bo(this),this.crossTileSymbolIndex=new mc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=d.styleChanges||new X,this.dispatcher=d.dispatcher?d.dispatcher:new a.by(a.bz(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new Tn,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new a.cP(l._requestManager,d.localFontFamily?a.cQ.all:d.localIdeographFontFamily?a.cQ.ideographs:a.cQ.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new Ci(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._config=d.config,this._initialConfig=d.initialConfig,this.dispatcher.broadcast("setReferrer",a.cR());const y=this;this._rtlTextPluginCallback=ca.registerForPluginStateChange(b=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(T,S)=>{if(a.cS(T),S&&S.every(A=>A))for(const A in y._sourceCaches){const k=y._sourceCaches[A],L=k.getSource().type;L!=="vector"&&L!=="geojson"||k.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const T=this.getOwnSource(b.sourceId);if(T&&T.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===T.id&&this._validateLayer(A)}})}load(l){return l?(typeof l=="string"?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if(typeof l=="string"){if(a.cT(l))return l;const d=a.cU(l);if(!d.startsWith("http"))try{return new URL(d,location.href).toString()}catch{return d}return d}return`json://${a.cV(JSON.stringify(l))}`}_diffStyle(l,d,y){this.globalId=this._getGlobalId(l);const b=(T,S)=>{try{S(null,this.setState(T,y))}catch(A){S(A,!1)}};if(typeof l=="string"){const T=this.map._requestManager.normalizeStyleURL(l),S=this.map._requestManager.transformRequest(T,a.R.Style);a.h(S,(A,k)=>{A?this.fire(new a.f(A)):k&&b(k,d)})}else typeof l=="object"&&b(l,d)}loadURL(l,d={}){this.fire(new a.g("dataloading",{dataType:"style"}));const y=typeof d.validate=="boolean"?d.validate:!a.cT(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,d.accessToken),this.resolvedImports.add(l);const b=this.importsCache.get(l);if(b)return this._load(b,y);const T=this.map._requestManager.transformRequest(l,a.R.Style);this._request=a.h(T,(S,A)=>{if(this._request=null,S)this.fire(new a.f(S));else if(A)return this.importsCache.set(l,A),this._load(A,y)})}loadJSON(l,d={}){this.fire(new a.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=a.e.frame(()=>{this._request=null,this._load(l,d.validate!==!1)})}loadEmpty(){this.fire(new a.g("dataloading",{dataType:"style"})),this._load(Zb,!1)}_loadImports(l,d,y){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const T of l){const S=this._createFragmentStyle(T),A=new Promise(B=>{S.once("style.import.load",B),S.once("error",B)}).then(()=>this.mergeAll());if(b.push(A),this.resolvedImports.has(T.url)){S.loadEmpty();continue}const k=T.data||this.importsCache.get(T.url);k?(S.loadJSON(k,{validate:d}),this._isInternalStyle(k)&&(S.globalId=null)):T.url?S.loadURL(T.url,{validate:d}):S.loadEmpty();const L={style:S,id:T.id,config:T.config};if(y){const B=this.fragments.findIndex(({id:U})=>U===y);this.fragments=this.fragments.slice(0,B).concat(L).concat(this.fragments.slice(B))}else this.fragments.push(L)}return Promise.allSettled(b)}getImportGlobalIds(l=this,d=new Set){for(const y of l.fragments)y.style.globalId&&d.add(y.style.globalId),this.getImportGlobalIds(y.style,d);return[...d.values()]}_createFragmentStyle(l){const d=this.scope?a.am(l.id,this.scope):l.id;let y;const b=this._initialConfig&&this._initialConfig[d];(l.config||b)&&(y=a.Q({},l.config,b));const T=new ca(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,configDependentLayers:this._configDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&l.fragment!==!1)}_load(l,d){const y=l.schema;if(this._isInternalStyle(l)){const S=a.Q({},Zb,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(S,d)}if(this.updateConfig(this._config,y),d&&la(this,te(l)))return;this._loaded=!0,this.stylesheet=a.cW(l);const b=()=>{for(const L in l.sources)this.addSource(L,l.sources[L],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const S=mp(this.stylesheet.layers);if(this._order=S.map(L=>L.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new ar(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ar(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const L of S){const B=a.c$(L,this.scope,this._styleColorTheme.lut,this.options);B.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B,this._serializedLayers[B.id]=B.serialize();const U=this.getOwnLayerSourceCache(B),q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&B.canCastShadows()&&q&&(U.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.g("data",{dataType:"style"}));const k=this.isRootStyle();l.imports?this._loadImports(l.imports,d).then(()=>{this._reloadImports(),this.fire(new a.g(k?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.g(k?"style.load":"style.import.load")))},T=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=T,T){const S=this._evaluateColorThemeData(T);this._loadColorTheme(S).then(()=>{b()}).catch(A=>{a.w(`Couldn't load color theme from the stylesheet: ${A}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,d,y,b,T,S,A,k;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(l=B.light),B.stylesheet.lights)for(const U of B.stylesheet.lights)U.type==="ambient"&&B.ambientLight!=null&&(d=B.ambientLight),U.type==="directional"&&B.directionalLight!=null&&(y=B.directionalLight);b=this._prioritizeTerrain(b,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(T=B.fog),B.stylesheet.camera!=null&&(k=B.stylesheet.camera),B.stylesheet.projection!=null&&(S=B.stylesheet.projection),B.stylesheet.transition!=null&&(A=B.stylesheet.transition),L[B.scope]=B._styleColorTheme}}),this.light=l,this.ambientLight=d,this.directionalLight=y,this.fog=T,this._styleColorThemeForScope=L,b===null?delete this.terrain:this.terrain=b,this.camera=k||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=a.Q({},Xb,A),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const d=y=>{for(const b of y.fragments)d(b.style);l(y)};d(this)}_prioritizeTerrain(l,d,y){const b=l&&l.drapeRenderMode===0;return y===null?d&&d.drapeRenderMode===0?d:b?l:null:d!=null&&(!l||b||d&&d.drapeRenderMode===1)?d:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{l=this._prioritizeTerrain(l,d.terrain,d.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(l=d.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},d={},y={};this.forEachFragmentStyle(b=>{for(const T in b._sourceCaches){const S=a.am(T,b.scope);l[S]=b._sourceCaches[T]}for(const T in b._otherSourceCaches){const S=a.am(T,b.scope);d[S]=b._otherSourceCaches[T]}for(const T in b._symbolSourceCaches){const S=a.am(T,b.scope);y[S]=b._symbolSourceCaches[T]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=y}mergeLayers(){const l={},d=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const A of S._order){const k=S._layers[A];if(k.type==="slot"){const L=a.cX(A);if(l[L])continue;l[L]=[]}k.slot&&l[k.slot]?l[k.slot].push(k):d.push(k)}}),this._mergedOrder=[],this._clipLayerIndices=[];let b=0;const T=(S=[])=>{for(const A of S)if(A.type==="slot"){const k=a.cX(A.id);l[k]&&T(l[k]),this._mergedSlots.push(k)}else{const k=a.am(A.id,A.scope);this._mergedOrder.push(k),y[k]=A,A.is3D()&&(this._has3DLayers=!0),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0),A.type==="clip"&&this._clipLayerIndices.push(b),b++}};T(d),this._mergedOrder.sort((S,A)=>{const k=y[S],L=y[A];return k.hasInitialOcclusionOpacityProperties?L.is3D()?1:0:k.is3D()&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=a.Q({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(d,y,b){const T=a.Q({},y);for(const A of Object.keys(a.N.colorTheme))T[A]===void 0&&(T[A]=a.N.colorTheme[A].default);const S=new a.O(R0,d,new Map(b));return S.setTransitionOrValue(T,b),S.untransitioned().possiblyEvaluate(new a.Y(0))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const d=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,b)=>{const T="data:image/png;base64,";if(!l||l.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let S=l;S.startsWith(T)||(S=T+S);const A="mapbox-reserved-lut",k=new Image;k.src=S,k.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},k.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==d)return void y();this._styleColorTheme.lutLoading=!1;const{width:L,height:B,data:U}=a.e.getImageData(k);if(B>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==B*B)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new a.j({width:L,height:B},U),pixelRatio:1,sdf:!1,version:0});const q=this.imageManager.getImage(A,this.scope);q?(this._styleColorTheme.lut={image:q.data,data:l},y()):b(new Error("Missing LUT image."))}})}getLut(l){const d=this._styleColorThemeForScope[l];return d?d.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(d,y,b){let T,S,A;const k=a.e.devicePixelRatio>1?"@2x":"";let L=a.h(y.transformRequest(y.normalizeSpriteURL(d,k,".json"),a.R.SpriteJSON),(q,H)=>{L=null,A||(A=q,T=H,U())}),B=a.i(y.transformRequest(y.normalizeSpriteURL(d,k,".png"),a.R.SpriteImage),(q,H)=>{B=null,A||(A=q,S=H,U())});function U(){if(A)b(A);else if(T&&S){const q=a.e.getImageData(S),H={};for(const ie in T){const{width:se,height:ae,x:ce,y:ye,sdf:ve,pixelRatio:_e,stretchX:Re,stretchY:Se,content:Ie}=T[ie],ze=new a.j({width:se,height:ae});a.j.copy(q,ze,{x:ce,y:ye},{x:0,y:0},{width:se,height:ae},null),H[ie]={data:ze,pixelRatio:_e,sdf:ve,stretchX:Re,stretchY:Se,content:Ie}}b(null,H)}}return{cancel(){L&&(L.cancel(),L=null),B&&(B.cancel(),B=null)}}}(l,this.map._requestManager,(d,y)=>{if(this._spriteRequest=null,d)this.fire(new a.f(d));else if(y)for(const b in y)this.imageManager.addImage(b,this.scope,y[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.g("data",{dataType:"style"}))})}_validateLayer(l){const d=this.getOwnSource(l.source);if(!d)return;const y=l.sourceLayer;y&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(y)===-1)&&this.fire(new a.f(new Error(`Source layer "${y}" does not exist on source "${d.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,d)=>{const y=this.fragments[d];return y&&y.style&&(l.data=y.style.serialize()),l})}_serializeSources(){const l={};for(const d in this._sourceCaches){const y=this._sourceCaches[d].getSource();l[y.id]||(l[y.id]=y.serialize())}return l}_serializeLayers(l){const d=[];for(const y of l){const b=this._layers[y];b&&b.type!=="custom"&&d.push(b.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const d=this.getOwnLayer(l);if(d)return d;this.fire(new a.f(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const d=this.getOwnSource(l);if(d)return d;this.fire(new a.f(new Error(`The source '${l}' does not exist in the map's style.`)))}precompilePrograms(l,d){const y=this.map.painter;if(y)for(let b=l.minzoom||0;b<(l.maxzoom||25.5);b++){const T=l.getProgramIds();if(T)for(const S of T){const A=l.getDefaultProgramParams(S,d.zoom,this._styleColorTheme.lut);A&&(y.style=this,this.fog&&(y._fogVisible=!0,A.overrideFog=!0,y.getOrCreateProgram(S,A)),y._fogVisible=!1,A.overrideFog=!1,y.getOrCreateProgram(S,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,y.getOrCreateProgram(S,A)))}}}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const d=this.calculateLightsBrightness();l.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d));const y=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const A in S){const{updatedIds:k,removedIds:L}=S[A];(k||L)&&(this._updateWorkerLayers(A,k,L),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const T={};for(const S in this._mergedSourceCaches){const A=this._mergedSourceCaches[S];T[S]=A.used,A.used=!1,A.tileCoverLift=0}for(const S of this._mergedOrder){const A=this._mergedLayers[S];if(A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)){const k=this.getLayerSourceCache(A);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,l)}):this.precompilePrograms(A,l))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();for(const S in T){const A=this._mergedSourceCaches[S];T[S]!==A.used&&A.getSource().fire(new a.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new a.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,d,y){const b=this.getFragmentStyle(l);b&&this.dispatcher.broadcast("updateLayers",{layers:d?b._serializeLayers(d):[],scope:l,removedIds:y||[],options:b.options})}setState(l,d){if(this._checkLoaded(),la(this,te(l)))return!1;(l=a.cW(l)).layers=mp(l.layers);const y=function(S,A){if(!S)return[{command:Sr.setStyle,args:[A]}];let k=[];try{if(!a.d(S.version,A.version))return[{command:Sr.setStyle,args:[A]}];if(a.d(S.center,A.center)||k.push({command:Sr.setCenter,args:[A.center]}),a.d(S.zoom,A.zoom)||k.push({command:Sr.setZoom,args:[A.zoom]}),a.d(S.bearing,A.bearing)||k.push({command:Sr.setBearing,args:[A.bearing]}),a.d(S.pitch,A.pitch)||k.push({command:Sr.setPitch,args:[A.pitch]}),a.d(S.sprite,A.sprite)||k.push({command:Sr.setSprite,args:[A.sprite]}),a.d(S.glyphs,A.glyphs)||k.push({command:Sr.setGlyphs,args:[A.glyphs]}),a.d(S.imports,A.imports)||function(H=[],ie=[],se){ie=ie||[];const ae=(H=H||[]).map(Sg),ce=ie.map(Sg),ye=H.reduce(pc,{}),ve=ie.reduce(pc,{}),_e=ae.slice();let Re,Se,Ie,ze;for(Re=0,Se=0;Re<ae.length;Re++)Ie=ae[Re],ve.hasOwnProperty(Ie)?Se++:(se.push({command:Sr.removeImport,args:[Ie]}),_e.splice(_e.indexOf(Ie,Se),1));for(Re=0,Se=0;Re<ce.length;Re++)Ie=ce[ce.length-1-Re],_e[_e.length-1-Re]!==Ie&&(ye.hasOwnProperty(Ie)?(se.push({command:Sr.removeImport,args:[Ie]}),_e.splice(_e.lastIndexOf(Ie,_e.length-Se),1)):Se++,ze=_e[_e.length-Re],se.push({command:Sr.addImport,args:[ve[Ie],ze]}),_e.splice(_e.length-Re,0,Ie));for(const Ne of ie){const We=ye[Ne.id];We&&!a.d(We,Ne)&&se.push({command:Sr.updateImport,args:[Ne.id,Ne]})}}(S.imports,A.imports,k),a.d(S.transition,A.transition)||k.push({command:Sr.setTransition,args:[A.transition]}),a.d(S.light,A.light)||k.push({command:Sr.setLight,args:[A.light]}),a.d(S.fog,A.fog)||k.push({command:Sr.setFog,args:[A.fog]}),a.d(S.projection,A.projection)||k.push({command:Sr.setProjection,args:[A.projection]}),a.d(S.lights,A.lights)||k.push({command:Sr.setLights,args:[A.lights]}),a.d(S.camera,A.camera)||k.push({command:Sr.setCamera,args:[A.camera]}),!a.d(S["color-theme"],A["color-theme"]))return[{command:Sr.setStyle,args:[A]}];const L={},B=[];(function(H,ie,se,ae){let ce;for(ce in ie=ie||{},H=H||{})H.hasOwnProperty(ce)&&(ie.hasOwnProperty(ce)||Fb(ce,se,ae));for(ce in ie){if(!ie.hasOwnProperty(ce))continue;const ye=ie[ce];H.hasOwnProperty(ce)?a.d(H[ce],ye)||(H[ce].type==="geojson"&&ye.type==="geojson"&&gp(H,ie,ce)?se.push({command:Sr.setGeoJSONSourceData,args:[ce,ye.data]}):TA(ce,ie,se,ae)):Ed(ce,ie,se)}})(S.sources,A.sources,B,L);const U=[];S.layers&&S.layers.forEach(H=>{H.source&&L[H.source]?k.push({command:Sr.removeLayer,args:[H.id]}):U.push(H)});let q=S.terrain;q&&L[q.source]&&(k.push({command:Sr.setTerrain,args:[void 0]}),q=void 0),k=k.concat(B),a.d(q,A.terrain)||k.push({command:Sr.setTerrain,args:[A.terrain]}),function(H,ie,se){ie=ie||[];const ae=(H=H||[]).map(Sg),ce=ie.map(Sg),ye=H.reduce(pc,{}),ve=ie.reduce(pc,{}),_e=ae.slice(),Re=Object.create(null);let Se,Ie,ze,Ne,We,Fe,Pe;for(Se=0,Ie=0;Se<ae.length;Se++)ze=ae[Se],ve.hasOwnProperty(ze)?Ie++:(se.push({command:Sr.removeLayer,args:[ze]}),_e.splice(_e.indexOf(ze,Ie),1));for(Se=0,Ie=0;Se<ce.length;Se++)ze=ce[ce.length-1-Se],_e[_e.length-1-Se]!==ze&&(ye.hasOwnProperty(ze)?(se.push({command:Sr.removeLayer,args:[ze]}),_e.splice(_e.lastIndexOf(ze,_e.length-Ie),1)):Ie++,Fe=_e[_e.length-Se],se.push({command:Sr.addLayer,args:[ve[ze],Fe]}),_e.splice(_e.length-Se,0,ze),Re[ze]=!0);for(Se=0;Se<ce.length;Se++)if(ze=ce[Se],Ne=ye[ze],We=ve[ze],!Re[ze]&&!a.d(Ne,We))if(a.d(Ne.source,We.source)&&a.d(Ne["source-layer"],We["source-layer"])&&a.d(Ne.type,We.type)){for(Pe in ou(Ne.layout,We.layout,se,ze,null,Sr.setLayoutProperty),ou(Ne.paint,We.paint,se,ze,null,Sr.setPaintProperty),a.d(Ne.slot,We.slot)||se.push({command:Sr.setSlot,args:[ze,We.slot]}),a.d(Ne.filter,We.filter)||se.push({command:Sr.setFilter,args:[ze,We.filter]}),a.d(Ne.minzoom,We.minzoom)&&a.d(Ne.maxzoom,We.maxzoom)||se.push({command:Sr.setLayerZoomRange,args:[ze,We.minzoom,We.maxzoom]}),Ne)Ne.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&Pe!=="slot"&&(Pe.indexOf("paint.")===0?ou(Ne[Pe],We[Pe],se,ze,Pe.slice(6),Sr.setPaintProperty):a.d(Ne[Pe],We[Pe])||se.push({command:Sr.setLayerProperty,args:[ze,Pe,We[Pe]]}));for(Pe in We)We.hasOwnProperty(Pe)&&!Ne.hasOwnProperty(Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&Pe!=="slot"&&(Pe.indexOf("paint.")===0?ou(Ne[Pe],We[Pe],se,ze,Pe.slice(6),Sr.setPaintProperty):a.d(Ne[Pe],We[Pe])||se.push({command:Sr.setLayerProperty,args:[ze,Pe,We[Pe]]}))}else se.push({command:Sr.removeLayer,args:[ze]}),Fe=_e[_e.lastIndexOf(ze)+1],se.push({command:Sr.addLayer,args:[We,Fe]})}(U,A.layers,k)}catch(L){console.warn("Unable to compute style diff:",L),k=[{command:Sr.setStyle,args:[A]}]}return k}(this.serialize(),l).filter(S=>!(S.command in Sd));if(y.length===0)return!1;const b=y.filter(S=>!(S.command in Rg));if(b.length>0)throw new Error(`Unimplemented: ${b.map(S=>S.command).join(", ")}.`);const T=[];return y.forEach(S=>{T.push(this[S.command].apply(this,S.args))}),d&&Promise.all(T).then(d),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,d){return this.getImage(l)?this.fire(new a.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,d),this._afterImageUpdated(l),this)}updateImage(l,d){this.imageManager.updateImage(l,this.scope,d)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new a.f(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new a.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,d,y={}){return this._checkLoaded(),this._validate(vt,`models.${l}`,d,null,y)||(this.modelManager.addModel(l,d,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new a.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,d,y={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(le,`sources.${l}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=ue(l,d,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const T=S=>{const A=(S?"symbol:":"other:")+b.id,k=a.am(A,this.scope),L=this._sourceCaches[A]=new a.bx(k,b,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=L,L.onAdd(this.map)};T(!1),d.type!=="vector"&&d.type!=="geojson"||T(!0),b.onAdd&&b.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const d=this.getOwnSource(l);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(l);for(const b of y){const T=a.cX(b.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(b.id),b.fire(new a.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,d){this._checkLoaded(),this.getOwnSource(l).setData(d),this._changes.setDirty()}getOwnSource(l){const d=this.getOwnSourceCache(l);return d&&d.getSource()}getOwnSources(){const l=[];for(const d in this._otherSourceCaches){const y=this.getOwnSourceCache(d);y&&l.push(y.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const d in l){const y=l[d]._tiles;for(const b in y){const T=y[b];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const b of l){if(this._validate(Oe,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(d)}else this.ambientLight=new tc(b,ad||(ad=new a.U({color:new a.W(a.N.properties_light_ambient.color),intensity:new a.W(a.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(d)}else this.directionalLight=new tc(b,ld||(ld=new a.U({direction:new a.a6(a.N.properties_light_directional.direction),color:new a.W(a.N.properties_light_directional.color),intensity:new a.W(a.N.properties_light_directional.intensity),"cast-shadows":new a.W(a.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new a.W(a.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=new a.Y(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,d=this.ambientLight;if(!l||!d)return;const y=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),b=l.properties.get("color").toRenderColor(null).toArray01(),T=l.properties.get("intensity"),S=l.properties.get("direction"),A=1-a.ad(S.x,S.y,S.z)[2]/90,k=y(b)*T*A,L=d.properties.get("color").toRenderColor(null).toArray01(),B=d.properties.get("intensity");return(k+y(L)*B)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(a.cY(l)){const d=a.cZ(l),y=this.fragments.find(({id:T})=>T===d);if(!y)throw new Error(`Style import not found: ${l}`);const b=a.cX(l);return y.style.getFragmentStyle(b)}{const d=this.fragments.find(({id:y})=>y===l);if(!d)throw new Error(`Style import not found: ${l}`);return d.style}}getConfigProperty(l,d){const y=this.getFragmentStyle(l);if(!y)return null;const b=a.am(d,y.scope),T=y.options.get(b),S=T?T.value||T.default:null;return S?S.serialize():null}setConfigProperty(l,d,y){const b=this.getFragmentStyle(l);if(!b)return;const T=b.stylesheet.schema;if(!T||!T[d])return;const S=a.z(y);if(S.result!=="success")return void la(this,S.value);const A=S.value.expression,k=a.am(d,b.scope),L=b.options.get(k);if(!L)return;let B;const{minValue:U,maxValue:q,stepValue:H,type:ie,values:se}=T[d],ae=a.z(T[d].default);ae.result==="success"&&(B=ae.value.expression),B?(this.options.set(k,{...L,value:A,default:B,minValue:U,maxValue:q,stepValue:H,type:ie,values:se}),this.updateConfigDependencies(d)):this.fire(new a.f(new Error(`No schema defined for the config option "${d}" in the "${l}" fragment.`)))}getConfig(l){const d=this.getFragmentStyle(l);if(!d)return null;const y=d.stylesheet.schema;if(!y)return null;const b={};for(const T in y){const S=a.am(T,d.scope),A=d.options.get(S),k=A?A.value||A.default:null;b[T]=k?k.serialize():null}return b}setConfig(l,d){const y=this.getFragmentStyle(l);y&&(y.updateConfig(d,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){const d=this.getFragmentStyle(l);return d?d.stylesheet.schema:null}setSchema(l,d){const y=this.getFragmentStyle(l);y&&(y.stylesheet.schema=d,y.updateConfig(y._config,d),this.updateConfigDependencies())}updateConfig(l,d){if(this._config=l,l||d)if(d)for(const y in d){let b,T;const S=a.z(d[y].default);if(S.result==="success"&&(b=S.value.expression),l&&l[y]!==void 0){const q=a.z(l[y]);q.result==="success"&&(T=q.value.expression)}const{minValue:A,maxValue:k,stepValue:L,type:B,values:U}=d[y];if(b){const q=a.am(y,this.scope);this.options.set(q,{default:b,value:T,minValue:A,maxValue:k,stepValue:L,type:B,values:U})}else this.fire(new a.f(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new a.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(l){for(const d of this._configDependentLayers){const y=this.getLayer(d);if(y){if(l&&!y.configDependencies.has(l))continue;y.possiblyEvaluateVisibility(),this._updateLayer(y)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(d=>{if(d._styleColorTheme.colorTheme){const y=d._evaluateColorThemeData(d._styleColorTheme.colorTheme);(!d._styleColorTheme.lut&&y!==""||d._styleColorTheme.lut&&y!==d._styleColorTheme.lut.data)&&d.setColorTheme(d._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(l,d,y={}){this._checkLoaded();const b=l.id;if(this._layers[b])return void this.fire(new a.f(new Error(`Layer with id "${b}" already exists on this map`)));let T;if(l.type==="custom"){if(la(this,a.c_(l)))return;T=a.c$(l,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof l.source=="object"&&(this.addSource(b,l.source),l=a.cW(l),l=a.Q(l,{source:b})),this._validate(rt,`layers.${b}`,l,{arrayIndex:-1},y))return;T=a.c$(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[T.id]=T.serialize()}T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid);let S=this._order.length;if(d){const B=this._order.indexOf(d);if(B===-1)return void this.fire(new a.f(new Error(`Layer with id "${d}" does not exist on this map.`)));T.slot===this._layers[d].slot?S=B:a.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,b),this._layerOrderChanged=!0,this._layers[b]=T;const A=this.getOwnLayerSourceCache(T),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&T.canCastShadows()&&k&&(A.castsShadows=!0);const L=this._changes.getRemovedLayer(T);if(L&&T.source&&A&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const B=a.am(T.source,T.scope);L.type!==T.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),A.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(l,d){this._checkLoaded();const y=this._checkLayer(l);if(!y||l===d)return;const b=this._order.indexOf(l);this._order.splice(b,1);let T=this._order.length;if(d){const S=this._order.indexOf(d);if(S===-1)return void this.fire(new a.f(new Error(`Layer with id "${d}" does not exist on this map.`)));y.slot===this._layers[d].slot?T=S:a.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const d=this._checkLayer(l);if(!d)return;d.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const b=this.getOwnLayerSourceCache(d);if(b&&b.castsShadows){let T=!1;for(const S in this._layers)if(this._layers[S].source===d.source&&this._layers[S].canCastShadows()){T=!0;break}b.castsShadows=T}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const d in this._layers)if(this._layers[d].type===l)return!0;return!1}setLayerZoomRange(l,d,y){this._checkLoaded();const b=this._checkLayer(l);b&&(b.minzoom===d&&b.maxzoom===y||(d!=null&&(b.minzoom=d),y!=null&&(b.maxzoom=y),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,d){this._checkLoaded();const y=this._checkLayer(l);y&&y.slot!==d&&(y.slot=d,this._updateLayer(y))}setFilter(l,d,y={}){this._checkLoaded();const b=this._checkLayer(l);if(b&&!a.d(b.filter,d))return d==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(qe,`layers.${b.id}.filter`,d,{layerType:b.type},y)||(b.filter=a.cW(d),this._updateLayer(b)))}getFilter(l){const d=this._checkLayer(l);if(d)return a.cW(d.filter)}setLayoutProperty(l,d,y,b={}){this._checkLoaded();const T=this._checkLayer(l);if(T&&!a.d(T.getLayoutProperty(d),y)){if(y!=null&&(!b||b.validate!==!1)&&la(T,yt.call(te,{key:`layers.${l}.layout.${d}`,layerType:T.type,objectKey:d,value:y,styleSpec:a.N,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(d,y),T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),this._updateLayer(T)}}getLayoutProperty(l,d){const y=this._checkLayer(l);if(y)return y.getLayoutProperty(d)}setPaintProperty(l,d,y,b={}){this._checkLoaded();const T=this._checkLayer(l);if(!T||a.d(T.getPaintProperty(d),y)||y!=null&&(!b||b.validate!==!1)&&la(T,tt.call(te,{key:`layers.${l}.paint.${d}`,layerType:T.type,objectKey:d,value:y,styleSpec:a.N})))return;const S=T.setPaintProperty(d,y);T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),S&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(l,d){const y=this._checkLayer(l);if(y)return y.getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const y=l.source,b=l.sourceLayer,T=this._checkSource(y);if(!T)return;const S=T.type;if(S==="geojson"&&b)return void this.fire(new a.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!b)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(y);for(const k of A)k.setFeatureState(b,l.id,d)}removeFeatureState(l,d){this._checkLoaded();const y=l.source,b=this._checkSource(y);if(!b)return;const T=b.type,S=T==="vector"?l.sourceLayer:void 0;if(T==="vector"&&!S)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new a.f(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(y);for(const k of A)k.removeFeatureState(S,l.id,d)}getFeatureState(l){this._checkLoaded();const d=l.source,y=l.sourceLayer,b=this._checkSource(d);if(b){if(b.type!=="vector"||y)return l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(y,l.id);this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=a.Q({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return a.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),d=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return a.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateLayer(l){this._changes.updateLayer(l);const d=this.getLayerSourceCache(l),y=a.am(l.source,l.scope),b=this._changes.getUpdatedSourceCaches();l.source&&!b[y]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),d.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const d=A=>this._mergedLayers[A].type==="fill-extrusion"||this._mergedLayers[A].type==="model",y=this.order,b={},T=[];for(let A=y.length-1;A>=0;A--){const k=y[A];if(d(k)){b[k]=A;for(const L of l){const B=L[k];if(B)for(const U of B)T.push(U)}}}T.sort((A,k)=>k.intersectionZ-A.intersectionZ);const S=[];for(let A=y.length-1;A>=0;A--){const k=y[A];if(d(k))for(let L=T.length-1;L>=0;L--){const B=T[L].feature;if(B.layer&&b[B.layer.id]<A)break;S.push(B),T.pop()}else for(const L of l){const B=L[k];if(B)for(const U of B)S.push(U.feature)}}return S}queryRenderedFeatures(l,d,y){d&&d.filter&&this._validate(qe,"queryRenderedFeatures.filter",d.filter,null,d),d.scope=this.scope,d.availableImages=this._availableImages,d.serializedLayers=this._serializedLayers;const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new a.f(new Error("parameters.layers must be an Array."))),[];for(const L of d.layers){const B=this._mergedLayers[L];if(!B)return this.fire(new a.f(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const T=[],S=d.serializedLayers||{},A=d&&d.layers?d.layers.some(L=>{const B=this.getLayer(L);return B&&B.is3D()}):this.has3DLayers(),k=oa.createFromScreenPoints(l,y);for(const L in this._mergedSourceCaches){const B=this._mergedSourceCaches[L].getSource();if(!B||B.scope!==d.scope)continue;const U=this._mergedSourceCaches[L].getSource().id;d.layers&&!b[U]||T.push(fc(this._mergedSourceCaches[L],this._mergedLayers,S,k,d,y,A,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(L,B,U,q,H,ie,se){const ae={},ce=ie.queryRenderedSymbols(q),ye=[];for(const ve of Object.keys(ce).map(Number))ye.push(se[ve]);ye.sort(S0);for(const ve of ye){const _e=ve.featureIndex.lookupSymbolFeatures(ce[ve.bucketInstanceId],B,ve.bucketIndex,ve.sourceLayerIndex,H.filter,H.layers,H.availableImages,L);for(const Re in _e){const Se=ae[Re]=ae[Re]||[],Ie=_e[Re];Ie.sort((ze,Ne)=>{const We=ve.featureSortOrder;if(We){const Fe=We.indexOf(ze.featureIndex);return We.indexOf(Ne.featureIndex)-Fe}return Ne.featureIndex-ze.featureIndex});for(const ze of Ie)Se.push(ze)}}for(const ve in ae)ae[ve].forEach(_e=>{const Re=_e.feature,Se=U(L[ve]);if(!Se)return;const Ie=Se.getFeatureState(Re.layer["source-layer"],Re.id);Re.source=Re.layer.source,Re.layer["source-layer"]&&(Re.sourceLayer=Re.layer["source-layer"]),Re.state=Ie});return ae}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),k.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(l,d){d&&d.filter&&this._validate(qe,"querySourceFeatures.filter",d.filter,null,d);const y=this.getOwnSourceCaches(l);let b=[];for(const T of y)b=b.concat(bA(T,d));return b}addSourceType(l,d,y){return ca.getSourceType(l)?y(new Error(`A source type called "${l}" already exists.`)):(ca.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,d,y={}){this._checkLoaded();const b=this.light.getLight();let T=!1;for(const A in l)if(!a.d(l[A],b[A])){T=!0;break}if(!T)return;const S=this._getTransitionParameters();this.light.setLight(l,d,y),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,d=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),d===0&&delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=l;const b=l.source==null;if(d===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const A="terrain-dem-src";this.addSource(A,y.source),y=a.cW(y),y=a.Q(y,{source:A})}const T=a.Q({},y),S={};if(this.terrain&&b){T.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(S.style=A.serialize())}if(this._validate(De,"terrain",T,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&d!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,d),this.fire(new a.g("data",{dataType:"style"}))}else{const T=this.terrain,S=T.get();for(const A of Object.keys(a.N.terrain))!y.hasOwnProperty(A)&&a.N.terrain[A].default&&(y[A]=a.N.terrain[A].default);for(const A in l)if(!a.d(l[A],S[A])){T.set(l,this.options),this.stylesheet.terrain=l;const k=this._getTransitionParameters({duration:0});T.updateTransitions(k),this.fire(new a.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const d=this.fog=new qs(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!a.d(d.get(),l)){d.set(l,this.options),this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}}else this._createFog(l);this._markersNeedUpdate=!0}setColorTheme(l){this._checkLoaded();const d=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()};if(this._styleColorTheme.colorTheme=l,!l)return this._styleColorTheme.lut=null,void d();const y=this._evaluateColorThemeData(l);this._loadColorTheme(y).then(()=>{this.fire(new a.g("colorthemeset")),d()}).catch(b=>{a.w(`Couldn't set color theme: ${b}`)})}_getTransitionParameters(l){return{now:a.e.now(),transition:a.Q(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],d=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?l.push(y):d.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...d)}_createTerrain(l,d){const y=this.terrain=new lr(l,d,this.scope,this.options);d===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});y.updateTransitions(b)}_force3DLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="symbol"&&this._updateLayer(d)}}_validate(l,d,y,b,T={}){if(T&&T.validate===!1)return!1;const S=a.Q({},this.serialize());return la(this,l.call(te,a.Q({key:d,style:S,value:y,styleSpec:a.N},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const d=this.getSourceCaches(l);for(const y of d)y.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const d=this.getSourceCaches(l);for(const y of d)y.resume(),y.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let d;this.directionalLight&&(d=Fo(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(l,void 0,void 0,d)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const d=this._sourceCaches[l];d.resume(),d.reload()}}_updatePlacement(l,d,y,b,T,S,A=!1){let k=!1,L=!1;const B={},U={};for(const q of this._mergedOrder){const H=this._mergedLayers[q];if(H.type!=="symbol")continue;const ie=a.am(H.source,H.scope);let se=B[ie];if(!se){const ce=this.getLayerSourceCache(H);if(!ce)continue;const ye=ce.getRenderableIds(!0).map(ve=>ce.getTileByID(ve));U[ie]=ye.slice(),se=B[ie]=ye.sort((ve,_e)=>_e.tileID.overscaledZ-ve.tileID.overscaledZ||(ve.tileID.isLessThan(_e.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(H,se,d.center.lng,d.projection);k=k||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||b===0,this._layerOrderChanged&&this.fire(new a.g("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.e.now(),d.zoom))&&(this.pauseablePlacement=new Wb(d,this._mergedOrder,A,y,b,T,this.placement,this.fog&&d.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,U),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.e.now()),L=!0),k&&this.pauseablePlacement.placement.setStale()),L||k){this._buildingIndex.onNewFrame(d.zoom);for(let q=0;q<this._mergedOrder.length;q++){const H=this._mergedLayers[this._mergedOrder[q]];if(H.type!=="symbol")continue;const ie=this.isLayerClipped(H)&&this._clipLayerIndices.some(se=>q<se);this.placement.updateLayerOpacities(H,B[a.am(H.source,H.scope)],q,ie?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.e.now())}}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,d){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:T})=>T===l.id)!==-1)return void this.fire(new a.f(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!d)return y.push(l),this._loadImports([l],!0);const b=y.findIndex(({id:T})=>T===d);return b===-1&&this.fire(new a.f(new Error(`Import with id "${d}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,b).concat(l).concat(y.slice(b)),this._loadImports([l],!0,d)}updateImport(l,d){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);return b===-1?this:typeof d=="string"?(this.setImportUrl(l,d),this):(d.url&&d.url!==y[b].url&&this.setImportUrl(l,d.url),a.d(d.config,y[b].config)||this.setImportConfig(l,d.config),a.d(d.data,y[b].data)||this.setImportData(l,d.data),this)}moveImport(l,d){this._checkLoaded();let y=this.stylesheet.imports||[];const b=this.getImportIndex(l);if(b===-1)return this;const T=this.getImportIndex(d);if(T===-1)return this;const S=y[b],A=this.fragments[b];return y=y.filter(({id:k})=>k!==l),this.fragments=this.fragments.filter(({id:k})=>k!==l),this.stylesheet.imports=y.slice(0,T).concat(S).concat(y.slice(T)),this.fragments=this.fragments.slice(0,T).concat(A).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(l,d){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);if(b===-1)return this;y[b].url=d;const T=this.fragments[b];return T.style=this._createFragmentStyle(y[b]),T.style.on("style.import.load",()=>this.mergeAll()),T.style.loadURL(d),this}setImportData(l,d){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];return y===-1?this:d?(this.fragments[y].style.setState(d),this._reloadImports(),this):(delete b[y].data,this.setImportUrl(l,b[y].url))}setImportConfig(l,d){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];if(y===-1)return this;d?b[y].config=d:delete b[y].config;const T=this.fragments[y],S=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=d,T.style.updateConfig(d,S),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(l);y!==-1&&(d.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(l){const d=(this.stylesheet.imports||[]).findIndex(y=>y.id===l);return d===-1&&this.fire(new a.f(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),d}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const d in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[d];y&&l.push(y.getSource())}return l}getSource(l,d){const y=this.getSourceCache(l,d);return y&&y.getSource()}getLayerSource(l){const d=this.getLayerSourceCache(l);return d&&d.getSource()}getSourceCache(l,d){const y=a.am(l,d);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(l){const d=a.am(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(l){if(l==null)return Object.values(this._mergedSourceCaches);const d=[];return this._mergedOtherSourceCaches[l]&&d.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&d.push(this._mergedSymbolSourceCaches[l]),d}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const d in l){const y=l[d];y==="reload"?this.reloadSource(d):y==="clear"&&this.clearSource(d)}}updateLayers(l){const d=this._changes.getUpdatedPaintProperties();for(const y of d){const b=this.getLayer(y);b&&b.updateTransitions(l)}}getImages(l,d,y){this.imageManager.getImages(d.icons,d.scope,y),this._updateTilesForChangedImages();const b=T=>{T&&T.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(l,d,y){this.glyphManager.getGlyphs(d.stacks,d.scope,y)}getResource(l,d,y){return a.d2(d,y)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const d=[];return this._otherSourceCaches[l]&&d.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&d.push(this._symbolSourceCaches[l]),d}_isSourceCacheLoaded(l){const d=this.getOwnSourceCaches(l);return d.length===0?(this.fire(new a.f(new Error(`There is no source with ID '${l}'`))),!1):d.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,d){if(this._clipLayerIndices.length===0&&l.type!=="fill-extrusion")return!1;const y=l.type==="fill-extrusion"&&l.sourceLayer==="building";let b=0;if(l.is3D()){if(y||d&&d.type==="batched-model")return!0;l.type==="model"&&(b=a.cw.Model)}else l.type==="symbol"&&(b=a.cw.Symbol);for(const T of this._clipLayerIndices){const S=this._mergedLayers[this._mergedOrder[T]];if(!S)continue;const A=[];for(const k of S.layout.get("clip-layer-types"))A.push(k==="model"?a.cw.Model:k==="symbol"?a.cw.Symbol:a.cw.FillExtrusion);for(const k of A)if(b&k)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Kb(g,l){let d=!1,y=null;const b=()=>{y=null,d&&(g(),y=setTimeout(b,l),d=!1)};return()=>(d=!0,y||b(),y)}ca.getSourceType=function(g){return K[g]},ca.setSourceType=function(g,l){K[g]=l},ca.registerForPluginStateChange=a.cO;class Qb{constructor(l){this._hashName=l&&encodeURIComponent(l),a.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kb(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const d=M0(l);if(this._hashName){const y=this._hashName;let b=!1;const T=location.hash.slice(1).split("&").map(S=>{const A=S.split("=")[0];return A===y?(b=!0,`${A}=${d}`):S}).filter(S=>S);return b||T.push(`${y}=${d}`),`#${T.join("&")}`}return`#${d}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(d=y)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(d[3]||0):l.getBearing();return l.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function M0(g,l){const d=g.getCenter(),y=Math.round(100*g.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),S=Math.round(d.lng*T)/T,A=Math.round(d.lat*T)/T,k=g.getBearing(),L=g.getPitch();let B=l?`/${S}/${A}/${y}`:`${y}/${A}/${S}`;return(k||L)&&(B+="/"+Math.round(10*k)/10),L&&(B+=`/${Math.round(L)}`),B}const Id={linearity:.3,easing:a.d3(0,0,.3,1)},IA=a.Q({deceleration:2500,maxSpeed:1400},Id),CA=a.Q({deceleration:20,maxSpeed:1400},Id),AA=a.Q({deceleration:1e3,maxSpeed:360},Id),PA=a.Q({deceleration:1e3,maxSpeed:90},Id);class Yb{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.e.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=a.e.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const T=ch(d.pan.mag(),y,a.Q({},IA,l||{}));b.offset=d.pan.mult(T.amount/d.pan.mag()),b.center=this._map.transform.center,Mg(b,T)}if(d.zoom){const T=ch(d.zoom,y,CA);b.zoom=this._map.transform.zoom+T.amount,Mg(b,T)}if(d.bearing){const T=ch(d.bearing,y,AA);b.bearing=this._map.transform.bearing+a.au(T.amount,-179,179),Mg(b,T)}if(d.pitch){const T=ch(d.pitch,y,PA);b.pitch=this._map.transform.pitch+T.amount,Mg(b,T)}if(b.zoom||b.bearing){const T=d.pinchAround===void 0?d.around:d.pinchAround;b.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Mg(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function ch(g,l,d){const{maxSpeed:y,linearity:b,deceleration:T}=d,S=a.au(g*b/(l/1e3),-y,y),A=Math.abs(S)/(T*b);return{easing:d.easing,duration:1e3*A,amount:S*(A/2)}}class ua extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y,b={}){const T=Te(d.getCanvasContainer(),y),S=d.unproject(T);super(l,a.Q({point:T,lngLat:S,originalEvent:y},b)),this._defaultPrevented=!1,this.target=d}}class wp extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y){const b=l==="touchend"?y.changedTouches:y.touches,T=we(d.getCanvasContainer(),b),S=T.map(k=>d.unproject(k)),A=T.reduce((k,L,B,U)=>k.add(L.div(U.length)),new a.P(0,0));super(l,{points:T,point:A,lngLats:S,lngLat:d.unproject(A),originalEvent:y}),this._defaultPrevented=!1}}class k0 extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d){super("wheel",{originalEvent:d}),this._defaultPrevented=!1}}class kg{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new k0(this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new ua(l.type,this._map,l))}mouseup(l){this._map.fire(new ua(l.type,this._map,l))}preclick(l){const d=a.Q({},l);d.type="preclick",this._map.fire(new ua(d.type,this._map,d))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(l),this._map.fire(new ua(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new ua(l.type,this._map,l))}mouseover(l){this._map.fire(new ua(l.type,this._map,l))}mouseout(l){this._map.fire(new ua(l.type,this._map,l))}touchstart(l){return this._firePreventable(new wp(l.type,this._map,l))}touchmove(l){this._map.fire(new wp(l.type,this._map,l))}touchend(l){this._map.fire(new wp(l.type,this._map,l))}touchcancel(l){this._map.fire(new wp(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class D0{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new ua(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ua("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ua(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uh{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(G(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const y=d,b=this._startPos,T=this._lastPos;if(!b||!T||T.equals(y)||!this._box&&y.dist(b)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=F("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const S=Math.min(b.x,y.x),A=Math.max(b.x,y.x),k=Math.min(b.y,y.y),L=Math.max(b.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${k}px)`,this._box.style.width=A-S+"px",this._box.style.height=L-k+"px")})}mouseupWindow(l,d){if(!this._active)return;const y=this._startPos,b=d;if(y&&l.button===0){if(this.reset(),de(),y.x!==b.x||y.y!==b.y)return this._map.fire(new a.g("boxzoomend",{originalEvent:l})),{cameraAnimation:T=>T.fitScreenCoordinates(y,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Y(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new a.g(l,{originalEvent:d}))}}function Tp(g,l){const d={};for(let y=0;y<g.length;y++)d[g[y].identifier]=l[y];return d}class Jb{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const T=new a.P(0,0);for(const S of b)T._add(S);return T.div(b.length)}(d),this.touches=Tp(y,d)))}touchmove(l,d,y){if(this.aborted||!this.centroid)return;const b=Tp(y,d);for(const T in this.touches){const S=b[T];(!S||S.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(l,d,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class lu{constructor(l){this.singleTap=new Jb(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,d,y){this.singleTap.touchstart(l,d,y)}touchmove(l,d,y){this.singleTap.touchmove(l,d,y)}touchend(l,d,y){const b=this.singleTap.touchend(l,d,y);if(b){const T=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(b)<30;if(T&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Ep{constructor(){this._zoomIn=new lu({numTouches:1,numTaps:2}),this._zoomOut=new lu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,y){this._zoomIn.touchstart(l,d,y),this._zoomOut.touchstart(l,d,y)}touchmove(l,d,y){this._zoomIn.touchmove(l,d,y),this._zoomOut.touchmove(l,d,y)}touchend(l,d,y){const b=this._zoomIn.touchend(l,d,y),T=this._zoomOut.touchend(l,d,y);return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(b)},{originalEvent:l})}):T?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(T)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Dg={0:1,2:2};class Sp{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;const y=oe(l);this._correctButton(l,y)&&(this._lastPoint=d,this._eventButton=y)}mousemoveWindow(l,d){const y=this._lastPoint;if(y){if(l.preventDefault(),this._eventButton!=null&&function(b,T){const S=Dg[T];return b.buttons===void 0||(b.buttons&S)!==S}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(y,d)}}mouseupWindow(l){this._lastPoint&&oe(l)===this._eventButton&&(this._moved&&de(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ip extends Sp{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return d===0&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class Cp extends Sp{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const y=.8*(d.x-l.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(l){l.preventDefault()}}class Og extends Sp{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const y=-.5*(d.y-l.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(l){l.preventDefault()}}class ew{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),a.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(l,d,y){return this._calculateTransform(l,d,y)}touchmove(l,d,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!a.d4())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,d,y)}}touchend(l,d,y){this._calculateTransform(l,d,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,y){y.length>0&&(this._active=!0);const b=Tp(y,d),T=new a.P(0,0),S=new a.P(0,0);let A=0;for(const L in b){const B=b[L],U=this._touches[L];U&&(T._add(B),S._add(B.sub(U)),A++,b[L]=B)}if(this._touches=b,A<this._minTouches||!S.mag())return;const k=S.div(A);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(A),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Ap{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,d,y){return{}}touchstart(l,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,y){const b=this._firstTwoTouches;if(!b)return;l.preventDefault();const[T,S]=b,A=hh(y,d,T),k=hh(y,d,S);if(!A||!k)return;const L=this._aroundCenter?null:A.add(k).div(2);return this._move([A,k],L,l)}touchend(l,d,y){if(!this._firstTwoTouches)return;const[b,T]=this._firstTwoTouches,S=hh(y,d,b),A=hh(y,d,T);S&&A||(this._active&&de(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function hh(g,l,d){for(let y=0;y<g.length;y++)if(g[y].identifier===d)return l[y]}function Cd(g,l){return Math.log(g/l)/Math.LN2}class tw extends Ap{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Cd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cd(this._distance,y),pinchAround:d}}}function O0(g,l){return 180*g.angleWith(l)/Math.PI}class nw extends Ap{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){const y=this._vector;if(this._vector=l[0].sub(l[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:O0(this._vector,y),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const b=O0(l,y);return Math.abs(b)<d}}function cu(g){return Math.abs(g.y)>Math.abs(g.x)}class rw extends Ap{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,cu(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,y){const b=this._lastPoints;if(!b)return;const T=l[0].sub(b[0]),S=l[1].sub(b[1]);return this._map._cooperativeGestures&&!a.d4()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(T,S,y.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(T.y+S.y)/2*-.5})}gestureBeginsVertically(l,d,y){if(this._valid!==void 0)return this._valid;const b=l.mag()>=2,T=d.mag()>=2;if(!b&&!T)return;if(!b||!T)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const S=l.y>0==d.y>0;return cu(l)&&cu(d)&&S}}const RA={panStep:100,bearingStep:15,pitchStep:10};class MA{constructor(){const l=RA;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,y=0,b=0,T=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),T=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),T=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:A=>{const k=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:kA,zoom:d?Math.round(k)+d*(l.shiftKey?2:1):k,bearing:A.getBearing()+y*this._bearingStep,pitch:A.getPitch()+b*this._pitchStep,offset:[-T*this._panStep,-S*this._panStep],center:A.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kA(g){return g*(2-g)}const Lg=4.000244140625,L0=1/450;class z0{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=L0,a.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||a.d4()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=a.e.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%Lg==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=window.setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Te(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Lg?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&B!==0&&(B=1/B);const U=d(),q=Math.pow(2,U),H=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(H*B))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:d(),b=this._startZoom,T=this._easing;let S,A=!1;if(this._type==="wheel"&&b&&T){const L=Math.min((a.e.now()-this._lastWheelEventTime)/200,1),B=T(L);S=a.a3(b,y,B),L<1?this._frameId||(this._frameId=!0):A=!0}else S=y,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=S-d();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=a.d5;if(this._prevEase){const y=this._prevEase,b=(a.e.now()-y.start)/y.duration,T=y.easing(b+.01)-y.easing(b),S=.27/Math.sqrt(T*T+1e-4)*.01,A=Math.sqrt(.0729-S*S);d=a.d3(S,A,.25,1)}return this._prevEase={start:a.e.now(),duration:l,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class N0{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class iw{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,d){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(l.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sw{constructor(){this._tap=new lu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,d,y){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=d[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(l,d,y))}touchmove(l,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=d[0],T=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(l,d,y)}touchend(l,d,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(l,d,y)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class DA{constructor(l,d,y){this._el=l,this._mousePan=d,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pp{constructor(l,d,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rp{constructor(l,d,y,b){this._el=l,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Mp=g=>g.zoom||g.drag||g.pitch||g.rotate;class ha extends a.g{}class F0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,d){const y=a.$.sub([],d,l);this.radius=a.$.length(y[2]<0?a.$.div([],y,this.constants):[y[0],y[1],0])}projectRay(l){a.$.div(l,l,this.constants),a.$.normalize(l,l),a.$.mul(l,l,this.constants);const d=a.$.scale([],l,this.radius);if(d[2]>0){const y=a.$.scale([],[0,0,1],a.$.dot(d,[0,0,1])),b=a.$.scale([],a.$.normalize([],[d[0],d[1],0]),this.radius),T=a.$.add([],d,a.$.scale([],a.$.sub([],a.$.add([],b,y),d),2));d[0]=T[0],d[1]=T[1]}return d}}function dh(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class zg{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yb(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new F0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),a.br(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,T,S]of this._listeners){const A=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(T,A,S)}}destroy(){for(const[l,d,y]of this._listeners){const b=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(d,b,y)}}_addDefaultHandlers(l){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new kg(d,l));const b=d.boxZoom=new uh(d,l);this._add("boxZoom",b);const T=new Ep,S=new iw;d.doubleClickZoom=new N0(S,T),this._add("tapZoom",T),this._add("clickZoom",S);const A=new sw;this._add("tapDragZoom",A);const k=d.touchPitch=new rw(d);this._add("touchPitch",k);const L=new Cp(l),B=new Og(l);d.dragRotate=new Pp(l,L,B),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const U=new Ip(l),q=new ew(d,l);d.dragPan=new DA(y,U,q),this._add("mousePan",U),this._add("touchPan",q,["touchZoom","touchRotate"]);const H=new nw,ie=new tw;d.touchZoomRotate=new Rp(y,ie,H,A),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new D0(d));const se=d.scrollZoom=new z0(d,this);this._add("scrollZoom",se,["mousePan"]);const ae=d.keyboard=new MA;this._add("keyboard",ae);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ce]&&d[ce].enable(l[ce])}_add(l,d,y){this._handlers.push({handlerName:l,handler:d,allowed:y}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Mp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,d,y){for(const b in l)if(b!==y&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const d=[];for(const y of l)this._el.contains(y.target)&&d.push(y);return d}handleEvent(l,d){this._updatingCamera=!0;const y=l.type==="renderFrame",b=y?void 0:l,T={needsRenderFrame:!1},S={},A={},k=l.touches?this._getMapTouches(l.touches):void 0,L=k?we(this._el,k):y?void 0:Te(this._el,l);for(const{handlerName:q,handler:H,allowed:ie}of this._handlers){if(!H.isEnabled())continue;let se;this._blockedByActive(A,ie,q)?H.reset():H[d||l.type]&&(se=H[d||l.type](l,L,k),this.mergeHandlerResult(T,S,se,q,b),se&&se.needsRenderFrame&&this._triggerRenderFrame()),(se||H.isActive())&&(A[q]=H)}const B={};for(const q in this._previousActiveHandlers)A[q]||(B[q]=b);this._previousActiveHandlers=A,(Object.keys(B).length||dh(T))&&(this._changes.push([T,S,B]),this._triggerRenderFrame()),(Object.keys(A).length||dh(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=T;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(l,d,y,b,T){if(!y)return;a.Q(l,y);const S={handlerName:b,originalEvent:y.originalEvent||T};y.zoomDelta!==void 0&&(d.zoom=S),y.panDelta!==void 0&&(d.drag=S),y.pitchDelta!==void 0&&(d.pitch=S),y.bearingDelta!==void 0&&(d.rotate=S)}_applyChanges(){const l={},d={},y={};for(const[b,T,S]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(l.around=b.around),b.aroundCoord!==void 0&&(l.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),a.Q(d,T),a.Q(y,S);this._updateMapTransform(l,d,y),this._changes=[]}_updateMapTransform(l,d,y){const b=this._map,T=b.transform,S=ye=>[ye.x,ye.y,ye.z];if((ye=>{const ve=this._eventsInProgress.drag;return ve&&!this._handlersById[ve.handlerName].isActive()})()&&!dh(l)){const ye=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),ye!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&b._stop(!0),!dh(l))return void this._fireEvents(d,y,!0);let{panDelta:A,zoomDelta:k,bearingDelta:L,pitchDelta:B,around:U,aroundCoord:q,pinchAround:H}=l;T._isCameraConstrained&&(k>0&&(k=0),T._isCameraConstrained=!1),H!==void 0&&(U=H),(k||(ye=>d[ye]&&!this._eventsInProgress[ye])("drag"))&&U&&(this._dragOrigin=S(T.pointCoordinate3D(U)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",b._stop(!0),U=U||b.transform.centerPoint,L&&(T.bearing+=L),B&&(T.pitch+=B),T._updateCameraState();const ie=[0,0,0];if(A)if(T.projection.name==="mercator"){const ye=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(U).dir),ve=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(U.sub(A)).dir);ie[0]=ve[0]-ye[0],ie[1]=ve[1]-ye[1]}else{const ye=T.pointCoordinate(U);if(T.projection.name==="globe"){A=A.rotate(-T.angle);const ve=T._pixelsPerMercatorPixel/T.worldSize;ie[0]=-A.x*a.d6(a.az(ye.y))*ve,ie[1]=-A.y*a.d6(T.center.lat)*ve}else{const ve=T.pointCoordinate(U.sub(A));ye&&ve&&(ie[0]=ve.x-ye.x,ie[1]=ve.y-ye.y)}}const se=T.zoom,ae=[0,0,0];if(k){const ye=S(q||T.pointCoordinate3D(U)),ve={dir:a.$.normalize([],a.$.sub([],ye,T._camera.position))};if(ve.dir[2]<0){const _e=T.zoomDeltaToMovement(ye,k);a.$.scale(ae,ve.dir,_e)}}const ce=a.$.add(ie,ie,ae);T._translateCameraConstrained(ce),k&&Math.abs(T.zoom-se)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,y,!0)}_fireEvents(l,d,y){const b=Mp(this._eventsInProgress),T=Mp(l),S={};for(const B in l){const{originalEvent:U}=l[B];this._eventsInProgress[B]||(S[`${B}start`]=U),this._eventsInProgress[B]=l[B]}!b&&T&&this._fireEvent("movestart",T.originalEvent);for(const B in S)this._fireEvent(B,S[B]);T&&this._fireEvent("move",T.originalEvent);for(const B in l){const{originalEvent:U}=l[B];this._fireEvent(B,U)}const A={};let k;for(const B in this._eventsInProgress){const{handlerName:U,originalEvent:q}=this._eventsInProgress[B];this._handlersById[U].isActive()||(delete this._eventsInProgress[B],k=d[U]||q,A[`${B}end`]=k)}for(const B in A)this._fireEvent(B,A[B]);const L=Mp(this._eventsInProgress);if(y&&(b||T)&&!L){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;B?(U(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:k})):(this._map.fire(new a.g("moveend",{originalEvent:k})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new a.g(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new ha("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ng="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class B0 extends a.E{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,a.br(["_renderFrameCallback"],this)}getCenter(){return new a.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,y){return l=a.P.convert(l).mult(-1),this.panTo(this.transform.center,a.Q({offset:l},d),y)}panTo(l,d,y){return this.easeTo(a.Q({center:l},d),y)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,y){return this.easeTo(a.Q({zoom:l},d),y)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,y){return this.easeTo(a.Q({bearing:l},d),y)}resetNorth(l,d){return this.rotateTo(0,a.Q({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(a.Q({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=a.aj.convert(l);const y=d&&d.bearing||0,b=d&&d.pitch||0,T=l.getNorthWest(),S=l.getSouthEast();return this._cameraForBounds(this.transform,T,S,y,b,d)}_extendPadding(l){const d={top:0,right:0,bottom:0,left:0};return l==null?a.Q({},d,this.transform.padding):typeof l=="number"?{top:l,bottom:l,right:l,left:l}:a.Q({},d,l)}_extendCameraOptions(l){return(l=a.Q({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,d){const y=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return y/b>l.aspect?y/(2*Math.tan(.5*l.fovX)*l.aspect):b/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,d,y,b,T,S){const A=l.clone(),k=this._extendCameraOptions(S);A.bearing=b,A.pitch=T;const L=a.aJ.convert(d),B=a.aJ.convert(y),U=.5*(L.lat+B.lat),q=.5*(L.lng+B.lng),H=a.d7(U,q),ie=a.$.normalize([],H),se=a.$.normalize([],a.$.cross([],ie,[0,1,0])),ae=a.$.cross([],se,ie),ce=[se[0],se[1],se[2],0,ae[0],ae[1],ae[2],0,ie[0],ie[1],ie[2],0,0,0,0,1],ye=[H,a.d7(L.lat,L.lng),a.d7(B.lat,L.lng),a.d7(B.lat,B.lng),a.d7(L.lat,B.lng),a.d7(U,L.lng),a.d7(U,B.lng),a.d7(L.lat,q),a.d7(B.lat,q)];let ve=a.b8.fromPoints(ye.map(Be=>[a.$.dot(se,Be),a.$.dot(ae,Be),a.$.dot(ie,Be)]));const _e=a.$.transformMat4([],ve.center,ce);a.$.squaredLength(_e)===0&&a.$.set(_e,0,0,1),a.$.normalize(_e,_e),a.$.scale(_e,_e,a.cF),A.center=a.d8(_e);const Re=A.getWorldToCameraMatrix(),Se=a.ae.invert(new Float64Array(16),Re);ve=a.b8.applyTransform(ve,a.ae.multiply([],Re,ce));const Ie=this._extendAABB(ve,A,k,b);if(!Ie)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=Ie,a.$.transformMat4(_e,_e,Re);const ze=.5*(ve.max[2]-ve.min[2]),Ne=this._minimumAABBFrustumDistance(A,ve),We=a.$.scale([],[0,0,1],ze),Fe=a.$.add(We,_e,We),Pe=Ne+(A.pitch===0?0:a.$.distance(_e,Fe)),et=A.globeCenterInViewSpace,Qe=a.$.sub([],_e,[et[0],et[1],et[2]]);a.$.normalize(Qe,Qe),a.$.scale(Qe,Qe,Pe);const Ve=a.$.add([],_e,Qe);a.$.transformMat4(Ve,Ve,Se);const xt=a.da/a.cF,pt=a.$.length(Ve),He=a.ay(Math.max(pt*xt-a.da,Number.EPSILON),0),it=Math.min(A.zoomFromMercatorZAdjusted(He),k.maxZoom);return it>.5*(a.b3+a.aV)?(A.setProjection({name:"mercator"}),A.zoom=it,this._cameraForBounds(A,d,y,b,T,S)):{center:A.center,zoom:it,bearing:b,pitch:T}}_extendAABB(l,d,y,b){const T=.5*((y.padding.left||0)+(y.padding.right||0)),S=.5*((y.padding.top||0)+(y.padding.bottom||0)),A=S,k=T,L=T,B=S,U=d.width-(k+L),q=d.height-(A+B),H=a.$.sub([],l.max,l.min),ie=Math.min(U/H[0],q/H[1]),se=Math.min(d.scaleZoom(d.scale*ie),y.maxZoom);if(isNaN(se))return null;const ae=d.scale/d.zoomScale(se),ce=new a.b8([l.min[0]-k*ae,l.min[1]-B*ae,l.min[2]],[l.max[0]+L*ae,l.max[1]+A*ae,l.max[2]]),ye=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new a.P(y.offset.x,y.offset.y):a.P.convert(y.offset)).rotate(-a.ac(b));return ce.center[0]-=ye.x*ae,ce.center[1]+=ye.y*ae,ce}queryTerrainElevation(l,d){const y=this.transform.elevation;return y?(d=a.Q({},{exaggerated:!0},d),y.getAtPoint(a._.fromLngLat(l),null,d.exaggerated)):null}_cameraForBounds(l,d,y,b,T,S){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,d,y,b,T,S);const A=l.clone(),k=this._extendCameraOptions(S);A.bearing=b,A.pitch=T;const L=a.aJ.convert(d),B=a.aJ.convert(y),U=new a.aJ(L.lng,B.lat),q=new a.aJ(B.lng,L.lat),H=A.project(L),ie=A.project(B),se=this.queryTerrainElevation(L),ae=this.queryTerrainElevation(B),ce=this.queryTerrainElevation(U),ye=this.queryTerrainElevation(q),ve=[[H.x,H.y,Math.min(se||0,ae||0,ce||0,ye||0)],[ie.x,ie.y,Math.max(se||0,ae||0,ce||0,ye||0)]];let _e=a.b8.fromPoints(ve);const Re=A.getWorldToCameraMatrix(),Se=a.ae.invert(new Float64Array(16),Re);_e=a.b8.applyTransform(_e,Re);const Ie=this._extendAABB(_e,A,k,b);if(!Ie)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_e=Ie;const ze=.5*a.$.sub([],_e.max,_e.min)[2],Ne=this._minimumAABBFrustumDistance(A,_e),We=[0,0,1,0];a.aB.transformMat4(We,We,Re),a.aB.normalize(We,We);const Fe=a.$.scale([],We,Ne+ze),Pe=a.$.add([],_e.center,Fe);a.$.transformMat4(_e.center,_e.center,Se),a.$.transformMat4(Pe,Pe,Se);const et=[_e.center[0],_e.center[1],Pe[2]*A.pixelsPerMeter];a.$.scale(et,et,1/A.worldSize);const Qe=a.d9(et[0]),Ve=a.az(et[1]),xt=Math.min(A._zoomFromMercatorZ(et[2]),k.maxZoom),pt=new a.aJ(Qe,Ve);return A.mercatorFromTransition&&xt<.5*(a.b3+a.aV)?(A.setProjection({name:"globe"}),A.zoom=xt,this._cameraForBounds(A,d,y,b,T,S)):{center:pt,zoom:xt,bearing:b,pitch:T}}fitBounds(l,d,y){const b=this.cameraForBounds(l,d);return this._fitInternal(b,d,y)}fitScreenCoordinates(l,d,y,b,T){const S=a.P.convert(l),A=a.P.convert(d),k=new a.P(Math.min(S.x,A.x),Math.min(S.y,A.y)),L=new a.P(Math.max(S.x,A.x),Math.max(S.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,A))return this;const B=this.transform.pointLocation3D(k),U=this.transform.pointLocation3D(L),q=this.transform.pointLocation3D(new a.P(k.x,L.y)),H=this.transform.pointLocation3D(new a.P(L.x,k.y)),ie=[Math.min(B.lng,U.lng,q.lng,H.lng),Math.min(B.lat,U.lat,q.lat,H.lat)],se=[Math.max(B.lng,U.lng,q.lng,H.lng),Math.max(B.lat,U.lat,q.lat,H.lat)],ae=b&&b.pitch?b.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,ie,se,y,ae,b);return this._fitInternal(ce,b,T)}_fitInternal(l,d,y){return l?(d=a.Q(l,d)).linear?this.easeTo(d,y):this.flyTo(d,y):this}jumpTo(l,d){this.stop();const y=l.preloadOnly?this.transform.clone():this.transform;let b=!1,T=!1,S=!1;if("zoom"in l&&y.zoom!==+l.zoom&&(b=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=a.aJ.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(T=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(S=!0,y.pitch=+l.pitch),l.padding!=null){const A=typeof l.padding=="number"?this._extendPadding(l.padding):l.padding;y.isPaddingEqual(A)||(y.padding=A)}return l.preloadOnly?(this._preloadTiles(y),this):(this.fire(new a.g("movestart",d)).fire(new a.g("move",d)),b&&this.fire(new a.g("zoomstart",d)).fire(new a.g("zoom",d)).fire(new a.g("zoomend",d)),T&&this.fire(new a.g("rotatestart",d)).fire(new a.g("rotate",d)).fire(new a.g("rotateend",d)),S&&this.fire(new a.g("pitchstart",d)).fire(new a.g("pitch",d)).fire(new a.g("pitchend",d)),this.fire(new a.g("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(Ng),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,d){const y=this.transform;if(!y.projection.supportsFreeCamera)return a.w(Ng),this;this.stop();const b=y.zoom,T=y.pitch,S=y.bearing;y.setFreeCameraOptions(l);const A=b!==y.zoom,k=T!==y.pitch,L=S!==y.bearing;return this.fire(new a.g("movestart",d)).fire(new a.g("move",d)),A&&this.fire(new a.g("zoomstart",d)).fire(new a.g("zoom",d)).fire(new a.g("zoomend",d)),L&&this.fire(new a.g("rotatestart",d)).fire(new a.g("rotate",d)).fire(new a.g("rotateend",d)),k&&this.fire(new a.g("pitchstart",d)).fire(new a.g("pitch",d)).fire(new a.g("pitchend",d)),this.fire(new a.g("moveend",d)),this}easeTo(l,d){this._stop(!1,l.easeId),((l=a.Q({offset:[0,0],duration:500,easing:a.d5},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),A=this.getPadding(),k="zoom"in l?+l.zoom:b,L="bearing"in l?this._normalizeBearing(l.bearing,T):T,B="pitch"in l?+l.pitch:S,U=this._extendPadding(l.padding),q=a.P.convert(l.offset);let H,ie,se;if(y.projection.name==="globe"){const Ne=a._.fromLngLat(y.center),We=q.rotate(-y.angle);Ne.x+=We.x/y.worldSize,Ne.y+=We.y/y.worldSize;const Fe=Ne.toLngLat(),Pe=a.aJ.convert(l.center||Fe);this._normalizeCenter(Pe),H=y.centerPoint.add(We),ie=new a.P(Ne.x,Ne.y).mult(y.worldSize),se=new a.P(a.ak(Pe.lng),a.al(Pe.lat)).mult(y.worldSize).sub(ie)}else{H=y.centerPoint.add(q);const Ne=y.pointLocation(H),We=a.aJ.convert(l.center||Ne);this._normalizeCenter(We),ie=y.project(Ne),se=y.project(We).sub(ie)}const ae=y.zoomScale(k-b);let ce,ye;l.around&&(ce=a.aJ.convert(l.around),ye=y.locationPoint(ce));const ve=this._zooming||k!==b,_e=this._rotating||T!==L,Re=this._pitching||B!==S,Se=!y.isPaddingEqual(U),Ie=Ne=>We=>{if(ve&&(Ne.zoom=a.a3(b,k,We)),_e&&(Ne.bearing=a.a3(T,L,We)),Re&&(Ne.pitch=a.a3(S,B,We)),Se&&(Ne.interpolatePadding(A,U,We),H=Ne.centerPoint.add(q)),ce)Ne.setLocationAtPoint(ce,ye);else{const Fe=Ne.zoomScale(Ne.zoom-b),Pe=k>b?Math.min(2,ae):Math.max(.5,ae),et=Math.pow(Pe,1-We),Qe=Ne.unproject(ie.add(se.mult(We*et)).mult(Fe));Ne.setLocationAtPoint(Ne.renderWorldCopies?Qe.wrap():Qe,H)}return l.preloadOnly||this._fireMoveEvents(d),Ne};if(l.preloadOnly){const Ne=this._emulate(Ie,l.duration,y);return this._preloadTiles(Ne),this}const ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ve,this._rotating=_e,this._pitching=Re,this._padding=Se,this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,ze),this._ease(Ie(y),Ne=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(d,Ne)},l),this}_prepareEase(l,d,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||y.moving||this.fire(new a.g("movestart",l)),this._zooming&&!y.zooming&&this.fire(new a.g("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new a.g("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new a.g("pitchstart",l))}_fireMoveEvents(l){this.fire(new a.g("move",l)),this._zooming&&this.fire(new a.g("zoom",l)),this._rotating&&this.fire(new a.g("rotate",l)),this._pitching&&this.fire(new a.g("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new a.g("zoomend",l)),b&&this.fire(new a.g("rotateend",l)),T&&this.fire(new a.g("pitchend",l)),this.fire(new a.g("moveend",l))}flyTo(l,d){if(this._prefersReducedMotion(l)){const it=a.ai(l,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(it,d)}this.stop(),l=a.Q({offset:[0,0],speed:1.2,curve:1.42,easing:a.d5},l);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),A=this.getPadding(),k="zoom"in l?a.au(+l.zoom,y.minZoom,y.maxZoom):b,L="bearing"in l?this._normalizeBearing(l.bearing,T):T,B="pitch"in l?+l.pitch:S,U=this._extendPadding(l.padding),q=y.zoomScale(k-b),H=a.P.convert(l.offset);let ie=y.centerPoint.add(H);const se=y.pointLocation(ie),ae=a.aJ.convert(l.center||se);this._normalizeCenter(ae);const ce=y.project(se),ye=y.project(ae).sub(ce);let ve=l.curve;const _e=Math.max(y.width,y.height),Re=_e/q,Se=ye.mag();if("minZoom"in l){const it=a.au(Math.min(l.minZoom,b,k),y.minZoom,y.maxZoom),Be=_e/y.zoomScale(it-b);ve=Math.sqrt(Be/Se*2)}const Ie=ve*ve;function ze(it){const Be=(Re*Re-_e*_e+(it?-1:1)*Ie*Ie*Se*Se)/(2*(it?Re:_e)*Ie*Se);return Math.log(Math.sqrt(Be*Be+1)-Be)}function Ne(it){return(Math.exp(it)-Math.exp(-it))/2}function We(it){return(Math.exp(it)+Math.exp(-it))/2}const Fe=ze(0);let Pe=function(it){return We(Fe)/We(Fe+ve*it)},et=function(it){return _e*((We(Fe)*(Ne(Be=Fe+ve*it)/We(Be))-Ne(Fe))/Ie)/Se;var Be},Qe=(ze(1)-Fe)/ve;if(Math.abs(Se)<1e-6||!isFinite(Qe)){if(Math.abs(_e-Re)<1e-6)return this.easeTo(l,d);const it=Re<_e?-1:1;Qe=Math.abs(Math.log(Re/_e))/ve,et=function(){return 0},Pe=function(Be){return Math.exp(it*ve*Be)}}l.duration="duration"in l?+l.duration:1e3*Qe/("screenSpeed"in l?+l.screenSpeed/ve:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Ve=T!==L,xt=B!==S,pt=!y.isPaddingEqual(U),He=it=>Be=>{const mt=Be*Qe,_t=1/Pe(mt);it.zoom=Be===1?k:b+it.scaleZoom(_t),Ve&&(it.bearing=a.a3(T,L,Be)),xt&&(it.pitch=a.a3(S,B,Be)),pt&&(it.interpolatePadding(A,U,Be),ie=it.centerPoint.add(H));const Bt=Be===1?ae:it.unproject(ce.add(ye.mult(et(mt))).mult(_t));return it.setLocationAtPoint(it.renderWorldCopies?Bt.wrap():Bt,ie),it._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(d),it};if(l.preloadOnly){const it=this._emulate(He,l.duration,y);return this._preloadTiles(it),this}return this._zooming=!0,this._rotating=Ve,this._pitching=xt,this._padding=pt,this._prepareEase(d,!1),this._ease(He(y),()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,d)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,d,y){y.animate===!1||y.duration===0?(l(1),d()):(this._easeStart=a.e.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((a.e.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=a.av(l,-180,180);const y=Math.abs(l-d);return Math.abs(l-360-d)<y&&(l-=360),Math.abs(l+360-d)<y&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const y=l.lng-d.center.lng;l.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&a.e.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,d,y){const b=Math.ceil(15*d/1e3),T=[],S=l(y.clone());for(let A=0;A<=b;A++){const k=S(A/b);T.push(k.clone())}return T}_preloadTiles(l,d){}}class kp{constructor(l={}){this.options=l,a.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const d=this.options&&this.options.compact,y=l._getUIString("AttributionControl.ToggleAttribution");this._map=l,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const b=F("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",y),this._innerContainer=F("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.db.ACCESS_TOKEN}];if(l){const y=d.reduce((b,T,S)=>(T.value&&(b+=`${T.key}=${T.value}${S<d.length-1?"&":""}`),b),"?");l.href=`${a.db.FEEDBACK_URL}/${y}#${M0(this._map,!0)}`,l.rel="noopener nofollow"}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._mergedSourceCaches;for(const b in d){const T=d[b];if(T.used){const S=T.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l.sort((b,T)=>b.length-T.length),l=l.filter((b,T)=>{for(let S=T+1;S<l.length;S++)if(l[S].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fg{constructor(){a.br(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=F("div","mapboxgl-ctrl");const d=F("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const d in l){const y=l[d].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Bg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const b of y)if(b.id===l)return void(b.cancelled=!0)}run(l=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Dp(g,l,d){if(g=new a.aJ(g.lng,g.lat),l){const y=new a.aJ(g.lng-360,g.lat),b=new a.aJ(g.lng+360,g.lat),T=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),S=d.locationPoint(g).distSqr(l),A=l.x<0||l.y<0||l.x>d.width||l.y>d.height;d.locationPoint(y).distSqr(l)<S&&(A||Math.abs(y.lng-d.center.lng)<T)?g=y:d.locationPoint(b).distSqr(l)<S&&(A||Math.abs(b.lng-d.center.lng)<T)&&(g=b)}for(;Math.abs(g.lng-d.center.lng)>180;){const y=d.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=d.width&&y.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const jg={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ug extends a.E{constructor(l,d){if(super(),(l instanceof HTMLElement||d)&&(l=a.Q({element:l},d)),a.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=a.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=F("div");const T=41,S=27,A=Z("svg",{display:"block",height:T*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${T}`},this._element),k=Z("radialGradient",{id:"shadowGradient"},Z("defs",{},A));Z("stop",{offset:"10%","stop-opacity":.4},k),Z("stop",{offset:"100%","stop-opacity":.05},k),Z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),Z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),Z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),Z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=a.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()});const y=this._element.classList;for(const T in jg)y.remove(`mapboxgl-marker-anchor-${T}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const b=l&&l.className?l.className.trim().split(/\s+/):[];y.add(...b),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.aJ.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const d=l.code,y=l.charCode||l.keyCode;d!=="Space"&&d!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(l){const d=l.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,d=this._pos;if(!l||!d)return!1;const y=l.unproject(d),b=l.getFreeCameraOptions();if(!b.position)return!1;const T=b.position.toLngLat();return T.distanceTo(y)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const d=this._pos;if(!d||d.x<0||d.x>l.transform.width||d.y<0||d.y>l.transform.height)return void this._clearFadeTimer();const y=l.unproject(d);let b;l._showingGlobe()&&a.dc(l.transform,this._lngLat)?b=0:(b=1-l._queryFogOpacity(y),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${jg[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const l=this._pos,d=this._map,y=this.getPitchAlignment();if(!d||!l||y!=="map")return"";if(!d._showingGlobe()){const k=d.getPitch();return k?`rotateX(${k}deg)`:""}const b=a.b1(a.dd(d.transform,this._lngLat)),T=l.sub(a.de(d.transform)),S=Math.abs(T.x)+Math.abs(T.y);if(S===0)return"";const A=b/S;return`rotateX(${-T.y*A}deg) rotateY(${T.x*A}deg)`}_calculateZTransform(){const l=this._pos,d=this._map;if(!d||!l)return"";let y=0;const b=this.getRotationAlignment();if(b==="map")if(d._showingGlobe()){const T=d.project(new a.aJ(this._lngLat.lng,this._lngLat.lat+.001)),S=d.project(new a.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);y=a.b1(Math.atan2(S.y,S.x))-90}else y=-d.getBearing();else if(b==="horizon"){const T=a.a0(4,6,d.getZoom()),S=a.de(d.transform);S.y+=T*d.transform.height;const A=l.sub(S),k=a.b1(Math.atan2(A.y,A.x));y=(k>90?k-270:k+90)*(1-T)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Dp(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=a.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const d=this._map;if(!d)return;const y=this._pointerdownPos,b=this._positionDelta;if(y&&b){if(!this._isDragging){const T=this._clickTolerance||d._clickTolerance;if(l.point.dist(y)<T)return;this._isDragging=!0}this._pos=l.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.g("dragstart"))),this.fire(new a.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.g("dragend")),this._state="inactive"}_addDragHandler(l){const d=this._map,y=this._pos;d&&y&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(y),this._pointerdownPos=l.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const d=this._map;return d&&(l?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ad={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},OA=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ow(g=new a.P(0,0),l="bottom"){if(typeof g=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new a.P(0,g);case"top-left":return new a.P(d,d);case"top-right":return new a.P(-d,d);case"bottom":return new a.P(0,-g);case"bottom-left":return new a.P(d,-d);case"bottom-right":return new a.P(-d,-d);case"left":return new a.P(g,0);case"right":return new a.P(-g,0)}return new a.P(0,0)}return g instanceof a.P||Array.isArray(g)?a.P.convert(g):a.P.convert(g[l]||[0,0])}class LA{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const d=a.bb((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,d,y){this._start=this.getValue(d),this._end=l,this._startTime=d,this._endTime=d+y}}const zA={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class NA{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const FA={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},j0={showCompass:!0,showZoom:!0,visualizePitch:!1};class U0{constructor(l,d,y=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Cp({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,y&&(this.mousePitch=new Og({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),a.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),G()}move(l,d){const y=this.map,b=this.mouseRotate.mousemoveWindow(l,d),T=b&&b.bearingDelta;if(T&&y.setBearing(y.getBearing()+T),this.mousePitch){const S=this.mousePitch.mousemoveWindow(l,d),A=S&&S.pitchDelta;A&&y.setPitch(y.getPitch()+A)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Y(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(a.Q({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Te(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Te(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=we(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=we(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const aw={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Pd={maxWidth:100,unit:"metric"},lw={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:a.dw,supported:I,setRTLTextPlugin:a.dy,getRTLTextPluginStatus:a.dz,Map:class extends B0{constructor(g){a.df.mark(a.dg.create);const l=g;if((g=a.Q({},FA,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&a.dh(window)&&(g.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new eu(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Bg,this._domRenderTaskQueue=new Bg,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.di(),this._locale=a.Q({},zA,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new LA(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new a.dj(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?{...g.contextCreateOptions}:{},typeof g.container=="string"){const d=document.getElementById(g.container);if(!d)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=d}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),a.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new NA),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new zg(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||a.db.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new Qb(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const d=g.bounds;d&&(this.resize(),this.fitBounds(d,a.Q({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new kp({customAttribution:g.customAttribution})),this._logoControl=new Fg,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new a.g(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new a.g(`${d.dataType}dataloading`,d))})}_getMapId(){return this._mapId}addControl(g,l){if(l===void 0&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new a.g("movestart",g)).fire(new a.g("move",g)),this.fire(new a.g("resize",g)),l&&this.fire(new a.g("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(a.aj.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(l=>l==="auto"?navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,l=g.projection.name;let d;l==="globe"&&g.zoom>=a.aV?(g.setMercatorFromTransition(),d=!0):l==="mercator"&&g.zoom<a.aV&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;return l=g.name==="globe"&&this.transform.zoom>=a.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(a.aJ.convert(g))}unproject(g){return this.transform.pointLocation3D(a.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,d){if(g==="mouseenter"||g==="mouseover"){let y=!1;const b=S=>{const A=l.filter(L=>this.getLayer(L)),k=A.length?this.queryRenderedFeatures(S.point,{layers:A}):[];k.length?y||(y=!0,d.call(this,new ua(g,this,S.originalEvent,{features:k}))):y=!1},T=()=>{y=!1};return{layers:new Set(l),listener:d,delegates:{mousemove:b,mouseout:T}}}if(g==="mouseleave"||g==="mouseout"){let y=!1;const b=S=>{const A=l.filter(k=>this.getLayer(k));(A.length?this.queryRenderedFeatures(S.point,{layers:A}):[]).length?y=!0:y&&(y=!1,d.call(this,new ua(g,this,S.originalEvent)))},T=S=>{y&&(y=!1,d.call(this,new ua(g,this,S.originalEvent)))};return{layers:new Set(l),listener:d,delegates:{mousemove:b,mouseout:T}}}{const y=b=>{const T=l.filter(A=>this.getLayer(A)),S=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];S.length&&(b.features=S,d.call(this,b),delete b.features)};return{layers:new Set(l),listener:d,delegates:{[g]:y}}}}on(g,l,d){if(typeof l=="function"||d===void 0)return super.on(g,l);if(Array.isArray(l)||(l=[l]),l){for(const b of l)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(g,l,d){if(typeof l=="function"||d===void 0)return super.once(g,l);if(Array.isArray(l)||(l=[l]),l){for(const b of l)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,l,d);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(g,l,d){if(typeof l=="function"||d===void 0)return super.off(g,l);const y=new Set(Array.isArray(l)?l:[l]);for(const S of y)if(!this._isValidId(S))return this;const b=(S,A)=>{if(S.size!==A.size)return!1;for(const k of S)if(!A.has(k))return!1;return!0},T=this._delegatedListeners?this._delegatedListeners[g]:void 0;return T&&(S=>{for(let A=0;A<S.length;A++){const k=S[A];if(k.listener===d&&b(k.layers,y)){for(const L in k.delegates)this.off(L,k.delegates[L]);return S.splice(A,1),this}}})(T),this}queryRenderedFeatures(g,l){if(!this.style)return[];if(l!==void 0||g===void 0||g instanceof a.P||Array.isArray(g)||(l=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers)){for(const d of l.layers)if(!this._isValidId(d))return[]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(g,l){return this._isValidId(g)?this.style.querySourceFeatures(g,l):[]}isPointOnSurface(g){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&a.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(g))}setStyle(g,l){return l=a.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&g&&l.diff!==!1&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(g,(d,y)=>{d?(a.w(`Unable to perform style diff: ${String(d.message||d.error||d)}. Rebuilding the style from scratch.`),this._updateStyle(g,l)):y&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(l==null)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const d=a.Q({},l);l&&l.config&&(d.initialConfig=l.config,delete d.config),this.style=new ca(this,d).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new a.f(new Error("IDs can't be empty."))),!1):!a.cY(g)||(this.fire(new a.f(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,l){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,l,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,d)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,l,{pixelRatio:d=1,sdf:y=!1,stretchX:b,stretchY:T,content:S}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:A,height:k,data:L}=a.e.getImageData(l);this.style.addImage(g,{data:new a.j({width:A,height:k},L),pixelRatio:d,stretchX:b,stretchY:T,content:S,sdf:y,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new a.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:k}=l,L=l;this.style.addImage(g,{data:new a.j({width:A,height:k},new Uint8Array(L.data)),pixelRatio:d,stretchX:b,stretchY:T,content:S,sdf:y,version:0,userImage:L}),L.onAdd&&L.onAdd(this,g)}}updateImage(g,l){this._lazyInitEmptyStyle();const d=this.style.getImage(g);if(!d)return void this.fire(new a.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?a.e.getImageData(l):l,{width:b,height:T,data:S}=y;if(b===void 0||T===void 0)return void this.fire(new a.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==d.data.width||T!==d.data.height)return void this.fire(new a.f(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const A=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);d.data.replace(S,A),this.style.updateImage(g,d)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new a.f(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){a.i(this._requestManager.transformRequest(g,a.R.Image),(d,y)=>{l(d,y instanceof HTMLImageElement?a.e.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(g,l){this._lazyInitEmptyStyle(),this.style.addModel(g,l)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new a.f(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,l){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)):this}getSlot(g){const l=this.getLayer(g);return l&&l.slot||null}setSlot(g,l){return this.style.setSlot(g,l),this.style.mergeLayers(),this._update(!0)}addImport(g,l){return this.style.addImport(g,l),this}updateImport(g,l){return typeof l!="string"&&l.id!==g?(this.removeImport(g),this.addImport(l)):(this.style.updateImport(g,l),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,l){return this.style.moveImport(g,l),this._update(!0)}moveLayer(g,l){return this._isValidId(g)?(this.style.moveLayer(g,l),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const l=this.style.getOwnLayer(g);return l?l.type==="custom"?l.implementation:l.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,l,d){return this._isValidId(g)?(this.style.setLayerZoomRange(g,l,d),this._update(!0)):this}setFilter(g,l,d={}){return this._isValidId(g)?(this.style.setFilter(g,l,d),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,l,d,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,l,d,y),this._update(!0)):this}getPaintProperty(g,l){return this._isValidId(g)?this.style.getPaintProperty(g,l):null}setLayoutProperty(g,l,d,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,l,d,y),this._update(!0)):this}getLayoutProperty(g,l){return this._isValidId(g)?this.style.getLayoutProperty(g,l):null}getSchema(g){return this.style.getSchema(g)}setSchema(g,l){return this.style.setSchema(g,l),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,l){return this.style.setConfig(g,l),this._update(!0)}getConfigProperty(g,l){return this.style.getConfigProperty(g,l)}setConfigProperty(g,l,d){return this.style.setConfigProperty(g,l,d),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const l=g[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aJ.convert(g),this.transform):0}setFeatureState(g,l){return this._isValidId(g.source)?(this.style.setFeatureState(g,l),this._update()):this}removeFeatureState(g,l){return this._isValidId(g.source)?(this.style.removeFeatureState(g,l),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let d,y,b,T=this._container;for(;T&&(!y||!b);){const S=window.getComputedStyle(T).transform;S&&S!=="none"&&(d=S.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(y=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(b=d[3])),T=T.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=b?Math.abs(l/b):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=F("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=F("div","mapboxgl-canvas-container",g);this._canvas=F("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=F("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=F("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const d=a.e.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);l!==-1&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const g=a.Q({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",g);l?(a.dk(l,!0),this.painter=new E0(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.dl.testSupport(l)):this.fire(new a.f(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.g("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new a.g("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;this.fire(new a.g("renderstart")),++this._frameId;const d=this.painter.context.extTimerQuery,y=a.e.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=b.createQuery(),b.beginQuery(d.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,B=this.transform.pitch,U=a.e.now(),q=new a.Y(L,{now:U,fadeDuration:T,pitch:B,transition:this.style.transition});this.style.update(q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(y);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource);if(A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.df.mark(a.dg.load),this.fire(new a.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const L=a.e.now()-y;b.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const B=b.getQueryParameter(l,b.QUERY_RESULT)/1e6;b.deleteQuery(l),this.fire(new a.g("gpu-timing-frame",{cpuTime:L,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(L);this.fire(new a.g("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(L);this.fire(new a.g("gpu-timing-deferred-render",{gpuTime:B}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(k||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(S=this._updateAverageElevation(y,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new a.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new a.g("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,a.df.mark(a.dg.fullLoad),this._performanceMetricsCollection&&a.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const d=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const b=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=g;const S=Math.abs(b-T);if(S>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(T),d(T);this._averageElevation.easeTo(T,g,300)}else if(S>1e-4)return this._averageElevation.jumpTo(T),d(T)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){a.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===a.dp||g.status===401)){const l=this.painter.context.gl;a.dk(l,!1),this._logoControl instanceof Fg&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&a.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const d=this.painter.context.gl,y=d.createFramebuffer();function b(T){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,T,0);const S=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,S),S}return d.bindFramebuffer(d.FRAMEBUFFER,y),this._canvasPixelComparison(b(g),l.canvasCopies.map(b),l.timeStamps)}_canvasPixelComparison(g,l,d){let y=d[1]-d[0];const b=g.length/4;for(let T=0;T<l.length;T++){const S=l[T];let A=0;for(let k=0;k<S.length;k+=4)S[k]===g[k]&&S[k+1]===g[k+1]&&S[k+2]===g[k+2]&&S[k+3]===g[k+3]&&(A+=1);y+=(d[T+2]-d[T+1])*(1-A/b)}return y}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.ds(this.painter.context.gl),a.dt.remove(),a.du.remove(),this._removed=!0,this.fire(new a.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=a.e.frame(l=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(l)}))}_preloadTiles(g){const l=this.style?this.style.getSourceCaches():[];return a.dv(l,(d,y)=>d._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,l){a.dx(g,l)}get version(){return a.dw}},NavigationControl:class{constructor(g={}){this.options=a.Q({},j0,g),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(a.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),F("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),F("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:l}):d.resetNorth({},{originalEvent:l}))}),this._compassIcon=F("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),d=l===g.getMaxZoom(),y=l===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new U0(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const d=F("button",g,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(g,l){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends a.E{constructor(g={}){super();const l=navigator.geolocation;this.options=a.Q({geolocation:l},aw,g),a.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kb(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>l(d.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),d=g.coords;return!!l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new a.g("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("geolocate",g)),this._finish()}}_updateCamera(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,y=this._map.getBearing(),b=a.Q({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),b,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=a.ay(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=F("button","mapboxgl-ctrl-geolocate",this._container),F("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F("div","mapboxgl-user-location"),this._dotElement.appendChild(F("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(F("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ug({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=F("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ug({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.g("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:kp,ScaleControl:class{constructor(g={}){this.options=a.Q({},Pd,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,d=l._containerHeight/2,y=l._containerWidth/2-g/2,b=l.unproject([y,d]),T=l.unproject([y+g,d]),S=b.distanceTo(T);if(this.options.unit==="imperial"){const A=3.2808*S;A>5280?this._setScale(g,A/5280,"mile"):this._setScale(g,A,"foot")}else this.options.unit==="nautical"?this._setScale(g,S/1852,"nautical-mile"):S>=1e3?this._setScale(g,S/1e3,"kilometer"):this._setScale(g,S,"meter")}_setScale(g,l,d){this._map._requestDomTask(()=>{const y=function(T){const S=Math.pow(10,`${Math.floor(T)}`.length-1);let A=T/S;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(k){const L=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*L)/L}(A),S*A}(l),b=y/l;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(y):`${y}&nbsp;${lw[d]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.w("Full screen control 'container' must be a DOM element.")),a.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=F("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(g){super(),this.options=a.Q(Object.create(Ad),g),a.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new a.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new a.g("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=a.aJ.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const l=document.createDocumentFragment(),d=document.createElement("body");let y;for(d.innerHTML=g;y=d.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=F("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const d=this._closeButton=F("button","mapboxgl-popup-close-button",l);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,d=this._container,y=this._pos;if(!l||!d||!y)return"bottom";const b=d.offsetWidth,T=d.offsetHeight,S=y.x<b/2,A=y.x>l.transform.width-b/2;if(y.y+g<T)return S?"top-left":A?"top-right":"top";if(y.y>l.transform.height-T){if(S)return"bottom-left";if(A)return"bottom-right"}return S?"left":A?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,d=this._content;if(!l||!this._lngLat&&!this._trackPointer||!d)return;let y=this._container;if(y||(y=this._container=F("div","mapboxgl-popup",l.getContainer()),this._tip=F("div","mapboxgl-popup-tip",y),y.appendChild(d)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Dp(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g instanceof a.P?g:l.project(this._lngLat),T=ow(this.options.offset),S=this._anchor=this._getAnchor(T.y),A=ow(this.options.offset,S),k=b.add(A).round();l._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${jg[S]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&l._showingGlobe()){const b=a.dc(l.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(OA);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Ug,Style:ca,LngLat:a.aJ,LngLatBounds:a.aj,Point:a.P,MercatorCoordinate:a._,FreeCameraOptions:dd,Evented:a.E,config:a.db,prewarm:a.dA,clearPrewarmedResources:a.dB,get accessToken(){return a.db.ACCESS_TOKEN},set accessToken(g){a.db.ACCESS_TOKEN=g},get baseApiUrl(){return a.db.API_URL},set baseApiUrl(g){a.db.API_URL=g},get workerCount(){return a.dC.workerCount},set workerCount(g){a.dC.workerCount=g},get maxParallelImageRequests(){return a.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){a.db.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){a.dD(g)},get workerUrl(){return a.dE.workerUrl},set workerUrl(g){a.dE.workerUrl=g},get workerClass(){return a.dE.workerClass},set workerClass(g){a.dE.workerClass=g},get workerParams(){return a.dE.workerParams},set workerParams(g){a.dE.workerParams=g},get dracoUrl(){return a.dF()},set dracoUrl(g){a.dG(g)},get meshoptUrl(){return a.dH()},set meshoptUrl(g){a.dI(g)},setNow:a.e.setNow,restoreNow:a.e.restoreNow}});var x=f;return x})})(yZ);var BTe=yZ.exports;const Gm=Gy(BTe),xZ="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";Gm.accessToken=xZ;let eE=null,f8=!1;const Nl={},jTe=async(e,t)=>{if($t.currentUser){const r=Zn(yn,"users",$t.currentUser.uid);try{await Yi(r,{location:{latitude:e,longitude:t,timestamp:new Date().toISOString()}})}catch(s){console.error("Error updating location:",s)}}},bZ=(e,t,r,s)=>{if(console.log("Adding marker for user:",s),!e||typeof e.addLayer!="function")return console.error("Invalid map object in addMarker"),null;if(!e.loaded())return console.log("Map not yet loaded, waiting..."),e.on("load",()=>bZ(e,t,r,s)),null;const c=document.createElement("div");c.className="marker-container";const f=document.createElement("img");f.src=s.profilePhoto||"/default-profile.png",f.alt=s.name||"User",f.className="marker-image";let _=!1;f.onerror=()=>{_||(console.warn(`Failed to load image for ${s.name||"user"}, default profile used.`),_=!0),f.src="/default-profile.png"},c.appendChild(f);const x=document.createElement("div");x.className="marker-dot",c.appendChild(x);try{const a=new Gm.Marker(c).setLngLat([r,t]).addTo(e);console.log("Marker created:",a);const I=new Gm.Popup({offset:25,closeButton:!1,closeOnClick:!1,maxWidth:"none"}),D=document.createElement("div");D.className="custom-popup",D.innerHTML=`
      <div class="profile-container">
        <div class="profile-header">
          <div class="profile-photo-container">
            <img src="${s.profilePhoto||"/default-profile.png"}" alt="${s.name||"User"}" class="profile-photo">
          </div>
          <div class="profile-info">
            <h2 class="profile-name">${s.name||"Unknown User"}</h2>
            <p class="profile-status"><span class="status-dot"></span> Active</p>
            <p class="profile-bio">${s.bio||"No bio available"}</p>
          </div>
        </div>
        <div class="tags-container">
          ${(s.tags||[]).map(F=>`<div class="tag">${F}</div>`).join("")}
        </div>
        <button class="add-friend-button">Add Friend</button>
      </div>
    `;const O=D.querySelector(".add-friend-button");return O.addEventListener("click",async()=>{console.log("Add friend button clicked");try{const F=Zn(yn,"users",$t.currentUser.uid),re=(await $i(F)).data().friends||[];re.includes(s.id)||(await Yi(F,{friends:[...re,s.id]}),O.textContent="Friend Added",O.disabled=!0)}catch(F){console.error("Error adding friend:",F)}}),I.setDOMContent(D),a.setPopup(I),a.getElement().addEventListener("click",F=>{console.log("Marker clicked:",s),F.stopPropagation(),I.addTo(e)}),a}catch(a){return console.error("Error creating marker:",a),null}},wZ=(e,t)=>{if(console.log("Setting up user locations listener"),!e||typeof e.addLayer!="function")return console.error("Invalid map object in setupUserLocationsListener"),()=>{};if(!e.loaded())return e.on("load",()=>wZ(e,t)),()=>{};const r=vi(yn,"users"),s=co(r,yi("isActive","==",!0));return jh(s,async c=>{console.log("User locations snapshot received");const f=new Set,_=$t.currentUser;if(!_){console.warn("No authenticated user found");return}const a=(await $i(Zn(yn,"users",_.uid))).data(),I=(a==null?void 0:a.friends)||[],D=(a==null?void 0:a.isPrivate)||!1;c.forEach(async O=>{const F=O.id,Z=O.data();console.log("Processing user:",F,Z);const J=!Z.isPrivate||F===_.uid||D&&I.includes(F)||!D&&I.includes(F);if(Z.isActive&&Z.location&&J){f.add(F);const re=new Date(Z.location.timestamp).getTime();if(new Date().getTime()-re>3e5)console.log("Removing inactive user:",F),Nl[F]&&(Nl[F].remove(),delete Nl[F]);else if(Nl[F])console.log("Updating marker for user:",F),Nl[F].setLngLat([Z.location.longitude,Z.location.latitude]);else{console.log("Adding new marker for user:",F);const Y=bZ(e,Z.location.latitude,Z.location.longitude,{id:F,name:Z.name,profilePhoto:Z.profilePhoto,bio:Z.bio,tags:Z.tags});Y&&(Nl[F]=Y)}}else console.log("Removing marker for non-visible user:",F),Nl[F]&&(Nl[F].remove(),delete Nl[F])}),Object.keys(Nl).forEach(O=>{f.has(O)||(console.log("Removing marker for user no longer in snapshot:",O),Nl[O].remove(),delete Nl[O])}),typeof t=="function"?t([...f]):console.warn("setCurrentUserIds is not a function")})},UTe=(e,t)=>{if(console.log("Setting up user location tracking"),!e||typeof e.addLayer!="function"){console.error("Invalid map object in trackUserLocation");return}if("geolocation"in navigator)return navigator.geolocation.watchPosition(s=>{const{latitude:c,longitude:f}=s.coords;jTe(c,f),(!eE||!f8||Math.abs(c-eE.latitude)>.001||Math.abs(f-eE.longitude)>.001)&&(e.flyTo({center:[f,c],zoom:15}),eE={latitude:c,longitude:f},f8=!0),fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${f},${c}.json?access_token=${xZ}`).then(x=>x.json()).then(x=>{x.features&&x.features.length>0&&t(x.features[0].place_name)}).catch(x=>{console.error("Error fetching address:",x)})},s=>{console.error("Error getting location:",s)},{enableHighAccuracy:!0,maximumAge:0,timeout:27e3});console.error("Geolocation is not supported by this browser.")},r4=async(e,t)=>{if(!e){console.error("Map object is not available");return}try{const s=(await $i(Zn(yn,"users",t))).data();s&&s.location?e.flyTo({center:[s.location.longitude,s.location.latitude],zoom:15,duration:1e3}):console.warn(`No location data found for user ${t}`)}catch(r){console.error("Error centering map on user:",r)}},i4=async e=>{if($t.currentUser){const t=Zn(yn,"users",$t.currentUser.uid);try{await Yi(t,{isActive:e})}catch(r){console.error("Error updating active status:",r)}}},VTe=e=>$t.onAuthStateChanged(t=>{t?i4(!0):(i4(!1),e("/login"))}),TZ=(e,t)=>{$t.currentUser?i4(!1).then(()=>{localStorage.clear(),$t.signOut().then(()=>{e("/login")}).catch(r=>{console.error("Error signing out:",r)})}):(localStorage.clear(),$t.signOut().then(()=>{e("/login")}).catch(r=>{console.error("Error signing out:",r)}))},EZ=W.createContext(),$Te=()=>W.useContext(EZ),qTe=({children:e})=>{const[t,r]=W.useState("offline"),[s,c]=W.useState(Date.now());W.useEffect(()=>{const x=$t.onAuthStateChanged(a=>{a?(r("online"),c(Date.now()),_(a.uid,"online"),f(a.uid)):(r("offline"),c(Date.now()))});return()=>{x()}},[]);const f=x=>{const a=["mousedown","keydown","scroll","touchstart"],I=()=>{c(Date.now()),t!=="online"&&(r("online"),_(x,"online"))};a.forEach(F=>{window.addEventListener(F,I)});const D=setInterval(()=>{Date.now()-s>3*60*1e3&&(r("idle"),_(x,"idle"))},60*1e3),O=()=>{document.hidden?(r("offline"),_(x,"offline")):(r("online"),c(Date.now()),_(x,"online"))};return document.addEventListener("visibilitychange",O),()=>{a.forEach(F=>{window.removeEventListener(F,I)}),clearInterval(D),document.removeEventListener("visibilitychange",O)}},_=async(x,a)=>{try{const I=Zn(yn,"users",x);await Yi(I,{status:a})}catch(I){console.error("Error updating user status in Firestore:",I)}};return W.useEffect(()=>{if($t.currentUser){const x=Zn(yn,"users",$t.currentUser.uid),a=jh(x,I=>{I.exists()&&I.data().activeQuest&&r("on quest")});return()=>a()}},[]),N.jsx(EZ.Provider,{value:{userStatus:t,setUserStatus:r},children:e})},p8=()=>{};let HO={},SZ={},IZ=null,CZ={mark:p8,measure:p8};try{typeof window<"u"&&(HO=window),typeof document<"u"&&(SZ=document),typeof MutationObserver<"u"&&(IZ=MutationObserver),typeof performance<"u"&&(CZ=performance)}catch{}const{userAgent:m8=""}=HO.navigator||{},Uf=HO,ts=SZ,g8=IZ,tE=CZ;Uf.document;const od=!!ts.documentElement&&!!ts.head&&typeof ts.addEventListener=="function"&&typeof ts.createElement=="function",AZ=~m8.indexOf("MSIE")||~m8.indexOf("Trident/");var ds="classic",PZ="duotone",gl="sharp",_l="sharp-duotone",GTe=[ds,PZ,gl,_l],WTe={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds"}},_8={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},HTe=["kit"],ZTe=/fa(s|r|l|t|d|b|k|kd|ss|sr|sl|st|sds)?[\-\ ]/,XTe=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit)?.*/i,KTe={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}},QTe={"Font Awesome 6 Free":{900:"fas",400:"far"},"Font Awesome 6 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 6 Brands":{400:"fab",normal:"fab"},"Font Awesome 6 Duotone":{900:"fad"},"Font Awesome 6 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 6 Sharp Duotone":{900:"fasds"}},YTe={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds"}},JTe={classic:["fas","far","fal","fat"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds"]},eEe={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid"}},tEe={classic:{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab"},sharp:{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"},"sharp-duotone":{solid:"fasds"}},RZ={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid"}},nEe=["solid","regular","light","thin","duotone","brands"],MZ=[1,2,3,4,5,6,7,8,9,10],rEe=MZ.concat([11,12,13,14,15,16,17,18,19,20]),p1={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},iEe=[...Object.keys(JTe),...nEe,"2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",p1.GROUP,p1.SWAP_OPACITY,p1.PRIMARY,p1.SECONDARY].concat(MZ.map(e=>"".concat(e,"x"))).concat(rEe.map(e=>"w-".concat(e))),sEe={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},oEe={kit:{"fa-kit":"fak"},"kit-duotone":{"fa-kit-duotone":"fakd"}},aEe={kit:{fak:"fa-kit"},"kit-duotone":{fakd:"fa-kit-duotone"}},y8={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}};const Jh="___FONT_AWESOME___",s4=16,kZ="fa",DZ="svg-inline--fa",Wm="data-fa-i2svg",o4="data-fa-pseudo-element",lEe="data-fa-pseudo-element-pending",ZO="data-prefix",XO="data-icon",v8="fontawesome-i2svg",cEe="async",uEe=["HTML","HEAD","STYLE","SCRIPT"],OZ=(()=>{try{return!0}catch{return!1}})(),LZ=[ds,gl,_l];function Tb(e){return new Proxy(e,{get(t,r){return r in t?t[r]:t[ds]}})}const zZ={...RZ};zZ[ds]={...RZ[ds],..._8.kit,..._8["kit-duotone"]};const Im=Tb(zZ),a4={...tEe};a4[ds]={...a4[ds],...y8.kit,...y8["kit-duotone"]};const Bx=Tb(a4),l4={...eEe};l4[ds]={...l4[ds],...aEe.kit};const Cm=Tb(l4),c4={...YTe};c4[ds]={...c4[ds],...oEe.kit};const hEe=Tb(c4),dEe=ZTe,NZ="fa-layers-text",fEe=XTe,pEe={...WTe};Tb(pEe);const mEe=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],BR=p1,Fy=new Set;Object.keys(Bx[ds]).map(Fy.add.bind(Fy));Object.keys(Bx[gl]).map(Fy.add.bind(Fy));Object.keys(Bx[_l]).map(Fy.add.bind(Fy));const gEe=[...HTe,...iEe],$1=Uf.FontAwesomeConfig||{};function _Ee(e){var t=ts.querySelector("script["+e+"]");if(t)return t.getAttribute(e)}function yEe(e){return e===""?!0:e==="false"?!1:e==="true"?!0:e}ts&&typeof ts.querySelector=="function"&&[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(t=>{let[r,s]=t;const c=yEe(_Ee(r));c!=null&&($1[s]=c)});const FZ={styleDefault:"solid",familyDefault:"classic",cssPrefix:kZ,replacementClass:DZ,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};$1.familyPrefix&&($1.cssPrefix=$1.familyPrefix);const By={...FZ,...$1};By.autoReplaceSvg||(By.observeMutations=!1);const Vn={};Object.keys(FZ).forEach(e=>{Object.defineProperty(Vn,e,{enumerable:!0,set:function(t){By[e]=t,q1.forEach(r=>r(Vn))},get:function(){return By[e]}})});Object.defineProperty(Vn,"familyPrefix",{enumerable:!0,set:function(e){By.cssPrefix=e,q1.forEach(t=>t(Vn))},get:function(){return By.cssPrefix}});Uf.FontAwesomeConfig=Vn;const q1=[];function vEe(e){return q1.push(e),()=>{q1.splice(q1.indexOf(e),1)}}const ef=s4,ku={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function xEe(e){if(!e||!od)return;const t=ts.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e;const r=ts.head.childNodes;let s=null;for(let c=r.length-1;c>-1;c--){const f=r[c],_=(f.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(_)>-1&&(s=f)}return ts.head.insertBefore(t,s),e}const bEe="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function jx(){let e=12,t="";for(;e-- >0;)t+=bEe[Math.random()*62|0];return t}function a0(e){const t=[];for(let r=(e||[]).length>>>0;r--;)t[r]=e[r];return t}function KO(e){return e.classList?a0(e.classList):(e.getAttribute("class")||"").split(" ").filter(t=>t)}function BZ(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function wEe(e){return Object.keys(e||{}).reduce((t,r)=>t+"".concat(r,'="').concat(BZ(e[r]),'" '),"").trim()}function rA(e){return Object.keys(e||{}).reduce((t,r)=>t+"".concat(r,": ").concat(e[r].trim(),";"),"")}function QO(e){return e.size!==ku.size||e.x!==ku.x||e.y!==ku.y||e.rotate!==ku.rotate||e.flipX||e.flipY}function TEe(e){let{transform:t,containerWidth:r,iconWidth:s}=e;const c={transform:"translate(".concat(r/2," 256)")},f="translate(".concat(t.x*32,", ").concat(t.y*32,") "),_="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),x="rotate(".concat(t.rotate," 0 0)"),a={transform:"".concat(f," ").concat(_," ").concat(x)},I={transform:"translate(".concat(s/2*-1," -256)")};return{outer:c,inner:a,path:I}}function EEe(e){let{transform:t,width:r=s4,height:s=s4,startCentered:c=!1}=e,f="";return c&&AZ?f+="translate(".concat(t.x/ef-r/2,"em, ").concat(t.y/ef-s/2,"em) "):c?f+="translate(calc(-50% + ".concat(t.x/ef,"em), calc(-50% + ").concat(t.y/ef,"em)) "):f+="translate(".concat(t.x/ef,"em, ").concat(t.y/ef,"em) "),f+="scale(".concat(t.size/ef*(t.flipX?-1:1),", ").concat(t.size/ef*(t.flipY?-1:1),") "),f+="rotate(".concat(t.rotate,"deg) "),f}var SEe=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 6 Sharp Duotone";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    animation-delay: -1ms;
    animation-duration: 1ms;
    animation-iteration-count: 1;
    transition-delay: 0s;
    transition-duration: 0s;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function jZ(){const e=kZ,t=DZ,r=Vn.cssPrefix,s=Vn.replacementClass;let c=SEe;if(r!==e||s!==t){const f=new RegExp("\\.".concat(e,"\\-"),"g"),_=new RegExp("\\--".concat(e,"\\-"),"g"),x=new RegExp("\\.".concat(t),"g");c=c.replace(f,".".concat(r,"-")).replace(_,"--".concat(r,"-")).replace(x,".".concat(s))}return c}let x8=!1;function jR(){Vn.autoAddCss&&!x8&&(xEe(jZ()),x8=!0)}var IEe={mixout(){return{dom:{css:jZ,insertCss:jR}}},hooks(){return{beforeDOMElementCreation(){jR()},beforeI2svg(){jR()}}}};const ed=Uf||{};ed[Jh]||(ed[Jh]={});ed[Jh].styles||(ed[Jh].styles={});ed[Jh].hooks||(ed[Jh].hooks={});ed[Jh].shims||(ed[Jh].shims=[]);var Du=ed[Jh];const UZ=[],VZ=function(){ts.removeEventListener("DOMContentLoaded",VZ),tI=1,UZ.map(e=>e())};let tI=!1;od&&(tI=(ts.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(ts.readyState),tI||ts.addEventListener("DOMContentLoaded",VZ));function CEe(e){od&&(tI?setTimeout(e,0):UZ.push(e))}function Eb(e){const{tag:t,attributes:r={},children:s=[]}=e;return typeof e=="string"?BZ(e):"<".concat(t," ").concat(wEe(r),">").concat(s.map(Eb).join(""),"</").concat(t,">")}function b8(e,t,r){if(e&&e[t]&&e[t][r])return{prefix:t,iconName:r,icon:e[t][r]}}var UR=function(t,r,s,c){var f=Object.keys(t),_=f.length,x=r,a,I,D;for(s===void 0?(a=1,D=t[f[0]]):(a=0,D=s);a<_;a++)I=f[a],D=x(D,t[I],I,t);return D};function AEe(e){const t=[];let r=0;const s=e.length;for(;r<s;){const c=e.charCodeAt(r++);if(c>=55296&&c<=56319&&r<s){const f=e.charCodeAt(r++);(f&64512)==56320?t.push(((c&1023)<<10)+(f&1023)+65536):(t.push(c),r--)}else t.push(c)}return t}function u4(e){const t=AEe(e);return t.length===1?t[0].toString(16):null}function PEe(e,t){const r=e.length;let s=e.charCodeAt(t),c;return s>=55296&&s<=56319&&r>t+1&&(c=e.charCodeAt(t+1),c>=56320&&c<=57343)?(s-55296)*1024+c-56320+65536:s}function w8(e){return Object.keys(e).reduce((t,r)=>{const s=e[r];return!!s.icon?t[s.iconName]=s.icon:t[r]=s,t},{})}function h4(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{skipHooks:s=!1}=r,c=w8(t);typeof Du.hooks.addPack=="function"&&!s?Du.hooks.addPack(e,w8(t)):Du.styles[e]={...Du.styles[e]||{},...c},e==="fas"&&h4("fa",t)}const{styles:cm,shims:REe}=Du,MEe={[ds]:Object.values(Cm[ds]),[gl]:Object.values(Cm[gl]),[_l]:Object.values(Cm[_l])};let YO=null,$Z={},qZ={},GZ={},WZ={},HZ={};const kEe={[ds]:Object.keys(Im[ds]),[gl]:Object.keys(Im[gl]),[_l]:Object.keys(Im[_l])};function DEe(e){return~gEe.indexOf(e)}function OEe(e,t){const r=t.split("-"),s=r[0],c=r.slice(1).join("-");return s===e&&c!==""&&!DEe(c)?c:null}const ZZ=()=>{const e=s=>UR(cm,(c,f,_)=>(c[_]=UR(f,s,{}),c),{});$Z=e((s,c,f)=>(c[3]&&(s[c[3]]=f),c[2]&&c[2].filter(x=>typeof x=="number").forEach(x=>{s[x.toString(16)]=f}),s)),qZ=e((s,c,f)=>(s[f]=f,c[2]&&c[2].filter(x=>typeof x=="string").forEach(x=>{s[x]=f}),s)),HZ=e((s,c,f)=>{const _=c[2];return s[f]=f,_.forEach(x=>{s[x]=f}),s});const t="far"in cm||Vn.autoFetchSvg,r=UR(REe,(s,c)=>{const f=c[0];let _=c[1];const x=c[2];return _==="far"&&!t&&(_="fas"),typeof f=="string"&&(s.names[f]={prefix:_,iconName:x}),typeof f=="number"&&(s.unicodes[f.toString(16)]={prefix:_,iconName:x}),s},{names:{},unicodes:{}});GZ=r.names,WZ=r.unicodes,YO=iA(Vn.styleDefault,{family:Vn.familyDefault})};vEe(e=>{YO=iA(e.styleDefault,{family:Vn.familyDefault})});ZZ();function JO(e,t){return($Z[e]||{})[t]}function LEe(e,t){return(qZ[e]||{})[t]}function _f(e,t){return(HZ[e]||{})[t]}function XZ(e){return GZ[e]||{prefix:null,iconName:null}}function zEe(e){const t=WZ[e],r=JO("fas",e);return t||(r?{prefix:"fas",iconName:r}:null)||{prefix:null,iconName:null}}function Vf(){return YO}const eL=()=>({prefix:null,iconName:null,rest:[]});function iA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{family:r=ds}=t,s=Im[r][e],c=Bx[r][e]||Bx[r][s],f=e in Du.styles?e:null;return c||f||null}const NEe={[ds]:Object.keys(Cm[ds]),[gl]:Object.keys(Cm[gl]),[_l]:Object.keys(Cm[_l])};function sA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{skipLookups:r=!1}=t,s={[ds]:"".concat(Vn.cssPrefix,"-").concat(ds),[gl]:"".concat(Vn.cssPrefix,"-").concat(gl),[_l]:"".concat(Vn.cssPrefix,"-").concat(_l)};let c=null,f=ds;const _=GTe.filter(a=>a!==PZ);_.forEach(a=>{(e.includes(s[a])||e.some(I=>NEe[a].includes(I)))&&(f=a)});const x=e.reduce((a,I)=>{const D=OEe(Vn.cssPrefix,I);if(cm[I]?(I=MEe[f].includes(I)?hEe[f][I]:I,c=I,a.prefix=I):kEe[f].indexOf(I)>-1?(c=I,a.prefix=iA(I,{family:f})):D?a.iconName=D:I!==Vn.replacementClass&&!_.some(O=>I===s[O])&&a.rest.push(I),!r&&a.prefix&&a.iconName){const O=c==="fa"?XZ(a.iconName):{},F=_f(a.prefix,a.iconName);O.prefix&&(c=null),a.iconName=O.iconName||F||a.iconName,a.prefix=O.prefix||a.prefix,a.prefix==="far"&&!cm.far&&cm.fas&&!Vn.autoFetchSvg&&(a.prefix="fas")}return a},eL());return(e.includes("fa-brands")||e.includes("fab"))&&(x.prefix="fab"),(e.includes("fa-duotone")||e.includes("fad"))&&(x.prefix="fad"),!x.prefix&&f===gl&&(cm.fass||Vn.autoFetchSvg)&&(x.prefix="fass",x.iconName=_f(x.prefix,x.iconName)||x.iconName),!x.prefix&&f===_l&&(cm.fasds||Vn.autoFetchSvg)&&(x.prefix="fasds",x.iconName=_f(x.prefix,x.iconName)||x.iconName),(x.prefix==="fa"||c==="fa")&&(x.prefix=Vf()||"fas"),x}class FEe{constructor(){this.definitions={}}add(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const c=r.reduce(this._pullDefinitions,{});Object.keys(c).forEach(f=>{this.definitions[f]={...this.definitions[f]||{},...c[f]},h4(f,c[f]);const _=Cm[ds][f];_&&h4(_,c[f]),ZZ()})}reset(){this.definitions={}}_pullDefinitions(t,r){const s=r.prefix&&r.iconName&&r.icon?{0:r}:r;return Object.keys(s).map(c=>{const{prefix:f,iconName:_,icon:x}=s[c],a=x[2];t[f]||(t[f]={}),a.length>0&&a.forEach(I=>{typeof I=="string"&&(t[f][I]=x)}),t[f][_]=x}),t}}let T8=[],X_={};const my={},BEe=Object.keys(my);function jEe(e,t){let{mixoutsTo:r}=t;return T8=e,X_={},Object.keys(my).forEach(s=>{BEe.indexOf(s)===-1&&delete my[s]}),T8.forEach(s=>{const c=s.mixout?s.mixout():{};if(Object.keys(c).forEach(f=>{typeof c[f]=="function"&&(r[f]=c[f]),typeof c[f]=="object"&&Object.keys(c[f]).forEach(_=>{r[f]||(r[f]={}),r[f][_]=c[f][_]})}),s.hooks){const f=s.hooks();Object.keys(f).forEach(_=>{X_[_]||(X_[_]=[]),X_[_].push(f[_])})}s.provides&&s.provides(my)}),r}function d4(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];return(X_[e]||[]).forEach(_=>{t=_.apply(null,[t,...s])}),t}function Hm(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];(X_[e]||[]).forEach(f=>{f.apply(null,r)})}function $f(){const e=arguments[0],t=Array.prototype.slice.call(arguments,1);return my[e]?my[e].apply(null,t):void 0}function f4(e){e.prefix==="fa"&&(e.prefix="fas");let{iconName:t}=e;const r=e.prefix||Vf();if(t)return t=_f(r,t)||t,b8(KZ.definitions,r,t)||b8(Du.styles,r,t)}const KZ=new FEe,UEe=()=>{Vn.autoReplaceSvg=!1,Vn.observeMutations=!1,Hm("noAuto")},VEe={i2svg:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return od?(Hm("beforeI2svg",e),$f("pseudoElements2svg",e),$f("i2svg",e)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:t}=e;Vn.autoReplaceSvg===!1&&(Vn.autoReplaceSvg=!0),Vn.observeMutations=!0,CEe(()=>{qEe({autoReplaceSvgRoot:t}),Hm("watch",e)})}},$Ee={icon:e=>{if(e===null)return null;if(typeof e=="object"&&e.prefix&&e.iconName)return{prefix:e.prefix,iconName:_f(e.prefix,e.iconName)||e.iconName};if(Array.isArray(e)&&e.length===2){const t=e[1].indexOf("fa-")===0?e[1].slice(3):e[1],r=iA(e[0]);return{prefix:r,iconName:_f(r,t)||t}}if(typeof e=="string"&&(e.indexOf("".concat(Vn.cssPrefix,"-"))>-1||e.match(dEe))){const t=sA(e.split(" "),{skipLookups:!0});return{prefix:t.prefix||Vf(),iconName:_f(t.prefix,t.iconName)||t.iconName}}if(typeof e=="string"){const t=Vf();return{prefix:t,iconName:_f(t,e)||e}}}},wl={noAuto:UEe,config:Vn,dom:VEe,parse:$Ee,library:KZ,findIconDefinition:f4,toHtml:Eb},qEe=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:t=ts}=e;(Object.keys(Du.styles).length>0||Vn.autoFetchSvg)&&od&&Vn.autoReplaceSvg&&wl.dom.i2svg({node:t})};function oA(e,t){return Object.defineProperty(e,"abstract",{get:t}),Object.defineProperty(e,"html",{get:function(){return e.abstract.map(r=>Eb(r))}}),Object.defineProperty(e,"node",{get:function(){if(!od)return;const r=ts.createElement("div");return r.innerHTML=e.html,r.children}}),e}function GEe(e){let{children:t,main:r,mask:s,attributes:c,styles:f,transform:_}=e;if(QO(_)&&r.found&&!s.found){const{width:x,height:a}=r,I={x:x/a/2,y:.5};c.style=rA({...f,"transform-origin":"".concat(I.x+_.x/16,"em ").concat(I.y+_.y/16,"em")})}return[{tag:"svg",attributes:c,children:t}]}function WEe(e){let{prefix:t,iconName:r,children:s,attributes:c,symbol:f}=e;const _=f===!0?"".concat(t,"-").concat(Vn.cssPrefix,"-").concat(r):f;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:{...c,id:_},children:s}]}]}function tL(e){const{icons:{main:t,mask:r},prefix:s,iconName:c,transform:f,symbol:_,title:x,maskId:a,titleId:I,extra:D,watchable:O=!1}=e,{width:F,height:Z}=r.found?r:t,J=s==="fak",re=[Vn.replacementClass,c?"".concat(Vn.cssPrefix,"-").concat(c):""].filter(Te=>D.classes.indexOf(Te)===-1).filter(Te=>Te!==""||!!Te).concat(D.classes).join(" ");let ne={children:[],attributes:{...D.attributes,"data-prefix":s,"data-icon":c,class:re,role:D.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(F," ").concat(Z)}};const G=J&&!~D.classes.indexOf("fa-fw")?{width:"".concat(F/Z*16*.0625,"em")}:{};O&&(ne.attributes[Wm]=""),x&&(ne.children.push({tag:"title",attributes:{id:ne.attributes["aria-labelledby"]||"title-".concat(I||jx())},children:[x]}),delete ne.attributes.title);const Y={...ne,prefix:s,iconName:c,main:t,mask:r,maskId:a,transform:f,symbol:_,styles:{...G,...D.styles}},{children:Q,attributes:de}=r.found&&t.found?$f("generateAbstractMask",Y)||{children:[],attributes:{}}:$f("generateAbstractIcon",Y)||{children:[],attributes:{}};return Y.children=Q,Y.attributes=de,_?WEe(Y):GEe(Y)}function E8(e){const{content:t,width:r,height:s,transform:c,title:f,extra:_,watchable:x=!1}=e,a={..._.attributes,...f?{title:f}:{},class:_.classes.join(" ")};x&&(a[Wm]="");const I={..._.styles};QO(c)&&(I.transform=EEe({transform:c,startCentered:!0,width:r,height:s}),I["-webkit-transform"]=I.transform);const D=rA(I);D.length>0&&(a.style=D);const O=[];return O.push({tag:"span",attributes:a,children:[t]}),f&&O.push({tag:"span",attributes:{class:"sr-only"},children:[f]}),O}function HEe(e){const{content:t,title:r,extra:s}=e,c={...s.attributes,...r?{title:r}:{},class:s.classes.join(" ")},f=rA(s.styles);f.length>0&&(c.style=f);const _=[];return _.push({tag:"span",attributes:c,children:[t]}),r&&_.push({tag:"span",attributes:{class:"sr-only"},children:[r]}),_}const{styles:VR}=Du;function p4(e){const t=e[0],r=e[1],[s]=e.slice(4);let c=null;return Array.isArray(s)?c={tag:"g",attributes:{class:"".concat(Vn.cssPrefix,"-").concat(BR.GROUP)},children:[{tag:"path",attributes:{class:"".concat(Vn.cssPrefix,"-").concat(BR.SECONDARY),fill:"currentColor",d:s[0]}},{tag:"path",attributes:{class:"".concat(Vn.cssPrefix,"-").concat(BR.PRIMARY),fill:"currentColor",d:s[1]}}]}:c={tag:"path",attributes:{fill:"currentColor",d:s}},{found:!0,width:t,height:r,icon:c}}const ZEe={found:!1,width:512,height:512};function XEe(e,t){!OZ&&!Vn.showMissingIcons&&e&&console.error('Icon with name "'.concat(e,'" and prefix "').concat(t,'" is missing.'))}function m4(e,t){let r=t;return t==="fa"&&Vn.styleDefault!==null&&(t=Vf()),new Promise((s,c)=>{if(r==="fa"){const f=XZ(e)||{};e=f.iconName||e,t=f.prefix||t}if(e&&t&&VR[t]&&VR[t][e]){const f=VR[t][e];return s(p4(f))}XEe(e,t),s({...ZEe,icon:Vn.showMissingIcons&&e?$f("missingIconAbstract")||{}:{}})})}const S8=()=>{},g4=Vn.measurePerformance&&tE&&tE.mark&&tE.measure?tE:{mark:S8,measure:S8},m1='FA "6.6.0"',KEe=e=>(g4.mark("".concat(m1," ").concat(e," begins")),()=>QZ(e)),QZ=e=>{g4.mark("".concat(m1," ").concat(e," ends")),g4.measure("".concat(m1," ").concat(e),"".concat(m1," ").concat(e," begins"),"".concat(m1," ").concat(e," ends"))};var nL={begin:KEe,end:QZ};const DE=()=>{};function I8(e){return typeof(e.getAttribute?e.getAttribute(Wm):null)=="string"}function QEe(e){const t=e.getAttribute?e.getAttribute(ZO):null,r=e.getAttribute?e.getAttribute(XO):null;return t&&r}function YEe(e){return e&&e.classList&&e.classList.contains&&e.classList.contains(Vn.replacementClass)}function JEe(){return Vn.autoReplaceSvg===!0?OE.replace:OE[Vn.autoReplaceSvg]||OE.replace}function eSe(e){return ts.createElementNS("http://www.w3.org/2000/svg",e)}function tSe(e){return ts.createElement(e)}function YZ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{ceFn:r=e.tag==="svg"?eSe:tSe}=t;if(typeof e=="string")return ts.createTextNode(e);const s=r(e.tag);return Object.keys(e.attributes||[]).forEach(function(f){s.setAttribute(f,e.attributes[f])}),(e.children||[]).forEach(function(f){s.appendChild(YZ(f,{ceFn:r}))}),s}function nSe(e){let t=" ".concat(e.outerHTML," ");return t="".concat(t,"Font Awesome fontawesome.com "),t}const OE={replace:function(e){const t=e[0];if(t.parentNode)if(e[1].forEach(r=>{t.parentNode.insertBefore(YZ(r),t)}),t.getAttribute(Wm)===null&&Vn.keepOriginalSource){let r=ts.createComment(nSe(t));t.parentNode.replaceChild(r,t)}else t.remove()},nest:function(e){const t=e[0],r=e[1];if(~KO(t).indexOf(Vn.replacementClass))return OE.replace(e);const s=new RegExp("".concat(Vn.cssPrefix,"-.*"));if(delete r[0].attributes.id,r[0].attributes.class){const f=r[0].attributes.class.split(" ").reduce((_,x)=>(x===Vn.replacementClass||x.match(s)?_.toSvg.push(x):_.toNode.push(x),_),{toNode:[],toSvg:[]});r[0].attributes.class=f.toSvg.join(" "),f.toNode.length===0?t.removeAttribute("class"):t.setAttribute("class",f.toNode.join(" "))}const c=r.map(f=>Eb(f)).join(`
`);t.setAttribute(Wm,""),t.innerHTML=c}};function C8(e){e()}function JZ(e,t){const r=typeof t=="function"?t:DE;if(e.length===0)r();else{let s=C8;Vn.mutateApproach===cEe&&(s=Uf.requestAnimationFrame||C8),s(()=>{const c=JEe(),f=nL.begin("mutate");e.map(c),f(),r()})}}let rL=!1;function eX(){rL=!0}function _4(){rL=!1}let nI=null;function A8(e){if(!g8||!Vn.observeMutations)return;const{treeCallback:t=DE,nodeCallback:r=DE,pseudoElementsCallback:s=DE,observeMutationsRoot:c=ts}=e;nI=new g8(f=>{if(rL)return;const _=Vf();a0(f).forEach(x=>{if(x.type==="childList"&&x.addedNodes.length>0&&!I8(x.addedNodes[0])&&(Vn.searchPseudoElements&&s(x.target),t(x.target)),x.type==="attributes"&&x.target.parentNode&&Vn.searchPseudoElements&&s(x.target.parentNode),x.type==="attributes"&&I8(x.target)&&~mEe.indexOf(x.attributeName))if(x.attributeName==="class"&&QEe(x.target)){const{prefix:a,iconName:I}=sA(KO(x.target));x.target.setAttribute(ZO,a||_),I&&x.target.setAttribute(XO,I)}else YEe(x.target)&&r(x.target)})}),od&&nI.observe(c,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}function rSe(){nI&&nI.disconnect()}function iSe(e){const t=e.getAttribute("style");let r=[];return t&&(r=t.split(";").reduce((s,c)=>{const f=c.split(":"),_=f[0],x=f.slice(1);return _&&x.length>0&&(s[_]=x.join(":").trim()),s},{})),r}function sSe(e){const t=e.getAttribute("data-prefix"),r=e.getAttribute("data-icon"),s=e.innerText!==void 0?e.innerText.trim():"";let c=sA(KO(e));return c.prefix||(c.prefix=Vf()),t&&r&&(c.prefix=t,c.iconName=r),c.iconName&&c.prefix||(c.prefix&&s.length>0&&(c.iconName=LEe(c.prefix,e.innerText)||JO(c.prefix,u4(e.innerText))),!c.iconName&&Vn.autoFetchSvg&&e.firstChild&&e.firstChild.nodeType===Node.TEXT_NODE&&(c.iconName=e.firstChild.data)),c}function oSe(e){const t=a0(e.attributes).reduce((c,f)=>(c.name!=="class"&&c.name!=="style"&&(c[f.name]=f.value),c),{}),r=e.getAttribute("title"),s=e.getAttribute("data-fa-title-id");return Vn.autoA11y&&(r?t["aria-labelledby"]="".concat(Vn.replacementClass,"-title-").concat(s||jx()):(t["aria-hidden"]="true",t.focusable="false")),t}function aSe(){return{iconName:null,title:null,titleId:null,prefix:null,transform:ku,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function P8(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0};const{iconName:r,prefix:s,rest:c}=sSe(e),f=oSe(e),_=d4("parseNodeAttributes",{},e);let x=t.styleParser?iSe(e):[];return{iconName:r,title:e.getAttribute("title"),titleId:e.getAttribute("data-fa-title-id"),prefix:s,transform:ku,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:c,styles:x,attributes:f},..._}}const{styles:lSe}=Du;function tX(e){const t=Vn.autoReplaceSvg==="nest"?P8(e,{styleParser:!1}):P8(e);return~t.extra.classes.indexOf(NZ)?$f("generateLayersText",e,t):$f("generateSvgReplacementMutation",e,t)}let qu=new Set;LZ.map(e=>{qu.add("fa-".concat(e))});Object.keys(Im[ds]).map(qu.add.bind(qu));Object.keys(Im[gl]).map(qu.add.bind(qu));Object.keys(Im[_l]).map(qu.add.bind(qu));qu=[...qu];function R8(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!od)return Promise.resolve();const r=ts.documentElement.classList,s=D=>r.add("".concat(v8,"-").concat(D)),c=D=>r.remove("".concat(v8,"-").concat(D)),f=Vn.autoFetchSvg?qu:LZ.map(D=>"fa-".concat(D)).concat(Object.keys(lSe));f.includes("fa")||f.push("fa");const _=[".".concat(NZ,":not([").concat(Wm,"])")].concat(f.map(D=>".".concat(D,":not([").concat(Wm,"])"))).join(", ");if(_.length===0)return Promise.resolve();let x=[];try{x=a0(e.querySelectorAll(_))}catch{}if(x.length>0)s("pending"),c("complete");else return Promise.resolve();const a=nL.begin("onTree"),I=x.reduce((D,O)=>{try{const F=tX(O);F&&D.push(F)}catch(F){OZ||F.name==="MissingIcon"&&console.error(F)}return D},[]);return new Promise((D,O)=>{Promise.all(I).then(F=>{JZ(F,()=>{s("active"),s("complete"),c("pending"),typeof t=="function"&&t(),a(),D()})}).catch(F=>{a(),O(F)})})}function cSe(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;tX(e).then(r=>{r&&JZ([r],t)})}function uSe(e){return function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=(t||{}).icon?t:f4(t||{});let{mask:c}=r;return c&&(c=(c||{}).icon?c:f4(c||{})),e(s,{...r,mask:c})}}const hSe=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=ku,symbol:s=!1,mask:c=null,maskId:f=null,title:_=null,titleId:x=null,classes:a=[],attributes:I={},styles:D={}}=t;if(!e)return;const{prefix:O,iconName:F,icon:Z}=e;return oA({type:"icon",...e},()=>(Hm("beforeDOMElementCreation",{iconDefinition:e,params:t}),Vn.autoA11y&&(_?I["aria-labelledby"]="".concat(Vn.replacementClass,"-title-").concat(x||jx()):(I["aria-hidden"]="true",I.focusable="false")),tL({icons:{main:p4(Z),mask:c?p4(c.icon):{found:!1,width:null,height:null,icon:{}}},prefix:O,iconName:F,transform:{...ku,...r},symbol:s,title:_,maskId:f,titleId:x,extra:{attributes:I,styles:D,classes:a}})))};var dSe={mixout(){return{icon:uSe(hSe)}},hooks(){return{mutationObserverCallbacks(e){return e.treeCallback=R8,e.nodeCallback=cSe,e}}},provides(e){e.i2svg=function(t){const{node:r=ts,callback:s=()=>{}}=t;return R8(r,s)},e.generateSvgReplacementMutation=function(t,r){const{iconName:s,title:c,titleId:f,prefix:_,transform:x,symbol:a,mask:I,maskId:D,extra:O}=r;return new Promise((F,Z)=>{Promise.all([m4(s,_),I.iconName?m4(I.iconName,I.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(J=>{let[re,ne]=J;F([t,tL({icons:{main:re,mask:ne},prefix:_,iconName:s,transform:x,symbol:a,maskId:D,title:c,titleId:f,extra:O,watchable:!0})])}).catch(Z)})},e.generateAbstractIcon=function(t){let{children:r,attributes:s,main:c,transform:f,styles:_}=t;const x=rA(_);x.length>0&&(s.style=x);let a;return QO(f)&&(a=$f("generateAbstractTransformGrouping",{main:c,transform:f,containerWidth:c.width,iconWidth:c.width})),r.push(a||c.icon),{children:r,attributes:s}}}},fSe={mixout(){return{layer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{classes:r=[]}=t;return oA({type:"layer"},()=>{Hm("beforeDOMElementCreation",{assembler:e,params:t});let s=[];return e(c=>{Array.isArray(c)?c.map(f=>{s=s.concat(f.abstract)}):s=s.concat(c.abstract)}),[{tag:"span",attributes:{class:["".concat(Vn.cssPrefix,"-layers"),...r].join(" ")},children:s}]})}}}},pSe={mixout(){return{counter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{title:r=null,classes:s=[],attributes:c={},styles:f={}}=t;return oA({type:"counter",content:e},()=>(Hm("beforeDOMElementCreation",{content:e,params:t}),HEe({content:e.toString(),title:r,extra:{attributes:c,styles:f,classes:["".concat(Vn.cssPrefix,"-layers-counter"),...s]}})))}}}},mSe={mixout(){return{text(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=ku,title:s=null,classes:c=[],attributes:f={},styles:_={}}=t;return oA({type:"text",content:e},()=>(Hm("beforeDOMElementCreation",{content:e,params:t}),E8({content:e,transform:{...ku,...r},title:s,extra:{attributes:f,styles:_,classes:["".concat(Vn.cssPrefix,"-layers-text"),...c]}})))}}},provides(e){e.generateLayersText=function(t,r){const{title:s,transform:c,extra:f}=r;let _=null,x=null;if(AZ){const a=parseInt(getComputedStyle(t).fontSize,10),I=t.getBoundingClientRect();_=I.width/a,x=I.height/a}return Vn.autoA11y&&!s&&(f.attributes["aria-hidden"]="true"),Promise.resolve([t,E8({content:t.innerHTML,width:_,height:x,transform:c,title:s,extra:f,watchable:!0})])}}};const gSe=new RegExp('"',"ug"),M8=[1105920,1112319],k8={FontAwesome:{normal:"fas",400:"fas"},...QTe,...KTe,...sEe},y4=Object.keys(k8).reduce((e,t)=>(e[t.toLowerCase()]=k8[t],e),{}),_Se=Object.keys(y4).reduce((e,t)=>{const r=y4[t];return e[t]=r[900]||[...Object.entries(r)][0][1],e},{});function ySe(e){const t=e.replace(gSe,""),r=PEe(t,0),s=r>=M8[0]&&r<=M8[1],c=t.length===2?t[0]===t[1]:!1;return{value:u4(c?t[0]:t),isSecondary:s||c}}function vSe(e,t){const r=e.replace(/^['"]|['"]$/g,"").toLowerCase(),s=parseInt(t),c=isNaN(s)?"normal":s;return(y4[r]||{})[c]||_Se[r]}function D8(e,t){const r="".concat(lEe).concat(t.replace(":","-"));return new Promise((s,c)=>{if(e.getAttribute(r)!==null)return s();const _=a0(e.children).filter(F=>F.getAttribute(o4)===t)[0],x=Uf.getComputedStyle(e,t),a=x.getPropertyValue("font-family"),I=a.match(fEe),D=x.getPropertyValue("font-weight"),O=x.getPropertyValue("content");if(_&&!I)return e.removeChild(_),s();if(I&&O!=="none"&&O!==""){const F=x.getPropertyValue("content");let Z=vSe(a,D);const{value:J,isSecondary:re}=ySe(F),ne=I[0].startsWith("FontAwesome");let G=JO(Z,J),Y=G;if(ne){const Q=zEe(J);Q.iconName&&Q.prefix&&(G=Q.iconName,Z=Q.prefix)}if(G&&!re&&(!_||_.getAttribute(ZO)!==Z||_.getAttribute(XO)!==Y)){e.setAttribute(r,Y),_&&e.removeChild(_);const Q=aSe(),{extra:de}=Q;de.attributes[o4]=t,m4(G,Z).then(Te=>{const we=tL({...Q,icons:{main:Te,mask:eL()},prefix:Z,iconName:Y,extra:de,watchable:!0}),oe=ts.createElementNS("http://www.w3.org/2000/svg","svg");t==="::before"?e.insertBefore(oe,e.firstChild):e.appendChild(oe),oe.outerHTML=we.map(he=>Eb(he)).join(`
`),e.removeAttribute(r),s()}).catch(c)}else s()}else s()})}function xSe(e){return Promise.all([D8(e,"::before"),D8(e,"::after")])}function bSe(e){return e.parentNode!==document.head&&!~uEe.indexOf(e.tagName.toUpperCase())&&!e.getAttribute(o4)&&(!e.parentNode||e.parentNode.tagName!=="svg")}function O8(e){if(od)return new Promise((t,r)=>{const s=a0(e.querySelectorAll("*")).filter(bSe).map(xSe),c=nL.begin("searchPseudoElements");eX(),Promise.all(s).then(()=>{c(),_4(),t()}).catch(()=>{c(),_4(),r()})})}var wSe={hooks(){return{mutationObserverCallbacks(e){return e.pseudoElementsCallback=O8,e}}},provides(e){e.pseudoElements2svg=function(t){const{node:r=ts}=t;Vn.searchPseudoElements&&O8(r)}}};let L8=!1;var TSe={mixout(){return{dom:{unwatch(){eX(),L8=!0}}}},hooks(){return{bootstrap(){A8(d4("mutationObserverCallbacks",{}))},noAuto(){rSe()},watch(e){const{observeMutationsRoot:t}=e;L8?_4():A8(d4("mutationObserverCallbacks",{observeMutationsRoot:t}))}}}};const z8=e=>{let t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e.toLowerCase().split(" ").reduce((r,s)=>{const c=s.toLowerCase().split("-"),f=c[0];let _=c.slice(1).join("-");if(f&&_==="h")return r.flipX=!0,r;if(f&&_==="v")return r.flipY=!0,r;if(_=parseFloat(_),isNaN(_))return r;switch(f){case"grow":r.size=r.size+_;break;case"shrink":r.size=r.size-_;break;case"left":r.x=r.x-_;break;case"right":r.x=r.x+_;break;case"up":r.y=r.y-_;break;case"down":r.y=r.y+_;break;case"rotate":r.rotate=r.rotate+_;break}return r},t)};var ESe={mixout(){return{parse:{transform:e=>z8(e)}}},hooks(){return{parseNodeAttributes(e,t){const r=t.getAttribute("data-fa-transform");return r&&(e.transform=z8(r)),e}}},provides(e){e.generateAbstractTransformGrouping=function(t){let{main:r,transform:s,containerWidth:c,iconWidth:f}=t;const _={transform:"translate(".concat(c/2," 256)")},x="translate(".concat(s.x*32,", ").concat(s.y*32,") "),a="scale(".concat(s.size/16*(s.flipX?-1:1),", ").concat(s.size/16*(s.flipY?-1:1),") "),I="rotate(".concat(s.rotate," 0 0)"),D={transform:"".concat(x," ").concat(a," ").concat(I)},O={transform:"translate(".concat(f/2*-1," -256)")},F={outer:_,inner:D,path:O};return{tag:"g",attributes:{...F.outer},children:[{tag:"g",attributes:{...F.inner},children:[{tag:r.icon.tag,children:r.icon.children,attributes:{...r.icon.attributes,...F.path}}]}]}}}};const $R={x:0,y:0,width:"100%",height:"100%"};function N8(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return e.attributes&&(e.attributes.fill||t)&&(e.attributes.fill="black"),e}function SSe(e){return e.tag==="g"?e.children:[e]}var ISe={hooks(){return{parseNodeAttributes(e,t){const r=t.getAttribute("data-fa-mask"),s=r?sA(r.split(" ").map(c=>c.trim())):eL();return s.prefix||(s.prefix=Vf()),e.mask=s,e.maskId=t.getAttribute("data-fa-mask-id"),e}}},provides(e){e.generateAbstractMask=function(t){let{children:r,attributes:s,main:c,mask:f,maskId:_,transform:x}=t;const{width:a,icon:I}=c,{width:D,icon:O}=f,F=TEe({transform:x,containerWidth:D,iconWidth:a}),Z={tag:"rect",attributes:{...$R,fill:"white"}},J=I.children?{children:I.children.map(N8)}:{},re={tag:"g",attributes:{...F.inner},children:[N8({tag:I.tag,attributes:{...I.attributes,...F.path},...J})]},ne={tag:"g",attributes:{...F.outer},children:[re]},G="mask-".concat(_||jx()),Y="clip-".concat(_||jx()),Q={tag:"mask",attributes:{...$R,id:G,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"},children:[Z,ne]},de={tag:"defs",children:[{tag:"clipPath",attributes:{id:Y},children:SSe(O)},Q]};return r.push(de,{tag:"rect",attributes:{fill:"currentColor","clip-path":"url(#".concat(Y,")"),mask:"url(#".concat(G,")"),...$R}}),{children:r,attributes:s}}}},CSe={provides(e){let t=!1;Uf.matchMedia&&(t=Uf.matchMedia("(prefers-reduced-motion: reduce)").matches),e.missingIconAbstract=function(){const r=[],s={fill:"currentColor"},c={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};r.push({tag:"path",attributes:{...s,d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}});const f={...c,attributeName:"opacity"},_={tag:"circle",attributes:{...s,cx:"256",cy:"364",r:"28"},children:[]};return t||_.children.push({tag:"animate",attributes:{...c,attributeName:"r",values:"28;14;28;28;14;28;"}},{tag:"animate",attributes:{...f,values:"1;0;1;1;0;1;"}}),r.push(_),r.push({tag:"path",attributes:{...s,opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"},children:t?[]:[{tag:"animate",attributes:{...f,values:"1;0;0;0;0;1;"}}]}),t||r.push({tag:"path",attributes:{...s,opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"},children:[{tag:"animate",attributes:{...f,values:"0;0;1;1;0;0;"}}]}),{tag:"g",attributes:{class:"missing"},children:r}}}},ASe={hooks(){return{parseNodeAttributes(e,t){const r=t.getAttribute("data-fa-symbol"),s=r===null?!1:r===""?!0:r;return e.symbol=s,e}}}},PSe=[IEe,dSe,fSe,pSe,mSe,wSe,TSe,ESe,ISe,CSe,ASe];jEe(PSe,{mixoutsTo:wl});wl.noAuto;wl.config;wl.library;wl.dom;const v4=wl.parse;wl.findIconDefinition;wl.toHtml;const RSe=wl.icon;wl.layer;wl.text;wl.counter;function F8(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,s)}return r}function Cu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F8(Object(r),!0).forEach(function(s){K_(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F8(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function rI(e){"@babel/helpers - typeof";return rI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rI(e)}function K_(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function MSe(e,t){if(e==null)return{};var r={},s=Object.keys(e),c,f;for(f=0;f<s.length;f++)c=s[f],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function kSe(e,t){if(e==null)return{};var r=MSe(e,t),s,c;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(c=0;c<f.length;c++)s=f[c],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}function x4(e){return DSe(e)||OSe(e)||LSe(e)||zSe()}function DSe(e){if(Array.isArray(e))return b4(e)}function OSe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function LSe(e,t){if(e){if(typeof e=="string")return b4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return b4(e,t)}}function b4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=e[r];return s}function zSe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function NSe(e){var t,r=e.beat,s=e.fade,c=e.beatFade,f=e.bounce,_=e.shake,x=e.flash,a=e.spin,I=e.spinPulse,D=e.spinReverse,O=e.pulse,F=e.fixedWidth,Z=e.inverse,J=e.border,re=e.listItem,ne=e.flip,G=e.size,Y=e.rotation,Q=e.pull,de=(t={"fa-beat":r,"fa-fade":s,"fa-beat-fade":c,"fa-bounce":f,"fa-shake":_,"fa-flash":x,"fa-spin":a,"fa-spin-reverse":D,"fa-spin-pulse":I,"fa-pulse":O,"fa-fw":F,"fa-inverse":Z,"fa-border":J,"fa-li":re,"fa-flip":ne===!0,"fa-flip-horizontal":ne==="horizontal"||ne==="both","fa-flip-vertical":ne==="vertical"||ne==="both"},K_(t,"fa-".concat(G),typeof G<"u"&&G!==null),K_(t,"fa-rotate-".concat(Y),typeof Y<"u"&&Y!==null&&Y!==0),K_(t,"fa-pull-".concat(Q),typeof Q<"u"&&Q!==null),K_(t,"fa-swap-opacity",e.swapOpacity),t);return Object.keys(de).map(function(Te){return de[Te]?Te:null}).filter(function(Te){return Te})}function FSe(e){return e=e-0,e===e}function nX(e){return FSe(e)?e:(e=e.replace(/[\-_\s]+(.)?/g,function(t,r){return r?r.toUpperCase():""}),e.substr(0,1).toLowerCase()+e.substr(1))}var BSe=["style"];function jSe(e){return e.charAt(0).toUpperCase()+e.slice(1)}function USe(e){return e.split(";").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,r){var s=r.indexOf(":"),c=nX(r.slice(0,s)),f=r.slice(s+1).trim();return c.startsWith("webkit")?t[jSe(c)]=f:t[c]=f,t},{})}function rX(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof t=="string")return t;var s=(t.children||[]).map(function(a){return rX(e,a)}),c=Object.keys(t.attributes||{}).reduce(function(a,I){var D=t.attributes[I];switch(I){case"class":a.attrs.className=D,delete t.attributes.class;break;case"style":a.attrs.style=USe(D);break;default:I.indexOf("aria-")===0||I.indexOf("data-")===0?a.attrs[I.toLowerCase()]=D:a.attrs[nX(I)]=D}return a},{attrs:{}}),f=r.style,_=f===void 0?{}:f,x=kSe(r,BSe);return c.attrs.style=Cu(Cu({},c.attrs.style),_),e.apply(void 0,[t.tag,Cu(Cu({},c.attrs),x)].concat(x4(s)))}var iX=!1;try{iX=!0}catch{}function VSe(){if(!iX&&console&&typeof console.error=="function"){var e;(e=console).error.apply(e,arguments)}}function B8(e){if(e&&rI(e)==="object"&&e.prefix&&e.iconName&&e.icon)return e;if(v4.icon)return v4.icon(e);if(e===null)return null;if(e&&rI(e)==="object"&&e.prefix&&e.iconName)return e;if(Array.isArray(e)&&e.length===2)return{prefix:e[0],iconName:e[1]};if(typeof e=="string")return{prefix:"fas",iconName:e}}function qR(e,t){return Array.isArray(t)&&t.length>0||!Array.isArray(t)&&t?K_({},e,t):{}}var j8={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1},sX=Gr.forwardRef(function(e,t){var r=Cu(Cu({},j8),e),s=r.icon,c=r.mask,f=r.symbol,_=r.className,x=r.title,a=r.titleId,I=r.maskId,D=B8(s),O=qR("classes",[].concat(x4(NSe(r)),x4((_||"").split(" ")))),F=qR("transform",typeof r.transform=="string"?v4.transform(r.transform):r.transform),Z=qR("mask",B8(c)),J=RSe(D,Cu(Cu(Cu(Cu({},O),F),Z),{},{symbol:f,title:x,titleId:a,maskId:I}));if(!J)return VSe("Could not find icon",D),null;var re=J.abstract,ne={ref:t};return Object.keys(r).forEach(function(G){j8.hasOwnProperty(G)||(ne[G]=r[G])}),$Se(re[0],ne)});sX.displayName="FontAwesomeIcon";sX.propTypes={beat:qr.bool,border:qr.bool,beatFade:qr.bool,bounce:qr.bool,className:qr.string,fade:qr.bool,flash:qr.bool,mask:qr.oneOfType([qr.object,qr.array,qr.string]),maskId:qr.string,fixedWidth:qr.bool,inverse:qr.bool,flip:qr.oneOf([!0,!1,"horizontal","vertical","both"]),icon:qr.oneOfType([qr.object,qr.array,qr.string]),listItem:qr.bool,pull:qr.oneOf(["right","left"]),pulse:qr.bool,rotation:qr.oneOf([0,90,180,270]),shake:qr.bool,size:qr.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:qr.bool,spinPulse:qr.bool,spinReverse:qr.bool,symbol:qr.oneOfType([qr.bool,qr.string]),title:qr.string,titleId:qr.string,transform:qr.oneOfType([qr.string,qr.object]),swapOpacity:qr.bool};var $Se=rX.bind(null,Gr.createElement);const qSe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M414-46q-32 0-55-20.5T332-118l-9-67q-5-2-10-5l-10-6-61 26q-29 12-59 2.5T137-205L71-322q-16-27-9.5-57.5T93-429l52-40v-22l-52-39q-26-19-32-49.5T71-638l66-116q16-27 45.5-37t58.5 2l64 26q5-3 9-5.5t9-4.5l9-68q4-32 27-52.5t55-20.5h132q32 0 55 20.5t27 52.5l9 68q5 2 10 4.5t10 5.5l61-26q29-12 59-2t46 37l66 116q16 28 10 58.5T867-530l-53 39v11q0 3-.5 5.5t-.5 5.5l53 39q26 19 32 49.5T888-322l-67 117q-16 27-45.5 37t-58.5-2l-62-26q-5 3-9 6t-9 5l-9 67q-4 31-27 51.5T546-46H414Zm37-126h56l15-104q32-8 61-24t51-42l98 41 27-50-83-63q5-16 8-32.5t3-33.5q0-17-3-33.5t-8-32.5l85-63-29-50-97 42q-22-26-51-43t-62-24l-13-104h-58l-12 103q-34 7-63.5 24T323-618l-96-41-28 50 82 61q-5 17-8 33.5t-3 34.5q0 17 3 34t8 34l-82 61 28 50 96-41q23 25 53 42t63 25l12 103Zm28-168q58 0 99-41t41-99q0-58-41-99t-99-41q-58 0-99 41t-41 99q0 58 41 99t99 41Zm1-140Z"})),U8=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M202.63-202.87h57.24l374.74-374.74-56.76-57-375.22 375.22v56.52Zm-45.26 91q-19.15 0-32.33-13.17-13.17-13.18-13.17-32.33v-102.26q0-18.15 6.84-34.69 6.83-16.53 19.51-29.2l501.17-500.41q12.48-11.72 27.7-17.96 15.21-6.24 31.93-6.24 16.48 0 32.2 6.24 15.71 6.24 27.67 18.72l65.28 65.56q12.48 11.72 18.34 27.56 5.86 15.83 5.86 31.79 0 16.72-5.86 32.05-5.86 15.34-18.34 27.82L324-138.22q-12.67 12.68-29.21 19.51-16.53 6.84-34.68 6.84H157.37Zm597.37-586.39-56.24-56.48 56.24 56.48Zm-148.89 92.41-28-28.76 56.76 57-28.76-28.24Z"})),oX=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"m421-443-60-60q-17-17-42-17t-42 17q-17 17-16.5 42t17.5 42l98 98q19.36 19 45.18 19T466-321l211-211q17-17 17-41.5T677-615q-17-17-42-17t-42 17L421-443Zm59 397q-91 0-169.99-34.08-78.98-34.09-137.41-92.52-58.43-58.43-92.52-137.41Q46-389 46-480q0-91 34.08-169.99 34.09-78.98 92.52-137.41 58.43-58.43 137.41-92.52Q389-914 480-914q91 0 169.99 34.08 78.98 34.09 137.41 92.52 58.43 58.43 92.52 137.41Q914-571 914-480q0 91-34.08 169.99-34.09 78.98-92.52 137.41-58.43 58.43-137.41 92.52Q571-46 480-46Zm0-126q130 0 219-89t89-219q0-130-89-219t-219-89q-130 0-219 89t-89 219q0 130 89 219t219 89Zm0-308Z"})),aX=({handleLogout:e,isNavExpanded:t})=>{const[r,s]=W.useState("placeholder.jpg"),[c,f]=W.useState("Default Name"),[_,x]=W.useState("default_username"),[a,I]=W.useState("Default Bio"),[D,O]=W.useState(!1),[F,Z]=W.useState(!1),[J,re]=W.useState(null),[ne,G]=W.useState([]);W.useState(!1);const[Y,Q]=W.useState([]),[de,Te]=W.useState(null),we=W.useRef(null),{showNotification:oe}=o0();$Te();const he=Qm(),[X,ge]=W.useState(window.innerWidth<768),[be,ke]=W.useState(window.innerHeight*.5),Ee=[{img:"/education.png",value:"education"},{img:"/food.png",value:"food"},{img:"/games.png",value:"games"},{img:"/other.png",value:"other"}];W.useEffect(()=>{const ht=()=>{ge(window.innerWidth<768)};return window.addEventListener("resize",ht),()=>window.removeEventListener("resize",ht)},[]),W.useEffect(()=>{$t.currentUser&&(zt(),Ut(),Qt())},[]);const zt=async()=>{try{const ht=await uy($t.currentUser.uid);ht&&(f(ht.name||"Default Name"),x(ht.username||"default_username"),s(ht.profilePhoto||"placeholder.jpg"),I(ht.bio||"Default Bio"),Z(ht.isPrivate||!1),G(ht.tags||[]))}catch(ht){console.error("Error fetching user data:",ht),oe("Failed to load user data","error")}},Ut=async()=>{if($t.currentUser)try{const ht=co(vi(yn,"quests"),yi("uid","==",$t.currentUser.uid),Tx("createdAt","desc"),H5(5)),wt=(await _a(ht)).docs.map(Xt=>({id:Xt.id,...Xt.data()}));Q(wt)}catch(ht){console.error("Error fetching recent quests:",ht),oe("Failed to load recent quests","error")}},Qt=async()=>{if($t.currentUser)try{const ht=co(vi(yn,"quests"),yi("uid","==",$t.currentUser.uid),yi("status","==","accepted")),At=await _a(ht);if(At.empty)Te(null);else{const wt=At.docs[0].data();if(wt.targetUser){const Xt=await uy(wt.targetUser);Te({...wt,partnerName:(Xt==null?void 0:Xt.name)||"Unknown",partnerPhoto:(Xt==null?void 0:Xt.profilePhoto)||"placeholder.jpg",partnerUsername:(Xt==null?void 0:Xt.username)||"unknown_user"})}else Te(wt)}}catch(ht){console.error("Error fetching active quest:",ht),oe("Failed to load active quest","error")}},kt=async()=>{try{let ht=r;J&&(ht=await fge(J)),await Ak($t.currentUser.uid,{name:c,username:_,bio:a,profilePhoto:ht,tags:ne}),O(!1),re(null),oe("Profile updated successfully!","success")}catch(ht){console.error("Error updating profile:",ht),oe("Failed to update profile","error")}},ft=ht=>{const At=ht.target.files[0];At&&(re(At),s(URL.createObjectURL(At)))},Rt=()=>{D&&we.current.click()},Yt=async ht=>{const At=ne.filter(wt=>wt!==ht);G(At);try{await Ak($t.currentUser.uid,{tags:At}),oe("Tag removed successfully","success")}catch(wt){console.error("Error removing tag:",wt),oe("Failed to remove tag","error")}};return wb(({movement:[,ht],down:At,event:wt})=>{if(X){if(At){const Xt=window.innerHeight*.5-ht;ke(Math.max(100,Math.min(Xt,window.innerHeight-60)))}wt.preventDefault()}},{delay:0,threshold:5}),xb({height:X?be:"auto",config:{tension:300,friction:30}}),N.jsx(aA,{children:N.jsxs("div",{className:"prof-container",children:[N.jsxs("header",{children:[N.jsxs("div",{className:"prof",children:[N.jsxs("div",{className:"prof-picture",onClick:()=>D&&Rt(),style:D?{cursor:"pointer"}:{},children:[D&&N.jsxs(N.Fragment,{children:[N.jsx("input",{type:"file",ref:we,onChange:ft,style:{display:"none"}}),N.jsx(U8,{})]}),N.jsx("img",{src:r,alt:"ProfilePicture"})]}),N.jsx("div",{className:"prof-name-container",style:D?{gap:"4px"}:{},children:D?N.jsxs(N.Fragment,{children:[N.jsx("input",{type:"text",value:c,onChange:ht=>f(ht.target.value),className:"prof-input",placeholder:"Name"}),N.jsx("div",{children:N.jsx("input",{type:"text",value:_,onChange:ht=>x(ht.target.value),className:"prof-input",placeholder:"Username"})})]}):N.jsxs(N.Fragment,{children:[N.jsx("p",{className:"prof-name",children:c}),N.jsxs("p",{className:"prof-username",children:["@",_]})]})}),N.jsxs("div",{className:"prof-header-buttons",children:[D?N.jsx(oX,{onClick:kt}):N.jsx(U8,{onClick:()=>O(!0)}),N.jsx(qSe,{onClick:()=>he("/home/settings")})]})]}),N.jsxs("div",{className:"prof-bio",children:[N.jsx("h3",{children:"Bio"}),D?N.jsx("textarea",{value:a,onChange:ht=>I(ht.target.value),className:"prof-bio-edit",placeholder:"Bio",maxLength:150}):N.jsx("p",{children:a})]})]}),N.jsxs("div",{className:"prof-body",children:[N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Tags"}),N.jsx("div",{className:"tags-container",children:ne.map(ht=>{var At;return N.jsxs("div",{className:"tag",children:[N.jsx("img",{src:((At=Ee.find(wt=>wt.value===ht))==null?void 0:At.img)||"/other.png",alt:ht,className:"tag-icon"}),N.jsx("button",{onClick:()=>Yt(ht),children:"x"})]},ht)})})]}),N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Active Quests"}),de?N.jsxs("div",{className:"quest-item",children:[N.jsxs("p",{children:['"',de.title,'" with']}),de.partnerName&&N.jsxs("div",{className:"quest-partner",children:[N.jsx("img",{src:de.partnerPhoto||"placeholder.jpg",alt:de.partnerName,className:"partner-photo"}),N.jsxs("p",{children:[de.partnerName," @",de.partnerUsername]})]})]}):N.jsx("p",{className:"section-empty-msg",children:"No quests ongoing. Ready to start a new adventure?"})]}),N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Recent Quests"}),Y.length>0?Y.map(ht=>N.jsxs("div",{className:"quest-item",children:[N.jsx("p",{children:ht.title}),ht.targetUser&&N.jsxs("p",{children:["with"," ",typeof ht.targetUser=="string"?ht.targetUser:ht.targetUser.name||"Unknown User"]})]},ht.id)):N.jsx("p",{className:"section-empty-msg",children:"No recent quests. Time to explore!"})]})]})]})})},GSe=Hu("div")({backgroundColor:"#000000",borderRadius:"20px",width:"90%",maxWidth:"500px",height:"90%",display:"flex",flexDirection:"column",overflow:"hidden"}),WSe=Hu("div")({position:"relative",width:"100%",height:"calc(100% - 150px)",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",backgroundColor:"#000000"}),HSe=Hu("img")({maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),ZSe=Hu("div")({position:"absolute",border:"2px solid white",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"}),XSe=Hu("div")({padding:"20px",backgroundColor:"#000000"}),KSe=Hu(Jxe)({display:"flex",justifyContent:"space-between",marginBottom:"20px"}),QSe=Hu(Kxe)({color:"white","&.Mui-checked":{color:"white"}}),YSe=Hu(V1e)({"& .MuiFormControlLabel-label":{color:"white"}}),JSe=Hu("div")({display:"flex",justifyContent:"space-between"}),V8=Hu(am)({flex:1,margin:"0 5px",fontWeight:"bold",borderRadius:"25px",padding:"12px 0"}),GR=[{value:"standard",label:"Standard (2:3)",width:1e3,height:1500},{value:"square",label:"Square (1:1)",width:1e3,height:1e3},{value:"long",label:"Long (1:2.1)",width:1e3,height:2100}],eIe=({photoPreview:e,onUpload:t,onCancel:r})=>{const[s,c]=W.useState("standard"),[f,_]=W.useState({x:0,y:0}),[x,a]=W.useState({width:0,height:0}),[I,D]=W.useState({width:0,height:0}),O=W.useRef(null),F=W.useRef(null),Z=W.useRef(null);W.useEffect(()=>{const G=new Image;G.onload=()=>{D({width:G.width,height:G.height})},G.src=e},[e]),W.useEffect(()=>{J()},[s,I]);const J=()=>{if(O.current&&I.width&&I.height){const G=O.current.getBoundingClientRect(),Y=GR.find(oe=>oe.value===s);G.width/G.height;const Q=I.width/I.height,de=Y.width/Y.height;let Te,we;de>Q?(Te=G.width,we=Te/de):(we=G.height,Te=we*de),a({width:Te,height:we}),_({x:(G.width-Te)/2,y:(G.height-we)/2})}},re=G=>{G.preventDefault();const Y=G.clientX-f.x,Q=G.clientY-f.y,de=we=>{if(O.current&&Z.current&&F.current){const oe=O.current.getBoundingClientRect(),he=F.current.getBoundingClientRect();let X=we.clientX-Y,ge=we.clientY-Q;X=Math.max(he.left-oe.left,Math.min(X,he.right-oe.left-x.width)),ge=Math.max(he.top-oe.top,Math.min(ge,he.bottom-oe.top-x.height)),_({x:X,y:ge})}},Te=()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",Te)};document.addEventListener("mousemove",de),document.addEventListener("mouseup",Te)},ne=()=>{if(F.current&&Z.current){const G=F.current.getBoundingClientRect(),Y=Z.current.getBoundingClientRect(),Q={x:(Y.left-G.left)/G.width,y:(Y.top-G.top)/G.height,width:Y.width/G.width,height:Y.height/G.height},de=GR.find(Te=>Te.value===s);t(Q,`${de.width}:${de.height}`)}};return N.jsxs(GSe,{children:[N.jsxs(WSe,{ref:O,children:[N.jsx(HSe,{ref:F,src:e,alt:"Preview"}),N.jsx(ZSe,{ref:Z,style:{width:`${x.width}px`,height:`${x.height}px`,left:`${f.x}px`,top:`${f.y}px`},onMouseDown:re})]}),N.jsxs(XSe,{children:[N.jsx(KSe,{row:!0,"aria-label":"aspect-ratio",name:"aspect-ratio",value:s,onChange:G=>c(G.target.value),children:GR.map(G=>N.jsx(YSe,{value:G.value,control:N.jsx(QSe,{}),label:G.label},G.value))}),N.jsxs(JSe,{children:[N.jsx(V8,{onClick:ne,variant:"contained",color:"primary",children:"Done"}),N.jsx(V8,{onClick:r,variant:"outlined",children:"Cancel"})]})]})]})};function aA({children:e}){return N.jsxs("div",{className:"navigation-modal-container",children:[N.jsx(RI,{className:"navigation-modal-bg",to:"/home"}),N.jsx("div",{className:"navigation-modal",children:e})]})}const tIe=e=>{e.getLayer("route")&&e.removeLayer("route"),e.getSource("route")&&e.removeSource("route")},lX=({currentUserIds:e,map:t,setLockedUserId:r,lockedUserId:s,lockedUserData:c,isCreateQuestOpen:f,setIsCreateQuestOpen:_})=>{console.log("Quests component rendering"),W.useState(!1);const[x,a]=W.useState(""),[I,D]=W.useState(""),[O,F]=W.useState(""),[Z,J]=W.useState([]),[re,ne]=W.useState(""),[G,Y]=W.useState([]),[Q,de]=W.useState(null),[Te,we]=W.useState(!1),[oe,he]=W.useState(!1),[X,ge]=W.useState(null),[be,ke]=W.useState(null),[Ee,zt]=W.useState(null),[Ut,Qt]=W.useState({acceptors:[],pendingAcceptors:[]}),[kt,ft]=W.useState(!1);W.useState(null),W.useState(!1);const[Rt,Yt]=W.useState([]),[ht,At]=W.useState("public"),[wt,Xt]=W.useState(window.innerHeight*.5),{showNotification:Ft}=o0();W.useEffect(()=>{(async()=>{try{const Xe=co(vi(yn,"users")),ut=jh(Xe,Ye=>{if(Ye.empty){console.error("No users found."),Y([]);return}const st=Ye.docs.map(Mt=>({id:Mt.id,...Mt.data()}));Y(st)});return()=>ut()}catch(Xe){console.error("Error fetching users:",Xe)}})()},[]),W.useEffect(()=>{$t.currentUser&&(async()=>{try{const Xe=co(vi(yn,"quests"),yi("isPublic","==",!0)),ut=co(vi(yn,"quests"),yi("uid","==",$t.currentUser.uid)),Ye=co(vi(yn,"quests"),yi("targetUser","==",$t.currentUser.uid)),[st,Mt,an]=await Promise.all([_a(Xe),_a(ut),_a(Ye)]),qt=st.docs.map(ir=>({id:ir.id,...ir.data()})),mn=Mt.docs.map(ir=>({id:ir.id,...ir.data()})),Ln=await Promise.all(an.docs.map(async ir=>{const Ci=ir.data(),ss=await $i(Zn(yn,"users",Ci.uid)),Tn=ss.exists()?ss.data():{};return{id:ir.id,...Ci,senderName:Tn.name||"Unknown sender"}})),fr=[...qt,...mn,...Ln],fi=new Map(fr.map(ir=>[ir.id,ir]));J(Array.from(fi.values()))}catch(Xe){console.error("Error fetching quests:",Xe)}})()},[$t.currentUser,Ft,G]),G.filter(Ue=>Ue.name.toLowerCase().includes(re.toLowerCase()));const Sn=async()=>{if($t.currentUser){if(!X){console.error("Pending quest is null.");return}try{const Ue=Zn(vi(yn,"quests"));if(X.isPublic)await Em(Ue,{...X,id:Ue.id,uid:$t.currentUser.uid,acceptedBy:[],pendingAcceptors:[]});else{if(!X.targetUser){console.error("Target user is missing in the quest");return}const Xe=co(vi(yn,"quests"),yi("uid","==",$t.currentUser.uid),yi("targetUser","==",X.targetUser),yi("title","==",X.title),yi("description","==",X.description),yi("isPublic","==",!1));if(!(await _a(Xe)).empty){Ft("A similar private quest already exists for this user.","info");return}await Em(Ue,{...X,id:Ue.id,uid:$t.currentUser.uid,acceptedBy:[],pendingAcceptors:[]})}Ft("Quest created!","success"),ge(null),he(!1),a(""),D(""),F(""),de(null),ne(""),we(!1)}catch(Ue){console.error("Error creating quest:",Ue),Ft("Failed to create quest.","error")}}},qn=async Ue=>{if($t.currentUser)try{const Xe=Zn(yn,"quests",Ue),Ye=(await $i(Xe)).data();if(!Ye.isPublic&&Ye.targetUser===$t.currentUser.uid)await O1(Xe),J(Z.filter(st=>st.id!==Ue)),Ft("Quest declined!","success");else if(Ye.isPublic)await Yi(Xe,{declinedBy:cy($t.currentUser.uid)}),J(Z.filter(st=>st.id!==Ue)),Ft("Quest declined!","success");else{const st=Ye.acceptedBy.filter(Mt=>Mt!==$t.currentUser.uid);await Yi(Xe,{acceptedBy:st}),J(Z.map(Mt=>Mt.id===Ue?{...Mt,acceptedBy:st}:Mt)),Ft("Quest declined!","success")}}catch(Xe){console.error("Error declining quest:",Xe),Ft("Failed to decline quest.","error")}},Qn=async Ue=>{if(!$t.currentUser){console.error("No authenticated user"),Ft("You must be logged in to accept quests.","error");return}if(!Ue.id){console.error("Quest ID is missing"),Ft("Invalid quest. Please try again.","error");return}try{const Xe=Zn(yn,"quests",Ue.id),ut=await $i(Xe);if(!ut.exists()){console.error("Quest does not exist"),Ft("This quest no longer exists.","error");return}let st={...ut.data(),status:Ue.isPublic?"pending":"accepted"};Ue.isPublic?st.pendingAcceptors=cy($t.currentUser.uid):st.acceptedBy=$t.currentUser.uid;const Mt=await $i(Zn(yn,"users",Ue.uid)),an=await $i(Zn(yn,"users",$t.currentUser.uid));if(!Mt.exists()||!an.exists()){console.error("Sender or receiver data not found"),Ft("Unable to process quest. User data missing.","error");return}const qt=Mt.data(),mn=an.data();if(!qt.location||!mn.location?(console.error("Sender or receiver location missing"),Ft("Location data is missing. Unable to display route.","warning")):st.routeInfo={senderLocation:qt.location,receiverLocation:mn.location},await Yi(Xe,st),J(Ln=>Ln.map(fr=>fr.id===Ue.id?st:fr)),Ue.isPublic||(Yt(Ln=>[...Ln,st]),st.routeInfo&&t&&Gt(t,st.routeInfo.senderLocation,st.routeInfo.receiverLocation)),Ft("Quest accepted!","success"),Ue.isPublic){const Ln=Zn(vi(yn,"notifications"));await Em(Ln,{type:"quest_accepted",questId:Ue.id,recipientId:Ue.uid,senderId:$t.currentUser.uid,content:`${$t.currentUser.displayName||"Someone"} has accepted your quest: ${Ue.title}`,createdAt:new Date,read:!1})}}catch(Xe){console.error("Error accepting quest:",Xe),Ft("Failed to accept quest. Please try again.","error")}},Gt=W.useCallback((Ue,Xe)=>{if(!t||!t.loaded()){console.error("Map is not fully loaded");return}if(!Ue||!Xe){console.error("Invalid locations for route display");return}const ut=`https://api.mapbox.com/directions/v5/mapbox/walking/${Ue.longitude},${Ue.latitude};${Xe.longitude},${Xe.latitude}?geometries=geojson&access_token=${Gm.accessToken}`;fetch(ut).then(Ye=>Ye.json()).then(Ye=>{if(!Ye.routes||Ye.routes.length===0){console.error("No route found in the response");return}const st=Ye.routes[0].geometry;t.getSource("route")?t.getSource("route").setData(st):t.addLayer({id:"route",type:"line",source:{type:"geojson",data:st},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00FFFF","line-width":5,"line-opacity":.75}});const Mt=new Gm.LngLatBounds().extend([Ue.longitude,Ue.latitude]).extend([Xe.longitude,Xe.latitude]);t.fitBounds(Mt,{padding:50})}).catch(Ye=>{console.error("Error fetching or displaying route:",Ye)})},[t]);W.useEffect(()=>{if($t.currentUser&&t){const Ue=jh(co(vi(yn,"quests"),yi("status","in",["approved","accepted"]),yi("uid","==",$t.currentUser.uid)),Xe=>{const ut=Xe.docs.map(Ye=>({id:Ye.id,...Ye.data()}));Yt(ut),ut.forEach(Ye=>{!Ye.isPublic&&Ye.routeInfo&&Gt(Ye.routeInfo.senderLocation,Ye.routeInfo.receiverLocation)})});return()=>Ue()}},[$t.currentUser,t,Gt]);const Cn=async(Ue,Xe)=>{if(console.log("Approving acceptor:",Xe),!Xe||!Xe.id){console.error("Selected acceptor is not defined or missing id."),Ft("Invalid acceptor data.","error");return}try{const ut=Zn(yn,"quests",Ue),Ye=await $i(ut);if(!Ye.exists()){console.error("Quest document does not exist."),Ft("Quest not found.","error");return}const st=Ye.data(),Mt={...st,pendingAcceptors:Ik(Xe.id),acceptedBy:cy(Xe.id),targetUser:Xe.id,status:"approved"};if($t.currentUser){const an=Zn(yn,"users",$t.currentUser.uid),qt=Zn(yn,"users",Xe.id),[mn,Ln]=await Promise.all([$i(an),$i(qt)]);if(mn.exists()&&Ln.exists()){const fr=mn.data(),fi=Ln.data();fr.location&&fi.location&&(Mt.routeInfo={senderLocation:fr.location,receiverLocation:fi.location})}}await Yi(ut,Mt),J(an=>an.map(qt=>qt.id===Ue?{...qt,...Mt}:qt)),Yt(an=>[...an,{...st,...Mt,id:Ue}]),Mt.routeInfo&&t&&Gt(t,Mt.routeInfo.senderLocation,Mt.routeInfo.receiverLocation),Ft(`Quest approved for ${Xe.name}!`,"success"),ft(!1)}catch(ut){console.error("Error approving acceptor:",ut),Ft("Failed to approve acceptor.","error")}},hn=async Ue=>{try{const Xe=Zn(yn,"quests",Ue);await O1(Xe),J(Z.filter(ut=>ut.id!==Ue)),Yt(Rt.filter(ut=>ut.id!==Ue)),t&&tIe(t),Ft("Quest completed and deleted!","success")}catch(Xe){console.error("Error completing quest:",Xe),Ft("Failed to complete quest.","error")}},Rn=async Ue=>{try{const Xe=Zn(yn,"quests",Ue);await O1(Xe),J(Z.filter(ut=>ut.id!==Ue)),Ft("Quest canceled!","success")}catch(Xe){console.error("Error canceling quest:",Xe),Ft("Failed to cancel quest.","error")}},Nr=async Ue=>{try{const Xe=Zn(yn,"quests",Ue.id),Ye=(await $i(Xe)).data(),st=Ye.acceptedBy||[],Mt=Ye.pendingAcceptors||[],an=await Promise.all(st.map(async mn=>{const Ln=await $i(Zn(yn,"users",mn));return{id:mn,...Ln.data()}})),qt=await Promise.all(Mt.map(async mn=>{const Ln=await $i(Zn(yn,"users",mn));return{id:mn,...Ln.data()}}));Qt({acceptors:an,pendingAcceptors:qt}),zt(Ue),ft(!0)}catch(Xe){console.error("Error fetching acceptors:",Xe),Ft("Failed to fetch acceptors.","error")}},jn=Z.filter(Ue=>{var Xe,ut,Ye,st;return Ue.isPublic?Ue.uid===((Xe=$t.currentUser)==null?void 0:Xe.uid)||Ue.approvedUser===((ut=$t.currentUser)==null?void 0:ut.uid):Ue.targetUser===((Ye=$t.currentUser)==null?void 0:Ye.uid)||Ue.uid===((st=$t.currentUser)==null?void 0:st.uid)}),gr=async(Ue,Xe)=>{try{const ut=Zn(yn,"quests",Ue.id);await Yi(ut,{acceptedBy:Xe.id,pendingAcceptors:[]}),J(Z.map(Ye=>Ye.id===Ue.id?{...Ye,acceptedBy:Xe.id,pendingAcceptors:[]}:Ye)),Qt([]),Ft(`Quest assigned to ${Xe.name}!`,"success")}catch(ut){console.error("Error selecting acceptor:",ut),Ft("Failed to assign quest.","error")}},Fr=()=>{ke(null)},dr=()=>{switch(ht){case"public":return N.jsx("div",{className:"quests-column",children:jn.filter(Ue=>{var Xe;return Ue.isPublic&&(!Ue.declinedBy||!Ue.declinedBy.includes((Xe=$t.currentUser)==null?void 0:Xe.uid))}).length>0?jn.filter(Ue=>{var Xe;return Ue.isPublic&&(!Ue.declinedBy||!Ue.declinedBy.includes((Xe=$t.currentUser)==null?void 0:Xe.uid))}).map(Ue=>{var Ye,st,Mt,an,qt;const ut=(G.find(mn=>mn.id===Ue.uid)||{}).name||"";return N.jsxs("div",{className:"quest-item",children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Title:"})," ",Ue.title]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Description:"})," ",Ue.description]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Time Frame:"})," ",Ue.timeFrame]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Sender:"})," ",ut]}),Ue.isPublic&&((Ye=$t.currentUser)==null?void 0:Ye.uid)!==Ue.uid&&!(Array.isArray(Ue.acceptedBy)&&Ue.acceptedBy.includes((st=$t.currentUser)==null?void 0:st.uid))&&!(Array.isArray(Ue.pendingAcceptors)&&Ue.pendingAcceptors.includes((Mt=$t.currentUser)==null?void 0:Mt.uid))&&N.jsxs("div",{className:"quest-actions",children:[N.jsx("button",{className:"confirm-button",onClick:()=>Qn(Ue),children:"Accept"}),N.jsx("button",{className:"cancel-button",onClick:()=>qn(Ue.id),children:"Decline"})]}),Ue.uid===((an=$t.currentUser)==null?void 0:an.uid)&&N.jsxs("div",{className:"quest-actions",children:[N.jsx("button",{className:"select-button",onClick:()=>Nr(Ue),children:"View Pending Acceptors"}),N.jsx("button",{className:"cancel-button",onClick:()=>Rn(Ue.id),children:"Cancel Quest"})]}),Array.isArray(Ue.acceptedBy)&&Ue.acceptedBy.includes((qt=$t.currentUser)==null?void 0:qt.uid)&&N.jsx("div",{className:"quest-actions",children:N.jsx("button",{className:"confirm-button",onClick:()=>hn(Ue.id),children:"Complete"})})]},Ue.id)}):N.jsx("p",{children:"No public quests."})});case"received":return N.jsx("div",{className:"quests-column",children:Z.filter(Ue=>{var Xe;return Ue.targetUser===((Xe=$t.currentUser)==null?void 0:Xe.uid)&&!Ue.isPublic}).length>0?Z.filter(Ue=>{var Xe;return Ue.targetUser===((Xe=$t.currentUser)==null?void 0:Xe.uid)&&!Ue.isPublic}).map(Ue=>{var Mt,an,qt,mn;const ut=(G.find(Ln=>Ln.id===Ue.uid)||{}).name||"",Ye=Ue.targetUser===((Mt=$t.currentUser)==null?void 0:Mt.uid),st=Ue.uid===((an=$t.currentUser)==null?void 0:an.uid);return N.jsxs("div",{className:"quest-item",children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Title:"})," ",Ue.title]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Description:"})," ",Ue.description]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Time Frame:"})," ",Ue.timeFrame]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Sender:"})," ",ut]}),Ye&&Ue.status==="accepted"&&N.jsxs("div",{className:"quest-actions",children:[N.jsx("button",{className:"confirm-button",onClick:()=>hn(Ue.id),children:"Complete"}),N.jsx("button",{className:"cancel-button",onClick:()=>Rn(Ue.id),children:"Cancel"})]}),Ye&&Ue.status==="pending"&&N.jsxs("div",{className:"quest-actions",children:[N.jsx("button",{className:"confirm-button",onClick:()=>Qn(Ue),children:"Accept"}),N.jsx("button",{className:"cancel-button",onClick:()=>qn(Ue.id),children:"Decline"})]}),st&&N.jsxs("p",{children:["Status: ",Ue.status]}),Ue.acceptedBy&&N.jsxs("div",{children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Accepted By:"})," ",((qt=G.find(Ln=>Ln.id===Ue.acceptedBy))==null?void 0:qt.name)||"Pending acceptance"]}),N.jsx("img",{src:((mn=G.find(Ln=>Ln.id===Ue.acceptedBy))==null?void 0:mn.profilePhotoUrl)||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},Ue.id)}):N.jsx("p",{children:"No received quests."})});case"sent":return N.jsx("div",{className:"quests-column",children:Z.filter(Ue=>{var Xe;return Ue.uid===((Xe=$t.currentUser)==null?void 0:Xe.uid)&&!Ue.isPublic}).length>0?Z.filter(Ue=>{var Xe;return Ue.uid===((Xe=$t.currentUser)==null?void 0:Xe.uid)&&!Ue.isPublic}).map(Ue=>{const Xe=G.find(st=>st.id===Ue.acceptedBy)||{},ut=Xe.name||"",Ye=G.filter(st=>Ue.pendingAcceptors&&Ue.pendingAcceptors.includes(st.id));return N.jsxs("div",{className:"quest-item",children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Title:"})," ",Ue.title]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Description:"})," ",Ue.description]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Time Frame:"})," ",Ue.timeFrame]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Status:"})," ",Ue.status]}),Ye.length>0&&N.jsxs("div",{children:[N.jsx("p",{children:N.jsx("strong",{children:"Pending Acceptors:"})}),N.jsx("ul",{children:Ye.map(st=>N.jsxs("li",{onClick:()=>gr(Ue,st),children:[st.name,N.jsx("img",{src:st.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]},st.id))})]}),Ue.acceptedBy&&N.jsxs("div",{children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Accepted By:"})," ",ut]}),N.jsx("img",{src:Xe.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},Ue.id)}):N.jsx("p",{children:"No sent quests."})});default:return null}},rr=wb(({movement:[,Ue],down:Xe})=>{if(Xe){const ut=window.innerHeight*.5-Ue;Xt(Math.max(100,Math.min(ut,window.innerHeight-60)))}});return xb({height:wt,config:{tension:300,friction:30}}),N.jsx(aA,{children:N.jsxs("div",{className:"quests-page",children:[N.jsx("div",{className:"drag-handle",...rr()}),N.jsx("div",{className:"quests-header",children:N.jsx("h1",{children:"Quests"})}),N.jsxs("div",{className:"tab-container",children:[N.jsx("button",{className:`tab-button ${ht==="public"?"selected":""}`,onClick:()=>At("public"),children:"Public"}),N.jsx("button",{className:`tab-button ${ht==="received"?"selected":""}`,onClick:()=>At("received"),children:"Received"}),N.jsx("button",{className:`tab-button ${ht==="sent"?"selected":""}`,onClick:()=>At("sent"),children:"Sent"})]}),dr(),oe&&X&&N.jsx("div",{className:"modal-overlay",children:N.jsxs("div",{className:"modal confirmation-dialog",children:[N.jsx("h3",{children:"Confirm Quest Sending"}),N.jsx("p",{children:"Are you sure you want to send the quest with the following details?"}),N.jsxs("p",{children:[N.jsx("strong",{children:"Title:"})," ",X.title]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Description:"})," ",X.description]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Time Frame:"})," ",X.timeFrame]}),N.jsxs("div",{className:"modal-actions",children:[N.jsx("button",{className:"confirm-button",onClick:Sn,children:"Confirm"}),N.jsx("button",{className:"cancel-button",onClick:()=>he(!1),children:"Cancel"})]})]})}),be&&N.jsx("div",{className:"modal-overlay",children:N.jsxs("div",{className:"modal profile-popup",children:[N.jsx("button",{className:"close-button",onClick:Fr,children:"X"}),N.jsx("h3",{children:be.name}),N.jsx("img",{src:be.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"profile-pic"}),N.jsxs("p",{children:[N.jsx("strong",{children:"Bio:"})," ",be.bio]})]})}),kt&&N.jsx("div",{className:"modal-overlay",children:N.jsxs("div",{className:"modal acceptors-modal",children:[N.jsx("h3",{children:"Accepted By"}),N.jsx("ul",{children:Ut.acceptors.map((Ue,Xe)=>N.jsx("li",{children:Ue.name},Xe))}),N.jsx("h3",{children:"Pending Acceptors"}),N.jsx("ul",{children:Ut.pendingAcceptors.map((Ue,Xe)=>N.jsx("li",{onClick:()=>Cn(Ee.id,Ue),className:"selectable-user",children:Ue.name},Xe))}),N.jsx("button",{className:"close-button",onClick:()=>ft(!1),children:"Close"})]})})]})})},nIe=({isOpen:e,quests:t,currentUserIds:r,map:s})=>N.jsx("div",{className:`quests-window ${e?"show-section":"hide-section"}`,children:N.jsx(lX,{quests:t,currentUserIds:r,map:s})}),cX={"--background-color":"rgb(33,33,35)","--text-color":"#ffffff","--accent-color":"#0a91ff","--nav-background":"#1a1a1a","--card-background":"#2c2c2c","--hover-color":"#3a3a3a","--border-color":"#333333"},uX={"--background-color":"#f5f5f5","--text-color":"#333333","--accent-color":"#3c68c6","--nav-background":"#ffffff","--card-background":"#ffffff","--hover-color":"#e0e0e0","--border-color":"#e0e0e0"},rIe="mapbox://styles/mapbox/dark-v10",iIe="mapbox://styles/mapbox/light-v10";function w4(e){for(let[t,r]of Object.entries(e))document.documentElement.style.setProperty(t,r)}function hX(e,t){e&&e.setStyle&&e.setStyle(t?iIe:rIe)}function dX(){const e=document.body.classList.toggle("light-mode");w4(e?uX:cX),localStorage.setItem("theme",e?"light":"dark");const r=window.currentMap;hX(r,e),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{isLightMode:e}}))}function fX(){const t=localStorage.getItem("theme")==="light";t?(w4(uX),document.body.classList.add("light-mode")):w4(cX);const r=window.currentMap;hX(r,t)}function T4(){return document.body.classList.contains("light-mode")?"light":"dark"}const sIe="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";Gm.accessToken=sIe;const $8="mapbox://styles/kyim50/clzniqnmq009s01qgee0a13s0",q8="mapbox://styles/mapbox/light-v10",D_=({address:e,setAddress:t,setCurrentUserIds:r,setMap:s,activeSection:c,lockedUser:f,showAddressBar:_,isFullScreen:x})=>{const a=W.useRef(null),I=W.useRef(null),[D,O]=W.useState(!1),[F,Z]=W.useState([]),J=W.useRef({}),re=W.useCallback(()=>{if(!I.current){const ne=JSON.parse(localStorage.getItem("mapState")),G=T4();I.current=new Gm.Map({container:a.current,style:G==="light"?q8:$8,center:(ne==null?void 0:ne.center)||[0,0],zoom:(ne==null?void 0:ne.zoom)||2,attributionControl:!1}),I.current.on("load",()=>{O(!0),s(I.current),window.currentMap=I.current}),I.current.on("moveend",()=>{const Y=I.current.getCenter(),Q=I.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:Y,zoom:Q}))})}},[s]);return W.useEffect(()=>(re(),fX(),()=>{if(I.current){const ne=I.current.getCenter(),G=I.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:ne,zoom:G})),I.current.remove(),I.current=null,window.currentMap=null}}),[re]),W.useEffect(()=>{const ne=G=>{const{isLightMode:Y}=G.detail;I.current&&D&&I.current.setStyle(Y?q8:$8)};return window.addEventListener("themeChanged",ne),()=>{window.removeEventListener("themeChanged",ne)}},[D]),W.useEffect(()=>{let ne;return D&&I.current&&(UTe(I.current,t),ne=wZ(I.current,(G,Y)=>{Z(G),r(G),J.current=Y})),()=>{ne&&ne()}},[D,t,r]),W.useEffect(()=>{if(I.current&&D){const ne=()=>{I.current.resize()};return ne(),window.addEventListener("resize",ne),()=>window.removeEventListener("resize",ne)}},[D,c,x]),W.useEffect(()=>{I.current&&D&&f&&(r4(I.current,f),Object.keys(J.current).forEach(ne=>{const Y=J.current[ne].getElement(),Q=Y.querySelector(".lock-indicator");if(ne===f){if(!Q){const de=document.createElement("div");de.className="lock-indicator",Y.appendChild(de)}}else Q&&Y.removeChild(Q)}))},[D,f]),N.jsxs(N.Fragment,{children:[N.jsx("div",{ref:a,className:`map-placeholder ${x?"full-screen":""}`,style:{width:"100%",height:"100%"}}),_&&N.jsx("div",{className:"address-bar",id:"address-bar",children:e})]})},oIe=({activeSection:e,showSection:t,logo:r,title:s})=>{const c=[{id:"home",icon:"/home.png",label:"Feed"},{id:"profile",icon:"/user-avatar.png",label:"Profile"},{id:"connections",icon:"/happy.png",label:"Connections"},{id:"quests",icon:"/letter.png",label:"Quests"},{id:"privacy",icon:"/privacy1.png",label:"Privacy"}];return N.jsxs("div",{className:"nav-bar",children:[N.jsxs("div",{className:"nav-header",children:[N.jsx("img",{src:r,alt:"Quests Logo",className:"qlogo"}),N.jsx("span",{className:"nav-title",children:s})]}),N.jsx("nav",{children:c.map(f=>N.jsxs("button",{onClick:()=>t(f.id),className:`nav-button ${e===f.id?"active":""}`,children:[N.jsx("img",{src:f.icon,alt:f.label}),N.jsx("span",{children:f.label})]},f.id))})]})},WR="/assets/chatbubble-DDibP9i3.png",pX=({currentUserIds:e,map:t,setLockedUserId:r,lockedUserId:s,lockedUserData:c})=>{const[f,_]=W.useState([]),[x,a]=W.useState([]),[I,D]=W.useState([]),[O,F]=W.useState(null),[Z,J]=W.useState(""),[re,ne]=W.useState(""),[G,Y]=W.useState(null),[Q,de]=W.useState([]),[Te,we]=W.useState(""),[oe,he]=W.useState([]),[X,ge]=W.useState(!1),[be,ke]=W.useState(null),[Ee,zt]=W.useState(null),[Ut,Qt]=W.useState("friends"),[kt,ft]=W.useState(window.innerHeight*.5),Rt=W.useCallback(async()=>{if(!$t.currentUser){console.error("User is not authenticated");return}const Ue=vi(yn,"users"),Xe=co(Ue,yi("isActive","==",!0)),Ye=(await _a(Xe)).docs.map(st=>({id:st.id,...st.data()})).filter(st=>st.id!==$t.currentUser.uid&&!x.some(Mt=>Mt.id===st.id)&&e.includes(st.id));_(Ye)},[x,e]),Yt=W.useCallback(async()=>{if(!$t.currentUser){console.error("User is not authenticated");return}try{const Ue=Zn(yn,"users",$t.currentUser.uid),ut=(await $i(Ue)).data(),Ye=(ut==null?void 0:ut.friends)||[],st=await Promise.all(Ye.map(async Mt=>{const an=Zn(yn,"users",Mt),qt=await $i(an);return{id:Mt,...qt.data()}}));a(st)}catch(Ue){console.error("Error fetching friends:",Ue)}},[]);W.useEffect(()=>{if(!$t.currentUser){console.error("User is not authenticated");return}const Ue=jh(vi(yn,"friend_requests"),async Xe=>{const ut=Xe.docs.map(qt=>({id:qt.id,...qt.data()})),Ye=ut.filter(qt=>qt.status==="pending"&&qt.receiverId===$t.currentUser.uid),Mt=ut.filter(qt=>qt.status==="accepted"&&(qt.senderId===$t.currentUser.uid||qt.receiverId===$t.currentUser.uid)).map(qt=>qt.senderId===$t.currentUser.uid?qt.receiverId:qt.senderId);Yt().then(()=>{a(qt=>qt.filter(mn=>Mt.includes(mn.id)))});const an=await Promise.all(Ye.map(async qt=>{const mn=Zn(yn,"users",qt.senderId),fr=(await $i(mn)).data();return{id:qt.id,senderId:qt.senderId,senderName:(fr==null?void 0:fr.name)||"User",senderPhoto:(fr==null?void 0:fr.profilePhoto)||"default_photo_url"}}));D(an),Rt()});return Yt(),()=>Ue()},[Rt,Yt]);const ht=async Ue=>{if(console.log("Attempting to send friend request to:",Ue),!Ue){console.error("Receiver ID is undefined.");return}try{const Xe=co(vi(yn,"friend_requests"),yi("senderId","==",$t.currentUser.uid),yi("receiverId","==",Ue),yi("status","==","pending"));if(!(await _a(Xe)).empty){console.log("Friend request already exists"),ne("Friend request already exists!");return}await Ex(vi(yn,"friend_requests"),{senderId:$t.currentUser.uid,senderName:$t.currentUser.displayName,senderPhoto:$t.currentUser.photoURL,receiverId:Ue,status:"pending",timestamp:DS()}),ne("Friend request sent!")}catch(Xe){console.error("Error sending friend request:",Xe)}},At=async(Ue,Xe)=>{try{await Yi(Zn(yn,"friend_requests",Ue),{status:"accepted"}),await Yi(Zn(yn,"users",$t.currentUser.uid),{friends:cy(Xe)}),await Yi(Zn(yn,"users",Xe),{friends:cy($t.currentUser.uid)}),ne("Friend request accepted!"),Yt()}catch(ut){console.error("Error accepting friend request:",ut)}},wt=async Ue=>{try{await O1(Zn(yn,"friend_requests",Ue)),ne("Friend request declined!")}catch(Xe){console.error("Error declining friend request:",Xe)}},Xt=async Ue=>{try{await Yi(Zn(yn,"users",$t.currentUser.uid),{friends:Ik(Ue)}),await Yi(Zn(yn,"users",Ue),{friends:Ik($t.currentUser.uid)}),a(Xe=>Xe.filter(ut=>ut.id!==Ue)),ne("Friend removed!")}catch(Xe){console.error("Error removing friend:",Xe)}},Ft=async Ue=>{if(Ee===Ue.id)zt(null),t&&$t.currentUser&&(r4(t,$t.currentUser.uid),setTimeout(()=>t.resize(),300));else{zt(Ue.id);const ut=(await $i(Zn(yn,"users",Ue.id))).data();ut&&ut.location&&t&&(r4(t,Ue.id),setTimeout(()=>t.resize(),300))}},Sn=()=>{F(null)},qn=Ue=>{J(Ue.target.value)},Qn=Ue=>{Y(Ue),hn(Ue.id),Cn(Ue)},Gt=()=>{Y(null),de([])},Cn=Ue=>{he(Xe=>{const ut=Xe.filter(Ye=>Ye.id!==Ue.id);return[Ue,...ut]})},hn=async Ue=>{if(!$t.currentUser){console.error("User is not authenticated");return}const Xe=vi(yn,"messages"),ut=co(Xe,yi("senderId","in",[$t.currentUser.uid,Ue]),yi("receiverId","in",[$t.currentUser.uid,Ue]),Tx("timestamp","desc"),H5(20)),st=(await _a(ut)).docs.map(Mt=>({id:Mt.id,...Mt.data()})).reverse();de(st)},Rn=async()=>{if(Te.trim())try{await Ex(vi(yn,"messages"),{senderId:$t.currentUser.uid,receiverId:G.id,content:Te,timestamp:DS()}),we(""),Cn(G)}catch(Ue){console.error("Error sending message:",Ue)}},Nr=Ue=>{we(Ue.target.value),be&&clearTimeout(be),Yi(Zn(yn,"users",$t.currentUser.uid),{isTyping:!0});const Xe=setTimeout(()=>{Yi(Zn(yn,"users",$t.currentUser.uid),{isTyping:!1})},2e3);ke(Xe)};W.useEffect(()=>{if(G){const Ue=jh(co(vi(yn,"messages"),yi("senderId","in",[$t.currentUser.uid,G.id]),yi("receiverId","in",[$t.currentUser.uid,G.id]),Tx("timestamp")),ut=>{const Ye=ut.docs.map(st=>({id:st.id,...st.data()}));de(Ye)}),Xe=jh(Zn(yn,"users",G.id),ut=>{const Ye=ut.data();Ye&&Ye.isTyping?ge(!0):ge(!1)});return()=>{Ue(),Xe()}}},[G]);const jn=f.filter(Ue=>Ue.name.toLowerCase().includes(Z.toLowerCase())),gr=()=>{if(!Ee)return null;const Ue=f.find(Xe=>Xe.id===Ee)||x.find(Xe=>Xe.id===Ee);return Ue?(x.some(Xe=>Xe.id===Ue.id),N.jsxs("div",{className:"profile-container",children:[N.jsxs("div",{className:"profile-header",children:[N.jsx("div",{className:"profile-photo-container",children:N.jsx("img",{src:Ue.profilePhoto,alt:"Profile",className:"profile-photo"})}),N.jsxs("div",{className:"profile-name-status",children:[N.jsx("h2",{className:"profile-name",children:Ue.name}),N.jsxs("p",{className:"profile-status",children:[N.jsx("span",{className:"status-dot"})," Active"]})]})]}),N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Bio"}),N.jsx("p",{className:"profile-bio",children:Ue.bio||"No bio available"})]}),N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Tags"}),N.jsx("div",{className:"tags-container",children:Ue.tags&&Ue.tags.map(Xe=>N.jsx("div",{className:"tag",children:Xe},Xe))})]}),N.jsxs("div",{className:"profile-actions",children:[N.jsx("button",{className:"add-friend-btn1",onClick:()=>ht(Ue.id),children:"Add Friend"}),N.jsx("button",{className:"chat-btn2",onClick:()=>Qn(Ue),children:N.jsx("img",{src:WR,alt:"Chat",className:"icon-img"})})]}),N.jsx("button",{className:"unlock-btn1",onClick:()=>zt(null),children:"Unlock User"})]})):null},Fr=()=>{switch(Ut){case"friends":return N.jsxs("section",{className:"friends-section",children:[I.length>0&&N.jsx("h2",{children:"Pending"}),I.map(Ue=>N.jsxs("div",{className:"pending-request",children:[N.jsx("img",{src:Ue.senderPhoto,alt:"User"}),N.jsx("div",{children:Ue.senderName}),N.jsxs("div",{className:"button-group",children:[N.jsx("button",{className:"accept-btn",onClick:()=>At(Ue.id,Ue.senderId),children:"Accept"}),N.jsx("button",{className:"decline-btn",onClick:()=>wt(Ue.id),children:"Decline"})]})]},Ue.id)),N.jsx("h2",{children:"All"}),x.map(Ue=>N.jsxs("div",{className:"friend-item1",onClick:()=>Ft(Ue),children:[N.jsx("img",{src:Ue.profilePhoto,alt:"Friend"}),N.jsx("div",{children:Ue.name}),N.jsxs("div",{className:"button-group",children:[N.jsx("button",{className:"remove-friend-btn1",onClick:Xe=>{Xe.stopPropagation(),Xt(Ue.id)},children:"Remove"}),N.jsx("button",{className:"chat-btn1",onClick:Xe=>{Xe.stopPropagation(),Qn(Ue)},children:N.jsx("img",{src:WR,alt:"Chat",className:"icon-img"})})]})]},Ue.id))]});case"pending":return N.jsxs("section",{className:"pending-requests-section",children:[N.jsx("h2",{children:"Pending Requests"}),I.map(Ue=>N.jsxs("div",{className:"pending-request",children:[N.jsx("img",{src:Ue.senderPhoto,alt:"User"}),N.jsx("div",{children:Ue.senderName}),N.jsxs("div",{className:"button-group",children:[N.jsx("button",{className:"accept-btn",onClick:()=>At(Ue.id,Ue.senderId),children:"Accept"}),N.jsx("button",{className:"decline-btn",onClick:()=>wt(Ue.id),children:"Decline"})]})]},Ue.id))]});case"people":return N.jsx("section",{className:"people-section",children:jn.map(Ue=>N.jsxs("div",{className:`people-item ${Ee===Ue.id?"locked":""}`,onClick:()=>Ft(Ue),children:[N.jsx("img",{src:Ue.profilePhoto,alt:"User"}),N.jsx("div",{children:Ue.name}),N.jsxs("div",{className:"button-group",children:[N.jsx("button",{className:"add-friend-btn1",onClick:Xe=>{Xe.stopPropagation(),ht(Ue.id)},children:"Add Friend"}),N.jsx("button",{className:"chat-btn1",onClick:Xe=>{Xe.stopPropagation(),Qn(Ue)},children:N.jsx("img",{src:WR,alt:"Chat",className:"icon-img"})})]})]},Ue.id))});case"recentChats":return N.jsxs("section",{className:"recent-chats-section",children:[N.jsx("h2",{children:"Recent Chats"}),oe.map(Ue=>N.jsxs("div",{className:"chat-history-item",onClick:()=>Qn(Ue),children:[N.jsx("img",{src:Ue.profilePhoto,alt:"Profile"}),N.jsx("div",{children:Ue.name})]},Ue.id))]});default:return null}},dr=wb(({movement:[,Ue],down:Xe})=>{if(Xe){const ut=window.innerHeight*.5-Ue;ft(Math.max(100,Math.min(ut,window.innerHeight-60)))}}),rr=xb({height:kt,config:{tension:300,friction:30}});return N.jsx(aA,{children:N.jsxs("div",{className:`connections-container2 ${Ee?"user-locked1":""}`,style:rr,children:[N.jsx("div",{className:"connections-header",children:N.jsx("h1",{children:"Connections"})}),N.jsx("div",{className:"drag-handle",...dr()}),re&&N.jsx("div",{className:"notification1",children:re}),Ee?gr():N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"tab-container",children:[N.jsx("button",{className:`tab-button ${Ut==="friends"?"active1 selected":""}`,onClick:()=>Qt("friends"),children:"Friends"}),N.jsx("button",{className:`tab-button ${Ut==="people"?"active1 selected":""}`,onClick:()=>Qt("people"),children:"People"}),N.jsx("button",{className:`tab-button ${Ut==="recentChats"?"active1 selected":""}`,onClick:()=>Qt("recentChats"),children:"Chat"})]}),Ut==="people"&&N.jsx("div",{className:"search-bar1",children:N.jsx("input",{type:"text",placeholder:"Search users...",value:Z,onChange:qn})}),Fr()]}),O&&N.jsxs("div",{className:"user-popup1",children:[N.jsx("button",{className:"close-popup1",onClick:Sn,children:""}),N.jsx("img",{src:O.profilePhoto,alt:"Profile"}),N.jsx("div",{children:O.name}),N.jsx("div",{children:O.bio}),N.jsx("button",{className:"view-profile-btn1",onClick:()=>ht(O.id),children:"Add Friend"}),N.jsx("button",{className:"remove-friend-btn1",onClick:()=>Xt(O.id),children:"Remove"})]}),G&&N.jsxs("div",{className:"chat-container1",children:[N.jsxs("div",{className:"chat-header1",children:[N.jsx("button",{className:"back-btn1",onClick:Gt,children:""}),N.jsx("img",{src:G.profilePhoto,alt:"Profile"}),N.jsx("div",{children:G.name})]}),N.jsxs("div",{className:"chat-messages1",children:[Q.map(Ue=>N.jsx("div",{className:`message1 ${Ue.senderId===$t.currentUser.uid?"sent1":"received1"}`,children:N.jsx("div",{children:Ue.content})},Ue.id)),X&&N.jsxs("div",{className:"typing-indicator1",children:[N.jsx("span",{}),N.jsx("span",{}),N.jsx("span",{})]})]}),N.jsxs("div",{className:"chat-input1",children:[N.jsx("input",{type:"text",placeholder:"Type a message...",value:Te,onChange:Nr}),N.jsx("button",{onClick:Rn,children:N.jsx("img",{className:"sendchatimg",src:"sendchat.png",alt:"Send"})})]})]})]})})},aIe=()=>{const[e,t]=W.useState({friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),[r,s]=W.useState([]),[c,f]=W.useState(""),[_,x]=W.useState([]),[a,I]=W.useState(window.innerHeight*.5);W.useEffect(()=>{D()},[]);const D=async()=>{try{const Y=(await $i(Zn(yn,"users",$t.currentUser.uid))).data();t(Y.privacySettings||{friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),s(Y.customVisibilityList||[])}catch(G){console.error("Error fetching privacy settings:",G)}},O=async(G,Y)=>{try{const Q={...e,[G]:Y};t(Q),await Yi(Zn(yn,"users",$t.currentUser.uid),{privacySettings:Q})}catch(Q){console.error("Error updating privacy setting:",Q)}},F=async G=>{if(f(G.target.value),G.target.value.length>2)try{const Y=vi(yn,"users"),Q=co(Y,yi("username",">=",G.target.value),yi("username","<=",G.target.value+"")),Te=(await _a(Q)).docs.map(we=>({id:we.id,...we.data()}));x(Te)}catch(Y){console.error("Error searching users:",Y)}else x([])},Z=async G=>{if(G&&!r.some(Y=>Y.id===G.id)){const Y=[...r,G];s(Y),f(""),x([]);try{await Yi(Zn(yn,"users",$t.currentUser.uid),{customVisibilityList:Y})}catch(Q){console.error("Error updating custom list:",Q)}}},J=async G=>{const Y=r.filter(Q=>Q.id!==G);s(Y);try{await Yi(Zn(yn,"users",$t.currentUser.uid),{customVisibilityList:Y})}catch(Q){console.error("Error updating custom list:",Q)}},re=wb(({movement:[,G],down:Y})=>{if(Y){const Q=window.innerHeight*.5-G;I(Math.max(100,Math.min(Q,window.innerHeight-60)))}}),ne=xb({height:a,config:{tension:300,friction:30}});return N.jsxs(sZ.div,{className:"privacy-container",style:ne,children:[N.jsx("div",{className:"drag-handle",...re()}),N.jsx("h2",{children:"Privacy Settings"}),N.jsxs("div",{className:"privacy-section",children:[N.jsx("h3",{className:"section-title1",children:"Location Visibility"}),N.jsxs("div",{className:"privacy-option",children:[N.jsxs("label",{className:"toggle-switch",children:[N.jsx("input",{type:"checkbox",checked:e.friendsCanSeeLocation,onChange:G=>O("friendsCanSeeLocation",G.target.checked)}),N.jsx("span",{className:"slider round"})]}),N.jsx("span",{children:"Friends can see my location in privacy mode"})]}),N.jsxs("div",{className:"privacy-option",children:[N.jsxs("label",{className:"toggle-switch",children:[N.jsx("input",{type:"checkbox",checked:e.quietMap,onChange:G=>O("quietMap",G.target.checked)}),N.jsx("span",{className:"slider round"})]}),N.jsx("span",{children:"Quiet Map (Hide my location from everyone)"})]}),N.jsxs("div",{className:"privacy-option",children:[N.jsxs("label",{className:"toggle-switch",children:[N.jsx("input",{type:"checkbox",checked:e.canSeeOtherMarkers,onChange:G=>O("canSeeOtherMarkers",G.target.checked)}),N.jsx("span",{className:"slider round"})]}),N.jsx("span",{children:"See other users' markers on the map"})]})]}),N.jsxs("div",{className:"privacy-section",children:[N.jsx("h3",{className:"section-title1",children:"Custom Visibility List"}),N.jsxs("div",{className:"privacy-option",children:[N.jsxs("label",{className:"toggle-switch",children:[N.jsx("input",{type:"checkbox",checked:e.useCustomVisibilityList,onChange:G=>O("useCustomVisibilityList",G.target.checked)}),N.jsx("span",{className:"slider round"})]}),N.jsx("span",{children:"Use Custom Visibility List"})]}),e.useCustomVisibilityList&&N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"search-user",children:[N.jsx("input",{type:"text",value:c,onChange:F,placeholder:"Search users..."}),N.jsx("div",{className:"search-results",children:_.map(G=>N.jsxs("div",{className:"search-result-item",onClick:()=>Z(G),children:[N.jsx("img",{src:G.profilePhoto||"/default-profile.png",alt:G.username,className:"user-avatar"}),N.jsx("span",{children:G.username})]},G.id))})]}),N.jsx("div",{className:"custom-list",children:r.map(G=>N.jsxs("div",{className:"custom-list-item",children:[N.jsx("img",{src:G.profilePhoto||"/default-profile.png",alt:G.username,className:"user-avatar"}),N.jsx("span",{children:G.username}),N.jsx("button",{onClick:()=>J(G.id),children:"Remove"})]},G.id))})]})]})]})},lIe="/assets/notification-bPXQTjjH.png",cIe="/assets/day-and-night-DlaE3U3y.png",G8=Gr.memo(({items:e,onItemClick:t})=>{const r=W.useCallback(s=>{const c=s.split(":").map(Number);return c[0]===c[1]?"square":c[0]*3===c[1]*2?"standard":c[0]*21===c[1]*10?"long":"standard"},[]);return N.jsx("div",{className:"pin-container",children:e.map(s=>{const c=r(s.aspectRatio||"2:3");return N.jsxs("div",{className:"pin-item",children:[N.jsx("div",{className:`card-wrapper pin-${c}`,children:N.jsxs("div",{className:"card",onClick:()=>t(s),children:[N.jsx("div",{className:"card-image-container",children:N.jsx("img",{src:s.image,alt:s.caption||`Photo by ${s.user.name}`,className:"card-image"})}),N.jsx("div",{className:"card-content",children:s.caption&&N.jsx("p",{className:"card-caption",children:s.caption})})]})}),N.jsxs("div",{className:"card-user-info",children:[N.jsx("img",{src:s.user.profilePhoto||"/default-profile-image.jpg",alt:s.user.name,className:"card-user-avatar"}),N.jsx("span",{className:"card-username",children:s.user.name})]})]},s.id)})})}),uIe=Gr.memo(({selectedImage:e,comments:t,onClose:r,onAddComment:s,onDeletePost:c})=>{var a,I,D;const[f,_]=W.useState(""),x=()=>{s(f),_("")};return N.jsx("div",{className:"image-preview-overlay",onClick:r,children:N.jsxs("div",{className:"image-preview-content",onClick:O=>O.stopPropagation(),children:[N.jsx("div",{className:"image-preview-main",children:N.jsx("img",{src:e==null?void 0:e.image,alt:"Preview",className:"preview-image"})}),N.jsxs("div",{className:"image-preview-sidebar",children:[N.jsxs("div",{className:"image-preview-header",children:[N.jsxs("div",{className:"user-info",children:[N.jsx("img",{src:((a=e==null?void 0:e.user)==null?void 0:a.profilePhoto)||"/default-profile-image.jpg",alt:"User",className:"user-avatar"}),N.jsx("span",{className:"username",children:((I=e==null?void 0:e.user)==null?void 0:I.name)||"Unknown User"})]}),N.jsx(IconButton,{onClick:r,className:"close-button",children:N.jsx(Close,{})})]}),N.jsx("div",{className:"quest-info",children:e!=null&&e.questTitle?N.jsx("p",{className:"quest-title",children:e.questTitle}):N.jsx("p",{className:"quest-break",children:"Taking a break from quests"})}),(e==null?void 0:e.caption)&&N.jsx("p",{className:"image-caption",children:e.caption}),N.jsx("div",{className:"comments-section",children:t.map(O=>N.jsxs("div",{className:"comment",children:[N.jsx("img",{src:O.userProfileImage||"/default-profile-image.jpg",alt:O.username,className:"comment-user-avatar"}),N.jsxs("div",{className:"comment-content",children:[N.jsx("strong",{children:O.username}),N.jsx("p",{children:O.text})]})]},O.id))}),N.jsx("div",{className:"add-comment",children:N.jsx(TextField,{value:f,onChange:O=>_(O.target.value),placeholder:"Add a comment...",fullWidth:!0,InputProps:{endAdornment:N.jsx(IconButton,{onClick:x,children:N.jsx(Send,{})})}})}),(e==null?void 0:e.userId)===((D=auth.currentUser)==null?void 0:D.uid)&&N.jsx(Button,{startIcon:N.jsx(Delete,{}),onClick:c,className:"delete-button",children:"Delete Post"})]})]})})}),hIe=({currentUser:e})=>W.useMemo(()=>N.jsxs("div",{className:"profile-display",children:[N.jsx("div",{className:"profile-photo-container",children:N.jsx("img",{src:(e==null?void 0:e.profilePhoto)||"/default-profile-image.jpg",alt:(e==null?void 0:e.name)||"Profile",className:"profile-photo"})}),N.jsxs("div",{className:"profile-name-status",children:[N.jsx("h2",{className:"profile-name",children:(e==null?void 0:e.name)||"Loading..."}),N.jsxs("p",{className:"profile-status",children:[N.jsx("span",{className:"status-dot"}),"Active now"]})]})]}),[e]);Gr.memo(()=>{const[e,t]=W.useState(""),[r,s]=W.useState([]),[c,f]=W.useState("Loading address..."),[_,x]=W.useState(null),[a,I]=W.useState(null),[D,O]=W.useState(null);W.useState(null);const[F,Z]=W.useState("environment"),[J,re]=W.useState(!1),[ne,G]=W.useState(null),[Y,Q]=W.useState(!1),[de,Te]=W.useState(null);W.useState("medium"),W.useState([]);const[we,oe]=W.useState(!1),[he,X]=W.useState(null),[ge,be]=W.useState(""),[ke,Ee]=W.useState([]);W.useState("");const[zt,Ut]=W.useState([]),[Qt,kt]=W.useState(!0),[ft,Rt]=W.useState(null),[Yt,ht]=W.useState(!1),[At,wt]=W.useState([]),[Xt,Ft]=W.useState(!0),[Sn,qn]=W.useState({width:1920,height:1080}),[Qn,Gt]=W.useState([]),[Cn,hn]=W.useState(!1),[Rn,Nr]=W.useState(window.innerHeight*.5),[jn,gr]=W.useState(window.innerWidth<=768),Fr=Qm(),{showNotification:dr}=o0();W.useRef(null);const rr=W.useCallback(async nn=>await uy(nn),[]);W.useEffect(()=>{const nn=$t.onAuthStateChanged(async Jn=>{if(Jn){const ti=await rr(Jn.uid);ti?(Rt({uid:Jn.uid,...ti}),G(ti),Ue(Jn.uid),Xe(Jn.uid)):console.error("User document not found")}else Rt(null),G(null),Gt([]),Ut([]);kt(!1)});return()=>nn()},[rr]),W.useEffect(()=>{const nn=VTe(Fr);return()=>nn()},[Fr]),W.useEffect(()=>{const nn=()=>{gr(window.innerWidth<=768)};return window.addEventListener("resize",nn),()=>window.removeEventListener("resize",nn)},[]),W.useEffect(()=>{const nn=()=>{const Jn=window.innerWidth>=1024;qn(Jn?{width:3840,height:2160}:{width:1920,height:1080})};return nn(),window.addEventListener("resize",nn),()=>window.removeEventListener("resize",nn)},[]);const Ue=W.useCallback(async nn=>{const Jn=Zn(yn,"users",nn),ti=await $i(Jn);if(ti.exists()){const Ts=ti.data().friends||[],Es=await Promise.all(Ts.map(async Ls=>{const $s=Zn(yn,"users",Ls),Lo=await $i($s);if(Lo.exists()){const jr=Lo.data(),Wa=co(vi(yn,"quests"),yi("uid","==",Ls),yi("status","==","accepted")),ni=await _a(Wa);let xi="Idle",Tl=null;if(!ni.empty){const Ta=ni.docs[0].data();if(xi="On a quest",Ta.targetUser){const po=await $i(Zn(yn,"users",Ta.targetUser));po.exists()&&(Tl=po.data())}}return{id:Ls,name:jr.name,username:jr.username,profilePhoto:jr.profilePhoto,status:xi,questPartner:Tl}}return null}));Gt(Es.filter(Ls=>Ls!==null))}},[]),Xe=W.useCallback(async nn=>{if(nn)try{const Jn=Zn(yn,"users",nn),ti=await $i(Jn);if(ti.exists()){const Ts=ti.data().friends||[],Es=vi(yn,"photos"),Ls=co(Es,yi("userId","in",[nn,...Ts]),Tx("timestamp","desc")),$s=await _a(Ls),Lo=await Promise.all($s.docs.map(async jr=>{const Wa=jr.data(),ni=await uy(Wa.userId);return{id:jr.id,...Wa,username:(ni==null?void 0:ni.name)||"Unknown User",user:{name:(ni==null?void 0:ni.name)||"Unknown User",profilePhoto:(ni==null?void 0:ni.profilePhoto)||"/default-profile-image.jpg"}}}));Ut(Lo)}}catch(Jn){console.error("Error fetching grid data:",Jn),dr("Failed to load posts. Please try again.")}},[uy,dr]),ut=W.useCallback(nn=>{t(Jn=>{const ti=nn===Jn?"":nn;return Ft(ti===""||ti==="home"),Q(!1),ti})},[]),Ye=W.useCallback(async nn=>{if(nn)try{const Jn=await rr(nn);Jn?(I(nn),O({id:nn,...Jn}),t("connections"),_&&_.flyTo({center:[Jn.location.longitude,Jn.location.latitude],zoom:15})):console.error("No user found with ID:",nn)}catch(Jn){console.error("Error fetching user data:",Jn)}else if(I(null),O(null),_&&$t.currentUser){const Jn=await rr($t.currentUser.uid);_.flyTo({center:[Jn.location.longitude,Jn.location.latitude],zoom:15})}},[_,rr]),st=W.useCallback(nn=>{Te(nn),re(!1)},[]),Mt=W.useCallback(()=>{Z(nn=>nn==="user"?"environment":"user")},[]),an=W.useCallback(()=>{re(nn=>!nn),hn(nn=>!nn)},[]),qt=W.useCallback(()=>{Q(nn=>{const Jn=!nn;return!Jn&&_&&(ne!=null&&ne.location)&&_.flyTo({center:[ne.location.longitude,ne.location.latitude],zoom:15,duration:2e3}),Jn})},[_,ne]),mn=W.useCallback(nn=>{X(nn),oe(Jn=>!Jn),nn&&Ln(nn.id)},[]),Ln=W.useCallback(async nn=>{const Jn=vi(yn,"photos",nn,"comments"),ti=await _a(Jn),Mi=await Promise.all(ti.docs.map(async Ts=>{const Es=Ts.data(),Ls=await rr(Es.userId);return{id:Ts.id,...Es,userProfileImage:Ls.profilePhoto}}));Ee(Mi)},[rr]),fr=W.useCallback(async nn=>{if(nn.trim()&&he){const Jn=await Ex(vi(yn,"photos",he.id,"comments"),{text:nn,userId:$t.currentUser.uid,username:$t.currentUser.displayName,timestamp:new Date}),ti=await rr($t.currentUser.uid);Ee(Mi=>[...Mi,{id:Jn.id,text:nn,userId:$t.currentUser.uid,username:$t.currentUser.displayName,timestamp:new Date,userProfileImage:ti.profilePhoto}])}},[he,rr]),fi=W.useCallback(async(nn,Jn,ti="")=>{if($t.currentUser&&de)try{const Mi=Zn(vi(yn,"photos")),Ts={id:Mi.id,userId:$t.currentUser.uid,user:{name:$t.currentUser.displayName||"Unknown User",profilePhoto:(ft==null?void 0:ft.profilePhoto)||null},image:de,aspectRatio:Jn,caption:ti,cropInfo:nn,timestamp:DS()};await Em(Mi,Ts),dr("Photo uploaded successfully"),Te(null),be(""),Ut(Es=>[Ts,...Es]),Xe($t.currentUser.uid)}catch(Mi){console.error("Error uploading photo:",Mi),dr("Failed to upload photo. Please try again.")}},[$t.currentUser,de,ft,dr,Xe]),ir=W.useCallback(async()=>{if(he&&he.userId===$t.currentUser.uid)try{await O1(Zn(yn,"photos",he.id)),oe(!1),Ut(nn=>nn.filter(Jn=>Jn.id!==he.id)),dr("Post deleted successfully"),Xe($t.currentUser.uid)}catch(nn){console.error("Error deleting post:",nn),dr("Failed to delete post. Please try again.")}},[he,dr,Xe]),Ci=W.useCallback(()=>ht(nn=>!nn),[]),ss=W.useCallback(()=>wt([]),[]),Tn=wb(({movement:[,nn],down:Jn})=>{if(Jn&&jn){const ti=window.innerHeight*.5-nn;Nr(Math.max(100,Math.min(ti,window.innerHeight-60)))}}),or=xb({height:Rn,config:{tension:300,friction:30}}),dn=W.useCallback(()=>N.jsxs("div",{className:"home-content",children:[N.jsxs("div",{className:"top-bar-old",children:[N.jsx(hIe,{}),N.jsx("div",{className:"top-bar-old-center",children:N.jsx(EH,{className:"search-bar-home",placeholder:"Search...",variant:"outlined",fullWidth:!0,InputProps:{startAdornment:N.jsx(_m,{children:N.jsx(_be,{})})}})}),N.jsxs("div",{className:"top-bar-old-right",children:[N.jsx(_m,{onClick:Ci,children:N.jsx(Qve,{badgeContent:At.length,color:"primary",children:N.jsx("img",{src:lIe,alt:"Notifications",className:"top-bar-old-icon"})})}),N.jsx(_m,{onClick:dX,children:N.jsx("img",{src:cIe,alt:"Toggle Theme",className:"top-bar-old-icon"})})]})]}),N.jsx("div",{className:"section-container",children:N.jsx("div",{className:"friends-list2",children:Qn.map(nn=>N.jsxs("div",{className:"friend-item",children:[N.jsx("div",{className:"friend-photo-container",children:N.jsx("img",{src:nn.profilePhoto||"/default-profile-image.jpg",alt:nn.name,className:"friend-photo"})}),N.jsxs("div",{className:"friend-info",children:[N.jsx("div",{className:"friend-name",children:nn.name}),N.jsxs("div",{className:"friend-username",children:["@",nn.username]}),N.jsxs("div",{className:`friend-status ${nn.status==="Idle"?"idle":"on-quest"}`,children:[nn.status,nn.status==="On a quest"&&nn.questPartner&&N.jsxs("span",{className:"quest-partner",children:["with ",N.jsx("img",{src:nn.questPartner.profilePhoto||"/default-profile-image.jpg",alt:nn.questPartner.name,className:"partner-photo"}),"@",nn.questPartner.username]})]})]})]},nn.id))})}),Yt&&N.jsxs("div",{className:"notifications-dropdown",children:[N.jsx("h3",{children:"Notifications"}),At.map((nn,Jn)=>N.jsx("div",{className:"notification-item",children:nn},Jn)),N.jsx(am,{onClick:ss,children:"Clear All"})]}),N.jsx("div",{className:"main-area",children:jn?N.jsxs("div",{className:"mobile-layout",children:[N.jsx("div",{className:"full-map-container",children:N.jsx(D_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!1,isFullScreen:!0})}),N.jsxs(sZ.div,{className:"draggable-container",style:or,children:[N.jsx("div",{className:"drag-handle",...Tn()}),N.jsxs("div",{className:"mobile-content",children:[N.jsx("div",{className:"camera-button",onClick:an,children:N.jsx(kV,{})}),N.jsxs("div",{className:"section-container",children:[N.jsx("h2",{className:"section-title3",children:"Feed"}),N.jsx(G8,{items:zt,onItemClick:mn})]})]})]})]}):N.jsxs(N.Fragment,{children:[N.jsx("div",{className:"grid-area",children:N.jsxs("div",{className:"section-container",children:[N.jsx("h2",{className:"section-title3",children:"Feed"}),N.jsx(G8,{items:zt,onItemClick:mn})]})}),N.jsx("div",{className:"side-area",children:N.jsxs("div",{className:"section-container",children:[N.jsx("h2",{className:"section-title",children:"Camera & Map"}),N.jsxs("div",{className:"camera-map-area",children:[Cn?N.jsx(CameraComponent,{facingMode:F,toggleCamera:an,handleCapture:st,handleFlipCamera:Mt,isFullScreenCamera:Cn,cameraResolution:Sn}):N.jsxs("div",{className:"camera-placeholder",onClick:an,children:[N.jsx(kV,{}),N.jsx("span",{children:"Open Camera"})]}),N.jsx("div",{className:"mini-map",onClick:qt,children:N.jsx(D_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!1,isFullScreen:!1})})]})]})})]})}),N.jsxs(Abe,{children:[we&&N.jsx(uIe,{selectedImage:he,comments:ke,onClose:()=>oe(!1),onAddComment:fr,onDeletePost:ir}),de&&N.jsx(eIe,{photoPreview:de,onUpload:fi,onCancel:()=>Te(null),currentUser:ft})]})]}),[J,F,an,st,Mt,qt,c,e,a,we,he,ke,fr,ir,de,fi,ft,At,Ci,ss,Sn,Qn,zt,jn,or,Tn]),Js=W.useCallback(()=>N.jsxs("div",{className:"full-map-container",children:[N.jsx(_m,{onClick:qt,className:"back-button",children:N.jsx(SH,{})}),N.jsx(D_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!0,isFullScreen:!0})]}),[qt,c,e,a]),Ai=W.useCallback(async()=>{try{await TZ(),dr("Logged out successfully"),Fr("/login")}catch(nn){console.error("Logout failed:",nn),dr("Logout failed. Please try again.")}},[dr,Fr]),fo=W.useCallback(()=>{const nn=Xt?dn():N.jsx("div",{className:`section-content ${jn?"mobile-section":""}`,children:(()=>{switch(e){case"profile":return N.jsx(aX,{handleLogout:Ai});case"quests":return N.jsx(nIe,{currentUserIds:r,map:_});case"connections":return N.jsx(pX,{currentUserIds:r,map:_,setLockedUser:Ye,lockedUser:a,lockedUserData:D});case"privacy":return N.jsx(aIe,{});default:return null}})()});return jn&&!Xt?N.jsxs("div",{className:"mobile-section-with-map",children:[N.jsx("div",{className:"mobile-map-container",children:N.jsx(D_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!1,isFullScreen:!1})}),N.jsx("div",{className:"mobile-section-content",children:nn})]}):nn},[e,Xt,r,_,Ye,a,D,dn,Ai,jn,c]),wa=W.useCallback(()=>Xt?"home-active":e==="profile"||e==="privacy"?`${e}-active`:e==="connections"?a?"connections-locked-active":"connections-active":e?`${e}-active`:"",[e,a,Xt]);return W.useEffect(()=>{Xt&&x(null)},[Xt]),N.jsxs("div",{className:`home-screen-container2 ${jn?"mobile-view":""}`,children:[N.jsx(oIe,{activeSection:e,showSection:ut,logo:"Questslogo blue.png",title:"QUESTS"}),jn&&N.jsx("nav",{className:"mobile-nav-bar-container",children:N.jsxs("nav",{className:"mobile-nav-bar",children:[N.jsx("a",{href:"#home",className:`mobile-nav-button ${e===""?"active":""}`,onClick:()=>ut(""),children:N.jsx("img",{src:"home.png",alt:"Home"})}),N.jsx("a",{href:"#profile",className:`mobile-nav-button ${e==="profile"?"active":""}`,onClick:()=>ut("profile"),children:N.jsx("img",{src:"user-avatar.png",alt:"Profile"})}),N.jsx("a",{href:"#connections",className:`mobile-nav-button ${e==="connections"?"active":""}`,onClick:()=>ut("connections"),children:N.jsx("img",{src:"happy.png",alt:"Connections"})}),N.jsx("a",{href:"#quests",className:`mobile-nav-button ${e==="quests"?"active":""}`,onClick:()=>ut("quests"),children:N.jsx("img",{src:"letter.png",alt:"Quests"})}),N.jsx("a",{href:"#privacy",className:`mobile-nav-button ${e==="privacy"?"active":""}`,onClick:()=>ut("privacy"),children:N.jsx("img",{src:"privacy1.png",alt:"Privacy"})})]})}),N.jsxs("div",{className:`main-content2 ${wa()}`,children:[Y?Js():fo(),!Xt&&!Y&&!jn&&N.jsx("div",{className:"map-container2",children:N.jsx(D_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!0,isFullScreen:!1})})]})]})});const W8=()=>{const{notifications:e}=o0();return N.jsx("div",{className:"notification-container",children:e.map(t=>N.jsx("div",{className:`notification ${t.type} ${t.show?"show":"hide"}`,children:t.message},t.id))})};function dIe(){return N.jsxs("div",{className:"landing-page",children:[N.jsx("header",{className:"landing-header",children:N.jsx("img",{src:"Quests Logo.png",alt:"Quests Logo",className:"logo"})}),N.jsxs("main",{className:"landing-main",children:[N.jsxs("div",{className:"headline",children:["Connect ",N.jsx("span",{className:"Today",children:"Today"})]}),N.jsx("h1",{className:"mainheadline",children:"Promoting daily connections & making networking easier than ever"}),N.jsx("p",{className:"subtext",children:"Quests makes networking easy by encouraging you to connect with nearby individuals, helping you build meaningful relationships effortlessly and fostering stronger communities."}),N.jsx("button",{className:"login-button",onClick:()=>window.location.href="/login",children:"Get Started"})]}),N.jsxs("section",{className:"Functions",children:[N.jsx("h2",{className:"Functionsh1",children:"Functions"}),N.jsx("div",{className:"functions-container",children:[{icon:"profile_hover.png",title:"Create a profile",text:"Express yourself and give others insight to who you are by uploading a profile photo, creating a bio, showing your current status and more. You can choose to make your account public or private"},{icon:"connections_hover.png",title:"Make a friend",text:"You can search for existing users who you may know, add someone you went on a quest with as a friend, view your friend's profile and so much more."},{icon:"quest_hover.png",title:"Go on a quest",text:"Using built in map functions and interactive social features to allow you to create public or private quests which you can accept, decline, complete, and view current quests."},{icon:"privacy.png",title:"Privacy & Security",text:"We ensure you and your data are safe and sound. Once your account is private, you won't be seen by and can't see people nearby unless they are a friend. Additionally, there is an SOS feature that alerts nearby personnel that you are in danger or in need of help."},{icon:"history_hover.png",title:"History",text:"Keep track of previous quests and specific details of that quest such as the location, date, time and who you went on that quest with."},{icon:"feed.png",title:"Photo Feed",text:"Look at pictures from quests your friends are currently on and take pictures of your own. Like and leave a message on your friends' pictures."}].map((e,t)=>N.jsxs("div",{className:"function-box",children:[N.jsx("div",{className:"functionicon",children:N.jsx("img",{src:e.icon,alt:e.title})}),N.jsx("div",{className:"functionrectheader",children:e.title.split(" ").map((r,s)=>s===e.title.split(" ").length-1?N.jsx("span",{children:r},s):r+" ")}),N.jsx("div",{className:"functiontext",children:e.text})]},t))})]}),N.jsx("footer",{className:"landing-footer",children:N.jsx("p",{children:" 2024 Quests. All rights reserved."})})]})}const mX=W.createContext(),gX=()=>W.useContext(mX),fIe=({children:e})=>{const[t,r]=W.useState(null),[s,c]=W.useState(!0);return W.useEffect(()=>{const f=$t.onAuthStateChanged(async _=>{if(_){const x=await uy(_.uid);console.log("Fetched user data:",x),r(x)}else r(null);c(!1)});return()=>f()},[]),N.jsx(mX.Provider,{value:t,children:s?N.jsx("div",{}):e})},pIe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M202.87-520q-37.54 0-64.27-26.73-26.73-26.73-26.73-64.27v-146.13q0-37.54 26.73-64.27 26.73-26.73 64.27-26.73H349q37.54 0 64.27 26.73Q440-794.67 440-757.13V-611q0 37.54-26.73 64.27Q386.54-520 349-520H202.87Zm0 408.13q-37.54 0-64.27-26.73-26.73-26.73-26.73-64.27V-349q0-37.54 26.73-64.27Q165.33-440 202.87-440H349q37.54 0 64.27 26.73Q440-386.54 440-349v146.13q0 37.54-26.73 64.27-26.73 26.73-64.27 26.73H202.87ZM611-520q-37.54 0-64.27-26.73Q520-573.46 520-611v-146.13q0-37.54 26.73-64.27 26.73-26.73 64.27-26.73h146.13q37.54 0 64.27 26.73 26.73 26.73 26.73 64.27V-611q0 37.54-26.73 64.27Q794.67-520 757.13-520H611Zm0 408.13q-37.54 0-64.27-26.73Q520-165.33 520-202.87V-349q0-37.54 26.73-64.27Q573.46-440 611-440h146.13q37.54 0 64.27 26.73 26.73 26.73 26.73 64.27v146.13q0 37.54-26.73 64.27-26.73 26.73-64.27 26.73H611ZM202.87-611H349v-146.13H202.87V-611ZM611-611h146.13v-146.13H611V-611Zm0 408.13h146.13V-349H611v146.13Zm-408.13 0H349V-349H202.87v146.13ZM611-611Zm0 262Zm-262 0Zm0-262Z"})),mIe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M479.94-258.09q75.78 0 128.88-53.04 53.09-53.04 53.09-128.81 0-75.78-53.04-128.88-53.04-53.09-128.81-53.09-75.78 0-128.88 53.04-53.09 53.04-53.09 128.81 0 75.78 53.04 128.88 53.04 53.09 128.81 53.09Zm.06-86.21q-40.33 0-68.01-27.69Q384.3-399.67 384.3-440q0-40.33 27.69-68.01Q439.67-535.7 480-535.7q40.33 0 68.01 27.69Q575.7-480.33 575.7-440q0 40.33-27.69 68.01Q520.33-344.3 480-344.3ZM162.87-111.87q-37.78 0-64.39-26.61t-26.61-64.39v-474.26q0-37.78 26.61-64.39t64.39-26.61H281.7l50.47-52.33q12.44-12.95 29.61-20.31 17.18-7.36 35.61-7.36h165.22q18.43 0 35.61 7.36 17.17 7.36 29.61 20.31l50.47 52.33h118.83q37.78 0 64.39 26.61t26.61 64.39v474.26q0 37.78-26.61 64.39t-64.39 26.61H162.87Zm0-91h634.26v-474.26H638.72l-75.63-80H397.63l-77.06 80h-157.7v474.26ZM480-440Z"})),gIe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M412.84-170.87q44.64-90.04 118.93-120.42 74.29-30.38 126.8-30.38 22.52 0 44.52 4 22 4 42.77 10 23.75-37.53 37.63-81.22 13.88-43.69 13.88-91.35 0-132.56-92.28-224.73-92.29-92.16-224.85-92.16-132.57 0-224.85 92.16-92.28 92.17-92.28 224.73 0 44.75 11.5 85.52 11.5 40.76 34.02 75.05 40.76-19.76 84.28-30.65 43.52-10.88 88.29-10.88 31.52 0 60.9 5.5t57.9 14.5q-22.76 12.24-43.14 27.88-20.38 15.65-38.38 33.65-12.48-2-20.38-2h-16.9q-32 0-63.15 6.88-31.14 6.88-59.9 20.88 31.52 31.52 70.78 52.78 39.27 21.26 83.91 30.26Zm67.4 99q-84.65 0-159.1-32.1-74.44-32.1-129.64-87.29-55.2-55.2-87.29-129.65-32.1-74.46-32.1-159.11 0-84.65 32.1-159.09 32.09-74.43 87.29-129.63 55.2-55.19 129.65-87.29 74.46-32.1 159.11-32.1 84.65 0 158.97 32.1 74.31 32.1 129.51 87.29 55.19 55.2 87.29 129.65 32.1 74.46 32.1 159.11 0 84.65-32.1 159.09-32.1 74.43-87.29 129.63-55.2 55.19-129.57 87.29-74.37 32.1-158.93 32.1ZM381.2-420.48q-57.77 0-98.41-40.64-40.64-40.64-40.64-98.4 0-57.76 40.64-98.28 40.64-40.53 98.41-40.53 57.76 0 98.28 40.53Q520-617.28 520-559.52t-40.52 98.4q-40.52 40.64-98.28 40.64Zm0-79.52q24.52 0 41.9-17.5t17.38-42.02q0-24.52-17.38-41.9t-41.9-17.38q-24.53 0-42.03 17.38t-17.5 41.9q0 24.52 17.5 42.02 17.5 17.5 42.03 17.5Zm277.66 119.04q-41.58 0-70.46-28.7-28.88-28.71-28.88-70.29 0-41.57 28.88-70.33 28.88-28.76 70.46-28.76 41.57 0 70.28 28.7 28.71 28.71 28.71 70.29 0 41.57-28.71 70.33-28.71 28.76-70.28 28.76ZM480.24-480Z"})),_Ie=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M320-148.52q-37.78 0-64.39-26.61T229-239.52v-77.13q0-19.15 13.17-32.33 13.18-13.17 32.33-13.17h77.37v-90q-29.04-2.72-57.47-13.34-28.42-10.62-50.42-30.9-6.48-6.24-9.98-14.1-3.5-7.86-3.5-16.34v-25.08h-25.65q-9.2 0-17.53-3.48-8.34-3.48-15.06-10.2l-88.8-88.8q-12.48-12.48-12.48-29.44 0-16.95 12.72-29.43 31.15-29 78.95-42.62 47.81-13.62 89.76-13.62 25.33 0 49.87 3.88 24.55 3.88 49.59 13.92 0-25.15 17.43-42.58 17.44-17.44 42.59-17.44h345.24q37.78 0 64.39 26.61t26.61 64.39v444.07q0 53.11-37.51 90.62-37.51 37.51-90.62 37.51H320Zm122.87-213.63h194.5q19.15 0 32.33 13.17 13.17 13.18 13.17 32.33v40q0 15.8 10.66 26.47 10.67 10.66 26.47 10.66 15.8 0 26.47-10.66 10.66-10.67 10.66-26.47v-444.07H442.87V-696l219.91 220.15q9.48 9.48 11.6 21.7 2.12 12.22-2.88 23.45-5 11.24-14.6 18.22-9.6 6.98-24.07 6.98-8.48 0-16.22-3.5-7.74-3.5-13.22-8.98l-96.98-97.22-6.56 6.57q-13.05 13.04-27.23 23.45-14.19 10.4-29.75 16.16v106.87ZM221.13-635.5h47.46q19.15 0 32.32 13.17 13.18 13.18 13.18 32.33v41.22q11.52 7.28 24.28 10.28 12.76 3 26.04 3 22.29 0 40.43-6.88t35.18-23.92l7.28-7.29-54.32-54.56q-29-29-64.52-43.38-35.53-14.38-76.05-14.38-19.04 0-36.2 2.76-17.17 2.76-34.21 8.52l39.13 39.13Zm370.74 356.93H320v39.05h277.87q-3-8.76-4.5-18.4-1.5-9.65-1.5-20.65ZM320-239.52v-39.05 39.05Z"}));function yIe(){const[e,t]=W.useState("/home"),r=gX();return N.jsx("div",{className:"navigation-bar-container",children:N.jsxs("div",{className:"navigation-bar",children:[N.jsx(s,{link:"/home",children:N.jsx(pIe,{})}),N.jsx(s,{link:"camera",children:N.jsx(mIe,{})}),N.jsx(s,{link:"profile",replace:!0,children:N.jsx("div",{className:"profile-icon",children:N.jsx("img",{src:(r==null?void 0:r.profilePhoto)||"/default-profile-image.jpg",alt:(r==null?void 0:r.name)||"User Profile",className:"profile-photo"})})}),N.jsx(s,{link:"connections",replace:!0,children:N.jsx(gIe,{})}),N.jsx(s,{link:"quests",replace:!0,children:N.jsx(_Ie,{})})]})});function s({link:c,children:f,replace:_=!1}){return N.jsx(jne,{end:!0,className:({isActive:x})=>`navigation-bar-button ${x?"selected":""}`,id:c,to:c,replace:_,onClick:()=>t(c),children:f})}}function H8({id:e,imageUrl:t,aspectRatio:r,time:s,user:c,description:f,comments:_,onAddComment:x}){const[a,I]=W.useState(!1),[D,O]=W.useState(""),F=()=>{I(!a)},Z=Y=>{Y.stopPropagation()},J=Y=>{Y.preventDefault(),D.trim()&&(x(e,D),O(""))},[re,ne]=r?r.split(":").map(Number):[1,1];let G=re/ne;return r==="16:9"&&(G=9/16),N.jsx("div",{className:`quest-card ${a?"expanded":""}`,onClick:F,children:N.jsxs("div",{className:"quest-card-inner",children:[N.jsxs("div",{className:"quest-card-content",style:{backgroundImage:`url(${t})`,aspectRatio:G},children:[N.jsx("div",{className:"header",children:N.jsx("div",{className:"time",children:s})}),N.jsxs("div",{className:"footer",children:[N.jsx("p",{className:"user",children:c}),N.jsx("p",{className:"description",children:f})]})]}),a&&N.jsxs("div",{className:"comments-section",onClick:Z,children:[N.jsx("h3",{children:"Comments"}),N.jsx("div",{className:"comments-list",children:_.map((Y,Q)=>N.jsxs("div",{className:"comment",children:[N.jsx("img",{src:Y.userPhoto,alt:Y.userName,className:"user-photo"}),N.jsxs("div",{className:"comment-content",children:[N.jsx("p",{className:"comment-user",children:Y.userName}),N.jsx("p",{className:"comment-text",children:Y.text})]})]},Q))}),N.jsxs("form",{className:"add-comment",onSubmit:J,children:[N.jsx("input",{type:"text",value:D,onChange:Y=>O(Y.target.value),placeholder:"Add a comment..."}),N.jsx("button",{type:"submit",children:"Post"})]})]})]})})}function vIe(){const[e,t]=W.useState([]);W.useEffect(()=>{const f=vi(yn,"quests"),_=co(f,Tx("createdAt","desc"),H5(20)),x=jh(_,a=>{const I=a.docs.map(D=>({id:D.id,...D.data(),comments:D.data().comments||[]}));t(I)});return()=>x()},[]);const r=async(f,_)=>{try{const x=Zn(yn,"quests",f);await Yi(x,{comments:cy({userName:"Current User",userPhoto:"https://example.com/user-photo.jpg",text:_,createdAt:new Date})})}catch(x){console.error("Error adding comment:",x)}},s=[{aspectRatio:"3:4"},{aspectRatio:"9:16"},{aspectRatio:"1:1"},{aspectRatio:"3:4"},{aspectRatio:"1:1"},{aspectRatio:"9:16"},{aspectRatio:"1:1"},{aspectRatio:"1:1"},{aspectRatio:"9:16"},{aspectRatio:"3:4"},{aspectRatio:"9:16"}],c=[...e,...s];return c.sort(()=>Math.random()-.5),N.jsx("div",{className:"feed",children:c.map((f,_)=>f.id?N.jsx(H8,{id:f.id,imageUrl:f.imageUrl,aspectRatio:f.aspectRatio,time:f.time,user:f.user,description:f.description,comments:f.comments,onAddComment:r},f.id):N.jsx(H8,{imageUrl:"https://media.tenor.com/o_5RQarGvJ0AAAAM/kiss.gif",aspectRatio:f.aspectRatio,time:"8:08 PM",user:"Kiity :3",description:"I am cat and i love yuu",comments:[],onAddComment:()=>{}},`dummy-${_}`))})}const _X=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M472-480 332-620q-18-18-18-44t18-44q18-18 44-18t44 18l183 183q9 9 14 21t5 24q0 12-5 24t-14 21L420-252q-18 18-44 18t-44-18q-18-18-18-44t18-44l140-140Z"}));function yX({small:e=!1}){const[t,r]=W.useState("Loading address..."),[s,c]=W.useState([]),[f,_]=W.useState(null),[x,a]=W.useState(""),[I,D]=W.useState(null),[O,F]=W.useState(!1);return N.jsxs("div",{className:`map-container ${e?"small":""} ${O?"full-screen":""}`,onClick:()=>{!O&&F(!0)},children:[N.jsx(D_,{address:t,setAddress:r,setCurrentUserIds:c,setMap:_,activeSection:x,lockedUser:I,showAddressBar:!1,isFullScreen:O}),O&&N.jsx("button",{className:"full-screen-toggle",onClick:()=>F(!1),"aria-label":O?"Exit full screen":"Enter full screen",children:N.jsx(_X,{})})]})}function xIe({ref:e,show:t}){return N.jsx("div",{className:"top-bar-container",style:{opacity:t?1:0},children:N.jsxs("div",{className:"top-bar",children:[N.jsx(M4,{small:!0}),N.jsx(D4,{small:!0}),N.jsx(k4,{small:!0}),N.jsx(yX,{small:!0})]})})}const bIe=({isOpen:e,onClose:t})=>{const[r,s]=W.useState(""),[c,f]=W.useState(""),[_,x]=W.useState(""),[a,I]=W.useState(!1),[D,O]=W.useState(""),[F,Z]=W.useState(null),[J,re]=W.useState([]),[ne,G]=W.useState([]),{showNotification:Y}=o0();W.useEffect(()=>{(async()=>{const X=vi(yn,"users"),be=(await _a(X)).docs.map(ke=>({id:ke.id,...ke.data()}));re(be)})()},[]),W.useEffect(()=>{if(D){const he=J.filter(X=>X.name.toLowerCase().includes(D.toLowerCase()));G(he)}else G([])},[D,J]);const Q=async()=>{if(!$t.currentUser){Y("You must be logged in to create a quest.","error");return}if(!r||!c||!_){Y("Please fill in all fields.","error");return}if(!a&&!F){Y("Please select a user for private quest.","error");return}try{const he={uid:$t.currentUser.uid,title:r,description:c,timeFrame:_,createdAt:DS(),isPublic:a,targetUser:a?null:F.id,status:"pending",acceptedBy:a?[]:null};await Ex(vi(yn,"quests"),he),Y("Quest created successfully!","success"),oe(),t()}catch(he){console.error("Error creating quest:",he),Y("Failed to create quest.","error")}},de=()=>{I(!a),Z(null),O("")},Te=he=>{he.target.value.split(/\s+/).length<=300&&f(he.target.value)},we=he=>{Z(he),O("")},oe=()=>{s(""),f(""),x(""),I(!1),O(""),Z(null)};return e?N.jsx("div",{className:"modal-overlay",children:N.jsx("div",{className:"quest-popup",children:N.jsxs("div",{className:"modal-content",children:[N.jsxs("div",{className:"modal-header",children:[N.jsx("svg",{onClick:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:N.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})}),N.jsx("h2",{children:"Create a New Quest"})]}),N.jsxs("div",{className:"input-group",children:[N.jsx("label",{htmlFor:"quest-title",children:"Title"}),N.jsx("input",{id:"quest-title",type:"text",placeholder:"Enter quest title",value:r,onChange:he=>s(he.target.value),className:"profile-input"})]}),N.jsxs("div",{className:"input-group",children:[N.jsx("label",{htmlFor:"quest-description",children:"Description"}),N.jsx("textarea",{id:"quest-description",placeholder:"Enter quest description",value:c,onChange:Te,className:"profile-bio-edit"})]}),N.jsxs("div",{className:"input-group",children:[N.jsx("label",{htmlFor:"quest-timeframe",children:"Time Frame"}),N.jsxs("select",{id:"quest-timeframe",value:_,onChange:he=>x(he.target.value),className:"profile-input",children:[N.jsx("option",{value:"",children:"Select Time Frame"}),N.jsx("option",{value:"5 mins",children:"5 mins"}),N.jsx("option",{value:"10 mins",children:"10 mins"}),N.jsx("option",{value:"15 mins",children:"15 mins"}),N.jsx("option",{value:"30 mins",children:"30 mins"}),N.jsx("option",{value:"1 hour",children:"1 hour"})]})]}),N.jsxs("div",{className:"toggle-container",children:[N.jsx("p",{children:"Public Quest"}),N.jsxs("label",{className:"switch",children:[N.jsx("input",{type:"checkbox",checked:a,onChange:de}),N.jsx("span",{className:"slider"})]})]}),!a&&N.jsxs("div",{className:"user-search-container",children:[N.jsx("input",{type:"text",placeholder:"Search users...",value:D,onChange:he=>O(he.target.value),className:"user-search-input"}),D&&ne.length>0&&N.jsx("div",{className:"user-search-results",children:ne.map(he=>N.jsxs("div",{className:"user-search-result",onClick:()=>we(he),children:[N.jsx("img",{src:he.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"}),he.name]},he.id))}),F&&N.jsx("div",{className:"selected-user",children:N.jsxs("p",{children:["Selected User: ",F.name]})})]}),N.jsxs("div",{className:"modal-actions",children:[N.jsx("button",{className:"cancel-button",onClick:t,children:"Cancel"}),N.jsx("button",{className:"create-quest-button",onClick:Q,children:"Create Quest"})]})]})})}):null};var Ba=function(){return Ba=Object.assign||function(t){for(var r,s=1,c=arguments.length;s<c;s++){r=arguments[s];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(t[f]=r[f])}return t},Ba.apply(this,arguments)};function iI(e,t,r){if(r||arguments.length===2)for(var s=0,c=t.length,f;s<c;s++)(f||!(s in t))&&(f||(f=Array.prototype.slice.call(t,0,s)),f[s]=t[s]);return e.concat(f||Array.prototype.slice.call(t))}var Xi="-ms-",G1="-moz-",_i="-webkit-",vX="comm",lA="rule",iL="decl",wIe="@import",xX="@keyframes",TIe="@layer",bX=Math.abs,sL=String.fromCharCode,E4=Object.assign;function EIe(e,t){return bo(e,0)^45?(((t<<2^bo(e,0))<<2^bo(e,1))<<2^bo(e,2))<<2^bo(e,3):0}function wX(e){return e.trim()}function Ah(e,t){return(e=t.exec(e))?e[0]:e}function zr(e,t,r){return e.replace(t,r)}function LE(e,t,r){return e.indexOf(t,r)}function bo(e,t){return e.charCodeAt(t)|0}function jy(e,t,r){return e.slice(t,r)}function Au(e){return e.length}function TX(e){return e.length}function g1(e,t){return t.push(e),e}function SIe(e,t){return e.map(t).join("")}function Z8(e,t){return e.filter(function(r){return!Ah(r,t)})}var cA=1,Uy=1,EX=0,Yl=0,Ks=0,l0="";function uA(e,t,r,s,c,f,_,x){return{value:e,root:t,parent:r,type:s,props:c,children:f,line:cA,column:Uy,length:_,return:"",siblings:x}}function tf(e,t){return E4(uA("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function A_(e){for(;e.root;)e=tf(e.root,{children:[e]});g1(e,e.siblings)}function IIe(){return Ks}function CIe(){return Ks=Yl>0?bo(l0,--Yl):0,Uy--,Ks===10&&(Uy=1,cA--),Ks}function Uc(){return Ks=Yl<EX?bo(l0,Yl++):0,Uy++,Ks===10&&(Uy=1,cA++),Ks}function Am(){return bo(l0,Yl)}function zE(){return Yl}function hA(e,t){return jy(l0,e,t)}function S4(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function AIe(e){return cA=Uy=1,EX=Au(l0=e),Yl=0,[]}function PIe(e){return l0="",e}function HR(e){return wX(hA(Yl-1,I4(e===91?e+2:e===40?e+1:e)))}function RIe(e){for(;(Ks=Am())&&Ks<33;)Uc();return S4(e)>2||S4(Ks)>3?"":" "}function MIe(e,t){for(;--t&&Uc()&&!(Ks<48||Ks>102||Ks>57&&Ks<65||Ks>70&&Ks<97););return hA(e,zE()+(t<6&&Am()==32&&Uc()==32))}function I4(e){for(;Uc();)switch(Ks){case e:return Yl;case 34:case 39:e!==34&&e!==39&&I4(Ks);break;case 40:e===41&&I4(e);break;case 92:Uc();break}return Yl}function kIe(e,t){for(;Uc()&&e+Ks!==57;)if(e+Ks===84&&Am()===47)break;return"/*"+hA(t,Yl-1)+"*"+sL(e===47?e:Uc())}function DIe(e){for(;!S4(Am());)Uc();return hA(e,Yl)}function OIe(e){return PIe(NE("",null,null,null,[""],e=AIe(e),0,[0],e))}function NE(e,t,r,s,c,f,_,x,a){for(var I=0,D=0,O=_,F=0,Z=0,J=0,re=1,ne=1,G=1,Y=0,Q="",de=c,Te=f,we=s,oe=Q;ne;)switch(J=Y,Y=Uc()){case 40:if(J!=108&&bo(oe,O-1)==58){LE(oe+=zr(HR(Y),"&","&\f"),"&\f",bX(I?x[I-1]:0))!=-1&&(G=-1);break}case 34:case 39:case 91:oe+=HR(Y);break;case 9:case 10:case 13:case 32:oe+=RIe(J);break;case 92:oe+=MIe(zE()-1,7);continue;case 47:switch(Am()){case 42:case 47:g1(LIe(kIe(Uc(),zE()),t,r,a),a);break;default:oe+="/"}break;case 123*re:x[I++]=Au(oe)*G;case 125*re:case 59:case 0:switch(Y){case 0:case 125:ne=0;case 59+D:G==-1&&(oe=zr(oe,/\f/g,"")),Z>0&&Au(oe)-O&&g1(Z>32?K8(oe+";",s,r,O-1,a):K8(zr(oe," ","")+";",s,r,O-2,a),a);break;case 59:oe+=";";default:if(g1(we=X8(oe,t,r,I,D,c,x,Q,de=[],Te=[],O,f),f),Y===123)if(D===0)NE(oe,t,we,we,de,f,O,x,Te);else switch(F===99&&bo(oe,3)===110?100:F){case 100:case 108:case 109:case 115:NE(e,we,we,s&&g1(X8(e,we,we,0,0,c,x,Q,c,de=[],O,Te),Te),c,Te,O,x,s?de:Te);break;default:NE(oe,we,we,we,[""],Te,0,x,Te)}}I=D=Z=0,re=G=1,Q=oe="",O=_;break;case 58:O=1+Au(oe),Z=J;default:if(re<1){if(Y==123)--re;else if(Y==125&&re++==0&&CIe()==125)continue}switch(oe+=sL(Y),Y*re){case 38:G=D>0?1:(oe+="\f",-1);break;case 44:x[I++]=(Au(oe)-1)*G,G=1;break;case 64:Am()===45&&(oe+=HR(Uc())),F=Am(),D=O=Au(Q=oe+=DIe(zE())),Y++;break;case 45:J===45&&Au(oe)==2&&(re=0)}}return f}function X8(e,t,r,s,c,f,_,x,a,I,D,O){for(var F=c-1,Z=c===0?f:[""],J=TX(Z),re=0,ne=0,G=0;re<s;++re)for(var Y=0,Q=jy(e,F+1,F=bX(ne=_[re])),de=e;Y<J;++Y)(de=wX(ne>0?Z[Y]+" "+Q:zr(Q,/&\f/g,Z[Y])))&&(a[G++]=de);return uA(e,t,r,c===0?lA:x,a,I,D,O)}function LIe(e,t,r,s){return uA(e,t,r,vX,sL(IIe()),jy(e,2,-2),0,s)}function K8(e,t,r,s,c){return uA(e,t,r,iL,jy(e,0,s),jy(e,s+1,-1),s,c)}function SX(e,t,r){switch(EIe(e,t)){case 5103:return _i+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return _i+e+e;case 4789:return G1+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return _i+e+G1+e+Xi+e+e;case 5936:switch(bo(e,t+11)){case 114:return _i+e+Xi+zr(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return _i+e+Xi+zr(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return _i+e+Xi+zr(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return _i+e+Xi+e+e;case 6165:return _i+e+Xi+"flex-"+e+e;case 5187:return _i+e+zr(e,/(\w+).+(:[^]+)/,_i+"box-$1$2"+Xi+"flex-$1$2")+e;case 5443:return _i+e+Xi+"flex-item-"+zr(e,/flex-|-self/g,"")+(Ah(e,/flex-|baseline/)?"":Xi+"grid-row-"+zr(e,/flex-|-self/g,""))+e;case 4675:return _i+e+Xi+"flex-line-pack"+zr(e,/align-content|flex-|-self/g,"")+e;case 5548:return _i+e+Xi+zr(e,"shrink","negative")+e;case 5292:return _i+e+Xi+zr(e,"basis","preferred-size")+e;case 6060:return _i+"box-"+zr(e,"-grow","")+_i+e+Xi+zr(e,"grow","positive")+e;case 4554:return _i+zr(e,/([^-])(transform)/g,"$1"+_i+"$2")+e;case 6187:return zr(zr(zr(e,/(zoom-|grab)/,_i+"$1"),/(image-set)/,_i+"$1"),e,"")+e;case 5495:case 3959:return zr(e,/(image-set\([^]*)/,_i+"$1$`$1");case 4968:return zr(zr(e,/(.+:)(flex-)?(.*)/,_i+"box-pack:$3"+Xi+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+_i+e+e;case 4200:if(!Ah(e,/flex-|baseline/))return Xi+"grid-column-align"+jy(e,t)+e;break;case 2592:case 3360:return Xi+zr(e,"template-","")+e;case 4384:case 3616:return r&&r.some(function(s,c){return t=c,Ah(s.props,/grid-\w+-end/)})?~LE(e+(r=r[t].value),"span",0)?e:Xi+zr(e,"-start","")+e+Xi+"grid-row-span:"+(~LE(r,"span",0)?Ah(r,/\d+/):+Ah(r,/\d+/)-+Ah(e,/\d+/))+";":Xi+zr(e,"-start","")+e;case 4896:case 4128:return r&&r.some(function(s){return Ah(s.props,/grid-\w+-start/)})?e:Xi+zr(zr(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return zr(e,/(.+)-inline(.+)/,_i+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Au(e)-1-t>6)switch(bo(e,t+1)){case 109:if(bo(e,t+4)!==45)break;case 102:return zr(e,/(.+:)(.+)-([^]+)/,"$1"+_i+"$2-$3$1"+G1+(bo(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~LE(e,"stretch",0)?SX(zr(e,"stretch","fill-available"),t,r)+e:e}break;case 5152:case 5920:return zr(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(s,c,f,_,x,a,I){return Xi+c+":"+f+I+(_?Xi+c+"-span:"+(x?a:+a-+f)+I:"")+e});case 4949:if(bo(e,t+6)===121)return zr(e,":",":"+_i)+e;break;case 6444:switch(bo(e,bo(e,14)===45?18:11)){case 120:return zr(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+_i+(bo(e,14)===45?"inline-":"")+"box$3$1"+_i+"$2$3$1"+Xi+"$2box$3")+e;case 100:return zr(e,":",":"+Xi)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return zr(e,"scroll-","scroll-snap-")+e}return e}function sI(e,t){for(var r="",s=0;s<e.length;s++)r+=t(e[s],s,e,t)||"";return r}function zIe(e,t,r,s){switch(e.type){case TIe:if(e.children.length)break;case wIe:case iL:return e.return=e.return||e.value;case vX:return"";case xX:return e.return=e.value+"{"+sI(e.children,s)+"}";case lA:if(!Au(e.value=e.props.join(",")))return""}return Au(r=sI(e.children,s))?e.return=e.value+"{"+r+"}":""}function NIe(e){var t=TX(e);return function(r,s,c,f){for(var _="",x=0;x<t;x++)_+=e[x](r,s,c,f)||"";return _}}function FIe(e){return function(t){t.root||(t=t.return)&&e(t)}}function BIe(e,t,r,s){if(e.length>-1&&!e.return)switch(e.type){case iL:e.return=SX(e.value,e.length,r);return;case xX:return sI([tf(e,{value:zr(e.value,"@","@"+_i)})],s);case lA:if(e.length)return SIe(r=e.props,function(c){switch(Ah(c,s=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":A_(tf(e,{props:[zr(c,/:(read-\w+)/,":"+G1+"$1")]})),A_(tf(e,{props:[c]})),E4(e,{props:Z8(r,s)});break;case"::placeholder":A_(tf(e,{props:[zr(c,/:(plac\w+)/,":"+_i+"input-$1")]})),A_(tf(e,{props:[zr(c,/:(plac\w+)/,":"+G1+"$1")]})),A_(tf(e,{props:[zr(c,/:(plac\w+)/,Xi+"input-$1")]})),A_(tf(e,{props:[c]})),E4(e,{props:Z8(r,s)});break}return""})}}var jIe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},il={},Vy=typeof process<"u"&&il!==void 0&&(il.REACT_APP_SC_ATTR||il.SC_ATTR)||"data-styled",IX="active",CX="data-styled-version",dA="6.1.13",oL=`/*!sc*/
`,oI=typeof window<"u"&&"HTMLElement"in window,UIe=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&il!==void 0&&il.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&il.REACT_APP_SC_DISABLE_SPEEDY!==""?il.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&il.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&il!==void 0&&il.SC_DISABLE_SPEEDY!==void 0&&il.SC_DISABLE_SPEEDY!==""&&il.SC_DISABLE_SPEEDY!=="false"&&il.SC_DISABLE_SPEEDY),fA=Object.freeze([]),$y=Object.freeze({});function VIe(e,t,r){return r===void 0&&(r=$y),e.theme!==r.theme&&e.theme||t||r.theme}var AX=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),$Ie=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,qIe=/(^-|-$)/g;function Q8(e){return e.replace($Ie,"-").replace(qIe,"")}var GIe=/(a)(d)/gi,nE=52,Y8=function(e){return String.fromCharCode(e+(e>25?39:97))};function C4(e){var t,r="";for(t=Math.abs(e);t>nE;t=t/nE|0)r=Y8(t%nE)+r;return(Y8(t%nE)+r).replace(GIe,"$1-$2")}var ZR,PX=5381,Q_=function(e,t){for(var r=t.length;r;)e=33*e^t.charCodeAt(--r);return e},RX=function(e){return Q_(PX,e)};function WIe(e){return C4(RX(e)>>>0)}function HIe(e){return e.displayName||e.name||"Component"}function XR(e){return typeof e=="string"&&!0}var MX=typeof Symbol=="function"&&Symbol.for,kX=MX?Symbol.for("react.memo"):60115,ZIe=MX?Symbol.for("react.forward_ref"):60112,XIe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},KIe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},DX={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},QIe=((ZR={})[ZIe]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},ZR[kX]=DX,ZR);function J8(e){return("type"in(t=e)&&t.type.$$typeof)===kX?DX:"$$typeof"in e?QIe[e.$$typeof]:XIe;var t}var YIe=Object.defineProperty,JIe=Object.getOwnPropertyNames,e$=Object.getOwnPropertySymbols,eCe=Object.getOwnPropertyDescriptor,tCe=Object.getPrototypeOf,t$=Object.prototype;function OX(e,t,r){if(typeof t!="string"){if(t$){var s=tCe(t);s&&s!==t$&&OX(e,s,r)}var c=JIe(t);e$&&(c=c.concat(e$(t)));for(var f=J8(e),_=J8(t),x=0;x<c.length;++x){var a=c[x];if(!(a in KIe||r&&r[a]||_&&a in _||f&&a in f)){var I=eCe(t,a);try{YIe(e,a,I)}catch{}}}}return e}function qy(e){return typeof e=="function"}function aL(e){return typeof e=="object"&&"styledComponentId"in e}function ym(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function n$(e,t){if(e.length===0)return"";for(var r=e[0],s=1;s<e.length;s++)r+=e[s];return r}function Ux(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function A4(e,t,r){if(r===void 0&&(r=!1),!r&&!Ux(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var s=0;s<t.length;s++)e[s]=A4(e[s],t[s]);else if(Ux(t))for(var s in t)e[s]=A4(e[s],t[s]);return e}function lL(e,t){Object.defineProperty(e,"toString",{value:t})}function Sb(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var nCe=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var r=0,s=0;s<t;s++)r+=this.groupSizes[s];return r},e.prototype.insertRules=function(t,r){if(t>=this.groupSizes.length){for(var s=this.groupSizes,c=s.length,f=c;t>=f;)if((f<<=1)<0)throw Sb(16,"".concat(t));this.groupSizes=new Uint32Array(f),this.groupSizes.set(s),this.length=f;for(var _=c;_<f;_++)this.groupSizes[_]=0}for(var x=this.indexOfGroup(t+1),a=(_=0,r.length);_<a;_++)this.tag.insertRule(x,r[_])&&(this.groupSizes[t]++,x++)},e.prototype.clearGroup=function(t){if(t<this.length){var r=this.groupSizes[t],s=this.indexOfGroup(t),c=s+r;this.groupSizes[t]=0;for(var f=s;f<c;f++)this.tag.deleteRule(s)}},e.prototype.getGroup=function(t){var r="";if(t>=this.length||this.groupSizes[t]===0)return r;for(var s=this.groupSizes[t],c=this.indexOfGroup(t),f=c+s,_=c;_<f;_++)r+="".concat(this.tag.getRule(_)).concat(oL);return r},e}(),FE=new Map,aI=new Map,BE=1,rE=function(e){if(FE.has(e))return FE.get(e);for(;aI.has(BE);)BE++;var t=BE++;return FE.set(e,t),aI.set(t,e),t},rCe=function(e,t){BE=t+1,FE.set(e,t),aI.set(t,e)},iCe="style[".concat(Vy,"][").concat(CX,'="').concat(dA,'"]'),sCe=new RegExp("^".concat(Vy,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),oCe=function(e,t,r){for(var s,c=r.split(","),f=0,_=c.length;f<_;f++)(s=c[f])&&e.registerName(t,s)},aCe=function(e,t){for(var r,s=((r=t.textContent)!==null&&r!==void 0?r:"").split(oL),c=[],f=0,_=s.length;f<_;f++){var x=s[f].trim();if(x){var a=x.match(sCe);if(a){var I=0|parseInt(a[1],10),D=a[2];I!==0&&(rCe(D,I),oCe(e,D,a[3]),e.getTag().insertRules(I,c)),c.length=0}else c.push(x)}}},r$=function(e){for(var t=document.querySelectorAll(iCe),r=0,s=t.length;r<s;r++){var c=t[r];c&&c.getAttribute(Vy)!==IX&&(aCe(e,c),c.parentNode&&c.parentNode.removeChild(c))}};function lCe(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var LX=function(e){var t=document.head,r=e||t,s=document.createElement("style"),c=function(x){var a=Array.from(x.querySelectorAll("style[".concat(Vy,"]")));return a[a.length-1]}(r),f=c!==void 0?c.nextSibling:null;s.setAttribute(Vy,IX),s.setAttribute(CX,dA);var _=lCe();return _&&s.setAttribute("nonce",_),r.insertBefore(s,f),s},cCe=function(){function e(t){this.element=LX(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(r){if(r.sheet)return r.sheet;for(var s=document.styleSheets,c=0,f=s.length;c<f;c++){var _=s[c];if(_.ownerNode===r)return _}throw Sb(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,r){try{return this.sheet.insertRule(r,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var r=this.sheet.cssRules[t];return r&&r.cssText?r.cssText:""},e}(),uCe=function(){function e(t){this.element=LX(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,r){if(t<=this.length&&t>=0){var s=document.createTextNode(r);return this.element.insertBefore(s,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),hCe=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,r){return t<=this.length&&(this.rules.splice(t,0,r),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),i$=oI,dCe={isServer:!oI,useCSSOMInjection:!UIe},zX=function(){function e(t,r,s){t===void 0&&(t=$y),r===void 0&&(r={});var c=this;this.options=Ba(Ba({},dCe),t),this.gs=r,this.names=new Map(s),this.server=!!t.isServer,!this.server&&oI&&i$&&(i$=!1,r$(this)),lL(this,function(){return function(f){for(var _=f.getTag(),x=_.length,a="",I=function(O){var F=function(G){return aI.get(G)}(O);if(F===void 0)return"continue";var Z=f.names.get(F),J=_.getGroup(O);if(Z===void 0||!Z.size||J.length===0)return"continue";var re="".concat(Vy,".g").concat(O,'[id="').concat(F,'"]'),ne="";Z!==void 0&&Z.forEach(function(G){G.length>0&&(ne+="".concat(G,","))}),a+="".concat(J).concat(re,'{content:"').concat(ne,'"}').concat(oL)},D=0;D<x;D++)I(D);return a}(c)})}return e.registerId=function(t){return rE(t)},e.prototype.rehydrate=function(){!this.server&&oI&&r$(this)},e.prototype.reconstructWithOptions=function(t,r){return r===void 0&&(r=!0),new e(Ba(Ba({},this.options),t),this.gs,r&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(r){var s=r.useCSSOMInjection,c=r.target;return r.isServer?new hCe(c):s?new cCe(c):new uCe(c)}(this.options),new nCe(t)));var t},e.prototype.hasNameForId=function(t,r){return this.names.has(t)&&this.names.get(t).has(r)},e.prototype.registerName=function(t,r){if(rE(t),this.names.has(t))this.names.get(t).add(r);else{var s=new Set;s.add(r),this.names.set(t,s)}},e.prototype.insertRules=function(t,r,s){this.registerName(t,r),this.getTag().insertRules(rE(t),s)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(rE(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),fCe=/&/g,pCe=/^\s*\/\/.*$/gm;function NX(e,t){return e.map(function(r){return r.type==="rule"&&(r.value="".concat(t," ").concat(r.value),r.value=r.value.replaceAll(",",",".concat(t," ")),r.props=r.props.map(function(s){return"".concat(t," ").concat(s)})),Array.isArray(r.children)&&r.type!=="@keyframes"&&(r.children=NX(r.children,t)),r})}function mCe(e){var t,r,s,c=$y,f=c.options,_=f===void 0?$y:f,x=c.plugins,a=x===void 0?fA:x,I=function(F,Z,J){return J.startsWith(r)&&J.endsWith(r)&&J.replaceAll(r,"").length>0?".".concat(t):F},D=a.slice();D.push(function(F){F.type===lA&&F.value.includes("&")&&(F.props[0]=F.props[0].replace(fCe,r).replace(s,I))}),_.prefix&&D.push(BIe),D.push(zIe);var O=function(F,Z,J,re){Z===void 0&&(Z=""),J===void 0&&(J=""),re===void 0&&(re="&"),t=re,r=Z,s=new RegExp("\\".concat(r,"\\b"),"g");var ne=F.replace(pCe,""),G=OIe(J||Z?"".concat(J," ").concat(Z," { ").concat(ne," }"):ne);_.namespace&&(G=NX(G,_.namespace));var Y=[];return sI(G,NIe(D.concat(FIe(function(Q){return Y.push(Q)})))),Y};return O.hash=a.length?a.reduce(function(F,Z){return Z.name||Sb(15),Q_(F,Z.name)},PX).toString():"",O}var gCe=new zX,P4=mCe(),FX=Gr.createContext({shouldForwardProp:void 0,styleSheet:gCe,stylis:P4});FX.Consumer;Gr.createContext(void 0);function s$(){return W.useContext(FX)}var _Ce=function(){function e(t,r){var s=this;this.inject=function(c,f){f===void 0&&(f=P4);var _=s.name+f.hash;c.hasNameForId(s.id,_)||c.insertRules(s.id,_,f(s.rules,_,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=r,lL(this,function(){throw Sb(12,String(s.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=P4),this.name+t.hash},e}(),yCe=function(e){return e>="A"&&e<="Z"};function o$(e){for(var t="",r=0;r<e.length;r++){var s=e[r];if(r===1&&s==="-"&&e[0]==="-")return e;yCe(s)?t+="-"+s.toLowerCase():t+=s}return t.startsWith("ms-")?"-"+t:t}var BX=function(e){return e==null||e===!1||e===""},jX=function(e){var t,r,s=[];for(var c in e){var f=e[c];e.hasOwnProperty(c)&&!BX(f)&&(Array.isArray(f)&&f.isCss||qy(f)?s.push("".concat(o$(c),":"),f,";"):Ux(f)?s.push.apply(s,iI(iI(["".concat(c," {")],jX(f),!1),["}"],!1)):s.push("".concat(o$(c),": ").concat((t=c,(r=f)==null||typeof r=="boolean"||r===""?"":typeof r!="number"||r===0||t in jIe||t.startsWith("--")?String(r).trim():"".concat(r,"px")),";")))}return s};function Pm(e,t,r,s){if(BX(e))return[];if(aL(e))return[".".concat(e.styledComponentId)];if(qy(e)){if(!qy(f=e)||f.prototype&&f.prototype.isReactComponent||!t)return[e];var c=e(t);return Pm(c,t,r,s)}var f;return e instanceof _Ce?r?(e.inject(r,s),[e.getName(s)]):[e]:Ux(e)?jX(e):Array.isArray(e)?Array.prototype.concat.apply(fA,e.map(function(_){return Pm(_,t,r,s)})):[e.toString()]}function vCe(e){for(var t=0;t<e.length;t+=1){var r=e[t];if(qy(r)&&!aL(r))return!1}return!0}var xCe=RX(dA),bCe=function(){function e(t,r,s){this.rules=t,this.staticRulesId="",this.isStatic=(s===void 0||s.isStatic)&&vCe(t),this.componentId=r,this.baseHash=Q_(xCe,r),this.baseStyle=s,zX.registerId(r)}return e.prototype.generateAndInjectStyles=function(t,r,s){var c=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,r,s):"";if(this.isStatic&&!s.hash)if(this.staticRulesId&&r.hasNameForId(this.componentId,this.staticRulesId))c=ym(c,this.staticRulesId);else{var f=n$(Pm(this.rules,t,r,s)),_=C4(Q_(this.baseHash,f)>>>0);if(!r.hasNameForId(this.componentId,_)){var x=s(f,".".concat(_),void 0,this.componentId);r.insertRules(this.componentId,_,x)}c=ym(c,_),this.staticRulesId=_}else{for(var a=Q_(this.baseHash,s.hash),I="",D=0;D<this.rules.length;D++){var O=this.rules[D];if(typeof O=="string")I+=O;else if(O){var F=n$(Pm(O,t,r,s));a=Q_(a,F+D),I+=F}}if(I){var Z=C4(a>>>0);r.hasNameForId(this.componentId,Z)||r.insertRules(this.componentId,Z,s(I,".".concat(Z),void 0,this.componentId)),c=ym(c,Z)}}return c},e}(),UX=Gr.createContext(void 0);UX.Consumer;var KR={};function wCe(e,t,r){var s=aL(e),c=e,f=!XR(e),_=t.attrs,x=_===void 0?fA:_,a=t.componentId,I=a===void 0?function(de,Te){var we=typeof de!="string"?"sc":Q8(de);KR[we]=(KR[we]||0)+1;var oe="".concat(we,"-").concat(WIe(dA+we+KR[we]));return Te?"".concat(Te,"-").concat(oe):oe}(t.displayName,t.parentComponentId):a,D=t.displayName,O=D===void 0?function(de){return XR(de)?"styled.".concat(de):"Styled(".concat(HIe(de),")")}(e):D,F=t.displayName&&t.componentId?"".concat(Q8(t.displayName),"-").concat(t.componentId):t.componentId||I,Z=s&&c.attrs?c.attrs.concat(x).filter(Boolean):x,J=t.shouldForwardProp;if(s&&c.shouldForwardProp){var re=c.shouldForwardProp;if(t.shouldForwardProp){var ne=t.shouldForwardProp;J=function(de,Te){return re(de,Te)&&ne(de,Te)}}else J=re}var G=new bCe(r,F,s?c.componentStyle:void 0);function Y(de,Te){return function(we,oe,he){var X=we.attrs,ge=we.componentStyle,be=we.defaultProps,ke=we.foldedComponentIds,Ee=we.styledComponentId,zt=we.target,Ut=Gr.useContext(UX),Qt=s$(),kt=we.shouldForwardProp||Qt.shouldForwardProp,ft=VIe(oe,Ut,be)||$y,Rt=function(Ft,Sn,qn){for(var Qn,Gt=Ba(Ba({},Sn),{className:void 0,theme:qn}),Cn=0;Cn<Ft.length;Cn+=1){var hn=qy(Qn=Ft[Cn])?Qn(Gt):Qn;for(var Rn in hn)Gt[Rn]=Rn==="className"?ym(Gt[Rn],hn[Rn]):Rn==="style"?Ba(Ba({},Gt[Rn]),hn[Rn]):hn[Rn]}return Sn.className&&(Gt.className=ym(Gt.className,Sn.className)),Gt}(X,oe,ft),Yt=Rt.as||zt,ht={};for(var At in Rt)Rt[At]===void 0||At[0]==="$"||At==="as"||At==="theme"&&Rt.theme===ft||(At==="forwardedAs"?ht.as=Rt.forwardedAs:kt&&!kt(At,Yt)||(ht[At]=Rt[At]));var wt=function(Ft,Sn){var qn=s$(),Qn=Ft.generateAndInjectStyles(Sn,qn.styleSheet,qn.stylis);return Qn}(ge,Rt),Xt=ym(ke,Ee);return wt&&(Xt+=" "+wt),Rt.className&&(Xt+=" "+Rt.className),ht[XR(Yt)&&!AX.has(Yt)?"class":"className"]=Xt,ht.ref=he,W.createElement(Yt,ht)}(Q,de,Te)}Y.displayName=O;var Q=Gr.forwardRef(Y);return Q.attrs=Z,Q.componentStyle=G,Q.displayName=O,Q.shouldForwardProp=J,Q.foldedComponentIds=s?ym(c.foldedComponentIds,c.styledComponentId):"",Q.styledComponentId=F,Q.target=s?c.target:e,Object.defineProperty(Q,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(de){this._foldedDefaultProps=s?function(Te){for(var we=[],oe=1;oe<arguments.length;oe++)we[oe-1]=arguments[oe];for(var he=0,X=we;he<X.length;he++)A4(Te,X[he],!0);return Te}({},c.defaultProps,de):de}}),lL(Q,function(){return".".concat(Q.styledComponentId)}),f&&OX(Q,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),Q}function a$(e,t){for(var r=[e[0]],s=0,c=t.length;s<c;s+=1)r.push(t[s],e[s+1]);return r}var l$=function(e){return Object.assign(e,{isCss:!0})};function TCe(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(qy(e)||Ux(e))return l$(Pm(a$(fA,iI([e],t,!0))));var s=e;return t.length===0&&s.length===1&&typeof s[0]=="string"?Pm(s):l$(Pm(a$(s,t)))}function R4(e,t,r){if(r===void 0&&(r=$y),!t)throw Sb(1,t);var s=function(c){for(var f=[],_=1;_<arguments.length;_++)f[_-1]=arguments[_];return e(t,r,TCe.apply(void 0,iI([c],f,!1)))};return s.attrs=function(c){return R4(e,t,Ba(Ba({},r),{attrs:Array.prototype.concat(r.attrs,c).filter(Boolean)}))},s.withConfig=function(c){return R4(e,t,Ba(Ba({},r),c))},s}var VX=function(e){return R4(wCe,e)},c0=VX;AX.forEach(function(e){c0[e]=VX(e)});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function lI(e,t,r,s){return new(r||(r=Promise))(function(c,f){function _(I){try{a(s.next(I))}catch(D){f(D)}}function x(I){try{a(s.throw(I))}catch(D){f(D)}}function a(I){I.done?c(I.value):new r(function(D){D(I.value)}).then(_,x)}a((s=s.apply(e,[])).next())})}function cI(e,t){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},s,c,f,_;return _={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function x(I){return function(D){return a([I,D])}}function a(I){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,c&&(f=I[0]&2?c.return:I[0]?c.throw||((f=c.return)&&f.call(c),0):c.next)&&!(f=f.call(c,I[1])).done)return f;switch(c=0,f&&(I=[I[0]&2,f.value]),I[0]){case 0:case 1:f=I;break;case 4:return r.label++,{value:I[1],done:!1};case 5:r.label++,c=I[1],I=[0];continue;case 7:I=r.ops.pop(),r.trys.pop();continue;default:if(f=r.trys,!(f=f.length>0&&f[f.length-1])&&(I[0]===6||I[0]===2)){r=0;continue}if(I[0]===3&&(!f||I[1]>f[0]&&I[1]<f[3])){r.label=I[1];break}if(I[0]===6&&r.label<f[1]){r.label=f[1],f=I;break}if(f&&r.label<f[2]){r.label=f[2],r.ops.push(I);break}f[2]&&r.ops.pop(),r.trys.pop();continue}I=t.call(e,r)}catch(D){I=[6,D],c=0}finally{s=f=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}}function Ib(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var ECe=c0.div(u$||(u$=Ib([`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`],[`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`]))),SCe=c0.div(h$||(h$=Ib([`
  width: 100%;
  `,`
`],[`
  width: 100%;
  `,`
`])),function(e){var t=e.aspectRatio;return t==="cover"?`
    position: absolute;
    bottom: 0;
    top: 0;
    left: 0;
    right: 0;`:`
    position: relative;
    padding-bottom: `+100/t+"%;"}),c$=c0.div(d$||(d$=Ib([`
  padding: 40px;
`],[`
  padding: 40px;
`]))),ICe=c0.video(f$||(f$=Ib([`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`],[`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`])),function(e){var t=e.mirrored;return t?"180deg":"0deg"}),CCe=c0.canvas(p$||(p$=Ib([`
  display: none;
`],[`
  display: none;
`]))),u$,h$,d$,f$,p$,$X=Gr.forwardRef(function(e,t){var r=e.facingMode,s=r===void 0?"user":r,c=e.aspectRatio,f=c===void 0?"cover":c,_=e.numberOfCamerasCallback,x=_===void 0?function(){return null}:_,a=e.videoSourceDeviceId,I=a===void 0?void 0:a,D=e.errorMessages,O=D===void 0?{noCameraAccessible:"No camera device accessible. Please connect your camera or try a different browser.",permissionDenied:"Permission denied. Please refresh and give camera permission.",switchCamera:"It is not possible to switch camera to different one because there is only one video device accessible.",canvas:"Canvas is not supported."}:D,F=e.videoReadyCallback,Z=F===void 0?function(){return null}:F,J=W.useRef(null),re=W.useRef(null),ne=W.useRef(null),G=W.useRef(null),Y=W.useState(0),Q=Y[0],de=Y[1],Te=W.useState(null),we=Te[0],oe=Te[1],he=W.useState(s),X=he[0],ge=he[1],be=W.useState(!1),ke=be[0],Ee=be[1],zt=W.useState(!1),Ut=zt[0],Qt=zt[1],kt=W.useState(!1),ft=kt[0],Rt=kt[1],Yt=W.useState(!1),ht=Yt[0],At=Yt[1],wt=W.useRef(!1);W.useEffect(function(){return wt.current=!0,function(){wt.current=!1}},[]),W.useEffect(function(){x(Q)},[Q]);var Xt=function(Ft){return Ft===void 0&&(Ft=!1),lI(void 0,void 0,void 0,function(){var Sn,qn;return cI(this,function(Qn){switch(Qn.label){case 0:if(!(we&&(navigator!=null&&navigator.mediaDevices)&&wt.current))return[3,4];if(Sn=navigator.mediaDevices.getSupportedConstraints(),qn=we.getTracks()[0],!(Sn&&"torch"in Sn&&qn))return[3,4];Qn.label=1;case 1:return Qn.trys.push([1,3,,4]),[4,qn.applyConstraints({advanced:[{torch:Ft}]})];case 2:return Qn.sent(),[2,!0];case 3:return Qn.sent(),[2,!1];case 4:return[2,!1]}})})};return W.useEffect(function(){Xt(ht)},[ht]),W.useImperativeHandle(t,function(){return{takePhoto:function(Ft){var Sn,qn,Qn,Gt,Cn;if(Q<1)throw new Error(O.noCameraAccessible);if(re!=null&&re.current){var hn=((Sn=J==null?void 0:J.current)===null||Sn===void 0?void 0:Sn.videoWidth)||1280,Rn=((qn=J==null?void 0:J.current)===null||qn===void 0?void 0:qn.videoHeight)||720,Nr=hn/Rn,jn=((Qn=G==null?void 0:G.current)===null||Qn===void 0?void 0:Qn.offsetWidth)||1280,gr=((Gt=G==null?void 0:G.current)===null||Gt===void 0?void 0:Gt.offsetHeight)||1280,Fr=jn/gr,dr=void 0,rr=void 0,Ue=void 0,Xe=void 0,ut=void 0;switch(Nr>Fr?(Xe=Rn,Ue=Rn*Fr,dr=(hn-Ue)/2,rr=0):(Ue=hn,Xe=hn/Fr,dr=0,rr=(Rn-Xe)/2),re.current.width=Ue,re.current.height=Xe,ne.current||(ne.current=re.current.getContext("2d",{willReadFrequently:!0})),ne.current&&(J!=null&&J.current)&&ne.current.drawImage(J.current,dr,rr,Ue,Xe,0,0,Ue,Xe),Ft){case"imgData":ut=(Cn=ne.current)===null||Cn===void 0?void 0:Cn.getImageData(0,0,Ue,Xe);break;default:ut=re.current.toDataURL("image/jpeg");break}return ut}else throw new Error(O.canvas)},switchCamera:function(){if(Q<1)throw new Error(O.noCameraAccessible);Q<2&&console.error("Error: Unable to switch camera. Only one device is accessible.");var Ft=X==="user"?"environment":"user";return ge(Ft),Ft},getNumberOfCameras:function(){return Q},toggleTorch:function(){var Ft=!ht;return At(Ft),Ft},torchSupported:ft}}),W.useEffect(function(){PCe(we,oe,X,I,de,Ee,Qt,!!wt.current)},[X,I]),W.useEffect(function(){return Xt(!1).then(function(Ft){return Rt(Ft)}),we&&J&&J.current&&(J.current.srcObject=we),function(){we&&we.getTracks().forEach(function(Ft){Ft.stop()})}},[we]),Gr.createElement(SCe,{ref:G,aspectRatio:f},Gr.createElement(ECe,null,ke?Gr.createElement(c$,null,O.noCameraAccessible):null,Ut?Gr.createElement(c$,null,O.permissionDenied):null,Gr.createElement(ICe,{ref:J,id:"video",muted:!0,autoPlay:!0,playsInline:!0,mirrored:X==="user",onLoadedData:function(){Z()}}),Gr.createElement(CCe,{ref:re})))});$X.displayName="Camera";var ACe=function(e){return lI(void 0,void 0,void 0,function(){var t;return cI(this,function(r){switch(r.label){case 0:return t=[],e!=="environment"?[3,2]:[4,navigator.mediaDevices.enumerateDevices().then(function(s){var c=s.filter(function(f){return f.kind=="videoinput"});c.forEach(function(f){var _=f.getCapabilities();_.facingMode&&_.facingMode.indexOf("environment")>=0&&_.deviceId&&t.push(_.deviceId)})})];case 1:r.sent(),r.label=2;case 2:return t.length>1?[2,t.pop()]:[2,void 0]}})})},PCe=function(e,t,r,s,c,f,_,x){return lI(void 0,void 0,void 0,function(){var a,I,D,O,F;return cI(this,function(Z){switch(Z.label){case 0:return e&&e.getTracks().forEach(function(J){J.stop()}),[4,ACe(r)];case 1:return I=Z.sent(),I?a=I:a=s?{exact:s}:void 0,D={audio:!1,video:{deviceId:a,facingMode:r}},!((F=navigator==null?void 0:navigator.mediaDevices)===null||F===void 0)&&F.getUserMedia?navigator.mediaDevices.getUserMedia(D).then(function(J){x&&t(m$(J,c))}).catch(function(J){g$(J,f,_)}):(O=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,O?O(D,function(J){return lI(void 0,void 0,void 0,function(){return cI(this,function(re){return x&&t(m$(J,c)),[2]})})},function(J){g$(J,f,_)}):f(!0)),[2]}})})},m$=function(e,t){return navigator.mediaDevices.enumerateDevices().then(function(r){return t(r.filter(function(s){return s.kind==="videoinput"}).length)}),e},g$=function(e,t,r){console.error(e),e.name==="PermissionDeniedError"?r(!0):t(!0)};const RCe=()=>{const[e,t]=W.useState(null),[r,s]=W.useState("1:1"),[c,f]=W.useState(""),[_,x]=W.useState(!1),[a,I]=W.useState({x:0,y:0}),[D,O]=W.useState({width:0,height:0}),[F,Z]=W.useState(""),[J,re]=W.useState("user"),[ne,G]=W.useState(!1),[Y,Q]=W.useState(null),[de,Te]=W.useState(!1),we=gX(),oe=Qm(),he=W.useRef(null),X=W.useRef(null),ge=W.useRef(null),be=W.useCallback(()=>{if(he.current){const ht=he.current.takePhoto(),At=new Image;At.onload=()=>{const wt=document.createElement("canvas");wt.width=At.width,wt.height=At.height,wt.getContext("2d").drawImage(At,0,0,At.width,At.height);const Ft=wt.toDataURL("image/png",1);t(Ft),Z(new Date().toLocaleTimeString())},At.src=ht}},[]),ke=ht=>{s(ht),Te(!0),G(!1),Ee(ht)},Ee=ht=>{if(X.current){const At=X.current.getBoundingClientRect(),[wt,Xt]=ht.split(":").map(Number);let Ft,Sn;At.width/At.height>wt/Xt?(Sn=At.height,Ft=Sn*wt/Xt):(Ft=At.width,Sn=Ft*Xt/wt),Ft=Math.min(Ft,At.width),Sn=Math.min(Sn,At.height),O({width:Ft,height:Sn}),I({x:(At.width-Ft)/2,y:(At.height-Sn)/2})}},zt=async()=>{x(!0);try{const ht=await Ut(),At=x2(lge,`quest_images/${Date.now()}_${$t.currentUser.uid}.jpg`);await nge(At,ht,"data_url");const Xt={imageUrl:await v2(At),aspectRatio:r,time:new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),user:(we==null?void 0:we.name)||"Anonymous",description:c,createdAt:new Date().toISOString(),userId:$t.currentUser.uid};await Ex(vi(yn,"quests"),Xt),oe("/home")}catch(ht){console.error("Error uploading quest:",ht)}finally{x(!1)}},Ut=()=>new Promise(ht=>{const At=document.createElement("canvas"),wt=At.getContext("2d"),Xt=X.current,Ft=ge.current;if(!Xt||!Ft){console.error("Image or crop reference is missing"),ht(null);return}const Sn=Xt.naturalWidth/Xt.width,qn=Xt.naturalHeight/Xt.height;At.width=D.width*Sn,At.height=D.height*qn,wt.drawImage(Xt,a.x*Sn,a.y*qn,D.width*Sn,D.height*qn,0,0,At.width,At.height),At.toBlob(Qn=>{if(!Qn){console.error("Failed to create blob from canvas"),ht(null);return}const Gt=new FileReader;Gt.onloadend=()=>ht(Gt.result),Gt.readAsDataURL(Qn)},"image/jpeg")}),Qt=ht=>{if(ge.current&&X.current){const At=X.current.getBoundingClientRect(),wt=ge.current.getBoundingClientRect();let Xt=ht.clientX-At.left-wt.width/2,Ft=ht.clientY-At.top-wt.height/2;Xt=Math.max(0,Math.min(Xt,At.width-wt.width)),Ft=Math.max(0,Math.min(Ft,At.height-wt.height)),I({x:Xt,y:Ft})}},kt=()=>{e?(t(null),G(!1),Te(!1)):oe("/home")},ft=()=>{re(ht=>ht==="user"?"environment":"user")},Rt=()=>{G(!0),Te(!1)},Yt=()=>{G(!1),Te(!0),Ee(r)};return W.useEffect(()=>{if(X.current&&ge.current){const ht=X.current.getBoundingClientRect(),At=ge.current.getBoundingClientRect();I({x:(ht.width-At.width)/2,y:(ht.height-At.height)/2})}},[r]),N.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",width:"100vw",backgroundColor:"#000",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:10001,border:"solid 50px white",borderRadius:"50px"},children:[Y&&N.jsx("div",{style:{color:"red"},children:Y}),e?N.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",height:"100%",width:"100%",backgroundColor:"#000"},children:[N.jsxs("div",{style:{position:"relative",width:"100%",height:"calc(100% - 200px)",overflow:"hidden"},onMouseMove:Qt,children:[N.jsx("img",{ref:X,src:e,alt:"Captured",style:{width:"100%",height:"100%",objectFit:"cover",transform:"scalex(-1)"}}),N.jsx("div",{ref:ge,style:{position:"absolute",border:"2px solid #fff",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)",left:`${a.x}px`,top:`${a.y}px`,width:`${D.width}px`,height:`${D.height}px`},children:N.jsx(mbe,{style:{position:"absolute",top:"10px",left:"10px",color:"#fff",fontSize:"24px"}})})]}),N.jsxs("div",{style:{width:"100%",padding:"20px",backgroundColor:"#fff",borderTopLeftRadius:"20px",borderTopRightRadius:"20px"},children:[N.jsx("div",{style:{display:"flex",justifyContent:"space-around",marginBottom:"20px"},children:["1:1","4:5","9:16"].map(ht=>N.jsx(am,{onClick:()=>ke(ht),style:{flex:1,margin:"0 5px",padding:"10px",borderRadius:"20px",fontWeight:"bold",height:"70px",width:"70px",textTransform:"none",backgroundColor:r===ht?"#3797EF":"transparent",color:r===ht?"#fff":"#3797EF",border:r===ht?"none":"2px solid #333333"},disabled:ne,children:ht},ht))}),de&&!ne&&N.jsx(am,{variant:"contained",onClick:Rt,style:{width:"100%",marginBottom:"20px",borderRadius:"20px",backgroundColor:"#3797EF",color:"#fff",fontWeight:"bold",textTransform:"none"},children:"Finalize Crop"}),ne&&N.jsx(am,{variant:"outlined",onClick:Yt,style:{width:"100%",marginBottom:"20px",borderRadius:"20px",color:"#3797EF",borderColor:"#3797EF"},startIcon:N.jsx(ybe,{}),children:"Reset Crop"}),N.jsx(EH,{fullWidth:!0,variant:"outlined",placeholder:"Add a description...",value:c,onChange:ht=>f(ht.target.value),style:{marginBottom:"20px"},InputProps:{style:{borderRadius:"20px"}}}),N.jsx(am,{variant:"contained",color:"primary",onClick:zt,disabled:_||!ne,style:{width:"100%",padding:"10px",borderRadius:"20px",backgroundColor:"#3797EF",color:"#fff",fontWeight:"bold",textTransform:"none"},children:"Done"})]}),N.jsx(am,{onClick:kt,style:{position:"absolute",top:"20px",left:"20px",color:"#fff",fontWeight:"bold"},children:"Cancel"})]}):N.jsxs(N.Fragment,{children:[N.jsx("div",{style:{borderRadius:"25px",overflow:"",border:"solid 10px blue",width:"105%",height:"100%",display:"inline-block",position:"absolute"},children:N.jsx($X,{ref:he,facingMode:J,aspectRatio:"cover",errorMessages:{},videoSourceDeviceId:void 0,numberOfCamerasCallback:ht=>console.log(ht),videoResolution:"highest",onError:ht=>Q("Could not start video source. Please check your camera permissions.")})}),N.jsxs("div",{style:{position:"absolute",bottom:"40px",left:0,right:0,display:"flex",justifyContent:"center",alignItems:"center"},children:[N.jsx(_m,{onClick:kt,style:{color:"#fff"},children:N.jsx(SH,{})}),N.jsx(_m,{onClick:be,style:{width:"70px",height:"70px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.3)",display:"flex",justifyContent:"center",alignItems:"center",marginRight:"30px",marginLeft:"30px"},children:N.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#fff"}})}),N.jsx(_m,{onClick:ft,style:{color:"#fff"},children:N.jsx(gbe,{})})]})]})]})},MCe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M380-320q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l224 224q11 11 11 28t-11 28q-11 11-28 11t-28-11L532-372q-30 24-69 38t-83 14Zm0-80q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"})),kCe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M459-381 314-526q-3-3-4.5-6.5T308-540q0-8 5.5-14t14.5-6h304q9 0 14.5 6t5.5 14q0 2-6 14L501-381q-5 5-10 7t-11 2q-6 0-11-2t-10-7Z"})),DCe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h200q17 0 28.5 11.5T440-800q0 17-11.5 28.5T400-760H200v560h560v-200q0-17 11.5-28.5T800-440q17 0 28.5 11.5T840-400v200q0 33-23.5 56.5T760-120H200Zm440-520h-80q-17 0-28.5-11.5T520-680q0-17 11.5-28.5T560-720h80v-80q0-17 11.5-28.5T680-840q17 0 28.5 11.5T720-800v80h80q17 0 28.5 11.5T840-680q0 17-11.5 28.5T800-640h-80v80q0 17-11.5 28.5T680-520q-17 0-28.5-11.5T640-560v-80Z"})),_$=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm.18-93q-36.18 0-61.68-25.32-25.5-25.33-25.5-61.5 0-36.18 25.32-61.68 25.33-25.5 61.5-25.5 36.18 0 61.68 25.32 25.5 25.33 25.5 61.5 0 36.18-25.32 61.68-25.33 25.5-61.5 25.5ZM480-169q-140 0-256.5-74T41-441q-8-14-11.5-29T26-500q0-15 3.5-30T41-559q66-124 182.5-198T480-831q140 0 256.5 74T919-559q8 14 11.5 29t3.5 30q0 15-3.5 30T919-441q-66 124-182.5 198T480-169Zm0-331Zm.09 220Q592-280 685.5-340T829-500q-50-100-143.59-160t-205.5-60Q368-720 274.5-660T131-500q50 100 143.59 160t205.5 60Z"})),y$=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M607-627q15 15 27 36.5t19 44.5q0 22-15 37t-37 15q-22 0-37-15t-15-37q2-7 0-12.5t-7-10.5q-5-5-10.5-7.5T518-577q-20 0-34.5-15T469-627q0-20 14.5-34.5T518-676q25 5 47 17t42 32Zm-127-93q-10 0-19.5.5T441-718q-23 2-43-10t-26-35q-6-23 6-42t35-22q17-2 33.5-3t33.5-1q144 0 264.5 76.5T928-547q5 11 8 23t3 24q0 12-2 24.5t-7 23.5q-17 34-39 64.5T843-329q-15 17-37.5 15T768-333q-15-17-14-40t16-40q17-20 32-42t28-45q-52-100-145-160t-205-60Zm0 551q-140 0-257.5-74.5T39-443q-7-14-10.5-28T25-500q0-15 3-29.5T38-558q18-37 42.5-69.5T134-689l-73-73q-14-14-14-33t14-33q14-14 33.5-14t33.5 14l685 685q14 14 14 33t-14 33q-14 14-33 14t-33-14L630-193q-36 13-74 18.5t-76 5.5ZM213-613q-25 26-45 54t-37 59q50 101 143.5 160.5T480-280q15 0 30-1.5t30-3.5l-36-38q-6 2-12 2.5t-12 .5q-75 0-127.5-52.5T300-500v-12q0-6 1-12l-88-89Zm343 74Zm-180 90Z"})),v$=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M9-257q0-43.3 22.7-79.6Q54.39-372.9 92-392q65-32 132.96-48.5Q292.92-457 363-457q72 0 140 16t131 48q37.61 18.96 60.3 54.98Q717-302 717-257v22q0 53-36.5 89.5T591-109H135q-53 0-89.5-36.5T9-235v-22Zm816 148h-71q22-27 32.5-59t10.5-67v-22q0-51-24.5-105T689-454q44 7 91.5 24t85.5 37q40 20 62.5 55.81T951-259v24q0 53-36.5 89.5T825-109ZM363-497q-74 0-125.5-51.5T186-674q0-74 51.5-125.5T363-851q74 0 125.5 51.5T540-674q0 74-51.5 125.5T363-497Zm449-177.01Q812-601 760.05-549q-51.94 52-124.89 52-12.16 0-28.16-3t-31-8q29-34 44-76.85 15-42.85 15-89T620-763q-15-43-44-77 15-6 29-8.5t29.53-2.5q73.21 0 125.34 51.99 52.13 51.99 52.13 125ZM135-235h456v-17q0-10.03-5.5-18.24-5.5-8.2-14.5-12.76-48-23-100-35.5T363-331q-54 0-108 12.5T155-283q-9 4.56-14.5 12.76-5.5 8.21-5.5 18.24v17Zm227.84-373q27.16 0 46.66-19.34 19.5-19.34 19.5-46.5t-19.34-46.66q-19.34-19.5-46.5-19.5t-46.66 19.34q-19.5 19.34-19.5 46.5t19.34 46.66q19.34 19.5 46.5 19.5Zm.16 373Zm0-439Z"})),OCe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"m480-413 100 100q14 14 33.5 13.5T647-314q14-14 14-33.5T647-381l-100-99 100-100q14-14 14-33.5T647-647q-14-14-33.5-14T580-647L480-547 380-647q-14-14-33-14t-33 14q-14 14-14 33.5t14 33.5l99 100-100 100q-14 14-13.5 33t14.5 33q14 14 33.5 14t33.5-14l99-99Zm0 367q-91 0-170-34t-137.5-92.5Q114-231 80-310T46-480q0-91 34-170t92.5-137.5Q231-846 310-880t170-34q91 0 170 34t137.5 92.5Q846-729 880-650t34 170q0 91-34 170t-92.5 137.5Q729-114 650-80T480-46Zm0-126q130 0 219-89t89-219q0-130-89-219t-219-89q-130 0-219 89t-89 219q0 130 89 219t219 89Zm0-308Z"})),LCe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M481-105q-162 0-269-106.5T105-480q0-121 68-222.5T375-840q23-8 42-5.5t32.5 12.5q13.5 10 19.5 26t4 36q-4 22-8 41t-4 38q0 97.08 68.54 165.04T696-459q20 0 40.5-2.5T776-468q19-2 33.5 3.5t23.03 16.5q9.47 11 11.97 28.5T840-379q-32 123-131.5 198.5T481-105Zm0-126q62 0 115.5-28.5T683-337q-10 1-19.5 1t-18.5-2q-119-17-203-98.5T339-645q-1-9-1.5-19t1.5-19q-48 34-77.5 88T232-480q0 103.16 72.92 176.08Q377.84-231 481-231Zm-23-226Z"})),zCe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M480-406q31 0 52.5-21.5T554-480q0-31-21.5-52.5T480-554q-31 0-52.5 21.5T406-480q0 31 21.5 52.5T480-406Zm0 126q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM80-417q-26 0-44.5-18.5T17-480q0-26 18.5-44.5T80-543h80q26 0 44.5 18.5T223-480q0 26-18.5 44.5T160-417H80Zm720 0q-26 0-44.5-18.5T737-480q0-26 18.5-44.5T800-543h80q26 0 44.5 18.5T943-480q0 26-18.5 44.5T880-417h-80ZM480-737q-26 0-44.5-18.5T417-800v-80q0-26 18.5-44.5T480-943q26 0 44.5 18.5T543-880v80q0 26-18.5 44.5T480-737Zm0 720q-26 0-44.5-18.5T417-80v-80q0-26 18.5-44.5T480-223q26 0 44.5 18.5T543-160v80q0 26-18.5 44.5T480-17ZM210-661l-43-42q-19-18-18.5-44t18.5-46q18-19 44-19t45 19l43 43q18 18 17.5 43.5T299-662q-18 19-44 19.5T210-661Zm494 494-43-43q-18-18-18-43.5t18-44.5q18-19 44-18.5t45 18.5l43 41q19 18 18.5 44T793-167q-18 19-44 19t-45-19Zm-42-494q-19-18-18.5-44t18.5-45l41-43q18-19 44-18.5t46 18.5q19 18 19 44t-19 45l-43 43q-18 18-43.5 17.5T662-661ZM167-167q-19-18-19-44t19-45l43-43q18-18 43.5-18t44.5 18q19 18 18.5 44T298-210l-41 43q-18 19-44 18.5T167-167Zm313-313Z"})),NCe=e=>W.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed",...e},W.createElement("path",{d:"M634-380H291q-86 0-145.5-60.5T86-587q0-86 59.5-146.5T291-794q26 0 44.5 18.5T354-731q0 26-18.5 44.5T291-668q-33 0-56 24t-23 57q0 33 23 57t56 24h343l-81-81q-18-18-18.5-43.5T553-675q19-19 44.5-19t44.5 19l188 188q18 19 18 44t-18 44L642-211q-18 19-43.5 19T554-211q-18-18-18-44t18-44l80-81Z"}));function FCe(){const{showNotification:e}=o0(),t=Qm(),[r,s]=W.useState(T4()),c=()=>{dX(),s(T4())};W.useEffect(()=>{const _=x=>{s(x.detail.isLightMode?"light":"dark")};return window.addEventListener("themeChanged",_),()=>{window.removeEventListener("themeChanged",_)}},[]);const f=W.useCallback(async()=>{try{await TZ(),e("Logged out successfully"),t("/login")}catch(_){console.error("Logout failed:",_),e("Logout failed. Please try again.")}},[e,t]);return N.jsx(aA,{children:N.jsxs("div",{className:"settings-container",children:[N.jsxs("header",{children:[N.jsx(_X,{onClick:()=>t("/home/profile")}),N.jsx("h2",{children:"Settings"})]}),N.jsxs("section",{children:[N.jsx("h3",{children:"Privacy"}),N.jsx(BCe,{})]}),N.jsxs("section",{children:[N.jsx("h3",{children:"Theme"}),N.jsxs("div",{className:"setting-option",onClick:c,children:[N.jsx("div",{children:N.jsx("p",{children:r==="light"?"Light Mode":"Dark Mode"})}),N.jsx("div",{className:"setting-icons",children:r==="light"?N.jsx(zCe,{}):N.jsx(LCe,{})})]})]}),N.jsxs("section",{children:[N.jsx("h3",{children:"Account"}),N.jsxs("div",{className:"setting-option nogap",id:"logout",children:["Logout",N.jsx("div",{className:"logout-button",onClick:f,children:N.jsx(NCe,{})})]})]})]})})}function BCe(){const[e,t]=W.useState({friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),[r,s]=W.useState(1),[c,f]=W.useState([]),[_,x]=W.useState(""),[a,I]=W.useState([]);W.useState(window.innerHeight*.5),W.useEffect(()=>{D()},[]),W.useEffect(()=>{const ne=(e.friendsCanSeeLocation?1:0)+(e.quietMap?2:0);s(ne)},[e.friendsCanSeeLocation,e.quietMap]);const D=async()=>{try{const G=(await $i(Zn(yn,"users",$t.currentUser.uid))).data();t(G.privacySettings||{friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),f(G.customVisibilityList||[])}catch(ne){console.error("Error fetching privacy settings:",ne)}},O=()=>{const ne=(r+1)%4;switch(s(ne),ne){case 0:F("friendsCanSeeLocation",!1),F("quietMap",!1);break;case 1:F("friendsCanSeeLocation",!0),F("quietMap",!1);break;case 2:F("friendsCanSeeLocation",!1),F("quietMap",!0);break;case 3:F("friendsCanSeeLocation",!0),F("quietMap",!0);break}},F=async(ne,G)=>{try{const Y={...e,[ne]:G};t(Y),await Yi(Zn(yn,"users",$t.currentUser.uid),{privacySettings:Y})}catch(Y){console.error("Error updating privacy setting:",Y)}},Z=async ne=>{if(x(ne.target.value),ne.target.value.length>2)try{const G=vi(yn,"users"),Y=co(G,yi("username",">=",ne.target.value),yi("username","<=",ne.target.value+"")),de=(await _a(Y)).docs.map(Te=>({id:Te.id,...Te.data()}));I(de)}catch(G){console.error("Error searching users:",G)}else I([])},J=async ne=>{if(ne&&!c.some(G=>G.id===ne.id)){const G=[...c,ne];f(G),x(""),I([]);try{await Yi(Zn(yn,"users",$t.currentUser.uid),{customVisibilityList:G})}catch(Y){console.error("Error updating custom list:",Y)}}},re=async ne=>{const G=c.filter(Y=>Y.id!==ne);f(G);try{await Yi(Zn(yn,"users",$t.currentUser.uid),{customVisibilityList:G})}catch(Y){console.error("Error updating custom list:",Y)}};return N.jsxs("div",{children:[N.jsxs("div",{className:"setting-option",children:[N.jsxs("div",{children:[N.jsx("p",{children:"Location Visibility"}),N.jsx("span",{children:"Only Friends can see my Location"})]}),N.jsxs("div",{className:"setting-icons",onClick:O,children:[r===0&&N.jsx(_$,{}),r===1&&N.jsxs(N.Fragment,{children:[N.jsx(_$,{}),N.jsx(v$,{})]}),r===2&&N.jsx(y$,{}),r===3&&N.jsxs(N.Fragment,{children:[N.jsx(y$,{}),N.jsx(v$,{})]})]})]}),N.jsxs("div",{className:"setting-option",children:[N.jsxs("div",{children:[N.jsx("p",{children:"Visibility List"}),N.jsx("span",{children:"Use Custom Visibility List"})]}),N.jsx("div",{className:"setting-icons",onClick:()=>F("useCustomVisibilityList",!e.useCustomVisibilityList),children:e.useCustomVisibilityList?N.jsx(oX,{}):N.jsx(OCe,{})})]}),e.useCustomVisibilityList&&N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"search-user",children:[N.jsx("input",{type:"text",value:_,onChange:Z,placeholder:"Search users..."}),N.jsx("div",{className:"search-results",children:a.map(ne=>N.jsxs("div",{className:"search-result-item",onClick:()=>J(ne),children:[N.jsx("img",{src:ne.profilePhoto||"/default-profile.png",alt:ne.username,className:"user-avatar"}),N.jsx("span",{children:ne.username})]},ne.id))})]}),N.jsx("div",{className:"custom-list",children:c.map(ne=>N.jsxs("div",{className:"custom-list-item",children:[N.jsx("img",{src:ne.profilePhoto||"/default-profile.png",alt:ne.username,className:"user-avatar"}),N.jsx("span",{children:ne.username}),N.jsx("button",{onClick:()=>re(ne.id),children:"Remove"})]},ne.id))})]})]})}function jCe(){const e=YU("(max-width:800px)"),t=YU("(max-width:550px)"),r=W.useRef(null),[s,c]=W.useState(!1),[f,_]=W.useState(!1);W.useState(!1),Gr.useState(!1),W.useEffect(()=>{const a=()=>{if(console.debug("scroll"),r.current){const I=r.current.getBoundingClientRect();c(I.bottom<48)}};return window.addEventListener("scroll",a,!0),a(),()=>{window.removeEventListener("scroll",a,!0)}},[]);const x=()=>{_(!0)};return N.jsxs("div",{className:"main-page",children:[t&&N.jsx(xIe,{show:s}),N.jsxs("div",{className:"left-panel",children:[N.jsx(yIe,{}),N.jsxs(q7,{children:[N.jsx(Oc,{path:"profile",element:N.jsx(aX,{})}),N.jsx(Oc,{path:"settings",element:N.jsx(FCe,{})}),N.jsx(Oc,{path:"connections",element:N.jsx(pX,{})}),N.jsx(Oc,{path:"camera",element:N.jsx(RCe,{})}),N.jsx(Oc,{path:"quests",element:N.jsx(lX,{isCreateQuestOpen:f,setIsCreateQuestOpen:_})})]})]}),N.jsxs("div",{className:"body-section",children:[N.jsx("div",{className:"middle-panel",children:N.jsx(vIe,{})}),N.jsx("div",{className:"right-panel",ref:r,children:N.jsxs("div",{className:"right-panel right-panel-sticky",children:[N.jsx(yX,{}),N.jsx("div",{className:"button-section",children:e?N.jsxs(N.Fragment,{children:[N.jsx(M4,{}),N.jsx(D4,{onClick:x}),N.jsx(k4,{})]}):N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"actions-container",children:[N.jsx(M4,{}),N.jsx(k4,{})]}),N.jsx(D4,{onClick:x})]})})]})})]}),f&&N.jsx(bIe,{isOpen:f,onClose:()=>_(!1)})]})}function M4({small:e=!1}){return N.jsxs("div",{className:`search ${e&&"small"}`,children:[N.jsx("div",{className:"icon-container",children:N.jsx(MCe,{})}),!e&&N.jsx("input",{className:"search-input",type:"text",placeholder:"Find Quests"})]})}function k4({small:e=!1}){const[t,r]=W.useState("Near You");return N.jsxs("button",{className:`filter-button ${e&&"small"}`,children:[N.jsx("div",{className:"icon-container",children:N.jsx(kCe,{})}),t]})}function D4({small:e=!1,onClick:t}){return N.jsxs("button",{className:`create-button ${e&&"small"}`,onClick:t,children:[N.jsx("div",{className:"icon-container",children:N.jsx(DCe,{})}),!e&&"Create Quest"]})}function UCe(){return W.useEffect(()=>{fX()},[]),N.jsx(FTe,{children:N.jsx(qTe,{children:N.jsxs(fIe,{children:[" ",N.jsx(Nne,{children:N.jsxs(q7,{children:[N.jsx(Oc,{path:"/",element:N.jsx(dIe,{})}),N.jsx(Oc,{path:"/login",element:N.jsx(bge,{})}),N.jsx(Oc,{path:"/register",element:N.jsx(wge,{})}),N.jsx(Oc,{path:"/home/*",element:N.jsxs(N.Fragment,{children:[N.jsx(jCe,{}),N.jsx(W8,{})]})}),N.jsx(Oc,{path:"/adventure-feed",element:N.jsx(N.Fragment,{children:N.jsx(W8,{})})})]})})]})})})}k7(document.getElementById("root")).render(N.jsx(W.StrictMode,{children:N.jsx(UCe,{})}))});export default VCe();
