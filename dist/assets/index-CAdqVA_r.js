var CJ=Object.defineProperty,AJ=Object.defineProperties;var PJ=Object.getOwnPropertyDescriptors;var ET=Object.getOwnPropertySymbols,RJ=Object.getPrototypeOf,MB=Object.prototype.hasOwnProperty,kB=Object.prototype.propertyIsEnumerable,MJ=Reflect.get;var Ch=Math.pow,N3=(e,t,r)=>t in e?CJ(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,de=(e,t)=>{for(var r in t||(t={}))MB.call(t,r)&&N3(e,r,t[r]);if(ET)for(var r of ET(t))kB.call(t,r)&&N3(e,r,t[r]);return e},_t=(e,t)=>AJ(e,PJ(t));var ST=e=>typeof e=="symbol"?e:e+"",On=(e,t)=>{var r={};for(var s in e)MB.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&ET)for(var s of ET(e))t.indexOf(s)<0&&kB.call(e,s)&&(r[s]=e[s]);return r};var kJ=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Bv=(e,t,r)=>N3(e,typeof t!="symbol"?t+"":t,r);var nm=(e,t,r)=>MJ(RJ(e),r,t);var Be=(e,t,r)=>new Promise((s,c)=>{var f=a=>{try{x(r.next(a))}catch(I){c(I)}},_=a=>{try{x(r.throw(a))}catch(I){c(I)}},x=a=>a.done?s(a.value):Promise.resolve(a.value).then(f,_);x((r=r.apply(e,t)).next())});var tAe=kJ((xn,gl)=>{function DJ(e,t){for(var r=0;r<t.length;r++){const s=t[r];if(typeof s!="string"&&!Array.isArray(s)){for(const c in s)if(c!=="default"&&!(c in e)){const f=Object.getOwnPropertyDescriptor(s,c);f&&Object.defineProperty(e,c,f.get?f:{enumerable:!0,get:()=>s[c]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const f of c)if(f.type==="childList")for(const _ of f.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function r(c){const f={};return c.integrity&&(f.integrity=c.integrity),c.referrerPolicy&&(f.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?f.credentials="include":c.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function s(c){if(c.ep)return;c.ep=!0;const f=r(c);fetch(c.href,f)}})();var OJ=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Yy(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var D8={exports:{}},xI={},O8={exports:{}},Kr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kx=Symbol.for("react.element"),LJ=Symbol.for("react.portal"),zJ=Symbol.for("react.fragment"),NJ=Symbol.for("react.strict_mode"),FJ=Symbol.for("react.profiler"),BJ=Symbol.for("react.provider"),jJ=Symbol.for("react.context"),UJ=Symbol.for("react.forward_ref"),VJ=Symbol.for("react.suspense"),$J=Symbol.for("react.memo"),qJ=Symbol.for("react.lazy"),DB=Symbol.iterator;function GJ(e){return e===null||typeof e!="object"?null:(e=DB&&e[DB]||e["@@iterator"],typeof e=="function"?e:null)}var L8={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},z8=Object.assign,N8={};function Jy(e,t,r){this.props=e,this.context=t,this.refs=N8,this.updater=r||L8}Jy.prototype.isReactComponent={};Jy.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Jy.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F8(){}F8.prototype=Jy.prototype;function G4(e,t,r){this.props=e,this.context=t,this.refs=N8,this.updater=r||L8}var W4=G4.prototype=new F8;W4.constructor=G4;z8(W4,Jy.prototype);W4.isPureReactComponent=!0;var OB=Array.isArray,B8=Object.prototype.hasOwnProperty,H4={current:null},j8={key:!0,ref:!0,__self:!0,__source:!0};function U8(e,t,r){var s,c={},f=null,_=null;if(t!=null)for(s in t.ref!==void 0&&(_=t.ref),t.key!==void 0&&(f=""+t.key),t)B8.call(t,s)&&!j8.hasOwnProperty(s)&&(c[s]=t[s]);var x=arguments.length-2;if(x===1)c.children=r;else if(1<x){for(var a=Array(x),I=0;I<x;I++)a[I]=arguments[I+2];c.children=a}if(e&&e.defaultProps)for(s in x=e.defaultProps,x)c[s]===void 0&&(c[s]=x[s]);return{$$typeof:Kx,type:e,key:f,ref:_,props:c,_owner:H4.current}}function WJ(e,t){return{$$typeof:Kx,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Z4(e){return typeof e=="object"&&e!==null&&e.$$typeof===Kx}function HJ(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var LB=/\/+/g;function F3(e,t){return typeof e=="object"&&e!==null&&e.key!=null?HJ(""+e.key):t.toString(36)}function pE(e,t,r,s,c){var f=typeof e;(f==="undefined"||f==="boolean")&&(e=null);var _=!1;if(e===null)_=!0;else switch(f){case"string":case"number":_=!0;break;case"object":switch(e.$$typeof){case Kx:case LJ:_=!0}}if(_)return _=e,c=c(_),e=s===""?"."+F3(_,0):s,OB(c)?(r="",e!=null&&(r=e.replace(LB,"$&/")+"/"),pE(c,t,r,"",function(I){return I})):c!=null&&(Z4(c)&&(c=WJ(c,r+(!c.key||_&&_.key===c.key?"":(""+c.key).replace(LB,"$&/")+"/")+e)),t.push(c)),1;if(_=0,s=s===""?".":s+":",OB(e))for(var x=0;x<e.length;x++){f=e[x];var a=s+F3(f,x);_+=pE(f,t,r,a,c)}else if(a=GJ(e),typeof a=="function")for(e=a.call(e),x=0;!(f=e.next()).done;)f=f.value,a=s+F3(f,x++),_+=pE(f,t,r,a,c);else if(f==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return _}function IT(e,t,r){if(e==null)return e;var s=[],c=0;return pE(e,s,"","",function(f){return t.call(r,f,c++)}),s}function ZJ(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Sa={current:null},mE={transition:null},XJ={ReactCurrentDispatcher:Sa,ReactCurrentBatchConfig:mE,ReactCurrentOwner:H4};function V8(){throw Error("act(...) is not supported in production builds of React.")}Kr.Children={map:IT,forEach:function(e,t,r){IT(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return IT(e,function(){t++}),t},toArray:function(e){return IT(e,function(t){return t})||[]},only:function(e){if(!Z4(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Kr.Component=Jy;Kr.Fragment=zJ;Kr.Profiler=FJ;Kr.PureComponent=G4;Kr.StrictMode=NJ;Kr.Suspense=VJ;Kr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XJ;Kr.act=V8;Kr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=z8({},e.props),c=e.key,f=e.ref,_=e._owner;if(t!=null){if(t.ref!==void 0&&(f=t.ref,_=H4.current),t.key!==void 0&&(c=""+t.key),e.type&&e.type.defaultProps)var x=e.type.defaultProps;for(a in t)B8.call(t,a)&&!j8.hasOwnProperty(a)&&(s[a]=t[a]===void 0&&x!==void 0?x[a]:t[a])}var a=arguments.length-2;if(a===1)s.children=r;else if(1<a){x=Array(a);for(var I=0;I<a;I++)x[I]=arguments[I+2];s.children=x}return{$$typeof:Kx,type:e.type,key:c,ref:f,props:s,_owner:_}};Kr.createContext=function(e){return e={$$typeof:jJ,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:BJ,_context:e},e.Consumer=e};Kr.createElement=U8;Kr.createFactory=function(e){var t=U8.bind(null,e);return t.type=e,t};Kr.createRef=function(){return{current:null}};Kr.forwardRef=function(e){return{$$typeof:UJ,render:e}};Kr.isValidElement=Z4;Kr.lazy=function(e){return{$$typeof:qJ,_payload:{_status:-1,_result:e},_init:ZJ}};Kr.memo=function(e,t){return{$$typeof:$J,type:e,compare:t===void 0?null:t}};Kr.startTransition=function(e){var t=mE.transition;mE.transition={};try{e()}finally{mE.transition=t}};Kr.unstable_act=V8;Kr.useCallback=function(e,t){return Sa.current.useCallback(e,t)};Kr.useContext=function(e){return Sa.current.useContext(e)};Kr.useDebugValue=function(){};Kr.useDeferredValue=function(e){return Sa.current.useDeferredValue(e)};Kr.useEffect=function(e,t){return Sa.current.useEffect(e,t)};Kr.useId=function(){return Sa.current.useId()};Kr.useImperativeHandle=function(e,t,r){return Sa.current.useImperativeHandle(e,t,r)};Kr.useInsertionEffect=function(e,t){return Sa.current.useInsertionEffect(e,t)};Kr.useLayoutEffect=function(e,t){return Sa.current.useLayoutEffect(e,t)};Kr.useMemo=function(e,t){return Sa.current.useMemo(e,t)};Kr.useReducer=function(e,t,r){return Sa.current.useReducer(e,t,r)};Kr.useRef=function(e){return Sa.current.useRef(e)};Kr.useState=function(e){return Sa.current.useState(e)};Kr.useSyncExternalStore=function(e,t,r){return Sa.current.useSyncExternalStore(e,t,r)};Kr.useTransition=function(){return Sa.current.useTransition()};Kr.version="18.3.1";O8.exports=Kr;var G=O8.exports;const Xr=Yy(G),KE=DJ({__proto__:null,default:Xr},[G]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KJ=G,QJ=Symbol.for("react.element"),YJ=Symbol.for("react.fragment"),JJ=Object.prototype.hasOwnProperty,eee=KJ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,tee={key:!0,ref:!0,__self:!0,__source:!0};function $8(e,t,r){var s,c={},f=null,_=null;r!==void 0&&(f=""+r),t.key!==void 0&&(f=""+t.key),t.ref!==void 0&&(_=t.ref);for(s in t)JJ.call(t,s)&&!tee.hasOwnProperty(s)&&(c[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)c[s]===void 0&&(c[s]=t[s]);return{$$typeof:QJ,type:e,key:f,ref:_,props:c,_owner:eee.current}}xI.Fragment=YJ;xI.jsx=$8;xI.jsxs=$8;D8.exports=xI;var N=D8.exports,q8={exports:{}},Tl={},G8={exports:{}},W8={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(ct,Ut){var Kt=ct.length;ct.push(Ut);e:for(;0<Kt;){var at=Kt-1>>>1,At=ct[at];if(0<c(At,Ut))ct[at]=Ut,ct[Kt]=At,Kt=at;else break e}}function r(ct){return ct.length===0?null:ct[0]}function s(ct){if(ct.length===0)return null;var Ut=ct[0],Kt=ct.pop();if(Kt!==Ut){ct[0]=Kt;e:for(var at=0,At=ct.length,Et=At>>>1;at<Et;){var Jt=2*(at+1)-1,Bt=ct[Jt],Pn=Jt+1,$n=ct[Pn];if(0>c(Bt,Kt))Pn<At&&0>c($n,Bt)?(ct[at]=$n,ct[Pn]=Kt,at=Pn):(ct[at]=Bt,ct[Jt]=Kt,at=Jt);else if(Pn<At&&0>c($n,Kt))ct[at]=$n,ct[Pn]=Kt,at=Pn;else break e}}return Ut}function c(ct,Ut){var Kt=ct.sortIndex-Ut.sortIndex;return Kt!==0?Kt:ct.id-Ut.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;e.unstable_now=function(){return f.now()}}else{var _=Date,x=_.now();e.unstable_now=function(){return _.now()-x}}var a=[],I=[],D=1,O=null,F=3,H=!1,Q=!1,ie=!1,te=typeof setTimeout=="function"?setTimeout:null,W=typeof clearTimeout=="function"?clearTimeout:null,X=typeof setImmediate!="undefined"?setImmediate:null;typeof navigator!="undefined"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ee(ct){for(var Ut=r(I);Ut!==null;){if(Ut.callback===null)s(I);else if(Ut.startTime<=ct)s(I),Ut.sortIndex=Ut.expirationTime,t(a,Ut);else break;Ut=r(I)}}function fe(ct){if(ie=!1,ee(ct),!Q)if(r(a)!==null)Q=!0,qt(ye);else{var Ut=r(I);Ut!==null&&It(fe,Ut.startTime-ct)}}function ye(ct,Ut){Q=!1,ie&&(ie=!1,W(he),he=-1),H=!0;var Kt=F;try{for(ee(Ut),O=r(a);O!==null&&(!(O.expirationTime>Ut)||ct&&!J());){var at=O.callback;if(typeof at=="function"){O.callback=null,F=O.priorityLevel;var At=at(O.expirationTime<=Ut);Ut=e.unstable_now(),typeof At=="function"?O.callback=At:O===r(a)&&s(a),ee(Ut)}else s(a);O=r(a)}if(O!==null)var Et=!0;else{var Jt=r(I);Jt!==null&&It(fe,Jt.startTime-Ut),Et=!1}return Et}finally{O=null,F=Kt,H=!1}}var Ee=!1,re=null,he=-1,_e=5,Se=-1;function J(){return!(e.unstable_now()-Se<_e)}function Ie(){if(re!==null){var ct=e.unstable_now();Se=ct;var Ut=!0;try{Ut=re(!0,ct)}finally{Ut?we():(Ee=!1,re=null)}}else Ee=!1}var we;if(typeof X=="function")we=function(){X(Ie)};else if(typeof MessageChannel!="undefined"){var Lt=new MessageChannel,Gt=Lt.port2;Lt.port1.onmessage=Ie,we=function(){Gt.postMessage(null)}}else we=function(){te(Ie,0)};function qt(ct){re=ct,Ee||(Ee=!0,we())}function It(ct,Ut){he=te(function(){ct(e.unstable_now())},Ut)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ct){ct.callback=null},e.unstable_continueExecution=function(){Q||H||(Q=!0,qt(ye))},e.unstable_forceFrameRate=function(ct){0>ct||125<ct?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_e=0<ct?Math.floor(1e3/ct):5},e.unstable_getCurrentPriorityLevel=function(){return F},e.unstable_getFirstCallbackNode=function(){return r(a)},e.unstable_next=function(ct){switch(F){case 1:case 2:case 3:var Ut=3;break;default:Ut=F}var Kt=F;F=Ut;try{return ct()}finally{F=Kt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ct,Ut){switch(ct){case 1:case 2:case 3:case 4:case 5:break;default:ct=3}var Kt=F;F=ct;try{return Ut()}finally{F=Kt}},e.unstable_scheduleCallback=function(ct,Ut,Kt){var at=e.unstable_now();switch(typeof Kt=="object"&&Kt!==null?(Kt=Kt.delay,Kt=typeof Kt=="number"&&0<Kt?at+Kt:at):Kt=at,ct){case 1:var At=-1;break;case 2:At=250;break;case 5:At=1073741823;break;case 4:At=1e4;break;default:At=5e3}return At=Kt+At,ct={id:D++,callback:Ut,priorityLevel:ct,startTime:Kt,expirationTime:At,sortIndex:-1},Kt>at?(ct.sortIndex=Kt,t(I,ct),r(a)===null&&ct===r(I)&&(ie?(W(he),he=-1):ie=!0,It(fe,Kt-at))):(ct.sortIndex=At,t(a,ct),Q||H||(Q=!0,qt(ye))),ct},e.unstable_shouldYield=J,e.unstable_wrapCallback=function(ct){var Ut=F;return function(){var Kt=F;F=Ut;try{return ct.apply(this,arguments)}finally{F=Kt}}}})(W8);G8.exports=W8;var nee=G8.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ree=G,wl=nee;function fn(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var H8=new Set,ex={};function eg(e,t){Ty(e,t),Ty(e+"Capture",t)}function Ty(e,t){for(ex[e]=t,e=0;e<t.length;e++)H8.add(t[e])}var Hh=!(typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"),lM=Object.prototype.hasOwnProperty,iee=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,zB={},NB={};function see(e){return lM.call(NB,e)?!0:lM.call(zB,e)?!1:iee.test(e)?NB[e]=!0:(zB[e]=!0,!1)}function oee(e,t,r,s){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function aee(e,t,r,s){if(t===null||typeof t=="undefined"||oee(e,t,r,s))return!0;if(s)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ia(e,t,r,s,c,f,_){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=c,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=f,this.removeEmptyString=_}var No={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){No[e]=new Ia(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];No[t]=new Ia(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){No[e]=new Ia(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){No[e]=new Ia(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){No[e]=new Ia(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){No[e]=new Ia(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){No[e]=new Ia(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){No[e]=new Ia(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){No[e]=new Ia(e,5,!1,e.toLowerCase(),null,!1,!1)});var X4=/[\-:]([a-z])/g;function K4(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(X4,K4);No[t]=new Ia(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(X4,K4);No[t]=new Ia(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(X4,K4);No[t]=new Ia(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){No[e]=new Ia(e,1,!1,e.toLowerCase(),null,!1,!1)});No.xlinkHref=new Ia("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){No[e]=new Ia(e,1,!1,e.toLowerCase(),null,!0,!0)});function Q4(e,t,r,s){var c=No.hasOwnProperty(t)?No[t]:null;(c!==null?c.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(aee(t,r,c,s)&&(r=null),s||c===null?see(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):c.mustUseProperty?e[c.propertyName]=r===null?c.type===3?!1:"":r:(t=c.attributeName,s=c.attributeNamespace,r===null?e.removeAttribute(t):(c=c.type,r=c===3||c===4&&r===!0?"":""+r,s?e.setAttributeNS(s,t,r):e.setAttribute(t,r))))}var od=ree.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,CT=Symbol.for("react.element"),j_=Symbol.for("react.portal"),U_=Symbol.for("react.fragment"),Y4=Symbol.for("react.strict_mode"),cM=Symbol.for("react.profiler"),Z8=Symbol.for("react.provider"),X8=Symbol.for("react.context"),J4=Symbol.for("react.forward_ref"),uM=Symbol.for("react.suspense"),hM=Symbol.for("react.suspense_list"),eD=Symbol.for("react.memo"),lf=Symbol.for("react.lazy"),K8=Symbol.for("react.offscreen"),FB=Symbol.iterator;function jv(e){return e===null||typeof e!="object"?null:(e=FB&&e[FB]||e["@@iterator"],typeof e=="function"?e:null)}var Is=Object.assign,B3;function o1(e){if(B3===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);B3=t&&t[1]||""}return`
`+B3+e}var j3=!1;function U3(e,t){if(!e||j3)return"";j3=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(I){var s=I}Reflect.construct(e,[],t)}else{try{t.call()}catch(I){s=I}e.call(t.prototype)}else{try{throw Error()}catch(I){s=I}e()}}catch(I){if(I&&s&&typeof I.stack=="string"){for(var c=I.stack.split(`
`),f=s.stack.split(`
`),_=c.length-1,x=f.length-1;1<=_&&0<=x&&c[_]!==f[x];)x--;for(;1<=_&&0<=x;_--,x--)if(c[_]!==f[x]){if(_!==1||x!==1)do if(_--,x--,0>x||c[_]!==f[x]){var a=`
`+c[_].replace(" at new "," at ");return e.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",e.displayName)),a}while(1<=_&&0<=x);break}}}finally{j3=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?o1(e):""}function lee(e){switch(e.tag){case 5:return o1(e.type);case 16:return o1("Lazy");case 13:return o1("Suspense");case 19:return o1("SuspenseList");case 0:case 2:case 15:return e=U3(e.type,!1),e;case 11:return e=U3(e.type.render,!1),e;case 1:return e=U3(e.type,!0),e;default:return""}}function dM(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case U_:return"Fragment";case j_:return"Portal";case cM:return"Profiler";case Y4:return"StrictMode";case uM:return"Suspense";case hM:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case X8:return(e.displayName||"Context")+".Consumer";case Z8:return(e._context.displayName||"Context")+".Provider";case J4:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case eD:return t=e.displayName||null,t!==null?t:dM(e.type)||"Memo";case lf:t=e._payload,e=e._init;try{return dM(e(t))}catch(r){}}return null}function cee(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return dM(t);case 8:return t===Y4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Nf(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Q8(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function uee(e){var t=Q8(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof r!="undefined"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,f=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(_){s=""+_,f.call(this,_)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(_){s=""+_},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function AT(e){e._valueTracker||(e._valueTracker=uee(e))}function Y8(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),s="";return e&&(s=Q8(e)?e.checked?"true":"false":e.value),e=s,e!==r?(t.setValue(e),!0):!1}function QE(e){if(e=e||(typeof document!="undefined"?document:void 0),typeof e=="undefined")return null;try{return e.activeElement||e.body}catch(t){return e.body}}function fM(e,t){var r=t.checked;return Is({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r!=null?r:e._wrapperState.initialChecked})}function BB(e,t){var r=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;r=Nf(t.value!=null?t.value:r),e._wrapperState={initialChecked:s,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function J8(e,t){t=t.checked,t!=null&&Q4(e,"checked",t,!1)}function pM(e,t){J8(e,t);var r=Nf(t.value),s=t.type;if(r!=null)s==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?mM(e,t.type,r):t.hasOwnProperty("defaultValue")&&mM(e,t.type,Nf(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function jB(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function mM(e,t,r){(t!=="number"||QE(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var a1=Array.isArray;function iy(e,t,r,s){if(e=e.options,t){t={};for(var c=0;c<r.length;c++)t["$"+r[c]]=!0;for(r=0;r<e.length;r++)c=t.hasOwnProperty("$"+e[r].value),e[r].selected!==c&&(e[r].selected=c),c&&s&&(e[r].defaultSelected=!0)}else{for(r=""+Nf(r),t=null,c=0;c<e.length;c++){if(e[c].value===r){e[c].selected=!0,s&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function gM(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(fn(91));return Is({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function UB(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(fn(92));if(a1(r)){if(1<r.length)throw Error(fn(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Nf(r)}}function e9(e,t){var r=Nf(t.value),s=Nf(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),s!=null&&(e.defaultValue=""+s)}function VB(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function t9(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _M(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?t9(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var PT,n9=function(e){return typeof MSApp!="undefined"&&MSApp.execUnsafeLocalFunction?function(t,r,s,c){MSApp.execUnsafeLocalFunction(function(){return e(t,r,s,c)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(PT=PT||document.createElement("div"),PT.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=PT.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function tx(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var E1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hee=["Webkit","ms","Moz","O"];Object.keys(E1).forEach(function(e){hee.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),E1[t]=E1[e]})});function r9(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||E1.hasOwnProperty(e)&&E1[e]?(""+t).trim():t+"px"}function i9(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var s=r.indexOf("--")===0,c=r9(r,t[r],s);r==="float"&&(r="cssFloat"),s?e.setProperty(r,c):e[r]=c}}var dee=Is({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yM(e,t){if(t){if(dee[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(fn(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(fn(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(fn(61))}if(t.style!=null&&typeof t.style!="object")throw Error(fn(62))}}function vM(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xM=null;function tD(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var bM=null,sy=null,oy=null;function $B(e){if(e=Jx(e)){if(typeof bM!="function")throw Error(fn(280));var t=e.stateNode;t&&(t=SI(t),bM(e.stateNode,e.type,t))}}function s9(e){sy?oy?oy.push(e):oy=[e]:sy=e}function o9(){if(sy){var e=sy,t=oy;if(oy=sy=null,$B(e),t)for(e=0;e<t.length;e++)$B(t[e])}}function a9(e,t){return e(t)}function l9(){}var V3=!1;function c9(e,t,r){if(V3)return e(t,r);V3=!0;try{return a9(e,t,r)}finally{V3=!1,(sy!==null||oy!==null)&&(l9(),o9())}}function nx(e,t){var r=e.stateNode;if(r===null)return null;var s=SI(r);if(s===null)return null;r=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(fn(231,t,typeof r));return r}var wM=!1;if(Hh)try{var Uv={};Object.defineProperty(Uv,"passive",{get:function(){wM=!0}}),window.addEventListener("test",Uv,Uv),window.removeEventListener("test",Uv,Uv)}catch(e){wM=!1}function fee(e,t,r,s,c,f,_,x,a){var I=Array.prototype.slice.call(arguments,3);try{t.apply(r,I)}catch(D){this.onError(D)}}var S1=!1,YE=null,JE=!1,TM=null,pee={onError:function(e){S1=!0,YE=e}};function mee(e,t,r,s,c,f,_,x,a){S1=!1,YE=null,fee.apply(pee,arguments)}function gee(e,t,r,s,c,f,_,x,a){if(mee.apply(this,arguments),S1){if(S1){var I=YE;S1=!1,YE=null}else throw Error(fn(198));JE||(JE=!0,TM=I)}}function tg(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function u9(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function qB(e){if(tg(e)!==e)throw Error(fn(188))}function _ee(e){var t=e.alternate;if(!t){if(t=tg(e),t===null)throw Error(fn(188));return t!==e?null:e}for(var r=e,s=t;;){var c=r.return;if(c===null)break;var f=c.alternate;if(f===null){if(s=c.return,s!==null){r=s;continue}break}if(c.child===f.child){for(f=c.child;f;){if(f===r)return qB(c),e;if(f===s)return qB(c),t;f=f.sibling}throw Error(fn(188))}if(r.return!==s.return)r=c,s=f;else{for(var _=!1,x=c.child;x;){if(x===r){_=!0,r=c,s=f;break}if(x===s){_=!0,s=c,r=f;break}x=x.sibling}if(!_){for(x=f.child;x;){if(x===r){_=!0,r=f,s=c;break}if(x===s){_=!0,s=f,r=c;break}x=x.sibling}if(!_)throw Error(fn(189))}}if(r.alternate!==s)throw Error(fn(190))}if(r.tag!==3)throw Error(fn(188));return r.stateNode.current===r?e:t}function h9(e){return e=_ee(e),e!==null?d9(e):null}function d9(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=d9(e);if(t!==null)return t;e=e.sibling}return null}var f9=wl.unstable_scheduleCallback,GB=wl.unstable_cancelCallback,yee=wl.unstable_shouldYield,vee=wl.unstable_requestPaint,Zs=wl.unstable_now,xee=wl.unstable_getCurrentPriorityLevel,nD=wl.unstable_ImmediatePriority,p9=wl.unstable_UserBlockingPriority,eS=wl.unstable_NormalPriority,bee=wl.unstable_LowPriority,m9=wl.unstable_IdlePriority,bI=null,Fu=null;function wee(e){if(Fu&&typeof Fu.onCommitFiberRoot=="function")try{Fu.onCommitFiberRoot(bI,e,void 0,(e.current.flags&128)===128)}catch(t){}}var Vc=Math.clz32?Math.clz32:See,Tee=Math.log,Eee=Math.LN2;function See(e){return e>>>=0,e===0?32:31-(Tee(e)/Eee|0)|0}var RT=64,MT=4194304;function l1(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function tS(e,t){var r=e.pendingLanes;if(r===0)return 0;var s=0,c=e.suspendedLanes,f=e.pingedLanes,_=r&268435455;if(_!==0){var x=_&~c;x!==0?s=l1(x):(f&=_,f!==0&&(s=l1(f)))}else _=r&~c,_!==0?s=l1(_):f!==0&&(s=l1(f));if(s===0)return 0;if(t!==0&&t!==s&&!(t&c)&&(c=s&-s,f=t&-t,c>=f||c===16&&(f&4194240)!==0))return t;if(s&4&&(s|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)r=31-Vc(t),c=1<<r,s|=e[r],t&=~c;return s}function Iee(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cee(e,t){for(var r=e.suspendedLanes,s=e.pingedLanes,c=e.expirationTimes,f=e.pendingLanes;0<f;){var _=31-Vc(f),x=1<<_,a=c[_];a===-1?(!(x&r)||x&s)&&(c[_]=Iee(x,t)):a<=t&&(e.expiredLanes|=x),f&=~x}}function EM(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function g9(){var e=RT;return RT<<=1,!(RT&4194240)&&(RT=64),e}function $3(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Qx(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Vc(t),e[t]=r}function Aee(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<r;){var c=31-Vc(r),f=1<<c;t[c]=0,s[c]=-1,e[c]=-1,r&=~f}}function rD(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var s=31-Vc(r),c=1<<s;c&t|e[s]&t&&(e[s]|=t),r&=~c}}var Mi=0;function _9(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var y9,iD,v9,x9,b9,SM=!1,kT=[],Tf=null,Ef=null,Sf=null,rx=new Map,ix=new Map,uf=[],Pee="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function WB(e,t){switch(e){case"focusin":case"focusout":Tf=null;break;case"dragenter":case"dragleave":Ef=null;break;case"mouseover":case"mouseout":Sf=null;break;case"pointerover":case"pointerout":rx.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ix.delete(t.pointerId)}}function Vv(e,t,r,s,c,f){return e===null||e.nativeEvent!==f?(e={blockedOn:t,domEventName:r,eventSystemFlags:s,nativeEvent:f,targetContainers:[c]},t!==null&&(t=Jx(t),t!==null&&iD(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function Ree(e,t,r,s,c){switch(t){case"focusin":return Tf=Vv(Tf,e,t,r,s,c),!0;case"dragenter":return Ef=Vv(Ef,e,t,r,s,c),!0;case"mouseover":return Sf=Vv(Sf,e,t,r,s,c),!0;case"pointerover":var f=c.pointerId;return rx.set(f,Vv(rx.get(f)||null,e,t,r,s,c)),!0;case"gotpointercapture":return f=c.pointerId,ix.set(f,Vv(ix.get(f)||null,e,t,r,s,c)),!0}return!1}function w9(e){var t=gm(e.target);if(t!==null){var r=tg(t);if(r!==null){if(t=r.tag,t===13){if(t=u9(r),t!==null){e.blockedOn=t,b9(e.priority,function(){v9(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function gE(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=IM(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var s=new r.constructor(r.type,r);xM=s,r.target.dispatchEvent(s),xM=null}else return t=Jx(r),t!==null&&iD(t),e.blockedOn=r,!1;t.shift()}return!0}function HB(e,t,r){gE(e)&&r.delete(t)}function Mee(){SM=!1,Tf!==null&&gE(Tf)&&(Tf=null),Ef!==null&&gE(Ef)&&(Ef=null),Sf!==null&&gE(Sf)&&(Sf=null),rx.forEach(HB),ix.forEach(HB)}function $v(e,t){e.blockedOn===t&&(e.blockedOn=null,SM||(SM=!0,wl.unstable_scheduleCallback(wl.unstable_NormalPriority,Mee)))}function sx(e){function t(c){return $v(c,e)}if(0<kT.length){$v(kT[0],e);for(var r=1;r<kT.length;r++){var s=kT[r];s.blockedOn===e&&(s.blockedOn=null)}}for(Tf!==null&&$v(Tf,e),Ef!==null&&$v(Ef,e),Sf!==null&&$v(Sf,e),rx.forEach(t),ix.forEach(t),r=0;r<uf.length;r++)s=uf[r],s.blockedOn===e&&(s.blockedOn=null);for(;0<uf.length&&(r=uf[0],r.blockedOn===null);)w9(r),r.blockedOn===null&&uf.shift()}var ay=od.ReactCurrentBatchConfig,nS=!0;function kee(e,t,r,s){var c=Mi,f=ay.transition;ay.transition=null;try{Mi=1,sD(e,t,r,s)}finally{Mi=c,ay.transition=f}}function Dee(e,t,r,s){var c=Mi,f=ay.transition;ay.transition=null;try{Mi=4,sD(e,t,r,s)}finally{Mi=c,ay.transition=f}}function sD(e,t,r,s){if(nS){var c=IM(e,t,r,s);if(c===null)J3(e,t,s,rS,r),WB(e,s);else if(Ree(c,e,t,r,s))s.stopPropagation();else if(WB(e,s),t&4&&-1<Pee.indexOf(e)){for(;c!==null;){var f=Jx(c);if(f!==null&&y9(f),f=IM(e,t,r,s),f===null&&J3(e,t,s,rS,r),f===c)break;c=f}c!==null&&s.stopPropagation()}else J3(e,t,s,null,r)}}var rS=null;function IM(e,t,r,s){if(rS=null,e=tD(s),e=gm(e),e!==null)if(t=tg(e),t===null)e=null;else if(r=t.tag,r===13){if(e=u9(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return rS=e,null}function T9(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(xee()){case nD:return 1;case p9:return 4;case eS:case bee:return 16;case m9:return 536870912;default:return 16}default:return 16}}var gf=null,oD=null,_E=null;function E9(){if(_E)return _E;var e,t=oD,r=t.length,s,c="value"in gf?gf.value:gf.textContent,f=c.length;for(e=0;e<r&&t[e]===c[e];e++);var _=r-e;for(s=1;s<=_&&t[r-s]===c[f-s];s++);return _E=c.slice(e,1<s?1-s:void 0)}function yE(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function DT(){return!0}function ZB(){return!1}function El(e){function t(r,s,c,f,_){this._reactName=r,this._targetInst=c,this.type=s,this.nativeEvent=f,this.target=_,this.currentTarget=null;for(var x in e)e.hasOwnProperty(x)&&(r=e[x],this[x]=r?r(f):f[x]);return this.isDefaultPrevented=(f.defaultPrevented!=null?f.defaultPrevented:f.returnValue===!1)?DT:ZB,this.isPropagationStopped=ZB,this}return Is(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=DT)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=DT)},persist:function(){},isPersistent:DT}),t}var e0={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},aD=El(e0),Yx=Is({},e0,{view:0,detail:0}),Oee=El(Yx),q3,G3,qv,wI=Is({},Yx,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lD,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==qv&&(qv&&e.type==="mousemove"?(q3=e.screenX-qv.screenX,G3=e.screenY-qv.screenY):G3=q3=0,qv=e),q3)},movementY:function(e){return"movementY"in e?e.movementY:G3}}),XB=El(wI),Lee=Is({},wI,{dataTransfer:0}),zee=El(Lee),Nee=Is({},Yx,{relatedTarget:0}),W3=El(Nee),Fee=Is({},e0,{animationName:0,elapsedTime:0,pseudoElement:0}),Bee=El(Fee),jee=Is({},e0,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Uee=El(jee),Vee=Is({},e0,{data:0}),KB=El(Vee),$ee={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qee={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gee={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Wee(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Gee[e])?!!t[e]:!1}function lD(){return Wee}var Hee=Is({},Yx,{key:function(e){if(e.key){var t=$ee[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=yE(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?qee[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lD,charCode:function(e){return e.type==="keypress"?yE(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?yE(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Zee=El(Hee),Xee=Is({},wI,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),QB=El(Xee),Kee=Is({},Yx,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lD}),Qee=El(Kee),Yee=Is({},e0,{propertyName:0,elapsedTime:0,pseudoElement:0}),Jee=El(Yee),ete=Is({},wI,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),tte=El(ete),nte=[9,13,27,32],cD=Hh&&"CompositionEvent"in window,I1=null;Hh&&"documentMode"in document&&(I1=document.documentMode);var rte=Hh&&"TextEvent"in window&&!I1,S9=Hh&&(!cD||I1&&8<I1&&11>=I1),YB=" ",JB=!1;function I9(e,t){switch(e){case"keyup":return nte.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function C9(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var V_=!1;function ite(e,t){switch(e){case"compositionend":return C9(t);case"keypress":return t.which!==32?null:(JB=!0,YB);case"textInput":return e=t.data,e===YB&&JB?null:e;default:return null}}function ste(e,t){if(V_)return e==="compositionend"||!cD&&I9(e,t)?(e=E9(),_E=oD=gf=null,V_=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return S9&&t.locale!=="ko"?null:t.data;default:return null}}var ote={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function e6(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!ote[e.type]:t==="textarea"}function A9(e,t,r,s){s9(s),t=iS(t,"onChange"),0<t.length&&(r=new aD("onChange","change",null,r,s),e.push({event:r,listeners:t}))}var C1=null,ox=null;function ate(e){B9(e,0)}function TI(e){var t=G_(e);if(Y8(t))return e}function lte(e,t){if(e==="change")return t}var P9=!1;if(Hh){var H3;if(Hh){var Z3="oninput"in document;if(!Z3){var t6=document.createElement("div");t6.setAttribute("oninput","return;"),Z3=typeof t6.oninput=="function"}H3=Z3}else H3=!1;P9=H3&&(!document.documentMode||9<document.documentMode)}function n6(){C1&&(C1.detachEvent("onpropertychange",R9),ox=C1=null)}function R9(e){if(e.propertyName==="value"&&TI(ox)){var t=[];A9(t,ox,e,tD(e)),c9(ate,t)}}function cte(e,t,r){e==="focusin"?(n6(),C1=t,ox=r,C1.attachEvent("onpropertychange",R9)):e==="focusout"&&n6()}function ute(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return TI(ox)}function hte(e,t){if(e==="click")return TI(t)}function dte(e,t){if(e==="input"||e==="change")return TI(t)}function fte(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Wc=typeof Object.is=="function"?Object.is:fte;function ax(e,t){if(Wc(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var c=r[s];if(!lM.call(t,c)||!Wc(e[c],t[c]))return!1}return!0}function r6(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function i6(e,t){var r=r6(e);e=0;for(var s;r;){if(r.nodeType===3){if(s=e+r.textContent.length,e<=t&&s>=t)return{node:r,offset:t-e};e=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=r6(r)}}function M9(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?M9(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function k9(){for(var e=window,t=QE();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch(s){r=!1}if(r)e=t.contentWindow;else break;t=QE(e.document)}return t}function uD(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function pte(e){var t=k9(),r=e.focusedElem,s=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&M9(r.ownerDocument.documentElement,r)){if(s!==null&&uD(r)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var c=r.textContent.length,f=Math.min(s.start,c);s=s.end===void 0?f:Math.min(s.end,c),!e.extend&&f>s&&(c=s,s=f,f=c),c=i6(r,f);var _=i6(r,s);c&&_&&(e.rangeCount!==1||e.anchorNode!==c.node||e.anchorOffset!==c.offset||e.focusNode!==_.node||e.focusOffset!==_.offset)&&(t=t.createRange(),t.setStart(c.node,c.offset),e.removeAllRanges(),f>s?(e.addRange(t),e.extend(_.node,_.offset)):(t.setEnd(_.node,_.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mte=Hh&&"documentMode"in document&&11>=document.documentMode,$_=null,CM=null,A1=null,AM=!1;function s6(e,t,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;AM||$_==null||$_!==QE(s)||(s=$_,"selectionStart"in s&&uD(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),A1&&ax(A1,s)||(A1=s,s=iS(CM,"onSelect"),0<s.length&&(t=new aD("onSelect","select",null,t,r),e.push({event:t,listeners:s}),t.target=$_)))}function OT(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var q_={animationend:OT("Animation","AnimationEnd"),animationiteration:OT("Animation","AnimationIteration"),animationstart:OT("Animation","AnimationStart"),transitionend:OT("Transition","TransitionEnd")},X3={},D9={};Hh&&(D9=document.createElement("div").style,"AnimationEvent"in window||(delete q_.animationend.animation,delete q_.animationiteration.animation,delete q_.animationstart.animation),"TransitionEvent"in window||delete q_.transitionend.transition);function EI(e){if(X3[e])return X3[e];if(!q_[e])return e;var t=q_[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in D9)return X3[e]=t[r];return e}var O9=EI("animationend"),L9=EI("animationiteration"),z9=EI("animationstart"),N9=EI("transitionend"),F9=new Map,o6="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xf(e,t){F9.set(e,t),eg(t,[e])}for(var K3=0;K3<o6.length;K3++){var Q3=o6[K3],gte=Q3.toLowerCase(),_te=Q3[0].toUpperCase()+Q3.slice(1);Xf(gte,"on"+_te)}Xf(O9,"onAnimationEnd");Xf(L9,"onAnimationIteration");Xf(z9,"onAnimationStart");Xf("dblclick","onDoubleClick");Xf("focusin","onFocus");Xf("focusout","onBlur");Xf(N9,"onTransitionEnd");Ty("onMouseEnter",["mouseout","mouseover"]);Ty("onMouseLeave",["mouseout","mouseover"]);Ty("onPointerEnter",["pointerout","pointerover"]);Ty("onPointerLeave",["pointerout","pointerover"]);eg("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));eg("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));eg("onBeforeInput",["compositionend","keypress","textInput","paste"]);eg("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));eg("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));eg("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var c1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yte=new Set("cancel close invalid load scroll toggle".split(" ").concat(c1));function a6(e,t,r){var s=e.type||"unknown-event";e.currentTarget=r,gee(s,t,void 0,e),e.currentTarget=null}function B9(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var s=e[r],c=s.event;s=s.listeners;e:{var f=void 0;if(t)for(var _=s.length-1;0<=_;_--){var x=s[_],a=x.instance,I=x.currentTarget;if(x=x.listener,a!==f&&c.isPropagationStopped())break e;a6(c,x,I),f=a}else for(_=0;_<s.length;_++){if(x=s[_],a=x.instance,I=x.currentTarget,x=x.listener,a!==f&&c.isPropagationStopped())break e;a6(c,x,I),f=a}}}if(JE)throw e=TM,JE=!1,TM=null,e}function ts(e,t){var r=t[DM];r===void 0&&(r=t[DM]=new Set);var s=e+"__bubble";r.has(s)||(j9(t,e,2,!1),r.add(s))}function Y3(e,t,r){var s=0;t&&(s|=4),j9(r,e,s,t)}var LT="_reactListening"+Math.random().toString(36).slice(2);function lx(e){if(!e[LT]){e[LT]=!0,H8.forEach(function(r){r!=="selectionchange"&&(yte.has(r)||Y3(r,!1,e),Y3(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[LT]||(t[LT]=!0,Y3("selectionchange",!1,t))}}function j9(e,t,r,s){switch(T9(t)){case 1:var c=kee;break;case 4:c=Dee;break;default:c=sD}r=c.bind(null,t,r,e),c=void 0,!wM||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),s?c!==void 0?e.addEventListener(t,r,{capture:!0,passive:c}):e.addEventListener(t,r,!0):c!==void 0?e.addEventListener(t,r,{passive:c}):e.addEventListener(t,r,!1)}function J3(e,t,r,s,c){var f=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var _=s.tag;if(_===3||_===4){var x=s.stateNode.containerInfo;if(x===c||x.nodeType===8&&x.parentNode===c)break;if(_===4)for(_=s.return;_!==null;){var a=_.tag;if((a===3||a===4)&&(a=_.stateNode.containerInfo,a===c||a.nodeType===8&&a.parentNode===c))return;_=_.return}for(;x!==null;){if(_=gm(x),_===null)return;if(a=_.tag,a===5||a===6){s=f=_;continue e}x=x.parentNode}}s=s.return}c9(function(){var I=f,D=tD(r),O=[];e:{var F=F9.get(e);if(F!==void 0){var H=aD,Q=e;switch(e){case"keypress":if(yE(r)===0)break e;case"keydown":case"keyup":H=Zee;break;case"focusin":Q="focus",H=W3;break;case"focusout":Q="blur",H=W3;break;case"beforeblur":case"afterblur":H=W3;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":H=XB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":H=zee;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":H=Qee;break;case O9:case L9:case z9:H=Bee;break;case N9:H=Jee;break;case"scroll":H=Oee;break;case"wheel":H=tte;break;case"copy":case"cut":case"paste":H=Uee;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":H=QB}var ie=(t&4)!==0,te=!ie&&e==="scroll",W=ie?F!==null?F+"Capture":null:F;ie=[];for(var X=I,ee;X!==null;){ee=X;var fe=ee.stateNode;if(ee.tag===5&&fe!==null&&(ee=fe,W!==null&&(fe=nx(X,W),fe!=null&&ie.push(cx(X,fe,ee)))),te)break;X=X.return}0<ie.length&&(F=new H(F,Q,null,r,D),O.push({event:F,listeners:ie}))}}if(!(t&7)){e:{if(F=e==="mouseover"||e==="pointerover",H=e==="mouseout"||e==="pointerout",F&&r!==xM&&(Q=r.relatedTarget||r.fromElement)&&(gm(Q)||Q[Zh]))break e;if((H||F)&&(F=D.window===D?D:(F=D.ownerDocument)?F.defaultView||F.parentWindow:window,H?(Q=r.relatedTarget||r.toElement,H=I,Q=Q?gm(Q):null,Q!==null&&(te=tg(Q),Q!==te||Q.tag!==5&&Q.tag!==6)&&(Q=null)):(H=null,Q=I),H!==Q)){if(ie=XB,fe="onMouseLeave",W="onMouseEnter",X="mouse",(e==="pointerout"||e==="pointerover")&&(ie=QB,fe="onPointerLeave",W="onPointerEnter",X="pointer"),te=H==null?F:G_(H),ee=Q==null?F:G_(Q),F=new ie(fe,X+"leave",H,r,D),F.target=te,F.relatedTarget=ee,fe=null,gm(D)===I&&(ie=new ie(W,X+"enter",Q,r,D),ie.target=ee,ie.relatedTarget=te,fe=ie),te=fe,H&&Q)t:{for(ie=H,W=Q,X=0,ee=ie;ee;ee=T_(ee))X++;for(ee=0,fe=W;fe;fe=T_(fe))ee++;for(;0<X-ee;)ie=T_(ie),X--;for(;0<ee-X;)W=T_(W),ee--;for(;X--;){if(ie===W||W!==null&&ie===W.alternate)break t;ie=T_(ie),W=T_(W)}ie=null}else ie=null;H!==null&&l6(O,F,H,ie,!1),Q!==null&&te!==null&&l6(O,te,Q,ie,!0)}}e:{if(F=I?G_(I):window,H=F.nodeName&&F.nodeName.toLowerCase(),H==="select"||H==="input"&&F.type==="file")var ye=lte;else if(e6(F))if(P9)ye=dte;else{ye=ute;var Ee=cte}else(H=F.nodeName)&&H.toLowerCase()==="input"&&(F.type==="checkbox"||F.type==="radio")&&(ye=hte);if(ye&&(ye=ye(e,I))){A9(O,ye,r,D);break e}Ee&&Ee(e,F,I),e==="focusout"&&(Ee=F._wrapperState)&&Ee.controlled&&F.type==="number"&&mM(F,"number",F.value)}switch(Ee=I?G_(I):window,e){case"focusin":(e6(Ee)||Ee.contentEditable==="true")&&($_=Ee,CM=I,A1=null);break;case"focusout":A1=CM=$_=null;break;case"mousedown":AM=!0;break;case"contextmenu":case"mouseup":case"dragend":AM=!1,s6(O,r,D);break;case"selectionchange":if(mte)break;case"keydown":case"keyup":s6(O,r,D)}var re;if(cD)e:{switch(e){case"compositionstart":var he="onCompositionStart";break e;case"compositionend":he="onCompositionEnd";break e;case"compositionupdate":he="onCompositionUpdate";break e}he=void 0}else V_?I9(e,r)&&(he="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(he="onCompositionStart");he&&(S9&&r.locale!=="ko"&&(V_||he!=="onCompositionStart"?he==="onCompositionEnd"&&V_&&(re=E9()):(gf=D,oD="value"in gf?gf.value:gf.textContent,V_=!0)),Ee=iS(I,he),0<Ee.length&&(he=new KB(he,e,null,r,D),O.push({event:he,listeners:Ee}),re?he.data=re:(re=C9(r),re!==null&&(he.data=re)))),(re=rte?ite(e,r):ste(e,r))&&(I=iS(I,"onBeforeInput"),0<I.length&&(D=new KB("onBeforeInput","beforeinput",null,r,D),O.push({event:D,listeners:I}),D.data=re))}B9(O,t)})}function cx(e,t,r){return{instance:e,listener:t,currentTarget:r}}function iS(e,t){for(var r=t+"Capture",s=[];e!==null;){var c=e,f=c.stateNode;c.tag===5&&f!==null&&(c=f,f=nx(e,r),f!=null&&s.unshift(cx(e,f,c)),f=nx(e,t),f!=null&&s.push(cx(e,f,c))),e=e.return}return s}function T_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function l6(e,t,r,s,c){for(var f=t._reactName,_=[];r!==null&&r!==s;){var x=r,a=x.alternate,I=x.stateNode;if(a!==null&&a===s)break;x.tag===5&&I!==null&&(x=I,c?(a=nx(r,f),a!=null&&_.unshift(cx(r,a,x))):c||(a=nx(r,f),a!=null&&_.push(cx(r,a,x)))),r=r.return}_.length!==0&&e.push({event:t,listeners:_})}var vte=/\r\n?/g,xte=/\u0000|\uFFFD/g;function c6(e){return(typeof e=="string"?e:""+e).replace(vte,`
`).replace(xte,"")}function zT(e,t,r){if(t=c6(t),c6(e)!==t&&r)throw Error(fn(425))}function sS(){}var PM=null,RM=null;function MM(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var kM=typeof setTimeout=="function"?setTimeout:void 0,bte=typeof clearTimeout=="function"?clearTimeout:void 0,u6=typeof Promise=="function"?Promise:void 0,wte=typeof queueMicrotask=="function"?queueMicrotask:typeof u6!="undefined"?function(e){return u6.resolve(null).then(e).catch(Tte)}:kM;function Tte(e){setTimeout(function(){throw e})}function eR(e,t){var r=t,s=0;do{var c=r.nextSibling;if(e.removeChild(r),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(s===0){e.removeChild(c),sx(t);return}s--}else r!=="$"&&r!=="$?"&&r!=="$!"||s++;r=c}while(r);sx(t)}function If(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function h6(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var t0=Math.random().toString(36).slice(2),Du="__reactFiber$"+t0,ux="__reactProps$"+t0,Zh="__reactContainer$"+t0,DM="__reactEvents$"+t0,Ete="__reactListeners$"+t0,Ste="__reactHandles$"+t0;function gm(e){var t=e[Du];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Zh]||r[Du]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=h6(e);e!==null;){if(r=e[Du])return r;e=h6(e)}return t}e=r,r=e.parentNode}return null}function Jx(e){return e=e[Du]||e[Zh],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function G_(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(fn(33))}function SI(e){return e[ux]||null}var OM=[],W_=-1;function Kf(e){return{current:e}}function as(e){0>W_||(e.current=OM[W_],OM[W_]=null,W_--)}function Qi(e,t){W_++,OM[W_]=e.current,e.current=t}var Ff={},ra=Kf(Ff),Ga=Kf(!1),zm=Ff;function Ey(e,t){var r=e.type.contextTypes;if(!r)return Ff;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var c={},f;for(f in r)c[f]=t[f];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=c),c}function Wa(e){return e=e.childContextTypes,e!=null}function oS(){as(Ga),as(ra)}function d6(e,t,r){if(ra.current!==Ff)throw Error(fn(168));Qi(ra,t),Qi(Ga,r)}function U9(e,t,r){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return r;s=s.getChildContext();for(var c in s)if(!(c in t))throw Error(fn(108,cee(e)||"Unknown",c));return Is({},r,s)}function aS(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ff,zm=ra.current,Qi(ra,e),Qi(Ga,Ga.current),!0}function f6(e,t,r){var s=e.stateNode;if(!s)throw Error(fn(169));r?(e=U9(e,t,zm),s.__reactInternalMemoizedMergedChildContext=e,as(Ga),as(ra),Qi(ra,e)):as(Ga),Qi(Ga,r)}var Oh=null,II=!1,tR=!1;function V9(e){Oh===null?Oh=[e]:Oh.push(e)}function Ite(e){II=!0,V9(e)}function Qf(){if(!tR&&Oh!==null){tR=!0;var e=0,t=Mi;try{var r=Oh;for(Mi=1;e<r.length;e++){var s=r[e];do s=s(!0);while(s!==null)}Oh=null,II=!1}catch(c){throw Oh!==null&&(Oh=Oh.slice(e+1)),f9(nD,Qf),c}finally{Mi=t,tR=!1}}return null}var H_=[],Z_=0,lS=null,cS=0,$l=[],ql=0,Nm=null,Nh=1,Fh="";function sm(e,t){H_[Z_++]=cS,H_[Z_++]=lS,lS=e,cS=t}function $9(e,t,r){$l[ql++]=Nh,$l[ql++]=Fh,$l[ql++]=Nm,Nm=e;var s=Nh;e=Fh;var c=32-Vc(s)-1;s&=~(1<<c),r+=1;var f=32-Vc(t)+c;if(30<f){var _=c-c%5;f=(s&(1<<_)-1).toString(32),s>>=_,c-=_,Nh=1<<32-Vc(t)+c|r<<c|s,Fh=f+e}else Nh=1<<f|r<<c|s,Fh=e}function hD(e){e.return!==null&&(sm(e,1),$9(e,1,0))}function dD(e){for(;e===lS;)lS=H_[--Z_],H_[Z_]=null,cS=H_[--Z_],H_[Z_]=null;for(;e===Nm;)Nm=$l[--ql],$l[ql]=null,Fh=$l[--ql],$l[ql]=null,Nh=$l[--ql],$l[ql]=null}var _l=null,dl=null,_s=!1,zc=null;function q9(e,t){var r=Kl(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function p6(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,_l=e,dl=If(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,_l=e,dl=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Nm!==null?{id:Nh,overflow:Fh}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Kl(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,_l=e,dl=null,!0):!1;default:return!1}}function LM(e){return(e.mode&1)!==0&&(e.flags&128)===0}function zM(e){if(_s){var t=dl;if(t){var r=t;if(!p6(e,t)){if(LM(e))throw Error(fn(418));t=If(r.nextSibling);var s=_l;t&&p6(e,t)?q9(s,r):(e.flags=e.flags&-4097|2,_s=!1,_l=e)}}else{if(LM(e))throw Error(fn(418));e.flags=e.flags&-4097|2,_s=!1,_l=e}}}function m6(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;_l=e}function NT(e){if(e!==_l)return!1;if(!_s)return m6(e),_s=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!MM(e.type,e.memoizedProps)),t&&(t=dl)){if(LM(e))throw G9(),Error(fn(418));for(;t;)q9(e,t),t=If(t.nextSibling)}if(m6(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(fn(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){dl=If(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}dl=null}}else dl=_l?If(e.stateNode.nextSibling):null;return!0}function G9(){for(var e=dl;e;)e=If(e.nextSibling)}function Sy(){dl=_l=null,_s=!1}function fD(e){zc===null?zc=[e]:zc.push(e)}var Cte=od.ReactCurrentBatchConfig;function Gv(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(fn(309));var s=r.stateNode}if(!s)throw Error(fn(147,e));var c=s,f=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===f?t.ref:(t=function(_){var x=c.refs;_===null?delete x[f]:x[f]=_},t._stringRef=f,t)}if(typeof e!="string")throw Error(fn(284));if(!r._owner)throw Error(fn(290,e))}return e}function FT(e,t){throw e=Object.prototype.toString.call(t),Error(fn(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function g6(e){var t=e._init;return t(e._payload)}function W9(e){function t(W,X){if(e){var ee=W.deletions;ee===null?(W.deletions=[X],W.flags|=16):ee.push(X)}}function r(W,X){if(!e)return null;for(;X!==null;)t(W,X),X=X.sibling;return null}function s(W,X){for(W=new Map;X!==null;)X.key!==null?W.set(X.key,X):W.set(X.index,X),X=X.sibling;return W}function c(W,X){return W=Rf(W,X),W.index=0,W.sibling=null,W}function f(W,X,ee){return W.index=ee,e?(ee=W.alternate,ee!==null?(ee=ee.index,ee<X?(W.flags|=2,X):ee):(W.flags|=2,X)):(W.flags|=1048576,X)}function _(W){return e&&W.alternate===null&&(W.flags|=2),W}function x(W,X,ee,fe){return X===null||X.tag!==6?(X=lR(ee,W.mode,fe),X.return=W,X):(X=c(X,ee),X.return=W,X)}function a(W,X,ee,fe){var ye=ee.type;return ye===U_?D(W,X,ee.props.children,fe,ee.key):X!==null&&(X.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===lf&&g6(ye)===X.type)?(fe=c(X,ee.props),fe.ref=Gv(W,X,ee),fe.return=W,fe):(fe=SE(ee.type,ee.key,ee.props,null,W.mode,fe),fe.ref=Gv(W,X,ee),fe.return=W,fe)}function I(W,X,ee,fe){return X===null||X.tag!==4||X.stateNode.containerInfo!==ee.containerInfo||X.stateNode.implementation!==ee.implementation?(X=cR(ee,W.mode,fe),X.return=W,X):(X=c(X,ee.children||[]),X.return=W,X)}function D(W,X,ee,fe,ye){return X===null||X.tag!==7?(X=Im(ee,W.mode,fe,ye),X.return=W,X):(X=c(X,ee),X.return=W,X)}function O(W,X,ee){if(typeof X=="string"&&X!==""||typeof X=="number")return X=lR(""+X,W.mode,ee),X.return=W,X;if(typeof X=="object"&&X!==null){switch(X.$$typeof){case CT:return ee=SE(X.type,X.key,X.props,null,W.mode,ee),ee.ref=Gv(W,null,X),ee.return=W,ee;case j_:return X=cR(X,W.mode,ee),X.return=W,X;case lf:var fe=X._init;return O(W,fe(X._payload),ee)}if(a1(X)||jv(X))return X=Im(X,W.mode,ee,null),X.return=W,X;FT(W,X)}return null}function F(W,X,ee,fe){var ye=X!==null?X.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number")return ye!==null?null:x(W,X,""+ee,fe);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case CT:return ee.key===ye?a(W,X,ee,fe):null;case j_:return ee.key===ye?I(W,X,ee,fe):null;case lf:return ye=ee._init,F(W,X,ye(ee._payload),fe)}if(a1(ee)||jv(ee))return ye!==null?null:D(W,X,ee,fe,null);FT(W,ee)}return null}function H(W,X,ee,fe,ye){if(typeof fe=="string"&&fe!==""||typeof fe=="number")return W=W.get(ee)||null,x(X,W,""+fe,ye);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case CT:return W=W.get(fe.key===null?ee:fe.key)||null,a(X,W,fe,ye);case j_:return W=W.get(fe.key===null?ee:fe.key)||null,I(X,W,fe,ye);case lf:var Ee=fe._init;return H(W,X,ee,Ee(fe._payload),ye)}if(a1(fe)||jv(fe))return W=W.get(ee)||null,D(X,W,fe,ye,null);FT(X,fe)}return null}function Q(W,X,ee,fe){for(var ye=null,Ee=null,re=X,he=X=0,_e=null;re!==null&&he<ee.length;he++){re.index>he?(_e=re,re=null):_e=re.sibling;var Se=F(W,re,ee[he],fe);if(Se===null){re===null&&(re=_e);break}e&&re&&Se.alternate===null&&t(W,re),X=f(Se,X,he),Ee===null?ye=Se:Ee.sibling=Se,Ee=Se,re=_e}if(he===ee.length)return r(W,re),_s&&sm(W,he),ye;if(re===null){for(;he<ee.length;he++)re=O(W,ee[he],fe),re!==null&&(X=f(re,X,he),Ee===null?ye=re:Ee.sibling=re,Ee=re);return _s&&sm(W,he),ye}for(re=s(W,re);he<ee.length;he++)_e=H(re,W,he,ee[he],fe),_e!==null&&(e&&_e.alternate!==null&&re.delete(_e.key===null?he:_e.key),X=f(_e,X,he),Ee===null?ye=_e:Ee.sibling=_e,Ee=_e);return e&&re.forEach(function(J){return t(W,J)}),_s&&sm(W,he),ye}function ie(W,X,ee,fe){var ye=jv(ee);if(typeof ye!="function")throw Error(fn(150));if(ee=ye.call(ee),ee==null)throw Error(fn(151));for(var Ee=ye=null,re=X,he=X=0,_e=null,Se=ee.next();re!==null&&!Se.done;he++,Se=ee.next()){re.index>he?(_e=re,re=null):_e=re.sibling;var J=F(W,re,Se.value,fe);if(J===null){re===null&&(re=_e);break}e&&re&&J.alternate===null&&t(W,re),X=f(J,X,he),Ee===null?ye=J:Ee.sibling=J,Ee=J,re=_e}if(Se.done)return r(W,re),_s&&sm(W,he),ye;if(re===null){for(;!Se.done;he++,Se=ee.next())Se=O(W,Se.value,fe),Se!==null&&(X=f(Se,X,he),Ee===null?ye=Se:Ee.sibling=Se,Ee=Se);return _s&&sm(W,he),ye}for(re=s(W,re);!Se.done;he++,Se=ee.next())Se=H(re,W,he,Se.value,fe),Se!==null&&(e&&Se.alternate!==null&&re.delete(Se.key===null?he:Se.key),X=f(Se,X,he),Ee===null?ye=Se:Ee.sibling=Se,Ee=Se);return e&&re.forEach(function(Ie){return t(W,Ie)}),_s&&sm(W,he),ye}function te(W,X,ee,fe){if(typeof ee=="object"&&ee!==null&&ee.type===U_&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case CT:e:{for(var ye=ee.key,Ee=X;Ee!==null;){if(Ee.key===ye){if(ye=ee.type,ye===U_){if(Ee.tag===7){r(W,Ee.sibling),X=c(Ee,ee.props.children),X.return=W,W=X;break e}}else if(Ee.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===lf&&g6(ye)===Ee.type){r(W,Ee.sibling),X=c(Ee,ee.props),X.ref=Gv(W,Ee,ee),X.return=W,W=X;break e}r(W,Ee);break}else t(W,Ee);Ee=Ee.sibling}ee.type===U_?(X=Im(ee.props.children,W.mode,fe,ee.key),X.return=W,W=X):(fe=SE(ee.type,ee.key,ee.props,null,W.mode,fe),fe.ref=Gv(W,X,ee),fe.return=W,W=fe)}return _(W);case j_:e:{for(Ee=ee.key;X!==null;){if(X.key===Ee)if(X.tag===4&&X.stateNode.containerInfo===ee.containerInfo&&X.stateNode.implementation===ee.implementation){r(W,X.sibling),X=c(X,ee.children||[]),X.return=W,W=X;break e}else{r(W,X);break}else t(W,X);X=X.sibling}X=cR(ee,W.mode,fe),X.return=W,W=X}return _(W);case lf:return Ee=ee._init,te(W,X,Ee(ee._payload),fe)}if(a1(ee))return Q(W,X,ee,fe);if(jv(ee))return ie(W,X,ee,fe);FT(W,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"?(ee=""+ee,X!==null&&X.tag===6?(r(W,X.sibling),X=c(X,ee),X.return=W,W=X):(r(W,X),X=lR(ee,W.mode,fe),X.return=W,W=X),_(W)):r(W,X)}return te}var Iy=W9(!0),H9=W9(!1),uS=Kf(null),hS=null,X_=null,pD=null;function mD(){pD=X_=hS=null}function gD(e){var t=uS.current;as(uS),e._currentValue=t}function NM(e,t,r){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===r)break;e=e.return}}function ly(e,t){hS=e,pD=X_=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&($a=!0),e.firstContext=null)}function Jl(e){var t=e._currentValue;if(pD!==e)if(e={context:e,memoizedValue:t,next:null},X_===null){if(hS===null)throw Error(fn(308));X_=e,hS.dependencies={lanes:0,firstContext:e}}else X_=X_.next=e;return t}var _m=null;function _D(e){_m===null?_m=[e]:_m.push(e)}function Z9(e,t,r,s){var c=t.interleaved;return c===null?(r.next=r,_D(t)):(r.next=c.next,c.next=r),t.interleaved=r,Xh(e,s)}function Xh(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var cf=!1;function yD(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function X9(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Vh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Cf(e,t,r){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,li&2){var c=s.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),s.pending=t,Xh(e,r)}return c=s.interleaved,c===null?(t.next=t,_D(s)):(t.next=c.next,c.next=t),s.interleaved=t,Xh(e,r)}function vE(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,rD(e,r)}}function _6(e,t){var r=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var c=null,f=null;if(r=r.firstBaseUpdate,r!==null){do{var _={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};f===null?c=f=_:f=f.next=_,r=r.next}while(r!==null);f===null?c=f=t:f=f.next=t}else c=f=t;r={baseState:s.baseState,firstBaseUpdate:c,lastBaseUpdate:f,shared:s.shared,effects:s.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function dS(e,t,r,s){var c=e.updateQueue;cf=!1;var f=c.firstBaseUpdate,_=c.lastBaseUpdate,x=c.shared.pending;if(x!==null){c.shared.pending=null;var a=x,I=a.next;a.next=null,_===null?f=I:_.next=I,_=a;var D=e.alternate;D!==null&&(D=D.updateQueue,x=D.lastBaseUpdate,x!==_&&(x===null?D.firstBaseUpdate=I:x.next=I,D.lastBaseUpdate=a))}if(f!==null){var O=c.baseState;_=0,D=I=a=null,x=f;do{var F=x.lane,H=x.eventTime;if((s&F)===F){D!==null&&(D=D.next={eventTime:H,lane:0,tag:x.tag,payload:x.payload,callback:x.callback,next:null});e:{var Q=e,ie=x;switch(F=t,H=r,ie.tag){case 1:if(Q=ie.payload,typeof Q=="function"){O=Q.call(H,O,F);break e}O=Q;break e;case 3:Q.flags=Q.flags&-65537|128;case 0:if(Q=ie.payload,F=typeof Q=="function"?Q.call(H,O,F):Q,F==null)break e;O=Is({},O,F);break e;case 2:cf=!0}}x.callback!==null&&x.lane!==0&&(e.flags|=64,F=c.effects,F===null?c.effects=[x]:F.push(x))}else H={eventTime:H,lane:F,tag:x.tag,payload:x.payload,callback:x.callback,next:null},D===null?(I=D=H,a=O):D=D.next=H,_|=F;if(x=x.next,x===null){if(x=c.shared.pending,x===null)break;F=x,x=F.next,F.next=null,c.lastBaseUpdate=F,c.shared.pending=null}}while(!0);if(D===null&&(a=O),c.baseState=a,c.firstBaseUpdate=I,c.lastBaseUpdate=D,t=c.shared.interleaved,t!==null){c=t;do _|=c.lane,c=c.next;while(c!==t)}else f===null&&(c.shared.lanes=0);Bm|=_,e.lanes=_,e.memoizedState=O}}function y6(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],c=s.callback;if(c!==null){if(s.callback=null,s=r,typeof c!="function")throw Error(fn(191,c));c.call(s)}}}var eb={},Bu=Kf(eb),hx=Kf(eb),dx=Kf(eb);function ym(e){if(e===eb)throw Error(fn(174));return e}function vD(e,t){switch(Qi(dx,t),Qi(hx,e),Qi(Bu,eb),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:_M(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=_M(t,e)}as(Bu),Qi(Bu,t)}function Cy(){as(Bu),as(hx),as(dx)}function K9(e){ym(dx.current);var t=ym(Bu.current),r=_M(t,e.type);t!==r&&(Qi(hx,e),Qi(Bu,r))}function xD(e){hx.current===e&&(as(Bu),as(hx))}var Es=Kf(0);function fS(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var nR=[];function bD(){for(var e=0;e<nR.length;e++)nR[e]._workInProgressVersionPrimary=null;nR.length=0}var xE=od.ReactCurrentDispatcher,rR=od.ReactCurrentBatchConfig,Fm=0,Ss=null,mo=null,So=null,pS=!1,P1=!1,fx=0,Ate=0;function Zo(){throw Error(fn(321))}function wD(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Wc(e[r],t[r]))return!1;return!0}function TD(e,t,r,s,c,f){if(Fm=f,Ss=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xE.current=e===null||e.memoizedState===null?kte:Dte,e=r(s,c),P1){f=0;do{if(P1=!1,fx=0,25<=f)throw Error(fn(301));f+=1,So=mo=null,t.updateQueue=null,xE.current=Ote,e=r(s,c)}while(P1)}if(xE.current=mS,t=mo!==null&&mo.next!==null,Fm=0,So=mo=Ss=null,pS=!1,t)throw Error(fn(300));return e}function ED(){var e=fx!==0;return fx=0,e}function Iu(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return So===null?Ss.memoizedState=So=e:So=So.next=e,So}function ec(){if(mo===null){var e=Ss.alternate;e=e!==null?e.memoizedState:null}else e=mo.next;var t=So===null?Ss.memoizedState:So.next;if(t!==null)So=t,mo=e;else{if(e===null)throw Error(fn(310));mo=e,e={memoizedState:mo.memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},So===null?Ss.memoizedState=So=e:So=So.next=e}return So}function px(e,t){return typeof t=="function"?t(e):t}function iR(e){var t=ec(),r=t.queue;if(r===null)throw Error(fn(311));r.lastRenderedReducer=e;var s=mo,c=s.baseQueue,f=r.pending;if(f!==null){if(c!==null){var _=c.next;c.next=f.next,f.next=_}s.baseQueue=c=f,r.pending=null}if(c!==null){f=c.next,s=s.baseState;var x=_=null,a=null,I=f;do{var D=I.lane;if((Fm&D)===D)a!==null&&(a=a.next={lane:0,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null}),s=I.hasEagerState?I.eagerState:e(s,I.action);else{var O={lane:D,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null};a===null?(x=a=O,_=s):a=a.next=O,Ss.lanes|=D,Bm|=D}I=I.next}while(I!==null&&I!==f);a===null?_=s:a.next=x,Wc(s,t.memoizedState)||($a=!0),t.memoizedState=s,t.baseState=_,t.baseQueue=a,r.lastRenderedState=s}if(e=r.interleaved,e!==null){c=e;do f=c.lane,Ss.lanes|=f,Bm|=f,c=c.next;while(c!==e)}else c===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function sR(e){var t=ec(),r=t.queue;if(r===null)throw Error(fn(311));r.lastRenderedReducer=e;var s=r.dispatch,c=r.pending,f=t.memoizedState;if(c!==null){r.pending=null;var _=c=c.next;do f=e(f,_.action),_=_.next;while(_!==c);Wc(f,t.memoizedState)||($a=!0),t.memoizedState=f,t.baseQueue===null&&(t.baseState=f),r.lastRenderedState=f}return[f,s]}function Q9(){}function Y9(e,t){var r=Ss,s=ec(),c=t(),f=!Wc(s.memoizedState,c);if(f&&(s.memoizedState=c,$a=!0),s=s.queue,SD(t7.bind(null,r,s,e),[e]),s.getSnapshot!==t||f||So!==null&&So.memoizedState.tag&1){if(r.flags|=2048,mx(9,e7.bind(null,r,s,c,t),void 0,null),Co===null)throw Error(fn(349));Fm&30||J9(r,t,c)}return c}function J9(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Ss.updateQueue,t===null?(t={lastEffect:null,stores:null},Ss.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function e7(e,t,r,s){t.value=r,t.getSnapshot=s,n7(t)&&r7(e)}function t7(e,t,r){return r(function(){n7(t)&&r7(e)})}function n7(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Wc(e,r)}catch(s){return!0}}function r7(e){var t=Xh(e,1);t!==null&&$c(t,e,1,-1)}function v6(e){var t=Iu();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:px,lastRenderedState:e},t.queue=e,e=e.dispatch=Mte.bind(null,Ss,e),[t.memoizedState,e]}function mx(e,t,r,s){return e={tag:e,create:t,destroy:r,deps:s,next:null},t=Ss.updateQueue,t===null?(t={lastEffect:null,stores:null},Ss.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(s=r.next,r.next=e,e.next=s,t.lastEffect=e)),e}function i7(){return ec().memoizedState}function bE(e,t,r,s){var c=Iu();Ss.flags|=e,c.memoizedState=mx(1|t,r,void 0,s===void 0?null:s)}function CI(e,t,r,s){var c=ec();s=s===void 0?null:s;var f=void 0;if(mo!==null){var _=mo.memoizedState;if(f=_.destroy,s!==null&&wD(s,_.deps)){c.memoizedState=mx(t,r,f,s);return}}Ss.flags|=e,c.memoizedState=mx(1|t,r,f,s)}function x6(e,t){return bE(8390656,8,e,t)}function SD(e,t){return CI(2048,8,e,t)}function s7(e,t){return CI(4,2,e,t)}function o7(e,t){return CI(4,4,e,t)}function a7(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function l7(e,t,r){return r=r!=null?r.concat([e]):null,CI(4,4,a7.bind(null,t,e),r)}function ID(){}function c7(e,t){var r=ec();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&wD(t,s[1])?s[0]:(r.memoizedState=[e,t],e)}function u7(e,t){var r=ec();t=t===void 0?null:t;var s=r.memoizedState;return s!==null&&t!==null&&wD(t,s[1])?s[0]:(e=e(),r.memoizedState=[e,t],e)}function h7(e,t,r){return Fm&21?(Wc(r,t)||(r=g9(),Ss.lanes|=r,Bm|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,$a=!0),e.memoizedState=r)}function Pte(e,t){var r=Mi;Mi=r!==0&&4>r?r:4,e(!0);var s=rR.transition;rR.transition={};try{e(!1),t()}finally{Mi=r,rR.transition=s}}function d7(){return ec().memoizedState}function Rte(e,t,r){var s=Pf(e);if(r={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null},f7(e))p7(t,r);else if(r=Z9(e,t,r,s),r!==null){var c=Ea();$c(r,e,s,c),m7(r,t,s)}}function Mte(e,t,r){var s=Pf(e),c={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null};if(f7(e))p7(t,c);else{var f=e.alternate;if(e.lanes===0&&(f===null||f.lanes===0)&&(f=t.lastRenderedReducer,f!==null))try{var _=t.lastRenderedState,x=f(_,r);if(c.hasEagerState=!0,c.eagerState=x,Wc(x,_)){var a=t.interleaved;a===null?(c.next=c,_D(t)):(c.next=a.next,a.next=c),t.interleaved=c;return}}catch(I){}finally{}r=Z9(e,t,c,s),r!==null&&(c=Ea(),$c(r,e,s,c),m7(r,t,s))}}function f7(e){var t=e.alternate;return e===Ss||t!==null&&t===Ss}function p7(e,t){P1=pS=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function m7(e,t,r){if(r&4194240){var s=t.lanes;s&=e.pendingLanes,r|=s,t.lanes=r,rD(e,r)}}var mS={readContext:Jl,useCallback:Zo,useContext:Zo,useEffect:Zo,useImperativeHandle:Zo,useInsertionEffect:Zo,useLayoutEffect:Zo,useMemo:Zo,useReducer:Zo,useRef:Zo,useState:Zo,useDebugValue:Zo,useDeferredValue:Zo,useTransition:Zo,useMutableSource:Zo,useSyncExternalStore:Zo,useId:Zo,unstable_isNewReconciler:!1},kte={readContext:Jl,useCallback:function(e,t){return Iu().memoizedState=[e,t===void 0?null:t],e},useContext:Jl,useEffect:x6,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,bE(4194308,4,a7.bind(null,t,e),r)},useLayoutEffect:function(e,t){return bE(4194308,4,e,t)},useInsertionEffect:function(e,t){return bE(4,2,e,t)},useMemo:function(e,t){var r=Iu();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var s=Iu();return t=r!==void 0?r(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=Rte.bind(null,Ss,e),[s.memoizedState,e]},useRef:function(e){var t=Iu();return e={current:e},t.memoizedState=e},useState:v6,useDebugValue:ID,useDeferredValue:function(e){return Iu().memoizedState=e},useTransition:function(){var e=v6(!1),t=e[0];return e=Pte.bind(null,e[1]),Iu().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var s=Ss,c=Iu();if(_s){if(r===void 0)throw Error(fn(407));r=r()}else{if(r=t(),Co===null)throw Error(fn(349));Fm&30||J9(s,t,r)}c.memoizedState=r;var f={value:r,getSnapshot:t};return c.queue=f,x6(t7.bind(null,s,f,e),[e]),s.flags|=2048,mx(9,e7.bind(null,s,f,r,t),void 0,null),r},useId:function(){var e=Iu(),t=Co.identifierPrefix;if(_s){var r=Fh,s=Nh;r=(s&~(1<<32-Vc(s)-1)).toString(32)+r,t=":"+t+"R"+r,r=fx++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Ate++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Dte={readContext:Jl,useCallback:c7,useContext:Jl,useEffect:SD,useImperativeHandle:l7,useInsertionEffect:s7,useLayoutEffect:o7,useMemo:u7,useReducer:iR,useRef:i7,useState:function(){return iR(px)},useDebugValue:ID,useDeferredValue:function(e){var t=ec();return h7(t,mo.memoizedState,e)},useTransition:function(){var e=iR(px)[0],t=ec().memoizedState;return[e,t]},useMutableSource:Q9,useSyncExternalStore:Y9,useId:d7,unstable_isNewReconciler:!1},Ote={readContext:Jl,useCallback:c7,useContext:Jl,useEffect:SD,useImperativeHandle:l7,useInsertionEffect:s7,useLayoutEffect:o7,useMemo:u7,useReducer:sR,useRef:i7,useState:function(){return sR(px)},useDebugValue:ID,useDeferredValue:function(e){var t=ec();return mo===null?t.memoizedState=e:h7(t,mo.memoizedState,e)},useTransition:function(){var e=sR(px)[0],t=ec().memoizedState;return[e,t]},useMutableSource:Q9,useSyncExternalStore:Y9,useId:d7,unstable_isNewReconciler:!1};function Oc(e,t){if(e&&e.defaultProps){t=Is({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function FM(e,t,r,s){t=e.memoizedState,r=r(s,t),r=r==null?t:Is({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var AI={isMounted:function(e){return(e=e._reactInternals)?tg(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var s=Ea(),c=Pf(e),f=Vh(s,c);f.payload=t,r!=null&&(f.callback=r),t=Cf(e,f,c),t!==null&&($c(t,e,c,s),vE(t,e,c))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var s=Ea(),c=Pf(e),f=Vh(s,c);f.tag=1,f.payload=t,r!=null&&(f.callback=r),t=Cf(e,f,c),t!==null&&($c(t,e,c,s),vE(t,e,c))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Ea(),s=Pf(e),c=Vh(r,s);c.tag=2,t!=null&&(c.callback=t),t=Cf(e,c,s),t!==null&&($c(t,e,s,r),vE(t,e,s))}};function b6(e,t,r,s,c,f,_){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,f,_):t.prototype&&t.prototype.isPureReactComponent?!ax(r,s)||!ax(c,f):!0}function g7(e,t,r){var s=!1,c=Ff,f=t.contextType;return typeof f=="object"&&f!==null?f=Jl(f):(c=Wa(t)?zm:ra.current,s=t.contextTypes,f=(s=s!=null)?Ey(e,c):Ff),t=new t(r,f),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=AI,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=c,e.__reactInternalMemoizedMaskedChildContext=f),t}function w6(e,t,r,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,s),t.state!==e&&AI.enqueueReplaceState(t,t.state,null)}function BM(e,t,r,s){var c=e.stateNode;c.props=r,c.state=e.memoizedState,c.refs={},yD(e);var f=t.contextType;typeof f=="object"&&f!==null?c.context=Jl(f):(f=Wa(t)?zm:ra.current,c.context=Ey(e,f)),c.state=e.memoizedState,f=t.getDerivedStateFromProps,typeof f=="function"&&(FM(e,t,f,r),c.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(t=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),t!==c.state&&AI.enqueueReplaceState(c,c.state,null),dS(e,r,c,s),c.state=e.memoizedState),typeof c.componentDidMount=="function"&&(e.flags|=4194308)}function Ay(e,t){try{var r="",s=t;do r+=lee(s),s=s.return;while(s);var c=r}catch(f){c=`
Error generating stack: `+f.message+`
`+f.stack}return{value:e,source:t,stack:c,digest:null}}function oR(e,t,r){return{value:e,source:null,stack:r!=null?r:null,digest:t!=null?t:null}}function jM(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Lte=typeof WeakMap=="function"?WeakMap:Map;function _7(e,t,r){r=Vh(-1,r),r.tag=3,r.payload={element:null};var s=t.value;return r.callback=function(){_S||(_S=!0,KM=s),jM(e,t)},r}function y7(e,t,r){r=Vh(-1,r),r.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var c=t.value;r.payload=function(){return s(c)},r.callback=function(){jM(e,t)}}var f=e.stateNode;return f!==null&&typeof f.componentDidCatch=="function"&&(r.callback=function(){jM(e,t),typeof s!="function"&&(Af===null?Af=new Set([this]):Af.add(this));var _=t.stack;this.componentDidCatch(t.value,{componentStack:_!==null?_:""})}),r}function T6(e,t,r){var s=e.pingCache;if(s===null){s=e.pingCache=new Lte;var c=new Set;s.set(t,c)}else c=s.get(t),c===void 0&&(c=new Set,s.set(t,c));c.has(r)||(c.add(r),e=Xte.bind(null,e,t,r),t.then(e,e))}function E6(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function S6(e,t,r,s,c){return e.mode&1?(e.flags|=65536,e.lanes=c,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Vh(-1,1),t.tag=2,Cf(r,t,1))),r.lanes|=1),e)}var zte=od.ReactCurrentOwner,$a=!1;function ba(e,t,r,s){t.child=e===null?H9(t,null,r,s):Iy(t,e.child,r,s)}function I6(e,t,r,s,c){r=r.render;var f=t.ref;return ly(t,c),s=TD(e,t,r,s,f,c),r=ED(),e!==null&&!$a?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Kh(e,t,c)):(_s&&r&&hD(t),t.flags|=1,ba(e,t,s,c),t.child)}function C6(e,t,r,s,c){if(e===null){var f=r.type;return typeof f=="function"&&!OD(f)&&f.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=f,v7(e,t,f,s,c)):(e=SE(r.type,null,s,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(f=e.child,!(e.lanes&c)){var _=f.memoizedProps;if(r=r.compare,r=r!==null?r:ax,r(_,s)&&e.ref===t.ref)return Kh(e,t,c)}return t.flags|=1,e=Rf(f,s),e.ref=t.ref,e.return=t,t.child=e}function v7(e,t,r,s,c){if(e!==null){var f=e.memoizedProps;if(ax(f,s)&&e.ref===t.ref)if($a=!1,t.pendingProps=s=f,(e.lanes&c)!==0)e.flags&131072&&($a=!0);else return t.lanes=e.lanes,Kh(e,t,c)}return UM(e,t,r,s,c)}function x7(e,t,r){var s=t.pendingProps,c=s.children,f=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qi(Q_,ul),ul|=r;else{if(!(r&1073741824))return e=f!==null?f.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Qi(Q_,ul),ul|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=f!==null?f.baseLanes:r,Qi(Q_,ul),ul|=s}else f!==null?(s=f.baseLanes|r,t.memoizedState=null):s=r,Qi(Q_,ul),ul|=s;return ba(e,t,c,r),t.child}function b7(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function UM(e,t,r,s,c){var f=Wa(r)?zm:ra.current;return f=Ey(t,f),ly(t,c),r=TD(e,t,r,s,f,c),s=ED(),e!==null&&!$a?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Kh(e,t,c)):(_s&&s&&hD(t),t.flags|=1,ba(e,t,r,c),t.child)}function A6(e,t,r,s,c){if(Wa(r)){var f=!0;aS(t)}else f=!1;if(ly(t,c),t.stateNode===null)wE(e,t),g7(t,r,s),BM(t,r,s,c),s=!0;else if(e===null){var _=t.stateNode,x=t.memoizedProps;_.props=x;var a=_.context,I=r.contextType;typeof I=="object"&&I!==null?I=Jl(I):(I=Wa(r)?zm:ra.current,I=Ey(t,I));var D=r.getDerivedStateFromProps,O=typeof D=="function"||typeof _.getSnapshotBeforeUpdate=="function";O||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(x!==s||a!==I)&&w6(t,_,s,I),cf=!1;var F=t.memoizedState;_.state=F,dS(t,s,_,c),a=t.memoizedState,x!==s||F!==a||Ga.current||cf?(typeof D=="function"&&(FM(t,r,D,s),a=t.memoizedState),(x=cf||b6(t,r,x,s,F,a,I))?(O||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(t.flags|=4194308)):(typeof _.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=a),_.props=s,_.state=a,_.context=I,s=x):(typeof _.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{_=t.stateNode,X9(e,t),x=t.memoizedProps,I=t.type===t.elementType?x:Oc(t.type,x),_.props=I,O=t.pendingProps,F=_.context,a=r.contextType,typeof a=="object"&&a!==null?a=Jl(a):(a=Wa(r)?zm:ra.current,a=Ey(t,a));var H=r.getDerivedStateFromProps;(D=typeof H=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(x!==O||F!==a)&&w6(t,_,s,a),cf=!1,F=t.memoizedState,_.state=F,dS(t,s,_,c);var Q=t.memoizedState;x!==O||F!==Q||Ga.current||cf?(typeof H=="function"&&(FM(t,r,H,s),Q=t.memoizedState),(I=cf||b6(t,r,I,s,F,Q,a)||!1)?(D||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(s,Q,a),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(s,Q,a)),typeof _.componentDidUpdate=="function"&&(t.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof _.componentDidUpdate!="function"||x===e.memoizedProps&&F===e.memoizedState||(t.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||x===e.memoizedProps&&F===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=Q),_.props=s,_.state=Q,_.context=a,s=I):(typeof _.componentDidUpdate!="function"||x===e.memoizedProps&&F===e.memoizedState||(t.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||x===e.memoizedProps&&F===e.memoizedState||(t.flags|=1024),s=!1)}return VM(e,t,r,s,f,c)}function VM(e,t,r,s,c,f){b7(e,t);var _=(t.flags&128)!==0;if(!s&&!_)return c&&f6(t,r,!1),Kh(e,t,f);s=t.stateNode,zte.current=t;var x=_&&typeof r.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&_?(t.child=Iy(t,e.child,null,f),t.child=Iy(t,null,x,f)):ba(e,t,x,f),t.memoizedState=s.state,c&&f6(t,r,!0),t.child}function w7(e){var t=e.stateNode;t.pendingContext?d6(e,t.pendingContext,t.pendingContext!==t.context):t.context&&d6(e,t.context,!1),vD(e,t.containerInfo)}function P6(e,t,r,s,c){return Sy(),fD(c),t.flags|=256,ba(e,t,r,s),t.child}var $M={dehydrated:null,treeContext:null,retryLane:0};function qM(e){return{baseLanes:e,cachePool:null,transitions:null}}function T7(e,t,r){var s=t.pendingProps,c=Es.current,f=!1,_=(t.flags&128)!==0,x;if((x=_)||(x=e!==null&&e.memoizedState===null?!1:(c&2)!==0),x?(f=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(c|=1),Qi(Es,c&1),e===null)return zM(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(_=s.children,e=s.fallback,f?(s=t.mode,f=t.child,_={mode:"hidden",children:_},!(s&1)&&f!==null?(f.childLanes=0,f.pendingProps=_):f=MI(_,s,0,null),e=Im(e,s,r,null),f.return=t,e.return=t,f.sibling=e,t.child=f,t.child.memoizedState=qM(r),t.memoizedState=$M,e):CD(t,_));if(c=e.memoizedState,c!==null&&(x=c.dehydrated,x!==null))return Nte(e,t,_,s,x,c,r);if(f){f=s.fallback,_=t.mode,c=e.child,x=c.sibling;var a={mode:"hidden",children:s.children};return!(_&1)&&t.child!==c?(s=t.child,s.childLanes=0,s.pendingProps=a,t.deletions=null):(s=Rf(c,a),s.subtreeFlags=c.subtreeFlags&14680064),x!==null?f=Rf(x,f):(f=Im(f,_,r,null),f.flags|=2),f.return=t,s.return=t,s.sibling=f,t.child=s,s=f,f=t.child,_=e.child.memoizedState,_=_===null?qM(r):{baseLanes:_.baseLanes|r,cachePool:null,transitions:_.transitions},f.memoizedState=_,f.childLanes=e.childLanes&~r,t.memoizedState=$M,s}return f=e.child,e=f.sibling,s=Rf(f,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=r),s.return=t,s.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=s,t.memoizedState=null,s}function CD(e,t){return t=MI({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function BT(e,t,r,s){return s!==null&&fD(s),Iy(t,e.child,null,r),e=CD(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Nte(e,t,r,s,c,f,_){if(r)return t.flags&256?(t.flags&=-257,s=oR(Error(fn(422))),BT(e,t,_,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(f=s.fallback,c=t.mode,s=MI({mode:"visible",children:s.children},c,0,null),f=Im(f,c,_,null),f.flags|=2,s.return=t,f.return=t,s.sibling=f,t.child=s,t.mode&1&&Iy(t,e.child,null,_),t.child.memoizedState=qM(_),t.memoizedState=$M,f);if(!(t.mode&1))return BT(e,t,_,null);if(c.data==="$!"){if(s=c.nextSibling&&c.nextSibling.dataset,s)var x=s.dgst;return s=x,f=Error(fn(419)),s=oR(f,s,void 0),BT(e,t,_,s)}if(x=(_&e.childLanes)!==0,$a||x){if(s=Co,s!==null){switch(_&-_){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(s.suspendedLanes|_)?0:c,c!==0&&c!==f.retryLane&&(f.retryLane=c,Xh(e,c),$c(s,e,c,-1))}return DD(),s=oR(Error(fn(421))),BT(e,t,_,s)}return c.data==="$?"?(t.flags|=128,t.child=e.child,t=Kte.bind(null,e),c._reactRetry=t,null):(e=f.treeContext,dl=If(c.nextSibling),_l=t,_s=!0,zc=null,e!==null&&($l[ql++]=Nh,$l[ql++]=Fh,$l[ql++]=Nm,Nh=e.id,Fh=e.overflow,Nm=t),t=CD(t,s.children),t.flags|=4096,t)}function R6(e,t,r){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),NM(e.return,t,r)}function aR(e,t,r,s,c){var f=e.memoizedState;f===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:c}:(f.isBackwards=t,f.rendering=null,f.renderingStartTime=0,f.last=s,f.tail=r,f.tailMode=c)}function E7(e,t,r){var s=t.pendingProps,c=s.revealOrder,f=s.tail;if(ba(e,t,s.children,r),s=Es.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&R6(e,r,t);else if(e.tag===19)R6(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(Qi(Es,s),!(t.mode&1))t.memoizedState=null;else switch(c){case"forwards":for(r=t.child,c=null;r!==null;)e=r.alternate,e!==null&&fS(e)===null&&(c=r),r=r.sibling;r=c,r===null?(c=t.child,t.child=null):(c=r.sibling,r.sibling=null),aR(t,!1,c,r,f);break;case"backwards":for(r=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&fS(e)===null){t.child=c;break}e=c.sibling,c.sibling=r,r=c,c=e}aR(t,!0,r,null,f);break;case"together":aR(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function wE(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Kh(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Bm|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(fn(153));if(t.child!==null){for(e=t.child,r=Rf(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Rf(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Fte(e,t,r){switch(t.tag){case 3:w7(t),Sy();break;case 5:K9(t);break;case 1:Wa(t.type)&&aS(t);break;case 4:vD(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,c=t.memoizedProps.value;Qi(uS,s._currentValue),s._currentValue=c;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(Qi(Es,Es.current&1),t.flags|=128,null):r&t.child.childLanes?T7(e,t,r):(Qi(Es,Es.current&1),e=Kh(e,t,r),e!==null?e.sibling:null);Qi(Es,Es.current&1);break;case 19:if(s=(r&t.childLanes)!==0,e.flags&128){if(s)return E7(e,t,r);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Qi(Es,Es.current),s)break;return null;case 22:case 23:return t.lanes=0,x7(e,t,r)}return Kh(e,t,r)}var S7,GM,I7,C7;S7=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};GM=function(){};I7=function(e,t,r,s){var c=e.memoizedProps;if(c!==s){e=t.stateNode,ym(Bu.current);var f=null;switch(r){case"input":c=fM(e,c),s=fM(e,s),f=[];break;case"select":c=Is({},c,{value:void 0}),s=Is({},s,{value:void 0}),f=[];break;case"textarea":c=gM(e,c),s=gM(e,s),f=[];break;default:typeof c.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=sS)}yM(r,s);var _;r=null;for(I in c)if(!s.hasOwnProperty(I)&&c.hasOwnProperty(I)&&c[I]!=null)if(I==="style"){var x=c[I];for(_ in x)x.hasOwnProperty(_)&&(r||(r={}),r[_]="")}else I!=="dangerouslySetInnerHTML"&&I!=="children"&&I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(ex.hasOwnProperty(I)?f||(f=[]):(f=f||[]).push(I,null));for(I in s){var a=s[I];if(x=c!=null?c[I]:void 0,s.hasOwnProperty(I)&&a!==x&&(a!=null||x!=null))if(I==="style")if(x){for(_ in x)!x.hasOwnProperty(_)||a&&a.hasOwnProperty(_)||(r||(r={}),r[_]="");for(_ in a)a.hasOwnProperty(_)&&x[_]!==a[_]&&(r||(r={}),r[_]=a[_])}else r||(f||(f=[]),f.push(I,r)),r=a;else I==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,x=x?x.__html:void 0,a!=null&&x!==a&&(f=f||[]).push(I,a)):I==="children"?typeof a!="string"&&typeof a!="number"||(f=f||[]).push(I,""+a):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&(ex.hasOwnProperty(I)?(a!=null&&I==="onScroll"&&ts("scroll",e),f||x===a||(f=[])):(f=f||[]).push(I,a))}r&&(f=f||[]).push("style",r);var I=f;(t.updateQueue=I)&&(t.flags|=4)}};C7=function(e,t,r,s){r!==s&&(t.flags|=4)};function Wv(e,t){if(!_s)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Xo(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,s=0;if(t)for(var c=e.child;c!==null;)r|=c.lanes|c.childLanes,s|=c.subtreeFlags&14680064,s|=c.flags&14680064,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)r|=c.lanes|c.childLanes,s|=c.subtreeFlags,s|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=s,e.childLanes=r,t}function Bte(e,t,r){var s=t.pendingProps;switch(dD(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xo(t),null;case 1:return Wa(t.type)&&oS(),Xo(t),null;case 3:return s=t.stateNode,Cy(),as(Ga),as(ra),bD(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(NT(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,zc!==null&&(JM(zc),zc=null))),GM(e,t),Xo(t),null;case 5:xD(t);var c=ym(dx.current);if(r=t.type,e!==null&&t.stateNode!=null)I7(e,t,r,s,c),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(fn(166));return Xo(t),null}if(e=ym(Bu.current),NT(t)){s=t.stateNode,r=t.type;var f=t.memoizedProps;switch(s[Du]=t,s[ux]=f,e=(t.mode&1)!==0,r){case"dialog":ts("cancel",s),ts("close",s);break;case"iframe":case"object":case"embed":ts("load",s);break;case"video":case"audio":for(c=0;c<c1.length;c++)ts(c1[c],s);break;case"source":ts("error",s);break;case"img":case"image":case"link":ts("error",s),ts("load",s);break;case"details":ts("toggle",s);break;case"input":BB(s,f),ts("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!f.multiple},ts("invalid",s);break;case"textarea":UB(s,f),ts("invalid",s)}yM(r,f),c=null;for(var _ in f)if(f.hasOwnProperty(_)){var x=f[_];_==="children"?typeof x=="string"?s.textContent!==x&&(f.suppressHydrationWarning!==!0&&zT(s.textContent,x,e),c=["children",x]):typeof x=="number"&&s.textContent!==""+x&&(f.suppressHydrationWarning!==!0&&zT(s.textContent,x,e),c=["children",""+x]):ex.hasOwnProperty(_)&&x!=null&&_==="onScroll"&&ts("scroll",s)}switch(r){case"input":AT(s),jB(s,f,!0);break;case"textarea":AT(s),VB(s);break;case"select":case"option":break;default:typeof f.onClick=="function"&&(s.onclick=sS)}s=c,t.updateQueue=s,s!==null&&(t.flags|=4)}else{_=c.nodeType===9?c:c.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=t9(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=_.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=_.createElement(r,{is:s.is}):(e=_.createElement(r),r==="select"&&(_=e,s.multiple?_.multiple=!0:s.size&&(_.size=s.size))):e=_.createElementNS(e,r),e[Du]=t,e[ux]=s,S7(e,t,!1,!1),t.stateNode=e;e:{switch(_=vM(r,s),r){case"dialog":ts("cancel",e),ts("close",e),c=s;break;case"iframe":case"object":case"embed":ts("load",e),c=s;break;case"video":case"audio":for(c=0;c<c1.length;c++)ts(c1[c],e);c=s;break;case"source":ts("error",e),c=s;break;case"img":case"image":case"link":ts("error",e),ts("load",e),c=s;break;case"details":ts("toggle",e),c=s;break;case"input":BB(e,s),c=fM(e,s),ts("invalid",e);break;case"option":c=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},c=Is({},s,{value:void 0}),ts("invalid",e);break;case"textarea":UB(e,s),c=gM(e,s),ts("invalid",e);break;default:c=s}yM(r,c),x=c;for(f in x)if(x.hasOwnProperty(f)){var a=x[f];f==="style"?i9(e,a):f==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&n9(e,a)):f==="children"?typeof a=="string"?(r!=="textarea"||a!=="")&&tx(e,a):typeof a=="number"&&tx(e,""+a):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(ex.hasOwnProperty(f)?a!=null&&f==="onScroll"&&ts("scroll",e):a!=null&&Q4(e,f,a,_))}switch(r){case"input":AT(e),jB(e,s,!1);break;case"textarea":AT(e),VB(e);break;case"option":s.value!=null&&e.setAttribute("value",""+Nf(s.value));break;case"select":e.multiple=!!s.multiple,f=s.value,f!=null?iy(e,!!s.multiple,f,!1):s.defaultValue!=null&&iy(e,!!s.multiple,s.defaultValue,!0);break;default:typeof c.onClick=="function"&&(e.onclick=sS)}switch(r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Xo(t),null;case 6:if(e&&t.stateNode!=null)C7(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(fn(166));if(r=ym(dx.current),ym(Bu.current),NT(t)){if(s=t.stateNode,r=t.memoizedProps,s[Du]=t,(f=s.nodeValue!==r)&&(e=_l,e!==null))switch(e.tag){case 3:zT(s.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&zT(s.nodeValue,r,(e.mode&1)!==0)}f&&(t.flags|=4)}else s=(r.nodeType===9?r:r.ownerDocument).createTextNode(s),s[Du]=t,t.stateNode=s}return Xo(t),null;case 13:if(as(Es),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(_s&&dl!==null&&t.mode&1&&!(t.flags&128))G9(),Sy(),t.flags|=98560,f=!1;else if(f=NT(t),s!==null&&s.dehydrated!==null){if(e===null){if(!f)throw Error(fn(318));if(f=t.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(fn(317));f[Du]=t}else Sy(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Xo(t),f=!1}else zc!==null&&(JM(zc),zc=null),f=!0;if(!f)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||Es.current&1?_o===0&&(_o=3):DD())),t.updateQueue!==null&&(t.flags|=4),Xo(t),null);case 4:return Cy(),GM(e,t),e===null&&lx(t.stateNode.containerInfo),Xo(t),null;case 10:return gD(t.type._context),Xo(t),null;case 17:return Wa(t.type)&&oS(),Xo(t),null;case 19:if(as(Es),f=t.memoizedState,f===null)return Xo(t),null;if(s=(t.flags&128)!==0,_=f.rendering,_===null)if(s)Wv(f,!1);else{if(_o!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(_=fS(e),_!==null){for(t.flags|=128,Wv(f,!1),s=_.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=r,r=t.child;r!==null;)f=r,e=s,f.flags&=14680066,_=f.alternate,_===null?(f.childLanes=0,f.lanes=e,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=_.childLanes,f.lanes=_.lanes,f.child=_.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=_.memoizedProps,f.memoizedState=_.memoizedState,f.updateQueue=_.updateQueue,f.type=_.type,e=_.dependencies,f.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Qi(Es,Es.current&1|2),t.child}e=e.sibling}f.tail!==null&&Zs()>Py&&(t.flags|=128,s=!0,Wv(f,!1),t.lanes=4194304)}else{if(!s)if(e=fS(_),e!==null){if(t.flags|=128,s=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Wv(f,!0),f.tail===null&&f.tailMode==="hidden"&&!_.alternate&&!_s)return Xo(t),null}else 2*Zs()-f.renderingStartTime>Py&&r!==1073741824&&(t.flags|=128,s=!0,Wv(f,!1),t.lanes=4194304);f.isBackwards?(_.sibling=t.child,t.child=_):(r=f.last,r!==null?r.sibling=_:t.child=_,f.last=_)}return f.tail!==null?(t=f.tail,f.rendering=t,f.tail=t.sibling,f.renderingStartTime=Zs(),t.sibling=null,r=Es.current,Qi(Es,s?r&1|2:r&1),t):(Xo(t),null);case 22:case 23:return kD(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?ul&1073741824&&(Xo(t),t.subtreeFlags&6&&(t.flags|=8192)):Xo(t),null;case 24:return null;case 25:return null}throw Error(fn(156,t.tag))}function jte(e,t){switch(dD(t),t.tag){case 1:return Wa(t.type)&&oS(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Cy(),as(Ga),as(ra),bD(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return xD(t),null;case 13:if(as(Es),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(fn(340));Sy()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return as(Es),null;case 4:return Cy(),null;case 10:return gD(t.type._context),null;case 22:case 23:return kD(),null;case 24:return null;default:return null}}var jT=!1,Jo=!1,Ute=typeof WeakSet=="function"?WeakSet:Set,Fn=null;function K_(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(s){Fs(e,t,s)}else r.current=null}function WM(e,t,r){try{r()}catch(s){Fs(e,t,s)}}var M6=!1;function Vte(e,t){if(PM=nS,e=k9(),uD(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var c=s.anchorOffset,f=s.focusNode;s=s.focusOffset;try{r.nodeType,f.nodeType}catch(fe){r=null;break e}var _=0,x=-1,a=-1,I=0,D=0,O=e,F=null;t:for(;;){for(var H;O!==r||c!==0&&O.nodeType!==3||(x=_+c),O!==f||s!==0&&O.nodeType!==3||(a=_+s),O.nodeType===3&&(_+=O.nodeValue.length),(H=O.firstChild)!==null;)F=O,O=H;for(;;){if(O===e)break t;if(F===r&&++I===c&&(x=_),F===f&&++D===s&&(a=_),(H=O.nextSibling)!==null)break;O=F,F=O.parentNode}O=H}r=x===-1||a===-1?null:{start:x,end:a}}else r=null}r=r||{start:0,end:0}}else r=null;for(RM={focusedElem:e,selectionRange:r},nS=!1,Fn=t;Fn!==null;)if(t=Fn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Fn=e;else for(;Fn!==null;){t=Fn;try{var Q=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(Q!==null){var ie=Q.memoizedProps,te=Q.memoizedState,W=t.stateNode,X=W.getSnapshotBeforeUpdate(t.elementType===t.type?ie:Oc(t.type,ie),te);W.__reactInternalSnapshotBeforeUpdate=X}break;case 3:var ee=t.stateNode.containerInfo;ee.nodeType===1?ee.textContent="":ee.nodeType===9&&ee.documentElement&&ee.removeChild(ee.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(fn(163))}}catch(fe){Fs(t,t.return,fe)}if(e=t.sibling,e!==null){e.return=t.return,Fn=e;break}Fn=t.return}return Q=M6,M6=!1,Q}function R1(e,t,r){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var c=s=s.next;do{if((c.tag&e)===e){var f=c.destroy;c.destroy=void 0,f!==void 0&&WM(t,r,f)}c=c.next}while(c!==s)}}function PI(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var s=r.create;r.destroy=s()}r=r.next}while(r!==t)}}function HM(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function A7(e){var t=e.alternate;t!==null&&(e.alternate=null,A7(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Du],delete t[ux],delete t[DM],delete t[Ete],delete t[Ste])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function P7(e){return e.tag===5||e.tag===3||e.tag===4}function k6(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||P7(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function ZM(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=sS));else if(s!==4&&(e=e.child,e!==null))for(ZM(e,t,r),e=e.sibling;e!==null;)ZM(e,t,r),e=e.sibling}function XM(e,t,r){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(XM(e,t,r),e=e.sibling;e!==null;)XM(e,t,r),e=e.sibling}var Mo=null,Lc=!1;function tf(e,t,r){for(r=r.child;r!==null;)R7(e,t,r),r=r.sibling}function R7(e,t,r){if(Fu&&typeof Fu.onCommitFiberUnmount=="function")try{Fu.onCommitFiberUnmount(bI,r)}catch(x){}switch(r.tag){case 5:Jo||K_(r,t);case 6:var s=Mo,c=Lc;Mo=null,tf(e,t,r),Mo=s,Lc=c,Mo!==null&&(Lc?(e=Mo,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Mo.removeChild(r.stateNode));break;case 18:Mo!==null&&(Lc?(e=Mo,r=r.stateNode,e.nodeType===8?eR(e.parentNode,r):e.nodeType===1&&eR(e,r),sx(e)):eR(Mo,r.stateNode));break;case 4:s=Mo,c=Lc,Mo=r.stateNode.containerInfo,Lc=!0,tf(e,t,r),Mo=s,Lc=c;break;case 0:case 11:case 14:case 15:if(!Jo&&(s=r.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){c=s=s.next;do{var f=c,_=f.destroy;f=f.tag,_!==void 0&&(f&2||f&4)&&WM(r,t,_),c=c.next}while(c!==s)}tf(e,t,r);break;case 1:if(!Jo&&(K_(r,t),s=r.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=r.memoizedProps,s.state=r.memoizedState,s.componentWillUnmount()}catch(x){Fs(r,t,x)}tf(e,t,r);break;case 21:tf(e,t,r);break;case 22:r.mode&1?(Jo=(s=Jo)||r.memoizedState!==null,tf(e,t,r),Jo=s):tf(e,t,r);break;default:tf(e,t,r)}}function D6(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Ute),t.forEach(function(s){var c=Qte.bind(null,e,s);r.has(s)||(r.add(s),s.then(c,c))})}}function Dc(e,t){var r=t.deletions;if(r!==null)for(var s=0;s<r.length;s++){var c=r[s];try{var f=e,_=t,x=_;e:for(;x!==null;){switch(x.tag){case 5:Mo=x.stateNode,Lc=!1;break e;case 3:Mo=x.stateNode.containerInfo,Lc=!0;break e;case 4:Mo=x.stateNode.containerInfo,Lc=!0;break e}x=x.return}if(Mo===null)throw Error(fn(160));R7(f,_,c),Mo=null,Lc=!1;var a=c.alternate;a!==null&&(a.return=null),c.return=null}catch(I){Fs(c,t,I)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)M7(t,e),t=t.sibling}function M7(e,t){var r=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Dc(t,e),wu(e),s&4){try{R1(3,e,e.return),PI(3,e)}catch(ie){Fs(e,e.return,ie)}try{R1(5,e,e.return)}catch(ie){Fs(e,e.return,ie)}}break;case 1:Dc(t,e),wu(e),s&512&&r!==null&&K_(r,r.return);break;case 5:if(Dc(t,e),wu(e),s&512&&r!==null&&K_(r,r.return),e.flags&32){var c=e.stateNode;try{tx(c,"")}catch(ie){Fs(e,e.return,ie)}}if(s&4&&(c=e.stateNode,c!=null)){var f=e.memoizedProps,_=r!==null?r.memoizedProps:f,x=e.type,a=e.updateQueue;if(e.updateQueue=null,a!==null)try{x==="input"&&f.type==="radio"&&f.name!=null&&J8(c,f),vM(x,_);var I=vM(x,f);for(_=0;_<a.length;_+=2){var D=a[_],O=a[_+1];D==="style"?i9(c,O):D==="dangerouslySetInnerHTML"?n9(c,O):D==="children"?tx(c,O):Q4(c,D,O,I)}switch(x){case"input":pM(c,f);break;case"textarea":e9(c,f);break;case"select":var F=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!f.multiple;var H=f.value;H!=null?iy(c,!!f.multiple,H,!1):F!==!!f.multiple&&(f.defaultValue!=null?iy(c,!!f.multiple,f.defaultValue,!0):iy(c,!!f.multiple,f.multiple?[]:"",!1))}c[ux]=f}catch(ie){Fs(e,e.return,ie)}}break;case 6:if(Dc(t,e),wu(e),s&4){if(e.stateNode===null)throw Error(fn(162));c=e.stateNode,f=e.memoizedProps;try{c.nodeValue=f}catch(ie){Fs(e,e.return,ie)}}break;case 3:if(Dc(t,e),wu(e),s&4&&r!==null&&r.memoizedState.isDehydrated)try{sx(t.containerInfo)}catch(ie){Fs(e,e.return,ie)}break;case 4:Dc(t,e),wu(e);break;case 13:Dc(t,e),wu(e),c=e.child,c.flags&8192&&(f=c.memoizedState!==null,c.stateNode.isHidden=f,!f||c.alternate!==null&&c.alternate.memoizedState!==null||(RD=Zs())),s&4&&D6(e);break;case 22:if(D=r!==null&&r.memoizedState!==null,e.mode&1?(Jo=(I=Jo)||D,Dc(t,e),Jo=I):Dc(t,e),wu(e),s&8192){if(I=e.memoizedState!==null,(e.stateNode.isHidden=I)&&!D&&e.mode&1)for(Fn=e,D=e.child;D!==null;){for(O=Fn=D;Fn!==null;){switch(F=Fn,H=F.child,F.tag){case 0:case 11:case 14:case 15:R1(4,F,F.return);break;case 1:K_(F,F.return);var Q=F.stateNode;if(typeof Q.componentWillUnmount=="function"){s=F,r=F.return;try{t=s,Q.props=t.memoizedProps,Q.state=t.memoizedState,Q.componentWillUnmount()}catch(ie){Fs(s,r,ie)}}break;case 5:K_(F,F.return);break;case 22:if(F.memoizedState!==null){L6(O);continue}}H!==null?(H.return=F,Fn=H):L6(O)}D=D.sibling}e:for(D=null,O=e;;){if(O.tag===5){if(D===null){D=O;try{c=O.stateNode,I?(f=c.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none"):(x=O.stateNode,a=O.memoizedProps.style,_=a!=null&&a.hasOwnProperty("display")?a.display:null,x.style.display=r9("display",_))}catch(ie){Fs(e,e.return,ie)}}}else if(O.tag===6){if(D===null)try{O.stateNode.nodeValue=I?"":O.memoizedProps}catch(ie){Fs(e,e.return,ie)}}else if((O.tag!==22&&O.tag!==23||O.memoizedState===null||O===e)&&O.child!==null){O.child.return=O,O=O.child;continue}if(O===e)break e;for(;O.sibling===null;){if(O.return===null||O.return===e)break e;D===O&&(D=null),O=O.return}D===O&&(D=null),O.sibling.return=O.return,O=O.sibling}}break;case 19:Dc(t,e),wu(e),s&4&&D6(e);break;case 21:break;default:Dc(t,e),wu(e)}}function wu(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(P7(r)){var s=r;break e}r=r.return}throw Error(fn(160))}switch(s.tag){case 5:var c=s.stateNode;s.flags&32&&(tx(c,""),s.flags&=-33);var f=k6(e);XM(e,f,c);break;case 3:case 4:var _=s.stateNode.containerInfo,x=k6(e);ZM(e,x,_);break;default:throw Error(fn(161))}}catch(a){Fs(e,e.return,a)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function $te(e,t,r){Fn=e,k7(e)}function k7(e,t,r){for(var s=(e.mode&1)!==0;Fn!==null;){var c=Fn,f=c.child;if(c.tag===22&&s){var _=c.memoizedState!==null||jT;if(!_){var x=c.alternate,a=x!==null&&x.memoizedState!==null||Jo;x=jT;var I=Jo;if(jT=_,(Jo=a)&&!I)for(Fn=c;Fn!==null;)_=Fn,a=_.child,_.tag===22&&_.memoizedState!==null?z6(c):a!==null?(a.return=_,Fn=a):z6(c);for(;f!==null;)Fn=f,k7(f),f=f.sibling;Fn=c,jT=x,Jo=I}O6(e)}else c.subtreeFlags&8772&&f!==null?(f.return=c,Fn=f):O6(e)}}function O6(e){for(;Fn!==null;){var t=Fn;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Jo||PI(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Jo)if(r===null)s.componentDidMount();else{var c=t.elementType===t.type?r.memoizedProps:Oc(t.type,r.memoizedProps);s.componentDidUpdate(c,r.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var f=t.updateQueue;f!==null&&y6(t,f,s);break;case 3:var _=t.updateQueue;if(_!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}y6(t,_,r)}break;case 5:var x=t.stateNode;if(r===null&&t.flags&4){r=x;var a=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&r.focus();break;case"img":a.src&&(r.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var I=t.alternate;if(I!==null){var D=I.memoizedState;if(D!==null){var O=D.dehydrated;O!==null&&sx(O)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(fn(163))}Jo||t.flags&512&&HM(t)}catch(F){Fs(t,t.return,F)}}if(t===e){Fn=null;break}if(r=t.sibling,r!==null){r.return=t.return,Fn=r;break}Fn=t.return}}function L6(e){for(;Fn!==null;){var t=Fn;if(t===e){Fn=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Fn=r;break}Fn=t.return}}function z6(e){for(;Fn!==null;){var t=Fn;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{PI(4,t)}catch(a){Fs(t,r,a)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var c=t.return;try{s.componentDidMount()}catch(a){Fs(t,c,a)}}var f=t.return;try{HM(t)}catch(a){Fs(t,f,a)}break;case 5:var _=t.return;try{HM(t)}catch(a){Fs(t,_,a)}}}catch(a){Fs(t,t.return,a)}if(t===e){Fn=null;break}var x=t.sibling;if(x!==null){x.return=t.return,Fn=x;break}Fn=t.return}}var qte=Math.ceil,gS=od.ReactCurrentDispatcher,AD=od.ReactCurrentOwner,Ql=od.ReactCurrentBatchConfig,li=0,Co=null,io=null,Lo=0,ul=0,Q_=Kf(0),_o=0,gx=null,Bm=0,RI=0,PD=0,M1=null,ja=null,RD=0,Py=1/0,Mh=null,_S=!1,KM=null,Af=null,UT=!1,_f=null,yS=0,k1=0,QM=null,TE=-1,EE=0;function Ea(){return li&6?Zs():TE!==-1?TE:TE=Zs()}function Pf(e){return e.mode&1?li&2&&Lo!==0?Lo&-Lo:Cte.transition!==null?(EE===0&&(EE=g9()),EE):(e=Mi,e!==0||(e=window.event,e=e===void 0?16:T9(e.type)),e):1}function $c(e,t,r,s){if(50<k1)throw k1=0,QM=null,Error(fn(185));Qx(e,r,s),(!(li&2)||e!==Co)&&(e===Co&&(!(li&2)&&(RI|=r),_o===4&&hf(e,Lo)),Ha(e,s),r===1&&li===0&&!(t.mode&1)&&(Py=Zs()+500,II&&Qf()))}function Ha(e,t){var r=e.callbackNode;Cee(e,t);var s=tS(e,e===Co?Lo:0);if(s===0)r!==null&&GB(r),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(r!=null&&GB(r),t===1)e.tag===0?Ite(N6.bind(null,e)):V9(N6.bind(null,e)),wte(function(){!(li&6)&&Qf()}),r=null;else{switch(_9(s)){case 1:r=nD;break;case 4:r=p9;break;case 16:r=eS;break;case 536870912:r=m9;break;default:r=eS}r=j7(r,D7.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function D7(e,t){if(TE=-1,EE=0,li&6)throw Error(fn(327));var r=e.callbackNode;if(cy()&&e.callbackNode!==r)return null;var s=tS(e,e===Co?Lo:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=vS(e,s);else{t=s;var c=li;li|=2;var f=L7();(Co!==e||Lo!==t)&&(Mh=null,Py=Zs()+500,Sm(e,t));do try{Hte();break}catch(x){O7(e,x)}while(!0);mD(),gS.current=f,li=c,io!==null?t=0:(Co=null,Lo=0,t=_o)}if(t!==0){if(t===2&&(c=EM(e),c!==0&&(s=c,t=YM(e,c))),t===1)throw r=gx,Sm(e,0),hf(e,s),Ha(e,Zs()),r;if(t===6)hf(e,s);else{if(c=e.current.alternate,!(s&30)&&!Gte(c)&&(t=vS(e,s),t===2&&(f=EM(e),f!==0&&(s=f,t=YM(e,f))),t===1))throw r=gx,Sm(e,0),hf(e,s),Ha(e,Zs()),r;switch(e.finishedWork=c,e.finishedLanes=s,t){case 0:case 1:throw Error(fn(345));case 2:om(e,ja,Mh);break;case 3:if(hf(e,s),(s&130023424)===s&&(t=RD+500-Zs(),10<t)){if(tS(e,0)!==0)break;if(c=e.suspendedLanes,(c&s)!==s){Ea(),e.pingedLanes|=e.suspendedLanes&c;break}e.timeoutHandle=kM(om.bind(null,e,ja,Mh),t);break}om(e,ja,Mh);break;case 4:if(hf(e,s),(s&4194240)===s)break;for(t=e.eventTimes,c=-1;0<s;){var _=31-Vc(s);f=1<<_,_=t[_],_>c&&(c=_),s&=~f}if(s=c,s=Zs()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*qte(s/1960))-s,10<s){e.timeoutHandle=kM(om.bind(null,e,ja,Mh),s);break}om(e,ja,Mh);break;case 5:om(e,ja,Mh);break;default:throw Error(fn(329))}}}return Ha(e,Zs()),e.callbackNode===r?D7.bind(null,e):null}function YM(e,t){var r=M1;return e.current.memoizedState.isDehydrated&&(Sm(e,t).flags|=256),e=vS(e,t),e!==2&&(t=ja,ja=r,t!==null&&JM(t)),e}function JM(e){ja===null?ja=e:ja.push.apply(ja,e)}function Gte(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var s=0;s<r.length;s++){var c=r[s],f=c.getSnapshot;c=c.value;try{if(!Wc(f(),c))return!1}catch(_){return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function hf(e,t){for(t&=~PD,t&=~RI,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Vc(t),s=1<<r;e[r]=-1,t&=~s}}function N6(e){if(li&6)throw Error(fn(327));cy();var t=tS(e,0);if(!(t&1))return Ha(e,Zs()),null;var r=vS(e,t);if(e.tag!==0&&r===2){var s=EM(e);s!==0&&(t=s,r=YM(e,s))}if(r===1)throw r=gx,Sm(e,0),hf(e,t),Ha(e,Zs()),r;if(r===6)throw Error(fn(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,om(e,ja,Mh),Ha(e,Zs()),null}function MD(e,t){var r=li;li|=1;try{return e(t)}finally{li=r,li===0&&(Py=Zs()+500,II&&Qf())}}function jm(e){_f!==null&&_f.tag===0&&!(li&6)&&cy();var t=li;li|=1;var r=Ql.transition,s=Mi;try{if(Ql.transition=null,Mi=1,e)return e()}finally{Mi=s,Ql.transition=r,li=t,!(li&6)&&Qf()}}function kD(){ul=Q_.current,as(Q_)}function Sm(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,bte(r)),io!==null)for(r=io.return;r!==null;){var s=r;switch(dD(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&oS();break;case 3:Cy(),as(Ga),as(ra),bD();break;case 5:xD(s);break;case 4:Cy();break;case 13:as(Es);break;case 19:as(Es);break;case 10:gD(s.type._context);break;case 22:case 23:kD()}r=r.return}if(Co=e,io=e=Rf(e.current,null),Lo=ul=t,_o=0,gx=null,PD=RI=Bm=0,ja=M1=null,_m!==null){for(t=0;t<_m.length;t++)if(r=_m[t],s=r.interleaved,s!==null){r.interleaved=null;var c=s.next,f=r.pending;if(f!==null){var _=f.next;f.next=c,s.next=_}r.pending=s}_m=null}return e}function O7(e,t){do{var r=io;try{if(mD(),xE.current=mS,pS){for(var s=Ss.memoizedState;s!==null;){var c=s.queue;c!==null&&(c.pending=null),s=s.next}pS=!1}if(Fm=0,So=mo=Ss=null,P1=!1,fx=0,AD.current=null,r===null||r.return===null){_o=1,gx=t,io=null;break}e:{var f=e,_=r.return,x=r,a=t;if(t=Lo,x.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var I=a,D=x,O=D.tag;if(!(D.mode&1)&&(O===0||O===11||O===15)){var F=D.alternate;F?(D.updateQueue=F.updateQueue,D.memoizedState=F.memoizedState,D.lanes=F.lanes):(D.updateQueue=null,D.memoizedState=null)}var H=E6(_);if(H!==null){H.flags&=-257,S6(H,_,x,f,t),H.mode&1&&T6(f,I,t),t=H,a=I;var Q=t.updateQueue;if(Q===null){var ie=new Set;ie.add(a),t.updateQueue=ie}else Q.add(a);break e}else{if(!(t&1)){T6(f,I,t),DD();break e}a=Error(fn(426))}}else if(_s&&x.mode&1){var te=E6(_);if(te!==null){!(te.flags&65536)&&(te.flags|=256),S6(te,_,x,f,t),fD(Ay(a,x));break e}}f=a=Ay(a,x),_o!==4&&(_o=2),M1===null?M1=[f]:M1.push(f),f=_;do{switch(f.tag){case 3:f.flags|=65536,t&=-t,f.lanes|=t;var W=_7(f,a,t);_6(f,W);break e;case 1:x=a;var X=f.type,ee=f.stateNode;if(!(f.flags&128)&&(typeof X.getDerivedStateFromError=="function"||ee!==null&&typeof ee.componentDidCatch=="function"&&(Af===null||!Af.has(ee)))){f.flags|=65536,t&=-t,f.lanes|=t;var fe=y7(f,x,t);_6(f,fe);break e}}f=f.return}while(f!==null)}N7(r)}catch(ye){t=ye,io===r&&r!==null&&(io=r=r.return);continue}break}while(!0)}function L7(){var e=gS.current;return gS.current=mS,e===null?mS:e}function DD(){(_o===0||_o===3||_o===2)&&(_o=4),Co===null||!(Bm&268435455)&&!(RI&268435455)||hf(Co,Lo)}function vS(e,t){var r=li;li|=2;var s=L7();(Co!==e||Lo!==t)&&(Mh=null,Sm(e,t));do try{Wte();break}catch(c){O7(e,c)}while(!0);if(mD(),li=r,gS.current=s,io!==null)throw Error(fn(261));return Co=null,Lo=0,_o}function Wte(){for(;io!==null;)z7(io)}function Hte(){for(;io!==null&&!yee();)z7(io)}function z7(e){var t=B7(e.alternate,e,ul);e.memoizedProps=e.pendingProps,t===null?N7(e):io=t,AD.current=null}function N7(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=jte(r,t),r!==null){r.flags&=32767,io=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{_o=6,io=null;return}}else if(r=Bte(r,t,ul),r!==null){io=r;return}if(t=t.sibling,t!==null){io=t;return}io=t=e}while(t!==null);_o===0&&(_o=5)}function om(e,t,r){var s=Mi,c=Ql.transition;try{Ql.transition=null,Mi=1,Zte(e,t,r,s)}finally{Ql.transition=c,Mi=s}return null}function Zte(e,t,r,s){do cy();while(_f!==null);if(li&6)throw Error(fn(327));r=e.finishedWork;var c=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(fn(177));e.callbackNode=null,e.callbackPriority=0;var f=r.lanes|r.childLanes;if(Aee(e,f),e===Co&&(io=Co=null,Lo=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||UT||(UT=!0,j7(eS,function(){return cy(),null})),f=(r.flags&15990)!==0,r.subtreeFlags&15990||f){f=Ql.transition,Ql.transition=null;var _=Mi;Mi=1;var x=li;li|=4,AD.current=null,Vte(e,r),M7(r,e),pte(RM),nS=!!PM,RM=PM=null,e.current=r,$te(r),vee(),li=x,Mi=_,Ql.transition=f}else e.current=r;if(UT&&(UT=!1,_f=e,yS=c),f=e.pendingLanes,f===0&&(Af=null),wee(r.stateNode),Ha(e,Zs()),t!==null)for(s=e.onRecoverableError,r=0;r<t.length;r++)c=t[r],s(c.value,{componentStack:c.stack,digest:c.digest});if(_S)throw _S=!1,e=KM,KM=null,e;return yS&1&&e.tag!==0&&cy(),f=e.pendingLanes,f&1?e===QM?k1++:(k1=0,QM=e):k1=0,Qf(),null}function cy(){if(_f!==null){var e=_9(yS),t=Ql.transition,r=Mi;try{if(Ql.transition=null,Mi=16>e?16:e,_f===null)var s=!1;else{if(e=_f,_f=null,yS=0,li&6)throw Error(fn(331));var c=li;for(li|=4,Fn=e.current;Fn!==null;){var f=Fn,_=f.child;if(Fn.flags&16){var x=f.deletions;if(x!==null){for(var a=0;a<x.length;a++){var I=x[a];for(Fn=I;Fn!==null;){var D=Fn;switch(D.tag){case 0:case 11:case 15:R1(8,D,f)}var O=D.child;if(O!==null)O.return=D,Fn=O;else for(;Fn!==null;){D=Fn;var F=D.sibling,H=D.return;if(A7(D),D===I){Fn=null;break}if(F!==null){F.return=H,Fn=F;break}Fn=H}}}var Q=f.alternate;if(Q!==null){var ie=Q.child;if(ie!==null){Q.child=null;do{var te=ie.sibling;ie.sibling=null,ie=te}while(ie!==null)}}Fn=f}}if(f.subtreeFlags&2064&&_!==null)_.return=f,Fn=_;else e:for(;Fn!==null;){if(f=Fn,f.flags&2048)switch(f.tag){case 0:case 11:case 15:R1(9,f,f.return)}var W=f.sibling;if(W!==null){W.return=f.return,Fn=W;break e}Fn=f.return}}var X=e.current;for(Fn=X;Fn!==null;){_=Fn;var ee=_.child;if(_.subtreeFlags&2064&&ee!==null)ee.return=_,Fn=ee;else e:for(_=X;Fn!==null;){if(x=Fn,x.flags&2048)try{switch(x.tag){case 0:case 11:case 15:PI(9,x)}}catch(ye){Fs(x,x.return,ye)}if(x===_){Fn=null;break e}var fe=x.sibling;if(fe!==null){fe.return=x.return,Fn=fe;break e}Fn=x.return}}if(li=c,Qf(),Fu&&typeof Fu.onPostCommitFiberRoot=="function")try{Fu.onPostCommitFiberRoot(bI,e)}catch(ye){}s=!0}return s}finally{Mi=r,Ql.transition=t}}return!1}function F6(e,t,r){t=Ay(r,t),t=_7(e,t,1),e=Cf(e,t,1),t=Ea(),e!==null&&(Qx(e,1,t),Ha(e,t))}function Fs(e,t,r){if(e.tag===3)F6(e,e,r);else for(;t!==null;){if(t.tag===3){F6(t,e,r);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Af===null||!Af.has(s))){e=Ay(r,e),e=y7(t,e,1),t=Cf(t,e,1),e=Ea(),t!==null&&(Qx(t,1,e),Ha(t,e));break}}t=t.return}}function Xte(e,t,r){var s=e.pingCache;s!==null&&s.delete(t),t=Ea(),e.pingedLanes|=e.suspendedLanes&r,Co===e&&(Lo&r)===r&&(_o===4||_o===3&&(Lo&130023424)===Lo&&500>Zs()-RD?Sm(e,0):PD|=r),Ha(e,t)}function F7(e,t){t===0&&(e.mode&1?(t=MT,MT<<=1,!(MT&130023424)&&(MT=4194304)):t=1);var r=Ea();e=Xh(e,t),e!==null&&(Qx(e,t,r),Ha(e,r))}function Kte(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),F7(e,r)}function Qte(e,t){var r=0;switch(e.tag){case 13:var s=e.stateNode,c=e.memoizedState;c!==null&&(r=c.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(fn(314))}s!==null&&s.delete(t),F7(e,r)}var B7;B7=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ga.current)$a=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return $a=!1,Fte(e,t,r);$a=!!(e.flags&131072)}else $a=!1,_s&&t.flags&1048576&&$9(t,cS,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;wE(e,t),e=t.pendingProps;var c=Ey(t,ra.current);ly(t,r),c=TD(null,t,s,e,c,r);var f=ED();return t.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Wa(s)?(f=!0,aS(t)):f=!1,t.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,yD(t),c.updater=AI,t.stateNode=c,c._reactInternals=t,BM(t,s,e,r),t=VM(null,t,s,!0,f,r)):(t.tag=0,_s&&f&&hD(t),ba(null,t,c,r),t=t.child),t;case 16:s=t.elementType;e:{switch(wE(e,t),e=t.pendingProps,c=s._init,s=c(s._payload),t.type=s,c=t.tag=Jte(s),e=Oc(s,e),c){case 0:t=UM(null,t,s,e,r);break e;case 1:t=A6(null,t,s,e,r);break e;case 11:t=I6(null,t,s,e,r);break e;case 14:t=C6(null,t,s,Oc(s.type,e),r);break e}throw Error(fn(306,s,""))}return t;case 0:return s=t.type,c=t.pendingProps,c=t.elementType===s?c:Oc(s,c),UM(e,t,s,c,r);case 1:return s=t.type,c=t.pendingProps,c=t.elementType===s?c:Oc(s,c),A6(e,t,s,c,r);case 3:e:{if(w7(t),e===null)throw Error(fn(387));s=t.pendingProps,f=t.memoizedState,c=f.element,X9(e,t),dS(t,s,null,r);var _=t.memoizedState;if(s=_.element,f.isDehydrated)if(f={element:s,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},t.updateQueue.baseState=f,t.memoizedState=f,t.flags&256){c=Ay(Error(fn(423)),t),t=P6(e,t,s,r,c);break e}else if(s!==c){c=Ay(Error(fn(424)),t),t=P6(e,t,s,r,c);break e}else for(dl=If(t.stateNode.containerInfo.firstChild),_l=t,_s=!0,zc=null,r=H9(t,null,s,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Sy(),s===c){t=Kh(e,t,r);break e}ba(e,t,s,r)}t=t.child}return t;case 5:return K9(t),e===null&&zM(t),s=t.type,c=t.pendingProps,f=e!==null?e.memoizedProps:null,_=c.children,MM(s,c)?_=null:f!==null&&MM(s,f)&&(t.flags|=32),b7(e,t),ba(e,t,_,r),t.child;case 6:return e===null&&zM(t),null;case 13:return T7(e,t,r);case 4:return vD(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=Iy(t,null,s,r):ba(e,t,s,r),t.child;case 11:return s=t.type,c=t.pendingProps,c=t.elementType===s?c:Oc(s,c),I6(e,t,s,c,r);case 7:return ba(e,t,t.pendingProps,r),t.child;case 8:return ba(e,t,t.pendingProps.children,r),t.child;case 12:return ba(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(s=t.type._context,c=t.pendingProps,f=t.memoizedProps,_=c.value,Qi(uS,s._currentValue),s._currentValue=_,f!==null)if(Wc(f.value,_)){if(f.children===c.children&&!Ga.current){t=Kh(e,t,r);break e}}else for(f=t.child,f!==null&&(f.return=t);f!==null;){var x=f.dependencies;if(x!==null){_=f.child;for(var a=x.firstContext;a!==null;){if(a.context===s){if(f.tag===1){a=Vh(-1,r&-r),a.tag=2;var I=f.updateQueue;if(I!==null){I=I.shared;var D=I.pending;D===null?a.next=a:(a.next=D.next,D.next=a),I.pending=a}}f.lanes|=r,a=f.alternate,a!==null&&(a.lanes|=r),NM(f.return,r,t),x.lanes|=r;break}a=a.next}}else if(f.tag===10)_=f.type===t.type?null:f.child;else if(f.tag===18){if(_=f.return,_===null)throw Error(fn(341));_.lanes|=r,x=_.alternate,x!==null&&(x.lanes|=r),NM(_,r,t),_=f.sibling}else _=f.child;if(_!==null)_.return=f;else for(_=f;_!==null;){if(_===t){_=null;break}if(f=_.sibling,f!==null){f.return=_.return,_=f;break}_=_.return}f=_}ba(e,t,c.children,r),t=t.child}return t;case 9:return c=t.type,s=t.pendingProps.children,ly(t,r),c=Jl(c),s=s(c),t.flags|=1,ba(e,t,s,r),t.child;case 14:return s=t.type,c=Oc(s,t.pendingProps),c=Oc(s.type,c),C6(e,t,s,c,r);case 15:return v7(e,t,t.type,t.pendingProps,r);case 17:return s=t.type,c=t.pendingProps,c=t.elementType===s?c:Oc(s,c),wE(e,t),t.tag=1,Wa(s)?(e=!0,aS(t)):e=!1,ly(t,r),g7(t,s,c),BM(t,s,c,r),VM(null,t,s,!0,e,r);case 19:return E7(e,t,r);case 22:return x7(e,t,r)}throw Error(fn(156,t.tag))};function j7(e,t){return f9(e,t)}function Yte(e,t,r,s){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kl(e,t,r,s){return new Yte(e,t,r,s)}function OD(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Jte(e){if(typeof e=="function")return OD(e)?1:0;if(e!=null){if(e=e.$$typeof,e===J4)return 11;if(e===eD)return 14}return 2}function Rf(e,t){var r=e.alternate;return r===null?(r=Kl(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function SE(e,t,r,s,c,f){var _=2;if(s=e,typeof e=="function")OD(e)&&(_=1);else if(typeof e=="string")_=5;else e:switch(e){case U_:return Im(r.children,c,f,t);case Y4:_=8,c|=8;break;case cM:return e=Kl(12,r,t,c|2),e.elementType=cM,e.lanes=f,e;case uM:return e=Kl(13,r,t,c),e.elementType=uM,e.lanes=f,e;case hM:return e=Kl(19,r,t,c),e.elementType=hM,e.lanes=f,e;case K8:return MI(r,c,f,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Z8:_=10;break e;case X8:_=9;break e;case J4:_=11;break e;case eD:_=14;break e;case lf:_=16,s=null;break e}throw Error(fn(130,e==null?e:typeof e,""))}return t=Kl(_,r,t,c),t.elementType=e,t.type=s,t.lanes=f,t}function Im(e,t,r,s){return e=Kl(7,e,s,t),e.lanes=r,e}function MI(e,t,r,s){return e=Kl(22,e,s,t),e.elementType=K8,e.lanes=r,e.stateNode={isHidden:!1},e}function lR(e,t,r){return e=Kl(6,e,null,t),e.lanes=r,e}function cR(e,t,r){return t=Kl(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ene(e,t,r,s,c){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$3(0),this.expirationTimes=$3(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$3(0),this.identifierPrefix=s,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function LD(e,t,r,s,c,f,_,x,a){return e=new ene(e,t,r,x,a),t===1?(t=1,f===!0&&(t|=8)):t=0,f=Kl(3,null,null,t),e.current=f,f.stateNode=e,f.memoizedState={element:s,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},yD(f),e}function tne(e,t,r){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:j_,key:s==null?null:""+s,children:e,containerInfo:t,implementation:r}}function U7(e){if(!e)return Ff;e=e._reactInternals;e:{if(tg(e)!==e||e.tag!==1)throw Error(fn(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Wa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(fn(171))}if(e.tag===1){var r=e.type;if(Wa(r))return U9(e,r,t)}return t}function V7(e,t,r,s,c,f,_,x,a){return e=LD(r,s,!0,e,c,f,_,x,a),e.context=U7(null),r=e.current,s=Ea(),c=Pf(r),f=Vh(s,c),f.callback=t!=null?t:null,Cf(r,f,c),e.current.lanes=c,Qx(e,c,s),Ha(e,s),e}function kI(e,t,r,s){var c=t.current,f=Ea(),_=Pf(c);return r=U7(r),t.context===null?t.context=r:t.pendingContext=r,t=Vh(f,_),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=Cf(c,t,_),e!==null&&($c(e,c,_,f),vE(e,c,_)),_}function xS(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function B6(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function zD(e,t){B6(e,t),(e=e.alternate)&&B6(e,t)}function nne(){return null}var $7=typeof reportError=="function"?reportError:function(e){console.error(e)};function ND(e){this._internalRoot=e}DI.prototype.render=ND.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(fn(409));kI(e,t,null,null)};DI.prototype.unmount=ND.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;jm(function(){kI(null,e,null,null)}),t[Zh]=null}};function DI(e){this._internalRoot=e}DI.prototype.unstable_scheduleHydration=function(e){if(e){var t=x9();e={blockedOn:null,target:e,priority:t};for(var r=0;r<uf.length&&t!==0&&t<uf[r].priority;r++);uf.splice(r,0,e),r===0&&w9(e)}};function FD(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function OI(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function j6(){}function rne(e,t,r,s,c){if(c){if(typeof s=="function"){var f=s;s=function(){var I=xS(_);f.call(I)}}var _=V7(t,s,e,0,null,!1,!1,"",j6);return e._reactRootContainer=_,e[Zh]=_.current,lx(e.nodeType===8?e.parentNode:e),jm(),_}for(;c=e.lastChild;)e.removeChild(c);if(typeof s=="function"){var x=s;s=function(){var I=xS(a);x.call(I)}}var a=LD(e,0,!1,null,null,!1,!1,"",j6);return e._reactRootContainer=a,e[Zh]=a.current,lx(e.nodeType===8?e.parentNode:e),jm(function(){kI(t,a,r,s)}),a}function LI(e,t,r,s,c){var f=r._reactRootContainer;if(f){var _=f;if(typeof c=="function"){var x=c;c=function(){var a=xS(_);x.call(a)}}kI(t,_,e,c)}else _=rne(r,t,e,c,s);return xS(_)}y9=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=l1(t.pendingLanes);r!==0&&(rD(t,r|1),Ha(t,Zs()),!(li&6)&&(Py=Zs()+500,Qf()))}break;case 13:jm(function(){var s=Xh(e,1);if(s!==null){var c=Ea();$c(s,e,1,c)}}),zD(e,1)}};iD=function(e){if(e.tag===13){var t=Xh(e,134217728);if(t!==null){var r=Ea();$c(t,e,134217728,r)}zD(e,134217728)}};v9=function(e){if(e.tag===13){var t=Pf(e),r=Xh(e,t);if(r!==null){var s=Ea();$c(r,e,t,s)}zD(e,t)}};x9=function(){return Mi};b9=function(e,t){var r=Mi;try{return Mi=e,t()}finally{Mi=r}};bM=function(e,t,r){switch(t){case"input":if(pM(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var s=r[t];if(s!==e&&s.form===e.form){var c=SI(s);if(!c)throw Error(fn(90));Y8(s),pM(s,c)}}}break;case"textarea":e9(e,r);break;case"select":t=r.value,t!=null&&iy(e,!!r.multiple,t,!1)}};a9=MD;l9=jm;var ine={usingClientEntryPoint:!1,Events:[Jx,G_,SI,s9,o9,MD]},Hv={findFiberByHostInstance:gm,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},sne={bundleType:Hv.bundleType,version:Hv.version,rendererPackageName:Hv.rendererPackageName,rendererConfig:Hv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:od.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=h9(e),e===null?null:e.stateNode},findFiberByHostInstance:Hv.findFiberByHostInstance||nne,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!="undefined"){var VT=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!VT.isDisabled&&VT.supportsFiber)try{bI=VT.inject(sne),Fu=VT}catch(e){}}Tl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ine;Tl.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!FD(t))throw Error(fn(200));return tne(e,t,null,r)};Tl.createRoot=function(e,t){if(!FD(e))throw Error(fn(299));var r=!1,s="",c=$7;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=LD(e,1,!1,null,null,r,!1,s,c),e[Zh]=t.current,lx(e.nodeType===8?e.parentNode:e),new ND(t)};Tl.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(fn(188)):(e=Object.keys(e).join(","),Error(fn(268,e)));return e=h9(t),e=e===null?null:e.stateNode,e};Tl.flushSync=function(e){return jm(e)};Tl.hydrate=function(e,t,r){if(!OI(t))throw Error(fn(200));return LI(null,e,t,!0,r)};Tl.hydrateRoot=function(e,t,r){if(!FD(e))throw Error(fn(405));var s=r!=null&&r.hydratedSources||null,c=!1,f="",_=$7;if(r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(_=r.onRecoverableError)),t=V7(t,null,e,1,r!=null?r:null,c,!1,f,_),e[Zh]=t.current,lx(e),s)for(e=0;e<s.length;e++)r=s[e],c=r._getVersion,c=c(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,c]:t.mutableSourceEagerHydrationData.push(r,c);return new DI(t)};Tl.render=function(e,t,r){if(!OI(t))throw Error(fn(200));return LI(null,e,t,!1,r)};Tl.unmountComponentAtNode=function(e){if(!OI(e))throw Error(fn(40));return e._reactRootContainer?(jm(function(){LI(null,null,e,!1,function(){e._reactRootContainer=null,e[Zh]=null})}),!0):!1};Tl.unstable_batchedUpdates=MD;Tl.unstable_renderSubtreeIntoContainer=function(e,t,r,s){if(!OI(r))throw Error(fn(200));if(e==null||e._reactInternals===void 0)throw Error(fn(38));return LI(e,t,r,!1,s)};Tl.version="18.3.1-next-f1338f8080-20240426";function q7(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__=="undefined"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(q7)}catch(e){console.error(e)}}q7(),q8.exports=Tl;var zI=q8.exports;const $T=Yy(zI);var G7,U6=zI;G7=U6.createRoot,U6.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _x(){return _x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},_x.apply(this,arguments)}var yf;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(yf||(yf={}));const V6="popstate";function one(e){e===void 0&&(e={});function t(s,c){let{pathname:f,search:_,hash:x}=s.location;return ek("",{pathname:f,search:_,hash:x},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function r(s,c){return typeof c=="string"?c:bS(c)}return lne(t,r,null,e)}function Bs(e,t){if(e===!1||e===null||typeof e=="undefined")throw new Error(t)}function W7(e,t){if(!e){typeof console!="undefined"&&console.warn(t);try{throw new Error(t)}catch(r){}}}function ane(){return Math.random().toString(36).substr(2,8)}function $6(e,t){return{usr:e.state,key:e.key,idx:t}}function ek(e,t,r,s){return r===void 0&&(r=null),_x({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?n0(t):t,{state:r,key:t&&t.key||s||ane()})}function bS(e){let{pathname:t="/",search:r="",hash:s=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),s&&s!=="#"&&(t+=s.charAt(0)==="#"?s:"#"+s),t}function n0(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function lne(e,t,r,s){s===void 0&&(s={});let{window:c=document.defaultView,v5Compat:f=!1}=s,_=c.history,x=yf.Pop,a=null,I=D();I==null&&(I=0,_.replaceState(_x({},_.state,{idx:I}),""));function D(){return(_.state||{idx:null}).idx}function O(){x=yf.Pop;let te=D(),W=te==null?null:te-I;I=te,a&&a({action:x,location:ie.location,delta:W})}function F(te,W){x=yf.Push;let X=ek(ie.location,te,W);I=D()+1;let ee=$6(X,I),fe=ie.createHref(X);try{_.pushState(ee,"",fe)}catch(ye){if(ye instanceof DOMException&&ye.name==="DataCloneError")throw ye;c.location.assign(fe)}f&&a&&a({action:x,location:ie.location,delta:1})}function H(te,W){x=yf.Replace;let X=ek(ie.location,te,W);I=D();let ee=$6(X,I),fe=ie.createHref(X);_.replaceState(ee,"",fe),f&&a&&a({action:x,location:ie.location,delta:0})}function Q(te){let W=c.location.origin!=="null"?c.location.origin:c.location.href,X=typeof te=="string"?te:bS(te);return X=X.replace(/ $/,"%20"),Bs(W,"No window.location.(origin|href) available to create URL for href: "+X),new URL(X,W)}let ie={get action(){return x},get location(){return e(c,_)},listen(te){if(a)throw new Error("A history only accepts one active listener");return c.addEventListener(V6,O),a=te,()=>{c.removeEventListener(V6,O),a=null}},createHref(te){return t(c,te)},createURL:Q,encodeLocation(te){let W=Q(te);return{pathname:W.pathname,search:W.search,hash:W.hash}},push:F,replace:H,go(te){return _.go(te)}};return ie}var q6;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(q6||(q6={}));function cne(e,t,r){return r===void 0&&(r="/"),une(e,t,r,!1)}function une(e,t,r,s){let c=typeof t=="string"?n0(t):t,f=Ry(c.pathname||"/",r);if(f==null)return null;let _=H7(e);hne(_);let x=null;for(let a=0;x==null&&a<_.length;++a){let I=wne(f);x=xne(_[a],I,s)}return x}function H7(e,t,r,s){t===void 0&&(t=[]),r===void 0&&(r=[]),s===void 0&&(s="");let c=(f,_,x)=>{let a={relativePath:x===void 0?f.path||"":x,caseSensitive:f.caseSensitive===!0,childrenIndex:_,route:f};a.relativePath.startsWith("/")&&(Bs(a.relativePath.startsWith(s),'Absolute route path "'+a.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),a.relativePath=a.relativePath.slice(s.length));let I=Mf([s,a.relativePath]),D=r.concat(a);f.children&&f.children.length>0&&(Bs(f.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+I+'".')),H7(f.children,t,D,I)),!(f.path==null&&!f.index)&&t.push({path:I,score:yne(I,f.index),routesMeta:D})};return e.forEach((f,_)=>{var x;if(f.path===""||!((x=f.path)!=null&&x.includes("?")))c(f,_);else for(let a of Z7(f.path))c(f,_,a)}),t}function Z7(e){let t=e.split("/");if(t.length===0)return[];let[r,...s]=t,c=r.endsWith("?"),f=r.replace(/\?$/,"");if(s.length===0)return c?[f,""]:[f];let _=Z7(s.join("/")),x=[];return x.push(..._.map(a=>a===""?f:[f,a].join("/"))),c&&x.push(..._),x.map(a=>e.startsWith("/")&&a===""?"/":a)}function hne(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:vne(t.routesMeta.map(s=>s.childrenIndex),r.routesMeta.map(s=>s.childrenIndex)))}const dne=/^:[\w-]+$/,fne=3,pne=2,mne=1,gne=10,_ne=-2,G6=e=>e==="*";function yne(e,t){let r=e.split("/"),s=r.length;return r.some(G6)&&(s+=_ne),t&&(s+=pne),r.filter(c=>!G6(c)).reduce((c,f)=>c+(dne.test(f)?fne:f===""?mne:gne),s)}function vne(e,t){return e.length===t.length&&e.slice(0,-1).every((s,c)=>s===t[c])?e[e.length-1]-t[t.length-1]:0}function xne(e,t,r){let{routesMeta:s}=e,c={},f="/",_=[];for(let x=0;x<s.length;++x){let a=s[x],I=x===s.length-1,D=f==="/"?t:t.slice(f.length)||"/",O=wS({path:a.relativePath,caseSensitive:a.caseSensitive,end:I},D),F=a.route;if(!O&&I&&r&&!s[s.length-1].route.index&&(O=wS({path:a.relativePath,caseSensitive:a.caseSensitive,end:!1},D)),!O)return null;Object.assign(c,O.params),_.push({params:c,pathname:Mf([f,O.pathname]),pathnameBase:Ine(Mf([f,O.pathnameBase])),route:F}),O.pathnameBase!=="/"&&(f=Mf([f,O.pathnameBase]))}return _}function wS(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,s]=bne(e.path,e.caseSensitive,e.end),c=t.match(r);if(!c)return null;let f=c[0],_=f.replace(/(.)\/+$/,"$1"),x=c.slice(1);return{params:s.reduce((I,D,O)=>{let{paramName:F,isOptional:H}=D;if(F==="*"){let ie=x[O]||"";_=f.slice(0,f.length-ie.length).replace(/(.)\/+$/,"$1")}const Q=x[O];return H&&!Q?I[F]=void 0:I[F]=(Q||"").replace(/%2F/g,"/"),I},{}),pathname:f,pathnameBase:_,pattern:e}}function bne(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),W7(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let s=[],c="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,x,a)=>(s.push({paramName:x,isOptional:a!=null}),a?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(s.push({paramName:"*"}),c+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":e!==""&&e!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,t?void 0:"i"),s]}function wne(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return W7(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function Ry(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,s=e.charAt(r);return s&&s!=="/"?null:e.slice(r)||"/"}function Tne(e,t){t===void 0&&(t="/");let{pathname:r,search:s="",hash:c=""}=typeof e=="string"?n0(e):e;return{pathname:r?r.startsWith("/")?r:Ene(r,t):t,search:Cne(s),hash:Ane(c)}}function Ene(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(c=>{c===".."?r.length>1&&r.pop():c!=="."&&r.push(c)}),r.length>1?r.join("/"):"/"}function uR(e,t,r,s){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Sne(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function X7(e,t){let r=Sne(e);return t?r.map((s,c)=>c===r.length-1?s.pathname:s.pathnameBase):r.map(s=>s.pathnameBase)}function K7(e,t,r,s){s===void 0&&(s=!1);let c;typeof e=="string"?c=n0(e):(c=_x({},e),Bs(!c.pathname||!c.pathname.includes("?"),uR("?","pathname","search",c)),Bs(!c.pathname||!c.pathname.includes("#"),uR("#","pathname","hash",c)),Bs(!c.search||!c.search.includes("#"),uR("#","search","hash",c)));let f=e===""||c.pathname==="",_=f?"/":c.pathname,x;if(_==null)x=r;else{let O=t.length-1;if(!s&&_.startsWith("..")){let F=_.split("/");for(;F[0]==="..";)F.shift(),O-=1;c.pathname=F.join("/")}x=O>=0?t[O]:"/"}let a=Tne(c,x),I=_&&_!=="/"&&_.endsWith("/"),D=(f||_===".")&&r.endsWith("/");return!a.pathname.endsWith("/")&&(I||D)&&(a.pathname+="/"),a}const Mf=e=>e.join("/").replace(/\/\/+/g,"/"),Ine=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Cne=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Ane=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Pne(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const Q7=["post","put","patch","delete"];new Set(Q7);const Rne=["get",...Q7];new Set(Rne);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yx(){return yx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},yx.apply(this,arguments)}const NI=G.createContext(null),Y7=G.createContext(null),Yf=G.createContext(null),FI=G.createContext(null),ng=G.createContext({outlet:null,matches:[],isDataRoute:!1}),J7=G.createContext(null);function Mne(e,t){let{relative:r}=t===void 0?{}:t;tb()||Bs(!1);let{basename:s,navigator:c}=G.useContext(Yf),{hash:f,pathname:_,search:x}=BI(e,{relative:r}),a=_;return s!=="/"&&(a=_==="/"?s:Mf([s,_])),c.createHref({pathname:a,search:x,hash:f})}function tb(){return G.useContext(FI)!=null}function nb(){return tb()||Bs(!1),G.useContext(FI).location}function eq(e){G.useContext(Yf).static||G.useLayoutEffect(e)}function rg(){let{isDataRoute:e}=G.useContext(ng);return e?qne():kne()}function kne(){tb()||Bs(!1);let e=G.useContext(NI),{basename:t,future:r,navigator:s}=G.useContext(Yf),{matches:c}=G.useContext(ng),{pathname:f}=nb(),_=JSON.stringify(X7(c,r.v7_relativeSplatPath)),x=G.useRef(!1);return eq(()=>{x.current=!0}),G.useCallback(function(I,D){if(D===void 0&&(D={}),!x.current)return;if(typeof I=="number"){s.go(I);return}let O=K7(I,JSON.parse(_),f,D.relative==="path");e==null&&t!=="/"&&(O.pathname=O.pathname==="/"?t:Mf([t,O.pathname])),(D.replace?s.replace:s.push)(O,D.state,D)},[t,s,_,f,e])}function BI(e,t){let{relative:r}=t===void 0?{}:t,{future:s}=G.useContext(Yf),{matches:c}=G.useContext(ng),{pathname:f}=nb(),_=JSON.stringify(X7(c,s.v7_relativeSplatPath));return G.useMemo(()=>K7(e,JSON.parse(_),f,r==="path"),[e,_,f,r])}function Dne(e,t){return One(e,t)}function One(e,t,r,s){tb()||Bs(!1);let{navigator:c}=G.useContext(Yf),{matches:f}=G.useContext(ng),_=f[f.length-1],x=_?_.params:{};_&&_.pathname;let a=_?_.pathnameBase:"/";_&&_.route;let I=nb(),D;if(t){var O;let te=typeof t=="string"?n0(t):t;a==="/"||(O=te.pathname)!=null&&O.startsWith(a)||Bs(!1),D=te}else D=I;let F=D.pathname||"/",H=F;if(a!=="/"){let te=a.replace(/^\//,"").split("/");H="/"+F.replace(/^\//,"").split("/").slice(te.length).join("/")}let Q=cne(e,{pathname:H}),ie=Bne(Q&&Q.map(te=>Object.assign({},te,{params:Object.assign({},x,te.params),pathname:Mf([a,c.encodeLocation?c.encodeLocation(te.pathname).pathname:te.pathname]),pathnameBase:te.pathnameBase==="/"?a:Mf([a,c.encodeLocation?c.encodeLocation(te.pathnameBase).pathname:te.pathnameBase])})),f,r,s);return t&&ie?G.createElement(FI.Provider,{value:{location:yx({pathname:"/",search:"",hash:"",state:null,key:"default"},D),navigationType:yf.Pop}},ie):ie}function Lne(){let e=$ne(),t=Pne(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return G.createElement(G.Fragment,null,G.createElement("h2",null,"Unexpected Application Error!"),G.createElement("h3",{style:{fontStyle:"italic"}},t),r?G.createElement("pre",{style:c},r):null,null)}const zne=G.createElement(Lne,null);class Nne extends G.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?G.createElement(ng.Provider,{value:this.props.routeContext},G.createElement(J7.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Fne(e){let{routeContext:t,match:r,children:s}=e,c=G.useContext(NI);return c&&c.static&&c.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=r.route.id),G.createElement(ng.Provider,{value:t},s)}function Bne(e,t,r,s){var c;if(t===void 0&&(t=[]),r===void 0&&(r=null),s===void 0&&(s=null),e==null){var f;if(!r)return null;if(r.errors)e=r.matches;else if((f=s)!=null&&f.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let _=e,x=(c=r)==null?void 0:c.errors;if(x!=null){let D=_.findIndex(O=>O.route.id&&(x==null?void 0:x[O.route.id])!==void 0);D>=0||Bs(!1),_=_.slice(0,Math.min(_.length,D+1))}let a=!1,I=-1;if(r&&s&&s.v7_partialHydration)for(let D=0;D<_.length;D++){let O=_[D];if((O.route.HydrateFallback||O.route.hydrateFallbackElement)&&(I=D),O.route.id){let{loaderData:F,errors:H}=r,Q=O.route.loader&&F[O.route.id]===void 0&&(!H||H[O.route.id]===void 0);if(O.route.lazy||Q){a=!0,I>=0?_=_.slice(0,I+1):_=[_[0]];break}}}return _.reduceRight((D,O,F)=>{let H,Q=!1,ie=null,te=null;r&&(H=x&&O.route.id?x[O.route.id]:void 0,ie=O.route.errorElement||zne,a&&(I<0&&F===0?(Q=!0,te=null):I===F&&(Q=!0,te=O.route.hydrateFallbackElement||null)));let W=t.concat(_.slice(0,F+1)),X=()=>{let ee;return H?ee=ie:Q?ee=te:O.route.Component?ee=G.createElement(O.route.Component,null):O.route.element?ee=O.route.element:ee=D,G.createElement(Fne,{match:O,routeContext:{outlet:D,matches:W,isDataRoute:r!=null},children:ee})};return r&&(O.route.ErrorBoundary||O.route.errorElement||F===0)?G.createElement(Nne,{location:r.location,revalidation:r.revalidation,component:ie,error:H,children:X(),routeContext:{outlet:null,matches:W,isDataRoute:!0}}):X()},null)}var tq=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(tq||{}),TS=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(TS||{});function jne(e){let t=G.useContext(NI);return t||Bs(!1),t}function Une(e){let t=G.useContext(Y7);return t||Bs(!1),t}function Vne(e){let t=G.useContext(ng);return t||Bs(!1),t}function nq(e){let t=Vne(),r=t.matches[t.matches.length-1];return r.route.id||Bs(!1),r.route.id}function $ne(){var e;let t=G.useContext(J7),r=Une(TS.UseRouteError),s=nq(TS.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[s]}function qne(){let{router:e}=jne(tq.UseNavigateStable),t=nq(TS.UseNavigateStable),r=G.useRef(!1);return eq(()=>{r.current=!0}),G.useCallback(function(c,f){f===void 0&&(f={}),r.current&&(typeof c=="number"?e.navigate(c):e.navigate(c,yx({fromRouteId:t},f)))},[e,t])}function Fc(e){Bs(!1)}function Gne(e){let{basename:t="/",children:r=null,location:s,navigationType:c=yf.Pop,navigator:f,static:_=!1,future:x}=e;tb()&&Bs(!1);let a=t.replace(/^\/*/,"/"),I=G.useMemo(()=>({basename:a,navigator:f,static:_,future:yx({v7_relativeSplatPath:!1},x)}),[a,x,f,_]);typeof s=="string"&&(s=n0(s));let{pathname:D="/",search:O="",hash:F="",state:H=null,key:Q="default"}=s,ie=G.useMemo(()=>{let te=Ry(D,a);return te==null?null:{location:{pathname:te,search:O,hash:F,state:H,key:Q},navigationType:c}},[a,D,O,F,H,Q,c]);return ie==null?null:G.createElement(Yf.Provider,{value:I},G.createElement(FI.Provider,{children:r,value:ie}))}function rq(e){let{children:t,location:r}=e;return Dne(tk(t),r)}new Promise(()=>{});function tk(e,t){t===void 0&&(t=[]);let r=[];return G.Children.forEach(e,(s,c)=>{if(!G.isValidElement(s))return;let f=[...t,c];if(s.type===G.Fragment){r.push.apply(r,tk(s.props.children,f));return}s.type!==Fc&&Bs(!1),!s.props.index||!s.props.children||Bs(!1);let _={id:s.props.id||f.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(_.children=tk(s.props.children,f)),r.push(_)}),r}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ES(){return ES=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},ES.apply(this,arguments)}function iq(e,t){if(e==null)return{};var r={},s=Object.keys(e),c,f;for(f=0;f<s.length;f++)c=s[f],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function Wne(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function Hne(e,t){return e.button===0&&(!t||t==="_self")&&!Wne(e)}const Zne=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],Xne=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],Kne="6";try{window.__reactRouterVersion=Kne}catch(e){}const Qne=G.createContext({isTransitioning:!1}),Yne="startTransition",W6=KE[Yne];function Jne(e){let{basename:t,children:r,future:s,window:c}=e,f=G.useRef();f.current==null&&(f.current=one({window:c,v5Compat:!0}));let _=f.current,[x,a]=G.useState({action:_.action,location:_.location}),{v7_startTransition:I}=s||{},D=G.useCallback(O=>{I&&W6?W6(()=>a(O)):a(O)},[a,I]);return G.useLayoutEffect(()=>_.listen(D),[_,D]),G.createElement(Gne,{basename:t,children:r,location:x.location,navigationType:x.action,navigator:_,future:s})}const ere=typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement!="undefined",tre=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,jI=G.forwardRef(function(t,r){let{onClick:s,relative:c,reloadDocument:f,replace:_,state:x,target:a,to:I,preventScrollReset:D,unstable_viewTransition:O}=t,F=iq(t,Zne),{basename:H}=G.useContext(Yf),Q,ie=!1;if(typeof I=="string"&&tre.test(I)&&(Q=I,ere))try{let ee=new URL(window.location.href),fe=I.startsWith("//")?new URL(ee.protocol+I):new URL(I),ye=Ry(fe.pathname,H);fe.origin===ee.origin&&ye!=null?I=ye+fe.search+fe.hash:ie=!0}catch(ee){}let te=Mne(I,{relative:c}),W=ire(I,{replace:_,state:x,target:a,preventScrollReset:D,relative:c,unstable_viewTransition:O});function X(ee){s&&s(ee),ee.defaultPrevented||W(ee)}return G.createElement("a",ES({},F,{href:Q||te,onClick:ie||f?s:X,ref:r,target:a}))}),nre=G.forwardRef(function(t,r){let{"aria-current":s="page",caseSensitive:c=!1,className:f="",end:_=!1,style:x,to:a,unstable_viewTransition:I,children:D}=t,O=iq(t,Xne),F=BI(a,{relative:O.relative}),H=nb(),Q=G.useContext(Y7),{navigator:ie,basename:te}=G.useContext(Yf),W=Q!=null&&sre(F)&&I===!0,X=ie.encodeLocation?ie.encodeLocation(F).pathname:F.pathname,ee=H.pathname,fe=Q&&Q.navigation&&Q.navigation.location?Q.navigation.location.pathname:null;c||(ee=ee.toLowerCase(),fe=fe?fe.toLowerCase():null,X=X.toLowerCase()),fe&&te&&(fe=Ry(fe,te)||fe);const ye=X!=="/"&&X.endsWith("/")?X.length-1:X.length;let Ee=ee===X||!_&&ee.startsWith(X)&&ee.charAt(ye)==="/",re=fe!=null&&(fe===X||!_&&fe.startsWith(X)&&fe.charAt(X.length)==="/"),he={isActive:Ee,isPending:re,isTransitioning:W},_e=Ee?s:void 0,Se;typeof f=="function"?Se=f(he):Se=[f,Ee?"active":null,re?"pending":null,W?"transitioning":null].filter(Boolean).join(" ");let J=typeof x=="function"?x(he):x;return G.createElement(jI,ES({},O,{"aria-current":_e,className:Se,ref:r,style:J,to:a,unstable_viewTransition:I}),typeof D=="function"?D(he):D)});var nk;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(nk||(nk={}));var H6;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(H6||(H6={}));function rre(e){let t=G.useContext(NI);return t||Bs(!1),t}function ire(e,t){let{target:r,replace:s,state:c,preventScrollReset:f,relative:_,unstable_viewTransition:x}=t===void 0?{}:t,a=rg(),I=nb(),D=BI(e,{relative:_});return G.useCallback(O=>{if(Hne(O,r)){O.preventDefault();let F=s!==void 0?s:bS(I)===bS(D);a(e,{replace:F,state:c,preventScrollReset:f,relative:_,unstable_viewTransition:x})}},[I,a,D,s,c,r,e,f,_,x])}function sre(e,t){t===void 0&&(t={});let r=G.useContext(Qne);r==null&&Bs(!1);let{basename:s}=rre(nk.useViewTransitionState),c=BI(e,{relative:t.relative});if(!r.isTransitioning)return!1;let f=Ry(r.currentLocation.pathname,s)||r.currentLocation.pathname,_=Ry(r.nextLocation.pathname,s)||r.nextLocation.pathname;return wS(c.pathname,_)!=null||wS(c.pathname,f)!=null}var ore=function(t){return are(t)&&!lre(t)};function are(e){return!!e&&typeof e=="object"}function lre(e){var t=Object.prototype.toString.call(e);return t==="[object RegExp]"||t==="[object Date]"||hre(e)}var cre=typeof Symbol=="function"&&Symbol.for,ure=cre?Symbol.for("react.element"):60103;function hre(e){return e.$$typeof===ure}function dre(e){return Array.isArray(e)?[]:{}}function SS(e,t){return t.clone!==!1&&t.isMergeableObject(e)?vx(dre(e),e,t):e}function fre(e,t,r){return e.concat(t).map(function(s){return SS(s,r)})}function pre(e,t,r){var s={};return r.isMergeableObject(e)&&Object.keys(e).forEach(function(c){s[c]=SS(e[c],r)}),Object.keys(t).forEach(function(c){!r.isMergeableObject(t[c])||!e[c]?s[c]=SS(t[c],r):s[c]=vx(e[c],t[c],r)}),s}function vx(e,t,r){r=r||{},r.arrayMerge=r.arrayMerge||fre,r.isMergeableObject=r.isMergeableObject||ore;var s=Array.isArray(t),c=Array.isArray(e),f=s===c;return f?s?r.arrayMerge(e,t,r):pre(e,t,r):SS(t,r)}vx.all=function(t,r){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce(function(s,c){return vx(s,c,r)},{})};var rk=vx,sq=typeof global=="object"&&global&&global.Object===Object&&global,mre=typeof self=="object"&&self&&self.Object===Object&&self,Xu=sq||mre||Function("return this")(),Bf=Xu.Symbol,oq=Object.prototype,gre=oq.hasOwnProperty,_re=oq.toString,Zv=Bf?Bf.toStringTag:void 0;function yre(e){var t=gre.call(e,Zv),r=e[Zv];try{e[Zv]=void 0;var s=!0}catch(f){}var c=_re.call(e);return s&&(t?e[Zv]=r:delete e[Zv]),c}var vre=Object.prototype,xre=vre.toString;function bre(e){return xre.call(e)}var wre="[object Null]",Tre="[object Undefined]",Z6=Bf?Bf.toStringTag:void 0;function ig(e){return e==null?e===void 0?Tre:wre:Z6&&Z6 in Object(e)?yre(e):bre(e)}function aq(e,t){return function(r){return e(t(r))}}var BD=aq(Object.getPrototypeOf,Object);function sg(e){return e!=null&&typeof e=="object"}var Ere="[object Object]",Sre=Function.prototype,Ire=Object.prototype,lq=Sre.toString,Cre=Ire.hasOwnProperty,Are=lq.call(Object);function X6(e){if(!sg(e)||ig(e)!=Ere)return!1;var t=BD(e);if(t===null)return!0;var r=Cre.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&lq.call(r)==Are}function Pre(){this.__data__=[],this.size=0}function cq(e,t){return e===t||e!==e&&t!==t}function UI(e,t){for(var r=e.length;r--;)if(cq(e[r][0],t))return r;return-1}var Rre=Array.prototype,Mre=Rre.splice;function kre(e){var t=this.__data__,r=UI(t,e);if(r<0)return!1;var s=t.length-1;return r==s?t.pop():Mre.call(t,r,1),--this.size,!0}function Dre(e){var t=this.__data__,r=UI(t,e);return r<0?void 0:t[r][1]}function Ore(e){return UI(this.__data__,e)>-1}function Lre(e,t){var r=this.__data__,s=UI(r,e);return s<0?(++this.size,r.push([e,t])):r[s][1]=t,this}function ad(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}ad.prototype.clear=Pre;ad.prototype.delete=kre;ad.prototype.get=Dre;ad.prototype.has=Ore;ad.prototype.set=Lre;function zre(){this.__data__=new ad,this.size=0}function Nre(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function Fre(e){return this.__data__.get(e)}function Bre(e){return this.__data__.has(e)}function rb(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var jre="[object AsyncFunction]",Ure="[object Function]",Vre="[object GeneratorFunction]",$re="[object Proxy]";function uq(e){if(!rb(e))return!1;var t=ig(e);return t==Ure||t==Vre||t==jre||t==$re}var hR=Xu["__core-js_shared__"],K6=function(){var e=/[^.]+$/.exec(hR&&hR.keys&&hR.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function qre(e){return!!K6&&K6 in e}var Gre=Function.prototype,Wre=Gre.toString;function og(e){if(e!=null){try{return Wre.call(e)}catch(t){}try{return e+""}catch(t){}}return""}var Hre=/[\\^$.*+?()[\]{}|]/g,Zre=/^\[object .+?Constructor\]$/,Xre=Function.prototype,Kre=Object.prototype,Qre=Xre.toString,Yre=Kre.hasOwnProperty,Jre=RegExp("^"+Qre.call(Yre).replace(Hre,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function eie(e){if(!rb(e)||qre(e))return!1;var t=uq(e)?Jre:Zre;return t.test(og(e))}function tie(e,t){return e==null?void 0:e[t]}function ag(e,t){var r=tie(e,t);return eie(r)?r:void 0}var xx=ag(Xu,"Map"),bx=ag(Object,"create");function nie(){this.__data__=bx?bx(null):{},this.size=0}function rie(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var iie="__lodash_hash_undefined__",sie=Object.prototype,oie=sie.hasOwnProperty;function aie(e){var t=this.__data__;if(bx){var r=t[e];return r===iie?void 0:r}return oie.call(t,e)?t[e]:void 0}var lie=Object.prototype,cie=lie.hasOwnProperty;function uie(e){var t=this.__data__;return bx?t[e]!==void 0:cie.call(t,e)}var hie="__lodash_hash_undefined__";function die(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=bx&&t===void 0?hie:t,this}function Um(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}Um.prototype.clear=nie;Um.prototype.delete=rie;Um.prototype.get=aie;Um.prototype.has=uie;Um.prototype.set=die;function fie(){this.size=0,this.__data__={hash:new Um,map:new(xx||ad),string:new Um}}function pie(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function VI(e,t){var r=e.__data__;return pie(t)?r[typeof t=="string"?"string":"hash"]:r.map}function mie(e){var t=VI(this,e).delete(e);return this.size-=t?1:0,t}function gie(e){return VI(this,e).get(e)}function _ie(e){return VI(this,e).has(e)}function yie(e,t){var r=VI(this,e),s=r.size;return r.set(e,t),this.size+=r.size==s?0:1,this}function Jf(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var s=e[t];this.set(s[0],s[1])}}Jf.prototype.clear=fie;Jf.prototype.delete=mie;Jf.prototype.get=gie;Jf.prototype.has=_ie;Jf.prototype.set=yie;var vie=200;function xie(e,t){var r=this.__data__;if(r instanceof ad){var s=r.__data__;if(!xx||s.length<vie-1)return s.push([e,t]),this.size=++r.size,this;r=this.__data__=new Jf(s)}return r.set(e,t),this.size=r.size,this}function r0(e){var t=this.__data__=new ad(e);this.size=t.size}r0.prototype.clear=zre;r0.prototype.delete=Nre;r0.prototype.get=Fre;r0.prototype.has=Bre;r0.prototype.set=xie;function bie(e,t){for(var r=-1,s=e==null?0:e.length;++r<s&&t(e[r],r,e)!==!1;);return e}var Q6=function(){try{var e=ag(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();function hq(e,t,r){t=="__proto__"&&Q6?Q6(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var wie=Object.prototype,Tie=wie.hasOwnProperty;function dq(e,t,r){var s=e[t];(!(Tie.call(e,t)&&cq(s,r))||r===void 0&&!(t in e))&&hq(e,t,r)}function $I(e,t,r,s){var c=!r;r||(r={});for(var f=-1,_=t.length;++f<_;){var x=t[f],a=void 0;a===void 0&&(a=e[x]),c?hq(r,x,a):dq(r,x,a)}return r}function Eie(e,t){for(var r=-1,s=Array(e);++r<e;)s[r]=t(r);return s}var Sie="[object Arguments]";function Y6(e){return sg(e)&&ig(e)==Sie}var fq=Object.prototype,Iie=fq.hasOwnProperty,Cie=fq.propertyIsEnumerable,Aie=Y6(function(){return arguments}())?Y6:function(e){return sg(e)&&Iie.call(e,"callee")&&!Cie.call(e,"callee")},ib=Array.isArray;function Pie(){return!1}var pq=typeof xn=="object"&&xn&&!xn.nodeType&&xn,J6=pq&&typeof gl=="object"&&gl&&!gl.nodeType&&gl,Rie=J6&&J6.exports===pq,ej=Rie?Xu.Buffer:void 0,Mie=ej?ej.isBuffer:void 0,mq=Mie||Pie,kie=9007199254740991,Die=/^(?:0|[1-9]\d*)$/;function Oie(e,t){var r=typeof e;return t=t==null?kie:t,!!t&&(r=="number"||r!="symbol"&&Die.test(e))&&e>-1&&e%1==0&&e<t}var Lie=9007199254740991;function gq(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Lie}var zie="[object Arguments]",Nie="[object Array]",Fie="[object Boolean]",Bie="[object Date]",jie="[object Error]",Uie="[object Function]",Vie="[object Map]",$ie="[object Number]",qie="[object Object]",Gie="[object RegExp]",Wie="[object Set]",Hie="[object String]",Zie="[object WeakMap]",Xie="[object ArrayBuffer]",Kie="[object DataView]",Qie="[object Float32Array]",Yie="[object Float64Array]",Jie="[object Int8Array]",ese="[object Int16Array]",tse="[object Int32Array]",nse="[object Uint8Array]",rse="[object Uint8ClampedArray]",ise="[object Uint16Array]",sse="[object Uint32Array]",rs={};rs[Qie]=rs[Yie]=rs[Jie]=rs[ese]=rs[tse]=rs[nse]=rs[rse]=rs[ise]=rs[sse]=!0;rs[zie]=rs[Nie]=rs[Xie]=rs[Fie]=rs[Kie]=rs[Bie]=rs[jie]=rs[Uie]=rs[Vie]=rs[$ie]=rs[qie]=rs[Gie]=rs[Wie]=rs[Hie]=rs[Zie]=!1;function ose(e){return sg(e)&&gq(e.length)&&!!rs[ig(e)]}function jD(e){return function(t){return e(t)}}var _q=typeof xn=="object"&&xn&&!xn.nodeType&&xn,D1=_q&&typeof gl=="object"&&gl&&!gl.nodeType&&gl,ase=D1&&D1.exports===_q,dR=ase&&sq.process,My=function(){try{var e=D1&&D1.require&&D1.require("util").types;return e||dR&&dR.binding&&dR.binding("util")}catch(t){}}(),tj=My&&My.isTypedArray,lse=tj?jD(tj):ose,cse=Object.prototype,use=cse.hasOwnProperty;function yq(e,t){var r=ib(e),s=!r&&Aie(e),c=!r&&!s&&mq(e),f=!r&&!s&&!c&&lse(e),_=r||s||c||f,x=_?Eie(e.length,String):[],a=x.length;for(var I in e)(t||use.call(e,I))&&!(_&&(I=="length"||c&&(I=="offset"||I=="parent")||f&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||Oie(I,a)))&&x.push(I);return x}var hse=Object.prototype;function UD(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||hse;return e===r}var dse=aq(Object.keys,Object),fse=Object.prototype,pse=fse.hasOwnProperty;function mse(e){if(!UD(e))return dse(e);var t=[];for(var r in Object(e))pse.call(e,r)&&r!="constructor"&&t.push(r);return t}function vq(e){return e!=null&&gq(e.length)&&!uq(e)}function VD(e){return vq(e)?yq(e):mse(e)}function gse(e,t){return e&&$I(t,VD(t),e)}function _se(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var yse=Object.prototype,vse=yse.hasOwnProperty;function xse(e){if(!rb(e))return _se(e);var t=UD(e),r=[];for(var s in e)s=="constructor"&&(t||!vse.call(e,s))||r.push(s);return r}function $D(e){return vq(e)?yq(e,!0):xse(e)}function bse(e,t){return e&&$I(t,$D(t),e)}var xq=typeof xn=="object"&&xn&&!xn.nodeType&&xn,nj=xq&&typeof gl=="object"&&gl&&!gl.nodeType&&gl,wse=nj&&nj.exports===xq,rj=wse?Xu.Buffer:void 0,ij=rj?rj.allocUnsafe:void 0;function Tse(e,t){if(t)return e.slice();var r=e.length,s=ij?ij(r):new e.constructor(r);return e.copy(s),s}function bq(e,t){var r=-1,s=e.length;for(t||(t=Array(s));++r<s;)t[r]=e[r];return t}function Ese(e,t){for(var r=-1,s=e==null?0:e.length,c=0,f=[];++r<s;){var _=e[r];t(_,r,e)&&(f[c++]=_)}return f}function wq(){return[]}var Sse=Object.prototype,Ise=Sse.propertyIsEnumerable,sj=Object.getOwnPropertySymbols,qD=sj?function(e){return e==null?[]:(e=Object(e),Ese(sj(e),function(t){return Ise.call(e,t)}))}:wq;function Cse(e,t){return $I(e,qD(e),t)}function Tq(e,t){for(var r=-1,s=t.length,c=e.length;++r<s;)e[c+r]=t[r];return e}var Ase=Object.getOwnPropertySymbols,Eq=Ase?function(e){for(var t=[];e;)Tq(t,qD(e)),e=BD(e);return t}:wq;function Pse(e,t){return $I(e,Eq(e),t)}function Sq(e,t,r){var s=t(e);return ib(e)?s:Tq(s,r(e))}function Rse(e){return Sq(e,VD,qD)}function Mse(e){return Sq(e,$D,Eq)}var ik=ag(Xu,"DataView"),sk=ag(Xu,"Promise"),ok=ag(Xu,"Set"),ak=ag(Xu,"WeakMap"),oj="[object Map]",kse="[object Object]",aj="[object Promise]",lj="[object Set]",cj="[object WeakMap]",uj="[object DataView]",Dse=og(ik),Ose=og(xx),Lse=og(sk),zse=og(ok),Nse=og(ak),Lh=ig;(ik&&Lh(new ik(new ArrayBuffer(1)))!=uj||xx&&Lh(new xx)!=oj||sk&&Lh(sk.resolve())!=aj||ok&&Lh(new ok)!=lj||ak&&Lh(new ak)!=cj)&&(Lh=function(e){var t=ig(e),r=t==kse?e.constructor:void 0,s=r?og(r):"";if(s)switch(s){case Dse:return uj;case Ose:return oj;case Lse:return aj;case zse:return lj;case Nse:return cj}return t});var Fse=Object.prototype,Bse=Fse.hasOwnProperty;function jse(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&Bse.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var hj=Xu.Uint8Array;function GD(e){var t=new e.constructor(e.byteLength);return new hj(t).set(new hj(e)),t}function Use(e,t){var r=t?GD(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var Vse=/\w*$/;function $se(e){var t=new e.constructor(e.source,Vse.exec(e));return t.lastIndex=e.lastIndex,t}var dj=Bf?Bf.prototype:void 0,fj=dj?dj.valueOf:void 0;function qse(e){return fj?Object(fj.call(e)):{}}function Gse(e,t){var r=t?GD(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var Wse="[object Boolean]",Hse="[object Date]",Zse="[object Map]",Xse="[object Number]",Kse="[object RegExp]",Qse="[object Set]",Yse="[object String]",Jse="[object Symbol]",eoe="[object ArrayBuffer]",toe="[object DataView]",noe="[object Float32Array]",roe="[object Float64Array]",ioe="[object Int8Array]",soe="[object Int16Array]",ooe="[object Int32Array]",aoe="[object Uint8Array]",loe="[object Uint8ClampedArray]",coe="[object Uint16Array]",uoe="[object Uint32Array]";function hoe(e,t,r){var s=e.constructor;switch(t){case eoe:return GD(e);case Wse:case Hse:return new s(+e);case toe:return Use(e,r);case noe:case roe:case ioe:case soe:case ooe:case aoe:case loe:case coe:case uoe:return Gse(e,r);case Zse:return new s;case Xse:case Yse:return new s(e);case Kse:return $se(e);case Qse:return new s;case Jse:return qse(e)}}var pj=Object.create,doe=function(){function e(){}return function(t){if(!rb(t))return{};if(pj)return pj(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();function foe(e){return typeof e.constructor=="function"&&!UD(e)?doe(BD(e)):{}}var poe="[object Map]";function moe(e){return sg(e)&&Lh(e)==poe}var mj=My&&My.isMap,goe=mj?jD(mj):moe,_oe="[object Set]";function yoe(e){return sg(e)&&Lh(e)==_oe}var gj=My&&My.isSet,voe=gj?jD(gj):yoe,xoe=1,boe=2,woe=4,Iq="[object Arguments]",Toe="[object Array]",Eoe="[object Boolean]",Soe="[object Date]",Ioe="[object Error]",Cq="[object Function]",Coe="[object GeneratorFunction]",Aoe="[object Map]",Poe="[object Number]",Aq="[object Object]",Roe="[object RegExp]",Moe="[object Set]",koe="[object String]",Doe="[object Symbol]",Ooe="[object WeakMap]",Loe="[object ArrayBuffer]",zoe="[object DataView]",Noe="[object Float32Array]",Foe="[object Float64Array]",Boe="[object Int8Array]",joe="[object Int16Array]",Uoe="[object Int32Array]",Voe="[object Uint8Array]",$oe="[object Uint8ClampedArray]",qoe="[object Uint16Array]",Goe="[object Uint32Array]",Xi={};Xi[Iq]=Xi[Toe]=Xi[Loe]=Xi[zoe]=Xi[Eoe]=Xi[Soe]=Xi[Noe]=Xi[Foe]=Xi[Boe]=Xi[joe]=Xi[Uoe]=Xi[Aoe]=Xi[Poe]=Xi[Aq]=Xi[Roe]=Xi[Moe]=Xi[koe]=Xi[Doe]=Xi[Voe]=Xi[$oe]=Xi[qoe]=Xi[Goe]=!0;Xi[Ioe]=Xi[Cq]=Xi[Ooe]=!1;function O1(e,t,r,s,c,f){var _,x=t&xoe,a=t&boe,I=t&woe;if(_!==void 0)return _;if(!rb(e))return e;var D=ib(e);if(D){if(_=jse(e),!x)return bq(e,_)}else{var O=Lh(e),F=O==Cq||O==Coe;if(mq(e))return Tse(e,x);if(O==Aq||O==Iq||F&&!c){if(_=a||F?{}:foe(e),!x)return a?Pse(e,bse(_,e)):Cse(e,gse(_,e))}else{if(!Xi[O])return c?e:{};_=hoe(e,O,x)}}f||(f=new r0);var H=f.get(e);if(H)return H;f.set(e,_),voe(e)?e.forEach(function(te){_.add(O1(te,t,r,te,e,f))}):goe(e)&&e.forEach(function(te,W){_.set(W,O1(te,t,r,W,e,f))});var Q=I?a?Mse:Rse:a?$D:VD,ie=D?void 0:Q(e);return bie(ie||e,function(te,W){ie&&(W=te,te=e[W]),dq(_,W,O1(te,t,r,W,e,f))}),_}var Woe=1,Hoe=4;function qT(e){return O1(e,Woe|Hoe)}var _j=Array.isArray,yj=Object.keys,Zoe=Object.prototype.hasOwnProperty,Xoe=typeof Element!="undefined";function lk(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=_j(e),s=_j(t),c,f,_;if(r&&s){if(f=e.length,f!=t.length)return!1;for(c=f;c--!==0;)if(!lk(e[c],t[c]))return!1;return!0}if(r!=s)return!1;var x=e instanceof Date,a=t instanceof Date;if(x!=a)return!1;if(x&&a)return e.getTime()==t.getTime();var I=e instanceof RegExp,D=t instanceof RegExp;if(I!=D)return!1;if(I&&D)return e.toString()==t.toString();var O=yj(e);if(f=O.length,f!==yj(t).length)return!1;for(c=f;c--!==0;)if(!Zoe.call(t,O[c]))return!1;if(Xoe&&e instanceof Element&&t instanceof Element)return e===t;for(c=f;c--!==0;)if(_=O[c],!(_==="_owner"&&e.$$typeof)&&!lk(e[_],t[_]))return!1;return!0}return e!==e&&t!==t}var Koe=function(t,r){try{return lk(t,r)}catch(s){if(s.message&&s.message.match(/stack|recursion/i)||s.number===-2146828260)return console.warn("Warning: react-fast-compare does not handle circular references.",s.name,s.message),!1;throw s}};const am=Yy(Koe);var Qoe=4;function vj(e){return O1(e,Qoe)}function Pq(e,t){for(var r=-1,s=e==null?0:e.length,c=Array(s);++r<s;)c[r]=t(e[r],r,e);return c}var Yoe="[object Symbol]";function WD(e){return typeof e=="symbol"||sg(e)&&ig(e)==Yoe}var Joe="Expected a function";function HD(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Joe);var r=function(){var s=arguments,c=t?t.apply(this,s):s[0],f=r.cache;if(f.has(c))return f.get(c);var _=e.apply(this,s);return r.cache=f.set(c,_)||f,_};return r.cache=new(HD.Cache||Jf),r}HD.Cache=Jf;var eae=500;function tae(e){var t=HD(e,function(s){return r.size===eae&&r.clear(),s}),r=t.cache;return t}var nae=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rae=/\\(\\)?/g,iae=tae(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(nae,function(r,s,c,f){t.push(c?f.replace(rae,"$1"):s||r)}),t}),sae=1/0;function oae(e){if(typeof e=="string"||WD(e))return e;var t=e+"";return t=="0"&&1/e==-sae?"-0":t}var aae=1/0,xj=Bf?Bf.prototype:void 0,bj=xj?xj.toString:void 0;function Rq(e){if(typeof e=="string")return e;if(ib(e))return Pq(e,Rq)+"";if(WD(e))return bj?bj.call(e):"";var t=e+"";return t=="0"&&1/e==-aae?"-0":t}function lae(e){return e==null?"":Rq(e)}function Mq(e){return ib(e)?Pq(e,oae):WD(e)?[e]:bq(iae(lae(e)))}var kq={exports:{}},ki={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ao=typeof Symbol=="function"&&Symbol.for,ZD=Ao?Symbol.for("react.element"):60103,XD=Ao?Symbol.for("react.portal"):60106,qI=Ao?Symbol.for("react.fragment"):60107,GI=Ao?Symbol.for("react.strict_mode"):60108,WI=Ao?Symbol.for("react.profiler"):60114,HI=Ao?Symbol.for("react.provider"):60109,ZI=Ao?Symbol.for("react.context"):60110,KD=Ao?Symbol.for("react.async_mode"):60111,XI=Ao?Symbol.for("react.concurrent_mode"):60111,KI=Ao?Symbol.for("react.forward_ref"):60112,QI=Ao?Symbol.for("react.suspense"):60113,cae=Ao?Symbol.for("react.suspense_list"):60120,YI=Ao?Symbol.for("react.memo"):60115,JI=Ao?Symbol.for("react.lazy"):60116,uae=Ao?Symbol.for("react.block"):60121,hae=Ao?Symbol.for("react.fundamental"):60117,dae=Ao?Symbol.for("react.responder"):60118,fae=Ao?Symbol.for("react.scope"):60119;function Sl(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case ZD:switch(e=e.type,e){case KD:case XI:case qI:case WI:case GI:case QI:return e;default:switch(e=e&&e.$$typeof,e){case ZI:case KI:case JI:case YI:case HI:return e;default:return t}}case XD:return t}}}function Dq(e){return Sl(e)===XI}ki.AsyncMode=KD;ki.ConcurrentMode=XI;ki.ContextConsumer=ZI;ki.ContextProvider=HI;ki.Element=ZD;ki.ForwardRef=KI;ki.Fragment=qI;ki.Lazy=JI;ki.Memo=YI;ki.Portal=XD;ki.Profiler=WI;ki.StrictMode=GI;ki.Suspense=QI;ki.isAsyncMode=function(e){return Dq(e)||Sl(e)===KD};ki.isConcurrentMode=Dq;ki.isContextConsumer=function(e){return Sl(e)===ZI};ki.isContextProvider=function(e){return Sl(e)===HI};ki.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===ZD};ki.isForwardRef=function(e){return Sl(e)===KI};ki.isFragment=function(e){return Sl(e)===qI};ki.isLazy=function(e){return Sl(e)===JI};ki.isMemo=function(e){return Sl(e)===YI};ki.isPortal=function(e){return Sl(e)===XD};ki.isProfiler=function(e){return Sl(e)===WI};ki.isStrictMode=function(e){return Sl(e)===GI};ki.isSuspense=function(e){return Sl(e)===QI};ki.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===qI||e===XI||e===WI||e===GI||e===QI||e===cae||typeof e=="object"&&e!==null&&(e.$$typeof===JI||e.$$typeof===YI||e.$$typeof===HI||e.$$typeof===ZI||e.$$typeof===KI||e.$$typeof===hae||e.$$typeof===dae||e.$$typeof===fae||e.$$typeof===uae)};ki.typeOf=Sl;kq.exports=ki;var pae=kq.exports,Oq=pae,mae={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},gae={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Lq={};Lq[Oq.ForwardRef]=mae;Lq[Oq.Memo]=gae;function is(){return is=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},is.apply(this,arguments)}function Y_(e,t){if(e==null)return{};var r={},s=Object.keys(e),c,f;for(f=0;f<s.length;f++)c=s[f],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}var eC=G.createContext(void 0);eC.displayName="FormikContext";var _ae=eC.Provider;eC.Consumer;function zq(){var e=G.useContext(eC);return e}var ll=function(t){return typeof t=="function"},tC=function(t){return t!==null&&typeof t=="object"},yae=function(t){return String(Math.floor(Number(t)))===t},fR=function(t){return Object.prototype.toString.call(t)==="[object String]"},vae=function(t){return G.Children.count(t)===0},pR=function(t){return tC(t)&&ll(t.then)};function al(e,t,r,s){s===void 0&&(s=0);for(var c=Mq(t);e&&s<c.length;)e=e[c[s++]];return s!==c.length&&!e||e===void 0?r:e}function Cm(e,t,r){for(var s=vj(e),c=s,f=0,_=Mq(t);f<_.length-1;f++){var x=_[f],a=al(e,_.slice(0,f+1));if(a&&(tC(a)||Array.isArray(a)))c=c[x]=vj(a);else{var I=_[f+1];c=c[x]=yae(I)&&Number(I)>=0?[]:{}}}return(f===0?e:c)[_[f]]===r?e:(r===void 0?delete c[_[f]]:c[_[f]]=r,f===0&&r===void 0&&delete s[_[f]],s)}function Nq(e,t,r,s){r===void 0&&(r=new WeakMap),s===void 0&&(s={});for(var c=0,f=Object.keys(e);c<f.length;c++){var _=f[c],x=e[_];tC(x)?r.get(x)||(r.set(x,!0),s[_]=Array.isArray(x)?[]:{},Nq(x,t,r,s[_])):s[_]=t}return s}function xae(e,t){switch(t.type){case"SET_VALUES":return is({},e,{values:t.payload});case"SET_TOUCHED":return is({},e,{touched:t.payload});case"SET_ERRORS":return am(e.errors,t.payload)?e:is({},e,{errors:t.payload});case"SET_STATUS":return is({},e,{status:t.payload});case"SET_ISSUBMITTING":return is({},e,{isSubmitting:t.payload});case"SET_ISVALIDATING":return is({},e,{isValidating:t.payload});case"SET_FIELD_VALUE":return is({},e,{values:Cm(e.values,t.payload.field,t.payload.value)});case"SET_FIELD_TOUCHED":return is({},e,{touched:Cm(e.touched,t.payload.field,t.payload.value)});case"SET_FIELD_ERROR":return is({},e,{errors:Cm(e.errors,t.payload.field,t.payload.value)});case"RESET_FORM":return is({},e,t.payload);case"SET_FORMIK_STATE":return t.payload(e);case"SUBMIT_ATTEMPT":return is({},e,{touched:Nq(e.values,!0),isSubmitting:!0,submitCount:e.submitCount+1});case"SUBMIT_FAILURE":return is({},e,{isSubmitting:!1});case"SUBMIT_SUCCESS":return is({},e,{isSubmitting:!1});default:return e}}var rm={},GT={};function bae(e){var t=e.validateOnChange,r=t===void 0?!0:t,s=e.validateOnBlur,c=s===void 0?!0:s,f=e.validateOnMount,_=f===void 0?!1:f,x=e.isInitialValid,a=e.enableReinitialize,I=a===void 0?!1:a,D=e.onSubmit,O=Y_(e,["validateOnChange","validateOnBlur","validateOnMount","isInitialValid","enableReinitialize","onSubmit"]),F=is({validateOnChange:r,validateOnBlur:c,validateOnMount:_,onSubmit:D},O),H=G.useRef(F.initialValues),Q=G.useRef(F.initialErrors||rm),ie=G.useRef(F.initialTouched||GT),te=G.useRef(F.initialStatus),W=G.useRef(!1),X=G.useRef({});G.useEffect(function(){return W.current=!0,function(){W.current=!1}},[]);var ee=G.useState(0),fe=ee[1],ye=G.useRef({values:qT(F.initialValues),errors:qT(F.initialErrors)||rm,touched:qT(F.initialTouched)||GT,status:qT(F.initialStatus),isSubmitting:!1,isValidating:!1,submitCount:0}),Ee=ye.current,re=G.useCallback(function(Qe){var pt=ye.current;ye.current=xae(pt,Qe),pt!==ye.current&&fe(function(dt){return dt+1})},[]),he=G.useCallback(function(Qe,pt){return new Promise(function(dt,sn){var Wt=F.validate(Qe,pt);Wt==null?dt(rm):pR(Wt)?Wt.then(function(pn){dt(pn||rm)},function(pn){sn(pn)}):dt(Wt)})},[F.validate]),_e=G.useCallback(function(Qe,pt){var dt=F.validationSchema,sn=ll(dt)?dt(pt):dt,Wt=pt&&sn.validateAt?sn.validateAt(pt,Qe):Tae(Qe,sn);return new Promise(function(pn,Sn){Wt.then(function(){pn(rm)},function(gr){gr.name==="ValidationError"?pn(wae(gr)):Sn(gr)})})},[F.validationSchema]),Se=G.useCallback(function(Qe,pt){return new Promise(function(dt){return dt(X.current[Qe].validate(pt))})},[]),J=G.useCallback(function(Qe){var pt=Object.keys(X.current).filter(function(sn){return ll(X.current[sn].validate)}),dt=pt.length>0?pt.map(function(sn){return Se(sn,al(Qe,sn))}):[Promise.resolve("DO_NOT_DELETE_YOU_WILL_BE_FIRED")];return Promise.all(dt).then(function(sn){return sn.reduce(function(Wt,pn,Sn){return pn==="DO_NOT_DELETE_YOU_WILL_BE_FIRED"||pn&&(Wt=Cm(Wt,pt[Sn],pn)),Wt},{})})},[Se]),Ie=G.useCallback(function(Qe){return Promise.all([J(Qe),F.validationSchema?_e(Qe):{},F.validate?he(Qe):{}]).then(function(pt){var dt=pt[0],sn=pt[1],Wt=pt[2],pn=rk.all([dt,sn,Wt],{arrayMerge:Eae});return pn})},[F.validate,F.validationSchema,J,he,_e]),we=jl(function(Qe){return Qe===void 0&&(Qe=Ee.values),re({type:"SET_ISVALIDATING",payload:!0}),Ie(Qe).then(function(pt){return W.current&&(re({type:"SET_ISVALIDATING",payload:!1}),re({type:"SET_ERRORS",payload:pt})),pt})});G.useEffect(function(){_&&W.current===!0&&am(H.current,F.initialValues)&&we(H.current)},[_,we]);var Lt=G.useCallback(function(Qe){var pt=Qe&&Qe.values?Qe.values:H.current,dt=Qe&&Qe.errors?Qe.errors:Q.current?Q.current:F.initialErrors||{},sn=Qe&&Qe.touched?Qe.touched:ie.current?ie.current:F.initialTouched||{},Wt=Qe&&Qe.status?Qe.status:te.current?te.current:F.initialStatus;H.current=pt,Q.current=dt,ie.current=sn,te.current=Wt;var pn=function(){re({type:"RESET_FORM",payload:{isSubmitting:!!Qe&&!!Qe.isSubmitting,errors:dt,touched:sn,status:Wt,values:pt,isValidating:!!Qe&&!!Qe.isValidating,submitCount:Qe&&Qe.submitCount&&typeof Qe.submitCount=="number"?Qe.submitCount:0}})};if(F.onReset){var Sn=F.onReset(Ee.values,zr);pR(Sn)?Sn.then(pn):pn()}else pn()},[F.initialErrors,F.initialStatus,F.initialTouched,F.onReset]);G.useEffect(function(){W.current===!0&&!am(H.current,F.initialValues)&&I&&(H.current=F.initialValues,Lt(),_&&we(H.current))},[I,F.initialValues,Lt,_,we]),G.useEffect(function(){I&&W.current===!0&&!am(Q.current,F.initialErrors)&&(Q.current=F.initialErrors||rm,re({type:"SET_ERRORS",payload:F.initialErrors||rm}))},[I,F.initialErrors]),G.useEffect(function(){I&&W.current===!0&&!am(ie.current,F.initialTouched)&&(ie.current=F.initialTouched||GT,re({type:"SET_TOUCHED",payload:F.initialTouched||GT}))},[I,F.initialTouched]),G.useEffect(function(){I&&W.current===!0&&!am(te.current,F.initialStatus)&&(te.current=F.initialStatus,re({type:"SET_STATUS",payload:F.initialStatus}))},[I,F.initialStatus,F.initialTouched]);var Gt=jl(function(Qe){if(X.current[Qe]&&ll(X.current[Qe].validate)){var pt=al(Ee.values,Qe),dt=X.current[Qe].validate(pt);return pR(dt)?(re({type:"SET_ISVALIDATING",payload:!0}),dt.then(function(sn){return sn}).then(function(sn){re({type:"SET_FIELD_ERROR",payload:{field:Qe,value:sn}}),re({type:"SET_ISVALIDATING",payload:!1})})):(re({type:"SET_FIELD_ERROR",payload:{field:Qe,value:dt}}),Promise.resolve(dt))}else if(F.validationSchema)return re({type:"SET_ISVALIDATING",payload:!0}),_e(Ee.values,Qe).then(function(sn){return sn}).then(function(sn){re({type:"SET_FIELD_ERROR",payload:{field:Qe,value:al(sn,Qe)}}),re({type:"SET_ISVALIDATING",payload:!1})});return Promise.resolve()}),qt=G.useCallback(function(Qe,pt){var dt=pt.validate;X.current[Qe]={validate:dt}},[]),It=G.useCallback(function(Qe){delete X.current[Qe]},[]),ct=jl(function(Qe,pt){re({type:"SET_TOUCHED",payload:Qe});var dt=pt===void 0?c:pt;return dt?we(Ee.values):Promise.resolve()}),Ut=G.useCallback(function(Qe){re({type:"SET_ERRORS",payload:Qe})},[]),Kt=jl(function(Qe,pt){var dt=ll(Qe)?Qe(Ee.values):Qe;re({type:"SET_VALUES",payload:dt});var sn=pt===void 0?r:pt;return sn?we(dt):Promise.resolve()}),at=G.useCallback(function(Qe,pt){re({type:"SET_FIELD_ERROR",payload:{field:Qe,value:pt}})},[]),At=jl(function(Qe,pt,dt){re({type:"SET_FIELD_VALUE",payload:{field:Qe,value:pt}});var sn=dt===void 0?r:dt;return sn?we(Cm(Ee.values,Qe,pt)):Promise.resolve()}),Et=G.useCallback(function(Qe,pt){var dt=pt,sn=Qe,Wt;if(!fR(Qe)){Qe.persist&&Qe.persist();var pn=Qe.target?Qe.target:Qe.currentTarget,Sn=pn.type,gr=pn.name,xi=pn.id,Yr=pn.value,Li=pn.checked,Nr=pn.outerHTML,di=pn.options,En=pn.multiple;dt=pt||gr||xi,sn=/number|range/.test(Sn)?(Wt=parseFloat(Yr),isNaN(Wt)?"":Wt):/checkbox/.test(Sn)?Iae(al(Ee.values,dt),Li,Yr):di&&En?Sae(di):Yr}dt&&At(dt,sn)},[At,Ee.values]),Jt=jl(function(Qe){if(fR(Qe))return function(pt){return Et(pt,Qe)};Et(Qe)}),Bt=jl(function(Qe,pt,dt){pt===void 0&&(pt=!0),re({type:"SET_FIELD_TOUCHED",payload:{field:Qe,value:pt}});var sn=dt===void 0?c:dt;return sn?we(Ee.values):Promise.resolve()}),Pn=G.useCallback(function(Qe,pt){Qe.persist&&Qe.persist();var dt=Qe.target,sn=dt.name,Wt=dt.id,pn=dt.outerHTML,Sn=pt||sn||Wt;Bt(Sn,!0)},[Bt]),$n=jl(function(Qe){if(fR(Qe))return function(pt){return Pn(pt,Qe)};Pn(Qe)}),Qn=G.useCallback(function(Qe){ll(Qe)?re({type:"SET_FORMIK_STATE",payload:Qe}):re({type:"SET_FORMIK_STATE",payload:function(){return Qe}})},[]),Xt=G.useCallback(function(Qe){re({type:"SET_STATUS",payload:Qe})},[]),mr=G.useCallback(function(Qe){re({type:"SET_ISSUBMITTING",payload:Qe})},[]),An=jl(function(){return re({type:"SUBMIT_ATTEMPT"}),we().then(function(Qe){var pt=Qe instanceof Error,dt=!pt&&Object.keys(Qe).length===0;if(dt){var sn;try{if(sn=qn(),sn===void 0)return}catch(Wt){throw Wt}return Promise.resolve(sn).then(function(Wt){return W.current&&re({type:"SUBMIT_SUCCESS"}),Wt}).catch(function(Wt){if(W.current)throw re({type:"SUBMIT_FAILURE"}),Wt})}else if(W.current&&(re({type:"SUBMIT_FAILURE"}),pt))throw Qe})}),cr=jl(function(Qe){Qe&&Qe.preventDefault&&ll(Qe.preventDefault)&&Qe.preventDefault(),Qe&&Qe.stopPropagation&&ll(Qe.stopPropagation)&&Qe.stopPropagation(),An().catch(function(pt){console.warn("Warning: An unhandled error was caught from submitForm()",pt)})}),zr={resetForm:Lt,validateForm:we,validateField:Gt,setErrors:Ut,setFieldError:at,setFieldTouched:Bt,setFieldValue:At,setStatus:Xt,setSubmitting:mr,setTouched:ct,setValues:Kt,setFormikState:Qn,submitForm:An},qn=jl(function(){return D(Ee.values,zr)}),Mr=jl(function(Qe){Qe&&Qe.preventDefault&&ll(Qe.preventDefault)&&Qe.preventDefault(),Qe&&Qe.stopPropagation&&ll(Qe.stopPropagation)&&Qe.stopPropagation(),Lt()}),Vr=G.useCallback(function(Qe){return{value:al(Ee.values,Qe),error:al(Ee.errors,Qe),touched:!!al(Ee.touched,Qe),initialValue:al(H.current,Qe),initialTouched:!!al(ie.current,Qe),initialError:al(Q.current,Qe)}},[Ee.errors,Ee.touched,Ee.values]),kn=G.useCallback(function(Qe){return{setValue:function(dt,sn){return At(Qe,dt,sn)},setTouched:function(dt,sn){return Bt(Qe,dt,sn)},setError:function(dt){return at(Qe,dt)}}},[At,Bt,at]),zn=G.useCallback(function(Qe){var pt=tC(Qe),dt=pt?Qe.name:Qe,sn=al(Ee.values,dt),Wt={name:dt,value:sn,onChange:Jt,onBlur:$n};if(pt){var pn=Qe.type,Sn=Qe.value,gr=Qe.as,xi=Qe.multiple;pn==="checkbox"?Sn===void 0?Wt.checked=!!sn:(Wt.checked=!!(Array.isArray(sn)&&~sn.indexOf(Sn)),Wt.value=Sn):pn==="radio"?(Wt.checked=sn===Sn,Wt.value=Sn):gr==="select"&&xi&&(Wt.value=Wt.value||[],Wt.multiple=!0)}return Wt},[$n,Jt,Ee.values]),Ue=G.useMemo(function(){return!am(H.current,Ee.values)},[H.current,Ee.values]),Ye=G.useMemo(function(){return typeof x!="undefined"?Ue?Ee.errors&&Object.keys(Ee.errors).length===0:x!==!1&&ll(x)?x(F):x:Ee.errors&&Object.keys(Ee.errors).length===0},[x,Ue,Ee.errors,F]),gt=is({},Ee,{initialValues:H.current,initialErrors:Q.current,initialTouched:ie.current,initialStatus:te.current,handleBlur:$n,handleChange:Jt,handleReset:Mr,handleSubmit:cr,resetForm:Lt,setErrors:Ut,setFormikState:Qn,setFieldTouched:Bt,setFieldValue:At,setFieldError:at,setStatus:Xt,setSubmitting:mr,setTouched:ct,setValues:Kt,submitForm:An,validateForm:we,validateField:Gt,isValid:Ye,dirty:Ue,unregisterField:It,registerField:qt,getFieldProps:zn,getFieldMeta:Vr,getFieldHelpers:kn,validateOnBlur:c,validateOnChange:r,validateOnMount:_});return gt}function Fq(e){var t=bae(e),r=e.component,s=e.children,c=e.render,f=e.innerRef;return G.useImperativeHandle(f,function(){return t}),G.createElement(_ae,{value:t},r?G.createElement(r,t):c?c(t):s?ll(s)?s(t):vae(s)?null:G.Children.only(s):null)}function wae(e){var t={};if(e.inner){if(e.inner.length===0)return Cm(t,e.path,e.message);for(var c=e.inner,r=Array.isArray(c),s=0,c=r?c:c[Symbol.iterator]();;){var f;if(r){if(s>=c.length)break;f=c[s++]}else{if(s=c.next(),s.done)break;f=s.value}var _=f;al(t,_.path)||(t=Cm(t,_.path,_.message))}}return t}function Tae(e,t,r,s){r===void 0&&(r=!1);var c=ck(e);return t[r?"validateSync":"validate"](c,{abortEarly:!1,context:c})}function ck(e){var t=Array.isArray(e)?[]:{};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var s=String(r);Array.isArray(e[s])===!0?t[s]=e[s].map(function(c){return Array.isArray(c)===!0||X6(c)?ck(c):c!==""?c:void 0}):X6(e[s])?t[s]=ck(e[s]):t[s]=e[s]!==""?e[s]:void 0}return t}function Eae(e,t,r){var s=e.slice();return t.forEach(function(f,_){if(typeof s[_]=="undefined"){var x=r.clone!==!1,a=x&&r.isMergeableObject(f);s[_]=a?rk(Array.isArray(f)?[]:{},f,r):f}else r.isMergeableObject(f)?s[_]=rk(e[_],f,r):e.indexOf(f)===-1&&s.push(f)}),s}function Sae(e){return Array.from(e).filter(function(t){return t.selected}).map(function(t){return t.value})}function Iae(e,t,r){if(typeof e=="boolean")return!!t;var s=[],c=!1,f=-1;if(Array.isArray(e))s=e,f=e.indexOf(r),c=f>=0;else if(!r||r=="true"||r=="false")return!!t;return t&&r&&!c?s.concat(r):c?s.slice(0,f).concat(s.slice(f+1)):s}var Cae=typeof window!="undefined"&&typeof window.document!="undefined"&&typeof window.document.createElement!="undefined"?G.useLayoutEffect:G.useEffect;function jl(e){var t=G.useRef(e);return Cae(function(){t.current=e}),G.useCallback(function(){for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return t.current.apply(void 0,s)},[])}function L1(e){var t=e.validate,r=e.name,s=e.render,c=e.children,f=e.as,_=e.component,x=e.className,a=Y_(e,["validate","name","render","children","as","component","className"]),I=zq(),D=Y_(I,["validate","validationSchema"]),O=D.registerField,F=D.unregisterField;G.useEffect(function(){return O(r,{validate:t}),function(){F(r)}},[O,F,r,t]);var H=D.getFieldProps(is({name:r},a)),Q=D.getFieldMeta(r),ie={field:H,form:D};if(s)return s(is({},ie,{meta:Q}));if(ll(c))return c(is({},ie,{meta:Q}));if(_){if(typeof _=="string"){var te=a.innerRef,W=Y_(a,["innerRef"]);return G.createElement(_,is({ref:te},H,W,{className:x}),c)}return G.createElement(_,is({field:H,form:D},a,{className:x}),c)}var X=f||"input";if(typeof X=="string"){var ee=a.innerRef,fe=Y_(a,["innerRef"]);return G.createElement(X,is({ref:ee},H,fe,{className:x}),c)}return G.createElement(X,is({},H,a,{className:x}),c)}var QD=G.forwardRef(function(e,t){var r=e.action,s=Y_(e,["action"]),c=r!=null?r:"#",f=zq(),_=f.handleReset,x=f.handleSubmit;return G.createElement("form",is({onSubmit:x,ref:t,onReset:_,action:c},s))});QD.displayName="Form";function lg(e){this._maxSize=e,this.clear()}lg.prototype.clear=function(){this._size=0,this._values=Object.create(null)};lg.prototype.get=function(e){return this._values[e]};lg.prototype.set=function(e,t){return this._size>=this._maxSize&&this.clear(),e in this._values||this._size++,this._values[e]=t};var Aae=/[^.^\]^[]+|(?=\[\]|\.\.)/g,Bq=/^\d+$/,Pae=/^\d/,Rae=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,Mae=/^\s*(['"]?)(.*?)(\1)\s*$/,YD=512,wj=new lg(YD),Tj=new lg(YD),Ej=new lg(YD),Am={Cache:lg,split:uk,normalizePath:mR,setter:function(e){var t=mR(e);return Tj.get(e)||Tj.set(e,function(s,c){for(var f=0,_=t.length,x=s;f<_-1;){var a=t[f];if(a==="__proto__"||a==="constructor"||a==="prototype")return s;x=x[t[f++]]}x[t[f]]=c})},getter:function(e,t){var r=mR(e);return Ej.get(e)||Ej.set(e,function(c){for(var f=0,_=r.length;f<_;)if(c!=null||!t)c=c[r[f++]];else return;return c})},join:function(e){return e.reduce(function(t,r){return t+(JD(r)||Bq.test(r)?"["+r+"]":(t?".":"")+r)},"")},forEach:function(e,t,r){kae(Array.isArray(e)?e:uk(e),t,r)}};function mR(e){return wj.get(e)||wj.set(e,uk(e).map(function(t){return t.replace(Mae,"$2")}))}function uk(e){return e.match(Aae)||[""]}function kae(e,t,r){var s=e.length,c,f,_,x;for(f=0;f<s;f++)c=e[f],c&&(Lae(c)&&(c='"'+c+'"'),x=JD(c),_=!x&&/^\d+$/.test(c),t.call(r,c,x,_,f,e))}function JD(e){return typeof e=="string"&&e&&["'",'"'].indexOf(e.charAt(0))!==-1}function Dae(e){return e.match(Pae)&&!e.match(Bq)}function Oae(e){return Rae.test(e)}function Lae(e){return!JD(e)&&(Dae(e)||Oae(e))}const zae=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,nC=e=>e.match(zae)||[],rC=e=>e[0].toUpperCase()+e.slice(1),eO=(e,t)=>nC(e).join(t).toLowerCase(),jq=e=>nC(e).reduce((t,r)=>`${t}${t?r[0].toUpperCase()+r.slice(1).toLowerCase():r.toLowerCase()}`,""),Nae=e=>rC(jq(e)),Fae=e=>eO(e,"_"),Bae=e=>eO(e,"-"),jae=e=>rC(eO(e," ")),Uae=e=>nC(e).map(rC).join(" ");var gR={words:nC,upperFirst:rC,camelCase:jq,pascalCase:Nae,snakeCase:Fae,kebabCase:Bae,sentenceCase:jae,titleCase:Uae},tO={exports:{}};tO.exports=function(e){return Uq(Vae(e),e)};tO.exports.array=Uq;function Uq(e,t){var r=e.length,s=new Array(r),c={},f=r,_=$ae(t),x=qae(e);for(t.forEach(function(I){if(!x.has(I[0])||!x.has(I[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});f--;)c[f]||a(e[f],f,new Set);return s;function a(I,D,O){if(O.has(I)){var F;try{F=", node was:"+JSON.stringify(I)}catch(ie){F=""}throw new Error("Cyclic dependency"+F)}if(!x.has(I))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(I));if(!c[D]){c[D]=!0;var H=_.get(I)||new Set;if(H=Array.from(H),D=H.length){O.add(I);do{var Q=H[--D];a(Q,x.get(Q),O)}while(D);O.delete(I)}s[--r]=I}}}function Vae(e){for(var t=new Set,r=0,s=e.length;r<s;r++){var c=e[r];t.add(c[0]),t.add(c[1])}return Array.from(t)}function $ae(e){for(var t=new Map,r=0,s=e.length;r<s;r++){var c=e[r];t.has(c[0])||t.set(c[0],new Set),t.has(c[1])||t.set(c[1],new Set),t.get(c[0]).add(c[1])}return t}function qae(e){for(var t=new Map,r=0,s=e.length;r<s;r++)t.set(e[r],r);return t}var Gae=tO.exports;const Wae=Yy(Gae),Hae=Object.prototype.toString,Zae=Error.prototype.toString,Xae=RegExp.prototype.toString,Kae=typeof Symbol!="undefined"?Symbol.prototype.toString:()=>"",Qae=/^Symbol\((.*)\)(.*)$/;function Yae(e){return e!=+e?"NaN":e===0&&1/e<0?"-0":""+e}function Sj(e,t=!1){if(e==null||e===!0||e===!1)return""+e;const r=typeof e;if(r==="number")return Yae(e);if(r==="string")return t?`"${e}"`:e;if(r==="function")return"[Function "+(e.name||"anonymous")+"]";if(r==="symbol")return Kae.call(e).replace(Qae,"Symbol($1)");const s=Hae.call(e).slice(8,-1);return s==="Date"?isNaN(e.getTime())?""+e:e.toISOString(e):s==="Error"||e instanceof Error?"["+Zae.call(e)+"]":s==="RegExp"?Xae.call(e):null}function kf(e,t){let r=Sj(e,t);return r!==null?r:JSON.stringify(e,function(s,c){let f=Sj(this[s],t);return f!==null?f:c},2)}function Vq(e){return e==null?[]:[].concat(e)}let $q,qq,Gq,Jae=/\$\{\s*(\w+)\s*\}/g;$q=Symbol.toStringTag;class Ij{constructor(t,r,s,c){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[$q]="Error",this.name="ValidationError",this.value=r,this.path=s,this.type=c,this.errors=[],this.inner=[],Vq(t).forEach(f=>{if(Ua.isError(f)){this.errors.push(...f.errors);const _=f.inner.length?f.inner:[f];this.inner.push(..._)}else this.errors.push(f)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}qq=Symbol.hasInstance;Gq=Symbol.toStringTag;class Ua extends Error{static formatError(t,r){const s=r.label||r.path||"this";return s!==r.path&&(r=Object.assign({},r,{path:s})),typeof t=="string"?t.replace(Jae,(c,f)=>kf(r[f])):typeof t=="function"?t(r):t}static isError(t){return t&&t.name==="ValidationError"}constructor(t,r,s,c,f){const _=new Ij(t,r,s,c);if(f)return _;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[Gq]="Error",this.name=_.name,this.message=_.message,this.type=_.type,this.value=_.value,this.path=_.path,this.errors=_.errors,this.inner=_.inner,Error.captureStackTrace&&Error.captureStackTrace(this,Ua)}static[qq](t){return Ij[Symbol.hasInstance](t)||super[Symbol.hasInstance](t)}}let Cu={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:e,type:t,value:r,originalValue:s})=>{const c=s!=null&&s!==r?` (cast from the value \`${kf(s,!0)}\`).`:".";return t!=="mixed"?`${e} must be a \`${t}\` type, but the final value was: \`${kf(r,!0)}\``+c:`${e} must match the configured type. The validated value was: \`${kf(r,!0)}\``+c}},Na={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},ele={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},hk={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},tle={isValue:"${path} field must be ${value}"},dk={noUnknown:"${path} field has unspecified keys: ${unknown}"},nle={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},rle={notType:e=>{const{path:t,value:r,spec:s}=e,c=s.types.length;if(Array.isArray(r)){if(r.length<c)return`${t} tuple value has too few items, expected a length of ${c} but got ${r.length} for value: \`${kf(r,!0)}\``;if(r.length>c)return`${t} tuple value has too many items, expected a length of ${c} but got ${r.length} for value: \`${kf(r,!0)}\``}return Ua.formatError(Cu.notType,e)}};Object.assign(Object.create(null),{mixed:Cu,string:Na,number:ele,date:hk,object:dk,array:nle,boolean:tle,tuple:rle});const nO=e=>e&&e.__isYupSchema__;class IS{static fromOptions(t,r){if(!r.then&&!r.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:s,then:c,otherwise:f}=r,_=typeof s=="function"?s:(...x)=>x.every(a=>a===s);return new IS(t,(x,a)=>{var I;let D=_(...x)?c:f;return(I=D==null?void 0:D(a))!=null?I:a})}constructor(t,r){this.fn=void 0,this.refs=t,this.refs=t,this.fn=r}resolve(t,r){let s=this.refs.map(f=>f.getValue(r==null?void 0:r.value,r==null?void 0:r.parent,r==null?void 0:r.context)),c=this.fn(s,t,r);if(c===void 0||c===t)return t;if(!nO(c))throw new TypeError("conditions must return a schema object");return c.resolve(r)}}const WT={context:"$",value:"."};let cg=class{constructor(t,r={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof t!="string")throw new TypeError("ref must be a string, got: "+t);if(this.key=t.trim(),t==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===WT.context,this.isValue=this.key[0]===WT.value,this.isSibling=!this.isContext&&!this.isValue;let s=this.isContext?WT.context:this.isValue?WT.value:"";this.path=this.key.slice(s.length),this.getter=this.path&&Am.getter(this.path,!0),this.map=r.map}getValue(t,r,s){let c=this.isContext?s:this.isValue?t:r;return this.getter&&(c=this.getter(c||{})),this.map&&(c=this.map(c)),c}cast(t,r){return this.getValue(t,r==null?void 0:r.parent,r==null?void 0:r.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(t){return t&&t.__isYupRef}};cg.prototype.__isYupRef=!0;const vm=e=>e==null;function E_(e){function t({value:r,path:s="",options:c,originalValue:f,schema:_},x,a){const{name:I,test:D,params:O,message:F,skipAbsent:H}=e;let{parent:Q,context:ie,abortEarly:te=_.spec.abortEarly,disableStackTrace:W=_.spec.disableStackTrace}=c;function X(J){return cg.isRef(J)?J.getValue(r,Q,ie):J}function ee(J={}){const Ie=Object.assign({value:r,originalValue:f,label:_.spec.label,path:J.path||s,spec:_.spec,disableStackTrace:J.disableStackTrace||W},O,J.params);for(const Lt of Object.keys(Ie))Ie[Lt]=X(Ie[Lt]);const we=new Ua(Ua.formatError(J.message||F,Ie),r,Ie.path,J.type||I,Ie.disableStackTrace);return we.params=Ie,we}const fe=te?x:a;let ye={path:s,parent:Q,type:I,from:c.from,createError:ee,resolve:X,options:c,originalValue:f,schema:_};const Ee=J=>{Ua.isError(J)?fe(J):J?a(null):fe(ee())},re=J=>{Ua.isError(J)?fe(J):x(J)};if(H&&vm(r))return Ee(!0);let _e;try{var Se;if(_e=D.call(ye,r,ye),typeof((Se=_e)==null?void 0:Se.then)=="function"){if(c.sync)throw new Error(`Validation test of type: "${ye.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(_e).then(Ee,re)}}catch(J){re(J);return}Ee(_e)}return t.OPTIONS=e,t}function ile(e,t,r,s=r){let c,f,_;return t?(Am.forEach(t,(x,a,I)=>{let D=a?x.slice(1,x.length-1):x;e=e.resolve({context:s,parent:c,value:r});let O=e.type==="tuple",F=I?parseInt(D,10):0;if(e.innerType||O){if(O&&!I)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${_}" must contain an index to the tuple element, e.g. "${_}[0]"`);if(r&&F>=r.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${x}, in the path: ${t}. because there is no value at that index. `);c=r,r=r&&r[F],e=O?e.spec.types[F]:e.innerType}if(!I){if(!e.fields||!e.fields[D])throw new Error(`The schema does not contain the path: ${t}. (failed at: ${_} which is a type: "${e.type}")`);c=r,r=r&&r[D],e=e.fields[D]}f=D,_=a?"["+x+"]":"."+x}),{schema:e,parent:c,parentPath:f}):{parent:c,parentPath:t,schema:e}}class CS extends Set{describe(){const t=[];for(const r of this.values())t.push(cg.isRef(r)?r.describe():r);return t}resolveAll(t){let r=[];for(const s of this.values())r.push(t(s));return r}clone(){return new CS(this.values())}merge(t,r){const s=this.clone();return t.forEach(c=>s.add(c)),r.forEach(c=>s.delete(c)),s}}function J_(e,t=new Map){if(nO(e)||!e||typeof e!="object")return e;if(t.has(e))return t.get(e);let r;if(e instanceof Date)r=new Date(e.getTime()),t.set(e,r);else if(e instanceof RegExp)r=new RegExp(e),t.set(e,r);else if(Array.isArray(e)){r=new Array(e.length),t.set(e,r);for(let s=0;s<e.length;s++)r[s]=J_(e[s],t)}else if(e instanceof Map){r=new Map,t.set(e,r);for(const[s,c]of e.entries())r.set(s,J_(c,t))}else if(e instanceof Set){r=new Set,t.set(e,r);for(const s of e)r.add(J_(s,t))}else if(e instanceof Object){r={},t.set(e,r);for(const[s,c]of Object.entries(e))r[s]=J_(c,t)}else throw Error(`Unable to clone ${e}`);return r}class Gu{constructor(t){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new CS,this._blacklist=new CS,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(Cu.notType)}),this.type=t.type,this._typeCheck=t.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},t==null?void 0:t.spec),this.withMutation(r=>{r.nonNullable()})}get _type(){return this.type}clone(t){if(this._mutate)return t&&Object.assign(this.spec,t),this;const r=Object.create(Object.getPrototypeOf(this));return r.type=this.type,r._typeCheck=this._typeCheck,r._whitelist=this._whitelist.clone(),r._blacklist=this._blacklist.clone(),r.internalTests=Object.assign({},this.internalTests),r.exclusiveTests=Object.assign({},this.exclusiveTests),r.deps=[...this.deps],r.conditions=[...this.conditions],r.tests=[...this.tests],r.transforms=[...this.transforms],r.spec=J_(Object.assign({},this.spec,t)),r}label(t){let r=this.clone();return r.spec.label=t,r}meta(...t){if(t.length===0)return this.spec.meta;let r=this.clone();return r.spec.meta=Object.assign(r.spec.meta||{},t[0]),r}withMutation(t){let r=this._mutate;this._mutate=!0;let s=t(this);return this._mutate=r,s}concat(t){if(!t||t===this)return this;if(t.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${t.type}`);let r=this,s=t.clone();const c=Object.assign({},r.spec,s.spec);return s.spec=c,s.internalTests=Object.assign({},r.internalTests,s.internalTests),s._whitelist=r._whitelist.merge(t._whitelist,t._blacklist),s._blacklist=r._blacklist.merge(t._blacklist,t._whitelist),s.tests=r.tests,s.exclusiveTests=r.exclusiveTests,s.withMutation(f=>{t.tests.forEach(_=>{f.test(_.OPTIONS)})}),s.transforms=[...r.transforms,...s.transforms],s}isType(t){return t==null?!!(this.spec.nullable&&t===null||this.spec.optional&&t===void 0):this._typeCheck(t)}resolve(t){let r=this;if(r.conditions.length){let s=r.conditions;r=r.clone(),r.conditions=[],r=s.reduce((c,f)=>f.resolve(c,t),r),r=r.resolve(t)}return r}resolveOptions(t){var r,s,c,f;return Object.assign({},t,{from:t.from||[],strict:(r=t.strict)!=null?r:this.spec.strict,abortEarly:(s=t.abortEarly)!=null?s:this.spec.abortEarly,recursive:(c=t.recursive)!=null?c:this.spec.recursive,disableStackTrace:(f=t.disableStackTrace)!=null?f:this.spec.disableStackTrace})}cast(t,r={}){let s=this.resolve(Object.assign({value:t},r)),c=r.assert==="ignore-optionality",f=s._cast(t,r);if(r.assert!==!1&&!s.isType(f)){if(c&&vm(f))return f;let _=kf(t),x=kf(f);throw new TypeError(`The value of ${r.path||"field"} could not be cast to a value that satisfies the schema type: "${s.type}". 

attempted value: ${_} 
`+(x!==_?`result of cast: ${x}`:""))}return f}_cast(t,r){let s=t===void 0?t:this.transforms.reduce((c,f)=>f.call(this,c,t,this),t);return s===void 0&&(s=this.getDefault(r)),s}_validate(t,r={},s,c){let{path:f,originalValue:_=t,strict:x=this.spec.strict}=r,a=t;x||(a=this._cast(a,Object.assign({assert:!1},r)));let I=[];for(let D of Object.values(this.internalTests))D&&I.push(D);this.runTests({path:f,value:a,originalValue:_,options:r,tests:I},s,D=>{if(D.length)return c(D,a);this.runTests({path:f,value:a,originalValue:_,options:r,tests:this.tests},s,c)})}runTests(t,r,s){let c=!1,{tests:f,value:_,originalValue:x,path:a,options:I}=t,D=ie=>{c||(c=!0,r(ie,_))},O=ie=>{c||(c=!0,s(ie,_))},F=f.length,H=[];if(!F)return O([]);let Q={value:_,originalValue:x,path:a,options:I,schema:this};for(let ie=0;ie<f.length;ie++){const te=f[ie];te(Q,D,function(X){X&&(Array.isArray(X)?H.push(...X):H.push(X)),--F<=0&&O(H)})}}asNestedTest({key:t,index:r,parent:s,parentPath:c,originalParent:f,options:_}){const x=t!=null?t:r;if(x==null)throw TypeError("Must include `key` or `index` for nested validations");const a=typeof x=="number";let I=s[x];const D=Object.assign({},_,{strict:!0,parent:s,value:I,originalValue:f[x],key:void 0,[a?"index":"key"]:x,path:a||x.includes(".")?`${c||""}[${a?x:`"${x}"`}]`:(c?`${c}.`:"")+t});return(O,F,H)=>this.resolve(D)._validate(I,D,F,H)}validate(t,r){var s;let c=this.resolve(Object.assign({},r,{value:t})),f=(s=r==null?void 0:r.disableStackTrace)!=null?s:c.spec.disableStackTrace;return new Promise((_,x)=>c._validate(t,r,(a,I)=>{Ua.isError(a)&&(a.value=I),x(a)},(a,I)=>{a.length?x(new Ua(a,I,void 0,void 0,f)):_(I)}))}validateSync(t,r){var s;let c=this.resolve(Object.assign({},r,{value:t})),f,_=(s=r==null?void 0:r.disableStackTrace)!=null?s:c.spec.disableStackTrace;return c._validate(t,Object.assign({},r,{sync:!0}),(x,a)=>{throw Ua.isError(x)&&(x.value=a),x},(x,a)=>{if(x.length)throw new Ua(x,t,void 0,void 0,_);f=a}),f}isValid(t,r){return this.validate(t,r).then(()=>!0,s=>{if(Ua.isError(s))return!1;throw s})}isValidSync(t,r){try{return this.validateSync(t,r),!0}catch(s){if(Ua.isError(s))return!1;throw s}}_getDefault(t){let r=this.spec.default;return r==null?r:typeof r=="function"?r.call(this,t):J_(r)}getDefault(t){return this.resolve(t||{})._getDefault(t)}default(t){return arguments.length===0?this._getDefault():this.clone({default:t})}strict(t=!0){return this.clone({strict:t})}nullability(t,r){const s=this.clone({nullable:t});return s.internalTests.nullable=E_({message:r,name:"nullable",test(c){return c===null?this.schema.spec.nullable:!0}}),s}optionality(t,r){const s=this.clone({optional:t});return s.internalTests.optionality=E_({message:r,name:"optionality",test(c){return c===void 0?this.schema.spec.optional:!0}}),s}optional(){return this.optionality(!0)}defined(t=Cu.defined){return this.optionality(!1,t)}nullable(){return this.nullability(!0)}nonNullable(t=Cu.notNull){return this.nullability(!1,t)}required(t=Cu.required){return this.clone().withMutation(r=>r.nonNullable(t).defined(t))}notRequired(){return this.clone().withMutation(t=>t.nullable().optional())}transform(t){let r=this.clone();return r.transforms.push(t),r}test(...t){let r;if(t.length===1?typeof t[0]=="function"?r={test:t[0]}:r=t[0]:t.length===2?r={name:t[0],test:t[1]}:r={name:t[0],message:t[1],test:t[2]},r.message===void 0&&(r.message=Cu.default),typeof r.test!="function")throw new TypeError("`test` is a required parameters");let s=this.clone(),c=E_(r),f=r.exclusive||r.name&&s.exclusiveTests[r.name]===!0;if(r.exclusive&&!r.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return r.name&&(s.exclusiveTests[r.name]=!!r.exclusive),s.tests=s.tests.filter(_=>!(_.OPTIONS.name===r.name&&(f||_.OPTIONS.test===c.OPTIONS.test))),s.tests.push(c),s}when(t,r){!Array.isArray(t)&&typeof t!="string"&&(r=t,t=".");let s=this.clone(),c=Vq(t).map(f=>new cg(f));return c.forEach(f=>{f.isSibling&&s.deps.push(f.key)}),s.conditions.push(typeof r=="function"?new IS(c,r):IS.fromOptions(c,r)),s}typeError(t){let r=this.clone();return r.internalTests.typeError=E_({message:t,name:"typeError",skipAbsent:!0,test(s){return this.schema._typeCheck(s)?!0:this.createError({params:{type:this.schema.type}})}}),r}oneOf(t,r=Cu.oneOf){let s=this.clone();return t.forEach(c=>{s._whitelist.add(c),s._blacklist.delete(c)}),s.internalTests.whiteList=E_({message:r,name:"oneOf",skipAbsent:!0,test(c){let f=this.schema._whitelist,_=f.resolveAll(this.resolve);return _.includes(c)?!0:this.createError({params:{values:Array.from(f).join(", "),resolved:_}})}}),s}notOneOf(t,r=Cu.notOneOf){let s=this.clone();return t.forEach(c=>{s._blacklist.add(c),s._whitelist.delete(c)}),s.internalTests.blacklist=E_({message:r,name:"notOneOf",test(c){let f=this.schema._blacklist,_=f.resolveAll(this.resolve);return _.includes(c)?this.createError({params:{values:Array.from(f).join(", "),resolved:_}}):!0}}),s}strip(t=!0){let r=this.clone();return r.spec.strip=t,r}describe(t){const r=(t?this.resolve(t):this).clone(),{label:s,meta:c,optional:f,nullable:_}=r.spec;return{meta:c,label:s,optional:f,nullable:_,default:r.getDefault(t),type:r.type,oneOf:r._whitelist.describe(),notOneOf:r._blacklist.describe(),tests:r.tests.map(a=>({name:a.OPTIONS.name,params:a.OPTIONS.params})).filter((a,I,D)=>D.findIndex(O=>O.name===a.name)===I)}}}Gu.prototype.__isYupSchema__=!0;for(const e of["validate","validateSync"])Gu.prototype[`${e}At`]=function(t,r,s={}){const{parent:c,parentPath:f,schema:_}=ile(this,t,r,s.context);return _[e](c&&c[f],Object.assign({},s,{parent:c,path:t}))};for(const e of["equals","is"])Gu.prototype[e]=Gu.prototype.oneOf;for(const e of["not","nope"])Gu.prototype[e]=Gu.prototype.notOneOf;const sle=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function ole(e){const t=fk(e);if(!t)return Date.parse?Date.parse(e):Number.NaN;if(t.z===void 0&&t.plusMinus===void 0)return new Date(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond).valueOf();let r=0;return t.z!=="Z"&&t.plusMinus!==void 0&&(r=t.hourOffset*60+t.minuteOffset,t.plusMinus==="+"&&(r=0-r)),Date.UTC(t.year,t.month,t.day,t.hour,t.minute+r,t.second,t.millisecond)}function fk(e){var t,r;const s=sle.exec(e);return s?{year:Ah(s[1]),month:Ah(s[2],1)-1,day:Ah(s[3],1),hour:Ah(s[4]),minute:Ah(s[5]),second:Ah(s[6]),millisecond:s[7]?Ah(s[7].substring(0,3)):0,precision:(t=(r=s[7])==null?void 0:r.length)!=null?t:void 0,z:s[8]||void 0,plusMinus:s[9]||void 0,hourOffset:Ah(s[10]),minuteOffset:Ah(s[11])}:null}function Ah(e,t=0){return Number(e)||t}let ale=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,lle=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,cle=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,ule="^\\d{4}-\\d{2}-\\d{2}",hle="\\d{2}:\\d{2}:\\d{2}",dle="(([+-]\\d{2}(:?\\d{2})?)|Z)",fle=new RegExp(`${ule}T${hle}(\\.\\d+)?${dle}$`),ple=e=>vm(e)||e===e.trim(),mle={}.toString();function uy(){return new Wq}class Wq extends Gu{constructor(){super({type:"string",check(t){return t instanceof String&&(t=t.valueOf()),typeof t=="string"}}),this.withMutation(()=>{this.transform((t,r,s)=>{if(!s.spec.coerce||s.isType(t)||Array.isArray(t))return t;const c=t!=null&&t.toString?t.toString():t;return c===mle?t:c})})}required(t){return super.required(t).withMutation(r=>r.test({message:t||Cu.required,name:"required",skipAbsent:!0,test:s=>!!s.length}))}notRequired(){return super.notRequired().withMutation(t=>(t.tests=t.tests.filter(r=>r.OPTIONS.name!=="required"),t))}length(t,r=Na.length){return this.test({message:r,name:"length",exclusive:!0,params:{length:t},skipAbsent:!0,test(s){return s.length===this.resolve(t)}})}min(t,r=Na.min){return this.test({message:r,name:"min",exclusive:!0,params:{min:t},skipAbsent:!0,test(s){return s.length>=this.resolve(t)}})}max(t,r=Na.max){return this.test({name:"max",exclusive:!0,message:r,params:{max:t},skipAbsent:!0,test(s){return s.length<=this.resolve(t)}})}matches(t,r){let s=!1,c,f;return r&&(typeof r=="object"?{excludeEmptyString:s=!1,message:c,name:f}=r:c=r),this.test({name:f||"matches",message:c||Na.matches,params:{regex:t},skipAbsent:!0,test:_=>_===""&&s||_.search(t)!==-1})}email(t=Na.email){return this.matches(ale,{name:"email",message:t,excludeEmptyString:!0})}url(t=Na.url){return this.matches(lle,{name:"url",message:t,excludeEmptyString:!0})}uuid(t=Na.uuid){return this.matches(cle,{name:"uuid",message:t,excludeEmptyString:!1})}datetime(t){let r="",s,c;return t&&(typeof t=="object"?{message:r="",allowOffset:s=!1,precision:c=void 0}=t:r=t),this.matches(fle,{name:"datetime",message:r||Na.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:r||Na.datetime_offset,params:{allowOffset:s},skipAbsent:!0,test:f=>{if(!f||s)return!0;const _=fk(f);return _?!!_.z:!1}}).test({name:"datetime_precision",message:r||Na.datetime_precision,params:{precision:c},skipAbsent:!0,test:f=>{if(!f||c==null)return!0;const _=fk(f);return _?_.precision===c:!1}})}ensure(){return this.default("").transform(t=>t===null?"":t)}trim(t=Na.trim){return this.transform(r=>r!=null?r.trim():r).test({message:t,name:"trim",test:ple})}lowercase(t=Na.lowercase){return this.transform(r=>vm(r)?r:r.toLowerCase()).test({message:t,name:"string_case",exclusive:!0,skipAbsent:!0,test:r=>vm(r)||r===r.toLowerCase()})}uppercase(t=Na.uppercase){return this.transform(r=>vm(r)?r:r.toUpperCase()).test({message:t,name:"string_case",exclusive:!0,skipAbsent:!0,test:r=>vm(r)||r===r.toUpperCase()})}}uy.prototype=Wq.prototype;let gle=new Date(""),_le=e=>Object.prototype.toString.call(e)==="[object Date]";class iC extends Gu{constructor(){super({type:"date",check(t){return _le(t)&&!isNaN(t.getTime())}}),this.withMutation(()=>{this.transform((t,r,s)=>!s.spec.coerce||s.isType(t)||t===null?t:(t=ole(t),isNaN(t)?iC.INVALID_DATE:new Date(t)))})}prepareParam(t,r){let s;if(cg.isRef(t))s=t;else{let c=this.cast(t);if(!this._typeCheck(c))throw new TypeError(`\`${r}\` must be a Date or a value that can be \`cast()\` to a Date`);s=c}return s}min(t,r=hk.min){let s=this.prepareParam(t,"min");return this.test({message:r,name:"min",exclusive:!0,params:{min:t},skipAbsent:!0,test(c){return c>=this.resolve(s)}})}max(t,r=hk.max){let s=this.prepareParam(t,"max");return this.test({message:r,name:"max",exclusive:!0,params:{max:t},skipAbsent:!0,test(c){return c<=this.resolve(s)}})}}iC.INVALID_DATE=gle;iC.prototype;function yle(e,t=[]){let r=[],s=new Set,c=new Set(t.map(([_,x])=>`${_}-${x}`));function f(_,x){let a=Am.split(_)[0];s.add(a),c.has(`${x}-${a}`)||r.push([x,a])}for(const _ of Object.keys(e)){let x=e[_];s.add(_),cg.isRef(x)&&x.isSibling?f(x.path,_):nO(x)&&"deps"in x&&x.deps.forEach(a=>f(a,_))}return Wae.array(Array.from(s),r).reverse()}function Cj(e,t){let r=1/0;return e.some((s,c)=>{var f;if((f=t.path)!=null&&f.includes(s))return r=c,!0}),r}function Hq(e){return(t,r)=>Cj(e,t)-Cj(e,r)}const vle=(e,t,r)=>{if(typeof e!="string")return e;let s=e;try{s=JSON.parse(e)}catch(c){}return r.isType(s)?s:e};function IE(e){if("fields"in e){const t={};for(const[r,s]of Object.entries(e.fields))t[r]=IE(s);return e.setFields(t)}if(e.type==="array"){const t=e.optional();return t.innerType&&(t.innerType=IE(t.innerType)),t}return e.type==="tuple"?e.optional().clone({types:e.spec.types.map(IE)}):"optional"in e?e.optional():e}const xle=(e,t)=>{const r=[...Am.normalizePath(t)];if(r.length===1)return r[0]in e;let s=r.pop(),c=Am.getter(Am.join(r),!0)(e);return!!(c&&s in c)};let Aj=e=>Object.prototype.toString.call(e)==="[object Object]";function ble(e,t){let r=Object.keys(e.fields);return Object.keys(t).filter(s=>r.indexOf(s)===-1)}const wle=Hq([]);function rO(e){return new Zq(e)}class Zq extends Gu{constructor(t){super({type:"object",check(r){return Aj(r)||typeof r=="function"}}),this.fields=Object.create(null),this._sortErrors=wle,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{t&&this.shape(t)})}_cast(t,r={}){var s;let c=super._cast(t,r);if(c===void 0)return this.getDefault(r);if(!this._typeCheck(c))return c;let f=this.fields,_=(s=r.stripUnknown)!=null?s:this.spec.noUnknown,x=[].concat(this._nodes,Object.keys(c).filter(O=>!this._nodes.includes(O))),a={},I=Object.assign({},r,{parent:a,__validating:r.__validating||!1}),D=!1;for(const O of x){let F=f[O],H=O in c;if(F){let Q,ie=c[O];I.path=(r.path?`${r.path}.`:"")+O,F=F.resolve({value:ie,context:r.context,parent:a});let te=F instanceof Gu?F.spec:void 0,W=te==null?void 0:te.strict;if(te!=null&&te.strip){D=D||O in c;continue}Q=!r.__validating||!W?F.cast(c[O],I):c[O],Q!==void 0&&(a[O]=Q)}else H&&!_&&(a[O]=c[O]);(H!==O in a||a[O]!==c[O])&&(D=!0)}return D?a:c}_validate(t,r={},s,c){let{from:f=[],originalValue:_=t,recursive:x=this.spec.recursive}=r;r.from=[{schema:this,value:_},...f],r.__validating=!0,r.originalValue=_,super._validate(t,r,s,(a,I)=>{if(!x||!Aj(I)){c(a,I);return}_=_||I;let D=[];for(let O of this._nodes){let F=this.fields[O];!F||cg.isRef(F)||D.push(F.asNestedTest({options:r,key:O,parent:I,parentPath:r.path,originalParent:_}))}this.runTests({tests:D,value:I,originalValue:_,options:r},s,O=>{c(O.sort(this._sortErrors).concat(a),I)})})}clone(t){const r=super.clone(t);return r.fields=Object.assign({},this.fields),r._nodes=this._nodes,r._excludedEdges=this._excludedEdges,r._sortErrors=this._sortErrors,r}concat(t){let r=super.concat(t),s=r.fields;for(let[c,f]of Object.entries(this.fields)){const _=s[c];s[c]=_===void 0?f:_}return r.withMutation(c=>c.setFields(s,[...this._excludedEdges,...t._excludedEdges]))}_getDefault(t){if("default"in this.spec)return super._getDefault(t);if(!this._nodes.length)return;let r={};return this._nodes.forEach(s=>{var c;const f=this.fields[s];let _=t;(c=_)!=null&&c.value&&(_=Object.assign({},_,{parent:_.value,value:_.value[s]})),r[s]=f&&"getDefault"in f?f.getDefault(_):void 0}),r}setFields(t,r){let s=this.clone();return s.fields=t,s._nodes=yle(t,r),s._sortErrors=Hq(Object.keys(t)),r&&(s._excludedEdges=r),s}shape(t,r=[]){return this.clone().withMutation(s=>{let c=s._excludedEdges;return r.length&&(Array.isArray(r[0])||(r=[r]),c=[...s._excludedEdges,...r]),s.setFields(Object.assign(s.fields,t),c)})}partial(){const t={};for(const[r,s]of Object.entries(this.fields))t[r]="optional"in s&&s.optional instanceof Function?s.optional():s;return this.setFields(t)}deepPartial(){return IE(this)}pick(t){const r={};for(const s of t)this.fields[s]&&(r[s]=this.fields[s]);return this.setFields(r,this._excludedEdges.filter(([s,c])=>t.includes(s)&&t.includes(c)))}omit(t){const r=[];for(const s of Object.keys(this.fields))t.includes(s)||r.push(s);return this.pick(r)}from(t,r,s){let c=Am.getter(t,!0);return this.transform(f=>{if(!f)return f;let _=f;return xle(f,t)&&(_=Object.assign({},f),s||delete _[t],_[r]=c(f)),_})}json(){return this.transform(vle)}noUnknown(t=!0,r=dk.noUnknown){typeof t!="boolean"&&(r=t,t=!0);let s=this.test({name:"noUnknown",exclusive:!0,message:r,test(c){if(c==null)return!0;const f=ble(this.schema,c);return!t||f.length===0||this.createError({params:{unknown:f.join(", ")}})}});return s.spec.noUnknown=t,s}unknown(t=!0,r=dk.noUnknown){return this.noUnknown(!t,r)}transformKeys(t){return this.transform(r=>{if(!r)return r;const s={};for(const c of Object.keys(r))s[t(c)]=r[c];return s})}camelCase(){return this.transformKeys(gR.camelCase)}snakeCase(){return this.transformKeys(gR.snakeCase)}constantCase(){return this.transformKeys(t=>gR.snakeCase(t).toUpperCase())}describe(t){const r=(t?this.resolve(t):this).clone(),s=super.describe(t);s.fields={};for(const[f,_]of Object.entries(r.fields)){var c;let x=t;(c=x)!=null&&c.value&&(x=Object.assign({},x,{parent:x.value,value:x.value[f]})),s.fields[f]=_.describe(x)}return s}}rO.prototype=Zq.prototype;var Pj={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xq=function(e){const t=[];let r=0;for(let s=0;s<e.length;s++){let c=e.charCodeAt(s);c<128?t[r++]=c:c<2048?(t[r++]=c>>6|192,t[r++]=c&63|128):(c&64512)===55296&&s+1<e.length&&(e.charCodeAt(s+1)&64512)===56320?(c=65536+((c&1023)<<10)+(e.charCodeAt(++s)&1023),t[r++]=c>>18|240,t[r++]=c>>12&63|128,t[r++]=c>>6&63|128,t[r++]=c&63|128):(t[r++]=c>>12|224,t[r++]=c>>6&63|128,t[r++]=c&63|128)}return t},Tle=function(e){const t=[];let r=0,s=0;for(;r<e.length;){const c=e[r++];if(c<128)t[s++]=String.fromCharCode(c);else if(c>191&&c<224){const f=e[r++];t[s++]=String.fromCharCode((c&31)<<6|f&63)}else if(c>239&&c<365){const f=e[r++],_=e[r++],x=e[r++],a=((c&7)<<18|(f&63)<<12|(_&63)<<6|x&63)-65536;t[s++]=String.fromCharCode(55296+(a>>10)),t[s++]=String.fromCharCode(56320+(a&1023))}else{const f=e[r++],_=e[r++];t[s++]=String.fromCharCode((c&15)<<12|(f&63)<<6|_&63)}}return t.join("")},Kq={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let c=0;c<e.length;c+=3){const f=e[c],_=c+1<e.length,x=_?e[c+1]:0,a=c+2<e.length,I=a?e[c+2]:0,D=f>>2,O=(f&3)<<4|x>>4;let F=(x&15)<<2|I>>6,H=I&63;a||(H=64,_||(F=64)),s.push(r[D],r[O],r[F],r[H])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Xq(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Tle(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let c=0;c<e.length;){const f=r[e.charAt(c++)],x=c<e.length?r[e.charAt(c)]:0;++c;const I=c<e.length?r[e.charAt(c)]:64;++c;const O=c<e.length?r[e.charAt(c)]:64;if(++c,f==null||x==null||I==null||O==null)throw new Ele;const F=f<<2|x>>4;if(s.push(F),I!==64){const H=x<<4&240|I>>2;if(s.push(H),O!==64){const Q=I<<6&192|O;s.push(Q)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Ele extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Sle=function(e){const t=Xq(e);return Kq.encodeByteArray(t,!0)},AS=function(e){return Sle(e).replace(/\./g,"")},Qq=function(e){try{return Kq.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ile(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cle=()=>Ile().__FIREBASE_DEFAULTS__,Ale=()=>{if(typeof process=="undefined"||typeof Pj=="undefined")return;const e=Pj.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Ple=()=>{if(typeof document=="undefined")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(r){return}const t=e&&Qq(e[1]);return t&&JSON.parse(t)},sC=()=>{try{return Cle()||Ale()||Ple()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Yq=e=>{var t,r;return(r=(t=sC())===null||t===void 0?void 0:t.emulatorHosts)===null||r===void 0?void 0:r[e]},Jq=e=>{const t=Yq(e);if(!t)return;const r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const s=parseInt(t.substring(r+1),10);return t[0]==="["?[t.substring(1,r-1),s]:[t.substring(0,r),s]},eG=()=>{var e;return(e=sC())===null||e===void 0?void 0:e.config},tG=e=>{var t;return(t=sC())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rle{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,r)=>{this.resolve=t,this.reject=r})}wrapCallback(t){return(r,s)=>{r?this.reject(r):this.resolve(s),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(r):t(r,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nG(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},s=t||"demo-project",c=e.iat||0,f=e.sub||e.user_id;if(!f)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:c,exp:c+3600,auth_time:c,sub:f,user_id:f,firebase:{sign_in_provider:"custom",identities:{}}},e);return[AS(JSON.stringify(r)),AS(JSON.stringify(_)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ia(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Mle(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ia())}function kle(){var e;const t=(e=sC())===null||e===void 0?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(r){return!1}}function Dle(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Ole(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Lle(){const e=ia();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function zle(){return!kle()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Nle(){try{return typeof indexedDB=="object"}catch(e){return!1}}function Fle(){return new Promise((e,t)=>{try{let r=!0;const s="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(s);c.onsuccess=()=>{c.result.close(),r||self.indexedDB.deleteDatabase(s),e(!0)},c.onupgradeneeded=()=>{r=!1},c.onerror=()=>{var f;t(((f=c.error)===null||f===void 0?void 0:f.message)||"")}}catch(r){t(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ble="FirebaseError";class Ku extends Error{constructor(t,r,s){super(r),this.code=t,this.customData=s,this.name=Ble,Object.setPrototypeOf(this,Ku.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,sb.prototype.create)}}class sb{constructor(t,r,s){this.service=t,this.serviceName=r,this.errors=s}create(t,...r){const s=r[0]||{},c=`${this.service}/${t}`,f=this.errors[t],_=f?jle(f,s):"Error",x=`${this.serviceName}: ${_} (${c}).`;return new Ku(c,x,s)}}function jle(e,t){return e.replace(Ule,(r,s)=>{const c=t[s];return c!=null?String(c):`<${s}?>`})}const Ule=/\{\$([^}]+)}/g;function Vle(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ky(e,t){if(e===t)return!0;const r=Object.keys(e),s=Object.keys(t);for(const c of r){if(!s.includes(c))return!1;const f=e[c],_=t[c];if(Rj(f)&&Rj(_)){if(!ky(f,_))return!1}else if(f!==_)return!1}for(const c of s)if(!r.includes(c))return!1;return!0}function Rj(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ob(e){const t=[];for(const[r,s]of Object.entries(e))Array.isArray(s)?s.forEach(c=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(c))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(s));return t.length?"&"+t.join("&"):""}function u1(e){const t={};return e.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[c,f]=s.split("=");t[decodeURIComponent(c)]=decodeURIComponent(f)}}),t}function h1(e){const t=e.indexOf("?");if(!t)return"";const r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function $le(e,t){const r=new qle(e,t);return r.subscribe.bind(r)}class qle{constructor(t,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{t(this)}).catch(s=>{this.error(s)})}next(t){this.forEachObserver(r=>{r.next(t)})}error(t){this.forEachObserver(r=>{r.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,r,s){let c;if(t===void 0&&r===void 0&&s===void 0)throw new Error("Missing Observer.");Gle(t,["next","error","complete"])?c=t:c={next:t,error:r,complete:s},c.next===void 0&&(c.next=_R),c.error===void 0&&(c.error=_R),c.complete===void 0&&(c.complete=_R);const f=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch(_){}}),this.observers.push(c),f}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,t)}sendOne(t,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{r(this.observers[t])}catch(s){typeof console!="undefined"&&console.error&&console.error(s)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Gle(e,t){if(typeof e!="object"||e===null)return!1;for(const r of t)if(r in e&&typeof e[r]=="function")return!0;return!1}function _R(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function js(e){return e&&e._delegate?e._delegate:e}class jf{constructor(t,r,s){this.name=t,this.instanceFactory=r,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wle{constructor(t,r){this.name=t,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const r=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(r)){const s=new Rle;if(this.instancesDeferred.set(r,s),this.isInitialized(r)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:r});c&&s.resolve(c)}catch(c){}}return this.instancesDeferred.get(r).promise}getImmediate(t){var r;const s=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),c=(r=t==null?void 0:t.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(f){if(c)return null;throw f}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Zle(t))try{this.getOrInitializeService({instanceIdentifier:lm})}catch(r){}for(const[r,s]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(r);try{const f=this.getOrInitializeService({instanceIdentifier:c});s.resolve(f)}catch(f){}}}}clearInstance(t=lm){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return Be(this,null,function*(){const t=Array.from(this.instances.values());yield Promise.all([...t.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...t.filter(r=>"_delete"in r).map(r=>r._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=lm){return this.instances.has(t)}getOptions(t=lm){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:r={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:s,options:r});for(const[f,_]of this.instancesDeferred.entries()){const x=this.normalizeInstanceIdentifier(f);s===x&&_.resolve(c)}return c}onInit(t,r){var s;const c=this.normalizeInstanceIdentifier(r),f=(s=this.onInitCallbacks.get(c))!==null&&s!==void 0?s:new Set;f.add(t),this.onInitCallbacks.set(c,f);const _=this.instances.get(c);return _&&t(_,c),()=>{f.delete(t)}}invokeOnInitCallbacks(t,r){const s=this.onInitCallbacks.get(r);if(s)for(const c of s)try{c(t,r)}catch(f){}}getOrInitializeService({instanceIdentifier:t,options:r={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Hle(t),options:r}),this.instances.set(t,s),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch(c){}return s||null}normalizeInstanceIdentifier(t=lm){return this.component?this.component.multipleInstances?t:lm:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Hle(e){return e===lm?void 0:e}function Zle(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xle{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const r=this.getProvider(t.name);if(r.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);r.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const r=new Wle(t,this);return this.providers.set(t,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ni;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(ni||(ni={}));const Kle={debug:ni.DEBUG,verbose:ni.VERBOSE,info:ni.INFO,warn:ni.WARN,error:ni.ERROR,silent:ni.SILENT},Qle=ni.INFO,Yle={[ni.DEBUG]:"log",[ni.VERBOSE]:"log",[ni.INFO]:"info",[ni.WARN]:"warn",[ni.ERROR]:"error"},Jle=(e,t,...r)=>{if(t<e.logLevel)return;const s=new Date().toISOString(),c=Yle[t];if(c)console[c](`[${s}]  ${e.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class iO{constructor(t){this.name=t,this._logLevel=Qle,this._logHandler=Jle,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in ni))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Kle[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,ni.DEBUG,...t),this._logHandler(this,ni.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,ni.VERBOSE,...t),this._logHandler(this,ni.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,ni.INFO,...t),this._logHandler(this,ni.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,ni.WARN,...t),this._logHandler(this,ni.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,ni.ERROR,...t),this._logHandler(this,ni.ERROR,...t)}}const ece=(e,t)=>t.some(r=>e instanceof r);let Mj,kj;function tce(){return Mj||(Mj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function nce(){return kj||(kj=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const rG=new WeakMap,pk=new WeakMap,iG=new WeakMap,yR=new WeakMap,sO=new WeakMap;function rce(e){const t=new Promise((r,s)=>{const c=()=>{e.removeEventListener("success",f),e.removeEventListener("error",_)},f=()=>{r(Df(e.result)),c()},_=()=>{s(e.error),c()};e.addEventListener("success",f),e.addEventListener("error",_)});return t.then(r=>{r instanceof IDBCursor&&rG.set(r,e)}).catch(()=>{}),sO.set(t,e),t}function ice(e){if(pk.has(e))return;const t=new Promise((r,s)=>{const c=()=>{e.removeEventListener("complete",f),e.removeEventListener("error",_),e.removeEventListener("abort",_)},f=()=>{r(),c()},_=()=>{s(e.error||new DOMException("AbortError","AbortError")),c()};e.addEventListener("complete",f),e.addEventListener("error",_),e.addEventListener("abort",_)});pk.set(e,t)}let mk={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return pk.get(e);if(t==="objectStoreNames")return e.objectStoreNames||iG.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Df(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function sce(e){mk=e(mk)}function oce(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...r){const s=e.call(vR(this),t,...r);return iG.set(s,t.sort?t.sort():[t]),Df(s)}:nce().includes(e)?function(...t){return e.apply(vR(this),t),Df(rG.get(this))}:function(...t){return Df(e.apply(vR(this),t))}}function ace(e){return typeof e=="function"?oce(e):(e instanceof IDBTransaction&&ice(e),ece(e,tce())?new Proxy(e,mk):e)}function Df(e){if(e instanceof IDBRequest)return rce(e);if(yR.has(e))return yR.get(e);const t=ace(e);return t!==e&&(yR.set(e,t),sO.set(t,e)),t}const vR=e=>sO.get(e);function lce(e,t,{blocked:r,upgrade:s,blocking:c,terminated:f}={}){const _=indexedDB.open(e,t),x=Df(_);return s&&_.addEventListener("upgradeneeded",a=>{s(Df(_.result),a.oldVersion,a.newVersion,Df(_.transaction),a)}),r&&_.addEventListener("blocked",a=>r(a.oldVersion,a.newVersion,a)),x.then(a=>{f&&a.addEventListener("close",()=>f()),c&&a.addEventListener("versionchange",I=>c(I.oldVersion,I.newVersion,I))}).catch(()=>{}),x}const cce=["get","getKey","getAll","getAllKeys","count"],uce=["put","add","delete","clear"],xR=new Map;function Dj(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(xR.get(t))return xR.get(t);const r=t.replace(/FromIndex$/,""),s=t!==r,c=uce.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(c||cce.includes(r)))return;const f=function(_,...x){return Be(this,null,function*(){const a=this.transaction(_,c?"readwrite":"readonly");let I=a.store;return s&&(I=I.index(x.shift())),(yield Promise.all([I[r](...x),c&&a.done]))[0]})};return xR.set(t,f),f}sce(e=>_t(de({},e),{get:(t,r,s)=>Dj(t,r)||e.get(t,r,s),has:(t,r)=>!!Dj(t,r)||e.has(t,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hce{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(dce(r)){const s=r.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(r=>r).join(" ")}}function dce(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const gk="@firebase/app",Oj="0.10.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qh=new iO("@firebase/app"),fce="@firebase/app-compat",pce="@firebase/analytics-compat",mce="@firebase/analytics",gce="@firebase/app-check-compat",_ce="@firebase/app-check",yce="@firebase/auth",vce="@firebase/auth-compat",xce="@firebase/database",bce="@firebase/database-compat",wce="@firebase/functions",Tce="@firebase/functions-compat",Ece="@firebase/installations",Sce="@firebase/installations-compat",Ice="@firebase/messaging",Cce="@firebase/messaging-compat",Ace="@firebase/performance",Pce="@firebase/performance-compat",Rce="@firebase/remote-config",Mce="@firebase/remote-config-compat",kce="@firebase/storage",Dce="@firebase/storage-compat",Oce="@firebase/firestore",Lce="@firebase/vertexai-preview",zce="@firebase/firestore-compat",Nce="firebase",Fce="10.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _k="[DEFAULT]",Bce={[gk]:"fire-core",[fce]:"fire-core-compat",[mce]:"fire-analytics",[pce]:"fire-analytics-compat",[_ce]:"fire-app-check",[gce]:"fire-app-check-compat",[yce]:"fire-auth",[vce]:"fire-auth-compat",[xce]:"fire-rtdb",[bce]:"fire-rtdb-compat",[wce]:"fire-fn",[Tce]:"fire-fn-compat",[Ece]:"fire-iid",[Sce]:"fire-iid-compat",[Ice]:"fire-fcm",[Cce]:"fire-fcm-compat",[Ace]:"fire-perf",[Pce]:"fire-perf-compat",[Rce]:"fire-rc",[Mce]:"fire-rc-compat",[kce]:"fire-gcs",[Dce]:"fire-gcs-compat",[Oce]:"fire-fst",[zce]:"fire-fst-compat",[Lce]:"fire-vertex","fire-js":"fire-js",[Nce]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PS=new Map,jce=new Map,yk=new Map;function Lj(e,t){try{e.container.addComponent(t)}catch(r){Qh.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function Vm(e){const t=e.name;if(yk.has(t))return Qh.debug(`There were multiple attempts to register component ${t}.`),!1;yk.set(t,e);for(const r of PS.values())Lj(r,e);for(const r of jce.values())Lj(r,e);return!0}function oC(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function Bc(e){return e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uce={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Of=new sb("app","Firebase",Uce);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vce{constructor(t,r,s){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new jf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Of.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ug=Fce;function sG(e,t={}){let r=e;typeof t!="object"&&(t={name:t});const s=Object.assign({name:_k,automaticDataCollectionEnabled:!1},t),c=s.name;if(typeof c!="string"||!c)throw Of.create("bad-app-name",{appName:String(c)});if(r||(r=eG()),!r)throw Of.create("no-options");const f=PS.get(c);if(f){if(ky(r,f.options)&&ky(s,f.config))return f;throw Of.create("duplicate-app",{appName:c})}const _=new Xle(c);for(const a of yk.values())_.addComponent(a);const x=new Vce(r,s,_);return PS.set(c,x),x}function oO(e=_k){const t=PS.get(e);if(!t&&e===_k&&eG())return sG();if(!t)throw Of.create("no-app",{appName:e});return t}function ju(e,t,r){var s;let c=(s=Bce[e])!==null&&s!==void 0?s:e;r&&(c+=`-${r}`);const f=c.match(/\s|\//),_=t.match(/\s|\//);if(f||_){const x=[`Unable to register library "${c}" with version "${t}":`];f&&x.push(`library name "${c}" contains illegal characters (whitespace or "/")`),f&&_&&x.push("and"),_&&x.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Qh.warn(x.join(" "));return}Vm(new jf(`${c}-version`,()=>({library:c,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $ce="firebase-heartbeat-database",qce=1,wx="firebase-heartbeat-store";let bR=null;function oG(){return bR||(bR=lce($ce,qce,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(wx)}catch(r){console.warn(r)}}}}).catch(e=>{throw Of.create("idb-open",{originalErrorMessage:e.message})})),bR}function Gce(e){return Be(this,null,function*(){try{const r=(yield oG()).transaction(wx),s=yield r.objectStore(wx).get(aG(e));return yield r.done,s}catch(t){if(t instanceof Ku)Qh.warn(t.message);else{const r=Of.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Qh.warn(r.message)}}})}function zj(e,t){return Be(this,null,function*(){try{const s=(yield oG()).transaction(wx,"readwrite");yield s.objectStore(wx).put(t,aG(e)),yield s.done}catch(r){if(r instanceof Ku)Qh.warn(r.message);else{const s=Of.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Qh.warn(s.message)}}})}function aG(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wce=1024,Hce=30*24*60*60*1e3;class Zce{constructor(t){this.container=t,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new Kce(r),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}triggerHeartbeat(){return Be(this,null,function*(){var t,r;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),f=Nj();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===f||this._heartbeatsCache.heartbeats.some(_=>_.date===f)?void 0:(this._heartbeatsCache.heartbeats.push({date:f,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const x=new Date(_.date).valueOf();return Date.now()-x<=Hce}),this._storage.overwrite(this._heartbeatsCache))}catch(s){Qh.warn(s)}})}getHeartbeatsHeader(){return Be(this,null,function*(){var t;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=Nj(),{heartbeatsToSend:s,unsentEntries:c}=Xce(this._heartbeatsCache.heartbeats),f=AS(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=r,c.length>0?(this._heartbeatsCache.heartbeats=c,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),f}catch(r){return Qh.warn(r),""}})}}function Nj(){return new Date().toISOString().substring(0,10)}function Xce(e,t=Wce){const r=[];let s=e.slice();for(const c of e){const f=r.find(_=>_.agent===c.agent);if(f){if(f.dates.push(c.date),Fj(r)>t){f.dates.pop();break}}else if(r.push({agent:c.agent,dates:[c.date]}),Fj(r)>t){r.pop();break}s=s.slice(1)}return{heartbeatsToSend:r,unsentEntries:s}}class Kce{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return Be(this,null,function*(){return Nle()?Fle().then(()=>!0).catch(()=>!1):!1})}read(){return Be(this,null,function*(){if(yield this._canUseIndexedDBPromise){const r=yield Gce(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return Be(this,null,function*(){var r;if(yield this._canUseIndexedDBPromise){const c=yield this.read();return zj(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return Be(this,null,function*(){var r;if(yield this._canUseIndexedDBPromise){const c=yield this.read();return zj(this.app,{lastSentHeartbeatDate:(r=t.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...t.heartbeats]})}else return})}}function Fj(e){return AS(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qce(e){Vm(new jf("platform-logger",t=>new hce(t),"PRIVATE")),Vm(new jf("heartbeat",t=>new Zce(t),"PRIVATE")),ju(gk,Oj,e),ju(gk,Oj,"esm2017"),ju("fire-js","")}Qce("");var Yce="firebase",Jce="10.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ju(Yce,Jce,"app");function aO(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(e);c<s.length;c++)t.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(e,s[c])&&(r[s[c]]=e[s[c]]);return r}function lG(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const eue=lG,cG=new sb("auth","Firebase",lG());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RS=new iO("@firebase/auth");function tue(e,...t){RS.logLevel<=ni.WARN&&RS.warn(`Auth (${ug}): ${e}`,...t)}function CE(e,...t){RS.logLevel<=ni.ERROR&&RS.error(`Auth (${ug}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(e,...t){throw cO(e,...t)}function qc(e,...t){return cO(e,...t)}function lO(e,t,r){const s=Object.assign(Object.assign({},eue()),{[t]:r});return new sb("auth","Firebase",s).create(t,{appName:e.name})}function $h(e){return lO(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function nue(e,t,r){const s=r;if(!(t instanceof s))throw s.name!==t.constructor.name&&tc(e,"argument-error"),lO(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function cO(e,...t){if(typeof e!="string"){const r=t[0],s=[...t.slice(1)];return s[0]&&(s[0].appName=e.name),e._errorFactory.create(r,...s)}return cG.create(e,...t)}function br(e,t,...r){if(!e)throw cO(t,...r)}function Bh(e){const t="INTERNAL ASSERTION FAILED: "+e;throw CE(t),new Error(t)}function Yh(e,t){e||Bh(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vk(){var e;return typeof self!="undefined"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function rue(){return Bj()==="http:"||Bj()==="https:"}function Bj(){var e;return typeof self!="undefined"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iue(){return typeof navigator!="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(rue()||Dle()||"connection"in navigator)?navigator.onLine:!0}function sue(){if(typeof navigator=="undefined")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(t,r){this.shortDelay=t,this.longDelay=r,Yh(r>t,"Short delay should be less than long delay!"),this.isMobile=Mle()||Ole()}get(){return iue()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uO(e,t){Yh(e.emulator,"Emulator should always be set here");const{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uG{static initialize(t,r,s){this.fetchImpl=t,r&&(this.headersImpl=r),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self!="undefined"&&"fetch"in self)return self.fetch;if(typeof globalThis!="undefined"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch!="undefined")return fetch;Bh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self!="undefined"&&"Headers"in self)return self.Headers;if(typeof globalThis!="undefined"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers!="undefined")return Headers;Bh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self!="undefined"&&"Response"in self)return self.Response;if(typeof globalThis!="undefined"&&globalThis.Response)return globalThis.Response;if(typeof Response!="undefined")return Response;Bh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oue={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aue=new ab(3e4,6e4);function ep(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}function tp(f,_,x,a){return Be(this,arguments,function*(e,t,r,s,c={}){return hG(e,c,()=>Be(this,null,function*(){let I={},D={};s&&(t==="GET"?D=s:I={body:JSON.stringify(s)});const O=ob(Object.assign({key:e.config.apiKey},D)).slice(1),F=yield e._getAdditionalHeaders();return F["Content-Type"]="application/json",e.languageCode&&(F["X-Firebase-Locale"]=e.languageCode),uG.fetch()(dG(e,e.config.apiHost,r,O),Object.assign({method:t,headers:F,referrerPolicy:"no-referrer"},I))}))})}function hG(e,t,r){return Be(this,null,function*(){e._canInitEmulator=!1;const s=Object.assign(Object.assign({},oue),t);try{const c=new cue(e),f=yield Promise.race([r(),c.promise]);c.clearNetworkTimeout();const _=yield f.json();if("needConfirmation"in _)throw HT(e,"account-exists-with-different-credential",_);if(f.ok&&!("errorMessage"in _))return _;{const x=f.ok?_.errorMessage:_.error.message,[a,I]=x.split(" : ");if(a==="FEDERATED_USER_ID_ALREADY_LINKED")throw HT(e,"credential-already-in-use",_);if(a==="EMAIL_EXISTS")throw HT(e,"email-already-in-use",_);if(a==="USER_DISABLED")throw HT(e,"user-disabled",_);const D=s[a]||a.toLowerCase().replace(/[_\s]+/g,"-");if(I)throw lO(e,D,I);tc(e,D)}}catch(c){if(c instanceof Ku)throw c;tc(e,"network-request-failed",{message:String(c)})}})}function lb(f,_,x,a){return Be(this,arguments,function*(e,t,r,s,c={}){const I=yield tp(e,t,r,s,c);return"mfaPendingCredential"in I&&tc(e,"multi-factor-auth-required",{_serverResponse:I}),I})}function dG(e,t,r,s){const c=`${t}${r}?${s}`;return e.config.emulator?uO(e.config,c):`${e.config.apiScheme}://${c}`}function lue(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class cue{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((r,s)=>{this.timer=setTimeout(()=>s(qc(this.auth,"network-request-failed")),aue.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function HT(e,t,r){const s={appName:e.name};r.email&&(s.email=r.email),r.phoneNumber&&(s.phoneNumber=r.phoneNumber);const c=qc(e,t,s);return c.customData._tokenResponse=r,c}function jj(e){return e!==void 0&&e.enterprise!==void 0}class uue{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===t)return lue(r.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}}function hue(e,t){return Be(this,null,function*(){return tp(e,"GET","/v2/recaptchaConfig",ep(e,t))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function due(e,t){return Be(this,null,function*(){return tp(e,"POST","/v1/accounts:delete",t)})}function fG(e,t){return Be(this,null,function*(){return tp(e,"POST","/v1/accounts:lookup",t)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z1(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function fue(e,t=!1){return Be(this,null,function*(){const r=js(e),s=yield r.getIdToken(t),c=hO(s);br(c&&c.exp&&c.auth_time&&c.iat,r.auth,"internal-error");const f=typeof c.firebase=="object"?c.firebase:void 0,_=f==null?void 0:f.sign_in_provider;return{claims:c,token:s,authTime:z1(wR(c.auth_time)),issuedAtTime:z1(wR(c.iat)),expirationTime:z1(wR(c.exp)),signInProvider:_||null,signInSecondFactor:(f==null?void 0:f.sign_in_second_factor)||null}})}function wR(e){return Number(e)*1e3}function hO(e){const[t,r,s]=e.split(".");if(t===void 0||r===void 0||s===void 0)return CE("JWT malformed, contained fewer than 3 sections"),null;try{const c=Qq(r);return c?JSON.parse(c):(CE("Failed to decode base64 JWT payload"),null)}catch(c){return CE("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function Uj(e){const t=hO(e);return br(t,"internal-error"),br(typeof t.exp!="undefined","internal-error"),br(typeof t.iat!="undefined","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tx(e,t,r=!1){return Be(this,null,function*(){if(r)return t;try{return yield t}catch(s){throw s instanceof Ku&&pue(s)&&e.auth.currentUser===e&&(yield e.auth.signOut()),s}})}function pue({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mue{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var r;if(t){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const c=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(t=!1){if(!this.isRunning)return;const r=this.getInterval(t);this.timerId=setTimeout(()=>Be(this,null,function*(){yield this.iteration()}),r)}iteration(){return Be(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xk{constructor(t,r){this.createdAt=t,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=z1(this.lastLoginAt),this.creationTime=z1(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MS(e){return Be(this,null,function*(){var t;const r=e.auth,s=yield e.getIdToken(),c=yield Tx(e,fG(r,{idToken:s}));br(c==null?void 0:c.users.length,r,"internal-error");const f=c.users[0];e._notifyReloadListener(f);const _=!((t=f.providerUserInfo)===null||t===void 0)&&t.length?pG(f.providerUserInfo):[],x=_ue(e.providerData,_),a=e.isAnonymous,I=!(e.email&&f.passwordHash)&&!(x!=null&&x.length),D=a?I:!1,O={uid:f.localId,displayName:f.displayName||null,photoURL:f.photoUrl||null,email:f.email||null,emailVerified:f.emailVerified||!1,phoneNumber:f.phoneNumber||null,tenantId:f.tenantId||null,providerData:x,metadata:new xk(f.createdAt,f.lastLoginAt),isAnonymous:D};Object.assign(e,O)})}function gue(e){return Be(this,null,function*(){const t=js(e);yield MS(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}function _ue(e,t){return[...e.filter(s=>!t.some(c=>c.providerId===s.providerId)),...t]}function pG(e){return e.map(t=>{var{providerId:r}=t,s=aO(t,["providerId"]);return{providerId:r,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yue(e,t){return Be(this,null,function*(){const r=yield hG(e,{},()=>Be(this,null,function*(){const s=ob({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:c,apiKey:f}=e.config,_=dG(e,c,"/v1/token",`key=${f}`),x=yield e._getAdditionalHeaders();return x["Content-Type"]="application/x-www-form-urlencoded",uG.fetch()(_,{method:"POST",headers:x,body:s})}));return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}})}function vue(e,t){return Be(this,null,function*(){return tp(e,"POST","/v2/accounts:revokeToken",ep(e,t))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){br(t.idToken,"internal-error"),br(typeof t.idToken!="undefined","internal-error"),br(typeof t.refreshToken!="undefined","internal-error");const r="expiresIn"in t&&typeof t.expiresIn!="undefined"?Number(t.expiresIn):Uj(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,r)}updateFromIdToken(t){br(t.length!==0,"internal-error");const r=Uj(t);this.updateTokensAndExpiration(t,null,r)}getToken(t,r=!1){return Be(this,null,function*(){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(br(this.refreshToken,t,"user-token-expired"),this.refreshToken?(yield this.refresh(t,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(t,r){return Be(this,null,function*(){const{accessToken:s,refreshToken:c,expiresIn:f}=yield yue(t,r);this.updateTokensAndExpiration(s,c,Number(f))})}updateTokensAndExpiration(t,r,s){this.refreshToken=r||null,this.accessToken=t||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(t,r){const{refreshToken:s,accessToken:c,expirationTime:f}=r,_=new hy;return s&&(br(typeof s=="string","internal-error",{appName:t}),_.refreshToken=s),c&&(br(typeof c=="string","internal-error",{appName:t}),_.accessToken=c),f&&(br(typeof f=="number","internal-error",{appName:t}),_.expirationTime=f),_}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new hy,this.toJSON())}_performRefresh(){return Bh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(e,t){br(typeof e=="string"||typeof e=="undefined","internal-error",{appName:t})}class jh{constructor(t){var{uid:r,auth:s,stsTokenManager:c}=t,f=aO(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new mue(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=s,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=f.displayName||null,this.email=f.email||null,this.emailVerified=f.emailVerified||!1,this.phoneNumber=f.phoneNumber||null,this.photoURL=f.photoURL||null,this.isAnonymous=f.isAnonymous||!1,this.tenantId=f.tenantId||null,this.providerData=f.providerData?[...f.providerData]:[],this.metadata=new xk(f.createdAt||void 0,f.lastLoginAt||void 0)}getIdToken(t){return Be(this,null,function*(){const r=yield Tx(this,this.stsTokenManager.getToken(this.auth,t));return br(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r})}getIdTokenResult(t){return fue(this,t)}reload(){return gue(this)}_assign(t){this!==t&&(br(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(r=>Object.assign({},r)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const r=new jh(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(t){br(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(t,r=!1){return Be(this,null,function*(){let s=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),s=!0),r&&(yield MS(this)),yield this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)})}delete(){return Be(this,null,function*(){if(Bc(this.auth.app))return Promise.reject($h(this.auth));const t=yield this.getIdToken();return yield Tx(this,due(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,r){var s,c,f,_,x,a,I,D;const O=(s=r.displayName)!==null&&s!==void 0?s:void 0,F=(c=r.email)!==null&&c!==void 0?c:void 0,H=(f=r.phoneNumber)!==null&&f!==void 0?f:void 0,Q=(_=r.photoURL)!==null&&_!==void 0?_:void 0,ie=(x=r.tenantId)!==null&&x!==void 0?x:void 0,te=(a=r._redirectEventId)!==null&&a!==void 0?a:void 0,W=(I=r.createdAt)!==null&&I!==void 0?I:void 0,X=(D=r.lastLoginAt)!==null&&D!==void 0?D:void 0,{uid:ee,emailVerified:fe,isAnonymous:ye,providerData:Ee,stsTokenManager:re}=r;br(ee&&re,t,"internal-error");const he=hy.fromJSON(this.name,re);br(typeof ee=="string",t,"internal-error"),nf(O,t.name),nf(F,t.name),br(typeof fe=="boolean",t,"internal-error"),br(typeof ye=="boolean",t,"internal-error"),nf(H,t.name),nf(Q,t.name),nf(ie,t.name),nf(te,t.name),nf(W,t.name),nf(X,t.name);const _e=new jh({uid:ee,auth:t,email:F,emailVerified:fe,displayName:O,isAnonymous:ye,photoURL:Q,phoneNumber:H,tenantId:ie,stsTokenManager:he,createdAt:W,lastLoginAt:X});return Ee&&Array.isArray(Ee)&&(_e.providerData=Ee.map(Se=>Object.assign({},Se))),te&&(_e._redirectEventId=te),_e}static _fromIdTokenResponse(t,r,s=!1){return Be(this,null,function*(){const c=new hy;c.updateFromServerResponse(r);const f=new jh({uid:r.localId,auth:t,stsTokenManager:c,isAnonymous:s});return yield MS(f),f})}static _fromGetAccountInfoResponse(t,r,s){return Be(this,null,function*(){const c=r.users[0];br(c.localId!==void 0,"internal-error");const f=c.providerUserInfo!==void 0?pG(c.providerUserInfo):[],_=!(c.email&&c.passwordHash)&&!(f!=null&&f.length),x=new hy;x.updateFromIdToken(s);const a=new jh({uid:c.localId,auth:t,stsTokenManager:x,isAnonymous:_}),I={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:f,metadata:new xk(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!(f!=null&&f.length)};return Object.assign(a,I),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vj=new Map;function Uh(e){Yh(e instanceof Function,"Expected a class definition");let t=Vj.get(e);return t?(Yh(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Vj.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mG{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return Be(this,null,function*(){return!0})}_set(t,r){return Be(this,null,function*(){this.storage[t]=r})}_get(t){return Be(this,null,function*(){const r=this.storage[t];return r===void 0?null:r})}_remove(t){return Be(this,null,function*(){delete this.storage[t]})}_addListener(t,r){}_removeListener(t,r){}}mG.type="NONE";const $j=mG;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AE(e,t,r){return`firebase:${e}:${t}:${r}`}class dy{constructor(t,r,s){this.persistence=t,this.auth=r,this.userKey=s;const{config:c,name:f}=this.auth;this.fullUserKey=AE(this.userKey,c.apiKey,f),this.fullPersistenceKey=AE("persistence",c.apiKey,f),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}getCurrentUser(){return Be(this,null,function*(){const t=yield this.persistence._get(this.fullUserKey);return t?jh._fromJSON(this.auth,t):null})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(t){return Be(this,null,function*(){if(this.persistence===t)return;const r=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=t,r)return this.setCurrentUser(r)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(t,r,s="authUser"){return Be(this,null,function*(){if(!r.length)return new dy(Uh($j),t,s);const c=(yield Promise.all(r.map(I=>Be(this,null,function*(){if(yield I._isAvailable())return I})))).filter(I=>I);let f=c[0]||Uh($j);const _=AE(s,t.config.apiKey,t.name);let x=null;for(const I of r)try{const D=yield I._get(_);if(D){const O=jh._fromJSON(t,D);I!==f&&(x=O),f=I;break}}catch(D){}const a=c.filter(I=>I._shouldAllowMigration);return!f._shouldAllowMigration||!a.length?new dy(f,t,s):(f=a[0],x&&(yield f._set(_,x.toJSON())),yield Promise.all(r.map(I=>Be(this,null,function*(){if(I!==f)try{yield I._remove(_)}catch(D){}}))),new dy(f,t,s))})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qj(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(vG(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(gG(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(bG(t))return"Blackberry";if(wG(t))return"Webos";if(_G(t))return"Safari";if((t.includes("chrome/")||yG(t))&&!t.includes("edge/"))return"Chrome";if(xG(t))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=e.match(r);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function gG(e=ia()){return/firefox\//i.test(e)}function _G(e=ia()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function yG(e=ia()){return/crios\//i.test(e)}function vG(e=ia()){return/iemobile/i.test(e)}function xG(e=ia()){return/android/i.test(e)}function bG(e=ia()){return/blackberry/i.test(e)}function wG(e=ia()){return/webos/i.test(e)}function dO(e=ia()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function xue(e=ia()){var t;return dO(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function bue(){return Lle()&&document.documentMode===10}function TG(e=ia()){return dO(e)||xG(e)||wG(e)||bG(e)||/windows phone/i.test(e)||vG(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EG(e,t=[]){let r;switch(e){case"Browser":r=qj(ia());break;case"Worker":r=`${qj(ia())}-${e}`;break;default:r=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${ug}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wue{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,r){const s=f=>new Promise((_,x)=>{try{const a=t(f);_(a)}catch(a){x(a)}});s.onAbort=r,this.queue.push(s);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}runMiddleware(t){return Be(this,null,function*(){if(this.auth.currentUser===t)return;const r=[];try{for(const s of this.queue)yield s(t),s.onAbort&&r.push(s.onAbort)}catch(s){r.reverse();for(const c of r)try{c()}catch(f){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}})}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tue(r){return Be(this,arguments,function*(e,t={}){return tp(e,"GET","/v2/passwordPolicy",ep(e,t))})}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eue=6;class Sue{constructor(t){var r,s,c,f;const _=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=_.minPasswordLength)!==null&&r!==void 0?r:Eue,_.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=_.maxPasswordLength),_.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=_.containsLowercaseCharacter),_.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=_.containsUppercaseCharacter),_.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=_.containsNumericCharacter),_.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=_.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(s=t.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(f=t.forceUpgradeOnSignin)!==null&&f!==void 0?f:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var r,s,c,f,_,x;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,a),this.validatePasswordCharacterOptions(t,a),a.isValid&&(a.isValid=(r=a.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),a.isValid&&(a.isValid=(s=a.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),a.isValid&&(a.isValid=(c=a.containsLowercaseLetter)!==null&&c!==void 0?c:!0),a.isValid&&(a.isValid=(f=a.containsUppercaseLetter)!==null&&f!==void 0?f:!0),a.isValid&&(a.isValid=(_=a.containsNumericCharacter)!==null&&_!==void 0?_:!0),a.isValid&&(a.isValid=(x=a.containsNonAlphanumericCharacter)!==null&&x!==void 0?x:!0),a}validatePasswordLengthOptions(t,r){const s=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;s&&(r.meetsMinPasswordLength=t.length>=s),c&&(r.meetsMaxPasswordLength=t.length<=c)}validatePasswordCharacterOptions(t,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let s;for(let c=0;c<t.length;c++)s=t.charAt(c),this.updatePasswordCharacterOptionsStatuses(r,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(t,r,s,c,f){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iue{constructor(t,r,s,c){this.app=t,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=s,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Gj(this),this.idTokenSubscription=new Gj(this),this.beforeStateQueue=new wue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=cG,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(t,r){return r&&(this._popupRedirectResolver=Uh(r)),this._initializationPromise=this.queue(()=>Be(this,null,function*(){var s,c;if(!this._deleted&&(this.persistenceManager=yield dy.create(this,t),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(f){}yield this.initializeCurrentUser(r),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return Be(this,null,function*(){if(this._deleted)return;const t=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(t,!0)}})}initializeCurrentUserFromIdToken(t){return Be(this,null,function*(){try{const r=yield fG(this,{idToken:t}),s=yield jh._fromGetAccountInfoResponse(this,r,t);yield this.directlySetCurrentUser(s)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(t){return Be(this,null,function*(){var r;if(Bc(this.app)){const _=this.app.settings.authIdToken;return _?new Promise(x=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(_).then(x,x))}):this.directlySetCurrentUser(null)}const s=yield this.assertedPersistence.getCurrentUser();let c=s,f=!1;if(t&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();const _=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,x=c==null?void 0:c._redirectEventId,a=yield this.tryRedirectSignIn(t);(!_||_===x)&&(a!=null&&a.user)&&(c=a.user,f=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(f)try{yield this.beforeStateQueue.runMiddleware(c)}catch(_){c=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(_))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return br(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)})}tryRedirectSignIn(t){return Be(this,null,function*(){let r=null;try{r=yield this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(s){yield this._setRedirectUser(null)}return r})}reloadAndSetCurrentUserOrClear(t){return Be(this,null,function*(){try{yield MS(t)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)})}useDeviceLanguage(){this.languageCode=sue()}_delete(){return Be(this,null,function*(){this._deleted=!0})}updateCurrentUser(t){return Be(this,null,function*(){if(Bc(this.app))return Promise.reject($h(this));const r=t?js(t):null;return r&&br(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))})}_updateCurrentUser(t,r=!1){return Be(this,null,function*(){if(!this._deleted)return t&&br(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),r||(yield this.beforeStateQueue.runMiddleware(t)),this.queue(()=>Be(this,null,function*(){yield this.directlySetCurrentUser(t),this.notifyAuthListeners()}))})}signOut(){return Be(this,null,function*(){return Bc(this.app)?Promise.reject($h(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(t){return Bc(this.app)?Promise.reject($h(this)):this.queue(()=>Be(this,null,function*(){yield this.assertedPersistence.setPersistence(Uh(t))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(t){return Be(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(t)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return Be(this,null,function*(){const t=yield Tue(this),r=new Sue(t);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new sb("auth","Firebase",t())}onAuthStateChanged(t,r,s){return this.registerStateListener(this.authStateSubscription,t,r,s)}beforeAuthStateChanged(t,r){return this.beforeStateQueue.pushCallback(t,r)}onIdTokenChanged(t,r,s){return this.registerStateListener(this.idTokenSubscription,t,r,s)}authStateReady(){return new Promise((t,r)=>{if(this.currentUser)t();else{const s=this.onAuthStateChanged(()=>{s(),t()},r)}})}revokeAccessToken(t){return Be(this,null,function*(){if(this.currentUser){const r=yield this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:r};this.tenantId!=null&&(s.tenantId=this.tenantId),yield vue(this,s)}})}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}_setRedirectUser(t,r){return Be(this,null,function*(){const s=yield this.getOrInitRedirectPersistenceManager(r);return t===null?s.removeCurrentUser():s.setCurrentUser(t)})}getOrInitRedirectPersistenceManager(t){return Be(this,null,function*(){if(!this.redirectPersistenceManager){const r=t&&Uh(t)||this._popupRedirectResolver;br(r,this,"argument-error"),this.redirectPersistenceManager=yield dy.create(this,[Uh(r._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(t){return Be(this,null,function*(){var r,s;return this._isInitialized&&(yield this.queue(()=>Be(this,null,function*(){}))),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===t?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===t?this.redirectUser:null})}_persistUserIfCurrent(t){return Be(this,null,function*(){if(t===this.currentUser)return this.queue(()=>Be(this,null,function*(){return this.directlySetCurrentUser(t)}))})}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(r=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,r,s,c){if(this._deleted)return()=>{};const f=typeof r=="function"?r:r.next.bind(r);let _=!1;const x=this._isInitialized?Promise.resolve():this._initializationPromise;if(br(x,this,"internal-error"),x.then(()=>{_||f(this.currentUser)}),typeof r=="function"){const a=t.addObserver(r,s,c);return()=>{_=!0,a()}}else{const a=t.addObserver(r);return()=>{_=!0,a()}}}directlySetCurrentUser(t){return Be(this,null,function*(){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?yield this.assertedPersistence.setCurrentUser(t):yield this.assertedPersistence.removeCurrentUser()})}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return br(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=EG(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return Be(this,null,function*(){var t;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const s=yield(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader();s&&(r["X-Firebase-Client"]=s);const c=yield this._getAppCheckToken();return c&&(r["X-Firebase-AppCheck"]=c),r})}_getAppCheckToken(){return Be(this,null,function*(){var t;const r=yield(t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken();return r!=null&&r.error&&tue(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token})}}function np(e){return js(e)}class Gj{constructor(t){this.auth=t,this.observer=null,this.addObserver=$le(r=>this.observer=r)}get next(){return br(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aC={loadJS(){return Be(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Cue(e){aC=e}function SG(e){return aC.loadJS(e)}function Aue(){return aC.recaptchaEnterpriseScript}function Pue(){return aC.gapiScript}function Rue(e){return`__${e}${Math.floor(Math.random()*1e6)}`}const Mue="recaptcha-enterprise",kue="NO_RECAPTCHA";class Due{constructor(t){this.type=Mue,this.auth=np(t)}verify(t="verify",r=!1){return Be(this,null,function*(){function s(f){return Be(this,null,function*(){if(!r){if(f.tenantId==null&&f._agentRecaptchaConfig!=null)return f._agentRecaptchaConfig.siteKey;if(f.tenantId!=null&&f._tenantRecaptchaConfigs[f.tenantId]!==void 0)return f._tenantRecaptchaConfigs[f.tenantId].siteKey}return new Promise((_,x)=>Be(this,null,function*(){hue(f,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(a=>{if(a.recaptchaKey===void 0)x(new Error("recaptcha Enterprise site key undefined"));else{const I=new uue(a);return f.tenantId==null?f._agentRecaptchaConfig=I:f._tenantRecaptchaConfigs[f.tenantId]=I,_(I.siteKey)}}).catch(a=>{x(a)})}))})}function c(f,_,x){const a=window.grecaptcha;jj(a)?a.enterprise.ready(()=>{a.enterprise.execute(f,{action:t}).then(I=>{_(I)}).catch(()=>{_(kue)})}):x(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((f,_)=>{s(this.auth).then(x=>{if(!r&&jj(window.grecaptcha))c(x,f,_);else{if(typeof window=="undefined"){_(new Error("RecaptchaVerifier is only supported in browser"));return}let a=Aue();a.length!==0&&(a+=x),SG(a).then(()=>{c(x,f,_)}).catch(I=>{_(I)})}}).catch(x=>{_(x)})})})}}function Wj(e,t,r,s=!1){return Be(this,null,function*(){const c=new Due(e);let f;try{f=yield c.verify(r)}catch(x){f=yield c.verify(r,!0)}const _=Object.assign({},t);return s?Object.assign(_,{captchaResp:f}):Object.assign(_,{captchaResponse:f}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_})}function bk(e,t,r,s){return Be(this,null,function*(){var c;if(!((c=e._getRecaptchaConfig())===null||c===void 0)&&c.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=yield Wj(e,t,r,r==="getOobCode");return s(e,f)}else return s(e,t).catch(f=>Be(this,null,function*(){if(f.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=yield Wj(e,t,r,r==="getOobCode");return s(e,_)}else return Promise.reject(f)}))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oue(e,t){const r=oC(e,"auth");if(r.isInitialized()){const c=r.getImmediate(),f=r.getOptions();if(ky(f,t!=null?t:{}))return c;tc(c,"already-initialized")}return r.initialize({options:t})}function Lue(e,t){const r=(t==null?void 0:t.persistence)||[],s=(Array.isArray(r)?r:[r]).map(Uh);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(s,t==null?void 0:t.popupRedirectResolver)}function zue(e,t,r){const s=np(e);br(s._canInitEmulator,s,"emulator-config-failed"),br(/^https?:\/\//.test(t),s,"invalid-emulator-scheme");const c=!1,f=IG(t),{host:_,port:x}=Nue(t),a=x===null?"":`:${x}`;s.config.emulator={url:`${f}//${_}${a}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:_,port:x,protocol:f.replace(":",""),options:Object.freeze({disableWarnings:c})}),Fue()}function IG(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Nue(e){const t=IG(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};const s=r[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(s);if(c){const f=c[1];return{host:f,port:Hj(s.substr(f.length+1))}}else{const[f,_]=s.split(":");return{host:f,port:Hj(_)}}}function Hj(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function Fue(){function e(){const t=document.createElement("p"),r=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console!="undefined"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window!="undefined"&&typeof document!="undefined"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fO{constructor(t,r){this.providerId=t,this.signInMethod=r}toJSON(){return Bh("not implemented")}_getIdTokenResponse(t){return Bh("not implemented")}_linkToIdToken(t,r){return Bh("not implemented")}_getReauthenticationResolver(t){return Bh("not implemented")}}function Bue(e,t){return Be(this,null,function*(){return tp(e,"POST","/v1/accounts:signUp",t)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jue(e,t){return Be(this,null,function*(){return lb(e,"POST","/v1/accounts:signInWithPassword",ep(e,t))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uue(e,t){return Be(this,null,function*(){return lb(e,"POST","/v1/accounts:signInWithEmailLink",ep(e,t))})}function Vue(e,t){return Be(this,null,function*(){return lb(e,"POST","/v1/accounts:signInWithEmailLink",ep(e,t))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ex extends fO{constructor(t,r,s,c=null){super("password",s),this._email=t,this._password=r,this._tenantId=c}static _fromEmailAndPassword(t,r){return new Ex(t,r,"password")}static _fromEmailAndCode(t,r,s=null){return new Ex(t,r,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}_getIdTokenResponse(t){return Be(this,null,function*(){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bk(t,r,"signInWithPassword",jue);case"emailLink":return Uue(t,{email:this._email,oobCode:this._password});default:tc(t,"internal-error")}})}_linkToIdToken(t,r){return Be(this,null,function*(){switch(this.signInMethod){case"password":const s={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return bk(t,s,"signUpPassword",Bue);case"emailLink":return Vue(t,{idToken:r,email:this._email,oobCode:this._password});default:tc(t,"internal-error")}})}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fy(e,t){return Be(this,null,function*(){return lb(e,"POST","/v1/accounts:signInWithIdp",ep(e,t))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $ue="http://localhost";class $m extends fO{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const r=new $m(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(r.idToken=t.idToken),t.accessToken&&(r.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(r.nonce=t.nonce),t.pendingToken&&(r.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(r.accessToken=t.oauthToken,r.secret=t.oauthTokenSecret):tc("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const r=typeof t=="string"?JSON.parse(t):t,{providerId:s,signInMethod:c}=r,f=aO(r,["providerId","signInMethod"]);if(!s||!c)return null;const _=new $m(s,c);return _.idToken=f.idToken||void 0,_.accessToken=f.accessToken||void 0,_.secret=f.secret,_.nonce=f.nonce,_.pendingToken=f.pendingToken||null,_}_getIdTokenResponse(t){const r=this.buildRequest();return fy(t,r)}_linkToIdToken(t,r){const s=this.buildRequest();return s.idToken=r,fy(t,s)}_getReauthenticationResolver(t){const r=this.buildRequest();return r.autoCreate=!1,fy(t,r)}buildRequest(){const t={requestUri:$ue,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),t.postBody=ob(r)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function que(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Gue(e){const t=u1(h1(e)).link,r=t?u1(h1(t)).deep_link_id:null,s=u1(h1(e)).deep_link_id;return(s?u1(h1(s)).link:null)||s||r||t||e}class pO{constructor(t){var r,s,c,f,_,x;const a=u1(h1(t)),I=(r=a.apiKey)!==null&&r!==void 0?r:null,D=(s=a.oobCode)!==null&&s!==void 0?s:null,O=que((c=a.mode)!==null&&c!==void 0?c:null);br(I&&D&&O,"argument-error"),this.apiKey=I,this.operation=O,this.code=D,this.continueUrl=(f=a.continueUrl)!==null&&f!==void 0?f:null,this.languageCode=(_=a.languageCode)!==null&&_!==void 0?_:null,this.tenantId=(x=a.tenantId)!==null&&x!==void 0?x:null}static parseLink(t){const r=Gue(t);try{return new pO(r)}catch(s){return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i0{constructor(){this.providerId=i0.PROVIDER_ID}static credential(t,r){return Ex._fromEmailAndPassword(t,r)}static credentialWithLink(t,r){const s=pO.parseLink(r);return br(s,"argument-error"),Ex._fromEmailAndCode(t,s.code,s.tenantId)}}i0.PROVIDER_ID="password";i0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";i0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mO{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb extends mO{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df extends cb{constructor(){super("facebook.com")}static credential(t){return $m._fromParams({providerId:df.PROVIDER_ID,signInMethod:df.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return df.credentialFromTaggedObject(t)}static credentialFromError(t){return df.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return df.credential(t.oauthAccessToken)}catch(r){return null}}}df.FACEBOOK_SIGN_IN_METHOD="facebook.com";df.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou extends cb{constructor(){super("google.com"),this.addScope("profile")}static credential(t,r){return $m._fromParams({providerId:Ou.PROVIDER_ID,signInMethod:Ou.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:r})}static credentialFromResult(t){return Ou.credentialFromTaggedObject(t)}static credentialFromError(t){return Ou.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:r,oauthAccessToken:s}=t;if(!r&&!s)return null;try{return Ou.credential(r,s)}catch(c){return null}}}Ou.GOOGLE_SIGN_IN_METHOD="google.com";Ou.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ff extends cb{constructor(){super("github.com")}static credential(t){return $m._fromParams({providerId:ff.PROVIDER_ID,signInMethod:ff.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return ff.credentialFromTaggedObject(t)}static credentialFromError(t){return ff.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return ff.credential(t.oauthAccessToken)}catch(r){return null}}}ff.GITHUB_SIGN_IN_METHOD="github.com";ff.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf extends cb{constructor(){super("twitter.com")}static credential(t,r){return $m._fromParams({providerId:pf.PROVIDER_ID,signInMethod:pf.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:r})}static credentialFromResult(t){return pf.credentialFromTaggedObject(t)}static credentialFromError(t){return pf.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:r,oauthTokenSecret:s}=t;if(!r||!s)return null;try{return pf.credential(r,s)}catch(c){return null}}}pf.TWITTER_SIGN_IN_METHOD="twitter.com";pf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wue(e,t){return Be(this,null,function*(){return lb(e,"POST","/v1/accounts:signUp",ep(e,t))})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static _fromIdTokenResponse(t,r,s,c=!1){return Be(this,null,function*(){const f=yield jh._fromIdTokenResponse(t,s,c),_=Zj(s);return new qm({user:f,providerId:_,_tokenResponse:s,operationType:r})})}static _forOperation(t,r,s){return Be(this,null,function*(){yield t._updateTokensIfNecessary(s,!0);const c=Zj(s);return new qm({user:t,providerId:c,_tokenResponse:s,operationType:r})})}}function Zj(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kS extends Ku{constructor(t,r,s,c){var f;super(r.code,r.message),this.operationType=s,this.user=c,Object.setPrototypeOf(this,kS.prototype),this.customData={appName:t.name,tenantId:(f=t.tenantId)!==null&&f!==void 0?f:void 0,_serverResponse:r.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(t,r,s,c){return new kS(t,r,s,c)}}function CG(e,t,r,s){return(t==="reauthenticate"?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(f=>{throw f.code==="auth/multi-factor-auth-required"?kS._fromErrorAndOperation(e,f,t,s):f})}function Hue(e,t,r=!1){return Be(this,null,function*(){const s=yield Tx(e,t._linkToIdToken(e.auth,yield e.getIdToken()),r);return qm._forOperation(e,"link",s)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zue(e,t,r=!1){return Be(this,null,function*(){const{auth:s}=e;if(Bc(s.app))return Promise.reject($h(s));const c="reauthenticate";try{const f=yield Tx(e,CG(s,c,t,e),r);br(f.idToken,s,"internal-error");const _=hO(f.idToken);br(_,s,"internal-error");const{sub:x}=_;return br(e.uid===x,s,"user-mismatch"),qm._forOperation(e,c,f)}catch(f){throw(f==null?void 0:f.code)==="auth/user-not-found"&&tc(s,"user-mismatch"),f}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AG(e,t,r=!1){return Be(this,null,function*(){if(Bc(e.app))return Promise.reject($h(e));const s="signIn",c=yield CG(e,s,t),f=yield qm._fromIdTokenResponse(e,s,c);return r||(yield e._updateCurrentUser(f.user)),f})}function Xue(e,t){return Be(this,null,function*(){return AG(np(e),t)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PG(e){return Be(this,null,function*(){const t=np(e);t._getPasswordPolicyInternal()&&(yield t._updatePasswordPolicy())})}function Kue(e,t,r){return Be(this,null,function*(){if(Bc(e.app))return Promise.reject($h(e));const s=np(e),_=yield bk(s,{returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Wue).catch(a=>{throw a.code==="auth/password-does-not-meet-requirements"&&PG(e),a}),x=yield qm._fromIdTokenResponse(s,"signIn",_);return yield s._updateCurrentUser(x.user),x})}function Que(e,t,r){return Bc(e.app)?Promise.reject($h(e)):Xue(js(e),i0.credential(t,r)).catch(s=>Be(this,null,function*(){throw s.code==="auth/password-does-not-meet-requirements"&&PG(e),s}))}function Yue(e,t,r,s){return js(e).onIdTokenChanged(t,r,s)}function Jue(e,t,r){return js(e).beforeAuthStateChanged(t,r)}const DS="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RG{constructor(t,r){this.storageRetriever=t,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(DS,"1"),this.storage.removeItem(DS),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,r){return this.storage.setItem(t,JSON.stringify(r)),Promise.resolve()}_get(t){const r=this.storage.getItem(t);return Promise.resolve(r?JSON.parse(r):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ehe=1e3,the=10;class py extends RG{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,r)=>this.onStorageEvent(t,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=TG(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const r of Object.keys(this.listeners)){const s=this.storage.getItem(r),c=this.localCache[r];s!==c&&t(r,c,s)}}onStorageEvent(t,r=!1){if(!t.key){this.forAllChangedKeys((_,x,a)=>{this.notifyListeners(_,a)});return}const s=t.key;r?this.detachListener():this.stopPolling();const c=()=>{const _=this.storage.getItem(s);!r&&this.localCache[s]===_||this.notifyListeners(s,_)},f=this.storage.getItem(s);bue()&&f!==t.newValue&&t.newValue!==t.oldValue?setTimeout(c,the):c()}notifyListeners(t,r){this.localCache[t]=r;const s=this.listeners[t];if(s)for(const c of Array.from(s))c(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,r,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:r,newValue:s}),!0)})},ehe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}_set(t,r){return Be(this,null,function*(){yield nm(py.prototype,this,"_set").call(this,t,r),this.localCache[t]=JSON.stringify(r)})}_get(t){return Be(this,null,function*(){const r=yield nm(py.prototype,this,"_get").call(this,t);return this.localCache[t]=JSON.stringify(r),r})}_remove(t){return Be(this,null,function*(){yield nm(py.prototype,this,"_remove").call(this,t),delete this.localCache[t]})}}py.type="LOCAL";const nhe=py;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MG extends RG{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,r){}_removeListener(t,r){}}MG.type="SESSION";const kG=MG;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rhe(e){return Promise.all(e.map(t=>Be(this,null,function*(){try{return{fulfilled:!0,value:yield t}}catch(r){return{fulfilled:!1,reason:r}}})))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lC{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const r=this.receivers.find(c=>c.isListeningto(t));if(r)return r;const s=new lC(t);return this.receivers.push(s),s}isListeningto(t){return this.eventTarget===t}handleEvent(t){return Be(this,null,function*(){const r=t,{eventId:s,eventType:c,data:f}=r.data,_=this.handlersMap[c];if(!(_!=null&&_.size))return;r.ports[0].postMessage({status:"ack",eventId:s,eventType:c});const x=Array.from(_).map(I=>Be(this,null,function*(){return I(r.origin,f)})),a=yield rhe(x);r.ports[0].postMessage({status:"done",eventId:s,eventType:c,response:a})})}_subscribe(t,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(r)}_unsubscribe(t,r){this.handlersMap[t]&&r&&this.handlersMap[t].delete(r),(!r||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}lC.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gO(e="",t=10){let r="";for(let s=0;s<t;s++)r+=Math.floor(Math.random()*10);return e+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ihe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}_send(t,r,s=50){return Be(this,null,function*(){const c=typeof MessageChannel!="undefined"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let f,_;return new Promise((x,a)=>{const I=gO("",20);c.port1.start();const D=setTimeout(()=>{a(new Error("unsupported_event"))},s);_={messageChannel:c,onMessage(O){const F=O;if(F.data.eventId===I)switch(F.data.status){case"ack":clearTimeout(D),f=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(f),x(F.data.response);break;default:clearTimeout(D),clearTimeout(f),a(new Error("invalid_response"));break}}},this.handlers.add(_),c.port1.addEventListener("message",_.onMessage),this.target.postMessage({eventType:t,eventId:I,data:r},[c.port2])}).finally(()=>{_&&this.removeMessageHandler(_)})})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uu(){return window}function she(e){Uu().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DG(){return typeof Uu().WorkerGlobalScope!="undefined"&&typeof Uu().importScripts=="function"}function ohe(){return Be(this,null,function*(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(e){return null}})}function ahe(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function lhe(){return DG()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OG="firebaseLocalStorageDb",che=1,OS="firebaseLocalStorage",LG="fbase_key";class ub{constructor(t){this.request=t}toPromise(){return new Promise((t,r)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function cC(e,t){return e.transaction([OS],t?"readwrite":"readonly").objectStore(OS)}function uhe(){const e=indexedDB.deleteDatabase(OG);return new ub(e).toPromise()}function wk(){const e=indexedDB.open(OG,che);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{const s=e.result;try{s.createObjectStore(OS,{keyPath:LG})}catch(c){r(c)}}),e.addEventListener("success",()=>Be(this,null,function*(){const s=e.result;s.objectStoreNames.contains(OS)?t(s):(s.close(),yield uhe(),t(yield wk()))}))})}function Xj(e,t,r){return Be(this,null,function*(){const s=cC(e,!0).put({[LG]:t,value:r});return new ub(s).toPromise()})}function hhe(e,t){return Be(this,null,function*(){const r=cC(e,!1).get(t),s=yield new ub(r).toPromise();return s===void 0?null:s.value})}function Kj(e,t){const r=cC(e,!0).delete(t);return new ub(r).toPromise()}const dhe=800,fhe=3;class zG{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return Be(this,null,function*(){return this.db?this.db:(this.db=yield wk(),this.db)})}_withRetries(t){return Be(this,null,function*(){let r=0;for(;;)try{const s=yield this._openDb();return yield t(s)}catch(s){if(r++>fhe)throw s;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return Be(this,null,function*(){return DG()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return Be(this,null,function*(){this.receiver=lC._getInstance(lhe()),this.receiver._subscribe("keyChanged",(t,r)=>Be(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(r.key)}})),this.receiver._subscribe("ping",(t,r)=>Be(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return Be(this,null,function*(){var t,r;if(this.activeServiceWorker=yield ohe(),!this.activeServiceWorker)return;this.sender=new ihe(this.activeServiceWorker);const s=yield this.sender._send("ping",{},800);s&&!((t=s[0])===null||t===void 0)&&t.fulfilled&&!((r=s[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(t){return Be(this,null,function*(){if(!(!this.sender||!this.activeServiceWorker||ahe()!==this.activeServiceWorker))try{yield this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(r){}})}_isAvailable(){return Be(this,null,function*(){try{if(!indexedDB)return!1;const t=yield wk();return yield Xj(t,DS,"1"),yield Kj(t,DS),!0}catch(t){}return!1})}_withPendingWrite(t){return Be(this,null,function*(){this.pendingWrites++;try{yield t()}finally{this.pendingWrites--}})}_set(t,r){return Be(this,null,function*(){return this._withPendingWrite(()=>Be(this,null,function*(){return yield this._withRetries(s=>Xj(s,t,r)),this.localCache[t]=r,this.notifyServiceWorker(t)}))})}_get(t){return Be(this,null,function*(){const r=yield this._withRetries(s=>hhe(s,t));return this.localCache[t]=r,r})}_remove(t){return Be(this,null,function*(){return this._withPendingWrite(()=>Be(this,null,function*(){return yield this._withRetries(r=>Kj(r,t)),delete this.localCache[t],this.notifyServiceWorker(t)}))})}_poll(){return Be(this,null,function*(){const t=yield this._withRetries(c=>{const f=cC(c,!1).getAll();return new ub(f).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const r=[],s=new Set;if(t.length!==0)for(const{fbase_key:c,value:f}of t)s.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(f)&&(this.notifyListeners(c,f),r.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!s.has(c)&&(this.notifyListeners(c,null),r.push(c));return r})}notifyListeners(t,r){this.localCache[t]=r;const s=this.listeners[t];if(s)for(const c of Array.from(s))c(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>Be(this,null,function*(){return this._poll()}),dhe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(r)}_removeListener(t,r){this.listeners[t]&&(this.listeners[t].delete(r),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}zG.type="LOCAL";const phe=zG;new ab(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NG(e,t){return t?Uh(t):(br(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _O extends fO{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return fy(t,this._buildIdpRequest())}_linkToIdToken(t,r){return fy(t,this._buildIdpRequest(r))}_getReauthenticationResolver(t){return fy(t,this._buildIdpRequest())}_buildIdpRequest(t){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(r.idToken=t),r}}function mhe(e){return AG(e.auth,new _O(e),e.bypassAuthState)}function ghe(e){const{auth:t,user:r}=e;return br(r,t,"internal-error"),Zue(r,new _O(e),e.bypassAuthState)}function _he(e){return Be(this,null,function*(){const{auth:t,user:r}=e;return br(r,t,"internal-error"),Hue(r,new _O(e),e.bypassAuthState)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FG{constructor(t,r,s,c,f=!1){this.auth=t,this.resolver=s,this.user=c,this.bypassAuthState=f,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise((t,r)=>Be(this,null,function*(){this.pendingPromise={resolve:t,reject:r};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}}))}onAuthEvent(t){return Be(this,null,function*(){const{urlResponse:r,sessionId:s,postBody:c,tenantId:f,error:_,type:x}=t;if(_){this.reject(_);return}const a={auth:this.auth,requestUri:r,sessionId:s,tenantId:f||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(x)(a))}catch(I){this.reject(I)}})}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return mhe;case"linkViaPopup":case"linkViaRedirect":return _he;case"reauthViaPopup":case"reauthViaRedirect":return ghe;default:tc(this.auth,"internal-error")}}resolve(t){Yh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Yh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yhe=new ab(2e3,1e4);function BG(e,t,r){return Be(this,null,function*(){if(Bc(e.app))return Promise.reject(qc(e,"operation-not-supported-in-this-environment"));const s=np(e);nue(e,t,mO);const c=NG(s,r);return new xm(s,"signInViaPopup",t,c).executeNotNull()})}class xm extends FG{constructor(t,r,s,c,f){super(t,r,c,f),this.provider=s,this.authWindow=null,this.pollId=null,xm.currentPopupAction&&xm.currentPopupAction.cancel(),xm.currentPopupAction=this}executeNotNull(){return Be(this,null,function*(){const t=yield this.execute();return br(t,this.auth,"internal-error"),t})}onExecution(){return Be(this,null,function*(){Yh(this.filter.length===1,"Popup operations only handle one event");const t=gO();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(qc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(qc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xm.currentPopupAction=null}pollUserCancellation(){const t=()=>{var r,s;if(!((s=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(qc(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,yhe.get())};t()}}xm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vhe="pendingRedirect",PE=new Map;class N1 extends FG{constructor(t,r,s=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,s),this.eventId=null}execute(){return Be(this,null,function*(){let t=PE.get(this.auth._key());if(!t){try{const s=(yield xhe(this.resolver,this.auth))?yield nm(N1.prototype,this,"execute").call(this):null;t=()=>Promise.resolve(s)}catch(r){t=()=>Promise.reject(r)}PE.set(this.auth._key(),t)}return this.bypassAuthState||PE.set(this.auth._key(),()=>Promise.resolve(null)),t()})}onAuthEvent(t){return Be(this,null,function*(){if(t.type==="signInViaRedirect")return nm(N1.prototype,this,"onAuthEvent").call(this,t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const r=yield this.auth._redirectUserForId(t.eventId);if(r)return this.user=r,nm(N1.prototype,this,"onAuthEvent").call(this,t);this.resolve(null)}})}onExecution(){return Be(this,null,function*(){})}cleanUp(){}}function xhe(e,t){return Be(this,null,function*(){const r=The(t),s=whe(e);if(!(yield s._isAvailable()))return!1;const c=(yield s._get(r))==="true";return yield s._remove(r),c})}function bhe(e,t){PE.set(e._key(),t)}function whe(e){return Uh(e._redirectPersistence)}function The(e){return AE(vhe,e.config.apiKey,e.name)}function Ehe(e,t,r=!1){return Be(this,null,function*(){if(Bc(e.app))return Promise.reject($h(e));const s=np(e),c=NG(s,t),_=yield new N1(s,c,r).execute();return _&&!r&&(delete _.user._redirectEventId,yield s._persistUserIfCurrent(_.user),yield s._setRedirectUser(null,t)),_})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const She=10*60*1e3;class Ihe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let r=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(t,s)&&(r=!0,this.sendToConsumer(t,s),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!Che(t)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=t,r=!0)),r}sendToConsumer(t,r){var s;if(t.error&&!jG(t)){const c=((s=t.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";r.onError(qc(this.auth,c))}else r.onAuthEvent(t)}isEventForConsumer(t,r){const s=r.eventId===null||!!t.eventId&&t.eventId===r.eventId;return r.filter.includes(t.type)&&s}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=She&&this.cachedEventUids.clear(),this.cachedEventUids.has(Qj(t))}saveEventToCache(t){this.cachedEventUids.add(Qj(t)),this.lastProcessedEventTime=Date.now()}}function Qj(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function jG({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function Che(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return jG(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ahe(r){return Be(this,arguments,function*(e,t={}){return tp(e,"GET","/v1/projects",t)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Phe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Rhe=/^https?/;function Mhe(e){return Be(this,null,function*(){if(e.config.emulator)return;const{authorizedDomains:t}=yield Ahe(e);for(const r of t)try{if(khe(r))return}catch(s){}tc(e,"unauthorized-domain")})}function khe(e){const t=vk(),{protocol:r,hostname:s}=new URL(t);if(e.startsWith("chrome-extension://")){const _=new URL(e);return _.hostname===""&&s===""?r==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):r==="chrome-extension:"&&_.hostname===s}if(!Rhe.test(r))return!1;if(Phe.test(e))return s===e;const c=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dhe=new ab(3e4,6e4);function Yj(){const e=Uu().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let r=0;r<e.CP.length;r++)e.CP[r]=null}}function Ohe(e){return new Promise((t,r)=>{var s,c,f;function _(){Yj(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Yj(),r(qc(e,"network-request-failed"))},timeout:Dhe.get()})}if(!((c=(s=Uu().gapi)===null||s===void 0?void 0:s.iframes)===null||c===void 0)&&c.Iframe)t(gapi.iframes.getContext());else if(!((f=Uu().gapi)===null||f===void 0)&&f.load)_();else{const x=Rue("iframefcb");return Uu()[x]=()=>{gapi.load?_():r(qc(e,"network-request-failed"))},SG(`${Pue()}?onload=${x}`).catch(a=>r(a))}}).catch(t=>{throw RE=null,t})}let RE=null;function Lhe(e){return RE=RE||Ohe(e),RE}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zhe=new ab(5e3,15e3),Nhe="__/auth/iframe",Fhe="emulator/auth/iframe",Bhe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},jhe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Uhe(e){const t=e.config;br(t.authDomain,e,"auth-domain-config-required");const r=t.emulator?uO(t,Fhe):`https://${e.config.authDomain}/${Nhe}`,s={apiKey:t.apiKey,appName:e.name,v:ug},c=jhe.get(e.config.apiHost);c&&(s.eid=c);const f=e._getFrameworks();return f.length&&(s.fw=f.join(",")),`${r}?${ob(s).slice(1)}`}function Vhe(e){return Be(this,null,function*(){const t=yield Lhe(e),r=Uu().gapi;return br(r,e,"internal-error"),t.open({where:document.body,url:Uhe(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Bhe,dontclear:!0},s=>new Promise((c,f)=>Be(this,null,function*(){yield s.restyle({setHideOnLeave:!1});const _=qc(e,"network-request-failed"),x=Uu().setTimeout(()=>{f(_)},zhe.get());function a(){Uu().clearTimeout(x),c(s)}s.ping(a).then(a,()=>{f(_)})})))})}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $he={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},qhe=500,Ghe=600,Whe="_blank",Hhe="http://localhost";class Jj{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}function Zhe(e,t,r,s=qhe,c=Ghe){const f=Math.max((window.screen.availHeight-c)/2,0).toString(),_=Math.max((window.screen.availWidth-s)/2,0).toString();let x="";const a=Object.assign(Object.assign({},$he),{width:s.toString(),height:c.toString(),top:f,left:_}),I=ia().toLowerCase();r&&(x=yG(I)?Whe:r),gG(I)&&(t=t||Hhe,a.scrollbars="yes");const D=Object.entries(a).reduce((F,[H,Q])=>`${F}${H}=${Q},`,"");if(xue(I)&&x!=="_self")return Xhe(t||"",x),new Jj(null);const O=window.open(t||"",x,D);br(O,e,"popup-blocked");try{O.focus()}catch(F){}return new Jj(O)}function Xhe(e,t){const r=document.createElement("a");r.href=e,r.target=t;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Khe="__/auth/handler",Qhe="emulator/auth/handler",Yhe=encodeURIComponent("fac");function eU(e,t,r,s,c,f){return Be(this,null,function*(){br(e.config.authDomain,e,"auth-domain-config-required"),br(e.config.apiKey,e,"invalid-api-key");const _={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:s,v:ug,eventId:c};if(t instanceof mO){t.setDefaultLanguage(e.languageCode),_.providerId=t.providerId||"",Vle(t.getCustomParameters())||(_.customParameters=JSON.stringify(t.getCustomParameters()));for(const[D,O]of Object.entries({}))_[D]=O}if(t instanceof cb){const D=t.getScopes().filter(O=>O!=="");D.length>0&&(_.scopes=D.join(","))}e.tenantId&&(_.tid=e.tenantId);const x=_;for(const D of Object.keys(x))x[D]===void 0&&delete x[D];const a=yield e._getAppCheckToken(),I=a?`#${Yhe}=${encodeURIComponent(a)}`:"";return`${Jhe(e)}?${ob(x).slice(1)}${I}`})}function Jhe({config:e}){return e.emulator?uO(e,Qhe):`https://${e.authDomain}/${Khe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TR="webStorageSupport";class ede{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=kG,this._completeRedirectFn=Ehe,this._overrideRedirectResult=bhe}_openPopup(t,r,s,c){return Be(this,null,function*(){var f;Yh((f=this.eventManagers[t._key()])===null||f===void 0?void 0:f.manager,"_initialize() not called before _openPopup()");const _=yield eU(t,r,s,vk(),c);return Zhe(t,_,gO())})}_openRedirect(t,r,s,c){return Be(this,null,function*(){yield this._originValidation(t);const f=yield eU(t,r,s,vk(),c);return she(f),new Promise(()=>{})})}_initialize(t){const r=t._key();if(this.eventManagers[r]){const{manager:c,promise:f}=this.eventManagers[r];return c?Promise.resolve(c):(Yh(f,"If manager is not set, promise should be"),f)}const s=this.initAndGetManager(t);return this.eventManagers[r]={promise:s},s.catch(()=>{delete this.eventManagers[r]}),s}initAndGetManager(t){return Be(this,null,function*(){const r=yield Vhe(t),s=new Ihe(t);return r.register("authEvent",c=>(br(c==null?void 0:c.authEvent,t,"invalid-auth-event"),{status:s.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:s},this.iframes[t._key()]=r,s})}_isIframeWebStorageSupported(t,r){this.iframes[t._key()].send(TR,{type:TR},c=>{var f;const _=(f=c==null?void 0:c[0])===null||f===void 0?void 0:f[TR];_!==void 0&&r(!!_),tc(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const r=t._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=Mhe(t)),this.originValidationPromises[r]}get _shouldInitProactively(){return TG()||_G()||dO()}}const tde=ede;var tU="@firebase/auth",nU="1.7.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nde{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}getToken(t){return Be(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(t)}:null})}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const r=this.auth.onIdTokenChanged(s=>{t((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,r),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const r=this.internalListeners.get(t);r&&(this.internalListeners.delete(t),r(),this.updateProactiveRefresh())}assertAuthConfigured(){br(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rde(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ide(e){Vm(new jf("auth",(t,{options:r})=>{const s=t.getProvider("app").getImmediate(),c=t.getProvider("heartbeat"),f=t.getProvider("app-check-internal"),{apiKey:_,authDomain:x}=s.options;br(_&&!_.includes(":"),"invalid-api-key",{appName:s.name});const a={apiKey:_,authDomain:x,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:EG(e)},I=new Iue(s,c,f,a);return Lue(I,r),I},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,r,s)=>{t.getProvider("auth-internal").initialize()})),Vm(new jf("auth-internal",t=>{const r=np(t.getProvider("auth").getImmediate());return(s=>new nde(s))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),ju(tU,nU,rde(e)),ju(tU,nU,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sde=5*60,ode=tG("authIdTokenMaxAge")||sde;let rU=null;const ade=e=>t=>Be(xn,null,function*(){const r=t&&(yield t.getIdTokenResult()),s=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(s&&s>ode)return;const c=r==null?void 0:r.token;rU!==c&&(rU=c,yield fetch(e,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))});function lde(e=oO()){const t=oC(e,"auth");if(t.isInitialized())return t.getImmediate();const r=Oue(e,{popupRedirectResolver:tde,persistence:[phe,nhe,kG]}),s=tG("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const f=new URL(s,location.origin);if(location.origin===f.origin){const _=ade(f.toString());Jue(r,_,()=>_(r.currentUser)),Yue(r,x=>_(x))}}const c=Yq("auth");return c&&zue(r,`http://${c}`),r}function cde(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}Cue({loadJS(e){return new Promise((t,r)=>{const s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=c=>{const f=qc("internal-error");f.customData=c,r(f)},s.type="text/javascript",s.charset="UTF-8",cde().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});ide("Browser");var iU=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pm,UG;(function(){var e;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(re,he){function _e(){}_e.prototype=he.prototype,re.D=he.prototype,re.prototype=new _e,re.prototype.constructor=re,re.C=function(Se,J,Ie){for(var we=Array(arguments.length-2),Lt=2;Lt<arguments.length;Lt++)we[Lt-2]=arguments[Lt];return he.prototype[J].apply(Se,we)}}function r(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(s,r),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(re,he,_e){_e||(_e=0);var Se=Array(16);if(typeof he=="string")for(var J=0;16>J;++J)Se[J]=he.charCodeAt(_e++)|he.charCodeAt(_e++)<<8|he.charCodeAt(_e++)<<16|he.charCodeAt(_e++)<<24;else for(J=0;16>J;++J)Se[J]=he[_e++]|he[_e++]<<8|he[_e++]<<16|he[_e++]<<24;he=re.g[0],_e=re.g[1],J=re.g[2];var Ie=re.g[3],we=he+(Ie^_e&(J^Ie))+Se[0]+3614090360&4294967295;he=_e+(we<<7&4294967295|we>>>25),we=Ie+(J^he&(_e^J))+Se[1]+3905402710&4294967295,Ie=he+(we<<12&4294967295|we>>>20),we=J+(_e^Ie&(he^_e))+Se[2]+606105819&4294967295,J=Ie+(we<<17&4294967295|we>>>15),we=_e+(he^J&(Ie^he))+Se[3]+3250441966&4294967295,_e=J+(we<<22&4294967295|we>>>10),we=he+(Ie^_e&(J^Ie))+Se[4]+4118548399&4294967295,he=_e+(we<<7&4294967295|we>>>25),we=Ie+(J^he&(_e^J))+Se[5]+1200080426&4294967295,Ie=he+(we<<12&4294967295|we>>>20),we=J+(_e^Ie&(he^_e))+Se[6]+2821735955&4294967295,J=Ie+(we<<17&4294967295|we>>>15),we=_e+(he^J&(Ie^he))+Se[7]+4249261313&4294967295,_e=J+(we<<22&4294967295|we>>>10),we=he+(Ie^_e&(J^Ie))+Se[8]+1770035416&4294967295,he=_e+(we<<7&4294967295|we>>>25),we=Ie+(J^he&(_e^J))+Se[9]+2336552879&4294967295,Ie=he+(we<<12&4294967295|we>>>20),we=J+(_e^Ie&(he^_e))+Se[10]+4294925233&4294967295,J=Ie+(we<<17&4294967295|we>>>15),we=_e+(he^J&(Ie^he))+Se[11]+2304563134&4294967295,_e=J+(we<<22&4294967295|we>>>10),we=he+(Ie^_e&(J^Ie))+Se[12]+1804603682&4294967295,he=_e+(we<<7&4294967295|we>>>25),we=Ie+(J^he&(_e^J))+Se[13]+4254626195&4294967295,Ie=he+(we<<12&4294967295|we>>>20),we=J+(_e^Ie&(he^_e))+Se[14]+2792965006&4294967295,J=Ie+(we<<17&4294967295|we>>>15),we=_e+(he^J&(Ie^he))+Se[15]+1236535329&4294967295,_e=J+(we<<22&4294967295|we>>>10),we=he+(J^Ie&(_e^J))+Se[1]+4129170786&4294967295,he=_e+(we<<5&4294967295|we>>>27),we=Ie+(_e^J&(he^_e))+Se[6]+3225465664&4294967295,Ie=he+(we<<9&4294967295|we>>>23),we=J+(he^_e&(Ie^he))+Se[11]+643717713&4294967295,J=Ie+(we<<14&4294967295|we>>>18),we=_e+(Ie^he&(J^Ie))+Se[0]+3921069994&4294967295,_e=J+(we<<20&4294967295|we>>>12),we=he+(J^Ie&(_e^J))+Se[5]+3593408605&4294967295,he=_e+(we<<5&4294967295|we>>>27),we=Ie+(_e^J&(he^_e))+Se[10]+38016083&4294967295,Ie=he+(we<<9&4294967295|we>>>23),we=J+(he^_e&(Ie^he))+Se[15]+3634488961&4294967295,J=Ie+(we<<14&4294967295|we>>>18),we=_e+(Ie^he&(J^Ie))+Se[4]+3889429448&4294967295,_e=J+(we<<20&4294967295|we>>>12),we=he+(J^Ie&(_e^J))+Se[9]+568446438&4294967295,he=_e+(we<<5&4294967295|we>>>27),we=Ie+(_e^J&(he^_e))+Se[14]+3275163606&4294967295,Ie=he+(we<<9&4294967295|we>>>23),we=J+(he^_e&(Ie^he))+Se[3]+4107603335&4294967295,J=Ie+(we<<14&4294967295|we>>>18),we=_e+(Ie^he&(J^Ie))+Se[8]+1163531501&4294967295,_e=J+(we<<20&4294967295|we>>>12),we=he+(J^Ie&(_e^J))+Se[13]+2850285829&4294967295,he=_e+(we<<5&4294967295|we>>>27),we=Ie+(_e^J&(he^_e))+Se[2]+4243563512&4294967295,Ie=he+(we<<9&4294967295|we>>>23),we=J+(he^_e&(Ie^he))+Se[7]+1735328473&4294967295,J=Ie+(we<<14&4294967295|we>>>18),we=_e+(Ie^he&(J^Ie))+Se[12]+2368359562&4294967295,_e=J+(we<<20&4294967295|we>>>12),we=he+(_e^J^Ie)+Se[5]+4294588738&4294967295,he=_e+(we<<4&4294967295|we>>>28),we=Ie+(he^_e^J)+Se[8]+2272392833&4294967295,Ie=he+(we<<11&4294967295|we>>>21),we=J+(Ie^he^_e)+Se[11]+1839030562&4294967295,J=Ie+(we<<16&4294967295|we>>>16),we=_e+(J^Ie^he)+Se[14]+4259657740&4294967295,_e=J+(we<<23&4294967295|we>>>9),we=he+(_e^J^Ie)+Se[1]+2763975236&4294967295,he=_e+(we<<4&4294967295|we>>>28),we=Ie+(he^_e^J)+Se[4]+1272893353&4294967295,Ie=he+(we<<11&4294967295|we>>>21),we=J+(Ie^he^_e)+Se[7]+4139469664&4294967295,J=Ie+(we<<16&4294967295|we>>>16),we=_e+(J^Ie^he)+Se[10]+3200236656&4294967295,_e=J+(we<<23&4294967295|we>>>9),we=he+(_e^J^Ie)+Se[13]+681279174&4294967295,he=_e+(we<<4&4294967295|we>>>28),we=Ie+(he^_e^J)+Se[0]+3936430074&4294967295,Ie=he+(we<<11&4294967295|we>>>21),we=J+(Ie^he^_e)+Se[3]+3572445317&4294967295,J=Ie+(we<<16&4294967295|we>>>16),we=_e+(J^Ie^he)+Se[6]+76029189&4294967295,_e=J+(we<<23&4294967295|we>>>9),we=he+(_e^J^Ie)+Se[9]+3654602809&4294967295,he=_e+(we<<4&4294967295|we>>>28),we=Ie+(he^_e^J)+Se[12]+3873151461&4294967295,Ie=he+(we<<11&4294967295|we>>>21),we=J+(Ie^he^_e)+Se[15]+530742520&4294967295,J=Ie+(we<<16&4294967295|we>>>16),we=_e+(J^Ie^he)+Se[2]+3299628645&4294967295,_e=J+(we<<23&4294967295|we>>>9),we=he+(J^(_e|~Ie))+Se[0]+4096336452&4294967295,he=_e+(we<<6&4294967295|we>>>26),we=Ie+(_e^(he|~J))+Se[7]+1126891415&4294967295,Ie=he+(we<<10&4294967295|we>>>22),we=J+(he^(Ie|~_e))+Se[14]+2878612391&4294967295,J=Ie+(we<<15&4294967295|we>>>17),we=_e+(Ie^(J|~he))+Se[5]+4237533241&4294967295,_e=J+(we<<21&4294967295|we>>>11),we=he+(J^(_e|~Ie))+Se[12]+1700485571&4294967295,he=_e+(we<<6&4294967295|we>>>26),we=Ie+(_e^(he|~J))+Se[3]+2399980690&4294967295,Ie=he+(we<<10&4294967295|we>>>22),we=J+(he^(Ie|~_e))+Se[10]+4293915773&4294967295,J=Ie+(we<<15&4294967295|we>>>17),we=_e+(Ie^(J|~he))+Se[1]+2240044497&4294967295,_e=J+(we<<21&4294967295|we>>>11),we=he+(J^(_e|~Ie))+Se[8]+1873313359&4294967295,he=_e+(we<<6&4294967295|we>>>26),we=Ie+(_e^(he|~J))+Se[15]+4264355552&4294967295,Ie=he+(we<<10&4294967295|we>>>22),we=J+(he^(Ie|~_e))+Se[6]+2734768916&4294967295,J=Ie+(we<<15&4294967295|we>>>17),we=_e+(Ie^(J|~he))+Se[13]+1309151649&4294967295,_e=J+(we<<21&4294967295|we>>>11),we=he+(J^(_e|~Ie))+Se[4]+4149444226&4294967295,he=_e+(we<<6&4294967295|we>>>26),we=Ie+(_e^(he|~J))+Se[11]+3174756917&4294967295,Ie=he+(we<<10&4294967295|we>>>22),we=J+(he^(Ie|~_e))+Se[2]+718787259&4294967295,J=Ie+(we<<15&4294967295|we>>>17),we=_e+(Ie^(J|~he))+Se[9]+3951481745&4294967295,re.g[0]=re.g[0]+he&4294967295,re.g[1]=re.g[1]+(J+(we<<21&4294967295|we>>>11))&4294967295,re.g[2]=re.g[2]+J&4294967295,re.g[3]=re.g[3]+Ie&4294967295}s.prototype.u=function(re,he){he===void 0&&(he=re.length);for(var _e=he-this.blockSize,Se=this.B,J=this.h,Ie=0;Ie<he;){if(J==0)for(;Ie<=_e;)c(this,re,Ie),Ie+=this.blockSize;if(typeof re=="string"){for(;Ie<he;)if(Se[J++]=re.charCodeAt(Ie++),J==this.blockSize){c(this,Se),J=0;break}}else for(;Ie<he;)if(Se[J++]=re[Ie++],J==this.blockSize){c(this,Se),J=0;break}}this.h=J,this.o+=he},s.prototype.v=function(){var re=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);re[0]=128;for(var he=1;he<re.length-8;++he)re[he]=0;var _e=8*this.o;for(he=re.length-8;he<re.length;++he)re[he]=_e&255,_e/=256;for(this.u(re),re=Array(16),he=_e=0;4>he;++he)for(var Se=0;32>Se;Se+=8)re[_e++]=this.g[he]>>>Se&255;return re};function f(re,he){var _e=x;return Object.prototype.hasOwnProperty.call(_e,re)?_e[re]:_e[re]=he(re)}function _(re,he){this.h=he;for(var _e=[],Se=!0,J=re.length-1;0<=J;J--){var Ie=re[J]|0;Se&&Ie==he||(_e[J]=Ie,Se=!1)}this.g=_e}var x={};function a(re){return-128<=re&&128>re?f(re,function(he){return new _([he|0],0>he?-1:0)}):new _([re|0],0>re?-1:0)}function I(re){if(isNaN(re)||!isFinite(re))return O;if(0>re)return te(I(-re));for(var he=[],_e=1,Se=0;re>=_e;Se++)he[Se]=re/_e|0,_e*=4294967296;return new _(he,0)}function D(re,he){if(re.length==0)throw Error("number format error: empty string");if(he=he||10,2>he||36<he)throw Error("radix out of range: "+he);if(re.charAt(0)=="-")return te(D(re.substring(1),he));if(0<=re.indexOf("-"))throw Error('number format error: interior "-" character');for(var _e=I(Math.pow(he,8)),Se=O,J=0;J<re.length;J+=8){var Ie=Math.min(8,re.length-J),we=parseInt(re.substring(J,J+Ie),he);8>Ie?(Ie=I(Math.pow(he,Ie)),Se=Se.j(Ie).add(I(we))):(Se=Se.j(_e),Se=Se.add(I(we)))}return Se}var O=a(0),F=a(1),H=a(16777216);e=_.prototype,e.m=function(){if(ie(this))return-te(this).m();for(var re=0,he=1,_e=0;_e<this.g.length;_e++){var Se=this.i(_e);re+=(0<=Se?Se:4294967296+Se)*he,he*=4294967296}return re},e.toString=function(re){if(re=re||10,2>re||36<re)throw Error("radix out of range: "+re);if(Q(this))return"0";if(ie(this))return"-"+te(this).toString(re);for(var he=I(Math.pow(re,6)),_e=this,Se="";;){var J=fe(_e,he).g;_e=W(_e,J.j(he));var Ie=((0<_e.g.length?_e.g[0]:_e.h)>>>0).toString(re);if(_e=J,Q(_e))return Ie+Se;for(;6>Ie.length;)Ie="0"+Ie;Se=Ie+Se}},e.i=function(re){return 0>re?0:re<this.g.length?this.g[re]:this.h};function Q(re){if(re.h!=0)return!1;for(var he=0;he<re.g.length;he++)if(re.g[he]!=0)return!1;return!0}function ie(re){return re.h==-1}e.l=function(re){return re=W(this,re),ie(re)?-1:Q(re)?0:1};function te(re){for(var he=re.g.length,_e=[],Se=0;Se<he;Se++)_e[Se]=~re.g[Se];return new _(_e,~re.h).add(F)}e.abs=function(){return ie(this)?te(this):this},e.add=function(re){for(var he=Math.max(this.g.length,re.g.length),_e=[],Se=0,J=0;J<=he;J++){var Ie=Se+(this.i(J)&65535)+(re.i(J)&65535),we=(Ie>>>16)+(this.i(J)>>>16)+(re.i(J)>>>16);Se=we>>>16,Ie&=65535,we&=65535,_e[J]=we<<16|Ie}return new _(_e,_e[_e.length-1]&-2147483648?-1:0)};function W(re,he){return re.add(te(he))}e.j=function(re){if(Q(this)||Q(re))return O;if(ie(this))return ie(re)?te(this).j(te(re)):te(te(this).j(re));if(ie(re))return te(this.j(te(re)));if(0>this.l(H)&&0>re.l(H))return I(this.m()*re.m());for(var he=this.g.length+re.g.length,_e=[],Se=0;Se<2*he;Se++)_e[Se]=0;for(Se=0;Se<this.g.length;Se++)for(var J=0;J<re.g.length;J++){var Ie=this.i(Se)>>>16,we=this.i(Se)&65535,Lt=re.i(J)>>>16,Gt=re.i(J)&65535;_e[2*Se+2*J]+=we*Gt,X(_e,2*Se+2*J),_e[2*Se+2*J+1]+=Ie*Gt,X(_e,2*Se+2*J+1),_e[2*Se+2*J+1]+=we*Lt,X(_e,2*Se+2*J+1),_e[2*Se+2*J+2]+=Ie*Lt,X(_e,2*Se+2*J+2)}for(Se=0;Se<he;Se++)_e[Se]=_e[2*Se+1]<<16|_e[2*Se];for(Se=he;Se<2*he;Se++)_e[Se]=0;return new _(_e,0)};function X(re,he){for(;(re[he]&65535)!=re[he];)re[he+1]+=re[he]>>>16,re[he]&=65535,he++}function ee(re,he){this.g=re,this.h=he}function fe(re,he){if(Q(he))throw Error("division by zero");if(Q(re))return new ee(O,O);if(ie(re))return he=fe(te(re),he),new ee(te(he.g),te(he.h));if(ie(he))return he=fe(re,te(he)),new ee(te(he.g),he.h);if(30<re.g.length){if(ie(re)||ie(he))throw Error("slowDivide_ only works with positive integers.");for(var _e=F,Se=he;0>=Se.l(re);)_e=ye(_e),Se=ye(Se);var J=Ee(_e,1),Ie=Ee(Se,1);for(Se=Ee(Se,2),_e=Ee(_e,2);!Q(Se);){var we=Ie.add(Se);0>=we.l(re)&&(J=J.add(_e),Ie=we),Se=Ee(Se,1),_e=Ee(_e,1)}return he=W(re,J.j(he)),new ee(J,he)}for(J=O;0<=re.l(he);){for(_e=Math.max(1,Math.floor(re.m()/he.m())),Se=Math.ceil(Math.log(_e)/Math.LN2),Se=48>=Se?1:Math.pow(2,Se-48),Ie=I(_e),we=Ie.j(he);ie(we)||0<we.l(re);)_e-=Se,Ie=I(_e),we=Ie.j(he);Q(Ie)&&(Ie=F),J=J.add(Ie),re=W(re,we)}return new ee(J,re)}e.A=function(re){return fe(this,re).h},e.and=function(re){for(var he=Math.max(this.g.length,re.g.length),_e=[],Se=0;Se<he;Se++)_e[Se]=this.i(Se)&re.i(Se);return new _(_e,this.h&re.h)},e.or=function(re){for(var he=Math.max(this.g.length,re.g.length),_e=[],Se=0;Se<he;Se++)_e[Se]=this.i(Se)|re.i(Se);return new _(_e,this.h|re.h)},e.xor=function(re){for(var he=Math.max(this.g.length,re.g.length),_e=[],Se=0;Se<he;Se++)_e[Se]=this.i(Se)^re.i(Se);return new _(_e,this.h^re.h)};function ye(re){for(var he=re.g.length+1,_e=[],Se=0;Se<he;Se++)_e[Se]=re.i(Se)<<1|re.i(Se-1)>>>31;return new _(_e,re.h)}function Ee(re,he){var _e=he>>5;he%=32;for(var Se=re.g.length-_e,J=[],Ie=0;Ie<Se;Ie++)J[Ie]=0<he?re.i(Ie+_e)>>>he|re.i(Ie+_e+1)<<32-he:re.i(Ie+_e);return new _(J,re.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,UG=s,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.A,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=I,_.fromString=D,Pm=_}).apply(typeof iU!="undefined"?iU:typeof self!="undefined"?self:typeof window!="undefined"?window:{});var ZT=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var VG,$G,d1,qG,ME,Tk,GG,WG,HG;(function(){var e,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(R,K,ue){return R==Array.prototype||R==Object.prototype||(R[K]=ue.value),R};function r(R){R=[typeof globalThis=="object"&&globalThis,R,typeof window=="object"&&window,typeof self=="object"&&self,typeof ZT=="object"&&ZT];for(var K=0;K<R.length;++K){var ue=R[K];if(ue&&ue.Math==Math)return ue}throw Error("Cannot find global object")}var s=r(this);function c(R,K){if(K)e:{var ue=s;R=R.split(".");for(var De=0;De<R.length-1;De++){var mt=R[De];if(!(mt in ue))break e;ue=ue[mt]}R=R[R.length-1],De=ue[R],K=K(De),K!=De&&K!=null&&t(ue,R,{configurable:!0,writable:!0,value:K})}}function f(R,K){R instanceof String&&(R+="");var ue=0,De=!1,mt={next:function(){if(!De&&ue<R.length){var kt=ue++;return{value:K(kt,R[kt]),done:!1}}return De=!0,{done:!0,value:void 0}}};return mt[Symbol.iterator]=function(){return mt},mt}c("Array.prototype.values",function(R){return R||function(){return f(this,function(K,ue){return ue})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var _=_||{},x=this||self;function a(R){var K=typeof R;return K=K!="object"?K:R?Array.isArray(R)?"array":K:"null",K=="array"||K=="object"&&typeof R.length=="number"}function I(R){var K=typeof R;return K=="object"&&R!=null||K=="function"}function D(R,K,ue){return R.call.apply(R.bind,arguments)}function O(R,K,ue){if(!R)throw Error();if(2<arguments.length){var De=Array.prototype.slice.call(arguments,2);return function(){var mt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(mt,De),R.apply(K,mt)}}return function(){return R.apply(K,arguments)}}function F(R,K,ue){return F=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?D:O,F.apply(null,arguments)}function H(R,K){var ue=Array.prototype.slice.call(arguments,1);return function(){var De=ue.slice();return De.push.apply(De,arguments),R.apply(this,De)}}function Q(R,K){function ue(){}ue.prototype=K.prototype,R.aa=K.prototype,R.prototype=new ue,R.prototype.constructor=R,R.Qb=function(De,mt,kt){for(var rn=Array(arguments.length-2),ui=2;ui<arguments.length;ui++)rn[ui-2]=arguments[ui];return K.prototype[mt].apply(De,rn)}}function ie(R){const K=R.length;if(0<K){const ue=Array(K);for(let De=0;De<K;De++)ue[De]=R[De];return ue}return[]}function te(R,K){for(let ue=1;ue<arguments.length;ue++){const De=arguments[ue];if(a(De)){const mt=R.length||0,kt=De.length||0;R.length=mt+kt;for(let rn=0;rn<kt;rn++)R[mt+rn]=De[rn]}else R.push(De)}}class W{constructor(K,ue){this.i=K,this.j=ue,this.h=0,this.g=null}get(){let K;return 0<this.h?(this.h--,K=this.g,this.g=K.next,K.next=null):K=this.i(),K}}function X(R){return/^[\s\xa0]*$/.test(R)}function ee(){var R=x.navigator;return R&&(R=R.userAgent)?R:""}function fe(R){return fe[" "](R),R}fe[" "]=function(){};var ye=ee().indexOf("Gecko")!=-1&&!(ee().toLowerCase().indexOf("webkit")!=-1&&ee().indexOf("Edge")==-1)&&!(ee().indexOf("Trident")!=-1||ee().indexOf("MSIE")!=-1)&&ee().indexOf("Edge")==-1;function Ee(R,K,ue){for(const De in R)K.call(ue,R[De],De,R)}function re(R,K){for(const ue in R)K.call(void 0,R[ue],ue,R)}function he(R){const K={};for(const ue in R)K[ue]=R[ue];return K}const _e="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Se(R,K){let ue,De;for(let mt=1;mt<arguments.length;mt++){De=arguments[mt];for(ue in De)R[ue]=De[ue];for(let kt=0;kt<_e.length;kt++)ue=_e[kt],Object.prototype.hasOwnProperty.call(De,ue)&&(R[ue]=De[ue])}}function J(R){var K=1;R=R.split(":");const ue=[];for(;0<K&&R.length;)ue.push(R.shift()),K--;return R.length&&ue.push(R.join(":")),ue}function Ie(R){x.setTimeout(()=>{throw R},0)}function we(){var R=Ut;let K=null;return R.g&&(K=R.g,R.g=R.g.next,R.g||(R.h=null),K.next=null),K}class Lt{constructor(){this.h=this.g=null}add(K,ue){const De=Gt.get();De.set(K,ue),this.h?this.h.next=De:this.g=De,this.h=De}}var Gt=new W(()=>new qt,R=>R.reset());class qt{constructor(){this.next=this.g=this.h=null}set(K,ue){this.h=K,this.g=ue,this.next=null}reset(){this.next=this.g=this.h=null}}let It,ct=!1,Ut=new Lt,Kt=()=>{const R=x.Promise.resolve(void 0);It=()=>{R.then(at)}};var at=()=>{for(var R;R=we();){try{R.h.call(R.g)}catch(ue){Ie(ue)}var K=Gt;K.j(R),100>K.h&&(K.h++,R.next=K.g,K.g=R)}ct=!1};function At(){this.s=this.s,this.C=this.C}At.prototype.s=!1,At.prototype.ma=function(){this.s||(this.s=!0,this.N())},At.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Et(R,K){this.type=R,this.g=this.target=K,this.defaultPrevented=!1}Et.prototype.h=function(){this.defaultPrevented=!0};var Jt=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var R=!1,K=Object.defineProperty({},"passive",{get:function(){R=!0}});try{const ue=()=>{};x.addEventListener("test",ue,K),x.removeEventListener("test",ue,K)}catch(ue){}return R}();function Bt(R,K){if(Et.call(this,R?R.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,R){var ue=this.type=R.type,De=R.changedTouches&&R.changedTouches.length?R.changedTouches[0]:null;if(this.target=R.target||R.srcElement,this.g=K,K=R.relatedTarget){if(ye){e:{try{fe(K.nodeName);var mt=!0;break e}catch(kt){}mt=!1}mt||(K=null)}}else ue=="mouseover"?K=R.fromElement:ue=="mouseout"&&(K=R.toElement);this.relatedTarget=K,De?(this.clientX=De.clientX!==void 0?De.clientX:De.pageX,this.clientY=De.clientY!==void 0?De.clientY:De.pageY,this.screenX=De.screenX||0,this.screenY=De.screenY||0):(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0),this.button=R.button,this.key=R.key||"",this.ctrlKey=R.ctrlKey,this.altKey=R.altKey,this.shiftKey=R.shiftKey,this.metaKey=R.metaKey,this.pointerId=R.pointerId||0,this.pointerType=typeof R.pointerType=="string"?R.pointerType:Pn[R.pointerType]||"",this.state=R.state,this.i=R,R.defaultPrevented&&Bt.aa.h.call(this)}}Q(Bt,Et);var Pn={2:"touch",3:"pen",4:"mouse"};Bt.prototype.h=function(){Bt.aa.h.call(this);var R=this.i;R.preventDefault?R.preventDefault():R.returnValue=!1};var $n="closure_listenable_"+(1e6*Math.random()|0),Qn=0;function Xt(R,K,ue,De,mt){this.listener=R,this.proxy=null,this.src=K,this.type=ue,this.capture=!!De,this.ha=mt,this.key=++Qn,this.da=this.fa=!1}function mr(R){R.da=!0,R.listener=null,R.proxy=null,R.src=null,R.ha=null}function An(R){this.src=R,this.g={},this.h=0}An.prototype.add=function(R,K,ue,De,mt){var kt=R.toString();R=this.g[kt],R||(R=this.g[kt]=[],this.h++);var rn=zr(R,K,De,mt);return-1<rn?(K=R[rn],ue||(K.fa=!1)):(K=new Xt(K,this.src,kt,!!De,mt),K.fa=ue,R.push(K)),K};function cr(R,K){var ue=K.type;if(ue in R.g){var De=R.g[ue],mt=Array.prototype.indexOf.call(De,K,void 0),kt;(kt=0<=mt)&&Array.prototype.splice.call(De,mt,1),kt&&(mr(K),R.g[ue].length==0&&(delete R.g[ue],R.h--))}}function zr(R,K,ue,De){for(var mt=0;mt<R.length;++mt){var kt=R[mt];if(!kt.da&&kt.listener==K&&kt.capture==!!ue&&kt.ha==De)return mt}return-1}var qn="closure_lm_"+(1e6*Math.random()|0),Mr={};function Vr(R,K,ue,De,mt){if(Array.isArray(K)){for(var kt=0;kt<K.length;kt++)Vr(R,K[kt],ue,De,mt);return null}return ue=sn(ue),R&&R[$n]?R.K(K,ue,I(De)?!!De.capture:!!De,mt):kn(R,K,ue,!1,De,mt)}function kn(R,K,ue,De,mt,kt){if(!K)throw Error("Invalid event type");var rn=I(mt)?!!mt.capture:!!mt,ui=pt(R);if(ui||(R[qn]=ui=new An(R)),ue=ui.add(K,ue,De,rn,kt),ue.proxy)return ue;if(De=zn(),ue.proxy=De,De.src=R,De.listener=ue,R.addEventListener)Jt||(mt=rn),mt===void 0&&(mt=!1),R.addEventListener(K.toString(),De,mt);else if(R.attachEvent)R.attachEvent(gt(K.toString()),De);else if(R.addListener&&R.removeListener)R.addListener(De);else throw Error("addEventListener and attachEvent are unavailable.");return ue}function zn(){function R(ue){return K.call(R.src,R.listener,ue)}const K=Qe;return R}function Ue(R,K,ue,De,mt){if(Array.isArray(K))for(var kt=0;kt<K.length;kt++)Ue(R,K[kt],ue,De,mt);else De=I(De)?!!De.capture:!!De,ue=sn(ue),R&&R[$n]?(R=R.i,K=String(K).toString(),K in R.g&&(kt=R.g[K],ue=zr(kt,ue,De,mt),-1<ue&&(mr(kt[ue]),Array.prototype.splice.call(kt,ue,1),kt.length==0&&(delete R.g[K],R.h--)))):R&&(R=pt(R))&&(K=R.g[K.toString()],R=-1,K&&(R=zr(K,ue,De,mt)),(ue=-1<R?K[R]:null)&&Ye(ue))}function Ye(R){if(typeof R!="number"&&R&&!R.da){var K=R.src;if(K&&K[$n])cr(K.i,R);else{var ue=R.type,De=R.proxy;K.removeEventListener?K.removeEventListener(ue,De,R.capture):K.detachEvent?K.detachEvent(gt(ue),De):K.addListener&&K.removeListener&&K.removeListener(De),(ue=pt(K))?(cr(ue,R),ue.h==0&&(ue.src=null,K[qn]=null)):mr(R)}}}function gt(R){return R in Mr?Mr[R]:Mr[R]="on"+R}function Qe(R,K){if(R.da)R=!0;else{K=new Bt(K,this);var ue=R.listener,De=R.ha||R.src;R.fa&&Ye(R),R=ue.call(De,K)}return R}function pt(R){return R=R[qn],R instanceof An?R:null}var dt="__closure_events_fn_"+(1e9*Math.random()>>>0);function sn(R){return typeof R=="function"?R:(R[dt]||(R[dt]=function(K){return R.handleEvent(K)}),R[dt])}function Wt(){At.call(this),this.i=new An(this),this.M=this,this.F=null}Q(Wt,At),Wt.prototype[$n]=!0,Wt.prototype.removeEventListener=function(R,K,ue,De){Ue(this,R,K,ue,De)};function pn(R,K){var ue,De=R.F;if(De)for(ue=[];De;De=De.F)ue.push(De);if(R=R.M,De=K.type||K,typeof K=="string")K=new Et(K,R);else if(K instanceof Et)K.target=K.target||R;else{var mt=K;K=new Et(De,R),Se(K,mt)}if(mt=!0,ue)for(var kt=ue.length-1;0<=kt;kt--){var rn=K.g=ue[kt];mt=Sn(rn,De,!0,K)&&mt}if(rn=K.g=R,mt=Sn(rn,De,!0,K)&&mt,mt=Sn(rn,De,!1,K)&&mt,ue)for(kt=0;kt<ue.length;kt++)rn=K.g=ue[kt],mt=Sn(rn,De,!1,K)&&mt}Wt.prototype.N=function(){if(Wt.aa.N.call(this),this.i){var R=this.i,K;for(K in R.g){for(var ue=R.g[K],De=0;De<ue.length;De++)mr(ue[De]);delete R.g[K],R.h--}}this.F=null},Wt.prototype.K=function(R,K,ue,De){return this.i.add(String(R),K,!1,ue,De)},Wt.prototype.L=function(R,K,ue,De){return this.i.add(String(R),K,!0,ue,De)};function Sn(R,K,ue,De){if(K=R.i.g[String(K)],!K)return!0;K=K.concat();for(var mt=!0,kt=0;kt<K.length;++kt){var rn=K[kt];if(rn&&!rn.da&&rn.capture==ue){var ui=rn.listener,xs=rn.ha||rn.src;rn.fa&&cr(R.i,rn),mt=ui.call(xs,De)!==!1&&mt}}return mt&&!De.defaultPrevented}function gr(R,K,ue){if(typeof R=="function")ue&&(R=F(R,ue));else if(R&&typeof R.handleEvent=="function")R=F(R.handleEvent,R);else throw Error("Invalid listener argument");return 2147483647<Number(K)?-1:x.setTimeout(R,K||0)}function xi(R){R.g=gr(()=>{R.g=null,R.i&&(R.i=!1,xi(R))},R.l);const K=R.h;R.h=null,R.m.apply(null,K)}class Yr extends At{constructor(K,ue){super(),this.m=K,this.l=ue,this.h=null,this.i=!1,this.g=null}j(K){this.h=arguments,this.g?this.i=!0:xi(this)}N(){super.N(),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Li(R){At.call(this),this.h=R,this.g={}}Q(Li,At);var Nr=[];function di(R){Ee(R.g,function(K,ue){this.g.hasOwnProperty(ue)&&Ye(K)},R),R.g={}}Li.prototype.N=function(){Li.aa.N.call(this),di(this)},Li.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var En=x.JSON.stringify,hn=x.JSON.parse,bi=class{stringify(R){return x.JSON.stringify(R,void 0)}parse(R){return x.JSON.parse(R,void 0)}};function ci(){}ci.prototype.h=null;function Us(R){return R.h||(R.h=R.i())}function Ca(){}var an={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ir(){Et.call(this,"d")}Q(ir,Et);function oi(){Et.call(this,"c")}Q(oi,Et);var Fi={},Ps=null;function Rs(){return Ps=Ps||new Wt}Fi.La="serverreachability";function Vs(R){Et.call(this,Fi.La,R)}Q(Vs,Et);function Ks(R){const K=Rs();pn(K,new Vs(K))}Fi.STAT_EVENT="statevent";function jo(R,K){Et.call(this,Fi.STAT_EVENT,R),this.stat=K}Q(jo,Et);function qr(R){const K=Rs();pn(K,new jo(K,R))}Fi.Ma="timingevent";function Qa(R,K){Et.call(this,Fi.Ma,R),this.size=K}Q(Qa,Et);function ai(R,K){if(typeof R!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){R()},K)}function Ai(){this.g=!0}Ai.prototype.xa=function(){this.g=!1};function Cl(R,K,ue,De,mt,kt){R.info(function(){if(R.g)if(kt)for(var rn="",ui=kt.split("&"),xs=0;xs<ui.length;xs++){var Gr=ui[xs].split("=");if(1<Gr.length){var Os=Gr[0];Gr=Gr[1];var Ls=Os.split("_");rn=2<=Ls.length&&Ls[1]=="type"?rn+(Os+"="+Gr+"&"):rn+(Os+"=redacted&")}}else rn=null;else rn=kt;return"XMLHTTP REQ ("+De+") [attempt "+mt+"]: "+K+`
`+ue+`
`+rn})}function Aa(R,K,ue,De,mt,kt,rn){R.info(function(){return"XMLHTTP RESP ("+De+") [ attempt "+mt+"]: "+K+`
`+ue+`
`+kt+" "+rn})}function vo(R,K,ue,De){R.info(function(){return"XMLHTTP TEXT ("+K+"): "+Ju(R,ue)+(De?" "+De:"")})}function Gi(R,K){R.info(function(){return"TIMEOUT: "+K})}Ai.prototype.info=function(){};function Ju(R,K){if(!R.g)return K;if(!K)return null;try{var ue=JSON.parse(K);if(ue){for(R=0;R<ue.length;R++)if(Array.isArray(ue[R])){var De=ue[R];if(!(2>De.length)){var mt=De[1];if(Array.isArray(mt)&&!(1>mt.length)){var kt=mt[0];if(kt!="noop"&&kt!="stop"&&kt!="close")for(var rn=1;rn<mt.length;rn++)mt[rn]=""}}}}return En(ue)}catch(ui){return K}}var Ve={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ne={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},le;function Te(){}Q(Te,ci),Te.prototype.g=function(){return new XMLHttpRequest},Te.prototype.i=function(){return{}},le=new Te;function Le(R,K,ue,De){this.j=R,this.i=K,this.l=ue,this.R=De||1,this.U=new Li(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Oe}function Oe(){this.i=null,this.g="",this.h=!1}var He={},st={};function We(R,K,ue){R.L=1,R.v=Kc(Uo(K)),R.m=ue,R.P=!0,rt(R,null)}function rt(R,K){R.F=Date.now(),Qt(R),R.A=Uo(R.v);var ue=R.A,De=R.R;Array.isArray(De)||(De=[String(De)]),gg(ue.i,"t",De),R.C=0,ue=R.j.J,R.h=new Oe,R.g=ou(R.j,ue?K:null,!R.m),0<R.O&&(R.M=new Yr(F(R.Y,R,R.g),R.O)),K=R.U,ue=R.g,De=R.ca;var mt="readystatechange";Array.isArray(mt)||(mt&&(Nr[0]=mt.toString()),mt=Nr);for(var kt=0;kt<mt.length;kt++){var rn=Vr(ue,mt[kt],De||K.handleEvent,!1,K.h||K);if(!rn)break;K.g[rn.key]=rn}K=R.H?he(R.H):{},R.m?(R.u||(R.u="POST"),K["Content-Type"]="application/x-www-form-urlencoded",R.g.ea(R.A,R.u,R.m,K)):(R.u="GET",R.g.ea(R.A,R.u,null,K)),Ks(),Cl(R.i,R.u,R.A,R.l,R.R,R.m)}Le.prototype.ca=function(R){R=R.target;const K=this.M;K&&aa(R)==3?K.j():this.Y(R)},Le.prototype.Y=function(R){try{if(R==this.g)e:{const Ls=aa(this.g);var K=this.g.Ba();const pc=this.g.Z();if(!(3>Ls)&&(Ls!=3||this.g&&(this.h.h||this.g.oa()||cc(this.g)))){this.J||Ls!=4||K==7||(K==8||0>=pc?Ks(3):Ks(2)),Cn(this);var ue=this.g.Z();this.X=ue;t:if(wt(this)){var De=cc(this.g);R="";var mt=De.length,kt=aa(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){Dn(this),ur(this);var rn="";break t}this.h.i=new x.TextDecoder}for(K=0;K<mt;K++)this.h.h=!0,R+=this.h.i.decode(De[K],{stream:!(kt&&K==mt-1)});De.length=0,this.h.g+=R,this.C=0,rn=this.h.g}else rn=this.g.oa();if(this.o=ue==200,Aa(this.i,this.u,this.A,this.l,this.R,Ls,ue),this.o){if(this.T&&!this.K){t:{if(this.g){var ui,xs=this.g;if((ui=xs.g?xs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!X(ui)){var Gr=ui;break t}}Gr=null}if(ue=Gr)vo(this.i,this.l,ue,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,hr(this,ue);else{this.o=!1,this.s=3,qr(12),Dn(this),ur(this);break e}}if(this.P){ue=!0;let fs;for(;!this.J&&this.C<rn.length;)if(fs=Tt(this,rn),fs==st){Ls==4&&(this.s=4,qr(14),ue=!1),vo(this.i,this.l,null,"[Incomplete Response]");break}else if(fs==He){this.s=4,qr(15),vo(this.i,this.l,rn,"[Invalid Chunk]"),ue=!1;break}else vo(this.i,this.l,fs,null),hr(this,fs);if(wt(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ls!=4||rn.length!=0||this.h.h||(this.s=1,qr(16),ue=!1),this.o=this.o&&ue,!ue)vo(this.i,this.l,rn,"[Invalid Chunked Response]"),Dn(this),ur(this);else if(0<rn.length&&!this.W){this.W=!0;var Os=this.j;Os.g==this&&Os.ba&&!Os.M&&(Os.j.info("Great, no buffering proxy detected. Bytes received: "+rn.length),vs(Os),Os.M=!0,qr(11))}}else vo(this.i,this.l,rn,null),hr(this,rn);Ls==4&&Dn(this),this.o&&!this.J&&(Ls==4?vg(this.j,this):(this.o=!1,Qt(this)))}else ih(this.g),ue==400&&0<rn.indexOf("Unknown SID")?(this.s=3,qr(12)):(this.s=0,qr(13)),Dn(this),ur(this)}}}catch(Ls){}finally{}};function wt(R){return R.g?R.u=="GET"&&R.L!=2&&R.j.Ca:!1}function Tt(R,K){var ue=R.C,De=K.indexOf(`
`,ue);return De==-1?st:(ue=Number(K.substring(ue,De)),isNaN(ue)?He:(De+=1,De+ue>K.length?st:(K=K.slice(De,De+ue),R.C=De+ue,K)))}Le.prototype.cancel=function(){this.J=!0,Dn(this)};function Qt(R){R.S=Date.now()+R.I,_n(R,R.I)}function _n(R,K){if(R.B!=null)throw Error("WatchDog timer not null");R.B=ai(F(R.ba,R),K)}function Cn(R){R.B&&(x.clearTimeout(R.B),R.B=null)}Le.prototype.ba=function(){this.B=null;const R=Date.now();0<=R-this.S?(Gi(this.i,this.A),this.L!=2&&(Ks(),qr(17)),Dn(this),this.s=2,ur(this)):_n(this,this.S-R)};function ur(R){R.j.G==0||R.J||vg(R.j,R)}function Dn(R){Cn(R);var K=R.M;K&&typeof K.ma=="function"&&K.ma(),R.M=null,di(R.U),R.g&&(K=R.g,R.g=null,K.abort(),K.ma())}function hr(R,K){try{var ue=R.j;if(ue.G!=0&&(ue.g==R||wi(ue.h,R))){if(!R.K&&wi(ue.h,R)&&ue.G==3){try{var De=ue.Da.g.parse(K)}catch(Gr){De=null}if(Array.isArray(De)&&De.length==3){var mt=De;if(mt[0]==0){e:if(!ue.u){if(ue.g)if(ue.g.F+3e3<R.F)la(ue),hc(ue);else break e;$s(ue),qr(18)}}else ue.za=mt[1],0<ue.za-ue.T&&37500>mt[2]&&ue.F&&ue.v==0&&!ue.C&&(ue.C=ai(F(ue.Za,ue),6e3));if(1>=dr(ue.h)&&ue.ca){try{ue.ca()}catch(Gr){}ue.ca=void 0}}else $o(ue,11)}else if((R.K||ue.g==R)&&la(ue),!X(K))for(mt=ue.Da.g.parse(K),K=0;K<mt.length;K++){let Gr=mt[K];if(ue.T=Gr[0],Gr=Gr[1],ue.G==2)if(Gr[0]=="c"){ue.K=Gr[1],ue.ia=Gr[2];const Os=Gr[3];Os!=null&&(ue.la=Os,ue.j.info("VER="+ue.la));const Ls=Gr[4];Ls!=null&&(ue.Aa=Ls,ue.j.info("SVER="+ue.Aa));const pc=Gr[5];pc!=null&&typeof pc=="number"&&0<pc&&(De=1.5*pc,ue.L=De,ue.j.info("backChannelRequestTimeoutMs_="+De)),De=ue;const fs=R.g;if(fs){const mc=fs.g?fs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(mc){var kt=De.h;kt.g||mc.indexOf("spdy")==-1&&mc.indexOf("quic")==-1&&mc.indexOf("h2")==-1||(kt.j=kt.l,kt.g=new Set,kt.h&&(Ti(kt,kt.h),kt.h=null))}if(De.D){const xd=fs.g?fs.g.getResponseHeader("X-HTTP-Session-Id"):null;xd&&(De.ya=xd,fi(De.I,De.D,xd))}}ue.G=3,ue.l&&ue.l.ua(),ue.ba&&(ue.R=Date.now()-R.F,ue.j.info("Handshake RTT: "+ue.R+"ms")),De=ue;var rn=R;if(De.qa=vd(De,De.J?De.ia:null,De.W),rn.K){Yi(De.h,rn);var ui=rn,xs=De.L;xs&&(ui.I=xs),ui.B&&(Cn(ui),Qt(ui)),De.g=rn}else Ds(De);0<ue.i.length&&Pa(ue)}else Gr[0]!="stop"&&Gr[0]!="close"||$o(ue,7);else ue.G==3&&(Gr[0]=="stop"||Gr[0]=="close"?Gr[0]=="stop"?$o(ue,7):yd(ue):Gr[0]!="noop"&&ue.l&&ue.l.ta(Gr),ue.v=0)}}Ks(4)}catch(Gr){}}var dn=class{constructor(R,K){this.g=R,this.map=K}};function Jr(R){this.l=R||10,x.PerformanceNavigationTiming?(R=x.performance.getEntriesByType("navigation"),R=0<R.length&&(R[0].nextHopProtocol=="hq"||R[0].nextHopProtocol=="h2")):R=!!(x.chrome&&x.chrome.loadTimes&&x.chrome.loadTimes()&&x.chrome.loadTimes().wasFetchedViaSpdy),this.j=R?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function vr(R){return R.h?!0:R.g?R.g.size>=R.j:!1}function dr(R){return R.h?1:R.g?R.g.size:0}function wi(R,K){return R.h?R.h==K:R.g?R.g.has(K):!1}function Ti(R,K){R.g?R.g.add(K):R.h=K}function Yi(R,K){R.h&&R.h==K?R.h=null:R.g&&R.g.has(K)&&R.g.delete(K)}Jr.prototype.cancel=function(){if(this.i=Ms(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const R of this.g.values())R.cancel();this.g.clear()}};function Ms(R){if(R.h!=null)return R.i.concat(R.h.D);if(R.g!=null&&R.g.size!==0){let K=R.i;for(const ue of R.g.values())K=K.concat(ue.D);return K}return ie(R.i)}function Qs(R){if(R.V&&typeof R.V=="function")return R.V();if(typeof Map!="undefined"&&R instanceof Map||typeof Set!="undefined"&&R instanceof Set)return Array.from(R.values());if(typeof R=="string")return R.split("");if(a(R)){for(var K=[],ue=R.length,De=0;De<ue;De++)K.push(R[De]);return K}K=[],ue=0;for(De in R)K[ue++]=R[De];return K}function sc(R){if(R.na&&typeof R.na=="function")return R.na();if(!R.V||typeof R.V!="function"){if(typeof Map!="undefined"&&R instanceof Map)return Array.from(R.keys());if(!(typeof Set!="undefined"&&R instanceof Set)){if(a(R)||typeof R=="string"){var K=[];R=R.length;for(var ue=0;ue<R;ue++)K.push(ue);return K}K=[],ue=0;for(const De in R)K[ue++]=De;return K}}}function dd(R,K){if(R.forEach&&typeof R.forEach=="function")R.forEach(K,void 0);else if(a(R)||typeof R=="string")Array.prototype.forEach.call(R,K,void 0);else for(var ue=sc(R),De=Qs(R),mt=De.length,kt=0;kt<mt;kt++)K.call(void 0,De[kt],ue&&ue[kt],R)}var fd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eh(R,K){if(R){R=R.split("&");for(var ue=0;ue<R.length;ue++){var De=R[ue].indexOf("="),mt=null;if(0<=De){var kt=R[ue].substring(0,De);mt=R[ue].substring(De+1)}else kt=R[ue];K(kt,mt?decodeURIComponent(mt.replace(/\+/g," ")):"")}}}function Nn(R){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,R instanceof Nn){this.h=R.h,sa(this,R.j),this.o=R.o,this.g=R.g,Xc(this,R.s),this.l=R.l;var K=R.i,ue=new Yc;ue.i=K.i,K.g&&(ue.g=new Map(K.g),ue.h=K.h),pd(this,ue),this.m=R.m}else R&&(K=String(R).match(fd))?(this.h=!1,sa(this,K[1]||"",!0),this.o=oc(K[2]||""),this.g=oc(K[3]||"",!0),Xc(this,K[4]),this.l=oc(K[5]||"",!0),pd(this,K[6]||"",!0),this.m=oc(K[7]||"")):(this.h=!1,this.i=new Yc(null,this.h))}Nn.prototype.toString=function(){var R=[],K=this.j;K&&R.push(ac(K,Qc,!0),":");var ue=this.g;return(ue||K=="file")&&(R.push("//"),(K=this.o)&&R.push(ac(K,Qc,!0),"@"),R.push(encodeURIComponent(String(ue)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ue=this.s,ue!=null&&R.push(":",String(ue))),(ue=this.l)&&(this.g&&ue.charAt(0)!="/"&&R.push("/"),R.push(ac(ue,ue.charAt(0)=="/"?md:th,!0))),(ue=this.i.toString())&&R.push("?",ue),(ue=this.m)&&R.push("#",ac(ue,pg)),R.join("")};function Uo(R){return new Nn(R)}function sa(R,K,ue){R.j=ue?oc(K,!0):K,R.j&&(R.j=R.j.replace(/:$/,""))}function Xc(R,K){if(K){if(K=Number(K),isNaN(K)||0>K)throw Error("Bad port number "+K);R.s=K}else R.s=null}function pd(R,K,ue){K instanceof Yc?(R.i=K,_g(R.i,R.h)):(ue||(K=ac(K,gd)),R.i=new Yc(K,R.h))}function fi(R,K,ue){R.i.set(K,ue)}function Kc(R){return fi(R,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),R}function oc(R,K){return R?K?decodeURI(R.replace(/%25/g,"%2525")):decodeURIComponent(R):""}function ac(R,K,ue){return typeof R=="string"?(R=encodeURI(R).replace(K,sp),ue&&(R=R.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R):null}function sp(R){return R=R.charCodeAt(0),"%"+(R>>4&15).toString(16)+(R&15).toString(16)}var Qc=/[#\/\?@]/g,th=/[#\?:]/g,md=/[#\?]/g,gd=/[#\?@]/g,pg=/#/g;function Yc(R,K){this.h=this.g=null,this.i=R||null,this.j=!!K}function Po(R){R.g||(R.g=new Map,R.h=0,R.i&&eh(R.i,function(K,ue){R.add(decodeURIComponent(K.replace(/\+/g," ")),ue)}))}e=Yc.prototype,e.add=function(R,K){Po(this),this.i=null,R=Jc(this,R);var ue=this.g.get(R);return ue||this.g.set(R,ue=[]),ue.push(K),this.h+=1,this};function fr(R,K){Po(R),K=Jc(R,K),R.g.has(K)&&(R.i=null,R.h-=R.g.get(K).length,R.g.delete(K))}function mg(R,K){return Po(R),K=Jc(R,K),R.g.has(K)}e.forEach=function(R,K){Po(this),this.g.forEach(function(ue,De){ue.forEach(function(mt){R.call(K,mt,De,this)},this)},this)},e.na=function(){Po(this);const R=Array.from(this.g.values()),K=Array.from(this.g.keys()),ue=[];for(let De=0;De<K.length;De++){const mt=R[De];for(let kt=0;kt<mt.length;kt++)ue.push(K[De])}return ue},e.V=function(R){Po(this);let K=[];if(typeof R=="string")mg(this,R)&&(K=K.concat(this.g.get(Jc(this,R))));else{R=Array.from(this.g.values());for(let ue=0;ue<R.length;ue++)K=K.concat(R[ue])}return K},e.set=function(R,K){return Po(this),this.i=null,R=Jc(this,R),mg(this,R)&&(this.h-=this.g.get(R).length),this.g.set(R,[K]),this.h+=1,this},e.get=function(R,K){return R?(R=this.V(R),0<R.length?String(R[0]):K):K};function gg(R,K,ue){fr(R,K),0<ue.length&&(R.i=null,R.g.set(Jc(R,K),ie(ue)),R.h+=ue.length)}e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const R=[],K=Array.from(this.g.keys());for(var ue=0;ue<K.length;ue++){var De=K[ue];const kt=encodeURIComponent(String(De)),rn=this.V(De);for(De=0;De<rn.length;De++){var mt=kt;rn[De]!==""&&(mt+="="+encodeURIComponent(String(rn[De]))),R.push(mt)}}return this.i=R.join("&")};function Jc(R,K){return K=String(K),R.j&&(K=K.toLowerCase()),K}function _g(R,K){K&&!R.j&&(Po(R),R.i=null,R.g.forEach(function(ue,De){var mt=De.toLowerCase();De!=mt&&(fr(this,De),gg(this,mt,ue))},R)),R.j=K}function _0(R,K){const ue=new Ai;if(x.Image){const De=new Image;De.onload=H(Vo,ue,"TestLoadImage: loaded",!0,K,De),De.onerror=H(Vo,ue,"TestLoadImage: error",!1,K,De),De.onabort=H(Vo,ue,"TestLoadImage: abort",!1,K,De),De.ontimeout=H(Vo,ue,"TestLoadImage: timeout",!1,K,De),x.setTimeout(function(){De.ontimeout&&De.ontimeout()},1e4),De.src=R}else K(!1)}function op(R,K){const ue=new Ai,De=new AbortController,mt=setTimeout(()=>{De.abort(),Vo(ue,"TestPingServer: timeout",!1,K)},1e4);fetch(R,{signal:De.signal}).then(kt=>{clearTimeout(mt),kt.ok?Vo(ue,"TestPingServer: ok",!0,K):Vo(ue,"TestPingServer: server error",!1,K)}).catch(()=>{clearTimeout(mt),Vo(ue,"TestPingServer: error",!1,K)})}function Vo(R,K,ue,De,mt){try{mt&&(mt.onload=null,mt.onerror=null,mt.onabort=null,mt.ontimeout=null),De(ue)}catch(kt){}}function Ro(){this.g=new bi}function yg(R,K,ue){const De=ue||"";try{dd(R,function(mt,kt){let rn=mt;I(mt)&&(rn=En(mt)),K.push(De+kt+"="+encodeURIComponent(rn))})}catch(mt){throw K.push(De+"type="+encodeURIComponent("_badmap")),mt}}function eu(R){this.l=R.Ub||null,this.j=R.eb||!1}Q(eu,ci),eu.prototype.g=function(){return new tu(this.l,this.j)},eu.prototype.i=function(R){return function(){return R}}({});function tu(R,K){Wt.call(this),this.D=R,this.o=K,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Q(tu,Wt),e=tu.prototype,e.open=function(R,K){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=R,this.A=K,this.readyState=1,Ft(this)},e.send=function(R){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const K={headers:this.u,method:this.B,credentials:this.m,cache:void 0};R&&(K.body=R),(this.D||x).fetch(new Request(this.A,K)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,oa(this)),this.readyState=0},e.Sa=function(R){if(this.g&&(this.l=R,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=R.headers,this.readyState=2,Ft(this)),this.g&&(this.readyState=3,Ft(this),this.g)))if(this.responseType==="arraybuffer")R.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof x.ReadableStream!="undefined"&&"body"in R){if(this.j=R.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;nu(this)}else R.text().then(this.Ra.bind(this),this.ga.bind(this))};function nu(R){R.j.read().then(R.Pa.bind(R)).catch(R.ga.bind(R))}e.Pa=function(R){if(this.g){if(this.o&&R.value)this.response.push(R.value);else if(!this.o){var K=R.value?R.value:new Uint8Array(0);(K=this.v.decode(K,{stream:!R.done}))&&(this.response=this.responseText+=K)}R.done?oa(this):Ft(this),this.readyState==3&&nu(this)}},e.Ra=function(R){this.g&&(this.response=this.responseText=R,oa(this))},e.Qa=function(R){this.g&&(this.response=R,oa(this))},e.ga=function(){this.g&&oa(this)};function oa(R){R.readyState=4,R.l=null,R.j=null,R.v=null,Ft(R)}e.setRequestHeader=function(R,K){this.u.append(R,K)},e.getResponseHeader=function(R){return this.h&&this.h.get(R.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const R=[],K=this.h.entries();for(var ue=K.next();!ue.done;)ue=ue.value,R.push(ue[0]+": "+ue[1]),ue=K.next();return R.join(`\r
`)};function Ft(R){R.onreadystatechange&&R.onreadystatechange.call(R)}Object.defineProperty(tu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(R){this.m=R?"include":"same-origin"}});function lc(R){let K="";return Ee(R,function(ue,De){K+=De,K+=":",K+=ue,K+=`\r
`}),K}function _d(R,K,ue){e:{for(De in ue){var De=!1;break e}De=!0}De||(ue=lc(ue),typeof R=="string"?ue!=null&&encodeURIComponent(String(ue)):fi(R,K,ue))}function pi(R){Wt.call(this),this.headers=new Map,this.o=R||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Q(pi,Wt);var sr=/^https?$/i,oo=["POST","PUT"];e=pi.prototype,e.Ha=function(R){this.J=R},e.ea=function(R,K,ue,De){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+R);K=K?K.toUpperCase():"GET",this.D=R,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():le.g(),this.v=this.o?Us(this.o):Us(le),this.g.onreadystatechange=F(this.Ea,this);try{this.B=!0,this.g.open(K,String(R),!0),this.B=!1}catch(kt){ru(this,kt);return}if(R=ue||"",ue=new Map(this.headers),De)if(Object.getPrototypeOf(De)===Object.prototype)for(var mt in De)ue.set(mt,De[mt]);else if(typeof De.keys=="function"&&typeof De.get=="function")for(const kt of De.keys())ue.set(kt,De.get(kt));else throw Error("Unknown input type for opt_headers: "+String(De));De=Array.from(ue.keys()).find(kt=>kt.toLowerCase()=="content-type"),mt=x.FormData&&R instanceof x.FormData,!(0<=Array.prototype.indexOf.call(oo,K,void 0))||De||mt||ue.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[kt,rn]of ue)this.g.setRequestHeader(kt,rn);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Yn(this),this.u=!0,this.g.send(R),this.u=!1}catch(kt){ru(this,kt)}};function ru(R,K){R.h=!1,R.g&&(R.j=!0,R.g.abort(),R.j=!1),R.l=K,R.m=5,nh(R),xo(R)}function nh(R){R.A||(R.A=!0,pn(R,"complete"),pn(R,"error"))}e.abort=function(R){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=R||7,pn(this,"complete"),pn(this,"abort"),xo(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xo(this,!0)),pi.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?rh(this):this.bb())},e.bb=function(){rh(this)};function rh(R){if(R.h&&typeof _!="undefined"&&(!R.v[1]||aa(R)!=4||R.Z()!=2)){if(R.u&&aa(R)==4)gr(R.Ea,0,R);else if(pn(R,"readystatechange"),aa(R)==4){R.h=!1;try{const rn=R.Z();e:switch(rn){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var K=!0;break e;default:K=!1}var ue;if(!(ue=K)){var De;if(De=rn===0){var mt=String(R.D).match(fd)[1]||null;!mt&&x.self&&x.self.location&&(mt=x.self.location.protocol.slice(0,-1)),De=!sr.test(mt?mt.toLowerCase():"")}ue=De}if(ue)pn(R,"complete"),pn(R,"success");else{R.m=6;try{var kt=2<aa(R)?R.g.statusText:""}catch(ui){kt=""}R.l=kt+" ["+R.Z()+"]",nh(R)}}finally{xo(R)}}}}function xo(R,K){if(R.g){Yn(R);const ue=R.g,De=R.v[0]?()=>{}:null;R.g=null,R.v=null,K||pn(R,"ready");try{ue.onreadystatechange=De}catch(mt){}}}function Yn(R){R.I&&(x.clearTimeout(R.I),R.I=null)}e.isActive=function(){return!!this.g};function aa(R){return R.g?R.g.readyState:0}e.Z=function(){try{return 2<aa(this)?this.g.status:-1}catch(R){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(R){return""}},e.Oa=function(R){if(this.g){var K=this.g.responseText;return R&&K.indexOf(R)==0&&(K=K.substring(R.length)),hn(K)}};function cc(R){try{if(!R.g)return null;if("response"in R.g)return R.g.response;switch(R.H){case"":case"text":return R.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in R.g)return R.g.mozResponseArrayBuffer}return null}catch(K){return null}}function ih(R){const K={};R=(R.g&&2<=aa(R)&&R.g.getAllResponseHeaders()||"").split(`\r
`);for(let De=0;De<R.length;De++){if(X(R[De]))continue;var ue=J(R[De]);const mt=ue[0];if(ue=ue[1],typeof ue!="string")continue;ue=ue.trim();const kt=K[mt]||[];K[mt]=kt,kt.push(ue)}re(K,function(De){return De.join(", ")})}e.Ba=function(){return this.m},e.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function uc(R,K,ue){return ue&&ue.internalChannelParams&&ue.internalChannelParams[R]||K}function ks(R){this.Aa=0,this.i=[],this.j=new Ai,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=uc("failFast",!1,R),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=uc("baseRetryDelayMs",5e3,R),this.cb=uc("retryDelaySeedMs",1e4,R),this.Wa=uc("forwardChannelMaxRetries",2,R),this.wa=uc("forwardChannelRequestTimeoutMs",2e4,R),this.pa=R&&R.xmlHttpFactory||void 0,this.Xa=R&&R.Tb||void 0,this.Ca=R&&R.useFetchStreams||!1,this.L=void 0,this.J=R&&R.supportsCrossDomainXhr||!1,this.K="",this.h=new Jr(R&&R.concurrentRequestLimit),this.Da=new Ro,this.P=R&&R.fastHandshake||!1,this.O=R&&R.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=R&&R.Rb||!1,R&&R.xa&&this.j.xa(),R&&R.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&R&&R.detectBufferingProxy||!1,this.ja=void 0,R&&R.longPollingTimeout&&0<R.longPollingTimeout&&(this.ja=R.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}e=ks.prototype,e.la=8,e.G=1,e.connect=function(R,K,ue,De){qr(0),this.W=R,this.H=K||{},ue&&De!==void 0&&(this.H.OSID=ue,this.H.OAID=De),this.F=this.X,this.I=vd(this,null,this.W),Pa(this)};function yd(R){if(dc(R),R.G==3){var K=R.U++,ue=Uo(R.I);if(fi(ue,"SID",R.K),fi(ue,"RID",K),fi(ue,"TYPE","terminate"),Ya(R,ue),K=new Le(R,R.j,K),K.L=2,K.v=Kc(Uo(ue)),ue=!1,x.navigator&&x.navigator.sendBeacon)try{ue=x.navigator.sendBeacon(K.v.toString(),"")}catch(De){}!ue&&x.Image&&(new Image().src=K.v,ue=!0),ue||(K.g=ou(K.j,null),K.g.ea(K.v)),K.F=Date.now(),Qt(K)}su(R)}function hc(R){R.g&&(vs(R),R.g.cancel(),R.g=null)}function dc(R){hc(R),R.u&&(x.clearTimeout(R.u),R.u=null),la(R),R.h.cancel(),R.s&&(typeof R.s=="number"&&x.clearTimeout(R.s),R.s=null)}function Pa(R){if(!vr(R.h)&&!R.s){R.s=!0;var K=R.Ga;It||Kt(),ct||(It(),ct=!0),Ut.add(K,R),R.B=0}}function ap(R,K){return dr(R.h)>=R.h.j-(R.s?1:0)?!1:R.s?(R.i=K.D.concat(R.i),!0):R.G==1||R.G==2||R.B>=(R.Va?0:R.Wa)?!1:(R.s=ai(F(R.Ga,R,K),fc(R,R.B)),R.B++,!0)}e.Ga=function(R){if(this.s)if(this.s=null,this.G==1){if(!R){this.U=Math.floor(1e5*Math.random()),R=this.U++;const mt=new Le(this,this.j,R);let kt=this.o;if(this.S&&(kt?(kt=he(kt),Se(kt,this.S)):kt=this.S),this.m!==null||this.O||(mt.H=kt,kt=null),this.P)e:{for(var K=0,ue=0;ue<this.i.length;ue++){t:{var De=this.i[ue];if("__data__"in De.map&&(De=De.map.__data__,typeof De=="string")){De=De.length;break t}De=void 0}if(De===void 0)break;if(K+=De,4096<K){K=ue;break e}if(K===4096||ue===this.i.length-1){K=ue+1;break e}}K=1e3}else K=1e3;K=iu(this,mt,K),ue=Uo(this.I),fi(ue,"RID",R),fi(ue,"CVER",22),this.D&&fi(ue,"X-HTTP-Session-Id",this.D),Ya(this,ue),kt&&(this.O?K="headers="+encodeURIComponent(String(lc(kt)))+"&"+K:this.m&&_d(ue,this.m,kt)),Ti(this.h,mt),this.Ua&&fi(ue,"TYPE","init"),this.P?(fi(ue,"$req",K),fi(ue,"SID","null"),mt.T=!0,We(mt,ue,null)):We(mt,ue,K),this.G=2}}else this.G==3&&(R?sh(this,R):this.i.length==0||vr(this.h)||sh(this))};function sh(R,K){var ue;K?ue=K.l:ue=R.U++;const De=Uo(R.I);fi(De,"SID",R.K),fi(De,"RID",ue),fi(De,"AID",R.T),Ya(R,De),R.m&&R.o&&_d(De,R.m,R.o),ue=new Le(R,R.j,ue,R.B+1),R.m===null&&(ue.H=R.o),K&&(R.i=K.D.concat(R.i)),K=iu(R,ue,1e3),ue.I=Math.round(.5*R.wa)+Math.round(.5*R.wa*Math.random()),Ti(R.h,ue),We(ue,De,K)}function Ya(R,K){R.H&&Ee(R.H,function(ue,De){fi(K,De,ue)}),R.l&&dd({},function(ue,De){fi(K,De,ue)})}function iu(R,K,ue){ue=Math.min(R.i.length,ue);var De=R.l?F(R.l.Na,R.l,R):null;e:{var mt=R.i;let kt=-1;for(;;){const rn=["count="+ue];kt==-1?0<ue?(kt=mt[0].g,rn.push("ofs="+kt)):kt=0:rn.push("ofs="+kt);let ui=!0;for(let xs=0;xs<ue;xs++){let Gr=mt[xs].g;const Os=mt[xs].map;if(Gr-=kt,0>Gr)kt=Math.max(0,mt[xs].g-100),ui=!1;else try{yg(Os,rn,"req"+Gr+"_")}catch(Ls){De&&De(Os)}}if(ui){De=rn.join("&");break e}}}return R=R.i.splice(0,ue),K.D=R,De}function Ds(R){if(!R.g&&!R.u){R.Y=1;var K=R.Fa;It||Kt(),ct||(It(),ct=!0),Ut.add(K,R),R.v=0}}function $s(R){return R.g||R.u||3<=R.v?!1:(R.Y++,R.u=ai(F(R.Fa,R),fc(R,R.v)),R.v++,!0)}e.Fa=function(){if(this.u=null,Pi(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var R=2*this.R;this.j.info("BP detection timer enabled: "+R),this.A=ai(F(this.ab,this),R)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,qr(10),hc(this),Pi(this))};function vs(R){R.A!=null&&(x.clearTimeout(R.A),R.A=null)}function Pi(R){R.g=new Le(R,R.j,"rpc",R.Y),R.m===null&&(R.g.H=R.o),R.g.O=0;var K=Uo(R.qa);fi(K,"RID","rpc"),fi(K,"SID",R.K),fi(K,"AID",R.T),fi(K,"CI",R.F?"0":"1"),!R.F&&R.ja&&fi(K,"TO",R.ja),fi(K,"TYPE","xmlhttp"),Ya(R,K),R.m&&R.o&&_d(K,R.m,R.o),R.L&&(R.g.I=R.L);var ue=R.g;R=R.ia,ue.L=1,ue.v=Kc(Uo(K)),ue.m=null,ue.P=!0,rt(ue,R)}e.Za=function(){this.C!=null&&(this.C=null,hc(this),$s(this),qr(19))};function la(R){R.C!=null&&(x.clearTimeout(R.C),R.C=null)}function vg(R,K){var ue=null;if(R.g==K){la(R),vs(R),R.g=null;var De=2}else if(wi(R.h,K))ue=K.D,Yi(R.h,K),De=1;else return;if(R.G!=0){if(K.o)if(De==1){ue=K.m?K.m.length:0,K=Date.now()-K.F;var mt=R.B;De=Rs(),pn(De,new Qa(De,ue)),Pa(R)}else Ds(R);else if(mt=K.s,mt==3||mt==0&&0<K.X||!(De==1&&ap(R,K)||De==2&&$s(R)))switch(ue&&0<ue.length&&(K=R.h,K.i=K.i.concat(ue)),mt){case 1:$o(R,5);break;case 4:$o(R,10);break;case 3:$o(R,6);break;default:$o(R,2)}}}function fc(R,K){let ue=R.Ta+Math.floor(Math.random()*R.cb);return R.isActive()||(ue*=2),ue*K}function $o(R,K){if(R.j.info("Error code "+K),K==2){var ue=F(R.fb,R),De=R.Xa;const mt=!De;De=new Nn(De||"//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||sa(De,"https"),Kc(De),mt?_0(De.toString(),ue):op(De.toString(),ue)}else qr(2);R.G=0,R.l&&R.l.sa(K),su(R),dc(R)}e.fb=function(R){R?(this.j.info("Successfully pinged google.com"),qr(2)):(this.j.info("Failed to ping google.com"),qr(1))};function su(R){if(R.G=0,R.ka=[],R.l){const K=Ms(R.h);(K.length!=0||R.i.length!=0)&&(te(R.ka,K),te(R.ka,R.i),R.h.i.length=0,ie(R.i),R.i.length=0),R.l.ra()}}function vd(R,K,ue){var De=ue instanceof Nn?Uo(ue):new Nn(ue);if(De.g!="")K&&(De.g=K+"."+De.g),Xc(De,De.s);else{var mt=x.location;De=mt.protocol,K=K?K+"."+mt.hostname:mt.hostname,mt=+mt.port;var kt=new Nn(null);De&&sa(kt,De),K&&(kt.g=K),mt&&Xc(kt,mt),ue&&(kt.l=ue),De=kt}return ue=R.D,K=R.ya,ue&&K&&fi(De,ue,K),fi(De,"VER",R.la),Ya(R,De),De}function ou(R,K,ue){if(K&&!R.J)throw Error("Can't create secondary domain capable XhrIo object.");return K=R.Ca&&!R.pa?new pi(new eu({eb:ue})):new pi(R.pa),K.Ha(R.J),K}e.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ja(){}e=Ja.prototype,e.ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){};function Al(){}Al.prototype.g=function(R,K){return new ds(R,K)};function ds(R,K){Wt.call(this),this.g=new ks(K),this.l=R,this.h=K&&K.messageUrlParams||null,R=K&&K.messageHeaders||null,K&&K.clientProtocolHeaderRequired&&(R?R["X-Client-Protocol"]="webchannel":R={"X-Client-Protocol":"webchannel"}),this.g.o=R,R=K&&K.initMessageHeaders||null,K&&K.messageContentType&&(R?R["X-WebChannel-Content-Type"]=K.messageContentType:R={"X-WebChannel-Content-Type":K.messageContentType}),K&&K.va&&(R?R["X-WebChannel-Client-Profile"]=K.va:R={"X-WebChannel-Client-Profile":K.va}),this.g.S=R,(R=K&&K.Sb)&&!X(R)&&(this.g.m=R),this.v=K&&K.supportsCrossDomainXhr||!1,this.u=K&&K.sendRawJson||!1,(K=K&&K.httpSessionIdParam)&&!X(K)&&(this.g.D=K,R=this.h,R!==null&&K in R&&(R=this.h,K in R&&delete R[K])),this.j=new el(this)}Q(ds,Wt),ds.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ds.prototype.close=function(){yd(this.g)},ds.prototype.o=function(R){var K=this.g;if(typeof R=="string"){var ue={};ue.__data__=R,R=ue}else this.u&&(ue={},ue.__data__=En(R),R=ue);K.i.push(new dn(K.Ya++,R)),K.G==3&&Pa(K)},ds.prototype.N=function(){this.g.l=null,delete this.j,yd(this.g),delete this.g,ds.aa.N.call(this)};function au(R){ir.call(this),R.__headers__&&(this.headers=R.__headers__,this.statusCode=R.__status__,delete R.__headers__,delete R.__status__);var K=R.__sm__;if(K){e:{for(const ue in K){R=ue;break e}R=void 0}(this.i=R)&&(R=this.i,K=K!==null&&R in K?K[R]:void 0),this.data=K}else this.data=R}Q(au,ir);function lu(){oi.call(this),this.status=1}Q(lu,oi);function el(R){this.g=R}Q(el,Ja),el.prototype.ua=function(){pn(this.g,"a")},el.prototype.ta=function(R){pn(this.g,new au(R))},el.prototype.sa=function(R){pn(this.g,new lu)},el.prototype.ra=function(){pn(this.g,"b")},Al.prototype.createWebChannel=Al.prototype.g,ds.prototype.send=ds.prototype.o,ds.prototype.open=ds.prototype.m,ds.prototype.close=ds.prototype.close,HG=function(){return new Al},WG=function(){return Rs()},GG=Fi,Tk={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ve.NO_ERROR=0,Ve.TIMEOUT=8,Ve.HTTP_ERROR=6,ME=Ve,ne.COMPLETE="complete",qG=ne,Ca.EventType=an,an.OPEN="a",an.CLOSE="b",an.ERROR="c",an.MESSAGE="d",Wt.prototype.listen=Wt.prototype.K,d1=Ca,$G=eu,pi.prototype.listenOnce=pi.prototype.L,pi.prototype.getLastError=pi.prototype.Ka,pi.prototype.getLastErrorCode=pi.prototype.Ba,pi.prototype.getStatus=pi.prototype.Z,pi.prototype.getResponseJson=pi.prototype.Oa,pi.prototype.getResponseText=pi.prototype.oa,pi.prototype.send=pi.prototype.ea,pi.prototype.setWithCredentials=pi.prototype.Ha,VG=pi}).apply(typeof ZT!="undefined"?ZT:typeof self!="undefined"?self:typeof window!="undefined"?window:{});const sU="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Yo.UNAUTHENTICATED=new Yo(null),Yo.GOOGLE_CREDENTIALS=new Yo("google-credentials-uid"),Yo.FIRST_PARTY=new Yo("first-party-uid"),Yo.MOCK_USER=new Yo("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let s0="10.13.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gm=new iO("@firebase/firestore");function Xv(){return Gm.logLevel}function Hn(e,...t){if(Gm.logLevel<=ni.DEBUG){const r=t.map(yO);Gm.debug(`Firestore (${s0}): ${e}`,...r)}}function Jh(e,...t){if(Gm.logLevel<=ni.ERROR){const r=t.map(yO);Gm.error(`Firestore (${s0}): ${e}`,...r)}}function Dy(e,...t){if(Gm.logLevel<=ni.WARN){const r=t.map(yO);Gm.warn(`Firestore (${s0}): ${e}`,...r)}}function yO(e){if(typeof e=="string")return e;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(e)}catch(t){return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sr(e="Unexpected state"){const t=`FIRESTORE (${s0}) INTERNAL ASSERTION FAILED: `+e;throw Jh(t),new Error(t)}function qi(e,t){e||Sr()}function Rr(e,t){return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const en={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ln extends Ku{constructor(t,r){super(t,r),this.code=t,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qh{constructor(){this.promise=new Promise((t,r)=>{this.resolve=t,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZG{constructor(t,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class ude{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,r){t.enqueueRetryable(()=>r(Yo.UNAUTHENTICATED))}shutdown(){}}class hde{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,r){this.changeListener=r,t.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class dde{constructor(t){this.t=t,this.currentUser=Yo.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,r){let s=this.i;const c=a=>this.i!==s?(s=this.i,r(a)):Promise.resolve();let f=new qh;this.o=()=>{this.i++,this.currentUser=this.u(),f.resolve(),f=new qh,t.enqueueRetryable(()=>c(this.currentUser))};const _=()=>{const a=f;t.enqueueRetryable(()=>Be(this,null,function*(){yield a.promise,yield c(this.currentUser)}))},x=a=>{Hn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.auth.addAuthTokenListener(this.o),_()};this.t.onInit(a=>x(a)),setTimeout(()=>{if(!this.auth){const a=this.t.getImmediate({optional:!0});a?x(a):(Hn("FirebaseAuthCredentialsProvider","Auth not yet detected"),f.resolve(),f=new qh)}},0),_()}getToken(){const t=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(s=>this.i!==t?(Hn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(qi(typeof s.accessToken=="string"),new ZG(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return qi(t===null||typeof t=="string"),new Yo(t)}}class fde{constructor(t,r,s){this.l=t,this.h=r,this.P=s,this.type="FirstParty",this.user=Yo.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class pde{constructor(t,r,s){this.l=t,this.h=r,this.P=s}getToken(){return Promise.resolve(new fde(this.l,this.h,this.P))}start(t,r){t.enqueueRetryable(()=>r(Yo.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class mde{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class gde{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,r){const s=f=>{f.error!=null&&Hn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${f.error.message}`);const _=f.token!==this.R;return this.R=f.token,Hn("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?r(f.token):Promise.resolve()};this.o=f=>{t.enqueueRetryable(()=>s(f))};const c=f=>{Hn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=f,this.appCheck.addTokenListener(this.o)};this.A.onInit(f=>c(f)),setTimeout(()=>{if(!this.appCheck){const f=this.A.getImmediate({optional:!0});f?c(f):Hn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(r=>r?(qi(typeof r.token=="string"),this.R=r.token,new mde(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _de(e){const t=typeof self!="undefined"&&(self.crypto||self.msCrypto),r=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(r);else for(let s=0;s<e;s++)r[s]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XG{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/t.length)*t.length;let s="";for(;s.length<20;){const c=_de(40);for(let f=0;f<c.length;++f)s.length<20&&c[f]<r&&(s+=t.charAt(c[f]%t.length))}return s}}function hi(e,t){return e<t?-1:e>t?1:0}function Oy(e,t,r){return e.length===t.length&&e.every((s,c)=>r(s,t[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yo{constructor(t,r){if(this.seconds=t,this.nanoseconds=r,r<0)throw new Ln(en.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new Ln(en.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(t<-62135596800)throw new Ln(en.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ln(en.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return yo.fromMillis(Date.now())}static fromDate(t){return yo.fromMillis(t.getTime())}static fromMillis(t){const r=Math.floor(t/1e3),s=Math.floor(1e6*(t-1e3*r));return new yo(r,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?hi(this.nanoseconds,t.nanoseconds):hi(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Pr(t)}static min(){return new Pr(new yo(0,0))}static max(){return new Pr(new yo(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx{constructor(t,r,s){r===void 0?r=0:r>t.length&&Sr(),s===void 0?s=t.length-r:s>t.length-r&&Sr(),this.segments=t,this.offset=r,this.len=s}get length(){return this.len}isEqual(t){return Sx.comparator(this,t)===0}child(t){const r=this.segments.slice(this.offset,this.limit());return t instanceof Sx?t.forEach(s=>{r.push(s)}):r.push(t),this.construct(r)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==t.get(r))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==t.get(r))return!1;return!0}forEach(t){for(let r=this.offset,s=this.limit();r<s;r++)t(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,r){const s=Math.min(t.length,r.length);for(let c=0;c<s;c++){const f=t.get(c),_=r.get(c);if(f<_)return-1;if(f>_)return 1}return t.length<r.length?-1:t.length>r.length?1:0}}class os extends Sx{construct(t,r,s){return new os(t,r,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const r=[];for(const s of t){if(s.indexOf("//")>=0)throw new Ln(en.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);r.push(...s.split("/").filter(c=>c.length>0))}return new os(r)}static emptyPath(){return new os([])}}const yde=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Oo extends Sx{construct(t,r,s){return new Oo(t,r,s)}static isValidIdentifier(t){return yde.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Oo.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Oo(["__name__"])}static fromServerFormat(t){const r=[];let s="",c=0;const f=()=>{if(s.length===0)throw new Ln(en.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(s),s=""};let _=!1;for(;c<t.length;){const x=t[c];if(x==="\\"){if(c+1===t.length)throw new Ln(en.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const a=t[c+1];if(a!=="\\"&&a!=="."&&a!=="`")throw new Ln(en.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);s+=a,c+=2}else x==="`"?(_=!_,c++):x!=="."||_?(s+=x,c++):(f(),c++)}if(f(),_)throw new Ln(en.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Oo(r)}static emptyPath(){return new Oo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{constructor(t){this.path=t}static fromPath(t){return new ar(os.fromString(t))}static fromName(t){return new ar(os.fromString(t).popFirst(5))}static empty(){return new ar(os.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&os.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,r){return os.comparator(t.path,r.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ar(new os(t.slice()))}}function vde(e,t){const r=e.toTimestamp().seconds,s=e.toTimestamp().nanoseconds+1,c=Pr.fromTimestamp(s===1e9?new yo(r+1,0):new yo(r,s));return new Uf(c,ar.empty(),t)}function xde(e){return new Uf(e.readTime,e.key,-1)}class Uf{constructor(t,r,s){this.readTime=t,this.documentKey=r,this.largestBatchId=s}static min(){return new Uf(Pr.min(),ar.empty(),-1)}static max(){return new Uf(Pr.max(),ar.empty(),-1)}}function bde(e,t){let r=e.readTime.compareTo(t.readTime);return r!==0?r:(r=ar.comparator(e.documentKey,t.documentKey),r!==0?r:hi(e.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wde="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Tde{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hb(e){return Be(this,null,function*(){if(e.code!==en.FAILED_PRECONDITION||e.message!==wde)throw e;Hn("LocalStore","Unexpectedly lost primary lease")})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(t){return this.next(void 0,t)}next(t,r){return this.callbackAttached&&Sr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(t,this.result):new on((s,c)=>{this.nextCallback=f=>{this.wrapSuccess(t,f).next(s,c)},this.catchCallback=f=>{this.wrapFailure(r,f).next(s,c)}})}toPromise(){return new Promise((t,r)=>{this.next(t,r)})}wrapUserFunction(t){try{const r=t();return r instanceof on?r:on.resolve(r)}catch(r){return on.reject(r)}}wrapSuccess(t,r){return t?this.wrapUserFunction(()=>t(r)):on.resolve(r)}wrapFailure(t,r){return t?this.wrapUserFunction(()=>t(r)):on.reject(r)}static resolve(t){return new on((r,s)=>{r(t)})}static reject(t){return new on((r,s)=>{s(t)})}static waitFor(t){return new on((r,s)=>{let c=0,f=0,_=!1;t.forEach(x=>{++c,x.next(()=>{++f,_&&f===c&&r()},a=>s(a))}),_=!0,f===c&&r()})}static or(t){let r=on.resolve(!1);for(const s of t)r=r.next(c=>c?on.resolve(c):s());return r}static forEach(t,r){const s=[];return t.forEach((c,f)=>{s.push(r.call(this,c,f))}),this.waitFor(s)}static mapArray(t,r){return new on((s,c)=>{const f=t.length,_=new Array(f);let x=0;for(let a=0;a<f;a++){const I=a;r(t[I]).next(D=>{_[I]=D,++x,x===f&&s(_)},D=>c(D))}})}static doWhile(t,r){return new on((s,c)=>{const f=()=>{t()===!0?r().next(()=>{f()},c):s()};f()})}}function Ede(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function db(e){return e.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vO{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=s=>this.ie(s),this.se=s=>r.writeSequenceNumber(s))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}vO.oe=-1;function uC(e){return e==null}function LS(e){return e===0&&1/e==-1/0}function Sde(e){return typeof e=="number"&&Number.isInteger(e)&&!LS(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oU(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function hg(e,t){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function KG(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(t,r){this.comparator=t,this.root=r||ko.EMPTY}insert(t,r){return new Cs(this.comparator,this.root.insert(t,r,this.comparator).copy(null,null,ko.BLACK,null,null))}remove(t){return new Cs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ko.BLACK,null,null))}get(t){let r=this.root;for(;!r.isEmpty();){const s=this.comparator(t,r.key);if(s===0)return r.value;s<0?r=r.left:s>0&&(r=r.right)}return null}indexOf(t){let r=0,s=this.root;for(;!s.isEmpty();){const c=this.comparator(t,s.key);if(c===0)return r+s.left.size;c<0?s=s.left:(r+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((r,s)=>(t(r,s),!1))}toString(){const t=[];return this.inorderTraversal((r,s)=>(t.push(`${r}:${s}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new XT(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new XT(this.root,t,this.comparator,!1)}getReverseIterator(){return new XT(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new XT(this.root,t,this.comparator,!0)}}class XT{constructor(t,r,s,c){this.isReverse=c,this.nodeStack=[];let f=1;for(;!t.isEmpty();)if(f=r?s(t.key,r):1,r&&c&&(f*=-1),f<0)t=this.isReverse?t.left:t.right;else{if(f===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const r={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ko{constructor(t,r,s,c,f){this.key=t,this.value=r,this.color=s!=null?s:ko.RED,this.left=c!=null?c:ko.EMPTY,this.right=f!=null?f:ko.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,s,c,f){return new ko(t!=null?t:this.key,r!=null?r:this.value,s!=null?s:this.color,c!=null?c:this.left,f!=null?f:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,s){let c=this;const f=s(t,c.key);return c=f<0?c.copy(null,null,null,c.left.insert(t,r,s),null):f===0?c.copy(null,r,null,null,null):c.copy(null,null,null,null,c.right.insert(t,r,s)),c.fixUp()}removeMin(){if(this.left.isEmpty())return ko.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let s,c=this;if(r(t,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(t,r),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),r(t,c.key)===0){if(c.right.isEmpty())return ko.EMPTY;s=c.right.min(),c=c.copy(s.key,s.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(t,r))}return c.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ko.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ko.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Sr();const t=this.left.check();if(t!==this.right.check())throw Sr();return t+(this.isRed()?0:1)}}ko.EMPTY=null,ko.RED=!0,ko.BLACK=!1;ko.EMPTY=new class{constructor(){this.size=0}get key(){throw Sr()}get value(){throw Sr()}get color(){throw Sr()}get left(){throw Sr()}get right(){throw Sr()}copy(t,r,s,c,f){return this}insert(t,r,s){return new ko(t,r)}remove(t,r){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(t){this.comparator=t,this.data=new Cs(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((r,s)=>(t(r),!1))}forEachInRange(t,r){const s=this.data.getIteratorFrom(t[0]);for(;s.hasNext();){const c=s.getNext();if(this.comparator(c.key,t[1])>=0)return;r(c.key)}}forEachWhile(t,r){let s;for(s=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();s.hasNext();)if(!t(s.getNext().key))return}firstAfterOrEqual(t){const r=this.data.getIteratorFrom(t);return r.hasNext()?r.getNext().key:null}getIterator(){return new aU(this.data.getIterator())}getIteratorFrom(t){return new aU(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let r=this;return r.size<t.size&&(r=t,t=this),t.forEach(s=>{r=r.add(s)}),r}isEqual(t){if(!(t instanceof zo)||this.size!==t.size)return!1;const r=this.data.getIterator(),s=t.data.getIterator();for(;r.hasNext();){const c=r.getNext().key,f=s.getNext().key;if(this.comparator(c,f)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(r=>{t.push(r)}),t}toString(){const t=[];return this.forEach(r=>t.push(r)),"SortedSet("+t.toString()+")"}copy(t){const r=new zo(this.comparator);return r.data=t,r}}class aU{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(t){this.fields=t,t.sort(Oo.comparator)}static empty(){return new fl([])}unionWith(t){let r=new zo(Oo.comparator);for(const s of this.fields)r=r.add(s);for(const s of t)r=r.add(s);return new fl(r.toArray())}covers(t){for(const r of this.fields)if(r.isPrefixOf(t))return!0;return!1}isEqual(t){return Oy(this.fields,t.fields,(r,s)=>r.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QG extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(t){this.binaryString=t}static fromBase64String(t){const r=function(c){try{return atob(c)}catch(f){throw typeof DOMException!="undefined"&&f instanceof DOMException?new QG("Invalid base64 string: "+f):f}}(t);return new Fo(r)}static fromUint8Array(t){const r=function(c){let f="";for(let _=0;_<c.length;++_)f+=String.fromCharCode(c[_]);return f}(t);return new Fo(r)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const s=new Uint8Array(r.length);for(let c=0;c<r.length;c++)s[c]=r.charCodeAt(c);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return hi(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Fo.EMPTY_BYTE_STRING=new Fo("");const Ide=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Vf(e){if(qi(!!e),typeof e=="string"){let t=0;const r=Ide.exec(e);if(qi(!!r),r[1]){let c=r[1];c=(c+"000000000").substr(0,9),t=Number(c)}const s=new Date(e);return{seconds:Math.floor(s.getTime()/1e3),nanos:t}}return{seconds:Hs(e.seconds),nanos:Hs(e.nanos)}}function Hs(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function Wm(e){return typeof e=="string"?Fo.fromBase64String(e):Fo.fromUint8Array(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xO(e){var t,r;return((r=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function bO(e){const t=e.mapValue.fields.__previous_value__;return xO(t)?bO(t):t}function Ix(e){const t=Vf(e.mapValue.fields.__local_write_time__.timestampValue);return new yo(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cde{constructor(t,r,s,c,f,_,x,a,I){this.databaseId=t,this.appId=r,this.persistenceKey=s,this.host=c,this.ssl=f,this.forceLongPolling=_,this.autoDetectLongPolling=x,this.longPollingOptions=a,this.useFetchStreams=I}}class Cx{constructor(t,r){this.projectId=t,this.database=r||"(default)"}static empty(){return new Cx("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof Cx&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KT={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Hm(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?xO(e)?4:Pde(e)?9007199254740991:Ade(e)?10:11:Sr()}function Wu(e,t){if(e===t)return!0;const r=Hm(e);if(r!==Hm(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ix(e).isEqual(Ix(t));case 3:return function(c,f){if(typeof c.timestampValue=="string"&&typeof f.timestampValue=="string"&&c.timestampValue.length===f.timestampValue.length)return c.timestampValue===f.timestampValue;const _=Vf(c.timestampValue),x=Vf(f.timestampValue);return _.seconds===x.seconds&&_.nanos===x.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(c,f){return Wm(c.bytesValue).isEqual(Wm(f.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(c,f){return Hs(c.geoPointValue.latitude)===Hs(f.geoPointValue.latitude)&&Hs(c.geoPointValue.longitude)===Hs(f.geoPointValue.longitude)}(e,t);case 2:return function(c,f){if("integerValue"in c&&"integerValue"in f)return Hs(c.integerValue)===Hs(f.integerValue);if("doubleValue"in c&&"doubleValue"in f){const _=Hs(c.doubleValue),x=Hs(f.doubleValue);return _===x?LS(_)===LS(x):isNaN(_)&&isNaN(x)}return!1}(e,t);case 9:return Oy(e.arrayValue.values||[],t.arrayValue.values||[],Wu);case 10:case 11:return function(c,f){const _=c.mapValue.fields||{},x=f.mapValue.fields||{};if(oU(_)!==oU(x))return!1;for(const a in _)if(_.hasOwnProperty(a)&&(x[a]===void 0||!Wu(_[a],x[a])))return!1;return!0}(e,t);default:return Sr()}}function Ax(e,t){return(e.values||[]).find(r=>Wu(r,t))!==void 0}function Ly(e,t){if(e===t)return 0;const r=Hm(e),s=Hm(t);if(r!==s)return hi(r,s);switch(r){case 0:case 9007199254740991:return 0;case 1:return hi(e.booleanValue,t.booleanValue);case 2:return function(f,_){const x=Hs(f.integerValue||f.doubleValue),a=Hs(_.integerValue||_.doubleValue);return x<a?-1:x>a?1:x===a?0:isNaN(x)?isNaN(a)?0:-1:1}(e,t);case 3:return lU(e.timestampValue,t.timestampValue);case 4:return lU(Ix(e),Ix(t));case 5:return hi(e.stringValue,t.stringValue);case 6:return function(f,_){const x=Wm(f),a=Wm(_);return x.compareTo(a)}(e.bytesValue,t.bytesValue);case 7:return function(f,_){const x=f.split("/"),a=_.split("/");for(let I=0;I<x.length&&I<a.length;I++){const D=hi(x[I],a[I]);if(D!==0)return D}return hi(x.length,a.length)}(e.referenceValue,t.referenceValue);case 8:return function(f,_){const x=hi(Hs(f.latitude),Hs(_.latitude));return x!==0?x:hi(Hs(f.longitude),Hs(_.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return cU(e.arrayValue,t.arrayValue);case 10:return function(f,_){var x,a,I,D;const O=f.fields||{},F=_.fields||{},H=(x=O.value)===null||x===void 0?void 0:x.arrayValue,Q=(a=F.value)===null||a===void 0?void 0:a.arrayValue,ie=hi(((I=H==null?void 0:H.values)===null||I===void 0?void 0:I.length)||0,((D=Q==null?void 0:Q.values)===null||D===void 0?void 0:D.length)||0);return ie!==0?ie:cU(H,Q)}(e.mapValue,t.mapValue);case 11:return function(f,_){if(f===KT.mapValue&&_===KT.mapValue)return 0;if(f===KT.mapValue)return 1;if(_===KT.mapValue)return-1;const x=f.fields||{},a=Object.keys(x),I=_.fields||{},D=Object.keys(I);a.sort(),D.sort();for(let O=0;O<a.length&&O<D.length;++O){const F=hi(a[O],D[O]);if(F!==0)return F;const H=Ly(x[a[O]],I[D[O]]);if(H!==0)return H}return hi(a.length,D.length)}(e.mapValue,t.mapValue);default:throw Sr()}}function lU(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return hi(e,t);const r=Vf(e),s=Vf(t),c=hi(r.seconds,s.seconds);return c!==0?c:hi(r.nanos,s.nanos)}function cU(e,t){const r=e.values||[],s=t.values||[];for(let c=0;c<r.length&&c<s.length;++c){const f=Ly(r[c],s[c]);if(f)return f}return hi(r.length,s.length)}function zy(e){return Ek(e)}function Ek(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(r){const s=Vf(r);return`time(${s.seconds},${s.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(r){return Wm(r).toBase64()}(e.bytesValue):"referenceValue"in e?function(r){return ar.fromName(r).toString()}(e.referenceValue):"geoPointValue"in e?function(r){return`geo(${r.latitude},${r.longitude})`}(e.geoPointValue):"arrayValue"in e?function(r){let s="[",c=!0;for(const f of r.values||[])c?c=!1:s+=",",s+=Ek(f);return s+"]"}(e.arrayValue):"mapValue"in e?function(r){const s=Object.keys(r.fields||{}).sort();let c="{",f=!0;for(const _ of s)f?f=!1:c+=",",c+=`${_}:${Ek(r.fields[_])}`;return c+"}"}(e.mapValue):Sr()}function uU(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Sk(e){return!!e&&"integerValue"in e}function wO(e){return!!e&&"arrayValue"in e}function hU(e){return!!e&&"nullValue"in e}function dU(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function kE(e){return!!e&&"mapValue"in e}function Ade(e){var t,r;return((r=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function F1(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return hg(e.mapValue.fields,(r,s)=>t.mapValue.fields[r]=F1(s)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=F1(e.arrayValue.values[r]);return t}return Object.assign({},e)}function Pde(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Va{constructor(t){this.value=t}static empty(){return new Va({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let r=this.value;for(let s=0;s<t.length-1;++s)if(r=(r.mapValue.fields||{})[t.get(s)],!kE(r))return null;return r=(r.mapValue.fields||{})[t.lastSegment()],r||null}}set(t,r){this.getFieldsMap(t.popLast())[t.lastSegment()]=F1(r)}setAll(t){let r=Oo.emptyPath(),s={},c=[];t.forEach((_,x)=>{if(!r.isImmediateParentOf(x)){const a=this.getFieldsMap(r);this.applyChanges(a,s,c),s={},c=[],r=x.popLast()}_?s[x.lastSegment()]=F1(_):c.push(x.lastSegment())});const f=this.getFieldsMap(r);this.applyChanges(f,s,c)}delete(t){const r=this.field(t.popLast());kE(r)&&r.mapValue.fields&&delete r.mapValue.fields[t.lastSegment()]}isEqual(t){return Wu(this.value,t.value)}getFieldsMap(t){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let s=0;s<t.length;++s){let c=r.mapValue.fields[t.get(s)];kE(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},r.mapValue.fields[t.get(s)]=c),r=c}return r.mapValue.fields}applyChanges(t,r,s){hg(r,(c,f)=>t[c]=f);for(const c of s)delete t[c]}clone(){return new Va(F1(this.value))}}function YG(e){const t=[];return hg(e.fields,(r,s)=>{const c=new Oo([r]);if(kE(s)){const f=YG(s.mapValue).fields;if(f.length===0)t.push(c);else for(const _ of f)t.push(c.child(_))}else t.push(c)}),new fl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(t,r,s,c,f,_,x){this.key=t,this.documentType=r,this.version=s,this.readTime=c,this.createTime=f,this.data=_,this.documentState=x}static newInvalidDocument(t){return new ea(t,0,Pr.min(),Pr.min(),Pr.min(),Va.empty(),0)}static newFoundDocument(t,r,s,c){return new ea(t,1,r,Pr.min(),s,c,0)}static newNoDocument(t,r){return new ea(t,2,r,Pr.min(),Pr.min(),Va.empty(),0)}static newUnknownDocument(t,r){return new ea(t,3,r,Pr.min(),Pr.min(),Va.empty(),2)}convertToFoundDocument(t,r){return!this.createTime.isEqual(Pr.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Va.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Va.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Pr.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ea&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ea(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zS{constructor(t,r){this.position=t,this.inclusive=r}}function fU(e,t,r){let s=0;for(let c=0;c<e.position.length;c++){const f=t[c],_=e.position[c];if(f.field.isKeyField()?s=ar.comparator(ar.fromName(_.referenceValue),r.key):s=Ly(_,r.data.field(f.field)),f.dir==="desc"&&(s*=-1),s!==0)break}return s}function pU(e,t){if(e===null)return t===null;if(t===null||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!Wu(e.position[r],t.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Px{constructor(t,r="asc"){this.field=t,this.dir=r}}function Rde(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let JG=class{};class so extends JG{constructor(t,r,s){super(),this.field=t,this.op=r,this.value=s}static create(t,r,s){return t.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(t,r,s):new kde(t,r,s):r==="array-contains"?new Lde(t,s):r==="in"?new zde(t,s):r==="not-in"?new Nde(t,s):r==="array-contains-any"?new Fde(t,s):new so(t,r,s)}static createKeyFieldInFilter(t,r,s){return r==="in"?new Dde(t,s):new Ode(t,s)}matches(t){const r=t.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(Ly(r,this.value)):r!==null&&Hm(this.value)===Hm(r)&&this.matchesComparison(Ly(r,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Sr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Hc extends JG{constructor(t,r){super(),this.filters=t,this.op=r,this.ae=null}static create(t,r){return new Hc(t,r)}matches(t){return eW(this)?this.filters.find(r=>!r.matches(t))===void 0:this.filters.find(r=>r.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,r)=>t.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function eW(e){return e.op==="and"}function tW(e){return Mde(e)&&eW(e)}function Mde(e){for(const t of e.filters)if(t instanceof Hc)return!1;return!0}function Ik(e){if(e instanceof so)return e.field.canonicalString()+e.op.toString()+zy(e.value);if(tW(e))return e.filters.map(t=>Ik(t)).join(",");{const t=e.filters.map(r=>Ik(r)).join(",");return`${e.op}(${t})`}}function nW(e,t){return e instanceof so?function(s,c){return c instanceof so&&s.op===c.op&&s.field.isEqual(c.field)&&Wu(s.value,c.value)}(e,t):e instanceof Hc?function(s,c){return c instanceof Hc&&s.op===c.op&&s.filters.length===c.filters.length?s.filters.reduce((f,_,x)=>f&&nW(_,c.filters[x]),!0):!1}(e,t):void Sr()}function rW(e){return e instanceof so?function(r){return`${r.field.canonicalString()} ${r.op} ${zy(r.value)}`}(e):e instanceof Hc?function(r){return r.op.toString()+" {"+r.getFilters().map(rW).join(" ,")+"}"}(e):"Filter"}class kde extends so{constructor(t,r,s){super(t,r,s),this.key=ar.fromName(s.referenceValue)}matches(t){const r=ar.comparator(t.key,this.key);return this.matchesComparison(r)}}class Dde extends so{constructor(t,r){super(t,"in",r),this.keys=iW("in",r)}matches(t){return this.keys.some(r=>r.isEqual(t.key))}}class Ode extends so{constructor(t,r){super(t,"not-in",r),this.keys=iW("not-in",r)}matches(t){return!this.keys.some(r=>r.isEqual(t.key))}}function iW(e,t){var r;return(((r=t.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(s=>ar.fromName(s.referenceValue))}class Lde extends so{constructor(t,r){super(t,"array-contains",r)}matches(t){const r=t.data.field(this.field);return wO(r)&&Ax(r.arrayValue,this.value)}}class zde extends so{constructor(t,r){super(t,"in",r)}matches(t){const r=t.data.field(this.field);return r!==null&&Ax(this.value.arrayValue,r)}}class Nde extends so{constructor(t,r){super(t,"not-in",r)}matches(t){if(Ax(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=t.data.field(this.field);return r!==null&&!Ax(this.value.arrayValue,r)}}class Fde extends so{constructor(t,r){super(t,"array-contains-any",r)}matches(t){const r=t.data.field(this.field);return!(!wO(r)||!r.arrayValue.values)&&r.arrayValue.values.some(s=>Ax(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bde{constructor(t,r=null,s=[],c=[],f=null,_=null,x=null){this.path=t,this.collectionGroup=r,this.orderBy=s,this.filters=c,this.limit=f,this.startAt=_,this.endAt=x,this.ue=null}}function mU(e,t=null,r=[],s=[],c=null,f=null,_=null){return new Bde(e,t,r,s,c,f,_)}function TO(e){const t=Rr(e);if(t.ue===null){let r=t.path.canonicalString();t.collectionGroup!==null&&(r+="|cg:"+t.collectionGroup),r+="|f:",r+=t.filters.map(s=>Ik(s)).join(","),r+="|ob:",r+=t.orderBy.map(s=>function(f){return f.field.canonicalString()+f.dir}(s)).join(","),uC(t.limit)||(r+="|l:",r+=t.limit),t.startAt&&(r+="|lb:",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>zy(s)).join(",")),t.endAt&&(r+="|ub:",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>zy(s)).join(",")),t.ue=r}return t.ue}function EO(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!Rde(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!nW(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!pU(e.startAt,t.startAt)&&pU(e.endAt,t.endAt)}function Ck(e){return ar.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(t,r=null,s=[],c=[],f=null,_="F",x=null,a=null){this.path=t,this.collectionGroup=r,this.explicitOrderBy=s,this.filters=c,this.limit=f,this.limitType=_,this.startAt=x,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function jde(e,t,r,s,c,f,_,x){return new o0(e,t,r,s,c,f,_,x)}function hC(e){return new o0(e)}function gU(e){return e.filters.length===0&&e.limit===null&&e.startAt==null&&e.endAt==null&&(e.explicitOrderBy.length===0||e.explicitOrderBy.length===1&&e.explicitOrderBy[0].field.isKeyField())}function sW(e){return e.collectionGroup!==null}function B1(e){const t=Rr(e);if(t.ce===null){t.ce=[];const r=new Set;for(const f of t.explicitOrderBy)t.ce.push(f),r.add(f.field.canonicalString());const s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(_){let x=new zo(Oo.comparator);return _.filters.forEach(a=>{a.getFlattenedFilters().forEach(I=>{I.isInequality()&&(x=x.add(I.field))})}),x})(t).forEach(f=>{r.has(f.canonicalString())||f.isKeyField()||t.ce.push(new Px(f,s))}),r.has(Oo.keyField().canonicalString())||t.ce.push(new Px(Oo.keyField(),s))}return t.ce}function Vu(e){const t=Rr(e);return t.le||(t.le=Ude(t,B1(e))),t.le}function Ude(e,t){if(e.limitType==="F")return mU(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(c=>{const f=c.dir==="desc"?"asc":"desc";return new Px(c.field,f)});const r=e.endAt?new zS(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new zS(e.startAt.position,e.startAt.inclusive):null;return mU(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}}function Ak(e,t){const r=e.filters.concat([t]);return new o0(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function NS(e,t,r){return new o0(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function dC(e,t){return EO(Vu(e),Vu(t))&&e.limitType===t.limitType}function oW(e){return`${TO(Vu(e))}|lt:${e.limitType}`}function L_(e){return`Query(target=${function(r){let s=r.path.canonicalString();return r.collectionGroup!==null&&(s+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(s+=`, filters: [${r.filters.map(c=>rW(c)).join(", ")}]`),uC(r.limit)||(s+=", limit: "+r.limit),r.orderBy.length>0&&(s+=`, orderBy: [${r.orderBy.map(c=>function(_){return`${_.field.canonicalString()} (${_.dir})`}(c)).join(", ")}]`),r.startAt&&(s+=", startAt: ",s+=r.startAt.inclusive?"b:":"a:",s+=r.startAt.position.map(c=>zy(c)).join(",")),r.endAt&&(s+=", endAt: ",s+=r.endAt.inclusive?"a:":"b:",s+=r.endAt.position.map(c=>zy(c)).join(",")),`Target(${s})`}(Vu(e))}; limitType=${e.limitType})`}function fC(e,t){return t.isFoundDocument()&&function(s,c){const f=c.key.path;return s.collectionGroup!==null?c.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(f):ar.isDocumentKey(s.path)?s.path.isEqual(f):s.path.isImmediateParentOf(f)}(e,t)&&function(s,c){for(const f of B1(s))if(!f.field.isKeyField()&&c.data.field(f.field)===null)return!1;return!0}(e,t)&&function(s,c){for(const f of s.filters)if(!f.matches(c))return!1;return!0}(e,t)&&function(s,c){return!(s.startAt&&!function(_,x,a){const I=fU(_,x,a);return _.inclusive?I<=0:I<0}(s.startAt,B1(s),c)||s.endAt&&!function(_,x,a){const I=fU(_,x,a);return _.inclusive?I>=0:I>0}(s.endAt,B1(s),c))}(e,t)}function Vde(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function aW(e){return(t,r)=>{let s=!1;for(const c of B1(e)){const f=$de(c,t,r);if(f!==0)return f;s=s||c.field.isKeyField()}return 0}}function $de(e,t,r){const s=e.field.isKeyField()?ar.comparator(t.key,r.key):function(f,_,x){const a=_.data.field(f),I=x.data.field(f);return a!==null&&I!==null?Ly(a,I):Sr()}(e.field,t,r);switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return Sr()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a0{constructor(t,r){this.mapKeyFn=t,this.equalsFn=r,this.inner={},this.innerSize=0}get(t){const r=this.mapKeyFn(t),s=this.inner[r];if(s!==void 0){for(const[c,f]of s)if(this.equalsFn(c,t))return f}}has(t){return this.get(t)!==void 0}set(t,r){const s=this.mapKeyFn(t),c=this.inner[s];if(c===void 0)return this.inner[s]=[[t,r]],void this.innerSize++;for(let f=0;f<c.length;f++)if(this.equalsFn(c[f][0],t))return void(c[f]=[t,r]);c.push([t,r]),this.innerSize++}delete(t){const r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return!1;for(let c=0;c<s.length;c++)if(this.equalsFn(s[c][0],t))return s.length===1?delete this.inner[r]:s.splice(c,1),this.innerSize--,!0;return!1}forEach(t){hg(this.inner,(r,s)=>{for(const[c,f]of s)t(c,f)})}isEmpty(){return KG(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qde=new Cs(ar.comparator);function ed(){return qde}const lW=new Cs(ar.comparator);function f1(...e){let t=lW;for(const r of e)t=t.insert(r.key,r);return t}function cW(e){let t=lW;return e.forEach((r,s)=>t=t.insert(r,s.overlayedDocument)),t}function bm(){return j1()}function uW(){return j1()}function j1(){return new a0(e=>e.toString(),(e,t)=>e.isEqual(t))}const Gde=new Cs(ar.comparator),Wde=new zo(ar.comparator);function Qr(...e){let t=Wde;for(const r of e)t=t.add(r);return t}const Hde=new zo(hi);function Zde(){return Hde}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SO(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:LS(t)?"-0":t}}function hW(e){return{integerValue:""+e}}function Xde(e,t){return Sde(t)?hW(t):SO(e,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pC{constructor(){this._=void 0}}function Kde(e,t,r){return e instanceof Rx?function(c,f){const _={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return f&&xO(f)&&(f=bO(f)),f&&(_.fields.__previous_value__=f),{mapValue:_}}(r,t):e instanceof Ny?fW(e,t):e instanceof Fy?pW(e,t):function(c,f){const _=dW(c,f),x=_U(_)+_U(c.Pe);return Sk(_)&&Sk(c.Pe)?hW(x):SO(c.serializer,x)}(e,t)}function Qde(e,t,r){return e instanceof Ny?fW(e,t):e instanceof Fy?pW(e,t):r}function dW(e,t){return e instanceof FS?function(s){return Sk(s)||function(f){return!!f&&"doubleValue"in f}(s)}(t)?t:{integerValue:0}:null}class Rx extends pC{}class Ny extends pC{constructor(t){super(),this.elements=t}}function fW(e,t){const r=mW(t);for(const s of e.elements)r.some(c=>Wu(c,s))||r.push(s);return{arrayValue:{values:r}}}class Fy extends pC{constructor(t){super(),this.elements=t}}function pW(e,t){let r=mW(t);for(const s of e.elements)r=r.filter(c=>!Wu(c,s));return{arrayValue:{values:r}}}class FS extends pC{constructor(t,r){super(),this.serializer=t,this.Pe=r}}function _U(e){return Hs(e.integerValue||e.doubleValue)}function mW(e){return wO(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IO{constructor(t,r){this.field=t,this.transform=r}}function Yde(e,t){return e.field.isEqual(t.field)&&function(s,c){return s instanceof Ny&&c instanceof Ny||s instanceof Fy&&c instanceof Fy?Oy(s.elements,c.elements,Wu):s instanceof FS&&c instanceof FS?Wu(s.Pe,c.Pe):s instanceof Rx&&c instanceof Rx}(e.transform,t.transform)}class Jde{constructor(t,r){this.version=t,this.transformResults=r}}class Yl{constructor(t,r){this.updateTime=t,this.exists=r}static none(){return new Yl}static exists(t){return new Yl(void 0,t)}static updateTime(t){return new Yl(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function DE(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}class mC{}function gW(e,t){if(!e.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return e.isNoDocument()?new CO(e.key,Yl.none()):new fb(e.key,e.data,Yl.none());{const r=e.data,s=Va.empty();let c=new zo(Oo.comparator);for(let f of t.fields)if(!c.has(f)){let _=r.field(f);_===null&&f.length>1&&(f=f.popLast(),_=r.field(f)),_===null?s.delete(f):s.set(f,_),c=c.add(f)}return new rp(e.key,s,new fl(c.toArray()),Yl.none())}}function efe(e,t,r){e instanceof fb?function(c,f,_){const x=c.value.clone(),a=vU(c.fieldTransforms,f,_.transformResults);x.setAll(a),f.convertToFoundDocument(_.version,x).setHasCommittedMutations()}(e,t,r):e instanceof rp?function(c,f,_){if(!DE(c.precondition,f))return void f.convertToUnknownDocument(_.version);const x=vU(c.fieldTransforms,f,_.transformResults),a=f.data;a.setAll(_W(c)),a.setAll(x),f.convertToFoundDocument(_.version,a).setHasCommittedMutations()}(e,t,r):function(c,f,_){f.convertToNoDocument(_.version).setHasCommittedMutations()}(0,t,r)}function U1(e,t,r,s){return e instanceof fb?function(f,_,x,a){if(!DE(f.precondition,_))return x;const I=f.value.clone(),D=xU(f.fieldTransforms,a,_);return I.setAll(D),_.convertToFoundDocument(_.version,I).setHasLocalMutations(),null}(e,t,r,s):e instanceof rp?function(f,_,x,a){if(!DE(f.precondition,_))return x;const I=xU(f.fieldTransforms,a,_),D=_.data;return D.setAll(_W(f)),D.setAll(I),_.convertToFoundDocument(_.version,D).setHasLocalMutations(),x===null?null:x.unionWith(f.fieldMask.fields).unionWith(f.fieldTransforms.map(O=>O.field))}(e,t,r,s):function(f,_,x){return DE(f.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):x}(e,t,r)}function tfe(e,t){let r=null;for(const s of e.fieldTransforms){const c=t.data.field(s.field),f=dW(s.transform,c||null);f!=null&&(r===null&&(r=Va.empty()),r.set(s.field,f))}return r||null}function yU(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(s,c){return s===void 0&&c===void 0||!(!s||!c)&&Oy(s,c,(f,_)=>Yde(f,_))}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class fb extends mC{constructor(t,r,s,c=[]){super(),this.key=t,this.value=r,this.precondition=s,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class rp extends mC{constructor(t,r,s,c,f=[]){super(),this.key=t,this.data=r,this.fieldMask=s,this.precondition=c,this.fieldTransforms=f,this.type=1}getFieldMask(){return this.fieldMask}}function _W(e){const t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const s=e.data.field(r);t.set(r,s)}}),t}function vU(e,t,r){const s=new Map;qi(e.length===r.length);for(let c=0;c<r.length;c++){const f=e[c],_=f.transform,x=t.data.field(f.field);s.set(f.field,Qde(_,x,r[c]))}return s}function xU(e,t,r){const s=new Map;for(const c of e){const f=c.transform,_=r.data.field(c.field);s.set(c.field,Kde(f,_,t))}return s}class CO extends mC{constructor(t,r){super(),this.key=t,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nfe extends mC{constructor(t,r){super(),this.key=t,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rfe{constructor(t,r,s,c){this.batchId=t,this.localWriteTime=r,this.baseMutations=s,this.mutations=c}applyToRemoteDocument(t,r){const s=r.mutationResults;for(let c=0;c<this.mutations.length;c++){const f=this.mutations[c];f.key.isEqual(t.key)&&efe(f,t,s[c])}}applyToLocalView(t,r){for(const s of this.baseMutations)s.key.isEqual(t.key)&&(r=U1(s,t,r,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(t.key)&&(r=U1(s,t,r,this.localWriteTime));return r}applyToLocalDocumentSet(t,r){const s=uW();return this.mutations.forEach(c=>{const f=t.get(c.key),_=f.overlayedDocument;let x=this.applyToLocalView(_,f.mutatedFields);x=r.has(c.key)?null:x;const a=gW(_,x);a!==null&&s.set(c.key,a),_.isValidDocument()||_.convertToNoDocument(Pr.min())}),s}keys(){return this.mutations.reduce((t,r)=>t.add(r.key),Qr())}isEqual(t){return this.batchId===t.batchId&&Oy(this.mutations,t.mutations,(r,s)=>yU(r,s))&&Oy(this.baseMutations,t.baseMutations,(r,s)=>yU(r,s))}}class AO{constructor(t,r,s,c){this.batch=t,this.commitVersion=r,this.mutationResults=s,this.docVersions=c}static from(t,r,s){qi(t.mutations.length===s.length);let c=function(){return Gde}();const f=t.mutations;for(let _=0;_<f.length;_++)c=c.insert(f[_].key,s[_].version);return new AO(t,r,s,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ife{constructor(t,r){this.largestBatchId=t,this.mutation=r}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sfe{constructor(t,r){this.count=t,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var to,si;function ofe(e){switch(e){default:return Sr();case en.CANCELLED:case en.UNKNOWN:case en.DEADLINE_EXCEEDED:case en.RESOURCE_EXHAUSTED:case en.INTERNAL:case en.UNAVAILABLE:case en.UNAUTHENTICATED:return!1;case en.INVALID_ARGUMENT:case en.NOT_FOUND:case en.ALREADY_EXISTS:case en.PERMISSION_DENIED:case en.FAILED_PRECONDITION:case en.ABORTED:case en.OUT_OF_RANGE:case en.UNIMPLEMENTED:case en.DATA_LOSS:return!0}}function yW(e){if(e===void 0)return Jh("GRPC error has no .code"),en.UNKNOWN;switch(e){case to.OK:return en.OK;case to.CANCELLED:return en.CANCELLED;case to.UNKNOWN:return en.UNKNOWN;case to.DEADLINE_EXCEEDED:return en.DEADLINE_EXCEEDED;case to.RESOURCE_EXHAUSTED:return en.RESOURCE_EXHAUSTED;case to.INTERNAL:return en.INTERNAL;case to.UNAVAILABLE:return en.UNAVAILABLE;case to.UNAUTHENTICATED:return en.UNAUTHENTICATED;case to.INVALID_ARGUMENT:return en.INVALID_ARGUMENT;case to.NOT_FOUND:return en.NOT_FOUND;case to.ALREADY_EXISTS:return en.ALREADY_EXISTS;case to.PERMISSION_DENIED:return en.PERMISSION_DENIED;case to.FAILED_PRECONDITION:return en.FAILED_PRECONDITION;case to.ABORTED:return en.ABORTED;case to.OUT_OF_RANGE:return en.OUT_OF_RANGE;case to.UNIMPLEMENTED:return en.UNIMPLEMENTED;case to.DATA_LOSS:return en.DATA_LOSS;default:return Sr()}}(si=to||(to={}))[si.OK=0]="OK",si[si.CANCELLED=1]="CANCELLED",si[si.UNKNOWN=2]="UNKNOWN",si[si.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",si[si.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",si[si.NOT_FOUND=5]="NOT_FOUND",si[si.ALREADY_EXISTS=6]="ALREADY_EXISTS",si[si.PERMISSION_DENIED=7]="PERMISSION_DENIED",si[si.UNAUTHENTICATED=16]="UNAUTHENTICATED",si[si.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",si[si.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",si[si.ABORTED=10]="ABORTED",si[si.OUT_OF_RANGE=11]="OUT_OF_RANGE",si[si.UNIMPLEMENTED=12]="UNIMPLEMENTED",si[si.INTERNAL=13]="INTERNAL",si[si.UNAVAILABLE=14]="UNAVAILABLE",si[si.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function afe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lfe=new Pm([4294967295,4294967295],0);function bU(e){const t=afe().encode(e),r=new UG;return r.update(t),new Uint8Array(r.digest())}function wU(e){const t=new DataView(e.buffer),r=t.getUint32(0,!0),s=t.getUint32(4,!0),c=t.getUint32(8,!0),f=t.getUint32(12,!0);return[new Pm([r,s],0),new Pm([c,f],0)]}class PO{constructor(t,r,s){if(this.bitmap=t,this.padding=r,this.hashCount=s,r<0||r>=8)throw new p1(`Invalid padding: ${r}`);if(s<0)throw new p1(`Invalid hash count: ${s}`);if(t.length>0&&this.hashCount===0)throw new p1(`Invalid hash count: ${s}`);if(t.length===0&&r!==0)throw new p1(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*t.length-r,this.Te=Pm.fromNumber(this.Ie)}Ee(t,r,s){let c=t.add(r.multiply(Pm.fromNumber(s)));return c.compare(lfe)===1&&(c=new Pm([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;const r=bU(t),[s,c]=wU(r);for(let f=0;f<this.hashCount;f++){const _=this.Ee(s,c,f);if(!this.de(_))return!1}return!0}static create(t,r,s){const c=t%8==0?0:8-t%8,f=new Uint8Array(Math.ceil(t/8)),_=new PO(f,c,r);return s.forEach(x=>_.insert(x)),_}insert(t){if(this.Ie===0)return;const r=bU(t),[s,c]=wU(r);for(let f=0;f<this.hashCount;f++){const _=this.Ee(s,c,f);this.Ae(_)}}Ae(t){const r=Math.floor(t/8),s=t%8;this.bitmap[r]|=1<<s}}class p1 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gC{constructor(t,r,s,c,f){this.snapshotVersion=t,this.targetChanges=r,this.targetMismatches=s,this.documentUpdates=c,this.resolvedLimboDocuments=f}static createSynthesizedRemoteEventForCurrentChange(t,r,s){const c=new Map;return c.set(t,pb.createSynthesizedTargetChangeForCurrentChange(t,r,s)),new gC(Pr.min(),c,new Cs(hi),ed(),Qr())}}class pb{constructor(t,r,s,c,f){this.resumeToken=t,this.current=r,this.addedDocuments=s,this.modifiedDocuments=c,this.removedDocuments=f}static createSynthesizedTargetChangeForCurrentChange(t,r,s){return new pb(s,r,Qr(),Qr(),Qr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OE{constructor(t,r,s,c){this.Re=t,this.removedTargetIds=r,this.key=s,this.Ve=c}}class vW{constructor(t,r){this.targetId=t,this.me=r}}class xW{constructor(t,r,s=Fo.EMPTY_BYTE_STRING,c=null){this.state=t,this.targetIds=r,this.resumeToken=s,this.cause=c}}class TU{constructor(){this.fe=0,this.ge=SU(),this.pe=Fo.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}ve(){let t=Qr(),r=Qr(),s=Qr();return this.ge.forEach((c,f)=>{switch(f){case 0:t=t.add(c);break;case 2:r=r.add(c);break;case 1:s=s.add(c);break;default:Sr()}}),new pb(this.pe,this.ye,t,r,s)}Ce(){this.we=!1,this.ge=SU()}Fe(t,r){this.we=!0,this.ge=this.ge.insert(t,r)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,qi(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class cfe{constructor(t){this.Le=t,this.Be=new Map,this.ke=ed(),this.qe=EU(),this.Qe=new Cs(hi)}Ke(t){for(const r of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(r,t.Ve):this.Ue(r,t.key,t.Ve);for(const r of t.removedTargetIds)this.Ue(r,t.key,t.Ve)}We(t){this.forEachTarget(t,r=>{const s=this.Ge(r);switch(t.state){case 0:this.ze(r)&&s.De(t.resumeToken);break;case 1:s.Oe(),s.Se||s.Ce(),s.De(t.resumeToken);break;case 2:s.Oe(),s.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(s.Ne(),s.De(t.resumeToken));break;case 4:this.ze(r)&&(this.je(r),s.De(t.resumeToken));break;default:Sr()}})}forEachTarget(t,r){t.targetIds.length>0?t.targetIds.forEach(r):this.Be.forEach((s,c)=>{this.ze(c)&&r(c)})}He(t){const r=t.targetId,s=t.me.count,c=this.Je(r);if(c){const f=c.target;if(Ck(f))if(s===0){const _=new ar(f.path);this.Ue(r,_,ea.newNoDocument(_,Pr.min()))}else qi(s===1);else{const _=this.Ye(r);if(_!==s){const x=this.Ze(t),a=x?this.Xe(x,t,_):1;if(a!==0){this.je(r);const I=a===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,I)}}}}}Ze(t){const r=t.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:s="",padding:c=0},hashCount:f=0}=r;let _,x;try{_=Wm(s).toUint8Array()}catch(a){if(a instanceof QG)return Dy("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{x=new PO(_,c,f)}catch(a){return Dy(a instanceof p1?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return x.Ie===0?null:x}Xe(t,r,s){return r.me.count===s-this.nt(t,r.targetId)?0:2}nt(t,r){const s=this.Le.getRemoteKeysForTarget(r);let c=0;return s.forEach(f=>{const _=this.Le.tt(),x=`projects/${_.projectId}/databases/${_.database}/documents/${f.path.canonicalString()}`;t.mightContain(x)||(this.Ue(r,f,null),c++)}),c}rt(t){const r=new Map;this.Be.forEach((f,_)=>{const x=this.Je(_);if(x){if(f.current&&Ck(x.target)){const a=new ar(x.target.path);this.ke.get(a)!==null||this.it(_,a)||this.Ue(_,a,ea.newNoDocument(a,t))}f.be&&(r.set(_,f.ve()),f.Ce())}});let s=Qr();this.qe.forEach((f,_)=>{let x=!0;_.forEachWhile(a=>{const I=this.Je(a);return!I||I.purpose==="TargetPurposeLimboResolution"||(x=!1,!1)}),x&&(s=s.add(f))}),this.ke.forEach((f,_)=>_.setReadTime(t));const c=new gC(t,r,this.Qe,this.ke,s);return this.ke=ed(),this.qe=EU(),this.Qe=new Cs(hi),c}$e(t,r){if(!this.ze(t))return;const s=this.it(t,r.key)?2:0;this.Ge(t).Fe(r.key,s),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(t))}Ue(t,r,s){if(!this.ze(t))return;const c=this.Ge(t);this.it(t,r)?c.Fe(r,1):c.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(t)),s&&(this.ke=this.ke.insert(r,s))}removeTarget(t){this.Be.delete(t)}Ye(t){const r=this.Ge(t).ve();return this.Le.getRemoteKeysForTarget(t).size+r.addedDocuments.size-r.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let r=this.Be.get(t);return r||(r=new TU,this.Be.set(t,r)),r}st(t){let r=this.qe.get(t);return r||(r=new zo(hi),this.qe=this.qe.insert(t,r)),r}ze(t){const r=this.Je(t)!==null;return r||Hn("WatchChangeAggregator","Detected inactive target",t),r}Je(t){const r=this.Be.get(t);return r&&r.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new TU),this.Le.getRemoteKeysForTarget(t).forEach(r=>{this.Ue(t,r,null)})}it(t,r){return this.Le.getRemoteKeysForTarget(t).has(r)}}function EU(){return new Cs(ar.comparator)}function SU(){return new Cs(ar.comparator)}const ufe={asc:"ASCENDING",desc:"DESCENDING"},hfe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},dfe={and:"AND",or:"OR"};class ffe{constructor(t,r){this.databaseId=t,this.useProto3Json=r}}function Pk(e,t){return e.useProto3Json||uC(t)?t:{value:t}}function BS(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function bW(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function pfe(e,t){return BS(e,t.toTimestamp())}function $u(e){return qi(!!e),Pr.fromTimestamp(function(r){const s=Vf(r);return new yo(s.seconds,s.nanos)}(e))}function RO(e,t){return Rk(e,t).canonicalString()}function Rk(e,t){const r=function(c){return new os(["projects",c.projectId,"databases",c.database])}(e).child("documents");return t===void 0?r:r.child(t)}function wW(e){const t=os.fromString(e);return qi(CW(t)),t}function Mk(e,t){return RO(e.databaseId,t.path)}function ER(e,t){const r=wW(t);if(r.get(1)!==e.databaseId.projectId)throw new Ln(en.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new Ln(en.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new ar(EW(r))}function TW(e,t){return RO(e.databaseId,t)}function mfe(e){const t=wW(e);return t.length===4?os.emptyPath():EW(t)}function kk(e){return new os(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function EW(e){return qi(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function IU(e,t,r){return{name:Mk(e,t),fields:r.value.mapValue.fields}}function gfe(e,t){let r;if("targetChange"in t){t.targetChange;const s=function(I){return I==="NO_CHANGE"?0:I==="ADD"?1:I==="REMOVE"?2:I==="CURRENT"?3:I==="RESET"?4:Sr()}(t.targetChange.targetChangeType||"NO_CHANGE"),c=t.targetChange.targetIds||[],f=function(I,D){return I.useProto3Json?(qi(D===void 0||typeof D=="string"),Fo.fromBase64String(D||"")):(qi(D===void 0||D instanceof Buffer||D instanceof Uint8Array),Fo.fromUint8Array(D||new Uint8Array))}(e,t.targetChange.resumeToken),_=t.targetChange.cause,x=_&&function(I){const D=I.code===void 0?en.UNKNOWN:yW(I.code);return new Ln(D,I.message||"")}(_);r=new xW(s,c,f,x||null)}else if("documentChange"in t){t.documentChange;const s=t.documentChange;s.document,s.document.name,s.document.updateTime;const c=ER(e,s.document.name),f=$u(s.document.updateTime),_=s.document.createTime?$u(s.document.createTime):Pr.min(),x=new Va({mapValue:{fields:s.document.fields}}),a=ea.newFoundDocument(c,f,_,x),I=s.targetIds||[],D=s.removedTargetIds||[];r=new OE(I,D,a.key,a)}else if("documentDelete"in t){t.documentDelete;const s=t.documentDelete;s.document;const c=ER(e,s.document),f=s.readTime?$u(s.readTime):Pr.min(),_=ea.newNoDocument(c,f),x=s.removedTargetIds||[];r=new OE([],x,_.key,_)}else if("documentRemove"in t){t.documentRemove;const s=t.documentRemove;s.document;const c=ER(e,s.document),f=s.removedTargetIds||[];r=new OE([],f,c,null)}else{if(!("filter"in t))return Sr();{t.filter;const s=t.filter;s.targetId;const{count:c=0,unchangedNames:f}=s,_=new sfe(c,f),x=s.targetId;r=new vW(x,_)}}return r}function _fe(e,t){let r;if(t instanceof fb)r={update:IU(e,t.key,t.value)};else if(t instanceof CO)r={delete:Mk(e,t.key)};else if(t instanceof rp)r={update:IU(e,t.key,t.data),updateMask:Ife(t.fieldMask)};else{if(!(t instanceof nfe))return Sr();r={verify:Mk(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(s=>function(f,_){const x=_.transform;if(x instanceof Rx)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(x instanceof Ny)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:x.elements}};if(x instanceof Fy)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:x.elements}};if(x instanceof FS)return{fieldPath:_.field.canonicalString(),increment:x.Pe};throw Sr()}(0,s))),t.precondition.isNone||(r.currentDocument=function(c,f){return f.updateTime!==void 0?{updateTime:pfe(c,f.updateTime)}:f.exists!==void 0?{exists:f.exists}:Sr()}(e,t.precondition)),r}function yfe(e,t){return e&&e.length>0?(qi(t!==void 0),e.map(r=>function(c,f){let _=c.updateTime?$u(c.updateTime):$u(f);return _.isEqual(Pr.min())&&(_=$u(f)),new Jde(_,c.transformResults||[])}(r,t))):[]}function vfe(e,t){return{documents:[TW(e,t.path)]}}function xfe(e,t){const r={structuredQuery:{}},s=t.path;let c;t.collectionGroup!==null?(c=s,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(c=s.popLast(),r.structuredQuery.from=[{collectionId:s.lastSegment()}]),r.parent=TW(e,c);const f=function(I){if(I.length!==0)return IW(Hc.create(I,"and"))}(t.filters);f&&(r.structuredQuery.where=f);const _=function(I){if(I.length!==0)return I.map(D=>function(F){return{field:z_(F.field),direction:Tfe(F.dir)}}(D))}(t.orderBy);_&&(r.structuredQuery.orderBy=_);const x=Pk(e,t.limit);return x!==null&&(r.structuredQuery.limit=x),t.startAt&&(r.structuredQuery.startAt=function(I){return{before:I.inclusive,values:I.position}}(t.startAt)),t.endAt&&(r.structuredQuery.endAt=function(I){return{before:!I.inclusive,values:I.position}}(t.endAt)),{_t:r,parent:c}}function bfe(e){let t=mfe(e.parent);const r=e.structuredQuery,s=r.from?r.from.length:0;let c=null;if(s>0){qi(s===1);const D=r.from[0];D.allDescendants?c=D.collectionId:t=t.child(D.collectionId)}let f=[];r.where&&(f=function(O){const F=SW(O);return F instanceof Hc&&tW(F)?F.getFilters():[F]}(r.where));let _=[];r.orderBy&&(_=function(O){return O.map(F=>function(Q){return new Px(N_(Q.field),function(te){switch(te){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Q.direction))}(F))}(r.orderBy));let x=null;r.limit&&(x=function(O){let F;return F=typeof O=="object"?O.value:O,uC(F)?null:F}(r.limit));let a=null;r.startAt&&(a=function(O){const F=!!O.before,H=O.values||[];return new zS(H,F)}(r.startAt));let I=null;return r.endAt&&(I=function(O){const F=!O.before,H=O.values||[];return new zS(H,F)}(r.endAt)),jde(t,c,_,f,x,"F",a,I)}function wfe(e,t){const r=function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Sr()}}(t.purpose);return r==null?null:{"goog-listen-tags":r}}function SW(e){return e.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const s=N_(r.unaryFilter.field);return so.create(s,"==",{doubleValue:NaN});case"IS_NULL":const c=N_(r.unaryFilter.field);return so.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const f=N_(r.unaryFilter.field);return so.create(f,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=N_(r.unaryFilter.field);return so.create(_,"!=",{nullValue:"NULL_VALUE"});default:return Sr()}}(e):e.fieldFilter!==void 0?function(r){return so.create(N_(r.fieldFilter.field),function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Sr()}}(r.fieldFilter.op),r.fieldFilter.value)}(e):e.compositeFilter!==void 0?function(r){return Hc.create(r.compositeFilter.filters.map(s=>SW(s)),function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return Sr()}}(r.compositeFilter.op))}(e):Sr()}function Tfe(e){return ufe[e]}function Efe(e){return hfe[e]}function Sfe(e){return dfe[e]}function z_(e){return{fieldPath:e.canonicalString()}}function N_(e){return Oo.fromServerFormat(e.fieldPath)}function IW(e){return e instanceof so?function(r){if(r.op==="=="){if(dU(r.value))return{unaryFilter:{field:z_(r.field),op:"IS_NAN"}};if(hU(r.value))return{unaryFilter:{field:z_(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(dU(r.value))return{unaryFilter:{field:z_(r.field),op:"IS_NOT_NAN"}};if(hU(r.value))return{unaryFilter:{field:z_(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:z_(r.field),op:Efe(r.op),value:r.value}}}(e):e instanceof Hc?function(r){const s=r.getFilters().map(c=>IW(c));return s.length===1?s[0]:{compositeFilter:{op:Sfe(r.op),filters:s}}}(e):Sr()}function Ife(e){const t=[];return e.fields.forEach(r=>t.push(r.canonicalString())),{fieldPaths:t}}function CW(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(t,r,s,c,f=Pr.min(),_=Pr.min(),x=Fo.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=r,this.purpose=s,this.sequenceNumber=c,this.snapshotVersion=f,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=x,this.expectedCount=a}withSequenceNumber(t){return new vf(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,r){return new vf(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new vf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new vf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cfe{constructor(t){this.ct=t}}function Afe(e){const t=bfe({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?NS(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pfe{constructor(){this.un=new Rfe}addToCollectionParentIndex(t,r){return this.un.add(r),on.resolve()}getCollectionParents(t,r){return on.resolve(this.un.getEntries(r))}addFieldIndex(t,r){return on.resolve()}deleteFieldIndex(t,r){return on.resolve()}deleteAllFieldIndexes(t){return on.resolve()}createTargetIndexes(t,r){return on.resolve()}getDocumentsMatchingTarget(t,r){return on.resolve(null)}getIndexType(t,r){return on.resolve(0)}getFieldIndexes(t,r){return on.resolve([])}getNextCollectionGroupToUpdate(t){return on.resolve(null)}getMinOffset(t,r){return on.resolve(Uf.min())}getMinOffsetFromCollectionGroup(t,r){return on.resolve(Uf.min())}updateCollectionGroup(t,r,s){return on.resolve()}updateIndexEntries(t,r){return on.resolve()}}class Rfe{constructor(){this.index={}}add(t){const r=t.lastSegment(),s=t.popLast(),c=this.index[r]||new zo(os.comparator),f=!c.has(s);return this.index[r]=c.add(s),f}has(t){const r=t.lastSegment(),s=t.popLast(),c=this.index[r];return c&&c.has(s)}getEntries(t){return(this.index[t]||new zo(os.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(t){this.Ln=t}next(){return this.Ln+=2,this.Ln}static Bn(){return new By(0)}static kn(){return new By(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mfe{constructor(){this.changes=new a0(t=>t.toString(),(t,r)=>t.isEqual(r)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,r){this.assertNotApplied(),this.changes.set(t,ea.newInvalidDocument(t).setReadTime(r))}getEntry(t,r){this.assertNotApplied();const s=this.changes.get(r);return s!==void 0?on.resolve(s):this.getFromCache(t,r)}getEntries(t,r){return this.getAllFromCache(t,r)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kfe{constructor(t,r){this.overlayedDocument=t,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dfe{constructor(t,r,s,c){this.remoteDocumentCache=t,this.mutationQueue=r,this.documentOverlayCache=s,this.indexManager=c}getDocument(t,r){let s=null;return this.documentOverlayCache.getOverlay(t,r).next(c=>(s=c,this.remoteDocumentCache.getEntry(t,r))).next(c=>(s!==null&&U1(s.mutation,c,fl.empty(),yo.now()),c))}getDocuments(t,r){return this.remoteDocumentCache.getEntries(t,r).next(s=>this.getLocalViewOfDocuments(t,s,Qr()).next(()=>s))}getLocalViewOfDocuments(t,r,s=Qr()){const c=bm();return this.populateOverlays(t,c,r).next(()=>this.computeViews(t,r,c,s).next(f=>{let _=f1();return f.forEach((x,a)=>{_=_.insert(x,a.overlayedDocument)}),_}))}getOverlayedDocuments(t,r){const s=bm();return this.populateOverlays(t,s,r).next(()=>this.computeViews(t,r,s,Qr()))}populateOverlays(t,r,s){const c=[];return s.forEach(f=>{r.has(f)||c.push(f)}),this.documentOverlayCache.getOverlays(t,c).next(f=>{f.forEach((_,x)=>{r.set(_,x)})})}computeViews(t,r,s,c){let f=ed();const _=j1(),x=function(){return j1()}();return r.forEach((a,I)=>{const D=s.get(I.key);c.has(I.key)&&(D===void 0||D.mutation instanceof rp)?f=f.insert(I.key,I):D!==void 0?(_.set(I.key,D.mutation.getFieldMask()),U1(D.mutation,I,D.mutation.getFieldMask(),yo.now())):_.set(I.key,fl.empty())}),this.recalculateAndSaveOverlays(t,f).next(a=>(a.forEach((I,D)=>_.set(I,D)),r.forEach((I,D)=>{var O;return x.set(I,new kfe(D,(O=_.get(I))!==null&&O!==void 0?O:null))}),x))}recalculateAndSaveOverlays(t,r){const s=j1();let c=new Cs((_,x)=>_-x),f=Qr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,r).next(_=>{for(const x of _)x.keys().forEach(a=>{const I=r.get(a);if(I===null)return;let D=s.get(a)||fl.empty();D=x.applyToLocalView(I,D),s.set(a,D);const O=(c.get(x.batchId)||Qr()).add(a);c=c.insert(x.batchId,O)})}).next(()=>{const _=[],x=c.getReverseIterator();for(;x.hasNext();){const a=x.getNext(),I=a.key,D=a.value,O=uW();D.forEach(F=>{if(!f.has(F)){const H=gW(r.get(F),s.get(F));H!==null&&O.set(F,H),f=f.add(F)}}),_.push(this.documentOverlayCache.saveOverlays(t,I,O))}return on.waitFor(_)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(t,r){return this.remoteDocumentCache.getEntries(t,r).next(s=>this.recalculateAndSaveOverlays(t,s))}getDocumentsMatchingQuery(t,r,s,c){return function(_){return ar.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(t,r.path):sW(r)?this.getDocumentsMatchingCollectionGroupQuery(t,r,s,c):this.getDocumentsMatchingCollectionQuery(t,r,s,c)}getNextDocuments(t,r,s,c){return this.remoteDocumentCache.getAllFromCollectionGroup(t,r,s,c).next(f=>{const _=c-f.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,r,s.largestBatchId,c-f.size):on.resolve(bm());let x=-1,a=f;return _.next(I=>on.forEach(I,(D,O)=>(x<O.largestBatchId&&(x=O.largestBatchId),f.get(D)?on.resolve():this.remoteDocumentCache.getEntry(t,D).next(F=>{a=a.insert(D,F)}))).next(()=>this.populateOverlays(t,I,f)).next(()=>this.computeViews(t,a,I,Qr())).next(D=>({batchId:x,changes:cW(D)})))})}getDocumentsMatchingDocumentQuery(t,r){return this.getDocument(t,new ar(r)).next(s=>{let c=f1();return s.isFoundDocument()&&(c=c.insert(s.key,s)),c})}getDocumentsMatchingCollectionGroupQuery(t,r,s,c){const f=r.collectionGroup;let _=f1();return this.indexManager.getCollectionParents(t,f).next(x=>on.forEach(x,a=>{const I=function(O,F){return new o0(F,null,O.explicitOrderBy.slice(),O.filters.slice(),O.limit,O.limitType,O.startAt,O.endAt)}(r,a.child(f));return this.getDocumentsMatchingCollectionQuery(t,I,s,c).next(D=>{D.forEach((O,F)=>{_=_.insert(O,F)})})}).next(()=>_))}getDocumentsMatchingCollectionQuery(t,r,s,c){let f;return this.documentOverlayCache.getOverlaysForCollection(t,r.path,s.largestBatchId).next(_=>(f=_,this.remoteDocumentCache.getDocumentsMatchingQuery(t,r,s,f,c))).next(_=>{f.forEach((a,I)=>{const D=I.getKey();_.get(D)===null&&(_=_.insert(D,ea.newInvalidDocument(D)))});let x=f1();return _.forEach((a,I)=>{const D=f.get(a);D!==void 0&&U1(D.mutation,I,fl.empty(),yo.now()),fC(r,I)&&(x=x.insert(a,I))}),x})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ofe{constructor(t){this.serializer=t,this.hr=new Map,this.Pr=new Map}getBundleMetadata(t,r){return on.resolve(this.hr.get(r))}saveBundleMetadata(t,r){return this.hr.set(r.id,function(c){return{id:c.id,version:c.version,createTime:$u(c.createTime)}}(r)),on.resolve()}getNamedQuery(t,r){return on.resolve(this.Pr.get(r))}saveNamedQuery(t,r){return this.Pr.set(r.name,function(c){return{name:c.name,query:Afe(c.bundledQuery),readTime:$u(c.readTime)}}(r)),on.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lfe{constructor(){this.overlays=new Cs(ar.comparator),this.Ir=new Map}getOverlay(t,r){return on.resolve(this.overlays.get(r))}getOverlays(t,r){const s=bm();return on.forEach(r,c=>this.getOverlay(t,c).next(f=>{f!==null&&s.set(c,f)})).next(()=>s)}saveOverlays(t,r,s){return s.forEach((c,f)=>{this.ht(t,r,f)}),on.resolve()}removeOverlaysForBatchId(t,r,s){const c=this.Ir.get(s);return c!==void 0&&(c.forEach(f=>this.overlays=this.overlays.remove(f)),this.Ir.delete(s)),on.resolve()}getOverlaysForCollection(t,r,s){const c=bm(),f=r.length+1,_=new ar(r.child("")),x=this.overlays.getIteratorFrom(_);for(;x.hasNext();){const a=x.getNext().value,I=a.getKey();if(!r.isPrefixOf(I.path))break;I.path.length===f&&a.largestBatchId>s&&c.set(a.getKey(),a)}return on.resolve(c)}getOverlaysForCollectionGroup(t,r,s,c){let f=new Cs((I,D)=>I-D);const _=this.overlays.getIterator();for(;_.hasNext();){const I=_.getNext().value;if(I.getKey().getCollectionGroup()===r&&I.largestBatchId>s){let D=f.get(I.largestBatchId);D===null&&(D=bm(),f=f.insert(I.largestBatchId,D)),D.set(I.getKey(),I)}}const x=bm(),a=f.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((I,D)=>x.set(I,D)),!(x.size()>=c)););return on.resolve(x)}ht(t,r,s){const c=this.overlays.get(s.key);if(c!==null){const _=this.Ir.get(c.largestBatchId).delete(s.key);this.Ir.set(c.largestBatchId,_)}this.overlays=this.overlays.insert(s.key,new ife(r,s));let f=this.Ir.get(r);f===void 0&&(f=Qr(),this.Ir.set(r,f)),this.Ir.set(r,f.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zfe{constructor(){this.sessionToken=Fo.EMPTY_BYTE_STRING}getSessionToken(t){return on.resolve(this.sessionToken)}setSessionToken(t,r){return this.sessionToken=r,on.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MO{constructor(){this.Tr=new zo(Eo.Er),this.dr=new zo(Eo.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(t,r){const s=new Eo(t,r);this.Tr=this.Tr.add(s),this.dr=this.dr.add(s)}Rr(t,r){t.forEach(s=>this.addReference(s,r))}removeReference(t,r){this.Vr(new Eo(t,r))}mr(t,r){t.forEach(s=>this.removeReference(s,r))}gr(t){const r=new ar(new os([])),s=new Eo(r,t),c=new Eo(r,t+1),f=[];return this.dr.forEachInRange([s,c],_=>{this.Vr(_),f.push(_.key)}),f}pr(){this.Tr.forEach(t=>this.Vr(t))}Vr(t){this.Tr=this.Tr.delete(t),this.dr=this.dr.delete(t)}yr(t){const r=new ar(new os([])),s=new Eo(r,t),c=new Eo(r,t+1);let f=Qr();return this.dr.forEachInRange([s,c],_=>{f=f.add(_.key)}),f}containsKey(t){const r=new Eo(t,0),s=this.Tr.firstAfterOrEqual(r);return s!==null&&t.isEqual(s.key)}}class Eo{constructor(t,r){this.key=t,this.wr=r}static Er(t,r){return ar.comparator(t.key,r.key)||hi(t.wr,r.wr)}static Ar(t,r){return hi(t.wr,r.wr)||ar.comparator(t.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nfe{constructor(t,r){this.indexManager=t,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new zo(Eo.Er)}checkEmpty(t){return on.resolve(this.mutationQueue.length===0)}addMutationBatch(t,r,s,c){const f=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new rfe(f,r,s,c);this.mutationQueue.push(_);for(const x of c)this.br=this.br.add(new Eo(x.key,f)),this.indexManager.addToCollectionParentIndex(t,x.key.path.popLast());return on.resolve(_)}lookupMutationBatch(t,r){return on.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(t,r){const s=r+1,c=this.vr(s),f=c<0?0:c;return on.resolve(this.mutationQueue.length>f?this.mutationQueue[f]:null)}getHighestUnacknowledgedBatchId(){return on.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(t){return on.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,r){const s=new Eo(r,0),c=new Eo(r,Number.POSITIVE_INFINITY),f=[];return this.br.forEachInRange([s,c],_=>{const x=this.Dr(_.wr);f.push(x)}),on.resolve(f)}getAllMutationBatchesAffectingDocumentKeys(t,r){let s=new zo(hi);return r.forEach(c=>{const f=new Eo(c,0),_=new Eo(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([f,_],x=>{s=s.add(x.wr)})}),on.resolve(this.Cr(s))}getAllMutationBatchesAffectingQuery(t,r){const s=r.path,c=s.length+1;let f=s;ar.isDocumentKey(f)||(f=f.child(""));const _=new Eo(new ar(f),0);let x=new zo(hi);return this.br.forEachWhile(a=>{const I=a.key.path;return!!s.isPrefixOf(I)&&(I.length===c&&(x=x.add(a.wr)),!0)},_),on.resolve(this.Cr(x))}Cr(t){const r=[];return t.forEach(s=>{const c=this.Dr(s);c!==null&&r.push(c)}),r}removeMutationBatch(t,r){qi(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let s=this.br;return on.forEach(r.mutations,c=>{const f=new Eo(c.key,r.batchId);return s=s.delete(f),this.referenceDelegate.markPotentiallyOrphaned(t,c.key)}).next(()=>{this.br=s})}On(t){}containsKey(t,r){const s=new Eo(r,0),c=this.br.firstAfterOrEqual(s);return on.resolve(r.isEqual(c&&c.key))}performConsistencyCheck(t){return this.mutationQueue.length,on.resolve()}Fr(t,r){return this.vr(t)}vr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Dr(t){const r=this.vr(t);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ffe{constructor(t){this.Mr=t,this.docs=function(){return new Cs(ar.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,r){const s=r.key,c=this.docs.get(s),f=c?c.size:0,_=this.Mr(r);return this.docs=this.docs.insert(s,{document:r.mutableCopy(),size:_}),this.size+=_-f,this.indexManager.addToCollectionParentIndex(t,s.path.popLast())}removeEntry(t){const r=this.docs.get(t);r&&(this.docs=this.docs.remove(t),this.size-=r.size)}getEntry(t,r){const s=this.docs.get(r);return on.resolve(s?s.document.mutableCopy():ea.newInvalidDocument(r))}getEntries(t,r){let s=ed();return r.forEach(c=>{const f=this.docs.get(c);s=s.insert(c,f?f.document.mutableCopy():ea.newInvalidDocument(c))}),on.resolve(s)}getDocumentsMatchingQuery(t,r,s,c){let f=ed();const _=r.path,x=new ar(_.child("")),a=this.docs.getIteratorFrom(x);for(;a.hasNext();){const{key:I,value:{document:D}}=a.getNext();if(!_.isPrefixOf(I.path))break;I.path.length>_.length+1||bde(xde(D),s)<=0||(c.has(D.key)||fC(r,D))&&(f=f.insert(D.key,D.mutableCopy()))}return on.resolve(f)}getAllFromCollectionGroup(t,r,s,c){Sr()}Or(t,r){return on.forEach(this.docs,s=>r(s))}newChangeBuffer(t){return new Bfe(this)}getSize(t){return on.resolve(this.size)}}class Bfe extends Mfe{constructor(t){super(),this.cr=t}applyChanges(t){const r=[];return this.changes.forEach((s,c)=>{c.isValidDocument()?r.push(this.cr.addEntry(t,c)):this.cr.removeEntry(s)}),on.waitFor(r)}getFromCache(t,r){return this.cr.getEntry(t,r)}getAllFromCache(t,r){return this.cr.getEntries(t,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jfe{constructor(t){this.persistence=t,this.Nr=new a0(r=>TO(r),EO),this.lastRemoteSnapshotVersion=Pr.min(),this.highestTargetId=0,this.Lr=0,this.Br=new MO,this.targetCount=0,this.kr=By.Bn()}forEachTarget(t,r){return this.Nr.forEach((s,c)=>r(c)),on.resolve()}getLastRemoteSnapshotVersion(t){return on.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return on.resolve(this.Lr)}allocateTargetId(t){return this.highestTargetId=this.kr.next(),on.resolve(this.highestTargetId)}setTargetsMetadata(t,r,s){return s&&(this.lastRemoteSnapshotVersion=s),r>this.Lr&&(this.Lr=r),on.resolve()}Kn(t){this.Nr.set(t.target,t);const r=t.targetId;r>this.highestTargetId&&(this.kr=new By(r),this.highestTargetId=r),t.sequenceNumber>this.Lr&&(this.Lr=t.sequenceNumber)}addTargetData(t,r){return this.Kn(r),this.targetCount+=1,on.resolve()}updateTargetData(t,r){return this.Kn(r),on.resolve()}removeTargetData(t,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,on.resolve()}removeTargets(t,r,s){let c=0;const f=[];return this.Nr.forEach((_,x)=>{x.sequenceNumber<=r&&s.get(x.targetId)===null&&(this.Nr.delete(_),f.push(this.removeMatchingKeysForTargetId(t,x.targetId)),c++)}),on.waitFor(f).next(()=>c)}getTargetCount(t){return on.resolve(this.targetCount)}getTargetData(t,r){const s=this.Nr.get(r)||null;return on.resolve(s)}addMatchingKeys(t,r,s){return this.Br.Rr(r,s),on.resolve()}removeMatchingKeys(t,r,s){this.Br.mr(r,s);const c=this.persistence.referenceDelegate,f=[];return c&&r.forEach(_=>{f.push(c.markPotentiallyOrphaned(t,_))}),on.waitFor(f)}removeMatchingKeysForTargetId(t,r){return this.Br.gr(r),on.resolve()}getMatchingKeysForTargetId(t,r){const s=this.Br.yr(r);return on.resolve(s)}containsKey(t,r){return on.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ufe{constructor(t,r){this.qr={},this.overlays={},this.Qr=new vO(0),this.Kr=!1,this.Kr=!0,this.$r=new zfe,this.referenceDelegate=t(this),this.Ur=new jfe(this),this.indexManager=new Pfe,this.remoteDocumentCache=function(c){return new Ffe(c)}(s=>this.referenceDelegate.Wr(s)),this.serializer=new Cfe(r),this.Gr=new Ofe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let r=this.overlays[t.toKey()];return r||(r=new Lfe,this.overlays[t.toKey()]=r),r}getMutationQueue(t,r){let s=this.qr[t.toKey()];return s||(s=new Nfe(r,this.referenceDelegate),this.qr[t.toKey()]=s),s}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(t,r,s){Hn("MemoryPersistence","Starting transaction:",t);const c=new Vfe(this.Qr.next());return this.referenceDelegate.zr(),s(c).next(f=>this.referenceDelegate.jr(c).next(()=>f)).toPromise().then(f=>(c.raiseOnCommittedEvent(),f))}Hr(t,r){return on.or(Object.values(this.qr).map(s=>()=>s.containsKey(t,r)))}}class Vfe extends Tde{constructor(t){super(),this.currentSequenceNumber=t}}class kO{constructor(t){this.persistence=t,this.Jr=new MO,this.Yr=null}static Zr(t){return new kO(t)}get Xr(){if(this.Yr)return this.Yr;throw Sr()}addReference(t,r,s){return this.Jr.addReference(s,r),this.Xr.delete(s.toString()),on.resolve()}removeReference(t,r,s){return this.Jr.removeReference(s,r),this.Xr.add(s.toString()),on.resolve()}markPotentiallyOrphaned(t,r){return this.Xr.add(r.toString()),on.resolve()}removeTarget(t,r){this.Jr.gr(r.targetId).forEach(c=>this.Xr.add(c.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(t,r.targetId).next(c=>{c.forEach(f=>this.Xr.add(f.toString()))}).next(()=>s.removeTargetData(t,r))}zr(){this.Yr=new Set}jr(t){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return on.forEach(this.Xr,s=>{const c=ar.fromPath(s);return this.ei(t,c).next(f=>{f||r.removeEntry(c,Pr.min())})}).next(()=>(this.Yr=null,r.apply(t)))}updateLimboDocument(t,r){return this.ei(t,r).next(s=>{s?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(t){return 0}ei(t,r){return on.or([()=>on.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(t,r),()=>this.persistence.Hr(t,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DO{constructor(t,r,s,c){this.targetId=t,this.fromCache=r,this.$i=s,this.Ui=c}static Wi(t,r){let s=Qr(),c=Qr();for(const f of r.docChanges)switch(f.type){case 0:s=s.add(f.doc.key);break;case 1:c=c.add(f.doc.key)}return new DO(t,r.fromCache,s,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $fe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qfe{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return zle()?8:Ede(ia())>0?6:4}()}initialize(t,r){this.Ji=t,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(t,r,s,c){const f={result:null};return this.Yi(t,r).next(_=>{f.result=_}).next(()=>{if(!f.result)return this.Zi(t,r,c,s).next(_=>{f.result=_})}).next(()=>{if(f.result)return;const _=new $fe;return this.Xi(t,r,_).next(x=>{if(f.result=x,this.zi)return this.es(t,r,_,x.size)})}).next(()=>f.result)}es(t,r,s,c){return s.documentReadCount<this.ji?(Xv()<=ni.DEBUG&&Hn("QueryEngine","SDK will not create cache indexes for query:",L_(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),on.resolve()):(Xv()<=ni.DEBUG&&Hn("QueryEngine","Query:",L_(r),"scans",s.documentReadCount,"local documents and returns",c,"documents as results."),s.documentReadCount>this.Hi*c?(Xv()<=ni.DEBUG&&Hn("QueryEngine","The SDK decides to create cache indexes for query:",L_(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Vu(r))):on.resolve())}Yi(t,r){if(gU(r))return on.resolve(null);let s=Vu(r);return this.indexManager.getIndexType(t,s).next(c=>c===0?null:(r.limit!==null&&c===1&&(r=NS(r,null,"F"),s=Vu(r)),this.indexManager.getDocumentsMatchingTarget(t,s).next(f=>{const _=Qr(...f);return this.Ji.getDocuments(t,_).next(x=>this.indexManager.getMinOffset(t,s).next(a=>{const I=this.ts(r,x);return this.ns(r,I,_,a.readTime)?this.Yi(t,NS(r,null,"F")):this.rs(t,I,r,a)}))})))}Zi(t,r,s,c){return gU(r)||c.isEqual(Pr.min())?on.resolve(null):this.Ji.getDocuments(t,s).next(f=>{const _=this.ts(r,f);return this.ns(r,_,s,c)?on.resolve(null):(Xv()<=ni.DEBUG&&Hn("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),L_(r)),this.rs(t,_,r,vde(c,-1)).next(x=>x))})}ts(t,r){let s=new zo(aW(t));return r.forEach((c,f)=>{fC(t,f)&&(s=s.add(f))}),s}ns(t,r,s,c){if(t.limit===null)return!1;if(s.size!==r.size)return!0;const f=t.limitType==="F"?r.last():r.first();return!!f&&(f.hasPendingWrites||f.version.compareTo(c)>0)}Xi(t,r,s){return Xv()<=ni.DEBUG&&Hn("QueryEngine","Using full collection scan to execute query:",L_(r)),this.Ji.getDocumentsMatchingQuery(t,r,Uf.min(),s)}rs(t,r,s,c){return this.Ji.getDocumentsMatchingQuery(t,s,c).next(f=>(r.forEach(_=>{f=f.insert(_.key,_)}),f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gfe{constructor(t,r,s,c){this.persistence=t,this.ss=r,this.serializer=c,this.os=new Cs(hi),this._s=new a0(f=>TO(f),EO),this.us=new Map,this.cs=t.getRemoteDocumentCache(),this.Ur=t.getTargetCache(),this.Gr=t.getBundleCache(),this.ls(s)}ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Dfe(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>t.collect(r,this.os))}}function Wfe(e,t,r,s){return new Gfe(e,t,r,s)}function AW(e,t){return Be(this,null,function*(){const r=Rr(e);return yield r.persistence.runTransaction("Handle user change","readonly",s=>{let c;return r.mutationQueue.getAllMutationBatches(s).next(f=>(c=f,r.ls(t),r.mutationQueue.getAllMutationBatches(s))).next(f=>{const _=[],x=[];let a=Qr();for(const I of c){_.push(I.batchId);for(const D of I.mutations)a=a.add(D.key)}for(const I of f){x.push(I.batchId);for(const D of I.mutations)a=a.add(D.key)}return r.localDocuments.getDocuments(s,a).next(I=>({hs:I,removedBatchIds:_,addedBatchIds:x}))})})})}function Hfe(e,t){const r=Rr(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const c=t.batch.keys(),f=r.cs.newChangeBuffer({trackRemovals:!0});return function(x,a,I,D){const O=I.batch,F=O.keys();let H=on.resolve();return F.forEach(Q=>{H=H.next(()=>D.getEntry(a,Q)).next(ie=>{const te=I.docVersions.get(Q);qi(te!==null),ie.version.compareTo(te)<0&&(O.applyToRemoteDocument(ie,I),ie.isValidDocument()&&(ie.setReadTime(I.commitVersion),D.addEntry(ie)))})}),H.next(()=>x.mutationQueue.removeMutationBatch(a,O))}(r,s,t,f).next(()=>f.apply(s)).next(()=>r.mutationQueue.performConsistencyCheck(s)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(s,c,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(x){let a=Qr();for(let I=0;I<x.mutationResults.length;++I)x.mutationResults[I].transformResults.length>0&&(a=a.add(x.batch.mutations[I].key));return a}(t))).next(()=>r.localDocuments.getDocuments(s,c))})}function PW(e){const t=Rr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",r=>t.Ur.getLastRemoteSnapshotVersion(r))}function Zfe(e,t){const r=Rr(e),s=t.snapshotVersion;let c=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",f=>{const _=r.cs.newChangeBuffer({trackRemovals:!0});c=r.os;const x=[];t.targetChanges.forEach((D,O)=>{const F=c.get(O);if(!F)return;x.push(r.Ur.removeMatchingKeys(f,D.removedDocuments,O).next(()=>r.Ur.addMatchingKeys(f,D.addedDocuments,O)));let H=F.withSequenceNumber(f.currentSequenceNumber);t.targetMismatches.get(O)!==null?H=H.withResumeToken(Fo.EMPTY_BYTE_STRING,Pr.min()).withLastLimboFreeSnapshotVersion(Pr.min()):D.resumeToken.approximateByteSize()>0&&(H=H.withResumeToken(D.resumeToken,s)),c=c.insert(O,H),function(ie,te,W){return ie.resumeToken.approximateByteSize()===0||te.snapshotVersion.toMicroseconds()-ie.snapshotVersion.toMicroseconds()>=3e8?!0:W.addedDocuments.size+W.modifiedDocuments.size+W.removedDocuments.size>0}(F,H,D)&&x.push(r.Ur.updateTargetData(f,H))});let a=ed(),I=Qr();if(t.documentUpdates.forEach(D=>{t.resolvedLimboDocuments.has(D)&&x.push(r.persistence.referenceDelegate.updateLimboDocument(f,D))}),x.push(Xfe(f,_,t.documentUpdates).next(D=>{a=D.Ps,I=D.Is})),!s.isEqual(Pr.min())){const D=r.Ur.getLastRemoteSnapshotVersion(f).next(O=>r.Ur.setTargetsMetadata(f,f.currentSequenceNumber,s));x.push(D)}return on.waitFor(x).next(()=>_.apply(f)).next(()=>r.localDocuments.getLocalViewOfDocuments(f,a,I)).next(()=>a)}).then(f=>(r.os=c,f))}function Xfe(e,t,r){let s=Qr(),c=Qr();return r.forEach(f=>s=s.add(f)),t.getEntries(e,s).next(f=>{let _=ed();return r.forEach((x,a)=>{const I=f.get(x);a.isFoundDocument()!==I.isFoundDocument()&&(c=c.add(x)),a.isNoDocument()&&a.version.isEqual(Pr.min())?(t.removeEntry(x,a.readTime),_=_.insert(x,a)):!I.isValidDocument()||a.version.compareTo(I.version)>0||a.version.compareTo(I.version)===0&&I.hasPendingWrites?(t.addEntry(a),_=_.insert(x,a)):Hn("LocalStore","Ignoring outdated watch update for ",x,". Current version:",I.version," Watch version:",a.version)}),{Ps:_,Is:c}})}function Kfe(e,t){const r=Rr(e);return r.persistence.runTransaction("Get next mutation batch","readonly",s=>(t===void 0&&(t=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(s,t)))}function Qfe(e,t){const r=Rr(e);return r.persistence.runTransaction("Allocate target","readwrite",s=>{let c;return r.Ur.getTargetData(s,t).next(f=>f?(c=f,on.resolve(c)):r.Ur.allocateTargetId(s).next(_=>(c=new vf(t,_,"TargetPurposeListen",s.currentSequenceNumber),r.Ur.addTargetData(s,c).next(()=>c))))}).then(s=>{const c=r.os.get(s.targetId);return(c===null||s.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(r.os=r.os.insert(s.targetId,s),r._s.set(t,s.targetId)),s})}function Dk(e,t,r){return Be(this,null,function*(){const s=Rr(e),c=s.os.get(t),f=r?"readwrite":"readwrite-primary";try{r||(yield s.persistence.runTransaction("Release target",f,_=>s.persistence.referenceDelegate.removeTarget(_,c)))}catch(_){if(!db(_))throw _;Hn("LocalStore",`Failed to update sequence numbers for target ${t}: ${_}`)}s.os=s.os.remove(t),s._s.delete(c.target)})}function CU(e,t,r){const s=Rr(e);let c=Pr.min(),f=Qr();return s.persistence.runTransaction("Execute query","readwrite",_=>function(a,I,D){const O=Rr(a),F=O._s.get(D);return F!==void 0?on.resolve(O.os.get(F)):O.Ur.getTargetData(I,D)}(s,_,Vu(t)).next(x=>{if(x)return c=x.lastLimboFreeSnapshotVersion,s.Ur.getMatchingKeysForTargetId(_,x.targetId).next(a=>{f=a})}).next(()=>s.ss.getDocumentsMatchingQuery(_,t,r?c:Pr.min(),r?f:Qr())).next(x=>(Yfe(s,Vde(t),x),{documents:x,Ts:f})))}function Yfe(e,t,r){let s=e.us.get(t)||Pr.min();r.forEach((c,f)=>{f.readTime.compareTo(s)>0&&(s=f.readTime)}),e.us.set(t,s)}class AU{constructor(){this.activeTargetIds=Zde()}fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}gs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Vs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Jfe{constructor(){this.so=new AU,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,r,s){}addLocalQueryTarget(t){return this.so.fs(t),this.oo[t]||"not-current"}updateQueryState(t,r,s){this.oo[t]=r}removeLocalQueryTarget(t){this.so.gs(t)}isLocalQueryTarget(t){return this.so.activeTargetIds.has(t)}clearQueryState(t){delete this.oo[t]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(t){return this.so.activeTargetIds.has(t)}start(){return this.so=new AU,Promise.resolve()}handleUserChange(t,r,s){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class epe{_o(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PU{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(t){this.ho.push(t)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){Hn("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ho)t(0)}lo(){Hn("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ho)t(1)}static D(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let QT=null;function SR(){return QT===null?QT=function(){return 268435456+Math.round(2147483648*Math.random())}():QT++,"0x"+QT.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tpe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class npe{constructor(t){this.Io=t.Io,this.To=t.To}Eo(t){this.Ao=t}Ro(t){this.Vo=t}mo(t){this.fo=t}onMessage(t){this.po=t}close(){this.To()}send(t){this.Io(t)}yo(){this.Ao()}wo(){this.Vo()}So(t){this.fo(t)}bo(t){this.po(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ko="WebChannelConnection";class rpe extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const s=r.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),f=encodeURIComponent(this.databaseId.database);this.Do=s+"://"+r.host,this.vo=`projects/${c}/databases/${f}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${f}`}get Fo(){return!1}Mo(r,s,c,f,_){const x=SR(),a=this.xo(r,s.toUriEncodedString());Hn("RestConnection",`Sending RPC '${r}' ${x}:`,a,c);const I={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(I,f,_),this.No(r,a,I,c).then(D=>(Hn("RestConnection",`Received RPC '${r}' ${x}: `,D),D),D=>{throw Dy("RestConnection",`RPC '${r}' ${x} failed with error: `,D,"url: ",a,"request:",c),D})}Lo(r,s,c,f,_,x){return this.Mo(r,s,c,f,_)}Oo(r,s,c){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+s0}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((f,_)=>r[_]=f),c&&c.headers.forEach((f,_)=>r[_]=f)}xo(r,s){const c=tpe[r];return`${this.Do}/v1/${s}:${c}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}No(t,r,s,c){const f=SR();return new Promise((_,x)=>{const a=new VG;a.setWithCredentials(!0),a.listenOnce(qG.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case ME.NO_ERROR:const D=a.getResponseJson();Hn(Ko,`XHR for RPC '${t}' ${f} received:`,JSON.stringify(D)),_(D);break;case ME.TIMEOUT:Hn(Ko,`RPC '${t}' ${f} timed out`),x(new Ln(en.DEADLINE_EXCEEDED,"Request time out"));break;case ME.HTTP_ERROR:const O=a.getStatus();if(Hn(Ko,`RPC '${t}' ${f} failed with status:`,O,"response text:",a.getResponseText()),O>0){let F=a.getResponseJson();Array.isArray(F)&&(F=F[0]);const H=F==null?void 0:F.error;if(H&&H.status&&H.message){const Q=function(te){const W=te.toLowerCase().replace(/_/g,"-");return Object.values(en).indexOf(W)>=0?W:en.UNKNOWN}(H.status);x(new Ln(Q,H.message))}else x(new Ln(en.UNKNOWN,"Server responded with status "+a.getStatus()))}else x(new Ln(en.UNAVAILABLE,"Connection failed."));break;default:Sr()}}finally{Hn(Ko,`RPC '${t}' ${f} completed.`)}});const I=JSON.stringify(c);Hn(Ko,`RPC '${t}' ${f} sending request:`,c),a.send(r,"POST",I,s,15)})}Bo(t,r,s){const c=SR(),f=[this.Do,"/","google.firestore.v1.Firestore","/",t,"/channel"],_=HG(),x=WG(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},I=this.longPollingOptions.timeoutSeconds;I!==void 0&&(a.longPollingTimeout=Math.round(1e3*I)),this.useFetchStreams&&(a.xmlHttpFactory=new $G({})),this.Oo(a.initMessageHeaders,r,s),a.encodeInitMessageHeaders=!0;const D=f.join("");Hn(Ko,`Creating RPC '${t}' stream ${c}: ${D}`,a);const O=_.createWebChannel(D,a);let F=!1,H=!1;const Q=new npe({Io:te=>{H?Hn(Ko,`Not sending because RPC '${t}' stream ${c} is closed:`,te):(F||(Hn(Ko,`Opening RPC '${t}' stream ${c} transport.`),O.open(),F=!0),Hn(Ko,`RPC '${t}' stream ${c} sending:`,te),O.send(te))},To:()=>O.close()}),ie=(te,W,X)=>{te.listen(W,ee=>{try{X(ee)}catch(fe){setTimeout(()=>{throw fe},0)}})};return ie(O,d1.EventType.OPEN,()=>{H||(Hn(Ko,`RPC '${t}' stream ${c} transport opened.`),Q.yo())}),ie(O,d1.EventType.CLOSE,()=>{H||(H=!0,Hn(Ko,`RPC '${t}' stream ${c} transport closed`),Q.So())}),ie(O,d1.EventType.ERROR,te=>{H||(H=!0,Dy(Ko,`RPC '${t}' stream ${c} transport errored:`,te),Q.So(new Ln(en.UNAVAILABLE,"The operation could not be completed")))}),ie(O,d1.EventType.MESSAGE,te=>{var W;if(!H){const X=te.data[0];qi(!!X);const ee=X,fe=ee.error||((W=ee[0])===null||W===void 0?void 0:W.error);if(fe){Hn(Ko,`RPC '${t}' stream ${c} received error:`,fe);const ye=fe.status;let Ee=function(_e){const Se=to[_e];if(Se!==void 0)return yW(Se)}(ye),re=fe.message;Ee===void 0&&(Ee=en.INTERNAL,re="Unknown error status: "+ye+" with message "+fe.message),H=!0,Q.So(new Ln(Ee,re)),O.close()}else Hn(Ko,`RPC '${t}' stream ${c} received:`,X),Q.bo(X)}}),ie(x,GG.STAT_EVENT,te=>{te.stat===Tk.PROXY?Hn(Ko,`RPC '${t}' stream ${c} detected buffering proxy`):te.stat===Tk.NOPROXY&&Hn(Ko,`RPC '${t}' stream ${c} detected no buffering proxy`)}),setTimeout(()=>{Q.wo()},0),Q}}function IR(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _C(e){return new ffe(e,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RW{constructor(t,r,s=1e3,c=1.5,f=6e4){this.ui=t,this.timerId=r,this.ko=s,this.qo=c,this.Qo=f,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();const r=Math.floor(this.Ko+this.zo()),s=Math.max(0,Date.now()-this.Uo),c=Math.max(0,r-s);c>0&&Hn("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${s} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MW{constructor(t,r,s,c,f,_,x,a){this.ui=t,this.Ho=s,this.Jo=c,this.connection=f,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=x,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new RW(t,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}stop(){return Be(this,null,function*(){this.n_()&&(yield this.close(0))})}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(t){this.u_(),this.stream.send(t)}__(){return Be(this,null,function*(){if(this.r_())return this.close(0)})}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(t,r){return Be(this,null,function*(){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,t!==4?this.t_.reset():r&&r.code===en.RESOURCE_EXHAUSTED?(Jh(r.toString()),Jh("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===en.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.mo(r)})}l_(){}auth(){this.state=1;const t=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,c])=>{this.Yo===r&&this.P_(s,c)},s=>{t(()=>{const c=new Ln(en.UNKNOWN,"Fetching auth token failed: "+s.message);return this.I_(c)})})}P_(t,r){const s=this.h_(this.Yo);this.stream=this.T_(t,r),this.stream.Eo(()=>{s(()=>this.listener.Eo())}),this.stream.Ro(()=>{s(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(c=>{s(()=>this.I_(c))}),this.stream.onMessage(c=>{s(()=>++this.e_==1?this.E_(c):this.onNext(c))})}i_(){this.state=5,this.t_.Go(()=>Be(this,null,function*(){this.state=0,this.start()}))}I_(t){return Hn("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}h_(t){return r=>{this.ui.enqueueAndForget(()=>this.Yo===t?r():(Hn("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ipe extends MW{constructor(t,r,s,c,f,_){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,s,c,_),this.serializer=f}T_(t,r){return this.connection.Bo("Listen",t,r)}E_(t){return this.onNext(t)}onNext(t){this.t_.reset();const r=gfe(this.serializer,t),s=function(f){if(!("targetChange"in f))return Pr.min();const _=f.targetChange;return _.targetIds&&_.targetIds.length?Pr.min():_.readTime?$u(_.readTime):Pr.min()}(t);return this.listener.d_(r,s)}A_(t){const r={};r.database=kk(this.serializer),r.addTarget=function(f,_){let x;const a=_.target;if(x=Ck(a)?{documents:vfe(f,a)}:{query:xfe(f,a)._t},x.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){x.resumeToken=bW(f,_.resumeToken);const I=Pk(f,_.expectedCount);I!==null&&(x.expectedCount=I)}else if(_.snapshotVersion.compareTo(Pr.min())>0){x.readTime=BS(f,_.snapshotVersion.toTimestamp());const I=Pk(f,_.expectedCount);I!==null&&(x.expectedCount=I)}return x}(this.serializer,t);const s=wfe(this.serializer,t);s&&(r.labels=s),this.a_(r)}R_(t){const r={};r.database=kk(this.serializer),r.removeTarget=t,this.a_(r)}}class spe extends MW{constructor(t,r,s,c,f,_){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,s,c,_),this.serializer=f}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(t,r){return this.connection.Bo("Write",t,r)}E_(t){return qi(!!t.streamToken),this.lastStreamToken=t.streamToken,qi(!t.writeResults||t.writeResults.length===0),this.listener.f_()}onNext(t){qi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.t_.reset();const r=yfe(t.writeResults,t.commitTime),s=$u(t.commitTime);return this.listener.g_(s,r)}p_(){const t={};t.database=kk(this.serializer),this.a_(t)}m_(t){const r={streamToken:this.lastStreamToken,writes:t.map(s=>_fe(this.serializer,s))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ope extends class{}{constructor(t,r,s,c){super(),this.authCredentials=t,this.appCheckCredentials=r,this.connection=s,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new Ln(en.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(t,r,s,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,_])=>this.connection.Mo(t,Rk(r,s),c,f,_)).catch(f=>{throw f.name==="FirebaseError"?(f.code===en.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new Ln(en.UNKNOWN,f.toString())})}Lo(t,r,s,c,f){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([_,x])=>this.connection.Lo(t,Rk(r,s),c,_,x,f)).catch(_=>{throw _.name==="FirebaseError"?(_.code===en.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new Ln(en.UNKNOWN,_.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class ape{constructor(t,r){this.asyncQueue=t,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(t){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.C_("Offline")))}set(t){this.x_(),this.S_=0,t==="Online"&&(this.D_=!1),this.C_(t)}C_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}F_(t){const r=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Jh(r),this.D_=!1):Hn("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lpe{constructor(t,r,s,c,f){this.localStore=t,this.datastore=r,this.asyncQueue=s,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=f,this.k_._o(_=>{s.enqueueAndForget(()=>Be(this,null,function*(){dg(this)&&(Hn("RemoteStore","Restarting streams for network reachability change."),yield function(a){return Be(this,null,function*(){const I=Rr(a);I.L_.add(4),yield mb(I),I.q_.set("Unknown"),I.L_.delete(4),yield yC(I)})}(this))}))}),this.q_=new ape(s,c)}}function yC(e){return Be(this,null,function*(){if(dg(e))for(const t of e.B_)yield t(!0)})}function mb(e){return Be(this,null,function*(){for(const t of e.B_)yield t(!1)})}function kW(e,t){const r=Rr(e);r.N_.has(t.targetId)||(r.N_.set(t.targetId,t),NO(r)?zO(r):l0(r).r_()&&LO(r,t))}function OO(e,t){const r=Rr(e),s=l0(r);r.N_.delete(t),s.r_()&&DW(r,t),r.N_.size===0&&(s.r_()?s.o_():dg(r)&&r.q_.set("Unknown"))}function LO(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Pr.min())>0){const r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}l0(e).A_(t)}function DW(e,t){e.Q_.xe(t),l0(e).R_(t)}function zO(e){e.Q_=new cfe({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),l0(e).start(),e.q_.v_()}function NO(e){return dg(e)&&!l0(e).n_()&&e.N_.size>0}function dg(e){return Rr(e).L_.size===0}function OW(e){e.Q_=void 0}function cpe(e){return Be(this,null,function*(){e.q_.set("Online")})}function upe(e){return Be(this,null,function*(){e.N_.forEach((t,r)=>{LO(e,t)})})}function hpe(e,t){return Be(this,null,function*(){OW(e),NO(e)?(e.q_.M_(t),zO(e)):e.q_.set("Unknown")})}function dpe(e,t,r){return Be(this,null,function*(){if(e.q_.set("Online"),t instanceof xW&&t.state===2&&t.cause)try{yield function(c,f){return Be(this,null,function*(){const _=f.cause;for(const x of f.targetIds)c.N_.has(x)&&(yield c.remoteSyncer.rejectListen(x,_),c.N_.delete(x),c.Q_.removeTarget(x))})}(e,t)}catch(s){Hn("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),s),yield jS(e,s)}else if(t instanceof OE?e.Q_.Ke(t):t instanceof vW?e.Q_.He(t):e.Q_.We(t),!r.isEqual(Pr.min()))try{const s=yield PW(e.localStore);r.compareTo(s)>=0&&(yield function(f,_){const x=f.Q_.rt(_);return x.targetChanges.forEach((a,I)=>{if(a.resumeToken.approximateByteSize()>0){const D=f.N_.get(I);D&&f.N_.set(I,D.withResumeToken(a.resumeToken,_))}}),x.targetMismatches.forEach((a,I)=>{const D=f.N_.get(a);if(!D)return;f.N_.set(a,D.withResumeToken(Fo.EMPTY_BYTE_STRING,D.snapshotVersion)),DW(f,a);const O=new vf(D.target,a,I,D.sequenceNumber);LO(f,O)}),f.remoteSyncer.applyRemoteEvent(x)}(e,r))}catch(s){Hn("RemoteStore","Failed to raise snapshot:",s),yield jS(e,s)}})}function jS(e,t,r){return Be(this,null,function*(){if(!db(t))throw t;e.L_.add(1),yield mb(e),e.q_.set("Offline"),r||(r=()=>PW(e.localStore)),e.asyncQueue.enqueueRetryable(()=>Be(this,null,function*(){Hn("RemoteStore","Retrying IndexedDB access"),yield r(),e.L_.delete(1),yield yC(e)}))})}function LW(e,t){return t().catch(r=>jS(e,r,t))}function vC(e){return Be(this,null,function*(){const t=Rr(e),r=$f(t);let s=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;fpe(t);)try{const c=yield Kfe(t.localStore,s);if(c===null){t.O_.length===0&&r.o_();break}s=c.batchId,ppe(t,c)}catch(c){yield jS(t,c)}zW(t)&&NW(t)})}function fpe(e){return dg(e)&&e.O_.length<10}function ppe(e,t){e.O_.push(t);const r=$f(e);r.r_()&&r.V_&&r.m_(t.mutations)}function zW(e){return dg(e)&&!$f(e).n_()&&e.O_.length>0}function NW(e){$f(e).start()}function mpe(e){return Be(this,null,function*(){$f(e).p_()})}function gpe(e){return Be(this,null,function*(){const t=$f(e);for(const r of e.O_)t.m_(r.mutations)})}function _pe(e,t,r){return Be(this,null,function*(){const s=e.O_.shift(),c=AO.from(s,t,r);yield LW(e,()=>e.remoteSyncer.applySuccessfulWrite(c)),yield vC(e)})}function ype(e,t){return Be(this,null,function*(){t&&$f(e).V_&&(yield function(s,c){return Be(this,null,function*(){if(function(_){return ofe(_)&&_!==en.ABORTED}(c.code)){const f=s.O_.shift();$f(s).s_(),yield LW(s,()=>s.remoteSyncer.rejectFailedWrite(f.batchId,c)),yield vC(s)}})}(e,t)),zW(e)&&NW(e)})}function RU(e,t){return Be(this,null,function*(){const r=Rr(e);r.asyncQueue.verifyOperationInProgress(),Hn("RemoteStore","RemoteStore received new credentials");const s=dg(r);r.L_.add(3),yield mb(r),s&&r.q_.set("Unknown"),yield r.remoteSyncer.handleCredentialChange(t),r.L_.delete(3),yield yC(r)})}function vpe(e,t){return Be(this,null,function*(){const r=Rr(e);t?(r.L_.delete(2),yield yC(r)):t||(r.L_.add(2),yield mb(r),r.q_.set("Unknown"))})}function l0(e){return e.K_||(e.K_=function(r,s,c){const f=Rr(r);return f.w_(),new ipe(s,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,c)}(e.datastore,e.asyncQueue,{Eo:cpe.bind(null,e),Ro:upe.bind(null,e),mo:hpe.bind(null,e),d_:dpe.bind(null,e)}),e.B_.push(t=>Be(this,null,function*(){t?(e.K_.s_(),NO(e)?zO(e):e.q_.set("Unknown")):(yield e.K_.stop(),OW(e))}))),e.K_}function $f(e){return e.U_||(e.U_=function(r,s,c){const f=Rr(r);return f.w_(),new spe(s,f.connection,f.authCredentials,f.appCheckCredentials,f.serializer,c)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:mpe.bind(null,e),mo:ype.bind(null,e),f_:gpe.bind(null,e),g_:_pe.bind(null,e)}),e.B_.push(t=>Be(this,null,function*(){t?(e.U_.s_(),yield vC(e)):(yield e.U_.stop(),e.O_.length>0&&(Hn("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))}))),e.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FO{constructor(t,r,s,c,f){this.asyncQueue=t,this.timerId=r,this.targetTimeMs=s,this.op=c,this.removalCallback=f,this.deferred=new qh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(_=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,r,s,c,f){const _=Date.now()+s,x=new FO(t,r,_,c,f);return x.start(s),x}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ln(en.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function BO(e,t){if(Jh("AsyncQueue",`${t}: ${e}`),db(e))return new Ln(en.UNAVAILABLE,`${t}: ${e}`);throw e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(t){this.comparator=t?(r,s)=>t(r,s)||ar.comparator(r.key,s.key):(r,s)=>ar.comparator(r.key,s.key),this.keyedMap=f1(),this.sortedSet=new Cs(this.comparator)}static emptySet(t){return new my(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const r=this.keyedMap.get(t);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((r,s)=>(t(r),!1))}add(t){const r=this.delete(t.key);return r.copy(r.keyedMap.insert(t.key,t),r.sortedSet.insert(t,null))}delete(t){const r=this.get(t);return r?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(r)):this}isEqual(t){if(!(t instanceof my)||this.size!==t.size)return!1;const r=this.sortedSet.getIterator(),s=t.sortedSet.getIterator();for(;r.hasNext();){const c=r.getNext().key,f=s.getNext().key;if(!c.isEqual(f))return!1}return!0}toString(){const t=[];return this.forEach(r=>{t.push(r.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,r){const s=new my;return s.comparator=this.comparator,s.keyedMap=t,s.sortedSet=r,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MU{constructor(){this.W_=new Cs(ar.comparator)}track(t){const r=t.doc.key,s=this.W_.get(r);s?t.type!==0&&s.type===3?this.W_=this.W_.insert(r,t):t.type===3&&s.type!==1?this.W_=this.W_.insert(r,{type:s.type,doc:t.doc}):t.type===2&&s.type===2?this.W_=this.W_.insert(r,{type:2,doc:t.doc}):t.type===2&&s.type===0?this.W_=this.W_.insert(r,{type:0,doc:t.doc}):t.type===1&&s.type===0?this.W_=this.W_.remove(r):t.type===1&&s.type===2?this.W_=this.W_.insert(r,{type:1,doc:s.doc}):t.type===0&&s.type===1?this.W_=this.W_.insert(r,{type:2,doc:t.doc}):Sr():this.W_=this.W_.insert(r,t)}G_(){const t=[];return this.W_.inorderTraversal((r,s)=>{t.push(s)}),t}}class jy{constructor(t,r,s,c,f,_,x,a,I){this.query=t,this.docs=r,this.oldDocs=s,this.docChanges=c,this.mutatedKeys=f,this.fromCache=_,this.syncStateChanged=x,this.excludesMetadataChanges=a,this.hasCachedResults=I}static fromInitialDocuments(t,r,s,c,f){const _=[];return r.forEach(x=>{_.push({type:0,doc:x})}),new jy(t,r,my.emptySet(r),_,s,c,!0,!1,f)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&dC(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const r=this.docChanges,s=t.docChanges;if(r.length!==s.length)return!1;for(let c=0;c<r.length;c++)if(r[c].type!==s[c].type||!r[c].doc.isEqual(s[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xpe{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(t=>t.J_())}}class bpe{constructor(){this.queries=kU(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,s){const c=Rr(r),f=c.queries;c.queries=kU(),f.forEach((_,x)=>{for(const a of x.j_)a.onError(s)})})(this,new Ln(en.ABORTED,"Firestore shutting down"))}}function kU(){return new a0(e=>oW(e),dC)}function jO(e,t){return Be(this,null,function*(){const r=Rr(e);let s=3;const c=t.query;let f=r.queries.get(c);f?!f.H_()&&t.J_()&&(s=2):(f=new xpe,s=t.J_()?0:1);try{switch(s){case 0:f.z_=yield r.onListen(c,!0);break;case 1:f.z_=yield r.onListen(c,!1);break;case 2:yield r.onFirstRemoteStoreListen(c)}}catch(_){const x=BO(_,`Initialization of query '${L_(t.query)}' failed`);return void t.onError(x)}r.queries.set(c,f),f.j_.push(t),t.Z_(r.onlineState),f.z_&&t.X_(f.z_)&&VO(r)})}function UO(e,t){return Be(this,null,function*(){const r=Rr(e),s=t.query;let c=3;const f=r.queries.get(s);if(f){const _=f.j_.indexOf(t);_>=0&&(f.j_.splice(_,1),f.j_.length===0?c=t.J_()?0:1:!f.H_()&&t.J_()&&(c=2))}switch(c){case 0:return r.queries.delete(s),r.onUnlisten(s,!0);case 1:return r.queries.delete(s),r.onUnlisten(s,!1);case 2:return r.onLastRemoteStoreUnlisten(s);default:return}})}function wpe(e,t){const r=Rr(e);let s=!1;for(const c of t){const f=c.query,_=r.queries.get(f);if(_){for(const x of _.j_)x.X_(c)&&(s=!0);_.z_=c}}s&&VO(r)}function Tpe(e,t,r){const s=Rr(e),c=s.queries.get(t);if(c)for(const f of c.j_)f.onError(r);s.queries.delete(t)}function VO(e){e.Y_.forEach(t=>{t.next()})}var Ok,DU;(DU=Ok||(Ok={})).ea="default",DU.Cache="cache";class $O{constructor(t,r,s){this.query=t,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=s||{}}X_(t){if(!this.options.includeMetadataChanges){const s=[];for(const c of t.docChanges)c.type!==3&&s.push(c);t=new jy(t.query,t.docs,t.oldDocs,s,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let r=!1;return this.na?this.ia(t)&&(this.ta.next(t),r=!0):this.sa(t,this.onlineState)&&(this.oa(t),r=!0),this.ra=t,r}onError(t){this.ta.error(t)}Z_(t){this.onlineState=t;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,t)&&(this.oa(this.ra),r=!0),r}sa(t,r){if(!t.fromCache||!this.J_())return!0;const s=r!=="Offline";return(!this.options._a||!s)&&(!t.docs.isEmpty()||t.hasCachedResults||r==="Offline")}ia(t){if(t.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(t){t=jy.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.na=!0,this.ta.next(t)}J_(){return this.options.source!==Ok.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FW{constructor(t){this.key=t}}class BW{constructor(t){this.key=t}}class Epe{constructor(t,r){this.query=t,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Qr(),this.mutatedKeys=Qr(),this.Aa=aW(t),this.Ra=new my(this.Aa)}get Va(){return this.Ta}ma(t,r){const s=r?r.fa:new MU,c=r?r.Ra:this.Ra;let f=r?r.mutatedKeys:this.mutatedKeys,_=c,x=!1;const a=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,I=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(t.inorderTraversal((D,O)=>{const F=c.get(D),H=fC(this.query,O)?O:null,Q=!!F&&this.mutatedKeys.has(F.key),ie=!!H&&(H.hasLocalMutations||this.mutatedKeys.has(H.key)&&H.hasCommittedMutations);let te=!1;F&&H?F.data.isEqual(H.data)?Q!==ie&&(s.track({type:3,doc:H}),te=!0):this.ga(F,H)||(s.track({type:2,doc:H}),te=!0,(a&&this.Aa(H,a)>0||I&&this.Aa(H,I)<0)&&(x=!0)):!F&&H?(s.track({type:0,doc:H}),te=!0):F&&!H&&(s.track({type:1,doc:F}),te=!0,(a||I)&&(x=!0)),te&&(H?(_=_.add(H),f=ie?f.add(D):f.delete(D)):(_=_.delete(D),f=f.delete(D)))}),this.query.limit!==null)for(;_.size>this.query.limit;){const D=this.query.limitType==="F"?_.last():_.first();_=_.delete(D.key),f=f.delete(D.key),s.track({type:1,doc:D})}return{Ra:_,fa:s,ns:x,mutatedKeys:f}}ga(t,r){return t.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(t,r,s,c){const f=this.Ra;this.Ra=t.Ra,this.mutatedKeys=t.mutatedKeys;const _=t.fa.G_();_.sort((D,O)=>function(H,Q){const ie=te=>{switch(te){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Sr()}};return ie(H)-ie(Q)}(D.type,O.type)||this.Aa(D.doc,O.doc)),this.pa(s),c=c!=null&&c;const x=r&&!c?this.ya():[],a=this.da.size===0&&this.current&&!c?1:0,I=a!==this.Ea;return this.Ea=a,_.length!==0||I?{snapshot:new jy(this.query,t.Ra,f,_,t.mutatedKeys,a===0,I,!1,!!s&&s.resumeToken.approximateByteSize()>0),wa:x}:{wa:x}}Z_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new MU,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(t){return!this.Ta.has(t)&&!!this.Ra.has(t)&&!this.Ra.get(t).hasLocalMutations}pa(t){t&&(t.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),t.modifiedDocuments.forEach(r=>{}),t.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=t.current)}ya(){if(!this.current)return[];const t=this.da;this.da=Qr(),this.Ra.forEach(s=>{this.Sa(s.key)&&(this.da=this.da.add(s.key))});const r=[];return t.forEach(s=>{this.da.has(s)||r.push(new BW(s))}),this.da.forEach(s=>{t.has(s)||r.push(new FW(s))}),r}ba(t){this.Ta=t.Ts,this.da=Qr();const r=this.ma(t.documents);return this.applyChanges(r,!0)}Da(){return jy.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Spe{constructor(t,r,s){this.query=t,this.targetId=r,this.view=s}}class Ipe{constructor(t){this.key=t,this.va=!1}}class Cpe{constructor(t,r,s,c,f,_){this.localStore=t,this.remoteStore=r,this.eventManager=s,this.sharedClientState=c,this.currentUser=f,this.maxConcurrentLimboResolutions=_,this.Ca={},this.Fa=new a0(x=>oW(x),dC),this.Ma=new Map,this.xa=new Set,this.Oa=new Cs(ar.comparator),this.Na=new Map,this.La=new MO,this.Ba={},this.ka=new Map,this.qa=By.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}function Ape(e,t,r=!0){return Be(this,null,function*(){const s=GW(e);let c;const f=s.Fa.get(t);return f?(s.sharedClientState.addLocalQueryTarget(f.targetId),c=f.view.Da()):c=yield jW(s,t,r,!0),c})}function Ppe(e,t){return Be(this,null,function*(){const r=GW(e);yield jW(r,t,!0,!1)})}function jW(e,t,r,s){return Be(this,null,function*(){const c=yield Qfe(e.localStore,Vu(t)),f=c.targetId,_=r?e.sharedClientState.addLocalQueryTarget(f):"not-current";let x;return s&&(x=yield Rpe(e,t,f,_==="current",c.resumeToken)),e.isPrimaryClient&&r&&kW(e.remoteStore,c),x})}function Rpe(e,t,r,s,c){return Be(this,null,function*(){e.Ka=(O,F,H)=>function(ie,te,W,X){return Be(this,null,function*(){let ee=te.view.ma(W);ee.ns&&(ee=yield CU(ie.localStore,te.query,!1).then(({documents:re})=>te.view.ma(re,ee)));const fe=X&&X.targetChanges.get(te.targetId),ye=X&&X.targetMismatches.get(te.targetId)!=null,Ee=te.view.applyChanges(ee,ie.isPrimaryClient,fe,ye);return LU(ie,te.targetId,Ee.wa),Ee.snapshot})}(e,O,F,H);const f=yield CU(e.localStore,t,!0),_=new Epe(t,f.Ts),x=_.ma(f.documents),a=pb.createSynthesizedTargetChangeForCurrentChange(r,s&&e.onlineState!=="Offline",c),I=_.applyChanges(x,e.isPrimaryClient,a);LU(e,r,I.wa);const D=new Spe(t,r,_);return e.Fa.set(t,D),e.Ma.has(r)?e.Ma.get(r).push(t):e.Ma.set(r,[t]),I.snapshot})}function Mpe(e,t,r){return Be(this,null,function*(){const s=Rr(e),c=s.Fa.get(t),f=s.Ma.get(c.targetId);if(f.length>1)return s.Ma.set(c.targetId,f.filter(_=>!dC(_,t))),void s.Fa.delete(t);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(c.targetId),s.sharedClientState.isActiveQueryTarget(c.targetId)||(yield Dk(s.localStore,c.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(c.targetId),r&&OO(s.remoteStore,c.targetId),Lk(s,c.targetId)}).catch(hb))):(Lk(s,c.targetId),yield Dk(s.localStore,c.targetId,!0))})}function kpe(e,t){return Be(this,null,function*(){const r=Rr(e),s=r.Fa.get(t),c=r.Ma.get(s.targetId);r.isPrimaryClient&&c.length===1&&(r.sharedClientState.removeLocalQueryTarget(s.targetId),OO(r.remoteStore,s.targetId))})}function Dpe(e,t,r){return Be(this,null,function*(){const s=jpe(e);try{const c=yield function(_,x){const a=Rr(_),I=yo.now(),D=x.reduce((H,Q)=>H.add(Q.key),Qr());let O,F;return a.persistence.runTransaction("Locally write mutations","readwrite",H=>{let Q=ed(),ie=Qr();return a.cs.getEntries(H,D).next(te=>{Q=te,Q.forEach((W,X)=>{X.isValidDocument()||(ie=ie.add(W))})}).next(()=>a.localDocuments.getOverlayedDocuments(H,Q)).next(te=>{O=te;const W=[];for(const X of x){const ee=tfe(X,O.get(X.key).overlayedDocument);ee!=null&&W.push(new rp(X.key,ee,YG(ee.value.mapValue),Yl.exists(!0)))}return a.mutationQueue.addMutationBatch(H,I,W,x)}).next(te=>{F=te;const W=te.applyToLocalDocumentSet(O,ie);return a.documentOverlayCache.saveOverlays(H,te.batchId,W)})}).then(()=>({batchId:F.batchId,changes:cW(O)}))}(s.localStore,t);s.sharedClientState.addPendingMutation(c.batchId),function(_,x,a){let I=_.Ba[_.currentUser.toKey()];I||(I=new Cs(hi)),I=I.insert(x,a),_.Ba[_.currentUser.toKey()]=I}(s,c.batchId,r),yield gb(s,c.changes),yield vC(s.remoteStore)}catch(c){const f=BO(c,"Failed to persist write");r.reject(f)}})}function UW(e,t){return Be(this,null,function*(){const r=Rr(e);try{const s=yield Zfe(r.localStore,t);t.targetChanges.forEach((c,f)=>{const _=r.Na.get(f);_&&(qi(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?_.va=!0:c.modifiedDocuments.size>0?qi(_.va):c.removedDocuments.size>0&&(qi(_.va),_.va=!1))}),yield gb(r,s,t)}catch(s){yield hb(s)}})}function OU(e,t,r){const s=Rr(e);if(s.isPrimaryClient&&r===0||!s.isPrimaryClient&&r===1){const c=[];s.Fa.forEach((f,_)=>{const x=_.view.Z_(t);x.snapshot&&c.push(x.snapshot)}),function(_,x){const a=Rr(_);a.onlineState=x;let I=!1;a.queries.forEach((D,O)=>{for(const F of O.j_)F.Z_(x)&&(I=!0)}),I&&VO(a)}(s.eventManager,t),c.length&&s.Ca.d_(c),s.onlineState=t,s.isPrimaryClient&&s.sharedClientState.setOnlineState(t)}}function Ope(e,t,r){return Be(this,null,function*(){const s=Rr(e);s.sharedClientState.updateQueryState(t,"rejected",r);const c=s.Na.get(t),f=c&&c.key;if(f){let _=new Cs(ar.comparator);_=_.insert(f,ea.newNoDocument(f,Pr.min()));const x=Qr().add(f),a=new gC(Pr.min(),new Map,new Cs(hi),_,x);yield UW(s,a),s.Oa=s.Oa.remove(f),s.Na.delete(t),qO(s)}else yield Dk(s.localStore,t,!1).then(()=>Lk(s,t,r)).catch(hb)})}function Lpe(e,t){return Be(this,null,function*(){const r=Rr(e),s=t.batch.batchId;try{const c=yield Hfe(r.localStore,t);$W(r,s,null),VW(r,s),r.sharedClientState.updateMutationState(s,"acknowledged"),yield gb(r,c)}catch(c){yield hb(c)}})}function zpe(e,t,r){return Be(this,null,function*(){const s=Rr(e);try{const c=yield function(_,x){const a=Rr(_);return a.persistence.runTransaction("Reject batch","readwrite-primary",I=>{let D;return a.mutationQueue.lookupMutationBatch(I,x).next(O=>(qi(O!==null),D=O.keys(),a.mutationQueue.removeMutationBatch(I,O))).next(()=>a.mutationQueue.performConsistencyCheck(I)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(I,D,x)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(I,D)).next(()=>a.localDocuments.getDocuments(I,D))})}(s.localStore,t);$W(s,t,r),VW(s,t),s.sharedClientState.updateMutationState(t,"rejected",r),yield gb(s,c)}catch(c){yield hb(c)}})}function VW(e,t){(e.ka.get(t)||[]).forEach(r=>{r.resolve()}),e.ka.delete(t)}function $W(e,t,r){const s=Rr(e);let c=s.Ba[s.currentUser.toKey()];if(c){const f=c.get(t);f&&(r?f.reject(r):f.resolve(),c=c.remove(t)),s.Ba[s.currentUser.toKey()]=c}}function Lk(e,t,r=null){e.sharedClientState.removeLocalQueryTarget(t);for(const s of e.Ma.get(t))e.Fa.delete(s),r&&e.Ca.$a(s,r);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach(s=>{e.La.containsKey(s)||qW(e,s)})}function qW(e,t){e.xa.delete(t.path.canonicalString());const r=e.Oa.get(t);r!==null&&(OO(e.remoteStore,r),e.Oa=e.Oa.remove(t),e.Na.delete(r),qO(e))}function LU(e,t,r){for(const s of r)s instanceof FW?(e.La.addReference(s.key,t),Npe(e,s)):s instanceof BW?(Hn("SyncEngine","Document no longer in limbo: "+s.key),e.La.removeReference(s.key,t),e.La.containsKey(s.key)||qW(e,s.key)):Sr()}function Npe(e,t){const r=t.key,s=r.path.canonicalString();e.Oa.get(r)||e.xa.has(s)||(Hn("SyncEngine","New document in limbo: "+r),e.xa.add(s),qO(e))}function qO(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const r=new ar(os.fromString(t)),s=e.qa.next();e.Na.set(s,new Ipe(r)),e.Oa=e.Oa.insert(r,s),kW(e.remoteStore,new vf(Vu(hC(r.path)),s,"TargetPurposeLimboResolution",vO.oe))}}function gb(e,t,r){return Be(this,null,function*(){const s=Rr(e),c=[],f=[],_=[];s.Fa.isEmpty()||(s.Fa.forEach((x,a)=>{_.push(s.Ka(a,t,r).then(I=>{var D;if((I||r)&&s.isPrimaryClient){const O=I?!I.fromCache:(D=r==null?void 0:r.targetChanges.get(a.targetId))===null||D===void 0?void 0:D.current;s.sharedClientState.updateQueryState(a.targetId,O?"current":"not-current")}if(I){c.push(I);const O=DO.Wi(a.targetId,I);f.push(O)}}))}),yield Promise.all(_),s.Ca.d_(c),yield function(a,I){return Be(this,null,function*(){const D=Rr(a);try{yield D.persistence.runTransaction("notifyLocalViewChanges","readwrite",O=>on.forEach(I,F=>on.forEach(F.$i,H=>D.persistence.referenceDelegate.addReference(O,F.targetId,H)).next(()=>on.forEach(F.Ui,H=>D.persistence.referenceDelegate.removeReference(O,F.targetId,H)))))}catch(O){if(!db(O))throw O;Hn("LocalStore","Failed to update sequence numbers: "+O)}for(const O of I){const F=O.targetId;if(!O.fromCache){const H=D.os.get(F),Q=H.snapshotVersion,ie=H.withLastLimboFreeSnapshotVersion(Q);D.os=D.os.insert(F,ie)}}})}(s.localStore,f))})}function Fpe(e,t){return Be(this,null,function*(){const r=Rr(e);if(!r.currentUser.isEqual(t)){Hn("SyncEngine","User change. New user:",t.toKey());const s=yield AW(r.localStore,t);r.currentUser=t,function(f,_){f.ka.forEach(x=>{x.forEach(a=>{a.reject(new Ln(en.CANCELLED,_))})}),f.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,s.removedBatchIds,s.addedBatchIds),yield gb(r,s.hs)}})}function Bpe(e,t){const r=Rr(e),s=r.Na.get(t);if(s&&s.va)return Qr().add(s.key);{let c=Qr();const f=r.Ma.get(t);if(!f)return c;for(const _ of f){const x=r.Fa.get(_);c=c.unionWith(x.view.Va)}return c}}function GW(e){const t=Rr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=UW.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Bpe.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ope.bind(null,t),t.Ca.d_=wpe.bind(null,t.eventManager),t.Ca.$a=Tpe.bind(null,t.eventManager),t}function jpe(e){const t=Rr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Lpe.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=zpe.bind(null,t),t}class zU{constructor(){this.synchronizeTabs=!1}initialize(t){return Be(this,null,function*(){this.serializer=_C(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,r){return null}createIndexBackfillerScheduler(t,r){return null}createLocalStore(t){return Wfe(this.persistence,new qfe,t.initialUser,this.serializer)}createPersistence(t){return new Ufe(kO.Zr,this.serializer)}createSharedClientState(t){return new Jfe}terminate(){return Be(this,null,function*(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}class Upe{initialize(t,r){return Be(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>OU(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=Fpe.bind(null,this.syncEngine),yield vpe(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new bpe}()}createDatastore(t){const r=_C(t.databaseInfo.databaseId),s=function(f){return new rpe(f)}(t.databaseInfo);return function(f,_,x,a){return new ope(f,_,x,a)}(t.authCredentials,t.appCheckCredentials,s,r)}createRemoteStore(t){return function(s,c,f,_,x){return new lpe(s,c,f,_,x)}(this.localStore,this.datastore,t.asyncQueue,r=>OU(this.syncEngine,r,0),function(){return PU.D()?new PU:new epe}())}createSyncEngine(t,r){return function(c,f,_,x,a,I,D){const O=new Cpe(c,f,_,x,a,I);return D&&(O.Qa=!0),O}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}terminate(){return Be(this,null,function*(){var t,r;yield function(c){return Be(this,null,function*(){const f=Rr(c);Hn("RemoteStore","RemoteStore shutting down."),f.L_.add(5),yield mb(f),f.k_.shutdown(),f.q_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GO{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ga(this.observer.next,t)}error(t){this.observer.error?this.Ga(this.observer.error,t):Jh("Uncaught Error in snapshot listener:",t.toString())}za(){this.muted=!0}Ga(t,r){this.muted||setTimeout(()=>{this.muted||t(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vpe{constructor(t,r,s,c){this.authCredentials=t,this.appCheckCredentials=r,this.asyncQueue=s,this.databaseInfo=c,this.user=Yo.UNAUTHENTICATED,this.clientId=XG.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,f=>Be(this,null,function*(){Hn("FirestoreClient","Received user=",f.uid),yield this.authCredentialListener(f),this.user=f})),this.appCheckCredentials.start(s,f=>(Hn("FirestoreClient","Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ln(en.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new qh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>Be(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=BO(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function CR(e,t){return Be(this,null,function*(){e.asyncQueue.verifyOperationInProgress(),Hn("FirestoreClient","Initializing OfflineComponentProvider");const r=e.configuration;yield t.initialize(r);let s=r.initialUser;e.setCredentialChangeListener(c=>Be(this,null,function*(){s.isEqual(c)||(yield AW(t.localStore,c),s=c)})),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t})}function NU(e,t){return Be(this,null,function*(){e.asyncQueue.verifyOperationInProgress();const r=yield qpe(e);Hn("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(r,e.configuration),e.setCredentialChangeListener(s=>RU(t.remoteStore,s)),e.setAppCheckTokenChangeListener((s,c)=>RU(t.remoteStore,c)),e._onlineComponents=t})}function $pe(e){return e.name==="FirebaseError"?e.code===en.FAILED_PRECONDITION||e.code===en.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&e instanceof DOMException)||e.code===22||e.code===20||e.code===11}function qpe(e){return Be(this,null,function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Hn("FirestoreClient","Using user provided OfflineComponentProvider");try{yield CR(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!$pe(r))throw r;Dy("Error using user provided cache. Falling back to memory cache: "+r),yield CR(e,new zU)}}else Hn("FirestoreClient","Using default OfflineComponentProvider"),yield CR(e,new zU);return e._offlineComponents})}function WW(e){return Be(this,null,function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(Hn("FirestoreClient","Using user provided OnlineComponentProvider"),yield NU(e,e._uninitializedComponentsProvider._online)):(Hn("FirestoreClient","Using default OnlineComponentProvider"),yield NU(e,new Upe))),e._onlineComponents})}function Gpe(e){return WW(e).then(t=>t.syncEngine)}function US(e){return Be(this,null,function*(){const t=yield WW(e),r=t.eventManager;return r.onListen=Ape.bind(null,t.syncEngine),r.onUnlisten=Mpe.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=Ppe.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=kpe.bind(null,t.syncEngine),r})}function Wpe(e,t,r={}){const s=new qh;return e.asyncQueue.enqueueAndForget(()=>Be(this,null,function*(){return function(f,_,x,a,I){const D=new GO({next:F=>{_.enqueueAndForget(()=>UO(f,O));const H=F.docs.has(x);!H&&F.fromCache?I.reject(new Ln(en.UNAVAILABLE,"Failed to get document because the client is offline.")):H&&F.fromCache&&a&&a.source==="server"?I.reject(new Ln(en.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):I.resolve(F)},error:F=>I.reject(F)}),O=new $O(hC(x.path),D,{includeMetadataChanges:!0,_a:!0});return jO(f,O)}(yield US(e),e.asyncQueue,t,r,s)})),s.promise}function Hpe(e,t,r={}){const s=new qh;return e.asyncQueue.enqueueAndForget(()=>Be(this,null,function*(){return function(f,_,x,a,I){const D=new GO({next:F=>{_.enqueueAndForget(()=>UO(f,O)),F.fromCache&&a.source==="server"?I.reject(new Ln(en.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):I.resolve(F)},error:F=>I.reject(F)}),O=new $O(x,D,{includeMetadataChanges:!0,_a:!0});return jO(f,O)}(yield US(e),e.asyncQueue,t,r,s)})),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HW(e){const t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FU=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZW(e,t,r){if(!r)throw new Ln(en.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Zpe(e,t,r,s){if(t===!0&&s===!0)throw new Ln(en.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function BU(e){if(!ar.isDocumentKey(e))throw new Ln(en.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function jU(e){if(ar.isDocumentKey(e))throw new Ln(en.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function xC(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{const t=function(s){return s.constructor?s.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":Sr()}function Za(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Ln(en.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=xC(e);throw new Ln(en.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function Xpe(e,t){if(t<=0)throw new Ln(en.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UU{constructor(t){var r,s;if(t.host===void 0){if(t.ssl!==void 0)throw new Ln(en.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(r=t.ssl)===null||r===void 0||r;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new Ln(en.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Zpe("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=HW((s=t.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(f){if(f.timeoutSeconds!==void 0){if(isNaN(f.timeoutSeconds))throw new Ln(en.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (must not be NaN)`);if(f.timeoutSeconds<5)throw new Ln(en.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (minimum allowed value is 5)`);if(f.timeoutSeconds>30)throw new Ln(en.INVALID_ARGUMENT,`invalid long polling timeout: ${f.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(s,c){return s.timeoutSeconds===c.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class bC{constructor(t,r,s,c){this._authCredentials=t,this._appCheckCredentials=r,this._databaseId=s,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new UU({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ln(en.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new Ln(en.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new UU(t),t.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new ude;switch(s.type){case"firstParty":return new pde(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new Ln(en.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const s=FU.get(r);s&&(Hn("ComponentProvider","Removing Datastore"),FU.delete(r),s.terminate())}(this),Promise.resolve()}}function Kpe(e,t,r,s={}){var c;const f=(e=Za(e,bC))._getSettings(),_=`${t}:${r}`;if(f.host!=="firestore.googleapis.com"&&f.host!==_&&Dy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},f),{host:_,ssl:!1})),s.mockUserToken){let x,a;if(typeof s.mockUserToken=="string")x=s.mockUserToken,a=Yo.MOCK_USER;else{x=nG(s.mockUserToken,(c=e._app)===null||c===void 0?void 0:c.options.projectId);const I=s.mockUserToken.sub||s.mockUserToken.user_id;if(!I)throw new Ln(en.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Yo(I)}e._authCredentials=new hde(new ZG(x,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld{constructor(t,r,s){this.converter=r,this._query=s,this.type="query",this.firestore=t}withConverter(t){return new ld(this.firestore,t,this._query)}}class ta{constructor(t,r,s){this.converter=r,this._key=s,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Lf(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ta(this.firestore,t,this._key)}}class Lf extends ld{constructor(t,r,s){super(t,r,hC(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ta(this.firestore,null,new ar(t))}withConverter(t){return new Lf(this.firestore,t,this._path)}}function Ci(e,t,...r){if(e=js(e),ZW("collection","path",t),e instanceof bC){const s=os.fromString(t,...r);return jU(s),new Lf(e,null,s)}{if(!(e instanceof ta||e instanceof Lf))throw new Ln(en.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(os.fromString(t,...r));return jU(s),new Lf(e.firestore,null,s)}}function er(e,t,...r){if(e=js(e),arguments.length===1&&(t=XG.newId()),ZW("doc","path",t),e instanceof bC){const s=os.fromString(t,...r);return BU(s),new ta(e,null,new ar(s))}{if(!(e instanceof ta||e instanceof Lf))throw new Ln(en.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=e._path.child(os.fromString(t,...r));return BU(s),new ta(e.firestore,e instanceof Lf?e.converter:null,new ar(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qpe{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new RW(this,"async_queue_retry"),this.Eu=()=>{const r=IR();r&&Hn("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()};const t=IR();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.du(),this.Au(t)}enterRestrictedMode(t){if(!this.cu){this.cu=!0,this.Iu=t||!1;const r=IR();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Eu)}}enqueue(t){if(this.du(),this.cu)return new Promise(()=>{});const r=new qh;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(t().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.uu.push(t),this.Ru()))}Ru(){return Be(this,null,function*(){if(this.uu.length!==0){try{yield this.uu[0](),this.uu.shift(),this.t_.reset()}catch(t){if(!db(t))throw t;Hn("AsyncQueue","Operation failed with retryable error: "+t)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}})}Au(t){const r=this.au.then(()=>(this.Pu=!0,t().catch(s=>{this.hu=s,this.Pu=!1;const c=function(_){let x=_.message||"";return _.stack&&(x=_.stack.includes(_.message)?_.stack:_.message+`
`+_.stack),x}(s);throw Jh("INTERNAL UNHANDLED ERROR: ",c),s}).then(s=>(this.Pu=!1,s))));return this.au=r,r}enqueueAfterDelay(t,r,s){this.du(),this.Tu.indexOf(t)>-1&&(r=0);const c=FO.createAndSchedule(this,t,r,s,f=>this.Vu(f));return this.lu.push(c),c}du(){this.hu&&Sr()}verifyOperationInProgress(){}mu(){return Be(this,null,function*(){let t;do t=this.au,yield t;while(t!==this.au)})}fu(t){for(const r of this.lu)if(r.timerId===t)return!0;return!1}gu(t){return this.mu().then(()=>{this.lu.sort((r,s)=>r.targetTimeMs-s.targetTimeMs);for(const r of this.lu)if(r.skipDelay(),t!=="all"&&r.timerId===t)break;return this.mu()})}pu(t){this.Tu.push(t)}Vu(t){const r=this.lu.indexOf(t);this.lu.splice(r,1)}}function VU(e){return function(r,s){if(typeof r!="object"||r===null)return!1;const c=r;for(const f of s)if(f in c&&typeof c[f]=="function")return!0;return!1}(e,["next","error","complete"])}class td extends bC{constructor(t,r,s,c){super(t,r,s,c),this.type="firestore",this._queue=function(){return new Qpe}(),this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||XW(this),this._firestoreClient.terminate()}}function Ype(e,t){const r=typeof e=="object"?e:oO(),s=typeof e=="string"?e:"(default)",c=oC(r,"firestore").getImmediate({identifier:s});if(!c._initialized){const f=Jq("firestore");f&&Kpe(c,...f)}return c}function wC(e){return e._firestoreClient||XW(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function XW(e){var t,r,s;const c=e._freezeSettings(),f=function(x,a,I,D){return new Cde(x,a,I,D.host,D.ssl,D.experimentalForceLongPolling,D.experimentalAutoDetectLongPolling,HW(D.experimentalLongPollingOptions),D.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,c);e._firestoreClient=new Vpe(e._authCredentials,e._appCheckCredentials,e._queue,f),!((r=c.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((s=c.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:c.localCache.kind,_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Uy(Fo.fromBase64String(t))}catch(r){throw new Ln(en.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(t){return new Uy(Fo.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TC{constructor(...t){for(let r=0;r<t.length;++r)if(t[r].length===0)throw new Ln(en.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Oo(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WO{constructor(t,r){if(!isFinite(t)||t<-90||t>90)throw new Ln(en.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(r)||r<-180||r>180)throw new Ln(en.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=t,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return hi(this._lat,t._lat)||hi(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HO{constructor(t){this._values=(t||[]).map(r=>r)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(s,c){if(s.length!==c.length)return!1;for(let f=0;f<s.length;++f)if(s[f]!==c[f])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jpe=/^__.*__$/;class eme{constructor(t,r,s){this.data=t,this.fieldMask=r,this.fieldTransforms=s}toMutation(t,r){return this.fieldMask!==null?new rp(t,this.data,this.fieldMask,r,this.fieldTransforms):new fb(t,this.data,r,this.fieldTransforms)}}class KW{constructor(t,r,s){this.data=t,this.fieldMask=r,this.fieldTransforms=s}toMutation(t,r){return new rp(t,this.data,this.fieldMask,r,this.fieldTransforms)}}function QW(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Sr()}}class EC{constructor(t,r,s,c,f,_){this.settings=t,this.databaseId=r,this.serializer=s,this.ignoreUndefinedProperties=c,f===void 0&&this.yu(),this.fieldTransforms=f||[],this.fieldMask=_||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(t){return new EC(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(t){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(t),c=this.Su({path:s,Du:!1});return c.vu(t),c}Cu(t){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(t),c=this.Su({path:s,Du:!1});return c.yu(),c}Fu(t){return this.Su({path:void 0,Du:!0})}Mu(t){return VS(t,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(t){return this.fieldMask.find(r=>t.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>t.isPrefixOf(r.field))!==void 0}yu(){if(this.path)for(let t=0;t<this.path.length;t++)this.vu(this.path.get(t))}vu(t){if(t.length===0)throw this.Mu("Document fields must not be empty");if(QW(this.wu)&&Jpe.test(t))throw this.Mu('Document fields cannot begin and end with "__"')}}class tme{constructor(t,r,s){this.databaseId=t,this.ignoreUndefinedProperties=r,this.serializer=s||_C(t)}Nu(t,r,s,c=!1){return new EC({wu:t,methodName:r,Ou:s,path:Oo.emptyPath(),Du:!1,xu:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function SC(e){const t=e._freezeSettings(),r=_C(e._databaseId);return new tme(e._databaseId,!!t.ignoreUndefinedProperties,r)}function YW(e,t,r,s,c,f={}){const _=e.Nu(f.merge||f.mergeFields?2:0,t,r,c);QO("Data must be an object, but it was:",_,s);const x=e2(s,_);let a,I;if(f.merge)a=new fl(_.fieldMask),I=_.fieldTransforms;else if(f.mergeFields){const D=[];for(const O of f.mergeFields){const F=zk(t,O,r);if(!_.contains(F))throw new Ln(en.INVALID_ARGUMENT,`Field '${F}' is specified in your field mask but missing from your input data.`);n2(D,F)||D.push(F)}a=new fl(D),I=_.fieldTransforms.filter(O=>a.covers(O.field))}else a=null,I=_.fieldTransforms;return new eme(new Va(x),a,I)}class IC extends c0{_toFieldTransform(t){if(t.wu!==2)throw t.wu===1?t.Mu(`${this._methodName}() can only appear at the top level of your update data`):t.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof IC}}function JW(e,t,r){return new EC({wu:3,Ou:t.settings.Ou,methodName:e._methodName,Du:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class ZO extends c0{_toFieldTransform(t){return new IO(t.path,new Rx)}isEqual(t){return t instanceof ZO}}class XO extends c0{constructor(t,r){super(t),this.Lu=r}_toFieldTransform(t){const r=JW(this,t,!0),s=this.Lu.map(f=>fg(f,r)),c=new Ny(s);return new IO(t.path,c)}isEqual(t){return t instanceof XO&&ky(this.Lu,t.Lu)}}class KO extends c0{constructor(t,r){super(t),this.Lu=r}_toFieldTransform(t){const r=JW(this,t,!0),s=this.Lu.map(f=>fg(f,r)),c=new Fy(s);return new IO(t.path,c)}isEqual(t){return t instanceof KO&&ky(this.Lu,t.Lu)}}function nme(e,t,r,s){const c=e.Nu(1,t,r);QO("Data must be an object, but it was:",c,s);const f=[],_=Va.empty();hg(s,(a,I)=>{const D=YO(t,a,r);I=js(I);const O=c.Cu(D);if(I instanceof IC)f.push(D);else{const F=fg(I,O);F!=null&&(f.push(D),_.set(D,F))}});const x=new fl(f);return new KW(_,x,c.fieldTransforms)}function rme(e,t,r,s,c,f){const _=e.Nu(1,t,r),x=[zk(t,s,r)],a=[c];if(f.length%2!=0)throw new Ln(en.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let F=0;F<f.length;F+=2)x.push(zk(t,f[F])),a.push(f[F+1]);const I=[],D=Va.empty();for(let F=x.length-1;F>=0;--F)if(!n2(I,x[F])){const H=x[F];let Q=a[F];Q=js(Q);const ie=_.Cu(H);if(Q instanceof IC)I.push(H);else{const te=fg(Q,ie);te!=null&&(I.push(H),D.set(H,te))}}const O=new fl(I);return new KW(D,O,_.fieldTransforms)}function ime(e,t,r,s=!1){return fg(r,e.Nu(s?4:3,t))}function fg(e,t){if(t2(e=js(e)))return QO("Unsupported field value:",t,e),e2(e,t);if(e instanceof c0)return function(s,c){if(!QW(c.wu))throw c.Mu(`${s._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Mu(`${s._methodName}() is not currently supported inside arrays`);const f=s._toFieldTransform(c);f&&c.fieldTransforms.push(f)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Du&&t.wu!==4)throw t.Mu("Nested arrays are not supported");return function(s,c){const f=[];let _=0;for(const x of s){let a=fg(x,c.Fu(_));a==null&&(a={nullValue:"NULL_VALUE"}),f.push(a),_++}return{arrayValue:{values:f}}}(e,t)}return function(s,c){if((s=js(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Xde(c.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const f=yo.fromDate(s);return{timestampValue:BS(c.serializer,f)}}if(s instanceof yo){const f=new yo(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:BS(c.serializer,f)}}if(s instanceof WO)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Uy)return{bytesValue:bW(c.serializer,s._byteString)};if(s instanceof ta){const f=c.databaseId,_=s.firestore._databaseId;if(!_.isEqual(f))throw c.Mu(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${f.projectId}/${f.database}`);return{referenceValue:RO(s.firestore._databaseId||c.databaseId,s._key.path)}}if(s instanceof HO)return function(_,x){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:_.toArray().map(a=>{if(typeof a!="number")throw x.Mu("VectorValues must only contain numeric values.");return SO(x.serializer,a)})}}}}}}(s,c);throw c.Mu(`Unsupported field value: ${xC(s)}`)}(e,t)}function e2(e,t){const r={};return KG(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):hg(e,(s,c)=>{const f=fg(c,t.bu(s));f!=null&&(r[s]=f)}),{mapValue:{fields:r}}}function t2(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof yo||e instanceof WO||e instanceof Uy||e instanceof ta||e instanceof c0||e instanceof HO)}function QO(e,t,r){if(!t2(r)||!function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)}(r)){const s=xC(r);throw s==="an object"?t.Mu(e+" a custom object"):t.Mu(e+" "+s)}}function zk(e,t,r){if((t=js(t))instanceof TC)return t._internalPath;if(typeof t=="string")return YO(e,t);throw VS("Field path arguments must be of type string or ",e,!1,void 0,r)}const sme=new RegExp("[~\\*/\\[\\]]");function YO(e,t,r){if(t.search(sme)>=0)throw VS(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new TC(...t.split("."))._internalPath}catch(s){throw VS(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function VS(e,t,r,s,c){const f=s&&!s.isEmpty(),_=c!==void 0;let x=`Function ${t}() called with invalid data`;r&&(x+=" (via `toFirestore()`)"),x+=". ";let a="";return(f||_)&&(a+=" (found",f&&(a+=` in field ${s}`),_&&(a+=` in document ${c}`),a+=")"),new Ln(en.INVALID_ARGUMENT,x+e+a)}function n2(e,t){return e.some(r=>r.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r2{constructor(t,r,s,c,f){this._firestore=t,this._userDataWriter=r,this._key=s,this._document=c,this._converter=f}get id(){return this._key.path.lastSegment()}get ref(){return new ta(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new ome(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const r=this._document.data.field(CC("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r)}}}class ome extends r2{data(){return super.data()}}function CC(e,t){return typeof t=="string"?YO(e,t):t instanceof TC?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i2(e){if(e.limitType==="L"&&e.explicitOrderBy.length===0)throw new Ln(en.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class JO{}class e5 extends JO{}function go(e,t,...r){let s=[];t instanceof JO&&s.push(t),s=s.concat(r),function(f){const _=f.filter(a=>a instanceof t5).length,x=f.filter(a=>a instanceof AC).length;if(_>1||_>0&&x>0)throw new Ln(en.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const c of s)e=c._apply(e);return e}class AC extends e5{constructor(t,r,s){super(),this._field=t,this._op=r,this._value=s,this.type="where"}static _create(t,r,s){return new AC(t,r,s)}_apply(t){const r=this._parse(t);return s2(t._query,r),new ld(t.firestore,t.converter,Ak(t._query,r))}_parse(t){const r=SC(t.firestore);return function(f,_,x,a,I,D,O){let F;if(I.isKeyField()){if(D==="array-contains"||D==="array-contains-any")throw new Ln(en.INVALID_ARGUMENT,`Invalid Query. You can't perform '${D}' queries on documentId().`);if(D==="in"||D==="not-in"){qU(O,D);const H=[];for(const Q of O)H.push($U(a,f,Q));F={arrayValue:{values:H}}}else F=$U(a,f,O)}else D!=="in"&&D!=="not-in"&&D!=="array-contains-any"||qU(O,D),F=ime(x,_,O,D==="in"||D==="not-in");return so.create(I,D,F)}(t._query,"where",r,t.firestore._databaseId,this._field,this._op,this._value)}}function Ii(e,t,r){const s=t,c=CC("where",e);return AC._create(c,s,r)}class t5 extends JO{constructor(t,r){super(),this.type=t,this._queryConstraints=r}static _create(t,r){return new t5(t,r)}_parse(t){const r=this._queryConstraints.map(s=>s._parse(t)).filter(s=>s.getFilters().length>0);return r.length===1?r[0]:Hc.create(r,this._getOperator())}_apply(t){const r=this._parse(t);return r.getFilters().length===0?t:(function(c,f){let _=c;const x=f.getFlattenedFilters();for(const a of x)s2(_,a),_=Ak(_,a)}(t._query,r),new ld(t.firestore,t.converter,Ak(t._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class n5 extends e5{constructor(t,r){super(),this._field=t,this._direction=r,this.type="orderBy"}static _create(t,r){return new n5(t,r)}_apply(t){const r=function(c,f,_){if(c.startAt!==null)throw new Ln(en.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(c.endAt!==null)throw new Ln(en.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Px(f,_)}(t._query,this._field,this._direction);return new ld(t.firestore,t.converter,function(c,f){const _=c.explicitOrderBy.concat([f]);return new o0(c.path,c.collectionGroup,_,c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(t._query,r))}}function Mx(e,t="asc"){const r=t,s=CC("orderBy",e);return n5._create(s,r)}class r5 extends e5{constructor(t,r,s){super(),this.type=t,this._limit=r,this._limitType=s}static _create(t,r,s){return new r5(t,r,s)}_apply(t){return new ld(t.firestore,t.converter,NS(t._query,this._limit,this._limitType))}}function i5(e){return Xpe("limit",e),r5._create("limit",e,"F")}function $U(e,t,r){if(typeof(r=js(r))=="string"){if(r==="")throw new Ln(en.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sW(t)&&r.indexOf("/")!==-1)throw new Ln(en.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const s=t.path.child(os.fromString(r));if(!ar.isDocumentKey(s))throw new Ln(en.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return uU(e,new ar(s))}if(r instanceof ta)return uU(e,r._key);throw new Ln(en.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${xC(r)}.`)}function qU(e,t){if(!Array.isArray(e)||e.length===0)throw new Ln(en.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function s2(e,t){const r=function(c,f){for(const _ of c)for(const x of _.getFlattenedFilters())if(f.indexOf(x.op)>=0)return x.op;return null}(e.filters,function(c){switch(c){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(r!==null)throw r===t.op?new Ln(en.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Ln(en.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}class ame{convertValue(t,r="none"){switch(Hm(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Hs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,r);case 5:return t.stringValue;case 6:return this.convertBytes(Wm(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,r);case 11:return this.convertObject(t.mapValue,r);case 10:return this.convertVectorValue(t.mapValue);default:throw Sr()}}convertObject(t,r){return this.convertObjectMap(t.fields,r)}convertObjectMap(t,r="none"){const s={};return hg(t,(c,f)=>{s[c]=this.convertValue(f,r)}),s}convertVectorValue(t){var r,s,c;const f=(c=(s=(r=t.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||s===void 0?void 0:s.values)===null||c===void 0?void 0:c.map(_=>Hs(_.doubleValue));return new HO(f)}convertGeoPoint(t){return new WO(Hs(t.latitude),Hs(t.longitude))}convertArray(t,r){return(t.values||[]).map(s=>this.convertValue(s,r))}convertServerTimestamp(t,r){switch(r){case"previous":const s=bO(t);return s==null?null:this.convertValue(s,r);case"estimate":return this.convertTimestamp(Ix(t));default:return null}}convertTimestamp(t){const r=Vf(t);return new yo(r.seconds,r.nanos)}convertDocumentKey(t,r){const s=os.fromString(t);qi(CW(s));const c=new Cx(s.get(1),s.get(3)),f=new ar(s.popFirst(5));return c.isEqual(r)||Jh(`Document ${f} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),f}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o2(e,t,r){let s;return s=e?e.toFirestore(t):t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m1{constructor(t,r){this.hasPendingWrites=t,this.fromCache=r}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class a2 extends r2{constructor(t,r,s,c,f,_){super(t,r,s,c,_),this._firestore=t,this._firestoreImpl=t,this.metadata=f}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const r=new LE(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,r={}){if(this._document){const s=this._document.data.field(CC("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s,r.serverTimestamps)}}}class LE extends a2{data(t={}){return super.data(t)}}class l2{constructor(t,r,s,c){this._firestore=t,this._userDataWriter=r,this._snapshot=c,this.metadata=new m1(c.hasPendingWrites,c.fromCache),this.query=s}get docs(){const t=[];return this.forEach(r=>t.push(r)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,r){this._snapshot.docs.forEach(s=>{t.call(r,new LE(this._firestore,this._userDataWriter,s.key,s,new m1(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const r=!!t.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new Ln(en.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(c,f){if(c._snapshot.oldDocs.isEmpty()){let _=0;return c._snapshot.docChanges.map(x=>{const a=new LE(c._firestore,c._userDataWriter,x.doc.key,x.doc,new m1(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);return x.doc,{type:"added",doc:a,oldIndex:-1,newIndex:_++}})}{let _=c._snapshot.oldDocs;return c._snapshot.docChanges.filter(x=>f||x.type!==3).map(x=>{const a=new LE(c._firestore,c._userDataWriter,x.doc.key,x.doc,new m1(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);let I=-1,D=-1;return x.type!==0&&(I=_.indexOf(x.doc.key),_=_.delete(x.doc.key)),x.type!==1&&(_=_.add(x.doc),D=_.indexOf(x.doc.key)),{type:lme(x.type),doc:a,oldIndex:I,newIndex:D}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function lme(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Sr()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ki(e){e=Za(e,ta);const t=Za(e.firestore,td);return Wpe(wC(t),e._key).then(r=>c2(t,e,r))}class s5 extends ame{constructor(t){super(),this.firestore=t}convertBytes(t){return new Uy(t)}convertReference(t){const r=this.convertDocumentKey(t,this.firestore._databaseId);return new ta(this.firestore,null,r)}}function wa(e){e=Za(e,ld);const t=Za(e.firestore,td),r=wC(t),s=new s5(t);return i2(e._query),Hpe(r,e._query).then(c=>new l2(t,s,e,c))}function Rm(e,t,r){e=Za(e,ta);const s=Za(e.firestore,td),c=o2(e.converter,t);return PC(s,[YW(SC(s),"setDoc",e._key,c,e.converter!==null,r).toMutation(e._key,Yl.none())])}function ss(e,t,r,...s){e=Za(e,ta);const c=Za(e.firestore,td),f=SC(c);let _;return _=typeof(t=js(t))=="string"||t instanceof TC?rme(f,"updateDoc",e._key,t,r,s):nme(f,"updateDoc",e._key,t),PC(c,[_.toMutation(e._key,Yl.exists(!0))])}function V1(e){return PC(Za(e.firestore,td),[new CO(e._key,Yl.none())])}function kx(e,t){const r=Za(e.firestore,td),s=er(e),c=o2(e.converter,t);return PC(r,[YW(SC(e.firestore),"addDoc",s._key,c,e.converter!==null,{}).toMutation(s._key,Yl.exists(!1))]).then(()=>s)}function Gh(e,...t){var r,s,c;e=js(e);let f={includeMetadataChanges:!1,source:"default"},_=0;typeof t[_]!="object"||VU(t[_])||(f=t[_],_++);const x={includeMetadataChanges:f.includeMetadataChanges,source:f.source};if(VU(t[_])){const O=t[_];t[_]=(r=O.next)===null||r===void 0?void 0:r.bind(O),t[_+1]=(s=O.error)===null||s===void 0?void 0:s.bind(O),t[_+2]=(c=O.complete)===null||c===void 0?void 0:c.bind(O)}let a,I,D;if(e instanceof ta)I=Za(e.firestore,td),D=hC(e._key.path),a={next:O=>{t[_]&&t[_](c2(I,e,O))},error:t[_+1],complete:t[_+2]};else{const O=Za(e,ld);I=Za(O.firestore,td),D=O._query;const F=new s5(I);a={next:H=>{t[_]&&t[_](new l2(I,F,O,H))},error:t[_+1],complete:t[_+2]},i2(e._query)}return function(F,H,Q,ie){const te=new GO(ie),W=new $O(H,te,Q);return F.asyncQueue.enqueueAndForget(()=>Be(this,null,function*(){return jO(yield US(F),W)})),()=>{te.za(),F.asyncQueue.enqueueAndForget(()=>Be(this,null,function*(){return UO(yield US(F),W)}))}}(wC(I),D,x,a)}function PC(e,t){return function(s,c){const f=new qh;return s.asyncQueue.enqueueAndForget(()=>Be(this,null,function*(){return Dpe(yield Gpe(s),c,f)})),f.promise}(wC(e),t)}function c2(e,t,r){const s=r.docs.get(t._key),c=new s5(e);return new a2(e,c,t._key,s,new m1(r.hasPendingWrites,r.fromCache),t.converter)}function $S(){return new ZO("serverTimestamp")}function gy(...e){return new XO("arrayUnion",e)}function Nk(...e){return new KO("arrayRemove",e)}(function(t,r=!0){(function(c){s0=c})(ug),Vm(new jf("firestore",(s,{instanceIdentifier:c,options:f})=>{const _=s.getProvider("app").getImmediate(),x=new td(new dde(s.getProvider("auth-internal")),new gde(s.getProvider("app-check-internal")),function(I,D){if(!Object.prototype.hasOwnProperty.apply(I.options,["projectId"]))throw new Ln(en.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cx(I.options.projectId,D)}(_,c),_);return f=Object.assign({useFetchStreams:r},f),x._setSettings(f),x},"PUBLIC").setMultipleInstances(!0)),ju(sU,"4.7.1",t),ju(sU,"4.7.1","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u2="firebasestorage.googleapis.com",h2="storageBucket",cme=2*60*1e3,ume=10*60*1e3,hme=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As extends Ku{constructor(t,r,s=0){super(AR(t),`Firebase Storage: ${r} (${AR(t)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,As.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return AR(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var cs;(function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(cs||(cs={}));function AR(e){return"storage/"+e}function o5(){const e="An unknown error occurred, please check the error payload for server response.";return new As(cs.UNKNOWN,e)}function dme(e){return new As(cs.OBJECT_NOT_FOUND,"Object '"+e+"' does not exist.")}function fme(e){return new As(cs.QUOTA_EXCEEDED,"Quota for bucket '"+e+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function pme(){const e="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new As(cs.UNAUTHENTICATED,e)}function mme(){return new As(cs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function gme(e){return new As(cs.UNAUTHORIZED,"User does not have permission to access '"+e+"'.")}function d2(){return new As(cs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function f2(){return new As(cs.CANCELED,"User canceled the upload/download.")}function _me(e){return new As(cs.INVALID_URL,"Invalid URL '"+e+"'.")}function yme(e){return new As(cs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}function vme(){return new As(cs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+h2+"' property when initializing the app?")}function p2(){return new As(cs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function xme(){return new As(cs.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function bme(){return new As(cs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function wme(e){return new As(cs.UNSUPPORTED_ENVIRONMENT,`${e} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Fk(e){return new As(cs.INVALID_ARGUMENT,e)}function m2(){return new As(cs.APP_DELETED,"The Firebase app was deleted.")}function Tme(e){return new As(cs.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function $1(e,t){return new As(cs.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function Kv(e){throw new As(cs.INTERNAL_ERROR,"Internal error: "+e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(t,r){this.bucket=t,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,r){let s;try{s=pl.makeFromUrl(t,r)}catch(c){return new pl(t,"")}if(s.path==="")return s;throw yme(t)}static makeFromUrl(t,r){let s=null;const c="([A-Za-z0-9.\\-_]+)";function f(fe){fe.path.charAt(fe.path.length-1)==="/"&&(fe.path_=fe.path_.slice(0,-1))}const _="(/(.*))?$",x=new RegExp("^gs://"+c+_,"i"),a={bucket:1,path:3};function I(fe){fe.path_=decodeURIComponent(fe.path)}const D="v[A-Za-z0-9_]+",O=r.replace(/[.]/g,"\\."),F="(/([^?#]*).*)?$",H=new RegExp(`^https?://${O}/${D}/b/${c}/o${F}`,"i"),Q={bucket:1,path:3},ie=r===u2?"(?:storage.googleapis.com|storage.cloud.google.com)":r,te="([^?#]*)",W=new RegExp(`^https?://${ie}/${c}/${te}`,"i"),ee=[{regex:x,indices:a,postModify:f},{regex:H,indices:Q,postModify:I},{regex:W,indices:{bucket:1,path:2},postModify:I}];for(let fe=0;fe<ee.length;fe++){const ye=ee[fe],Ee=ye.regex.exec(t);if(Ee){const re=Ee[ye.indices.bucket];let he=Ee[ye.indices.path];he||(he=""),s=new pl(re,he),ye.postModify(s);break}}if(s==null)throw _me(t);return s}}class Eme{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sme(e,t,r){let s=1,c=null,f=null,_=!1,x=0;function a(){return x===2}let I=!1;function D(...te){I||(I=!0,t.apply(null,te))}function O(te){c=setTimeout(()=>{c=null,e(H,a())},te)}function F(){f&&clearTimeout(f)}function H(te,...W){if(I){F();return}if(te){F(),D.call(null,te,...W);return}if(a()||_){F(),D.call(null,te,...W);return}s<64&&(s*=2);let ee;x===1?(x=2,ee=0):ee=(s+Math.random())*1e3,O(ee)}let Q=!1;function ie(te){Q||(Q=!0,F(),!I&&(c!==null?(te||(x=2),clearTimeout(c),O(0)):te||(x=1)))}return O(0),f=setTimeout(()=>{_=!0,ie(!0)},r),ie}function Ime(e){e(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cme(e){return e!==void 0}function Ame(e){return typeof e=="function"}function Pme(e){return typeof e=="object"&&!Array.isArray(e)}function RC(e){return typeof e=="string"||e instanceof String}function GU(e){return a5()&&e instanceof Blob}function a5(){return typeof Blob!="undefined"}function WU(e,t,r,s){if(s<t)throw Fk(`Invalid value for '${e}'. Expected ${t} or greater.`);if(s>r)throw Fk(`Invalid value for '${e}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _b(e,t,r){let s=t;return r==null&&(s=`https://${t}`),`${r}://${s}/v0${e}`}function g2(e){const t=encodeURIComponent;let r="?";for(const s in e)if(e.hasOwnProperty(s)){const c=t(s)+"="+t(e[s]);r=r+c+"&"}return r=r.slice(0,-1),r}var Mm;(function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"})(Mm||(Mm={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _2(e,t){const r=e>=500&&e<600,c=[408,429].indexOf(e)!==-1,f=t.indexOf(e)!==-1;return r||c||f}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rme{constructor(t,r,s,c,f,_,x,a,I,D,O,F=!0){this.url_=t,this.method_=r,this.headers_=s,this.body_=c,this.successCodes_=f,this.additionalRetryCodes_=_,this.callback_=x,this.errorCallback_=a,this.timeout_=I,this.progressCallback_=D,this.connectionFactory_=O,this.retry=F,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((H,Q)=>{this.resolve_=H,this.reject_=Q,this.start_()})}start_(){const t=(s,c)=>{if(c){s(!1,new YT(!1,null,!0));return}const f=this.connectionFactory_();this.pendingConnection_=f;const _=x=>{const a=x.loaded,I=x.lengthComputable?x.total:-1;this.progressCallback_!==null&&this.progressCallback_(a,I)};this.progressCallback_!==null&&f.addUploadProgressListener(_),f.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&f.removeUploadProgressListener(_),this.pendingConnection_=null;const x=f.getErrorCode()===Mm.NO_ERROR,a=f.getStatus();if(!x||_2(a,this.additionalRetryCodes_)&&this.retry){const D=f.getErrorCode()===Mm.ABORT;s(!1,new YT(!1,null,D));return}const I=this.successCodes_.indexOf(a)!==-1;s(!0,new YT(I,f))})},r=(s,c)=>{const f=this.resolve_,_=this.reject_,x=c.connection;if(c.wasSuccessCode)try{const a=this.callback_(x,x.getResponse());Cme(a)?f(a):f()}catch(a){_(a)}else if(x!==null){const a=o5();a.serverResponse=x.getErrorText(),this.errorCallback_?_(this.errorCallback_(x,a)):_(a)}else if(c.canceled){const a=this.appDelete_?m2():f2();_(a)}else{const a=d2();_(a)}};this.canceled_?r(!1,new YT(!1,null,!0)):this.backoffId_=Sme(t,r,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&Ime(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class YT{constructor(t,r,s){this.wasSuccessCode=t,this.connection=r,this.canceled=!!s}}function Mme(e,t){t!==null&&t.length>0&&(e.Authorization="Firebase "+t)}function kme(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(t!=null?t:"AppManager")}function Dme(e,t){t&&(e["X-Firebase-GMPID"]=t)}function Ome(e,t){t!==null&&(e["X-Firebase-AppCheck"]=t)}function Lme(e,t,r,s,c,f,_=!0){const x=g2(e.urlParams),a=e.url+x,I=Object.assign({},e.headers);return Dme(I,t),Mme(I,r),kme(I,f),Ome(I,s),new Rme(a,e.method,I,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,c,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zme(){return typeof BlobBuilder!="undefined"?BlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:void 0}function Nme(...e){const t=zme();if(t!==void 0){const r=new t;for(let s=0;s<e.length;s++)r.append(e[s]);return r.getBlob()}else{if(a5())return new Blob(e);throw new As(cs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Fme(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.mozSlice?e.mozSlice(t,r):e.slice?e.slice(t,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bme(e){if(typeof atob=="undefined")throw wme("base-64");return atob(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class PR{constructor(t,r){this.data=t,this.contentType=r||null}}function y2(e,t){switch(e){case jc.RAW:return new PR(v2(t));case jc.BASE64:case jc.BASE64URL:return new PR(x2(e,t));case jc.DATA_URL:return new PR(Ume(t),Vme(t))}throw o5()}function v2(e){const t=[];for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);if(s<=127)t.push(s);else if(s<=2047)t.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(r<e.length-1&&(e.charCodeAt(r+1)&64512)===56320))t.push(239,191,189);else{const f=s,_=e.charCodeAt(++r);s=65536|(f&1023)<<10|_&1023,t.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?t.push(239,191,189):t.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(t)}function jme(e){let t;try{t=decodeURIComponent(e)}catch(r){throw $1(jc.DATA_URL,"Malformed data URL.")}return v2(t)}function x2(e,t){switch(e){case jc.BASE64:{const c=t.indexOf("-")!==-1,f=t.indexOf("_")!==-1;if(c||f)throw $1(e,"Invalid character '"+(c?"-":"_")+"' found: is it base64url encoded?");break}case jc.BASE64URL:{const c=t.indexOf("+")!==-1,f=t.indexOf("/")!==-1;if(c||f)throw $1(e,"Invalid character '"+(c?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=Bme(t)}catch(c){throw c.message.includes("polyfill")?c:$1(e,"Invalid character found")}const s=new Uint8Array(r.length);for(let c=0;c<r.length;c++)s[c]=r.charCodeAt(c);return s}class b2{constructor(t){this.base64=!1,this.contentType=null;const r=t.match(/^data:([^,]+)?,/);if(r===null)throw $1(jc.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=r[1]||null;s!=null&&(this.base64=$me(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=t.substring(t.indexOf(",")+1)}}function Ume(e){const t=new b2(e);return t.base64?x2(jc.BASE64,t.rest):jme(t.rest)}function Vme(e){return new b2(e).contentType}function $me(e,t){return e.length>=t.length?e.substring(e.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zh{constructor(t,r){let s=0,c="";GU(t)?(this.data_=t,s=t.size,c=t.type):t instanceof ArrayBuffer?(r?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),s=this.data_.length):t instanceof Uint8Array&&(r?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),s=t.length),this.size_=s,this.type_=c}size(){return this.size_}type(){return this.type_}slice(t,r){if(GU(this.data_)){const s=this.data_,c=Fme(s,t,r);return c===null?null:new zh(c)}else{const s=new Uint8Array(this.data_.buffer,t,r-t);return new zh(s,!0)}}static getBlob(...t){if(a5()){const r=t.map(s=>s instanceof zh?s.data_:s);return new zh(Nme.apply(null,r))}else{const r=t.map(_=>RC(_)?y2(jc.RAW,_).data:_.data_);let s=0;r.forEach(_=>{s+=_.byteLength});const c=new Uint8Array(s);let f=0;return r.forEach(_=>{for(let x=0;x<_.length;x++)c[f++]=_[x]}),new zh(c,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w2(e){let t;try{t=JSON.parse(e)}catch(r){return null}return Pme(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qme(e){if(e.length===0)return null;const t=e.lastIndexOf("/");return t===-1?"":e.slice(0,t)}function Gme(e,t){const r=t.split("/").filter(s=>s.length>0).join("/");return e.length===0?r:e+"/"+r}function T2(e){const t=e.lastIndexOf("/",e.length-2);return t===-1?e:e.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wme(e,t){return t}class xa{constructor(t,r,s,c){this.server=t,this.local=r||t,this.writable=!!s,this.xform=c||Wme}}let JT=null;function Hme(e){return!RC(e)||e.length<2?e:T2(e)}function l5(){if(JT)return JT;const e=[];e.push(new xa("bucket")),e.push(new xa("generation")),e.push(new xa("metageneration")),e.push(new xa("name","fullPath",!0));function t(f,_){return Hme(_)}const r=new xa("name");r.xform=t,e.push(r);function s(f,_){return _!==void 0?Number(_):_}const c=new xa("size");return c.xform=s,e.push(c),e.push(new xa("timeCreated")),e.push(new xa("updated")),e.push(new xa("md5Hash",null,!0)),e.push(new xa("cacheControl",null,!0)),e.push(new xa("contentDisposition",null,!0)),e.push(new xa("contentEncoding",null,!0)),e.push(new xa("contentLanguage",null,!0)),e.push(new xa("contentType",null,!0)),e.push(new xa("metadata","customMetadata",!0)),JT=e,JT}function Zme(e,t){function r(){const s=e.bucket,c=e.fullPath,f=new pl(s,c);return t._makeStorageReference(f)}Object.defineProperty(e,"ref",{get:r})}function Xme(e,t,r){const s={};s.type="file";const c=r.length;for(let f=0;f<c;f++){const _=r[f];s[_.local]=_.xform(s,t[_.server])}return Zme(s,e),s}function E2(e,t,r){const s=w2(t);return s===null?null:Xme(e,s,r)}function Kme(e,t,r,s){const c=w2(t);if(c===null||!RC(c.downloadTokens))return null;const f=c.downloadTokens;if(f.length===0)return null;const _=encodeURIComponent;return f.split(",").map(I=>{const D=e.bucket,O=e.fullPath,F="/b/"+_(D)+"/o/"+_(O),H=_b(F,r,s),Q=g2({alt:"media",token:I});return H+Q})[0]}function S2(e,t){const r={},s=t.length;for(let c=0;c<s;c++){const f=t[c];f.writable&&(r[f.server]=e[f.local])}return JSON.stringify(r)}class u0{constructor(t,r,s,c){this.url=t,this.method=r,this.handler=s,this.timeout=c,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wh(e){if(!e)throw o5()}function c5(e,t){function r(s,c){const f=E2(e,c,t);return Wh(f!==null),f}return r}function Qme(e,t){function r(s,c){const f=E2(e,c,t);return Wh(f!==null),Kme(f,c,e.host,e._protocol)}return r}function yb(e){function t(r,s){let c;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?c=mme():c=pme():r.getStatus()===402?c=fme(e.bucket):r.getStatus()===403?c=gme(e.path):c=s,c.status=r.getStatus(),c.serverResponse=s.serverResponse,c}return t}function I2(e){const t=yb(e);function r(s,c){let f=t(s,c);return s.getStatus()===404&&(f=dme(e.path)),f.serverResponse=c.serverResponse,f}return r}function Yme(e,t,r){const s=t.fullServerUrl(),c=_b(s,e.host,e._protocol),f="GET",_=e.maxOperationRetryTime,x=new u0(c,f,c5(e,r),_);return x.errorHandler=I2(t),x}function Jme(e,t,r){const s=t.fullServerUrl(),c=_b(s,e.host,e._protocol),f="GET",_=e.maxOperationRetryTime,x=new u0(c,f,Qme(e,r),_);return x.errorHandler=I2(t),x}function ege(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}function C2(e,t,r){const s=Object.assign({},r);return s.fullPath=e.path,s.size=t.size(),s.contentType||(s.contentType=ege(null,t)),s}function A2(e,t,r,s,c){const f=t.bucketOnlyServerUrl(),_={"X-Goog-Upload-Protocol":"multipart"};function x(){let ee="";for(let fe=0;fe<2;fe++)ee=ee+Math.random().toString().slice(2);return ee}const a=x();_["Content-Type"]="multipart/related; boundary="+a;const I=C2(t,s,c),D=S2(I,r),O="--"+a+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+D+`\r
--`+a+`\r
Content-Type: `+I.contentType+`\r
\r
`,F=`\r
--`+a+"--",H=zh.getBlob(O,s,F);if(H===null)throw p2();const Q={name:I.fullPath},ie=_b(f,e.host,e._protocol),te="POST",W=e.maxUploadRetryTime,X=new u0(ie,te,c5(e,r),W);return X.urlParams=Q,X.headers=_,X.body=H.uploadData(),X.errorHandler=yb(t),X}class qS{constructor(t,r,s,c){this.current=t,this.total=r,this.finalized=!!s,this.metadata=c||null}}function u5(e,t){let r=null;try{r=e.getResponseHeader("X-Goog-Upload-Status")}catch(c){Wh(!1)}return Wh(!!r&&(t||["active"]).indexOf(r)!==-1),r}function tge(e,t,r,s,c){const f=t.bucketOnlyServerUrl(),_=C2(t,s,c),x={name:_.fullPath},a=_b(f,e.host,e._protocol),I="POST",D={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${s.size()}`,"X-Goog-Upload-Header-Content-Type":_.contentType,"Content-Type":"application/json; charset=utf-8"},O=S2(_,r),F=e.maxUploadRetryTime;function H(ie){u5(ie);let te;try{te=ie.getResponseHeader("X-Goog-Upload-URL")}catch(W){Wh(!1)}return Wh(RC(te)),te}const Q=new u0(a,I,H,F);return Q.urlParams=x,Q.headers=D,Q.body=O,Q.errorHandler=yb(t),Q}function nge(e,t,r,s){const c={"X-Goog-Upload-Command":"query"};function f(I){const D=u5(I,["active","final"]);let O=null;try{O=I.getResponseHeader("X-Goog-Upload-Size-Received")}catch(H){Wh(!1)}O||Wh(!1);const F=Number(O);return Wh(!isNaN(F)),new qS(F,s.size(),D==="final")}const _="POST",x=e.maxUploadRetryTime,a=new u0(r,_,f,x);return a.headers=c,a.errorHandler=yb(t),a}const HU=256*1024;function rge(e,t,r,s,c,f,_,x){const a=new qS(0,0);if(_?(a.current=_.current,a.total=_.total):(a.current=0,a.total=s.size()),s.size()!==a.total)throw xme();const I=a.total-a.current;let D=I;c>0&&(D=Math.min(D,c));const O=a.current,F=O+D;let H="";D===0?H="finalize":I===D?H="upload, finalize":H="upload";const Q={"X-Goog-Upload-Command":H,"X-Goog-Upload-Offset":`${a.current}`},ie=s.slice(O,F);if(ie===null)throw p2();function te(fe,ye){const Ee=u5(fe,["active","final"]),re=a.current+D,he=s.size();let _e;return Ee==="final"?_e=c5(t,f)(fe,ye):_e=null,new qS(re,he,Ee==="final",_e)}const W="POST",X=t.maxUploadRetryTime,ee=new u0(r,W,te,X);return ee.headers=Q,ee.body=ie.uploadData(),ee.progressCallback=x||null,ee.errorHandler=yb(e),ee}const Fa={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function RR(e){switch(e){case"running":case"pausing":case"canceling":return Fa.RUNNING;case"paused":return Fa.PAUSED;case"success":return Fa.SUCCESS;case"canceled":return Fa.CANCELED;case"error":return Fa.ERROR;default:return Fa.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ige{constructor(t,r,s){if(Ame(t)||r!=null||s!=null)this.next=t,this.error=r!=null?r:void 0,this.complete=s!=null?s:void 0;else{const f=t;this.next=f.next,this.error=f.error,this.complete=f.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S_(e){return(...t)=>{Promise.resolve().then(()=>e(...t))}}class sge{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Mm.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Mm.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Mm.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,r,s,c){if(this.sent_)throw Kv("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(r,t,!0),c!==void 0)for(const f in c)c.hasOwnProperty(f)&&this.xhr_.setRequestHeader(f,c[f].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Kv("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Kv("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}}getResponse(){if(!this.sent_)throw Kv("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Kv("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class oge extends sge{initXhr(){this.xhr_.responseType="text"}}function dm(){return new oge}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class age{constructor(t,r,s=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=r,this._metadata=s,this._mappings=l5(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=c=>{if(this._request=void 0,this._chunkMultiplier=1,c._codeEquals(cs.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const f=this.isExponentialBackoffExpired();if(_2(c.status,[]))if(f)c=d2();else{this.sleepTime=Math.max(this.sleepTime*2,hme),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=c,this._transition("error")}},this._metadataErrorHandler=c=>{this._request=void 0,c._codeEquals(cs.CANCELED)?this.completeTransitions_():(this._error=c,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((c,f)=>{this._resolve=c,this._reject=f,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const t=this._transferred;return r=>this._updateProgress(t+r)}_shouldDoResumable(t){return t.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(t){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([r,s])=>{switch(this._state){case"running":t(r,s);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((t,r)=>{const s=tge(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(s,dm,t,r);this._request=c,c.getPromise().then(f=>{this._request=void 0,this._uploadUrl=f,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const t=this._uploadUrl;this._resolveToken((r,s)=>{const c=nge(this._ref.storage,this._ref._location,t,this._blob),f=this._ref.storage._makeRequest(c,dm,r,s);this._request=f,f.getPromise().then(_=>{_=_,this._request=void 0,this._updateProgress(_.current),this._needToFetchStatus=!1,_.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const t=HU*this._chunkMultiplier,r=new qS(this._transferred,this._blob.size()),s=this._uploadUrl;this._resolveToken((c,f)=>{let _;try{_=rge(this._ref._location,this._ref.storage,s,this._blob,t,this._mappings,r,this._makeProgressCallback())}catch(a){this._error=a,this._transition("error");return}const x=this._ref.storage._makeRequest(_,dm,c,f,!1);this._request=x,x.getPromise().then(a=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(a.current),a.finalized?(this._metadata=a.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){HU*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((t,r)=>{const s=Yme(this._ref.storage,this._ref._location,this._mappings),c=this._ref.storage._makeRequest(s,dm,t,r);this._request=c,c.getPromise().then(f=>{this._request=void 0,this._metadata=f,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((t,r)=>{const s=A2(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(s,dm,t,r);this._request=c,c.getPromise().then(f=>{this._request=void 0,this._metadata=f,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(t){const r=this._transferred;this._transferred=t,this._transferred!==r&&this._notifyObservers()}_transition(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const r=this._state==="paused";this._state=t,r&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=f2(),this._state=t,this._notifyObservers();break;case"error":this._state=t,this._notifyObservers();break;case"success":this._state=t,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const t=RR(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}on(t,r,s,c){const f=new ige(r||void 0,s||void 0,c||void 0);return this._addObserver(f),()=>{this._removeObserver(f)}}then(t,r){return this._promise.then(t,r)}catch(t){return this.then(null,t)}_addObserver(t){this._observers.push(t),this._notifyObserver(t)}_removeObserver(t){const r=this._observers.indexOf(t);r!==-1&&this._observers.splice(r,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(r=>{this._notifyObserver(r)})}_finishPromise(){if(this._resolve!==void 0){let t=!0;switch(RR(this._state)){case Fa.SUCCESS:S_(this._resolve.bind(null,this.snapshot))();break;case Fa.CANCELED:case Fa.ERROR:const r=this._reject;S_(r.bind(null,this._error))();break;default:t=!1;break}t&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(t){switch(RR(this._state)){case Fa.RUNNING:case Fa.PAUSED:t.next&&S_(t.next.bind(t,this.snapshot))();break;case Fa.SUCCESS:t.complete&&S_(t.complete.bind(t))();break;case Fa.CANCELED:case Fa.ERROR:t.error&&S_(t.error.bind(t,this._error))();break;default:t.error&&S_(t.error.bind(t,this._error))()}}resume(){const t=this._state==="paused"||this._state==="pausing";return t&&this._transition("running"),t}pause(){const t=this._state==="running";return t&&this._transition("pausing"),t}cancel(){const t=this._state==="running"||this._state==="pausing";return t&&this._transition("canceling"),t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(t,r){this._service=t,r instanceof pl?this._location=r:this._location=pl.makeFromUrl(r,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,r){return new Zm(t,r)}get root(){const t=new pl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return T2(this._location.path)}get storage(){return this._service}get parent(){const t=qme(this._location.path);if(t===null)return null;const r=new pl(this._location.bucket,t);return new Zm(this._service,r)}_throwIfRoot(t){if(this._location.path==="")throw Tme(t)}}function lge(e,t,r){e._throwIfRoot("uploadBytes");const s=A2(e.storage,e._location,l5(),new zh(t,!0),r);return e.storage.makeRequestWithTokens(s,dm).then(c=>({metadata:c,ref:e}))}function cge(e,t,r){return e._throwIfRoot("uploadBytesResumable"),new age(e,new zh(t),r)}function uge(e,t,r=jc.RAW,s){e._throwIfRoot("uploadString");const c=y2(r,t),f=Object.assign({},s);return f.contentType==null&&c.contentType!=null&&(f.contentType=c.contentType),lge(e,c.data,f)}function hge(e){e._throwIfRoot("getDownloadURL");const t=Jme(e.storage,e._location,l5());return e.storage.makeRequestWithTokens(t,dm).then(r=>{if(r===null)throw bme();return r})}function dge(e,t){const r=Gme(e._location.path,t),s=new pl(e._location.bucket,r);return new Zm(e.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fge(e){return/^[A-Za-z]+:\/\//.test(e)}function pge(e,t){return new Zm(e,t)}function P2(e,t){if(e instanceof h5){const r=e;if(r._bucket==null)throw vme();const s=new Zm(r,r._bucket);return t!=null?P2(s,t):s}else return t!==void 0?dge(e,t):e}function mge(e,t){if(t&&fge(t)){if(e instanceof h5)return pge(e,t);throw Fk("To use ref(service, url), the first argument must be a Storage instance.")}else return P2(e,t)}function ZU(e,t){const r=t==null?void 0:t[h2];return r==null?null:pl.makeFromBucketSpec(r,e)}function gge(e,t,r,s={}){e.host=`${t}:${r}`,e._protocol="http";const{mockUserToken:c}=s;c&&(e._overrideAuthToken=typeof c=="string"?c:nG(c,e.app.options.projectId))}class h5{constructor(t,r,s,c,f){this.app=t,this._authProvider=r,this._appCheckProvider=s,this._url=c,this._firebaseVersion=f,this._bucket=null,this._host=u2,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=cme,this._maxUploadRetryTime=ume,this._requests=new Set,c!=null?this._bucket=pl.makeFromBucketSpec(c,this._host):this._bucket=ZU(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=pl.makeFromBucketSpec(this._url,t):this._bucket=ZU(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){WU("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){WU("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}_getAuthToken(){return Be(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const r=yield t.getToken();if(r!==null)return r.accessToken}return null})}_getAppCheckToken(){return Be(this,null,function*(){const t=this._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Zm(this,t)}_makeRequest(t,r,s,c,f=!0){if(this._deleted)return new Eme(m2());{const _=Lme(t,this._appId,s,c,r,this._firebaseVersion,f);return this._requests.add(_),_.getPromise().then(()=>this._requests.delete(_),()=>this._requests.delete(_)),_}}makeRequestWithTokens(t,r){return Be(this,null,function*(){const[s,c]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,r,s,c).getPromise()})}}const XU="@firebase/storage",KU="0.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R2="storage";function _ge(e,t,r,s){return e=js(e),uge(e,t,r,s)}function yge(e,t,r){return e=js(e),cge(e,t,r)}function M2(e){return e=js(e),hge(e)}function k2(e,t){return e=js(e),mge(e,t)}function D2(e=oO(),t){e=js(e);const s=oC(e,R2).getImmediate({identifier:t}),c=Jq("storage");return c&&vge(s,...c),s}function vge(e,t,r,s={}){gge(e,t,r,s)}function xge(e,{instanceIdentifier:t}){const r=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),c=e.getProvider("app-check-internal");return new h5(r,s,c,t,ug)}function bge(){Vm(new jf(R2,xge,"PUBLIC").setMultipleInstances(!0)),ju(XU,KU,""),ju(XU,KU,"esm2017")}bge();const wge={apiKey:"AIzaSyC2wTEeSiz_09FzWarn52vwzSlzfHXjATE",authDomain:"quests-b5b92.firebaseapp.com",databaseURL:"https://quests-b5b92-default-rtdb.firebaseio.com",projectId:"quests-b5b92",storageBucket:"quests-b5b92.appspot.com",messagingSenderId:"388972050284",appId:"1:388972050284:web:38dfdb79a67edcf0756549",measurementId:"G-Y1P89CPKCY"},d5=sG(wge),Zt=lde(d5),bn=Ype(d5),Tge=D2(d5),Ege=(e,t,r)=>Be(xn,null,function*(){try{const s=yield Kue(Zt,e,t),c=s.user.uid;return yield Rm(er(bn,"users",c),{name:r,email:e,profilePhoto:yield f5(),bio:"",isActive:!0,lastActive:Date.now(),receiverId:c,senderId:c,isPrivate:!1}),s}catch(s){console.error("Error signing up:",s)}}),O2=new Ou,Sge=()=>Be(xn,null,function*(){try{const t=(yield BG(Zt,O2)).user,r=er(bn,"users",t.uid);return(yield Ki(r)).exists()||(yield Rm(r,{name:t.displayName||"Unnamed",email:t.email,profilePhoto:t.photoURL||(yield f5()),bio:"",isActive:!0,receiverId:t.uid,senderId:t.uid,isPrivate:!1})),t}catch(e){throw console.error("Error signing up with Google:",e),e}}),Ige=()=>Be(xn,null,function*(){try{const e=yield BG(Zt,O2),r=Ou.credentialFromResult(e).accessToken,s=e.user;return yield Bk(s.uid,{isActive:!0,lastActive:Date.now()}),console.log("User signed in with Google:",s),s}catch(e){console.error("Error signing in with Google:",e)}}),Cge=(e,t)=>Be(xn,null,function*(){var r;try{const s=yield Que(Zt,e,t),c=(r=s.user)==null?void 0:r.uid;return c?yield ss(er(bn,"users",c),{isActive:!0,lastActive:Date.now()}):console.error("User ID is not available"),s}catch(s){console.error("Error signing in:",s)}}),Age=e=>Be(xn,null,function*(){const t=D2(),r=k2(t,`profile_photos/${Zt.currentUser.uid}`),s=yge(r,e);return new Promise((c,f)=>{s.on("state_changed",_=>{},_=>{console.error("Error uploading image:",_),f(_)},()=>Be(xn,null,function*(){try{const _=yield M2(s.snapshot.ref);c(_)}catch(_){console.error("Error getting download URL:",_),f(_)}}))})}),Bk=(e,t)=>Be(xn,null,function*(){try{console.log("Updating user profile:",e,t),yield ss(er(bn,"users",e),t),console.log("User profile updated successfully")}catch(r){console.error("Error updating user profile:",r)}}),f5=()=>Be(xn,null,function*(){return"https://firebasestorage.googleapis.com/v0/b/quests-b5b92.appspot.com/o/profile_photos%2Fdefault.jpg?alt=media&token=e7424067-7007-4a70-a405-b56c83f0d9d2"}),_y=e=>Be(xn,null,function*(){try{const t=yield Ki(er(bn,"users",e));if(t.exists())return t.data();console.log("No such document!")}catch(t){console.error("Error fetching user data:",t)}});var L2={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},QU=Xr.createContext&&Xr.createContext(L2),Pge=["attr","size","title"];function Rge(e,t){if(e==null)return{};var r=Mge(e,t),s,c;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(c=0;c<f.length;c++)s=f[c],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}function Mge(e,t){if(e==null)return{};var r={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;r[s]=e[s]}return r}function GS(){return GS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},GS.apply(this,arguments)}function YU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,s)}return r}function WS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YU(Object(r),!0).forEach(function(s){kge(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YU(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function kge(e,t,r){return t=Dge(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dge(e){var t=Oge(e,"string");return typeof t=="symbol"?t:t+""}function Oge(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var s=r.call(e,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function z2(e){return e&&e.map((t,r)=>Xr.createElement(t.tag,WS({key:r},t.attr),z2(t.child)))}function N2(e){return t=>Xr.createElement(Lge,GS({attr:WS({},e.attr)},t),z2(e.child))}function Lge(e){var t=r=>{var{attr:s,size:c,title:f}=e,_=Rge(e,Pge),x=c||r.size||"1em",a;return r.className&&(a=r.className),e.className&&(a=(a?a+" ":"")+e.className),Xr.createElement("svg",GS({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,s,_,{className:a,style:WS(WS({color:e.color||r.color},r.style),e.style),height:x,width:x,xmlns:"http://www.w3.org/2000/svg"}),f&&Xr.createElement("title",null,f),e.children)};return QU!==void 0?Xr.createElement(QU.Consumer,null,r=>t(r)):t(L2)}function F2(e){return N2({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(e)}function B2(e){return N2({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(e)}const zge=()=>{const e=rg(),[t,r]=G.useState(!1),[s,c]=G.useState(""),f={email:"",password:""},_=rO({email:uy().email("Invalid email address").required("Required"),password:uy().required("Required")}),x=(D,{setSubmitting:O})=>{c(""),Cge(D.email,D.password).then(F=>{const H=F.user;console.log("User signed in:",H.uid),e("/home")}).catch(F=>{console.error("Error signing in:",F),c("Incorrect username or password")}).finally(()=>{O(!1)})},a=()=>{r(!t)},I=()=>Be(xn,null,function*(){try{(yield Ige())&&e("/home")}catch(D){console.error("Error signing in with Google:",D),c("Error signing in with Google")}});return N.jsxs("section",{className:"login-container",children:[N.jsxs("div",{className:"login-form-container",children:[N.jsx("h1",{children:"Login"}),N.jsxs("p",{className:"linktoregister",children:["Not a user? ",N.jsx(jI,{to:"/register",className:"gotoregister",style:{color:"rgb(10,145,255)"},children:"Create an account here"})]}),N.jsx(Fq,{initialValues:f,validationSchema:_,onSubmit:x,children:({isSubmitting:D,errors:O,touched:F})=>N.jsxs(QD,{className:"login-form",children:[N.jsx(L1,{type:"email",name:"email",placeholder:"Email Address"}),N.jsxs("div",{className:"password-container",children:[N.jsx(L1,{type:t?"text":"password",name:"password",placeholder:"Password"}),N.jsx("span",{className:"password-toggle",onClick:a,role:"button","aria-label":"Toggle password visibility",children:t?N.jsx(F2,{}):N.jsx(B2,{})})]}),N.jsx("div",{className:"error-container",children:O.email&&F.email||O.password&&F.password?N.jsx("div",{className:"error-message",children:O.email||O.password}):s?N.jsx("div",{className:"error-message",children:s}):null}),N.jsxs("div",{className:"buttons",children:[N.jsx("button",{className:"google-login-btn",onClick:I,type:"button",children:N.jsx("img",{src:"/google-logo.png",alt:"Google",className:"google-logo"})}),N.jsx("button",{className:"loginbtn",type:"submit",disabled:D,children:"Login"})]})]})})]}),N.jsxs("div",{className:"blue-rectangle",children:[N.jsx("img",{className:"questsimg",src:"/Questslogo white.png",alt:"Quests logo"}),N.jsx("h3",{children:"Welcome Back!"}),N.jsx("p",{children:"We're glad to see you again. Log in to continue where you left off."})]})]})},Nge=()=>{const e=rg(),[t,r]=G.useState(!1),[s,c]=G.useState(""),f={name:"",email:"",password:""},_=rO({name:uy().required("Name required"),email:uy().email("Invalid email address").required("Email required"),password:uy().min(6,"Password must be at least 6 characters").required("Password required")}),x=(F,H)=>Be(xn,[F,H],function*(I,{setSubmitting:D,setErrors:O}){try{c("");const Q=yield Ege(I.email,I.password,I.name);if(!Q||!Q.user)throw new Error("Failed to sign up");const ie=Q.user;console.log("User signed up successfully:",ie);const te=yield f5();yield Rm(er(bn,"users",ie.uid),{name:I.name,email:I.email,profilePhoto:te,bio:"",isActive:!0}),console.log("User data added to Firestore"),e("/login")}catch(Q){console.error("Error signing up:",Q),c("Failed to sign up. Please check your details and try again.")}finally{D(!1)}}),a=()=>Be(xn,null,function*(){try{c("");const I=yield Sge();console.log("Google user signed up:",I),e("/login")}catch(I){console.error("Error signing up with Google:",I),c("Error signing up with Google")}});return N.jsxs("section",{className:"register-container",children:[N.jsxs("div",{className:"register-form-container",children:[N.jsx("h2",{className:"createacc",children:"Create New Account"}),N.jsxs("p",{className:"aauser",children:["Already a user? ",N.jsx(jI,{to:"/login",style:{color:"rgb(10,145,255)"},children:"Login here."})]}),N.jsx(Fq,{initialValues:f,validationSchema:_,onSubmit:x,children:({isSubmitting:I,errors:D,touched:O})=>N.jsxs(QD,{className:"register-form",children:[N.jsx(L1,{className:"username",type:"text",name:"name",placeholder:"Name"}),N.jsx(L1,{type:"email",name:"email",placeholder:"Email"}),N.jsxs("div",{className:"password-container",children:[N.jsx(L1,{type:t?"text":"password",name:"password",placeholder:"Password"}),N.jsx("div",{className:"password-toggle",onClick:()=>r(!t),role:"button","aria-label":"Toggle password visibility",children:t?N.jsx(F2,{}):N.jsx(B2,{})})]}),N.jsx("div",{className:"error-container",children:D.name&&O.name||D.email&&O.email||D.password&&O.password?N.jsx("div",{className:"error-message",children:D.name||D.email||D.password}):s?N.jsx("div",{className:"error-message",children:s}):null}),N.jsxs("div",{className:"button-container",children:[N.jsx("button",{className:"google-register-btn",onClick:a,type:"button",children:N.jsx("img",{src:"/google-logo.png",alt:"Google",className:"google-logo"})}),N.jsx("button",{className:"register-btn",type:"submit",disabled:I,children:"Register"})]})]})})]}),N.jsxs("div",{className:"blue-rectangle",children:[N.jsx("img",{className:"questsimg",src:"/Questslogo white.png",alt:"Quests logo"}),N.jsx("h3",{children:"Welcome!"}),N.jsx("p",{children:"Join our community today and unlock a world of possibilities. Connect, share, and grow with us!"})]})]})},Dx={black:"#000",white:"#fff"},I_={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},C_={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},A_={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},P_={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},R_={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},Qv={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},Fge={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function nd(e){let t="https://mui.com/production-error/?code="+e;for(let r=1;r<arguments.length;r+=1)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}const MC="$$material";function HS(){return HS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},HS.apply(null,arguments)}function j2(e){var t=Object.create(null);return function(r){return t[r]===void 0&&(t[r]=e(r)),t[r]}}var Bge=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,jge=j2(function(e){return Bge.test(e)||e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)<91}),Uge=!1;function Vge(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}function $ge(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),e.nonce!==void 0&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var qge=function(){function e(r){var s=this;this._insertTag=function(c){var f;s.tags.length===0?s.insertionPoint?f=s.insertionPoint.nextSibling:s.prepend?f=s.container.firstChild:f=s.before:f=s.tags[s.tags.length-1].nextSibling,s.container.insertBefore(c,f),s.tags.push(c)},this.isSpeedy=r.speedy===void 0?!Uge:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(s){s.forEach(this._insertTag)},t.insert=function(s){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag($ge(this));var c=this.tags[this.tags.length-1];if(this.isSpeedy){var f=Vge(c);try{f.insertRule(s,f.cssRules.length)}catch(_){}}else c.appendChild(document.createTextNode(s));this.ctr++},t.flush=function(){this.tags.forEach(function(s){var c;return(c=s.parentNode)==null?void 0:c.removeChild(s)}),this.tags=[],this.ctr=0},e}(),Qo="-ms-",ZS="-moz-",yi="-webkit-",U2="comm",p5="rule",m5="decl",Gge="@import",V2="@keyframes",Wge="@layer",Hge=Math.abs,kC=String.fromCharCode,Zge=Object.assign;function Xge(e,t){return Do(e,0)^45?(((t<<2^Do(e,0))<<2^Do(e,1))<<2^Do(e,2))<<2^Do(e,3):0}function $2(e){return e.trim()}function Kge(e,t){return(e=t.exec(e))?e[0]:e}function vi(e,t,r){return e.replace(t,r)}function jk(e,t){return e.indexOf(t)}function Do(e,t){return e.charCodeAt(t)|0}function Ox(e,t,r){return e.slice(t,r)}function Pu(e){return e.length}function g5(e){return e.length}function eE(e,t){return t.push(e),e}function Qge(e,t){return e.map(t).join("")}var DC=1,Vy=1,q2=0,Xa=0,no=0,h0="";function OC(e,t,r,s,c,f,_){return{value:e,root:t,parent:r,type:s,props:c,children:f,line:DC,column:Vy,length:_,return:""}}function Yv(e,t){return Zge(OC("",null,null,"",null,null,0),e,{length:-e.length},t)}function Yge(){return no}function Jge(){return no=Xa>0?Do(h0,--Xa):0,Vy--,no===10&&(Vy=1,DC--),no}function yl(){return no=Xa<q2?Do(h0,Xa++):0,Vy++,no===10&&(Vy=1,DC++),no}function qu(){return Do(h0,Xa)}function zE(){return Xa}function vb(e,t){return Ox(h0,e,t)}function Lx(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function G2(e){return DC=Vy=1,q2=Pu(h0=e),Xa=0,[]}function W2(e){return h0="",e}function NE(e){return $2(vb(Xa-1,Uk(e===91?e+2:e===40?e+1:e)))}function e_e(e){for(;(no=qu())&&no<33;)yl();return Lx(e)>2||Lx(no)>3?"":" "}function t_e(e,t){for(;--t&&yl()&&!(no<48||no>102||no>57&&no<65||no>70&&no<97););return vb(e,zE()+(t<6&&qu()==32&&yl()==32))}function Uk(e){for(;yl();)switch(no){case e:return Xa;case 34:case 39:e!==34&&e!==39&&Uk(no);break;case 40:e===41&&Uk(e);break;case 92:yl();break}return Xa}function n_e(e,t){for(;yl()&&e+no!==57;)if(e+no===84&&qu()===47)break;return"/*"+vb(t,Xa-1)+"*"+kC(e===47?e:yl())}function r_e(e){for(;!Lx(qu());)yl();return vb(e,Xa)}function i_e(e){return W2(FE("",null,null,null,[""],e=G2(e),0,[0],e))}function FE(e,t,r,s,c,f,_,x,a){for(var I=0,D=0,O=_,F=0,H=0,Q=0,ie=1,te=1,W=1,X=0,ee="",fe=c,ye=f,Ee=s,re=ee;te;)switch(Q=X,X=yl()){case 40:if(Q!=108&&Do(re,O-1)==58){jk(re+=vi(NE(X),"&","&\f"),"&\f")!=-1&&(W=-1);break}case 34:case 39:case 91:re+=NE(X);break;case 9:case 10:case 13:case 32:re+=e_e(Q);break;case 92:re+=t_e(zE()-1,7);continue;case 47:switch(qu()){case 42:case 47:eE(s_e(n_e(yl(),zE()),t,r),a);break;default:re+="/"}break;case 123*ie:x[I++]=Pu(re)*W;case 125*ie:case 59:case 0:switch(X){case 0:case 125:te=0;case 59+D:W==-1&&(re=vi(re,/\f/g,"")),H>0&&Pu(re)-O&&eE(H>32?eV(re+";",s,r,O-1):eV(vi(re," ","")+";",s,r,O-2),a);break;case 59:re+=";";default:if(eE(Ee=JU(re,t,r,I,D,c,x,ee,fe=[],ye=[],O),f),X===123)if(D===0)FE(re,t,Ee,Ee,fe,f,O,x,ye);else switch(F===99&&Do(re,3)===110?100:F){case 100:case 108:case 109:case 115:FE(e,Ee,Ee,s&&eE(JU(e,Ee,Ee,0,0,c,x,ee,c,fe=[],O),ye),c,ye,O,x,s?fe:ye);break;default:FE(re,Ee,Ee,Ee,[""],ye,0,x,ye)}}I=D=H=0,ie=W=1,ee=re="",O=_;break;case 58:O=1+Pu(re),H=Q;default:if(ie<1){if(X==123)--ie;else if(X==125&&ie++==0&&Jge()==125)continue}switch(re+=kC(X),X*ie){case 38:W=D>0?1:(re+="\f",-1);break;case 44:x[I++]=(Pu(re)-1)*W,W=1;break;case 64:qu()===45&&(re+=NE(yl())),F=qu(),D=O=Pu(ee=re+=r_e(zE())),X++;break;case 45:Q===45&&Pu(re)==2&&(ie=0)}}return f}function JU(e,t,r,s,c,f,_,x,a,I,D){for(var O=c-1,F=c===0?f:[""],H=g5(F),Q=0,ie=0,te=0;Q<s;++Q)for(var W=0,X=Ox(e,O+1,O=Hge(ie=_[Q])),ee=e;W<H;++W)(ee=$2(ie>0?F[W]+" "+X:vi(X,/&\f/g,F[W])))&&(a[te++]=ee);return OC(e,t,r,c===0?p5:x,a,I,D)}function s_e(e,t,r){return OC(e,t,r,U2,kC(Yge()),Ox(e,2,-2),0)}function eV(e,t,r,s){return OC(e,t,r,m5,Ox(e,0,s),Ox(e,s+1,-1),s)}function yy(e,t){for(var r="",s=g5(e),c=0;c<s;c++)r+=t(e[c],c,e,t)||"";return r}function o_e(e,t,r,s){switch(e.type){case Wge:if(e.children.length)break;case Gge:case m5:return e.return=e.return||e.value;case U2:return"";case V2:return e.return=e.value+"{"+yy(e.children,s)+"}";case p5:e.value=e.props.join(",")}return Pu(r=yy(e.children,s))?e.return=e.value+"{"+r+"}":""}function a_e(e){var t=g5(e);return function(r,s,c,f){for(var _="",x=0;x<t;x++)_+=e[x](r,s,c,f)||"";return _}}function l_e(e){return function(t){t.root||(t=t.return)&&e(t)}}var c_e=function(t,r,s){for(var c=0,f=0;c=f,f=qu(),c===38&&f===12&&(r[s]=1),!Lx(f);)yl();return vb(t,Xa)},u_e=function(t,r){var s=-1,c=44;do switch(Lx(c)){case 0:c===38&&qu()===12&&(r[s]=1),t[s]+=c_e(Xa-1,r,s);break;case 2:t[s]+=NE(c);break;case 4:if(c===44){t[++s]=qu()===58?"&\f":"",r[s]=t[s].length;break}default:t[s]+=kC(c)}while(c=yl());return t},h_e=function(t,r){return W2(u_e(G2(t),r))},tV=new WeakMap,d_e=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var r=t.value,s=t.parent,c=t.column===s.column&&t.line===s.line;s.type!=="rule";)if(s=s.parent,!s)return;if(!(t.props.length===1&&r.charCodeAt(0)!==58&&!tV.get(s))&&!c){tV.set(t,!0);for(var f=[],_=h_e(r,f),x=s.props,a=0,I=0;a<_.length;a++)for(var D=0;D<x.length;D++,I++)t.props[I]=f[a]?_[a].replace(/&\f/g,x[D]):x[D]+" "+_[a]}}},f_e=function(t){if(t.type==="decl"){var r=t.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(t.return="",t.value="")}};function H2(e,t){switch(Xge(e,t)){case 5103:return yi+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return yi+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return yi+e+ZS+e+Qo+e+e;case 6828:case 4268:return yi+e+Qo+e+e;case 6165:return yi+e+Qo+"flex-"+e+e;case 5187:return yi+e+vi(e,/(\w+).+(:[^]+)/,yi+"box-$1$2"+Qo+"flex-$1$2")+e;case 5443:return yi+e+Qo+"flex-item-"+vi(e,/flex-|-self/,"")+e;case 4675:return yi+e+Qo+"flex-line-pack"+vi(e,/align-content|flex-|-self/,"")+e;case 5548:return yi+e+Qo+vi(e,"shrink","negative")+e;case 5292:return yi+e+Qo+vi(e,"basis","preferred-size")+e;case 6060:return yi+"box-"+vi(e,"-grow","")+yi+e+Qo+vi(e,"grow","positive")+e;case 4554:return yi+vi(e,/([^-])(transform)/g,"$1"+yi+"$2")+e;case 6187:return vi(vi(vi(e,/(zoom-|grab)/,yi+"$1"),/(image-set)/,yi+"$1"),e,"")+e;case 5495:case 3959:return vi(e,/(image-set\([^]*)/,yi+"$1$`$1");case 4968:return vi(vi(e,/(.+:)(flex-)?(.*)/,yi+"box-pack:$3"+Qo+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+yi+e+e;case 4095:case 3583:case 4068:case 2532:return vi(e,/(.+)-inline(.+)/,yi+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Pu(e)-1-t>6)switch(Do(e,t+1)){case 109:if(Do(e,t+4)!==45)break;case 102:return vi(e,/(.+:)(.+)-([^]+)/,"$1"+yi+"$2-$3$1"+ZS+(Do(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~jk(e,"stretch")?H2(vi(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(Do(e,t+1)!==115)break;case 6444:switch(Do(e,Pu(e)-3-(~jk(e,"!important")&&10))){case 107:return vi(e,":",":"+yi)+e;case 101:return vi(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+yi+(Do(e,14)===45?"inline-":"")+"box$3$1"+yi+"$2$3$1"+Qo+"$2box$3")+e}break;case 5936:switch(Do(e,t+11)){case 114:return yi+e+Qo+vi(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return yi+e+Qo+vi(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return yi+e+Qo+vi(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return yi+e+Qo+e+e}return e}var p_e=function(t,r,s,c){if(t.length>-1&&!t.return)switch(t.type){case m5:t.return=H2(t.value,t.length);break;case V2:return yy([Yv(t,{value:vi(t.value,"@","@"+yi)})],c);case p5:if(t.length)return Qge(t.props,function(f){switch(Kge(f,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return yy([Yv(t,{props:[vi(f,/:(read-\w+)/,":"+ZS+"$1")]})],c);case"::placeholder":return yy([Yv(t,{props:[vi(f,/:(plac\w+)/,":"+yi+"input-$1")]}),Yv(t,{props:[vi(f,/:(plac\w+)/,":"+ZS+"$1")]}),Yv(t,{props:[vi(f,/:(plac\w+)/,Qo+"input-$1")]})],c)}return""})}},m_e=[p_e],g_e=function(t){var r=t.key;if(r==="css"){var s=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(s,function(ie){var te=ie.getAttribute("data-emotion");te.indexOf(" ")!==-1&&(document.head.appendChild(ie),ie.setAttribute("data-s",""))})}var c=t.stylisPlugins||m_e,f={},_,x=[];_=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(ie){for(var te=ie.getAttribute("data-emotion").split(" "),W=1;W<te.length;W++)f[te[W]]=!0;x.push(ie)});var a,I=[d_e,f_e];{var D,O=[o_e,l_e(function(ie){D.insert(ie)})],F=a_e(I.concat(c,O)),H=function(te){return yy(i_e(te),F)};a=function(te,W,X,ee){D=X,H(te?te+"{"+W.styles+"}":W.styles),ee&&(Q.inserted[W.name]=!0)}}var Q={key:r,sheet:new qge({key:r,container:_,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:f,registered:{},insert:a};return Q.sheet.hydrate(x),Q},__e=!0;function y_e(e,t,r){var s="";return r.split(" ").forEach(function(c){e[c]!==void 0?t.push(e[c]+";"):s+=c+" "}),s}var Z2=function(t,r,s){var c=t.key+"-"+r.name;(s===!1||__e===!1)&&t.registered[c]===void 0&&(t.registered[c]=r.styles)},X2=function(t,r,s){Z2(t,r,s);var c=t.key+"-"+r.name;if(t.inserted[r.name]===void 0){var f=r;do t.insert(r===f?"."+c:"",f,t.sheet,!0),f=f.next;while(f!==void 0)}};function v_e(e){for(var t=0,r,s=0,c=e.length;c>=4;++s,c-=4)r=e.charCodeAt(s)&255|(e.charCodeAt(++s)&255)<<8|(e.charCodeAt(++s)&255)<<16|(e.charCodeAt(++s)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,t=(r&65535)*1540483477+((r>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(c){case 3:t^=(e.charCodeAt(s+2)&255)<<16;case 2:t^=(e.charCodeAt(s+1)&255)<<8;case 1:t^=e.charCodeAt(s)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var x_e={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},b_e=!1,w_e=/[A-Z]|^ms/g,T_e=/_EMO_([^_]+?)_([^]*?)_EMO_/g,K2=function(t){return t.charCodeAt(1)===45},nV=function(t){return t!=null&&typeof t!="boolean"},MR=j2(function(e){return K2(e)?e:e.replace(w_e,"-$&").toLowerCase()}),rV=function(t,r){switch(t){case"animation":case"animationName":if(typeof r=="string")return r.replace(T_e,function(s,c,f){return Ru={name:c,styles:f,next:Ru},c})}return x_e[t]!==1&&!K2(t)&&typeof r=="number"&&r!==0?r+"px":r},E_e="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function zx(e,t,r){if(r==null)return"";var s=r;if(s.__emotion_styles!==void 0)return s;switch(typeof r){case"boolean":return"";case"object":{var c=r;if(c.anim===1)return Ru={name:c.name,styles:c.styles,next:Ru},c.name;var f=r;if(f.styles!==void 0){var _=f.next;if(_!==void 0)for(;_!==void 0;)Ru={name:_.name,styles:_.styles,next:Ru},_=_.next;var x=f.styles+";";return x}return S_e(e,t,r)}case"function":{if(e!==void 0){var a=Ru,I=r(e);return Ru=a,zx(e,t,I)}break}}var D=r;if(t==null)return D;var O=t[D];return O!==void 0?O:D}function S_e(e,t,r){var s="";if(Array.isArray(r))for(var c=0;c<r.length;c++)s+=zx(e,t,r[c])+";";else for(var f in r){var _=r[f];if(typeof _!="object"){var x=_;t!=null&&t[x]!==void 0?s+=f+"{"+t[x]+"}":nV(x)&&(s+=MR(f)+":"+rV(f,x)+";")}else{if(f==="NO_COMPONENT_SELECTOR"&&b_e)throw new Error(E_e);if(Array.isArray(_)&&typeof _[0]=="string"&&(t==null||t[_[0]]===void 0))for(var a=0;a<_.length;a++)nV(_[a])&&(s+=MR(f)+":"+rV(f,_[a])+";");else{var I=zx(e,t,_);switch(f){case"animation":case"animationName":{s+=MR(f)+":"+I+";";break}default:s+=f+"{"+I+"}"}}}}return s}var iV=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Ru;function _5(e,t,r){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var s=!0,c="";Ru=void 0;var f=e[0];if(f==null||f.raw===void 0)s=!1,c+=zx(r,t,f);else{var _=f;c+=_[0]}for(var x=1;x<e.length;x++)if(c+=zx(r,t,e[x]),s){var a=f;c+=a[x]}iV.lastIndex=0;for(var I="",D;(D=iV.exec(c))!==null;)I+="-"+D[1];var O=v_e(c)+I;return{name:O,styles:c,next:Ru}}var I_e=function(t){return t()},Q2=KE.useInsertionEffect?KE.useInsertionEffect:!1,C_e=Q2||I_e,sV=Q2||G.useLayoutEffect,Y2=G.createContext(typeof HTMLElement!="undefined"?g_e({key:"css"}):null);Y2.Provider;var J2=function(t){return G.forwardRef(function(r,s){var c=G.useContext(Y2);return t(r,c,s)})},y5=G.createContext({}),A_e=J2(function(e,t){var r=e.styles,s=_5([r],void 0,G.useContext(y5)),c=G.useRef();return sV(function(){var f=t.key+"-global",_=new t.sheet.constructor({key:f,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),x=!1,a=document.querySelector('style[data-emotion="'+f+" "+s.name+'"]');return t.sheet.tags.length&&(_.before=t.sheet.tags[0]),a!==null&&(x=!0,a.setAttribute("data-emotion",f),_.hydrate([a])),c.current=[_,x],function(){_.flush()}},[t]),sV(function(){var f=c.current,_=f[0],x=f[1];if(x){f[1]=!1;return}if(s.next!==void 0&&X2(t,s.next,!0),_.tags.length){var a=_.tags[_.tags.length-1].nextElementSibling;_.before=a,_.flush()}t.insert("",s,_,!1)},[t,s.name]),null});function P_e(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return _5(t)}var v5=function(){var t=P_e.apply(void 0,arguments),r="animation-"+t.name;return{name:r,styles:"@keyframes "+r+"{"+t.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},R_e=jge,M_e=function(t){return t!=="theme"},oV=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?R_e:M_e},aV=function(t,r,s){var c;if(r){var f=r.shouldForwardProp;c=t.__emotion_forwardProp&&f?function(_){return t.__emotion_forwardProp(_)&&f(_)}:f}return typeof c!="function"&&s&&(c=t.__emotion_forwardProp),c},k_e=!1,D_e=function(t){var r=t.cache,s=t.serialized,c=t.isStringTag;return Z2(r,s,c),C_e(function(){return X2(r,s,c)}),null},O_e=function e(t,r){var s=t.__emotion_real===t,c=s&&t.__emotion_base||t,f,_;r!==void 0&&(f=r.label,_=r.target);var x=aV(t,r,s),a=x||oV(c),I=!a("as");return function(){var D=arguments,O=s&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(f!==void 0&&O.push("label:"+f+";"),D[0]==null||D[0].raw===void 0)O.push.apply(O,D);else{O.push(D[0][0]);for(var F=D.length,H=1;H<F;H++)O.push(D[H],D[0][H])}var Q=J2(function(ie,te,W){var X=I&&ie.as||c,ee="",fe=[],ye=ie;if(ie.theme==null){ye={};for(var Ee in ie)ye[Ee]=ie[Ee];ye.theme=G.useContext(y5)}typeof ie.className=="string"?ee=y_e(te.registered,fe,ie.className):ie.className!=null&&(ee=ie.className+" ");var re=_5(O.concat(fe),te.registered,ye);ee+=te.key+"-"+re.name,_!==void 0&&(ee+=" "+_);var he=I&&x===void 0?oV(X):a,_e={};for(var Se in ie)I&&Se==="as"||he(Se)&&(_e[Se]=ie[Se]);return _e.className=ee,W&&(_e.ref=W),G.createElement(G.Fragment,null,G.createElement(D_e,{cache:te,serialized:re,isStringTag:typeof X=="string"}),G.createElement(X,_e))});return Q.displayName=f!==void 0?f:"Styled("+(typeof c=="string"?c:c.displayName||c.name||"Component")+")",Q.defaultProps=t.defaultProps,Q.__emotion_real=Q,Q.__emotion_base=c,Q.__emotion_styles=O,Q.__emotion_forwardProp=x,Object.defineProperty(Q,"toString",{value:function(){return _===void 0&&k_e?"NO_COMPONENT_SELECTOR":"."+_}}),Q.withComponent=function(ie,te){return e(ie,HS({},r,te,{shouldForwardProp:aV(Q,te,!0)})).apply(void 0,O)},Q}},L_e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Vk=O_e.bind();L_e.forEach(function(e){Vk[e]=Vk(e)});var eH={exports:{}},z_e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",N_e=z_e,F_e=N_e;function tH(){}function nH(){}nH.resetWarningCache=tH;var B_e=function(){function e(s,c,f,_,x,a){if(a!==F_e){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:nH,resetWarningCache:tH};return r.PropTypes=r,r};eH.exports=B_e();var j_e=eH.exports;const Zr=Yy(j_e);function U_e(e){return e==null||Object.keys(e).length===0}function V_e(e){const{styles:t,defaultTheme:r={}}=e,s=typeof t=="function"?c=>t(U_e(c)?r:c):t;return N.jsx(A_e,{styles:s})}/**
 * @mui/styled-engine v6.0.2
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function $_e(e,t){return Vk(e,t)}const q_e=(e,t)=>{Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))};function Lu(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function rH(e){if(!Lu(e))return e;const t={};return Object.keys(e).forEach(r=>{t[r]=rH(e[r])}),t}function na(e,t,r={clone:!0}){const s=r.clone?de({},e):e;return Lu(e)&&Lu(t)&&Object.keys(t).forEach(c=>{Lu(t[c])&&Object.prototype.hasOwnProperty.call(e,c)&&Lu(e[c])?s[c]=na(e[c],t[c],r):r.clone?s[c]=Lu(t[c])?rH(t[c]):t[c]:s[c]=t[c]}),s}const G_e=e=>{const t=Object.keys(e).map(r=>({key:r,val:e[r]}))||[];return t.sort((r,s)=>r.val-s.val),t.reduce((r,s)=>_t(de({},r),{[s.key]:s.val}),{})};function W_e(e){const F=e,{values:t={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:r="px",step:s=5}=F,c=On(F,["values","unit","step"]),f=G_e(t),_=Object.keys(f);function x(H){return`@media (min-width:${typeof t[H]=="number"?t[H]:H}${r})`}function a(H){return`@media (max-width:${(typeof t[H]=="number"?t[H]:H)-s/100}${r})`}function I(H,Q){const ie=_.indexOf(Q);return`@media (min-width:${typeof t[H]=="number"?t[H]:H}${r}) and (max-width:${(ie!==-1&&typeof t[_[ie]]=="number"?t[_[ie]]:Q)-s/100}${r})`}function D(H){return _.indexOf(H)+1<_.length?I(H,_[_.indexOf(H)+1]):x(H)}function O(H){const Q=_.indexOf(H);return Q===0?x(_[1]):Q===_.length-1?a(_[Q]):I(H,_[_.indexOf(H)+1]).replace("@media","@media not all and")}return de({keys:_,values:f,up:x,down:a,between:I,only:D,not:O,unit:r},c)}function H_e(e,t){if(!e.containerQueries)return t;const r=Object.keys(t).filter(s=>s.startsWith("@container")).sort((s,c)=>{var _,x;const f=/min-width:\s*([0-9.]+)/;return+(((_=s.match(f))==null?void 0:_[1])||0)-+(((x=c.match(f))==null?void 0:x[1])||0)});return r.length?r.reduce((s,c)=>{const f=t[c];return delete s[c],s[c]=f,s},de({},t)):t}function Z_e(e,t){return t==="@"||t.startsWith("@")&&(e.some(r=>t.startsWith(`@${r}`))||!!t.match(/^@\d/))}function X_e(e,t){const r=t.match(/^@([^/]+)?\/?(.+)?$/);if(!r)return null;const[,s,c]=r,f=Number.isNaN(+s)?s||0:+s;return e.containerQueries(c).up(f)}function K_e(e){const t=(f,_)=>f.replace("@media",_?`@container ${_}`:"@container");function r(f,_){f.up=(...x)=>t(e.breakpoints.up(...x),_),f.down=(...x)=>t(e.breakpoints.down(...x),_),f.between=(...x)=>t(e.breakpoints.between(...x),_),f.only=(...x)=>t(e.breakpoints.only(...x),_),f.not=(...x)=>{const a=t(e.breakpoints.not(...x),_);return a.includes("not all and")?a.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):a}}const s={},c=f=>(r(s,f),s);return r(c),_t(de({},e),{containerQueries:c})}const Q_e={borderRadius:4};function q1(e,t){return t?na(e,t,{clone:!1}):e}const LC={xs:0,sm:600,md:900,lg:1200,xl:1536},lV={keys:["xs","sm","md","lg","xl"],up:e=>`@media (min-width:${LC[e]}px)`},Y_e={containerQueries:e=>({up:t=>{let r=typeof t=="number"?t:LC[t]||t;return typeof r=="number"&&(r=`${r}px`),e?`@container ${e} (min-width:${r})`:`@container (min-width:${r})`}})};function rd(e,t,r){const s=e.theme||{};if(Array.isArray(t)){const f=s.breakpoints||lV;return t.reduce((_,x,a)=>(_[f.up(f.keys[a])]=r(t[a]),_),{})}if(typeof t=="object"){const f=s.breakpoints||lV;return Object.keys(t).reduce((_,x)=>{if(Z_e(f.keys,x)){const a=X_e(s.containerQueries?s:Y_e,x);a&&(_[a]=r(t[x],x))}else if(Object.keys(f.values||LC).includes(x)){const a=f.up(x);_[a]=r(t[x],x)}else{const a=x;_[a]=t[a]}return _},{})}return r(t)}function J_e(e={}){var r;return((r=e.keys)==null?void 0:r.reduce((s,c)=>{const f=e.up(c);return s[f]={},s},{}))||{}}function eye(e,t){return e.reduce((r,s)=>{const c=r[s];return(!c||Object.keys(c).length===0)&&delete r[s],r},t)}function tr(e){if(typeof e!="string")throw new Error(nd(7));return e.charAt(0).toUpperCase()+e.slice(1)}function zC(e,t,r=!0){if(!t||typeof t!="string")return null;if(e&&e.vars&&r){const s=`vars.${t}`.split(".").reduce((c,f)=>c&&c[f]?c[f]:null,e);if(s!=null)return s}return t.split(".").reduce((s,c)=>s&&s[c]!=null?s[c]:null,e)}function XS(e,t,r,s=r){let c;return typeof e=="function"?c=e(r):Array.isArray(e)?c=e[r]||s:c=zC(e,r)||s,t&&(c=t(c,s,e)),c}function Xs(e){const{prop:t,cssProperty:r=e.prop,themeKey:s,transform:c}=e,f=_=>{if(_[t]==null)return null;const x=_[t],a=_.theme,I=zC(a,s)||{};return rd(_,x,O=>{let F=XS(I,c,O);return O===F&&typeof O=="string"&&(F=XS(I,c,`${t}${O==="default"?"":tr(O)}`,O)),r===!1?F:{[r]:F}})};return f.propTypes={},f.filterProps=[t],f}function tye(e){const t={};return r=>(t[r]===void 0&&(t[r]=e(r)),t[r])}const nye={m:"margin",p:"padding"},rye={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},cV={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},iye=tye(e=>{if(e.length>2)if(cV[e])e=cV[e];else return[e];const[t,r]=e.split(""),s=nye[t],c=rye[r]||"";return Array.isArray(c)?c.map(f=>s+f):[s+c]}),x5=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],b5=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...x5,...b5];function xb(e,t,r,s){var f;const c=(f=zC(e,t,!0))!=null?f:r;return typeof c=="number"||typeof c=="string"?_=>typeof _=="string"?_:typeof c=="string"?`calc(${_} * ${c})`:c*_:Array.isArray(c)?_=>{if(typeof _=="string")return _;const x=Math.abs(_),a=c[x];return _>=0?a:typeof a=="number"?-a:`-${a}`}:typeof c=="function"?c:()=>{}}function w5(e){return xb(e,"spacing",8)}function bb(e,t){return typeof t=="string"||t==null?t:e(t)}function sye(e,t){return r=>e.reduce((s,c)=>(s[c]=bb(t,r),s),{})}function oye(e,t,r,s){if(!t.includes(r))return null;const c=iye(r),f=sye(c,s),_=e[r];return rd(e,_,f)}function iH(e,t){const r=w5(e.theme);return Object.keys(e).map(s=>oye(e,t,s,r)).reduce(q1,{})}function zs(e){return iH(e,x5)}zs.propTypes={};zs.filterProps=x5;function Ns(e){return iH(e,b5)}Ns.propTypes={};Ns.filterProps=b5;function sH(e=8,t=w5({spacing:e})){if(e.mui)return e;const r=(...s)=>(s.length===0?[1]:s).map(f=>{const _=t(f);return typeof _=="number"?`${_}px`:_}).join(" ");return r.mui=!0,r}function NC(...e){const t=e.reduce((s,c)=>(c.filterProps.forEach(f=>{s[f]=c}),s),{}),r=s=>Object.keys(s).reduce((c,f)=>t[f]?q1(c,t[f](s)):c,{});return r.propTypes={},r.filterProps=e.reduce((s,c)=>s.concat(c.filterProps),[]),r}function Gl(e){return typeof e!="number"?e:`${e}px solid`}function rc(e,t){return Xs({prop:e,themeKey:"borders",transform:t})}const aye=rc("border",Gl),lye=rc("borderTop",Gl),cye=rc("borderRight",Gl),uye=rc("borderBottom",Gl),hye=rc("borderLeft",Gl),dye=rc("borderColor"),fye=rc("borderTopColor"),pye=rc("borderRightColor"),mye=rc("borderBottomColor"),gye=rc("borderLeftColor"),_ye=rc("outline",Gl),yye=rc("outlineColor"),FC=e=>{if(e.borderRadius!==void 0&&e.borderRadius!==null){const t=xb(e.theme,"shape.borderRadius",4),r=s=>({borderRadius:bb(t,s)});return rd(e,e.borderRadius,r)}return null};FC.propTypes={};FC.filterProps=["borderRadius"];NC(aye,lye,cye,uye,hye,dye,fye,pye,mye,gye,FC,_ye,yye);const BC=e=>{if(e.gap!==void 0&&e.gap!==null){const t=xb(e.theme,"spacing",8),r=s=>({gap:bb(t,s)});return rd(e,e.gap,r)}return null};BC.propTypes={};BC.filterProps=["gap"];const jC=e=>{if(e.columnGap!==void 0&&e.columnGap!==null){const t=xb(e.theme,"spacing",8),r=s=>({columnGap:bb(t,s)});return rd(e,e.columnGap,r)}return null};jC.propTypes={};jC.filterProps=["columnGap"];const UC=e=>{if(e.rowGap!==void 0&&e.rowGap!==null){const t=xb(e.theme,"spacing",8),r=s=>({rowGap:bb(t,s)});return rd(e,e.rowGap,r)}return null};UC.propTypes={};UC.filterProps=["rowGap"];const vye=Xs({prop:"gridColumn"}),xye=Xs({prop:"gridRow"}),bye=Xs({prop:"gridAutoFlow"}),wye=Xs({prop:"gridAutoColumns"}),Tye=Xs({prop:"gridAutoRows"}),Eye=Xs({prop:"gridTemplateColumns"}),Sye=Xs({prop:"gridTemplateRows"}),Iye=Xs({prop:"gridTemplateAreas"}),Cye=Xs({prop:"gridArea"});NC(BC,jC,UC,vye,xye,bye,wye,Tye,Eye,Sye,Iye,Cye);function vy(e,t){return t==="grey"?t:e}const Aye=Xs({prop:"color",themeKey:"palette",transform:vy}),Pye=Xs({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:vy}),Rye=Xs({prop:"backgroundColor",themeKey:"palette",transform:vy});NC(Aye,Pye,Rye);function hl(e){return e<=1&&e!==0?`${e*100}%`:e}const Mye=Xs({prop:"width",transform:hl}),T5=e=>{if(e.maxWidth!==void 0&&e.maxWidth!==null){const t=r=>{var c,f,_,x,a;const s=((_=(f=(c=e.theme)==null?void 0:c.breakpoints)==null?void 0:f.values)==null?void 0:_[r])||LC[r];return s?((a=(x=e.theme)==null?void 0:x.breakpoints)==null?void 0:a.unit)!=="px"?{maxWidth:`${s}${e.theme.breakpoints.unit}`}:{maxWidth:s}:{maxWidth:hl(r)}};return rd(e,e.maxWidth,t)}return null};T5.filterProps=["maxWidth"];const kye=Xs({prop:"minWidth",transform:hl}),Dye=Xs({prop:"height",transform:hl}),Oye=Xs({prop:"maxHeight",transform:hl}),Lye=Xs({prop:"minHeight",transform:hl});Xs({prop:"size",cssProperty:"width",transform:hl});Xs({prop:"size",cssProperty:"height",transform:hl});const zye=Xs({prop:"boxSizing"});NC(Mye,T5,kye,Dye,Oye,Lye,zye);const wb={border:{themeKey:"borders",transform:Gl},borderTop:{themeKey:"borders",transform:Gl},borderRight:{themeKey:"borders",transform:Gl},borderBottom:{themeKey:"borders",transform:Gl},borderLeft:{themeKey:"borders",transform:Gl},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Gl},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:FC},color:{themeKey:"palette",transform:vy},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:vy},backgroundColor:{themeKey:"palette",transform:vy},p:{style:Ns},pt:{style:Ns},pr:{style:Ns},pb:{style:Ns},pl:{style:Ns},px:{style:Ns},py:{style:Ns},padding:{style:Ns},paddingTop:{style:Ns},paddingRight:{style:Ns},paddingBottom:{style:Ns},paddingLeft:{style:Ns},paddingX:{style:Ns},paddingY:{style:Ns},paddingInline:{style:Ns},paddingInlineStart:{style:Ns},paddingInlineEnd:{style:Ns},paddingBlock:{style:Ns},paddingBlockStart:{style:Ns},paddingBlockEnd:{style:Ns},m:{style:zs},mt:{style:zs},mr:{style:zs},mb:{style:zs},ml:{style:zs},mx:{style:zs},my:{style:zs},margin:{style:zs},marginTop:{style:zs},marginRight:{style:zs},marginBottom:{style:zs},marginLeft:{style:zs},marginX:{style:zs},marginY:{style:zs},marginInline:{style:zs},marginInlineStart:{style:zs},marginInlineEnd:{style:zs},marginBlock:{style:zs},marginBlockStart:{style:zs},marginBlockEnd:{style:zs},displayPrint:{cssProperty:!1,transform:e=>({"@media print":{display:e}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:BC},rowGap:{style:UC},columnGap:{style:jC},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:hl},maxWidth:{style:T5},minWidth:{transform:hl},height:{transform:hl},maxHeight:{transform:hl},minHeight:{transform:hl},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function Nye(...e){const t=e.reduce((s,c)=>s.concat(Object.keys(c)),[]),r=new Set(t);return e.every(s=>r.size===Object.keys(s).length)}function Fye(e,t){return typeof e=="function"?e(t):e}function Bye(){function e(r,s,c,f){const _={[r]:s,theme:c},x=f[r];if(!x)return{[r]:s};const{cssProperty:a=r,themeKey:I,transform:D,style:O}=x;if(s==null)return null;if(I==="typography"&&s==="inherit")return{[r]:s};const F=zC(c,I)||{};return O?O(_):rd(_,s,Q=>{let ie=XS(F,D,Q);return Q===ie&&typeof Q=="string"&&(ie=XS(F,D,`${r}${Q==="default"?"":tr(Q)}`,Q)),a===!1?ie:{[a]:ie}})}function t(r){var x;const{sx:s,theme:c={}}=r||{};if(!s)return null;const f=(x=c.unstable_sxConfig)!=null?x:wb;function _(a){let I=a;if(typeof a=="function")I=a(c);else if(typeof a!="object")return a;if(!I)return null;const D=J_e(c.breakpoints),O=Object.keys(D);let F=D;return Object.keys(I).forEach(H=>{const Q=Fye(I[H],c);if(Q!=null)if(typeof Q=="object")if(f[H])F=q1(F,e(H,Q,c,f));else{const ie=rd({theme:c},Q,te=>({[H]:te}));Nye(ie,Q)?F[H]=t({sx:Q,theme:c}):F=q1(F,ie)}else F=q1(F,e(H,Q,c,f))}),H_e(c,eye(O,F))}return Array.isArray(s)?s.map(_):_(s)}return t}const Tb=Bye();Tb.filterProps=["sx"];function jye(e,t){var s;const r=this;if(r.vars){if(!((s=r.colorSchemes)!=null&&s[e])||typeof r.getColorSchemeSelector!="function")return{};let c=r.getColorSchemeSelector(e);return(c.includes("data-")||c.includes("."))&&(c=`*:where(${c.replace(/\s*&$/,"")}) &`),{[c]:t}}return r.palette.mode===e?t:{}}function E5(e={},...t){const D=e,{breakpoints:r={},palette:s={},spacing:c,shape:f={}}=D,_=On(D,["breakpoints","palette","spacing","shape"]),x=W_e(r),a=sH(c);let I=na({breakpoints:x,direction:"ltr",components:{},palette:de({mode:"light"},s),spacing:a,shape:de(de({},Q_e),f)},_);return I=K_e(I),I.applyStyles=jye,I=t.reduce((O,F)=>na(O,F),I),I.unstable_sxConfig=de(de({},wb),_==null?void 0:_.unstable_sxConfig),I.unstable_sx=function(F){return Tb({sx:F,theme:this})},I}function Uye(e){return Object.keys(e).length===0}function oH(e=null){const t=G.useContext(y5);return!t||Uye(t)?e:t}const Vye=E5();function S5(e=Vye){return oH(e)}function $ye({styles:e,themeId:t,defaultTheme:r={}}){const s=S5(r),c=typeof e=="function"?e(t&&s[t]||s):e;return N.jsx(V_e,{styles:c})}const qye=e=>{var s,c;const t={systemProps:{},otherProps:{}},r=(c=(s=e==null?void 0:e.theme)==null?void 0:s.unstable_sxConfig)!=null?c:wb;return Object.keys(e).forEach(f=>{r[f]?t.systemProps[f]=e[f]:t.otherProps[f]=e[f]}),t};function Gye(e){const _=e,{sx:t}=_,r=On(_,["sx"]),{systemProps:s,otherProps:c}=qye(r);let f;return Array.isArray(t)?f=[s,...t]:typeof t=="function"?f=(...x)=>{const a=t(...x);return Lu(a)?de(de({},s),a):s}:f=de(de({},s),t),_t(de({},c),{sx:f})}const uV=e=>e,Wye=()=>{let e=uV;return{configure(t){e=t},generate(t){return e(t)},reset(){e=uV}}},Hye=Wye();function aH(e){var t,r,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var c=e.length;for(t=0;t<c;t++)e[t]&&(r=aH(e[t]))&&(s&&(s+=" "),s+=r)}else for(r in e)e[r]&&(s&&(s+=" "),s+=r);return s}function Or(){for(var e,t,r=0,s="",c=arguments.length;r<c;r++)(e=arguments[r])&&(t=aH(e))&&(s&&(s+=" "),s+=t);return s}const Zye={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Di(e,t,r="Mui"){const s=Zye[t];return s?`${r}-${s}`:`${Hye.generate(e)}-${t}`}function Oi(e,t,r="Mui"){const s={};return t.forEach(c=>{s[c]=Di(e,c,r)}),s}var zi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I5=Symbol.for("react.element"),C5=Symbol.for("react.portal"),VC=Symbol.for("react.fragment"),$C=Symbol.for("react.strict_mode"),qC=Symbol.for("react.profiler"),GC=Symbol.for("react.provider"),WC=Symbol.for("react.context"),Xye=Symbol.for("react.server_context"),HC=Symbol.for("react.forward_ref"),ZC=Symbol.for("react.suspense"),XC=Symbol.for("react.suspense_list"),KC=Symbol.for("react.memo"),QC=Symbol.for("react.lazy"),Kye=Symbol.for("react.offscreen"),lH;lH=Symbol.for("react.module.reference");function ic(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case I5:switch(e=e.type,e){case VC:case qC:case $C:case ZC:case XC:return e;default:switch(e=e&&e.$$typeof,e){case Xye:case WC:case HC:case QC:case KC:case GC:return e;default:return t}}case C5:return t}}}zi.ContextConsumer=WC;zi.ContextProvider=GC;zi.Element=I5;zi.ForwardRef=HC;zi.Fragment=VC;zi.Lazy=QC;zi.Memo=KC;zi.Portal=C5;zi.Profiler=qC;zi.StrictMode=$C;zi.Suspense=ZC;zi.SuspenseList=XC;zi.isAsyncMode=function(){return!1};zi.isConcurrentMode=function(){return!1};zi.isContextConsumer=function(e){return ic(e)===WC};zi.isContextProvider=function(e){return ic(e)===GC};zi.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===I5};zi.isForwardRef=function(e){return ic(e)===HC};zi.isFragment=function(e){return ic(e)===VC};zi.isLazy=function(e){return ic(e)===QC};zi.isMemo=function(e){return ic(e)===KC};zi.isPortal=function(e){return ic(e)===C5};zi.isProfiler=function(e){return ic(e)===qC};zi.isStrictMode=function(e){return ic(e)===$C};zi.isSuspense=function(e){return ic(e)===ZC};zi.isSuspenseList=function(e){return ic(e)===XC};zi.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===VC||e===qC||e===$C||e===ZC||e===XC||e===Kye||typeof e=="object"&&e!==null&&(e.$$typeof===QC||e.$$typeof===KC||e.$$typeof===GC||e.$$typeof===WC||e.$$typeof===HC||e.$$typeof===lH||e.getModuleId!==void 0)};zi.typeOf=ic;const Qye=E5();function kR(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}function $k(e,t,r){return Jye(t)?r:t[e]||t}const tE=Symbol("mui.processed_props");function nE(e,t,r){if(tE in e)return e[tE];const s=_t(de({},e),{theme:$k(t,e.theme,r)});return e[tE]=s,s[tE]=s,s}function Yye(e){return e?(t,r)=>r[e]:null}function BE(e,t){var c;const r=typeof e=="function"?e(t):e;if(Array.isArray(r))return r.flatMap(f=>BE(f,t));if(Array.isArray(r==null?void 0:r.variants)){const s=r,{variants:f}=s;let x=On(s,["variants"]),a;e:for(let I=0;I<f.length;I+=1){const D=f[I];if(typeof D.props=="function"){if(a!=null||(a=_t(de(de({},t),t.ownerState),{ownerState:t.ownerState})),!D.props(a))continue}else for(const O in D.props)if(t[O]!==D.props[O]&&((c=t.ownerState)==null?void 0:c[O])!==D.props[O])continue e;Array.isArray(x)||(x=[x]),typeof D.style=="function"?(a!=null||(a=_t(de(de({},t),t.ownerState),{ownerState:t.ownerState})),x.push(D.style(a))):x.push(D.style)}return x}return r}function cH(e={}){const{themeId:t,defaultTheme:r=Qye,rootShouldForwardProp:s=kR,slotShouldForwardProp:c=kR}=e,f=x=>Tb(nE(x,t,r));return f.__mui_systemSx=!0,(x,a={})=>{q_e(x,re=>re.filter(he=>!(he!=null&&he.__mui_systemSx)));const Ee=a,{name:I,slot:D,skipVariantsResolver:O,skipSx:F,overridesResolver:H=Yye(t0e(D))}=Ee,Q=On(Ee,["name","slot","skipVariantsResolver","skipSx","overridesResolver"]),ie=O!==void 0?O:D&&D!=="Root"&&D!=="root"||!1,te=F||!1;let W,X=kR;D==="Root"||D==="root"?X=s:D?X=c:e0e(x)&&(X=void 0);const ee=$_e(x,de({shouldForwardProp:X,label:W},Q)),fe=re=>typeof re=="function"&&re.__emotion_real!==re||Lu(re)?he=>BE(re,nE(he,t,r)):re,ye=(re,...he)=>{let _e=fe(re);const Se=he?he.map(fe):[];I&&H&&Se.push(we=>{const Lt=$k(t,we.theme,r);if(!Lt.components||!Lt.components[I]||!Lt.components[I].styleOverrides)return null;const Gt=Lt.components[I].styleOverrides,qt={},It=nE(we,t,r);for(const ct in Gt)qt[ct]=BE(Gt[ct],It);return H(we,qt)}),I&&!ie&&Se.push(we=>{var qt,It;const Lt=$k(t,we.theme,r),Gt=(It=(qt=Lt==null?void 0:Lt.components)==null?void 0:qt[I])==null?void 0:It.variants;return Gt?BE({variants:Gt},nE(we,t,r)):null}),te||Se.push(f);const J=Se.length-he.length;if(Array.isArray(re)&&J>0){const we=new Array(J).fill("");_e=[...re,...we],_e.raw=[...re.raw,...we]}const Ie=ee(_e,...Se);return x.muiName&&(Ie.muiName=x.muiName),Ie};return ee.withConfig&&(ye.withConfig=ee.withConfig),ye}}function Jye(e){for(const t in e)return!1;return!0}function e0e(e){return typeof e=="string"&&e.charCodeAt(0)>96}function t0e(e){return e&&e.charAt(0).toLowerCase()+e.slice(1)}const Qu=cH();function Nx(e,t){const r=de({},t);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const c=s;if(c==="components"||c==="slots")r[c]=de(de({},e[c]),r[c]);else if(c==="componentsProps"||c==="slotProps"){const f=e[c],_=t[c];if(!_)r[c]=f||{};else if(!f)r[c]=_;else{r[c]=de({},_);for(const x in f)if(Object.prototype.hasOwnProperty.call(f,x)){const a=x;r[c][a]=Nx(f[a],_[a])}}}else r[c]===void 0&&(r[c]=e[c])}return r}function uH(e){const{theme:t,name:r,props:s}=e;return!t||!t.components||!t.components[r]||!t.components[r].defaultProps?s:Nx(t.components[r].defaultProps,s)}function n0e({props:e,name:t,defaultTheme:r,themeId:s}){let c=S5(r);return s&&(c=c[s]||c),uH({theme:c,name:t,props:e})}const qf=typeof window!="undefined"?G.useLayoutEffect:G.useEffect;function r0e(e,t,r,s,c){const[f,_]=G.useState(()=>c&&r?r(e).matches:s?s(e).matches:t);return qf(()=>{if(!r)return;const x=r(e),a=()=>{_(x.matches)};return a(),x.addEventListener("change",a),()=>{x.removeEventListener("change",a)}},[e,r]),f}const hH=G.useSyncExternalStore;function i0e(e,t,r,s,c){const f=G.useCallback(()=>t,[t]),_=G.useMemo(()=>{if(c&&r)return()=>r(e).matches;if(s!==null){const{matches:D}=s(e);return()=>D}return f},[f,e,s,c,r]),[x,a]=G.useMemo(()=>{if(r===null)return[f,()=>()=>{}];const D=r(e);return[()=>D.matches,O=>(D.addEventListener("change",O),()=>{D.removeEventListener("change",O)})]},[f,r,e]);return hH(a,x,_)}function hV(e,t={}){const r=oH(),s=typeof window!="undefined"&&typeof window.matchMedia!="undefined",{defaultMatches:c=!1,matchMedia:f=s?window.matchMedia:null,ssrMatchMedia:_=null,noSsr:x=!1}=uH({name:"MuiUseMediaQuery",props:t,theme:r});let a=typeof e=="function"?e(r):e;return a=a.replace(/^@media( ?)/m,""),(hH!==void 0?i0e:r0e)(a,c,f,_,x)}function s0e(e,t=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER){return Math.max(t,Math.min(e,r))}function A5(e,t=0,r=1){return s0e(e,t,r)}function o0e(e){e=e.slice(1);const t=new RegExp(`.{1,${e.length>=6?2:1}}`,"g");let r=e.match(t);return r&&r[0].length===1&&(r=r.map(s=>s+s)),r?`rgb${r.length===4?"a":""}(${r.map((s,c)=>c<3?parseInt(s,16):Math.round(parseInt(s,16)/255*1e3)/1e3).join(", ")})`:""}function Gf(e){if(e.type)return e;if(e.charAt(0)==="#")return Gf(o0e(e));const t=e.indexOf("("),r=e.substring(0,t);if(!["rgb","rgba","hsl","hsla","color"].includes(r))throw new Error(nd(9,e));let s=e.substring(t+1,e.length-1),c;if(r==="color"){if(s=s.split(" "),c=s.shift(),s.length===4&&s[3].charAt(0)==="/"&&(s[3]=s[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(c))throw new Error(nd(10,c))}else s=s.split(",");return s=s.map(f=>parseFloat(f)),{type:r,values:s,colorSpace:c}}const a0e=e=>{const t=Gf(e);return t.values.slice(0,3).map((r,s)=>t.type.includes("hsl")&&s!==0?`${r}%`:r).join(" ")},g1=(e,t)=>{try{return a0e(e)}catch(r){return e}};function YC(e){const{type:t,colorSpace:r}=e;let{values:s}=e;return t.includes("rgb")?s=s.map((c,f)=>f<3?parseInt(c,10):c):t.includes("hsl")&&(s[1]=`${s[1]}%`,s[2]=`${s[2]}%`),t.includes("color")?s=`${r} ${s.join(" ")}`:s=`${s.join(", ")}`,`${t}(${s})`}function dH(e){e=Gf(e);const{values:t}=e,r=t[0],s=t[1]/100,c=t[2]/100,f=s*Math.min(c,1-c),_=(I,D=(I+r/30)%12)=>c-f*Math.max(Math.min(D-3,9-D,1),-1);let x="rgb";const a=[Math.round(_(0)*255),Math.round(_(8)*255),Math.round(_(4)*255)];return e.type==="hsla"&&(x+="a",a.push(t[3])),YC({type:x,values:a})}function qk(e){e=Gf(e);let t=e.type==="hsl"||e.type==="hsla"?Gf(dH(e)).values:e.values;return t=t.map(r=>(e.type!=="color"&&(r/=255),r<=.03928?r/12.92:Ch((r+.055)/1.055,2.4))),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function l0e(e,t){const r=qk(e),s=qk(t);return(Math.max(r,s)+.05)/(Math.min(r,s)+.05)}function Hl(e,t){return e=Gf(e),t=A5(t),(e.type==="rgb"||e.type==="hsl")&&(e.type+="a"),e.type==="color"?e.values[3]=`/${t}`:e.values[3]=t,YC(e)}function rE(e,t,r){try{return Hl(e,t)}catch(s){return e}}function P5(e,t){if(e=Gf(e),t=A5(t),e.type.includes("hsl"))e.values[2]*=1-t;else if(e.type.includes("rgb")||e.type.includes("color"))for(let r=0;r<3;r+=1)e.values[r]*=1-t;return YC(e)}function Vi(e,t,r){try{return P5(e,t)}catch(s){return e}}function R5(e,t){if(e=Gf(e),t=A5(t),e.type.includes("hsl"))e.values[2]+=(100-e.values[2])*t;else if(e.type.includes("rgb"))for(let r=0;r<3;r+=1)e.values[r]+=(255-e.values[r])*t;else if(e.type.includes("color"))for(let r=0;r<3;r+=1)e.values[r]+=(1-e.values[r])*t;return YC(e)}function $i(e,t,r){try{return R5(e,t)}catch(s){return e}}function c0e(e,t=.15){return qk(e)>.5?P5(e,t):R5(e,t)}function iE(e,t,r){try{return c0e(e,t)}catch(s){return e}}function Gk(...e){return e.reduce((t,r)=>r==null?t:function(...c){t.apply(this,c),r.apply(this,c)},()=>{})}function fH(e,t=166){let r;function s(...c){const f=()=>{e.apply(this,c)};clearTimeout(r),r=setTimeout(f,t)}return s.clear=()=>{clearTimeout(r)},s}function DR(e,t){var r,s,c,f;return G.isValidElement(e)&&t.indexOf((f=e.type.muiName)!=null?f:(c=(s=(r=e.type)==null?void 0:r._payload)==null?void 0:s.value)==null?void 0:c.muiName)!==-1}function vl(e){return e&&e.ownerDocument||document}function Xm(e){return vl(e).defaultView||window}function Wk(e,t){typeof e=="function"?e(t):e&&(e.current=t)}let dV=0;function u0e(e){const[t,r]=G.useState(e),s=e||t;return G.useEffect(()=>{t==null&&(dV+=1,r(`mui-${dV}`))},[t]),s}const fV=KE.useId;function M5(e){if(fV!==void 0){const t=fV();return e!=null?e:t}return u0e(e)}function KS({controlled:e,default:t,name:r,state:s="value"}){const{current:c}=G.useRef(e!==void 0),[f,_]=G.useState(t),x=c?e:f,a=G.useCallback(I=>{c||_(I)},[]);return[x,a]}function ey(e){const t=G.useRef(e);return qf(()=>{t.current=e}),G.useRef((...r)=>(0,t.current)(...r)).current}function Bo(...e){return G.useMemo(()=>e.every(t=>t==null)?null:t=>{e.forEach(r=>{Wk(r,t)})},e)}const pV={};function pH(e,t){const r=G.useRef(pV);return r.current===pV&&(r.current=e(t)),r}const h0e=[];function d0e(e){G.useEffect(e,h0e)}class k5{constructor(){Bv(this,"currentId",null);Bv(this,"clear",()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)});Bv(this,"disposeEffect",()=>this.clear)}static create(){return new k5}start(t,r){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,r()},t)}}function mH(){const e=pH(k5.create).current;return d0e(e.disposeEffect),e}function mV(e){try{return e.matches(":focus-visible")}catch(t){}return!1}function gH(e){const t=e.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}const _H=e=>{const t=G.useRef({});return G.useEffect(()=>{t.current=e}),t.current};function Ni(e,t,r=void 0){const s={};for(const c in e){const f=e[c];let _="",x=!0;for(let a=0;a<f.length;a+=1){const I=f[a];I&&(_+=(x===!0?"":" ")+t(I),x=!1,r&&r[I]&&(_+=" "+r[I]))}s[c]=_}return s}function f0e(e){return typeof e=="string"}function yH(e,t,r){return e===void 0||f0e(e)?t:_t(de({},t),{ownerState:de(de({},t.ownerState),r)})}function vH(e,t=[]){if(e===void 0)return{};const r={};return Object.keys(e).filter(s=>s.match(/^on[A-Z]/)&&typeof e[s]=="function"&&!t.includes(s)).forEach(s=>{r[s]=e[s]}),r}function gV(e){if(e===void 0)return{};const t={};return Object.keys(e).filter(r=>!(r.match(/^on[A-Z]/)&&typeof e[r]=="function")).forEach(r=>{t[r]=e[r]}),t}function xH(e){const{getSlotProps:t,additionalProps:r,externalSlotProps:s,externalForwardedProps:c,className:f}=e;if(!t){const H=Or(r==null?void 0:r.className,f,c==null?void 0:c.className,s==null?void 0:s.className),Q=de(de(de({},r==null?void 0:r.style),c==null?void 0:c.style),s==null?void 0:s.style),ie=de(de(de({},r),c),s);return H.length>0&&(ie.className=H),Object.keys(Q).length>0&&(ie.style=Q),{props:ie,internalRef:void 0}}const _=vH(de(de({},c),s)),x=gV(s),a=gV(c),I=t(_),D=Or(I==null?void 0:I.className,r==null?void 0:r.className,f,c==null?void 0:c.className,s==null?void 0:s.className),O=de(de(de(de({},I==null?void 0:I.style),r==null?void 0:r.style),c==null?void 0:c.style),s==null?void 0:s.style),F=de(de(de(de({},I),r),a),x);return D.length>0&&(F.className=D),Object.keys(O).length>0&&(F.style=O),{props:F,internalRef:I.ref}}function bH(e,t,r){return typeof e=="function"?e(t,r):e}function QS(e){var F;const O=e,{elementType:t,externalSlotProps:r,ownerState:s,skipResolvingSlotProps:c=!1}=O,f=On(O,["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"]),_=c?{}:bH(r,s),{props:x,internalRef:a}=xH(_t(de({},f),{externalSlotProps:_})),I=Bo(a,_==null?void 0:_.ref,(F=e.additionalProps)==null?void 0:F.ref);return yH(t,_t(de({},x),{ref:I}),s)}function Eb(e){return!e||!G.isValidElement(e)?null:e.props.propertyIsEnumerable("ref")?e.props.ref:e.ref}const p0e=G.createContext(),m0e=()=>{const e=G.useContext(p0e);return e!=null?e:!1},g0e=G.createContext(void 0);function _0e(e){const{theme:t,name:r,props:s}=e;if(!t||!t.components||!t.components[r])return s;const c=t.components[r];return c.defaultProps?Nx(c.defaultProps,s):!c.styleOverrides&&!c.variants?Nx(c,s):s}function y0e({props:e,name:t}){const r=G.useContext(g0e);return _0e({props:e,name:t,theme:{components:r}})}function v0e(e=""){function t(...s){if(!s.length)return"";const c=s[0];return typeof c=="string"&&!c.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${e?`${e}-`:""}${c}${t(...s.slice(1))})`:`, ${c}`}return(s,...c)=>`var(--${e?`${e}-`:""}${s}${t(...c)})`}const _V=(e,t,r,s=[])=>{let c=e;t.forEach((f,_)=>{_===t.length-1?Array.isArray(c)?c[Number(f)]=r:c&&typeof c=="object"&&(c[f]=r):c&&typeof c=="object"&&(c[f]||(c[f]=s.includes(f)?[]:{}),c=c[f])})},x0e=(e,t,r)=>{function s(c,f=[],_=[]){Object.entries(c).forEach(([x,a])=>{(!r||r&&!r([...f,x]))&&a!=null&&(typeof a=="object"&&Object.keys(a).length>0?s(a,[...f,x],Array.isArray(a)?[..._,x]:_):t([...f,x],a,_))})}s(e)},b0e=(e,t)=>typeof t=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(s=>e.includes(s))||e[e.length-1].toLowerCase().indexOf("opacity")>=0?t:`${t}px`:t;function OR(e,t){const{prefix:r,shouldSkipGeneratingVar:s}=t||{},c={},f={},_={};return x0e(e,(x,a,I)=>{if((typeof a=="string"||typeof a=="number")&&(!s||!s(x,a))){const D=`--${r?`${r}-`:""}${x.join("-")}`,O=b0e(x,a);Object.assign(c,{[D]:O}),_V(f,x,`var(${D})`,I),_V(_,x,`var(${D}, ${O})`,I)}},x=>x[0]==="vars"),{css:c,vars:f,varsWithDefaults:_}}function w0e(e,t={}){const{getSelector:r=te,disableCssColorScheme:s,colorSchemeSelector:c}=t,ee=e,{colorSchemes:f={},components:_,defaultColorScheme:x="light"}=ee,a=On(ee,["colorSchemes","components","defaultColorScheme"]),{vars:I,css:D,varsWithDefaults:O}=OR(a,t);let F=O;const H={},fe=f,{[x]:Q}=fe,ie=On(fe,[ST(x)]);if(Object.entries(ie||{}).forEach(([ye,Ee])=>{const{vars:re,css:he,varsWithDefaults:_e}=OR(Ee,t);F=na(F,_e),H[ye]={css:he,vars:re}}),Q){const{css:ye,vars:Ee,varsWithDefaults:re}=OR(Q,t);F=na(F,re),H[x]={css:ye,vars:Ee}}function te(ye,Ee){var he,_e;let re=c;if(c==="class"&&(re=".%s"),c==="data"&&(re="[data-%s]"),c!=null&&c.startsWith("data-")&&!c.includes("%s")&&(re=`[${c}="%s"]`),ye){if(re==="media")return e.defaultColorScheme===ye?":root":{[`@media (prefers-color-scheme: ${((_e=(he=f[ye])==null?void 0:he.palette)==null?void 0:_e.mode)||ye})`]:{":root":Ee}};if(re)return e.defaultColorScheme===ye?`:root, ${re.replace("%s",String(ye))}`:re.replace("%s",String(ye))}return":root"}return{vars:F,generateThemeVars:()=>{let ye=de({},I);return Object.entries(H).forEach(([,{vars:Ee}])=>{ye=na(ye,Ee)}),ye},generateStyleSheets:()=>{var J,Ie;const ye=[],Ee=e.defaultColorScheme||"light";function re(we,Lt){Object.keys(Lt).length&&ye.push(typeof we=="string"?{[we]:de({},Lt)}:we)}re(r(void 0,de({},D)),D);const Se=H,{[Ee]:he}=Se,_e=On(Se,[ST(Ee)]);if(he){const{css:we}=he,Lt=(Ie=(J=f[Ee])==null?void 0:J.palette)==null?void 0:Ie.mode,Gt=de(!s&&Lt?{colorScheme:Lt}:{},we);re(r(Ee,de({},Gt)),Gt)}return Object.entries(_e).forEach(([we,{css:Lt}])=>{var It,ct;const Gt=(ct=(It=f[we])==null?void 0:It.palette)==null?void 0:ct.mode,qt=de(!s&&Gt?{colorScheme:Gt}:{},Lt);re(r(we,de({},qt)),qt)}),ye}}}function T0e(e){return function(r){return e==="media"?`@media (prefers-color-scheme: ${r})`:e?e.startsWith("data-")&&!e.includes("%s")?`[${e}="${r}"] &`:e==="class"?`.${r} &`:e==="data"?`[data-${r}] &`:`${e.replace("%s",r)} &`:"&"}}const yV={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Dx.white,default:Dx.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},LR={text:{primary:Dx.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Dx.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function vV(e,t,r,s){const c=s.light||s,f=s.dark||s*1.5;e[t]||(e.hasOwnProperty(r)?e[t]=e[r]:t==="light"?e.light=R5(e.main,c):t==="dark"&&(e.dark=P5(e.main,f)))}function E0e(e="light"){return e==="dark"?{main:A_[200],light:A_[50],dark:A_[400]}:{main:A_[700],light:A_[400],dark:A_[800]}}function S0e(e="light"){return e==="dark"?{main:C_[200],light:C_[50],dark:C_[400]}:{main:C_[500],light:C_[300],dark:C_[700]}}function I0e(e="light"){return e==="dark"?{main:I_[500],light:I_[300],dark:I_[700]}:{main:I_[700],light:I_[400],dark:I_[800]}}function C0e(e="light"){return e==="dark"?{main:P_[400],light:P_[300],dark:P_[700]}:{main:P_[700],light:P_[500],dark:P_[900]}}function A0e(e="light"){return e==="dark"?{main:R_[400],light:R_[300],dark:R_[700]}:{main:R_[800],light:R_[500],dark:R_[900]}}function P0e(e="light"){return e==="dark"?{main:Qv[400],light:Qv[300],dark:Qv[700]}:{main:"#ed6c02",light:Qv[500],dark:Qv[900]}}function D5(e){const ie=e,{mode:t="light",contrastThreshold:r=3,tonalOffset:s=.2}=ie,c=On(ie,["mode","contrastThreshold","tonalOffset"]),f=e.primary||E0e(t),_=e.secondary||S0e(t),x=e.error||I0e(t),a=e.info||C0e(t),I=e.success||A0e(t),D=e.warning||P0e(t);function O(te){return l0e(te,LR.text.primary)>=r?LR.text.primary:yV.text.primary}const F=({color:te,name:W,mainShade:X=500,lightShade:ee=300,darkShade:fe=700})=>{if(te=de({},te),!te.main&&te[X]&&(te.main=te[X]),!te.hasOwnProperty("main"))throw new Error(nd(11,W?` (${W})`:"",X));if(typeof te.main!="string")throw new Error(nd(12,W?` (${W})`:"",JSON.stringify(te.main)));return vV(te,"light",ee,s),vV(te,"dark",fe,s),te.contrastText||(te.contrastText=O(te.main)),te},H={dark:LR,light:yV};return na(de({common:de({},Dx),mode:t,primary:F({color:f,name:"primary"}),secondary:F({color:_,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:F({color:x,name:"error"}),warning:F({color:D,name:"warning"}),info:F({color:a,name:"info"}),success:F({color:I,name:"success"}),grey:Fge,contrastThreshold:r,getContrastText:O,augmentColor:F,tonalOffset:s},H[t]),c)}function R0e(e){const t={};return Object.entries(e).forEach(s=>{const[c,f]=s;typeof f=="object"&&(t[c]=`${f.fontStyle?`${f.fontStyle} `:""}${f.fontVariant?`${f.fontVariant} `:""}${f.fontWeight?`${f.fontWeight} `:""}${f.fontStretch?`${f.fontStretch} `:""}${f.fontSize||""}${f.lineHeight?`/${f.lineHeight} `:""}${f.fontFamily||""}`)}),t}function M0e(e,t){return de({toolbar:{minHeight:56,[e.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[e.up("sm")]:{minHeight:64}}},t)}function k0e(e){return Math.round(e*1e5)/1e5}const xV={textTransform:"uppercase"},bV='"Roboto", "Helvetica", "Arial", sans-serif';function D0e(e,t){const te=typeof t=="function"?t(e):t,{fontFamily:r=bV,fontSize:s=14,fontWeightLight:c=300,fontWeightRegular:f=400,fontWeightMedium:_=500,fontWeightBold:x=700,htmlFontSize:a=16,allVariants:I,pxToRem:D}=te,O=On(te,["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"]),F=s/14,H=D||(W=>`${W/a*F}rem`),Q=(W,X,ee,fe,ye)=>de(de(de({fontFamily:r,fontWeight:W,fontSize:H(X),lineHeight:ee},r===bV?{letterSpacing:`${k0e(fe/X)}em`}:{}),ye),I),ie={h1:Q(c,96,1.167,-1.5),h2:Q(c,60,1.2,-.5),h3:Q(f,48,1.167,0),h4:Q(f,34,1.235,.25),h5:Q(f,24,1.334,0),h6:Q(_,20,1.6,.15),subtitle1:Q(f,16,1.75,.15),subtitle2:Q(_,14,1.57,.1),body1:Q(f,16,1.5,.15),body2:Q(f,14,1.43,.15),button:Q(_,14,1.75,.4,xV),caption:Q(f,12,1.66,.4),overline:Q(f,12,2.66,1,xV),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return na(de({htmlFontSize:a,pxToRem:H,fontFamily:r,fontSize:s,fontWeightLight:c,fontWeightRegular:f,fontWeightMedium:_,fontWeightBold:x},ie),O,{clone:!1})}const O0e=.2,L0e=.14,z0e=.12;function gs(...e){return[`${e[0]}px ${e[1]}px ${e[2]}px ${e[3]}px rgba(0,0,0,${O0e})`,`${e[4]}px ${e[5]}px ${e[6]}px ${e[7]}px rgba(0,0,0,${L0e})`,`${e[8]}px ${e[9]}px ${e[10]}px ${e[11]}px rgba(0,0,0,${z0e})`].join(",")}const N0e=["none",gs(0,2,1,-1,0,1,1,0,0,1,3,0),gs(0,3,1,-2,0,2,2,0,0,1,5,0),gs(0,3,3,-2,0,3,4,0,0,1,8,0),gs(0,2,4,-1,0,4,5,0,0,1,10,0),gs(0,3,5,-1,0,5,8,0,0,1,14,0),gs(0,3,5,-1,0,6,10,0,0,1,18,0),gs(0,4,5,-2,0,7,10,1,0,2,16,1),gs(0,5,5,-3,0,8,10,1,0,3,14,2),gs(0,5,6,-3,0,9,12,1,0,3,16,2),gs(0,6,6,-3,0,10,14,1,0,4,18,3),gs(0,6,7,-4,0,11,15,1,0,4,20,3),gs(0,7,8,-4,0,12,17,2,0,5,22,4),gs(0,7,8,-4,0,13,19,2,0,5,24,4),gs(0,7,9,-4,0,14,21,2,0,5,26,4),gs(0,8,9,-5,0,15,22,2,0,6,28,5),gs(0,8,10,-5,0,16,24,2,0,6,30,5),gs(0,8,11,-5,0,17,26,2,0,6,32,5),gs(0,9,11,-5,0,18,28,2,0,7,34,6),gs(0,9,12,-6,0,19,29,2,0,7,36,6),gs(0,10,13,-6,0,20,31,3,0,8,38,7),gs(0,10,13,-6,0,21,33,3,0,8,40,7),gs(0,10,14,-6,0,22,35,3,0,8,42,7),gs(0,11,14,-7,0,23,36,3,0,9,44,8),gs(0,11,15,-7,0,24,38,3,0,9,46,8)],F0e={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},B0e={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function wV(e){return`${Math.round(e)}ms`}function j0e(e){if(!e)return 0;const t=e/36;return Math.min(Math.round((4+15*Ch(t,.25)+t/5)*10),3e3)}function U0e(e){const t=de(de({},F0e),e.easing),r=de(de({},B0e),e.duration);return _t(de({getAutoHeightDuration:j0e,create:(c=["all"],f={})=>{const D=f,{duration:_=r.standard,easing:x=t.easeInOut,delay:a=0}=D,I=On(D,["duration","easing","delay"]);return(Array.isArray(c)?c:[c]).map(O=>`${O} ${typeof _=="string"?_:wV(_)} ${x} ${typeof a=="string"?a:wV(a)}`).join(",")}},e),{easing:t,duration:r})}const V0e={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function Hk(e={},...t){const H=e,{breakpoints:r,mixins:s={},spacing:c,palette:f={},transitions:_={},typography:x={},shape:a}=H,I=On(H,["breakpoints","mixins","spacing","palette","transitions","typography","shape"]);if(e.vars)throw new Error(nd(20));const D=D5(f),O=E5(e);let F=na(O,{mixins:M0e(O.breakpoints,s),palette:D,shadows:N0e.slice(),typography:D0e(D,x),transitions:U0e(_),zIndex:de({},V0e)});return F=na(F,I),F=t.reduce((Q,ie)=>na(Q,ie),F),F.unstable_sxConfig=de(de({},wb),I==null?void 0:I.unstable_sxConfig),F.unstable_sx=function(ie){return Tb({sx:ie,theme:this})},F}function Zk(e){let t;return e<1?t=5.11916*Ch(e,2):t=4.5*Math.log(e+1)+2,Math.round(t*10)/1e3}const $0e=[...Array(25)].map((e,t)=>{if(t===0)return;const r=Zk(t);return`linear-gradient(rgba(255 255 255 / ${r}), rgba(255 255 255 / ${r}))`});function wH(e){return{inputPlaceholder:e==="dark"?.5:.42,inputUnderline:e==="dark"?.7:.42,switchTrackDisabled:e==="dark"?.2:.12,switchTrack:e==="dark"?.3:.38}}function TH(e){return e==="dark"?$0e:[]}function q0e(e){const _=e,{palette:t={mode:"light"},opacity:r,overlays:s}=_,c=On(_,["palette","opacity","overlays"]),f=D5(t);return de({palette:f,opacity:de(de({},wH(f.mode)),r),overlays:s||TH(f.mode)},c)}function G0e(e){var t;return!!e[0].match(/(cssVarPrefix|colorSchemeSelector|typography|mixins|breakpoints|direction|transitions)/)||!!e[0].match(/sxConfig$/)||e[0]==="palette"&&!!((t=e[1])!=null&&t.match(/(mode|contrastThreshold|tonalOffset)/))}const W0e=e=>[...[...Array(24)].map((t,r)=>`--${e?`${e}-`:""}overlays-${r+1}`),`--${e?`${e}-`:""}palette-AppBar-darkBg`,`--${e?`${e}-`:""}palette-AppBar-darkColor`],H0e=e=>(t,r)=>{const s=e.colorSchemeSelector;let c=s;if(s==="class"&&(c=".%s"),s==="data"&&(c="[data-%s]"),s!=null&&s.startsWith("data-")&&!s.includes("%s")&&(c=`[${s}="%s"]`),e.defaultColorScheme===t){if(t==="dark"){const f={};return W0e(e.cssVarPrefix).forEach(_=>{f[_]=r[_],delete r[_]}),c==="media"?{":root":r,"@media (prefers-color-scheme: dark)":{":root":f}}:c?{[c.replace("%s",t)]:f,[`:root, ${c.replace("%s",t)}`]:r}:{":root":de(de({},r),f)}}if(c&&c!=="media")return`:root, ${c.replace("%s",String(t))}`}else if(t){if(c==="media")return{[`@media (prefers-color-scheme: ${String(t)})`]:{":root":r}};if(c)return c.replace("%s",String(t))}return":root"};function Z0e(e){return Lu(e)||typeof e=="undefined"||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||Array.isArray(e)}function X0e(e={}){const t=de({},e);function r(s){const c=Object.entries(s);for(let f=0;f<c.length;f++){const[_,x]=c[f];!Z0e(x)||_.startsWith("unstable_")?delete s[_]:Lu(x)&&(s[_]=de({},x),r(s[_]))}}return r(t),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(t,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function K0e(e,t){t.forEach(r=>{e[r]||(e[r]={})})}function $t(e,t,r){!e[t]&&r&&(e[t]=r)}function _1(e){return!e||!e.startsWith("hsl")?e:dH(e)}function Ph(e,t){`${t}Channel`in e||(e[`${t}Channel`]=g1(_1(e[t]),`MUI: Can't create \`palette.${t}Channel\` because \`palette.${t}\` is not one of these formats: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color().
To suppress this warning, you need to explicitly provide the \`palette.${t}Channel\` as a string (in rgb format, for example "12 12 12") or undefined if you want to remove the channel token.`))}function Q0e(e){return typeof e=="number"?`${e}px`:typeof e=="string"||typeof e=="function"||Array.isArray(e)?e:"8px"}const Tu=e=>{try{return e()}catch(t){}},Y0e=(e="mui")=>v0e(e);function zR(e,t,r,s){if(!t)return;t=t===!0?{}:t;const c=s==="dark"?"dark":"light";if(!r){e[s]=q0e(_t(de({},t),{palette:de({mode:c},t==null?void 0:t.palette)}));return}const x=Hk(_t(de({},r),{palette:de({mode:c},t==null?void 0:t.palette)})),{palette:f}=x,_=On(x,["palette"]);return e[s]=_t(de({},t),{palette:f,opacity:de(de({},wH(c)),t==null?void 0:t.opacity),overlays:(t==null?void 0:t.overlays)||TH(c)}),_}function J0e(e={},...t){const he=e,{colorSchemes:r={light:!0},defaultColorScheme:s,disableCssColorScheme:c=!1,cssVarPrefix:f="mui",shouldSkipGeneratingVar:_=G0e,colorSchemeSelector:x=r.light&&r.dark?"media":void 0}=he,a=On(he,["colorSchemes","defaultColorScheme","disableCssColorScheme","cssVarPrefix","shouldSkipGeneratingVar","colorSchemeSelector"]),I=Object.keys(r)[0],D=s||(r.light&&I!=="light"?"light":I),O=Y0e(f),_e=r,{[D]:F,light:H,dark:Q}=_e,ie=On(_e,[ST(D),"light","dark"]),te=de({},ie);let W=F;if((D==="dark"&&!("dark"in r)||D==="light"&&!("light"in r))&&(W=!0),!W)throw new Error(nd(21,D));const X=zR(te,W,a,D);H&&!te.light&&zR(te,H,void 0,"light"),Q&&!te.dark&&zR(te,Q,void 0,"dark");let ee=_t(de({defaultColorScheme:D},X),{cssVarPrefix:f,colorSchemeSelector:x,getCssVar:O,colorSchemes:te,font:de(de({},R0e(X.typography)),X.font),spacing:Q0e(a.spacing)});Object.keys(ee.colorSchemes).forEach(Se=>{const J=ee.colorSchemes[Se].palette,Ie=we=>{const Lt=we.split("-"),Gt=Lt[1],qt=Lt[2];return O(we,J[Gt][qt])};if(J.mode==="light"&&($t(J.common,"background","#fff"),$t(J.common,"onBackground","#000")),J.mode==="dark"&&($t(J.common,"background","#000"),$t(J.common,"onBackground","#fff")),K0e(J,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),J.mode==="light"){$t(J.Alert,"errorColor",Vi(J.error.light,.6)),$t(J.Alert,"infoColor",Vi(J.info.light,.6)),$t(J.Alert,"successColor",Vi(J.success.light,.6)),$t(J.Alert,"warningColor",Vi(J.warning.light,.6)),$t(J.Alert,"errorFilledBg",Ie("palette-error-main")),$t(J.Alert,"infoFilledBg",Ie("palette-info-main")),$t(J.Alert,"successFilledBg",Ie("palette-success-main")),$t(J.Alert,"warningFilledBg",Ie("palette-warning-main")),$t(J.Alert,"errorFilledColor",Tu(()=>J.getContrastText(J.error.main))),$t(J.Alert,"infoFilledColor",Tu(()=>J.getContrastText(J.info.main))),$t(J.Alert,"successFilledColor",Tu(()=>J.getContrastText(J.success.main))),$t(J.Alert,"warningFilledColor",Tu(()=>J.getContrastText(J.warning.main))),$t(J.Alert,"errorStandardBg",$i(J.error.light,.9)),$t(J.Alert,"infoStandardBg",$i(J.info.light,.9)),$t(J.Alert,"successStandardBg",$i(J.success.light,.9)),$t(J.Alert,"warningStandardBg",$i(J.warning.light,.9)),$t(J.Alert,"errorIconColor",Ie("palette-error-main")),$t(J.Alert,"infoIconColor",Ie("palette-info-main")),$t(J.Alert,"successIconColor",Ie("palette-success-main")),$t(J.Alert,"warningIconColor",Ie("palette-warning-main")),$t(J.AppBar,"defaultBg",Ie("palette-grey-100")),$t(J.Avatar,"defaultBg",Ie("palette-grey-400")),$t(J.Button,"inheritContainedBg",Ie("palette-grey-300")),$t(J.Button,"inheritContainedHoverBg",Ie("palette-grey-A100")),$t(J.Chip,"defaultBorder",Ie("palette-grey-400")),$t(J.Chip,"defaultAvatarColor",Ie("palette-grey-700")),$t(J.Chip,"defaultIconColor",Ie("palette-grey-700")),$t(J.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),$t(J.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),$t(J.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),$t(J.LinearProgress,"primaryBg",$i(J.primary.main,.62)),$t(J.LinearProgress,"secondaryBg",$i(J.secondary.main,.62)),$t(J.LinearProgress,"errorBg",$i(J.error.main,.62)),$t(J.LinearProgress,"infoBg",$i(J.info.main,.62)),$t(J.LinearProgress,"successBg",$i(J.success.main,.62)),$t(J.LinearProgress,"warningBg",$i(J.warning.main,.62)),$t(J.Skeleton,"bg",`rgba(${Ie("palette-text-primaryChannel")} / 0.11)`),$t(J.Slider,"primaryTrack",$i(J.primary.main,.62)),$t(J.Slider,"secondaryTrack",$i(J.secondary.main,.62)),$t(J.Slider,"errorTrack",$i(J.error.main,.62)),$t(J.Slider,"infoTrack",$i(J.info.main,.62)),$t(J.Slider,"successTrack",$i(J.success.main,.62)),$t(J.Slider,"warningTrack",$i(J.warning.main,.62));const we=iE(J.background.default,.8);$t(J.SnackbarContent,"bg",we),$t(J.SnackbarContent,"color",Tu(()=>J.getContrastText(we))),$t(J.SpeedDialAction,"fabHoverBg",iE(J.background.paper,.15)),$t(J.StepConnector,"border",Ie("palette-grey-400")),$t(J.StepContent,"border",Ie("palette-grey-400")),$t(J.Switch,"defaultColor",Ie("palette-common-white")),$t(J.Switch,"defaultDisabledColor",Ie("palette-grey-100")),$t(J.Switch,"primaryDisabledColor",$i(J.primary.main,.62)),$t(J.Switch,"secondaryDisabledColor",$i(J.secondary.main,.62)),$t(J.Switch,"errorDisabledColor",$i(J.error.main,.62)),$t(J.Switch,"infoDisabledColor",$i(J.info.main,.62)),$t(J.Switch,"successDisabledColor",$i(J.success.main,.62)),$t(J.Switch,"warningDisabledColor",$i(J.warning.main,.62)),$t(J.TableCell,"border",$i(rE(J.divider,1),.88)),$t(J.Tooltip,"bg",rE(J.grey[700],.92))}if(J.mode==="dark"){$t(J.Alert,"errorColor",$i(J.error.light,.6)),$t(J.Alert,"infoColor",$i(J.info.light,.6)),$t(J.Alert,"successColor",$i(J.success.light,.6)),$t(J.Alert,"warningColor",$i(J.warning.light,.6)),$t(J.Alert,"errorFilledBg",Ie("palette-error-dark")),$t(J.Alert,"infoFilledBg",Ie("palette-info-dark")),$t(J.Alert,"successFilledBg",Ie("palette-success-dark")),$t(J.Alert,"warningFilledBg",Ie("palette-warning-dark")),$t(J.Alert,"errorFilledColor",Tu(()=>J.getContrastText(J.error.dark))),$t(J.Alert,"infoFilledColor",Tu(()=>J.getContrastText(J.info.dark))),$t(J.Alert,"successFilledColor",Tu(()=>J.getContrastText(J.success.dark))),$t(J.Alert,"warningFilledColor",Tu(()=>J.getContrastText(J.warning.dark))),$t(J.Alert,"errorStandardBg",Vi(J.error.light,.9)),$t(J.Alert,"infoStandardBg",Vi(J.info.light,.9)),$t(J.Alert,"successStandardBg",Vi(J.success.light,.9)),$t(J.Alert,"warningStandardBg",Vi(J.warning.light,.9)),$t(J.Alert,"errorIconColor",Ie("palette-error-main")),$t(J.Alert,"infoIconColor",Ie("palette-info-main")),$t(J.Alert,"successIconColor",Ie("palette-success-main")),$t(J.Alert,"warningIconColor",Ie("palette-warning-main")),$t(J.AppBar,"defaultBg",Ie("palette-grey-900")),$t(J.AppBar,"darkBg",Ie("palette-background-paper")),$t(J.AppBar,"darkColor",Ie("palette-text-primary")),$t(J.Avatar,"defaultBg",Ie("palette-grey-600")),$t(J.Button,"inheritContainedBg",Ie("palette-grey-800")),$t(J.Button,"inheritContainedHoverBg",Ie("palette-grey-700")),$t(J.Chip,"defaultBorder",Ie("palette-grey-700")),$t(J.Chip,"defaultAvatarColor",Ie("palette-grey-300")),$t(J.Chip,"defaultIconColor",Ie("palette-grey-300")),$t(J.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),$t(J.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),$t(J.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),$t(J.LinearProgress,"primaryBg",Vi(J.primary.main,.5)),$t(J.LinearProgress,"secondaryBg",Vi(J.secondary.main,.5)),$t(J.LinearProgress,"errorBg",Vi(J.error.main,.5)),$t(J.LinearProgress,"infoBg",Vi(J.info.main,.5)),$t(J.LinearProgress,"successBg",Vi(J.success.main,.5)),$t(J.LinearProgress,"warningBg",Vi(J.warning.main,.5)),$t(J.Skeleton,"bg",`rgba(${Ie("palette-text-primaryChannel")} / 0.13)`),$t(J.Slider,"primaryTrack",Vi(J.primary.main,.5)),$t(J.Slider,"secondaryTrack",Vi(J.secondary.main,.5)),$t(J.Slider,"errorTrack",Vi(J.error.main,.5)),$t(J.Slider,"infoTrack",Vi(J.info.main,.5)),$t(J.Slider,"successTrack",Vi(J.success.main,.5)),$t(J.Slider,"warningTrack",Vi(J.warning.main,.5));const we=iE(J.background.default,.98);$t(J.SnackbarContent,"bg",we),$t(J.SnackbarContent,"color",Tu(()=>J.getContrastText(we))),$t(J.SpeedDialAction,"fabHoverBg",iE(J.background.paper,.15)),$t(J.StepConnector,"border",Ie("palette-grey-600")),$t(J.StepContent,"border",Ie("palette-grey-600")),$t(J.Switch,"defaultColor",Ie("palette-grey-300")),$t(J.Switch,"defaultDisabledColor",Ie("palette-grey-600")),$t(J.Switch,"primaryDisabledColor",Vi(J.primary.main,.55)),$t(J.Switch,"secondaryDisabledColor",Vi(J.secondary.main,.55)),$t(J.Switch,"errorDisabledColor",Vi(J.error.main,.55)),$t(J.Switch,"infoDisabledColor",Vi(J.info.main,.55)),$t(J.Switch,"successDisabledColor",Vi(J.success.main,.55)),$t(J.Switch,"warningDisabledColor",Vi(J.warning.main,.55)),$t(J.TableCell,"border",Vi(rE(J.divider,1),.68)),$t(J.Tooltip,"bg",rE(J.grey[700],.92))}Ph(J.background,"default"),Ph(J.background,"paper"),Ph(J.common,"background"),Ph(J.common,"onBackground"),Ph(J,"divider"),Object.keys(J).forEach(we=>{const Lt=J[we];Lt&&typeof Lt=="object"&&(Lt.main&&$t(J[we],"mainChannel",g1(_1(Lt.main))),Lt.light&&$t(J[we],"lightChannel",g1(_1(Lt.light))),Lt.dark&&$t(J[we],"darkChannel",g1(_1(Lt.dark))),Lt.contrastText&&$t(J[we],"contrastTextChannel",g1(_1(Lt.contrastText))),we==="text"&&(Ph(J[we],"primary"),Ph(J[we],"secondary")),we==="action"&&(Lt.active&&Ph(J[we],"active"),Lt.selected&&Ph(J[we],"selected")))})}),ee=t.reduce((Se,J)=>na(Se,J),ee);const fe={prefix:f,disableCssColorScheme:c,shouldSkipGeneratingVar:_,getSelector:H0e(ee)},{vars:ye,generateThemeVars:Ee,generateStyleSheets:re}=w0e(ee,fe);return ee.vars=ye,Object.entries(ee.colorSchemes[ee.defaultColorScheme]).forEach(([Se,J])=>{ee[Se]=J}),ee.generateThemeVars=Ee,ee.generateStyleSheets=re,ee.generateSpacing=function(){return sH(a.spacing,w5(this))},ee.getColorSchemeSelector=T0e(x),ee.spacing=ee.generateSpacing(),ee.shouldSkipGeneratingVar=_,ee.unstable_sxConfig=de(de({},wb),a==null?void 0:a.unstable_sxConfig),ee.unstable_sx=function(J){return Tb({sx:J,theme:this})},ee.toRuntimeSource=X0e,ee}function TV(e,t,r){e.colorSchemes&&r&&(e.colorSchemes[t]=_t(de({},r!==!0&&r),{palette:D5(_t(de({},r===!0?{}:r.palette),{mode:t}))}))}function eve(e={},...t){const D=e,{palette:r,cssVariables:s=!1,colorSchemes:c=r?void 0:{light:!0},defaultColorScheme:f=r==null?void 0:r.mode}=D,_=On(D,["palette","cssVariables","colorSchemes","defaultColorScheme"]),x=f||"light",a=c==null?void 0:c[x],I=de(de({},c),r?{[x]:_t(de({},typeof a!="boolean"&&a),{palette:r})}:void 0);if(s===!1){if(!("colorSchemes"in e))return Hk(e,...t);let O=r;"palette"in e||I[x]&&(I[x]!==!0?O=I[x].palette:x==="dark"&&(O={mode:"dark"}));const F=Hk(_t(de({},e),{palette:O}),...t);return F.defaultColorScheme=x,F.colorSchemes=I,F.palette.mode==="light"&&(F.colorSchemes.light=_t(de({},I.light!==!0&&I.light),{palette:F.palette}),TV(F,"dark",I.dark)),F.palette.mode==="dark"&&(F.colorSchemes.dark=_t(de({},I.dark!==!0&&I.dark),{palette:F.palette}),TV(F,"light",I.light)),F}return!r&&!("light"in I)&&x==="light"&&(I.light=!0),J0e(de(_t(de({},_),{colorSchemes:I,defaultColorScheme:x}),typeof s!="boolean"&&s),...t)}const JC=eve();function O5(){const e=S5(JC);return e[MC]||e}function tve({props:e,name:t}){return n0e({props:e,name:t,defaultTheme:JC,themeId:MC})}function EH(e){return e!=="ownerState"&&e!=="theme"&&e!=="sx"&&e!=="as"}const Ka=e=>EH(e)&&e!=="classes",nr=cH({themeId:MC,defaultTheme:JC,rootShouldForwardProp:Ka});function nve(e){return N.jsx($ye,_t(de({},e),{defaultTheme:JC,themeId:MC}))}function rve(e){return function(r){return N.jsx(nve,{styles:typeof e=="function"?s=>e(de({theme:s},r)):e})}}function ive(){return Gye}const EV={theme:void 0};function us(e){let t,r;return s=>{let c=t;return(c===void 0||s.theme!==r)&&(EV.theme=s.theme,c=e(EV),t=c,r=s.theme),c}}function hs(e){return y0e(e)}function sve(e){return Di("MuiSvgIcon",e)}Oi("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const ove=e=>{const{color:t,fontSize:r,classes:s}=e,c={root:["root",t!=="inherit"&&`color${tr(t)}`,`fontSize${tr(r)}`]};return Ni(c,sve,s)},ave=nr("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.color!=="inherit"&&t[`color${tr(r.color)}`],t[`fontSize${tr(r.fontSize)}`]]}})(us(({theme:e})=>{var t,r,s,c,f,_,x,a,I,D,O,F,H,Q,ie,te,W,X;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:(f=(t=e.transitions)==null?void 0:t.create)==null?void 0:f.call(t,"fill",{duration:(c=(s=((r=e.vars)!=null?r:e).transitions)==null?void 0:s.duration)==null?void 0:c.shorter}),variants:[{props:ee=>!ee.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:((x=(_=e.typography)==null?void 0:_.pxToRem)==null?void 0:x.call(_,20))||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:((I=(a=e.typography)==null?void 0:a.pxToRem)==null?void 0:I.call(a,24))||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:((O=(D=e.typography)==null?void 0:D.pxToRem)==null?void 0:O.call(D,35))||"2.1875rem"}},...Object.entries(((F=e.vars)!=null?F:e).palette).filter(([,ee])=>ee&&ee.main).map(([ee])=>{var fe,ye,Ee;return{props:{color:ee},style:{color:(Ee=(ye=((fe=e.vars)!=null?fe:e).palette)==null?void 0:ye[ee])==null?void 0:Ee.main}}}),{props:{color:"action"},style:{color:(ie=(Q=((H=e.vars)!=null?H:e).palette)==null?void 0:Q.action)==null?void 0:ie.active}},{props:{color:"disabled"},style:{color:(X=(W=((te=e.vars)!=null?te:e).palette)==null?void 0:W.action)==null?void 0:X.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}})),YS=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiSvgIcon"}),X=s,{children:c,className:f,color:_="inherit",component:x="svg",fontSize:a="medium",htmlColor:I,inheritViewBox:D=!1,titleAccess:O,viewBox:F="0 0 24 24"}=X,H=On(X,["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"]),Q=G.isValidElement(c)&&c.type==="svg",ie=_t(de({},s),{color:_,component:x,fontSize:a,instanceFontSize:t.fontSize,inheritViewBox:D,viewBox:F,hasSvgAsChild:Q}),te={};D||(te.viewBox=F);const W=ove(ie);return N.jsxs(ave,_t(de(de(de({as:x,className:Or(W.root,f),focusable:"false",color:I,"aria-hidden":O?void 0:!0,role:O?"img":void 0,ref:r},te),H),Q&&c.props),{ownerState:ie,children:[Q?c.props.children:c,O?N.jsx("title",{children:O}):null]}))});YS&&(YS.muiName="SvgIcon");function cd(e,t){function r(s,c){return N.jsx(YS,_t(de({"data-testid":`${t}Icon`,ref:c},s),{children:e}))}return r.muiName=YS.muiName,G.memo(G.forwardRef(r))}function SH(e,t){if(e==null)return{};var r={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.includes(s))continue;r[s]=e[s]}return r}function Xk(e,t){return Xk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Xk(e,t)}function IH(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Xk(e,t)}const SV={disabled:!1},JS=Xr.createContext(null);var lve=function(t){return t.scrollTop},y1="unmounted",cm="exited",um="entering",F_="entered",Kk="exiting",Yu=function(e){IH(t,e);function t(s,c){var f;f=e.call(this,s,c)||this;var _=c,x=_&&!_.isMounting?s.enter:s.appear,a;return f.appearStatus=null,s.in?x?(a=cm,f.appearStatus=um):a=F_:s.unmountOnExit||s.mountOnEnter?a=y1:a=cm,f.state={status:a},f.nextCallback=null,f}t.getDerivedStateFromProps=function(c,f){var _=c.in;return _&&f.status===y1?{status:cm}:null};var r=t.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(c){var f=null;if(c!==this.props){var _=this.state.status;this.props.in?_!==um&&_!==F_&&(f=um):(_===um||_===F_)&&(f=Kk)}this.updateStatus(!1,f)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var c=this.props.timeout,f,_,x;return f=_=x=c,c!=null&&typeof c!="number"&&(f=c.exit,_=c.enter,x=c.appear!==void 0?c.appear:_),{exit:f,enter:_,appear:x}},r.updateStatus=function(c,f){if(c===void 0&&(c=!1),f!==null)if(this.cancelNextCallback(),f===um){if(this.props.unmountOnExit||this.props.mountOnEnter){var _=this.props.nodeRef?this.props.nodeRef.current:$T.findDOMNode(this);_&&lve(_)}this.performEnter(c)}else this.performExit();else this.props.unmountOnExit&&this.state.status===cm&&this.setState({status:y1})},r.performEnter=function(c){var f=this,_=this.props.enter,x=this.context?this.context.isMounting:c,a=this.props.nodeRef?[x]:[$T.findDOMNode(this),x],I=a[0],D=a[1],O=this.getTimeouts(),F=x?O.appear:O.enter;if(!c&&!_||SV.disabled){this.safeSetState({status:F_},function(){f.props.onEntered(I)});return}this.props.onEnter(I,D),this.safeSetState({status:um},function(){f.props.onEntering(I,D),f.onTransitionEnd(F,function(){f.safeSetState({status:F_},function(){f.props.onEntered(I,D)})})})},r.performExit=function(){var c=this,f=this.props.exit,_=this.getTimeouts(),x=this.props.nodeRef?void 0:$T.findDOMNode(this);if(!f||SV.disabled){this.safeSetState({status:cm},function(){c.props.onExited(x)});return}this.props.onExit(x),this.safeSetState({status:Kk},function(){c.props.onExiting(x),c.onTransitionEnd(_.exit,function(){c.safeSetState({status:cm},function(){c.props.onExited(x)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(c,f){f=this.setNextCallback(f),this.setState(c,f)},r.setNextCallback=function(c){var f=this,_=!0;return this.nextCallback=function(x){_&&(_=!1,f.nextCallback=null,c(x))},this.nextCallback.cancel=function(){_=!1},this.nextCallback},r.onTransitionEnd=function(c,f){this.setNextCallback(f);var _=this.props.nodeRef?this.props.nodeRef.current:$T.findDOMNode(this),x=c==null&&!this.props.addEndListener;if(!_||x){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[_,this.nextCallback],I=a[0],D=a[1];this.props.addEndListener(I,D)}c!=null&&setTimeout(this.nextCallback,c)},r.render=function(){var c=this.state.status;if(c===y1)return null;var f=this.props,_=f.children;f.in,f.mountOnEnter,f.unmountOnExit,f.appear,f.enter,f.exit,f.timeout,f.addEndListener,f.onEnter,f.onEntering,f.onEntered,f.onExit,f.onExiting,f.onExited,f.nodeRef;var x=SH(f,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Xr.createElement(JS.Provider,{value:null},typeof _=="function"?_(c,x):Xr.cloneElement(Xr.Children.only(_),x))},t}(Xr.Component);Yu.contextType=JS;Yu.propTypes={};function M_(){}Yu.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:M_,onEntering:M_,onEntered:M_,onExit:M_,onExiting:M_,onExited:M_};Yu.UNMOUNTED=y1;Yu.EXITED=cm;Yu.ENTERING=um;Yu.ENTERED=F_;Yu.EXITING=Kk;function cve(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L5(e,t){var r=function(f){return t&&G.isValidElement(f)?t(f):f},s=Object.create(null);return e&&G.Children.map(e,function(c){return c}).forEach(function(c){s[c.key]=r(c)}),s}function uve(e,t){e=e||{},t=t||{};function r(D){return D in t?t[D]:e[D]}var s=Object.create(null),c=[];for(var f in e)f in t?c.length&&(s[f]=c,c=[]):c.push(f);var _,x={};for(var a in t){if(s[a])for(_=0;_<s[a].length;_++){var I=s[a][_];x[s[a][_]]=r(I)}x[a]=r(a)}for(_=0;_<c.length;_++)x[c[_]]=r(c[_]);return x}function wm(e,t,r){return r[t]!=null?r[t]:e.props[t]}function hve(e,t){return L5(e.children,function(r){return G.cloneElement(r,{onExited:t.bind(null,r),in:!0,appear:wm(r,"appear",e),enter:wm(r,"enter",e),exit:wm(r,"exit",e)})})}function dve(e,t,r){var s=L5(e.children),c=uve(t,s);return Object.keys(c).forEach(function(f){var _=c[f];if(G.isValidElement(_)){var x=f in t,a=f in s,I=t[f],D=G.isValidElement(I)&&!I.props.in;a&&(!x||D)?c[f]=G.cloneElement(_,{onExited:r.bind(null,_),in:!0,exit:wm(_,"exit",e),enter:wm(_,"enter",e)}):!a&&x&&!D?c[f]=G.cloneElement(_,{in:!1}):a&&x&&G.isValidElement(I)&&(c[f]=G.cloneElement(_,{onExited:r.bind(null,_),in:I.props.in,exit:wm(_,"exit",e),enter:wm(_,"enter",e)}))}}),c}var fve=Object.values||function(e){return Object.keys(e).map(function(t){return e[t]})},pve={component:"div",childFactory:function(t){return t}},z5=function(e){IH(t,e);function t(s,c){var f;f=e.call(this,s,c)||this;var _=f.handleExited.bind(cve(f));return f.state={contextValue:{isMounting:!0},handleExited:_,firstRender:!0},f}var r=t.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(c,f){var _=f.children,x=f.handleExited,a=f.firstRender;return{children:a?hve(c,x):dve(c,_,x),firstRender:!1}},r.handleExited=function(c,f){var _=L5(this.props.children);c.key in _||(c.props.onExited&&c.props.onExited(f),this.mounted&&this.setState(function(x){var a=HS({},x.children);return delete a[c.key],{children:a}}))},r.render=function(){var c=this.props,f=c.component,_=c.childFactory,x=SH(c,["component","childFactory"]),a=this.state.contextValue,I=fve(this.state.children).map(_);return delete x.appear,delete x.enter,delete x.exit,f===null?Xr.createElement(JS.Provider,{value:a},I):Xr.createElement(JS.Provider,{value:a},Xr.createElement(f,x,I))},t}(Xr.Component);z5.propTypes={};z5.defaultProps=pve;const CH=e=>e.scrollTop;function eI(e,t){var f,_;const{timeout:r,easing:s,style:c={}}=e;return{duration:(f=c.transitionDuration)!=null?f:typeof r=="number"?r:r[t.mode]||0,easing:(_=c.transitionTimingFunction)!=null?_:typeof s=="object"?s[t.mode]:s,delay:c.transitionDelay}}function mve(e){return Di("MuiPaper",e)}Oi("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const gve=e=>{const{square:t,elevation:r,variant:s,classes:c}=e,f={root:["root",s,!t&&"rounded",s==="elevation"&&`elevation${r}`]};return Ni(f,mve,c)},_ve=nr("div",{name:"MuiPaper",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],!r.square&&t.rounded,r.variant==="elevation"&&t[`elevation${r.elevation}`]]}})(us(({theme:e})=>({backgroundColor:(e.vars||e).palette.background.paper,color:(e.vars||e).palette.text.primary,transition:e.transitions.create("box-shadow"),variants:[{props:({ownerState:t})=>!t.square,style:{borderRadius:e.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(e.vars||e).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),yve=G.forwardRef(function(t,r){var Q;const s=hs({props:t,name:"MuiPaper"}),c=O5(),H=s,{className:f,component:_="div",elevation:x=1,square:a=!1,variant:I="elevation"}=H,D=On(H,["className","component","elevation","square","variant"]),O=_t(de({},s),{component:_,elevation:x,square:a,variant:I}),F=gve(O);return N.jsx(_ve,_t(de({as:_,ownerState:O,className:Or(F.root,f),ref:r},D),{style:de(de({},I==="elevation"&&de(de({"--Paper-shadow":(c.vars||c).shadows[x]},c.vars&&{"--Paper-overlay":(Q=c.vars.overlays)==null?void 0:Q[x]}),!c.vars&&c.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${Hl("#fff",Zk(x))}, ${Hl("#fff",Zk(x))})`})),D.style)}))});function Zl(e,t){const re=t,{className:r,elementType:s,ownerState:c,externalForwardedProps:f,getSlotOwnerState:_,internalForwardedProps:x}=re,a=On(re,["className","elementType","ownerState","externalForwardedProps","getSlotOwnerState","internalForwardedProps"]),he=f,{component:I,slots:D={[e]:void 0},slotProps:O={[e]:void 0}}=he,F=On(he,["component","slots","slotProps"]),H=D[e]||s,Q=bH(O[e],c),_e=xH(_t(de({className:r},a),{externalForwardedProps:e==="root"?F:void 0,externalSlotProps:Q})),{props:Se}=_e,J=Se,{component:ie}=J,te=On(J,["component"]),{internalRef:W}=_e,X=Bo(W,Q==null?void 0:Q.ref,t.ref),ee=_?_(te):{},fe=de(de({},c),ee),ye=e==="root"?ie||I:ie,Ee=yH(H,_t(de(de(de(de({},e==="root"&&!I&&!D[e]&&x),e!=="root"&&!D[e]&&x),te),ye&&{as:ye}),{ref:X}),fe);return Object.keys(ee).forEach(Ie=>{delete Ee[Ie]}),[H,Ee]}class tI{constructor(){Bv(this,"mountEffect",()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())});this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}static create(){return new tI}static use(){const t=pH(tI.create).current,[r,s]=G.useState(!1);return t.shouldMount=r,t.setShouldMount=s,G.useEffect(t.mountEffect,[r]),t}mount(){return this.mounted||(this.mounted=xve(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}start(...t){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.start(...t)})}stop(...t){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.stop(...t)})}pulsate(...t){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.pulsate(...t)})}}function vve(){return tI.use()}function xve(){let e,t;const r=new Promise((s,c)=>{e=s,t=c});return r.resolve=e,r.reject=t,r}function bve(e){const{className:t,classes:r,pulsate:s=!1,rippleX:c,rippleY:f,rippleSize:_,in:x,onExited:a,timeout:I}=e,[D,O]=G.useState(!1),F=Or(t,r.ripple,r.rippleVisible,s&&r.ripplePulsate),H={width:_,height:_,top:-(_/2)+f,left:-(_/2)+c},Q=Or(r.child,D&&r.childLeaving,s&&r.childPulsate);return!x&&!D&&O(!0),G.useEffect(()=>{if(!x&&a!=null){const ie=setTimeout(a,I);return()=>{clearTimeout(ie)}}},[a,x,I]),N.jsx("span",{className:F,style:H,children:N.jsx("span",{className:Q})})}const Vl=Oi("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Qk=550,wve=80,Tve=v5`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,Eve=v5`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,Sve=v5`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,Ive=nr("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),Cve=nr(bve,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${Vl.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${Tve};
    animation-duration: ${Qk}ms;
    animation-timing-function: ${({theme:e})=>e.transitions.easing.easeInOut};
  }

  &.${Vl.ripplePulsate} {
    animation-duration: ${({theme:e})=>e.transitions.duration.shorter}ms;
  }

  & .${Vl.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${Vl.childLeaving} {
    opacity: 0;
    animation-name: ${Eve};
    animation-duration: ${Qk}ms;
    animation-timing-function: ${({theme:e})=>e.transitions.easing.easeInOut};
  }

  & .${Vl.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${Sve};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:e})=>e.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,Ave=G.forwardRef(function(t,r){const fe=hs({props:t,name:"MuiTouchRipple"}),{center:c=!1,classes:f={},className:_}=fe,x=On(fe,["center","classes","className"]),[a,I]=G.useState([]),D=G.useRef(0),O=G.useRef(null);G.useEffect(()=>{O.current&&(O.current(),O.current=null)},[a]);const F=G.useRef(!1),H=mH(),Q=G.useRef(null),ie=G.useRef(null),te=G.useCallback(ye=>{const{pulsate:Ee,rippleX:re,rippleY:he,rippleSize:_e,cb:Se}=ye;I(J=>[...J,N.jsx(Cve,{classes:{ripple:Or(f.ripple,Vl.ripple),rippleVisible:Or(f.rippleVisible,Vl.rippleVisible),ripplePulsate:Or(f.ripplePulsate,Vl.ripplePulsate),child:Or(f.child,Vl.child),childLeaving:Or(f.childLeaving,Vl.childLeaving),childPulsate:Or(f.childPulsate,Vl.childPulsate)},timeout:Qk,pulsate:Ee,rippleX:re,rippleY:he,rippleSize:_e},D.current)]),D.current+=1,O.current=Se},[f]),W=G.useCallback((ye={},Ee={},re=()=>{})=>{const{pulsate:he=!1,center:_e=c||Ee.pulsate,fakeElement:Se=!1}=Ee;if((ye==null?void 0:ye.type)==="mousedown"&&F.current){F.current=!1;return}(ye==null?void 0:ye.type)==="touchstart"&&(F.current=!0);const J=Se?null:ie.current,Ie=J?J.getBoundingClientRect():{width:0,height:0,left:0,top:0};let we,Lt,Gt;if(_e||ye===void 0||ye.clientX===0&&ye.clientY===0||!ye.clientX&&!ye.touches)we=Math.round(Ie.width/2),Lt=Math.round(Ie.height/2);else{const{clientX:qt,clientY:It}=ye.touches&&ye.touches.length>0?ye.touches[0]:ye;we=Math.round(qt-Ie.left),Lt=Math.round(It-Ie.top)}if(_e)Gt=Math.sqrt((2*Ch(Ie.width,2)+Ch(Ie.height,2))/3),Gt%2===0&&(Gt+=1);else{const qt=Math.max(Math.abs((J?J.clientWidth:0)-we),we)*2+2,It=Math.max(Math.abs((J?J.clientHeight:0)-Lt),Lt)*2+2;Gt=Math.sqrt(Ch(qt,2)+Ch(It,2))}ye!=null&&ye.touches?Q.current===null&&(Q.current=()=>{te({pulsate:he,rippleX:we,rippleY:Lt,rippleSize:Gt,cb:re})},H.start(wve,()=>{Q.current&&(Q.current(),Q.current=null)})):te({pulsate:he,rippleX:we,rippleY:Lt,rippleSize:Gt,cb:re})},[c,te,H]),X=G.useCallback(()=>{W({},{pulsate:!0})},[W]),ee=G.useCallback((ye,Ee)=>{if(H.clear(),(ye==null?void 0:ye.type)==="touchend"&&Q.current){Q.current(),Q.current=null,H.start(0,()=>{ee(ye,Ee)});return}Q.current=null,I(re=>re.length>0?re.slice(1):re),O.current=Ee},[H]);return G.useImperativeHandle(r,()=>({pulsate:X,start:W,stop:ee}),[X,W,ee]),N.jsx(Ive,_t(de({className:Or(Vl.root,f.root,_),ref:ie},x),{children:N.jsx(z5,{component:null,exit:!0,children:a})}))});function Pve(e){return Di("MuiButtonBase",e)}const Rve=Oi("MuiButtonBase",["root","disabled","focusVisible"]),Mve=e=>{const{disabled:t,focusVisible:r,focusVisibleClassName:s,classes:c}=e,_=Ni({root:["root",t&&"disabled",r&&"focusVisible"]},Pve,c);return r&&s&&(_.root+=` ${s}`),_},kve=nr("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${Rve.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),N5=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiButtonBase"}),pt=s,{action:c,centerRipple:f=!1,children:_,className:x,component:a="button",disabled:I=!1,disableRipple:D=!1,disableTouchRipple:O=!1,focusRipple:F=!1,focusVisibleClassName:H,LinkComponent:Q="a",onBlur:ie,onClick:te,onContextMenu:W,onDragLeave:X,onFocus:ee,onFocusVisible:fe,onKeyDown:ye,onKeyUp:Ee,onMouseDown:re,onMouseLeave:he,onMouseUp:_e,onTouchEnd:Se,onTouchMove:J,onTouchStart:Ie,tabIndex:we=0,TouchRippleProps:Lt,touchRippleRef:Gt,type:qt}=pt,It=On(pt,["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"]),ct=G.useRef(null),Ut=vve(),Kt=Bo(Ut.ref,Gt),[at,At]=G.useState(!1);I&&at&&At(!1),G.useImperativeHandle(c,()=>({focusVisible:()=>{At(!0),ct.current.focus()}}),[]);const Et=Ut.shouldMount&&!D&&!I;G.useEffect(()=>{at&&F&&!D&&Ut.pulsate()},[D,F,at,Ut]);function Jt(dt,sn,Wt=O){return ey(pn=>(sn&&sn(pn),Wt||Ut[dt](pn),!0))}const Bt=Jt("start",re),Pn=Jt("stop",W),$n=Jt("stop",X),Qn=Jt("stop",_e),Xt=Jt("stop",dt=>{at&&dt.preventDefault(),he&&he(dt)}),mr=Jt("start",Ie),An=Jt("stop",Se),cr=Jt("stop",J),zr=Jt("stop",dt=>{mV(dt.target)||At(!1),ie&&ie(dt)},!1),qn=ey(dt=>{ct.current||(ct.current=dt.currentTarget),mV(dt.target)&&(At(!0),fe&&fe(dt)),ee&&ee(dt)}),Mr=()=>{const dt=ct.current;return a&&a!=="button"&&!(dt.tagName==="A"&&dt.href)},Vr=ey(dt=>{F&&!dt.repeat&&at&&dt.key===" "&&Ut.stop(dt,()=>{Ut.start(dt)}),dt.target===dt.currentTarget&&Mr()&&dt.key===" "&&dt.preventDefault(),ye&&ye(dt),dt.target===dt.currentTarget&&Mr()&&dt.key==="Enter"&&!I&&(dt.preventDefault(),te&&te(dt))}),kn=ey(dt=>{F&&dt.key===" "&&at&&!dt.defaultPrevented&&Ut.stop(dt,()=>{Ut.pulsate(dt)}),Ee&&Ee(dt),te&&dt.target===dt.currentTarget&&Mr()&&dt.key===" "&&!dt.defaultPrevented&&te(dt)});let zn=a;zn==="button"&&(It.href||It.to)&&(zn=Q);const Ue={};zn==="button"?(Ue.type=qt===void 0?"button":qt,Ue.disabled=I):(!It.href&&!It.to&&(Ue.role="button"),I&&(Ue["aria-disabled"]=I));const Ye=Bo(r,ct),gt=_t(de({},s),{centerRipple:f,component:a,disabled:I,disableRipple:D,disableTouchRipple:O,focusRipple:F,tabIndex:we,focusVisible:at}),Qe=Mve(gt);return N.jsxs(kve,_t(de(de({as:zn,className:Or(Qe.root,x),ownerState:gt,onBlur:zr,onClick:te,onContextMenu:Pn,onFocus:qn,onKeyDown:Vr,onKeyUp:kn,onMouseDown:Bt,onMouseLeave:Xt,onMouseUp:Qn,onDragLeave:$n,onTouchEnd:An,onTouchMove:cr,onTouchStart:mr,ref:Ye,tabIndex:I?-1:we,type:qt},Ue),It),{children:[_,Et?N.jsx(Ave,de({ref:Kt,center:f},Lt)):null]}))});function Dve(e){return Di("MuiIconButton",e)}const Ove=Oi("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),Lve=e=>{const{classes:t,disabled:r,color:s,edge:c,size:f}=e,_={root:["root",r&&"disabled",s!=="default"&&`color${tr(s)}`,c&&`edge${tr(c)}`,`size${tr(f)}`]};return Ni(_,Dve,t)},zve=nr(N5,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.color!=="default"&&t[`color${tr(r.color)}`],r.edge&&t[`edge${tr(r.edge)}`],t[`size${tr(r.size)}`]]}})(us(({theme:e})=>({textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(e.vars||e).palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),variants:[{props:{disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:Hl(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),us(({theme:e})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}})),...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${(e.vars||e).palette[t].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:Hl((e.vars||e).palette[t].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}})),{props:{size:"small"},style:{padding:5,fontSize:e.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:e.typography.pxToRem(28)}}],[`&.${Ove.disabled}`]:{backgroundColor:"transparent",color:(e.vars||e).palette.action.disabled}}))),Tm=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiIconButton"}),ie=s,{edge:c=!1,children:f,className:_,color:x="default",disabled:a=!1,disableFocusRipple:I=!1,disableRipple:D=!1,size:O="medium"}=ie,F=On(ie,["edge","children","className","color","disabled","disableFocusRipple","disableRipple","size"]),H=_t(de({},s),{edge:c,color:x,disabled:a,disableFocusRipple:I,disableRipple:D,size:O}),Q=Lve(H);return N.jsx(zve,_t(de({className:Or(Q.root,_),centerRipple:!0,focusRipple:!I,disabled:a,disableRipple:D,ref:r},F),{ownerState:H,children:f}))});function Nve(e){return Di("MuiTypography",e)}Oi("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const Fve={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},Bve=ive(),jve=e=>{const{align:t,gutterBottom:r,noWrap:s,paragraph:c,variant:f,classes:_}=e,x={root:["root",f,e.align!=="inherit"&&`align${tr(t)}`,r&&"gutterBottom",s&&"noWrap",c&&"paragraph"]};return Ni(x,Nve,_)},Uve=nr("span",{name:"MuiTypography",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.variant&&t[r.variant],r.align!=="inherit"&&t[`align${tr(r.align)}`],r.noWrap&&t.noWrap,r.gutterBottom&&t.gutterBottom,r.paragraph&&t.paragraph]}})(us(({theme:e})=>{var t;return{margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(e.typography).filter(([r,s])=>r!=="inherit"&&s&&typeof s=="object").map(([r,s])=>({props:{variant:r},style:s})),...Object.entries(e.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{color:(e.vars||e).palette[r].main}})),...Object.entries(((t=e.palette)==null?void 0:t.text)||{}).filter(([,r])=>typeof r=="string").map(([r])=>({props:{color:`text${tr(r)}`},style:{color:(e.vars||e).palette.text[r]}})),{props:({ownerState:r})=>r.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:r})=>r.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:r})=>r.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:r})=>r.paragraph,style:{marginBottom:16}}]}})),IV={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},CV=G.forwardRef(function(t,r){const ee=hs({props:t,name:"MuiTypography"}),{color:s}=ee,c=On(ee,["color"]),f=!Fve[s],_=Bve(de(de({},c),f&&{color:s})),fe=_,{align:x="inherit",className:a,component:I,gutterBottom:D=!1,noWrap:O=!1,paragraph:F=!1,variant:H="body1",variantMapping:Q=IV}=fe,ie=On(fe,["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"]),te=_t(de({},_),{align:x,color:s,className:a,component:I,gutterBottom:D,noWrap:O,paragraph:F,variant:H,variantMapping:Q}),W=I||(F?"p":Q[H]||IV[H])||"span",X=jve(te);return N.jsx(Uve,_t(de({as:W,ref:r,className:Or(X.root,a)},ie),{ownerState:te,style:de(de({},x!=="inherit"&&{"--Typography-textAlign":x}),ie.style)}))});function Vve(e){return typeof e=="function"?e():e}const $ve=G.forwardRef(function(t,r){const{children:s,container:c,disablePortal:f=!1}=t,[_,x]=G.useState(null),a=Bo(Eb(s),r);if(qf(()=>{f||x(Vve(c)||document.body)},[c,f]),qf(()=>{if(_&&!f)return Wk(r,_),()=>{Wk(r,null)}},[r,_,f]),f){if(G.isValidElement(s)){const I={ref:a};return G.cloneElement(s,I)}return N.jsx(G.Fragment,{children:s})}return N.jsx(G.Fragment,{children:_&&zI.createPortal(s,_)})});function sE(e){return parseInt(e,10)||0}const qve={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function Gve(e){return e==null||Object.keys(e).length===0||e.outerHeightStyle===0&&!e.overflowing}const Wve=G.forwardRef(function(t,r){const W=t,{onChange:s,maxRows:c,minRows:f=1,style:_,value:x}=W,a=On(W,["onChange","maxRows","minRows","style","value"]),{current:I}=G.useRef(x!=null),D=G.useRef(null),O=Bo(r,D),F=G.useRef(null),H=G.useRef(null),Q=G.useCallback(()=>{const X=D.current,fe=Xm(X).getComputedStyle(X);if(fe.width==="0px")return{outerHeightStyle:0,overflowing:!1};const ye=H.current;ye.style.width=fe.width,ye.value=X.value||t.placeholder||"x",ye.value.slice(-1)===`
`&&(ye.value+=" ");const Ee=fe.boxSizing,re=sE(fe.paddingBottom)+sE(fe.paddingTop),he=sE(fe.borderBottomWidth)+sE(fe.borderTopWidth),_e=ye.scrollHeight;ye.value="x";const Se=ye.scrollHeight;let J=_e;f&&(J=Math.max(Number(f)*Se,J)),c&&(J=Math.min(Number(c)*Se,J)),J=Math.max(J,Se);const Ie=J+(Ee==="border-box"?re+he:0),we=Math.abs(J-_e)<=1;return{outerHeightStyle:Ie,overflowing:we}},[c,f,t.placeholder]),ie=G.useCallback(()=>{const X=Q();if(Gve(X))return;const ee=X.outerHeightStyle,fe=D.current;F.current!==ee&&(F.current=ee,fe.style.height=`${ee}px`),fe.style.overflow=X.overflowing?"hidden":""},[Q]);qf(()=>{const X=()=>{ie()};let ee;const fe=fH(X),ye=D.current,Ee=Xm(ye);Ee.addEventListener("resize",fe);let re;return typeof ResizeObserver!="undefined"&&(re=new ResizeObserver(X),re.observe(ye)),()=>{fe.clear(),cancelAnimationFrame(ee),Ee.removeEventListener("resize",fe),re&&re.disconnect()}},[Q,ie]),qf(()=>{ie()});const te=X=>{I||ie(),s&&s(X)};return N.jsxs(G.Fragment,{children:[N.jsx("textarea",de({value:x,onChange:te,ref:O,rows:f,style:_},a)),N.jsx("textarea",{"aria-hidden":!0,className:t.className,readOnly:!0,ref:H,tabIndex:-1,style:_t(de(de({},qve.shadow),_),{paddingTop:0,paddingBottom:0})})]})});function Yk(e){return typeof e=="string"}function ip({props:e,states:t,muiFormControl:r}){return t.reduce((s,c)=>(s[c]=e[c],r&&typeof e[c]=="undefined"&&(s[c]=r[c]),s),{})}const F5=G.createContext(void 0);function ud(){return G.useContext(F5)}function AV(e){return e!=null&&!(Array.isArray(e)&&e.length===0)}function nI(e,t=!1){return e&&(AV(e.value)&&e.value!==""||t&&AV(e.defaultValue)&&e.defaultValue!=="")}function Hve(e){return e.startAdornment}function Zve(e){return Di("MuiInputBase",e)}const $y=Oi("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var PV;const eA=(e,t)=>{const{ownerState:r}=e;return[t.root,r.formControl&&t.formControl,r.startAdornment&&t.adornedStart,r.endAdornment&&t.adornedEnd,r.error&&t.error,r.size==="small"&&t.sizeSmall,r.multiline&&t.multiline,r.color&&t[`color${tr(r.color)}`],r.fullWidth&&t.fullWidth,r.hiddenLabel&&t.hiddenLabel]},tA=(e,t)=>{const{ownerState:r}=e;return[t.input,r.size==="small"&&t.inputSizeSmall,r.multiline&&t.inputMultiline,r.type==="search"&&t.inputTypeSearch,r.startAdornment&&t.inputAdornedStart,r.endAdornment&&t.inputAdornedEnd,r.hiddenLabel&&t.inputHiddenLabel]},Xve=e=>{const{classes:t,color:r,disabled:s,error:c,endAdornment:f,focused:_,formControl:x,fullWidth:a,hiddenLabel:I,multiline:D,readOnly:O,size:F,startAdornment:H,type:Q}=e,ie={root:["root",`color${tr(r)}`,s&&"disabled",c&&"error",a&&"fullWidth",_&&"focused",x&&"formControl",F&&F!=="medium"&&`size${tr(F)}`,D&&"multiline",H&&"adornedStart",f&&"adornedEnd",I&&"hiddenLabel",O&&"readOnly"],input:["input",s&&"disabled",Q==="search"&&"inputTypeSearch",D&&"inputMultiline",F==="small"&&"inputSizeSmall",I&&"inputHiddenLabel",H&&"inputAdornedStart",f&&"inputAdornedEnd",O&&"readOnly"]};return Ni(ie,Zve,t)},nA=nr("div",{name:"MuiInputBase",slot:"Root",overridesResolver:eA})(us(({theme:e})=>_t(de({},e.typography.body1),{color:(e.vars||e).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${$y.disabled}`]:{color:(e.vars||e).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:t})=>t.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:t,size:r})=>t.multiline&&r==="small",style:{paddingTop:1}},{props:({ownerState:t})=>t.fullWidth,style:{width:"100%"}}]}))),rA=nr("input",{name:"MuiInputBase",slot:"Input",overridesResolver:tA})(us(({theme:e})=>{const t=e.palette.mode==="light",r=_t(de({color:"currentColor"},e.vars?{opacity:e.vars.opacity.inputPlaceholder}:{opacity:t?.42:.5}),{transition:e.transitions.create("opacity",{duration:e.transitions.duration.shorter})}),s={opacity:"0 !important"},c=e.vars?{opacity:e.vars.opacity.inputPlaceholder}:{opacity:t?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&::-ms-input-placeholder":r,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${$y.formControl} &`]:{"&::-webkit-input-placeholder":s,"&::-moz-placeholder":s,"&::-ms-input-placeholder":s,"&:focus::-webkit-input-placeholder":c,"&:focus::-moz-placeholder":c,"&:focus::-ms-input-placeholder":c},[`&.${$y.disabled}`]:{opacity:1,WebkitTextFillColor:(e.vars||e).palette.text.disabled},variants:[{props:({ownerState:f})=>!f.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:f})=>f.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),RV=rve({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),Kve=G.forwardRef(function(t,r){var Li;const s=hs({props:t,name:"MuiInputBase"}),Yr=s,{"aria-describedby":c,autoComplete:f,autoFocus:_,className:x,color:a,components:I={},componentsProps:D={},defaultValue:O,disabled:F,disableInjectingGlobalStyles:H,endAdornment:Q,error:ie,fullWidth:te=!1,id:W,inputComponent:X="input",inputProps:ee={},inputRef:fe,margin:ye,maxRows:Ee,minRows:re,multiline:he=!1,name:_e,onBlur:Se,onChange:J,onClick:Ie,onFocus:we,onKeyDown:Lt,onKeyUp:Gt,placeholder:qt,readOnly:It,renderSuffix:ct,rows:Ut,size:Kt,slotProps:at={},slots:At={},startAdornment:Et,type:Jt="text",value:Bt}=Yr,Pn=On(Yr,["aria-describedby","autoComplete","autoFocus","className","color","components","componentsProps","defaultValue","disabled","disableInjectingGlobalStyles","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","size","slotProps","slots","startAdornment","type","value"]),$n=ee.value!=null?ee.value:Bt,{current:Qn}=G.useRef($n!=null),Xt=G.useRef(),mr=G.useCallback(Nr=>{},[]),An=Bo(Xt,fe,ee.ref,mr),[cr,zr]=G.useState(!1),qn=ud(),Mr=ip({props:s,muiFormControl:qn,states:["color","disabled","error","hiddenLabel","size","required","filled"]});Mr.focused=qn?qn.focused:cr,G.useEffect(()=>{!qn&&F&&cr&&(zr(!1),Se&&Se())},[qn,F,cr,Se]);const Vr=qn&&qn.onFilled,kn=qn&&qn.onEmpty,zn=G.useCallback(Nr=>{nI(Nr)?Vr&&Vr():kn&&kn()},[Vr,kn]);qf(()=>{Qn&&zn({value:$n})},[$n,zn,Qn]);const Ue=Nr=>{we&&we(Nr),ee.onFocus&&ee.onFocus(Nr),qn&&qn.onFocus?qn.onFocus(Nr):zr(!0)},Ye=Nr=>{Se&&Se(Nr),ee.onBlur&&ee.onBlur(Nr),qn&&qn.onBlur?qn.onBlur(Nr):zr(!1)},gt=(Nr,...di)=>{if(!Qn){const En=Nr.target||Xt.current;if(En==null)throw new Error(nd(1));zn({value:En.value})}ee.onChange&&ee.onChange(Nr,...di),J&&J(Nr,...di)};G.useEffect(()=>{zn(Xt.current)},[]);const Qe=Nr=>{Xt.current&&Nr.currentTarget===Nr.target&&Xt.current.focus(),Ie&&Ie(Nr)};let pt=X,dt=ee;he&&pt==="input"&&(Ut?dt=de({type:void 0,minRows:Ut,maxRows:Ut},dt):dt=de({type:void 0,maxRows:Ee,minRows:re},dt),pt=Wve);const sn=Nr=>{zn(Nr.animationName==="mui-auto-fill-cancel"?Xt.current:{value:"x"})};G.useEffect(()=>{qn&&qn.setAdornedStart(!!Et)},[qn,Et]);const Wt=_t(de({},s),{color:Mr.color||"primary",disabled:Mr.disabled,endAdornment:Q,error:Mr.error,focused:Mr.focused,formControl:qn,fullWidth:te,hiddenLabel:Mr.hiddenLabel,multiline:he,size:Mr.size,startAdornment:Et,type:Jt}),pn=Xve(Wt),Sn=At.root||I.Root||nA,gr=at.root||D.root||{},xi=At.input||I.Input||rA;return dt=de(de({},dt),(Li=at.input)!=null?Li:D.input),N.jsxs(G.Fragment,{children:[!H&&typeof RV=="function"&&(PV||(PV=N.jsx(RV,{}))),N.jsxs(Sn,_t(de(de(_t(de({},gr),{ref:r,onClick:Qe}),Pn),!Yk(Sn)&&{ownerState:de(de({},Wt),gr.ownerState)}),{className:Or(pn.root,gr.className,x,It&&"MuiInputBase-readOnly"),children:[Et,N.jsx(F5.Provider,{value:null,children:N.jsx(xi,_t(de(de({"aria-invalid":Mr.error,"aria-describedby":c,autoComplete:f,autoFocus:_,defaultValue:O,disabled:Mr.disabled,id:W,onAnimationStart:sn,name:_e,placeholder:qt,readOnly:It,required:Mr.required,rows:Ut,value:$n,onKeyDown:Lt,onKeyUp:Gt,type:Jt},dt),!Yk(xi)&&{as:pt,ownerState:de(de({},Wt),dt.ownerState)}),{ref:An,className:Or(pn.input,dt.className,It&&"MuiInputBase-readOnly"),onBlur:Ye,onChange:gt,onFocus:Ue}))}),Q,ct?ct(_t(de({},Mr),{startAdornment:Et})):null]}))]})}),B5=Kve;function Qve(e){return Di("MuiInput",e)}const Jv=de(de({},$y),Oi("MuiInput",["root","underline","input"]));function Yve(e){return Di("MuiOutlinedInput",e)}const Eu=de(de({},$y),Oi("MuiOutlinedInput",["root","notchedOutline","input"]));function Jve(e){return Di("MuiFilledInput",e)}const im=de(de({},$y),Oi("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])),e1e=cd(N.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),t1e={entering:{opacity:1},entered:{opacity:1}},n1e=G.forwardRef(function(t,r){const s=O5(),c={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen},Lt=t,{addEndListener:f,appear:_=!0,children:x,easing:a,in:I,onEnter:D,onEntered:O,onEntering:F,onExit:H,onExited:Q,onExiting:ie,style:te,timeout:W=c,TransitionComponent:X=Yu}=Lt,ee=On(Lt,["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),fe=G.useRef(null),ye=Bo(fe,Eb(x),r),Ee=Gt=>qt=>{if(Gt){const It=fe.current;qt===void 0?Gt(It):Gt(It,qt)}},re=Ee(F),he=Ee((Gt,qt)=>{CH(Gt);const It=eI({style:te,timeout:W,easing:a},{mode:"enter"});Gt.style.webkitTransition=s.transitions.create("opacity",It),Gt.style.transition=s.transitions.create("opacity",It),D&&D(Gt,qt)}),_e=Ee(O),Se=Ee(ie),J=Ee(Gt=>{const qt=eI({style:te,timeout:W,easing:a},{mode:"exit"});Gt.style.webkitTransition=s.transitions.create("opacity",qt),Gt.style.transition=s.transitions.create("opacity",qt),H&&H(Gt)}),Ie=Ee(Q),we=Gt=>{f&&f(fe.current,Gt)};return N.jsx(X,_t(de({appear:_,in:I,nodeRef:fe,onEnter:he,onEntered:_e,onEntering:re,onExit:J,onExited:Ie,onExiting:Se,addEndListener:we,timeout:W},ee),{children:(Gt,qt)=>G.cloneElement(x,de({style:de(de(de({opacity:0,visibility:Gt==="exited"&&!I?"hidden":void 0},t1e[Gt]),te),x.props.style),ref:ye},qt))}))});function r1e(e){return Di("MuiBackdrop",e)}Oi("MuiBackdrop",["root","invisible"]);const i1e=e=>{const{classes:t,invisible:r}=e;return Ni({root:["root",r&&"invisible"]},r1e,t)},s1e=nr("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.invisible&&t.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),o1e=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiBackdrop"}),_e=s,{children:c,className:f,component:_="div",invisible:x=!1,open:a,components:I={},componentsProps:D={},slotProps:O={},slots:F={},TransitionComponent:H,transitionDuration:Q}=_e,ie=On(_e,["children","className","component","invisible","open","components","componentsProps","slotProps","slots","TransitionComponent","transitionDuration"]),te=_t(de({},s),{component:_,invisible:x}),W=i1e(te),X=de({transition:H,root:I.Root},F),ee=de(de({},D),O),fe={slots:X,slotProps:ee},[ye,Ee]=Zl("root",{elementType:s1e,externalForwardedProps:fe,className:Or(W.root,f),ownerState:te}),[re,he]=Zl("transition",{elementType:n1e,externalForwardedProps:fe,ownerState:te});return delete he.ownerState,N.jsx(re,_t(de(de({in:a,timeout:Q},ie),he),{children:N.jsx(ye,_t(de({"aria-hidden":!0},Ee),{classes:W,ref:r,children:c}))}))});function a1e(e){const{badgeContent:t,invisible:r=!1,max:s=99,showZero:c=!1}=e,f=_H({badgeContent:t,max:s});let _=r;r===!1&&t===0&&!c&&(_=!0);const{badgeContent:x,max:a=s}=_?f:e,I=x&&Number(x)>a?`${a}+`:x;return{badgeContent:x,invisible:_,max:a,displayValue:I}}function l1e(e){return Di("MuiBadge",e)}const rf=Oi("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),NR=10,FR=4,c1e=e=>{const{color:t,anchorOrigin:r,invisible:s,overlap:c,variant:f,classes:_={}}=e,x={root:["root"],badge:["badge",f,s&&"invisible",`anchorOrigin${tr(r.vertical)}${tr(r.horizontal)}`,`anchorOrigin${tr(r.vertical)}${tr(r.horizontal)}${tr(c)}`,`overlap${tr(c)}`,t!=="default"&&`color${tr(t)}`]};return Ni(x,l1e,_)},u1e=nr("span",{name:"MuiBadge",slot:"Root",overridesResolver:(e,t)=>t.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),h1e=nr("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.badge,t[r.variant],t[`anchorOrigin${tr(r.anchorOrigin.vertical)}${tr(r.anchorOrigin.horizontal)}${tr(r.overlap)}`],r.color!=="default"&&t[`color${tr(r.color)}`],r.invisible&&t.invisible]}})(us(({theme:e})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:e.typography.fontFamily,fontWeight:e.typography.fontWeightMedium,fontSize:e.typography.pxToRem(12),minWidth:NR*2,lineHeight:1,padding:"0 6px",height:NR*2,borderRadius:NR,zIndex:1,transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.enteringScreen}),variants:[...Object.entries(e.palette).filter(([,t])=>t&&t.main&&t.contrastText).map(([t])=>({props:{color:t},style:{backgroundColor:(e.vars||e).palette[t].main,color:(e.vars||e).palette[t].contrastText}})),{props:{variant:"dot"},style:{borderRadius:FR,height:FR*2,minWidth:FR*2,padding:0}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${rf.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${rf.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${rf.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${rf.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${rf.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="right"&&t.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${rf.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="top"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${rf.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:t})=>t.anchorOrigin.vertical==="bottom"&&t.anchorOrigin.horizontal==="left"&&t.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${rf.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:e.transitions.create("transform",{easing:e.transitions.easing.easeInOut,duration:e.transitions.duration.leavingScreen})}}]}))),d1e=G.forwardRef(function(t,r){var Bt,Pn,$n,Qn,Xt,mr;const s=hs({props:t,name:"MuiBadge"}),Jt=s,{anchorOrigin:c={vertical:"top",horizontal:"right"},className:f,classes:_,component:x,components:a={},componentsProps:I={},children:D,overlap:O="rectangular",color:F="default",invisible:H=!1,max:Q=99,badgeContent:ie,slots:te,slotProps:W,showZero:X=!1,variant:ee="standard"}=Jt,fe=On(Jt,["anchorOrigin","className","classes","component","components","componentsProps","children","overlap","color","invisible","max","badgeContent","slots","slotProps","showZero","variant"]),{badgeContent:ye,invisible:Ee,max:re,displayValue:he}=a1e({max:Q,invisible:H,badgeContent:ie,showZero:X}),_e=_H({anchorOrigin:c,color:F,overlap:O,variant:ee,badgeContent:ie}),Se=Ee||ye==null&&ee!=="dot",{color:J=F,overlap:Ie=O,anchorOrigin:we=c,variant:Lt=ee}=Se?_e:s,Gt=Lt!=="dot"?he:void 0,qt=_t(de({},s),{badgeContent:ye,invisible:Se,max:re,displayValue:Gt,showZero:X,anchorOrigin:we,color:J,overlap:Ie,variant:Lt}),It=c1e(qt),ct=(Pn=(Bt=te==null?void 0:te.root)!=null?Bt:a.Root)!=null?Pn:u1e,Ut=(Qn=($n=te==null?void 0:te.badge)!=null?$n:a.Badge)!=null?Qn:h1e,Kt=(Xt=W==null?void 0:W.root)!=null?Xt:I.root,at=(mr=W==null?void 0:W.badge)!=null?mr:I.badge,At=QS({elementType:ct,externalSlotProps:Kt,externalForwardedProps:fe,additionalProps:{ref:r,as:x},ownerState:qt,className:Or(Kt==null?void 0:Kt.className,It.root,f)}),Et=QS({elementType:Ut,externalSlotProps:at,ownerState:qt,className:Or(It.badge,at==null?void 0:at.className)});return N.jsxs(ct,_t(de({},At),{children:[D,N.jsx(Ut,_t(de({},Et),{children:Gt}))]}))});function f1e(e){return Di("MuiButton",e)}const k_=Oi("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),p1e=G.createContext({}),m1e=G.createContext(void 0),g1e=e=>{const{color:t,disableElevation:r,fullWidth:s,size:c,variant:f,classes:_}=e,x={root:["root",f,`${f}${tr(t)}`,`size${tr(c)}`,`${f}Size${tr(c)}`,`color${tr(t)}`,r&&"disableElevation",s&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${tr(c)}`],endIcon:["icon","endIcon",`iconSize${tr(c)}`]},a=Ni(x,f1e,_);return de(de({},_),a)},AH=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],_1e=nr(N5,{shouldForwardProp:e=>Ka(e)||e==="classes",name:"MuiButton",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t[`${r.variant}${tr(r.color)}`],t[`size${tr(r.size)}`],t[`${r.variant}Size${tr(r.size)}`],r.color==="inherit"&&t.colorInherit,r.disableElevation&&t.disableElevation,r.fullWidth&&t.fullWidth]}})(us(({theme:e})=>{var s,c;const t=e.palette.mode==="light"?e.palette.grey[300]:e.palette.grey[800],r=e.palette.mode==="light"?e.palette.grey.A100:e.palette.grey[700];return _t(de({},e.typography.button),{minWidth:64,padding:"6px 16px",border:0,borderRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create(["background-color","box-shadow","border-color","color"],{duration:e.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${k_.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(e.vars||e).shadows[2],"&:hover":{boxShadow:(e.vars||e).shadows[4],"@media (hover: none)":{boxShadow:(e.vars||e).shadows[2]}},"&:active":{boxShadow:(e.vars||e).shadows[8]},[`&.${k_.focusVisible}`]:{boxShadow:(e.vars||e).shadows[6]},[`&.${k_.disabled}`]:{color:(e.vars||e).palette.action.disabled,boxShadow:(e.vars||e).shadows[0],backgroundColor:(e.vars||e).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${k_.disabled}`]:{border:`1px solid ${(e.vars||e).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(e.palette).filter(([,f])=>f&&f.main&&f.dark&&f.contrastText).map(([f])=>({props:{color:f},style:{"--variant-textColor":(e.vars||e).palette[f].main,"--variant-outlinedColor":(e.vars||e).palette[f].main,"--variant-outlinedBorder":e.vars?`rgba(${e.vars.palette[f].mainChannel} / 0.5)`:Hl(e.palette[f].main,.5),"--variant-containedColor":(e.vars||e).palette[f].contrastText,"--variant-containedBg":(e.vars||e).palette[f].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(e.vars||e).palette[f].dark,"--variant-textBg":e.vars?`rgba(${e.vars.palette[f].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:Hl(e.palette[f].main,e.palette.action.hoverOpacity),"--variant-outlinedBorder":(e.vars||e).palette[f].main,"--variant-outlinedBg":e.vars?`rgba(${e.vars.palette[f].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:Hl(e.palette[f].main,e.palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{"--variant-containedColor":e.vars?e.vars.palette.text.primary:(c=(s=e.palette).getContrastText)==null?void 0:c.call(s,t),"--variant-containedBg":e.vars?e.vars.palette.Button.inheritContainedBg:t,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":e.vars?e.vars.palette.Button.inheritContainedHoverBg:r,"--variant-textBg":e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:Hl(e.palette.text.primary,e.palette.action.hoverOpacity),"--variant-outlinedBg":e.vars?`rgba(${e.vars.palette.text.primaryChannel} / ${e.vars.palette.action.hoverOpacity})`:Hl(e.palette.text.primary,e.palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:e.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:e.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:e.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:e.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:e.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:e.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${k_.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${k_.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}}]})})),y1e=nr("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.startIcon,t[`iconSize${tr(r.size)}`]]}})({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},...AH]}),v1e=nr("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.endIcon,t[`iconSize${tr(r.size)}`]]}})({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},...AH]}),fm=G.forwardRef(function(t,r){const s=G.useContext(p1e),c=G.useContext(m1e),f=Nx(s,t),_=hs({props:f,name:"MuiButton"}),J=_,{children:x,color:a="primary",component:I="button",className:D,disabled:O=!1,disableElevation:F=!1,disableFocusRipple:H=!1,endIcon:Q,focusVisibleClassName:ie,fullWidth:te=!1,size:W="medium",startIcon:X,type:ee,variant:fe="text"}=J,ye=On(J,["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"]),Ee=_t(de({},_),{color:a,component:I,disabled:O,disableElevation:F,disableFocusRipple:H,fullWidth:te,size:W,type:ee,variant:fe}),re=g1e(Ee),he=X&&N.jsx(y1e,{className:re.startIcon,ownerState:Ee,children:X}),_e=Q&&N.jsx(v1e,{className:re.endIcon,ownerState:Ee,children:Q}),Se=c||"";return N.jsxs(_1e,_t(de({ownerState:Ee,className:Or(s.className,re.root,D,Se),component:I,disabled:O,focusRipple:!H,focusVisibleClassName:Or(re.focusVisible,ie),ref:r,type:ee},ye),{classes:re,children:[he,x,_e]}))});function x1e(e){return Di("PrivateSwitchBase",e)}Oi("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const b1e=e=>{const{classes:t,checked:r,disabled:s,edge:c}=e,f={root:["root",r&&"checked",s&&"disabled",c&&`edge${tr(c)}`],input:["input"]};return Ni(f,x1e,t)},w1e=nr(N5)({padding:9,borderRadius:"50%",variants:[{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:({edge:e,ownerState:t})=>e==="start"&&t.size!=="small",style:{marginLeft:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}},{props:({edge:e,ownerState:t})=>e==="end"&&t.size!=="small",style:{marginRight:-12}}]}),T1e=nr("input",{shouldForwardProp:Ka})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),E1e=G.forwardRef(function(t,r){const Ut=t,{autoFocus:s,checked:c,checkedIcon:f,className:_,defaultChecked:x,disabled:a,disableFocusRipple:I=!1,edge:D=!1,icon:O,id:F,inputProps:H,inputRef:Q,name:ie,onBlur:te,onChange:W,onFocus:X,readOnly:ee,required:fe=!1,tabIndex:ye,type:Ee,value:re}=Ut,he=On(Ut,["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"]),[_e,Se]=KS({controlled:c,default:!!x,name:"SwitchBase",state:"checked"}),J=ud(),Ie=Kt=>{X&&X(Kt),J&&J.onFocus&&J.onFocus(Kt)},we=Kt=>{te&&te(Kt),J&&J.onBlur&&J.onBlur(Kt)},Lt=Kt=>{if(Kt.nativeEvent.defaultPrevented)return;const at=Kt.target.checked;Se(at),W&&W(Kt,at)};let Gt=a;J&&typeof Gt=="undefined"&&(Gt=J.disabled);const qt=Ee==="checkbox"||Ee==="radio",It=_t(de({},t),{checked:_e,disabled:Gt,disableFocusRipple:I,edge:D}),ct=b1e(It);return N.jsxs(w1e,_t(de({component:"span",className:Or(ct.root,_),centerRipple:!0,focusRipple:!I,disabled:Gt,tabIndex:null,role:void 0,onFocus:Ie,onBlur:we,ownerState:It,ref:r},he),{children:[N.jsx(T1e,de(de({autoFocus:s,checked:c,defaultChecked:x,className:ct.input,disabled:Gt,id:qt?F:void 0,name:ie,onChange:Lt,readOnly:ee,ref:Q,required:fe,ownerState:It,tabIndex:ye,type:Ee},Ee==="checkbox"&&re===void 0?{}:{value:re}),H)),_e?f:O]}))});function S1e(e){const t=vl(e);return t.body===e?Xm(e).innerWidth>t.documentElement.clientWidth:e.scrollHeight>e.clientHeight}function G1(e,t){t?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function MV(e){return parseInt(Xm(e).getComputedStyle(e).paddingRight,10)||0}function I1e(e){const r=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(e.tagName)!==-1,s=e.tagName==="INPUT"&&e.getAttribute("type")==="hidden";return r||s}function kV(e,t,r,s,c){const f=[t,r,...s];[].forEach.call(e.children,_=>{const x=f.indexOf(_)===-1,a=!I1e(_);x&&a&&G1(_,c)})}function BR(e,t){let r=-1;return e.some((s,c)=>t(s)?(r=c,!0):!1),r}function C1e(e,t){const r=[],s=e.container;if(!t.disableScrollLock){if(S1e(s)){const _=gH(vl(s));r.push({value:s.style.paddingRight,property:"padding-right",el:s}),s.style.paddingRight=`${MV(s)+_}px`;const x=vl(s).querySelectorAll(".mui-fixed");[].forEach.call(x,a=>{r.push({value:a.style.paddingRight,property:"padding-right",el:a}),a.style.paddingRight=`${MV(a)+_}px`})}let f;if(s.parentNode instanceof DocumentFragment)f=vl(s).body;else{const _=s.parentElement,x=Xm(s);f=(_==null?void 0:_.nodeName)==="HTML"&&x.getComputedStyle(_).overflowY==="scroll"?_:s}r.push({value:f.style.overflow,property:"overflow",el:f},{value:f.style.overflowX,property:"overflow-x",el:f},{value:f.style.overflowY,property:"overflow-y",el:f}),f.style.overflow="hidden"}return()=>{r.forEach(({value:f,el:_,property:x})=>{f?_.style.setProperty(x,f):_.style.removeProperty(x)})}}function A1e(e){const t=[];return[].forEach.call(e.children,r=>{r.getAttribute("aria-hidden")==="true"&&t.push(r)}),t}class P1e{constructor(){this.modals=[],this.containers=[]}add(t,r){let s=this.modals.indexOf(t);if(s!==-1)return s;s=this.modals.length,this.modals.push(t),t.modalRef&&G1(t.modalRef,!1);const c=A1e(r);kV(r,t.mount,t.modalRef,c,!0);const f=BR(this.containers,_=>_.container===r);return f!==-1?(this.containers[f].modals.push(t),s):(this.containers.push({modals:[t],container:r,restore:null,hiddenSiblings:c}),s)}mount(t,r){const s=BR(this.containers,f=>f.modals.indexOf(t)!==-1),c=this.containers[s];c.restore||(c.restore=C1e(c,r))}remove(t,r=!0){const s=this.modals.indexOf(t);if(s===-1)return s;const c=BR(this.containers,_=>_.modals.indexOf(t)!==-1),f=this.containers[c];if(f.modals.splice(f.modals.indexOf(t),1),this.modals.splice(s,1),f.modals.length===0)f.restore&&f.restore(),t.modalRef&&G1(t.modalRef,r),kV(f.container,t.mount,t.modalRef,f.hiddenSiblings,!1),this.containers.splice(c,1);else{const _=f.modals[f.modals.length-1];_.modalRef&&G1(_.modalRef,!1)}return s}isTopModal(t){return this.modals.length>0&&this.modals[this.modals.length-1]===t}}const R1e=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function M1e(e){const t=parseInt(e.getAttribute("tabindex")||"",10);return Number.isNaN(t)?e.contentEditable==="true"||(e.nodeName==="AUDIO"||e.nodeName==="VIDEO"||e.nodeName==="DETAILS")&&e.getAttribute("tabindex")===null?0:e.tabIndex:t}function k1e(e){if(e.tagName!=="INPUT"||e.type!=="radio"||!e.name)return!1;const t=s=>e.ownerDocument.querySelector(`input[type="radio"]${s}`);let r=t(`[name="${e.name}"]:checked`);return r||(r=t(`[name="${e.name}"]`)),r!==e}function D1e(e){return!(e.disabled||e.tagName==="INPUT"&&e.type==="hidden"||k1e(e))}function O1e(e){const t=[],r=[];return Array.from(e.querySelectorAll(R1e)).forEach((s,c)=>{const f=M1e(s);f===-1||!D1e(s)||(f===0?t.push(s):r.push({documentOrder:c,tabIndex:f,node:s}))}),r.sort((s,c)=>s.tabIndex===c.tabIndex?s.documentOrder-c.documentOrder:s.tabIndex-c.tabIndex).map(s=>s.node).concat(t)}function L1e(){return!0}function z1e(e){const{children:t,disableAutoFocus:r=!1,disableEnforceFocus:s=!1,disableRestoreFocus:c=!1,getTabbable:f=O1e,isEnabled:_=L1e,open:x}=e,a=G.useRef(!1),I=G.useRef(null),D=G.useRef(null),O=G.useRef(null),F=G.useRef(null),H=G.useRef(!1),Q=G.useRef(null),ie=Bo(Eb(t),Q),te=G.useRef(null);G.useEffect(()=>{!x||!Q.current||(H.current=!r)},[r,x]),G.useEffect(()=>{if(!x||!Q.current)return;const ee=vl(Q.current);return Q.current.contains(ee.activeElement)||(Q.current.hasAttribute("tabIndex")||Q.current.setAttribute("tabIndex","-1"),H.current&&Q.current.focus()),()=>{c||(O.current&&O.current.focus&&(a.current=!0,O.current.focus()),O.current=null)}},[x]),G.useEffect(()=>{if(!x||!Q.current)return;const ee=vl(Q.current),fe=re=>{te.current=re,!(s||!_()||re.key!=="Tab")&&ee.activeElement===Q.current&&re.shiftKey&&(a.current=!0,D.current&&D.current.focus())},ye=()=>{var _e,Se;const re=Q.current;if(re===null)return;if(!ee.hasFocus()||!_()||a.current){a.current=!1;return}if(re.contains(ee.activeElement)||s&&ee.activeElement!==I.current&&ee.activeElement!==D.current)return;if(ee.activeElement!==F.current)F.current=null;else if(F.current!==null)return;if(!H.current)return;let he=[];if((ee.activeElement===I.current||ee.activeElement===D.current)&&(he=f(Q.current)),he.length>0){const J=!!((_e=te.current)!=null&&_e.shiftKey&&((Se=te.current)==null?void 0:Se.key)==="Tab"),Ie=he[0],we=he[he.length-1];typeof Ie!="string"&&typeof we!="string"&&(J?we.focus():Ie.focus())}else re.focus()};ee.addEventListener("focusin",ye),ee.addEventListener("keydown",fe,!0);const Ee=setInterval(()=>{ee.activeElement&&ee.activeElement.tagName==="BODY"&&ye()},50);return()=>{clearInterval(Ee),ee.removeEventListener("focusin",ye),ee.removeEventListener("keydown",fe,!0)}},[r,s,c,_,x,f]);const W=ee=>{O.current===null&&(O.current=ee.relatedTarget),H.current=!0,F.current=ee.target;const fe=t.props.onFocus;fe&&fe(ee)},X=ee=>{O.current===null&&(O.current=ee.relatedTarget),H.current=!0};return N.jsxs(G.Fragment,{children:[N.jsx("div",{tabIndex:x?0:-1,onFocus:X,ref:I,"data-testid":"sentinelStart"}),G.cloneElement(t,{ref:ie,onFocus:W}),N.jsx("div",{tabIndex:x?0:-1,onFocus:X,ref:D,"data-testid":"sentinelEnd"})]})}function N1e(e){return typeof e=="function"?e():e}function F1e(e){return e?e.props.hasOwnProperty("in"):!1}const B1e=new P1e;function j1e(e){const{container:t,disableEscapeKeyDown:r=!1,disableScrollLock:s=!1,manager:c=B1e,closeAfterTransition:f=!1,onTransitionEnter:_,onTransitionExited:x,children:a,onClose:I,open:D,rootRef:O}=e,F=G.useRef({}),H=G.useRef(null),Q=G.useRef(null),ie=Bo(Q,O),[te,W]=G.useState(!D),X=F1e(a);let ee=!0;(e["aria-hidden"]==="false"||e["aria-hidden"]===!1)&&(ee=!1);const fe=()=>vl(H.current),ye=()=>(F.current.modalRef=Q.current,F.current.mount=H.current,F.current),Ee=()=>{c.mount(ye(),{disableScrollLock:s}),Q.current&&(Q.current.scrollTop=0)},re=ey(()=>{const qt=N1e(t)||fe().body;c.add(ye(),qt),Q.current&&Ee()}),he=G.useCallback(()=>c.isTopModal(ye()),[c]),_e=ey(qt=>{H.current=qt,qt&&(D&&he()?Ee():Q.current&&G1(Q.current,ee))}),Se=G.useCallback(()=>{c.remove(ye(),ee)},[ee,c]);G.useEffect(()=>()=>{Se()},[Se]),G.useEffect(()=>{D?re():(!X||!f)&&Se()},[D,Se,X,f,re]);const J=qt=>It=>{var ct;(ct=qt.onKeyDown)==null||ct.call(qt,It),!(It.key!=="Escape"||It.which===229||!he())&&(r||(It.stopPropagation(),I&&I(It,"escapeKeyDown")))},Ie=qt=>It=>{var ct;(ct=qt.onClick)==null||ct.call(qt,It),It.target===It.currentTarget&&I&&I(It,"backdropClick")};return{getRootProps:(qt={})=>{const It=vH(e);delete It.onTransitionEnter,delete It.onTransitionExited;const ct=de(de({},It),qt);return _t(de({role:"presentation"},ct),{onKeyDown:J(ct),ref:ie})},getBackdropProps:(qt={})=>{const It=qt;return _t(de({"aria-hidden":!0},It),{onClick:Ie(It),open:D})},getTransitionProps:()=>{const qt=()=>{W(!1),_&&_()},It=()=>{W(!0),x&&x(),f&&Se()};return{onEnter:Gk(qt,a==null?void 0:a.props.onEnter),onExited:Gk(It,a==null?void 0:a.props.onExited)}},rootRef:ie,portalRef:_e,isTopModal:he,exited:te,hasTransition:X}}function U1e(e){return Di("MuiModal",e)}Oi("MuiModal",["root","hidden","backdrop"]);const V1e=e=>{const{open:t,exited:r,classes:s}=e;return Ni({root:["root",!t&&r&&"hidden"],backdrop:["backdrop"]},U1e,s)},$1e=nr("div",{name:"MuiModal",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,!r.open&&r.exited&&t.hidden]}})(us(({theme:e})=>({position:"fixed",zIndex:(e.vars||e).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:t})=>!t.open&&t.exited,style:{visibility:"hidden"}}]}))),q1e=nr(o1e,{name:"MuiModal",slot:"Backdrop",overridesResolver:(e,t)=>t.backdrop})({zIndex:-1}),G1e=G.forwardRef(function(t,r){const s=hs({name:"MuiModal",props:t}),cr=s,{BackdropComponent:c=q1e,BackdropProps:f,classes:_,className:x,closeAfterTransition:a=!1,children:I,container:D,component:O,components:F={},componentsProps:H={},disableAutoFocus:Q=!1,disableEnforceFocus:ie=!1,disableEscapeKeyDown:te=!1,disablePortal:W=!1,disableRestoreFocus:X=!1,disableScrollLock:ee=!1,hideBackdrop:fe=!1,keepMounted:ye=!1,onBackdropClick:Ee,onClose:re,onTransitionEnter:he,onTransitionExited:_e,open:Se,slotProps:J={},slots:Ie={},theme:we}=cr,Lt=On(cr,["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onBackdropClick","onClose","onTransitionEnter","onTransitionExited","open","slotProps","slots","theme"]),Gt=_t(de({},s),{closeAfterTransition:a,disableAutoFocus:Q,disableEnforceFocus:ie,disableEscapeKeyDown:te,disablePortal:W,disableRestoreFocus:X,disableScrollLock:ee,hideBackdrop:fe,keepMounted:ye}),{getRootProps:qt,getBackdropProps:It,getTransitionProps:ct,portalRef:Ut,isTopModal:Kt,exited:at,hasTransition:At}=j1e(_t(de({},Gt),{rootRef:r})),Et=_t(de({},Gt),{exited:at}),Jt=V1e(Et),Bt={};if(I.props.tabIndex===void 0&&(Bt.tabIndex="-1"),At){const{onEnter:zr,onExited:qn}=ct();Bt.onEnter=zr,Bt.onExited=qn}const Pn={slots:de({root:F.Root,backdrop:F.Backdrop},Ie),slotProps:de(de({},H),J)},[$n,Qn]=Zl("root",{elementType:$1e,externalForwardedProps:Pn,getSlotProps:qt,additionalProps:{ref:r,as:O},ownerState:Et,className:Or(x,Jt==null?void 0:Jt.root,!Et.open&&Et.exited&&(Jt==null?void 0:Jt.hidden))}),[Xt,mr]=Zl("backdrop",{elementType:c,externalForwardedProps:Pn,additionalProps:f,getSlotProps:zr=>It(_t(de({},zr),{onClick:qn=>{Ee&&Ee(qn),zr!=null&&zr.onClick&&zr.onClick(qn)}})),className:Or(f==null?void 0:f.className,Jt==null?void 0:Jt.backdrop),ownerState:Et}),An=Bo(f==null?void 0:f.ref,mr.ref);return!ye&&!Se&&(!At||at)?null:N.jsx($ve,{ref:Ut,container:D,disablePortal:W,children:N.jsxs($n,_t(de(de({},Qn),Lt),{children:[!fe&&c?N.jsx(Xt,_t(de({},mr),{ref:An})):null,N.jsx(z1e,{disableEnforceFocus:ie,disableAutoFocus:Q,disableRestoreFocus:X,isEnabled:Kt,open:Se,children:G.cloneElement(I,Bt)})]}))})}),W1e=e=>{const{classes:t,disableUnderline:r,startAdornment:s,endAdornment:c,size:f,hiddenLabel:_,multiline:x}=e,a={root:["root",!r&&"underline",s&&"adornedStart",c&&"adornedEnd",f==="small"&&`size${tr(f)}`,_&&"hiddenLabel",x&&"multiline"],input:["input"]},I=Ni(a,Jve,t);return de(de({},t),I)},H1e=nr(nA,{shouldForwardProp:e=>Ka(e)||e==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[...eA(e,t),!r.disableUnderline&&t.underline]}})(us(({theme:e})=>{const t=e.palette.mode==="light",r=t?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",s=t?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",c=t?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",f=t?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:e.vars?e.vars.palette.FilledInput.bg:s,borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),"&:hover":{backgroundColor:e.vars?e.vars.palette.FilledInput.hoverBg:c,"@media (hover: none)":{backgroundColor:e.vars?e.vars.palette.FilledInput.bg:s}},[`&.${im.focused}`]:{backgroundColor:e.vars?e.vars.palette.FilledInput.bg:s},[`&.${im.disabled}`]:{backgroundColor:e.vars?e.vars.palette.FilledInput.disabledBg:f},variants:[{props:({ownerState:_})=>!_.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${im.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${im.error}`]:{"&::before, &::after":{borderBottomColor:(e.vars||e).palette.error.main}},"&::before":{borderBottom:`1px solid ${e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / ${e.vars.opacity.inputUnderline})`:r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${im.disabled}, .${im.error}):before`]:{borderBottom:`1px solid ${(e.vars||e).palette.text.primary}`},[`&.${im.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(e.palette).filter(([,_])=>_&&_.main).map(([_])=>{var x;return{props:{disableUnderline:!1,color:_},style:{"&::after":{borderBottom:`2px solid ${(x=(e.vars||e).palette[_])==null?void 0:x.main}`}}}}),{props:({ownerState:_})=>_.startAdornment,style:{paddingLeft:12}},{props:({ownerState:_})=>_.endAdornment,style:{paddingRight:12}},{props:({ownerState:_})=>_.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:_,size:x})=>_.multiline&&x==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:_})=>_.multiline&&_.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:_})=>_.multiline&&_.hiddenLabel&&_.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),Z1e=nr(rA,{name:"MuiFilledInput",slot:"Input",overridesResolver:tA})(us(({theme:e})=>_t(de(de({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12},!e.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:e.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:e.palette.mode==="light"?null:"#fff",caretColor:e.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}}),e.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[e.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}}),{variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:t})=>t.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:t})=>t.startAdornment,style:{paddingLeft:0}},{props:({ownerState:t})=>t.endAdornment,style:{paddingRight:0}},{props:({ownerState:t})=>t.hiddenLabel&&t.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:t})=>t.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),rI=G.forwardRef(function(t,r){var Ee,re,he,_e;const s=hs({props:t,name:"MuiFilledInput"}),ye=s,{disableUnderline:c=!1,components:f={},componentsProps:_,fullWidth:x=!1,hiddenLabel:a,inputComponent:I="input",multiline:D=!1,slotProps:O,slots:F={},type:H="text"}=ye,Q=On(ye,["disableUnderline","components","componentsProps","fullWidth","hiddenLabel","inputComponent","multiline","slotProps","slots","type"]),ie=_t(de({},s),{disableUnderline:c,fullWidth:x,inputComponent:I,multiline:D,type:H}),te=W1e(s),W={root:{ownerState:ie},input:{ownerState:ie}},X=(O!=null?O:_)?na(W,O!=null?O:_):W,ee=(re=(Ee=F.root)!=null?Ee:f.Root)!=null?re:H1e,fe=(_e=(he=F.input)!=null?he:f.Input)!=null?_e:Z1e;return N.jsx(B5,_t(de({slots:{root:ee,input:fe},componentsProps:X,fullWidth:x,inputComponent:I,multiline:D,ref:r,type:H},Q),{classes:te}))});rI&&(rI.muiName="Input");function X1e(e){return Di("MuiFormControl",e)}Oi("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const K1e=e=>{const{classes:t,margin:r,fullWidth:s}=e,c={root:["root",r!=="none"&&`margin${tr(r)}`,s&&"fullWidth"]};return Ni(c,X1e,t)},Q1e=nr("div",{name:"MuiFormControl",slot:"Root",overridesResolver:({ownerState:e},t)=>de(de(de({},t.root),t[`margin${tr(e.margin)}`]),e.fullWidth&&t.fullWidth)})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),Y1e=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiFormControl"}),we=s,{children:c,className:f,color:_="primary",component:x="div",disabled:a=!1,error:I=!1,focused:D,fullWidth:O=!1,hiddenLabel:F=!1,margin:H="none",required:Q=!1,size:ie="medium",variant:te="outlined"}=we,W=On(we,["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"]),X=_t(de({},s),{color:_,component:x,disabled:a,error:I,fullWidth:O,hiddenLabel:F,margin:H,required:Q,size:ie,variant:te}),ee=K1e(X),[fe,ye]=G.useState(()=>{let Lt=!1;return c&&G.Children.forEach(c,Gt=>{if(!DR(Gt,["Input","Select"]))return;const qt=DR(Gt,["Select"])?Gt.props.input:Gt;qt&&Hve(qt.props)&&(Lt=!0)}),Lt}),[Ee,re]=G.useState(()=>{let Lt=!1;return c&&G.Children.forEach(c,Gt=>{DR(Gt,["Input","Select"])&&(nI(Gt.props,!0)||nI(Gt.props.inputProps,!0))&&(Lt=!0)}),Lt}),[he,_e]=G.useState(!1);a&&he&&_e(!1);const Se=D!==void 0&&!a?D:he;let J;const Ie=G.useMemo(()=>({adornedStart:fe,setAdornedStart:ye,color:_,disabled:a,error:I,filled:Ee,focused:Se,fullWidth:O,hiddenLabel:F,size:ie,onBlur:()=>{_e(!1)},onEmpty:()=>{re(!1)},onFilled:()=>{re(!0)},onFocus:()=>{_e(!0)},registerEffect:J,required:Q,variant:te}),[fe,_,a,I,Ee,Se,O,F,J,Q,ie,te]);return N.jsx(F5.Provider,{value:Ie,children:N.jsx(Q1e,_t(de({as:x,ownerState:X,className:Or(ee.root,f),ref:r},W),{children:c}))})});function J1e(e){return Di("MuiFormControlLabel",e)}const v1=Oi("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),exe=e=>{const{classes:t,disabled:r,labelPlacement:s,error:c,required:f}=e,_={root:["root",r&&"disabled",`labelPlacement${tr(s)}`,c&&"error",f&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",c&&"error"]};return Ni(_,J1e,t)},txe=nr("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{[`& .${v1.label}`]:t.label},t.root,t[`labelPlacement${tr(r.labelPlacement)}`]]}})(us(({theme:e})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${v1.disabled}`]:{cursor:"default"},[`& .${v1.label}`]:{[`&.${v1.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:t})=>t==="start"||t==="top"||t==="bottom",style:{marginLeft:16}}]}))),nxe=nr("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})(us(({theme:e})=>({[`&.${v1.error}`]:{color:(e.vars||e).palette.error.main}}))),rxe=G.forwardRef(function(t,r){var qt;const s=hs({props:t,name:"MuiFormControlLabel"}),Gt=s,{checked:c,className:f,componentsProps:_={},control:x,disabled:a,disableTypography:I,inputRef:D,label:O,labelPlacement:F="end",name:H,onChange:Q,required:ie,slots:te={},slotProps:W={},value:X}=Gt,ee=On(Gt,["checked","className","componentsProps","control","disabled","disableTypography","inputRef","label","labelPlacement","name","onChange","required","slots","slotProps","value"]),fe=ud(),ye=(qt=a!=null?a:x.props.disabled)!=null?qt:fe==null?void 0:fe.disabled,Ee=ie!=null?ie:x.props.required,re={disabled:ye,required:Ee};["checked","name","onChange","value","inputRef"].forEach(It=>{typeof x.props[It]=="undefined"&&typeof s[It]!="undefined"&&(re[It]=s[It])});const he=ip({props:s,muiFormControl:fe,states:["error"]}),_e=_t(de({},s),{disabled:ye,labelPlacement:F,required:Ee,error:he.error}),Se=exe(_e),J={slots:te,slotProps:de(de({},_),W)},[Ie,we]=Zl("typography",{elementType:CV,externalForwardedProps:J,ownerState:_e});let Lt=O;return Lt!=null&&Lt.type!==CV&&!I&&(Lt=N.jsx(Ie,_t(de({component:"span"},we),{className:Or(Se.label,we==null?void 0:we.className),children:Lt}))),N.jsxs(txe,_t(de({className:Or(Se.root,f),ownerState:_e,ref:r},ee),{children:[G.cloneElement(x,re),Ee?N.jsxs("div",{children:[Lt,N.jsxs(nxe,{ownerState:_e,"aria-hidden":!0,className:Se.asterisk,children:["","*"]})]}):Lt]}))});function ixe(e){return Di("MuiFormGroup",e)}Oi("MuiFormGroup",["root","row","error"]);const sxe=e=>{const{classes:t,row:r,error:s}=e;return Ni({root:["root",r&&"row",s&&"error"]},ixe,t)},oxe=nr("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.row&&t.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),axe=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiFormGroup"}),O=s,{className:c,row:f=!1}=O,_=On(O,["className","row"]),x=ud(),a=ip({props:s,muiFormControl:x,states:["error"]}),I=_t(de({},s),{row:f,error:a.error}),D=sxe(I);return N.jsx(oxe,de({className:Or(D.root,c),ownerState:I,ref:r},_))});function lxe(e){return Di("MuiFormHelperText",e)}const DV=Oi("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var OV;const cxe=e=>{const{classes:t,contained:r,size:s,disabled:c,error:f,filled:_,focused:x,required:a}=e,I={root:["root",c&&"disabled",f&&"error",s&&`size${tr(s)}`,r&&"contained",x&&"focused",_&&"filled",a&&"required"]};return Ni(I,lxe,t)},uxe=nr("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.size&&t[`size${tr(r.size)}`],r.contained&&t.contained,r.filled&&t.filled]}})(us(({theme:e})=>_t(de({color:(e.vars||e).palette.text.secondary},e.typography.caption),{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${DV.disabled}`]:{color:(e.vars||e).palette.text.disabled},[`&.${DV.error}`]:{color:(e.vars||e).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:t})=>t.contained,style:{marginLeft:14,marginRight:14}}]}))),hxe=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiFormHelperText"}),ee=s,{children:c,className:f,component:_="p",disabled:x,error:a,filled:I,focused:D,margin:O,required:F,variant:H}=ee,Q=On(ee,["children","className","component","disabled","error","filled","focused","margin","required","variant"]),ie=ud(),te=ip({props:s,muiFormControl:ie,states:["variant","size","disabled","error","filled","focused","required"]}),W=_t(de({},s),{component:_,contained:te.variant==="filled"||te.variant==="outlined",variant:te.variant,size:te.size,disabled:te.disabled,error:te.error,filled:te.filled,focused:te.focused,required:te.required});delete W.ownerState;const X=cxe(W);return N.jsx(uxe,_t(de({as:_,className:Or(X.root,f),ref:r},Q),{ownerState:W,children:c===" "?OV||(OV=N.jsx("span",{className:"notranslate",children:""})):c}))});function dxe(e){return Di("MuiFormLabel",e)}const W1=Oi("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),fxe=e=>{const{classes:t,color:r,focused:s,disabled:c,error:f,filled:_,required:x}=e,a={root:["root",`color${tr(r)}`,c&&"disabled",f&&"error",_&&"filled",s&&"focused",x&&"required"],asterisk:["asterisk",f&&"error"]};return Ni(a,dxe,t)},pxe=nr("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:({ownerState:e},t)=>de(de(de({},t.root),e.color==="secondary"&&t.colorSecondary),e.filled&&t.filled)})(us(({theme:e})=>_t(de({color:(e.vars||e).palette.text.secondary},e.typography.body1),{lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t},style:{[`&.${W1.focused}`]:{color:(e.vars||e).palette[t].main}}})),{props:{},style:{[`&.${W1.disabled}`]:{color:(e.vars||e).palette.text.disabled},[`&.${W1.error}`]:{color:(e.vars||e).palette.error.main}}}]}))),mxe=nr("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(e,t)=>t.asterisk})(us(({theme:e})=>({[`&.${W1.error}`]:{color:(e.vars||e).palette.error.main}}))),gxe=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiFormLabel"}),X=s,{children:c,className:f,color:_,component:x="label",disabled:a,error:I,filled:D,focused:O,required:F}=X,H=On(X,["children","className","color","component","disabled","error","filled","focused","required"]),Q=ud(),ie=ip({props:s,muiFormControl:Q,states:["color","required","focused","disabled","error","filled"]}),te=_t(de({},s),{color:ie.color||"primary",component:x,disabled:ie.disabled,error:ie.error,filled:ie.filled,focused:ie.focused,required:ie.required}),W=fxe(te);return N.jsxs(pxe,_t(de({as:x,ownerState:te,className:Or(W.root,f),ref:r},H),{children:[c,ie.required&&N.jsxs(mxe,{ownerState:te,"aria-hidden":!0,className:W.asterisk,children:["","*"]})]}))});function Jk(e){return`scale(${e}, ${Ch(e,2)})`}const _xe={entering:{opacity:1,transform:Jk(1)},entered:{opacity:1,transform:"none"}},jR=typeof navigator!="undefined"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),e4=G.forwardRef(function(t,r){const Gt=t,{addEndListener:s,appear:c=!0,children:f,easing:_,in:x,onEnter:a,onEntered:I,onEntering:D,onExit:O,onExited:F,onExiting:H,style:Q,timeout:ie="auto",TransitionComponent:te=Yu}=Gt,W=On(Gt,["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"]),X=mH(),ee=G.useRef(),fe=O5(),ye=G.useRef(null),Ee=Bo(ye,Eb(f),r),re=qt=>It=>{if(qt){const ct=ye.current;It===void 0?qt(ct):qt(ct,It)}},he=re(D),_e=re((qt,It)=>{CH(qt);const{duration:ct,delay:Ut,easing:Kt}=eI({style:Q,timeout:ie,easing:_},{mode:"enter"});let at;ie==="auto"?(at=fe.transitions.getAutoHeightDuration(qt.clientHeight),ee.current=at):at=ct,qt.style.transition=[fe.transitions.create("opacity",{duration:at,delay:Ut}),fe.transitions.create("transform",{duration:jR?at:at*.666,delay:Ut,easing:Kt})].join(","),a&&a(qt,It)}),Se=re(I),J=re(H),Ie=re(qt=>{const{duration:It,delay:ct,easing:Ut}=eI({style:Q,timeout:ie,easing:_},{mode:"exit"});let Kt;ie==="auto"?(Kt=fe.transitions.getAutoHeightDuration(qt.clientHeight),ee.current=Kt):Kt=It,qt.style.transition=[fe.transitions.create("opacity",{duration:Kt,delay:ct}),fe.transitions.create("transform",{duration:jR?Kt:Kt*.666,delay:jR?ct:ct||Kt*.333,easing:Ut})].join(","),qt.style.opacity=0,qt.style.transform=Jk(.75),O&&O(qt)}),we=re(F),Lt=qt=>{ie==="auto"&&X.start(ee.current||0,qt),s&&s(ye.current,qt)};return N.jsx(te,_t(de({appear:c,in:x,nodeRef:ye,onEnter:_e,onEntered:Se,onEntering:he,onExit:Ie,onExited:we,onExiting:J,addEndListener:Lt,timeout:ie==="auto"?null:ie},W),{children:(qt,It)=>G.cloneElement(f,de({style:de(de(de({opacity:0,transform:Jk(.75),visibility:qt==="exited"&&!x?"hidden":void 0},_xe[qt]),Q),f.props.style),ref:Ee},It))}))});e4&&(e4.muiSupportAuto=!0);const yxe=e=>{const{classes:t,disableUnderline:r}=e,c=Ni({root:["root",!r&&"underline"],input:["input"]},Qve,t);return de(de({},t),c)},vxe=nr(nA,{shouldForwardProp:e=>Ka(e)||e==="classes",name:"MuiInput",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[...eA(e,t),!r.disableUnderline&&t.underline]}})(us(({theme:e})=>{let r=e.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return e.vars&&(r=`rgba(${e.vars.palette.common.onBackgroundChannel} / ${e.vars.opacity.inputUnderline})`),{position:"relative",variants:[{props:({ownerState:s})=>s.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:s})=>!s.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Jv.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Jv.error}`]:{"&::before, &::after":{borderBottomColor:(e.vars||e).palette.error.main}},"&::before":{borderBottom:`1px solid ${r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Jv.disabled}, .${Jv.error}):before`]:{borderBottom:`2px solid ${(e.vars||e).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${r}`}},[`&.${Jv.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(e.palette).filter(([,s])=>s&&s.main).map(([s])=>({props:{color:s,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(e.vars||e).palette[s].main}`}}}))]}})),xxe=nr(rA,{name:"MuiInput",slot:"Input",overridesResolver:tA})({}),iI=G.forwardRef(function(t,r){var ye,Ee,re,he;const s=hs({props:t,name:"MuiInput"}),fe=s,{disableUnderline:c=!1,components:f={},componentsProps:_,fullWidth:x=!1,inputComponent:a="input",multiline:I=!1,slotProps:D,slots:O={},type:F="text"}=fe,H=On(fe,["disableUnderline","components","componentsProps","fullWidth","inputComponent","multiline","slotProps","slots","type"]),Q=yxe(s),te={root:{ownerState:{disableUnderline:c}}},W=(D!=null?D:_)?na(D!=null?D:_,te):te,X=(Ee=(ye=O.root)!=null?ye:f.Root)!=null?Ee:vxe,ee=(he=(re=O.input)!=null?re:f.Input)!=null?he:xxe;return N.jsx(B5,_t(de({slots:{root:X,input:ee},slotProps:W,fullWidth:x,inputComponent:a,multiline:I,ref:r,type:F},H),{classes:Q}))});iI&&(iI.muiName="Input");function bxe(e){return Di("MuiInputLabel",e)}Oi("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const wxe=e=>{const{classes:t,formControl:r,size:s,shrink:c,disableAnimation:f,variant:_,required:x}=e,a={root:["root",r&&"formControl",!f&&"animated",c&&"shrink",s&&s!=="normal"&&`size${tr(s)}`,_],asterisk:[x&&"asterisk"]},I=Ni(a,bxe,t);return de(de({},t),I)},Txe=nr(gxe,{shouldForwardProp:e=>Ka(e)||e==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{[`& .${W1.asterisk}`]:t.asterisk},t.root,r.formControl&&t.formControl,r.size==="small"&&t.sizeSmall,r.shrink&&t.shrink,!r.disableAnimation&&t.animated,r.focused&&t.focused,t[r.variant]]}})(us(({theme:e})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:t})=>t.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:t})=>t.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:t})=>!t.disableAnimation,style:{transition:e.transitions.create(["color","transform","max-width"],{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:t,ownerState:r})=>t==="filled"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:t,ownerState:r,size:s})=>t==="filled"&&r.shrink&&s==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:t,ownerState:r})=>t==="outlined"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),Exe=G.forwardRef(function(t,r){const s=hs({name:"MuiInputLabel",props:t}),ie=s,{disableAnimation:c=!1,margin:f,shrink:_,variant:x,className:a}=ie,I=On(ie,["disableAnimation","margin","shrink","variant","className"]),D=ud();let O=_;typeof O=="undefined"&&D&&(O=D.filled||D.focused||D.adornedStart);const F=ip({props:s,muiFormControl:D,states:["size","variant","required","focused"]}),H=_t(de({},s),{disableAnimation:c,formControl:D,shrink:O,size:F.size,variant:F.variant,required:F.required,focused:F.focused}),Q=wxe(H);return N.jsx(Txe,_t(de({"data-shrink":O,ref:r,className:Or(Q.root,a)},I),{ownerState:H,classes:Q}))}),Sxe=G.createContext({});function Ixe(e){return Di("MuiList",e)}Oi("MuiList",["root","padding","dense","subheader"]);const Cxe=e=>{const{classes:t,disablePadding:r,dense:s,subheader:c}=e;return Ni({root:["root",!r&&"padding",s&&"dense",c&&"subheader"]},Ixe,t)},Axe=nr("ul",{name:"MuiList",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,!r.disablePadding&&t.padding,r.dense&&t.dense,r.subheader&&t.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:e})=>!e.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:e})=>e.subheader,style:{paddingTop:0}}]}),Pxe=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiList"}),Q=s,{children:c,className:f,component:_="ul",dense:x=!1,disablePadding:a=!1,subheader:I}=Q,D=On(Q,["children","className","component","dense","disablePadding","subheader"]),O=G.useMemo(()=>({dense:x}),[x]),F=_t(de({},s),{component:_,dense:x,disablePadding:a}),H=Cxe(F);return N.jsx(Sxe.Provider,{value:O,children:N.jsxs(Axe,_t(de({as:_,className:Or(H.root,f),ref:r,ownerState:F},D),{children:[I,c]}))})});function UR(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function LV(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function PH(e,t){if(t===void 0)return!0;let r=e.innerText;return r===void 0&&(r=e.textContent),r=r.trim().toLowerCase(),r.length===0?!1:t.repeating?r[0]===t.keys[0]:r.startsWith(t.keys.join(""))}function e1(e,t,r,s,c,f){let _=!1,x=c(e,t,t?r:!1);for(;x;){if(x===e.firstChild){if(_)return!1;_=!0}const a=s?!1:x.disabled||x.getAttribute("aria-disabled")==="true";if(!x.hasAttribute("tabindex")||!PH(x,f)||a)x=c(e,x,r);else return x.focus(),!0}return!1}const Rxe=G.forwardRef(function(t,r){const ee=t,{actions:s,autoFocus:c=!1,autoFocusItem:f=!1,children:_,className:x,disabledItemsFocusable:a=!1,disableListWrap:I=!1,onKeyDown:D,variant:O="selectedMenu"}=ee,F=On(ee,["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"]),H=G.useRef(null),Q=G.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});qf(()=>{c&&H.current.focus()},[c]),G.useImperativeHandle(s,()=>({adjustStyleForScrollbar:(fe,{direction:ye})=>{const Ee=!H.current.style.width;if(fe.clientHeight<H.current.clientHeight&&Ee){const re=`${gH(vl(fe))}px`;H.current.style[ye==="rtl"?"paddingLeft":"paddingRight"]=re,H.current.style.width=`calc(100% + ${re})`}return H.current}}),[]);const ie=fe=>{const ye=H.current,Ee=fe.key;if(fe.ctrlKey||fe.metaKey||fe.altKey){D&&D(fe);return}const he=vl(ye).activeElement;if(Ee==="ArrowDown")fe.preventDefault(),e1(ye,he,I,a,UR);else if(Ee==="ArrowUp")fe.preventDefault(),e1(ye,he,I,a,LV);else if(Ee==="Home")fe.preventDefault(),e1(ye,null,I,a,UR);else if(Ee==="End")fe.preventDefault(),e1(ye,null,I,a,LV);else if(Ee.length===1){const _e=Q.current,Se=Ee.toLowerCase(),J=performance.now();_e.keys.length>0&&(J-_e.lastTime>500?(_e.keys=[],_e.repeating=!0,_e.previousKeyMatched=!0):_e.repeating&&Se!==_e.keys[0]&&(_e.repeating=!1)),_e.lastTime=J,_e.keys.push(Se);const Ie=he&&!_e.repeating&&PH(he,_e);_e.previousKeyMatched&&(Ie||e1(ye,he,!1,a,UR,_e))?fe.preventDefault():_e.previousKeyMatched=!1}D&&D(fe)},te=Bo(H,r);let W=-1;G.Children.forEach(_,(fe,ye)=>{if(!G.isValidElement(fe)){W===ye&&(W+=1,W>=_.length&&(W=-1));return}fe.props.disabled||(O==="selectedMenu"&&fe.props.selected||W===-1)&&(W=ye),W===ye&&(fe.props.disabled||fe.props.muiSkipListHighlight||fe.type.muiSkipListHighlight)&&(W+=1,W>=_.length&&(W=-1))});const X=G.Children.map(_,(fe,ye)=>{if(ye===W){const Ee={};return f&&(Ee.autoFocus=!0),fe.props.tabIndex===void 0&&O==="selectedMenu"&&(Ee.tabIndex=0),G.cloneElement(fe,Ee)}return fe});return N.jsx(Pxe,_t(de({role:"menu",ref:te,className:x,onKeyDown:ie,tabIndex:c?0:-1},F),{children:X}))});function Mxe(e){return Di("MuiPopover",e)}Oi("MuiPopover",["root","paper"]);function zV(e,t){let r=0;return typeof t=="number"?r=t:t==="center"?r=e.height/2:t==="bottom"&&(r=e.height),r}function NV(e,t){let r=0;return typeof t=="number"?r=t:t==="center"?r=e.width/2:t==="right"&&(r=e.width),r}function FV(e){return[e.horizontal,e.vertical].map(t=>typeof t=="number"?`${t}px`:t).join(" ")}function VR(e){return typeof e=="function"?e():e}const kxe=e=>{const{classes:t}=e;return Ni({root:["root"],paper:["paper"]},Mxe,t)},Dxe=nr(G1e,{name:"MuiPopover",slot:"Root",overridesResolver:(e,t)=>t.root})({}),RH=nr(yve,{name:"MuiPopover",slot:"Paper",overridesResolver:(e,t)=>t.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),Oxe=G.forwardRef(function(t,r){var qn;const s=hs({props:t,name:"MuiPopover"}),mr=s,{action:c,anchorEl:f,anchorOrigin:_={vertical:"top",horizontal:"left"},anchorPosition:x,anchorReference:a="anchorEl",children:I,className:D,container:O,elevation:F=8,marginThreshold:H=16,open:Q,PaperProps:ie={},slots:te={},slotProps:W={},transformOrigin:X={vertical:"top",horizontal:"left"},TransitionComponent:ee=e4,transitionDuration:fe="auto",TransitionProps:An={}}=mr,cr=An,{onEntering:ye}=cr,Ee=On(cr,["onEntering"]),zr=mr,{disableScrollLock:re=!1}=zr,he=On(zr,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps","disableScrollLock"]),_e=(qn=W==null?void 0:W.paper)!=null?qn:ie,Se=G.useRef(),J=_t(de({},s),{anchorOrigin:_,anchorReference:a,elevation:F,marginThreshold:H,externalPaperSlotProps:_e,transformOrigin:X,TransitionComponent:ee,transitionDuration:fe,TransitionProps:Ee}),Ie=kxe(J),we=G.useCallback(()=>{if(a==="anchorPosition")return x;const kn=VR(f),Ue=(kn&&kn.nodeType===1?kn:vl(Se.current).body).getBoundingClientRect();return{top:Ue.top+zV(Ue,_.vertical),left:Ue.left+NV(Ue,_.horizontal)}},[f,_.horizontal,_.vertical,x,a]),Lt=G.useCallback(kn=>({vertical:zV(kn,X.vertical),horizontal:NV(kn,X.horizontal)}),[X.horizontal,X.vertical]),Gt=G.useCallback(kn=>{const zn={width:kn.offsetWidth,height:kn.offsetHeight},Ue=Lt(zn);if(a==="none")return{top:null,left:null,transformOrigin:FV(Ue)};const Ye=we();let gt=Ye.top-Ue.vertical,Qe=Ye.left-Ue.horizontal;const pt=gt+zn.height,dt=Qe+zn.width,sn=Xm(VR(f)),Wt=sn.innerHeight-H,pn=sn.innerWidth-H;if(H!==null&&gt<H){const Sn=gt-H;gt-=Sn,Ue.vertical+=Sn}else if(H!==null&&pt>Wt){const Sn=pt-Wt;gt-=Sn,Ue.vertical+=Sn}if(H!==null&&Qe<H){const Sn=Qe-H;Qe-=Sn,Ue.horizontal+=Sn}else if(dt>pn){const Sn=dt-pn;Qe-=Sn,Ue.horizontal+=Sn}return{top:`${Math.round(gt)}px`,left:`${Math.round(Qe)}px`,transformOrigin:FV(Ue)}},[f,a,we,Lt,H]),[qt,It]=G.useState(Q),ct=G.useCallback(()=>{const kn=Se.current;if(!kn)return;const zn=Gt(kn);zn.top!==null&&(kn.style.top=zn.top),zn.left!==null&&(kn.style.left=zn.left),kn.style.transformOrigin=zn.transformOrigin,It(!0)},[Gt]);G.useEffect(()=>(re&&window.addEventListener("scroll",ct),()=>window.removeEventListener("scroll",ct)),[f,re,ct]);const Ut=(kn,zn)=>{ye&&ye(kn,zn),ct()},Kt=()=>{It(!1)};G.useEffect(()=>{Q&&ct()}),G.useImperativeHandle(c,()=>Q?{updatePosition:()=>{ct()}}:null,[Q,ct]),G.useEffect(()=>{if(!Q)return;const kn=fH(()=>{ct()}),zn=Xm(f);return zn.addEventListener("resize",kn),()=>{kn.clear(),zn.removeEventListener("resize",kn)}},[f,Q,ct]);let at=fe;fe==="auto"&&!ee.muiSupportAuto&&(at=void 0);const At=O||(f?vl(VR(f)).body:void 0),Et={slots:te,slotProps:_t(de({},W),{paper:_e})},[Jt,Bt]=Zl("paper",{elementType:RH,externalForwardedProps:Et,additionalProps:{elevation:F,className:Or(Ie.paper,_e==null?void 0:_e.className),style:qt?_e.style:_t(de({},_e.style),{opacity:0})},ownerState:J}),[Pn,Mr]=Zl("root",{elementType:Dxe,externalForwardedProps:Et,additionalProps:{slotProps:{backdrop:{invisible:!0}},container:At,open:Q},ownerState:J,className:Or(Ie.root,D)}),Vr=Mr,{slotProps:$n}=Vr,Qn=On(Vr,["slotProps"]),Xt=Bo(Se,Bt.ref);return N.jsx(Pn,_t(de(de(de({},Qn),!Yk(Pn)&&{slotProps:$n,disableScrollLock:re}),he),{ref:r,children:N.jsx(ee,_t(de({appear:!0,in:Q,onEntering:Ut,onExited:Kt,timeout:at},Ee),{children:N.jsx(Jt,_t(de({},Bt),{ref:Xt,children:I}))}))}))});function Lxe(e){return Di("MuiMenu",e)}Oi("MuiMenu",["root","paper","list"]);const zxe={vertical:"top",horizontal:"right"},Nxe={vertical:"top",horizontal:"left"},Fxe=e=>{const{classes:t}=e;return Ni({root:["root"],paper:["paper"],list:["list"]},Lxe,t)},Bxe=nr(Oxe,{shouldForwardProp:e=>Ka(e)||e==="classes",name:"MuiMenu",slot:"Root",overridesResolver:(e,t)=>t.root})({}),jxe=nr(RH,{name:"MuiMenu",slot:"Paper",overridesResolver:(e,t)=>t.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),Uxe=nr(Rxe,{name:"MuiMenu",slot:"List",overridesResolver:(e,t)=>t.list})({outline:0}),Vxe=G.forwardRef(function(t,r){var Kt,at;const s=hs({props:t,name:"MuiMenu"}),qt=s,{autoFocus:c=!0,children:f,className:_,disableAutoFocusItem:x=!1,MenuListProps:a={},onClose:I,open:D,PaperProps:O={},PopoverClasses:F,transitionDuration:H="auto",TransitionProps:It={}}=qt,ct=It,{onEntering:Q}=ct,ie=On(ct,["onEntering"]),Ut=qt,{variant:te="selectedMenu",slots:W={},slotProps:X={}}=Ut,ee=On(Ut,["autoFocus","children","className","disableAutoFocusItem","MenuListProps","onClose","open","PaperProps","PopoverClasses","transitionDuration","TransitionProps","variant","slots","slotProps"]),fe=m0e(),ye=_t(de({},s),{autoFocus:c,disableAutoFocusItem:x,MenuListProps:a,onEntering:Q,PaperProps:O,transitionDuration:H,TransitionProps:ie,variant:te}),Ee=Fxe(ye),re=c&&!x&&D,he=G.useRef(null),_e=(At,Et)=>{he.current&&he.current.adjustStyleForScrollbar(At,{direction:fe?"rtl":"ltr"}),Q&&Q(At,Et)},Se=At=>{At.key==="Tab"&&(At.preventDefault(),I&&I(At,"tabKeyDown"))};let J=-1;G.Children.map(f,(At,Et)=>{G.isValidElement(At)&&(At.props.disabled||(te==="selectedMenu"&&At.props.selected||J===-1)&&(J=Et))});const Ie=(Kt=W.paper)!=null?Kt:jxe,we=(at=X.paper)!=null?at:O,Lt=QS({elementType:W.root,externalSlotProps:X.root,ownerState:ye,className:[Ee.root,_]}),Gt=QS({elementType:Ie,externalSlotProps:we,ownerState:ye,className:Ee.paper});return N.jsx(Bxe,_t(de({onClose:I,anchorOrigin:{vertical:"bottom",horizontal:fe?"right":"left"},transformOrigin:fe?zxe:Nxe,slots:{paper:Ie,root:W.root},slotProps:{root:Lt,paper:Gt},open:D,ref:r,transitionDuration:H,TransitionProps:de({onEntering:_e},ie),ownerState:ye},ee),{classes:F,children:N.jsx(Uxe,_t(de({onKeyDown:Se,actions:he,autoFocus:c&&(J===-1||x),autoFocusItem:re,variant:te},a),{className:Or(Ee.list,a.className),children:f}))}))});function $xe(e){return Di("MuiNativeSelect",e)}const j5=Oi("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),qxe=e=>{const{classes:t,variant:r,disabled:s,multiple:c,open:f,error:_}=e,x={select:["select",r,s&&"disabled",c&&"multiple",_&&"error"],icon:["icon",`icon${tr(r)}`,f&&"iconOpen",s&&"disabled"]};return Ni(x,$xe,t)},MH=nr("select")(({theme:e})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${j5.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(e.vars||e).palette.background.paper},variants:[{props:({ownerState:t})=>t.variant!=="filled"&&t.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(e.vars||e).shape.borderRadius,"&:focus":{borderRadius:(e.vars||e).shape.borderRadius},"&&&":{paddingRight:32}}}]})),Gxe=nr(MH,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Ka,overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.select,t[r.variant],r.error&&t.error,{[`&.${j5.multiple}`]:t.multiple}]}})({}),kH=nr("svg")(({theme:e})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(e.vars||e).palette.action.active,[`&.${j5.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:({ownerState:t})=>t.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),Wxe=nr(kH,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.icon,r.variant&&t[`icon${tr(r.variant)}`],r.open&&t.iconOpen]}})({}),Hxe=G.forwardRef(function(t,r){const F=t,{className:s,disabled:c,error:f,IconComponent:_,inputRef:x,variant:a="standard"}=F,I=On(F,["className","disabled","error","IconComponent","inputRef","variant"]),D=_t(de({},t),{disabled:c,variant:a,error:f}),O=qxe(D);return N.jsxs(G.Fragment,{children:[N.jsx(Gxe,de({ownerState:D,className:Or(O.select,s),disabled:c,ref:x||r},I)),t.multiple?null:N.jsx(Wxe,{as:_,ownerState:D,className:O.icon})]})});var BV;const Zxe=nr("fieldset",{shouldForwardProp:Ka})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),Xxe=nr("legend",{shouldForwardProp:Ka})(us(({theme:e})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:t})=>!t.withLabel,style:{padding:0,lineHeight:"11px",transition:e.transitions.create("width",{duration:150,easing:e.transitions.easing.easeOut})}},{props:({ownerState:t})=>t.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:e.transitions.create("max-width",{duration:50,easing:e.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:t})=>t.withLabel&&t.notched,style:{maxWidth:"100%",transition:e.transitions.create("max-width",{duration:100,easing:e.transitions.easing.easeOut,delay:50})}}]})));function Kxe(e){const I=e,{children:t,classes:r,className:s,label:c,notched:f}=I,_=On(I,["children","classes","className","label","notched"]),x=c!=null&&c!=="",a=_t(de({},e),{notched:f,withLabel:x});return N.jsx(Zxe,_t(de({"aria-hidden":!0,className:s,ownerState:a},_),{children:N.jsx(Xxe,{ownerState:a,children:x?N.jsx("span",{children:c}):BV||(BV=N.jsx("span",{className:"notranslate",children:""}))})}))}const Qxe=e=>{const{classes:t}=e,s=Ni({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},Yve,t);return de(de({},t),s)},Yxe=nr(nA,{shouldForwardProp:e=>Ka(e)||e==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:eA})(us(({theme:e})=>{const t=e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(e.vars||e).shape.borderRadius,[`&:hover .${Eu.notchedOutline}`]:{borderColor:(e.vars||e).palette.text.primary},[`&.${Eu.focused} .${Eu.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(e.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{[`&.${Eu.focused} .${Eu.notchedOutline}`]:{borderColor:(e.vars||e).palette[r].main}}})),{props:{},style:{"@media (hover: none)":{[`&:hover .${Eu.notchedOutline}`]:{borderColor:e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:t}},[`&.${Eu.error} .${Eu.notchedOutline}`]:{borderColor:(e.vars||e).palette.error.main},[`&.${Eu.disabled} .${Eu.notchedOutline}`]:{borderColor:(e.vars||e).palette.action.disabled}}},{props:({ownerState:r})=>r.startAdornment,style:{paddingLeft:14}},{props:({ownerState:r})=>r.endAdornment,style:{paddingRight:14}},{props:({ownerState:r})=>r.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:r,size:s})=>r.multiline&&s==="small",style:{padding:"8.5px 14px"}}]}})),Jxe=nr(Kxe,{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(e,t)=>t.notchedOutline})(us(({theme:e})=>{const t=e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:t}})),ebe=nr(rA,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:tA})(us(({theme:e})=>_t(de(de({padding:"16.5px 14px"},!e.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:e.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:e.palette.mode==="light"?null:"#fff",caretColor:e.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}}),e.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[e.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}}),{variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:t})=>t.multiline,style:{padding:0}},{props:({ownerState:t})=>t.startAdornment,style:{paddingLeft:0}},{props:({ownerState:t})=>t.endAdornment,style:{paddingRight:0}}]}))),sI=G.forwardRef(function(t,r){var ye,Ee,re,he;var s;const c=hs({props:t,name:"MuiOutlinedInput"}),fe=c,{components:f={},fullWidth:_=!1,inputComponent:x="input",label:a,multiline:I=!1,notched:D,slots:O={},type:F="text"}=fe,H=On(fe,["components","fullWidth","inputComponent","label","multiline","notched","slots","type"]),Q=Qxe(c),ie=ud(),te=ip({props:c,muiFormControl:ie,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),W=_t(de({},c),{color:te.color||"primary",disabled:te.disabled,error:te.error,focused:te.focused,formControl:ie,fullWidth:_,hiddenLabel:te.hiddenLabel,multiline:I,size:te.size,type:F}),X=(Ee=(ye=O.root)!=null?ye:f.Root)!=null?Ee:Yxe,ee=(he=(re=O.input)!=null?re:f.Input)!=null?he:ebe;return N.jsx(B5,_t(de({slots:{root:X,input:ee},renderSuffix:_e=>N.jsx(Jxe,{ownerState:W,className:Q.notchedOutline,label:a!=null&&a!==""&&te.required?s||(s=N.jsxs(G.Fragment,{children:[a,"","*"]})):a,notched:typeof D!="undefined"?D:!!(_e.startAdornment||_e.filled||_e.focused)}),fullWidth:_,inputComponent:x,multiline:I,ref:r,type:F},H),{classes:_t(de({},Q),{notchedOutline:null})}))});sI&&(sI.muiName="Input");const tbe=cd(N.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),nbe=cd(N.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),rbe=nr("span",{shouldForwardProp:Ka})({position:"relative",display:"flex"}),ibe=nr(tbe)({transform:"scale(1)"}),sbe=nr(nbe)(us(({theme:e})=>({left:0,position:"absolute",transform:"scale(0)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeIn,duration:e.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:e.transitions.create("transform",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.shortest})}}]})));function DH(e){const{checked:t=!1,classes:r={},fontSize:s}=e,c=_t(de({},e),{checked:t});return N.jsxs(rbe,{className:r.root,ownerState:c,children:[N.jsx(ibe,{fontSize:s,className:r.background,ownerState:c}),N.jsx(sbe,{fontSize:s,className:r.dot,ownerState:c})]})}const OH=G.createContext(void 0);function obe(){return G.useContext(OH)}function abe(e){return Di("MuiRadio",e)}const jV=Oi("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),lbe=e=>{const{classes:t,color:r,size:s}=e,c={root:["root",`color${tr(r)}`,s!=="medium"&&`size${tr(s)}`]};return de(de({},t),Ni(c,abe,t))},cbe=nr(E1e,{shouldForwardProp:e=>Ka(e)||e==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.size!=="medium"&&t[`size${tr(r.size)}`],t[`color${tr(r.color)}`]]}})(us(({theme:e})=>({color:(e.vars||e).palette.text.secondary,[`&.${jV.disabled}`]:{color:(e.vars||e).palette.action.disabled},variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:Hl(e.palette.action.active,e.palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t,disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:Hl(e.palette[t].main,e.palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(([,t])=>t&&t.main).map(([t])=>({props:{color:t},style:{[`&.${jV.checked}`]:{color:(e.vars||e).palette[t].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function ube(e,t){return typeof t=="object"&&t!==null?e===t:String(e)===String(t)}const UV=N.jsx(DH,{checked:!0}),VV=N.jsx(DH,{}),hbe=G.forwardRef(function(t,r){var ye,Ee;const s=hs({props:t,name:"MuiRadio"}),fe=s,{checked:c,checkedIcon:f=UV,color:_="primary",icon:x=VV,name:a,onChange:I,size:D="medium",className:O,disableRipple:F=!1}=fe,H=On(fe,["checked","checkedIcon","color","icon","name","onChange","size","className","disableRipple"]),Q=_t(de({},s),{disableRipple:F,color:_,size:D}),ie=lbe(Q),te=obe();let W=c;const X=Gk(I,te&&te.onChange);let ee=a;return te&&(typeof W=="undefined"&&(W=ube(te.value,s.value)),typeof ee=="undefined"&&(ee=te.name)),N.jsx(cbe,de({type:"radio",icon:G.cloneElement(x,{fontSize:(ye=VV.props.fontSize)!=null?ye:D}),checkedIcon:G.cloneElement(f,{fontSize:(Ee=UV.props.fontSize)!=null?Ee:D}),ownerState:Q,classes:ie,name:ee,checked:W,onChange:X,ref:r,className:Or(ie.root,O)},H))});function dbe(e){return Di("MuiRadioGroup",e)}Oi("MuiRadioGroup",["root","row","error"]);const fbe=e=>{const{classes:t,row:r,error:s}=e;return Ni({root:["root",r&&"row",s&&"error"]},dbe,t)},pbe=G.forwardRef(function(t,r){const X=t,{actions:s,children:c,className:f,defaultValue:_,name:x,onChange:a,value:I}=X,D=On(X,["actions","children","className","defaultValue","name","onChange","value"]),O=G.useRef(null),F=fbe(t),[H,Q]=KS({controlled:I,default:_,name:"RadioGroup"});G.useImperativeHandle(s,()=>({focus:()=>{let ee=O.current.querySelector("input:not(:disabled):checked");ee||(ee=O.current.querySelector("input:not(:disabled)")),ee&&ee.focus()}}),[]);const ie=Bo(r,O),te=M5(x),W=G.useMemo(()=>({name:te,onChange(ee){Q(ee.target.value),a&&a(ee,ee.target.value)},value:H}),[te,a,Q,H]);return N.jsx(OH.Provider,{value:W,children:N.jsx(axe,_t(de({role:"radiogroup",ref:ie,className:Or(F.root,f)},D),{children:c}))})});function mbe(e){return Di("MuiSelect",e)}const t1=Oi("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var $V;const gbe=nr(MH,{name:"MuiSelect",slot:"Select",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[{[`&.${t1.select}`]:t.select},{[`&.${t1.select}`]:t[r.variant]},{[`&.${t1.error}`]:t.error},{[`&.${t1.multiple}`]:t.multiple}]}})({[`&.${t1.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),_be=nr(kH,{name:"MuiSelect",slot:"Icon",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.icon,r.variant&&t[`icon${tr(r.variant)}`],r.open&&t.iconOpen]}})({}),ybe=nr("input",{shouldForwardProp:e=>EH(e)&&e!=="classes",name:"MuiSelect",slot:"NativeInput",overridesResolver:(e,t)=>t.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function qV(e,t){return typeof t=="object"&&t!==null?e===t:String(e)===String(t)}function vbe(e){return e==null||typeof e=="string"&&!e.trim()}const xbe=e=>{const{classes:t,variant:r,disabled:s,multiple:c,open:f,error:_}=e,x={select:["select",r,s&&"disabled",c&&"multiple",_&&"error"],icon:["icon",`icon${tr(r)}`,f&&"iconOpen",s&&"disabled"],nativeInput:["nativeInput"]};return Ni(x,mbe,t)},bbe=G.forwardRef(function(t,r){var di;const Nr=t,{"aria-describedby":s,"aria-label":c,autoFocus:f,autoWidth:_,children:x,className:a,defaultOpen:I,defaultValue:D,disabled:O,displayEmpty:F,error:H=!1,IconComponent:Q,inputRef:ie,labelId:te,MenuProps:W={},multiple:X,name:ee,onBlur:fe,onChange:ye,onClose:Ee,onFocus:re,onOpen:he,open:_e,readOnly:Se,renderValue:J,SelectDisplayProps:Ie={},tabIndex:we,type:Lt,value:Gt,variant:qt="standard"}=Nr,It=On(Nr,["aria-describedby","aria-label","autoFocus","autoWidth","children","className","defaultOpen","defaultValue","disabled","displayEmpty","error","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"]),[ct,Ut]=KS({controlled:Gt,default:D,name:"Select"}),[Kt,at]=KS({controlled:_e,default:I,name:"Select"}),At=G.useRef(null),Et=G.useRef(null),[Jt,Bt]=G.useState(null),{current:Pn}=G.useRef(_e!=null),[$n,Qn]=G.useState(),Xt=Bo(r,ie),mr=G.useCallback(En=>{Et.current=En,En&&Bt(En)},[]),An=Jt==null?void 0:Jt.parentNode;G.useImperativeHandle(Xt,()=>({focus:()=>{Et.current.focus()},node:At.current,value:ct}),[ct]),G.useEffect(()=>{I&&Kt&&Jt&&!Pn&&(Qn(_?null:An.clientWidth),Et.current.focus())},[Jt,_]),G.useEffect(()=>{f&&Et.current.focus()},[f]),G.useEffect(()=>{if(!te)return;const En=vl(Et.current).getElementById(te);if(En){const hn=()=>{getSelection().isCollapsed&&Et.current.focus()};return En.addEventListener("click",hn),()=>{En.removeEventListener("click",hn)}}},[te]);const cr=(En,hn)=>{En?he&&he(hn):Ee&&Ee(hn),Pn||(Qn(_?null:An.clientWidth),at(En))},zr=En=>{En.button===0&&(En.preventDefault(),Et.current.focus(),cr(!0,En))},qn=En=>{cr(!1,En)},Mr=G.Children.toArray(x),Vr=En=>{const hn=Mr.find(bi=>bi.props.value===En.target.value);hn!==void 0&&(Ut(hn.props.value),ye&&ye(En,hn))},kn=En=>hn=>{let bi;if(hn.currentTarget.hasAttribute("tabindex")){if(X){bi=Array.isArray(ct)?ct.slice():[];const ci=ct.indexOf(En.props.value);ci===-1?bi.push(En.props.value):bi.splice(ci,1)}else bi=En.props.value;if(En.props.onClick&&En.props.onClick(hn),ct!==bi&&(Ut(bi),ye)){const ci=hn.nativeEvent||hn,Us=new ci.constructor(ci.type,ci);Object.defineProperty(Us,"target",{writable:!0,value:{value:bi,name:ee}}),ye(Us,En)}X||cr(!1,hn)}},zn=En=>{Se||[" ","ArrowUp","ArrowDown","Enter"].includes(En.key)&&(En.preventDefault(),cr(!0,En))},Ue=Jt!==null&&Kt,Ye=En=>{!Ue&&fe&&(Object.defineProperty(En,"target",{writable:!0,value:{value:ct,name:ee}}),fe(En))};delete It["aria-invalid"];let gt,Qe;const pt=[];let dt=!1;(nI({value:ct})||F)&&(J?gt=J(ct):dt=!0);const sn=Mr.map(En=>{if(!G.isValidElement(En))return null;let hn;if(X){if(!Array.isArray(ct))throw new Error(nd(2));hn=ct.some(bi=>qV(bi,En.props.value)),hn&&dt&&pt.push(En.props.children)}else hn=qV(ct,En.props.value),hn&&dt&&(Qe=En.props.children);return G.cloneElement(En,{"aria-selected":hn?"true":"false",onClick:kn(En),onKeyUp:bi=>{bi.key===" "&&bi.preventDefault(),En.props.onKeyUp&&En.props.onKeyUp(bi)},role:"option",selected:hn,value:void 0,"data-value":En.props.value})});dt&&(X?pt.length===0?gt=null:gt=pt.reduce((En,hn,bi)=>(En.push(hn),bi<pt.length-1&&En.push(", "),En),[]):gt=Qe);let Wt=$n;!_&&Pn&&Jt&&(Wt=An.clientWidth);let pn;typeof we!="undefined"?pn=we:pn=O?null:0;const Sn=Ie.id||(ee?`mui-component-select-${ee}`:void 0),gr=_t(de({},t),{variant:qt,value:ct,open:Ue,error:H}),xi=xbe(gr),Yr=de(de({},W.PaperProps),(di=W.slotProps)==null?void 0:di.paper),Li=M5();return N.jsxs(G.Fragment,{children:[N.jsx(gbe,_t(de({as:"div",ref:mr,tabIndex:pn,role:"combobox","aria-controls":Li,"aria-disabled":O?"true":void 0,"aria-expanded":Ue?"true":"false","aria-haspopup":"listbox","aria-label":c,"aria-labelledby":[te,Sn].filter(Boolean).join(" ")||void 0,"aria-describedby":s,onKeyDown:zn,onMouseDown:O||Se?null:zr,onBlur:Ye,onFocus:re},Ie),{ownerState:gr,className:Or(Ie.className,xi.select,a),id:Sn,children:vbe(gt)?$V||($V=N.jsx("span",{className:"notranslate",children:""})):gt})),N.jsx(ybe,_t(de({"aria-invalid":H,value:Array.isArray(ct)?ct.join(","):ct,name:ee,ref:At,"aria-hidden":!0,onChange:Vr,tabIndex:-1,disabled:O,className:xi.nativeInput,autoFocus:f},It),{ownerState:gr})),N.jsx(_be,{as:Q,className:xi.icon,ownerState:gr}),N.jsx(Vxe,_t(de({id:`menu-${ee||""}`,anchorEl:An,open:Ue,onClose:qn,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},W),{MenuListProps:de({"aria-labelledby":te,role:"listbox","aria-multiselectable":X?"true":void 0,disableListWrap:!0,id:Li},W.MenuListProps),slotProps:_t(de({},W.slotProps),{paper:_t(de({},Yr),{style:de({minWidth:Wt},Yr!=null?Yr.style:null)})}),children:sn}))]})}),wbe=e=>{const{classes:t}=e;return t},U5={name:"MuiSelect",overridesResolver:(e,t)=>t.root,shouldForwardProp:e=>Ka(e)&&e!=="variant",slot:"Root"},Tbe=nr(iI,U5)(""),Ebe=nr(sI,U5)(""),Sbe=nr(rI,U5)(""),LH=G.forwardRef(function(t,r){const s=tve({name:"MuiSelect",props:t}),Kt=s,{autoWidth:c=!1,children:f,classes:_={},className:x,defaultOpen:a=!1,displayEmpty:I=!1,IconComponent:D=e1e,id:O,input:F,inputProps:H,label:Q,labelId:ie,MenuProps:te,multiple:W=!1,native:X=!1,onClose:ee,onOpen:fe,open:ye,renderValue:Ee,SelectDisplayProps:re,variant:he="outlined"}=Kt,_e=On(Kt,["autoWidth","children","classes","className","defaultOpen","displayEmpty","IconComponent","id","input","inputProps","label","labelId","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"]),Se=X?Hxe:bbe,J=ud(),Ie=ip({props:s,muiFormControl:J,states:["variant","error"]}),we=Ie.variant||he,Lt=_t(de({},s),{variant:we,classes:_}),Gt=wbe(Lt),at=Gt,{root:qt}=at,It=On(at,["root"]),ct=F||{standard:N.jsx(Tbe,{ownerState:Lt}),outlined:N.jsx(Ebe,{label:Q,ownerState:Lt}),filled:N.jsx(Sbe,{ownerState:Lt})}[we],Ut=Bo(r,Eb(ct));return N.jsx(G.Fragment,{children:G.cloneElement(ct,de(de(_t(de({inputComponent:Se,inputProps:de(_t(de(de({children:f,error:Ie.error,IconComponent:D,variant:we,type:void 0,multiple:W},X?{id:O}:{autoWidth:c,defaultOpen:a,displayEmpty:I,labelId:ie,MenuProps:te,onClose:ee,onOpen:fe,open:ye,renderValue:Ee,SelectDisplayProps:de({id:O},re)}),H),{classes:H?na(It,H.classes):It}),F?F.props.inputProps:{})},(W&&X||I)&&we==="outlined"?{notched:!0}:{}),{ref:Ut,className:Or(ct.props.className,x,Gt.root)}),!F&&{variant:we}),_e))})});LH.muiName="Select";function Ibe(e){return Di("MuiTextField",e)}Oi("MuiTextField",["root"]);const Cbe={standard:iI,filled:rI,outlined:sI},Abe=e=>{const{classes:t}=e;return Ni({root:["root"]},Ibe,t)},Pbe=nr(Y1e,{name:"MuiTextField",slot:"Root",overridesResolver:(e,t)=>t.root})({}),zH=G.forwardRef(function(t,r){const s=hs({props:t,name:"MuiTextField"}),pt=s,{autoComplete:c,autoFocus:f=!1,children:_,className:x,color:a="primary",defaultValue:I,disabled:D=!1,error:O=!1,FormHelperTextProps:F,fullWidth:H=!1,helperText:Q,id:ie,InputLabelProps:te,inputProps:W,InputProps:X,inputRef:ee,label:fe,maxRows:ye,minRows:Ee,multiline:re=!1,name:he,onBlur:_e,onChange:Se,onFocus:J,placeholder:Ie,required:we=!1,rows:Lt,select:Gt=!1,SelectProps:qt,slots:It={},slotProps:ct={},type:Ut,value:Kt,variant:at="outlined"}=pt,At=On(pt,["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onFocus","placeholder","required","rows","select","SelectProps","slots","slotProps","type","value","variant"]),Et=_t(de({},s),{autoFocus:f,color:a,disabled:D,error:O,fullWidth:H,multiline:re,required:we,select:Gt,variant:at}),Jt=Abe(Et),Bt=M5(ie),Pn=Q&&Bt?`${Bt}-helper-text`:void 0,$n=fe&&Bt?`${Bt}-label`:void 0,Qn=Cbe[at],Xt={slots:It,slotProps:de({input:X,inputLabel:te,htmlInput:W,formHelperText:F,select:qt},ct)},mr={},An=Xt.slotProps.inputLabel;at==="outlined"&&(An&&typeof An.shrink!="undefined"&&(mr.notched=An.shrink),mr.label=fe),Gt&&((!qt||!qt.native)&&(mr.id=void 0),mr["aria-describedby"]=void 0);const[cr,zr]=Zl("input",{elementType:Qn,externalForwardedProps:Xt,additionalProps:mr,ownerState:Et}),[qn,Mr]=Zl("inputLabel",{elementType:Exe,externalForwardedProps:Xt,ownerState:Et}),[Vr,kn]=Zl("htmlInput",{elementType:"input",externalForwardedProps:Xt,ownerState:Et}),[zn,Ue]=Zl("formHelperText",{elementType:hxe,externalForwardedProps:Xt,ownerState:Et}),[Ye,gt]=Zl("select",{elementType:LH,externalForwardedProps:Xt,ownerState:Et}),Qe=N.jsx(cr,de({"aria-describedby":Pn,autoComplete:c,autoFocus:f,defaultValue:I,fullWidth:H,multiline:re,name:he,rows:Lt,maxRows:ye,minRows:Ee,type:Ut,value:Kt,id:Bt,inputRef:ee,onBlur:_e,onChange:Se,onFocus:J,placeholder:Ie,inputProps:kn,slots:{input:It.htmlInput?Vr:void 0}},zr));return N.jsxs(Pbe,_t(de({className:Or(Jt.root,x),disabled:D,error:O,fullWidth:H,ref:r,required:we,color:a,variant:at,ownerState:Et},At),{children:[fe!=null&&fe!==""&&N.jsx(qn,_t(de({htmlFor:Bt,id:$n},Mr),{children:fe})),Gt?N.jsx(Ye,_t(de({"aria-describedby":Pn,id:Bt,labelId:$n,value:Kt,input:Qe},gt),{children:_})):Qe,Q&&N.jsx(zn,_t(de({id:Pn},Ue),{children:Q}))]}))}),NH=cd(N.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),GV=cd([N.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),N.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt"),Rbe=cd(N.jsx("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2z"}),"Crop"),Mbe=cd(N.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),kbe=cd(N.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Dbe=cd(N.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo"),Obe=G.createContext(null),Lbe=G.createContext({}),zbe=G.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),Nbe=typeof window!="undefined",Fbe=Nbe?G.useLayoutEffect:G.useEffect;function FH(e){const t=G.useRef(null);return t.current===null&&(t.current=e()),t.current}class Bbe extends G.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=r.offsetHeight||0,s.width=r.offsetWidth||0,s.top=r.offsetTop,s.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function jbe({children:e,isPresent:t}){const r=G.useId(),s=G.useRef(null),c=G.useRef({width:0,height:0,top:0,left:0}),{nonce:f}=G.useContext(zbe);return G.useInsertionEffect(()=>{const{width:_,height:x,top:a,left:I}=c.current;if(t||!s.current||!_||!x)return;s.current.dataset.motionPopId=r;const D=document.createElement("style");return f&&(D.nonce=f),document.head.appendChild(D),D.sheet&&D.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${_}px !important;
            height: ${x}px !important;
            top: ${a}px !important;
            left: ${I}px !important;
          }
        `),()=>{document.head.removeChild(D)}},[t]),N.jsx(Bbe,{isPresent:t,childRef:s,sizeRef:c,children:G.cloneElement(e,{ref:s})})}const Ube=({children:e,initial:t,isPresent:r,onExitComplete:s,custom:c,presenceAffectsLayout:f,mode:_})=>{const x=FH(Vbe),a=G.useId(),I=G.useMemo(()=>({id:a,initial:t,isPresent:r,custom:c,onExitComplete:D=>{x.set(D,!0);for(const O of x.values())if(!O)return;s&&s()},register:D=>(x.set(D,!1),()=>x.delete(D))}),f?[Math.random()]:[r]);return G.useMemo(()=>{x.forEach((D,O)=>x.set(O,!1))},[r]),G.useEffect(()=>{!r&&!x.size&&s&&s()},[r]),_==="popLayout"&&(e=N.jsx(jbe,{isPresent:r,children:e})),N.jsx(Obe.Provider,{value:I,children:e})};function Vbe(){return new Map}const oE=e=>e.key||"";function WV(e){const t=[];return G.Children.forEach(e,r=>{G.isValidElement(r)&&t.push(r)}),t}const $be=({children:e,exitBeforeEnter:t,custom:r,initial:s=!0,onExitComplete:c,presenceAffectsLayout:f=!0,mode:_="sync"})=>{const x=G.useMemo(()=>WV(e),[e]),a=x.map(oE),I=G.useRef(!0),D=G.useRef(x),O=FH(()=>new Map),[F,H]=G.useState(x),[Q,ie]=G.useState(x);Fbe(()=>{I.current=!1,D.current=x;for(let X=0;X<Q.length;X++){const ee=oE(Q[X]);a.includes(ee)?O.delete(ee):O.get(ee)!==!0&&O.set(ee,!1)}},[Q,a.length,a.join("-")]);const te=[];if(x!==F){let X=[...x];for(let ee=0;ee<Q.length;ee++){const fe=Q[ee],ye=oE(fe);a.includes(ye)||(X.splice(ee,0,fe),te.push(fe))}_==="wait"&&te.length&&(X=te),ie(WV(X)),H(x);return}const{forceRender:W}=G.useContext(Lbe);return N.jsx(N.Fragment,{children:Q.map(X=>{const ee=oE(X),fe=x===Q||a.includes(ee),ye=()=>{if(O.has(ee))O.set(ee,!0);else return;let Ee=!0;O.forEach(re=>{re||(Ee=!1)}),Ee&&(W==null||W(),ie(D.current),c&&c())};return N.jsx(Ube,{isPresent:fe,initial:!I.current||s?void 0:!1,custom:fe?void 0:r,presenceAffectsLayout:f,mode:_,onExitComplete:fe?void 0:ye,children:X},ee)})})};var V5=Ib(),Lr=e=>Sb(e,V5),$5=Ib();Lr.write=e=>Sb(e,$5);var iA=Ib();Lr.onStart=e=>Sb(e,iA);var q5=Ib();Lr.onFrame=e=>Sb(e,q5);var G5=Ib();Lr.onFinish=e=>Sb(e,G5);var xy=[];Lr.setTimeout=(e,t)=>{const r=Lr.now()+t,s=()=>{const f=xy.findIndex(_=>_.cancel==s);~f&&xy.splice(f,1),bf-=~f?1:0},c={time:r,handler:e,cancel:s};return xy.splice(BH(r),0,c),bf+=1,jH(),c};var BH=e=>~(~xy.findIndex(t=>t.time>e)||~xy.length);Lr.cancel=e=>{iA.delete(e),q5.delete(e),G5.delete(e),V5.delete(e),$5.delete(e)};Lr.sync=e=>{t4=!0,Lr.batchedUpdates(e),t4=!1};Lr.throttle=e=>{let t;function r(){try{e(...t)}finally{t=null}}function s(...c){t=c,Lr.onStart(r)}return s.handler=e,s.cancel=()=>{iA.delete(r),t=null},s};var W5=typeof window!="undefined"?window.requestAnimationFrame:()=>{};Lr.use=e=>W5=e;Lr.now=typeof performance!="undefined"?()=>performance.now():Date.now;Lr.batchedUpdates=e=>e();Lr.catch=console.error;Lr.frameLoop="always";Lr.advance=()=>{Lr.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):VH()};var xf=-1,bf=0,t4=!1;function Sb(e,t){t4?(t.delete(e),e(0)):(t.add(e),jH())}function jH(){xf<0&&(xf=0,Lr.frameLoop!=="demand"&&W5(UH))}function qbe(){xf=-1}function UH(){~xf&&(W5(UH),Lr.batchedUpdates(VH))}function VH(){const e=xf;xf=Lr.now();const t=BH(xf);if(t&&($H(xy.splice(0,t),r=>r.handler()),bf-=t),!bf){qbe();return}iA.flush(),V5.flush(e?Math.min(64,xf-e):16.667),q5.flush(),$5.flush(),G5.flush()}function Ib(){let e=new Set,t=e;return{add(r){bf+=t==e&&!e.has(r)?1:0,e.add(r)},delete(r){return bf-=t==e&&e.has(r)?1:0,e.delete(r)},flush(r){t.size&&(e=new Set,bf-=t.size,$H(t,s=>s(r)&&e.add(s)),bf+=e.size,t=e)}}}function $H(e,t){e.forEach(r=>{try{t(r)}catch(s){Lr.catch(s)}})}var Gbe=Object.defineProperty,Wbe=(e,t)=>{for(var r in t)Gbe(e,r,{get:t[r],enumerable:!0})},Zc={};Wbe(Zc,{assign:()=>Zbe,colors:()=>zf,createStringInterpolator:()=>Z5,skipAnimation:()=>GH,to:()=>qH,willAdvance:()=>X5});function n4(){}var Hbe=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),yn={arr:Array.isArray,obj:e=>!!e&&e.constructor.name==="Object",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",und:e=>e===void 0};function kh(e,t){if(yn.arr(e)){if(!yn.arr(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return e===t}var ri=(e,t)=>e.forEach(t);function Hu(e,t,r){if(yn.arr(e)){for(let s=0;s<e.length;s++)t.call(r,e[s],`${s}`);return}for(const s in e)e.hasOwnProperty(s)&&t.call(r,e[s],s)}var ml=e=>yn.und(e)?[]:yn.arr(e)?e:[e];function H1(e,t){if(e.size){const r=Array.from(e);e.clear(),ri(r,t)}}var x1=(e,...t)=>H1(e,r=>r(...t)),H5=()=>typeof window=="undefined"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),Z5,qH,zf=null,GH=!1,X5=n4,Zbe=e=>{e.to&&(qH=e.to),e.now&&(Lr.now=e.now),e.colors!==void 0&&(zf=e.colors),e.skipAnimation!=null&&(GH=e.skipAnimation),e.createStringInterpolator&&(Z5=e.createStringInterpolator),e.requestAnimationFrame&&Lr.use(e.requestAnimationFrame),e.batchedUpdates&&(Lr.batchedUpdates=e.batchedUpdates),e.willAdvance&&(X5=e.willAdvance),e.frameLoop&&(Lr.frameLoop=e.frameLoop)},Z1=new Set,Xl=[],$R=[],oI=0,sA={get idle(){return!Z1.size&&!Xl.length},start(e){oI>e.priority?(Z1.add(e),Lr.onStart(Xbe)):(WH(e),Lr(r4))},advance:r4,sort(e){if(oI)Lr.onFrame(()=>sA.sort(e));else{const t=Xl.indexOf(e);~t&&(Xl.splice(t,1),HH(e))}},clear(){Xl=[],Z1.clear()}};function Xbe(){Z1.forEach(WH),Z1.clear(),Lr(r4)}function WH(e){Xl.includes(e)||HH(e)}function HH(e){Xl.splice(Kbe(Xl,t=>t.priority>e.priority),0,e)}function r4(e){const t=$R;for(let r=0;r<Xl.length;r++){const s=Xl[r];oI=s.priority,s.idle||(X5(s),s.advance(e),s.idle||t.push(s))}return oI=0,$R=Xl,$R.length=0,Xl=t,Xl.length>0}function Kbe(e,t){const r=e.findIndex(t);return r<0?e.length:r}var Qbe=(e,t,r)=>Math.min(Math.max(r,e),t),Ybe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Uc="[-+]?\\d*\\.?\\d+",aI=Uc+"%";function oA(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}var Jbe=new RegExp("rgb"+oA(Uc,Uc,Uc)),ewe=new RegExp("rgba"+oA(Uc,Uc,Uc,Uc)),twe=new RegExp("hsl"+oA(Uc,aI,aI)),nwe=new RegExp("hsla"+oA(Uc,aI,aI,Uc)),rwe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,iwe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,swe=/^#([0-9a-fA-F]{6})$/,owe=/^#([0-9a-fA-F]{8})$/;function awe(e){let t;return typeof e=="number"?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=swe.exec(e))?parseInt(t[1]+"ff",16)>>>0:zf&&zf[e]!==void 0?zf[e]:(t=Jbe.exec(e))?(D_(t[1])<<24|D_(t[2])<<16|D_(t[3])<<8|255)>>>0:(t=ewe.exec(e))?(D_(t[1])<<24|D_(t[2])<<16|D_(t[3])<<8|XV(t[4]))>>>0:(t=rwe.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=owe.exec(e))?parseInt(t[1],16)>>>0:(t=iwe.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=twe.exec(e))?(HV(ZV(t[1]),aE(t[2]),aE(t[3]))|255)>>>0:(t=nwe.exec(e))?(HV(ZV(t[1]),aE(t[2]),aE(t[3]))|XV(t[4]))>>>0:null}function qR(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function HV(e,t,r){const s=r<.5?r*(1+t):r+t-r*t,c=2*r-s,f=qR(c,s,e+1/3),_=qR(c,s,e),x=qR(c,s,e-1/3);return Math.round(f*255)<<24|Math.round(_*255)<<16|Math.round(x*255)<<8}function D_(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function ZV(e){return(parseFloat(e)%360+360)%360/360}function XV(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(t*255)}function aE(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function KV(e){let t=awe(e);if(t===null)return e;t=t||0;const r=(t&4278190080)>>>24,s=(t&16711680)>>>16,c=(t&65280)>>>8,f=(t&255)/255;return`rgba(${r}, ${s}, ${c}, ${f})`}var Fx=(e,t,r)=>{if(yn.fun(e))return e;if(yn.arr(e))return Fx({range:e,output:t,extrapolate:r});if(yn.str(e.output[0]))return Z5(e);const s=e,c=s.output,f=s.range||[0,1],_=s.extrapolateLeft||s.extrapolate||"extend",x=s.extrapolateRight||s.extrapolate||"extend",a=s.easing||(I=>I);return I=>{const D=cwe(I,f);return lwe(I,f[D],f[D+1],c[D],c[D+1],a,_,x,s.map)}};function lwe(e,t,r,s,c,f,_,x,a){let I=a?a(e):e;if(I<t){if(_==="identity")return I;_==="clamp"&&(I=t)}if(I>r){if(x==="identity")return I;x==="clamp"&&(I=r)}return s===c?s:t===r?e<=t?s:c:(t===-1/0?I=-I:r===1/0?I=I-t:I=(I-t)/(r-t),I=f(I),s===-1/0?I=-I:c===1/0?I=I+s:I=I*(c-s)+s,I)}function cwe(e,t){for(var r=1;r<t.length-1&&!(t[r]>=e);++r);return r-1}var uwe=(e,t="end")=>r=>{r=t==="end"?Math.min(r,.999):Math.max(r,.001);const s=r*e,c=t==="end"?Math.floor(s):Math.ceil(s);return Qbe(0,1,c/e)},lI=1.70158,lE=lI*1.525,QV=lI+1,YV=2*Math.PI/3,JV=2*Math.PI/4.5,cE=e=>e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375,hwe={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e===0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e===1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e===0?0:e===1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>QV*e*e*e-lI*e*e,easeOutBack:e=>1+QV*Math.pow(e-1,3)+lI*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*((lE+1)*2*e-lE)/2:(Math.pow(2*e-2,2)*((lE+1)*(e*2-2)+lE)+2)/2,easeInElastic:e=>e===0?0:e===1?1:-Math.pow(2,10*e-10)*Math.sin((e*10-10.75)*YV),easeOutElastic:e=>e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e*10-.75)*YV)+1,easeInOutElastic:e=>e===0?0:e===1?1:e<.5?-(Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*JV))/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*JV)/2+1,easeInBounce:e=>1-cE(1-e),easeOutBounce:cE,easeInOutBounce:e=>e<.5?(1-cE(1-2*e))/2:(1+cE(2*e-1))/2,steps:uwe},Bx=Symbol.for("FluidValue.get"),qy=Symbol.for("FluidValue.observers"),Wl=e=>!!(e&&e[Bx]),Ba=e=>e&&e[Bx]?e[Bx]():e,e$=e=>e[qy]||null;function dwe(e,t){e.eventObserved?e.eventObserved(t):e(t)}function jx(e,t){const r=e[qy];r&&r.forEach(s=>{dwe(s,t)})}var ZH=class{constructor(e){if(!e&&!(e=this.get))throw Error("Unknown getter");fwe(this,e)}},fwe=(e,t)=>XH(e,Bx,t);function d0(e,t){if(e[Bx]){let r=e[qy];r||XH(e,qy,r=new Set),r.has(t)||(r.add(t),e.observerAdded&&e.observerAdded(r.size,t))}return t}function Ux(e,t){const r=e[qy];if(r&&r.has(t)){const s=r.size-1;s?r.delete(t):e[qy]=null,e.observerRemoved&&e.observerRemoved(s,t)}}var XH=(e,t,r)=>Object.defineProperty(e,t,{value:r,writable:!0,configurable:!0}),jE=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,pwe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,t$=new RegExp(`(${jE.source})(%|[a-z]+)`,"i"),mwe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,aA=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,KH=e=>{const[t,r]=gwe(e);if(!t||H5())return e;const s=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(s)return s.trim();if(r&&r.startsWith("--")){const c=window.getComputedStyle(document.documentElement).getPropertyValue(r);return c||e}else{if(r&&aA.test(r))return KH(r);if(r)return r}return e},gwe=e=>{const t=aA.exec(e);if(!t)return[,];const[,r,s]=t;return[r,s]},GR,_we=(e,t,r,s,c)=>`rgba(${Math.round(t)}, ${Math.round(r)}, ${Math.round(s)}, ${c})`,QH=e=>{GR||(GR=zf?new RegExp(`(${Object.keys(zf).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map(f=>Ba(f).replace(aA,KH).replace(pwe,KV).replace(GR,KV)),r=t.map(f=>f.match(jE).map(Number)),c=r[0].map((f,_)=>r.map(x=>{if(!(_ in x))throw Error('The arity of each "output" value must be equal');return x[_]})).map(f=>Fx(_t(de({},e),{output:f})));return f=>{var a;const _=!t$.test(t[0])&&((a=t.find(I=>t$.test(I)))==null?void 0:a.replace(jE,""));let x=0;return t[0].replace(jE,()=>`${c[x++](f)}${_||""}`).replace(mwe,_we)}},K5="react-spring: ",YH=e=>{const t=e;let r=!1;if(typeof t!="function")throw new TypeError(`${K5}once requires a function parameter`);return(...s)=>{r||(t(...s),r=!0)}},ywe=YH(console.warn);function vwe(){ywe(`${K5}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var xwe=YH(console.warn);function bwe(){xwe(`${K5}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function lA(e){return yn.str(e)&&(e[0]=="#"||/\d/.test(e)||!H5()&&aA.test(e)||e in(zf||{}))}var Q5=H5()?G.useEffect:G.useLayoutEffect,wwe=()=>{const e=G.useRef(!1);return Q5(()=>(e.current=!0,()=>{e.current=!1}),[]),e};function JH(){const e=G.useState()[1],t=wwe();return()=>{t.current&&e(Math.random())}}function Twe(e,t){const[r]=G.useState(()=>({inputs:t,result:e()})),s=G.useRef(),c=s.current;let f=c;return f?t&&f.inputs&&Ewe(t,f.inputs)||(f={inputs:t,result:e()}):f=r,G.useEffect(()=>{s.current=f,c==r&&(r.inputs=r.result=void 0)},[f]),f.result}function Ewe(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}var eZ=e=>G.useEffect(e,Swe),Swe=[];function n$(e){const t=G.useRef();return G.useEffect(()=>{t.current=e}),t.current}var Vx=Symbol.for("Animated:node"),Iwe=e=>!!e&&e[Vx]===e,Au=e=>e&&e[Vx],Y5=(e,t)=>Hbe(e,Vx,t),cA=e=>e&&e[Vx]&&e[Vx].getPayload(),tZ=class{constructor(){Y5(this,this)}getPayload(){return this.payload||[]}},Cb=class extends tZ{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,yn.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new Cb(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return yn.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value===e?!1:(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,yn.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},$x=class extends Cb{constructor(e){super(0),this._string=null,this._toString=Fx({output:[e,e]})}static create(e){return new $x(e)}getValue(){const e=this._string;return e==null?this._string=this._toString(this._value):e}setValue(e){if(yn.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else if(super.setValue(e))this._string=null;else return!1;return!0}reset(e){e&&(this._toString=Fx({output:[this.getValue(),e]})),this._value=0,super.reset()}},cI={dependencies:null},uA=class extends tZ{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return Hu(this.source,(r,s)=>{Iwe(r)?t[s]=r.getValue(e):Wl(r)?t[s]=Ba(r):e||(t[s]=r)}),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&ri(this.payload,e=>e.reset())}_makePayload(e){if(e){const t=new Set;return Hu(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){cI.dependencies&&Wl(e)&&cI.dependencies.add(e);const t=cA(e);t&&ri(t,r=>this.add(r))}},nZ=class extends uA{constructor(e){super(e)}static create(e){return new nZ(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const t=this.getPayload();return e.length==t.length?t.map((r,s)=>r.setValue(e[s])).some(Boolean):(super.setValue(e.map(Cwe)),!0)}};function Cwe(e){return(lA(e)?$x:Cb).create(e)}function i4(e){const t=Au(e);return t?t.constructor:yn.arr(e)?nZ:lA(e)?$x:Cb}var r$=(e,t)=>{const r=!yn.fun(e)||e.prototype&&e.prototype.isReactComponent;return G.forwardRef((s,c)=>{const f=G.useRef(null),_=r&&G.useCallback(Q=>{f.current=Rwe(c,Q)},[c]),[x,a]=Pwe(s,t),I=JH(),D=()=>{const Q=f.current;if(r&&!Q)return;(Q?t.applyAnimatedValues(Q,x.getValue(!0)):!1)===!1&&I()},O=new Awe(D,a),F=G.useRef();Q5(()=>(F.current=O,ri(a,Q=>d0(Q,O)),()=>{F.current&&(ri(F.current.deps,Q=>Ux(Q,F.current)),Lr.cancel(F.current.update))})),G.useEffect(D,[]),eZ(()=>()=>{const Q=F.current;ri(Q.deps,ie=>Ux(ie,Q))});const H=t.getComponentProps(x.getValue());return G.createElement(e,_t(de({},H),{ref:_}))})},Awe=class{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){e.type=="change"&&Lr.write(this.update)}};function Pwe(e,t){const r=new Set;return cI.dependencies=r,e.style&&(e=_t(de({},e),{style:t.createAnimatedStyle(e.style)})),e=new uA(e),cI.dependencies=null,[e,r]}function Rwe(e,t){return e&&(yn.fun(e)?e(t):e.current=t),t}var i$=Symbol.for("AnimatedComponent"),Mwe=(e,{applyAnimatedValues:t=()=>!1,createAnimatedStyle:r=c=>new uA(c),getComponentProps:s=c=>c}={})=>{const c={applyAnimatedValues:t,createAnimatedStyle:r,getComponentProps:s},f=_=>{const x=s$(_)||"Anonymous";return yn.str(_)?_=f[_]||(f[_]=r$(_,c)):_=_[i$]||(_[i$]=r$(_,c)),_.displayName=`Animated(${x})`,_};return Hu(e,(_,x)=>{yn.arr(e)&&(x=s$(_)),f[x]=f(_)}),{animated:f}},s$=e=>yn.str(e)?e:e&&yn.str(e.displayName)?e.displayName:yn.fun(e)&&e.name||null;function pm(e,...t){return yn.fun(e)?e(...t):e}var X1=(e,t)=>e===!0||!!(t&&e&&(yn.fun(e)?e(t):ml(e).includes(t))),rZ=(e,t)=>yn.obj(e)?t&&e[t]:e,iZ=(e,t)=>e.default===!0?e[t]:e.default?e.default[t]:void 0,kwe=e=>e,J5=(e,t=kwe)=>{let r=Dwe;e.default&&e.default!==!0&&(e=e.default,r=Object.keys(e));const s={};for(const c of r){const f=t(e[c],c);yn.und(f)||(s[c]=f)}return s},Dwe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],Owe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function Lwe(e){const t={};let r=0;if(Hu(e,(s,c)=>{Owe[c]||(t[c]=s,r++)}),r)return t}function sZ(e){const t=Lwe(e);if(t){const r={to:t};return Hu(e,(s,c)=>c in t||(r[c]=s)),r}return de({},e)}function qx(e){return e=Ba(e),yn.arr(e)?e.map(qx):lA(e)?Zc.createStringInterpolator({range:[0,1],output:[e,e]})(1):e}function zwe(e){for(const t in e)return!0;return!1}function s4(e){return yn.fun(e)||yn.arr(e)&&yn.obj(e[0])}function Nwe(e,t){var r;(r=e.ref)==null||r.delete(e),t==null||t.delete(e)}function Fwe(e,t){var r;t&&e.ref!==t&&((r=e.ref)==null||r.delete(e),t.add(e),e.ref=t)}var Bwe={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},o4=_t(de({},Bwe.default),{mass:1,damping:1,easing:hwe.linear,clamp:!1}),jwe=class{constructor(){this.velocity=0,Object.assign(this,o4)}};function Uwe(e,t,r){r&&(r=de({},r),o$(r,t),t=de(de({},r),t)),o$(e,t),Object.assign(e,t);for(const _ in o4)e[_]==null&&(e[_]=o4[_]);let{frequency:s,damping:c}=e;const{mass:f}=e;return yn.und(s)||(s<.01&&(s=.01),c<0&&(c=0),e.tension=Math.pow(2*Math.PI/s,2)*f,e.friction=4*Math.PI*c*f/s),e}function o$(e,t){if(!yn.und(t.decay))e.duration=void 0;else{const r=!yn.und(t.tension)||!yn.und(t.friction);(r||!yn.und(t.frequency)||!yn.und(t.damping)||!yn.und(t.mass))&&(e.duration=void 0,e.decay=void 0),r&&(e.frequency=void 0)}}var a$=[],Vwe=class{constructor(){this.changed=!1,this.values=a$,this.toValues=null,this.fromValues=a$,this.config=new jwe,this.immediate=!1}};function oZ(e,{key:t,props:r,defaultProps:s,state:c,actions:f}){return new Promise((_,x)=>{var Q;let a,I,D=X1((Q=r.cancel)!=null?Q:s==null?void 0:s.cancel,t);if(D)H();else{yn.und(r.pause)||(c.paused=X1(r.pause,t));let ie=s==null?void 0:s.pause;ie!==!0&&(ie=c.paused||X1(ie,t)),a=pm(r.delay||0,t),ie?(c.resumeQueue.add(F),f.pause()):(f.resume(),F())}function O(){c.resumeQueue.add(F),c.timeouts.delete(I),I.cancel(),a=I.time-Lr.now()}function F(){a>0&&!Zc.skipAnimation?(c.delayed=!0,I=Lr.setTimeout(H,a),c.pauseQueue.add(O),c.timeouts.add(I)):H()}function H(){c.delayed&&(c.delayed=!1),c.pauseQueue.delete(O),c.timeouts.delete(I),e<=(c.cancelId||0)&&(D=!0);try{f.start(_t(de({},r),{callId:e,cancel:D}),_)}catch(ie){x(ie)}}})}var eL=(e,t)=>t.length==1?t[0]:t.some(r=>r.cancelled)?by(e.get()):t.every(r=>r.noop)?aZ(e.get()):Nc(e.get(),t.every(r=>r.finished)),aZ=e=>({value:e,noop:!0,finished:!0,cancelled:!1}),Nc=(e,t,r=!1)=>({value:e,finished:t,cancelled:r}),by=e=>({value:e,cancelled:!0,finished:!1});function lZ(e,t,r,s){const{callId:c,parentId:f,onRest:_}=t,{asyncTo:x,promise:a}=r;return!f&&e===x&&!t.reset?a:r.promise=Be(this,null,function*(){r.asyncId=c,r.asyncTo=e;const I=J5(t,(te,W)=>W==="onRest"?void 0:te);let D,O;const F=new Promise((te,W)=>(D=te,O=W)),H=te=>{const W=c<=(r.cancelId||0)&&by(s)||c!==r.asyncId&&Nc(s,!1);if(W)throw te.result=W,O(te),te},Q=(te,W)=>{const X=new l$,ee=new c$;return Be(this,null,function*(){if(Zc.skipAnimation)throw Gx(r),ee.result=Nc(s,!1),O(ee),ee;H(X);const fe=yn.obj(te)?de({},te):_t(de({},W),{to:te});fe.parentId=c,Hu(I,(Ee,re)=>{yn.und(fe[re])&&(fe[re]=Ee)});const ye=yield s.start(fe);return H(X),r.paused&&(yield new Promise(Ee=>{r.resumeQueue.add(Ee)})),ye})};let ie;if(Zc.skipAnimation)return Gx(r),Nc(s,!1);try{let te;yn.arr(e)?te=(W=>Be(this,null,function*(){for(const X of W)yield Q(X)}))(e):te=Promise.resolve(e(Q,s.stop.bind(s))),yield Promise.all([te.then(D),F]),ie=Nc(s.get(),!0,!1)}catch(te){if(te instanceof l$)ie=te.result;else if(te instanceof c$)ie=te.result;else throw te}finally{c==r.asyncId&&(r.asyncId=f,r.asyncTo=f?x:void 0,r.promise=f?a:void 0)}return yn.fun(_)&&Lr.batchedUpdates(()=>{_(ie,s,s.item)}),ie})}function Gx(e,t){H1(e.timeouts,r=>r.cancel()),e.pauseQueue.clear(),e.resumeQueue.clear(),e.asyncId=e.asyncTo=e.promise=void 0,t&&(e.cancelId=t)}var l$=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},c$=class extends Error{constructor(){super("SkipAnimationSignal")}},a4=e=>e instanceof tL,$we=1,tL=class extends ZH{constructor(){super(...arguments),this.id=$we++,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=Au(this);return e&&e.getValue()}to(...e){return Zc.to(this,e)}interpolate(...e){return vwe(),Zc.to(this,e)}toJSON(){return this.get()}observerAdded(e){e==1&&this._attach()}observerRemoved(e){e==0&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){jx(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||sA.sort(this),jx(this,{type:"priority",parent:this,priority:e})}},Km=Symbol.for("SpringPhase"),cZ=1,l4=2,c4=4,WR=e=>(e[Km]&cZ)>0,sf=e=>(e[Km]&l4)>0,n1=e=>(e[Km]&c4)>0,u$=(e,t)=>t?e[Km]|=l4|cZ:e[Km]&=~l4,h$=(e,t)=>t?e[Km]|=c4:e[Km]&=~c4,qwe=class extends tL{constructor(e,t){if(super(),this.animation=new Vwe,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!yn.und(e)||!yn.und(t)){const r=yn.obj(e)?de({},e):_t(de({},t),{from:e});yn.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(sf(this)||this._state.asyncTo)||n1(this)}get goal(){return Ba(this.animation.to)}get velocity(){const e=Au(this);return e instanceof Cb?e.lastVelocity||0:e.getPayload().map(t=>t.lastVelocity||0)}get hasAnimated(){return WR(this)}get isAnimating(){return sf(this)}get isPaused(){return n1(this)}get isDelayed(){return this._state.delayed}advance(e){let t=!0,r=!1;const s=this.animation;let{toValues:c}=s;const{config:f}=s,_=cA(s.to);!_&&Wl(s.to)&&(c=ml(Ba(s.to))),s.values.forEach((I,D)=>{if(I.done)return;const O=I.constructor==$x?1:_?_[D].lastPosition:c[D];let F=s.immediate,H=O;if(!F){if(H=I.lastPosition,f.tension<=0){I.done=!0;return}let Q=I.elapsedTime+=e;const ie=s.fromValues[D],te=I.v0!=null?I.v0:I.v0=yn.arr(f.velocity)?f.velocity[D]:f.velocity;let W;const X=f.precision||(ie==O?.005:Math.min(1,Math.abs(O-ie)*.001));if(yn.und(f.duration))if(f.decay){const ee=f.decay===!0?.998:f.decay,fe=Math.exp(-(1-ee)*Q);H=ie+te/(1-ee)*(1-fe),F=Math.abs(I.lastPosition-H)<=X,W=te*fe}else{W=I.lastVelocity==null?te:I.lastVelocity;const ee=f.restVelocity||X/10,fe=f.clamp?0:f.bounce,ye=!yn.und(fe),Ee=ie==O?I.v0>0:ie<O;let re,he=!1;const _e=1,Se=Math.ceil(e/_e);for(let J=0;J<Se&&(re=Math.abs(W)>ee,!(!re&&(F=Math.abs(O-H)<=X,F)));++J){ye&&(he=H==O||H>O==Ee,he&&(W=-W*fe,H=O));const Ie=-f.tension*1e-6*(H-O),we=-f.friction*.001*W,Lt=(Ie+we)/f.mass;W=W+Lt*_e,H=H+W*_e}}else{let ee=1;f.duration>0&&(this._memoizedDuration!==f.duration&&(this._memoizedDuration=f.duration,I.durationProgress>0&&(I.elapsedTime=f.duration*I.durationProgress,Q=I.elapsedTime+=e)),ee=(f.progress||0)+Q/this._memoizedDuration,ee=ee>1?1:ee<0?0:ee,I.durationProgress=ee),H=ie+f.easing(ee)*(O-ie),W=(H-I.lastPosition)/e,F=ee==1}I.lastVelocity=W,Number.isNaN(H)&&(console.warn("Got NaN while animating:",this),F=!0)}_&&!_[D].done&&(F=!1),F?I.done=!0:t=!1,I.setValue(H,f.round)&&(r=!0)});const x=Au(this),a=x.getValue();if(t){const I=Ba(s.to);(a!==I||r)&&!f.decay?(x.setValue(I),this._onChange(I)):r&&f.decay&&this._onChange(a),this._stop()}else r&&this._onChange(a)}set(e){return Lr.batchedUpdates(()=>{this._stop(),this._focus(e),this._set(e)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(sf(this)){const{to:e,config:t}=this.animation;Lr.batchedUpdates(()=>{this._onStart(),t.decay||this._set(e,!1),this._stop()})}return this}update(e){return(this.queue||(this.queue=[])).push(e),this}start(e,t){let r;return yn.und(e)?(r=this.queue||[],this.queue=[]):r=[yn.obj(e)?e:_t(de({},t),{to:e})],Promise.all(r.map(s=>this._update(s))).then(s=>eL(this,s))}stop(e){const{to:t}=this.animation;return this._focus(this.get()),Gx(this._state,e&&this._lastCallId),Lr.batchedUpdates(()=>this._stop(t,e)),this}reset(){this._update({reset:!0})}eventObserved(e){e.type=="change"?this._start():e.type=="priority"&&(this.priority=e.priority+1)}_prepareNode(e){const t=this.key||"";let{to:r,from:s}=e;r=yn.obj(r)?r[t]:r,(r==null||s4(r))&&(r=void 0),s=yn.obj(s)?s[t]:s,s==null&&(s=void 0);const c={to:r,from:s};return WR(this)||(e.reverse&&([r,s]=[s,r]),s=Ba(s),yn.und(s)?Au(this)||this._set(r):this._set(s)),c}_update(r,t){var e=On(r,[]);const{key:s,defaultProps:c}=this;e.default&&Object.assign(c,J5(e,(x,a)=>/^on/.test(a)?rZ(x,s):x)),f$(this,e,"onProps"),i1(this,"onProps",e,this);const f=this._prepareNode(e);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const _=this._state;return oZ(++this._lastCallId,{key:s,props:e,defaultProps:c,state:_,actions:{pause:()=>{n1(this)||(h$(this,!0),x1(_.pauseQueue),i1(this,"onPause",Nc(this,r1(this,this.animation.to)),this))},resume:()=>{n1(this)&&(h$(this,!1),sf(this)&&this._resume(),x1(_.resumeQueue),i1(this,"onResume",Nc(this,r1(this,this.animation.to)),this))},start:this._merge.bind(this,f)}}).then(x=>{if(e.loop&&x.finished&&!(t&&x.noop)){const a=uZ(e);if(a)return this._update(a,!0)}return x})}_merge(e,t,r){if(t.cancel)return this.stop(!0),r(by(this));const s=!yn.und(e.to),c=!yn.und(e.from);if(s||c)if(t.callId>this._lastToId)this._lastToId=t.callId;else return r(by(this));const{key:f,defaultProps:_,animation:x}=this,{to:a,from:I}=x;let{to:D=a,from:O=I}=e;c&&!s&&(!t.default||yn.und(D))&&(D=O),t.reverse&&([D,O]=[O,D]);const F=!kh(O,I);F&&(x.from=O),O=Ba(O);const H=!kh(D,a);H&&this._focus(D);const Q=s4(t.to),{config:ie}=x,{decay:te,velocity:W}=ie;(s||c)&&(ie.velocity=0),t.config&&!Q&&Uwe(ie,pm(t.config,f),t.config!==_.config?pm(_.config,f):void 0);let X=Au(this);if(!X||yn.und(D))return r(Nc(this,!0));const ee=yn.und(t.reset)?c&&!t.default:!yn.und(O)&&X1(t.reset,f),fe=ee?O:this.get(),ye=qx(D),Ee=yn.num(ye)||yn.arr(ye)||lA(ye),re=!Q&&(!Ee||X1(_.immediate||t.immediate,f));if(H){const J=i4(D);if(J!==X.constructor)if(re)X=this._set(ye);else throw Error(`Cannot animate between ${X.constructor.name} and ${J.name}, as the "to" prop suggests`)}const he=X.constructor;let _e=Wl(D),Se=!1;if(!_e){const J=ee||!WR(this)&&F;(H||J)&&(Se=kh(qx(fe),ye),_e=!Se),(!kh(x.immediate,re)&&!re||!kh(ie.decay,te)||!kh(ie.velocity,W))&&(_e=!0)}if(Se&&sf(this)&&(x.changed&&!ee?_e=!0:_e||this._stop(a)),!Q&&((_e||Wl(a))&&(x.values=X.getPayload(),x.toValues=Wl(D)?null:he==$x?[1]:ml(ye)),x.immediate!=re&&(x.immediate=re,!re&&!ee&&this._set(a)),_e)){const{onRest:J}=x;ri(Wwe,we=>f$(this,t,we));const Ie=Nc(this,r1(this,a));x1(this._pendingCalls,Ie),this._pendingCalls.add(r),x.changed&&Lr.batchedUpdates(()=>{var we;x.changed=!ee,J==null||J(Ie,this),ee?pm(_.onRest,Ie):(we=x.onStart)==null||we.call(x,Ie,this)})}ee&&this._set(fe),Q?r(lZ(t.to,t,this._state,this)):_e?this._start():sf(this)&&!H?this._pendingCalls.add(r):r(aZ(fe))}_focus(e){const t=this.animation;e!==t.to&&(e$(this)&&this._detach(),t.to=e,e$(this)&&this._attach())}_attach(){let e=0;const{to:t}=this.animation;Wl(t)&&(d0(t,this),a4(t)&&(e=t.priority+1)),this.priority=e}_detach(){const{to:e}=this.animation;Wl(e)&&Ux(e,this)}_set(e,t=!0){const r=Ba(e);if(!yn.und(r)){const s=Au(this);if(!s||!kh(r,s.getValue())){const c=i4(r);!s||s.constructor!=c?Y5(this,c.create(r)):s.setValue(r),s&&Lr.batchedUpdates(()=>{this._onChange(r,t)})}}return Au(this)}_onStart(){const e=this.animation;e.changed||(e.changed=!0,i1(this,"onStart",Nc(this,r1(this,e.to)),this))}_onChange(e,t){t||(this._onStart(),pm(this.animation.onChange,e,this)),pm(this.defaultProps.onChange,e,this),super._onChange(e,t)}_start(){const e=this.animation;Au(this).reset(Ba(e.to)),e.immediate||(e.fromValues=e.values.map(t=>t.lastPosition)),sf(this)||(u$(this,!0),n1(this)||this._resume())}_resume(){Zc.skipAnimation?this.finish():sA.start(this)}_stop(e,t){if(sf(this)){u$(this,!1);const r=this.animation;ri(r.values,c=>{c.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),jx(this,{type:"idle",parent:this});const s=t?by(this.get()):Nc(this.get(),r1(this,e!=null?e:r.to));x1(this._pendingCalls,s),r.changed&&(r.changed=!1,i1(this,"onRest",s,this))}}};function r1(e,t){const r=qx(t),s=qx(e.get());return kh(s,r)}function uZ(e,t=e.loop,r=e.to){const s=pm(t);if(s){const c=s!==!0&&sZ(s),f=(c||e).reverse,_=!c||c.reset;return Wx(de(_t(de({},e),{loop:t,default:!1,pause:void 0,to:!f||s4(r)?r:void 0,from:_?e.from:void 0,reset:_}),c))}}function Wx(e){const{to:t,from:r}=e=sZ(e),s=new Set;return yn.obj(t)&&d$(t,s),yn.obj(r)&&d$(r,s),e.keys=s.size?Array.from(s):null,e}function Gwe(e){const t=Wx(e);return yn.und(t.default)&&(t.default=J5(t)),t}function d$(e,t){Hu(e,(r,s)=>r!=null&&t.add(s))}var Wwe=["onStart","onRest","onChange","onPause","onResume"];function f$(e,t,r){e.animation[r]=t[r]!==iZ(t,r)?rZ(t[r],e.key):void 0}function i1(e,t,...r){var s,c,f,_;(c=(s=e.animation)[t])==null||c.call(s,...r),(_=(f=e.defaultProps)[t])==null||_.call(f,...r)}var Hwe=["onStart","onChange","onRest"],Zwe=1,Xwe=class{constructor(t,r){this.id=Zwe++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),r&&(this._flush=r),t&&this.start(de({default:!0},t))}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(t=>t.idle&&!t.isDelayed&&!t.isPaused)}get item(){return this._item}set item(t){this._item=t}get(){const t={};return this.each((r,s)=>t[s]=r.get()),t}set(t){for(const r in t){const s=t[r];yn.und(s)||this.springs[r].set(s)}}update(t){return t&&this.queue.push(Wx(t)),this}start(t){let{queue:r}=this;return t?r=ml(t).map(Wx):this.queue=[],this._flush?this._flush(this,r):(mZ(this,r),u4(this,r))}stop(t,r){if(t!==!!t&&(r=t),r){const s=this.springs;ri(ml(r),c=>s[c].stop(!!t))}else Gx(this._state,this._lastAsyncId),this.each(s=>s.stop(!!t));return this}pause(t){if(yn.und(t))this.start({pause:!0});else{const r=this.springs;ri(ml(t),s=>r[s].pause())}return this}resume(t){if(yn.und(t))this.start({pause:!1});else{const r=this.springs;ri(ml(t),s=>r[s].resume())}return this}each(t){Hu(this.springs,t)}_onFrame(){const{onStart:t,onChange:r,onRest:s}=this._events,c=this._active.size>0,f=this._changed.size>0;(c&&!this._started||f&&!this._started)&&(this._started=!0,H1(t,([a,I])=>{I.value=this.get(),a(I,this,this._item)}));const _=!c&&this._started,x=f||_&&s.size?this.get():null;f&&r.size&&H1(r,([a,I])=>{I.value=x,a(I,this,this._item)}),_&&(this._started=!1,H1(s,([a,I])=>{I.value=x,a(I,this,this._item)}))}eventObserved(t){if(t.type=="change")this._changed.add(t.parent),t.idle||this._active.add(t.parent);else if(t.type=="idle")this._active.delete(t.parent);else return;Lr.onFrame(this._onFrame)}};function u4(e,t){return Promise.all(t.map(r=>hZ(e,r))).then(r=>eL(e,r))}function hZ(e,t,r){return Be(this,null,function*(){const{keys:s,to:c,from:f,loop:_,onRest:x,onResolve:a}=t,I=yn.obj(t.default)&&t.default;_&&(t.loop=!1),c===!1&&(t.to=null),f===!1&&(t.from=null);const D=yn.arr(c)||yn.fun(c)?c:void 0;D?(t.to=void 0,t.onRest=void 0,I&&(I.onRest=void 0)):ri(Hwe,ie=>{const te=t[ie];if(yn.fun(te)){const W=e._events[ie];t[ie]=({finished:X,cancelled:ee})=>{const fe=W.get(te);fe?(X||(fe.finished=!1),ee&&(fe.cancelled=!0)):W.set(te,{value:null,finished:X||!1,cancelled:ee||!1})},I&&(I[ie]=t[ie])}});const O=e._state;t.pause===!O.paused?(O.paused=t.pause,x1(t.pause?O.pauseQueue:O.resumeQueue)):O.paused&&(t.pause=!0);const F=(s||Object.keys(e.springs)).map(ie=>e.springs[ie].start(t)),H=t.cancel===!0||iZ(t,"cancel")===!0;(D||H&&O.asyncId)&&F.push(oZ(++e._lastAsyncId,{props:t,state:O,actions:{pause:n4,resume:n4,start(ie,te){H?(Gx(O,e._lastAsyncId),te(by(e))):(ie.onRest=x,te(lZ(D,ie,O,e)))}}})),O.paused&&(yield new Promise(ie=>{O.resumeQueue.add(ie)}));const Q=eL(e,yield Promise.all(F));if(_&&Q.finished&&!(r&&Q.noop)){const ie=uZ(t,_,c);if(ie)return mZ(e,[ie]),hZ(e,ie,!0)}return a&&Lr.batchedUpdates(()=>a(Q,e,e.item)),Q})}function p$(e,t){const r=de({},e.springs);return t&&ri(ml(t),s=>{yn.und(s.keys)&&(s=Wx(s)),yn.obj(s.to)||(s=_t(de({},s),{to:void 0})),pZ(r,s,c=>fZ(c))}),dZ(e,r),r}function dZ(e,t){Hu(t,(r,s)=>{e.springs[s]||(e.springs[s]=r,d0(r,e))})}function fZ(e,t){const r=new qwe;return r.key=e,t&&d0(r,t),r}function pZ(e,t,r){t.keys&&ri(t.keys,s=>{(e[s]||(e[s]=r(s)))._prepareNode(t)})}function mZ(e,t){ri(t,r=>{pZ(e.springs,r,s=>fZ(s,e))})}var hA=r=>{var s=r,{children:e}=s,t=On(s,["children"]);const c=G.useContext(uI),f=t.pause||!!c.pause,_=t.immediate||!!c.immediate;t=Twe(()=>({pause:f,immediate:_}),[f,_]);const{Provider:x}=uI;return G.createElement(x,{value:t},e)},uI=Kwe(hA,{});hA.Provider=uI.Provider;hA.Consumer=uI.Consumer;function Kwe(e,t){return Object.assign(e,G.createContext(t)),e.Provider._context=e,e.Consumer._context=e,e}var Qwe=()=>{const e=[],t=function(s){bwe();const c=[];return ri(e,(f,_)=>{if(yn.und(s))c.push(f.start());else{const x=r(s,f,_);x&&c.push(f.start(x))}}),c};t.current=e,t.add=function(s){e.includes(s)||e.push(s)},t.delete=function(s){const c=e.indexOf(s);~c&&e.splice(c,1)},t.pause=function(){return ri(e,s=>s.pause(...arguments)),this},t.resume=function(){return ri(e,s=>s.resume(...arguments)),this},t.set=function(s){ri(e,(c,f)=>{const _=yn.fun(s)?s(f,c):s;_&&c.set(_)})},t.start=function(s){const c=[];return ri(e,(f,_)=>{if(yn.und(s))c.push(f.start());else{const x=this._getProps(s,f,_);x&&c.push(f.start(x))}}),c},t.stop=function(){return ri(e,s=>s.stop(...arguments)),this},t.update=function(s){return ri(e,(c,f)=>c.update(this._getProps(s,c,f))),this};const r=function(s,c,f){return yn.fun(s)?s(f,c):s};return t._getProps=r,t};function Ywe(e,t,r){const s=yn.fun(t)&&t;s&&!r&&(r=[]);const c=G.useMemo(()=>s||arguments.length==3?Qwe():void 0,[]),f=G.useRef(0),_=JH(),x=G.useMemo(()=>({ctrls:[],queue:[],flush(W,X){const ee=p$(W,X);return f.current>0&&!x.queue.length&&!Object.keys(ee).some(ye=>!W.springs[ye])?u4(W,X):new Promise(ye=>{dZ(W,ee),x.queue.push(()=>{ye(u4(W,X))}),_()})}}),[]),a=G.useRef([...x.ctrls]),I=[],D=n$(e)||0;G.useMemo(()=>{ri(a.current.slice(e,D),W=>{Nwe(W,c),W.stop(!0)}),a.current.length=e,O(D,e)},[e]),G.useMemo(()=>{O(0,Math.min(D,e))},r);function O(W,X){for(let ee=W;ee<X;ee++){const fe=a.current[ee]||(a.current[ee]=new Xwe(null,x.flush)),ye=s?s(ee,fe):t[ee];ye&&(I[ee]=Gwe(ye))}}const F=a.current.map((W,X)=>p$(W,I[X])),H=G.useContext(hA),Q=n$(H),ie=H!==Q&&zwe(H);Q5(()=>{f.current++,x.ctrls=a.current;const{queue:W}=x;W.length&&(x.queue=[],ri(W,X=>X())),ri(a.current,(X,ee)=>{c==null||c.add(X),ie&&X.start({default:H});const fe=I[ee];fe&&(Fwe(X,fe.ref),X.ref?X.queue.push(fe):X.start(fe))})}),eZ(()=>()=>{ri(x.ctrls,W=>W.stop(!0))});const te=F.map(W=>de({},W));return c?[te,c]:te}function Ab(e,t){const r=yn.fun(e),[[s],c]=Ywe(1,r?e:[e],r?[]:t);return r||arguments.length==2?[s,c]:s}var Jwe=class extends tL{constructor(e,t){super(),this.source=e,this.idle=!0,this._active=new Set,this.calc=Fx(...t);const r=this._get(),s=i4(r);Y5(this,s.create(r))}advance(e){const t=this._get(),r=this.get();kh(t,r)||(Au(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&m$(this._active)&&HR(this)}_get(){const e=yn.arr(this.source)?this.source.map(Ba):ml(Ba(this.source));return this.calc(...e)}_start(){this.idle&&!m$(this._active)&&(this.idle=!1,ri(cA(this),e=>{e.done=!1}),Zc.skipAnimation?(Lr.batchedUpdates(()=>this.advance()),HR(this)):sA.start(this))}_attach(){let e=1;ri(ml(this.source),t=>{Wl(t)&&d0(t,this),a4(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))}),this.priority=e,this._start()}_detach(){ri(ml(this.source),e=>{Wl(e)&&Ux(e,this)}),this._active.clear(),HR(this)}eventObserved(e){e.type=="change"?e.idle?this.advance():(this._active.add(e.parent),this._start()):e.type=="idle"?this._active.delete(e.parent):e.type=="priority"&&(this.priority=ml(this.source).reduce((t,r)=>Math.max(t,(a4(r)?r.priority:0)+1),0))}};function eTe(e){return e.idle!==!1}function m$(e){return!e.size||Array.from(e).every(eTe)}function HR(e){e.idle||(e.idle=!0,ri(cA(e),t=>{t.done=!0}),jx(e,{type:"idle",parent:e}))}Zc.assign({createStringInterpolator:QH,to:(e,t)=>new Jwe(e,t)});var gZ=/^--/;function tTe(e,t){return t==null||typeof t=="boolean"||t===""?"":typeof t=="number"&&t!==0&&!gZ.test(e)&&!(K1.hasOwnProperty(e)&&K1[e])?t+"px":(""+t).trim()}var g$={};function nTe(e,t){if(!e.nodeType||!e.setAttribute)return!1;const r=e.nodeName==="filter"||e.parentNode&&e.parentNode.nodeName==="filter",O=t,{style:s,children:c,scrollTop:f,scrollLeft:_,viewBox:x}=O,a=On(O,["style","children","scrollTop","scrollLeft","viewBox"]),I=Object.values(a),D=Object.keys(a).map(F=>r||e.hasAttribute(F)?F:g$[F]||(g$[F]=F.replace(/([A-Z])/g,H=>"-"+H.toLowerCase())));c!==void 0&&(e.textContent=c);for(const F in s)if(s.hasOwnProperty(F)){const H=tTe(F,s[F]);gZ.test(F)?e.style.setProperty(F,H):e.style[F]=H}D.forEach((F,H)=>{e.setAttribute(F,I[H])}),f!==void 0&&(e.scrollTop=f),_!==void 0&&(e.scrollLeft=_),x!==void 0&&e.setAttribute("viewBox",x)}var K1={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rTe=(e,t)=>e+t.charAt(0).toUpperCase()+t.substring(1),iTe=["Webkit","Ms","Moz","O"];K1=Object.keys(K1).reduce((e,t)=>(iTe.forEach(r=>e[rTe(r,t)]=e[t]),e),K1);var sTe=/^(matrix|translate|scale|rotate|skew)/,oTe=/^(translate)/,aTe=/^(rotate|skew)/,ZR=(e,t)=>yn.num(e)&&e!==0?e+t:e,UE=(e,t)=>yn.arr(e)?e.every(r=>UE(r,t)):yn.num(e)?e===t:parseFloat(e)===t,lTe=class extends uA{constructor(c){var f=c,{x:e,y:t,z:r}=f,s=On(f,["x","y","z"]);const _=[],x=[];(e||t||r)&&(_.push([e||0,t||0,r||0]),x.push(a=>[`translate3d(${a.map(I=>ZR(I,"px")).join(",")})`,UE(a,0)])),Hu(s,(a,I)=>{if(I==="transform")_.push([a||""]),x.push(D=>[D,D===""]);else if(sTe.test(I)){if(delete s[I],yn.und(a))return;const D=oTe.test(I)?"px":aTe.test(I)?"deg":"";_.push(ml(a)),x.push(I==="rotate3d"?([O,F,H,Q])=>[`rotate3d(${O},${F},${H},${ZR(Q,D)})`,UE(Q,0)]:O=>[`${I}(${O.map(F=>ZR(F,D)).join(",")})`,UE(O,I.startsWith("scale")?1:0)])}}),_.length&&(s.transform=new cTe(_,x)),super(s)}},cTe=class extends ZH{constructor(e,t){super(),this.inputs=e,this.transforms=t,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let e="",t=!0;return ri(this.inputs,(r,s)=>{const c=Ba(r[0]),[f,_]=this.transforms[s](yn.arr(c)?c:r.map(Ba));e+=" "+f,t=t&&_}),t?"none":e}observerAdded(e){e==1&&ri(this.inputs,t=>ri(t,r=>Wl(r)&&d0(r,this)))}observerRemoved(e){e==0&&ri(this.inputs,t=>ri(t,r=>Wl(r)&&Ux(r,this)))}eventObserved(e){e.type=="change"&&(this._value=null),jx(this,e)}},uTe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];Zc.assign({batchedUpdates:zI.unstable_batchedUpdates,createStringInterpolator:QH,colors:Ybe});var hTe=Mwe(uTe,{applyAnimatedValues:nTe,createAnimatedStyle:e=>new lTe(e),getComponentProps:s=>{var c=s,{scrollTop:e,scrollLeft:t}=c,r=On(c,["scrollTop","scrollLeft"]);return r}}),_Z=hTe.animated;function h4(e,t){return e.map(function(r,s){return r+t[s]})}function nL(e,t){return e.map(function(r,s){return r-t[s]})}function d4(e){return Math.hypot.apply(Math,e)}function dTe(e,t,r){var s=d4(t),c=s===0?0:1/s,f=r===0?0:1/r,_=f*s,x=t.map(function(D){return f*D}),a=t.map(function(D){return c*D}),I=d4(e);return{velocities:x,velocity:_,distance:I,direction:a}}function f4(e){return Math.sign?Math.sign(e):+(e>0)-+(e<0)||+e}function fTe(e,t,r){return Math.max(t,Math.min(e,r))}function pTe(e,t){return Math.pow(e,t*5)}function _$(e,t,r){return t===0||Math.abs(t)===1/0?pTe(e,r):e*t*r/(t+r*e)}function y$(e,t,r,s){return s===void 0&&(s=.15),s===0?fTe(e,t,r):e<t?-_$(t-e,r-t,s)+t:e>r?+_$(e-r,r-t,s)+r:e}function mTe(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function gTe(e,t,r){return t&&mTe(e.prototype,t),e}function Ta(){return Ta=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ta.apply(this,arguments)}function yZ(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function _Te(e,t){if(e==null)return{};var r={},s=Object.keys(e),c,f;for(f=0;f<s.length;f++)c=s[f],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function Rh(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yTe(e,t){if(e){if(typeof e=="string")return v$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v$(e,t)}}function v$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=e[r];return s}function dA(e,t){var r;if(typeof Symbol=="undefined"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=yTe(e))||t){r&&(e=r);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return r=e[Symbol.iterator](),r.next.bind(r)}function vZ(){}function xZ(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.length===0?vZ:t.length===1?t[0]:function(){for(var s,c=dA(t),f;!(f=c()).done;){var _=f.value;s=_.apply(this,arguments)||s}return s}}function mf(e,t){if(e===void 0){if(t===void 0)throw new Error("Must define fallback value if undefined is expected");e=t}return Array.isArray(e)?e:[e,e]}function x$(e){if(typeof e=="function"){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return e.apply(void 0,r)}else return e}function rL(e,t){e===void 0&&(e={});for(var r={},s=0,c=Object.entries(t);s<c.length;s++){var f=c[s],_=f[0],x=f[1];switch(typeof x){case"function":r[_]=x.call(r,e[_],_,e);break;case"object":r[_]=rL(e[_],x);break;case"boolean":x&&(r[_]=e[_]);break}}return r}function vTe(){try{return"constructor"in GestureEvent}catch(e){return!1}}function bZ(){return typeof window!="undefined"&&"ontouchstart"in window}function xTe(){return typeof window!="undefined"&&"onpointerdown"in window}function wZ(e){return"pointerId"in e?null:e.type==="touchend"?e.changedTouches:e.targetTouches}function TZ(e){return Array.from(wZ(e)).map(function(t){return t.identifier})}function b$(e){var t="buttons"in e?e.buttons:0,r=e.shiftKey,s=e.altKey,c=e.metaKey,f=e.ctrlKey;return{buttons:t,shiftKey:r,altKey:s,metaKey:c,ctrlKey:f}}var bTe=function(t){return t};function w$(e,t){t===void 0&&(t=bTe);var r=wZ(e),s=r?r[0]:e,c=s.clientX,f=s.clientY;return t([c,f])}var wTe=180,TTe=.15,ETe=.5,STe=50,ITe=250,CTe={threshold:function(t){return t===void 0&&(t=0),mf(t)},rubberband:function(t){switch(t===void 0&&(t=0),t){case!0:return mf(TTe);case!1:return mf(0);default:return mf(t)}},enabled:function(t){return t===void 0&&(t=!0),t},triggerAllEvents:function(t){return t===void 0&&(t=!1),t},initial:function(t){return t===void 0&&(t=0),typeof t=="function"?t:mf(t)},transform:!0},EZ=Ta({},CTe,{axis:!0,lockDirection:function(t){return t===void 0&&(t=!1),t},bounds:function(t){if(t===void 0&&(t={}),typeof t=="function")return function(O){return EZ.bounds(t(O))};var r=t,s=r.left,c=s===void 0?-1/0:s,f=r.right,_=f===void 0?1/0:f,x=r.top,a=x===void 0?-1/0:x,I=r.bottom,D=I===void 0?1/0:I;return[[c,_],[a,D]]}}),ATe=typeof window!="undefined"&&window.document&&window.document.createElement,PTe={enabled:function(t){return t===void 0&&(t=!0),t},domTarget:!0,window:function(e){function t(r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return e===void 0&&(e=ATe?window:void 0),e}),eventOptions:function(t){var r=t===void 0?{}:t,s=r.passive,c=s===void 0?!0:s,f=r.capture,_=f===void 0?!1:f;return{passive:c,capture:_}},transform:!0},RTe=Ta({},EZ,{useTouch:function(t){t===void 0&&(t=!1);var r=bZ(),s=xTe();return!!(t&&r||r&&!s)},experimental_preventWindowScrollY:function(t){return t===void 0&&(t=!1),t},threshold:function(t,r,s){var c=s.filterTaps,f=c===void 0?!1:c,_=s.lockDirection,x=_===void 0?!1:_,a=s.axis,I=a===void 0?void 0:a,D=mf(t,f?3:x||I?1:0);return this.filterTaps=f,D},swipeVelocity:function(t){return t===void 0&&(t=ETe),mf(t)},swipeDistance:function(t){return t===void 0&&(t=STe),mf(t)},swipeDuration:function(t){return t===void 0&&(t=ITe),t},delay:function(t){switch(t===void 0&&(t=0),t){case!0:return wTe;case!1:return 0;default:return t}}});function MTe(e){return e===void 0&&(e={}),rL(e,PTe)}function kTe(e){return e===void 0&&(e={}),rL(e,RTe)}function DTe(e){var t=e.domTarget,r=e.eventOptions,s=e.window,c=e.enabled,f=_Te(e,["domTarget","eventOptions","window","enabled"]),_=MTe({domTarget:t,eventOptions:r,window:s,enabled:c});return _.drag=kTe(f),_}function s1(e){return Ta({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_threshold:[0,0],_lastEventType:void 0,_dragStarted:!1,_dragPreventScroll:!1,_dragIsTap:!0,_dragDelayed:!1,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:vZ,canceled:!1,memo:void 0,args:void 0},e)}function SZ(){var e={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1,locked:!1},t=s1({_pointerId:void 0,axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,tap:!1,swipe:[0,0]}),r=s1({_pointerIds:[],da:[0,0],vdva:[0,0],origin:void 0,turns:0}),s=s1({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),c=s1({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),f=s1({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:e,drag:t,pinch:r,wheel:s,move:c,scroll:f}}var hm=new Map,OTe=function(t){return t},LTe=function(){function e(r,s){var c=this;s===void 0&&(s=[]),this.controller=r,this.args=s,this.debounced=!0,this.setTimeout=function(f,_){var x;_===void 0&&(_=140),clearTimeout(c.controller.timeouts[c.stateKey]);for(var a=arguments.length,I=new Array(a>2?a-2:0),D=2;D<a;D++)I[D-2]=arguments[D];c.controller.timeouts[c.stateKey]=(x=window).setTimeout.apply(x,[f,_].concat(I))},this.clearTimeout=function(){clearTimeout(c.controller.timeouts[c.stateKey])},this.fireGestureHandler=function(f){if(f===void 0&&(f=!1),c.state._blocked)return c.debounced||(c.state._active=!1,c.clean()),null;if(!f&&!c.state.intentional&&!c.config.triggerAllEvents)return null;if(c.state.intentional){var _=c.state.active,x=c.state._active;c.state.active=x,c.state.first=x&&!_,c.state.last=_&&!x,c.controller.state.shared[c.ingKey]=x}var a=c.controller.pointerIds.size||c.controller.touchIds.size,I=c.controller.state.shared.buttons>0||a>0,D=Ta({},c.controller.state.shared,c.state,c.mapStateValues(c.state),{locked:!!document.pointerLockElement,touches:a,down:I}),O=c.handler(D);return c.state.memo=O!==void 0?O:c.state.memo,D},this.controller=r,this.args=s}var t=e.prototype;return t.updateSharedState=function(s){Object.assign(this.controller.state.shared,s)},t.updateGestureState=function(s){Object.assign(this.state,s)},t.checkIntentionality=function(s,c){return{_intentional:s,_blocked:!1}},t.getMovement=function(s){var c=this.config.rubberband,f=this.state,_=f._bounds,x=f._initial,a=f._active,I=f._intentional,D=f.lastOffset,O=f.movement,F=f._threshold,H=this.getInternalMovement(s,this.state),Q=I[0]===!1?T$(H[0],F[0]):I[0],ie=I[1]===!1?T$(H[1],F[1]):I[1],te=this.checkIntentionality([Q,ie],H);if(te._blocked)return Ta({},te,{_movement:H,delta:[0,0]});var W=te._intentional,X=H,ee=[W[0]!==!1?H[0]-W[0]:0,W[1]!==!1?H[1]-W[1]:0],fe=h4(ee,D),ye=a?c:[0,0];return ee=E$(_,h4(ee,x),ye),Ta({},te,{intentional:W[0]!==!1||W[1]!==!1,_initial:x,_movement:X,movement:ee,values:s,offset:E$(_,fe,ye),delta:nL(ee,O)})},t.clean=function(){this.clearTimeout()},gTe(e,[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}},{key:"transform",get:function(){return this.config.transform||this.controller.config.transform||OTe}}]),e}();function T$(e,t){return Math.abs(e)>=t?f4(e)*t:!1}function E$(e,t,r){var s=t[0],c=t[1],f=r[0],_=r[1],x=e[0],a=x[0],I=x[1],D=e[1],O=D[0],F=D[1];return[y$(s,a,I,f),y$(c,O,F,_)]}function XR(e,t,r){var s=e.state,c=t.timeStamp,f=t.type,_=s.values,x=r?0:c-s.startTime;return{_lastEventType:f,event:t,timeStamp:c,elapsedTime:x,previous:_}}function zTe(e,t,r,s){var c=e.state,f=e.config,_=e.stateKey,x=e.args,a=e.transform,I=c.offset,D=r.timeStamp,O=f.initial,F=f.bounds,H=f.threshold,Q=nL(a(H),a([0,0])).map(Math.abs),ie=Ta({},SZ()[_],{_active:!0,args:x,values:t,initial:t,_threshold:Q,offset:I,lastOffset:I,startTime:D});return Ta({},ie,{_initial:x$(O,ie),_bounds:x$(F,ie)})}var NTe=function(t){var r=this;this.classes=t,this.pointerIds=new Set,this.touchIds=new Set,this.supportsTouchEvents=bZ(),this.supportsGestureEvents=vTe(),this.bind=function(){for(var s=arguments.length,c=new Array(s),f=0;f<s;f++)c[f]=arguments[f];for(var _={},x=dA(r.classes),a;!(a=x()).done;){var I=a.value;new I(r,c).addBindings(_)}var D=function(H){Su(_,H,function(Q){return r.nativeRefs[H](Ta({},r.state.shared,{event:Q,args:c}))})};for(var O in r.nativeRefs)D(O);return r.config.domTarget?$Te(r,_):qTe(r,_)},this.effect=function(){return r.config.domTarget&&r.bind(),r.clean},this.clean=function(){var s=CZ(r.config),c=r.config.eventOptions;s&&Pb(s,IZ(r.domListeners),c),Object.values(r.timeouts).forEach(clearTimeout),jTe(r)},this.classes=t,this.state=SZ(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function FTe(e,t){"pointerId"in t?e.pointerIds.add(t.pointerId):e.touchIds=new Set(TZ(t))}function BTe(e,t){"pointerId"in t?e.pointerIds.delete(t.pointerId):TZ(t).forEach(function(r){return e.touchIds.delete(r)})}function jTe(e){var t=e.config,r=t.window,s=t.eventOptions,c=e.windowListeners;if(r){for(var f in c){var _=c[f];Pb(r,_,s)}e.windowListeners={}}}function UTe(e,t,r){var s=e.config,c=e.windowListeners;r===void 0&&(r=s.eventOptions),s.window&&(Pb(s.window,c[t],r),delete c[t])}function VTe(e,t,r,s){var c=e.config,f=e.windowListeners;r===void 0&&(r=[]),s===void 0&&(s=c.eventOptions),c.window&&(Pb(c.window,f[t],s),AZ(c.window,f[t]=r,s))}function $Te(e,t){var r=e.config,s=e.domListeners,c=CZ(r);if(!c)throw new Error("domTarget must be defined");var f=r.eventOptions;Pb(c,IZ(s),f);for(var _=0,x=Object.entries(t);_<x.length;_++){var a=x[_],I=a[0],D=a[1],O=I.slice(2).toLowerCase();s.push([O,xZ.apply(void 0,D)])}AZ(c,s,f)}function qTe(e,t){for(var r=e.config,s={},c=r.eventOptions.capture?"Capture":"",f=0,_=Object.entries(t);f<_.length;f++){var x=_[f],a=x[0],I=x[1],D=Array.isArray(I)?I:[I],O=a+c;s[O]=xZ.apply(void 0,D)}return s}function IZ(e){return e===void 0&&(e=[]),e.splice(0,e.length)}function CZ(e){var t=e.domTarget;return t&&"current"in t?t.current:t}function Su(e,t,r){e[t]||(e[t]=[]),e[t].push(r)}function AZ(e,t,r){t===void 0&&(t=[]),r===void 0&&(r={});for(var s=dA(t),c;!(c=s()).done;){var f=c.value,_=f[0],x=f[1];e.addEventListener(_,x,r)}}function Pb(e,t,r){t===void 0&&(t=[]),r===void 0&&(r={});for(var s=dA(t),c;!(c=s()).done;){var f=c.value,_=f[0],x=f[1];e.removeEventListener(_,x,r)}}function GTe(e,t,r){r===void 0&&(r={});var s=HTe(e),c=Xr.useMemo(function(){return new NTe(s)},[]);return c.config=t,c.handlers=e,c.nativeRefs=r,Xr.useEffect(c.effect,[]),c.config.domTarget?WTe:c.bind}function WTe(){}function HTe(e){var t=new Set;return e.drag&&t.add(hm.get("drag")),e.wheel&&t.add(hm.get("wheel")),e.scroll&&t.add(hm.get("scroll")),e.move&&t.add(hm.get("move")),e.pinch&&t.add(hm.get("pinch")),e.hover&&t.add(hm.get("hover")),t}var ZTe=function(e){yZ(t,e);function t(){return e.apply(this,arguments)||this}var r=t.prototype;return r.getInternalMovement=function(c,f){return nL(c,f.initial)},r.checkIntentionality=function(c,f){if(c[0]===!1&&c[1]===!1)return{_intentional:c,axis:this.state.axis};var _=f.map(Math.abs),x=_[0],a=_[1],I=this.state.axis||(x>a?"x":x<a?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:c,_blocked:!1,axis:I}:I?this.config.axis&&I!==this.config.axis?{_intentional:c,_blocked:!0,axis:I}:(c[I==="x"?1:0]=!1,{_intentional:c,_blocked:!1,axis:I}):{_intentional:[!1,!1],_blocked:!1,axis:I}},r.getKinematics=function(c,f){var _=this.getMovement(c);if(!_._blocked){var x=f.timeStamp-this.state.timeStamp;Object.assign(_,dTe(_.movement,_.delta,x))}return _},r.mapStateValues=function(c){return{xy:c.values,vxvy:c.velocities}},t}(LTe),XTe=3;function S$(e){"persist"in e&&typeof e.persist=="function"&&e.persist()}var KTe=function(e){yZ(t,e);function t(){var s;return s=e.apply(this,arguments)||this,s.ingKey="dragging",s.stateKey="drag",s.setPointerCapture=function(c){if(!(s.config.useTouch||document.pointerLockElement)){var f=c.target,_=c.pointerId;f&&"setPointerCapture"in f&&f.setPointerCapture(_),s.updateGestureState({_dragTarget:f,_dragPointerId:_})}},s.releasePointerCapture=function(){if(!(s.config.useTouch||document.pointerLockElement)){var c=s.state,f=c._dragTarget,_=c._dragPointerId;if(_&&f&&"releasePointerCapture"in f&&(!("hasPointerCapture"in f)||f.hasPointerCapture(_)))try{f.releasePointerCapture(_)}catch(x){}}},s.preventScroll=function(c){s.state._dragPreventScroll&&c.cancelable&&c.preventDefault()},s.getEventId=function(c){return s.config.useTouch?c.changedTouches[0].identifier:c.pointerId},s.isValidEvent=function(c){return s.state._pointerId===s.getEventId(c)},s.shouldPreventWindowScrollY=s.config.experimental_preventWindowScrollY&&s.controller.supportsTouchEvents,s.setUpWindowScrollDetection=function(c){S$(c),VTe(s.controller,s.stateKey,[["touchmove",s.preventScroll],["touchend",s.clean.bind(Rh(s))],["touchcancel",s.clean.bind(Rh(s))]],{passive:!1}),s.setTimeout(s.startDrag.bind(Rh(s)),250,c)},s.setUpDelayedDragTrigger=function(c){s.state._dragDelayed=!0,S$(c),s.setTimeout(s.startDrag.bind(Rh(s)),s.config.delay,c)},s.setStartState=function(c){var f=w$(c,s.transform);s.updateSharedState(b$(c)),s.updateGestureState(Ta({},zTe(Rh(s),f,c),XR(Rh(s),c,!0),{_pointerId:s.getEventId(c)})),s.updateGestureState(s.getMovement(f))},s.onDragStart=function(c){FTe(s.controller,c),!(!s.enabled||s.state._active)&&(s.setStartState(c),s.setPointerCapture(c),s.shouldPreventWindowScrollY?s.setUpWindowScrollDetection(c):s.config.delay>0?s.setUpDelayedDragTrigger(c):s.startDrag(c,!0))},s.onDragChange=function(c){if(!(s.state.canceled||!s.state._active||!s.isValidEvent(c)||s.state._lastEventType===c.type&&c.timeStamp===s.state.timeStamp)){var f;if(document.pointerLockElement){var _=c.movementX,x=c.movementY;f=h4(s.transform([_,x]),s.state.values)}else f=w$(c,s.transform);var a=s.getKinematics(f,c);if(!s.state._dragStarted){if(s.state._dragDelayed){s.startDrag(c);return}if(s.shouldPreventWindowScrollY)if(!s.state._dragPreventScroll&&a.axis)if(a.axis==="x")s.startDrag(c);else{s.state._active=!1;return}else return;else return}var I=b$(c);s.updateSharedState(I);var D=XR(Rh(s),c),O=d4(a._movement),F=s.state._dragIsTap;F&&O>=XTe&&(F=!1),s.updateGestureState(Ta({},D,a,{_dragIsTap:F})),s.fireGestureHandler()}},s.onDragEnd=function(c){if(BTe(s.controller,c),!!s.isValidEvent(c)&&(s.clean(),!!s.state._active)){s.state._active=!1;var f=s.state._dragIsTap,_=s.state.velocities,x=_[0],a=_[1],I=s.state.movement,D=I[0],O=I[1],F=s.state._intentional,H=F[0],Q=F[1],ie=s.config.swipeVelocity,te=ie[0],W=ie[1],X=s.config.swipeDistance,ee=X[0],fe=X[1],ye=s.config.swipeDuration,Ee=Ta({},XR(Rh(s),c),s.getMovement(s.state.values)),re=[0,0];Ee.elapsedTime<ye&&(H!==!1&&Math.abs(x)>te&&Math.abs(D)>ee&&(re[0]=f4(x)),Q!==!1&&Math.abs(a)>W&&Math.abs(O)>fe&&(re[1]=f4(a))),s.updateSharedState({buttons:0}),s.updateGestureState(Ta({},Ee,{tap:f,swipe:re})),s.fireGestureHandler(s.config.filterTaps&&f===!0)}},s.clean=function(){e.prototype.clean.call(Rh(s)),s.state._dragStarted=!1,s.releasePointerCapture(),UTe(s.controller,s.stateKey)},s.onCancel=function(){s.state.canceled||(s.updateGestureState({canceled:!0,_active:!1}),s.updateSharedState({buttons:0}),setTimeout(function(){return s.fireGestureHandler()},0))},s.onClick=function(c){s.state._dragIsTap||c.stopPropagation()},s}var r=t.prototype;return r.startDrag=function(c,f){f===void 0&&(f=!1),!(!this.state._active||this.state._dragStarted)&&(f||this.setStartState(c),this.updateGestureState({_dragStarted:!0,_dragPreventScroll:!0,cancel:this.onCancel}),this.clearTimeout(),this.fireGestureHandler())},r.addBindings=function(c){if(this.config.useTouch?(Su(c,"onTouchStart",this.onDragStart),Su(c,"onTouchMove",this.onDragChange),Su(c,"onTouchEnd",this.onDragEnd),Su(c,"onTouchCancel",this.onDragEnd)):(Su(c,"onPointerDown",this.onDragStart),Su(c,"onPointerMove",this.onDragChange),Su(c,"onPointerUp",this.onDragEnd),Su(c,"onPointerCancel",this.onDragEnd)),this.config.filterTaps){var f=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";Su(c,f,this.onClick)}},t}(ZTe);function QTe(e,t){var r,s=[],c,f=!1;function _(){for(var x=arguments.length,a=new Array(x),I=0;I<x;I++)a[I]=arguments[I];return f&&r===this&&t(a,s)||(c=e.apply(this,a),f=!0,r=this,s=a),c}return _}function VE(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,s,c;if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(s=r;s--!==0;)if(!VE(e[s],t[s]))return!1;return!0}var f;if(typeof Map=="function"&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(f=e.entries();!(s=f.next()).done;)if(!t.has(s.value[0]))return!1;for(f=e.entries();!(s=f.next()).done;)if(!VE(s.value[1],t.get(s.value[0])))return!1;return!0}if(typeof Set=="function"&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(f=e.entries();!(s=f.next()).done;)if(!t.has(s.value[0]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(c=Object.keys(e),r=c.length,r!==Object.keys(t).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,c[s]))return!1;if(typeof Element!="undefined"&&e instanceof Element)return!1;for(s=r;s--!==0;)if(!(c[s]==="_owner"&&e.$$typeof)&&!VE(e[c[s]],t[c[s]]))return!1;return!0}return e!==e&&t!==t}function YTe(e,t){try{return VE(e,t)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}}function Rb(e,t){t===void 0&&(t={}),hm.set("drag",KTe);var r=G.useRef();return r.current||(r.current=QTe(DTe,YTe)),GTe({drag:e},r.current(t))}const PZ=G.createContext(),f0=()=>G.useContext(PZ),JTe=({children:e})=>{const[t,r]=G.useState([]),[s,c]=G.useState(null);G.useEffect(()=>{c(Date.now())},[]),G.useEffect(()=>{if(s){const _=Ci(bn,"quests"),x=go(_,Ii("createdAt",">",new Date(s))),a=Gh(x,I=>{I.docChanges().forEach(D=>{if(D.type==="added"){const O=D.doc.data();f(`New quest available: ${O.title}`,"info")}})});return()=>a()}},[s]);const f=G.useCallback((_,x)=>{const a=Date.now();r(I=>[...I,{id:a,message:_,type:x,show:!0}]),setTimeout(()=>{r(I=>I.map(D=>D.id===a?_t(de({},D),{show:!1}):D))},3e3),setTimeout(()=>{r(I=>I.filter(D=>D.id!==a))},3500)},[]);return N.jsxs(PZ.Provider,{value:{notifications:t,showNotification:f},children:[e,N.jsx("div",{className:"notification-container",children:t.map(_=>N.jsx("div",{className:`notification ${_.type} ${_.show?"show":"hide"}`,children:_.message},_.id))})]})};var RZ={exports:{}};(function(e,t){var r={};(function(s,c){e.exports=c()})(OJ,function(){var s,c,f;function _(a,I){if(!s)s=I;else if(!c)c=I;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",O={};s(O),f=I(O),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}_(["exports"],function(a){var I="3.6.0";let D;const O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(D==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{D=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):i}catch(n){D=i}}return D},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!O.API_URL)return null;try{const i=new URL(O.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch(i){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function F(i){return O.API_URL_REGEX.test(i)}function H(i){return i.indexOf("mapbox:")===0}function Q(i){return O.API_CDN_URL_REGEX.test(i)}function ie(i){return O.API_SPRITE_REGEX.test(i)}function te(i){return O.API_STYLE_REGEX.test(i)&&!ie(i)}const W={create:"create",load:"load",fullLoad:"fullLoad"},X={mark(i){performance.mark(i)},measure(i,n,o){performance.measure(i,n,o)}};function ee(i){const n=i.name.split("?")[0];return Q(n)&&n.includes("mapbox-gl.js")?"javascript":Q(n)&&n.includes("mapbox-gl.css")?"css":function(o){return O.API_FONTS_REGEX.test(o)}(n)?"fontRange":ie(n)?"sprite":te(n)?"style":function(o){return O.API_TILEJSON_REGEX.test(o)}(n)?"tilejson":"other"}function fe(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ye={},Ee={};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.setMatrixArrayType=function(i){Ee.ARRAY_TYPE=he=i},Ee.toRadian=function(i){return i*Se},Ee.equals=function(i,n){return Math.abs(i-n)<=re*Math.max(1,Math.abs(i),Math.abs(n))},Ee.RANDOM=Ee.ARRAY_TYPE=Ee.EPSILON=void 0;var re=1e-6;Ee.EPSILON=re;var he=typeof Float32Array!="undefined"?Float32Array:Array;Ee.ARRAY_TYPE=he;var _e=Math.random;Ee.RANDOM=_e;var Se=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,n=arguments.length;n--;)i+=arguments[n]*arguments[n];return Math.sqrt(i)});var J={};function Ie(i){return Ie=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ie(i)}Object.defineProperty(J,"__esModule",{value:!0}),J.create=function(){var i=new we.ARRAY_TYPE(4);return we.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},J.clone=function(i){var n=new we.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},J.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},J.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},J.fromValues=function(i,n,o,u){var h=new we.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=o,h[3]=u,h},J.set=function(i,n,o,u,h){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i},J.transpose=function(i,n){if(i===n){var o=n[1];i[1]=n[2],i[2]=o}else i[0]=n[0],i[1]=n[2],i[2]=n[1],i[3]=n[3];return i},J.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o*p-h*u;return m?(i[0]=p*(m=1/m),i[1]=-u*m,i[2]=-h*m,i[3]=o*m,i):null},J.adjoint=function(i,n){var o=n[0];return i[0]=n[3],i[1]=-n[1],i[2]=-n[2],i[3]=o,i},J.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},J.multiply=Gt,J.rotate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w+p*v,i[1]=h*w+m*v,i[2]=u*-v+p*w,i[3]=h*-v+m*w,i},J.scale=function(i,n,o){var u=n[1],h=n[2],p=n[3],m=o[0],v=o[1];return i[0]=n[0]*m,i[1]=u*m,i[2]=h*v,i[3]=p*v,i},J.fromRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=-o,i[3]=u,i},J.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i},J.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},J.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},J.LDU=function(i,n,o,u){return i[2]=u[2]/u[0],o[0]=u[0],o[1]=u[1],o[3]=u[3]-i[2]*o[1],[i,n,o]},J.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i},J.subtract=qt,J.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},J.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=n[0],v=n[1],w=n[2],E=n[3];return Math.abs(o-m)<=we.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(u-v)<=we.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-w)<=we.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-E)<=we.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},J.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i},J.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i},J.sub=J.mul=void 0;var we=function(i,n){if(i&&i.__esModule)return i;if(i===null||Ie(i)!=="object"&&typeof i!="function")return{default:i};var o=Lt(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function Lt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Lt=function(u){return u?o:n})(i)}function Gt(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[0],w=o[1],E=o[2],C=o[3];return i[0]=u*v+p*w,i[1]=h*v+m*w,i[2]=u*E+p*C,i[3]=h*E+m*C,i}function qt(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i}J.mul=Gt,J.sub=qt;var It={};function ct(i){return ct=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ct(i)}Object.defineProperty(It,"__esModule",{value:!0}),It.create=function(){var i=new Ut.ARRAY_TYPE(6);return Ut.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},It.clone=function(i){var n=new Ut.ARRAY_TYPE(6);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n},It.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i},It.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},It.fromValues=function(i,n,o,u,h,p){var m=new Ut.ARRAY_TYPE(6);return m[0]=i,m[1]=n,m[2]=o,m[3]=u,m[4]=h,m[5]=p,m},It.set=function(i,n,o,u,h,p,m){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i},It.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=o*p-u*h;return w?(i[0]=p*(w=1/w),i[1]=-u*w,i[2]=-h*w,i[3]=o*w,i[4]=(h*v-p*m)*w,i[5]=(u*m-o*v)*w,i):null},It.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},It.multiply=at,It.rotate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=Math.sin(o),C=Math.cos(o);return i[0]=u*C+p*E,i[1]=h*C+m*E,i[2]=u*-E+p*C,i[3]=h*-E+m*C,i[4]=v,i[5]=w,i},It.scale=function(i,n,o){var u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=o[0],E=o[1];return i[0]=n[0]*w,i[1]=u*w,i[2]=h*E,i[3]=p*E,i[4]=m,i[5]=v,i},It.translate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=o[0],C=o[1];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=u*E+p*C+v,i[5]=h*E+m*C+w,i},It.fromRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=-o,i[3]=u,i[4]=0,i[5]=0,i},It.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i[4]=0,i[5]=0,i},It.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=n[0],i[5]=n[1],i},It.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},It.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},It.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i},It.subtract=At,It.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i},It.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i[4]=n[4]+o[4]*u,i[5]=n[5]+o[5]*u,i},It.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]},It.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=n[0],E=n[1],C=n[2],P=n[3],M=n[4],z=n[5];return Math.abs(o-w)<=Ut.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(u-E)<=Ut.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-C)<=Ut.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-P)<=Ut.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-M)<=Ut.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(v-z)<=Ut.EPSILON*Math.max(1,Math.abs(v),Math.abs(z))},It.sub=It.mul=void 0;var Ut=function(i,n){if(i&&i.__esModule)return i;if(i===null||ct(i)!=="object"&&typeof i!="function")return{default:i};var o=Kt(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function Kt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Kt=function(u){return u?o:n})(i)}function at(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=o[0],C=o[1],P=o[2],M=o[3],z=o[4],j=o[5];return i[0]=u*E+p*C,i[1]=h*E+m*C,i[2]=u*P+p*M,i[3]=h*P+m*M,i[4]=u*z+p*j+v,i[5]=h*z+m*j+w,i}function At(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i[4]=n[4]-o[4],i[5]=n[5]-o[5],i}It.mul=at,It.sub=At;var Et={};function Jt(i){return Jt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Jt(i)}Object.defineProperty(Et,"__esModule",{value:!0}),Et.create=function(){var i=new Bt.ARRAY_TYPE(9);return Bt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},Et.fromMat4=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[4],i[4]=n[5],i[5]=n[6],i[6]=n[8],i[7]=n[9],i[8]=n[10],i},Et.clone=function(i){var n=new Bt.ARRAY_TYPE(9);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n},Et.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},Et.fromValues=function(i,n,o,u,h,p,m,v,w){var E=new Bt.ARRAY_TYPE(9);return E[0]=i,E[1]=n,E[2]=o,E[3]=u,E[4]=h,E[5]=p,E[6]=m,E[7]=v,E[8]=w,E},Et.set=function(i,n,o,u,h,p,m,v,w,E){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i[8]=E,i},Et.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Et.transpose=function(i,n){if(i===n){var o=n[1],u=n[2],h=n[5];i[1]=n[3],i[2]=n[6],i[3]=o,i[5]=n[7],i[6]=u,i[7]=h}else i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8];return i},Et.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=C*m-v*E,M=-C*p+v*w,z=E*p-m*w,j=o*P+u*M+h*z;return j?(i[0]=P*(j=1/j),i[1]=(-C*u+h*E)*j,i[2]=(v*u-h*m)*j,i[3]=M*j,i[4]=(C*o-h*w)*j,i[5]=(-v*o+h*p)*j,i[6]=z*j,i[7]=(-E*o+u*w)*j,i[8]=(m*o-u*p)*j,i):null},Et.adjoint=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8];return i[0]=m*C-v*E,i[1]=h*E-u*C,i[2]=u*v-h*m,i[3]=v*w-p*C,i[4]=o*C-h*w,i[5]=h*p-o*v,i[6]=p*E-m*w,i[7]=u*w-o*E,i[8]=o*m-u*p,i},Et.determinant=function(i){var n=i[3],o=i[4],u=i[5],h=i[6],p=i[7],m=i[8];return i[0]*(m*o-u*p)+i[1]*(-m*n+u*h)+i[2]*(p*n-o*h)},Et.multiply=$n,Et.translate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=o[0],z=o[1];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=w,i[6]=M*u+z*m+E,i[7]=M*h+z*v+C,i[8]=M*p+z*w+P,i},Et.rotate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=Math.sin(o),z=Math.cos(o);return i[0]=z*u+M*m,i[1]=z*h+M*v,i[2]=z*p+M*w,i[3]=z*m-M*u,i[4]=z*v-M*h,i[5]=z*w-M*p,i[6]=E,i[7]=C,i[8]=P,i},Et.scale=function(i,n,o){var u=o[0],h=o[1];return i[0]=u*n[0],i[1]=u*n[1],i[2]=u*n[2],i[3]=h*n[3],i[4]=h*n[4],i[5]=h*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},Et.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=n[0],i[7]=n[1],i[8]=1,i},Et.fromRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=0,i[3]=-o,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Et.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},Et.fromMat2d=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=0,i[3]=n[2],i[4]=n[3],i[5]=0,i[6]=n[4],i[7]=n[5],i[8]=1,i},Et.fromQuat=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o+o,v=u+u,w=h+h,E=o*m,C=u*m,P=u*v,M=h*m,z=h*v,j=h*w,V=p*m,$=p*v,Y=p*w;return i[0]=1-P-j,i[3]=C-Y,i[6]=M+$,i[1]=C+Y,i[4]=1-E-j,i[7]=z-V,i[2]=M-$,i[5]=z+V,i[8]=1-E-P,i},Et.normalFromMat4=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=n[9],M=n[10],z=n[11],j=n[12],V=n[13],$=n[14],Y=n[15],me=o*v-u*m,pe=o*w-h*m,ge=o*E-p*m,Pe=u*w-h*v,Re=u*E-p*v,ze=h*E-p*w,Ge=C*V-P*j,Ke=C*$-M*j,it=C*Y-z*j,Je=P*$-M*V,ut=P*Y-z*V,Ct=M*Y-z*$,ht=me*Ct-pe*ut+ge*Je+Pe*it-Re*Ke+ze*Ge;return ht?(i[0]=(v*Ct-w*ut+E*Je)*(ht=1/ht),i[1]=(w*it-m*Ct-E*Ke)*ht,i[2]=(m*ut-v*it+E*Ge)*ht,i[3]=(h*ut-u*Ct-p*Je)*ht,i[4]=(o*Ct-h*it+p*Ke)*ht,i[5]=(u*it-o*ut-p*Ge)*ht,i[6]=(V*ze-$*Re+Y*Pe)*ht,i[7]=($*ge-j*ze-Y*pe)*ht,i[8]=(j*Re-V*ge+Y*me)*ht,i):null},Et.projection=function(i,n,o){return i[0]=2/n,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/o,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},Et.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},Et.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},Et.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i[6]=n[6]+o[6],i[7]=n[7]+o[7],i[8]=n[8]+o[8],i},Et.subtract=Qn,Et.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7]*o,i[8]=n[8]*o,i},Et.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i[4]=n[4]+o[4]*u,i[5]=n[5]+o[5]*u,i[6]=n[6]+o[6]*u,i[7]=n[7]+o[7]*u,i[8]=n[8]+o[8]*u,i},Et.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]},Et.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],C=i[8],P=n[0],M=n[1],z=n[2],j=n[3],V=n[4],$=n[5],Y=n[6],me=n[7],pe=n[8];return Math.abs(o-P)<=Bt.EPSILON*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(u-M)<=Bt.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(h-z)<=Bt.EPSILON*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(p-j)<=Bt.EPSILON*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(m-V)<=Bt.EPSILON*Math.max(1,Math.abs(m),Math.abs(V))&&Math.abs(v-$)<=Bt.EPSILON*Math.max(1,Math.abs(v),Math.abs($))&&Math.abs(w-Y)<=Bt.EPSILON*Math.max(1,Math.abs(w),Math.abs(Y))&&Math.abs(E-me)<=Bt.EPSILON*Math.max(1,Math.abs(E),Math.abs(me))&&Math.abs(C-pe)<=Bt.EPSILON*Math.max(1,Math.abs(C),Math.abs(pe))},Et.sub=Et.mul=void 0;var Bt=function(i,n){if(i&&i.__esModule)return i;if(i===null||Jt(i)!=="object"&&typeof i!="function")return{default:i};var o=Pn(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function Pn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Pn=function(u){return u?o:n})(i)}function $n(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=o[0],z=o[1],j=o[2],V=o[3],$=o[4],Y=o[5],me=o[6],pe=o[7],ge=o[8];return i[0]=M*u+z*m+j*E,i[1]=M*h+z*v+j*C,i[2]=M*p+z*w+j*P,i[3]=V*u+$*m+Y*E,i[4]=V*h+$*v+Y*C,i[5]=V*p+$*w+Y*P,i[6]=me*u+pe*m+ge*E,i[7]=me*h+pe*v+ge*C,i[8]=me*p+pe*w+ge*P,i}function Qn(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i[4]=n[4]-o[4],i[5]=n[5]-o[5],i[6]=n[6]-o[6],i[7]=n[7]-o[7],i[8]=n[8]-o[8],i}Et.mul=$n,Et.sub=Qn;var Xt={};function mr(i){return mr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},mr(i)}Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.create=function(){var i=new An.ARRAY_TYPE(16);return An.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},Xt.clone=function(i){var n=new An.ARRAY_TYPE(16);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],n},Xt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},Xt.fromValues=function(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V){var $=new An.ARRAY_TYPE(16);return $[0]=i,$[1]=n,$[2]=o,$[3]=u,$[4]=h,$[5]=p,$[6]=m,$[7]=v,$[8]=w,$[9]=E,$[10]=C,$[11]=P,$[12]=M,$[13]=z,$[14]=j,$[15]=V,$},Xt.set=function(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i[8]=E,i[9]=C,i[10]=P,i[11]=M,i[12]=z,i[13]=j,i[14]=V,i[15]=$,i},Xt.identity=zr,Xt.transpose=function(i,n){if(i===n){var o=n[1],u=n[2],h=n[3],p=n[6],m=n[7],v=n[11];i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=o,i[6]=n[9],i[7]=n[13],i[8]=u,i[9]=p,i[11]=n[14],i[12]=h,i[13]=m,i[14]=v}else i[0]=n[0],i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=n[1],i[5]=n[5],i[6]=n[9],i[7]=n[13],i[8]=n[2],i[9]=n[6],i[10]=n[10],i[11]=n[14],i[12]=n[3],i[13]=n[7],i[14]=n[11],i[15]=n[15];return i},Xt.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=n[9],M=n[10],z=n[11],j=n[12],V=n[13],$=n[14],Y=n[15],me=o*v-u*m,pe=o*w-h*m,ge=o*E-p*m,Pe=u*w-h*v,Re=u*E-p*v,ze=h*E-p*w,Ge=C*V-P*j,Ke=C*$-M*j,it=C*Y-z*j,Je=P*$-M*V,ut=P*Y-z*V,Ct=M*Y-z*$,ht=me*Ct-pe*ut+ge*Je+Pe*it-Re*Ke+ze*Ge;return ht?(i[0]=(v*Ct-w*ut+E*Je)*(ht=1/ht),i[1]=(h*ut-u*Ct-p*Je)*ht,i[2]=(V*ze-$*Re+Y*Pe)*ht,i[3]=(M*Re-P*ze-z*Pe)*ht,i[4]=(w*it-m*Ct-E*Ke)*ht,i[5]=(o*Ct-h*it+p*Ke)*ht,i[6]=($*ge-j*ze-Y*pe)*ht,i[7]=(C*ze-M*ge+z*pe)*ht,i[8]=(m*ut-v*it+E*Ge)*ht,i[9]=(u*it-o*ut-p*Ge)*ht,i[10]=(j*Re-V*ge+Y*me)*ht,i[11]=(P*ge-C*Re-z*me)*ht,i[12]=(v*Ke-m*Je-w*Ge)*ht,i[13]=(o*Je-u*Ke+h*Ge)*ht,i[14]=(V*pe-j*Pe-$*me)*ht,i[15]=(C*Pe-P*pe+M*me)*ht,i):null},Xt.adjoint=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=n[9],M=n[10],z=n[11],j=n[12],V=n[13],$=n[14],Y=n[15];return i[0]=v*(M*Y-z*$)-P*(w*Y-E*$)+V*(w*z-E*M),i[1]=-(u*(M*Y-z*$)-P*(h*Y-p*$)+V*(h*z-p*M)),i[2]=u*(w*Y-E*$)-v*(h*Y-p*$)+V*(h*E-p*w),i[3]=-(u*(w*z-E*M)-v*(h*z-p*M)+P*(h*E-p*w)),i[4]=-(m*(M*Y-z*$)-C*(w*Y-E*$)+j*(w*z-E*M)),i[5]=o*(M*Y-z*$)-C*(h*Y-p*$)+j*(h*z-p*M),i[6]=-(o*(w*Y-E*$)-m*(h*Y-p*$)+j*(h*E-p*w)),i[7]=o*(w*z-E*M)-m*(h*z-p*M)+C*(h*E-p*w),i[8]=m*(P*Y-z*V)-C*(v*Y-E*V)+j*(v*z-E*P),i[9]=-(o*(P*Y-z*V)-C*(u*Y-p*V)+j*(u*z-p*P)),i[10]=o*(v*Y-E*V)-m*(u*Y-p*V)+j*(u*E-p*v),i[11]=-(o*(v*z-E*P)-m*(u*z-p*P)+C*(u*E-p*v)),i[12]=-(m*(P*$-M*V)-C*(v*$-w*V)+j*(v*M-w*P)),i[13]=o*(P*$-M*V)-C*(u*$-h*V)+j*(u*M-h*P),i[14]=-(o*(v*$-w*V)-m*(u*$-h*V)+j*(u*w-h*v)),i[15]=o*(v*M-w*P)-m*(u*M-h*P)+C*(u*w-h*v),i},Xt.determinant=function(i){var n=i[0],o=i[1],u=i[2],h=i[3],p=i[4],m=i[5],v=i[6],w=i[7],E=i[8],C=i[9],P=i[10],M=i[11],z=i[12],j=i[13],V=i[14],$=i[15];return(n*m-o*p)*(P*$-M*V)-(n*v-u*p)*(C*$-M*j)+(n*w-h*p)*(C*V-P*j)+(o*v-u*m)*(E*$-M*z)-(o*w-h*m)*(E*V-P*z)+(u*w-h*v)*(E*j-C*z)},Xt.multiply=qn,Xt.translate=function(i,n,o){var u,h,p,m,v,w,E,C,P,M,z,j,V=o[0],$=o[1],Y=o[2];return n===i?(i[12]=n[0]*V+n[4]*$+n[8]*Y+n[12],i[13]=n[1]*V+n[5]*$+n[9]*Y+n[13],i[14]=n[2]*V+n[6]*$+n[10]*Y+n[14],i[15]=n[3]*V+n[7]*$+n[11]*Y+n[15]):(h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=n[9],z=n[10],j=n[11],i[0]=u=n[0],i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=w,i[6]=E,i[7]=C,i[8]=P,i[9]=M,i[10]=z,i[11]=j,i[12]=u*V+v*$+P*Y+n[12],i[13]=h*V+w*$+M*Y+n[13],i[14]=p*V+E*$+z*Y+n[14],i[15]=m*V+C*$+j*Y+n[15]),i},Xt.scale=function(i,n,o){var u=o[0],h=o[1],p=o[2];return i[0]=n[0]*u,i[1]=n[1]*u,i[2]=n[2]*u,i[3]=n[3]*u,i[4]=n[4]*h,i[5]=n[5]*h,i[6]=n[6]*h,i[7]=n[7]*h,i[8]=n[8]*p,i[9]=n[9]*p,i[10]=n[10]*p,i[11]=n[11]*p,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},Xt.rotate=function(i,n,o,u){var h,p,m,v,w,E,C,P,M,z,j,V,$,Y,me,pe,ge,Pe,Re,ze,Ge,Ke,it,Je,ut=u[0],Ct=u[1],ht=u[2],Mt=Math.hypot(ut,Ct,ht);return Mt<An.EPSILON?null:(ut*=Mt=1/Mt,Ct*=Mt,ht*=Mt,h=Math.sin(o),p=Math.cos(o),w=n[1],E=n[2],C=n[3],M=n[5],z=n[6],j=n[7],$=n[9],Y=n[10],me=n[11],pe=ut*ut*(m=1-p)+p,Re=ut*Ct*m-ht*h,ze=Ct*Ct*m+p,Ge=ht*Ct*m+ut*h,Ke=ut*ht*m+Ct*h,it=Ct*ht*m-ut*h,Je=ht*ht*m+p,i[0]=(v=n[0])*pe+(P=n[4])*(ge=Ct*ut*m+ht*h)+(V=n[8])*(Pe=ht*ut*m-Ct*h),i[1]=w*pe+M*ge+$*Pe,i[2]=E*pe+z*ge+Y*Pe,i[3]=C*pe+j*ge+me*Pe,i[4]=v*Re+P*ze+V*Ge,i[5]=w*Re+M*ze+$*Ge,i[6]=E*Re+z*ze+Y*Ge,i[7]=C*Re+j*ze+me*Ge,i[8]=v*Ke+P*it+V*Je,i[9]=w*Ke+M*it+$*Je,i[10]=E*Ke+z*it+Y*Je,i[11]=C*Ke+j*it+me*Je,n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i)},Xt.rotateX=function(i,n,o){var u=Math.sin(o),h=Math.cos(o),p=n[4],m=n[5],v=n[6],w=n[7],E=n[8],C=n[9],P=n[10],M=n[11];return n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[4]=p*h+E*u,i[5]=m*h+C*u,i[6]=v*h+P*u,i[7]=w*h+M*u,i[8]=E*h-p*u,i[9]=C*h-m*u,i[10]=P*h-v*u,i[11]=M*h-w*u,i},Xt.rotateY=function(i,n,o){var u=Math.sin(o),h=Math.cos(o),p=n[0],m=n[1],v=n[2],w=n[3],E=n[8],C=n[9],P=n[10],M=n[11];return n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h-E*u,i[1]=m*h-C*u,i[2]=v*h-P*u,i[3]=w*h-M*u,i[8]=p*u+E*h,i[9]=m*u+C*h,i[10]=v*u+P*h,i[11]=w*u+M*h,i},Xt.rotateZ=function(i,n,o){var u=Math.sin(o),h=Math.cos(o),p=n[0],m=n[1],v=n[2],w=n[3],E=n[4],C=n[5],P=n[6],M=n[7];return n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h+E*u,i[1]=m*h+C*u,i[2]=v*h+P*u,i[3]=w*h+M*u,i[4]=E*h-p*u,i[5]=C*h-m*u,i[6]=P*h-v*u,i[7]=M*h-w*u,i},Xt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i},Xt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=n[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Xt.fromRotation=function(i,n,o){var u,h,p,m=o[0],v=o[1],w=o[2],E=Math.hypot(m,v,w);return E<An.EPSILON?null:(m*=E=1/E,v*=E,w*=E,u=Math.sin(n),h=Math.cos(n),i[0]=m*m*(p=1-h)+h,i[1]=v*m*p+w*u,i[2]=w*m*p-v*u,i[3]=0,i[4]=m*v*p-w*u,i[5]=v*v*p+h,i[6]=w*v*p+m*u,i[7]=0,i[8]=m*w*p+v*u,i[9]=v*w*p-m*u,i[10]=w*w*p+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},Xt.fromXRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=o,i[7]=0,i[8]=0,i[9]=-o,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Xt.fromYRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=0,i[2]=-o,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=o,i[9]=0,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Xt.fromZRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=0,i[3]=0,i[4]=-o,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Xt.fromRotationTranslation=Mr,Xt.fromQuat2=function(i,n){var o=new An.ARRAY_TYPE(3),u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=u*u+h*h+p*p+m*m;return P>0?(o[0]=2*(v*m+C*u+w*p-E*h)/P,o[1]=2*(w*m+C*h+E*u-v*p)/P,o[2]=2*(E*m+C*p+v*h-w*u)/P):(o[0]=2*(v*m+C*u+w*p-E*h),o[1]=2*(w*m+C*h+E*u-v*p),o[2]=2*(E*m+C*p+v*h-w*u)),Mr(i,n,o),i},Xt.getTranslation=function(i,n){return i[0]=n[12],i[1]=n[13],i[2]=n[14],i},Xt.getScaling=Vr,Xt.getRotation=function(i,n){var o=new An.ARRAY_TYPE(3);Vr(o,n);var u=1/o[0],h=1/o[1],p=1/o[2],m=n[0]*u,v=n[1]*h,w=n[2]*p,E=n[4]*u,C=n[5]*h,P=n[6]*p,M=n[8]*u,z=n[9]*h,j=n[10]*p,V=m+C+j,$=0;return V>0?($=2*Math.sqrt(V+1),i[3]=.25*$,i[0]=(P-z)/$,i[1]=(M-w)/$,i[2]=(v-E)/$):m>C&&m>j?($=2*Math.sqrt(1+m-C-j),i[3]=(P-z)/$,i[0]=.25*$,i[1]=(v+E)/$,i[2]=(M+w)/$):C>j?($=2*Math.sqrt(1+C-m-j),i[3]=(M-w)/$,i[0]=(v+E)/$,i[1]=.25*$,i[2]=(P+z)/$):($=2*Math.sqrt(1+j-m-C),i[3]=(v-E)/$,i[0]=(M+w)/$,i[1]=(P+z)/$,i[2]=.25*$),i},Xt.fromRotationTranslationScale=function(i,n,o,u){var h=n[0],p=n[1],m=n[2],v=n[3],w=h+h,E=p+p,C=m+m,P=h*w,M=h*E,z=h*C,j=p*E,V=p*C,$=m*C,Y=v*w,me=v*E,pe=v*C,ge=u[0],Pe=u[1],Re=u[2];return i[0]=(1-(j+$))*ge,i[1]=(M+pe)*ge,i[2]=(z-me)*ge,i[3]=0,i[4]=(M-pe)*Pe,i[5]=(1-(P+$))*Pe,i[6]=(V+Y)*Pe,i[7]=0,i[8]=(z+me)*Re,i[9]=(V-Y)*Re,i[10]=(1-(P+j))*Re,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i},Xt.fromRotationTranslationScaleOrigin=function(i,n,o,u,h){var p=n[0],m=n[1],v=n[2],w=n[3],E=p+p,C=m+m,P=v+v,M=p*E,z=p*C,j=p*P,V=m*C,$=m*P,Y=v*P,me=w*E,pe=w*C,ge=w*P,Pe=u[0],Re=u[1],ze=u[2],Ge=h[0],Ke=h[1],it=h[2],Je=(1-(V+Y))*Pe,ut=(z+ge)*Pe,Ct=(j-pe)*Pe,ht=(z-ge)*Re,Mt=(1-(M+Y))*Re,lt=($+me)*Re,xt=(j+pe)*ze,Ot=($-me)*ze,ft=(1-(M+V))*ze;return i[0]=Je,i[1]=ut,i[2]=Ct,i[3]=0,i[4]=ht,i[5]=Mt,i[6]=lt,i[7]=0,i[8]=xt,i[9]=Ot,i[10]=ft,i[11]=0,i[12]=o[0]+Ge-(Je*Ge+ht*Ke+xt*it),i[13]=o[1]+Ke-(ut*Ge+Mt*Ke+Ot*it),i[14]=o[2]+it-(Ct*Ge+lt*Ke+ft*it),i[15]=1,i},Xt.fromQuat=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o+o,v=u+u,w=h+h,E=o*m,C=u*m,P=u*v,M=h*m,z=h*v,j=h*w,V=p*m,$=p*v,Y=p*w;return i[0]=1-P-j,i[1]=C+Y,i[2]=M-$,i[3]=0,i[4]=C-Y,i[5]=1-E-j,i[6]=z+V,i[7]=0,i[8]=M+$,i[9]=z-V,i[10]=1-E-P,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Xt.frustum=function(i,n,o,u,h,p,m){var v=1/(o-n),w=1/(h-u),E=1/(p-m);return i[0]=2*p*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*p*w,i[6]=0,i[7]=0,i[8]=(o+n)*v,i[9]=(h+u)*w,i[10]=(m+p)*E,i[11]=-1,i[12]=0,i[13]=0,i[14]=m*p*2*E,i[15]=0,i},Xt.perspectiveNO=kn,Xt.perspectiveZO=function(i,n,o,u,h){var p,m=1/Math.tan(n/2);return i[0]=m/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=h*(p=1/(u-h)),i[14]=h*u*p):(i[10]=-1,i[14]=-u),i},Xt.perspectiveFromFieldOfView=function(i,n,o,u){var h=Math.tan(n.upDegrees*Math.PI/180),p=Math.tan(n.downDegrees*Math.PI/180),m=Math.tan(n.leftDegrees*Math.PI/180),v=Math.tan(n.rightDegrees*Math.PI/180),w=2/(m+v),E=2/(h+p);return i[0]=w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=E,i[6]=0,i[7]=0,i[8]=-(m-v)*w*.5,i[9]=(h-p)*E*.5,i[10]=u/(o-u),i[11]=-1,i[12]=0,i[13]=0,i[14]=u*o/(o-u),i[15]=0,i},Xt.orthoNO=zn,Xt.orthoZO=function(i,n,o,u,h,p,m){var v=1/(n-o),w=1/(u-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=E,i[11]=0,i[12]=(n+o)*v,i[13]=(h+u)*w,i[14]=p*E,i[15]=1,i},Xt.lookAt=function(i,n,o,u){var h,p,m,v,w,E,C,P,M,z,j=n[0],V=n[1],$=n[2],Y=u[0],me=u[1],pe=u[2],ge=o[0],Pe=o[1],Re=o[2];return Math.abs(j-ge)<An.EPSILON&&Math.abs(V-Pe)<An.EPSILON&&Math.abs($-Re)<An.EPSILON?zr(i):(C=j-ge,P=V-Pe,M=$-Re,h=me*(M*=z=1/Math.hypot(C,P,M))-pe*(P*=z),p=pe*(C*=z)-Y*M,m=Y*P-me*C,(z=Math.hypot(h,p,m))?(h*=z=1/z,p*=z,m*=z):(h=0,p=0,m=0),v=P*m-M*p,w=M*h-C*m,E=C*p-P*h,(z=Math.hypot(v,w,E))?(v*=z=1/z,w*=z,E*=z):(v=0,w=0,E=0),i[0]=h,i[1]=v,i[2]=C,i[3]=0,i[4]=p,i[5]=w,i[6]=P,i[7]=0,i[8]=m,i[9]=E,i[10]=M,i[11]=0,i[12]=-(h*j+p*V+m*$),i[13]=-(v*j+w*V+E*$),i[14]=-(C*j+P*V+M*$),i[15]=1,i)},Xt.targetTo=function(i,n,o,u){var h=n[0],p=n[1],m=n[2],v=u[0],w=u[1],E=u[2],C=h-o[0],P=p-o[1],M=m-o[2],z=C*C+P*P+M*M;z>0&&(C*=z=1/Math.sqrt(z),P*=z,M*=z);var j=w*M-E*P,V=E*C-v*M,$=v*P-w*C;return(z=j*j+V*V+$*$)>0&&(j*=z=1/Math.sqrt(z),V*=z,$*=z),i[0]=j,i[1]=V,i[2]=$,i[3]=0,i[4]=P*$-M*V,i[5]=M*j-C*$,i[6]=C*V-P*j,i[7]=0,i[8]=C,i[9]=P,i[10]=M,i[11]=0,i[12]=h,i[13]=p,i[14]=m,i[15]=1,i},Xt.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},Xt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},Xt.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i[6]=n[6]+o[6],i[7]=n[7]+o[7],i[8]=n[8]+o[8],i[9]=n[9]+o[9],i[10]=n[10]+o[10],i[11]=n[11]+o[11],i[12]=n[12]+o[12],i[13]=n[13]+o[13],i[14]=n[14]+o[14],i[15]=n[15]+o[15],i},Xt.subtract=Ue,Xt.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7]*o,i[8]=n[8]*o,i[9]=n[9]*o,i[10]=n[10]*o,i[11]=n[11]*o,i[12]=n[12]*o,i[13]=n[13]*o,i[14]=n[14]*o,i[15]=n[15]*o,i},Xt.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i[4]=n[4]+o[4]*u,i[5]=n[5]+o[5]*u,i[6]=n[6]+o[6]*u,i[7]=n[7]+o[7]*u,i[8]=n[8]+o[8]*u,i[9]=n[9]+o[9]*u,i[10]=n[10]+o[10]*u,i[11]=n[11]+o[11]*u,i[12]=n[12]+o[12]*u,i[13]=n[13]+o[13]*u,i[14]=n[14]+o[14]*u,i[15]=n[15]+o[15]*u,i},Xt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]&&i[9]===n[9]&&i[10]===n[10]&&i[11]===n[11]&&i[12]===n[12]&&i[13]===n[13]&&i[14]===n[14]&&i[15]===n[15]},Xt.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],C=i[8],P=i[9],M=i[10],z=i[11],j=i[12],V=i[13],$=i[14],Y=i[15],me=n[0],pe=n[1],ge=n[2],Pe=n[3],Re=n[4],ze=n[5],Ge=n[6],Ke=n[7],it=n[8],Je=n[9],ut=n[10],Ct=n[11],ht=n[12],Mt=n[13],lt=n[14],xt=n[15];return Math.abs(o-me)<=An.EPSILON*Math.max(1,Math.abs(o),Math.abs(me))&&Math.abs(u-pe)<=An.EPSILON*Math.max(1,Math.abs(u),Math.abs(pe))&&Math.abs(h-ge)<=An.EPSILON*Math.max(1,Math.abs(h),Math.abs(ge))&&Math.abs(p-Pe)<=An.EPSILON*Math.max(1,Math.abs(p),Math.abs(Pe))&&Math.abs(m-Re)<=An.EPSILON*Math.max(1,Math.abs(m),Math.abs(Re))&&Math.abs(v-ze)<=An.EPSILON*Math.max(1,Math.abs(v),Math.abs(ze))&&Math.abs(w-Ge)<=An.EPSILON*Math.max(1,Math.abs(w),Math.abs(Ge))&&Math.abs(E-Ke)<=An.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ke))&&Math.abs(C-it)<=An.EPSILON*Math.max(1,Math.abs(C),Math.abs(it))&&Math.abs(P-Je)<=An.EPSILON*Math.max(1,Math.abs(P),Math.abs(Je))&&Math.abs(M-ut)<=An.EPSILON*Math.max(1,Math.abs(M),Math.abs(ut))&&Math.abs(z-Ct)<=An.EPSILON*Math.max(1,Math.abs(z),Math.abs(Ct))&&Math.abs(j-ht)<=An.EPSILON*Math.max(1,Math.abs(j),Math.abs(ht))&&Math.abs(V-Mt)<=An.EPSILON*Math.max(1,Math.abs(V),Math.abs(Mt))&&Math.abs($-lt)<=An.EPSILON*Math.max(1,Math.abs($),Math.abs(lt))&&Math.abs(Y-xt)<=An.EPSILON*Math.max(1,Math.abs(Y),Math.abs(xt))},Xt.sub=Xt.mul=Xt.ortho=Xt.perspective=void 0;var An=function(i,n){if(i&&i.__esModule)return i;if(i===null||mr(i)!=="object"&&typeof i!="function")return{default:i};var o=cr(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function cr(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(cr=function(u){return u?o:n})(i)}function zr(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function qn(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],M=n[9],z=n[10],j=n[11],V=n[12],$=n[13],Y=n[14],me=n[15],pe=o[0],ge=o[1],Pe=o[2],Re=o[3];return i[0]=pe*u+ge*v+Pe*P+Re*V,i[1]=pe*h+ge*w+Pe*M+Re*$,i[2]=pe*p+ge*E+Pe*z+Re*Y,i[3]=pe*m+ge*C+Pe*j+Re*me,i[4]=(pe=o[4])*u+(ge=o[5])*v+(Pe=o[6])*P+(Re=o[7])*V,i[5]=pe*h+ge*w+Pe*M+Re*$,i[6]=pe*p+ge*E+Pe*z+Re*Y,i[7]=pe*m+ge*C+Pe*j+Re*me,i[8]=(pe=o[8])*u+(ge=o[9])*v+(Pe=o[10])*P+(Re=o[11])*V,i[9]=pe*h+ge*w+Pe*M+Re*$,i[10]=pe*p+ge*E+Pe*z+Re*Y,i[11]=pe*m+ge*C+Pe*j+Re*me,i[12]=(pe=o[12])*u+(ge=o[13])*v+(Pe=o[14])*P+(Re=o[15])*V,i[13]=pe*h+ge*w+Pe*M+Re*$,i[14]=pe*p+ge*E+Pe*z+Re*Y,i[15]=pe*m+ge*C+Pe*j+Re*me,i}function Mr(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=u+u,w=h+h,E=p+p,C=u*v,P=u*w,M=u*E,z=h*w,j=h*E,V=p*E,$=m*v,Y=m*w,me=m*E;return i[0]=1-(z+V),i[1]=P+me,i[2]=M-Y,i[3]=0,i[4]=P-me,i[5]=1-(C+V),i[6]=j+$,i[7]=0,i[8]=M+Y,i[9]=j-$,i[10]=1-(C+z),i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i}function Vr(i,n){var o=n[4],u=n[5],h=n[6],p=n[8],m=n[9],v=n[10];return i[0]=Math.hypot(n[0],n[1],n[2]),i[1]=Math.hypot(o,u,h),i[2]=Math.hypot(p,m,v),i}function kn(i,n,o,u,h){var p,m=1/Math.tan(n/2);return i[0]=m/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+u)*(p=1/(u-h)),i[14]=2*h*u*p):(i[10]=-1,i[14]=-2*u),i}function zn(i,n,o,u,h,p,m){var v=1/(n-o),w=1/(u-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(n+o)*v,i[13]=(h+u)*w,i[14]=(m+p)*E,i[15]=1,i}function Ue(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i[4]=n[4]-o[4],i[5]=n[5]-o[5],i[6]=n[6]-o[6],i[7]=n[7]-o[7],i[8]=n[8]-o[8],i[9]=n[9]-o[9],i[10]=n[10]-o[10],i[11]=n[11]-o[11],i[12]=n[12]-o[12],i[13]=n[13]-o[13],i[14]=n[14]-o[14],i[15]=n[15]-o[15],i}Xt.perspective=kn,Xt.ortho=zn,Xt.mul=qn,Xt.sub=Ue;var Ye={},gt={};function Qe(i){return Qe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Qe(i)}Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=sn,gt.clone=function(i){var n=new pt.ARRAY_TYPE(3);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n},gt.length=Wt,gt.fromValues=function(i,n,o){var u=new pt.ARRAY_TYPE(3);return u[0]=i,u[1]=n,u[2]=o,u},gt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i},gt.set=function(i,n,o,u){return i[0]=n,i[1]=o,i[2]=u,i},gt.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i},gt.subtract=pn,gt.multiply=Sn,gt.divide=gr,gt.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i},gt.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i},gt.min=function(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i[2]=Math.min(n[2],o[2]),i},gt.max=function(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i[2]=Math.max(n[2],o[2]),i},gt.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i},gt.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i},gt.scaleAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i},gt.distance=xi,gt.squaredDistance=Yr,gt.squaredLength=Li,gt.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i},gt.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i},gt.normalize=function(i,n){var o=n[0],u=n[1],h=n[2],p=o*o+u*u+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=n[0]*p,i[1]=n[1]*p,i[2]=n[2]*p,i},gt.dot=Nr,gt.cross=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=o[0],v=o[1],w=o[2];return i[0]=h*w-p*v,i[1]=p*m-u*w,i[2]=u*v-h*m,i},gt.lerp=function(i,n,o,u){var h=n[0],p=n[1],m=n[2];return i[0]=h+u*(o[0]-h),i[1]=p+u*(o[1]-p),i[2]=m+u*(o[2]-m),i},gt.hermite=function(i,n,o,u,h,p){var m=p*p,v=m*(2*p-3)+1,w=m*(p-2)+p,E=m*(p-1),C=m*(3-2*p);return i[0]=n[0]*v+o[0]*w+u[0]*E+h[0]*C,i[1]=n[1]*v+o[1]*w+u[1]*E+h[1]*C,i[2]=n[2]*v+o[2]*w+u[2]*E+h[2]*C,i},gt.bezier=function(i,n,o,u,h,p){var m=1-p,v=m*m,w=p*p,E=v*m,C=3*p*v,P=3*w*m,M=w*p;return i[0]=n[0]*E+o[0]*C+u[0]*P+h[0]*M,i[1]=n[1]*E+o[1]*C+u[1]*P+h[1]*M,i[2]=n[2]*E+o[2]*C+u[2]*P+h[2]*M,i},gt.random=function(i,n){n=n||1;var o=2*pt.RANDOM()*Math.PI,u=2*pt.RANDOM()-1,h=Math.sqrt(1-u*u)*n;return i[0]=Math.cos(o)*h,i[1]=Math.sin(o)*h,i[2]=u*n,i},gt.transformMat4=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=o[3]*u+o[7]*h+o[11]*p+o[15];return i[0]=(o[0]*u+o[4]*h+o[8]*p+o[12])/(m=m||1),i[1]=(o[1]*u+o[5]*h+o[9]*p+o[13])/m,i[2]=(o[2]*u+o[6]*h+o[10]*p+o[14])/m,i},gt.transformMat3=function(i,n,o){var u=n[0],h=n[1],p=n[2];return i[0]=u*o[0]+h*o[3]+p*o[6],i[1]=u*o[1]+h*o[4]+p*o[7],i[2]=u*o[2]+h*o[5]+p*o[8],i},gt.transformQuat=function(i,n,o){var u=o[0],h=o[1],p=o[2],m=n[0],v=n[1],w=n[2],E=h*w-p*v,C=p*m-u*w,P=u*v-h*m,M=h*P-p*C,z=p*E-u*P,j=u*C-h*E,V=2*o[3];return C*=V,P*=V,z*=2,j*=2,i[0]=m+(E*=V)+(M*=2),i[1]=v+C+z,i[2]=w+P+j,i},gt.rotateX=function(i,n,o,u){var h=[],p=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],p[0]=h[0],p[1]=h[1]*Math.cos(u)-h[2]*Math.sin(u),p[2]=h[1]*Math.sin(u)+h[2]*Math.cos(u),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},gt.rotateY=function(i,n,o,u){var h=[],p=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],p[0]=h[2]*Math.sin(u)+h[0]*Math.cos(u),p[1]=h[1],p[2]=h[2]*Math.cos(u)-h[0]*Math.sin(u),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},gt.rotateZ=function(i,n,o,u){var h=[],p=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],p[0]=h[0]*Math.cos(u)-h[1]*Math.sin(u),p[1]=h[0]*Math.sin(u)+h[1]*Math.cos(u),p[2]=h[2],i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},gt.angle=function(i,n){var o=i[0],u=i[1],h=i[2],p=n[0],m=n[1],v=n[2],w=Math.sqrt(o*o+u*u+h*h)*Math.sqrt(p*p+m*m+v*v),E=w&&Nr(i,n)/w;return Math.acos(Math.min(Math.max(E,-1),1))},gt.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},gt.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},gt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]},gt.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=n[0],m=n[1],v=n[2];return Math.abs(o-p)<=pt.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(u-m)<=pt.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(h-v)<=pt.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))},gt.forEach=gt.sqrLen=gt.len=gt.sqrDist=gt.dist=gt.div=gt.mul=gt.sub=void 0;var pt=function(i,n){if(i&&i.__esModule)return i;if(i===null||Qe(i)!=="object"&&typeof i!="function")return{default:i};var o=dt(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function dt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(dt=function(u){return u?o:n})(i)}function sn(){var i=new pt.ARRAY_TYPE(3);return pt.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Wt(i){return Math.hypot(i[0],i[1],i[2])}function pn(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i}function Sn(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i[2]=n[2]*o[2],i}function gr(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i[2]=n[2]/o[2],i}function xi(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2])}function Yr(i,n){var o=n[0]-i[0],u=n[1]-i[1],h=n[2]-i[2];return o*o+u*u+h*h}function Li(i){var n=i[0],o=i[1],u=i[2];return n*n+o*o+u*u}function Nr(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]}gt.sub=pn,gt.mul=Sn,gt.div=gr,gt.dist=xi,gt.sqrDist=Yr,gt.len=Wt,gt.sqrLen=Li;var di,En=(di=sn(),function(i,n,o,u,h,p){var m,v;for(n||(n=3),o||(o=0),v=u?Math.min(u*n+o,i.length):i.length,m=o;m<v;m+=n)di[0]=i[m],di[1]=i[m+1],di[2]=i[m+2],h(di,di,p),i[m]=di[0],i[m+1]=di[1],i[m+2]=di[2];return i});gt.forEach=En;var hn={};function bi(i){return bi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},bi(i)}Object.defineProperty(hn,"__esModule",{value:!0}),hn.create=Ca,hn.clone=function(i){var n=new ci.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},hn.fromValues=function(i,n,o,u){var h=new ci.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=o,h[3]=u,h},hn.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},hn.set=function(i,n,o,u,h){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i},hn.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i},hn.subtract=an,hn.multiply=ir,hn.divide=oi,hn.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i[3]=Math.ceil(n[3]),i},hn.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i[3]=Math.floor(n[3]),i},hn.min=function(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i[2]=Math.min(n[2],o[2]),i[3]=Math.min(n[3],o[3]),i},hn.max=function(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i[2]=Math.max(n[2],o[2]),i[3]=Math.max(n[3],o[3]),i},hn.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i[3]=Math.round(n[3]),i},hn.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i},hn.scaleAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i},hn.distance=Fi,hn.squaredDistance=Ps,hn.length=Rs,hn.squaredLength=Vs,hn.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=-n[3],i},hn.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i[3]=1/n[3],i},hn.normalize=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o*o+u*u+h*h+p*p;return m>0&&(m=1/Math.sqrt(m)),i[0]=o*m,i[1]=u*m,i[2]=h*m,i[3]=p*m,i},hn.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},hn.cross=function(i,n,o,u){var h=o[0]*u[1]-o[1]*u[0],p=o[0]*u[2]-o[2]*u[0],m=o[0]*u[3]-o[3]*u[0],v=o[1]*u[2]-o[2]*u[1],w=o[1]*u[3]-o[3]*u[1],E=o[2]*u[3]-o[3]*u[2],C=n[0],P=n[1],M=n[2],z=n[3];return i[0]=P*E-M*w+z*v,i[1]=-C*E+M*m-z*p,i[2]=C*w-P*m+z*h,i[3]=-C*v+P*p-M*h,i},hn.lerp=function(i,n,o,u){var h=n[0],p=n[1],m=n[2],v=n[3];return i[0]=h+u*(o[0]-h),i[1]=p+u*(o[1]-p),i[2]=m+u*(o[2]-m),i[3]=v+u*(o[3]-v),i},hn.random=function(i,n){var o,u,h,p,m,v;n=n||1;do m=(o=2*ci.RANDOM()-1)*o+(u=2*ci.RANDOM()-1)*u;while(m>=1);do v=(h=2*ci.RANDOM()-1)*h+(p=2*ci.RANDOM()-1)*p;while(v>=1);var w=Math.sqrt((1-m)/v);return i[0]=n*o,i[1]=n*u,i[2]=n*h*w,i[3]=n*p*w,i},hn.transformMat4=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3];return i[0]=o[0]*u+o[4]*h+o[8]*p+o[12]*m,i[1]=o[1]*u+o[5]*h+o[9]*p+o[13]*m,i[2]=o[2]*u+o[6]*h+o[10]*p+o[14]*m,i[3]=o[3]*u+o[7]*h+o[11]*p+o[15]*m,i},hn.transformQuat=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=o[0],v=o[1],w=o[2],E=o[3],C=E*u+v*p-w*h,P=E*h+w*u-m*p,M=E*p+m*h-v*u,z=-m*u-v*h-w*p;return i[0]=C*E+z*-m+P*-w-M*-v,i[1]=P*E+z*-v+M*-m-C*-w,i[2]=M*E+z*-w+C*-v-P*-m,i[3]=n[3],i},hn.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},hn.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},hn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},hn.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=n[0],v=n[1],w=n[2],E=n[3];return Math.abs(o-m)<=ci.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(u-v)<=ci.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-w)<=ci.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-E)<=ci.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},hn.forEach=hn.sqrLen=hn.len=hn.sqrDist=hn.dist=hn.div=hn.mul=hn.sub=void 0;var ci=function(i,n){if(i&&i.__esModule)return i;if(i===null||bi(i)!=="object"&&typeof i!="function")return{default:i};var o=Us(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function Us(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Us=function(u){return u?o:n})(i)}function Ca(){var i=new ci.ARRAY_TYPE(4);return ci.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function an(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i}function ir(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i[2]=n[2]*o[2],i[3]=n[3]*o[3],i}function oi(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i[2]=n[2]/o[2],i[3]=n[3]/o[3],i}function Fi(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2],n[3]-i[3])}function Ps(i,n){var o=n[0]-i[0],u=n[1]-i[1],h=n[2]-i[2],p=n[3]-i[3];return o*o+u*u+h*h+p*p}function Rs(i){return Math.hypot(i[0],i[1],i[2],i[3])}function Vs(i){var n=i[0],o=i[1],u=i[2],h=i[3];return n*n+o*o+u*u+h*h}hn.sub=an,hn.mul=ir,hn.div=oi,hn.dist=Fi,hn.sqrDist=Ps,hn.len=Rs,hn.sqrLen=Vs;var Ks=function(){var i=Ca();return function(n,o,u,h,p,m){var v,w;for(o||(o=4),u||(u=0),w=h?Math.min(h*o+u,n.length):n.length,v=u;v<w;v+=o)i[0]=n[v],i[1]=n[v+1],i[2]=n[v+2],i[3]=n[v+3],p(i,i,m),n[v]=i[0],n[v+1]=i[1],n[v+2]=i[2],n[v+3]=i[3];return n}}();function jo(i){return jo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},jo(i)}hn.forEach=Ks,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.create=vo,Ye.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},Ye.setAxisAngle=Gi,Ye.getAxisAngle=function(i,n){var o=2*Math.acos(n[3]),u=Math.sin(o/2);return u>qr.EPSILON?(i[0]=n[0]/u,i[1]=n[1]/u,i[2]=n[2]/u):(i[0]=1,i[1]=0,i[2]=0),o},Ye.getAngle=function(i,n){var o=Oe(i,n);return Math.acos(2*o*o-1)},Ye.multiply=Ju,Ye.rotateX=function(i,n,o){o*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w+m*v,i[1]=h*w+p*v,i[2]=p*w-h*v,i[3]=m*w-u*v,i},Ye.rotateY=function(i,n,o){o*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w-p*v,i[1]=h*w+m*v,i[2]=p*w+u*v,i[3]=m*w-h*v,i},Ye.rotateZ=function(i,n,o){o*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w+h*v,i[1]=h*w-u*v,i[2]=p*w+m*v,i[3]=m*w-p*v,i},Ye.calculateW=function(i,n){var o=n[0],u=n[1],h=n[2];return i[0]=o,i[1]=u,i[2]=h,i[3]=Math.sqrt(Math.abs(1-o*o-u*u-h*h)),i},Ye.exp=Ve,Ye.ln=ne,Ye.pow=function(i,n,o){return ne(i,n),Le(i,i,o),Ve(i,i),i},Ye.slerp=le,Ye.random=function(i){var n=qr.RANDOM(),o=qr.RANDOM(),u=qr.RANDOM(),h=Math.sqrt(1-n),p=Math.sqrt(n);return i[0]=h*Math.sin(2*Math.PI*o),i[1]=h*Math.cos(2*Math.PI*o),i[2]=p*Math.sin(2*Math.PI*u),i[3]=p*Math.cos(2*Math.PI*u),i},Ye.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o*o+u*u+h*h+p*p,v=m?1/m:0;return i[0]=-o*v,i[1]=-u*v,i[2]=-h*v,i[3]=p*v,i},Ye.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i},Ye.fromMat3=Te,Ye.fromEuler=function(i,n,o,u){var h=.5*Math.PI/180;n*=h,o*=h,u*=h;var p=Math.sin(n),m=Math.cos(n),v=Math.sin(o),w=Math.cos(o),E=Math.sin(u),C=Math.cos(u);return i[0]=p*w*C-m*v*E,i[1]=m*v*C+p*w*E,i[2]=m*w*E-p*v*C,i[3]=m*w*C+p*v*E,i},Ye.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},Ye.setAxes=Ye.sqlerp=Ye.rotationTo=Ye.equals=Ye.exactEquals=Ye.normalize=Ye.sqrLen=Ye.squaredLength=Ye.len=Ye.length=Ye.lerp=Ye.dot=Ye.scale=Ye.mul=Ye.add=Ye.set=Ye.copy=Ye.fromValues=Ye.clone=void 0;var qr=Aa(Ee),Qa=Aa(Et),ai=Aa(gt),Ai=Aa(hn);function Cl(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Cl=function(u){return u?o:n})(i)}function Aa(i,n){if(i&&i.__esModule)return i;if(i===null||jo(i)!=="object"&&typeof i!="function")return{default:i};var o=Cl(n);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}function vo(){var i=new qr.ARRAY_TYPE(4);return qr.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Gi(i,n,o){o*=.5;var u=Math.sin(o);return i[0]=u*n[0],i[1]=u*n[1],i[2]=u*n[2],i[3]=Math.cos(o),i}function Ju(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[0],w=o[1],E=o[2],C=o[3];return i[0]=u*C+m*v+h*E-p*w,i[1]=h*C+m*w+p*v-u*E,i[2]=p*C+m*E+u*w-h*v,i[3]=m*C-u*v-h*w-p*E,i}function Ve(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=Math.sqrt(o*o+u*u+h*h),v=Math.exp(p),w=m>0?v*Math.sin(m)/m:0;return i[0]=o*w,i[1]=u*w,i[2]=h*w,i[3]=v*Math.cos(m),i}function ne(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=Math.sqrt(o*o+u*u+h*h),v=m>0?Math.atan2(m,p)/m:0;return i[0]=o*v,i[1]=u*v,i[2]=h*v,i[3]=.5*Math.log(o*o+u*u+h*h+p*p),i}function le(i,n,o,u){var h,p,m,v,w,E=n[0],C=n[1],P=n[2],M=n[3],z=o[0],j=o[1],V=o[2],$=o[3];return(p=E*z+C*j+P*V+M*$)<0&&(p=-p,z=-z,j=-j,V=-V,$=-$),1-p>qr.EPSILON?(h=Math.acos(p),m=Math.sin(h),v=Math.sin((1-u)*h)/m,w=Math.sin(u*h)/m):(v=1-u,w=u),i[0]=v*E+w*z,i[1]=v*C+w*j,i[2]=v*P+w*V,i[3]=v*M+w*$,i}function Te(i,n){var o,u=n[0]+n[4]+n[8];if(u>0)o=Math.sqrt(u+1),i[3]=.5*o,i[0]=(n[5]-n[7])*(o=.5/o),i[1]=(n[6]-n[2])*o,i[2]=(n[1]-n[3])*o;else{var h=0;n[4]>n[0]&&(h=1),n[8]>n[3*h+h]&&(h=2);var p=(h+1)%3,m=(h+2)%3;o=Math.sqrt(n[3*h+h]-n[3*p+p]-n[3*m+m]+1),i[h]=.5*o,i[3]=(n[3*p+m]-n[3*m+p])*(o=.5/o),i[p]=(n[3*p+h]+n[3*h+p])*o,i[m]=(n[3*m+h]+n[3*h+m])*o}return i}Ye.clone=Ai.clone,Ye.fromValues=Ai.fromValues,Ye.copy=Ai.copy,Ye.set=Ai.set,Ye.add=Ai.add,Ye.mul=Ju;var Le=Ai.scale;Ye.scale=Le;var Oe=Ai.dot;Ye.dot=Oe,Ye.lerp=Ai.lerp;var He=Ai.length;Ye.length=He,Ye.len=He;var st=Ai.squaredLength;Ye.squaredLength=st,Ye.sqrLen=st;var We=Ai.normalize;Ye.normalize=We,Ye.exactEquals=Ai.exactEquals,Ye.equals=Ai.equals;var rt,wt,Tt,Qt=(rt=ai.create(),wt=ai.fromValues(1,0,0),Tt=ai.fromValues(0,1,0),function(i,n,o){var u=ai.dot(n,o);return u<-.999999?(ai.cross(rt,wt,n),ai.len(rt)<1e-6&&ai.cross(rt,Tt,n),ai.normalize(rt,rt),Gi(i,rt,Math.PI),i):u>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(ai.cross(rt,n,o),i[0]=rt[0],i[1]=rt[1],i[2]=rt[2],i[3]=1+u,We(i,i))});Ye.rotationTo=Qt;var _n,Cn,ur=(_n=vo(),Cn=vo(),function(i,n,o,u,h,p){return le(_n,n,h,p),le(Cn,o,u,p),le(i,_n,Cn,2*p*(1-p)),i});Ye.sqlerp=ur;var Dn,hr=(Dn=Qa.create(),function(i,n,o,u){return Dn[0]=o[0],Dn[3]=o[1],Dn[6]=o[2],Dn[1]=u[0],Dn[4]=u[1],Dn[7]=u[2],Dn[2]=-n[0],Dn[5]=-n[1],Dn[8]=-n[2],We(i,Te(i,Dn))});Ye.setAxes=hr;var dn={};function Jr(i){return Jr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Jr(i)}Object.defineProperty(dn,"__esModule",{value:!0}),dn.create=function(){var i=new vr.ARRAY_TYPE(8);return vr.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},dn.clone=function(i){var n=new vr.ARRAY_TYPE(8);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n},dn.fromValues=function(i,n,o,u,h,p,m,v){var w=new vr.ARRAY_TYPE(8);return w[0]=i,w[1]=n,w[2]=o,w[3]=u,w[4]=h,w[5]=p,w[6]=m,w[7]=v,w},dn.fromRotationTranslationValues=function(i,n,o,u,h,p,m){var v=new vr.ARRAY_TYPE(8);v[0]=i,v[1]=n,v[2]=o,v[3]=u;var w=.5*h,E=.5*p,C=.5*m;return v[4]=w*u+E*o-C*n,v[5]=E*u+C*i-w*o,v[6]=C*u+w*n-E*i,v[7]=-w*i-E*n-C*o,v},dn.fromRotationTranslation=Ms,dn.fromTranslation=function(i,n){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*n[0],i[5]=.5*n[1],i[6]=.5*n[2],i[7]=0,i},dn.fromRotation=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},dn.fromMat4=function(i,n){var o=dr.create();wi.getRotation(o,n);var u=new vr.ARRAY_TYPE(3);return wi.getTranslation(u,n),Ms(i,o,u),i},dn.copy=Qs,dn.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},dn.set=function(i,n,o,u,h,p,m,v,w){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i},dn.getDual=function(i,n){return i[0]=n[4],i[1]=n[5],i[2]=n[6],i[3]=n[7],i},dn.setDual=function(i,n){return i[4]=n[0],i[5]=n[1],i[6]=n[2],i[7]=n[3],i},dn.getTranslation=function(i,n){var o=n[4],u=n[5],h=n[6],p=n[7],m=-n[0],v=-n[1],w=-n[2],E=n[3];return i[0]=2*(o*E+p*m+u*w-h*v),i[1]=2*(u*E+p*v+h*m-o*w),i[2]=2*(h*E+p*w+o*v-u*m),i},dn.translate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=.5*o[0],w=.5*o[1],E=.5*o[2],C=n[4],P=n[5],M=n[6],z=n[7];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=m*v+h*E-p*w+C,i[5]=m*w+p*v-u*E+P,i[6]=m*E+u*w-h*v+M,i[7]=-u*v-h*w-p*E+z,i},dn.rotateX=function(i,n,o){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=v*m+C*u+w*p-E*h,M=w*m+C*h+E*u-v*p,z=E*m+C*p+v*h-w*u,j=C*m-v*u-w*h-E*p;return dr.rotateX(i,n,o),i[4]=P*(m=i[3])+j*(u=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+j*h+z*u-P*p,i[6]=z*m+j*p+P*h-M*u,i[7]=j*m-P*u-M*h-z*p,i},dn.rotateY=function(i,n,o){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=v*m+C*u+w*p-E*h,M=w*m+C*h+E*u-v*p,z=E*m+C*p+v*h-w*u,j=C*m-v*u-w*h-E*p;return dr.rotateY(i,n,o),i[4]=P*(m=i[3])+j*(u=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+j*h+z*u-P*p,i[6]=z*m+j*p+P*h-M*u,i[7]=j*m-P*u-M*h-z*p,i},dn.rotateZ=function(i,n,o){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=v*m+C*u+w*p-E*h,M=w*m+C*h+E*u-v*p,z=E*m+C*p+v*h-w*u,j=C*m-v*u-w*h-E*p;return dr.rotateZ(i,n,o),i[4]=P*(m=i[3])+j*(u=i[0])+M*(p=i[2])-z*(h=i[1]),i[5]=M*m+j*h+z*u-P*p,i[6]=z*m+j*p+P*h-M*u,i[7]=j*m-P*u-M*h-z*p,i},dn.rotateByQuatAppend=function(i,n,o){var u=o[0],h=o[1],p=o[2],m=o[3],v=n[0],w=n[1],E=n[2],C=n[3];return i[0]=v*m+C*u+w*p-E*h,i[1]=w*m+C*h+E*u-v*p,i[2]=E*m+C*p+v*h-w*u,i[3]=C*m-v*u-w*h-E*p,i[4]=(v=n[4])*m+(C=n[7])*u+(w=n[5])*p-(E=n[6])*h,i[5]=w*m+C*h+E*u-v*p,i[6]=E*m+C*p+v*h-w*u,i[7]=C*m-v*u-w*h-E*p,i},dn.rotateByQuatPrepend=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[0],w=o[1],E=o[2],C=o[3];return i[0]=u*C+m*v+h*E-p*w,i[1]=h*C+m*w+p*v-u*E,i[2]=p*C+m*E+u*w-h*v,i[3]=m*C-u*v-h*w-p*E,i[4]=u*(C=o[7])+m*(v=o[4])+h*(E=o[6])-p*(w=o[5]),i[5]=h*C+m*w+p*v-u*E,i[6]=p*C+m*E+u*w-h*v,i[7]=m*C-u*v-h*w-p*E,i},dn.rotateAroundAxis=function(i,n,o,u){if(Math.abs(u)<vr.EPSILON)return Qs(i,n);var h=Math.hypot(o[0],o[1],o[2]);u*=.5;var p=Math.sin(u),m=p*o[0]/h,v=p*o[1]/h,w=p*o[2]/h,E=Math.cos(u),C=n[0],P=n[1],M=n[2],z=n[3];i[0]=C*E+z*m+P*w-M*v,i[1]=P*E+z*v+M*m-C*w,i[2]=M*E+z*w+C*v-P*m,i[3]=z*E-C*m-P*v-M*w;var j=n[4],V=n[5],$=n[6],Y=n[7];return i[4]=j*E+Y*m+V*w-$*v,i[5]=V*E+Y*v+$*m-j*w,i[6]=$*E+Y*w+j*v-V*m,i[7]=Y*E-j*m-V*v-$*w,i},dn.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i[6]=n[6]+o[6],i[7]=n[7]+o[7],i},dn.multiply=sc,dn.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7]*o,i},dn.lerp=function(i,n,o,u){var h=1-u;return dd(n,o)<0&&(u=-u),i[0]=n[0]*h+o[0]*u,i[1]=n[1]*h+o[1]*u,i[2]=n[2]*h+o[2]*u,i[3]=n[3]*h+o[3]*u,i[4]=n[4]*h+o[4]*u,i[5]=n[5]*h+o[5]*u,i[6]=n[6]*h+o[6]*u,i[7]=n[7]*h+o[7]*u,i},dn.invert=function(i,n){var o=eh(n);return i[0]=-n[0]/o,i[1]=-n[1]/o,i[2]=-n[2]/o,i[3]=n[3]/o,i[4]=-n[4]/o,i[5]=-n[5]/o,i[6]=-n[6]/o,i[7]=n[7]/o,i},dn.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i[4]=-n[4],i[5]=-n[5],i[6]=-n[6],i[7]=n[7],i},dn.normalize=function(i,n){var o=eh(n);if(o>0){o=Math.sqrt(o);var u=n[0]/o,h=n[1]/o,p=n[2]/o,m=n[3]/o,v=n[4],w=n[5],E=n[6],C=n[7],P=u*v+h*w+p*E+m*C;i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=(v-u*P)/o,i[5]=(w-h*P)/o,i[6]=(E-p*P)/o,i[7]=(C-m*P)/o}return i},dn.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},dn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]},dn.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],C=n[0],P=n[1],M=n[2],z=n[3],j=n[4],V=n[5],$=n[6],Y=n[7];return Math.abs(o-C)<=vr.EPSILON*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(u-P)<=vr.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(h-M)<=vr.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(p-z)<=vr.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(m-j)<=vr.EPSILON*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(v-V)<=vr.EPSILON*Math.max(1,Math.abs(v),Math.abs(V))&&Math.abs(w-$)<=vr.EPSILON*Math.max(1,Math.abs(w),Math.abs($))&&Math.abs(E-Y)<=vr.EPSILON*Math.max(1,Math.abs(E),Math.abs(Y))},dn.sqrLen=dn.squaredLength=dn.len=dn.length=dn.dot=dn.mul=dn.setReal=dn.getReal=void 0;var vr=Yi(Ee),dr=Yi(Ye),wi=Yi(Xt);function Ti(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Ti=function(u){return u?o:n})(i)}function Yi(i,n){if(i&&i.__esModule)return i;if(i===null||Jr(i)!=="object"&&typeof i!="function")return{default:i};var o=Ti(n);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}function Ms(i,n,o){var u=.5*o[0],h=.5*o[1],p=.5*o[2],m=n[0],v=n[1],w=n[2],E=n[3];return i[0]=m,i[1]=v,i[2]=w,i[3]=E,i[4]=u*E+h*w-p*v,i[5]=h*E+p*m-u*w,i[6]=p*E+u*v-h*m,i[7]=-u*m-h*v-p*w,i}function Qs(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i}function sc(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[4],w=o[5],E=o[6],C=o[7],P=n[4],M=n[5],z=n[6],j=n[7],V=o[0],$=o[1],Y=o[2],me=o[3];return i[0]=u*me+m*V+h*Y-p*$,i[1]=h*me+m*$+p*V-u*Y,i[2]=p*me+m*Y+u*$-h*V,i[3]=m*me-u*V-h*$-p*Y,i[4]=u*C+m*v+h*E-p*w+P*me+j*V+M*Y-z*$,i[5]=h*C+m*w+p*v-u*E+M*me+j*$+z*V-P*Y,i[6]=p*C+m*E+u*w-h*v+z*me+j*Y+P*$-M*V,i[7]=m*C-u*v-h*w-p*E+j*me-P*V-M*$-z*Y,i}dn.getReal=dr.copy,dn.setReal=dr.copy,dn.mul=sc;var dd=dr.dot;dn.dot=dd;var fd=dr.length;dn.length=fd,dn.len=fd;var eh=dr.squaredLength;dn.squaredLength=eh,dn.sqrLen=eh;var Nn={};function Uo(i){return Uo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Uo(i)}Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.create=pd,Nn.clone=function(i){var n=new sa.ARRAY_TYPE(2);return n[0]=i[0],n[1]=i[1],n},Nn.fromValues=function(i,n){var o=new sa.ARRAY_TYPE(2);return o[0]=i,o[1]=n,o},Nn.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i},Nn.set=function(i,n,o){return i[0]=n,i[1]=o,i},Nn.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i},Nn.subtract=fi,Nn.multiply=Kc,Nn.divide=oc,Nn.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i},Nn.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i},Nn.min=function(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i},Nn.max=function(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i},Nn.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i},Nn.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i},Nn.scaleAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i},Nn.distance=ac,Nn.squaredDistance=sp,Nn.length=Qc,Nn.squaredLength=th,Nn.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i},Nn.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i},Nn.normalize=function(i,n){var o=n[0],u=n[1],h=o*o+u*u;return h>0&&(h=1/Math.sqrt(h)),i[0]=n[0]*h,i[1]=n[1]*h,i},Nn.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]},Nn.cross=function(i,n,o){var u=n[0]*o[1]-n[1]*o[0];return i[0]=i[1]=0,i[2]=u,i},Nn.lerp=function(i,n,o,u){var h=n[0],p=n[1];return i[0]=h+u*(o[0]-h),i[1]=p+u*(o[1]-p),i},Nn.random=function(i,n){n=n||1;var o=2*sa.RANDOM()*Math.PI;return i[0]=Math.cos(o)*n,i[1]=Math.sin(o)*n,i},Nn.transformMat2=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[2]*h,i[1]=o[1]*u+o[3]*h,i},Nn.transformMat2d=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[2]*h+o[4],i[1]=o[1]*u+o[3]*h+o[5],i},Nn.transformMat3=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[3]*h+o[6],i[1]=o[1]*u+o[4]*h+o[7],i},Nn.transformMat4=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[4]*h+o[12],i[1]=o[1]*u+o[5]*h+o[13],i},Nn.rotate=function(i,n,o,u){var h=n[0]-o[0],p=n[1]-o[1],m=Math.sin(u),v=Math.cos(u);return i[0]=h*v-p*m+o[0],i[1]=h*m+p*v+o[1],i},Nn.angle=function(i,n){var o=i[0],u=i[1],h=n[0],p=n[1],m=Math.sqrt(o*o+u*u)*Math.sqrt(h*h+p*p);return Math.acos(Math.min(Math.max(m&&(o*h+u*p)/m,-1),1))},Nn.zero=function(i){return i[0]=0,i[1]=0,i},Nn.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},Nn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]},Nn.equals=function(i,n){var o=i[0],u=i[1],h=n[0],p=n[1];return Math.abs(o-h)<=sa.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(u-p)<=sa.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))},Nn.forEach=Nn.sqrLen=Nn.sqrDist=Nn.dist=Nn.div=Nn.mul=Nn.sub=Nn.len=void 0;var sa=function(i,n){if(i&&i.__esModule)return i;if(i===null||Uo(i)!=="object"&&typeof i!="function")return{default:i};var o=Xc(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function Xc(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Xc=function(u){return u?o:n})(i)}function pd(){var i=new sa.ARRAY_TYPE(2);return sa.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function fi(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i}function Kc(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i}function oc(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i}function ac(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1])}function sp(i,n){var o=n[0]-i[0],u=n[1]-i[1];return o*o+u*u}function Qc(i){return Math.hypot(i[0],i[1])}function th(i){var n=i[0],o=i[1];return n*n+o*o}Nn.len=Qc,Nn.sub=fi,Nn.mul=Kc,Nn.div=oc,Nn.dist=ac,Nn.sqrDist=sp,Nn.sqrLen=th;var md=function(){var i=pd();return function(n,o,u,h,p,m){var v,w;for(o||(o=2),u||(u=0),w=h?Math.min(h*o+u,n.length):n.length,v=u;v<w;v+=o)i[0]=n[v],i[1]=n[v+1],p(i,i,m),n[v]=i[0],n[v+1]=i[1];return n}}();function gd(i){return gd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},gd(i)}Nn.forEach=md,Object.defineProperty(ye,"__esModule",{value:!0}),a.aB=ye.vec4=a.$=ye.vec3=ye.vec2=ye.quat2=a.aw=ye.quat=a.ae=ye.mat4=a.bE=ye.mat3=ye.mat2d=a.aD=ye.mat2=ye.glMatrix=void 0;var pg=Ro(Ee);ye.glMatrix=pg;var Yc=Ro(J);a.aD=ye.mat2=Yc;var Po=Ro(It);ye.mat2d=Po;var fr=Ro(Et);a.bE=ye.mat3=fr;var mg=Ro(Xt);a.ae=ye.mat4=mg;var gg=Ro(Ye);a.aw=ye.quat=gg;var Jc=Ro(dn);ye.quat2=Jc;var _g=Ro(Nn);ye.vec2=_g;var _0=Ro(gt);a.$=ye.vec3=_0;var op=Ro(hn);function Vo(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Vo=function(u){return u?o:n})(i)}function Ro(i,n){if(i&&i.__esModule)return i;if(i===null||gd(i)!=="object"&&typeof i!="function")return{default:i};var o=Vo(n);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}a.aB=ye.vec4=op;var yg=eu;function eu(i,n,o,u){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=o,this.p2y=u}eu.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,n){if(n===void 0&&(n=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,u=0;u<8;u++){var h=this.sampleCurveX(o)-i;if(Math.abs(h)<n)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=h/p}var m=0,v=1;for(o=i,u=0;u<20&&(h=this.sampleCurveX(o),!(Math.abs(h-i)<n));u++)i>h?m=o:v=o,o=.5*(v-m)+m;return o},solve:function(i,n){return this.sampleCurveY(this.solveCurveX(i,n))}};var tu=fe(yg),nu=oa;function oa(i,n){this.x=i,this.y=n}oa.prototype={clone:function(){return new oa(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,n){return this.clone()._rotateAround(i,n)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var n=i.x-this.x,o=i.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,n){return Math.atan2(this.x*n-this.y*i,this.x*i+this.y*n)},_matMult:function(i){var n=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=n,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var n=Math.cos(i),o=Math.sin(i),u=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=u,this},_rotateAround:function(i,n){var o=Math.cos(i),u=Math.sin(i),h=n.y+u*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-u*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oa.convert=function(i){return i instanceof oa?i:Array.isArray(i)?new oa(i[0],i[1]):i};var Ft=fe(nu);function lc(i,n){if(Array.isArray(i)){if(!Array.isArray(n)||i.length!==n.length)return!1;for(let o=0;o<i.length;o++)if(!lc(i[o],n[o]))return!1;return!0}if(typeof i=="object"&&i!==null&&n!==null){if(typeof n!="object"||Object.keys(i).length!==Object.keys(n).length)return!1;for(const o in i)if(!lc(i[o],n[o]))return!1;return!0}return i===n}const _d=Math.PI/180,pi=180/Math.PI;function sr(i){return i*_d}function oo(i){return i*pi}const ru=[[0,0],[1,0],[1,1],[0,1]];function nh(i){if(i<=0)return 0;if(i>=1)return 1;const n=i*i,o=n*i;return 4*(i<.5?o:3*(i-n)+o-.75)}function rh(i,n,o,u){const h=new tu(i,n,o,u);return function(p){return h.solve(p)}}const xo=rh(.25,.1,.25,1);function Yn(i,n,o){return Math.min(o,Math.max(n,i))}function aa(i,n,o){return(o=Yn((o-i)/(n-i),0,1))*o*(3-2*o)}function cc(i,n,o){const u=o-n,h=((i-n)%u+u)%u+n;return h===n?o:h}function ih(i,n,o){if(!i.length)return o(null,[]);let u=i.length;const h=new Array(i.length);let p=null;i.forEach((m,v)=>{n(m,(w,E)=>{w&&(p=w),h[v]=E,--u==0&&o(p,h)})})}function uc(i){const n=[];for(const o in i)n.push(i[o]);return n}function ks(i,...n){for(const o of n)for(const u in o)i[u]=o[u];return i}let yd=1;function hc(){return yd++}function dc(){return function i(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Pa(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function ap(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function sh(i,n){i.forEach(o=>{n[o]&&(n[o]=n[o].bind(n))})}function Ya(i,n){return i.indexOf(n,i.length-n.length)!==-1}function iu(i,n,o){const u={};for(const h in i)u[h]=n.call(this,i[h],h,i);return u}function Ds(i,n,o){const u={};for(const h in i)n.call(this,i[h],h,i)&&(u[h]=i[h]);return u}function $s(i){return Array.isArray(i)?i.map($s):typeof i=="object"&&i?iu(i,$s):i}const vs={};function Pi(i){vs[i]||(typeof console!="undefined"&&console.warn(i),vs[i]=!0)}function la(i,n,o){return(o.y-i.y)*(n.x-i.x)>(n.y-i.y)*(o.x-i.x)}function vg(i){let n=0;for(let o,u,h=0,p=i.length,m=p-1;h<p;m=h++)o=i[h],u=i[m],n+=(u.x-o.x)*(o.y+u.y);return n}function fc([i,n,o]){const u=sr(n+90),h=sr(o);return{x:i*Math.cos(u)*Math.sin(h),y:i*Math.sin(u)*Math.sin(h),z:i*Math.cos(h),azimuthal:n,polar:o}}function $o(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function su(i){const n={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,h,p)=>{const m=h||p;return n[u]=!m||m.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let vd,ou,Ja,Al,ds,au,lu=null;function el(i){try{const n=self[i];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch(n){return!1}}function R(i,n){return[i[4*n],i[4*n+1],i[4*n+2],i[4*n+3]]}function K(i,n,o,u){for(;n<o;){const h=n+o>>1;i[h]<u?n=h+1:o=h}return n}function ue(i,n,o,u){for(;n<o;){const h=n+o>>1;i[h]<=u?n=h+1:o=h}return n}function De(i){return i>0?1/(1.001-i):1+i}function mt(i){return i>0?1-1/(1.001-i):-i}function kt(){return vd==null&&(vd=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),vd}const rn={now:()=>Al!==void 0?Al:performance.now(),setNow(i){Al=i},restoreNow(){Al=void 0},frame(i){const n=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(i,n=0){const{width:o,height:u}=i;ds||(ds=document.createElement("canvas"));const h=ds.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>ds.width||u>ds.height)&&(ds.width=o,ds.height=u),h.clearRect(-n,-n,o+2*n,u+2*n),h.drawImage(i,0,0,o,u),h.getImageData(-n,-n,o+2*n,u+2*n)},resolveURL:i=>(ou||(ou=document.createElement("a")),ou.href=i,ou.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ja==null&&(Ja=window.matchMedia("(prefers-reduced-motion: reduce)")),Ja.matches)},hasCanvasFingerprintNoise(){if(au!==void 0)return au;if(!kt())return au=!1,!1;const i=new OffscreenCanvas(85,1),n=i.getContext("2d",{willReadFrequently:!0});let o=0;for(let h=0;h<i.width;++h)n.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,n.fillRect(h,0,1,1);const u=n.getImageData(0,0,i.width,i.height);o=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&o++!==u.data[h])return au=!0,!0;return au=!1,!1}};function ui(i,n){const o=i.indexOf("?");if(o<0)return`${i}?${new URLSearchParams(n).toString()}`;const u=new URLSearchParams(i.slice(o));for(const h in n)u.set(h,n[h]);return`${i.slice(0,o)}?${u.toString()}`}function xs(i,n={persistentParams:[]}){const o=i.indexOf("?");if(o<0)return i;const u=new URLSearchParams,h=new URLSearchParams(i.slice(o));for(const m of n.persistentParams){const v=h.get(m);v&&u.set(m,v)}const p=u.toString();return`${i.slice(0,o)}${p.length>0?`?${p}`:""}`}const Gr="mapbox-tiles";let Os=500,Ls=50;const pc=["language","worldview","jobid"];let fs,mc;function xd(){try{return caches}catch(i){}}function lp(){const i=xd();i&&!fs&&(fs=i.open(Gr))}let xg=1/0;const bg={supported:!1,testSupport:function(i){!wg&&bd&&(Lb?y0(i):cp=i)}};let cp,bd,wg=!1,Lb=!1;const zb=typeof self!="undefined"?self:{};function y0(i){const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,bd),i.isContextLost())return;bg.supported=!0}catch(o){}i.deleteTexture(n),wg=!0}zb.document&&(bd=zb.document.createElement("img"),bd.onload=function(){cp&&y0(cp),cp=null,Lb=!0},bd.onerror=function(){wg=!0,cp=null},bd.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const up={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(up);class Tg extends Error{constructor(n,o,u){o===401&&F(u)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const v0=$o()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Pl=function(i,n){if(!(/^file:/.test(o=i.url)||/^file:/.test(v0())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,h){const p=new AbortController,m=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:v0(),referrerPolicy:u.referrerPolicy,signal:p.signal});let v=!1,w=!1;const E=(C=m.url).indexOf("sku=")>0&&F(C);var C;u.type==="json"&&m.headers.set("Accept","application/json");const P=(z,j,V)=>{if(w)return;if(z&&z.message!=="SecurityError"&&Pi(z.toString()),j&&V)return M(j);const $=Date.now();fetch(m).then(Y=>{if(Y.ok){const me=E?Y.clone():null;return M(Y,me,$)}return h(new Tg(Y.statusText,Y.status,u.url))}).catch(Y=>{Y.name!=="AbortError"&&h(new Error(`${Y.message} ${u.url}`))})},M=(z,j,V)=>{(u.type==="arrayBuffer"?z.arrayBuffer():u.type==="json"?z.json():z.text()).then($=>{w||(j&&V&&function(Y,me,pe){if(lp(),!fs)return;const ge=su(me.headers.get("Cache-Control")||"");if(ge["no-store"])return;const Pe={status:me.status,statusText:me.statusText,headers:new Headers};me.headers.forEach((Ge,Ke)=>Pe.headers.set(Ke,Ge)),ge["max-age"]&&Pe.headers.set("Expires",new Date(pe+1e3*ge["max-age"]).toUTCString());const Re=Pe.headers.get("Expires");if(!Re||new Date(Re).getTime()-pe<42e4)return;let ze=xs(Y.url,{persistentParams:pc});if(me.status===206){const Ge=Y.headers.get("Range");if(!Ge)return;Pe.status=200,ze=ui(ze,{range:Ge})}(function(Ge,Ke){if(mc===void 0)try{new Response(new ReadableStream),mc=!0}catch(it){mc=!1}mc?Ke(Ge.body):Ge.blob().then(Ke)})(me,Ge=>{const Ke=new Response((it=me.status)!==200&&it!==404&&[101,103,204,205,304].includes(it)?null:Ge,Pe);var it;lp(),fs&&fs.then(Je=>Je.put(ze,Ke)).catch(Je=>Pi(Je.message))})}(m,j,V),v=!0,h(null,$,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch($=>{w||h(new Error($.message))})};return E?function(z,j){if(lp(),!fs)return j(null);fs.then(V=>{let $=xs(z.url,{persistentParams:pc});const Y=z.headers.get("Range");Y&&($=ui($,{range:Y})),V.match($).then(me=>{const pe=function(ge){if(!ge)return!1;const Pe=new Date(ge.headers.get("Expires")||0),Re=su(ge.headers.get("Cache-Control")||"");return Pe>Date.now()&&!Re["no-cache"]}(me);V.delete($),pe&&V.put($,me.clone()),j(null,me,pe)}).catch(j)}).catch(j)}(m,P):P(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(i,n);if($o()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,n,void 0,!0)}var o;return function(u,h){const p=new XMLHttpRequest;p.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in u.headers)p.setRequestHeader(m,u.headers[m]);return u.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=u.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(u.type==="json")try{m=JSON.parse(p.response)}catch(v){return h(v)}h(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new Tg(p.statusText,p.status,u.url))},p.send(u.body),{cancel:()=>p.abort()}}(i,n)},oh=function(i,n){return Pl(ks(i,{type:"arrayBuffer"}),n)};function EA(i){const n=document.createElement("a");return n.href=i,n.protocol===location.protocol&&n.host===location.host}const Nb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let hp,wd;hp=[],wd=0;const dp=function(i,n){if(bg.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),wd>=O.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return hp.push(p),p}wd++;let o=!1;const u=()=>{if(!o)for(o=!0,wd--;hp.length&&wd<O.MAX_PARALLEL_IMAGE_REQUESTS;){const p=hp.shift(),{requestParameters:m,callback:v,cancelled:w}=p;w||(p.cancel=dp(m,v).cancel)}},h=oh(i,(p,m,v,w)=>{u(),p?n(p):m&&(self.createImageBitmap?function(E,C){const P=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(P).then(M=>{C(null,M)}).catch(M=>{C(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,C)=>n(E,C,v,w)):function(E,C){const P=new Image;P.onload=()=>{C(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=Nb})},P.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?URL.createObjectURL(M):Nb}(m,(E,C)=>n(E,C,v,w)))});return{cancel:()=>{h.cancel(),u()}}},x0="01",b0="NO_ACCESS_TOKEN",SA=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ra(i){const n=i.match(SA);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function ah(i){const n=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${n}`}const w0="mapbox.eventData";function Fb(i){if(!i)return null;const n=i.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(n[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(o){return null}}class lh{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const o=Fb(O.ACCESS_TOKEN);let u="";return u=o&&o.u?btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):O.ACCESS_TOKEN||"",n?`${w0}.${n}:${u}`:`${w0}:${u}`}fetchEventData(){const n=el("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{const h=localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));const p=localStorage.getItem(u);p&&(this.anonId=p)}catch(h){Pi("Unable to read from LocalStorage")}}saveEventData(){const n=el("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid"),h=this.anonId;if(n&&h)try{localStorage.setItem(u,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){Pi("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,o,u,h){if(!O.EVENTS_URL)return;const p=Ra(O.EVENTS_URL);p.params.push(`access_token=${h||O.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(n).toISOString()},v=o?ks(m,o):m,w={url:ah(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=function(E,C){return Pl(ks(E,{method:"POST"}),C)}(w,E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(h)})}queueRequest(n,o){this.queue.push(n),this.processRequests(o)}}const Bb=new class extends lh{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,n){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(i)&&i.some(o=>H(o)||F(o))&&this.queueRequest(Date.now(),n)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Fb(O.ACCESS_TOKEN),o=n?n.u:O.ACCESS_TOKEN;let u=o!==this.eventData.tokenU;ap(this.anonId)||(this.anonId=dc(),u=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),m=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;u=u||v>=1||v<-1||p.getDate()!==m.getDate()}else u=!0;u?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:x0,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=o)},i):this.processRequests()}},T0=Bb.postTurnstileEvent.bind(Bb),Td=new class extends lh{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,n,o,u){this.skuToken=n,this.errorCb=u,O.EVENTS_URL&&(o||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(b0)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),ap(this.anonId)||(this.anonId=dc()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:x0,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},i))}remove(){this.errorCb=null}},jb=Td.postMapLoadEvent.bind(Td),fp=new class extends lh{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let n=this.mapInstanceIdMap.get(i);return n||(n=dc(),this.mapInstanceIdMap.set(i,n)),n}getEventId(i){const n=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,n+1),n}postStyleLoadEvent(i,n){const{map:o,style:u,importedStyles:h}=n;if(!O.EVENTS_URL||!i&&!O.ACCESS_TOKEN)return;const p=this.getMapInstanceId(o),m={mapInstanceId:p,eventId:this.getEventId(p),style:u};h.length&&(m.importedStyles=h),this.queueRequest({timestamp:Date.now(),payload:m},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:o}=this.queue.shift();this.postEvent(n,o,()=>{},i)}},Ub=fp.postStyleLoadEvent.bind(fp),Vb=new class extends lh{constructor(){super("gljs.performance")}postPerformanceEvent(i,n){O.EVENTS_URL&&(i||O.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:o}=this.queue.shift(),u=function(h){const p=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),v=function(z){const j={};if(z){for(const V in z)if(V!=="other")for(const $ of z[V]){const Y=`${V}ResolveRangeMin`,me=`${V}ResolveRangeMax`,pe=`${V}RequestCount`,ge=`${V}RequestCachedCount`;j[Y]=Math.min(j[Y]||1/0,$.startTime),j[me]=Math.max(j[me]||-1/0,$.responseEnd);const Pe=Re=>{j[Re]===void 0&&(j[Re]=0),++j[Re]};$.transferSize!==void 0&&$.transferSize===0&&Pe(ge),Pe(pe)}}return j}(function(z,j){const V={};if(z)for(const $ of z){const Y=j($);V[Y]===void 0&&(V[Y]=[]),V[Y].push($)}return V}(p,ee)),w=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,C=E?E.effectiveType:void 0,P={counters:[],metadata:[],attributes:[]},M=(z,j,V)=>{V!=null&&z.push({name:j,value:V.toString()})};for(const z in v)M(P.counters,z,v[z]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(M(P.counters,"interactionRangeMin",h.interactionRange[0]),M(P.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const z of Object.keys(W)){const j=W[z],V=m.find($=>$.name===j);V&&M(P.counters,j,V.startTime)}return M(P.counters,"visibilityHidden",h.visibilityHidden),M(P.attributes,"style",function(z){if(z)for(const j of z){const V=j.name.split("?")[0];if(te(V)){const $=V.split("/").slice(-2);if($.length===2)return`mapbox://styles/${$[0]}/${$[1]}`}}}(p)),M(P.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),M(P.attributes,"fogEnabled",h.fogEnabled?"true":"false"),M(P.attributes,"projection",h.projection),M(P.attributes,"zoom",h.zoom),M(P.metadata,"devicePixelRatio",w),M(P.metadata,"connectionEffectiveType",C),M(P.metadata,"navigatorUserAgent",navigator.userAgent),M(P.metadata,"screenWidth",window.screen.width),M(P.metadata,"screenHeight",window.screen.height),M(P.metadata,"windowWidth",window.innerWidth),M(P.metadata,"windowHeight",window.innerHeight),M(P.metadata,"mapWidth",h.width/w),M(P.metadata,"mapHeight",h.height/w),M(P.metadata,"webglRenderer",h.renderer),M(P.metadata,"webglVendor",h.vendor),M(P.metadata,"sdkVersion",I),M(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(o);for(const h of u.metadata);for(const h of u.counters);for(const h of u.attributes);this.postEvent(n,u,()=>{},i)}},IA=Vb.postPerformanceEvent.bind(Vb),pp=new class extends lh{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,n,o,u){if(!O.API_URL||!O.SESSION_PATH)return;const h=Ra(O.API_URL+O.SESSION_PATH);h.params.push(`sku=${n||""}`),h.params.push(`access_token=${u||O.ACCESS_TOKEN||""}`);const p={url:ah(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,v){return Pl(ks(m,{method:"GET"}),v)}(p,m=>{this.pendingRequest=null,o(m),this.saveEventData(),this.processRequests(u)})}getSessionAPI(i,n,o,u){this.skuToken=n,this.errorCb=u,O.SESSION_PATH&&O.API_URL&&(o||O.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(b0)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||this.getSession(o,this.skuToken,u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},i)}remove(){this.errorCb=null}},E0=pp.getSessionAPI.bind(pp),mp=new Set;var ch={exports:{}},Ed={exports:function(i,n){var o,u,h,p,m,v,w,E;for(u=i.length-(o=3&i.length),h=n,m=3432918353,v=461845907,E=0;E<u;)w=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,h=27492+(65535&(p=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,o){case 3:w^=(255&i.charCodeAt(E+2))<<16;case 2:w^=(255&i.charCodeAt(E+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(E)))*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}},CA={exports:function(i,n){for(var o,u=i.length,h=n^u,p=0;u>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:h^=(255&i.charCodeAt(p+2))<<16;case 2:h^=(255&i.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}},$b=Ed.exports,AA=CA.exports;ch.exports=$b,ch.exports.murmur3=$b,ch.exports.murmur2=AA;var Eg=fe(ch.exports);class Rl{constructor(n,...o){ks(this,o[0]||{}),this.type=n}}class gp extends Rl{constructor(n,o={}){super("error",ks({error:n},o))}}function Sg(i,n,o){o[i]&&o[i].indexOf(n)!==-1||(o[i]=o[i]||[],o[i].push(n))}function S0(i,n,o){if(o&&o[i]){const u=o[i].indexOf(n);u!==-1&&o[i].splice(u,1)}}class uh{on(n,o){return this._listeners=this._listeners||{},Sg(n,o,this._listeners),this}off(n,o){return S0(n,o,this._listeners),S0(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},Sg(n,o,this._oneTimeListeners),this):new Promise(u=>this.once(n,u))}fire(n,o){const u=typeof n=="string"?new Rl(n,o):n,h=u.type;if(this.listens(h)){u.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of p)w.call(this,u);const m=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of m)S0(h,w,this._oneTimeListeners),w.call(this,u);const v=this._eventedParent;v&&(ks(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(u))}else u instanceof gp&&console.error(u.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}a.G=void 0;var qb={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ig(i){return(i=Math.round(i))<0?0:i>255?255:i}function I0(i){return Ig(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function Cg(i){return(n=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:n>1?1:n;var n}function C0(i,n,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(n-i)*o*6:2*o<1?n:3*o<2?i+(n-i)*(2/3-o)*6:i}try{a.G={}.parseCSSColor=function(i){var n,o=i.replace(/ /g,"").toLowerCase();if(o in qb)return qb[o].slice();if(o[0]==="#")return o.length===4?(n=parseInt(o.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:o.length===7&&(n=parseInt(o.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var u=o.indexOf("("),h=o.indexOf(")");if(u!==-1&&h+1===o.length){var p=o.substr(0,u),m=o.substr(u+1,h-(u+1)).split(","),v=1;switch(p){case"rgba":if(m.length!==4)return null;v=Cg(m.pop());case"rgb":return m.length!==3?null:[I0(m[0]),I0(m[1]),I0(m[2]),v];case"hsla":if(m.length!==4)return null;v=Cg(m.pop());case"hsl":if(m.length!==3)return null;var w=(parseFloat(m[0])%360+360)%360/360,E=Cg(m[1]),C=Cg(m[2]),P=C<=.5?C*(E+1):C+E-C*E,M=2*C-P;return[Ig(255*C0(M,P,w+1/3)),Ig(255*C0(M,P,w)),Ig(255*C0(M,P,w-1/3)),v];default:return null}}return null}}catch(i){}class Ir{constructor(n,o,u,h=1){this.r=n,this.g=o,this.b=u,this.a=h}static parse(n){if(!n)return;if(n instanceof Ir)return n;if(typeof n!="string")return;const o=a.G(n);return o?new Ir(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[n,o,u,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(o)},${Math.round(u)},${h})`}toRenderColor(n){const{r:o,g:u,b:h,a:p}=this;return new PA(n,o,u,h,p)}}class PA{constructor(n,o,u,h,p){if(n){const m=n.image.height,v=m*m;o=p===0?0:o/p*(m-1),u=p===0?0:u/p*(m-1),h=p===0?0:h/p*(m-1);const w=Math.floor(o),E=Math.floor(u),C=Math.floor(h),P=Math.ceil(o),M=Math.ceil(u),z=Math.ceil(h),j=o-w,V=u-E,$=h-C,Y=n.image.data,me=4*(w+E*v+C*m),pe=4*(w+E*v+z*m),ge=4*(w+M*v+C*m),Pe=4*(w+M*v+z*m),Re=4*(P+E*v+C*m),ze=4*(P+E*v+z*m),Ge=4*(P+M*v+C*m),Ke=4*(P+M*v+z*m);if(me<0||Ke>=Y.length)throw new Error("out of range");this.r=Tn(Tn(Tn(Y[me],Y[pe],$),Tn(Y[ge],Y[Pe],$),V),Tn(Tn(Y[Re],Y[ze],$),Tn(Y[Ge],Y[Ke],$),V),j)/255*p,this.g=Tn(Tn(Tn(Y[me+1],Y[pe+1],$),Tn(Y[ge+1],Y[Pe+1],$),V),Tn(Tn(Y[Re+1],Y[ze+1],$),Tn(Y[Ge+1],Y[Ke+1],$),V),j)/255*p,this.b=Tn(Tn(Tn(Y[me+2],Y[pe+2],$),Tn(Y[ge+2],Y[Pe+2],$),V),Tn(Tn(Y[Re+2],Y[ze+2],$),Tn(Y[Ge+2],Y[Ke+2],$),V),j)/255*p,this.a=p}else this.r=o,this.g=u,this.b=h,this.a=p}toArray(){const{r:n,g:o,b:u,a:h}=this;return h===0?[0,0,0,0]:[255*n/h,255*o/h,255*u/h,h]}toArray01(){const{r:n,g:o,b:u,a:h}=this;return h===0?[0,0,0,0]:[n/h,o/h,u/h,h]}toArray01Scaled(n){const{r:o,g:u,b:h,a:p}=this;return p===0?[0,0,0]:[o/p*n,u/p*n,h/p*n]}toArray01PremultipliedAlpha(){const{r:n,g:o,b:u,a:h}=this;return[n,o,u,h]}toArray01Linear(){const{r:n,g:o,b:u,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(n/h,2.2),Math.pow(o/h,2.2),Math.pow(u/h,2.2),h]}}function Tn(i,n,o){return i*(1-o)+n*o}function A0(i,n,o){return i.map((u,h)=>Tn(u,n[h],o))}Ir.black=new Ir(0,0,0,1),Ir.white=new Ir(1,1,1,1),Ir.transparent=new Ir(0,0,0,0),Ir.red=new Ir(1,0,0,1),Ir.blue=new Ir(0,0,1,1);var _p=Object.freeze({__proto__:null,array:A0,color:function(i,n,o){return new Ir(Tn(i.r,n.r,o),Tn(i.g,n.g,o),Tn(i.b,n.b,o),Tn(i.a,n.a,o))},number:Tn});function Sd(i,...n){for(const o of n)for(const u in o)i[u]=o[u];return i}class Ml extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}class P0{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[u,h]of o)this.bindings[u]=h}concat(n){return new P0(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const ca={kind:"null"},nn={kind:"number"},xr={kind:"string"},Ar={kind:"boolean"},Ma={kind:"color"},Id={kind:"object"},Tr={kind:"value"},Ag={kind:"collator"},Cd={kind:"formatted"},hh={kind:"resolvedImage"};function ao(i,n){return{kind:"array",itemType:i,N:n}}function Bi(i){if(i.kind==="array"){const n=Bi(i.itemType);return typeof i.N=="number"?`array<${n}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${n}>`}return i.kind}const R0=[ca,nn,xr,Ar,Ma,Cd,Id,ao(Tr),hh];function yp(i,n){if(n.kind==="error")return null;if(i.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!yp(i.itemType,n.itemType))&&(typeof i.N!="number"||i.N===n.N))return null}else{if(i.kind===n.kind)return null;if(i.kind==="value"){for(const o of R0)if(!yp(o,n))return null}}return`Expected ${Bi(i)} but found ${Bi(n)} instead.`}function ka(i,n){return n.some(o=>o.kind===i.kind)}function vp(i,n){return n.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}class Pg{constructor(n,o,u){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Rg{constructor(n,o,u,h,p){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=u,this.fontStack=h,this.textColor=p}}class bo{constructor(n){this.sections=n}static fromString(n){return new bo([new Rg(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof bo?n:bo.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){n.push(["image",o.image.namePrimary]);continue}n.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),n.push(u)}return n}}class ua{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,o){return n?new ua({namePrimary:n,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Gb(i,n,o,u){return typeof i=="number"&&i>=0&&i<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[i,n,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[i,n,o,u]:[i,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ad(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ir||i instanceof Pg||i instanceof bo||i instanceof ua)return!0;if(Array.isArray(i)){for(const n of i)if(!Ad(n))return!1;return!0}if(typeof i=="object"){for(const n in i)if(!Ad(i[n]))return!1;return!0}return!1}function ps(i){if(i===null)return ca;if(typeof i=="string")return xr;if(typeof i=="boolean")return Ar;if(typeof i=="number")return nn;if(i instanceof Ir)return Ma;if(i instanceof Pg)return Ag;if(i instanceof bo)return Cd;if(i instanceof ua)return hh;if(Array.isArray(i)){const n=i.length;let o;for(const u of i){const h=ps(u);if(o){if(o===h)continue;o=Tr;break}o=h}return ao(o||Tr,n)}return Id}function tl(i){const n=typeof i;return i===null?"":n==="string"||n==="number"||n==="boolean"?String(i):i instanceof Ir||i instanceof bo||i instanceof ua?i.toString():JSON.stringify(i)}class nl{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Ad(n[1]))return o.error("invalid value");const u=n[1];let h=ps(u);const p=o.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new nl(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ir?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof bo?this.value.serialize():this.value}}class bs{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const M0={string:xr,number:nn,boolean:Ar,object:Id};class ha{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let u,h=1;const p=n[0];if(p==="array"){let v,w;if(n.length>2){const E=n[1];if(typeof E!="string"||!(E in M0)||E==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);v=M0[E],h++}else v=Tr;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);w=n[2],h++}u=ao(v,w)}else u=M0[p];const m=[];for(;h<n.length;h++){const v=o.parse(n[h],h,Tr);if(!v)return null;m.push(v)}return new ha(u,m)}evaluate(n){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(n);if(!yp(this.type,ps(u)))return u;if(o===this.args.length-1)throw new bs(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${Bi(ps(u))} but was expected to be of type ${Bi(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const h=n.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(u=>u.serialize()))}}class dh{constructor(n){this.type=Cd,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const h=[];let p=!1;for(let m=1;m<=n.length-1;++m){const v=n[m];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=o.parse(v["font-scale"],1,nn),!w))return null;let E=null;if(v["text-font"]&&(E=o.parse(v["text-font"],1,ao(xr)),!E))return null;let C=null;if(v["text-color"]&&(C=o.parse(v["text-color"],1,Ma),!C))return null;const P=h[h.length-1];P.scale=w,P.font=E,P.textColor=C}else{const w=o.parse(n[m],1,Tr);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new dh(h)}evaluate(n){return new bo(this.sections.map(o=>{const u=o.content.evaluate(n);return ps(u)===hh?new Rg("",u,null,null,null):new Rg(tl(u),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),n.push(u)}return n}}class gc{constructor(n,o){this.type=hh,this.inputPrimary=n,this.inputSecondary=o}static parse(n,o){if(n.length<2)return o.error("Expected two or more arguments.");const u=o.parse(n[1],1,xr);if(!u)return o.error("No image name provided.");if(n.length===2)return new gc(u);const h=o.parse(n[2],1,xr);return h?new gc(u,h):o.error("Secondary image variant is not a string.")}evaluate(n){const o=ua.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return o&&n.availableImages&&(o.available=n.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&n.availableImages&&(o.available=n.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function cu(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}const RA={"to-boolean":Ar,"to-color":Ma,"to-number":nn,"to-string":xr};class _c{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[0],h=[];let p=ca;if(u==="to-array"){if(!Array.isArray(n[1]))return null;const m=n[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);p=ao(o.expectedType.itemType,m)}else{if(!(m>0&&Ad(n[1][0])))return null;p=ao(ps(n[1][0]),m)}for(let v=0;v<m;v++){const w=n[1][v];let E;if(cu(w)==="array")E=o.parse(w,void 0,p.itemType);else{const C=cu(w);if(C!==p.itemType.kind)return o.error(`Expected ${p.itemType.kind} but found ${C}.`);E=o.registry.literal.parse(["literal",w===void 0?null:w],o)}if(!E)return null;h.push(E)}}else{if((u==="to-boolean"||u==="to-string")&&n.length!==2)return o.error("Expected one argument.");p=RA[u];for(let m=1;m<n.length;m++){const v=o.parse(n[m],m,Tr);if(!v)return null;h.push(v)}}return new _c(p,h)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,u;for(const h of this.args){if(o=h.evaluate(n),u=null,o instanceof Ir)return o;if(typeof o=="string"){const p=n.parseColor(o);if(p)return p}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Gb(o[0],o[1],o[2],o[3]),!u))return new Ir(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new bs(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(n),o===null)return 0;const h=Number(o);if(!isNaN(h))return h}throw new bs(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?bo.fromString(tl(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?ua.fromString(tl(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(o=>o.evaluate(n)):tl(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new dh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new gc(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{n.push(o.serialize())}),n}}const MA=["Unknown","Point","LineString","Polygon"];class k0{constructor(n,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?MA[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-n[0])+this.featureDistanceData.bearing[1]*(h*o-n[1])}return 0}parseColor(n){let o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=Ir.parse(n)),o}getConfig(n){return this.options?this.options.get(n):null}}class qo{constructor(n,o,u,h,p){this.name=n,this.type=o,this._evaluate=u,this.args=h,this._overloadIndex=p}evaluate(n){if(!this._evaluate){const o=qo.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,o){const u=n[0],h=qo.definitions[u];if(!h)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[];let w=null,E=-1;for(const[C,P]of m){if(Array.isArray(C)&&C.length!==n.length-1)continue;v.push(C),E++,w=new lw(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const M=[];let z=!1;for(let j=1;j<n.length;j++){const V=n[j],$=Array.isArray(C)?C[j-1]:C.type,Y=w.parse(V,1+M.length,$);if(!Y){z=!0;break}M.push(Y)}if(!z)if(Array.isArray(C)&&C.length!==M.length)w.error(`Expected ${C.length} arguments, but found ${M.length} instead.`);else{for(let j=0;j<M.length;j++){const V=Array.isArray(C)?C[j]:C.type,$=M[j];w.concat(j+1).checkSubtype(V,$.type)}if(w.errors.length===0)return new qo(u,p,P,M,E)}}if(v.length===1)o.errors.push(...w.errors);else{const C=(v.length?v:m.map(([M])=>M)).map(kA).join(" | "),P=[];for(let M=1;M<n.length;M++){const z=o.parse(n[M],1+P.length);if(!z)return null;P.push(Bi(z.type))}o.error(`Expected arguments of type ${C}, but found (${P.join(", ")}) instead.`)}return null}static register(n,o){qo.definitions=o;for(const u in o)n[u]=qo}}function kA(i){return Array.isArray(i)?`(${i.map(Bi).join(", ")})`:`(${Bi(i.type)}...)`}class xp{constructor(n,o,u){this.type=Ag,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const u=n[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Ar);if(!h)return null;const p=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Ar);if(!p)return null;let m=null;return u.locale&&(m=o.parse(u.locale,1,xr),!m)?null:new xp(h,p,m)}evaluate(n){return new Pg(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function Cr(i,n,o=0,u=i.length-1,h=Wb){for(;u>o;){if(u-o>600){const w=u-o+1,E=n-o+1,C=Math.log(w),P=.5*Math.exp(2*C/3),M=.5*Math.sqrt(C*P*(w-P)/w)*(E-w/2<0?-1:1);Cr(i,n,Math.max(o,Math.floor(n-E*P/w+M)),Math.min(u,Math.floor(n+(w-E)*P/w+M)),h)}const p=i[n];let m=o,v=u;for(Pd(i,o,n),h(i[u],p)>0&&Pd(i,o,u);m<v;){for(Pd(i,m,v),m++,v--;h(i[m],p)<0;)m++;for(;h(i[v],p)>0;)v--}h(i[o],p)===0?Pd(i,o,v):(v++,Pd(i,v,u)),v<=n&&(o=v+1),n<=v&&(u=v-1)}}function Pd(i,n,o){const u=i[n];i[n]=i[o],i[o]=u}function Wb(i,n){return i<n?-1:i>n?1:0}function DA(i){let n=0;for(let o,u,h=0,p=i.length,m=p-1;h<p;m=h++)o=i[h],u=i[m],n+=(u.x-o.x)*(o.y+u.y);return n}function bp(i,n){i[0]=Math.min(i[0],n[0]),i[1]=Math.min(i[1],n[1]),i[2]=Math.max(i[2],n[0]),i[3]=Math.max(i[3],n[1])}function uu(i,n){return!(i[0]<=n[0]||i[2]>=n[2]||i[1]<=n[1]||i[3]>=n[3])}function Mg(i,n,o){const u=i[0]-n[0],h=i[1]-n[1],p=i[0]-o[0],m=i[1]-o[1];return u*m-p*h==0&&u*p<=0&&h*m<=0}function yc(i,n,o=!1){let u=!1;for(let v=0,w=n.length;v<w;v++){const E=n[v];for(let C=0,P=E.length,M=P-1;C<P;M=C++){const z=E[M],j=E[C];if(Mg(i,z,j))return o;(p=z)[1]>(h=i)[1]!=(m=j)[1]>h[1]&&h[0]<(m[0]-p[0])*(h[1]-p[1])/(m[1]-p[1])+p[0]&&(u=!u)}}var h,p,m;return u}function Hb(i,n,o,u){const h=u[0]-o[0],p=u[1]-o[1],m=(i[0]-o[0])*p-h*(i[1]-o[1]),v=(n[0]-o[0])*p-h*(n[1]-o[1]);return m>0&&v<0||m<0&&v>0}function wp(i,n,o,u){return(h=[u[0]-o[0],u[1]-o[1]])[0]*(p=[n[0]-i[0],n[1]-i[1]])[1]-h[1]*p[0]!=0&&!(!Hb(i,n,o,u)||!Hb(o,u,i,n));var h,p}const lo=8192;function OA(i,n){const o=(180+i[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(o*h*lo),Math.round(u*h*lo)]}function Zb(i,n){for(let o=0;o<n.length;o++)if(yc(i,n[o]))return!0;return!1}function Tp(i,n,o){for(const u of o)for(let h=0,p=u.length,m=p-1;h<p;m=h++)if(wp(i,n,u[m],u[h]))return!0;return!1}function kg(i,n){for(let o=0;o<i.length;++o)if(!yc(i[o],n))return!1;for(let o=0;o<i.length-1;++o)if(Tp(i[o],i[o+1],n))return!1;return!0}function LA(i,n){for(let o=0;o<n.length;o++)if(kg(i,n[o]))return!0;return!1}function D0(i,n,o){const u=[];for(let h=0;h<i.length;h++){const p=[];for(let m=0;m<i[h].length;m++){const v=OA(i[h][m],o);bp(n,v),p.push(v)}u.push(p)}return u}function Xb(i,n,o){const u=[];for(let h=0;h<i.length;h++){const p=D0(i[h],n,o);u.push(p)}return u}function O0(i,n,o,u){if(i[0]<o[0]||i[0]>o[2]){const h=.5*u;let p=i[0]-o[0]>h?-u:o[0]-i[0]>h?u:0;p===0&&(p=i[0]-o[2]>h?-u:o[2]-i[0]>h?u:0),i[0]+=p}bp(n,i)}function Dg(i,n,o,u){const h=Math.pow(2,u.z)*lo,p=[u.x*lo,u.y*lo],m=[];if(!i)return m;for(const v of i)for(const w of v){const E=[w.x+p[0],w.y+p[1]];O0(E,n,o,h),m.push(E)}return m}function Kb(i,n,o,u){const h=Math.pow(2,u.z)*lo,p=[u.x*lo,u.y*lo],m=[];if(!i)return m;for(const w of i){const E=[];for(const C of w){const P=[C.x+p[0],C.y+p[1]];bp(n,P),E.push(P)}m.push(E)}if(n[2]-n[0]<=h/2){(v=n)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of m)for(const E of w)O0(E,n,o,h)}var v;return m}class kl{constructor(n,o){this.type=Ar,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ad(n[1])){const u=n[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const p=u.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new kl(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new kl(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new kl(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const v=D0(u.coordinates,p,m),w=Dg(o.geometry(),h,p,m);if(!uu(h,p))return!1;for(const E of w)if(!yc(E,v))return!1}if(u.type==="MultiPolygon"){const v=Xb(u.coordinates,p,m),w=Dg(o.geometry(),h,p,m);if(!uu(h,p))return!1;for(const E of w)if(!Zb(E,v))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const v=D0(u.coordinates,p,m),w=Kb(o.geometry(),h,p,m);if(!uu(h,p))return!1;for(const E of w)if(!kg(E,v))return!1}if(u.type==="MultiPolygon"){const v=Xb(u.coordinates,p,m),w=Kb(o.geometry(),h,p,m);if(!uu(h,p))return!1;for(const E of w)if(!LA(E,v))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Og={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Qb=1/298.257223563,Yb=Qb*(2-Qb),Ep=Math.PI/180;class Sp{static fromTile(n,o,u){const h=Math.PI*(1-2*(n+.5)/Math.pow(2,o)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Ep;return new Sp(p,u)}static get units(){return Og}constructor(n,o){if(n===void 0)throw new Error("No latitude given.");if(o&&!Og[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Og).join(", ")}`);const u=6378.137*Ep*(o?Og[o]:1),h=Math.cos(n*Ep),p=1/(1-Yb*(1-h*h)),m=Math.sqrt(p);this.kx=u*m*h,this.ky=u*m*p*(1-Yb)}distance(n,o){const u=da(n[0]-o[0])*this.kx,h=(n[1]-o[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(n,o){const u=da(o[0]-n[0])*this.kx;return Math.atan2(u,(o[1]-n[1])*this.ky)/Ep}destination(n,o,u){const h=u*Ep;return this.offset(n,Math.sin(h)*o,Math.cos(h)*o)}offset(n,o,u){return[n[0]+o/this.kx,n[1]+u/this.ky]}lineDistance(n){let o=0;for(let u=0;u<n.length-1;u++)o+=this.distance(n[u],n[u+1]);return o}area(n){let o=0;for(let u=0;u<n.length;u++){const h=n[u];for(let p=0,m=h.length,v=m-1;p<m;v=p++)o+=da(h[p][0]-h[v][0])*(h[p][1]+h[v][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(n,o){let u=0;if(o<=0)return n[0];for(let h=0;h<n.length-1;h++){const p=n[h],m=n[h+1],v=this.distance(p,m);if(u+=v,u>o)return L0(p,m,(o-(u-v))/v)}return n[n.length-1]}pointToSegmentDistance(n,o,u){let[h,p]=o,m=da(u[0]-h)*this.kx,v=(u[1]-p)*this.ky;if(m!==0||v!==0){const w=(da(n[0]-h)*this.kx*m+(n[1]-p)*this.ky*v)/(m*m+v*v);w>1?(h=u[0],p=u[1]):w>0&&(h+=m/this.kx*w,p+=v/this.ky*w)}return m=da(n[0]-h)*this.kx,v=(n[1]-p)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(n,o){let u=1/0,h=n[0][0],p=n[0][1],m=0,v=0;for(let w=0;w<n.length-1;w++){let E=n[w][0],C=n[w][1],P=da(n[w+1][0]-E)*this.kx,M=(n[w+1][1]-C)*this.ky,z=0;P===0&&M===0||(z=(da(o[0]-E)*this.kx*P+(o[1]-C)*this.ky*M)/(P*P+M*M),z>1?(E=n[w+1][0],C=n[w+1][1]):z>0&&(E+=P/this.kx*z,C+=M/this.ky*z)),P=da(o[0]-E)*this.kx,M=(o[1]-C)*this.ky;const j=P*P+M*M;j<u&&(u=j,h=E,p=C,m=w,v=z)}return{point:[h,p],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(n,o,u){let h=this.pointOnLine(u,n),p=this.pointOnLine(u,o);if(h.index>p.index||h.index===p.index&&h.t>p.t){const E=h;h=p,p=E}const m=[h.point],v=h.index+1,w=p.index;!Jb(u[v],m[0])&&v<=w&&m.push(u[v]);for(let E=v+1;E<=w;E++)m.push(u[E]);return Jb(u[w],p.point)||m.push(p.point),m}lineSliceAlong(n,o,u){let h=0;const p=[];for(let m=0;m<u.length-1;m++){const v=u[m],w=u[m+1],E=this.distance(v,w);if(h+=E,h>n&&p.length===0&&p.push(L0(v,w,(n-(h-E))/E)),h>=o)return p.push(L0(v,w,(o-(h-E))/E)),p;h>n&&p.push(w)}return p}bufferPoint(n,o){const u=o/this.ky,h=o/this.kx;return[n[0]-h,n[1]-u,n[0]+h,n[1]+u]}bufferBBox(n,o){const u=o/this.ky,h=o/this.kx;return[n[0]-h,n[1]-u,n[2]+h,n[3]+u]}insideBBox(n,o){return da(n[0]-o[0])>=0&&da(n[0]-o[2])<=0&&n[1]>=o[1]&&n[1]<=o[3]}}function Jb(i,n){return i[0]===n[0]&&i[1]===n[1]}function L0(i,n,o){const u=da(n[0]-i[0]);return[i[0]+u*o,i[1]+(n[1]-i[1])*o]}function da(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}class hu{constructor(n=[],o=(u,h)=>u<h?-1:u>h?1:0){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:u}=this,h=o[n];for(;n>0;){const p=n-1>>1,m=o[p];if(u(h,m)>=0)break;o[n]=m,n=p}o[n]=h}_down(n){const{data:o,compare:u}=this,h=this.length>>1,p=o[n];for(;n<h;){let m=1+(n<<1);const v=m+1;if(v<this.length&&u(o[v],o[m])<0&&(m=v),u(o[m],p)>=0)break;o[n]=o[m],n=m}o[n]=p}}var zt=8192;function ew(i,n){return n.dist-i.dist}const Ip=100,z0=50;function tw(i){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==i.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==i[o])return!1;return!0}function Lg(i){return i[1]-i[0]+1}function vc(i,n){const o=i[1]>=i[0]&&i[1]<n;return o||console.warn("Distance Expression: Index is out of range"),o}function N0(i,n){if(i[0]>i[1])return[null,null];const o=Lg(i);if(n){if(o===2)return[i,null];const u=Math.floor(o/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}{if(o===1)return[i,null];const u=Math.floor(o/2)-1;return[[i[0],i[0]+u],[i[0]+u+1,i[1]]]}}function fa(i,n){const o=[1/0,1/0,-1/0,-1/0];if(!vc(n,i.length))return o;for(let u=n[0];u<=n[1];++u)bp(o,i[u]);return o}function zg(i){const n=[1/0,1/0,-1/0,-1/0];for(let o=0;o<i.length;++o)for(let u=0;u<i[o].length;++u)bp(n,i[o][u]);return n}function Rd(i,n,o){if(tw(i)||tw(n))return NaN;let u=0,h=0;return i[2]<n[0]&&(u=n[0]-i[2]),i[0]>n[2]&&(u=i[0]-n[2]),i[1]>n[3]&&(h=i[1]-n[3]),i[3]<n[1]&&(h=n[1]-i[3]),o.distance([0,0],[u,h])}function nw(i){return 360*i-180}function rw(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function pa(i,n){const o=Math.pow(2,n.z),u=(i.y/zt+n.y)/o;return[nw((i.x/zt+n.x)/o),rw(u)]}function iw(i,n){const o=[];for(let u=0;u<i.length;++u)o.push(pa(i[u],n));return o}function sw(i,n,o){const u=o.pointOnLine(n,i).point;return o.distance(i,u)}function F0(i,n,o,u,h){const p=o.slice(u[0],u[1]+1);let m=1/0;for(let v=n[0];v<=n[1];++v)if((m=Math.min(m,sw(i[v],p,h)))===0)return 0;return m}function Md(i,n,o,u,h){const p=Math.min(h.pointToSegmentDistance(i,o,u),h.pointToSegmentDistance(n,o,u)),m=Math.min(h.pointToSegmentDistance(o,i,n),h.pointToSegmentDistance(u,i,n));return Math.min(p,m)}function zA(i,n,o,u,h){if(!vc(n,i.length)||!vc(u,o.length))return NaN;let p=1/0;for(let m=n[0];m<n[1];++m)for(let v=u[0];v<u[1];++v){if(wp(i[m],i[m+1],o[v],o[v+1]))return 0;p=Math.min(p,Md(i[m],i[m+1],o[v],o[v+1],h))}return p}function NA(i,n,o,u,h){if(!vc(n,i.length)||!vc(u,o.length))return NaN;let p=1/0;for(let m=n[0];m<=n[1];++m)for(let v=u[0];v<=u[1];++v)if((p=Math.min(p,h.distance(i[m],o[v])))===0)return p;return p}function FA(i,n,o){if(yc(i,n,!0))return 0;let u=1/0;for(const h of n){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(u=Math.min(u,o.pointToSegmentDistance(i,h[p-1],h[0])))===0||(u=Math.min(u,sw(i,h,o)))===0)return u}return u}function BA(i,n,o,u){if(!vc(n,i.length))return NaN;for(let p=n[0];p<=n[1];++p)if(yc(i[p],o,!0))return 0;let h=1/0;for(let p=n[0];p<n[1];++p)for(const m of o)for(let v=0,w=m.length,E=w-1;v<w;E=v++){if(wp(i[p],i[p+1],m[E],m[v]))return 0;h=Math.min(h,Md(i[p],i[p+1],m[E],m[v],u))}return h}function ow(i,n){for(const o of i)for(let u=0;u<=o.length-1;++u)if(yc(o[u],n,!0))return!0;return!1}function Ng(i,n,o,u=1/0){const h=zg(i),p=zg(n);if(u!==1/0&&Rd(h,p,o)>=u)return u;if(uu(h,p)){if(ow(i,n))return 0}else if(ow(n,i))return 0;let m=u;for(const v of i)for(let w=0,E=v.length,C=E-1;w<E;C=w++)for(const P of n)for(let M=0,z=P.length,j=z-1;M<z;j=M++){if(wp(v[C],v[w],P[j],P[M]))return 0;m=Math.min(m,Md(v[C],v[w],P[j],P[M],o))}return m}function fh(i,n,o,u,h,p,m){if(p===null||m===null)return;const v=Rd(fa(u,p),fa(h,m),o);v<n&&i.push({dist:v,range1:p,range2:m})}function ma(i,n,o,u,h=1/0){let p=Math.min(u.distance(i[0],o[0][0]),h);if(p===0)return p;const m=new hu([{dist:0,range1:[0,i.length-1],range2:[0,0]}],ew),v=n?z0:Ip,w=zg(o);for(;m.length;){const E=m.pop();if(E.dist>=p)continue;const C=E.range1;if(Lg(C)<=v){if(!vc(C,i.length))return NaN;if(n){const P=BA(i,C,o,u);if((p=Math.min(p,P))===0)return p}else for(let P=C[0];P<=C[1];++P){const M=FA(i[P],o,u);if((p=Math.min(p,M))===0)return p}}else{const P=N0(C,n);if(P[0]!==null){const M=Rd(fa(i,P[0]),w,u);M<p&&m.push({dist:M,range1:P[0],range2:[0,0]})}if(P[1]!==null){const M=Rd(fa(i,P[1]),w,u);M<p&&m.push({dist:M,range1:P[1],range2:[0,0]})}}}return p}function Cp(i,n,o,u,h,p=1/0){let m=Math.min(p,h.distance(i[0],o[0]));if(m===0)return m;const v=new hu([{dist:0,range1:[0,i.length-1],range2:[0,o.length-1]}],ew),w=n?z0:Ip,E=u?z0:Ip;for(;v.length;){const C=v.pop();if(C.dist>=m)continue;const P=C.range1,M=C.range2;if(Lg(P)<=w&&Lg(M)<=E){if(!vc(P,i.length)||!vc(M,o.length))return NaN;if(n&&u?m=Math.min(m,zA(i,P,o,M,h)):n||u?n&&!u?m=Math.min(m,F0(o,M,i,P,h)):!n&&u&&(m=Math.min(m,F0(i,P,o,M,h))):m=Math.min(m,NA(i,P,o,M,h)),m===0)return m}else{const z=N0(P,n),j=N0(M,u);fh(v,m,h,i,o,z[0],j[0]),fh(v,m,h,i,o,z[0],j[1]),fh(v,m,h,i,o,z[1],j[0]),fh(v,m,h,i,o,z[1],j[1])}}return m}function B0(i,n,o,u,h=1/0){let p=h;const m=fa(i,[0,i.length-1]);for(const v of o)if(!(p!==1/0&&Rd(m,fa(v,[0,v.length-1]),u)>=p)&&(p=Math.min(p,Cp(i,n,v,!0,u,p)),p===0))return p;return p}function Fg(i,n,o,u,h=1/0){let p=h;const m=fa(i,[0,i.length-1]);for(const v of o){if(p!==1/0&&Rd(m,zg(v),u)>=p)continue;const w=ma(i,n,v,u,p);if(isNaN(w))return w;if((p=Math.min(p,w))===0)return p}return p}function j0(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class ph{constructor(n,o){this.type=nn,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(Ad(n[1])){const u=n[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(j0(u.features[h].geometry.type))return new ph(u,u.features[h].geometry)}else if(u.type==="Feature"){if(j0(u.geometry.type))return new ph(u,u.geometry)}else if(j0(u.type))return new ph(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const o=n.geometry(),u=n.canonicalID();if(o!=null&&u!=null){if(n.geometryType()==="Point")return function(h,p,m){const v=[];for(const E of h)for(const C of E)v.push(pa(C,p));const w=new Sp(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Cp(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",w):m.type==="MultiLineString"?B0(v,!1,m.coordinates,w):m.type==="Polygon"||m.type==="MultiPolygon"?Fg(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,w):null}(o,u,this.geometries);if(n.geometryType()==="LineString")return function(h,p,m){const v=[];for(const E of h){const C=[];for(const P of E)C.push(pa(P,p));v.push(C)}const w=new Sp(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return B0(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,w);if(m.type==="MultiLineString"){let E=1/0;for(let C=0;C<m.coordinates.length;C++){const P=B0(m.coordinates[C],!0,v,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}if(m.type==="Polygon"||m.type==="MultiPolygon"){let E=1/0;for(let C=0;C<v.length;C++){const P=Fg(v[C],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return null}(o,u,this.geometries);if(n.geometryType()==="Polygon")return function(h,p,m){const v=[];for(const E of function(C,P){const M=C.length;if(M<=1)return[C];const z=[];let j,V;for(let $=0;$<M;$++){const Y=DA(C[$]);Y!==0&&(C[$].area=Math.abs(Y),V===void 0&&(V=Y<0),V===Y<0?(j&&z.push(j),j=[C[$]]):j.push(C[$]))}return j&&z.push(j),z}(h)){const C=[];for(let P=0;P<E.length;++P)C.push(iw(E[P],p));v.push(C)}const w=new Sp(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Fg(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,w);if(m.type==="MultiLineString"){let E=1/0;for(let C=0;C<m.coordinates.length;C++){const P=Fg(m.coordinates[C],!0,v,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return m.type==="Polygon"||m.type==="MultiPolygon"?function(E,C,P){let M=1/0;for(const z of E)for(const j of C){const V=Ng(z,j,P,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,w):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ap(i,n){switch(i){case"string":return tl(n);case"number":return+n;case"boolean":return!!n;case"color":return Ir.parse(n);case"formatted":return bo.fromString(tl(n));case"resolvedImage":return ua.fromString(tl(n))}return n}function aw(i,n,o,u){return u!==void 0&&(i=u*Math.round(i/u)),n!==void 0&&i<n&&(i=n),o!==void 0&&i>o&&(i=o),i}class du{constructor(n,o,u){this.type=n,this.key=o,this.scope=u}static parse(n,o){let u=o.expectedType;if(u==null&&(u=Tr),n.length<2||n.length>3)return o.error("Invalid number of arguments for 'config' expression.");const h=o.parse(n[1],1);if(!(h instanceof nl))return o.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const p=o.parse(n[2],2);return p instanceof nl?new du(u,tl(h.value),tl(p.value)):o.error("Scope of 'config' expression must be a string literal.")}return new du(u,tl(h.value))}evaluate(n){const o=[this.key,this.scope,n.scope].filter(Boolean).join(""),u=n.getConfig(o);if(!u)return null;const{type:h,value:p,values:m,minValue:v,maxValue:w,stepValue:E}=u,C=u.default.evaluate(n);let P=C;if(p){const M=n.scope;n.scope=(M||"").split("").slice(1).join(""),P=p.evaluate(n),n.scope=M}return h&&(P=Ap(h,P)),P===void 0||v===void 0&&w===void 0&&E===void 0||(typeof P=="number"?P=aw(P,v,w,E):Array.isArray(P)&&(P=P.map(M=>typeof M=="number"?aw(M,v,w,E):M))),p!==void 0&&P!==void 0&&m&&!m.includes(P)&&(P=C,h&&(P=Ap(h,P))),(h&&h!==this.type||P!==void 0&&ps(P)!==this.type)&&(P=Ap(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function Pp(i){if(i instanceof qo&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof kl||i instanceof ph)return!1;let n=!0;return i.eachChild(o=>{n&&!Pp(o)&&(n=!1)}),n}function Bg(i){if(i instanceof qo&&i.name==="feature-state")return!1;let n=!0;return i.eachChild(o=>{n&&!Bg(o)&&(n=!1)}),n}function Rp(i){if(i instanceof du)return new Set([i.key]);let n=new Set;return i.eachChild(o=>{n=new Set([...n,...Rp(o)])}),n}function Mp(i,n){if(i instanceof qo&&n.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(u=>{o&&!Mp(u,n)&&(o=!1)}),o}class kp{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=n[1];return o.scope.has(u)?new kp(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class jg{constructor(n,o=[],u,h=new P0,p=[],m,v){this.registry=n,this.path=o,this.key=o.map(w=>`[${w}]`).join(""),this.scope=h,this.errors=p,this.expectedType=u,this._scope=m,this.options=v}parse(n,o,u,h,p={}){return o||u?this.concat(o,u,h)._parse(n,p):this._parse(n,p)}_parse(n,o){function u(h,p,m){return m==="assert"?new ha(p,[h]):m==="coerce"?new _c(p,[h]):h}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(h){let p=h.parse(n,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,v=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else p=u(p,m,o.typeAnnotation||"coerce");else p=u(p,m,o.typeAnnotation||"assert")}if(!(p instanceof nl)&&p.type.kind!=="resolvedImage"&&Dp(p)){const m=new k0(this._scope,this.options);try{p=new nl(p.type,p.evaluate(m))}catch(v){return this.error(v.message),null}}return p}return _c.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,u){const h=typeof n=="number"?this.path.concat(n):this.path,p=u?this.scope.concat(u):this.scope;return new jg(this.registry,h,o||null,p,this.errors,this._scope,this.options)}error(n,...o){const u=`${this.key}${o.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ml(u,n))}checkSubtype(n,o){const u=yp(n,o);return u&&this.error(u),u}}var lw=jg;function Dp(i){if(i instanceof kp)return Dp(i.boundExpression);if(i instanceof qo&&i.name==="error"||i instanceof xp||i instanceof kl||i instanceof ph||i instanceof du)return!1;const n=i instanceof _c||i instanceof ha;let o=!0;return i.eachChild(u=>{o=n?o&&Dp(u):o&&u instanceof nl}),!!o&&Pp(i)&&Mp(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function mh(i,n){const o=i.length-1;let u,h,p=0,m=o,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),u=i[v],h=i[v+1],u<=n){if(v===o||n<h)return v;p=v+1}else{if(!(u>n))throw new bs("Input is not a number.");m=v-1}return 0}class kd{constructor(n,o,u){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[h,p]of u)this.labels.push(h),this.outputs.push(p)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(n[1],1,nn);if(!u)return null;const h=[];let p=null;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(let m=1;m<n.length;m+=2){const v=m===1?-1/0:n[m],w=n[m+1],E=m,C=m+1;if(typeof v!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=o.parse(w,C,p);if(!P)return null;p=p||P.type,h.push([v,P])}return new kd(p,u,h)}evaluate(n){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return u[0].evaluate(n);const p=o.length;return h>=o[p-1]?u[p-1].evaluate(n):u[mh(o,h)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}const cw=.95047,U0=1.08883,uw=4/29,fu=6/29,hw=3*fu*fu,jA=fu*fu*fu,UA=Math.PI/180,VA=180/Math.PI;function Ug(i){return i>jA?Math.pow(i,1/3):i/hw+uw}function V0(i){return i>fu?i*i*i:hw*(i-uw)}function $0(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function q0(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function dw(i){const n=q0(i.r),o=q0(i.g),u=q0(i.b),h=Ug((.4124564*n+.3575761*o+.1804375*u)/cw),p=Ug((.2126729*n+.7151522*o+.072175*u)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Ug((.0193339*n+.119192*o+.9503041*u)/U0)),alpha:i.a}}function fw(i){let n=(i.l+16)/116,o=isNaN(i.a)?n:n+i.a/500,u=isNaN(i.b)?n:n-i.b/200;return n=1*V0(n),o=cw*V0(o),u=U0*V0(u),new Ir($0(3.2404542*o-1.5371385*n-.4985314*u),$0(-.969266*o+1.8760108*n+.041556*u),$0(.0556434*o-.2040259*n+1.0572252*u),i.alpha)}function $A(i,n,o){const u=n-i;return i+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const Op={forward:dw,reverse:fw,interpolate:function(i,n,o){return{l:Tn(i.l,n.l,o),a:Tn(i.a,n.a,o),b:Tn(i.b,n.b,o),alpha:Tn(i.alpha,n.alpha,o)}}},Lp={forward:function(i){const{l:n,a:o,b:u}=dw(i),h=Math.atan2(u,o)*VA;return{h:h<0?h+360:h,c:Math.sqrt(o*o+u*u),l:n,alpha:i.a}},reverse:function(i){const n=i.h*UA,o=i.c;return fw({l:i.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:i.alpha})},interpolate:function(i,n,o){return{h:$A(i.h,n.h,o),c:Tn(i.c,n.c,o),l:Tn(i.l,n.l,o),alpha:Tn(i.alpha,n.alpha,o)}}};var zp=Object.freeze({__proto__:null,hcl:Lp,lab:Op});class ga{constructor(n,o,u,h,p){this.type=n,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(n,o,u,h){let p=0;if(n.name==="exponential")p=G0(o,n.base,u,h);else if(n.name==="linear")p=G0(o,1,u,h);else if(n.name==="cubic-bezier"){const m=n.controlPoints;p=new tu(m[0],m[1],m[2],m[3]).solve(G0(o,1,u,h))}return p}static parse(n,o){let[u,h,p,...m]=n;if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(p=o.parse(p,2,nn),!p)return null;const v=[];let w=null;u==="interpolate-hcl"||u==="interpolate-lab"?w=Ma:o.expectedType&&o.expectedType.kind!=="value"&&(w=o.expectedType);for(let E=0;E<m.length;E+=2){const C=m[E],P=m[E+1],M=E+3,z=E+4;if(typeof C!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(v.length&&v[v.length-1][0]>=C)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const j=o.parse(P,z,w);if(!j)return null;w=w||j.type,v.push([C,j])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new ga(w,u,h,p,v):o.error(`Type ${Bi(w)} is not interpolatable.`)}evaluate(n){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return u[0].evaluate(n);const p=o.length;if(h>=o[p-1])return u[p-1].evaluate(n);const m=mh(o,h),v=ga.interpolationFactor(this.interpolation,h,o[m],o[m+1]),w=u[m].evaluate(n),E=u[m+1].evaluate(n);return this.operator==="interpolate"?_p[this.type.kind.toLowerCase()](w,E,v):this.operator==="interpolate-hcl"?Lp.reverse(Lp.interpolate(Lp.forward(w),Lp.forward(E),v)):Op.reverse(Op.interpolate(Op.forward(w),Op.forward(E),v))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,n,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function G0(i,n,o,u){const h=u-o,p=i-o;return h===0?0:n===1?p/h:(Math.pow(n,p)-1)/(Math.pow(n,h)-1)}class gh{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let u=null;const h=o.expectedType;h&&h.kind!=="value"&&(u=h);const p=[];for(const v of n.slice(1)){const w=o.parse(v,1+p.length,u,void 0,{typeAnnotation:"omit"});if(!w)return null;u=u||w.type,p.push(w)}const m=h&&p.some(v=>yp(h,v.type));return new gh(m?Tr:u,p)}evaluate(n){let o,u=null,h=0;for(const p of this.args){if(h++,u=p.evaluate(n),u&&u instanceof ua&&!u.available&&(o||(o=u),u=null,h===this.args.length))return o;if(u!==null)break}return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class Vg{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const u=[];for(let p=1;p<n.length-1;p+=2){const m=n[p];if(typeof m!="string")return o.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=o.parse(n[p+1],p+1);if(!v)return null;u.push([m,v])}const h=o.parse(n[n.length-1],n.length-1,o.expectedType,u);return h?new Vg(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,u]of this.bindings)n.push(o,u.serialize());return n.push(this.result.serialize()),n}}class $g{constructor(n,o,u){this.type=n,this.index=o,this.input=u}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,nn),h=o.parse(n[2],2,ao(o.expectedType||Tr));return u&&h?new $g(h.type.itemType,u,h):null}evaluate(n){const o=this.index.evaluate(n),u=this.input.evaluate(n);if(o<0)throw new bs(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new bs(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new bs(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class W0{constructor(n,o){this.type=Ar,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,Tr),h=o.parse(n[2],2,Tr);return u&&h?ka(u.type,[Ar,xr,nn,ca,Tr])?new W0(u,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(u.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(u==null)return!1;if(!vp(o,["boolean","string","number","null"]))throw new bs(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(ps(o))} instead.`);if(!vp(u,["string","array"]))throw new bs(`Expected second argument to be of type array or string, but found ${Bi(ps(u))} instead.`);return u.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Np{constructor(n,o,u){this.type=nn,this.needle=n,this.haystack=o,this.fromIndex=u}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,Tr),h=o.parse(n[2],2,Tr);if(!u||!h)return null;if(!ka(u.type,[Ar,xr,nn,ca,Tr]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(u.type)} instead`);if(n.length===4){const p=o.parse(n[3],3,nn);return p?new Np(u,h,p):null}return new Np(u,h)}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!vp(o,["boolean","string","number","null"]))throw new bs(`Expected first argument to be of type boolean, string, number or null, but found ${Bi(ps(o))} instead.`);if(!vp(u,["string","array"]))throw new bs(`Expected second argument to be of type array or string, but found ${Bi(ps(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return u.indexOf(o,h)}return u.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class qg{constructor(n,o,u,h,p,m){this.inputType=n,this.type=o,this.input=u,this.cases=h,this.outputs=p,this.otherwise=m}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const p={},m=[];for(let E=2;E<n.length-1;E+=2){let C=n[E];const P=n[E+1];Array.isArray(C)||(C=[C]);const M=o.concat(E);if(C.length===0)return M.error("Expected at least one branch label.");for(const j of C){if(typeof j!="number"&&typeof j!="string")return M.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return M.error("Numeric branch labels must be integer values.");if(u){if(M.checkSubtype(u,ps(j)))return null}else u=ps(j);if(p[String(j)]!==void 0)return M.error("Branch labels must be unique.");p[String(j)]=m.length}const z=o.parse(P,E,h);if(!z)return null;h=h||z.type,m.push(z)}const v=o.parse(n[1],1,Tr);if(!v)return null;const w=o.parse(n[n.length-1],n.length-1,h);return w?v.type.kind!=="value"&&o.concat(1).checkSubtype(u,v.type)?null:new qg(u,h,v,p,m,w):null}evaluate(n){const o=this.input.evaluate(n);return(ps(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],h={};for(const m of o){const v=h[this.cases[m]];v===void 0?(h[this.cases[m]]=u.length,u.push([this.cases[m],[m]])):u[v][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,v]of u)n.push(v.length===1?p(v[0]):v.map(p)),n.push(this.outputs[m].serialize());return n.push(this.otherwise.serialize()),n}}class Gg{constructor(n,o,u){this.type=n,this.branches=o,this.otherwise=u}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const h=[];for(let m=1;m<n.length-1;m+=2){const v=o.parse(n[m],m,Ar);if(!v)return null;const w=o.parse(n[m+1],m+1,u);if(!w)return null;h.push([v,w]),u=u||w.type}const p=o.parse(n[n.length-1],n.length-1,u);return p?new Gg(u,h,p):null}evaluate(n){for(const[o,u]of this.branches)if(o.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,u]of this.branches)n(o),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class Fp{constructor(n,o,u,h){this.type=n,this.input=o,this.beginIndex=u,this.endIndex=h}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,Tr),h=o.parse(n[2],2,nn);if(!u||!h)return null;if(!ka(u.type,[ao(Tr),xr,Tr]))return o.error(`Expected first argument to be of type array or string, but found ${Bi(u.type)} instead`);if(n.length===4){const p=o.parse(n[3],3,nn);return p?new Fp(u.type,u,h,p):null}return new Fp(u.type,u,h)}evaluate(n){const o=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!vp(o,["string","array"]))throw new bs(`Expected first argument to be of type array or string, but found ${Bi(ps(o))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return o.slice(u,h)}return o.slice(u)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Wg(i,n){return i==="=="||i==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Hg(i,n,o,u){return u.compare(n,o)===0}function Dd(i,n,o){const u=i!=="=="&&i!=="!=";return class MZ{constructor(p,m,v){this.type=Ar,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const v=p[0];let w=m.parse(p[1],1,Tr);if(!w)return null;if(!Wg(v,w.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${Bi(w.type)}'.`);let E=m.parse(p[2],2,Tr);if(!E)return null;if(!Wg(v,E.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${Bi(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${Bi(w.type)}' and '${Bi(E.type)}'.`);u&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new ha(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new ha(w.type,[E])));let C=null;if(p.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(C=m.parse(p[3],3,Ag),!C)return null}return new MZ(w,E,C)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(u&&this.hasUntypedArgument){const w=ps(m),E=ps(v);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new bs(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const w=ps(m),E=ps(v);if(w.kind!=="string"||E.kind!=="string")return n(p,m,v)}return this.collator?o(p,m,v,this.collator.evaluate(p)):n(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const qA=Dd("==",function(i,n,o){return n===o},Hg),pw=Dd("!=",function(i,n,o){return n!==o},function(i,n,o,u){return!Hg(0,n,o,u)}),GA=Dd("<",function(i,n,o){return n<o},function(i,n,o,u){return u.compare(n,o)<0}),WA=Dd(">",function(i,n,o){return n>o},function(i,n,o,u){return u.compare(n,o)>0}),HA=Dd("<=",function(i,n,o){return n<=o},function(i,n,o,u){return u.compare(n,o)<=0}),ZA=Dd(">=",function(i,n,o){return n>=o},function(i,n,o,u){return u.compare(n,o)>=0});class H0{constructor(n,o,u,h,p,m){this.type=xr,this.number=n,this.locale=o,this.currency=u,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const u=o.parse(n[1],1,nn);if(!u)return null;const h=n[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=o.parse(h.locale,1,xr),!p))return null;let m=null;if(h.currency&&(m=o.parse(h.currency,1,xr),!m))return null;let v=null;if(h.unit&&(v=o.parse(h.unit,1,xr),!v))return null;let w=null;if(h["min-fraction-digits"]&&(w=o.parse(h["min-fraction-digits"],1,nn),!w))return null;let E=null;return h["max-fraction-digits"]&&(E=o.parse(h["max-fraction-digits"],1,nn),!E)?null:new H0(u,p,m,v,w,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Z0{constructor(n){this.type=nn,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=o.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Bi(u.type)} instead.`):new Z0(u):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new bs(`Expected value to be of type string or array, but found ${Bi(ps(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(o=>{n.push(o.serialize())}),n}}function mw(i){return function(){i=1831565813+(i|=0)|0;let n=Math.imul(i^i>>>15,1|i);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const Od={"==":qA,"!=":pw,">":WA,"<":GA,">=":ZA,"<=":HA,array:ha,at:$g,boolean:ha,case:Gg,coalesce:gh,collator:xp,format:dh,image:gc,in:W0,"index-of":Np,interpolate:ga,"interpolate-hcl":ga,"interpolate-lab":ga,length:Z0,let:Vg,literal:nl,match:qg,number:ha,"number-format":H0,object:ha,slice:Fp,step:kd,string:ha,"to-boolean":_c,"to-color":_c,"to-number":_c,"to-string":_c,var:kp,within:kl,distance:ph,config:du};function gw(i,[n,o,u,h]){n=n.evaluate(i),o=o.evaluate(i),u=u.evaluate(i);const p=h?h.evaluate(i):1,m=Gb(n,o,u,p);if(m)throw new bs(m);return new Ir(n/255*p,o/255*p,u/255*p,p)}function XA(i,[n,o,u,h]){n=n.evaluate(i),o=o.evaluate(i),u=u.evaluate(i);const p=h?h.evaluate(i):1,m=function(E,C,P,M){return typeof E=="number"&&E>=0&&E<=360?typeof C=="number"&&C>=0&&C<=100&&typeof P=="number"&&P>=0&&P<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[E,C,P,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[E,C,P,M]:[E,C,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[E,C,P,M]:[E,C,P]).join(", ")}]: 'h' must be between 0 and 360.`}(n,o,u,p);if(m)throw new bs(m);const v=`hsla(${n}, ${o}%, ${u}%, ${p})`,w=Ir.parse(v);if(!w)throw new bs(`Failed to parse HSLA color: ${v}`);return w}function g(i,n){return i in n}function l(i,n){const o=n[i];return o===void 0?null:o}function d(i){return{type:i}}function y(i){return{result:"success",value:i}}function b(i){return{result:"error",value:i}}function T(i,n){return!!i&&!!i.parameters&&i.parameters.indexOf(n)>-1}function S(i){return i["property-type"]==="data-driven"}function A(i){return T(i.expression,"measure-light")}function k(i){return T(i.expression,"zoom")}function L(i){return!!i.expression&&i.expression.interpolated}function B(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function U(i){return i}function q(i,n){const o=n.type==="color",u=i.stops&&typeof i.stops[0][0]=="object",h=u||!(u||i.property!==void 0),p=i.type||(L(n)?"exponential":"interval");if(o&&((i=Sd({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],Ir.parse(E[1])])),i.default=Ir.parse(i.default?i.default:n.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!zp[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let m,v,w;if(p==="exponential")m=ae;else if(p==="interval")m=oe;else if(p==="categorical"){m=se,v=Object.create(null);for(const E of i.stops)v[E[0]]=E[1];w=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=ce}if(u){const E={},C=[];for(let z=0;z<i.stops.length;z++){const j=i.stops[z],V=j[0].zoom;E[V]===void 0&&(E[V]={zoom:V,type:i.type,property:i.property,default:i.default,stops:[]},C.push(V)),E[V].stops.push([j[0].value,j[1]])}const P=[];for(const z of C)P.push([E[z].zoom,q(E[z],n)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:ga.interpolationFactor.bind(void 0,M),zoomStops:P.map(z=>z[0]),evaluate:({zoom:z},j)=>ae({stops:P,base:i.base},n,z).evaluate(z,j)}}if(h){const E=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ga.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(i,n,C,v,w)}}return{kind:"source",evaluate(E,C){const P=C&&C.properties?C.properties[i.property]:void 0;return P===void 0?Z(i.default,n.default):m(i,n,P,v,w)}}}function Z(i,n,o){return i!==void 0?i:n!==void 0?n:o!==void 0?o:void 0}function se(i,n,o,u,h){return Z(typeof o===h?u[o]:void 0,i.default,n.default)}function oe(i,n,o){if(cu(o)!=="number")return Z(i.default,n.default);const u=i.stops.length;if(u===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[u-1][0])return i.stops[u-1][1];const h=mh(i.stops.map(p=>p[0]),o);return i.stops[h][1]}function ae(i,n,o){const u=i.base!==void 0?i.base:1;if(cu(o)!=="number")return Z(i.default,n.default);const h=i.stops.length;if(h===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[h-1][0])return i.stops[h-1][1];const p=mh(i.stops.map(C=>C[0]),o),m=function(C,P,M,z){const j=z-M,V=C-M;return j===0?0:P===1?V/j:(Math.pow(P,V)-1)/(Math.pow(P,j)-1)}(o,u,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],w=i.stops[p+1][1];let E=_p[n.type]||U;if(i.colorSpace&&i.colorSpace!=="rgb"){const C=zp[i.colorSpace];E=(P,M)=>C.reverse(C.interpolate(C.forward(P),C.forward(M),m))}return typeof v.evaluate=="function"?{evaluate(...C){const P=v.evaluate.apply(void 0,C),M=w.evaluate.apply(void 0,C);if(P!==void 0&&M!==void 0)return E(P,M,m)}}:E(v,w,m)}function ce(i,n,o){return n.type==="color"?o=Ir.parse(o):n.type==="formatted"?o=bo.fromString(o.toString()):n.type==="resolvedImage"?o=ua.fromString(o.toString()):cu(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),Z(o,i.default,n.default)}qo.register(Od,{error:[{kind:"error"},[xr],(i,[n])=>{throw new bs(n.evaluate(i))}],typeof:[xr,[Tr],(i,[n])=>Bi(ps(n.evaluate(i)))],"to-rgba":[ao(nn,4),[Ma],(i,[n])=>n.evaluate(i).toRenderColor(null).toArray()],rgb:[Ma,[nn,nn,nn],gw],rgba:[Ma,[nn,nn,nn,nn],gw],hsl:[Ma,[nn,nn,nn],XA],hsla:[Ma,[nn,nn,nn,nn],XA],has:{type:Ar,overloads:[[[xr],(i,[n])=>g(n.evaluate(i),i.properties())],[[xr,Id],(i,[n,o])=>g(n.evaluate(i),o.evaluate(i))]]},get:{type:Tr,overloads:[[[xr],(i,[n])=>l(n.evaluate(i),i.properties())],[[xr,Id],(i,[n,o])=>l(n.evaluate(i),o.evaluate(i))]]},"feature-state":[Tr,[xr],(i,[n])=>l(n.evaluate(i),i.featureState||{})],properties:[Id,[],i=>i.properties()],"geometry-type":[xr,[],i=>i.geometryType()],id:[Tr,[],i=>i.id()],zoom:[nn,[],i=>i.globals.zoom],pitch:[nn,[],i=>i.globals.pitch||0],"distance-from-center":[nn,[],i=>i.distanceFromCenter()],"measure-light":[nn,[xr],(i,[n])=>i.measureLight(n.evaluate(i))],"heatmap-density":[nn,[],i=>i.globals.heatmapDensity||0],"line-progress":[nn,[],i=>i.globals.lineProgress||0],"raster-value":[nn,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[nn,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[nn,[],i=>i.globals.skyRadialProgress||0],accumulated:[Tr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[nn,d(nn),(i,n)=>{let o=0;for(const u of n)o+=u.evaluate(i);return o}],"*":[nn,d(nn),(i,n)=>{let o=1;for(const u of n)o*=u.evaluate(i);return o}],"-":{type:nn,overloads:[[[nn,nn],(i,[n,o])=>n.evaluate(i)-o.evaluate(i)],[[nn],(i,[n])=>-n.evaluate(i)]]},"/":[nn,[nn,nn],(i,[n,o])=>n.evaluate(i)/o.evaluate(i)],"%":[nn,[nn,nn],(i,[n,o])=>n.evaluate(i)%o.evaluate(i)],ln2:[nn,[],()=>Math.LN2],pi:[nn,[],()=>Math.PI],e:[nn,[],()=>Math.E],"^":[nn,[nn,nn],(i,[n,o])=>Math.pow(n.evaluate(i),o.evaluate(i))],sqrt:[nn,[nn],(i,[n])=>Math.sqrt(n.evaluate(i))],log10:[nn,[nn],(i,[n])=>Math.log(n.evaluate(i))/Math.LN10],ln:[nn,[nn],(i,[n])=>Math.log(n.evaluate(i))],log2:[nn,[nn],(i,[n])=>Math.log(n.evaluate(i))/Math.LN2],sin:[nn,[nn],(i,[n])=>Math.sin(n.evaluate(i))],cos:[nn,[nn],(i,[n])=>Math.cos(n.evaluate(i))],tan:[nn,[nn],(i,[n])=>Math.tan(n.evaluate(i))],asin:[nn,[nn],(i,[n])=>Math.asin(n.evaluate(i))],acos:[nn,[nn],(i,[n])=>Math.acos(n.evaluate(i))],atan:[nn,[nn],(i,[n])=>Math.atan(n.evaluate(i))],min:[nn,d(nn),(i,n)=>Math.min(...n.map(o=>o.evaluate(i)))],max:[nn,d(nn),(i,n)=>Math.max(...n.map(o=>o.evaluate(i)))],abs:[nn,[nn],(i,[n])=>Math.abs(n.evaluate(i))],round:[nn,[nn],(i,[n])=>{const o=n.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[nn,[nn],(i,[n])=>Math.floor(n.evaluate(i))],ceil:[nn,[nn],(i,[n])=>Math.ceil(n.evaluate(i))],"filter-==":[Ar,[xr,Tr],(i,[n,o])=>i.properties()[n.value]===o.value],"filter-id-==":[Ar,[Tr],(i,[n])=>i.id()===n.value],"filter-type-==":[Ar,[xr],(i,[n])=>i.geometryType()===n.value],"filter-<":[Ar,[xr,Tr],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Ar,[Tr],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o<u}],"filter->":[Ar,[xr,Tr],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u>h}],"filter-id->":[Ar,[Tr],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o>u}],"filter-<=":[Ar,[xr,Tr],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Ar,[Tr],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o<=u}],"filter->=":[Ar,[xr,Tr],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Ar,[Tr],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o>=u}],"filter-has":[Ar,[Tr],(i,[n])=>n.value in i.properties()],"filter-has-id":[Ar,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ar,[ao(xr)],(i,[n])=>n.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ar,[ao(Tr)],(i,[n])=>n.value.indexOf(i.id())>=0],"filter-in-small":[Ar,[xr,ao(Tr)],(i,[n,o])=>o.value.indexOf(i.properties()[n.value])>=0],"filter-in-large":[Ar,[xr,ao(Tr)],(i,[n,o])=>function(u,h,p,m){for(;p<=m;){const v=p+m>>1;if(h[v]===u)return!0;h[v]>u?m=v-1:p=v+1}return!1}(i.properties()[n.value],o.value,0,o.value.length-1)],all:{type:Ar,overloads:[[[Ar,Ar],(i,[n,o])=>n.evaluate(i)&&o.evaluate(i)],[d(Ar),(i,n)=>{for(const o of n)if(!o.evaluate(i))return!1;return!0}]]},any:{type:Ar,overloads:[[[Ar,Ar],(i,[n,o])=>n.evaluate(i)||o.evaluate(i)],[d(Ar),(i,n)=>{for(const o of n)if(o.evaluate(i))return!0;return!1}]]},"!":[Ar,[Ar],(i,[n])=>!n.evaluate(i)],"is-supported-script":[Ar,[xr],(i,[n])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(n.evaluate(i))}],upcase:[xr,[xr],(i,[n])=>n.evaluate(i).toUpperCase()],downcase:[xr,[xr],(i,[n])=>n.evaluate(i).toLowerCase()],concat:[xr,d(Tr),(i,n)=>n.map(o=>tl(o.evaluate(i))).join("")],"resolved-locale":[xr,[Ag],(i,[n])=>n.evaluate(i).resolvedLocale()],random:[nn,[nn,nn,Tr],(i,n)=>{const[o,u,h]=n.map(m=>m.evaluate(i));if(o>u||o===u)return o;let p;if(typeof h=="string")p=function(m){let v=0;if(m.length===0)return v;for(let w=0;w<m.length;w++)v=(v<<5)-v+m.charCodeAt(w),v|=0;return v}(h);else{if(typeof h!="number")throw new bs(`Invalid seed input: ${h}`);p=h}return o+mw(p)()*(u-o)}]});class xe{constructor(n,o,u,h){this.expression=n,this._warningHistory={},this._evaluator=new k0(u,h),this._defaultValue=o?function(p){return p.type==="color"&&(B(p.default)||Array.isArray(p.default))?new Ir(0,0,0,0):p.type==="color"?Ir.parse(p.default)||null:p.default===void 0?null:p.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(n,o,u,h,p,m,v,w){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,u,h,p,m,v,w){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new bs(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console!="undefined"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${E.message}`)),this._defaultValue}}}function be(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Od}function ve(i,n,o,u){const h=new lw(Od,[],n?function(m){const v={color:Ma,string:xr,number:nn,enum:xr,boolean:Ar,formatted:Cd,resolvedImage:hh};return m.type==="array"?ao(v[m.value]||Tr,m.length):v[m.type]}(n):void 0,void 0,void 0,o,u),p=h.parse(i,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?y(new xe(p,n,o,u)):b(h.errors)}class ke{constructor(n,o,u){this.kind=n,this._styleExpression=o,this.isLightConstant=u,this.isStateDependent=n!=="constant"&&!Bg(o.expression),this.configDependencies=Rp(o.expression)}evaluateWithoutErrorHandling(n,o,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,h,p,m)}evaluate(n,o,u,h,p,m){return this._styleExpression.evaluate(n,o,u,h,p,m)}}class Ce{constructor(n,o,u,h,p){this.kind=n,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!Bg(o.expression),this.isLightConstant=p,this.configDependencies=Rp(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,o,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,h,p,m)}evaluate(n,o,u,h,p,m){return this._styleExpression.evaluate(n,o,u,h,p,m)}interpolationFactor(n,o,u){return this.interpolationType?ga.interpolationFactor(this.interpolationType,n,o,u):0}}function Ae(i,n,o,u){if((i=ve(i,n,o,u)).result==="error")return i;const h=i.value.expression,p=Pp(h);if(!p&&!S(n))return b([new Ml("","data expressions not supported")]);const m=Mp(h,["zoom","pitch","distance-from-center"]);if(!m&&!k(n))return b([new Ml("","zoom expressions not supported")]);const v=Mp(h,["measure-light"]);if(!v&&!A(n))return b([new Ml("","measure-light expression not supported")]);const w=n.expression&&n.expression.relaxZoomRestriction,E=Fe(h);return E||m||w?E instanceof Ml?b([E]):E instanceof ga&&!L(n)?b([new Ml("",'"interpolate" expressions cannot be used with this property')]):y(E?new Ce(p?"camera":"composite",i.value,E.labels,E instanceof ga?E.interpolation:void 0,v):new ke(p?"constant":"source",i.value,v)):b([new Ml("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ne{constructor(n,o){this._parameters=n,this._specification=o,Sd(this,q(this._parameters,this._specification))}static deserialize(n){return new Ne(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Fe(i){let n=null;if(i instanceof Vg)n=Fe(i.result);else if(i instanceof gh){for(const o of i.args)if(n=Fe(o),n)break}else(i instanceof kd||i instanceof ga)&&i.input instanceof qo&&i.input.name==="zoom"&&(n=i);return n instanceof Ml||i.eachChild(o=>{const u=Fe(o);u instanceof Ml?n=u:n&&u&&n!==u&&(n=new Ml("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var Ze=Me,je=3;function Me(i,n,o){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(n=h[1])+2*(o=h[2]);for(var p=0;p<this.d*this.d;p++){var m=h[je+p],v=h[je+p+1];u.push(m===v?null:h.subarray(m,v))}var w=h[je+u.length+1];this.keys=h.subarray(h[je+u.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*o;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=i,this.padding=o,this.scale=n/i,this.uid=0;var C=o/n*i;this.min=-C,this.max=i+C}Me.prototype.insert=function(i,n,o,u,h){this._forEachCell(n,o,u,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h)},Me.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Me.prototype._insertCell=function(i,n,o,u,h,p){this.cells[h].push(p)},Me.prototype.query=function(i,n,o,u,h){var p=this.min,m=this.max;if(i<=p&&n<=p&&m<=o&&m<=u&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,n,o,u,this._queryCell,v,{},h),v},Me.prototype._queryCell=function(i,n,o,u,h,p,m,v){var w=this.cells[h];if(w!==null)for(var E=this.keys,C=this.bboxes,P=0;P<w.length;P++){var M=w[P];if(m[M]===void 0){var z=4*M;(v?v(C[z+0],C[z+1],C[z+2],C[z+3]):i<=C[z+2]&&n<=C[z+3]&&o>=C[z+0]&&u>=C[z+1])?(m[M]=!0,p.push(E[M])):m[M]=!1}}},Me.prototype._forEachCell=function(i,n,o,u,h,p,m,v){for(var w=this._convertToCellCoord(i),E=this._convertToCellCoord(n),C=this._convertToCellCoord(o),P=this._convertToCellCoord(u),M=w;M<=C;M++)for(var z=E;z<=P;z++){var j=this.d*z+M;if((!v||v(this._convertFromCellCoord(M),this._convertFromCellCoord(z),this._convertFromCellCoord(M+1),this._convertFromCellCoord(z+1)))&&h.call(this,i,n,o,u,j,p,m,v))return}},Me.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Me.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Me.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,n=je+this.cells.length+1+1,o=0,u=0;u<this.cells.length;u++)o+=this.cells[u].length;var h=new Int32Array(n+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=n,m=0;m<i.length;m++){var v=i[m];h[je+m]=p,h.set(v,p),p+=v.length}return h[je+i.length]=p,h.set(this.keys,p),h[je+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var nt=fe(Ze);const et={};function qe(i,n,o={}){Object.defineProperty(i,"_classRegistryKey",{value:n,writable:!1}),et[n]={klass:i,omit:o.omit||[]}}qe(Object,"Object"),nt.serialize=function(i,n){const o=i.toArrayBuffer();return n&&n.add(o),{buffer:o}},nt.deserialize=function(i){return new nt(i.buffer)},Object.defineProperty(nt,"name",{value:"Grid"}),qe(nt,"Grid"),qe(Ir,"Color"),qe(Error,"Error"),qe(bo,"Formatted"),qe(Rg,"FormattedSection"),qe(Tg,"AJAXError"),qe(ua,"ResolvedImage"),qe(Ne,"StylePropertyFunction"),qe(xe,"StyleExpression",{omit:["_evaluator"]}),qe(Ce,"ZoomDependentExpression"),qe(ke,"ZoomConstantExpression"),qe(qo,"CompoundExpression",{omit:["_evaluate"]});for(const i in Od)et[Od[i]._classRegistryKey]||qe(Od[i],`Expression${i}`);function St(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function yt(i){return self.ImageBitmap&&i instanceof ImageBitmap}function Xe(i,n){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(St(i)||yt(i))return n&&n.add(i),i;if(ArrayBuffer.isView(i)){const o=i;return n&&n.add(o.buffer),o}if(i instanceof ImageData)return n&&n.add(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const u of i)o.push(Xe(u,n));return o}if(i instanceof Map){const o={$name:"Map"};for(const[u,h]of i.entries())o[u]=Xe(h);return o}if(i instanceof Set){const o={$name:"Set"};let u=0;for(const h of i.values())o[++u]=Xe(h);return o}if(typeof i=="object"){const o=i.constructor,u=o._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const h=o.serialize?o.serialize(i,n):{};if(!o.serialize){for(const p in i)i.hasOwnProperty(p)&&(et[u].omit.indexOf(p)>=0||(h[p]=Xe(i[p],n)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof i)}function ot(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||St(i)||yt(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(ot);if(typeof i=="object"){const n=i.$name||"Object";if(n==="Map"){const h=new Map;for(const p of Object.keys(i))p!=="$name"&&h.set(p,ot(i[p]));return h}if(n==="Set"){const h=new Set;for(const p of Object.keys(i))p!=="$name"&&h.add(ot(i[p]));return h}const{klass:o}=et[n];if(!o)throw new Error(`can't deserialize unregistered class ${n}`);if(o.deserialize)return o.deserialize(i);const u=Object.create(o.prototype);for(const h of Object.keys(i))h!=="$name"&&(u[h]=ot(i[h]));return u}throw new Error("can't deserialize object of type "+typeof i)}const $e={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function vt(i){for(const n of i)if(Ht(n.charCodeAt(0)))return!0;return!1}function bt(i){for(const n of i)if(!Vt(n.charCodeAt(0)))return!1;return!0}function Vt(i){return!($e.Arabic(i)||$e["Arabic Supplement"](i)||$e["Arabic Extended-A"](i)||$e["Arabic Presentation Forms-A"](i)||$e["Arabic Presentation Forms-B"](i))}function Ht(i){return!(i!==746&&i!==747&&(i<4352||!($e["Bopomofo Extended"](i)||$e.Bopomofo(i)||$e["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||$e["CJK Compatibility Ideographs"](i)||$e["CJK Compatibility"](i)||$e["CJK Radicals Supplement"](i)||$e["CJK Strokes"](i)||!(!$e["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||$e["CJK Unified Ideographs Extension A"](i)||$e["CJK Unified Ideographs"](i)||$e["Enclosed CJK Letters and Months"](i)||$e["Hangul Compatibility Jamo"](i)||$e["Hangul Jamo Extended-A"](i)||$e["Hangul Jamo Extended-B"](i)||$e["Hangul Jamo"](i)||$e["Hangul Syllables"](i)||$e.Hiragana(i)||$e["Ideographic Description Characters"](i)||$e.Kanbun(i)||$e["Kangxi Radicals"](i)||$e["Katakana Phonetic Extensions"](i)||$e.Katakana(i)&&i!==12540||!(!$e["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!$e["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||$e["Unified Canadian Aboriginal Syllabics"](i)||$e["Unified Canadian Aboriginal Syllabics Extended"](i)||$e["Vertical Forms"](i)||$e["Yijing Hexagram Symbols"](i)||$e["Yi Syllables"](i)||$e["Yi Radicals"](i))))}function ln(i){return!(Ht(i)||function(n){return!!($e["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||$e["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||$e["Letterlike Symbols"](n)||$e["Number Forms"](n)||$e["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||$e["Control Pictures"](n)&&n!==9251||$e["Optical Character Recognition"](n)||$e["Enclosed Alphanumerics"](n)||$e["Geometric Shapes"](n)||$e["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||$e["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||$e["CJK Symbols and Punctuation"](n)||$e.Katakana(n)||$e["Private Use Area"](n)||$e["CJK Compatibility Forms"](n)||$e["Small Form Variants"](n)||$e["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(i))}function Yt(i){return i>=1424&&i<=2303||$e["Arabic Presentation Forms-A"](i)||$e["Arabic Presentation Forms-B"](i)}function wn(i,n){return!(!n&&Yt(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||$e.Khmer(i))}function Gn(i){for(const n of i)if(Yt(n.charCodeAt(0)))return!0;return!1}const In="deferred",Xn="loading",pr="loaded";let ei=null,jr="unavailable",_r=null;const Br=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(jr="error"),ei&&ei(i)};function Jn(){rr.fire(new Rl("pluginStateChange",{pluginStatus:jr,pluginURL:_r}))}const rr=new uh,Wn=function(){return jr},wr=function(){if(jr!==In||!_r)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");jr=Xn,Jn(),_r&&oh({url:_r},i=>{i?Br(i):(jr=pr,Jn())})},or={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>jr===pr||or.applyArabicShaping!=null,isLoading:()=>jr===Xn,setState(i){jr=i.pluginStatus,_r=i.pluginURL},isParsed:()=>or.applyArabicShaping!=null&&or.processBidirectionalText!=null&&or.processStyledBidirectionalText!=null,getPluginURL:()=>_r};class Mn{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(o,u){for(const h of o)if(!wn(h.charCodeAt(0),u))return!1;return!0}(n,or.isLoaded())}}class Wi{constructor(n,o,u,h){this.property=n,this.value=o,this.expression=function(p,m,v,w){if(B(p))return new Ne(p,m);if(be(p)||Array.isArray(p)&&p.length>0){const E=Ae(p,m,v,w);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));return E.value}{let E=p;return typeof p=="string"&&m.type==="color"&&(E=Ir.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>E}}}(o===void 0?n.specification.default:o,n.specification,u,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,u){return this.property.possiblyEvaluate(this,n,o,u)}}class Hi{constructor(n,o,u){this.property=n,this.value=new Wi(n,void 0,o,u)}transitioned(n,o){return new uo(this.property,this.value,o,ks({},n.transition,this.transition),n.now)}untransitioned(){return new uo(this.property,this.value,null,{},0)}}class co{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return $s(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Hi(this._values[n].property,this._scope,this._options)),this._values[n].value=new Wi(this._values[n].property,o===null?void 0:$s(o),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,o){o&&(this._options=o);const u=this._properties.properties;if(n)for(const h in n){const p=n[h];if(Ya(h,"-transition")){const m=h.slice(0,-11);u[m]&&this.setTransition(m,p)}else u.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(n){return $s(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new Hi(this._values[n].property)),this._values[n].transition=$s(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u);const h=this.getTransition(o);h!==void 0&&(n[`${o}-transition`]=h)}return n}transitioned(n,o){const u=new Ys(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(n,o._values[h]);return u}untransitioned(){const n=new Ys(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class uo{constructor(n,o,u,h,p){const m=h.delay||0,v=h.duration||0;p=p||0,this.property=n,this.value=o,this.begin=p+m,this.end=this.begin+v,n.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(n,o,u){const h=n.now||0,p=this.value.possiblyEvaluate(n,o,u),m=this.prior;if(m){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return m.possiblyEvaluate(n,o,u);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(n,o,u),p,nh(v))}}return p}}class Ys{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,u){const h=new Js(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,o,u);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class ho{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return $s(this._values[n].value)}setValue(n,o){this._values[n]=new Wi(this._values[n].property,o===null?void 0:$s(o),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u)}return n}possiblyEvaluate(n,o,u){const h=new Js(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,o,u);return h}}class qs{constructor(n,o,u){this.property=n,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,u,h){return this.property.evaluate(this.value,this.parameters,n,o,u,h)}}class Js{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Rt{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,u){const h=_p[this.specification.type];return h?h(n,o,u):n}}class un{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,u,h){return new qs(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},u,h)}:n.expression,o)}interpolate(n,o,u){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new qs(this,{kind:"constant",value:void 0},n.parameters);const h=_p[this.specification.type];return h?new qs(this,{kind:"constant",value:h(n.value.value,o.value.value,u)},n.parameters):n}evaluate(n,o,u,h,p,m){return n.kind==="constant"?n.value:n.evaluate(o,u,h,p,m)}}class wo{constructor(n){this.specification=n}possiblyEvaluate(n,o,u,h){return!!n.expression.evaluate(o,null,{},u,h)}interpolate(){return!1}}class Wr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Mn(0,{});for(const u in n){const h=n[u];h.specification.overridable&&this.overridableProperties.push(u);const p=this.defaultPropertyValues[u]=new Wi(h,void 0),m=this.defaultTransitionablePropertyValues[u]=new Hi(h);this.defaultTransitioningPropertyValues[u]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=p.possiblyEvaluate(o)}}}qe(un,"DataDrivenProperty"),qe(Rt,"DataConstantProperty"),qe(wo,"ColorRampProperty");var tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function xc(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function rl(i){if(Array.isArray(i))return i.map(rl);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const n={};for(const o in i)n[o]=rl(i[o]);return n}return xc(i)}function bc(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const n of i.slice(1))if(!bc(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function wc(i,n="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};bc(i)||(i=Ld(i));const o=i;let u=!0;try{u=function(E){if(!pu(E))return E;let C=rl(E);return Xg(C),C=Zg(C),C}(o)}catch(E){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const h=tt[`filter_${n}`],p=ve(u,h);let m=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,C,P)=>p.value.evaluate(E,C,{},P);let v=null,w=null;if(u!==o){const E=ve(o,h);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));v=(C,P,M,z,j)=>E.value.evaluate(C,P,{},M,void 0,void 0,z,j),w=!Pp(E.value.expression)}return{filter:m,dynamicFilter:v||void 0,needGeometry:Kg(u),needFeature:!!w}}function Zg(i){if(!Array.isArray(i))return i;const n=function(o){if(X0.has(o[0])){for(let u=1;u<o.length;u++)if(pu(o[u]))return!0}return o}(i);return n===!0?n:n.map(o=>Zg(o))}function Xg(i){let n=!1;const o=[];if(i[0]==="case"){for(let u=1;u<i.length-1;u+=2)n=n||pu(i[u]),o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="match"){n=n||pu(i[1]);for(let u=2;u<i.length-1;u+=2)o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="step"){n=n||pu(i[1]);for(let u=1;u<i.length-1;u+=2)o.push(i[u+1])}n&&(i.length=0,i.push("any",...o));for(let u=1;u<i.length;u++)Xg(i[u])}function pu(i){if(!Array.isArray(i))return!1;if((n=i[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<i.length;o++)if(pu(i[o]))return!0;return!1}const X0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function _h(i,n){return i<n?-1:i>n?1:0}function Kg(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let n=1;n<i.length;n++)if(Kg(i[n]))return!0;return!1}function Ld(i){if(!i)return!0;const n=i[0];return i.length<=1?n!=="any":n==="=="?KA(i[1],i[2],"=="):n==="!="?_w(KA(i[1],i[2],"==")):n==="<"||n===">"||n==="<="||n===">="?KA(i[1],i[2],n):n==="any"?(o=i.slice(1),["any"].concat(o.map(Ld))):n==="all"?["all"].concat(i.slice(1).map(Ld)):n==="none"?["all"].concat(i.slice(1).map(Ld).map(_w)):n==="in"?xL(i[1],i.slice(2)):n==="!in"?_w(xL(i[1],i.slice(2))):n==="has"?bL(i[1]):n!=="!has"||_w(bL(i[1]));var o}function KA(i,n,o){switch(i){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,i,n]}}function xL(i,n){if(n.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",i,["literal",n.sort(_h)]]:["filter-in-small",i,["literal",n]]}}function bL(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function _w(i){return["!",i]}const yw="";function wL(i,n){return n?`${i}${yw}${n}`:i}const TL="-transition",rK=new Set(["fill","line","background","hillshade","raster"]);class _a extends uh{constructor(n,o,u,h,p){if(super(),this.id=n.id,this.fqid=wL(this.id,u),this.type=n.type,this.scope=u,this.lut=h,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),o.layout&&(this._unevaluatedLayout=new ho(o.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint)){this._transitionablePaint=new co(o.paint,this.scope,p);for(const m in n.paint)this.setPaintProperty(m,n.paint[m]);for(const m in n.layout)this.setLayoutProperty(m,n.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Js(o.paint)}}onAdd(n){}onRemove(n){}isDraped(n){return rK.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o){if(this.type==="custom"&&n==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[n]&&(u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return Ya(n,TL)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o){const u=this._transitionablePaint,h=u._properties.properties;if(Ya(n,TL)){const P=n.slice(0,-11);return h[P]&&u.setTransition(P,o||void 0),!1}if(!h[n])return!1;const p=u._values[n],m=p.value.isDataDriven(),v=p.value;u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const w=u._values[n].value,E=w.isDataDriven(),C=Ya(n,"pattern")||n==="line-dasharray";return E||m||C||this._handleOverridablePaintPropertyUpdate(n,v,w)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,o,u){return null}_handleOverridablePaintPropertyUpdate(n,o,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){return Ds({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof qs&&S(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=wc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,o,u,h,p,m,v,w,E){}queryIntersectsMatchingFeature(n,o,u,h){}}const iK={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class K0{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function kr(i,n=1){let o=0,u=0;return{members:i.map(h=>{const p=iK[h.type].BYTES_PER_ELEMENT,m=o=EL(o,Math.max(n,p)),v=h.components||1;return u=Math.max(u,p),o+=p*v,{name:h.name,type:h.type,components:v,offset:m}}),size:EL(o,Math.max(u,n)),alignment:n}}function EL(i,n){return Math.ceil(i/n)*n}class Tc extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const h=2*n;return this.int16[h+0]=o,this.int16[h+1]=u,n}}Tc.prototype.bytesPerElement=4,qe(Tc,"StructArrayLayout2i4");class vw extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u)}emplace(n,o,u,h){const p=3*n;return this.int16[p+0]=o,this.int16[p+1]=u,this.int16[p+2]=h,n}}vw.prototype.bytesPerElement=6,qe(vw,"StructArrayLayout3i6");class yh extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=4*n;return this.int16[m+0]=o,this.int16[m+1]=u,this.int16[m+2]=h,this.int16[m+3]=p,n}}yh.prototype.bytesPerElement=8,qe(yh,"StructArrayLayout4i8");class QA extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=5*n;return this.int16[v+0]=o,this.int16[v+1]=u,this.int16[v+2]=h,this.int16[v+3]=p,this.int16[v+4]=m,n}}QA.prototype.bytesPerElement=10,qe(QA,"StructArrayLayout5i10");class YA extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=6*n,C=12*n,P=3*n;return this.int16[E+0]=o,this.int16[E+1]=u,this.uint8[C+4]=h,this.uint8[C+5]=p,this.uint8[C+6]=m,this.uint8[C+7]=v,this.float32[P+2]=w,n}}YA.prototype.bytesPerElement=12,qe(YA,"StructArrayLayout2i4ub1f12");class zd extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=4*n;return this.float32[m+0]=o,this.float32[m+1]=u,this.float32[m+2]=h,this.float32[m+3]=p,n}}zd.prototype.bytesPerElement=16,qe(zd,"StructArrayLayout4f16");class Nd extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u)}emplace(n,o,u,h){const p=3*n;return this.float32[p+0]=o,this.float32[p+1]=u,this.float32[p+2]=h,n}}Nd.prototype.bytesPerElement=12,qe(Nd,"StructArrayLayout3f12");class Fd extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=6*n,w=3*n;return this.uint16[v+0]=o,this.uint16[v+1]=u,this.uint16[v+2]=h,this.uint16[v+3]=p,this.float32[w+2]=m,n}}Fd.prototype.bytesPerElement=12,qe(Fd,"StructArrayLayout4ui1f12");class xw extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=4*n;return this.uint16[m+0]=o,this.uint16[m+1]=u,this.uint16[m+2]=h,this.uint16[m+3]=p,n}}xw.prototype.bytesPerElement=8,qe(xw,"StructArrayLayout4ui8");class bw extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,h,p,m)}emplace(n,o,u,h,p,m,v){const w=6*n;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=h,this.int16[w+3]=p,this.int16[w+4]=m,this.int16[w+5]=v,n}}bw.prototype.bytesPerElement=12,qe(bw,"StructArrayLayout6i12");class JA extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M){const z=this.length;return this.resize(z+1),this.emplace(z,n,o,u,h,p,m,v,w,E,C,P,M)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z){const j=12*n;return this.int16[j+0]=o,this.int16[j+1]=u,this.int16[j+2]=h,this.int16[j+3]=p,this.uint16[j+4]=m,this.uint16[j+5]=v,this.uint16[j+6]=w,this.uint16[j+7]=E,this.int16[j+8]=C,this.int16[j+9]=P,this.int16[j+10]=M,this.int16[j+11]=z,n}}JA.prototype.bytesPerElement=24,qe(JA,"StructArrayLayout4i4ui4i24");class eP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,h,p,m)}emplace(n,o,u,h,p,m,v){const w=10*n,E=5*n;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=h,this.float32[E+2]=p,this.float32[E+3]=m,this.float32[E+4]=v,n}}eP.prototype.bytesPerElement=20,qe(eP,"StructArrayLayout3i3f20");class tP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}tP.prototype.bytesPerElement=4,qe(tP,"StructArrayLayout1ul4");class Bd extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const h=2*n;return this.uint16[h+0]=o,this.uint16[h+1]=u,n}}Bd.prototype.bytesPerElement=4,qe(Bd,"StructArrayLayout2ui4");class nP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M,z){const j=this.length;return this.resize(j+1),this.emplace(j,n,o,u,h,p,m,v,w,E,C,P,M,z)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z,j){const V=20*n,$=10*n;return this.int16[V+0]=o,this.int16[V+1]=u,this.int16[V+2]=h,this.int16[V+3]=p,this.int16[V+4]=m,this.float32[$+3]=v,this.float32[$+4]=w,this.float32[$+5]=E,this.float32[$+6]=C,this.int16[V+14]=P,this.uint32[$+8]=M,this.uint16[V+18]=z,this.uint16[V+19]=j,n}}nP.prototype.bytesPerElement=40,qe(nP,"StructArrayLayout5i4f1i1ul2ui40");class ww extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=8*n;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=h,this.int16[E+4]=p,this.int16[E+5]=m,this.int16[E+6]=v,this.int16[E+7]=w,n}}ww.prototype.bytesPerElement=16,qe(ww,"StructArrayLayout3i2i2i16");class rP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=4*n,w=8*n;return this.float32[v+0]=o,this.float32[v+1]=u,this.float32[v+2]=h,this.int16[w+6]=p,this.int16[w+7]=m,n}}rP.prototype.bytesPerElement=16,qe(rP,"StructArrayLayout2f1f2i16");class iP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=12*n,v=3*n;return this.uint8[m+0]=o,this.uint8[m+1]=u,this.float32[v+1]=h,this.float32[v+2]=p,n}}iP.prototype.bytesPerElement=12,qe(iP,"StructArrayLayout2ub2f12");class Gs extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u)}emplace(n,o,u,h){const p=3*n;return this.uint16[p+0]=o,this.uint16[p+1]=u,this.uint16[p+2]=h,n}}Gs.prototype.bytesPerElement=6,qe(Gs,"StructArrayLayout3ui6");class sP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,Y,me,pe,ge,Pe){const Re=this.length;return this.resize(Re+1),this.emplace(Re,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,Y,me,pe,ge,Pe)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,Y,me,pe,ge,Pe,Re){const ze=30*n,Ge=15*n,Ke=60*n;return this.int16[ze+0]=o,this.int16[ze+1]=u,this.int16[ze+2]=h,this.float32[Ge+2]=p,this.float32[Ge+3]=m,this.uint16[ze+8]=v,this.uint16[ze+9]=w,this.uint32[Ge+5]=E,this.uint32[Ge+6]=C,this.uint32[Ge+7]=P,this.uint16[ze+16]=M,this.uint16[ze+17]=z,this.uint16[ze+18]=j,this.float32[Ge+10]=V,this.float32[Ge+11]=$,this.uint8[Ke+48]=Y,this.uint8[Ke+49]=me,this.uint8[Ke+50]=pe,this.uint32[Ge+13]=ge,this.int16[ze+28]=Pe,this.uint8[Ke+58]=Re,n}}sP.prototype.bytesPerElement=60,qe(sP,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class oP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,Y,me,pe,ge,Pe,Re,ze,Ge,Ke,it,Je,ut,Ct,ht,Mt,lt){const xt=this.length;return this.resize(xt+1),this.emplace(xt,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,Y,me,pe,ge,Pe,Re,ze,Ge,Ke,it,Je,ut,Ct,ht,Mt,lt)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,Y,me,pe,ge,Pe,Re,ze,Ge,Ke,it,Je,ut,Ct,ht,Mt,lt,xt){const Ot=20*n,ft=40*n,jt=80*n;return this.float32[Ot+0]=o,this.float32[Ot+1]=u,this.int16[ft+4]=h,this.int16[ft+5]=p,this.int16[ft+6]=m,this.int16[ft+7]=v,this.int16[ft+8]=w,this.int16[ft+9]=E,this.int16[ft+10]=C,this.int16[ft+11]=P,this.int16[ft+12]=M,this.uint16[ft+13]=z,this.uint16[ft+14]=j,this.uint16[ft+15]=V,this.uint16[ft+16]=$,this.uint16[ft+17]=Y,this.uint16[ft+18]=me,this.uint16[ft+19]=pe,this.uint16[ft+20]=ge,this.uint16[ft+21]=Pe,this.uint16[ft+22]=Re,this.uint16[ft+23]=ze,this.uint16[ft+24]=Ge,this.uint16[ft+25]=Ke,this.uint16[ft+26]=it,this.uint16[ft+27]=Je,this.uint32[Ot+14]=ut,this.float32[Ot+15]=Ct,this.float32[Ot+16]=ht,this.float32[Ot+17]=Mt,this.float32[Ot+18]=lt,this.uint8[jt+76]=xt,n}}oP.prototype.bytesPerElement=80,qe(oP,"StructArrayLayout2f9i15ui1ul4f1ub80");class Qg extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}Qg.prototype.bytesPerElement=4,qe(Qg,"StructArrayLayout1f4");class Bp extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=5*n;return this.float32[v+0]=o,this.float32[v+1]=u,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=m,n}}Bp.prototype.bytesPerElement=20,qe(Bp,"StructArrayLayout5f20");class aP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=7*n;return this.float32[E+0]=o,this.float32[E+1]=u,this.float32[E+2]=h,this.float32[E+3]=p,this.float32[E+4]=m,this.float32[E+5]=v,this.float32[E+6]=w,n}}aP.prototype.bytesPerElement=28,qe(aP,"StructArrayLayout7f28");class lP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=6*n;return this.uint32[3*n+0]=o,this.uint16[m+2]=u,this.uint16[m+3]=h,this.uint16[m+4]=p,n}}lP.prototype.bytesPerElement=12,qe(lP,"StructArrayLayout1ul3ui12");class Q0 extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}Q0.prototype.bytesPerElement=2,qe(Q0,"StructArrayLayout1ui2");class Y0 extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const h=2*n;return this.float32[h+0]=o,this.float32[h+1]=u,n}}Y0.prototype.bytesPerElement=8,qe(Y0,"StructArrayLayout2f8");class cP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$){const Y=this.length;return this.resize(Y+1),this.emplace(Y,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$)}emplace(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,Y){const me=16*n;return this.float32[me+0]=o,this.float32[me+1]=u,this.float32[me+2]=h,this.float32[me+3]=p,this.float32[me+4]=m,this.float32[me+5]=v,this.float32[me+6]=w,this.float32[me+7]=E,this.float32[me+8]=C,this.float32[me+9]=P,this.float32[me+10]=M,this.float32[me+11]=z,this.float32[me+12]=j,this.float32[me+13]=V,this.float32[me+14]=$,this.float32[me+15]=Y,n}}cP.prototype.bytesPerElement=64,qe(cP,"StructArrayLayout16f64");class Tw extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=10*n,C=5*n;return this.uint16[E+0]=o,this.uint16[E+1]=u,this.uint16[E+2]=h,this.uint16[E+3]=p,this.float32[C+2]=m,this.float32[C+3]=v,this.float32[C+4]=w,n}}Tw.prototype.bytesPerElement=20,qe(Tw,"StructArrayLayout4ui3f20");class uP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.int16[1*n+0]=o,n}}uP.prototype.bytesPerElement=2,qe(uP,"StructArrayLayout1i2");class hP extends mi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint8[1*n+0]=o,n}}hP.prototype.bytesPerElement=1,qe(hP,"StructArrayLayout1ub1");class SL extends K0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}SL.prototype.size=40;class dP extends nP{get(n){return new SL(this,n)}}qe(dP,"CollisionBoxArray");class IL extends K0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}IL.prototype.size=60;class CL extends sP{get(n){return new IL(this,n)}}qe(CL,"PlacedSymbolArray");class AL extends K0{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}AL.prototype.size=80;class PL extends oP{get(n){return new AL(this,n)}}qe(PL,"SymbolInstanceArray");class RL extends Qg{getoffsetX(n){return this.float32[1*n+0]}}qe(RL,"GlyphOffsetArray");class ML extends Tc{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}qe(ML,"SymbolLineVertexArray");class kL extends K0{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}kL.prototype.size=12;class DL extends lP{get(n){return new kL(this,n)}}qe(DL,"FeatureIndexArray");class OL extends Bd{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}qe(OL,"FillExtrusionCentroidArray");class LL extends K0{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}LL.prototype.size=8;class zL extends yh{get(n){return new LL(this,n)}}qe(zL,"FillExtrusionWallArray");const sK=kr([{name:"a_pos",components:2,type:"Int16"}],4),oK=kr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ei{constructor(n=[]){this.segments=n}_prepareSegment(n,o,u,h){let p=this.segments[this.segments.length-1];return n>Ei.MAX_VERTEX_ARRAY_LENGTH&&Pi(`Max vertices per segment is ${Ei.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!p||p.vertexLength+n>Ei.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(n,o,u,h){return this._prepareSegment(n,o.length,u.length,h)}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,u,h){return new Ei([{vertexOffset:n,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function NL(i,n){return 256*(i=Yn(Math.floor(i),0,255))+Yn(Math.floor(n),0,255)}Ei.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qe(Ei,"SegmentVector");const aK=kr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),lK=kr([{name:"a_dash",components:4,type:"Uint16"}]);class J0{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,o,u,h){this.ids.push(FL(n)),this.positions.push(o,u,h)}eachPosition(n,o){const u=FL(n);let h=0,p=this.ids.length-1;for(;h<p;){const m=h+p>>1;this.ids[m]>=u?p=m:h=m+1}for(;this.ids[h]===u;)o(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(n,o){const u=new Float64Array(n.ids),h=new Uint32Array(n.positions);return fP(u,h,0,u.length-1),o&&(o.add(u.buffer),o.add(h.buffer)),{ids:u,positions:h}}static deserialize(n){const o=new J0;let u;o.ids=n.ids,o.positions=n.positions;for(const h of o.ids)h!==u&&o.uniqueIds.push(h),u=h;return o.indexed=!0,o}}function FL(i){const n=+i;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:Eg(String(i))}function fP(i,n,o,u){for(;o<u;){const h=i[o+u>>1];let p=o-1,m=u+1;for(;;){do p++;while(i[p]<h);do m--;while(i[m]>h);if(p>=m)break;Ew(i,p,m),Ew(n,3*p,3*m),Ew(n,3*p+1,3*m+1),Ew(n,3*p+2,3*m+2)}m-o<u-m?(fP(i,n,o,m),o=m+1):(fP(i,n,m+1,u),u=m)}}function Ew(i,n,o){const u=i[n];i[n]=i[o],i[o]=u}qe(J0,"FeaturePositionMap");class vh{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}set(n,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Sw extends vh{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class Go extends vh{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class xh extends vh{constructor(n){super(n),this.current=[0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class pP extends vh{constructor(n){super(n),this.current=[0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class mP extends vh{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class BL extends vh{constructor(n){super(n),this.current=Ir.transparent.toRenderColor(null)}set(n,o,u){this.fetchUniformLocation(n,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const cK=new Float32Array(16);class ev extends vh{constructor(n){super(n),this.current=cK}set(n,o,u){if(this.fetchUniformLocation(n,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const uK=new Float32Array(9),hK=new Float32Array(4);class gP extends vh{constructor(n){super(n),this.current=hK}set(n,o,u){if(this.fetchUniformLocation(n,o)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function _P(i){return[NL(255*i.r,255*i.g),NL(255*i.b,255*i.a)]}class tv{constructor(n,o,u,h){this.value=n,this.uniformNames=o.map(p=>`u_${p}`),this.type=u,this.context=h}setUniform(n,o,u,h,p){const m=h.constantOr(this.value);o.set(n,p,m instanceof Ir?m.toRenderColor(this.context.lut):m)}getBinding(n,o){return this.type==="color"?new BL(n):new Go(n)}}class Yg{constructor(n,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,o,u,h,p){const m=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;m&&o.set(n,p,m)}getBinding(n,o){return o==="u_pattern"||o==="u_dash"?new mP(n):new Go(n)}}class bh{constructor(n,o,u,h){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(p=>({name:`a_${p}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,o,u,h,p,m,v){const w=this.paintVertexArray.length,E=this.expression.evaluate(new Mn(0,{brightness:m}),o,{},p,h,v);this.paintVertexArray.resize(n),this._setPaintValue(w,n,E,this.context)}updatePaintArray(n,o,u,h,p,m,v){const w=this.expression.evaluate({zoom:0,brightness:v},u,h,void 0,p);this._setPaintValue(n,o,w,this.context)}_setPaintValue(n,o,u,h){if(this.type==="color"){const p=_P(u.toRenderColor(h.lut));for(let m=n;m<o;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=n;p<o;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ec{constructor(n,o,u,h,p,m){this.expression=n,this.uniformNames=o.map(v=>`u_${v}_t`),this.type=u,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=o.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(n,o,u,h,p,m,v){const w=this.expression.evaluate(new Mn(this.context.zoom,{brightness:m}),o,{},p,h,v),E=this.expression.evaluate(new Mn(this.context.zoom+1,{brightness:m}),o,{},p,h,v),C=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(C,n,w,E,this.context)}updatePaintArray(n,o,u,h,p,m,v){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:v},u,h,void 0,p),E=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},u,h,void 0,p);this._setPaintValue(n,o,w,E,this.context)}_setPaintValue(n,o,u,h,p){if(this.type==="color"){const m=_P(u.toRenderColor(p.lut)),v=_P(u.toRenderColor(p.lut));for(let w=n;w<o;w++)this.paintVertexArray.emplace(w,m[0],m[1],v[0],v[1])}else{for(let m=n;m<o;m++)this.paintVertexArray.emplace(m,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,u,h,p){const m=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=Yn(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);o.set(n,p,v)}getBinding(n,o){return new Go(n)}}class jd{constructor(n,o,u,h,p){this.expression=n,this.layerId=p,this.paintVertexAttributes=(u==="array"?lK:aK).members;for(let m=0;m<o.length;++m);this.paintVertexArray=new h}populatePaintArray(n,o,u,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(p,n,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(n,o,u,h,p,m,v){this._setPaintValues(n,o,u.patterns&&u.patterns[this.layerId],m)}_setPaintValues(n,o,u,h){if(!h||!u)return;const p=h[u];if(!p)return;const{tl:m,br:v,pixelRatio:w}=p;for(let E=n;E<o;E++)this.paintVertexArray.emplace(E,m[0],m[1],v[0],v[1],w)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jp{constructor(n,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const h=[];for(const p in n.paint._values){const m=n.paint.get(p);if(!u(p)||!(m instanceof qs&&S(m.property.specification)))continue;const v=fK(p,n.type),w=m.value,E=m.property.specification.type,C=!!m.property.useIntegerZoom,P=p==="line-dasharray"||p.endsWith("pattern"),M=p==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||M)if(w.kind==="source"||M||P){const z=jL(p,E,"source");this.binders[p]=P?new jd(w,v,E,z,n.id):new bh(w,v,E,z),h.push(`/a_${p}`)}else{const z=jL(p,E,"composite");this.binders[p]=new Ec(w,v,E,C,o,z),h.push(`/z_${p}`)}else this.binders[p]=P?new Yg(w.value,v):new tv(w.value,v,E,o),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof bh||o instanceof Ec?o.maxValue:0}populatePaintArrays(n,o,u,h,p,m,v){for(const w in this.binders){const E=this.binders[w];E.context=this.context,(E instanceof bh||E instanceof Ec||E instanceof jd)&&E.populatePaintArray(n,o,u,h,p,m,v)}}setConstantPatternPositions(n){for(const o in this.binders){const u=this.binders[o];u instanceof Yg&&u.setConstantPatternPositions(n)}}updatePaintArrays(n,o,u,h,p,m,v,w){let E=!1;const C=Object.keys(n),P=C.length!==0,M=P?C:o.uniqueIds;this.context.lut=p.lut;for(const z in this.binders){const j=this.binders[z];if(j.context=this.context,(j instanceof bh||j instanceof Ec||j instanceof jd)&&(j.expression.isStateDependent===!0||j.expression.isLightConstant===!1)){const V=p.paint.get(z);j.expression=V.value;for(const $ of M){const Y=n[$.toString()];o.eachPosition($,(me,pe,ge)=>{const Pe=h.feature(me);j.updatePaintArray(pe,ge,Pe,Y,m,v,w)})}if(!P)for(const $ of u.uniqueIds){const Y=n[$.toString()];u.eachPosition($,(me,pe,ge)=>{const Pe=h.feature(me);j.updatePaintArray(pe,ge,Pe,Y,m,v,w)})}E=!0}}return E}defines(){const n=[];for(const o in this.binders){const u=this.binders[o];(u instanceof tv||u instanceof Yg)&&n.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof bh||u instanceof Ec||u instanceof jd)for(let h=0;h<u.paintVertexAttributes.length;h++)n.push(u.paintVertexAttributes[h].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof tv||u instanceof Yg||u instanceof Ec)for(const h of u.uniformNames)n.push(h)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof tv||h instanceof Yg||h instanceof Ec)for(const p of h.uniformNames)o.push({name:p,property:u,binding:h.getBinding(n,p)})}return o}setUniforms(n,o,u,h,p){for(const{name:m,property:v,binding:w}of u)this.binders[v].setUniform(n,w,p,h.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof bh||o instanceof Ec||o instanceof jd)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(n){for(const o in this.binders){const u=this.binders[o];(u instanceof bh||u instanceof Ec||u instanceof jd)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof bh||o instanceof Ec||o instanceof jd)&&o.destroy()}}}class Ud{constructor(n,o,u=()=>!0){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new jp(h,o,u);this.needsUpload=!1,this._featureMap=new J0,this._featureMapWithoutIds=new J0,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,o,u,h,p,m,v,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(n,o,h,p,m,v,w);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,u,h,p,m){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,o,v,h,p,m||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const dK={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function fK(i,n){return dK[i]||[i.replace(`${n}-`,"").replace(/-/g,"_")]}const pK={"line-pattern":{source:Fd,composite:Fd},"fill-pattern":{source:Fd,composite:Fd},"fill-extrusion-pattern":{source:Fd,composite:Fd},"line-dasharray":{source:xw,composite:xw}},mK={color:{source:Y0,composite:zd},number:{source:Qg,composite:Y0}};function jL(i,n,o){const u=pK[i];return u&&u[o]||mK[n][o]}qe(tv,"ConstantBinder"),qe(Yg,"PatternConstantBinder"),qe(bh,"SourceExpressionBinder"),qe(jd,"PatternCompositeBinder"),qe(Ec,"CompositeExpressionBinder"),qe(jp,"ProgramConfiguration",{omit:["_buffers"]}),qe(Ud,"ProgramConfigurationSet");const Wo=zt/Math.PI/2,yP=5,UL=6,gK=16383,Jg=64,vP=[Jg,32,16],Dl=-Wo,Ol=Wo;function e_(i,n,o,u=Wo){return o=sr(o),[i*Math.sin(o)*u,-n*u,i*Math.cos(o)*u]}function Up(i,n,o){return e_(Math.cos(sr(i)),Math.sin(sr(i)),n,o)}const t_=63710088e-1,xP=2*Math.PI*t_;class Er{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Er(cc(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,u=this.lat*o,h=n.lat*o,p=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((n.lng-this.lng)*o);return t_*Math.acos(Math.min(p,1))}toBounds(n=0){const o=360*n/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Vd({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(n){return Up(this.lat,this.lng,Wo+n*Wo/t_)}static convert(n){if(n instanceof Er)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Er(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Er(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Vd{constructor(n,o){if(n)if(o)this.setSouthWest(n).setNorthEast(o);else if(n.length===4){const u=n;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=n;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(n){return this._ne=n instanceof Er?new Er(n.lng,n.lat):Er.convert(n),this}setSouthWest(n){return this._sw=n instanceof Er?new Er(n.lng,n.lat):Er.convert(n),this}extend(n){const o=this._sw,u=this._ne;let h,p;if(n instanceof Er)h=n,p=n;else{if(!(n instanceof Vd))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Vd.convert(n)):this.extend(Er.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(Er.convert(n)):this;if(h=n._sw,p=n._ne,!h||!p)return this}return o||u?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new Er(h.lng,h.lat),this._ne=new Er(p.lng,p.lat)),this}getCenter(){return new Er((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Er(this.getWest(),this.getNorth())}getSouthEast(){return new Er(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:u}=Er.convert(n);let h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(n){return!n||n instanceof Vd?n:new Vd(n)}}var VL={};(function(i,n){(function(o){function u(p,m,v){var w=h(256*p,256*(m=Math.pow(2,v)-m-1),v),E=h(256*(p+1),256*(m+1),v);return w[0]+","+w[1]+","+E[0]+","+E[1]}function h(p,m,v){var w=2*Math.PI*6378137/256/Math.pow(2,v);return[p*w-2*Math.PI*6378137/2,m*w-2*Math.PI*6378137/2]}o.getURL=function(p,m,v,w,E,C){return C=C||{},p+"?"+["bbox="+u(v,w,E),"format="+(C.format||"image/png"),"service="+(C.service||"WMS"),"version="+(C.version||"1.1.1"),"request="+(C.request||"GetMap"),"srs="+(C.srs||"EPSG:3857"),"width="+(C.width||256),"height="+(C.height||256),"layers="+m].join("&")},o.getTileBBox=u,o.getMercCoords=h,Object.defineProperty(o,"__esModule",{value:!0})})(n)})(0,VL);var _K=VL;class Vp{constructor(n,o,u){this.z=n,this.x=o,this.y=u,this.key=n_(0,n,n,o,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o){const u=_K.getTileBBox(this.x,this.y,this.z),h=function(p,m,v){let w,E="";for(let C=p;C>0;C--)w=1<<C-1,E+=(m&w?1:0)+(v&w?2:0);return E}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class $L{constructor(n,o){this.wrap=n,this.canonical=o,this.key=n_(n,o.z,o.z,o.x,o.y)}}class ws{constructor(n,o,u,h,p){this.overscaledZ=n,this.wrap=o,this.canonical=new Vp(u,+h,+p),this.key=o===0&&n===u?this.canonical.key:n_(o,n,u,h,p)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new ws(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ws(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return n_(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-n;return n_(this.wrap*+o,n,n,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new ws(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new ws(o,this.wrap,o,u,h),new ws(o,this.wrap,o,u+1,h),new ws(o,this.wrap,o,u,h+1),new ws(o,this.wrap,o,u+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new ws(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new ws(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new $L(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function n_(i,n,o,u,h){const p=1<<Math.min(o,22);let m=p*(h%p)+u%p;return i&&o<22&&(m+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-o)))),16*(32*m+o)+(n-o)}const yK=[i=>{let n=i.canonical.x-1,o=i.wrap;return n<0&&(n=(1<<i.canonical.z)-1,o--),new ws(i.overscaledZ,o,i.canonical.z,n,i.canonical.y)},i=>{let n=i.canonical.x+1,o=i.wrap;return n===1<<i.canonical.z&&(n=0,o++),new ws(i.overscaledZ,o,i.canonical.z,n,i.canonical.y)},i=>new ws(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new ws(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];qe(Vp,"CanonicalTileID"),qe(ws,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const vK=0,xK=25.5;function bP(i){return xP*Math.cos(i*Math.PI/180)}function mu(i){return(180+i)/360}function gu(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Ho(i,n){return i/bP(n)}function ya(i){return 360*i-180}function eo(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function qL(i,n){return i*bP(eo(n))}const Zi=85.051129;function GL(i){return Math.cos(sr(Yn(i,-Zi,Zi)))}function $p(i,n){const o=Yn(n,vK,xK),u=Math.pow(2,o);return GL(i)*xP/(512*u)}function WL(i){return 1/Math.cos(i*Math.PI/180)}function Iw(i,n=0){const o=Math.exp(Math.PI*(1-(i.y+n/zt)/(1<<i.z)*2));return 80150034*o/(o*o+1)/zt/(1<<i.z)}class To{constructor(n,o,u=0){this.x=+n,this.y=+o,this.z=+u}static fromLngLat(n,o=0){const u=Er.convert(n);return new To(mu(u.lng),gu(u.lat),Ho(o,u.lat))}toLngLat(){return new Er(ya(this.x),eo(this.y))}toAltitude(){return qL(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xP*WL(eo(this.y))}}function wP(i,n,o,u,h,p,m,v,w){const E=(n+u)/2,C=(o+h)/2,P=new Ft(E,C);v(P),function(M,z,j,V,$,Y){const me=j-$,pe=V-Y;return Math.abs((V-z)*me-(j-M)*pe)/Math.hypot(me,pe)}(P.x,P.y,p.x,p.y,m.x,m.y)>=w?(wP(i,n,o,E,C,p,P,v,w),wP(i,E,C,u,h,P,m,v,w)):i.push(m)}function HL(i,n,o){let u=i[0],h=u.x,p=u.y;n(u);const m=[u];for(let v=1;v<i.length;v++){const w=i[v],{x:E,y:C}=w;n(w),wP(m,h,p,E,C,u,w,n,o),h=E,p=C,u=w}return m}function TP(i,n,o,u){if(u(n,o)){const h=n.add(o)._mult(.5);TP(i,n,h,u),TP(i,h,o,u)}else i.push(o)}function bK(i,n){let o=i[0];const u=[o];for(let h=1;h<i.length;h++){const p=i[h];TP(u,o,p,n),o=p}return u}const EP=Math.pow(2,14)-1,ZL=-EP-1;function wK(i,n){const o=Math.round(i.x*n),u=Math.round(i.y*n);return i.x=Yn(o,ZL,EP),i.y=Yn(u,ZL,EP),(o<i.x||o>i.x+1||u<i.y||u>i.y+1)&&Pi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Sc(i,n,o){const u=i.loadGeometry(),h=i.extent,p=zt/h;if(n&&o&&o.projection.isReprojectedInTileSpace){const m=1<<n.z,{scale:v,x:w,y:E,projection:C}=o,P=M=>{const z=ya((n.x+M.x/h)/m),j=eo((n.y+M.y/h)/m),V=C.project(z,j);M.x=(V.x*v-w)*h,M.y=(V.y*v-E)*h};for(let M=0;M<u.length;M++)if(i.type!==1)u[M]=HL(u[M],P,1);else{const z=[];for(const j of u[M])j.x<0||j.x>=h||j.y<0||j.y>=h||(P(j),z.push(j));u[M]=z}}for(const m of u)for(const v of m)wK(v,p);return u}function wh(i,n){return{type:i.type,id:i.id,properties:i.properties,geometry:n?Sc(i):[]}}function Cw(i,n,o,u,h){i.emplaceBack(2*n+(u+1)/2,2*o+(h+1)/2)}function Aw(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class SP{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Tc,this.indexArray=new Gs,this.segments=new Ei,this.programConfigurations=new Ud(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(n,o){}populate(n,o,u,h){const p=this.layers[0],m=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:P,sourceLayerIndex:M}of n){const z=this.layers[0]._featureFilter.needGeometry,j=wh(E,z);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom),j,u))continue;const V=v?v.evaluate(j,{},u):void 0,$={id:C,properties:E.properties,type:E.type,sourceLayerIndex:M,index:P,geometry:z?j.geometry:Sc(E,u,h),patterns:{},sortKey:V};m.push($)}v&&m.sort((E,C)=>E.sortKey-C.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new bw,w=h.projection);for(const E of m){const{geometry:C,index:P,sourceLayerIndex:M}=E,z=n[P].feature;this.addFeature(E,C,P,o.availableImages,u,w,o.brightness),o.featureIndex.insert(z,C,P,M,this.index)}}update(n,o,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,u,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,sK.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,oK.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,o,u,h,p,m,v){for(const w of o)for(const E of w){const C=E.x,P=E.y;if(C<0||C>=zt||P<0||P>=zt)continue;if(m){const j=m.projectTilePoint(C,P,p),V=m.upVector(p,C,P),$=this.globeExtVertexArray;Aw($,j,V),Aw($,j,V),Aw($,j,V),Aw($,j,V)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),z=M.vertexLength;Cw(this.layoutVertexArray,C,P,-1,-1),Cw(this.layoutVertexArray,C,P,1,-1),Cw(this.layoutVertexArray,C,P,1,1),Cw(this.layoutVertexArray,C,P,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},h,p,v)}}function IP(i,n){for(let o=0;o<i.length;o++)if($d(n,i[o]))return!0;for(let o=0;o<n.length;o++)if($d(i,n[o]))return!0;return!!CP(i,n)}function TK(i,n,o){return!!$d(i,n)||!!AP(n,i,o)}function XL(i,n){if(i.length===1)return QL(n,i[0]);for(let o=0;o<n.length;o++){const u=n[o];for(let h=0;h<u.length;h++)if($d(i,u[h]))return!0}for(let o=0;o<i.length;o++)if(QL(n,i[o]))return!0;for(let o=0;o<n.length;o++)if(CP(i,n[o]))return!0;return!1}function EK(i,n,o){if(i.length>1){if(CP(i,n))return!0;for(let u=0;u<n.length;u++)if(AP(n[u],i,o))return!0}for(let u=0;u<i.length;u++)if(AP(i[u],n,o))return!0;return!1}function CP(i,n){if(i.length===0||n.length===0)return!1;for(let o=0;o<i.length-1;o++){const u=i[o],h=i[o+1];for(let p=0;p<n.length-1;p++)if(SK(u,h,n[p],n[p+1]))return!0}return!1}function SK(i,n,o,u){return la(i,o,u)!==la(n,o,u)&&la(i,n,o)!==la(i,n,u)}function AP(i,n,o){const u=o*o;if(n.length===1)return i.distSqr(n[0])<u;for(let h=1;h<n.length;h++)if(KL(i,n[h-1],n[h])<u)return!0;return!1}function KL(i,n,o){const u=n.distSqr(o);if(u===0)return i.distSqr(n);const h=((i.x-n.x)*(o.x-n.x)+(i.y-n.y)*(o.y-n.y))/u;return i.distSqr(h<0?n:h>1?o:o.sub(n)._mult(h)._add(n))}function QL(i,n){let o,u,h,p=!1;for(let m=0;m<i.length;m++){o=i[m];for(let v=0,w=o.length-1;v<o.length;w=v++)u=o[v],h=o[w],u.y>n.y!=h.y>n.y&&n.x<(h.x-u.x)*(n.y-u.y)/(h.y-u.y)+u.x&&(p=!p)}return p}function $d(i,n){let o=!1;for(let u=0,h=i.length-1;u<i.length;h=u++){const p=i[u],m=i[h];p.y>n.y!=m.y>n.y&&n.x<(m.x-p.x)*(n.y-p.y)/(m.y-p.y)+p.x&&(o=!o)}return o}function YL(i,n,o,u,h){for(const m of i)if(n<=m.x&&o<=m.y&&u>=m.x&&h>=m.y)return!0;const p=[new Ft(n,o),new Ft(n,h),new Ft(u,h),new Ft(u,o)];if(i.length>2){for(const m of p)if($d(i,m))return!0}for(let m=0;m<i.length-1;m++)if(IK(i[m],i[m+1],p))return!0;return!1}function IK(i,n,o){const u=o[0],h=o[2];if(i.x<u.x&&n.x<u.x||i.x>h.x&&n.x>h.x||i.y<u.y&&n.y<u.y||i.y>h.y&&n.y>h.y)return!1;const p=la(i,n,o[0]);return p!==la(i,n,o[1])||p!==la(i,n,o[2])||p!==la(i,n,o[3])}function r_(i,n,o,u,h,p){let m=n.y-i.y,v=i.x-n.x;if(p=p||0){const w=m*m+v*v;if(w===0)return!0;const E=Math.sqrt(w);m/=E,v/=E}return!((o.x-i.x)*m+(o.y-i.y)*v-p<0||(u.x-i.x)*m+(u.y-i.y)*v-p<0||(h.x-i.x)*m+(h.y-i.y)*v-p<0)}function PP(i,n,o,u,h,p,m){return!(r_(i,n,u,h,p,m)||r_(n,o,u,h,p,m)||r_(o,i,u,h,p,m)||r_(u,h,i,n,o,m)||r_(h,p,i,n,o,m)||r_(p,u,i,n,o,m))}function i_(i,n,o){const u=n.paint.get(i).value;return u.kind==="constant"?u.value:o.programConfigurations.get(n.id).getMaxValue(i)}function Pw(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function JL(i,n,o,u,h){if(!n[0]&&!n[1])return i;const p=Ft.convert(n)._mult(h);o==="viewport"&&p._rotate(-u);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(p));return m}function ez(i,n,o,u){const h=Ft.convert(i)._mult(u);return n==="viewport"&&h._rotate(-o),h}let tz,nz;qe(SP,"CircleBucket",{omit:["layers"]});class RP{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,u){const h=a.$.dot(o,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/h;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,u[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(n,o,u){if(a.$.equals(this.pos,n)||o===0)return u[0]=u[1]=u[2]=0,!1;const[h,p,m]=this.dir,v=this.pos[0]-n[0],w=this.pos[1]-n[1],E=this.pos[2]-n[2],C=h*h+p*p+m*m,P=2*(v*h+w*p+E*m),M=P*P-4*C*(v*v+w*w+E*E-o*o);if(M<0){const z=Math.max(-P/2,0),j=v+h*z,V=w+p*z,$=E+m*z,Y=Math.hypot(j,V,$);return u[0]=j*o/Y,u[1]=V*o/Y,u[2]=$*o/Y,!1}{const z=(-P-Math.sqrt(M))/(2*C);if(z<0){const j=Math.hypot(v,w,E);return u[0]=v*o/j,u[1]=w*o/j,u[2]=E*o/j,!1}return u[0]=v+h*z,u[1]=w+p*z,u[2]=E+m*z,!0}}}class MP{constructor(n,o,u,h,p){this.TL=n,this.TR=o,this.BR=u,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(n,o,u){const h=[-1,1,1],p=[1,1,1],m=[1,-1,1],v=[-1,-1,1],w=a.$.transformMat4(h,h,n),E=a.$.transformMat4(p,p,n),C=a.$.transformMat4(m,m,n),P=a.$.transformMat4(v,v,n);return new MP(w,E,C,P,o/u)}}function nv(i,n,o){let u=1/0,h=-1/0;const p=[];for(const m of i){a.$.sub(p,m,n);const v=a.$.dot(p,o);u=Math.min(u,v),h=Math.max(h,v)}return[u,h]}function rz(i,n){let o=!0;for(let u=0;u<i.planes.length;u++){const h=i.planes[u];let p=0;for(let m=0;m<n.length;m++)p+=a.$.dot(h,n[m])+h[3]>=0;if(p===0)return 0;p!==n.length&&(o=!1)}return o?2:1}function iz(i,n){for(const o of i.projections){const u=nv(n,i.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function sz(i,n){let o=0;const u=[0,0,0,0];for(let h=0;h<i.length;h++)u[0]=i[h][0],u[1]=i[h][1],u[2]=i[h][2],u[3]=1,a.aB.dot(u,n)>=0&&o++;return o}class kP{constructor(n,o){this.points=n||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=gi.fromPoints(this.points),this.projections=[],this.frustumEdges=[a.$.sub([],this.points[2],this.points[3]),a.$.sub([],this.points[0],this.points[3]),a.$.sub([],this.points[4],this.points[0]),a.$.sub([],this.points[5],this.points[1]),a.$.sub([],this.points[6],this.points[2]),a.$.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],p=[u[2],0,-u[0]];this.projections.push({axis:h,projection:nv(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:nv(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(n,o,u,h){const p=Math.pow(2,u),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const C=a.aB.transformMat4([],E,n),P=1/C[3]/o*p;return a.aB.mul(C,C,[P,P,h?1/C[3]:P,P])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const C=a.$.sub([],m[E[0]],m[E[1]]),P=a.$.sub([],m[E[2]],m[E[1]]),M=a.$.normalize([],a.$.cross([],C,P)),z=-a.$.dot(M,m[E[1]]);return M.concat(z)}),w=[];for(let E=0;E<m.length;E++)w.push([m[E][0],m[E][1],m[E][2]]);return new kP(w,v)}intersectsPrecise(n,o,u){for(let h=0;h<o.length;h++)if(!sz(n,o[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!sz(n,this.planes[h]))return 0;for(const h of u)for(const p of this.frustumEdges){const m=a.$.cross([],h,p),v=a.$.length(m);if(v===0)continue;a.$.scale(m,m,1/v);const w=nv(this.points,this.points[0],m),E=nv(n,this.points[0],m);if(w[0]>E[1]||E[0]>w[1])return 0}return 1}containsPoint(n){for(const o of this.planes){const u=o[3];if(a.$.dot([o[0],o[1],o[2]],n)+u<0)return!1}return!0}}class gi{static fromPoints(n){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of n)a.$.min(o,o,h),a.$.max(u,u,h);return new gi(o,u)}static fromTileIdAndHeight(n,o,u){const h=1<<n.canonical.z,p=n.canonical.x,m=n.canonical.y;return new gi([p/h,m/h,o],[(p+1)/h,(m+1)/h,u])}static applyTransform(n,o){const u=n.getCorners();for(let h=0;h<u.length;++h)a.$.transformMat4(u[h],u[h],o);return gi.fromPoints(u)}static applyTransformFast(n,o){const u=[o[12],o[13],o[14]],h=[...u];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const v=o[4*m+p],w=v*n.min[m],E=v*n.max[m];u[p]+=Math.min(w,E),h[p]+=Math.max(w,E)}return new gi(u,h)}static projectAabbCorners(n,o){const u=n.getCorners();for(let h=0;h<u.length;++h)a.$.transformMat4(u[h],u[h],o);return u}constructor(n,o){this.min=n,this.max=o,this.center=a.$.scale([],a.$.add([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],u=a.$.clone(this.min),h=a.$.clone(this.max);for(let p=0;p<o.length;p++)u[p]=o[p]?this.min[p]:this.center[p],h[p]=o[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new gi(u,h)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?rz(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?rz(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,o){return o||this.intersects(n)?iz(n,this.getCorners()):0}intersectsPreciseFlat(n,o){return o||this.intersectsFlat(n)?iz(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let o=0;o<3;++o)if(this.min[o]>n.max[o]||n.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n.min[o]),this.max[o]=Math.max(this.max[o],n.max[o])}encapsulatePoint(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n[o]),this.max[o]=Math.max(this.max[o],n[o])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}qe(gi,"Aabb");const CK=kr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rw}=CK,oz=kr([{name:"a_pos_3",components:3,type:"Int16"}]);var rv=kr([{name:"a_pos",type:"Int16",components:2}]);function Mw(i){return i*Wo/t_}const AK=[new gi([Dl,Dl,Dl],[Ol,Ol,Ol]),new gi([Dl,Dl,Dl],[0,0,Ol]),new gi([0,Dl,Dl],[Ol,0,Ol]),new gi([Dl,0,Dl],[0,Ol,Ol]),new gi([0,0,Dl],[Ol,Ol,Ol])];function az(i,n,o,u=!0){const h=a.$.scale([],i._camera.position,i.worldSize),p=[n,o,1,1];a.aB.transformMat4(p,p,i.pixelMatrixInverse),a.aB.scale(p,p,1/p[3]);const m=a.$.sub([],p,h),v=a.$.normalize([],m),w=i.globeMatrix,E=[w[12],w[13],w[14]],C=a.$.sub([],E,h),P=a.$.length(C),M=a.$.normalize([],C),z=i.worldSize/(2*Math.PI),j=a.$.dot(M,v),V=Math.asin(z/P);if(V<Math.acos(j)){if(!u)return null;const Je=[],ut=[];a.$.scale(Je,v,P/j),a.$.normalize(ut,a.$.sub(ut,Je,C)),a.$.normalize(v,a.$.add(v,C,a.$.scale(v,ut,Math.tan(V)*P)))}const $=[];new RP(h,v).closestPointOnSphere(E,z,$);const Y=a.$.normalize([],R(w,0)),me=a.$.normalize([],R(w,1)),pe=a.$.normalize([],R(w,2)),ge=a.$.dot(Y,$),Pe=a.$.dot(me,$),Re=a.$.dot(pe,$),ze=oo(Math.asin(-Pe/z));let Ge=oo(Math.atan2(ge,Re));Ge=i.center.lng+function(Je,ut){const Ct=(ut-Je+180)%360-180;return Ct<-180?Ct+360:Ct}(i.center.lng,Ge);const Ke=mu(Ge),it=Yn(gu(ze),0,1);return new To(Ke,it)}class PK{constructor(n,o,u){this.a=a.$.sub([],n,u),this.b=a.$.sub([],o,u),this.center=u;const h=a.$.normalize([],this.a),p=a.$.normalize([],this.b);this.angle=Math.acos(a.$.dot(h,p))}}function DP(i,n){if(i.angle===0)return null;let o;return o=i.a[n]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[n]/i.a[n]/Math.sin(i.angle)-1/Math.tan(i.angle)),o<0||o>1?null:function(u,h,p,m){const v=Math.sin(p);return u*(Math.sin((1-m)*p)/v)+h*(Math.sin(m*p)/v)}(i.a[n],i.b[n],i.angle,Yn(o,0,1))+i.center[n]}function _u(i){if(i.z<=1)return AK[i.z+2*i.y+i.x];const n=OP(kw(i));return gi.fromPoints(n)}function Th(i,n,o){return a.$.scale(i,i,1-o),a.$.scaleAndAdd(i,i,n,o)}function lz(i,n){const o=Eh(n.zoom);if(o===0)return _u(i);const u=kw(i),h=OP(u),p=mu(u.getWest())*n.worldSize,m=mu(u.getEast())*n.worldSize,v=gu(u.getNorth())*n.worldSize,w=gu(u.getSouth())*n.worldSize,E=[p,v,0],C=[m,v,0],P=[p,w,0],M=[m,w,0],z=a.ae.invert([],n.globeMatrix);return a.$.transformMat4(E,E,z),a.$.transformMat4(C,C,z),a.$.transformMat4(P,P,z),a.$.transformMat4(M,M,z),h[0]=Th(h[0],P,o),h[1]=Th(h[1],M,o),h[2]=Th(h[2],C,o),h[3]=Th(h[3],E,o),gi.fromPoints(h)}function cz(i,n,o){for(const u of i)a.$.transformMat4(u,u,n),a.$.scale(u,u,o)}function uz(i,n,o,u){const h=n/i.worldSize,p=i.globeMatrix;if(o.z<=1){const Ke=_u(o).getCorners();return cz(Ke,p,h),gi.fromPoints(Ke)}const m=kw(o,u),v=OP(m,Wo+Mw(i._tileCoverLift));cz(v,p,h);const w=Number.MAX_VALUE,E=[-w,-w,-w],C=[w,w,w];if(m.contains(i.center)){for(const Je of v)a.$.min(C,C,Je),a.$.max(E,E,Je);E[2]=0;const Ke=i.point,it=[Ke.x*h,Ke.y*h,0];return a.$.min(C,C,it),a.$.max(E,E,it),new gi(C,E)}if(i._tileCoverLift>0){for(const Ke of v)a.$.min(C,C,Ke),a.$.max(E,E,Ke);return new gi(C,E)}const P=[p[12]*h,p[13]*h,p[14]*h],M=m.getCenter(),z=Yn(i.center.lat,-Zi,Zi),j=Yn(M.lat,-Zi,Zi),V=mu(i.center.lng),$=gu(z);let Y=V-mu(M.lng);const me=$-gu(j);Y>.5?Y-=1:Y<-.5&&(Y+=1);let pe=0;if(Math.abs(Y)>Math.abs(me))pe=Y>=0?1:3;else{pe=me>=0?0:2;const Ke=[p[4]*h,p[5]*h,p[6]*h],it=-Math.sin(sr(me>=0?m.getSouth():m.getNorth()))*Wo;a.$.scaleAndAdd(P,P,Ke,it)}const ge=v[pe],Pe=v[(pe+1)%4],Re=new PK(ge,Pe,P),ze=[DP(Re,0)||ge[0],DP(Re,1)||ge[1],DP(Re,2)||ge[2]],Ge=Eh(i.zoom);if(Ge>0){const Ke=function({x:Je,y:ut,z:Ct},ht,Mt,lt,xt){const Ot=1/(1<<Ct);let ft=Je*Ot,jt=ft+Ot,Dt=ut*Ot,Pt=Dt+Ot,vn=0;const mn=(ft+jt)/2-lt;return mn>.5?vn=-1:mn<-.5&&(vn=1),ft=((ft+vn)*ht-(lt*=ht))*Mt+lt,jt=((jt+vn)*ht-lt)*Mt+lt,Dt=(Dt*ht-(xt*=ht))*Mt+xt,Pt=(Pt*ht-xt)*Mt+xt,[[ft,Pt,0],[jt,Pt,0],[jt,Dt,0],[ft,Dt,0]]}(o,n,i._pixelsPerMercatorPixel,V,$);for(let Je=0;Je<v.length;Je++)Th(v[Je],Ke[Je],Ge);const it=a.$.add([],Ke[pe],Ke[(pe+1)%4]);a.$.scale(it,it,.5),Th(ze,it,Ge)}for(const Ke of v)a.$.min(C,C,Ke),a.$.max(E,E,Ke);return C[2]=Math.min(ge[2],Pe[2]),a.$.min(C,C,ze),a.$.max(E,E,ze),new gi(C,E)}function kw({x:i,y:n,z:o},u=!1){const h=1/(1<<o),p=new Er(ya(i*h),n===(1<<o)-1&&u?-90:eo((n+1)*h)),m=new Er(ya((i+1)*h),n===0&&u?90:eo(n*h));return new Vd(p,m)}function OP(i,n=Wo){const o=sr(i.getNorth()),u=sr(i.getSouth()),h=Math.cos(o),p=Math.cos(u),m=Math.sin(o),v=Math.sin(u),w=i.getWest(),E=i.getEast();return[e_(p,v,w,n),e_(p,v,E,n),e_(h,m,E,n),e_(h,m,w,n)]}function iv(i,n,o,u){const h=1<<o.z,p=(i/zt+o.x)/h;return Up(eo((n/zt+o.y)/h),ya(p),u)}function Dw({min:i,max:n}){return gK/Math.max(n[0]-i[0],n[1]-i[1],n[2]-i[2])}const hz=new Float64Array(16);function sv(i){const n=Dw(i),o=a.ae.fromScaling(hz,[n,n,n]);return a.ae.translate(o,o,a.$.negate([],i.min))}function LP(i){const n=a.ae.fromTranslation(hz,i.min),o=1/Dw(i);return a.ae.scale(n,n,[o,o,o])}function zP(i){const n=zt/(2*Math.PI);return i/(2*Math.PI)/n}function dz(i,n){return zt/(512*Math.pow(2,i))*Dw(_u(n))}function fz(i,n,o,u,h){const p=zP(o),m=[i,n,-o/(2*Math.PI)],v=a.ae.identity(new Float64Array(16));return a.ae.translate(v,v,m),a.ae.scale(v,v,[p,p,p]),a.ae.rotateX(v,v,sr(-h)),a.ae.rotateY(v,v,sr(-u)),v}function Eh(i){return aa(yP,UL,i)}function pz(i,n){const o=Up(n.lat,n.lng),u=function(p){const m=Up(p._center.lat,p._center.lng),v=a.$.fromValues(0,1,0);let w=a.$.cross([],v,m);const E=a.ae.fromRotation([],-p.angle,m);w=a.$.transformMat4(w,w,E),a.ae.fromRotation(E,-p._pitch,w);const C=a.$.normalize([],m);return a.$.scale(C,C,Mw(p.cameraToCenterDistance/p.pixelsPerMeter)),a.$.transformMat4(C,C,E),a.$.add([],m,C)}(i),h=a.$.subtract([],u,o);return a.$.angle(h,o)}function NP(i,n){return pz(i,n)>Math.PI/2*1.01}const mz=sr(85),RK=Math.cos(mz),MK=Math.sin(mz),kK=a.ae.create(),gz=i=>{const n=[];return i.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function _z(i,n,o,u,h,p,m,v,w){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(w*=i.pixelToTileUnitsFactor);const E=i.tileID.canonical,C=o.projection.upVectorScale(E,o.center.lat,o.worldSize).metersToTile;for(const P of n)for(const M of P){const z=M.add(v),j=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(z.x,z.y,!0):0,V=o.projection.projectTilePoint(z.x,z.y,E);if(j>0){const pe=o.projection.upVector(E,z.x,z.y);V.x+=pe[0]*C*j,V.y+=pe[1]*C*j,V.z+=pe[2]*C*j}const $=p?z:DK(V.x,V.y,V.z,u),Y=p?i.tilespaceRays.map(pe=>LK(pe,j)):i.queryGeometry.screenGeometry,me=a.aB.transformMat4([],[V.x,V.y,V.z,1],u);if(!m&&p?w*=me[3]/o.cameraToCenterDistance:m&&!p&&(w*=o.cameraToCenterDistance/me[3]),p){const pe=eo((M.y/zt+E.y)/(1<<E.z));w/=o.projection.pixelsPerMeter(pe,1)/Ho(1,pe)}if(TK(Y,$,w))return!0}return!1}function DK(i,n,o,u){const h=a.aB.transformMat4([],[i,n,o,1],u);return new Ft(h[0]/h[3],h[1]/h[3])}const yz=a.$.fromValues(0,0,0),OK=a.$.fromValues(0,0,1);function LK(i,n){const o=a.$.create();return yz[2]=n,i.intersectsPlane(yz,OK,o),new Ft(o[0],o[1])}class vz extends SP{}function xz(i,{width:n,height:o},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*o*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*o*u);return i.width=n,i.height=o,i.data=h,i}function bz(i,n,o){const{width:u,height:h}=n;u===i.width&&h===i.height||(FP(i,n,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,u),height:Math.min(i.height,h)},o,null),i.width=u,i.height=h,i.data=n.data)}function FP(i,n,o,u,h,p,m,v){if(h.width===0||h.height===0)return n;if(h.width>i.width||h.height>i.height||o.x>i.width-h.width||o.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||u.x>n.width-h.width||u.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const w=i.data,E=n.data,C=p===4&&v;for(let P=0;P<h.height;P++){const M=((o.y+P)*i.width+o.x)*p,z=((u.y+P)*n.width+u.x)*p;if(C)for(let j=0;j<h.width;j++){const V=M+j*p+3,$=z+j*p;E[$+0]=255,E[$+1]=255,E[$+2]=255,E[$+3]=w[V]}else if(m)for(let j=0;j<h.width;j++){const V=M+j*p,$=z+j*p,Y=w[V+3],me=new Ir(w[V+0]/255*Y,w[V+1]/255*Y,w[V+2]/255*Y,Y).toRenderColor(m).toArray();E[$+0]=me[0],E[$+1]=me[1],E[$+2]=me[2],E[$+3]=me[3]}else for(let j=0;j<h.width*p;j++)E[z+j]=w[M+j]}return n}qe(vz,"HeatmapBucket",{omit:["layers"]});class qd{constructor(n,o){xz(this,n,1,o)}resize(n){bz(this,new qd(n),1)}clone(){return new qd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,h,p){FP(n,o,u,h,p,1,null)}}class il{constructor(n,o){xz(this,n,4,o)}resize(n){bz(this,new il(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new il({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,h,p,m,v){FP(n,o,u,h,p,4,m,v)}}class wz{constructor(n,o){this.width=n.width,this.height=n.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}let Tz,Ez,Sz,Iz;function ov(i){const n={},o=i.resolution||256,u=i.clips?i.clips.length:1,h=i.image||new il({width:o,height:u}),p=(m,v,w)=>{n[i.evaluationKey]=w;const E=i.expression.evaluate(n);E&&(h.data[m+v+0]=Math.floor(255*E.r/E.a),h.data[m+v+1]=Math.floor(255*E.g/E.a),h.data[m+v+2]=Math.floor(255*E.b/E.a),h.data[m+v+3]=Math.floor(255*E.a))};if(i.clips)for(let m=0,v=0;m<u;++m,v+=4*o)for(let w=0,E=0;w<o;w++,E+=4){const C=w/(o-1),{start:P,end:M}=i.clips[m];p(v,E,P*(1-C)+M*C)}else for(let m=0,v=0;m<o;m++,v+=4)p(0,v,m/(o-1));return h}qe(qd,"AlphaImage"),qe(il,"RGBAImage");const zK=kr([{name:"a_pos",components:2,type:"Int16"}],4),{members:NK}=zK;function av(i,n,o=2){const u=n&&n.length,h=u?n[0]*o:i.length;let p=Cz(i,0,h,o,!0);const m=[];if(!p||p.next===p.prev)return m;let v,w,E;if(u&&(p=function(C,P,M,z){const j=[];for(let V=0,$=P.length;V<$;V++){const Y=Cz(C,P[V]*z,V<$-1?P[V+1]*z:C.length,z,!1);Y===Y.next&&(Y.steiner=!0),j.push(GK(Y))}j.sort(VK);for(let V=0;V<j.length;V++)M=$K(j[V],M);return M}(i,n,p,o)),i.length>80*o){v=1/0,w=1/0;let C=-1/0,P=-1/0;for(let M=o;M<h;M+=o){const z=i[M],j=i[M+1];z<v&&(v=z),j<w&&(w=j),z>C&&(C=z),j>P&&(P=j)}E=Math.max(C-v,P-w),E=E!==0?32767/E:0}return lv(p,m,o,v,w,E,0),m}function Cz(i,n,o,u,h){let p;if(h===function(m,v,w,E){let C=0;for(let P=v,M=w-E;P<w;P+=E)C+=(m[M]-m[P])*(m[P+1]+m[M+1]),M=P;return C}(i,n,o,u)>0)for(let m=n;m<o;m+=u)p=Rz(m/u|0,i[m],i[m+1],p);else for(let m=o-u;m>=n;m-=u)p=Rz(m/u|0,i[m],i[m+1],p);return p&&Ow(p,p.next)&&(uv(p),p=p.next),p}function qp(i,n){if(!i)return i;n||(n=i);let o,u=i;do if(o=!1,u.steiner||!Ow(u,u.next)&&Ts(u.prev,u,u.next)!==0)u=u.next;else{if(uv(u),u=n=u.prev,u===u.next)break;o=!0}while(o||u!==n);return n}function lv(i,n,o,u,h,p,m){if(!i)return;!m&&p&&function(w,E,C,P){let M=w;do M.z===0&&(M.z=BP(M.x,M.y,E,C,P)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==w);M.prevZ.nextZ=null,M.prevZ=null,function(z){let j,V=1;do{let $,Y=z;z=null;let me=null;for(j=0;Y;){j++;let pe=Y,ge=0;for(let Re=0;Re<V&&(ge++,pe=pe.nextZ,pe);Re++);let Pe=V;for(;ge>0||Pe>0&&pe;)ge!==0&&(Pe===0||!pe||Y.z<=pe.z)?($=Y,Y=Y.nextZ,ge--):($=pe,pe=pe.nextZ,Pe--),me?me.nextZ=$:z=$,$.prevZ=me,me=$;Y=pe}me.nextZ=null,V*=2}while(j>1)}(M)}(i,u,h,p);let v=i;for(;i.prev!==i.next;){const w=i.prev,E=i.next;if(p?BK(i,u,h,p):FK(i))n.push(w.i,i.i,E.i),uv(i),i=E.next,v=E.next;else if((i=E)===v){m?m===1?lv(i=jK(qp(i),n),n,o,u,h,p,2):m===2&&UK(i,n,o,u,h,p):lv(qp(i),n,o,u,h,p,1);break}}}function FK(i){const n=i.prev,o=i,u=i.next;if(Ts(n,o,u)>=0)return!1;const h=n.x,p=o.x,m=u.x,v=n.y,w=o.y,E=u.y,C=h<p?h<m?h:m:p<m?p:m,P=v<w?v<E?v:E:w<E?w:E,M=h>p?h>m?h:m:p>m?p:m,z=v>w?v>E?v:E:w>E?w:E;let j=u.next;for(;j!==n;){if(j.x>=C&&j.x<=M&&j.y>=P&&j.y<=z&&s_(h,v,p,w,m,E,j.x,j.y)&&Ts(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function BK(i,n,o,u){const h=i.prev,p=i,m=i.next;if(Ts(h,p,m)>=0)return!1;const v=h.x,w=p.x,E=m.x,C=h.y,P=p.y,M=m.y,z=v<w?v<E?v:E:w<E?w:E,j=C<P?C<M?C:M:P<M?P:M,V=v>w?v>E?v:E:w>E?w:E,$=C>P?C>M?C:M:P>M?P:M,Y=BP(z,j,n,o,u),me=BP(V,$,n,o,u);let pe=i.prevZ,ge=i.nextZ;for(;pe&&pe.z>=Y&&ge&&ge.z<=me;){if(pe.x>=z&&pe.x<=V&&pe.y>=j&&pe.y<=$&&pe!==h&&pe!==m&&s_(v,C,w,P,E,M,pe.x,pe.y)&&Ts(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,ge.x>=z&&ge.x<=V&&ge.y>=j&&ge.y<=$&&ge!==h&&ge!==m&&s_(v,C,w,P,E,M,ge.x,ge.y)&&Ts(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;pe&&pe.z>=Y;){if(pe.x>=z&&pe.x<=V&&pe.y>=j&&pe.y<=$&&pe!==h&&pe!==m&&s_(v,C,w,P,E,M,pe.x,pe.y)&&Ts(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;ge&&ge.z<=me;){if(ge.x>=z&&ge.x<=V&&ge.y>=j&&ge.y<=$&&ge!==h&&ge!==m&&s_(v,C,w,P,E,M,ge.x,ge.y)&&Ts(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function jK(i,n){let o=i;do{const u=o.prev,h=o.next.next;!Ow(u,h)&&Az(u,o,o.next,h)&&cv(u,h)&&cv(h,u)&&(n.push(u.i,o.i,h.i),uv(o),uv(o.next),o=i=h),o=o.next}while(o!==i);return qp(o)}function UK(i,n,o,u,h,p){let m=i;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&WK(m,v)){let w=Pz(m,v);return m=qp(m,m.next),w=qp(w,w.next),lv(m,n,o,u,h,p,0),void lv(w,n,o,u,h,p,0)}v=v.next}m=m.next}while(m!==i)}function VK(i,n){return i.x-n.x}function $K(i,n){const o=function(h,p){let m=p;const v=h.x,w=h.y;let E,C=-1/0;do{if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){const V=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(V<=v&&V>C&&(C=V,E=m.x<m.next.x?m:m.next,V===v))return E}m=m.next}while(m!==p);if(!E)return null;const P=E,M=E.x,z=E.y;let j=1/0;m=E;do{if(v>=m.x&&m.x>=M&&v!==m.x&&s_(w<z?v:C,w,M,z,w<z?C:v,w,m.x,m.y)){const V=Math.abs(w-m.y)/(v-m.x);cv(m,h)&&(V<j||V===j&&(m.x>E.x||m.x===E.x&&qK(E,m)))&&(E=m,j=V)}m=m.next}while(m!==P);return E}(i,n);if(!o)return n;const u=Pz(o,i);return qp(u,u.next),qp(o,o.next)}function qK(i,n){return Ts(i.prev,i,n.prev)<0&&Ts(n.next,i,i.next)<0}function BP(i,n,o,u,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-o)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function GK(i){let n=i,o=i;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==i);return o}function s_(i,n,o,u,h,p,m,v){return(h-m)*(n-v)>=(i-m)*(p-v)&&(i-m)*(u-v)>=(o-m)*(n-v)&&(o-m)*(p-v)>=(h-m)*(u-v)}function WK(i,n){return i.next.i!==n.i&&i.prev.i!==n.i&&!function(o,u){let h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==u.i&&h.next.i!==u.i&&Az(h,h.next,o,u))return!0;h=h.next}while(h!==o);return!1}(i,n)&&(cv(i,n)&&cv(n,i)&&function(o,u){let h=o,p=!1;const m=(o.x+u.x)/2,v=(o.y+u.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&m<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==o);return p}(i,n)&&(Ts(i.prev,i,n.prev)||Ts(i,n.prev,n))||Ow(i,n)&&Ts(i.prev,i,i.next)>0&&Ts(n.prev,n,n.next)>0)}function Ts(i,n,o){return(n.y-i.y)*(o.x-n.x)-(n.x-i.x)*(o.y-n.y)}function Ow(i,n){return i.x===n.x&&i.y===n.y}function Az(i,n,o,u){const h=zw(Ts(i,n,o)),p=zw(Ts(i,n,u)),m=zw(Ts(o,u,i)),v=zw(Ts(o,u,n));return h!==p&&m!==v||!(h!==0||!Lw(i,o,n))||!(p!==0||!Lw(i,u,n))||!(m!==0||!Lw(o,i,u))||!(v!==0||!Lw(o,n,u))}function Lw(i,n,o){return n.x<=Math.max(i.x,o.x)&&n.x>=Math.min(i.x,o.x)&&n.y<=Math.max(i.y,o.y)&&n.y>=Math.min(i.y,o.y)}function zw(i){return i>0?1:i<0?-1:0}function cv(i,n){return Ts(i.prev,i,i.next)<0?Ts(i,n,i.next)>=0&&Ts(i,i.prev,n)>=0:Ts(i,n,i.prev)<0||Ts(i,i.next,n)<0}function Pz(i,n){const o=jP(i.i,i.x,i.y),u=jP(n.i,n.x,n.y),h=i.next,p=n.prev;return i.next=n,n.prev=i,o.next=h,h.prev=o,u.next=o,o.prev=u,p.next=u,u.prev=p,u}function Rz(i,n,o,u){const h=jP(i,n,o);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function uv(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function jP(i,n,o){return{i,x:n,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Nw(i,n){const o=i.length;if(o<=1)return[i];const u=[];let h,p;for(let m=0;m<o;m++){const v=vg(i[m]);v!==0&&(i[m].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(h&&u.push(h),h=[i[m]]):h.push(i[m]))}if(h&&u.push(h),n>1)for(let m=0;m<u.length;m++)u[m].length<=n||(Cr(u[m],n,1,u[m].length-1,HK),u[m]=u[m].slice(0,n));return u}function HK(i,n){return n.area-i.area}function UP(i,n,o){const u=o.patternDependencies;let h=!1;for(const p of n){const m=p.paint.get(`${i}-pattern`);m.isConstant()||(h=!0);const v=m.constantOr(null);v&&(h=!0,u[v]=!0)}return h}function VP(i,n,o,u,h){const p=h.patternDependencies;for(const m of n){const v=m.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:u},o,{},h.availableImages);w=w&&w.name?w.name:w,p[w]=!0,o.patterns[m.id]=w}}return o}class Fw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Tc,this.indexArray=new Gs,this.indexArray2=new Bd,this.programConfigurations=new Ud(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Ei,this.segments2=new Ei,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection}updateFootprints(n,o){}populate(n,o,u,h){this.hasPattern=UP("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:C}of n){const P=this.layers[0]._featureFilter.needGeometry,M=wh(v,P);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom),M,u))continue;const z=p?p.evaluate(M,{},u,o.availableImages):void 0,j={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:E,geometry:P?M.geometry:Sc(v,u,h),patterns:{},sortKey:z};m.push(j)}p&&m.sort((v,w)=>v.sortKey-w.sortKey);for(const v of m){const{geometry:w,index:E,sourceLayerIndex:C}=v;if(this.hasPattern){const P=VP("fill",this.layers,v,this.zoom,o);this.patternFeatures.push(P)}else this.addFeature(v,w,E,u,{},o.availableImages,o.brightness);o.featureIndex.insert(n[E].feature,w,E,C,this.index)}}update(n,o,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,u,h,p)}addFeatures(n,o,u,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,u,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,NK),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,u,h,p,m=[],v){for(const w of Nw(o,500)){let E=0;for(const V of w)E+=V.length;const C=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),P=C.vertexLength,M=[],z=[];for(const V of w){if(V.length===0)continue;V!==w[0]&&z.push(M.length/2);const $=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),Y=$.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(Y+V.length-1,Y),M.push(V[0].x),M.push(V[0].y);for(let me=1;me<V.length;me++)this.layoutVertexArray.emplaceBack(V[me].x,V[me].y),this.indexArray2.emplaceBack(Y+me-1,Y+me),M.push(V[me].x),M.push(V[me].y);$.vertexLength+=V.length,$.primitiveLength+=V.length}const j=av(M,z);for(let V=0;V<j.length;V+=3)this.indexArray.emplaceBack(P+j[V],P+j[V+1],P+j[V+2]);C.vertexLength+=E,C.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,v)}}let Mz,kz,Dz,Oz;qe(Fw,"FillBucket",{omit:["layers","patternFeatures"]});class $P{constructor(n,o,u,h){if(this.triangleCount=o.length/3,this.min=new Ft(0,0),this.max=new Ft(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[p,m]=[n[0].clone(),n[0].clone()];for(let P=1;P<n.length;++P){const M=n[P];p.x=Math.min(p.x,M.x),p.y=Math.min(p.y,M.y),m.x=Math.max(m.x,M.x),m.y=Math.max(m.y,M.y)}if(h){const P=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/h);u=Math.max(u,P)}if(u===0)return;this.min=p,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const w=Math.max(v.x,v.y)/u;this.cellsX=Math.max(1,Math.ceil(v.x/w)),this.cellsY=Math.max(1,Math.ceil(v.y/w)),this.xScale=1/w,this.yScale=1/w;const E=[];for(let P=0;P<this.triangleCount;P++){const M=n[o[3*P+0]].sub(this.min),z=n[o[3*P+1]].sub(this.min),j=n[o[3*P+2]].sub(this.min),V=yu(Math.floor(Math.min(M.x,z.x,j.x)),this.xScale,this.cellsX),$=yu(Math.floor(Math.max(M.x,z.x,j.x)),this.xScale,this.cellsX),Y=yu(Math.floor(Math.min(M.y,z.y,j.y)),this.yScale,this.cellsY),me=yu(Math.floor(Math.max(M.y,z.y,j.y)),this.yScale,this.cellsY),pe=new Ft(0,0),ge=new Ft(0,0),Pe=new Ft(0,0),Re=new Ft(0,0);for(let ze=Y;ze<=me;++ze){pe.y=ge.y=ze*w,Pe.y=Re.y=(ze+1)*w;for(let Ge=V;Ge<=$;++Ge)pe.x=Pe.x=Ge*w,ge.x=Re.x=(Ge+1)*w,(PP(M,z,j,pe,ge,Re)||PP(M,z,j,pe,Re,Pe))&&E.push({cellIdx:ze*this.cellsX+Ge,triIdx:P})}}if(E.length===0)return;E.sort((P,M)=>P.cellIdx-M.cellIdx||P.triIdx-M.triIdx);let C=0;for(;C<E.length;){const P=E[C].cellIdx,M={start:this.payload.length,len:0};for(;C<E.length&&E[C].cellIdx===P;)++M.len,this.payload.push(E[C++].triIdx);this.cells[P]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,o){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const u=yu(n.x-this.min.x,this.xScale,this.cellsX),h=yu(n.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+u];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const v=this.payload[p.start+m],w=Math.floor(v/8),E=1<<v%8;if(!(this.lookup[w]&E)&&(this.lookup[w]|=E,o.push(v),o.length===this.triangleCount))return}}}query(n,o,u){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>o.x||n.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const h=yu(n.x-this.min.x,this.xScale,this.cellsX),p=yu(o.x-this.min.x,this.xScale,this.cellsX),m=yu(n.y-this.min.y,this.yScale,this.cellsY),v=yu(o.y-this.min.y,this.yScale,this.cellsY);for(let w=m;w<=v;w++)for(let E=h;E<=p;E++){const C=this.cells[w*this.cellsX+E];if(C)for(let P=0;P<C.len;P++){const M=this.payload[C.start+P],z=Math.floor(M/8),j=1<<M%8;if(!(this.lookup[z]&j)&&(this.lookup[z]|=j,u.push(M),u.length===this.triangleCount))return}}}}function yu(i,n,o){return Math.max(0,Math.min(o-1,Math.floor(i*n)))}qe($P,"TriangleGridIndex");class Lz{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(n,o){for(const u of this.footprints)o.push({footprint:u,id:n})}populate(n,o,u,h){const p=[];for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of n){const C=this.layers[0]._featureFilter.needGeometry,P=wh(m,C);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom),P,u))continue;const M={id:v,properties:m.properties,type:m.type,sourceLayerIndex:E,index:w,geometry:C?P.geometry:Sc(m,u,h),patterns:{}};p.push(M)}for(const m of p){const{geometry:v,index:w,sourceLayerIndex:E}=m;this.addFeature(m,v,w,u,{},o.availableImages,o.brightness),o.featureIndex.insert(n[w].feature,v,w,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,o,u,h,p){}destroy(){}addFeature(n,o,u,h,p,m=[],v){for(const w of Nw(o,2)){const E=[],C=[],P=[],M=new Ft(1/0,1/0),z=new Ft(-1/0,-1/0);for(const $ of w)if($.length!==0){$!==w[0]&&P.push(C.length/2);for(let Y=0;Y<$.length;Y++)C.push($[Y].x),C.push($[Y].y),E.push($[Y]),M.x=Math.min(M.x,$[Y].x),M.y=Math.min(M.y,$[Y].y),z.x=Math.max(z.x,$[Y].x),z.y=Math.max(z.y,$[Y].y)}const j=av(C,P),V=new $P(E,j,8,256);this.footprints.push({vertices:E,indices:j,grid:V,min:M,max:z})}}}qe(Lz,"ClipBucket",{omit:["layers"]});const ZK=kr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),XK=kr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),KK=kr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),QK=kr([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),YK=kr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),JK=kr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:eQ}=ZK;var Bw={},tQ=nu,zz=o_;function o_(i,n,o,u,h){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=u,this._values=h,i.readFields(nQ,this,n)}function nQ(i,n,o){i==1?n.id=o.readVarint():i==2?function(u,h){for(var p=u.readVarint()+u.pos;u.pos<p;){var m=h._keys[u.readVarint()],v=h._values[u.readVarint()];h.properties[m]=v}}(o,n):i==3?n.type=o.readVarint():i==4&&(n._geometry=o.pos)}function rQ(i){for(var n,o,u=0,h=0,p=i.length,m=p-1;h<p;m=h++)u+=((o=i[m]).x-(n=i[h]).x)*(n.y+o.y);return u}o_.types=["Unknown","Point","LineString","Polygon"],o_.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var n,o=i.readVarint()+i.pos,u=1,h=0,p=0,m=0,v=[];i.pos<o;){if(h<=0){var w=i.readVarint();u=7&w,h=w>>3}if(h--,u===1||u===2)p+=i.readSVarint(),m+=i.readSVarint(),u===1&&(n&&v.push(n),n=[]),n.push(new tQ(p,m));else{if(u!==7)throw new Error("unknown command "+u);n&&n.push(n[0].clone())}}return n&&v.push(n),v},o_.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var n=i.readVarint()+i.pos,o=1,u=0,h=0,p=0,m=1/0,v=-1/0,w=1/0,E=-1/0;i.pos<n;){if(u<=0){var C=i.readVarint();o=7&C,u=C>>3}if(u--,o===1||o===2)(h+=i.readSVarint())<m&&(m=h),h>v&&(v=h),(p+=i.readSVarint())<w&&(w=p),p>E&&(E=p);else if(o!==7)throw new Error("unknown command "+o)}return[m,w,v,E]},o_.prototype.toGeoJSON=function(i,n,o){var u,h,p=this.extent*Math.pow(2,o),m=this.extent*i,v=this.extent*n,w=this.loadGeometry(),E=o_.types[this.type];function C(z){for(var j=0;j<z.length;j++){var V=z[j];z[j]=[360*(V.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<w.length;u++)P[u]=w[u][0];C(w=P);break;case 2:for(u=0;u<w.length;u++)C(w[u]);break;case 3:for(w=function(z){var j=z.length;if(j<=1)return[z];for(var V,$,Y=[],me=0;me<j;me++){var pe=rQ(z[me]);pe!==0&&($===void 0&&($=pe<0),$===pe<0?(V&&Y.push(V),V=[z[me]]):V.push(z[me]))}return V&&Y.push(V),Y}(w),u=0;u<w.length;u++)for(h=0;h<w[u].length;h++)C(w[u][h])}w.length===1?w=w[0]:E="Multi"+E;var M={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(M.id=this.id),M};var iQ=zz,Nz=Fz;function Fz(i,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(sQ,this,n),this.length=this._features.length}function sQ(i,n,o){i===15?n.version=o.readVarint():i===1?n.name=o.readString():i===5?n.extent=o.readVarint():i===2?n._features.push(o.pos):i===3?n._keys.push(o.readString()):i===4&&n._values.push(function(u){for(var h=null,p=u.readVarint()+u.pos;u.pos<p;){var m=u.readVarint()>>3;h=m===1?u.readString():m===2?u.readFloat():m===3?u.readDouble():m===4?u.readVarint64():m===5?u.readVarint():m===6?u.readSVarint():m===7?u.readBoolean():null}return h}(o))}Fz.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var n=this._pbf.readVarint()+this._pbf.pos;return new iQ(this._pbf,n,this.extent,this._keys,this._values)};var oQ=Nz;function aQ(i,n,o){if(i===3){var u=new oQ(o,o.readVarint()+o.pos);u.length&&(n[u.name]=u)}}var qP=Bw.VectorTile=function(i,n){this.layers=i.readFields(aQ,{},n)},jw=Bw.VectorTileFeature=zz;Bw.VectorTileLayer=Nz;class Gp extends Ft{constructor(n,o,u){super(n,o),this.z=u}}class Bz extends Gp{constructor(n,o,u,h){super(n,o,u),this.w=h}}function Uw(i,n,o,u){const h=[],p=u===0?(m,v,w,E,C,P)=>{m.push(new Ft(P,w+(P-v)/(E-v)*(C-w)))}:(m,v,w,E,C,P)=>{m.push(new Ft(v+(P-w)/(C-w)*(E-v),P))};for(const m of i){const v=[];for(const w of m){if(w.length<=2)continue;const E=[];for(let M=0;M<w.length-1;M++){const z=w[M].x,j=w[M].y,V=w[M+1].x,$=w[M+1].y,Y=u===0?z:j,me=u===0?V:$;Y<n?me>n&&p(E,z,j,V,$,n):Y>o?me<o&&p(E,z,j,V,$,o):E.push(w[M]),me<n&&Y>=n&&p(E,z,j,V,$,n),me>o&&Y<=o&&p(E,z,j,V,$,o)}let C=w[w.length-1];const P=u===0?C.x:C.y;P>=n&&P<=o&&E.push(C),E.length&&(C=E[E.length-1],E[0].x===C.x&&E[0].y===C.y||E.push(E[0]),v.push(E))}v.length&&h.push(v)}return h}function jz(i,n,o,u){const h=o==="x"?"y":"x",p=(u-i[o])/(n[o]-i[o]);i[h]=i[h]+(n[h]-i[h])*p,i[o]=u,i.hasOwnProperty("z")&&(i.z=Tn(i.z,n.z,p)),i.hasOwnProperty("w")&&(i.w=Tn(i.w,n.w,p))}function Uz(i,n,o,u){const h=o,p=u;for(const m of["x","y"]){let v=i,w=n;v[m]>=w[m]&&(v=n,w=i),v[m]<h&&w[m]>h&&jz(v,w,m,h),v[m]<p&&w[m]>p&&jz(w,v,m,p)}}const Vw=Number.MAX_SAFE_INTEGER;function Vz(i,n,o,u){return i.order<n||i.order===Vw||!(i.clipMask&o)||function(h,p){return p.length!==0&&p.find(m=>m===h)===void 0}(u,i.clipScope)}function $w(i,n){return i.x-n.x||i.y-n.y}function $z(i,n){return $w(i.min,n.min)===0&&$w(i.max,n.max)===0}function GP(i,n){return!(i.min.x>n.max.x||i.max.x<n.min.x||i.min.y>n.max.y||i.max.y<n.min.y)}function WP(i,n){if(i.length!==n.length)return!1;for(let o=0;o<i.length;o++)if(i[o].sourceId!==n[o].sourceId||!$z(i[o],n[o])||i[o].order!==n[o].order||i[o].clipMask!==n[o].clipMask||!lc(i[o].clipScope,n[o].clipScope))return!1;return!0}function qz(i,n,o){const u=1/zt,h=1/(1<<o.canonical.z),p=(n.x*u+o.canonical.x)*h+o.wrap,m=(n.y*u+o.canonical.y)*h;return{min:new Ft((i.x*u+o.canonical.x)*h+o.wrap,(i.y*u+o.canonical.y)*h),max:new Ft(p,m)}}function lQ(i,n,o){const u=1<<o.canonical.z,h=((n.x-o.wrap)*u-o.canonical.x)*zt,p=(n.y*u-o.canonical.y)*zt;return{min:new Ft(((i.x-o.wrap)*u-o.canonical.x)*zt,(i.y*u-o.canonical.y)*zt),max:new Ft(h,p)}}function Gz(i,n,o,u,h,p,m){const v=i.indices,w=i.vertices,E=[];for(let C=u;C<u+h;C+=3){const P=n[o[C+0]+p],M=n[o[C+1]+p],z=n[o[C+2]+p],j=Math.min(P.x,M.x,z.x),V=Math.max(P.x,M.x,z.x),$=Math.min(P.y,M.y,z.y),Y=Math.max(P.y,M.y,z.y);E.length=0,i.grid.query(new Ft(j,$),new Ft(V,Y),E);for(let me=0;me<E.length;me++){const pe=E[me];if(PP(w[v[3*pe+0]],w[v[3*pe+1]],w[v[3*pe+2]],P,M,z,m))return!0}}return!1}function Wz(i,n,o,u){if(!i||!o)return!1;let h=i.vertices;if(!n.canonical.equals(u.canonical)||n.wrap!==u.wrap){if(o.vertices.length<i.vertices.length)return Wz(o,u,i,n);const p=n.canonical,m=u.canonical,v=Math.pow(2,m.z-p.z);h=i.vertices.map(w=>new Ft((w.x+p.x*zt)*v-m.x*zt,(w.y+p.y*zt)*v-m.y*zt))}return Gz(o,h,i.indices,0,i.indices.length,0,0)}function Hz(i,n,o,u){const h=Math.pow(2,u.z-o.z);return new Ft((i+o.x*zt)*h-u.x*zt,(n+o.y*zt)*h-u.y*zt)}function Zz(i,n){const o=[];n.footprint.grid.queryPoint(i,o);const u=n.footprint.indices,h=n.footprint.vertices;for(let p=0;p<o.length;p++){const m=o[p];if($d([h[u[3*m+0]],h[u[3*m+1]],h[u[3*m+2]]],i))return!0}return!1}class Xz{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const u=this.toIdx(n,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function Kz(i,n,o,u){let h=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(u[m])<1e-15){if(o[m]<i[m]||o[m]>n[m])return null}else{const v=1/u[m];let w=(i[m]-o[m])*v,E=(n[m]-o[m])*v;if(w>E){const C=w;w=E,E=C}if(w>h&&(h=w),E<p&&(p=E),h>p)return null}return h}function Qz(i,n,o,u,h,p,m,v,w,E,C){const P=u-i,M=h-n,z=p-o,j=m-i,V=v-n,$=w-o,Y=C[1]*$-C[2]*V,me=C[2]*j-C[0]*$,pe=C[0]*V-C[1]*j,ge=P*Y+M*me+z*pe;if(Math.abs(ge)<1e-15)return null;const Pe=1/ge,Re=E[0]-i,ze=E[1]-n,Ge=E[2]-o,Ke=(Re*Y+ze*me+Ge*pe)*Pe;if(Ke<0||Ke>1)return null;const it=ze*z-Ge*M,Je=Ge*P-Re*z,ut=Re*M-ze*P,Ct=(C[0]*it+C[1]*Je+C[2]*ut)*Pe;return Ct<0||Ke+Ct>1?null:(j*it+V*Je+$*ut)*Pe}function Yz(i,n,o){return(i-n)/(o-n)}function Jz(i,n,o,u,h,p,m,v,w){const E=1<<o,C=p-u,P=m-h,M=(i+1)/E*C+u,z=(n+0)/E*P+h,j=(n+1)/E*P+h;v[0]=(i+0)/E*C+u,v[1]=z,w[0]=M,w[1]=j}class eN{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(p){const m=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,m));const E=1/w,C=(z,j,V,$,Y)=>{const me=$?1:0,pe=(z+1)*V-me,ge=j*V,Pe=(j+1)*V-me;Y[0]=z*V,Y[1]=ge,Y[2]=pe,Y[3]=Pe};let P=new Xz(w);const M=[];for(let z=0;z<w*w;z++){C(z%w,Math.floor(z/w),E,!1,M);const j=Gd(M[0],M[1],p),V=Gd(M[2],M[1],p),$=Gd(M[2],M[3],p),Y=Gd(M[0],M[3],p);P.minimums.push(Math.min(j,V,$,Y)),P.maximums.push(Math.max(j,V,$,Y)),P.leaves.push(1)}for(v.push(P),w/=2;w>=1;w/=2){const z=v[v.length-1];P=new Xz(w);for(let j=0;j<w*w;j++){C(j%w,Math.floor(j/w),2,!0,M);const V=z.getElevation(M[0],M[1]),$=z.getElevation(M[2],M[1]),Y=z.getElevation(M[2],M[3]),me=z.getElevation(M[0],M[3]),pe=z.isLeaf(M[0],M[1]),ge=z.isLeaf(M[2],M[1]),Pe=z.isLeaf(M[2],M[3]),Re=z.isLeaf(M[0],M[3]),ze=Math.min(V.min,$.min,Y.min,me.min),Ge=Math.max(V.max,$.max,Y.max,me.max),Ke=pe&&ge&&Pe&&Re;P.maximums.push(Ge),P.minimums.push(ze),P.leaves.push(Ge-ze<=5&&Ke?1:0)}v.push(P)}return v}(this.dem),u=o.length-1,h=o[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(n,o,u,h,p,m,v=1){return Kz([n,o,-100],[u,h,this.maximums[0]*v],p,m)}raycast(n,o,u,h,p,m,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(n,o,u,h,p,m,v);if(w==null)return null;const E=[],C=[],P=[],M=[],z=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:j,t:V,nodex:$,nodey:Y,depth:me}=z.pop();if(this.leaves[j]){Jz($,Y,me,n,o,u,h,P,M);const ge=1<<me,Pe=($+0)/ge,Re=($+1)/ge,ze=(Y+0)/ge,Ge=(Y+1)/ge,Ke=Gd(Pe,ze,this.dem)*v,it=Gd(Re,ze,this.dem)*v,Je=Gd(Re,Ge,this.dem)*v,ut=Gd(Pe,Ge,this.dem)*v,Ct=Qz(P[0],P[1],Ke,M[0],P[1],it,M[0],M[1],Je,p,m),ht=Qz(M[0],M[1],Je,P[0],M[1],ut,P[0],P[1],Ke,p,m),Mt=Math.min(Ct!==null?Ct:Number.MAX_VALUE,ht!==null?ht:Number.MAX_VALUE);if(Mt!==Number.MAX_VALUE)return Mt;{const lt=a.$.scaleAndAdd([],p,m,V);if(tN(Ke,it,ut,Je,Yz(lt[0],P[0],M[0]),Yz(lt[1],P[1],M[1]))>=lt[2])return V}continue}let pe=0;for(let ge=0;ge<this._siblingOffset.length;ge++){Jz(($<<1)+this._siblingOffset[ge][0],(Y<<1)+this._siblingOffset[ge][1],me+1,n,o,u,h,P,M),P[2]=-100,M[2]=this.maximums[this.childOffsets[j]+ge]*v;const Pe=Kz(P,M,p,m);if(Pe!=null){const Re=Pe;E[ge]=Re;let ze=!1;for(let Ge=0;Ge<pe&&!ze;Ge++)Re>=E[C[Ge]]&&(C.splice(Ge,0,ge),ze=!0);ze||(C[pe]=ge),pe++}}for(let ge=0;ge<pe;ge++){const Pe=C[ge];z.push({idx:this.childOffsets[j]+Pe,t:E[Pe],nodex:($<<1)+this._siblingOffset[Pe][0],nodey:(Y<<1)+this._siblingOffset[Pe][1],depth:me+1})}}return null}_addNode(n,o,u){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,u,h,p){if(n[h].isLeaf(o,u)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=h-1,v=n[m];let w=0,E=0;for(let C=0;C<this._siblingOffset.length;C++){const P=2*o+this._siblingOffset[C][0],M=2*u+this._siblingOffset[C][1],z=v.getElevation(P,M),j=v.isLeaf(P,M),V=this._addNode(z.min,z.max,j);j&&(w|=1<<C),E||(E=V)}for(let C=0;C<this._siblingOffset.length;C++)w&1<<C||this._construct(n,2*o+this._siblingOffset[C][0],2*u+this._siblingOffset[C][1],m,E+C)}}function tN(i,n,o,u,h,p){return Tn(Tn(i,o,p),Tn(n,u,p),h)}function Gd(i,n,o){const u=o.dim,h=Yn(i*u-.5,0,u-1),p=Yn(n*u-.5,0,u-1),m=Math.floor(h),v=Math.floor(p),w=Math.min(m+1,u-1),E=Math.min(v+1,u-1);return tN(o.get(m,v),o.get(w,v),o.get(m,E),o.get(w,E),h-m,p-v)}const cQ={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function uQ(i,n,o){return(256*i*256+256*n+o)/10-1e4}function hQ(i,n,o){return 256*i+n+o/256-32768}class qw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,u,h=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Pi(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const p=this.dim=o.height-2,m=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let w=0;w<p;w++)m[this._idx(-1,w)]=m[this._idx(0,w)],m[this._idx(p,w)]=m[this._idx(p-1,w)],m[this._idx(w,-1)]=m[this._idx(w,0)],m[this._idx(w,p)]=m[this._idx(w,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const v=u==="terrarium"?hQ:uQ;for(let w=0;w<m.length;++w){const E=4*w;this.floatView[w]=v(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=rn.now()}_buildQuadTree(){this._tree=new eN(this)}get(n,o,u=!1){u&&(n=Yn(n,-1,this.dim),o=Yn(o,-1,this.dim));const h=this._idx(n,o);return this.floatView[h]}set(n,o,u){const h=this._idx(n,o),p=this.floatView[h];return this.floatView[h]=u,u-p}static getUnpackVector(n){return cQ[n]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const u=[0,0,0,0],h=qw.getUnpackVector(o);let p=Math.floor((n+h[3])/h[2]);return u[2]=p%256,p=Math.floor(p/256),u[1]=p%256,p=Math.floor(p/256),u[0]=p,u}getPixels(){return new wz({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,p=o*this.dim+this.dim,m=u*this.dim,v=u*this.dim+this.dim;switch(o){case-1:h=p-1;break;case 1:p=h+1}switch(u){case-1:m=v-1;break;case 1:v=m+1}const w=-o*this.dim,E=-u*this.dim;for(let C=m;C<v;C++)for(let P=h;P<p;P++){const M=4*this._idx(P,C),z=4*this._idx(P+w,C+E);this.pixels[M+0]=n.pixels[z+0],this.pixels[M+1]=n.pixels[z+1],this.pixels[M+2]=n.pixels[z+2],this.pixels[M+3]=n.pixels[z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}qe(qw,"DEMData"),qe(eN,"DemMinMaxQuadTree",{omit:["dem"]});class a_{constructor(n,o,u){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(n,o,u){const h=u||n.findDEMTileFor(o);if(!h||!h.dem)return;const p=h.dem,m=h.tileID,v=1<<o.canonical.z-m.canonical.z;return new a_(h,p.dim/zt/v,[(o.canonical.x/v-m.canonical.x)*p.dim,(o.canonical.y/v-m.canonical.y)*p.dim])}tileCoordToPixel(n,o){const u=o*this._scale+this._offset[1],h=Math.floor(n*this._scale+this._offset[0]),p=Math.floor(u);return new Ft(h,p)}getElevationAt(n,o,u,h){const p=n*this._scale+this._offset[0],m=o*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(m),E=this._dem;return h=!!h,u?Tn(Tn(E.get(v,w,h),E.get(v,w+1,h),m-w),Tn(E.get(v+1,w,h),E.get(v+1,w+1,h),m-w),p-v):E.get(v,w,h)}getElevationAtPixel(n,o,u){return this._dem.get(n,o,!!u)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Ho(1,n)*this._dem.stride}}const nN={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},dQ=jw.types,fQ=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],pQ=["fill-extrusion-flood-light-ground-radius"],mQ=Math.pow(2,13),gQ=Math.pow(2,15)-1,rN=new Ft(0,1),Wd=2147483648;function hv(i,n,o,u,h,p,m,v){i.emplaceBack((n<<1)+m,(o<<1)+p,(Math.floor(u*mQ)<<1)+h,Math.round(v))}function dv(i,n,o,u){i.emplaceBack(n.x*zt,n.y*zt,o?0:1,u?1:0)}function Gw(i,n,o,u,h,p){i.emplaceBack(n.x,n.y,(o.x<<1)+u,(o.y<<1)+h,p)}function fv(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class iN{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sN{constructor(){this.centroidXY=new Ft(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ft(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ft(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ft(this.max.x-this.min.x,this.max.y-this.min.y)}}class oN{constructor(){this.acc=new Ft(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,o){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=o.x,n.min.y=n.max.y=o.y)}appendEdge(n,o,u){this.accCount++,this.acc._add(o);let h=!!this.borders;o.x<n.min.x?(n.min.x=o.x,h=!0):o.x>n.max.x&&(n.max.x=o.x,h=!0),o.y<n.min.y?(n.min.y=o.y,h=!0):o.y>n.max.y&&(n.max.y=o.y,h=!0),((o.x===0||o.x===zt)&&o.x===u.x)!=((o.y===0||o.y===zt)&&o.y===u.y)&&this.processBorderOverlap(o,u),h&&this.checkBorderIntersection(o,u)}checkBorderIntersection(n,o){o.x<0!=n.x<0&&this.addBorderIntersection(0,Tn(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>zt!=n.x>zt&&this.addBorderIntersection(1,Tn(o.y,n.y,(zt-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,Tn(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>zt!=n.y>zt&&this.addBorderIntersection(3,Tn(o.x,n.x,(zt-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[n];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const u=n.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,n.y)}else{const u=n.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,n.x)}}centroid(){return this.accCount===0?new Ft(0,0):new Ft(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,o)=>n+ +(o[0]!==Number.MAX_VALUE),0):0}}function aN(i,n){const o=i.add(n)._unit(),u=Yn(i.x*o.x+i.y*o.y,-1,1);var h,p,m;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*gQ*((p=i).x*(m=n).y-p.y*m.x<0?-1:1)}const _Q=[i=>i.x<0,i=>i.x>zt,i=>i.y<0,i=>i.y>zt];function yQ(i,n,o,u){const h=[4];if(u===0)return h;o._mult(u);const p=i.sub(o),m=n.sub(o),v=[i,n,p,m];for(let w=0;w<4;w++)for(const E of v)if(_Q[w](E)){h.push(w);break}return h}class lN{constructor(n){this.vertexArray=new QA,this.indexArray=new Gs,this.programConfigurations=new Ud(n.layers,{zoom:n.zoom,lut:n.lut},o=>pQ.includes(o)),this._segments=new Ei,this.hiddenByLandmarkVertexArray=new hP,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ei}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,o,u,h=!1){const p=n.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let w;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const E=n[0],C=n[1];w=aN(E.sub(n[p-1])._perp()._unit(),C.sub(E)._perp()._unit())}for(let E=0;E<p;E++){const C=E===p-1?0:E+1,P=n[E],M=n[C],z=n[C===p-1?0:C+1],j=M.sub(P)._perp()._unit(),V=aN(j,z.sub(M)._perp()._unit()),$=w,Y=V;if(HP(P,M,o)||h&&hN(P,o)&&hN(M,o)){w=V;continue}const me=v.vertexLength;Gw(this.vertexArray,P,M,1,1,$),Gw(this.vertexArray,P,M,1,0,$),Gw(this.vertexArray,P,M,0,1,Y),Gw(this.vertexArray,P,M,0,0,Y),v.vertexLength+=4;const pe=yQ(P,M,j,u);for(const ge of pe)this._segmentToGroundQuads[m].push({id:me,region:ge}),this._segmentToRegionTriCounts[m][ge]+=2,v.primitiveLength+=2;w=V}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),o=n.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((h,p)=>h.region-p.region);for(let u=0;u<o;u++){const h=this._segmentToGroundQuads[u],p=n[u],m=this._segmentToRegionTriCounts[u];m.reduce((w,E)=>w+E,0);let v=0;for(let w=0;w<=4;w++){const E=m[w];if(E!==0){let C=this.regionSegments[w];C||(C=this.regionSegments[w]=new Ei);const P={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:E};C.get().push(P)}v+=E}for(let w=0;w<h.length;w++){const E=h[w].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,o,u,h,p,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,o,u,h,p,m)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,XK.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,o,u,h,p,m){this.hasData()&&this.programConfigurations.updatePaintArrays(n,o,u,h,p,m)}updateHiddenByLandmark(n){if(!this.hasData())return;const o=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const u=n.flags&Wd?1:0;for(let h=n.groundVertexArrayOffset;h<o;++h)this.hiddenByLandmarkVertexArray.emplace(h,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,YK.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const o=this.regionSegments[n];o&&o.destroy()}}}}class Ww{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Gs,this.footprintVertices=new Tc,this.footprintSegments=[],this.layoutVertexArray=new yh,this.centroidVertexArray=new OL,this.wallVertexArray=new zL,this.indexArray=new Gs,this.programConfigurations=new Ud(n.layers,{zoom:n.zoom,lut:n.lut},o=>fQ.includes(o)),this.segments=new Ei,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new lN(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,o){}populate(n,o,u,h){this.features=[],this.hasPattern=UP("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Iw(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:v,sourceLayerIndex:w}of n){const E=this.layers[0]._featureFilter.needGeometry,C=wh(p,E);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom),C,u))continue;const P={id:m,sourceLayerIndex:w,index:v,geometry:E?C.geometry:Sc(p,u,h),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(VP("fill-extrusion",this.layers,P,this.zoom,o));else if(this.wallMode)for(const z of P.geometry)this.addFeature(P,[z],v,u,{},o.availableImages,h,o.brightness);else this.addFeature(P,P.geometry,v,u,{},o.availableImages,h,o.brightness);o.featureIndex.insert(p,P.geometry,v,w,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,o,u,h,p,m){for(const v of this.features){const{geometry:w}=v;if(this.wallMode)for(const E of w)this.addFeature(v,[E],v.index,o,u,h,p,m);else this.addFeature(v,w,v.index,o,u,h,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,o,u,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,o,v,u,h,p),this.groundEffect.update(n,o,v,u,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,eQ),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,QK.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,JK.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,KK.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,u,h,p,m,v,w){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,C=[new Ft(0,0),new Ft(zt,zt)],P=v.projection,M=P.name==="globe",z=this.wallMode||dQ[n.type]==="Polygon",j=new oN;j.centroidDataIndex=this.centroidData.length;const V=new sN,$=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},h)<=0,Y=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},h);let me;if(V.height=Y,V.vertexArrayOffset=this.layoutVertexArray.length,V.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bw),this.wallMode){if(M)return void Pi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;me=function(it){const Je=it[0].x===it[it.length-1].x&&it[0].y===it[it.length-1].y;(function(mn){let tn=0;const Nt=mn.length;for(let Rn=0;Rn<Nt;Rn++)tn+=(mn[(Rn+1)%Nt].x-mn[Rn].x)*(mn[(Rn+1)%Nt].y+mn[Rn].y);return tn>=0})(it)||(it=it.reverse());const Ct={isPolygon:Je,geometry:[],joinNormals:[]},ht=[],Mt=[],lt=[];let xt=it.length;if(xt<(Je?3:2))return Ct;for(;xt>=2&&it[xt-1].equals(it[xt-2]);)xt--;let Ot,ft,jt,Dt,Pt,vn=0;for(;vn<xt-1&&it[vn].equals(it[vn+1]);)vn++;Je&&(Ot=it[xt-2],Pt=it[vn].sub(Ot)._unit()._perp());for(let mn=vn;mn<xt;mn++){if(jt=mn===xt-1?Je?it[vn+1]:void 0:it[mn+1],jt&&it[mn].equals(jt))continue;Pt&&(Dt=Pt),Ot&&(ft=Ot),Ot=it[mn],Pt=jt?jt.sub(Ot)._unit()._perp():Dt,Dt=Dt||Pt;const tn=Dt.add(Pt);tn.x===0&&tn.y===0||tn._unit();const Nt=tn.x*Pt.x+tn.y*Pt.y,Rn=Nt!==0?1/Nt:1/0,gn=Dt.x*Pt.y-Dt.y*Pt.x>0;let cn="miter";cn==="miter"&&Rn>2&&(cn="bevel");const Bn=(Un,jn,Kn,yr)=>{const lr=new Ft(Un.x,Un.y),$r=new Ft(Un.x,Un.y);lr.x-=jn.x*yr,lr.y-=jn.y*yr,$r.x-=jn.x*Math.max(Kn,1),$r.y-=jn.y*Math.max(Kn,1),lt.push(jn),ht.push(lr),Mt.push($r)};if(cn==="miter")tn._mult(Rn),Bn(Ot,tn,1,0);else{const Un=-Math.sqrt(Rn*Rn-1),jn=gn?Un:0,Kn=gn?0:Un;ft&&Bn(Ot,Dt,jn,Kn),jt&&Bn(Ot,Pt,jn,Kn)}}return Ct.geometry=[...ht,...Mt.reverse(),ht[0]],Ct.joinNormals=[...lt,...lt.reverse(),lt[lt.length-1]],Ct}(o[0]),o=[me.geometry]}const pe=(it,Je)=>it<(Je.length-1)/2||it===Je.length-1,ge=this.wallMode?[o]:Nw(o,500);for(let it=ge.length-1;it>=0;it--){const Je=ge[it];(Je.length===0||(Pe=Je[0]).every(ut=>ut.x<=0)||Pe.every(ut=>ut.x>=zt)||Pe.every(ut=>ut.y<=0)||Pe.every(ut=>ut.y>=zt))&&ge.splice(it,1)}var Pe;let Re;if(M)Re=mN(ge,C,h);else{Re=[];for(const it of ge)Re.push({polygon:it,bounds:C})}const ze=z?this.edgeRadius:0,Ge=ze>0&&this.zoom<17,Ke=(it,Je)=>{if(it.length===0)return!1;const ut=it[it.length-1];return Je.x===ut.x&&Je.y===ut.y};for(const{polygon:it,bounds:Je}of Re){let ut=0,Ct=0;for(const xt of it)z&&!xt[0].equals(xt[xt.length-1])&&xt.push(xt[0]),Ct+=z?xt.length-1:xt.length;const ht=this.segments.prepareSegment((z?5:4)*Ct,this.layoutVertexArray,this.indexArray);V.footprintSegIdx<0&&(V.footprintSegIdx=this.footprintSegments.length),V.polygonSegIdx<0&&(V.polygonSegIdx=this.polygonSegments.length);const Mt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},lt=new iN;if(lt.vertexOffset=this.footprintVertices.length,lt.indexOffset=3*this.footprintIndices.length,lt.ringIndices=[],z){const xt=[],Ot=[];ut=ht.vertexLength;for(let jt=0;jt<it.length;jt++){const Dt=it[jt];Dt.length&&jt!==0&&Ot.push(xt.length/2);const Pt=[];let vn,mn;vn=Dt[1].sub(Dt[0])._perp()._unit(),lt.ringIndices.push(Dt.length-1);for(let tn=1;tn<Dt.length;tn++){const Nt=Dt[tn],Rn=Dt[tn===Dt.length-1?1:tn+1],gn=Nt.clone();if(ze){mn=Rn.sub(Nt)._perp()._unit();const cn=vn.add(mn)._unit(),Bn=ze*Math.min(4,1/(vn.x*cn.x+vn.y*cn.y));gn.x+=Bn*cn.x,gn.y+=Bn*cn.y,gn.x=Math.round(gn.x),gn.y=Math.round(gn.y),vn=mn}if(!$||ze!==0&&!Ge||Ke(Pt,gn)||Pt.push(gn),hv(this.layoutVertexArray,gn.x,gn.y,0,0,1,1,0),this.wallMode){const cn=pe(tn,Dt);dv(this.wallVertexArray,me.joinNormals[tn],cn,me.isPolygon)}ht.vertexLength++,this.footprintVertices.emplaceBack(Nt.x,Nt.y),xt.push(Nt.x,Nt.y),M&&fv(this.layoutVertexExtArray,P.projectTilePoint(gn.x,gn.y,h),P.upVector(h,gn.x,gn.y))}$&&(ze===0||Ge)&&(Pt.length!==0&&Ke(Pt,Pt[0])&&Pt.pop(),this.groundEffect.addData(Pt,Je,E))}const ft=av(xt,Ot);for(let jt=0;jt<ft.length;jt+=3)this.footprintIndices.emplaceBack(lt.vertexOffset+ft[jt+0],lt.vertexOffset+ft[jt+1],lt.vertexOffset+ft[jt+2]),this.indexArray.emplaceBack(ut+ft[jt],ut+ft[jt+2],ut+ft[jt+1]),ht.primitiveLength++;lt.indexCount+=ft.length,lt.vertexCount+=this.footprintVertices.length-lt.vertexOffset}for(let xt=0;xt<it.length;xt++){const Ot=it[xt];j.startRing(V,Ot[0]);let ft=Ot.length>4&&dN(Ot[Ot.length-2],Ot[0],Ot[1]),jt=ze?vQ(Ot[Ot.length-2],Ot[0],Ot[1],ze):0;const Dt=[];let Pt,vn,mn;vn=Ot[1].sub(Ot[0])._perp()._unit();let tn=!0;for(let Nt=1,Rn=0;Nt<Ot.length;Nt++){let gn=Ot[Nt-1],cn=Ot[Nt];const Bn=Ot[Nt===Ot.length-1?1:Nt+1];if(j.appendEdge(V,cn,gn),HP(cn,gn,Je)){ze&&(vn=Bn.sub(cn)._perp()._unit(),tn=!tn);continue}const Un=cn.sub(gn)._perp(),jn=Un.x/(Math.abs(Un.x)+Math.abs(Un.y)),Kn=Un.y>0?1:0,yr=gn.dist(cn);if(Rn+yr>32768&&(Rn=0),ze){mn=Bn.sub(cn)._perp()._unit();let Vn=uN(gn,cn,Bn,cN(vn,mn),ze);isNaN(Vn)&&(Vn=0);const Dr=cn.sub(gn)._unit();gn=gn.add(Dr.mult(jt))._round(),cn=cn.add(Dr.mult(-Vn))._round(),jt=Vn,vn=mn,$&&this.zoom>=17&&(Ke(Dt,gn)||Dt.push(gn),Ke(Dt,cn)||Dt.push(cn))}const lr=ht.vertexLength,$r=Ot.length>4&&dN(gn,cn,Bn);let Hr=fN(Rn,ft,tn);if(hv(this.layoutVertexArray,gn.x,gn.y,jn,Kn,0,0,Hr),hv(this.layoutVertexArray,gn.x,gn.y,jn,Kn,0,1,Hr),this.wallMode){const Vn=pe(Nt-1,Ot),Dr=me.joinNormals[Nt-1];dv(this.wallVertexArray,Dr,!Vn,me.isPolygon),dv(this.wallVertexArray,Dr,!Vn,me.isPolygon)}if(Rn+=yr,Hr=fN(Rn,$r,!tn),ft=$r,hv(this.layoutVertexArray,cn.x,cn.y,jn,Kn,0,0,Hr),hv(this.layoutVertexArray,cn.x,cn.y,jn,Kn,0,1,Hr),this.wallMode){const Vn=pe(Nt,Ot),Dr=me.joinNormals[Nt];dv(this.wallVertexArray,Dr,!Vn,me.isPolygon),dv(this.wallVertexArray,Dr,!Vn,me.isPolygon)}if(ht.vertexLength+=4,this.indexArray.emplaceBack(lr+0,lr+1,lr+2),this.indexArray.emplaceBack(lr+1,lr+3,lr+2),ht.primitiveLength+=2,ze){const Vn=ut+(Nt===1?Ot.length-2:Nt-2),Dr=Nt===1?ut:Vn+1;if(this.indexArray.emplaceBack(lr+1,Vn,lr+3),this.indexArray.emplaceBack(Vn,Dr,lr+3),ht.primitiveLength+=2,Pt===void 0&&(Pt=lr),!HP(Bn,Ot[Nt],Je)){const Fr=Nt===Ot.length-1?Pt:ht.vertexLength;this.indexArray.emplaceBack(lr+2,lr+3,Fr),this.indexArray.emplaceBack(lr+3,Fr+1,Fr),this.indexArray.emplaceBack(lr+3,Dr,Fr+1),ht.primitiveLength+=3}tn=!tn}if(M){const Vn=this.layoutVertexExtArray,Dr=P.projectTilePoint(gn.x,gn.y,h),Fr=P.projectTilePoint(cn.x,cn.y,h),ii=P.upVector(h,gn.x,gn.y),ji=P.upVector(h,cn.x,cn.y);fv(Vn,Dr,ii),fv(Vn,Dr,ii),fv(Vn,Fr,ji),fv(Vn,Fr,ji)}}z&&(ut+=Ot.length-1),$&&ze&&this.zoom>=17&&(Dt.length!==0&&Ke(Dt,Dt[0])&&Dt.pop(),this.groundEffect.addData(Dt,Je,E,ze>0))}this.footprintSegments.push(lt),Mt.triangleCount=this.indexArray.length-Mt.triangleArrayOffset,this.polygonSegments.push(Mt),++V.footprintSegLen,++V.polygonSegLen}if(V.vertexCount=this.layoutVertexArray.length-V.vertexArrayOffset,V.groundVertexCount=this.groundEffect.vertexArray.length-V.groundVertexArrayOffset,V.vertexCount!==0){if(V.centroidXY=j.borders?rN:this.encodeCentroid(j,V),this.centroidData.push(V),j.borders){this.featuresOnBorder.push(j);const it=this.featuresOnBorder.length-1;for(let Je=0;Je<j.borders.length;Je++)j.borders[Je][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Je].push(it)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,w),this.groundEffect.addPaintPropertiesData(n,u,p,m,h,w),this.maxHeight=Math.max(this.maxHeight,Y)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((o,u)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[u].borders[n][0])}splitToSubtiles(){const n=[];for(let v=0;v<this.centroidData.length;v++){const w=this.centroidData[v],E=+(w.min.y+w.max.y>zt),C=2*E+(+(w.min.x+w.max.x>zt)^E);for(let P=0;P<w.polygonSegLen;P++){const M=w.polygonSegIdx+P;n.push({centroidIdx:v,subtile:C,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const o=new Gs;n.sort((v,w)=>v.triangleSegmentIdx===w.triangleSegmentIdx?v.subtile-w.subtile:v.triangleSegmentIdx-w.triangleSegmentIdx);let u=0,h=0,p=0;for(const v of n){if(v.triangleSegmentIdx!==u)break;p++}const m=n.length;for(;h!==n.length;){u=n[h].triangleSegmentIdx;let v=0,w=h,E=h;for(let C=w;C<p&&n[C].subtile===v;C++)E++;for(;w!==p;){const C=n[w];v=C.subtile;const P=this.centroidData[C.centroidIdx].min.clone(),M=this.centroidData[C.centroidIdx].max.clone(),z={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let j=w;j<E;j++){const V=n[j],$=this.polygonSegments[V.polygonSegmentIdx],Y=this.centroidData[V.centroidIdx].min,me=this.centroidData[V.centroidIdx].max,pe=this.indexArray.uint16;for(let ge=$.triangleArrayOffset;ge<$.triangleArrayOffset+$.triangleCount;ge++)o.emplaceBack(pe[3*ge],pe[3*ge+1],pe[3*ge+2]);z.primitiveLength+=$.triangleCount,P.x=Math.min(P.x,Y.x),P.y=Math.min(P.y,Y.y),M.x=Math.max(M.x,me.x),M.y=Math.max(M.y,me.y)}z.primitiveLength>0&&this.triangleSubSegments.push({segment:z,min:P,max:M}),w=E;for(let j=w;j<p&&n[j].subtile===n[w].subtile;j++)E++}h=p;for(let C=h;C<m&&n[C].triangleSegmentIdx===n[h].triangleSegmentIdx;C++)p++}o._trim(),this.indexArray=o}getVisibleSegments(n,o,u){const h=new Ei;if(this.wallMode){for(const V of this.triangleSubSegments)h.segments.push(V.segment);return h}let p=0,m=0;const v=1<<n.canonical.z;if(o){const V=o.getMinMaxForTile(n);V&&(p=V.min,m=V.max)}m+=this.maxHeight;const w=n.toUnwrapped();let E;const C=[w.canonical.x/v+w.wrap,w.canonical.y/v],P=[(w.canonical.x+1)/v+w.wrap,(w.canonical.y+1)/v],M=(V,$,Y)=>[V[0]*(1-Y[0])+$[0]*Y[0],V[1]*(1-Y[1])+$[1]*Y[1]],z=[],j=[];for(const V of this.triangleSubSegments){z[0]=V.min.x/zt,z[1]=V.min.y/zt,j[0]=V.max.x/zt,j[1]=V.max.y/zt;const $=M(C,P,z),Y=M(C,P,j);if(new gi([$[0],$[1],p],[Y[0],Y[1],m]).intersectsPrecise(u)===0){E&&(h.segments.push(E),E=void 0);continue}const me=V.segment;E&&E.vertexOffset!==me.vertexOffset&&(h.segments.push(E),E=void 0),E?(E.vertexLength+=me.vertexLength,E.primitiveLength+=me.primitiveLength):E={vertexOffset:me.vertexOffset,primitiveLength:me.primitiveLength,vertexLength:me.vertexLength,primitiveOffset:me.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&h.segments.push(E),h}encodeCentroid(n,o){const u=n.centroid(),h=o.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Ft(Yn(u.x,1,zt-1)<<3|p,Yn(u.y,1,zt-1)<<3|m)}encodeBorderCentroid(n){if(!n.borders)return new Ft(0,0);const o=n.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const h=o[0][0]!==u?0:1;return new Ft(6|(o[0][0]!==u?0:65528),(o[h][0]+o[h][1])/2<<3|6)}{const h=o[2][0]!==u?2:3;return new Ft((o[h][0]+o[h][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(n){const o=this.centroidData[n.centroidDataIndex];o.flags&=Wd,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const o=n.vertexArrayOffset,u=n.vertexCount+n.vertexArrayOffset,h=n.flags&Wd?rN:n.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==h.y||p!==h.x){for(let m=o;m<u;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(n.toUnwrapped());if(WP(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<u)continue;const v=Math.pow(2,m.footprintTileId.canonical.z-n.canonical.z);for(const w of this.centroidData)if(!(w.flags&Wd||m.min.x>w.max.x||w.min.x>m.max.x||m.min.y>w.max.y||w.min.y>m.max.y))for(let E=0;E<w.footprintSegLen;E++){const C=this.footprintSegments[w.footprintSegIdx+E];if(p.length=0,xQ(this.footprintVertices,C.vertexOffset,C.vertexCount,m.footprintTileId.canonical,n.canonical,p),Gz(m.footprint,p,this.footprintIndices.uint16,C.indexOffset,C.indexCount,-C.vertexOffset,-v)){w.flags|=Wd;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,o,u){let h=!1;for(let p=0;p<u.footprintSegLen;p++){const m=this.footprintSegments[u.footprintSegIdx+p];let v=0;for(const w of m.ringIndices){for(let E=v,C=w+v-1;E<w+v;C=E++){const P=this.footprintVertices.int16[2*(E+m.vertexOffset)+0],M=this.footprintVertices.int16[2*(E+m.vertexOffset)+1],z=this.footprintVertices.int16[2*(C+m.vertexOffset)+1];M>o!=z>o&&n<(this.footprintVertices.int16[2*(C+m.vertexOffset)+0]-P)*(o-M)/(z-M)+P&&(h=!h)}v=w}}return h}getHeightAtTileCoord(n,o){let u=Number.NEGATIVE_INFINITY,h=!0;const p=4*(n+zt)*zt+(o+zt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&Wd)}:void 0}for(const m of this.centroidData)n>m.max.x||m.min.x>n||o>m.max.y||m.min.y>o||this.footprintContainsPoint(n,o,m)&&m&&m.height>u&&(u=m.height,this.partLookup[p]=m,h=!!(m.flags&Wd));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[p]=void 0}}function cN(i,n){const o=i.add(n)._unit();return i.x*o.x+i.y*o.y}function vQ(i,n,o,u){const h=n.sub(i)._perp()._unit(),p=o.sub(n)._perp()._unit();return uN(i,n,o,cN(h,p),u)}function uN(i,n,o,u,h){const p=Math.sqrt(1-u*u);return Math.min(i.dist(n)/3,n.dist(o)/3,h*p/u)}function HP(i,n,o){return i.x<o[0].x&&n.x<o[0].x||i.x>o[1].x&&n.x>o[1].x||i.y<o[0].y&&n.y<o[0].y||i.y>o[1].y&&n.y>o[1].y}function hN(i,n){return i.x<n[0].x||i.x>n[1].x||i.y<n[0].y||i.y>n[1].y}function dN(i,n,o){if(i.x<0||i.x>=zt||n.x<0||n.x>=zt||o.x<0||o.x>=zt)return!1;const u=o.sub(n),h=u.perp(),p=i.sub(n);return(u.x*p.x+u.y*p.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function fN(i,n,o){const u=n?2|i:-3&i;return o?1|u:-2&u}function pN(){const i=Math.PI/32,n=Math.tan(i),o=t_;return o*Math.sqrt(1+2*n*n)-o}function mN(i,n,o){const u=1<<o.z,h=ya(o.x/u),p=ya((o.x+1)/u),m=eo(o.y/u),v=eo((o.y+1)/u);return function(w,E,C,P,M=0,z){const j=[];if(!w.length||!C||!P)return j;const V=(Re,ze)=>{for(const Ge of Re)j.push({polygon:Ge,bounds:ze})},$=Math.ceil(Math.log2(C)),Y=Math.ceil(Math.log2(P)),me=$-Y,pe=[];for(let Re=0;Re<Math.abs(me);Re++)pe.push(me>0?0:1);for(let Re=0;Re<Math.min($,Y);Re++)pe.push(0),pe.push(1);let ge=w;if(ge=Uw(ge,E[0].y-M,E[1].y+M,1),ge=Uw(ge,E[0].x-M,E[1].x+M,0),!ge.length)return j;const Pe=[];for(pe.length?Pe.push({polygons:ge,bounds:E,depth:0}):V(ge,E);Pe.length;){const Re=Pe.pop(),ze=Re.depth,Ge=pe[ze],Ke=Re.bounds[0],it=Re.bounds[1],Je=Ge===0?Ke.x:Ke.y,ut=Ge===0?it.x:it.y,Ct=z?z(Ge,Je,ut):.5*(Je+ut),ht=Uw(Re.polygons,Je-M,Ct+M,Ge),Mt=Uw(Re.polygons,Ct-M,ut+M,Ge);if(ht.length){const lt=[Ke,new Ft(Ge===0?Ct:it.x,Ge===1?Ct:it.y)];pe.length>ze+1?Pe.push({polygons:ht,bounds:lt,depth:ze+1}):V(ht,lt)}if(Mt.length){const lt=[new Ft(Ge===0?Ct:Ke.x,Ge===1?Ct:Ke.y),it];pe.length>ze+1?Pe.push({polygons:Mt,bounds:lt,depth:ze+1}):V(Mt,lt)}}return j}(i,n,Math.ceil((p-h)/11.25),Math.ceil((m-v)/11.25),1,(w,E,C)=>{if(w===0)return .5*(E+C);{const P=eo((o.y+E/zt)/u);return(gu(.5*(eo((o.y+C/zt)/u)+P))*u-o.y)*zt}})}function xQ(i,n,o,u,h,p){const m=Math.pow(2,u.z-h.z);for(let v=0;v<o;v++){let w=i.int16[2*(v+n)+0],E=i.int16[2*(v+n)+1];w=(w+h.x*zt)*m-u.x*zt,E=(E+h.y*zt)*m-u.y*zt,p.push(new Ft(w,E))}}let gN,_N;function pv(i,n){return i.x*n.x+i.y*n.y}function yN(i,n){if(i.length===1){let o=0;const u=n[o++];let h;for(;!h||u.equals(h);)if(h=n[o++],!h)return 1/0;for(;o<n.length;o++){const p=n[o],m=i[0],v=h.sub(u),w=p.sub(u),E=m.sub(u),C=pv(v,v),P=pv(v,w),M=pv(w,w),z=pv(E,v),j=pv(E,w),V=C*M-P*P,$=(M*z-P*j)/V,Y=(C*j-P*z)/V,me=u.z*(1-$-Y)+h.z*$+p.z*Y;if(isFinite(me))return me}return 1/0}{let o=1/0;for(const u of n)o=Math.min(o,u.z);return o}}function vN(i,n,o,u,h,p,m,v){const w=m*h.getElevationAt(i,n,!0,!0),E=p[0]!==0,C=E?p[1]===0?m*(p[0]/7-450):m*function(P,M,z){const j=Math.floor(M[0]/8),V=Math.floor(M[1]/8),$=10*(M[0]-8*j),Y=10*(M[1]-8*V),me=P.getElevationAt(j,V,!0,!0),pe=P.getMeterToDEM(z),ge=Math.floor(.5*($*pe-1)),Pe=Math.floor(.5*(Y*pe-1)),Re=P.tileCoordToPixel(j,V),ze=2*ge+1,Ge=2*Pe+1,Ke=function(Mt,lt,xt,Ot,ft){return[Mt.getElevationAtPixel(lt,xt,!0),Mt.getElevationAtPixel(lt+ft,xt,!0),Mt.getElevationAtPixel(lt,xt+ft,!0),Mt.getElevationAtPixel(lt+Ot,xt+ft,!0)]}(P,Re.x-ge,Re.y-Pe,ze,Ge),it=Math.abs(Ke[0]-Ke[1]),Je=Math.abs(Ke[2]-Ke[3]),ut=Math.abs(Ke[0]-Ke[2])+Math.abs(Ke[1]-Ke[3]),Ct=Math.min(.25,.5*pe*(it+Je)/ze),ht=Math.min(.25,.5*pe*ut/Ge);return me+Math.max(Ct*$,ht*Y)}(h,p,v):w;return{base:w+(o===0)?-1:o,top:E?Math.max(C+u,w+o+2):w+u}}qe(Ww,"FillExtrusionBucket",{omit:["layers","features"]}),qe(sN,"PartData"),qe(iN,"FootprintSegment"),qe(oN,"BorderCentroidData"),qe(lN,"GroundEffect");const bQ=kr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:wQ}=bQ,TQ=kr([{name:"a_packed",components:4,type:"Float32"}]),{members:EQ}=TQ,SQ=kr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:IQ}=SQ,CQ=kr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),AQ=kr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),PQ=kr([{name:"a_projected_pos",components:4,type:"Float32"}],4);kr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xN=kr([{name:"a_z_offset",components:1,type:"Float32"}],4),RQ=kr([{name:"a_texb",components:2,type:"Uint16"}]),MQ=kr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),kQ=kr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);kr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const bN=kr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),DQ=kr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);kr([{name:"triangle",components:3,type:"Uint16"}]),kr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),kr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),kr([{type:"Float32",name:"offsetX"}]),kr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class wN{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new qd({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const u=this.getKey(n,o);return this.positions[u]}trim(){const n=this.width,o=this.height=Pa(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,u){const h=[];let p=n.length%2==1?-n[n.length-1]*u:0,m=n[0]*u,v=!0;h.push({left:p,right:m,isDash:v,zeroLength:n[0]===0});let w=n[0];for(let E=1;E<n.length;E++){v=!v;const C=n[E];p=w*u,w+=C,m=w*u,h.push({left:p,right:m,isDash:v,zeroLength:C===0})}return h}addRoundDash(n,o,u){const h=o/2;for(let p=-u;p<=u;p++){const m=this.width*(this.nextRow+u+p);let v=0,w=n[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=n[++v]);const C=Math.abs(E-w.left),P=Math.abs(E-w.right),M=Math.min(C,P);let z;const j=p/u*(h+1);if(w.isDash){const V=h-Math.abs(j);z=Math.sqrt(M*M+V*V)}else z=h-Math.sqrt(M*M+j*j);this.image.data[m+E]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(n,o){for(let w=n.length-1;w>=0;--w){const E=n[w],C=n[w+1];E.zeroLength?n.splice(w,1):C&&C.isDash===E.isDash&&(C.left=E.left,n.splice(w,1))}const u=n[0],h=n[n.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const p=this.width*this.nextRow;let m=0,v=n[m];for(let w=0;w<this.width;w++){w/v.right>1&&(v=n[++m]);const E=Math.abs(w-v.left),C=Math.abs(w-v.right),P=Math.min(E,C);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?P:-P)+o+128))}}addDash(n,o){const u=this.getKey(n,o);if(this.positions[u])return this.positions[u];const h=o==="round",p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return Pi("LineAtlas out of space"),null;n.length===0&&n.push(1);let v=0;for(let C=0;C<n.length;C++)n[C]<0&&(Pi("Negative value is found in line dasharray, replacing values with 0"),n[C]=0),v+=n[C];if(v!==0){const C=this.width/v,P=this.getDashRanges(n,this.width,C);h?this.addRoundDash(P,C,p):this.addRegularDash(P,o==="square"?.5*C:0)}const w=this.nextRow+p;this.nextRow+=m;const E={tl:[w,p],br:[v,0]};return this.positions[u]=E,E}}qe(wN,"LineAtlas");const OQ=jw.types,LQ=Math.cos(Math.PI/180*37.5),zQ=Math.cos(Math.PI/180*5);class Hw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new YA,this.layoutVertexArray2=new zd,this.patternVertexArray=new Nd,this.indexArray=new Gs,this.programConfigurations=new Ud(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Ei,this.maxLineLength=0,this.zOffsetVertexArray=new Qg,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:zt/64}updateFootprints(n,o){}populate(n,o,u,h){this.hasPattern=UP("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),m=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!m.isConstant()||!!m.constantOr(0);const v=[];for(const{feature:P,id:M,index:z,sourceLayerIndex:j}of n){const V=this.layers[0]._featureFilter.needGeometry,$=wh(P,V);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom),$,u))continue;const Y=p?p.evaluate($,{},u):void 0,me={id:M,properties:P.properties,type:P.type,sourceLayerIndex:j,index:z,geometry:V?$.geometry:Sc(P,u,h),patterns:{},sortKey:Y};v.push(me)}p&&v.sort((P,M)=>P.sortKey-M.sortKey);const{lineAtlas:w,featureIndex:E}=o,C=this.addConstantDashes(w);for(const P of v){const{geometry:M,index:z,sourceLayerIndex:j}=P;if(C&&this.addFeatureDashes(P,w),this.hasPattern){const V=VP("line",this.layers,P,this.zoom,o);this.patternFeatures.push(V)}else this.addFeature(P,M,z,u,w.positions,o.availableImages,o.brightness);E.insert(n[z].feature,M,z,j,this.index)}}addConstantDashes(n){let o=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")o=!0;else{const m=p.value,v=h.value;if(!v)continue;n.addDash(v,m)}}return o}addFeatureDashes(n,o){const u=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let v,w;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:u},n);w=m.kind==="constant"?m.value:m.evaluate({zoom:u},n),o.addDash(v,w),n.patterns[h.id]=o.getKey(v,w)}}update(n,o,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,u,h,p)}addFeatures(n,o,u,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,u,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,EQ)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,IQ)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,xN.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,wQ),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,u,h,p,m,v){const w=this.layers[0].layout,E=w.get("line-join").evaluate(n,{}),C=w.get("line-cap").evaluate(n,{}),P=w.get("line-miter-limit"),M=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const z of o)this.addLine(z,n,h,E,C,P,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,v)}addLine(n,o,u,h,p,m,v){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const w={zoom:this.zoom,lineProgress:void 0},E=this.layers[0].layout,C=h==="none";if(this.patternJoinNone=this.hasPattern&&C,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Re=0;Re<n.length-1;Re++)this.totalDistance+=n[Re].dist(n[Re+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=OQ[o.type]==="Polygon";let M=n.length;for(;M>=2&&n[M-1].equals(n[M-2]);)M--;let z=0;for(;z<M-1&&n[z].equals(n[z+1]);)z++;if(M<(P?3:2))return;h==="bevel"&&(m=1.05);const j=this.overscaling<=16?15*zt/(512*this.overscaling):0,V=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let $,Y,me,pe,ge,Pe;this.e1=this.e2=-1,P&&($=n[M-2],ge=n[z].sub($)._unit()._perp());for(let Re=z;Re<M;Re++){if(me=Re===M-1?P?n[z+1]:void 0:n[Re+1],me&&n[Re].equals(me))continue;if(ge&&(pe=ge),$&&(Y=$),$=n[Re],this.hasZOffset){const lt=E.get("line-z-offset").value;if(lt.kind==="constant")Pe=lt.value;else{if(this.lineClips){const xt=this.totalDistance/(this.lineClips.end-this.lineClips.start);w.lineProgress=(xt*this.lineClips.start+this.distance+(Y?Y.dist($):0))/xt}else Pi(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),w.lineProgress=0;Pe=lt.evaluate(w,o)}Pe=Pe||0}ge=me?me.sub($)._unit()._perp():pe,pe=pe||ge;const ze=Y&&me;let Ge=ze?h:P||C?"butt":p;const Ke=pe.x*ge.x+pe.y*ge.y;if(C){const lt=function(xt){if(xt.patternJoinNone){const Ot=xt.segmentPoints.length/2,ft=xt.lineSoFar-xt.segmentStart;for(let jt=0;jt<Ot;++jt){const Dt=xt.segmentPoints[2*jt+1],Pt=Math.round(xt.segmentPoints[2*jt])+.5+.25*Dt;xt.patternVertexArray.emplaceBack(Pt,ft,xt.segmentStart),xt.patternVertexArray.emplaceBack(Pt,ft,xt.segmentStart)}xt.segmentPoints.length=0}xt.e1=xt.e2=-1};if(ze&&Ke<zQ){this.updateDistance(Y,$),this.addCurrentVertex($,pe,1,1,V,Pe),lt(this),this.addCurrentVertex($,ge,-1,-1,V,Pe);continue}if(Y){if(!me){this.updateDistance(Y,$),this.addCurrentVertex($,pe,1,1,V,Pe),lt(this);continue}Ge="miter"}}let it=pe.add(ge);it.x===0&&it.y===0||it._unit();const Je=it.x*ge.x+it.y*ge.y,ut=Je!==0?1/Je:1/0,Ct=2*Math.sqrt(2-2*Je),ht=Je<LQ&&Y&&me,Mt=pe.x*ge.y-pe.y*ge.x>0;if(ht&&Re>z){const lt=$.dist(Y);if(lt>2*j){const xt=$.sub($.sub(Y)._mult(j/lt)._round());this.updateDistance(Y,xt),this.addCurrentVertex(xt,pe,0,0,V,Pe),Y=xt}}if(ze&&Ge==="round"&&(ut<v?Ge="miter":ut<=2&&(Ge="fakeround")),Ge==="miter"&&ut>m&&(Ge="bevel"),Ge==="bevel"&&(ut>2&&(Ge="flipbevel"),ut<m&&(Ge="miter")),Y&&this.updateDistance(Y,$),Ge==="miter")it._mult(ut),this.addCurrentVertex($,it,0,0,V,Pe);else if(Ge==="flipbevel"){if(ut>100)it=ge.mult(-1);else{const lt=ut*pe.add(ge).mag()/pe.sub(ge).mag();it._perp()._mult(lt*(Mt?-1:1))}this.addCurrentVertex($,it,0,0,V,Pe),this.addCurrentVertex($,it.mult(-1),0,0,V,Pe)}else if(Ge==="bevel"||Ge==="fakeround"){const lt=-Math.sqrt(ut*ut-1),xt=Mt?lt:0,Ot=Mt?0:lt;if(Y&&this.addCurrentVertex($,pe,xt,Ot,V,Pe),Ge==="fakeround"){const ft=Math.round(180*Ct/Math.PI/20);for(let jt=1;jt<ft;jt++){let Dt=jt/ft;if(Dt!==.5){const vn=Dt-.5;Dt+=Dt*vn*(Dt-1)*((1.0904+Ke*(Ke*(3.55645-1.43519*Ke)-3.2452))*vn*vn+(.848013+Ke*(.215638*Ke-1.06021)))}const Pt=ge.sub(pe)._mult(Dt)._add(pe)._unit()._mult(Mt?-1:1);this.addHalfVertex($,Pt.x,Pt.y,!1,Mt,0,V,Pe)}}me&&this.addCurrentVertex($,ge,-xt,-Ot,V,Pe)}else Ge==="butt"?this.addCurrentVertex($,it,0,0,V,Pe):Ge==="square"?(Y||this.addCurrentVertex($,it,-1,-1,V,Pe),this.addCurrentVertex($,it,0,0,V,Pe),Y&&this.addCurrentVertex($,it,1,1,V,Pe)):Ge==="round"&&(Y&&(this.addCurrentVertex($,pe,0,0,V,Pe),this.addCurrentVertex($,pe,1,1,V,Pe,!0)),me&&(this.addCurrentVertex($,ge,-1,-1,V,Pe,!0),this.addCurrentVertex($,ge,0,0,V,Pe)));if(ht&&Re<M-1){const lt=$.dist(me);if(lt>2*j){const xt=$.add(me.sub($)._mult(j/lt)._round());this.updateDistance($,xt),this.addCurrentVertex(xt,ge,0,0,V,Pe),$=xt}}}}addVerticesTo(n,o,u,h,p,m,v,w,E,C){const P=(o.w-n.w)/this.tessellationStep|0;if(P>1){this.lineSoFar=n.w;const M=(o.x-n.x)/P,z=(o.y-n.y)/P,j=(o.z-n.z)/P,V=(o.w-n.w)/P;for(let $=1;$<P;++$)n.x+=M,n.y+=z,n.z+=j,this.lineSoFar+=V,this.addHalfVertex(n,u,h,C,!1,v,E,n.z),this.addHalfVertex(n,p,m,C,!0,-w,E,n.z)}this.lineSoFar=o.w,this.addHalfVertex(o,u,h,C,!1,v,E,o.z),this.addHalfVertex(o,p,m,C,!0,-w,E,o.z)}addCurrentVertex(n,o,u,h,p,m,v=!1){const w=o.x+o.y*u,E=o.y-o.x*u,C=o.y*h-o.x,P=-o.y-o.x*h;if(m!=null){const z=zt+10,j=m,V=new Bz(n.x,n.y,j,this.lineSoFar),$=TN(n,-10,z),Y=this.lineSoFar;if(this.currentVertex)if($){const me=this.currentVertexIsOutside,pe=this.currentVertex,ge=new Bz(n.x,n.y,j,this.lineSoFar);Uz(pe,ge,-10,z),TN(ge,-10,z)||(me&&(this.e1=this.e2=-1,this.lineSoFar=pe.w,this.addHalfVertex(pe,w,E,v,!1,u,p,pe.z),this.addHalfVertex(pe,C,P,v,!0,-h,p,pe.z)),this.addVerticesTo(pe,ge,w,E,C,P,u,h,p,v))}else{const me=this.currentVertex;this.currentVertexIsOutside&&(Uz(me,V,-10,z),this.e1=this.e2=-1,this.lineSoFar=me.w,this.addHalfVertex(me,w,E,v,!1,u,p,me.z),this.addHalfVertex(me,C,P,v,!0,-h,p,me.z)),this.addVerticesTo(me,V,w,E,C,P,u,h,p,v)}else $||(this.addHalfVertex(n,w,E,v,!1,u,p,m),this.addHalfVertex(n,C,P,v,!0,-h,p,m));this.currentVertex=V,this.currentVertexIsOutside=$,this.lineSoFar=Y}else this.addHalfVertex(n,w,E,v,!1,u,p,m),this.addHalfVertex(n,C,P,v,!0,-h,p,m)}addHalfVertex({x:n,y:o},u,h,p,m,v,w,E){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((n<<1)+(p?1:0),(o<<1)+(m?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),m?this.e2=C:this.e1=C,E!=null&&this.zOffsetVertexArray.emplaceBack(E)}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,o){this.distance+=n.dist(o),this.updateScaledDistance()}}function TN(i,n,o){return i.x<n||i.x>o||i.y<n||i.y>o}let EN,SN;function IN(i,n,o){return n*(zt/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}function CN(i,n){return 1/IN(i,1,n.tileZoom)}function AN(i,n,o,u){return i.translatePosMatrix(u||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}qe(Hw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const PN=i=>{const n=[];RN(i)&&n.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const o=i.paint.get("line-trim-offset");o[0]===0&&o[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const u=i.layout.get("line-join").constantOr("miter")==="none",h=!!i.paint.get("line-pattern").constantOr(1);return u&&h&&n.push("LINE_JOIN_NONE"),n};function RN(i){const n=i.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}class MN{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const u=n[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}var NQ={read:function(i,n,o,u,h){var p,m,v=8*h-u-1,w=(1<<v)-1,E=w>>1,C=-7,P=o?h-1:0,M=o?-1:1,z=i[n+P];for(P+=M,p=z&(1<<-C)-1,z>>=-C,C+=v;C>0;p=256*p+i[n+P],P+=M,C-=8);for(m=p&(1<<-C)-1,p>>=-C,C+=u;C>0;m=256*m+i[n+P],P+=M,C-=8);if(p===0)p=1-E;else{if(p===w)return m?NaN:1/0*(z?-1:1);m+=Math.pow(2,u),p-=E}return(z?-1:1)*m*Math.pow(2,p-u)},write:function(i,n,o,u,h,p){var m,v,w,E=8*p-h-1,C=(1<<E)-1,P=C>>1,M=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=u?0:p-1,j=u?1:-1,V=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(v=isNaN(n)?1:0,m=C):(m=Math.floor(Math.log(n)/Math.LN2),n*(w=Math.pow(2,-m))<1&&(m--,w*=2),(n+=m+P>=1?M/w:M*Math.pow(2,1-P))*w>=2&&(m++,w/=2),m+P>=C?(v=0,m=C):m+P>=1?(v=(n*w-1)*Math.pow(2,h),m+=P):(v=n*Math.pow(2,P-1)*Math.pow(2,h),m=0));h>=8;i[o+z]=255&v,z+=j,v/=256,h-=8);for(m=m<<h|v,E+=h;E>0;i[o+z]=255&m,z+=j,m/=256,E-=8);i[o+z-j]|=128*V}},kN=_i,Zw=NQ;function _i(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}_i.Varint=0,_i.Fixed64=1,_i.Bytes=2,_i.Fixed32=5;var ZP=4294967296,DN=1/ZP,ON=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Sh(i){return i.type===_i.Bytes?i.readVarint()+i.pos:i.pos+1}function l_(i,n,o){return o?4294967296*n+(i>>>0):4294967296*(n>>>0)+(i>>>0)}function LN(i,n,o){var u=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(u);for(var h=o.pos-1;h>=i;h--)o.buf[h+u]=o.buf[h]}function FQ(i,n){for(var o=0;o<i.length;o++)n.writeVarint(i[o])}function BQ(i,n){for(var o=0;o<i.length;o++)n.writeSVarint(i[o])}function jQ(i,n){for(var o=0;o<i.length;o++)n.writeFloat(i[o])}function UQ(i,n){for(var o=0;o<i.length;o++)n.writeDouble(i[o])}function VQ(i,n){for(var o=0;o<i.length;o++)n.writeBoolean(i[o])}function $Q(i,n){for(var o=0;o<i.length;o++)n.writeFixed32(i[o])}function qQ(i,n){for(var o=0;o<i.length;o++)n.writeSFixed32(i[o])}function GQ(i,n){for(var o=0;o<i.length;o++)n.writeFixed64(i[o])}function WQ(i,n){for(var o=0;o<i.length;o++)n.writeSFixed64(i[o])}function Xw(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+16777216*i[n+3]}function c_(i,n,o){i[o]=n,i[o+1]=n>>>8,i[o+2]=n>>>16,i[o+3]=n>>>24}function zN(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+(i[n+3]<<24)}_i.prototype={destroy:function(){this.buf=null},readFields:function(i,n,o){for(o=o||this.length;this.pos<o;){var u=this.readVarint(),h=u>>3,p=this.pos;this.type=7&u,i(h,n,this),this.pos===p&&this.skip(u)}return n},readMessage:function(i,n){return this.readFields(i,n,this.readVarint()+this.pos)},readFixed32:function(){var i=Xw(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=zN(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Xw(this.buf,this.pos)+Xw(this.buf,this.pos+4)*ZP;return this.pos+=8,i},readSFixed64:function(){var i=Xw(this.buf,this.pos)+zN(this.buf,this.pos+4)*ZP;return this.pos+=8,i},readFloat:function(){var i=Zw.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Zw.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var n,o,u=this.buf;return n=127&(o=u[this.pos++]),o<128?n:(n|=(127&(o=u[this.pos++]))<<7,o<128?n:(n|=(127&(o=u[this.pos++]))<<14,o<128?n:(n|=(127&(o=u[this.pos++]))<<21,o<128?n:function(h,p,m){var v,w,E=m.buf;if(v=(112&(w=E[m.pos++]))>>4,w<128||(v|=(127&(w=E[m.pos++]))<<3,w<128)||(v|=(127&(w=E[m.pos++]))<<10,w<128)||(v|=(127&(w=E[m.pos++]))<<17,w<128)||(v|=(127&(w=E[m.pos++]))<<24,w<128)||(v|=(1&(w=E[m.pos++]))<<31,w<128))return l_(h,v,p);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(o=u[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,n=this.pos;return this.pos=i,i-n>=12&&ON?function(o,u,h){return ON.decode(o.subarray(u,h))}(this.buf,n,i):function(o,u,h){for(var p="",m=u;m<h;){var v,w,E,C=o[m],P=null,M=C>239?4:C>223?3:C>191?2:1;if(m+M>h)break;M===1?C<128&&(P=C):M===2?(192&(v=o[m+1]))==128&&(P=(31&C)<<6|63&v)<=127&&(P=null):M===3?(w=o[m+2],(192&(v=o[m+1]))==128&&(192&w)==128&&((P=(15&C)<<12|(63&v)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):M===4&&(w=o[m+2],E=o[m+3],(192&(v=o[m+1]))==128&&(192&w)==128&&(192&E)==128&&((P=(15&C)<<18|(63&v)<<12|(63&w)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,M=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),m+=M}return p}(this.buf,n,i)},readBytes:function(){var i=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,i);return this.pos=i,n},readPackedVarint:function(i,n){if(this.type!==_i.Bytes)return i.push(this.readVarint(n));var o=Sh(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(n));return i},readPackedSVarint:function(i){if(this.type!==_i.Bytes)return i.push(this.readSVarint());var n=Sh(this);for(i=i||[];this.pos<n;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==_i.Bytes)return i.push(this.readBoolean());var n=Sh(this);for(i=i||[];this.pos<n;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==_i.Bytes)return i.push(this.readFloat());var n=Sh(this);for(i=i||[];this.pos<n;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==_i.Bytes)return i.push(this.readDouble());var n=Sh(this);for(i=i||[];this.pos<n;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==_i.Bytes)return i.push(this.readFixed32());var n=Sh(this);for(i=i||[];this.pos<n;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==_i.Bytes)return i.push(this.readSFixed32());var n=Sh(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==_i.Bytes)return i.push(this.readFixed64());var n=Sh(this);for(i=i||[];this.pos<n;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==_i.Bytes)return i.push(this.readSFixed64());var n=Sh(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed64());return i},skip:function(i){var n=7&i;if(n===_i.Varint)for(;this.buf[this.pos++]>127;);else if(n===_i.Bytes)this.pos=this.readVarint()+this.pos;else if(n===_i.Fixed32)this.pos+=4;else{if(n!==_i.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(i,n){this.writeVarint(i<<3|n)},realloc:function(i){for(var n=this.length||16;n<this.pos+i;)n*=2;if(n!==this.length){var o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),c_(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),c_(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),c_(this.buf,-1&i,this.pos),c_(this.buf,Math.floor(i*DN),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),c_(this.buf,-1&i,this.pos),c_(this.buf,Math.floor(i*DN),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(n,o){var u,h;if(n>=0?(u=n%4294967296|0,h=n/4294967296|0):(h=~(-n/4294967296),4294967295^(u=~(-n%4294967296))?u=u+1|0:(u=0,h=h+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(p,m,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(u,0,o),function(p,m){var v=(7&p)<<4;m.buf[m.pos++]|=v|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(h,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var n=this.pos;this.pos=function(u,h,p){for(var m,v,w=0;w<h.length;w++){if((m=h.charCodeAt(w))>55295&&m<57344){if(!v){m>56319||w+1===h.length?(u[p++]=239,u[p++]=191,u[p++]=189):v=m;continue}if(m<56320){u[p++]=239,u[p++]=191,u[p++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(u[p++]=239,u[p++]=191,u[p++]=189,v=null);m<128?u[p++]=m:(m<2048?u[p++]=m>>6|192:(m<65536?u[p++]=m>>12|224:(u[p++]=m>>18|240,u[p++]=m>>12&63|128),u[p++]=m>>6&63|128),u[p++]=63&m|128)}return p}(this.buf,i,this.pos);var o=this.pos-n;o>=128&&LN(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),Zw.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Zw.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var n=i.length;this.writeVarint(n),this.realloc(n);for(var o=0;o<n;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,n){this.pos++;var o=this.pos;i(n,this);var u=this.pos-o;u>=128&&LN(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeMessage:function(i,n,o){this.writeTag(i,_i.Bytes),this.writeRawMessage(n,o)},writePackedVarint:function(i,n){n.length&&this.writeMessage(i,FQ,n)},writePackedSVarint:function(i,n){n.length&&this.writeMessage(i,BQ,n)},writePackedBoolean:function(i,n){n.length&&this.writeMessage(i,VQ,n)},writePackedFloat:function(i,n){n.length&&this.writeMessage(i,jQ,n)},writePackedDouble:function(i,n){n.length&&this.writeMessage(i,UQ,n)},writePackedFixed32:function(i,n){n.length&&this.writeMessage(i,$Q,n)},writePackedSFixed32:function(i,n){n.length&&this.writeMessage(i,qQ,n)},writePackedFixed64:function(i,n){n.length&&this.writeMessage(i,GQ,n)},writePackedSFixed64:function(i,n){n.length&&this.writeMessage(i,WQ,n)},writeBytesField:function(i,n){this.writeTag(i,_i.Bytes),this.writeBytes(n)},writeFixed32Field:function(i,n){this.writeTag(i,_i.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(i,n){this.writeTag(i,_i.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(i,n){this.writeTag(i,_i.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(i,n){this.writeTag(i,_i.Fixed64),this.writeSFixed64(n)},writeVarintField:function(i,n){this.writeTag(i,_i.Varint),this.writeVarint(n)},writeSVarintField:function(i,n){this.writeTag(i,_i.Varint),this.writeSVarint(n)},writeStringField:function(i,n){this.writeTag(i,_i.Bytes),this.writeString(n)},writeFloatField:function(i,n){this.writeTag(i,_i.Fixed32),this.writeFloat(n)},writeDoubleField:function(i,n){this.writeTag(i,_i.Fixed64),this.writeDouble(n)},writeBooleanField:function(i,n){this.writeVarintField(i,!!n)}};var mv=fe(kN);const HQ=["id","tile","layer","source","sourceLayer","state"];class NN{constructor(n,o,u,h,p){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=u,this._y=h,this.properties=n.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of HQ)this[o]!==void 0&&(n[o]=this[o]);return n}}class ZQ{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,u){const h=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][h]=this.stateChanges[n][h]||{},ks(this.stateChanges[n][h],u),this.deletedStates[n]===null){this.deletedStates[n]={};for(const p in this.state[n])p!==h&&(this.deletedStates[n][p]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][h]===null){this.deletedStates[n][h]={};for(const p in this.state[n][h])u[p]||(this.deletedStates[n][h][p]=null)}else for(const p in u)this.deletedStates[n]&&this.deletedStates[n][h]&&this.deletedStates[n][h][p]===null&&delete this.deletedStates[n][h][p]}removeFeatureState(n,o,u){if(this.deletedStates[n]===null)return;const h=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},u&&o!==void 0)this.deletedStates[n][h]!==null&&(this.deletedStates[n][h]=this.deletedStates[n][h]||{},this.deletedStates[n][h][u]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][h])for(u in this.deletedStates[n][h]={},this.stateChanges[n][h])this.deletedStates[n][h][u]=null;else this.deletedStates[n][h]=null;else this.deletedStates[n]=null}getState(n,o){const u=String(o),h=ks({},(this.state[n]||{})[u],(this.stateChanges[n]||{})[u]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const p=this.deletedStates[n][o];if(p===null)return{};for(const m in p)delete h[m]}return h}initializeTileState(n,o){n.setFeatureState(this.state,o)}coalesceChanges(n,o){const u={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),ks(this.state[h][m],this.stateChanges[h][m]),p[m]=this.state[h][m];u[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const m in this.state[h])p[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(const v of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][v];p[m]=this.state[h][m]}u[h]=u[h]||{},ks(u[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const h in n)n[h].setFeatureState(u,o)}}class FN{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new nt(zt,16,0),this.featureIndexArray=new DL,this.promoteId=o,this.is3DTile=!1}insert(n,o,u,h,p,m=0,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,p,m);const E=this.grid;for(let C=0;C<o.length;C++){const P=o[C],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<P.length;z++){const j=P[z];M[0]=Math.min(M[0],j.x),M[1]=Math.min(M[1],j.y),M[2]=Math.max(M[2],j.x),M[3]=Math.max(M[3],j.y)}v!==0&&(M[0]-=v,M[1]-=v,M[2]+=v,M[3]+=v),M[0]<zt&&M[1]<zt&&M[2]>=0&&M[3]>=0&&E.insert(w,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new qP(new mv(this.rawTileData)).layers,this.sourceLayerCoder=new MN(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o,u,h){this.loadVTLayers();const p=n.params||{},m=wc(p.filter),v=n.tileResult,w=n.transform,E=v.bufferedTilespaceBounds,C=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(j,V,$,Y)=>YL(v.bufferedTilespaceGeometry,j,V,$,Y));C.sort(XQ);let P=null;w.elevation&&C.length>0&&(P=a_.create(w.elevation,this.tileID));const M={};let z;for(let j=0;j<C.length;j++){const V=C[j];if(V===z)continue;z=V;const $=this.featureIndexArray.get(V);let Y=null;if(this.is3DTile){const me=this.bucketLayerIDs[0][0],pe=o[me];if(pe.type!=="model")continue;const{queryFeature:ge,intersectionZ:Pe}=pe.queryIntersectsMatchingFeature(v,$.featureIndex,m,w);ge&&this.appendToResult(M,me,$.featureIndex,ge,Pe)}else this.loadMatchingFeature(M,$,m,p.layers,p.availableImages,o,u,h,(me,pe,ge,Pe=0)=>(Y||(Y=Sc(me,this.tileID.canonical,n.tileTransform)),pe.queryIntersectsFeature(v,me,ge,Y,this.z,n.transform,n.pixelPosMatrix,P,Pe)))}return M}loadMatchingFeature(n,o,u,h,p,m,v,w,E){const{featureIndex:C,bucketIndex:P,sourceLayerIndex:M,layoutVertexArrayOffset:z}=o,j=this.bucketLayerIDs[P];if(h&&!function(me,pe){for(let ge=0;ge<me.length;ge++)if(pe.indexOf(me[ge])>=0)return!0;return!1}(h,j))return;const V=this.sourceLayerCoder.decode(M),$=this.vtLayers[V].feature(C);if(u.needGeometry){const me=wh($,!0);if(!u.filter(new Mn(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!u.filter(new Mn(this.tileID.overscaledZ),$))return;const Y=this.getId($,V);for(let me=0;me<j.length;me++){const pe=j[me];if(h&&h.indexOf(pe)<0)continue;const ge=m[pe];if(!ge)continue;let Pe={};Y!==void 0&&w&&(Pe=w.getState(ge.sourceLayer||"_geojsonTileLayer",Y));const Re=!E||E($,ge,Pe,z);if(!Re)continue;const ze=new NN($,this.z,this.x,this.y,Y),Ge=ks({},v[pe]);Ge.paint=BN(Ge.paint,ge.paint,$,Pe,p),Ge.layout=BN(Ge.layout,ge.layout,$,Pe,p),ze.layer=Ge,this.appendToResult(n,pe,C,ze,Re)}}appendToResult(n,o,u,h,p){let m=n[o];m===void 0&&(m=n[o]=[]),m.push({featureIndex:u,feature:h,intersectionZ:p})}lookupSymbolFeatures(n,o,u,h,p,m,v,w){const E={};this.loadVTLayers();const C=wc(p);for(const P of n)this.loadMatchingFeature(E,{bucketIndex:u,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},C,m,v,w,o);return E}loadFeature(n){const{featureIndex:o,sourceLayerIndex:u}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),p=this.vtFeatures[h];if(p[o])return p[o];const m=this.vtLayers[h].feature(o);return p[o]=m,m}hasLayer(n){for(const o of this.bucketLayerIDs)for(const u of o)if(n===u)return!0;return!1}getId(n,o){let u=n.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];h!=null&&(u=n.properties[h]),typeof u=="boolean"&&(u=Number(u))}return u}}function BN(i,n,o,u,h){return iu(i,(p,m)=>{const v=n instanceof Js?n.get(m):null;return v&&v.evaluate?v.evaluate(o,u,h):v})}function XQ(i,n){return n-i}qe(FN,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var fo=24;const Ic=128;function XP(i,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Mn(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:h}=o;let p=0;for(;p<u.length&&u[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<u.length&&u[m]<i+1;)m++;m=Math.min(u.length-1,m);const v=u[p],w=u[m];return o.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:o.evaluate(new Mn(v)),maxSize:o.evaluate(new Mn(w)),interpolationType:h}}}function Kw(i,{uSize:n,uSizeT:o},{lowerSize:u,upperSize:h}){return i.kind==="source"?u/Ic:i.kind==="composite"?Tn(u/Ic,h/Ic,o):n}function u_(i,n){let o=0,u=0;if(i.kind==="constant")u=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:m}=i,v=h?Yn(ga.interpolationFactor(h,n,p,m),0,1):0;i.kind==="camera"?u=Tn(i.minSize,i.maxSize,v):o=v}return{uSizeT:o,uSize:u}}var KQ=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ic,evaluateSizeForFeature:Kw,evaluateSizeForZoom:u_,getSizeData:XP});function QQ(i,n,o){return i.sections.forEach(u=>{u.text=function(h,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),or.applyArabicShaping&&(h=or.applyArabicShaping(h)),h}(u.text,n,o)}),i}const gv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function YQ(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function JQ(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}const KP=3;function eY(i,n,o){n.glyphs=[],i===1&&o.readMessage(tY,n)}function tY(i,n,o){if(i===3){const{id:u,bitmap:h,width:p,height:m,left:v,top:w,advance:E}=o.readMessage(nY,{});n.glyphs.push({id:u,bitmap:new qd({width:p+2*KP,height:m+2*KP},h),metrics:{width:p,height:m,left:v,top:w,advance:E}})}else i===4?n.ascender=o.readSVarint():i===5&&(n.descender=o.readSVarint())}function nY(i,n,o){i===1?n.id=o.readVarint():i===2?n.bitmap=o.readBytes():i===3?n.width=o.readVarint():i===4?n.height=o.readVarint():i===5?n.left=o.readSVarint():i===6?n.top=o.readSVarint():i===7&&(n.advance=o.readVarint())}const jN=KP,sl={horizontal:1,vertical:2,horizontalOnly:3};class _v{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,o){const u=new _v;return u.scale=n||1,u.fontStack=o,u}static forImage(n){const o=new _v;return o.imageName=n,o}}class h_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){const u=new h_;for(let h=0;h<n.sections.length;h++){const p=n.sections[h];p.image?u.addImageSection(p):u.addTextSection(p,o)}return u}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(o,u){let h="";for(let p=0;p<o.length;p++){const m=o.charCodeAt(p+1)||null,v=o.charCodeAt(p-1)||null;h+=!u&&(m&&ln(m)&&!gv[o[p+1]]||v&&ln(v)&&!gv[o[p-1]])||!gv[o[p]]?o[p]:gv[o[p]]}return h}(this.text,n)}trim(){let n=0;for(let u=0;u<this.text.length&&Qw[this.text.charCodeAt(u)];u++)n++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&Qw[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const u=new h_;return u.text=this.text.substring(n,o),u.sectionIndex=this.sectionIndex.slice(n,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(_v.forText(n.scale,n.fontStack||o));const u=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(u)}addImageSection(n){const o=n.image?n.image.namePrimary:"";if(o.length===0)return void Pi("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(_v.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function QP(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j){const V=h_.fromFeature(i,h);P===sl.vertical&&V.verticalizePunctuation(M);let $=[];const Y=function(Re,ze,Ge,Ke,it,Je){if(!Re)return[];const ut=[],Ct=function(xt,Ot,ft,jt,Dt,Pt){let vn=0;for(let mn=0;mn<xt.length();mn++){const tn=xt.getSection(mn);vn+=UN(xt.getCodePoint(mn),tn,jt,Dt,Ot,Pt)}return vn/Math.max(1,Math.ceil(vn/ft))}(Re,ze,Ge,Ke,it,Je),ht=Re.text.indexOf("")>=0;let Mt=0;for(let xt=0;xt<Re.length();xt++){const Ot=Re.getSection(xt),ft=Re.getCodePoint(xt);if(Qw[ft]||(Mt+=UN(ft,Ot,Ke,it,ze,Je)),xt<Re.length()-1){const jt=!((lt=ft)<11904||!($e["Bopomofo Extended"](lt)||$e.Bopomofo(lt)||$e["CJK Compatibility Forms"](lt)||$e["CJK Compatibility Ideographs"](lt)||$e["CJK Compatibility"](lt)||$e["CJK Radicals Supplement"](lt)||$e["CJK Strokes"](lt)||$e["CJK Symbols and Punctuation"](lt)||$e["CJK Unified Ideographs Extension A"](lt)||$e["CJK Unified Ideographs"](lt)||$e["Enclosed CJK Letters and Months"](lt)||$e["Halfwidth and Fullwidth Forms"](lt)||$e.Hiragana(lt)||$e["Ideographic Description Characters"](lt)||$e["Kangxi Radicals"](lt)||$e["Katakana Phonetic Extensions"](lt)||$e.Katakana(lt)||$e["Vertical Forms"](lt)||$e["Yi Radicals"](lt)||$e["Yi Syllables"](lt)));(rY[ft]||jt||Ot.imageName)&&ut.push($N(xt+1,Mt,Ct,ut,iY(ft,Re.getCodePoint(xt+1),jt&&ht),!1))}}var lt;return qN($N(Re.length(),Mt,Ct,ut,0,!0))}(V,E,p,n,u,z),{processBidirectionalText:me,processStyledBidirectionalText:pe}=or;if(me&&V.sections.length===1){const Re=me(V.toString(),Y);for(const ze of Re){const Ge=new h_;Ge.text=ze,Ge.sections=V.sections;for(let Ke=0;Ke<ze.length;Ke++)Ge.sectionIndex.push(0);$.push(Ge)}}else if(pe){const Re=pe(V.text,V.sectionIndex,Y);for(const ze of Re){const Ge=new h_;Ge.text=ze[0],Ge.sectionIndex=ze[1],Ge.sections=V.sections,$.push(Ge)}}else $=function(Re,ze){const Ge=[],Ke=Re.text;let it=0;for(const Je of ze)Ge.push(Re.substring(it,Je)),it=Je;return it<Ke.length&&Ge.push(Re.substring(it,Ke.length)),Ge}(V,Y);const ge=[],Pe={positionedLines:ge,text:V.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Re,ze,Ge,Ke,it,Je,ut,Ct,ht,Mt,lt,xt){let Ot=0,ft=0,jt=0;const Dt=Ct==="right"?1:Ct==="left"?0:.5;let Pt=!1;for(const gn of it){const cn=gn.getSections();for(const Bn of cn){if(Bn.imageName)continue;const Un=ze[Bn.fontStack];if(Un&&(Pt=Un.ascender!==void 0&&Un.descender!==void 0,!Pt))break}if(!Pt)break}let vn=0;for(const gn of it){gn.trim();const cn=gn.getMaxScale(),Bn=(cn-1)*fo,Un={positionedGlyphs:[],lineOffset:0};Re.positionedLines[vn]=Un;const jn=Un.positionedGlyphs;let Kn=0;if(!gn.length()){ft+=Je,++vn;continue}let yr=0,lr=0;for(let Hr=0;Hr<gn.length();Hr++){const Vn=gn.getSection(Hr),Dr=gn.getSectionIndex(Hr),Fr=gn.getCodePoint(Hr);let ii=Vn.scale,ji=null,es=null,Ui=null,Ri=fo,Ws=0;const ms=!(ht===sl.horizontal||!lt&&!Ht(Fr)||lt&&(Qw[Fr]||(mn=Fr,$e.Arabic(mn)||$e["Arabic Supplement"](mn)||$e["Arabic Extended-A"](mn)||$e["Arabic Presentation Forms-A"](mn)||$e["Arabic Presentation Forms-B"](mn))));if(Vn.imageName){const po=Ke[Vn.imageName];if(!po)continue;Ui=Vn.imageName,Re.iconsInText=Re.iconsInText||!0,es=po.paddedRect;const ti=po.displaySize;ii=ii*fo/xt,ji={width:ti[0],height:ti[1],left:0,top:-jN,advance:ms?ti[1]:ti[0],localGlyph:!1},Ws=Pt?-ji.height*ii:cn*fo-17-ti[1]*ii,Ri=ji.advance;const va=(ms?ti[0]:ti[1])*ii-fo*cn;va>0&&va>Kn&&(Kn=va)}else{const po=Ge[Vn.fontStack];if(!po)continue;po[Fr]&&(es=po[Fr]);const ti=ze[Vn.fontStack];if(!ti)continue;const va=ti.glyphs[Fr];if(!va)continue;if(ji=va.metrics,Ri=Fr!==8203?fo:0,Pt){const kc=ti.ascender!==void 0?Math.abs(ti.ascender):0,Fl=ti.descender!==void 0?Math.abs(ti.descender):0,Bl=(kc+Fl)*ii;yr<Bl&&(yr=Bl,lr=(kc-Fl)/2*ii),Ws=-kc*ii}else Ws=(cn-ii)*fo-17}ms?(Re.verticalizable=!0,jn.push({glyph:Fr,imageName:Ui,x:Ot,y:ft+Ws,vertical:ms,scale:ii,localGlyph:ji.localGlyph,fontStack:Vn.fontStack,sectionIndex:Dr,metrics:ji,rect:es}),Ot+=Ri*ii+Mt):(jn.push({glyph:Fr,imageName:Ui,x:Ot,y:ft+Ws,vertical:ms,scale:ii,localGlyph:ji.localGlyph,fontStack:Vn.fontStack,sectionIndex:Dr,metrics:ji,rect:es}),Ot+=ji.advance*ii+Mt)}jn.length!==0&&(jt=Math.max(Ot-Mt,jt),Pt?GN(jn,Dt,Kn,lr,Je*cn/2):GN(jn,Dt,Kn,0,Je/2)),Ot=0;const $r=Je*cn+Kn;Un.lineOffset=Math.max(Kn,Bn),ft+=$r,++vn}var mn;const tn=ft,{horizontalAlign:Nt,verticalAlign:Rn}=YP(ut);(function(gn,cn,Bn,Un,jn,Kn){const yr=(cn-Bn)*jn,lr=-Kn*Un;for(const $r of gn)for(const Hr of $r.positionedGlyphs)Hr.x+=yr,Hr.y+=lr})(Re.positionedLines,Dt,Nt,Rn,jt,tn),Re.top+=-Rn*tn,Re.bottom=Re.top+tn,Re.left+=-Nt*jt,Re.right=Re.left+jt,Re.hasBaseline=Pt}(Pe,n,o,u,$,m,v,w,P,E,M,j),!function(Re){for(const ze of Re)if(ze.positionedGlyphs.length!==0)return!1;return!0}(ge)&&Pe}const Qw={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rY={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function UN(i,n,o,u,h,p){if(n.imageName){const m=u[n.imageName];return m?m.displaySize[0]*n.scale*fo/p+h:0}{const m=o[n.fontStack],v=m&&m.glyphs[i];return v?v.metrics.advance*n.scale+h:0}}function VN(i,n,o,u){const h=Math.pow(i-n,2);return u?i<n?h/2:2*h:h+Math.abs(o)*o}function iY(i,n,o){let u=0;return i===10&&(u-=1e4),o&&(u+=150),i!==40&&i!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function $N(i,n,o,u,h,p){let m=null,v=VN(n,o,h,p);for(const w of u){const E=VN(n-w.x,o,h,p)+w.badness;E<=v&&(m=w,v=E)}return{index:i,x:n,priorBreak:m,badness:v}}function qN(i){return i?qN(i.priorBreak).concat(i.index):[]}function YP(i){let n=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function GN(i,n,o,u,h){if(!(n||o||u||h))return;const p=i.length-1,m=i[p],v=(m.x+m.metrics.advance*m.scale)*n;for(let w=0;w<=p;w++)i[w].x-=v,i[w].y+=o+u+h}function sY(i,n,o,u){const{horizontalAlign:h,verticalAlign:p}=YP(u),m=o[0]-i.displaySize[0]*h,v=o[1]-i.displaySize[1]*p;return{imagePrimary:i,imageSecondary:n,top:v,bottom:v+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function WN(i,n,o,u,h,p){const m=i.imagePrimary;let v;if(m.content){const $=m.content,Y=m.pixelRatio||1;v=[$[0]/Y,$[1]/Y,m.displaySize[0]-$[2]/Y,m.displaySize[1]-$[3]/Y]}const w=n.left*p,E=n.right*p;let C,P,M,z;o==="width"||o==="both"?(z=h[0]+w-u[3],P=h[0]+E+u[1]):(z=h[0]+(w+E-m.displaySize[0])/2,P=z+m.displaySize[0]);const j=n.top*p,V=n.bottom*p;return o==="height"||o==="both"?(C=h[1]+j-u[0],M=h[1]+V+u[2]):(C=h[1]+(j+V-m.displaySize[1])/2,M=C+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:C,right:P,bottom:M,left:z,collisionPadding:v}}class Ih extends Ft{constructor(n,o,u,h,p){super(n,o),this.angle=h,this.z=u,p!==void 0&&(this.segment=p)}clone(){return new Ih(this.x,this.y,this.z,this.angle,this.segment)}}function HN(i,n,o,u,h){if(n.segment===void 0)return!0;let p=n,m=n.segment+1,v=0;for(;v>-o/2;){if(m--,m<0)return!1;v-=i[m].dist(p),p=i[m]}v+=i[m].dist(i[m+1]),m++;const w=[];let E=0;for(;v<o/2;){const C=i[m],P=i[m+1];if(!P)return!1;let M=i[m-1].angleTo(C)-C.angleTo(P);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:M}),E+=M;v-w[0].distance>u;)E-=w.shift().angleDelta;if(E>h)return!1;m++,v+=C.dist(P)}return!0}function ZN(i){let n=0;for(let o=0;o<i.length-1;o++)n+=i[o].dist(i[o+1]);return n}function XN(i,n,o){return i?.6*n*o:0}function KN(i,n){return Math.max(i?i.right-i.left:0,n?n.right-n.left:0)}function oY(i,n,o,u,h,p){const m=XN(o,h,p),v=KN(o,u)*p;let w=0;const E=ZN(i)/2;for(let C=0;C<i.length-1;C++){const P=i[C],M=i[C+1],z=P.dist(M);if(w+z>E){const j=(E-w)/z,V=Tn(P.x,M.x,j),$=Tn(P.y,M.y,j),Y=new Ih(V,$,0,M.angleTo(P),C);return!m||HN(i,Y,v,m,n)?Y:void 0}w+=z}}function aY(i,n,o,u,h,p,m,v,w){const E=XN(u,p,m),C=KN(u,h),P=C*m,M=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return n-P<n/4&&(n=P+n/4),QN(i,M?n/2*v%n:(C/2+2*p)*m*v%n,n,E,o,P,M,!1,w)}function QN(i,n,o,u,h,p,m,v,w){const E=p/2,C=ZN(i);let P=0,M=n-o,z=[];for(let j=0;j<i.length-1;j++){const V=i[j],$=i[j+1],Y=V.dist($),me=$.angleTo(V);for(;M+o<P+Y;){M+=o;const pe=(M-P)/Y,ge=Tn(V.x,$.x,pe),Pe=Tn(V.y,$.y,pe);if(ge>=0&&ge<w&&Pe>=0&&Pe<w&&M-E>=0&&M+E<=C){const Re=new Ih(ge,Pe,0,me,j);u&&!HN(i,Re,p,u,h)||z.push(Re)}}P+=Y}return v||z.length||m||(z=QN(i,P/2,o,u,h,p,m,!0,w)),z}function YN(i,n,o,u,h){const p=[];for(let m=0;m<i.length;m++){const v=i[m];let w;for(let E=0;E<v.length-1;E++){let C=v[E],P=v[E+1];C.x<n&&P.x<n||(C.x<n?C=new Ft(n,C.y+(n-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<n&&(P=new Ft(n,C.y+(n-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<o&&P.y<o||(C.y<o?C=new Ft(C.x+(o-C.y)/(P.y-C.y)*(P.x-C.x),o)._round():P.y<o&&(P=new Ft(C.x+(o-C.y)/(P.y-C.y)*(P.x-C.x),o)._round()),C.x>=u&&P.x>=u||(C.x>=u?C=new Ft(u,C.y+(u-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=u&&(P=new Ft(u,C.y+(u-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=h&&P.y>=h||(C.y>=h?C=new Ft(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round():P.y>=h&&(P=new Ft(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round()),w&&C.equals(w[w.length-1])||(w=[C],p.push(w)),w.push(P)))))}}return p}function JN(i){let n=0,o=0;for(const m of i)n+=m.w*m.h,o=Math.max(o,m.w);i.sort((m,v)=>v.h-m.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let h=0,p=0;for(const m of i)for(let v=u.length-1;v>=0;v--){const w=u[v];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,p=Math.max(p,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===w.w&&m.h===w.h){const E=u.pop();v<u.length&&(u[v]=E)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(u.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:h,h:p,fill:n/(h*p)||0}}qe(Ih,"Anchor");const Da=1;class JP{constructor(n,{pixelRatio:o,version:u,stretchX:h,stretchY:p,content:m}){this.paddedRect=n,this.pixelRatio=o,this.stretchX=h,this.stretchY=p,this.content=m,this.version=u}get tl(){return[this.paddedRect.x+Da,this.paddedRect.y+Da]}get br(){return[this.paddedRect.x+this.paddedRect.w-Da,this.paddedRect.y+this.paddedRect.h-Da]}get displaySize(){return[(this.paddedRect.w-2*Da)/this.pixelRatio,(this.paddedRect.h-2*Da)/this.pixelRatio]}}class eF{constructor(n,o,u){const h={},p={};this.haveRenderCallbacks=[];const m=[];this.addImages(n,h,m),this.addImages(o,p,m);const{w:v,h:w}=JN(m),E=new il({width:v||1,height:w||1});for(const C in n){const P=n[C],M=h[C].paddedRect;il.copy(P.data,E,{x:0,y:0},{x:M.x+Da,y:M.y+Da},P.data,u,P.sdf)}for(const C in o){const P=o[C],M=p[C].paddedRect,z=M.x+Da,j=M.y+Da,V=P.data.width,$=P.data.height;il.copy(P.data,E,{x:0,y:0},{x:z,y:j},P.data,u),il.copy(P.data,E,{x:0,y:$-1},{x:z,y:j-1},{width:V,height:1},u),il.copy(P.data,E,{x:0,y:0},{x:z,y:j+$},{width:V,height:1},u),il.copy(P.data,E,{x:V-1,y:0},{x:z-1,y:j},{width:1,height:$},u),il.copy(P.data,E,{x:0,y:0},{x:z+V,y:j},{width:1,height:$},u)}this.image=E,this.iconPositions=h,this.patternPositions=p}addImages(n,o,u){for(const h in n){const p=n[h],m={x:0,y:0,w:p.data.width+2*Da,h:p.data.height+2*Da};u.push(m),o[h]=new JP(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>n.hasImage(h,u)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h in n.getUpdatedImages(u))this.patchUpdatedImage(this.iconPositions[h],n.getImage(h,u),o),this.patchUpdatedImage(this.patternPositions[h],n.getImage(h,u),o)}patchUpdatedImage(n,o,u){if(!n||!o||n.version===o.version)return;n.version=o.version;const[h,p]=n.tl,m=!!Object.keys(this.patternPositions).length;u.update(o.data,{useMipmap:m},{x:h,y:p})}}qe(JP,"ImagePosition"),qe(eF,"ImageAtlas");const yv=1e20;function tF(i,n,o,u,h,p,m,v,w){for(let E=n;E<n+u;E++)nF(i,o*p+E,p,h,m,v,w);for(let E=o;E<o+h;E++)nF(i,E*p+n,1,u,m,v,w)}function nF(i,n,o,u,h,p,m){p[0]=0,m[0]=-yv,m[1]=yv,h[0]=i[n];for(let v=1,w=0,E=0;v<u;v++){h[v]=i[n+v*o];const C=v*v;do{const P=p[w];E=(h[v]-h[P]+C-P*P)/(v-P)/2}while(E<=m[w]&&--w>-1);w++,p[w]=v,m[w]=E,m[w+1]=yv}for(let v=0,w=0;v<u;v++){for(;m[w+1]<v;)w++;const E=p[w],C=v-E;i[n+v*o]=h[E]+C*C}}const Cc=2,e3={none:0,ideographs:1,all:2};class d_{constructor(n,o,u){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,o){this.urls[o]=n}getGlyphs(n,o,u){const h=[],p=this.urls[o]||O.GLYPHS_URL;for(const m in n)for(const v of n[m])h.push({stack:m,id:v});ih(h,({stack:m,id:v},w)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=E.glyphs[v];if(C!==void 0)return void w(null,{stack:m,id:v,glyph:C});if(C=this._tinySDF(E,m,v),C)return E.glyphs[v]=C,void w(null,{stack:m,id:v,glyph:C});const P=Math.floor(v/256);if(256*P>65535)return void w(new Error("glyphs > 65535 not supported"));if(E.ranges[P])return void w(null,{stack:m,id:v,glyph:C});let M=E.requests[P];M||(M=E.requests[P]=[],d_.loadGlyphRange(m,P,p,this.requestManager,(z,j)=>{if(j){E.ascender=j.ascender,E.descender=j.descender;for(const V in j.glyphs)this._doesCharSupportLocalGlyph(+V)||(E.glyphs[+V]=j.glyphs[+V]);E.ranges[P]=!0}for(const V of M)V(z,j);delete E.requests[P]})),M.push((z,j)=>{z?w(z):j&&w(null,{stack:m,id:v,glyph:j.glyphs[v]||null})})},(m,v)=>{if(m)u(m);else if(v){const w={};for(const{stack:E,id:C,glyph:P}of v)w[E]===void 0&&(w[E]={}),w[E].glyphs===void 0&&(w[E].glyphs={}),w[E].glyphs[C]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},w[E].ascender=this.entries[E].ascender,w[E].descender=this.entries[E].descender;u(null,w)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==e3.none&&(this.localGlyphMode===e3.all?!!this.localFontFamily:!!this.localFontFamily&&($e["CJK Unified Ideographs"](n)||$e["Hangul Syllables"](n)||$e.Hiragana(n)||$e.Katakana(n)||$e["CJK Symbols and Punctuation"](n)||$e["CJK Unified Ideographs Extension A"](n)||$e["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,o,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let p=n.tinySDF;if(!p){let V="400";/bold/i.test(o)?V="900":/medium/i.test(o)?V="500":/light/i.test(o)&&(V="200"),p=n.tinySDF=new d_.TinySDF({fontFamily:h,fontWeight:V,fontSize:24*Cc,buffer:3*Cc,radius:8*Cc}),p.fontWeight=V}if(this.localGlyphs[p.fontWeight][u])return this.localGlyphs[p.fontWeight][u];const m=String.fromCodePoint(u),{data:v,width:w,height:E,glyphWidth:C,glyphHeight:P,glyphLeft:M,glyphTop:z,glyphAdvance:j}=p.draw(m);return this.localGlyphs[p.fontWeight][u]={id:u,bitmap:new qd({width:w,height:E},v),metrics:{width:C/Cc,height:P/Cc,left:M/Cc,top:z/Cc-27,advance:j/Cc,localGlyph:!0}}}}d_.loadGlyphRange=function(i,n,o,u,h){const p=256*n,m=p+255,v=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",`${p}-${m}`),up.Glyphs);oh(v,(w,E)=>{if(w)h(w);else if(E){const C={},P=function(M){return new mv(M).readFields(eY,{})}(E);for(const M of P.glyphs)C[M.id]=M;h(null,{glyphs:C,ascender:P.ascender,descender:P.descender})}})},d_.TinySDF=class{constructor({fontSize:i=24,buffer:n=3,radius:o=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=n,this.cutoff=u,this.radius=o;const v=this.size=i+4*n,w=this._createCanvas(v),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${p} ${i}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const n=document.createElement("canvas");return n.width=n.height=i,n}draw(i){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(i),m=Math.ceil(o),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),w=Math.min(this.size-this.buffer,m+Math.ceil(u)),E=v+2*this.buffer,C=w+2*this.buffer,P=Math.max(E*C,0),M=new Uint8ClampedArray(P),z={data:M,width:E,height:C,glyphWidth:v,glyphHeight:w,glyphTop:m,glyphLeft:0,glyphAdvance:n};if(v===0||w===0)return z;const{ctx:j,buffer:V,gridInner:$,gridOuter:Y}=this;j.clearRect(V,V,v,w),j.fillText(i,V,V+m);const me=j.getImageData(V,V,v,w);Y.fill(yv,0,P),$.fill(0,0,P);for(let pe=0;pe<w;pe++)for(let ge=0;ge<v;ge++){const Pe=me.data[4*(pe*v+ge)+3]/255;if(Pe===0)continue;const Re=(pe+V)*E+ge+V;if(Pe===1)Y[Re]=0,$[Re]=yv;else{const ze=.5-Pe;Y[Re]=ze>0?ze*ze:0,$[Re]=ze<0?ze*ze:0}}tF(Y,0,0,E,C,E,this.f,this.v,this.z),tF($,V,V,v,w,E,this.f,this.v,this.z);for(let pe=0;pe<P;pe++){const ge=Math.sqrt(Y[pe])-Math.sqrt($[pe]);M[pe]=Math.round(255-255*(ge/this.radius+this.cutoff))}return z}};const Hd=Da;function rF(i,n,o,u){const h=[],p=i.imagePrimary,m=p.pixelRatio,v=p.paddedRect.w-2*Hd,w=p.paddedRect.h-2*Hd,E=i.right-i.left,C=i.bottom-i.top,P=p.stretchX||[[0,v]],M=p.stretchY||[[0,w]],z=(Je,ut)=>Je+ut[1]-ut[0],j=P.reduce(z,0),V=M.reduce(z,0),$=v-j,Y=w-V;let me=0,pe=j,ge=0,Pe=V,Re=0,ze=$,Ge=0,Ke=Y;if(p.content&&u){const Je=p.content;me=Yw(P,0,Je[0]),ge=Yw(M,0,Je[1]),pe=Yw(P,Je[0],Je[2]),Pe=Yw(M,Je[1],Je[3]),Re=Je[0]-me,Ge=Je[1]-ge,ze=Je[2]-Je[0]-pe,Ke=Je[3]-Je[1]-Pe}const it=(Je,ut,Ct,ht)=>{const Mt=Jw(Je.stretch-me,pe,E,i.left),lt=eT(Je.fixed-Re,ze,Je.stretch,j),xt=Jw(ut.stretch-ge,Pe,C,i.top),Ot=eT(ut.fixed-Ge,Ke,ut.stretch,V),ft=Jw(Ct.stretch-me,pe,E,i.left),jt=eT(Ct.fixed-Re,ze,Ct.stretch,j),Dt=Jw(ht.stretch-ge,Pe,C,i.top),Pt=eT(ht.fixed-Ge,Ke,ht.stretch,V),vn=new Ft(Mt,xt),mn=new Ft(ft,xt),tn=new Ft(ft,Dt),Nt=new Ft(Mt,Dt),Rn=new Ft(lt/m,Ot/m),gn=new Ft(jt/m,Pt/m),cn=n*Math.PI/180;if(cn){const lr=Math.sin(cn),$r=Math.cos(cn),Hr=[$r,-lr,lr,$r];vn._matMult(Hr),mn._matMult(Hr),Nt._matMult(Hr),tn._matMult(Hr)}const Bn=Je.stretch+Je.fixed,Un=Ct.stretch+Ct.fixed,jn=ut.stretch+ut.fixed,Kn=ht.stretch+ht.fixed,yr=i.imageSecondary;return{tl:vn,tr:mn,bl:Nt,br:tn,texPrimary:{x:p.paddedRect.x+Hd+Bn,y:p.paddedRect.y+Hd+jn,w:Un-Bn,h:Kn-jn},texSecondary:yr?{x:yr.paddedRect.x+Hd+Bn,y:yr.paddedRect.y+Hd+jn,w:Un-Bn,h:Kn-jn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rn,pixelOffsetBR:gn,minFontScaleX:ze/m/E,minFontScaleY:Ke/m/C,isSDF:o}};if(u&&(p.stretchX||p.stretchY)){const Je=iF(P,$,j),ut=iF(M,Y,V);for(let Ct=0;Ct<Je.length-1;Ct++){const ht=Je[Ct],Mt=Je[Ct+1];for(let lt=0;lt<ut.length-1;lt++)h.push(it(ht,ut[lt],Mt,ut[lt+1]))}}else h.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function Yw(i,n,o){let u=0;for(const h of i)u+=Math.max(n,Math.min(o,h[1]))-Math.max(n,Math.min(o,h[0]));return u}function iF(i,n,o){const u=[{fixed:-Hd,stretch:0}];for(const[h,p]of i){const m=u[u.length-1];u.push({fixed:h-m.stretch,stretch:m.stretch}),u.push({fixed:h-m.stretch,stretch:m.stretch+(p-h)})}return u.push({fixed:n+Hd,stretch:o}),u}function Jw(i,n,o,u){return i/n*o+u}function eT(i,n,o,u){return i-n*o/u}function lY(i,n,o,u){const h=n+i.positionedLines[u].lineOffset;return u===0?o+h/2:o+(h+(n+i.positionedLines[u-1].lineOffset))/2}function cY(i,n=1,o=!1){let u=1/0,h=1/0,p=-1/0,m=-1/0;const v=i[0];for(let z=0;z<v.length;z++){const j=v[z];(!z||j.x<u)&&(u=j.x),(!z||j.y<h)&&(h=j.y),(!z||j.x>p)&&(p=j.x),(!z||j.y>m)&&(m=j.y)}const w=Math.min(p-u,m-h);let E=w/2;const C=new hu([],uY);if(w===0)return new Ft(u,h);for(let z=u;z<p;z+=w)for(let j=h;j<m;j+=w)C.push(new f_(z+E,j+E,E,i));let P=function(z){let j=0,V=0,$=0;const Y=z[0];for(let me=0,pe=Y.length,ge=pe-1;me<pe;ge=me++){const Pe=Y[me],Re=Y[ge],ze=Pe.x*Re.y-Re.x*Pe.y;V+=(Pe.x+Re.x)*ze,$+=(Pe.y+Re.y)*ze,j+=3*ze}return new f_(V/j,$/j,0,z)}(i),M=C.length;for(;C.length;){const z=C.pop();(z.d>P.d||!P.d)&&(P=z,o&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,M)),z.max-P.d<=n||(E=z.h/2,C.push(new f_(z.p.x-E,z.p.y-E,E,i)),C.push(new f_(z.p.x+E,z.p.y-E,E,i)),C.push(new f_(z.p.x-E,z.p.y+E,E,i)),C.push(new f_(z.p.x+E,z.p.y+E,E,i)),M+=4)}return o&&(console.log(`num probes: ${M}`),console.log(`best distance: ${P.d}`)),P.p}function uY(i,n){return n.max-i.max}class f_{constructor(n,o,u,h){this.p=new Ft(n,o),this.h=u,this.d=function(p,m){let v=!1,w=1/0;for(let E=0;E<m.length;E++){const C=m[E];for(let P=0,M=C.length,z=M-1;P<M;z=P++){const j=C[P],V=C[z];j.y>p.y!=V.y>p.y&&p.x<(V.x-j.x)*(p.y-j.y)/(V.y-j.y)+j.x&&(v=!v),w=Math.min(w,KL(p,j,V))}}return(v?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const t3=Number.POSITIVE_INFINITY,hY=Math.sqrt(2);function sF(i,[n,o]){let u=0,h=0;if(o===t3){n<0&&(n=0);const p=n/hY;switch(i){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-n;break;case"top":h=n-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=n;break;case"right":u=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),i){case"top-right":case"top-left":case"top":h=o-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-o}switch(i){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}}return[u,h]}function n3(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dY(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j){let V=p.textMaxSize.evaluate(n,{},P);V===void 0&&(V=m);const $=i.layers[0].layout,Y=$.get("icon-offset").evaluate(n,{},P),me=aF(o.horizontal)||o.vertical,pe=M.name==="globe",ge=fo,Pe=m/ge,Re=i.tilePixelRatio*V/ge,ze=(Mt=i.overscaling,i.zoom>18&&Mt>2&&(Mt>>=1),Math.max(zt/(512*Mt),1)*$.get("symbol-spacing")),Ge=$.get("text-padding")*i.tilePixelRatio,Ke=$.get("icon-padding")*i.tilePixelRatio,it=sr($.get("text-max-angle")),Je=$.get("text-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",ut=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",Ct=$.get("symbol-placement"),ht=ze/2;var Mt;const lt=$.get("icon-text-fit").evaluate(n,{},P),xt=$.get("icon-text-fit-padding").evaluate(n,{},P),Ot=lt!=="none";let ft;i.hasAnyIconTextFit===!1&&Ot&&(i.hasAnyIconTextFit=!0),u&&Ot&&(i.allowVerticalPlacement&&o.vertical&&(ft=WN(u,o.vertical,lt,xt,Y,Pe)),me&&(u=WN(u,me,lt,xt,Y,Pe)));const jt=(Dt,Pt,vn)=>{if(Pt.x<0||Pt.x>=zt||Pt.y<0||Pt.y>=zt)return;let mn=null;if(pe){const{x:tn,y:Nt,z:Rn}=M.projectTilePoint(Pt.x,Pt.y,vn);mn={anchor:new Ih(tn,Nt,Rn,0,void 0),up:M.upVector(vn,Pt.x,Pt.y)}}(function(tn,Nt,Rn,gn,cn,Bn,Un,jn,Kn,yr,lr,$r,Hr,Vn,Dr,Fr,ii,ji,es,Ui,Ri,Ws,ms,po,ti,va,kc){const Fl=tn.addToLineVertexArray(Nt,gn);let Bl,Yp,Jd,Jp,Fv,TB,EB,SB=0,IB=0,CB=0,AB=0,M3=-1,k3=-1;const bu={};let PB=Eg("");const em=Rn?Rn.anchor:Nt,D3=Kn.layout.get("icon-text-fit").evaluate(Ri,{},ti)!=="none";let O3=0,L3=0;if(Kn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[O3,L3]=Kn.layout.get("text-offset").evaluate(Ri,{},ti).map(La=>La*fo):(O3=Kn.layout.get("text-radial-offset").evaluate(Ri,{},ti)*fo,L3=t3),tn.allowVerticalPlacement&&cn.vertical){const La=cn.vertical;if(Dr)TB=r3(La),jn&&(EB=r3(jn));else{const za=Kn.layout.get("text-rotate").evaluate(Ri,{},ti)+90;Jd=tT(yr,em,Nt,lr,$r,Hr,La,Vn,za,Fr),jn&&(Jp=tT(yr,em,Nt,lr,$r,Hr,jn,ji,za))}}if(Bn){const La=Kn.layout.get("icon-rotate").evaluate(Ri,{},ti),za=rF(Bn,La,ms,D3),w_=jn?rF(jn,La,ms,D3):void 0;Yp=tT(yr,em,Nt,lr,$r,Hr,Bn,ji,La),SB=4*za.length;const RB=tn.iconSizeData;let tm=null;RB.kind==="source"?(tm=[Ic*Kn.layout.get("icon-size").evaluate(Ri,{},ti)],tm[0]>Zd&&Pi(`${tn.layerIds[0]}: Value for "icon-size" is >= ${vv}. Reduce your "icon-size".`)):RB.kind==="composite"&&(tm=[Ic*Ws.compositeIconSizes[0].evaluate(Ri,{},ti),Ic*Ws.compositeIconSizes[1].evaluate(Ri,{},ti)],(tm[0]>Zd||tm[1]>Zd)&&Pi(`${tn.layerIds[0]}: Value for "icon-size" is >= ${vv}. Reduce your "icon-size".`)),tn.addSymbols(tn.icon,za,tm,Ui,es,Ri,!1,Rn,Nt,Fl.lineStartIndex,Fl.lineLength,-1,po,ti,va,kc),M3=tn.icon.placedSymbolArray.length-1,w_&&(IB=4*w_.length,tn.addSymbols(tn.icon,w_,tm,Ui,es,Ri,sl.vertical,Rn,Nt,Fl.lineStartIndex,Fl.lineLength,-1,po,ti,va,kc),k3=tn.icon.placedSymbolArray.length-1)}for(const La in cn.horizontal){const za=cn.horizontal[La];Bl||(PB=Eg(za.text),Dr?Fv=r3(za):Bl=tT(yr,em,Nt,lr,$r,Hr,za,Vn,Kn.layout.get("text-rotate").evaluate(Ri,{},ti),Fr));const w_=za.positionedLines.length===1;if(CB+=oF(tn,Rn,Nt,za,Un,Kn,Dr,Ri,Fr,Fl,cn.vertical?sl.horizontal:sl.horizontalOnly,w_?Object.keys(cn.horizontal):[La],bu,M3,Ws,po,ti,va),w_)break}cn.vertical&&(AB+=oF(tn,Rn,Nt,cn.vertical,Un,Kn,Dr,Ri,Fr,Fl,sl.vertical,["vertical"],bu,k3,Ws,po,ti,va));let ef=-1;const z3=(La,za)=>La?Math.max(La,za):za;ef=z3(Fv,ef),ef=z3(TB,ef),ef=z3(EB,ef);const IJ=ef>-1?1:0;tn.glyphOffsetArray.length>=65535&&Pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ri.sortKey!==void 0&&tn.addToSortKeyRanges(tn.symbolInstances.length,Ri.sortKey),tn.symbolInstances.emplaceBack(Nt.x,Nt.y,em.x,em.y,em.z,bu.right>=0?bu.right:-1,bu.center>=0?bu.center:-1,bu.left>=0?bu.left:-1,bu.vertical>=0?bu.vertical:-1,M3,k3,PB,Bl!==void 0?Bl:tn.collisionBoxArray.length,Bl!==void 0?Bl+1:tn.collisionBoxArray.length,Jd!==void 0?Jd:tn.collisionBoxArray.length,Jd!==void 0?Jd+1:tn.collisionBoxArray.length,Yp!==void 0?Yp:tn.collisionBoxArray.length,Yp!==void 0?Yp+1:tn.collisionBoxArray.length,Jp||tn.collisionBoxArray.length,Jp?Jp+1:tn.collisionBoxArray.length,lr,CB,AB,SB,IB,IJ,0,O3,L3,ef,0,D3?1:0)})(i,Pt,mn,Dt,o,u,h,ft,i.layers[0],i.collisionBoxArray,n.index,n.sourceLayerIndex,i.index,Ge,Je,w,0,Ke,ut,Y,n,p,E,C,P,z,j)};if(Ct==="line")for(const Dt of YN(n.geometry,0,0,zt,zt)){const Pt=aY(Dt,ze,it,o.vertical||me,u,ge,Re,i.overscaling,zt);for(const vn of Pt)me&&fY(i,me.text,ht,vn)||jt(Dt,vn,P)}else if(Ct==="line-center"){for(const Dt of n.geometry)if(Dt.length>1){const Pt=oY(Dt,it,o.vertical||me,u,ge,Re);Pt&&jt(Dt,Pt,P)}}else if(n.type==="Polygon")for(const Dt of Nw(n.geometry,0)){const Pt=cY(Dt,16);jt(Dt[0],new Ih(Pt.x,Pt.y,0,0,void 0),P)}else if(n.type==="LineString")for(const Dt of n.geometry)jt(Dt,new Ih(Dt[0].x,Dt[0].y,0,0,void 0),P);else if(n.type==="Point")for(const Dt of n.geometry)for(const Pt of Dt)jt([Pt],new Ih(Pt.x,Pt.y,0,0,void 0),P)}const vv=255,Zd=vv*Ic;function oF(i,n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$,Y){const me=function(Pe,Re,ze,Ge,Ke,it,Je,ut){const Ct=[];if(Re.positionedLines.length===0)return Ct;const ht=Ge.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,Mt=function(jt){const Dt=jt[0],Pt=jt[1],vn=Dt*Pt;return vn>0?[Dt,-Pt]:vn<0?[-Dt,Pt]:Dt===0?[Pt,Dt]:[Pt,-Dt]}(ze);let lt=Math.abs(Re.top-Re.bottom);for(const jt of Re.positionedLines)lt-=jt.lineOffset;const xt=Re.positionedLines.length,Ot=lt/xt;let ft=Re.top-ze[1];for(let jt=0;jt<xt;++jt){const Dt=Re.positionedLines[jt];ft=lY(Re,Ot,ft,jt);for(const Pt of Dt.positionedGlyphs){if(!Pt.rect)continue;const vn=Pt.rect||{};let mn=jN+1,tn=!0,Nt=1,Rn=0;if(Pt.imageName){const Ui=Je[Pt.imageName];if(!Ui)continue;if(Ui.sdf){Pi("SDF images are not supported in formatted text and will be ignored.");continue}tn=!1,Nt=Ui.pixelRatio,mn=Da/Nt}const gn=(Ke||ut)&&Pt.vertical,cn=Pt.metrics.advance*Pt.scale/2,Bn=Pt.metrics,Un=Pt.rect;if(Un===null)continue;ut&&Re.verticalizable&&(Rn=Pt.imageName?cn-Pt.metrics.width*Pt.scale/2:0);const jn=Ke?[Pt.x+cn,Pt.y]:[0,0];let Kn=[0,0],yr=[0,0],lr=!1;Ke||(gn?(yr=[Pt.x+cn+Mt[0],Pt.y+Mt[1]-Rn],lr=!0):Kn=[Pt.x+cn+ze[0],Pt.y+ze[1]-Rn]);const $r=Un.w*Pt.scale/(Nt*(Pt.localGlyph?Cc:1)),Hr=Un.h*Pt.scale/(Nt*(Pt.localGlyph?Cc:1));let Vn,Dr,Fr,ii;if(gn){const Ui=Pt.y-ft,Ri=new Ft(-cn,cn-Ui),Ws=-Math.PI/2,ms=new Ft(...yr);Vn=new Ft(-cn+Kn[0],Kn[1]),Vn._rotateAround(Ws,Ri)._add(ms),Vn.x+=-Ui+cn,Vn.y-=(Bn.left-mn)*Pt.scale;const po=Pt.imageName?Bn.advance*Pt.scale:fo*Pt.scale,ti=String.fromCodePoint(Pt.glyph);YQ(ti)?Vn.x+=(1-mn)*Pt.scale:JQ(ti)?Vn.x+=po-Bn.height*Pt.scale+(-mn-1)*Pt.scale:Vn.x+=Pt.imageName||Bn.width+2*mn===Un.w&&Bn.height+2*mn===Un.h?(po-Hr)/2:(po-(Bn.height+2*mn)*Pt.scale)/2,Dr=new Ft(Vn.x,Vn.y-$r),Fr=new Ft(Vn.x+Hr,Vn.y),ii=new Ft(Vn.x+Hr,Vn.y-$r)}else{const Ui=(Bn.left-mn)*Pt.scale-cn+Kn[0],Ri=(-Bn.top-mn)*Pt.scale+Kn[1],Ws=Ui+$r,ms=Ri+Hr;Vn=new Ft(Ui,Ri),Dr=new Ft(Ws,Ri),Fr=new Ft(Ui,ms),ii=new Ft(Ws,ms)}if(ht){let Ui;Ui=Ke?new Ft(0,0):lr?new Ft(Mt[0],Mt[1]):new Ft(ze[0],ze[1]),Vn._rotateAround(ht,Ui),Dr._rotateAround(ht,Ui),Fr._rotateAround(ht,Ui),ii._rotateAround(ht,Ui)}const ji=new Ft(0,0),es=new Ft(0,0);Ct.push({tl:Vn,tr:Dr,bl:Fr,br:ii,texPrimary:vn,texSecondary:void 0,writingMode:Re.writingMode,glyphOffset:jn,sectionIndex:Pt.sectionIndex,isSDF:tn,pixelOffsetTL:ji,pixelOffsetBR:es,minFontScaleX:0,minFontScaleY:0})}}return Ct}(0,u,w,p,m,v,h,i.allowVerticalPlacement),pe=i.textSizeData;let ge=null;pe.kind==="source"?(ge=[Ic*p.layout.get("text-size").evaluate(v,{},$)],ge[0]>Zd&&Pi(`${i.layerIds[0]}: Value for "text-size" is >= ${vv}. Reduce your "text-size".`)):pe.kind==="composite"&&(ge=[Ic*j.compositeTextSizes[0].evaluate(v,{},$),Ic*j.compositeTextSizes[1].evaluate(v,{},$)],(ge[0]>Zd||ge[1]>Zd)&&Pi(`${i.layerIds[0]}: Value for "text-size" is >= ${vv}. Reduce your "text-size".`)),i.addSymbols(i.text,me,ge,w,m,v,C,n,o,E.lineStartIndex,E.lineLength,z,V,$,Y,!1);for(const Pe of P)M[Pe]=i.text.placedSymbolArray.length-1;return 4*me.length}function aF(i){for(const n in i)return i[n];return null}function tT(i,n,o,u,h,p,m,v,w,E){let C=m.top,P=m.bottom,M=m.left,z=m.right;const j=m.collisionPadding;if(j&&(M-=j[0],C-=j[1],z+=j[2],P+=j[3]),w){const V=new Ft(M,C),$=new Ft(z,C),Y=new Ft(M,P),me=new Ft(z,P),pe=sr(w);let ge=new Ft(0,0);E&&(ge=new Ft(E[0],E[1])),V._rotateAround(pe,ge),$._rotateAround(pe,ge),Y._rotateAround(pe,ge),me._rotateAround(pe,ge),M=Math.min(V.x,$.x,Y.x,me.x),z=Math.max(V.x,$.x,Y.x,me.x),C=Math.min(V.y,$.y,Y.y,me.y),P=Math.max(V.y,$.y,Y.y,me.y)}return i.emplaceBack(n.x,n.y,n.z,o.x,o.y,M,C,z,P,v,u,h,p),i.length-1}function r3(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const n=i.bottom-i.top;return n>0?Math.max(10,n):null}function fY(i,n,o,u){const h=i.compareText;if(n in h){const p=h[n];for(let m=p.length-1;m>=0;m--)if(u.dist(p[m])<o)return!0}else h[n]=[];return h[n].push(u),!1}function lF(i,n){const o=i.fovAboveCenter,u=i.elevation?i.elevation.getMinElevationBelowMSL()*n:0,h=(i._camera.position[2]*i.worldSize-u)/Math.cos(i._pitch),p=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-i._pitch-o,.01)),m=Math.sin(i._pitch)*p+h;return Math.min(1.01*m,h*(1/i._horizonShift))}function Wp(i,n){if(!n.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:n};const o=Math.pow(2,-i.z),u=i.x*o,h=(i.x+1)*o,p=i.y*o,m=(i.y+1)*o,v=ya(u),w=ya(h),E=eo(p),C=eo(m),P=n.project(v,E),M=n.project(w,E),z=n.project(w,C),j=n.project(v,C);let V=Math.min(P.x,M.x,z.x,j.x),$=Math.min(P.y,M.y,z.y,j.y),Y=Math.max(P.x,M.x,z.x,j.x),me=Math.max(P.y,M.y,z.y,j.y);const pe=o/16;function ge(Re,ze,Ge,Ke,it,Je){const ut=(Ge+it)/2,Ct=(Ke+Je)/2,ht=n.project(ya(ut),eo(Ct)),Mt=Math.max(0,V-ht.x,$-ht.y,ht.x-Y,ht.y-me);V=Math.min(V,ht.x),Y=Math.max(Y,ht.x),$=Math.min($,ht.y),me=Math.max(me,ht.y),Mt>pe&&(ge(Re,ht,Ge,Ke,ut,Ct),ge(ht,ze,ut,Ct,it,Je))}ge(P,M,u,p,h,p),ge(M,z,h,p,h,m),ge(z,j,h,m,u,m),ge(j,P,u,m,u,p),V-=pe,$-=pe,Y+=pe,me+=pe;const Pe=1/Math.max(Y-V,me-$);return{scale:Pe,x:V*Pe,y:$*Pe,x2:Y*Pe,y2:me*Pe,projection:n}}function cF(i,{x:n,y:o},u=0){return new Ft(((n-u)*i.scale-i.x)*zt,(o*i.scale-i.y)*zt)}const pY=a.ae.identity(new Float32Array(16));class Xd{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new Er(0,0)}projectTilePoint(n,o,u){return{x:n,y:o,z:0}}locationPoint(n,o,u=!0){return n._coordinatePoint(n.locationCoordinate(o),u)}pixelsPerMeter(n,o){return Ho(1,n)*o}pixelSpaceConversion(n,o,u){return 1}farthestPixelDistance(n){return lF(n,n.pixelsPerMeter)}pointCoordinate(n,o,u,h){const p=n.horizonLineFromTop(!1),m=new Ft(o,Math.max(p,u));return n.rayIntersectionCoordinate(n.pointRayIntersection(m,h))}pointCoordinate3D(n,o,u){const h=new Ft(o,u);if(n.elevation)return n.elevation.pointCoordinate(h);{const p=this.pointCoordinate(n,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(n,o){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,o.x,o.y);const u=n.horizonLineFromTop();return o.y<u}createInversionMatrix(n,o){return pY}createTileMatrix(n,o,u){let h,p,m;const v=u.canonical,w=a.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Wp(v,this);h=1,p=E.x+u.wrap*E.scale,m=E.y,a.ae.scale(w,w,[h/E.scale,h/E.scale,n.pixelsPerMeter/o])}else h=o/n.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*u.wrap)*h,m=v.y*h;return a.ae.translate(w,w,[p,m,0]),a.ae.scale(w,w,[h/zt,h/zt,1]),w}upVector(n,o,u){return[0,0,1]}upVectorScale(n,o,u){return{metersToTile:1}}}class mY extends Xd{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,u]=this.parallels=n.parallels||[29.5,45.5],h=Math.sin(sr(o));this.n=(h+Math.sin(sr(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:u,c:h,r0:p}=this,m=sr(n-this.center[0]),v=sr(o),w=Math.sqrt(h-2*u*Math.sin(v))/u;return{x:w*Math.sin(m*u),y:w*Math.cos(m*u)-p,z:0}}unproject(n,o){const{n:u,c:h,r0:p}=this,m=p+o;let v=Math.atan2(n,Math.abs(m))*Math.sign(m);m*u<0&&(v-=Math.PI*Math.sign(n)*Math.sign(m));const w=sr(this.center[0])*u;v=cc(v,-Math.PI-w,Math.PI-w);const E=Yn(oo(v/u)+this.center[0],-180,180),C=Math.asin(Yn((h-(n*n+m*m)*u*u)/(2*u),-1,1)),P=Yn(oo(C),-Zi,Zi);return new Er(E,P)}}const xv=1.340264,bv=-.081106,wv=893e-6,Tv=.003796,nT=Math.sqrt(3)/2;class gY extends Xd{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const u=Math.asin(nT*Math.sin(o)),h=u*u,p=h*h*h;return{x:.5*(n*Math.cos(u)/(nT*(xv+3*bv*h+p*(7*wv+9*Tv*h)))/Math.PI+.5),y:1-.5*(u*(xv+bv*h+p*(wv+Tv*h))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,h=u*u,p=h*h*h;for(let C,P,M,z=0;z<12&&(P=u*(xv+bv*h+p*(wv+Tv*h))-o,M=xv+3*bv*h+p*(7*wv+9*Tv*h),C=P/M,u=Yn(u-C,-Math.PI/3,Math.PI/3),h=u*u,p=h*h*h,!(Math.abs(C)<1e-12));++z);const m=nT*n*(xv+3*bv*h+p*(7*wv+9*Tv*h))/Math.cos(u),v=Math.asin(Math.sin(u)/nT),w=Yn(180*m/Math.PI,-180,180),E=Yn(180*v/Math.PI,-Zi,Zi);return new Er(w,E)}}class _Y extends Xd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const u=360*(n-.5),h=Yn(360*(.5-o),-Zi,Zi);return new Er(u,h)}}const p_=Math.PI/2;function rT(i){return Math.tan((p_+i)/2)}class yY extends Xd{constructor(n){super(n),this.center=n.center||[0,30];const[o,u]=this.parallels=n.parallels||[30,30];let h=sr(o),p=sr(u);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const m=Math.cos(h),v=rT(h);this.n=h===p?Math.sin(h):Math.log(m/Math.cos(p))/Math.log(rT(p)/v),this.f=m*Math.pow(rT(h),this.n)/this.n}project(n,o){o=sr(o),this.southernCenter&&(o=-o),n=sr(n-this.center[0]);const u=1e-6,{n:h,f:p}=this;p>0?o<-p_+u&&(o=-p_+u):o>p_-u&&(o=p_-u);const m=p/Math.pow(rT(o),h);let v=m*Math.sin(h*n),w=p-m*Math.cos(h*n);return v=.5*(v/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:v,y:this.southernCenter?w:1-w,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f:h}=this,p=h-o,m=Math.sign(p),v=Math.sign(u)*Math.sqrt(n*n+p*p);let w=Math.atan2(n,Math.abs(p))*m;p*u<0&&(w-=Math.PI*Math.sign(n)*m);const E=Yn(oo(w/u)+this.center[0],-180,180),C=Yn(oo(2*Math.atan(Math.pow(h/v,1/u))-p_),-Zi,Zi);return new Er(E,this.southernCenter?-C:C)}}class uF extends Xd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:mu(n),y:gu(o),z:0}}unproject(n,o){const u=ya(n),h=eo(o);return new Er(u,h)}}const hF=sr(Zi);class vY extends Xd{project(n,o){const u=(o=sr(o))*o,h=u*u;return{x:.5*((n=sr(n))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,h=25,p=0,m=u*u;do{m=u*u;const E=m*m;p=(u*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-o)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),u=Yn(u-p,-hF,hF)}while(Math.abs(p)>1e-6&&--h>0);m=u*u;const v=Yn(oo(n/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),w=oo(u);return new Er(v,w)}}const dF=sr(Zi);class xY extends Xd{project(n,o){o=sr(o),n=sr(n);const u=Math.cos(o),h=2/Math.PI,p=Math.acos(u*Math.cos(n/2)),m=Math.sin(p)/p,v=.5*(n*h+2*u*Math.sin(n/2)/m)||0,w=.5*(o+Math.sin(o)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(n,o){let u=n=(2*n-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,p=25;const m=1e-6;let v=0,w=0;do{const E=Math.cos(h),C=Math.sin(h),P=2*C*E,M=C*C,z=E*E,j=Math.cos(u/2),V=Math.sin(u/2),$=2*j*V,Y=V*V,me=1-z*j*j,pe=me?1/me:0,ge=me?Math.acos(E*j)*Math.sqrt(1/me):0,Pe=.5*(2*ge*E*V+2*u/Math.PI)-n,Re=.5*(ge*C+h)-o,ze=.5*pe*(z*Y+ge*E*j*M)+1/Math.PI,Ge=pe*($*P/4-ge*C*V),Ke=.125*pe*(P*V-ge*C*z*$),it=.5*pe*(M*j+ge*Y*E)+.5,Je=Ge*Ke-it*ze;v=(Re*Ge-Pe*it)/Je,w=(Pe*Ke-Re*ze)/Je,u=Yn(u-v,-Math.PI,Math.PI),h=Yn(h-w,-dF,dF)}while((Math.abs(v)>m||Math.abs(w)>m)&&--p>0);return new Er(oo(u),oo(h))}}class fF extends Xd{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(sr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:u,cosPhi:h}=this;return{x:sr(n)*h*u+.5,y:-Math.sin(sr(o))/h*u+.5,z:0}}unproject(n,o){const{scale:u,cosPhi:h}=this,p=-(o-.5)/u,m=Yn(oo((n-.5)/u)/h,-180,180),v=Math.asin(Yn(p*h,-1,1)),w=Yn(oo(v),-Zi,Zi);return new Er(m,w)}}class bY extends uF{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,u){const h=iv(n,o,u),p=sv(_u(u));return a.$.transformMat4(h,h,p),{x:h[0],y:h[1],z:h[2]}}locationPoint(n,o){const u=Up(o.lat,o.lng),h=a.$.normalize([],u),p=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude,m=Ho(1,0)*zt*p;a.$.scaleAndAdd(u,u,h,m);const v=a.ae.identity(new Float64Array(16));return a.ae.multiply(v,n.pixelMatrix,n.globeMatrix),a.$.transformMat4(u,u,v),new Ft(u[0],u[1])}pixelsPerMeter(n,o){return Ho(1,0)*o}pixelSpaceConversion(n,o,u){const h=Ho(1,n)*o,p=Tn(Ho(1,45)*o,h,u);return this.pixelsPerMeter(n,o)/p}createTileMatrix(n,o,u){const h=LP(_u(u.canonical));return a.ae.multiply(new Float64Array(16),n.globeMatrix,h)}createInversionMatrix(n,o){const{center:u}=n,h=sv(_u(o));return a.ae.rotateY(h,h,sr(u.lng)),a.ae.rotateX(h,h,sr(u.lat)),a.ae.scale(h,h,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(n,o,u,h){return az(n,o,u,!0)||new To(0,0)}pointCoordinate3D(n,o,u){const h=this.pointCoordinate(n,o,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(n,o){return!az(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=function(h,p){const m=h.cameraToCenterDistance,v=h._centerAltitude*p,w=h._camera,E=h._camera.forward(),C=a.$.add([],a.$.scale([],E,-m),[0,0,v]),P=h.worldSize/(2*Math.PI),M=[0,0,-P],z=h.width/h.height,j=Math.tan(h.fovAboveCenter),V=a.$.scale([],w.up(),j),$=a.$.scale([],w.right(),j*z),Y=a.$.normalize([],a.$.add([],a.$.add([],E,V),$)),me=[];let pe;if(new RP(C,Y).closestPointOnSphere(M,P,me)){const ge=a.$.add([],me,M),Pe=a.$.sub([],ge,C);pe=Math.cos(h.fovAboveCenter)*a.$.length(Pe)}else{const ge=a.$.sub([],C,M),Pe=a.$.sub([],M,C);a.$.normalize(Pe,Pe);const Re=a.$.length(ge)-P;pe=Math.sqrt(Re*(Re+2*P));const ze=Math.acos(pe/(P+Re))-Math.acos(a.$.dot(E,Pe));pe*=Math.cos(ze)}return 1.01*pe}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),u=Eh(n.zoom);if(u>0){const h=lF(n,Ho(1,n.center.lat)*n.worldSize),p=n.worldSize/(2*Math.PI),m=Math.max(n.width,n.height)/n.worldSize*Math.PI;return Tn(o,h+p*(1-Math.cos(m)),Math.pow(u,10))}return o}upVector(n,o,u){return iv(o,u,n,1)}upVectorScale(n){return{metersToTile:Mw(Dw(_u(n)))}}}function pF(i){const n=i.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(i.name){case"mercator":return new uF(i);case"equirectangular":return new _Y(i);case"naturalEarth":return new vY(i);case"equalEarth":return new gY(i);case"winkelTripel":return new xY(i);case"albers":return o?new fF(i):new mY(i);case"lambertConformalConic":return o?new fF(i):new yY(i);case"globe":return new bY(i)}throw new Error(`Invalid projection name: ${i.name}`)}const wY=jw.types,TY=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function iT(i,n,o,u,h,p,m,v,w,E,C,P,M){const z=v?Math.min(Zd,Math.round(v[0])):0,j=v?Math.min(Zd,Math.round(v[1])):0;i.emplaceBack(n,o,Math.round(32*u),Math.round(32*h),p,m,(z<<1)+(w?1:0),j,16*E,16*C,256*P,256*M)}function sT(i,n,o){i.emplaceBack(n,o)}function oT(i,n,o,u,h,p,m){i.emplaceBack(n,o,u,h,p,m)}function aT(i,n,o,u,h){i.emplaceBack(n,o,u,h),i.emplaceBack(n,o,u,h),i.emplaceBack(n,o,u,h),i.emplaceBack(n,o,u,h)}function EY(i){for(const n of i.sections)if(Gn(n.text))return!0;return!1}class i3{constructor(n){this.layoutVertexArray=new JA,this.indexArray=new Gs,this.programConfigurations=n,this.segments=new Ei,this.dynamicLayoutVertexArray=new zd,this.opacityVertexArray=new tP,this.placedSymbolArray=new CL,this.iconTransitioningVertexArray=new Bd,this.globeExtVertexArray=new eP,this.zOffsetVertexArray=new Qg}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,o,u,h,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,CQ.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,PQ.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,TY,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,RQ.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,AQ.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,xN.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}qe(i3,"SymbolBuffers");class s3{constructor(n,o,u){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new u,this.segments=new Ei,this.collisionVertexArray=new iP,this.collisionVertexArrayExt=new zd}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,MQ.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,kQ.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qe(s3,"CollisionBuffers");class m_{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=a.ae.identity([]),this.placementViewportMatrix=a.ae.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=XP(this.zoom,o["text-size"]),this.iconSizeData=XP(this.zoom,o["icon-size"]);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),p=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(m=>sl[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new i3(new Ud(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^text/.test(n))),this.icon=new i3(new Ud(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^icon/.test(n))),this.glyphOffsetArray=new RL,this.lineVertexArray=new ML,this.symbolInstances=new PL}calculateGlyphDependencies(n,o,u,h,p){for(let m=0;m<n.length;m++){const v=n.codePointAt(m);if(v===void 0)break;if(o[v]=!0,h&&p&&v<=65535){const w=gv[n.charAt(m)];w&&(o[w.charCodeAt(0)]=!0)}}}updateFootprints(n,o){}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!WP(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(n,o,u,h){const p=this.layers[0],m=p.layout,v=this.projection.name==="globe",w=m.get("text-font"),E=m.get("text-field"),C=m.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof bo&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),M=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!P&&!M)return;const j=o.iconDependencies,V=o.glyphDependencies,$=o.availableImages,Y=new Mn(this.zoom);for(const{feature:me,id:pe,index:ge,sourceLayerIndex:Pe}of n){const Re=p._featureFilter.needGeometry,ze=wh(me,Re);if(!p._featureFilter.filter(Y,ze,u))continue;if(Re||(ze.geometry=Sc(me,u,h)),v&&me.type!==1&&u.z<=5){const Je=ze.geometry,ut=.98078528056,Ct=(ht,Mt)=>{const lt=iv(ht.x,ht.y,u,1),xt=iv(Mt.x,Mt.y,u,1);return a.$.dot(lt,xt)<ut};for(let ht=0;ht<Je.length;ht++)Je[ht]=bK(Je[ht],Ct)}let Ge,Ke;if(P){const Je=p.getValueAndResolveTokens("text-field",ze,u,$),ut=bo.factory(Je);EY(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||Wn()==="unavailable"||this.hasRTLText&&or.isParsed())&&(Ge=QQ(ut,p,ze))}if(M){const Je=p.getValueAndResolveTokens("icon-image",ze,u,$);Ke=Je instanceof ua?Je:ua.fromString(Je)}if(!Ge&&!Ke)continue;const it=this.sortFeaturesByKey?z.evaluate(ze,{},u):void 0;if(this.features.push({id:pe,text:Ge,icon:Ke,index:ge,sourceLayerIndex:Pe,geometry:ze.geometry,properties:me.properties,type:wY[me.type],sortKey:it}),Ke&&(j[Ke.namePrimary]=!0,Ke.nameSecondary&&(j[Ke.nameSecondary]=!0)),Ge){const Je=w.evaluate(ze,{},u).join(","),ut=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(sl.vertical)>=0;for(const Ct of Ge.sections)if(Ct.image)j[Ct.image.namePrimary]=!0;else{const ht=vt(Ge.toString()),Mt=Ct.fontStack||Je,lt=V[Mt]=V[Mt]||{};this.calculateGlyphDependencies(Ct.text,lt,ut,this.allowVerticalPlacement,ht)}}}m.get("symbol-placement")==="line"&&(this.features=function(me){const pe={},ge={},Pe=[];let Re=0;function ze(Je){Pe.push(me[Je]),Re++}function Ge(Je,ut,Ct){const ht=ge[Je];return delete ge[Je],ge[ut]=ht,Pe[ht].geometry[0].pop(),Pe[ht].geometry[0]=Pe[ht].geometry[0].concat(Ct[0]),ht}function Ke(Je,ut,Ct){const ht=pe[ut];return delete pe[ut],pe[Je]=ht,Pe[ht].geometry[0].shift(),Pe[ht].geometry[0]=Ct[0].concat(Pe[ht].geometry[0]),ht}function it(Je,ut,Ct){const ht=Ct?ut[0][ut[0].length-1]:ut[0][0];return`${Je}:${ht.x}:${ht.y}`}for(let Je=0;Je<me.length;Je++){const ut=me[Je],Ct=ut.geometry,ht=ut.text?ut.text.toString():null;if(!ht){ze(Je);continue}const Mt=it(ht,Ct),lt=it(ht,Ct,!0);if(Mt in ge&&lt in pe&&ge[Mt]!==pe[lt]){const xt=Ke(Mt,lt,Ct),Ot=Ge(Mt,lt,Pe[xt].geometry);delete pe[Mt],delete ge[lt],ge[it(ht,Pe[Ot].geometry,!0)]=Ot,Pe[xt].geometry=null}else Mt in ge?Ge(Mt,lt,Ct):lt in pe?Ke(Mt,lt,Ct):(ze(Je),pe[Mt]=Re-1,ge[lt]=Re-1)}return Pe.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,pe)=>me.sortKey-pe.sortKey)}update(n,o,u,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,o,v,u,h,p),this.icon.programConfigurations.updatePaintArrays(n,o,v,u,h,p)}updateZOffset(){const n=(p,m,v)=>{u+=m,u>p.length&&p.resize(u);for(let w=-m;w<0;w++)p.emplace(w+u,v)},o=(p,m,v)=>{h+=m,h>p.length&&p.resize(h);for(let w=-m;w<0;w++)p.emplace(w+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:w,numIconVertices:E}=m,C=m.zOffset,P=E>0;if((v>0||w>0)&&(n(this.text.zOffsetVertexArray,v,C),n(this.text.zOffsetVertexArray,w,C)),P){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:z}=m;M>=0&&o(this.icon.zOffsetVertexArray,E,C),z>=0&&o(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=pF(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const u=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:h,y:p}of o)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,o,u,h,p,m,v,w,E,C,P,M,z,j,V,$){const Y=n.indexArray,me=n.layoutVertexArray,pe=n.globeExtVertexArray,ge=n.segments.prepareSegment(4*o.length,me,Y,this.canOverlap?m.sortKey:void 0),Pe=this.glyphOffsetArray.length,Re=ge.vertexLength,ze=this.allowVerticalPlacement&&v===sl.vertical?Math.PI/2:0,Ge=m.text&&m.text.sections;for(let it=0;it<o.length;it++){const{tl:Je,tr:ut,bl:Ct,br:ht,texPrimary:Mt,texSecondary:lt,pixelOffsetTL:xt,pixelOffsetBR:Ot,minFontScaleX:ft,minFontScaleY:jt,glyphOffset:Dt,isSDF:Pt,sectionIndex:vn}=o[it],mn=ge.vertexLength,tn=Dt[1];if(iT(me,E.x,E.y,Je.x,tn+Je.y,Mt.x,Mt.y,u,Pt,xt.x,xt.y,ft,jt),iT(me,E.x,E.y,ut.x,tn+ut.y,Mt.x+Mt.w,Mt.y,u,Pt,Ot.x,xt.y,ft,jt),iT(me,E.x,E.y,Ct.x,tn+Ct.y,Mt.x,Mt.y+Mt.h,u,Pt,xt.x,Ot.y,ft,jt),iT(me,E.x,E.y,ht.x,tn+ht.y,Mt.x+Mt.w,Mt.y+Mt.h,u,Pt,Ot.x,Ot.y,ft,jt),w){const{x:Nt,y:Rn,z:gn}=w.anchor,[cn,Bn,Un]=w.up;oT(pe,Nt,Rn,gn,cn,Bn,Un),oT(pe,Nt,Rn,gn,cn,Bn,Un),oT(pe,Nt,Rn,gn,cn,Bn,Un),oT(pe,Nt,Rn,gn,cn,Bn,Un),aT(n.dynamicLayoutVertexArray,Nt,Rn,gn,ze)}else aT(n.dynamicLayoutVertexArray,E.x,E.y,E.z,ze);if($){const Nt=lt||Mt;sT(n.iconTransitioningVertexArray,Nt.x,Nt.y),sT(n.iconTransitioningVertexArray,Nt.x+Nt.w,Nt.y),sT(n.iconTransitioningVertexArray,Nt.x,Nt.y+Nt.h),sT(n.iconTransitioningVertexArray,Nt.x+Nt.w,Nt.y+Nt.h)}Y.emplaceBack(mn,mn+1,mn+2),Y.emplaceBack(mn+1,mn+2,mn+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),it!==o.length-1&&vn===o[it+1].sectionIndex||n.programConfigurations.populatePaintArrays(me.length,m,m.index,{},z,j,V,Ge&&Ge[vn])}const Ke=w?w.anchor:E;n.placedSymbolArray.emplaceBack(Ke.x,Ke.y,Ke.z,E.x,E.y,Pe,this.glyphOffsetArray.length-Pe,Re,C,P,E.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],v,0,!1,0,M,0)}_commitLayoutVertex(n,o,u,h,p,m,v){n.emplaceBack(o,u,h,p,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(n,o,u,h,p,m,v){const w=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=w.vertexLength,C=v.tileAnchorX,P=v.tileAnchorY;for(let z=0;z<4;z++)u.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,n.padding,v.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new Ft(n.x1,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new Ft(n.x2,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new Ft(n.x2,n.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new Ft(n.x1,n.y2)),w.vertexLength+=4;const M=u.indexArray;M.emplaceBack(E,E+1),M.emplaceBack(E+1,E+2),M.emplaceBack(E+2,E+3),M.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceTextSize(n,m,o,v);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceIconSize(n,o,m.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}generateCollisionDebugBuffers(n,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new s3(ww,bN.members,Bd),this.iconCollisionBox=new s3(ww,bN.members,Bd);const u=u_(this.iconSizeData,n),h=u_(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,n,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,n,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(u,n,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(u,n,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(n,o,u,h){const p=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),m=Kw(this.textSizeData,n,p)/fo;return this.tilePixelRatio*m}getSymbolInstanceIconSize(n,o,u){const h=this.icon.placedSymbolArray.get(u),p=Kw(this.iconSizeData,n,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(n,o,u,h){n.emplaceBack(o,-u,-u,h),n.emplaceBack(o,u,-u,h),n.emplaceBack(o,u,u,h),n.emplaceBack(o,-u,u,h)}_updateTextDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceTextSize(n,m,o,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceIconSize(n,o,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding,m.zOffset)}}updateCollisionDebugBuffers(n,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=u_(this.iconSizeData,n),h=u_(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,n,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,n,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(u,n,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(u,n,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,u,h,p,m,v,w,E){const C={};if(o<u){const{x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:me,tileAnchorX:pe,tileAnchorY:ge,featureIndex:Pe}=n.get(o);C.textBox={x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:me,tileAnchorX:pe,tileAnchorY:ge},C.textFeatureIndex=Pe}if(h<p){const{x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:me,tileAnchorX:pe,tileAnchorY:ge,featureIndex:Pe}=n.get(h);C.verticalTextBox={x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:me,tileAnchorX:pe,tileAnchorY:ge},C.verticalTextFeatureIndex=Pe}if(m<v){const{x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:me,tileAnchorX:pe,tileAnchorY:ge,featureIndex:Pe}=n.get(m);C.iconBox={x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:me,tileAnchorX:pe,tileAnchorY:ge},C.iconFeatureIndex=Pe}if(w<E){const{x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:me,tileAnchorX:pe,tileAnchorY:ge,featureIndex:Pe}=n.get(w);C.verticalIconBox={x1:P,y1:M,x2:z,y2:j,padding:V,projectedAnchorX:$,projectedAnchorY:Y,projectedAnchorZ:me,tileAnchorX:pe,tileAnchorY:ge},C.verticalIconFeatureIndex=Pe}return C}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,o){const u=n.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs;for(let p=u.vertexStartIndex;p<h;p+=4)n.indexArray.emplaceBack(p,p+1,p+2),n.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),u=Math.cos(n),h=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(o*w.tileAnchorX+u*w.tileAnchorY)),p.push(w.featureIndex)}return m.sort((v,w)=>h[v]-h[w]||p[w]-p[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}qe(m_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),m_.addDynamicAttributes=aT;class Ll{constructor(n,o,u,h){this.context=n,this.format=u,this.texture=n.gl.createTexture(),this.update(o,h)}update(n,o,u){const{width:h,height:p}=n,{context:m}=this,{gl:v}=m;if(v.bindTexture(v.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!o||o.premultiply!==!1)),this.useMipmap=!!(o&&o.useMipmap),u||this.size&&this.size[0]===h&&this.size[1]===p){const{x:w,y:E}=u||{x:0,y:0};if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap)v.texSubImage2D(v.TEXTURE_2D,0,w,E,v.RGBA,v.UNSIGNED_BYTE,n);else{let C=this.format,P=v.UNSIGNED_BYTE;this.format===v.R32F&&(C=v.RED,P=v.FLOAT),v.texSubImage2D(v.TEXTURE_2D,0,w,E,h,p,C,P,n.data)}}else if(this.size=[h,p],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap){let w=this.format;this.format===v.R8&&(w=v.RED),v.texImage2D(v.TEXTURE_2D,0,this.format,w,v.UNSIGNED_BYTE,n)}else{let w=this.format,E=this.format,C=v.UNSIGNED_BYTE,P=!1;this.format===v.DEPTH_COMPONENT&&(w=v.DEPTH_COMPONENT16,C=v.UNSIGNED_SHORT),this.format===v.DEPTH_STENCIL&&(w=v.DEPTH24_STENCIL8,C=v.UNSIGNED_INT_24_8,P=!0),this.format===v.R8&&(E=v.RED),this.format===v.R32F&&(C=v.FLOAT,E=v.RED),!this.useMipmap&&P?v.texStorage2D(v.TEXTURE_2D,1,w,h,p):v.texImage2D(v.TEXTURE_2D,0,w,h,p,0,E,C,n.data)}this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,o,u=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!u?n===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(n,o,u,h){const{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),o!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),this.magFilter=o),n!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?n===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),u!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class lT{constructor(n,o){this.context=n,this.texture=o}bind(n,o){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,n),this.minFilter=n),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}}const zl=32,vu=33,Kd=new Uint16Array(8184);for(let i=0;i<2046;i++){let n=i+2,o=0,u=0,h=0,p=0,m=0,v=0;for(1&n?h=p=m=zl:o=u=v=zl;(n>>=1)>1;){const E=o+h>>1,C=u+p>>1;1&n?(h=o,p=u,o=m,u=v):(o=h,u=p,h=m,p=v),m=E,v=C}const w=4*i;Kd[w+0]=o,Kd[w+1]=u,Kd[w+2]=h,Kd[w+3]=p}const xu=new Uint16Array(2178),Qd=new Uint8Array(1089),cT=new Uint16Array(1089);function mF(i){return i===0?-.03125:i===32?.03125:0}var uT=kr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Hp{constructor(n,o,u,h){this.id=Hp.uniqueIdxCounter,Hp.uniqueIdxCounter++,this.context=n;const p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||h||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Hp.uniqueIdxCounter,Hp.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Hp.uniqueIdxCounter=0;class g_{constructor(n,o,u){this.func=n,this.mask=o,this.range=u}}g_.ReadOnly=!1,g_.ReadWrite=!0,g_.disabled=new g_(519,g_.ReadOnly,[0,1]);const o3=7680;class a3{constructor(n,o,u,h,p,m){this.test=n,this.ref=o,this.mask=u,this.fail=h,this.depthFail=p,this.pass=m}}a3.disabled=new a3({func:519,mask:0},0,0,o3,o3,o3);const Ev=771;class Oa{constructor(n,o,u,h){this.blendFunction=n,this.blendColor=o,this.mask=u,this.blendEquation=h}}Oa.Replace=[1,0,1,0],Oa.disabled=new Oa(Oa.Replace,Ir.transparent,[!1,!1,!1,!1]),Oa.unblended=new Oa(Oa.Replace,Ir.transparent,[!0,!0,!0,!0]),Oa.alphaBlended=new Oa([1,Ev,1,Ev],Ir.transparent,[!0,!0,!0,!0]),Oa.alphaBlendedNonPremultiplied=new Oa([770,Ev,770,Ev],Ir.transparent,[!0,!0,!0,!0]),Oa.multiply=new Oa([774,0,774,0],Ir.transparent,[!0,!0,!0,!0]);const l3=1029,c3=2305;class Ac{constructor(n,o,u){this.enable=n,this.mode=o,this.frontFace=u}}Ac.disabled=new Ac(!1,l3,c3),Ac.backCCW=new Ac(!0,l3,c3),Ac.backCW=new Ac(!0,l3,2304),Ac.frontCW=new Ac(!0,1028,2304),Ac.frontCCW=new Ac(!0,1028,c3);var SY=kr([{name:"a_index",type:"Int16",components:1}]);const gF={type:2,extent:zt,loadGeometry:()=>[[new Ft(0,0),new Ft(zt+1,0),new Ft(zt+1,zt+1),new Ft(0,zt+1),new Ft(0,0)]]};class hT{constructor(n,o,u,h,p){this.tileID=n,this.uid=hc(),this.uses=0,this.tileSize=o,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<rn.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Wp(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,u){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(h,p){const m={};if(!p)return m;for(const v of h){const w=v.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(E=>w.filter(C=>C.id===E)[0]));for(const E of w)m[E.fqid]=v}}return m}(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof m_){if(this.hasSymbolBuckets=!0,!u)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof m_&&p.hasRTLText){this.hasRTLText=!0,or.isLoading()||or.isLoaded()||Wn()!=="deferred"||wr();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h],m=o.style.getOwnLayer(h);if(!m)continue;const v=m.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,v)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new dP}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(n)}const o=n.gl,u=this.imageAtlas;if(u&&!u.uploaded){const h=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new Ll(n,u.image,o.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ll(n,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ll(n,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(n,o,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,u),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const h=o.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,o)))}queryRenderedFeatures(n,o,u,h,p,m,v,w){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:m,params:p,tileTransform:this.tileTransform},n,o,u):{}}querySourceFeatures(n,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const h=u.loadVTLayers(),p=o?o.sourceLayer:"",m=h._geojsonTileLayer||h[p];if(!m)return;const v=wc(o&&o.filter),{z:w,x:E,y:C}=this.tileID.canonical,P={z:w,x:E,y:C};for(let M=0;M<m.length;M++){const z=m.feature(M);if(v.needGeometry){const $=wh(z,!0);if(!v.filter(new Mn(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!v.filter(new Mn(this.tileID.overscaledZ),z))continue;const j=u.getId(z,p),V=new NN(z,w,E,C,j);V.tile=P,n.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const u=su(n.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const u=Date.now();let h=!1;if(this.expirationTime>u)h=!1;else if(o)if(this.expirationTime<o)h=!0;else{const p=this.expirationTime-o;p?this.expirationTime=u+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&o&&this.updateBuckets(n,o)}updateBuckets(n,o){if(!this.latestFeatureIndex)return;const u=this.latestFeatureIndex.loadVTLayers(),h=o.style.listImages(),p=o.style.getBrightness();for(const m in this.buckets){if(!o.style.hasLayer(m))continue;const v=this.buckets[m],w=v.layers[0].sourceLayer||"_geojsonTileLayer",E=u[w];let C={};if(n&&(C=n[w],!E||!C||Object.keys(C).length===0))continue;if(v.update(C,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),v instanceof Hw||v instanceof Fw){const M=o.style.getOwnSourceCache(v.layers[0].source);o._terrain&&o._terrain.enabled&&M&&v.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(M.id,this.tileID)}const P=o&&o.style&&o.style.getOwnLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<rn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=rn.now()+n}setTexture(n,o){const u=o.context,h=u.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof Ll?this.texture.update(n,{useMipmap:!0}):(this.texture=new Ll(u,n,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(n,o){const u={};for(const h of o)u[h]=!0;this.dependencies[n]=u}hasDependency(n,o){for(const u of n){const h=this.dependencies[u];if(h){for(const p of o)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const u=Sc(gF,this.tileID.canonical,this.tileTransform)[0],h=new Tc,p=new Q0;for(let m=0;m<u.length;m++){const{x:v,y:w}=u[m];h.emplaceBack(v,w),p.emplaceBack(m)}p.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(p),this._tileDebugBuffer=n.createVertexBuffer(h,rv.members),this._tileDebugSegments=Ei.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const u=Sc(gF,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const m=function(v,w){const E=Wp(v,w),C=Math.pow(2,v.z);for(let $=0;$<vu;$++)for(let Y=0;Y<vu;Y++){const me=ya((v.x+(Y+mF(Y))/zl)/C),pe=eo((v.y+($+mF($))/zl)/C),ge=w.project(me,pe),Pe=$*vu+Y;xu[2*Pe+0]=Math.round((ge.x*E.scale-E.x)*zt),xu[2*Pe+1]=Math.round((ge.y*E.scale-E.y)*zt)}Qd.fill(0),cT.fill(0);for(let $=2045;$>=0;$--){const Y=4*$,me=Kd[Y+0],pe=Kd[Y+1],ge=Kd[Y+2],Pe=Kd[Y+3],Re=me+ge>>1,ze=pe+Pe>>1,Ge=Re+ze-pe,Ke=ze+me-Re,it=pe*vu+me,Je=Pe*vu+ge,ut=ze*vu+Re,Ct=Math.hypot((xu[2*it+0]+xu[2*Je+0])/2-xu[2*ut+0],(xu[2*it+1]+xu[2*Je+1])/2-xu[2*ut+1])>=16;Qd[ut]=Qd[ut]||(Ct?1:0),$<1022&&(Qd[ut]=Qd[ut]||Qd[(pe+Ke>>1)*vu+(me+Ge>>1)]||Qd[(Pe+Ke>>1)*vu+(ge+Ge>>1)])}const P=new yh,M=new Gs;let z=0;function j($,Y){const me=Y*vu+$;return cT[me]===0&&(P.emplaceBack(xu[2*me+0],xu[2*me+1],$*zt/zl,Y*zt/zl),cT[me]=++z),cT[me]-1}function V($,Y,me,pe,ge,Pe){const Re=$+me>>1,ze=Y+pe>>1;if(Math.abs($-ge)+Math.abs(Y-Pe)>1&&Qd[ze*vu+Re])V(ge,Pe,$,Y,Re,ze),V(me,pe,ge,Pe,Re,ze);else{const Ge=j($,Y),Ke=j(me,pe),it=j(ge,Pe);M.emplaceBack(Ge,Ke,it)}}return V(0,0,zl,zl,zl,0),V(zl,zl,0,0,0,zl),{vertices:P,indices:M}}(this.tileID.canonical,o);h=m.vertices,p=m.indices}else{h=new yh,p=new Gs;for(const{x:v,y:w}of u)h.emplaceBack(v,w,0,0);const m=av(h.int16,void 0,4);for(let v=0;v<m.length;v+=3)p.emplaceBack(m[v],m[v+1],m[v+2])}this._tileBoundsBuffer=n.createVertexBuffer(h,uT.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(p),this._tileBoundsSegments=Ei.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(n,o){const u=o.projection;if(!u||u.name!=="globe"||o.freezeTileCoverage)return;const h=this.tileID.canonical,p=sv(lz(h,o)),m=Eh(o.zoom);let v;m>0&&(v=a.ae.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,h,o,p,v,m),this._makeGlobeTileDebugTextBuffer(n,h,o,p,v,m)}_globePoint(n,o,u,h,p,m,v){let w=iv(n,o,u);if(m){const E=1<<u.z,C=mu(h.center.lng),P=gu(h.center.lat),M=(u.x+.5)/E-C;let z=0;M>.5?z=-1:M<-.5&&(z=1);let j=(n/zt+u.x)/E+z,V=(o/zt+u.y)/E;j=(j-C)*h._pixelsPerMercatorPixel+C,V=(V-P)*h._pixelsPerMercatorPixel+P;const $=[j*h.worldSize,V*h.worldSize,0];a.$.transformMat4($,$,m),w=Th(w,$,v)}return a.$.transformMat4(w,w,p)}_makeGlobeTileDebugBorderBuffer(n,o,u,h,p,m){const v=new Tc,w=new Q0,E=new vw,C=(M,z,j,V,$)=>{const Y=(j-M)/($-1),me=(V-z)/($-1),pe=v.length;for(let ge=0;ge<$;ge++){const Pe=M+ge*Y,Re=z+ge*me;v.emplaceBack(Pe,Re);const ze=this._globePoint(Pe,Re,o,u,h,p,m);E.emplaceBack(ze[0],ze[1],ze[2]),w.emplaceBack(pe+ge)}},P=zt;C(0,0,P,0,16),C(P,0,P,P,16),C(P,P,0,P,16),C(0,P,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(w),this._tileDebugBuffer=n.createVertexBuffer(v,rv.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(E,oz.members),this._tileDebugSegments=Ei.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugTextBuffer(n,o,u,h,p,m){const v=zt/4,w=new Tc,E=new Gs,C=new vw,P=25;E.reserve(32),w.reserve(P),C.reserve(P);const M=(z,j)=>P*z+j;for(let z=0;z<P;z++){const j=z*v;for(let V=0;V<P;V++){const $=V*v;w.emplaceBack($,j);const Y=this._globePoint($,j,o,u,h,p,m);C.emplaceBack(Y[0],Y[1],Y[2])}}for(let z=0;z<4;z++)for(let j=0;j<4;j++){const V=M(z,j),$=M(z,j+1),Y=M(z+1,j),me=M(z+1,j+1);E.emplaceBack(V,$,Y),E.emplaceBack(Y,$,me)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(E),this._tileDebugTextBuffer=n.createVertexBuffer(w,rv.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(C,oz.members),this._tileDebugTextSegments=Ei.simpleSegment(0,0,P,32)}destroy(n=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof Ll&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function IY(i,n,o){i===1?n.header_length=o.readFixed32():i===2?n.x=o.readVarint():i===3?n.y=o.readVarint():i===4?n.z=o.readVarint():i===5&&n.layers.push(function(u,h){return u.readFields(MY,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},h)}(o,o.readVarint()+o.pos))}function CY(i,n,o){i===1?(n.delta_filter=function(u,h){return u.readFields(AY,{block_size:0},h)}(o,o.readVarint()+o.pos),n.filter="delta_filter"):i===2?(o.readVarint(),n.filter="zigzag_filter"):i===3?(o.readVarint(),n.filter="bitshuffle_filter"):i===4&&(o.readVarint(),n.filter="byteshuffle_filter")}function AY(i,n,o){i===1&&(n.block_size=o.readVarint())}function PY(i,n,o){i===1?(o.readVarint(),n.codec="gzip_data"):i===2?(o.readVarint(),n.codec="jpeg_image"):i===3?(o.readVarint(),n.codec="webp_image"):i===4&&(o.readVarint(),n.codec="png_image")}function RY(i,n,o){i===1?n.first_byte=o.readFixed64():i===2?n.last_byte=o.readFixed64():i===3?n.filters.push(function(u,h){return u.readFields(CY,{},h)}(o,o.readVarint()+o.pos)):i===4?n.codec=function(u,h){return u.readFields(PY,{},h)}(o,o.readVarint()+o.pos):i===5?n.deprecated_offset=o.readFloat():i===6?n.deprecated_scale=o.readFloat():i===7?n.bands.push(o.readString()):i===8?n.offset=o.readDouble():i===9&&(n.scale=o.readDouble())}function MY(i,n,o){i===1?n.version=o.readVarint():i===2?n.name=o.readString():i===3?n.units=o.readString():i===4?n.tilesize=o.readVarint():i===5?n.buffer=o.readVarint():i===6?n.pixel_format=o.readVarint():i===7&&n.data_index.push(function(u,h){return u.readFields(RY,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},h)}(o,o.readVarint()+o.pos))}function kY(i,n,o){if(i===2)(function(u,h,p){u.readFields(DY,p,h)})(o,o.readVarint()+o.pos,n);else if(i===3)throw new Error("Not implemented")}function DY(i,n,o){if(i===1){let u=0;const h=o.readVarint()+o.pos;for(;o.pos<h;)n[u++]=o.readVarint()}}class OY{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const o=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,o),o}put(n,o){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,o)}}function LY(i,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let o=n[3];for(let u=2;u>=1;u--){const h=u===1?1:0,p=u===2?1:0;for(let m=0;m<n[0];m++){const v=n[1]*m;for(let w=h;w<n[1];w++){const E=n[2]*(w+v);for(let C=p;C<n[2];C++){const P=n[3]*(C+E);for(let M=0;M<n[3];M++){const z=P+M;i[z]+=i[z-o]}}}}o*=n[u]}return i}function zY(i){for(let n=0,o=i.length;n<o;n++)i[n]=i[n]>>>1^-(1&i[n]);return i}function NY(i,n){switch(n){case"uint32":return i;case"uint16":for(let o=0;o<i.length;o+=2){const u=i[o],h=i[o+1];i[o]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,i[o+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return i;case"uint8":for(let o=0;o<i.length;o+=4){const u=i[o],h=i[o+1],p=i[o+2],m=i[o+3];i[o+0]=(192&u)>>6|(192&h)>>4|(192&p)>>2|192&m,i[o+1]=(48&u)>>4|(48&h)>>2|48&p|(48&m)<<2,i[o+2]=(12&u)>>2|12&h|(12&p)<<2|(12&m)<<4,i[o+3]=3&u|(3&h)<<2|(3&p)<<4|(3&m)<<6}return i;default:throw new Error(`Invalid pixel format, "${n}"`)}}var ol=Uint8Array,Sv=Uint16Array,FY=Int32Array,_F=new ol([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yF=new ol([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),BY=new ol([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vF=function(i,n){for(var o=new Sv(31),u=0;u<31;++u)o[u]=n+=1<<i[u-1];var h=new FY(o[30]);for(u=1;u<30;++u)for(var p=o[u];p<o[u+1];++p)h[p]=p-o[u]<<5|u;return{b:o,r:h}},xF=vF(_F,2),bF=xF.b,jY=xF.r;bF[28]=258,jY[258]=28;for(var UY=vF(yF,0).b,wF=new Sv(32768),Ji=0;Ji<32768;++Ji){var __=(43690&Ji)>>1|(21845&Ji)<<1;wF[Ji]=((65280&(__=(61680&(__=(52428&__)>>2|(13107&__)<<2))>>4|(3855&__)<<4))>>8|(255&__)<<8)>>1}var Iv=function(i,n,o){for(var u=i.length,h=0,p=new Sv(n);h<u;++h)i[h]&&++p[i[h]-1];var m,v=new Sv(n);for(h=1;h<n;++h)v[h]=v[h-1]+p[h-1]<<1;m=new Sv(1<<n);var w=15-n;for(h=0;h<u;++h)if(i[h])for(var E=h<<4|i[h],C=n-i[h],P=v[i[h]-1]++<<C,M=P|(1<<C)-1;P<=M;++P)m[wF[P]>>w]=E;return m},Cv=new ol(288);for(Ji=0;Ji<144;++Ji)Cv[Ji]=8;for(Ji=144;Ji<256;++Ji)Cv[Ji]=9;for(Ji=256;Ji<280;++Ji)Cv[Ji]=7;for(Ji=280;Ji<288;++Ji)Cv[Ji]=8;var TF=new ol(32);for(Ji=0;Ji<32;++Ji)TF[Ji]=5;var VY=Iv(Cv,9),$Y=Iv(TF,5),u3=function(i){for(var n=i[0],o=1;o<i.length;++o)i[o]>n&&(n=i[o]);return n},Pc=function(i,n,o){var u=n/8|0;return(i[u]|i[u+1]<<8)>>(7&n)&o},h3=function(i,n){var o=n/8|0;return(i[o]|i[o+1]<<8|i[o+2]<<16)>>(7&n)},qY=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Rc=function(i,n,o){var u=new Error(n||qY[i]);if(u.code=i,Error.captureStackTrace&&Error.captureStackTrace(u,Rc),!o)throw u;return u},GY=new ol(0),WY=typeof TextDecoder!="undefined"&&new TextDecoder;try{WY.decode(GY,{stream:!0})}catch(i){}const HY={gzip_data:"gzip"};class Nl extends Error{constructor(n){super(n),this.name="MRTError"}}const ZY={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},EF={uint32:1,uint16:2,uint8:4},XY={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let d3,f3;class Av{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const o=this.layers[n];if(!o)throw new Nl(`Layer '${n}' not found`);return o}getHeaderLength(n){const o=new Uint8Array(n),u=new DataView(n);if(o[0]!==13)throw new Nl("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(n){const o=new Uint8Array(n),u=this.getHeaderLength(n);if(o.length<u)throw new Nl(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const h=function(p,m){return p.readFields(IY,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new d3(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Nl(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new KY(p,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const o=[],u=this.getLayer(n.layerName);for(let h of n.blockIndices){const p=u.dataIndex[h],m=p.first_byte-n.firstByte,v=p.last_byte-n.firstByte;if(u._blocksInProgress.has(h))continue;const w={layerName:u.name,firstByte:m,lastByte:v,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(u.bandShape),buffer:u.buffer,codec:p.codec.codec,filters:p.filters.map(E=>E.filter)};u._blocksInProgress.add(h),o.push(w)}return new SF(o,()=>{o.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,p)=>{if(o.forEach(m=>u._blocksInProgress.delete(m.blockIndex)),h)throw h;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class KY{constructor({version:n,name:o,units:u,tilesize:h,pixel_format:p,buffer:m,data_index:v},w){if(this.version=n,this.version!==1)throw new Nl(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=o,this.units=u,this.tileSize=h,this.buffer=m,this.pixelFormat=ZY[p],this.dataIndex=v,this.bandShape=[h+2*m,h+2*m,EF[this.pixelFormat]],this._decodedBlocks=new OY(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return EF[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const o=n.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,n.data)}getBlockForBand(n){let o=0;switch(typeof n){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[p,m]of h.bands.entries())if(m===n)return{bandIndex:o+p,blockIndex:u,blockBandIndex:p};o+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(n>=o&&n<o+h.bands.length)return{bandIndex:n,blockIndex:u,blockBandIndex:n-o};o+=h.bands.length}break;default:throw new Nl(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new Nl(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let o=1/0,u=-1/0;const h=[],p=new Set;for(const m of n){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new Nl(`Invalid band: ${JSON.stringify(m)}`);const w=this.dataIndex[v];h.includes(v)||h.push(v),p.add(v),o=Math.min(o,w.first_byte),u=Math.max(u,w.last_byte)}if(p.size>this.cacheSize)throw new Nl(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:h}}hasBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0}hasDataForBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(n){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(n),h=this._decodedBlocks.get(o.toString());if(!h)throw new Nl(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[o],m=this.bandShape.reduce((E,C)=>E*C,1),v=u*m,w=h.subarray(v,v+m);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset!==0?p.offset:p.deprecated_offset,scale:p.scale!==0?p.scale:p.deprecated_scale}}}Av.setPbf=function(i){d3=i};class SF{constructor(n,o,u){this.tasks=n,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,o){this._finalized||(this._onComplete(n,o),this._finalized=!0)}}Av.performDecoding=function(i,n){const o=new Uint8Array(i);return Promise.all(n.tasks.map(u=>{const{layerName:h,firstByte:p,lastByte:m,pixelFormat:v,blockShape:w,blockIndex:E,filters:C,codec:P}=u,M=o.subarray(p,m+1),z=new Uint32Array(w[0]*w[1]*w[2]);let j;if(P!=="gzip_data")throw new Nl(`Unhandled codec: ${P}`);return j=function(V,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve(((ge=function(ze){ze[0]==31&&ze[1]==139&&ze[2]==8||Rc(6,"invalid gzip data");var Ge=ze[3],Ke=10;4&Ge&&(Ke+=2+(ze[10]|ze[11]<<8));for(var it=(Ge>>3&1)+(Ge>>4&1);it>0;it-=!ze[Ke++]);return Ke+(2&Ge)}(pe=V))+8>pe.length&&Rc(6,"invalid gzip data"),function(ze,Ge,Ke,it){var Je=ze.length;if(!Je||Ge.f&&!Ge.l)return Ke||new ol(0);var ut=!Ke,Ct=ut||Ge.i!=2,ht=Ge.i;ut&&(Ke=new ol(3*Je));var Mt,lt,xt=function(Jd){var Jp=Ke.length;if(Jd>Jp){var Fv=new ol(Math.max(2*Jp,Jd));Fv.set(Ke),Ke=Fv}},Ot=Ge.f||0,ft=Ge.p||0,jt=Ge.b||0,Dt=Ge.l,Pt=Ge.d,vn=Ge.m,mn=Ge.n,tn=8*Je;do{if(!Dt){Ot=Pc(ze,ft,1);var Nt=Pc(ze,ft+1,3);if(ft+=3,!Nt){var Rn=ze[(Vn=4+((ft+7)/8|0))-4]|ze[Vn-3]<<8,gn=Vn+Rn;if(gn>Je){ht&&Rc(0);break}Ct&&xt(jt+Rn),Ke.set(ze.subarray(Vn,gn),jt),Ge.b=jt+=Rn,Ge.p=ft=8*gn,Ge.f=Ot;continue}if(Nt==1)Dt=VY,Pt=$Y,vn=9,mn=5;else if(Nt==2){var cn=Pc(ze,ft,31)+257,Bn=Pc(ze,ft+10,15)+4,Un=cn+Pc(ze,ft+5,31)+1;ft+=14;for(var jn=new ol(Un),Kn=new ol(19),yr=0;yr<Bn;++yr)Kn[BY[yr]]=Pc(ze,ft+3*yr,7);ft+=3*Bn;var lr=u3(Kn),$r=(1<<lr)-1,Hr=Iv(Kn,lr);for(yr=0;yr<Un;){var Vn,Dr=Hr[Pc(ze,ft,$r)];if(ft+=15&Dr,(Vn=Dr>>4)<16)jn[yr++]=Vn;else{var Fr=0,ii=0;for(Vn==16?(ii=3+Pc(ze,ft,3),ft+=2,Fr=jn[yr-1]):Vn==17?(ii=3+Pc(ze,ft,7),ft+=3):Vn==18&&(ii=11+Pc(ze,ft,127),ft+=7);ii--;)jn[yr++]=Fr}}var ji=jn.subarray(0,cn),es=jn.subarray(cn);vn=u3(ji),mn=u3(es),Dt=Iv(ji,vn),Pt=Iv(es,mn)}else Rc(1);if(ft>tn){ht&&Rc(0);break}}Ct&&xt(jt+131072);for(var Ui=(1<<vn)-1,Ri=(1<<mn)-1,Ws=ft;;Ws=ft){var ms=(Fr=Dt[h3(ze,ft)&Ui])>>4;if((ft+=15&Fr)>tn){ht&&Rc(0);break}if(Fr||Rc(2),ms<256)Ke[jt++]=ms;else{if(ms==256){Ws=ft,Dt=null;break}var po=ms-254;ms>264&&(po=Pc(ze,ft,(1<<(kc=_F[yr=ms-257]))-1)+bF[yr],ft+=kc);var ti=Pt[h3(ze,ft)&Ri],va=ti>>4;if(ti||Rc(3),ft+=15&ti,es=UY[va],va>3){var kc=yF[va];es+=h3(ze,ft)&(1<<kc)-1,ft+=kc}if(ft>tn){ht&&Rc(0);break}Ct&&xt(jt+131072);var Fl=jt+po;if(jt<es){var Bl=0-es,Yp=Math.min(es,Fl);for(Bl+jt<0&&Rc(3);jt<Yp;++jt)Ke[jt]=(void 0)[Bl+jt]}for(;jt<Fl;++jt)Ke[jt]=Ke[jt-es]}}Ge.l=Dt,Ge.p=Ws,Ge.b=jt,Ge.f=Ot,Dt&&(Ot=1,Ge.m=vn,Ge.d=Pt,Ge.n=mn)}while(!Ot);return jt!=Ke.length&&ut?(Mt=Ke,((lt=jt)==null||lt>Mt.length)&&(lt=Mt.length),new ol(Mt.subarray(0,lt))):Ke.subarray(0,jt)}(pe.subarray(ge,-8),{i:2},new ol(((Y=pe)[(me=Y.length)-4]|Y[me-3]<<8|Y[me-2]<<16|Y[me-1]<<24)>>>0))));var Y,me,pe,ge;const Pe=HY[$];if(!Pe)throw new Error(`Unhandled codec: ${$}`);const Re=new globalThis.DecompressionStream(Pe);return new Response(new Blob([V]).stream().pipeThrough(Re)).arrayBuffer().then(ze=>new Uint8Array(ze))}(M,P).then(V=>(function($,Y){$.readFields(kY,Y)}(new d3(V),z),new XY[v](z.buffer))),j.then(V=>{for(let $=C.length-1;$>=0;$--)switch(C[$]){case"delta_filter":LY(V,w);break;case"zigzag_filter":zY(V);break;case"bitshuffle_filter":NY(V,v);break;default:throw new Nl(`Unhandled filter "${C[$]}"`)}return{layerName:h,blockIndex:E,data:V}}).catch(V=>{throw V})}))},Av.setPbf(mv);class IF extends hT{constructor(n,o,u,h,p){super(n,o,u,h,p),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,o){const u=o.context,h=u.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof Ll?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new Ll(u,n,h.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,o){const u=this._mrt=new Av(30),h=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=oh(h,(p,m,v,w)=>{if(p)o(p);else try{const E=u.getHeaderLength(m);if(E>n)return void(this.request=this.fetchHeader(E,o));u.parseHeader(m),this._isHeaderLoaded=!0;let C=0;for(const P of Object.values(u.layers))C=Math.max(C,P.dataIndex[P.dataIndex.length-1].last_byte);m.byteLength>=C&&(this.entireBuffer=m),o(null,this.entireBuffer||m,v,w)}catch(E){o(E)}}),this.request}fetchBand(n,o,u){const h=this._mrt;if(!this._isHeaderLoaded||!h)return void u(new Error("Tile header is not ready"));const p=this.actor;if(!p)return void u(new Error("Can't fetch tile band without an actor"));let m;const v=(P,M)=>{m.complete(P,M),P?u(P):(this.updateTextureDescriptor(n,o),u(null,this.textureDescriptor&&this.textureDescriptor.img))},w=(P,M)=>{if(P)return u(P);const z=p.send("decodeRasterArray",{buffer:M,task:m},v,void 0,!0);this._workQueue.push(()=>{z&&z.cancel(),m.cancel()})},E=h.getLayer(n);if(!E)return void u(new Error(`Unknown sourceLayer "${n}"`));if(E.hasDataForBand(o))return this.updateTextureDescriptor(n,o),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const C=E.getDataRange([o]);if(m=h.createDecodingTask(C),!m||m.tasks.length)if(this.flushQueues(),this.entireBuffer)w(null,this.entireBuffer.slice(C.firstByte,C.lastByte+1));else{const P=Object.assign({},this.requestParams,{headers:{Range:`bytes=${C.firstByte}-${C.lastByte}`}}),M=oh(P,w);this._fetchQueue.push(()=>{M.cancel(),m.cancel()})}else u(null)}updateNeeded(n,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,o){if(!this._mrt)return;const u=this._mrt.getLayer(n);if(!u||!u.hasBand(o)||!u.hasDataForBand(o))return;const{bytes:h,tileSize:p,buffer:m,offset:v,scale:w}=u.getBandView(o),E=p+2*m,C={data:h,width:E,height:E},P=this.texture;P&&P instanceof Ll&&P.update(C,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:o,img:C,buffer:m,offset:v,tileSize:p,format:u.pixelFormat,mix:[w,256*w,65536*w,16777216*w]}}}class QY{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,u){const h=n.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:o,timeout:void 0};if(u!==void 0&&(p.timeout=setTimeout(()=>{this.remove(n,p)},u)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const u=n.wrapped().key,h=o===void 0?0:this.data[u].indexOf(o),p=this.data[u][h];return this.data[u].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(p.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const u in this.data)for(const h of this.data[u])n(h.value)||o.push(h);for(const u of o)this.remove(u.value.tileID,u)}}class Zp extends uh{constructor(n,o,u){super(),this.id=n,this._onlySymbols=u,o.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new QY(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new ZQ,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(n),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return uc(this._tiles).map(n=>n.tileID).sort(CF).map(n=>n.key)}getRenderableIds(n,o){const u=[];for(const h in this._tiles)this._isIdRenderable(+h,n,o)&&u.push(this._tiles[h]);return n?u.sort((h,p)=>{const m=h.tileID,v=p.tileID,w=new Ft(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new Ft(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||E.y-w.y||E.x-w.x}).map(h=>h.tileID.key):u.map(h=>h.tileID).sort(CF).map(h=>h.key)}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o,u){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())&&(u||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const u=this._tiles[n];u&&(u.state!=="loading"&&(u.state=o),this._loadTile(u,this._tileLoaded.bind(this,u,n,o)))}_tileLoaded(n,o,u,h){if(h)if(n.state="errored",h.status!==404)this._source.fire(new gp(h,{tile:n}));else{if(this._source.fire(new Rl("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=rn.now(),u==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Rl("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let h=0;h<o.length;h++){const p=o[h];if(n.neighboringTiles&&n.neighboringTiles[p]){const m=this.getTileByID(p);u(n,m),u(m,n)}}function u(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=p.tileID.canonical.x-h.tileID.canonical.x;const v=p.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),E=p.tileID.key;m===0&&v===0||Math.abs(v)>1||(Math.abs(m)>1&&(Math.abs(m+w)===1?m+=w:Math.abs(m-w)===1&&(m-=w)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,m,v),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,u,h){for(const p in this._tiles){let m=this._tiles[p];if(h[p]||!m.hasData()||m.tileID.overscaledZ<=o||m.tileID.overscaledZ>u)continue;let v=m.tileID;for(;m&&m.tileID.overscaledZ>o+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(v=E)}let w=v;for(;w.overscaledZ>o;)if(w=w.scaledTo(w.overscaledZ-1),n[w.key]){h[v.key]=v;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const u=this._loadedParentTiles[n.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=n.overscaledZ-1;u>=o;u--){const h=n.scaledTo(u),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const u=Math.ceil(n.width/o)+1,h=Math.ceil(n.height/o)+1,p=Math.floor(u*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const u={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+o),u[p.tileID.key]=p}this._tiles=u;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(n,o,u,h){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const p=this._source.type==="batched-model";let m;if(this.used||this.usedForTerrain){if(this._source.tileID)m=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new ws(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y));else if(this.tileCoverLift!==0){const E=n.clone();E.tileCoverLift=this.tileCoverLift,m=E.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.minzoom<=1&&n.projection.name==="globe"&&(m.push(new ws(1,0,1,0,0)),m.push(new ws(1,0,1,1,0)),m.push(new ws(1,0,1,0,1)),m.push(new ws(1,0,1,1,1)))}else if(m=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.hasTile){const E=this._source.hasTile.bind(this._source);m=m.filter(C=>E(C))}}else m=[];if(m.length>0&&this.castsShadows&&h&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!p3(this._source.type)){const E=n.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),C=Math.min(E,this._source.maxzoom);if(p){const P=n.extendTileCover(m,C);for(const M of P)m.push(M)}else{const P=n.extendTileCover(m,C,h);for(const M of P)this._shadowCasterTiles[M.key]=!0,m.push(M)}}const v=this._updateRetainedTiles(m);if(p3(this._source.type)&&m.length!==0){const E={},C={},P=Object.keys(v);for(const z of P){const j=v[z],V=this._tiles[z];if(!V||V.fadeEndTime&&V.fadeEndTime<=rn.now())continue;const $=this.findLoadedParent(j,Math.max(j.overscaledZ-Zp.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),E[$.tileID.key]=$.tileID),C[z]=j}const M=m[m.length-1].overscaledZ;for(const z in this._tiles){const j=this._tiles[z];if(v[z]||!j.hasData())continue;let V=j.tileID;for(;V.overscaledZ>M;){V=V.scaledTo(V.overscaledZ-1);const $=this._tiles[V.key];if($&&$.hasData()&&C[V.key]){v[z]=j.tileID;break}}}for(const z in E)v[z]||(this._coveredTiles[z]=!0,v[z]=E[z])}for(const E in v)this._tiles[E].clearFadeHold();const w=function(E,C){const P=[];for(const M in E)M in C||P.push(M);return P}(this._tiles,v);for(const E of w){const C=this._tiles[E];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const u={},h=n.reduce((E,C)=>Math.min(E,C.overscaledZ),1/0),p=n[0].overscaledZ,m=Math.max(p-Zp.maxOverzooming,this._source.minzoom),v=Math.max(p+Zp.maxUnderzooming,this._source.minzoom),w={};for(const E of n){const C=this._addTile(E);o[E.key]=E,C.hasData()||h<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,h,v,o);for(const E of n){let C=this._tiles[E.key];if(C.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const M=E.children(this._source.maxzoom)[0],z=this.getTile(M);if(z&&z.hasData()){o[M.key]=M;continue}}else{const M=E.children(this._source.maxzoom);if(o[M[0].key]&&o[M[1].key]&&o[M[2].key]&&o[M[3].key])continue}let P=C.wasRequested();for(let M=E.overscaledZ-1;M>=m;--M){const z=E.scaledTo(M);if(u[z.key]||(u[z.key]=!0,C=this.getTile(z),!C&&P&&(C=this._addTile(z)),C&&(o[z.key]=z,P=C.wasRequested(),C.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let u,h=this._tiles[n].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){u=this._loadedParentTiles[h.key];break}o.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(u=this._getLoadedTile(p),u)break;h=p}for(const p of o)this._loadedParentTiles[p]=u}}_addTile(n){let o=this._tiles[n.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const u=!!o;if(!u){const h=this.map?this.map.painter:null,p=this._source.tileSize*n.overscaleFactor();o=this._source.type==="raster-array"?new IF(n,p,this.transform.tileZoom,h,this._isRaster):new hT(n,p,this.transform.tileZoom,h,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,u||this._source.fire(new Rl("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const u=o.getExpiryTimeout();u&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},u))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,u){const h=[],p=this.transform;if(!p)return h;const m=p.projection.name==="globe",v=mu(p.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(u&&E.clearQueryDebugViz(),E.holdingForFade())continue;let C;if(m){const P=E.tileID.canonical;if(P.z===0){const M=[Math.abs(Yn(v,...Pv(P,-1))-v),Math.abs(Yn(v,...Pv(P,1))-v)];C=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(Yn(v,...Pv(P,-1))-v),Math.abs(Yn(v,...Pv(P,0))-v),Math.abs(Yn(v,...Pv(P,1))-v)];C=[M.indexOf(Math.min(...M))-1]}}else C=[0];for(const P of C){const M=n.containsTile(E,p,o,P);M&&h.push(M)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,o){const u=this.getRenderableIds(n,o).map(p=>this._tiles[p].tileID),h=this.transform.projection.name==="globe";for(const p of u)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=h?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return u}sortCoordinatesByDistance(n){const o=n.slice(),u=this.transform._camera.position,h=this.transform._camera.forward(),p={};for(const m of o){const v=1/(1<<m.canonical.z);p[m.key]=((m.canonical.x+.5)*v+m.wrap-u[0])*h[0]+((m.canonical.y+.5)*v-u[1])*h[1]-u[2]*h[2]}return o.sort((m,v)=>p[m.key]-p[v.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(p3(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=rn.now())return!0}return!1}setFeatureState(n,o,u){this._state.updateState(n=n||"_geojsonTileLayer",o,u)}removeFeatureState(n,o,u){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,u)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,u){const h=this._tiles[n];h&&h.setDependencies(o,u)}reloadTilesForDependencies(n,o){for(const u in this._tiles)this._tiles[u].hasDependency(n,o)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(n,o))}_preloadTiles(n,o){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(n,o))};return void this._source.on("data",v)}const u=new Map,h=Array.isArray(n)?n:[n],p=this.map.painter.terrain,m=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of h){const w=v.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)u.set(E.key,E);this.usedForTerrain&&v.updateElevation(!1)}ih(Array.from(u.values()),(v,w)=>{const E=new hT(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,C=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(C,E)})},o)}}function CF(i,n){const o=Math.abs(2*i.wrap)-+(i.wrap<0),u=Math.abs(2*n.wrap)-+(n.wrap<0);return i.overscaledZ-n.overscaledZ||u-o||n.canonical.y-i.canonical.y||n.canonical.x-i.canonical.x}function p3(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function Pv(i,n){const o=1<<i.z;return[i.x/o+n,(i.x+1)/o+n]}Zp.maxOverzooming=10,Zp.maxUnderzooming=3;const AF=()=>f3||(f3={layout:EN||(EN=new Wr({"line-cap":new un(tt.layout_line["line-cap"]),"line-join":new un(tt.layout_line["line-join"]),"line-miter-limit":new Rt(tt.layout_line["line-miter-limit"]),"line-round-limit":new Rt(tt.layout_line["line-round-limit"]),"line-sort-key":new un(tt.layout_line["line-sort-key"]),"line-z-offset":new un(tt.layout_line["line-z-offset"]),visibility:new Rt(tt.layout_line.visibility)})),paint:SN||(SN=new Wr({"line-opacity":new un(tt.paint_line["line-opacity"]),"line-color":new un(tt.paint_line["line-color"]),"line-translate":new Rt(tt.paint_line["line-translate"]),"line-translate-anchor":new Rt(tt.paint_line["line-translate-anchor"]),"line-width":new un(tt.paint_line["line-width"]),"line-gap-width":new un(tt.paint_line["line-gap-width"]),"line-offset":new un(tt.paint_line["line-offset"]),"line-blur":new un(tt.paint_line["line-blur"]),"line-dasharray":new un(tt.paint_line["line-dasharray"]),"line-pattern":new un(tt.paint_line["line-pattern"]),"line-gradient":new wo(tt.paint_line["line-gradient"]),"line-trim-offset":new Rt(tt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Rt(tt.paint_line["line-trim-fade-range"]),"line-trim-color":new Rt(tt.paint_line["line-trim-color"]),"line-emissive-strength":new Rt(tt.paint_line["line-emissive-strength"]),"line-border-width":new un(tt.paint_line["line-border-width"]),"line-border-color":new un(tt.paint_line["line-border-color"]),"line-occlusion-opacity":new Rt(tt.paint_line["line-occlusion-opacity"])}))},f3);class YY extends un{possiblyEvaluate(n,o){return o=new Mn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(n,o)}evaluate(n,o,u,h){return o=ks({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(n,o,u,h)}}let Rv,PF,RF,m3;function MF(i,n){return n>0?n+2*i:i}class kF{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:ca,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qe(kF,"FormatSectionOverride",{omit:["defaultValue"]});const g3=()=>m3||(m3={layout:PF||(PF=new Wr({"symbol-placement":new Rt(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new Rt(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rt(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new un(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Rt(tt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Rt(tt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Rt(tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Rt(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rt(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rt(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new un(tt.layout_symbol["icon-size"]),"icon-text-fit":new un(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new un(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new un(tt.layout_symbol["icon-image"]),"icon-rotate":new un(tt.layout_symbol["icon-rotate"]),"icon-padding":new Rt(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new Rt(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new un(tt.layout_symbol["icon-offset"]),"icon-anchor":new un(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rt(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rt(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rt(tt.layout_symbol["text-rotation-alignment"]),"text-field":new un(tt.layout_symbol["text-field"]),"text-font":new un(tt.layout_symbol["text-font"]),"text-size":new un(tt.layout_symbol["text-size"]),"text-max-width":new un(tt.layout_symbol["text-max-width"]),"text-line-height":new un(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new un(tt.layout_symbol["text-letter-spacing"]),"text-justify":new un(tt.layout_symbol["text-justify"]),"text-radial-offset":new un(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Rt(tt.layout_symbol["text-variable-anchor"]),"text-anchor":new un(tt.layout_symbol["text-anchor"]),"text-max-angle":new Rt(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new Rt(tt.layout_symbol["text-writing-mode"]),"text-rotate":new un(tt.layout_symbol["text-rotate"]),"text-padding":new Rt(tt.layout_symbol["text-padding"]),"text-keep-upright":new Rt(tt.layout_symbol["text-keep-upright"]),"text-transform":new un(tt.layout_symbol["text-transform"]),"text-offset":new un(tt.layout_symbol["text-offset"]),"text-allow-overlap":new Rt(tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Rt(tt.layout_symbol["text-ignore-placement"]),"text-optional":new Rt(tt.layout_symbol["text-optional"]),visibility:new Rt(tt.layout_symbol.visibility)})),paint:RF||(RF=new Wr({"icon-opacity":new un(tt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new un(tt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new un(tt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new un(tt.paint_symbol["text-emissive-strength"]),"icon-color":new un(tt.paint_symbol["icon-color"]),"icon-halo-color":new un(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new un(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new un(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new Rt(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rt(tt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new un(tt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new un(tt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new un(tt.paint_symbol["text-occlusion-opacity"]),"text-color":new un(tt.paint_symbol["text-color"],{runtimeType:Ma,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new un(tt.paint_symbol["text-halo-color"]),"text-halo-width":new un(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new un(tt.paint_symbol["text-halo-blur"]),"text-translate":new Rt(tt.paint_symbol["text-translate"]),"text-translate-anchor":new Rt(tt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Rt(tt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Rt(tt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Rt(tt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Rt(tt.paint_symbol["icon-color-brightness-max"])}))},m3);class dT extends _a{constructor(n,o,u,h){super(n,g3(),o,u,h),this._colorAdjustmentMatrix=a.ae.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,o){super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const p of u)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,o,u,h){return this._saturation===n&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(p,m,v,w){p=mt(p),m=De(m);const E=a.ae.create(),C=p/3,P=1-2*C,M=[P,C,C,0,C,P,C,0,C,C,P,0,0,0,0,1],z=.5-.5*m,j=w-v;return a.ae.multiply(E,[j,0,0,0,0,j,0,0,0,0,j,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,z,z,z,1]),a.ae.multiply(E,E,M),E}(n,o,u,h),this._saturation=n,this._contrast=o,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,o,u,h){const p=this.layout.get(n).evaluate(o,{},u,h),m=this._unevaluatedLayout._values[n];return m.isDataDriven()||be(m.value)||!p?p:function(v,w){return w.replace(/{([^{}]+)}/g,(E,C)=>C in v?String(v[C]):"")}(o.properties,p)}createBucket(n){return new m_(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of g3().paint.overridableProperties){if(!dT.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),u=new kF(o),h=new xe(u,o.property.specification,this.scope,this.options);let p=null;p=o.value.kind==="constant"||o.value.kind==="source"?new ke("source",h):new Ce("composite",h,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new qs(o.property,p,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&dT.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const u=n.get("text-field"),h=g3().paint.properties[o];let p=!1;const m=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(p=!0)};if(u.value.kind==="constant"&&u.value.value instanceof bo)m(u.value.value.sections);else if(u.value.kind==="source"){const v=E=>{p||(E instanceof nl&&ps(E.value)===Cd?m(E.value.sections):E instanceof dh?m(E.sections):E.eachChild(v))},w=u.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramIds(){const n=this.paint.get("icon-opacity").constantOr(1)!==0,o=this.paint.get("text-opacity").constantOr(1)!==0,u=[];return n&&u.push("symbolIcon"),o&&u.push("symbolSDF"),u}getDefaultProgramParams(n,o,u){return{config:new jp(this,{zoom:o,lut:u}),overrideFog:!1}}}let DF,OF,LF,zF;function fT(i,n,o,u,h,p,m,v){const w=[i,n,1,o,u,1,h,p,1],E=[m,v,1],C=a.bE.adjoint([],w),[P,M,z]=a.$.transformMat3(E,E,C);return a.bE.multiply(w,w,[P,0,0,0,M,0,0,0,z])}function NF(i,n,o,u,h,p,m,v){const w=function(E,C,P,M,z,j,V,$){const Y=fT(0,0,1,0,1,1,0,1),me=fT(E,C,P,M,z,j,V,$),pe=a.bE.adjoint([],Y);return a.bE.multiply(me,me,pe)}(i,n,o,u,h,p,m,v);return[w[2]/w[8]/zt,w[5]/w[8]/zt]}function pT(i){return[i[0],Math.min(Math.max(i[1],-Zi),Zi)]}class FF extends uh{constructor(n,o,u,h){super(),this.id=n,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=o,this._dirty=!1}load(n,o){if(this._loaded=o||!1,this.fire(new Rl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=dp(this.map._requestManager.transformRequest(this.url,up.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new gp(u)):h&&(this.image=h instanceof HTMLImageElement?rn.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new lT(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Rl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof lT||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=n[0][1],u=n[0][1];for(const p of n)p[1]>u&&(u=p[1]),p[1]<o&&(o=p[1]);const h=(u+o)/2;if(h>Zi?this.onNorthPole=!0:h<-Zi&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=n.map(To.fromLngLat);this.tileID=function(m){let v=1/0,w=1/0,E=-1/0,C=-1/0;for(const V of m)v=Math.min(v,V.x),w=Math.min(w,V.y),E=Math.max(E,V.x),C=Math.max(C,V.y);const P=Math.max(E-v,C-w),M=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),z=Math.pow(2,M);let j=Math.floor((v+E)/2*z);return j>1&&(j-=1),new Vp(M,j,Math.floor((w+C)/2*z))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Rl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const $ in this.tiles){const Y=this.tiles[$];Y.state!=="loaded"&&(Y.state="loaded",Y.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=Wp(new Vp(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const Y=$[1].x-$[0].x,me=$[1].y-$[0].y,pe=$[2].x-$[1].x,ge=$[2].y-$[1].y,Pe=$[3].x-$[2].x,Re=$[3].y-$[2].y,ze=$[0].x-$[3].x,Ge=$[0].y-$[3].y,Ke=Y*ge-pe*me,it=pe*Re-Pe*ge,Je=Pe*Ge-ze*Re,ut=ze*me-Y*Ge;return Ke>0&&it>0&&Je>0&&ut>0||Ke<0&&it<0&&Je<0&&ut<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=Wp(this.tileID,this.map.transform.projection),[p,m,v,w]=this.coordinates.map($=>{const Y=h.projection.project($[0],$[1]);return cF(h,Y)._round()});this.perspectiveTransform=NF(p.x,p.y,m.x,m.y,v.x,v.y,w.x,w.y);const E=this._boundsArray=new yh;E.emplaceBack(p.x,p.y,0,0),E.emplaceBack(m.x,m.y,zt,0),E.emplaceBack(w.x,w.y,0,zt),E.emplaceBack(v.x,v.y,zt,zt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(E,uT.members),this.boundsSegments=Ei.simpleSegment(0,0,4,2);const C=[],P=function($){return[pT($[0]),pT($[1]),pT($[2]),pT($[3])]}(this.coordinates),[M,z,j,V]=function($){let Y=$[0][0],me=Y,pe=$[0][1],ge=pe;for(let Pe=1;Pe<$.length;Pe++)$[Pe][0]<Y?Y=$[Pe][0]:$[Pe][0]>me&&(me=$[Pe][0]),$[Pe][1]<pe?pe=$[Pe][1]:$[Pe][1]>ge&&(ge=$[Pe][1]);return[Y,pe,me-Y,ge-pe]}(P);{const $=new yh,[Y,me,pe,ge]=function(lt){let xt=lt[0].x,Ot=xt,ft=lt[0].y,jt=ft;for(let Dt=1;Dt<lt.length;Dt++)lt[Dt].x<xt?xt=lt[Dt].x:lt[Dt].x>Ot&&(Ot=lt[Dt].x),lt[Dt].y<ft?ft=lt[Dt].y:lt[Dt].y>jt&&(jt=lt[Dt].y);return[xt,ft,Ot-xt,jt-ft]}(u),Pe=lt=>[(lt.x-Y)/pe,(lt.y-me)/ge],[Re,ze,Ge,Ke]=u.map(Pe),it=function(lt,xt,Ot,ft,jt,Dt,Pt,vn){const mn=fT(0,0,1,0,1,1,0,1),tn=fT(lt,xt,Ot,ft,jt,Dt,Pt,vn),Nt=a.bE.adjoint([],tn);return a.bE.multiply(mn,mn,Nt)}(Re[0],Re[1],ze[0],ze[1],Ge[0],Ge[1],Ke[0],Ke[1]);this.elevatedGlobePerspectiveTransform=NF(Re[0],Re[1],ze[0],ze[1],Ge[0],Ge[1],Ke[0],Ke[1]);const Je=(lt,xt)=>{C.push(lt.lng);const Ot=Math.round((lt.lng-M)/j*zt),ft=Math.round((lt.lat-z)/V*zt),jt=Pe(xt),Dt=a.$.transformMat3([],[jt[0],jt[1],1],it),Pt=Math.round(Dt[0]/Dt[2]*zt),vn=Math.round(Dt[1]/Dt[2]*zt);$.emplaceBack(Ot,ft,Pt,vn)},ut=u[3].x-u[0].x,Ct=u[3].y-u[0].y,ht=u[2].x-u[1].x,Mt=u[2].y-u[1].y;for(let lt=0;lt<65;lt++){const xt=lt/64,Ot=[u[0].x+xt*ut,u[0].y+xt*Ct],ft=[u[1].x+xt*ht,u[1].y+xt*Mt],jt=ft[0]-Ot[0],Dt=ft[1]-Ot[1];for(let Pt=0;Pt<65;Pt++){const vn=Pt/64,mn={x:Ot[0]+jt*vn,y:Ot[1]+Dt*vn,z:0};Je(o.projection.unproject(mn.x,mn.y),mn)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer($,uT.members)}{this.maxLongitudeTriangleSize=0;let $=[],Y=new Gs;const me=(pe,ge,Pe)=>{Y.emplaceBack(pe,ge,Pe);const Re=C[pe],ze=C[ge],Ge=C[Pe],Ke=Math.min(Math.min(Re,ze),Ge),it=Math.max(Math.max(Re,ze),Ge)-Ke;it>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=it),$.push(Ke+it/2)};for(let pe=0;pe<64;pe++)for(let ge=0;ge<64;ge++){const Pe=65*pe+ge,Re=Pe+1,ze=Pe+65,Ge=ze+1;me(Pe,ze,Re),me(Re,ze,Ge)}[$,Y]=function(pe,ge){const Pe=Array.from({length:pe.length},(Ge,Ke)=>Ke);Pe.sort((Ge,Ke)=>pe[Ge]-pe[Ke]);const Re=[],ze=new Gs;for(let Ge=0;Ge<Pe.length;Ge++){const Ke=Pe[Ge];Re.push(pe[Ke]);const it=3*Ke,Je=it+1;ze.emplaceBack(ge.uint16[it],ge.uint16[Je],ge.uint16[Je+1])}return[Re,ze]}($,Y),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(Y)}this.elevatedGlobeSegments=Ei.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,j/zt,0,V/zt,0,0,z,M,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof lT||(this.texture?this.texture.update(this.image):(this.texture=new Ll(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(o)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=n+180)+360*Math.round((u[0]-p)/360);var p;const m=new Ei,v=(P,M)=>{m.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:o.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=w){const P=ue(u,0,u.length,h+w);return P===u.length||v(P,K(u,P+1,u.length,h+360-w)-P),m}h<u[0]&&(h+=360);const E=K(u,0,u.length,h-w);if(E===u.length)return v(0,u.length),m;v(0,E-0);const C=ue(u,E+1,u.length,h+w);return C!==u.length&&v(C,u.length-C),m}}const JY=(Math.pow(256,2)-1)/16907520;class BF extends _a{constructor(n,o,u,h){super(n,{layout:LF||(LF=new Wr({visibility:new Rt(tt.layout_raster.visibility)})),paint:zF||(zF=new Wr({"raster-opacity":new Rt(tt.paint_raster["raster-opacity"]),"raster-color":new wo(tt.paint_raster["raster-color"]),"raster-color-mix":new Rt(tt.paint_raster["raster-color-mix"]),"raster-color-range":new Rt(tt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Rt(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rt(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rt(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new Rt(tt.paint_raster["raster-saturation"]),"raster-contrast":new Rt(tt.paint_raster["raster-contrast"]),"raster-resampling":new Rt(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new Rt(tt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Rt(tt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Rt(tt.paint_raster["raster-array-band"]),"raster-elevation":new Rt(tt.paint_raster["raster-elevation"])}))},o,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof FF&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=ov({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let jF,UF,VF,$F,qF;class GF extends _a{constructor(n,o,u,h){super(n,{layout:jF||(jF=new Wr({visibility:new Rt(tt["layout_raster-particle"].visibility)})),paint:UF||(UF=new Wr({"raster-particle-array-band":new Rt(tt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Rt(tt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new wo(tt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Rt(tt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Rt(tt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Rt(tt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Rt(tt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Rt(tt["paint_raster-particle"]["raster-particle-elevation"])}))},o,u,h),this._updateColorRamp(),this.lastInvalidatedAt=rn.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ov({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=rn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class eJ extends _a{constructor(n,o){super(n,{},o,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function _3(i,n,o){const u=[0,0,1],h=a.aw.identity([]);return a.aw.rotateY(h,h,o?-sr(i)+Math.PI:sr(i)),a.aw.rotateX(h,h,-sr(n)),a.$.transformQuat(u,u,h),a.$.normalize(u,u)}function WF(i,n){const o=mT(i.projection,i.zoom,i.width,i.height),u=function(p,m,v,w,E){const C=new Er(v.lng-180*Yd,v.lat),P=new Er(v.lng+180*Yd,v.lat),M=p.project(C.lng,C.lat),z=p.project(P.lng,P.lat),j=-Math.atan2(z.y-M.y,z.x-M.x),V=To.fromLngLat(v);V.y=Yn(V.y,-1+Yd,1-Yd);const $=V.toLngLat(),Y=p.project($.lng,$.lat),me=To.fromLngLat($);me.x+=Yd;const pe=me.toLngLat(),ge=p.project(pe.lng,pe.lat),Pe=XF(ge.x-Y.x,ge.y-Y.y,j),Re=To.fromLngLat($);Re.y+=Yd;const ze=Re.toLngLat(),Ge=p.project(ze.lng,ze.lat),Ke=XF(Ge.x-Y.x,Ge.y-Y.y,j),it=Math.abs(Pe.x)/Math.abs(Ke.y),Je=a.ae.identity([]);a.ae.rotateZ(Je,Je,-j*(1-(E?0:w)));const ut=a.ae.identity([]);return a.ae.scale(ut,ut,[1,1-(1-it)*w,1]),ut[4]=-Ke.x/Ke.y*w,a.ae.rotateZ(ut,ut,j),a.ae.multiply(ut,Je,ut),ut}(i.projection,0,i.center,o,n),h=HF(i);return a.ae.scale(u,u,[h,h,1]),u}function HF(i){const n=i.projection,o=mT(i.projection,i.zoom,i.width,i.height),u=ZF(n,i.center),h=ZF(n,Er.convert(n.center));return Math.pow(2,u*o+(1-o)*h)}function mT(i,n,o,u,h=1/0){const p=i.range;if(!p)return 0;const m=Math.min(h,Math.max(o,u)),v=Math.log(m/1024)/Math.LN2;return aa(p[0]+v,p[1]+v,n)}const Yd=1/4e4;function ZF(i,n){const o=Yn(n.lat,-Zi,Zi),u=new Er(n.lng-180*Yd,o),h=new Er(n.lng+180*Yd,o),p=i.project(u.lng,o),m=i.project(h.lng,o),v=To.fromLngLat(u),w=To.fromLngLat(h),E=m.x-p.x,C=m.y-p.y,P=w.x-v.x,M=w.y-v.y,z=Math.sqrt((P*P+M*M)/(E*E+C*C));return Math.log(z)/Math.LN2}function XF(i,n,o){const u=Math.cos(o),h=Math.sin(o);return{x:i*u-n*h,y:i*h+n*u}}function KF(i,n,o){a.ae.identity(i),a.ae.rotateZ(i,i,sr(n[2])),a.ae.rotateX(i,i,sr(n[0])),a.ae.rotateY(i,i,sr(n[1])),a.ae.scale(i,i,o),a.ae.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function gT(i,n,o,u,h,p,m,v){const w=[o[0]-n[0],o[1]-n[1],0],E=[u[0]-n[0],u[1]-n[1],0];if(a.$.length(w)<1e-12||a.$.length(E)<1e-12)return a.aw.identity(i);const C=a.$.cross([],w,E);a.$.normalize(C,C),a.$.subtract(E,u,n),w[2]=(p-h)*v,E[2]=(m-h)*v;const P=w;return a.$.cross(P,w,E),a.$.normalize(P,P),a.aw.rotationTo(i,C,P)}function y3(i,n,o=!1){const u=Eh(n.zoom),h=function(p,m,v){const w=m.worldSize,E=[p[12],p[13],p[14]],C=eo(E[1]/w),P=ya(E[0]/w),M=a.ae.identity([]),z=Ho(1,C)*w,j=Ho(1,0)*w*$p(C,m.zoom),V=1/zP(w);let $=j*V;if(v){const ge=mT(m.projection,m.zoom,m.width,m.height,1024);$=V*m.projection.pixelSpaceConversion(m.center.lat,w,ge)}const Y=Up(C,P);a.$.add(Y,Y,a.$.scale([],a.$.normalize([],Y),z*$*E[2]));const me=function(ge){const Pe=[ge[0],ge[1],ge[2]];let Re=[0,1,0];const ze=a.$.cross([],Re,Pe);return a.$.cross(Re,Pe,ze),a.$.squaredLength(Re)===0&&(Re=[0,1,0],a.$.cross(ze,Pe,Re)),a.$.normalize(ze,ze),a.$.normalize(Re,Re),a.$.normalize(Pe,Pe),[ze[0],ze[1],ze[2],0,Re[0],Re[1],Re[2],0,Pe[0],Pe[1],Pe[2],0,ge[0],ge[1],ge[2],1]}(Y);a.ae.scale(M,M,[$,$,$*z]),a.ae.translate(M,M,[-E[0],-E[1],-E[2]]);const pe=a.ae.multiply([],m.globeMatrix,me);return a.ae.multiply(pe,pe,M),a.ae.multiply(pe,pe,p),pe}(i,n,o);if(u>0){const p=function(m,v){const w=v.worldSize,E=Ho(1,0)*w*$p(v.center.lat,v.zoom)/zP(w),C=Ho(1,v.center.lat)*w,P=a.ae.identity([]);return a.ae.rotateY(P,P,sr(v.center.lng)),a.ae.rotateX(P,P,sr(v.center.lat)),a.ae.translate(P,P,[0,0,Wo]),a.ae.scale(P,P,[E,E,E*C]),a.ae.translate(P,P,[v.point.x-.5*w,v.point.y-.5*w,0]),a.ae.multiply(P,P,m),a.ae.multiply(P,v.globeMatrix,P)}(i,n);return function(m,v,w){const E=(j,V,$)=>{const Y=a.$.length(j),me=a.$.length(V),pe=Th(j,V,$);return a.$.scale(pe,pe,1/a.$.length(pe)*Tn(Y,me,$))},C=E([m[0],m[1],m[2]],[v[0],v[1],v[2]],w),P=E([m[4],m[5],m[6]],[v[4],v[5],v[6]],w),M=E([m[8],m[9],m[10]],[v[8],v[9],v[10]],w),z=Th([m[12],m[13],m[14]],[v[12],v[13],v[14]],w);return[C[0],C[1],C[2],0,P[0],P[1],P[2],0,M[0],M[1],M[2],0,z[0],z[1],z[2],1]}(h,p,u)}return h}function QF(i,n,o,u){const h=gi.projectAabbCorners(u,o);let p=Number.MAX_VALUE,m=-1;for(let E=0;E<h.length;++E){const C=h[E];C[0]=(.5*C[0]+.5)*n.width,C[1]=(.5-.5*C[1])*n.height,C[2]<p&&(m=E,p=C[2])}const v=E=>new Ft(h[E][0],h[E][1]);let w;switch(m){case 0:case 6:w=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:w=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:w=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:w=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(IP(i,w))return p}const tJ=kr([{name:"a_pos_3f",components:3,type:"Float32"}]),nJ=kr([{name:"a_color_3f",components:3,type:"Float32"}]),rJ=kr([{name:"a_color_4f",components:4,type:"Float32"}]),iJ=kr([{name:"a_uv_2f",components:2,type:"Float32"}]),sJ=kr([{name:"a_normal_3f",components:3,type:"Float32"}]),oJ=kr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),aJ=kr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class _T{constructor(n,o,u,h){this.message=(n?`${n}: `:"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)}}function YF(i,n){const o=i.indexOf("://")===-1;try{return new URL(i,o&&n?"http://example.com":void 0),!0}catch(u){return!1}}class JF{constructor(n,o){this.feature=n,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class eB{constructor(){this.instancedDataArray=new cP,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class v3{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,o){}populate(n,o,u,h){this.tileToMeter=Iw(u);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of n){const C=v!=null?v:m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0,P=wh(m,p);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom),P,u))continue;const M={id:C,sourceLayerIndex:E,index:w,geometry:p?P.geometry:Sc(m,u,h),properties:m.properties,type:m.type,patterns:{}},z=this.addFeature(M,M.geometry,P);z&&o.featureIndex.insert(m,M.geometry,w,E,this.index,this.instancesPerModel[z].instancedDataArray.length,zt/32)}this.lookup=null}update(n,o,u,h){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const v in n)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],n[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const h of u.features){const p=this.layers[0],m=h.feature,v=this.canonical,w=p.paint.get("model-rotation").evaluate(m,{},v),E=p.paint.get("model-scale").evaluate(m,{},v),C=p.paint.get("model-translation").evaluate(m,{},v);a.$.exactEquals(h.rotation,w)&&a.$.exactEquals(h.scale,E)&&a.$.exactEquals(h.translation,C)||(this.evaluate(h,h.featureStates,u,!0),n=!0)}}return n}updateReplacement(n,o,u,h){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const p=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(WP(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const v in this.instancesPerModel){const w=this.instancesPerModel[v],E=w.instancedDataArray;for(const C of w.features){const P=C.instancedDataOffset,M=C.instancedDataCount;for(let z=0;z<M;z++){const j=16*(z+P);let V=E.float32[j+0];V=V>zt?V-zt:V;const $=Math.floor(V),Y=E.float32[j+1];let me=!1;for(const pe of this.activeReplacements)if(!Vz(pe,u,nN.Model,h)&&!(pe.min.x>$||$>pe.max.x||pe.min.y>Y||Y>pe.max.y)&&(me=Zz(Hz($,Y,n.canonical,pe.footprintTileId.canonical),pe),me))break;E.float32[j]=me?V+zt:V,m=m||me}}}return m}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=n.createVertexBuffer(u.instancedDataArray,oJ.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const o of this.modelUris)n.removeModel(o,"")}addFeature(n,o,u){const h=this.layers[0],p=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!p)return Pi(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;YF(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new eB);const m=this.instancesPerModel[p],v=m.instancedDataArray,w=new JF(u,v.length);for(const E of o)for(const C of E){if(C.x<0||C.x>=zt||C.y<0||C.y>=zt)continue;const P=(this.lookupDim-1)/zt,M=this.lookupDim*(C.y*P|0)+C.x*P|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const z=v.length;v.resize(z+1),m.instancesEvaluatedElevation.push(0),v.float32[16*z]=C.x,v.float32[16*z+1]=C.y}return w.instancedDataCount=m.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(n.id&&(m.idToFeaturesIndex[n.id]=m.features.length),m.features.push(w),this.evaluate(w,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(n,o,u,h){const p=this.layers[0],m=n.feature,v=this.canonical,w=n.rotation=p.paint.get("model-rotation").evaluate(m,o,v),E=n.scale=p.paint.get("model-scale").evaluate(m,o,v),C=n.translation=p.paint.get("model-translation").evaluate(m,o,v),P=p.paint.get("model-color").evaluate(m,o,v);P.a=p.paint.get("model-color-mix-intensity").evaluate(m,o,v);const M=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),KF(M,w,E);const z=Math.round(100*P.a)+P.b/1.05;for(let j=0;j<n.instancedDataCount;++j){const V=n.instancedDataOffset+j,$=16*V,Y=u.instancedDataArray.float32;let me=0;h&&(me=Y[$+6]-u.instancesEvaluatedElevation[V]);const pe=0|Y[$+1];Y[$]=(0|Y[$])+P.r/1.05,Y[$+1]=pe+P.g/1.05,Y[$+2]=z,Y[$+3]=1/(v.z>10?this.tileToMeter:Iw(v,pe)),Y[$+4]=C[0],Y[$+5]=C[1],Y[$+6]=C[2]+me,Y[$+7]=M[0],Y[$+8]=M[1],Y[$+9]=M[2],Y[$+10]=M[4],Y[$+11]=M[5],Y[$+12]=M[6],Y[$+13]=M[8],Y[$+14]=M[9],Y[$+15]=M[10],u.instancesEvaluatedElevation[V]=C[2]}}}let tB,nB;qe(v3,"ModelBucket",{omit:["layers"]}),qe(eB,"PerModelAttributes"),qe(JF,"ModelFeature");const Xp=64,y_={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function rB(i,n,o,u,h,p,m,v,w,E=!1){const C=o.zoom,P=o.project(u),M=$p(u.lat,C),z=1/M;a.ae.identity(i),a.ae.translate(i,i,[P.x+m[0]*z,P.y+m[1]*z,m[2]]);let j=1,V=1;const $=o.worldSize;if(E){if(o.projection.name==="mercator"){let ge=0;o.elevation&&(ge=o.elevation.getAtPointOrZero(new To(P.x/$,P.y/$),0));const Pe=a.aB.transformMat4([],[P.x,P.y,ge,1],o.projMatrix)[3]/o.cameraToCenterDistance;j=Pe,V=Pe*$p(o.center.lat,C)}else if(o.projection.name==="globe"){const ge=y3(i,o),Pe=a.ae.multiply([],o.projMatrix,ge),Re=[0,0,0,1];a.aB.transformMat4(Re,Re,Pe);const ze=Re[3]/o.cameraToCenterDistance,Ge=Eh(C),Ke=o.projection.pixelsPerMeter(u.lat,$)*$p(u.lat,C),it=o.projection.pixelsPerMeter(o.center.lat,$)*$p(o.center.lat,C);j=ze/Tn(Ke,GL(o.center.lat),Ge),V=ze*M/Ke,j*=it,V*=it}}else j=z;a.ae.scale(i,i,[j,j,V]);const Y=[...i],me=n.orientation,pe=[];if(KF(pe,[me[0]+h[0],me[1]+h[1],me[2]+h[2]],p),a.ae.multiply(i,Y,pe),v&&o.elevation){let ge=0;const Pe=[];if(w&&o.elevation){ge=function(Ge,Ke,it,Je,ut){const Ct=Ke.elevation;if(!Ct)return 0;const ht=gi.projectAabbCorners(it,Je),Mt=Ho(1,ut.lat)*Ke.worldSize,lt=function(Rn,gn){const cn=[0,0,1],Bn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Un of Bn){const jn=Rn[Un.corners[0]],Kn=Rn[Un.corners[1]],yr=Rn[Un.corners[2]],lr=[Kn[0]-jn[0],Kn[1]-jn[1],gn*(Kn[2]-jn[2])],$r=a.$.cross(lr,lr,[yr[0]-jn[0],yr[1]-jn[1],gn*(yr[2]-jn[2])]);a.$.normalize($r,$r),Un.dotProductWithUp=a.$.dot($r,cn)}return Bn.sort((Un,jn)=>Un.dotProductWithUp-jn.dotProductWithUp),Bn[0].corners}(ht,Mt),xt=ht[lt[0]],Ot=ht[lt[1]],ft=ht[lt[2]],jt=ht[lt[3]],Dt=Ct.getAtPointOrZero(new To(xt[0]/Ke.worldSize,xt[1]/Ke.worldSize),0),Pt=Ct.getAtPointOrZero(new To(Ot[0]/Ke.worldSize,Ot[1]/Ke.worldSize),0),vn=Ct.getAtPointOrZero(new To(ft[0]/Ke.worldSize,ft[1]/Ke.worldSize),0),mn=Ct.getAtPointOrZero(new To(jt[0]/Ke.worldSize,jt[1]/Ke.worldSize),0),tn=(Dt+mn)/2,Nt=(Pt+vn)/2;return tn>Nt?Pt<vn?gT(Ge,Ot,jt,xt,Pt,mn,Dt,Mt):gT(Ge,ft,xt,jt,vn,Dt,mn,Mt):Dt<mn?gT(Ge,xt,Ot,ft,Dt,Pt,vn,Mt):gT(Ge,jt,ft,Ot,mn,vn,Pt,Mt),Math.max(tn,Nt)}(Pe,o,n.aabb,i,u);const Re=a.ae.fromQuat([],Pe),ze=a.ae.multiply([],Re,pe);a.ae.multiply(i,Y,ze)}else ge=o.elevation.getAtPointOrZero(new To(P.x/$,P.y/$),0);ge!==0&&(i[14]+=ge)}}function Mv(i,n,o=!1){i.uploaded||(i.gfxTexture=new Ll(n,i.image,o?n.gl.R8:n.gl.RGBA,{useMipmap:i.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function lJ(i,n,o){i.indexBuffer=n.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=n.createVertexBuffer(i.vertexArray,tJ.members,!1,!0),i.normalArray&&(i.normalBuffer=n.createVertexBuffer(i.normalArray,sJ.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=n.createVertexBuffer(i.texcoordArray,iJ.members,!1,!0)),i.colorArray&&(i.colorBuffer=n.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?nJ:rJ).members,!1,!0)),i.featureArray&&(i.pbrBuffer=n.createVertexBuffer(i.featureArray,aJ.members,!0)),i.segments=Ei.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);const u=i.material;u.pbrMetallicRoughness.baseColorTexture&&Mv(u.pbrMetallicRoughness.baseColorTexture,n),u.pbrMetallicRoughness.metallicRoughnessTexture&&Mv(u.pbrMetallicRoughness.metallicRoughnessTexture,n),u.normalTexture&&Mv(u.normalTexture,n),u.occlusionTexture&&Mv(u.occlusionTexture,n,o),u.emissionTexture&&Mv(u.emissionTexture,n)}function x3(i,n,o){if(i.meshes)for(const u of i.meshes)lJ(u,n,o);if(i.children)for(const u of i.children)x3(u,n,o)}function yT(i){if(i.meshes)for(const n of i.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(i.children)for(const n of i.children)yT(n)}function b3(i){if(i.meshes)for(const o of i.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((n=o.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(i.children)for(const o of i.children)b3(o)}class cJ{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class uJ{constructor(){this.tasks={},this.taskQueue=[],sh(["process"],this),this.invoker=new cJ(this.process),this.nextId=0}add(n,o){const u=this.nextId++,h=function({type:p,isSymbolTile:m,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-v:p==="maybePrepare"&&m?400-v:500:200-v:100-v}(o);if(h===0){try{n()}finally{}return null}return this.tasks[u]={fn:n,metadata:o,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let n=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<o&&(o=p.priority,n=h)}if(n===null)return null;const u=this.taskQueue[n];return this.taskQueue.splice(n,1),u}remove(){this.invoker.remove()}}class iB{constructor(n,o,u){this.target=n,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},sh(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new uJ}send(n,o,u,h,p=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=m,this.callbacks[v]=u);const w=new Set;return this.target.postMessage({id:v,type:n,hasCallback:!!u,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:Xe(o,w)},w),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(n){const o=n.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(o.mustQueue||$o()){const h=this.callbacks[u],p=this.scheduler.add(()=>this.processTask(u,o),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[u]=p)}else this.processTask(u,o)}processTask(n,o){if(delete this.cancelCallbacks[n],o.type==="<response>"){const u=this.callbacks[n];delete this.callbacks[n],u&&(o.error?u(ot(o.error)):u(null,ot(o.data)))}else{const u=new Set,h=o.hasCallback?(m,v)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:m?Xe(m):null,data:Xe(v,u)},u)}:m=>{},p=ot(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,h);else if(this.parent.getWorkerSource){const m=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,m[0],p.source,p.scope)[m[1]](p,h)}else h(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class v_{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=hc();const u=this.workerPool.acquire(this.id);for(let h=0;h<u.length;h++){const p=new v_.Actor(u[h],o,this.id);p.name=`Worker ${h}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,u){ih(this.actors,(h,p)=>{h.send(n,o,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}v_.Actor=iB;var kv={workerUrl:"",workerClass:null,workerParams:void 0};function hJ(){return kv.workerClass!=null?new kv.workerClass:new self.Worker(kv.workerUrl,kv.workerParams)}const w3="mapboxgl_preloaded_worker_pool";class Dv{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Dv.workerCount;)this.workers.push(new hJ);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[w3]}numActive(){return Object.keys(this.active).length}}let Ov;function vT(){return Ov||(Ov=new Dv),Ov}Dv.workerCount=2;let xT,T3,Mc,x_,E3,b_=null;function sB(){return $o()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:T3||O.DRACO_URL}function oB(){if($o()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(x_)return x_;const i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return x_=WebAssembly.validate(i)?O.MESHOPT_SIMD_URL:O.MESHOPT_URL,x_}const bT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},dJ={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Lv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function aB(i,n,o){const u=o.json.bufferViews.length,h=o.buffers.length;n.bufferView=u,o.json.bufferViews[u]={buffer:h,byteLength:i.byteLength},o.buffers[h]=i}const S3="KHR_draco_mesh_compression";function fJ(i,n){const o=i.extensions&&i.extensions[S3];if(!o)return;const u=new Mc.Decoder,h=hB(n,o.bufferView),p=new Mc.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=n.json.accessors[i.indices],v=bT[m.componentType],w=m.count*v.BYTES_PER_ELEMENT,E=Mc._malloc(w);v===Uint16Array?u.GetTrianglesUInt16Array(p,w,E):u.GetTrianglesUInt32Array(p,w,E),aB(Mc.memory.buffer.slice(E,E+w),m,n),Mc._free(E);for(const C of Object.keys(o.attributes)){const P=u.GetAttributeByUniqueId(p,o.attributes[C]),M=n.json.accessors[i.attributes[C]],z=dJ[M.componentType],j=M.count*Lv[M.type]*bT[M.componentType].BYTES_PER_ELEMENT,V=Mc._malloc(j);u.GetAttributeDataArrayForAllPoints(p,P,Mc[z],j,V),aB(Mc.memory.buffer.slice(V,V+j),M,n),Mc._free(V)}u.destroy(),p.destroy(),delete i.extensions[S3]}const wT="EXT_meshopt_compression";function pJ(i,n){if(!i.extensions||!i.extensions[wT])return;const o=i.extensions[wT],u=new Uint8Array(n.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),h=new Uint8Array(o.count*o.byteStride);E3.decodeGltfBuffer(h,o.count,o.byteStride,u,o.mode,o.filter),i.buffer=n.buffers.length,i.byteOffset=0,n.buffers[i.buffer]=h.buffer,delete i.extensions[wT]}const lB=1179937895,cB=new TextDecoder("utf8");function uB(i,n){return new URL(i,n).href}function mJ(i,n,o,u){return fetch(uB(i.uri,u)).then(h=>h.arrayBuffer()).then(h=>{n.buffers[o]=h})}function hB(i,n){const o=i.json.bufferViews[n];return new Uint8Array(i.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function gJ(i,n,o,u){if(i.uri){const h=uB(i.uri,u);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{n.images[o]=p})}if(i.bufferView!==void 0){const h=hB(n,i.bufferView),p=new Blob([h],{type:i.mimeType});return createImageBitmap(p).then(m=>{n.images[o]=m})}}function dB(i,n=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(i,n,1)[0]===lB){const C=new Uint32Array(i,n);let P=2;const M=(C[P++]>>2)-3,z=C[P++]>>2;if(P++,u.json=JSON.parse(cB.decode(C.subarray(P,P+z))),P+=z,P<M){const j=C[P++];P++;const V=n+(P<<2);u.buffers[0]=i.slice(V,V+j)}}else u.json=JSON.parse(cB.decode(new Uint8Array(i,n)));const{buffers:h,images:p,meshes:m,extensionsUsed:v,bufferViews:w}=u.json;let E=Promise.resolve();if(h){const C=[];for(let P=0;P<h.length;P++){const M=h[P];M.uri?C.push(mJ(M,u,P,o)):u.buffers[P]||(u.buffers[P]=null)}E=Promise.all(C)}return E.then(()=>{const C=[],P=v&&v.includes(S3),M=v&&v.includes(wT);if(P&&C.push(function(){if(!Mc)return xT||(xT=function(z){let j,V=null;function $(){j=new Uint8Array(V.buffer)}function Y(){throw new Error("Unexpected Draco error.")}const me={a:{a:Y,d:function(pe,ge,Pe){return j.copyWithin(pe,ge,ge+Pe)},c:function(pe){const ge=j.length,Pe=Math.max(pe>>>0,Math.ceil(1.2*ge)),Re=Math.ceil((Pe-ge)/65536);try{return V.grow(Re),$(),!0}catch(ze){return!1}},b:Y}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(z,me):z.then(pe=>pe.arrayBuffer()).then(pe=>WebAssembly.instantiate(pe,me))).then(pe=>{const{Rb:ge,Qb:Pe,P:Re,T:ze,X:Ge,Ja:Ke,La:it,Qa:Je,Va:ut,Wa:Ct,eb:ht,jb:Mt,f:lt,e:xt,yb:Ot,zb:ft,Ab:jt,Bb:Dt,Db:Pt,Gb:vn}=pe.instance.exports;V=xt;const mn=(()=>{let tn=0,Nt=0,Rn=0,gn=0;return cn=>{Rn&&(ge(gn),ge(tn),Nt+=Rn,Rn=tn=0),tn||(Nt+=128,tn=Pe(Nt));const Bn=cn.length+7&-8;let Un=tn;Bn>=Nt&&(Rn=Bn,Un=gn=Pe(Bn));for(let jn=0;jn<cn.length;jn++)j[Un+jn]=cn[jn];return Un}})();return $(),lt(),{memory:xt,_free:ge,_malloc:Pe,Mesh:class{constructor(){this.ptr=Re()}destroy(){ze(this.ptr)}},Decoder:class{constructor(){this.ptr=Ke()}destroy(){Mt(this.ptr)}DecodeArrayToMesh(tn,Nt,Rn){const gn=mn(tn),cn=it(this.ptr,gn,Nt,Rn.ptr);return!!Ge(cn)}GetAttributeByUniqueId(tn,Nt){return{ptr:Je(this.ptr,tn.ptr,Nt)}}GetTrianglesUInt16Array(tn,Nt,Rn){ut(this.ptr,tn.ptr,Nt,Rn)}GetTrianglesUInt32Array(tn,Nt,Rn){Ct(this.ptr,tn.ptr,Nt,Rn)}GetAttributeDataArrayForAllPoints(tn,Nt,Rn,gn,cn){ht(this.ptr,tn.ptr,Nt.ptr,Rn,gn,cn)}},DT_INT8:Ot(),DT_UINT8:ft(),DT_INT16:jt(),DT_UINT16:Dt(),DT_UINT32:Pt(),DT_FLOAT32:vn()}})}(fetch(sB())),xT.then(z=>{Mc=z,xT=void 0}))}()),M&&C.push(function(){if(E3)return;const z=function(j){let V;const $=WebAssembly.instantiateStreaming(j,{}).then(pe=>{V=pe.instance,V.exports.__wasm_call_ctors()}),Y={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},me={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(pe,ge,Pe,Re,ze,Ge){(function(Ke,it,Je,ut,Ct,ht,Mt){const lt=Ke.exports.sbrk,xt=ut+3&-4,Ot=lt(xt*Ct),ft=lt(ht.length),jt=new Uint8Array(Ke.exports.memory.buffer);jt.set(ht,ft);const Dt=it(Ot,ut,Ct,ft,ht.length);if(Dt===0&&Mt&&Mt(Ot,xt,Ct),Je.set(jt.subarray(Ot,Ot+ut*Ct)),lt(Ot-lt(0)),Dt!==0)throw new Error(`Malformed buffer data: ${Dt}`)})(V,V.exports[me[ze]],pe,ge,Pe,Re,V.exports[Y[Ge]])}}}(fetch(oB()));return z.ready.then(()=>{E3=z})}()),p)for(let z=0;z<p.length;z++)C.push(gJ(p[z],u,z,o));return(C.length?Promise.all(C):Promise.resolve()).then(()=>{if(P&&m)for(const{primitives:z}of m)for(const j of z)fJ(j,u);if(M&&m&&w)for(const z of w)pJ(z,u);return u})})}function Kp(i,n){const o=i.json.bufferViews[n.bufferView],u=bT[n.componentType];return new u(i.buffers[o.buffer],(n.byteOffset||0)+(o.byteOffset||0),n.count*(o.byteStride&&o.byteStride!==Lv[n.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:Lv[n.type]))}function I3(i,n,o,u){const h=bT[n.componentType],p=function(C){switch(C){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),m=i.json.bufferViews[n.bufferView],v=m.byteStride?m.byteStride/h.BYTES_PER_ELEMENT:Lv[n.type],w=o.float32,E=w.length/o.capacity;for(let C=0,P=0;C<n.count*v;C+=v,P+=E)for(let M=0;M<E;M++)w[P+M]=u[C+M]*p;o._trim()}function _J(i,n,o){const u=i.indices,h=i.attributes,p={};p.indexArray=new Gs;const m=n.json.accessors[u],v=m.count/3;p.indexArray.reserve(v);const w=Kp(n,m);for(let M=0;M<v;M++)p.indexArray.emplaceBack(w[3*M],w[3*M+1],w[3*M+2]);p.indexArray._trim(),p.vertexArray=new Nd;const E=n.json.accessors[h.POSITION];p.vertexArray.reserve(E.count);const C=Kp(n,E);for(let M=0;M<E.count;M++)p.vertexArray.emplaceBack(C[3*M],C[3*M+1],C[3*M+2]);if(p.vertexArray._trim(),p.aabb=new gi(E.min,E.max),p.centroid=function(M,z){const j=[0,0,0],V=M.length;if(V>0){for(let $=0;$<V;$++){const Y=3*M[$];j[0]+=z[Y],j[1]+=z[Y+1],j[2]+=z[Y+2]}j[0]/=V,j[1]/=V,j[2]/=V}return j}(w,C),h.COLOR_0!==void 0){const M=n.json.accessors[h.COLOR_0],z=Lv[M.type],j=Kp(n,M);p.colorArray=z===3?new Nd:new zd,p.colorArray.resize(M.count),I3(n,M,p.colorArray,j)}if(h.NORMAL!==void 0){p.normalArray=new Nd;const M=n.json.accessors[h.NORMAL];p.normalArray.resize(M.count);const z=Kp(n,M);I3(n,M,p.normalArray,z)}if(h.TEXCOORD_0!==void 0&&o.length>0){p.texcoordArray=new Y0;const M=n.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(M.count);const z=Kp(n,M);I3(n,M,p.texcoordArray,z)}if(h._FEATURE_ID_RGBA4444!==void 0){const M=n.json.accessors[h._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Kp(n,M))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Kp(n,n.json.accessors[h._FEATURE_RGBA4444]).buffer));const P=i.material;return p.material=function(M,z){const{emissiveFactor:j=[0,0,0],alphaMode:V="OPAQUE",alphaCutoff:$=.5,normalTexture:Y,occlusionTexture:me,emissiveTexture:pe,doubleSided:ge}=M,{baseColorFactor:Pe=[1,1,1,1],metallicFactor:Re=1,roughnessFactor:ze=1,baseColorTexture:Ge,metallicRoughnessTexture:Ke}=M.pbrMetallicRoughness||{},it=me?z[me.index]:void 0;if(me&&me.extensions&&me.extensions.KHR_texture_transform&&it){const Je=me.extensions.KHR_texture_transform;it.offsetScale=[Je.offset[0],Je.offset[1],Je.scale[0],Je.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ir(...Pe),metallicFactor:Re,roughnessFactor:ze,baseColorTexture:Ge?z[Ge.index]:void 0,metallicRoughnessTexture:Ke?z[Ke.index]:void 0},doubleSided:ge,emissiveFactor:j,alphaMode:V,alphaCutoff:$,normalTexture:Y?z[Y.index]:void 0,occlusionTexture:it,emissionTexture:pe?z[pe.index]:void 0,defined:M.defined===void 0}}(P!==void 0?n.json.materials[P]:{defined:!1},o),p}function fB(i,n,o){const{matrix:u,rotation:h,translation:p,scale:m,mesh:v,extras:w,children:E}=i,C={};if(C.matrix=u||a.ae.fromRotationTranslationScale([],h||[0,0,0,1],p||[0,0,0],m||[1,1,1]),v!==void 0){C.meshes=o[v];const P=C.anchor=[0,0];for(const M of C.meshes){const{min:z,max:j}=M.aabb;P[0]+=z[0]+j[0],P[1]+=z[1]+j[1]}P[0]=Math.floor(P[0]/C.meshes.length/2),P[1]=Math.floor(P[1]/C.meshes.length/2)}if(w&&(w.id&&(C.id=w.id),w.lights&&(C.lights=function(P){if(!P.length)return[];const M=function(Y){const me=atob(Y),pe=new Uint8Array(me.length);for(let ge=0;ge<me.length;ge++)pe[ge]=me.codePointAt(ge);return pe}(P),z=[],j=M.length/24,V=new Uint16Array(M.buffer),$=new Float32Array(M.buffer);for(let Y=0;Y<j;Y++){const me=V[2*Y*6]/30,pe=V[2*Y*6+1]/30,ge=V[2*Y*6+10]/100,Pe=$[6*Y+1],Re=$[6*Y+2],ze=$[6*Y+3],Ge=$[6*Y+4],Ke=ze-Pe,it=Ge-Re,Je=Math.hypot(Ke,it);z.push({pos:[Pe+.5*Ke,Re+.5*it,pe],normal:[it/Je,-Ke/Je,0],width:Je,height:me,depth:ge,points:[Pe,Re,ze,Ge]})}return z}(w.lights))),E){const P=[];for(const M of E)P.push(fB(n.json.nodes[M],n,o));C.children=P}return C}function yJ(i){if(i.vertices.length===0||i.indices.length===0)return null;const n=new $P(i.vertices,i.indices,8,256),[o,u]=[n.min.clone(),n.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:n,min:o,max:u}}function vJ(i){if(!i.extras||!i.extras.ground)return null;const n=i.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const o=n[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const m of o){if(!Array.isArray(m)||m.length!==2)continue;const v=m[0],w=m[1];typeof v=="number"&&typeof w=="number"&&u.push(new Ft(v,w))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let m=0;m<u.length;m++){const v=u[m],w=u[(m+1)%u.length],E=u[(m+2)%u.length];h+=(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)}h>0&&u.reverse();const p=av(u.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:u,indices:p}}function xJ(i,n){const o=[],u=[];let h=0;const p=[];for(const m of i){h=o.length;const v=m.vertexArray.float32,w=m.indexArray.uint16;for(let E=0;E<m.vertexArray.length;E++)p[0]=v[3*E+0],p[1]=v[3*E+1],p[2]=v[3*E+2],a.$.transformMat4(p,p,n),o.push(new Ft(p[0],p[1]));for(let E=0;E<3*m.indexArray.length;E++)u.push(w[E]+h)}if(u.length%3!=0)return null;for(let m=0;m<u.length;m+=3){const v=o[u[m+0]],w=o[u[m+1]],E=o[u[m+2]];(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)>0&&([u[m+1],u[m+2]]=[u[m+2],u[m+1]])}return{vertices:o,indices:u}}function pB(i){const n=function(w,E){const C=[],P=WebGL2RenderingContext;if(w.json.textures)for(const M of w.json.textures){const z={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};M.sampler!==void 0&&Object.assign(z,w.json.samplers[M.sampler]),C.push({image:E[M.source],sampler:z,uploaded:!1})}return C}(i,i.images),o=function(w,E){const C=[];for(const P of w.json.meshes){const M=[];for(const z of P.primitives)M.push(_J(z,w,E));C.push(M)}return C}(i,n),{scenes:u,scene:h,nodes:p}=i.json,m=u?u[h||0].nodes:p,v=[];for(const w of m)v.push(fB(p[w],i,o));return function(w,E,C){const P={},M=new Set;for(let z=0;z<w.length;z++){const j=C[E[z]];if(!j.extras)continue;const V=j.extras["mapbox:footprint:version"],$=j.extras["mapbox:footprint:id"];(V||$)&&M.add(z),V==="1.0.0"&&$&&(P[$]=z)}for(let z=0;z<w.length;z++){if(M.has(z))continue;const j=w[z],V=C[E[z]];if(!V.extras)continue;let $=null;j.id in P&&($=xJ(w[P[j.id]].meshes,j.matrix)),$||($=vJ(V)),$&&(j.footprint=yJ($))}if(M.size>0){const z=Array.from(M.values()).sort((j,V)=>j-V);for(let j=z.length-1;j>=0;j--)w.splice(z[j],1)}}(v,m,i.json.nodes),v}function bJ(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);const n=i.vertexArray.float32,o=i.aabb.min[0]-1,u=i.aabb.min[1]-1,h=Xp/(i.aabb.max[0]-o+2),p=Xp/(i.aabb.max[1]-u+2);for(let m=0;m<n.length;m+=3){const v=n[m+2],w=(n[m+0]-o)*h|0,E=(n[m+1]-u)*p|0;v>i.heightmap[E*Xp+w]&&(i.heightmap[E*Xp+w]=v)}}function wJ(i,n){const o={};o.indexArray=new Gs,o.indexArray.reserve(4*i.length),o.vertexArray=new Nd,o.vertexArray.reserve(10*i.length),o.colorArray=new zd,o.vertexArray.reserve(10*i.length);let u=0;for(const m of i){const v=Math.min(10,Math.max(4,1.3*m.height))*n,w=[-m.normal[1],m.normal[0],0],E=Math.min(.29,.1*m.width/m.depth),C=m.width-2*m.depth*n*(E+.01),P=a.$.scaleAndAdd([],m.pos,w,C/2),M=a.$.scaleAndAdd([],m.pos,w,-C/2),z=[P[0],P[1],P[2]+m.height],j=[M[0],M[1],M[2]+m.height],V=a.$.scaleAndAdd([],m.normal,w,E);a.$.scale(V,V,v);const $=a.$.scaleAndAdd([],m.normal,w,-E);a.$.scale($,$,v),a.$.add(V,P,V),a.$.add($,M,$),P[2]+=.1,M[2]+=.1,o.vertexArray.emplaceBack(V[0],V[1],V[2]),o.vertexArray.emplaceBack($[0],$[1],$[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(M[0],M[1],M[2]),o.vertexArray.emplaceBack(z[0],z[1],z[2]),o.vertexArray.emplaceBack(j[0],j[1],j[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(M[0],M[1],M[2]),o.vertexArray.emplaceBack(V[0],V[1],V[2]),o.vertexArray.emplaceBack($[0],$[1],$[2]);const Y=C/v/2;o.colorArray.emplaceBack(-Y-E,-1,Y,.8),o.colorArray.emplaceBack(Y+E,-1,Y,.8),o.colorArray.emplaceBack(-Y,0,Y,1.3),o.colorArray.emplaceBack(Y,0,Y,1.3),o.colorArray.emplaceBack(Y+E,-.8,Y,.7),o.colorArray.emplaceBack(Y+E,-.8,Y,.7),o.colorArray.emplaceBack(0,0,Y,1.3),o.colorArray.emplaceBack(0,0,Y,1.3),o.colorArray.emplaceBack(Y+E,-1.2,Y,.8),o.colorArray.emplaceBack(Y+E,-1.2,Y,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const h={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=Ir.white,h.pbrMetallicRoughness=p,o.material=h,o.aabb=new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}const C3=new Float32Array(262144),Qp=new Uint8Array(262144);function mB(i){let n=0;if(i.meshes)for(const o of i.meshes)n=Math.max(n,o.aabb.max[2]);if(i.children)for(const o of i.children)n=Math.max(n,mB(o));return n}function gB(i,n,o){if(i.meshes)for(const u of i.meshes)u.aabb.min[0]!==1/0&&o.insert(n,u.aabb.min[0],u.aabb.min[1],u.aabb.max[0],u.aabb.max[1]);if(i.children)for(const u of i.children)gB(u,n,o)}const _B=["","wall","door","roof","window","lamp","logo"];class yB{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:n.id,geometry:[],properties:{height:mB(n)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const o=new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==n&&(u.transformedAabb=gi.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),n++;this.aabb=o}return this.aabb}}class TT{constructor(n,o,u,h,p,m){this.id=o,this.modelTraits|=y_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=y_.HasMapboxMeshFeatures),h&&(this.modelTraits|=y_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const v of n)this.nodesInfo.push(new yB(v)),gB(v,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}updateFootprints(n,o){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&o.push({footprint:h.footprint,id:n})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const h=u.node;this.uploaded?this.updatePbrBuffer(h):x3(h,n,!0)}for(const u of o)yT(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let o=!1;if(!n.meshes)return o;for(const u of n.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(n,o,u){const h=n.transform.projectionOptions,p=n.style.getBrightness(),m=this.brightness!==p;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||zv(u.paint.get("model-color").value,m)||zv(u.paint.get("model-color-mix-intensity").value,m)||zv(u.paint.get("model-roughness").value,m)||zv(u.paint.get("model-emissive-strength").value,m)||zv(u.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=h,this.brightness=p,!0)}evaluateScale(n,o){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const p of u){const m=p.feature;p.evaluatedScale=o.paint.get("model-scale").evaluate(m,{},h)}}evaluate(n){const o=this.getNodesInfo();for(const u of o){if(!u.node.meshes)continue;const h=u.feature,p=u.node.meshes&&u.node.meshes[0].featureData,m=u.evaluatedColor[2],v=u.evaluatedRMEA[2],w=this.id.canonical;if(u.hasTranslucentParts=!1,p){for(let E=0;E<_B.length;E++){const C=_B[E];C.length&&(h.properties.part=C);const P=n.paint.get("model-color").evaluate(h,{},w).toRenderColor(null),M=n.paint.get("model-color-mix-intensity").evaluate(h,{},w);u.evaluatedColor[E]=[P.r,P.g,P.b,M],u.evaluatedRMEA[E][0]=n.paint.get("model-roughness").evaluate(h,{},w),u.evaluatedRMEA[E][2]=n.paint.get("model-emissive-strength").evaluate(h,{},w),u.evaluatedRMEA[E][3]=P.a,u.emissionHeightBasedParams[E]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},w),!u.hasTranslucentParts&&P.a<1&&(u.hasTranslucentParts=!0)}delete h.properties.part,EJ(u,m!==u.evaluatedColor[2]||v!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(h,{},w);u.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},w),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,o,u,h){const p=n.findDEMTileFor(u);if(p&&(p.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=a_.create(n,u,p);if(!m)return;this.modelTraits&y_.HasMapboxMeshFeatures&&this.updateDEM(n,m,u,h);for(const v of this.getNodesInfo()){const w=v.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const E=w.footprint.vertices;let C=m.getElevationAt(E[0].x,E[0].y,!0,!0);for(let P=1;P<E.length;P++)C=Math.min(C,m.getElevationAt(E[P].x,E[P].y,!0,!0));w.elevation=C}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=o}}updateDEM(n,o,u,h){let p=o._dem._modifiedForSources[h];if(p===void 0&&(o._dem._modifiedForSources[h]=[],p=o._dem._modifiedForSources[h]),p.includes(u.canonical))return;const m=o._dem.dim;p.push(u.canonical);let v=!1;for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.grid)continue;const C=E.footprint.grid,P=o.tileCoordToPixel(C.min.x,C.min.y),M=o.tileCoordToPixel(C.max.x,C.max.y),z=Math.min(Math.min(m-M.y,P.x),Math.min(P.y,m-M.x));if(z<0)continue;const j=Yn(z,2,5);let V=Math.max(0,P.x-j),$=Math.max(0,P.y-j),Y=Math.min(M.x+j,m-1),me=Math.min(M.y+j,m-1);for(let Re=$;Re<=me;++Re)for(let ze=V;ze<=Y;++ze)Qp[Re*m+ze]=255;let pe=0,ge=0;for(let Re=0;Re<C.cellsY;++Re)for(let ze=0;ze<C.cellsX;++ze){if(!C.cells[Re*C.cellsX+ze])continue;const Ge=o.tileCoordToPixel(C.min.x+ze/C.xScale,C.min.y+Re/C.yScale),Ke=o.tileCoordToPixel(C.min.x+(ze+1)/C.xScale,C.min.y+(Re+1)/C.yScale);for(let it=Ge.y;it<=Math.min(Ke.y+1,m-1);++it)for(let Je=Ge.x;Je<=Math.min(Ke.x+1,m-1);++Je)Qp[it*m+Je]===255&&(Qp[it*m+Je]=0,pe+=o.getElevationAtPixel(Je,it),ge++)}const Pe=pe/ge;V=Math.max(1,P.x-j),$=Math.max(1,P.y-j),Y=Math.min(M.x+j,m-2),me=Math.min(M.y+j,m-2),v=!0;for(let Re=$;Re<=me;++Re)for(let ze=V;ze<=Y;++ze)Qp[Re*m+ze]===0&&(C3[Re*m+ze]=o._dem.set(ze,Re,Pe));for(let Re=1;Re<j;++Re){V=Math.max(1,P.x-Re),$=Math.max(1,P.y-Re),Y=Math.min(M.x+Re,m-2),me=Math.min(M.y+Re,m-2);for(let ze=$;ze<=me;++ze)for(let Ge=V;Ge<=Y;++Ge){const Ke=ze*m+Ge;if(Qp[Ke]===255){let it=0,Je=0,ut=-1,Ct=-1;for(let ht=-1;ht<=1;++ht)for(let Mt=-1;Mt<=1;++Mt){const lt=(ze+ht)*m+Ge+Mt;if(Qp[lt]>=Re)continue;const xt=C3[lt],Ot=Math.abs(xt);Ot>Je&&(it=xt,Je=Ot,ut=Mt,Ct=ht)}if(Je>.1){const ht=1-(Re+.5*Math.abs(ut*Ct))/j;let Mt=o._dem.get(Ge,ze)+it*ht;const lt=o._dem.get(Ge+ut,ze+Ct),xt=o._dem.get(Ge-ut,ze-Ct,!0);(Mt-lt)*(Mt-xt)>0&&(Mt=(lt+xt)/2),C3[Ke]=o._dem.set(Ge,ze,Mt),Qp[Ke]=Re}}}}}v&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=rn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const o of n)yT(o.node),b3(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped()),h=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const m=h[p].node;h[p].hiddenByReplacement=!!m.footprint&&!u.find(v=>v.footprint===m.footprint)}}getHeightAtTileCoord(n,o){const u=this.getNodesInfo(),h=[],p=[0,0,0],m=a.ae.identity([]);for(let v=0;v<this.nodesInfo.length;v++){const w=u[v],E=w.node.meshes[0],C=E.transformedAabb;if(n<C.min[0]||o<C.min[1]||n>C.max[0]||o>C.max[1])continue;if(w.node.hidden===!0)return{height:0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};a.ae.invert(m,w.node.matrix),p[0]=n,p[1]=o,a.$.transformMat4(p,p,m);const P=(p[0]-E.aabb.min[0])/(E.aabb.max[0]-E.aabb.min[0])*Xp|0,M=Math.min(63,(p[1]-E.aabb.min[1])/(E.aabb.max[1]-E.aabb.min[1])*Xp|0)*Xp+Math.min(63,P),z=E.heightmap[M];if(!(z<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:z,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new Ft(n,o),new Ft(n,o),h),h.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function zv(i,n){return!i.isLightConstant&&n}function TJ(i,n,o,u,h,p,m,v){let w=(61440&n|(61440&n)>>4)>>8,E=(3840&n|(3840&n)>>4)>>4,C=240&n|(240&n)>>4;o[3]>0&&(w=Tn(w,255*o[0],o[3]),E=Tn(E,255*o[1],o[3]),C=Tn(C,255*o[2],o[3]));const P=w<<8|E,M=C<<8|Math.floor(255*u[3]),z=function(Re){const ze=Yn(Re,0,2);return Math.min(Math.round(.5*ze*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],j=Yn(h[0],0,1),V=Yn(h[1],0,1),$=Yn(h[2],0,1),Y=Yn(h[3],0,1);let me,pe,ge,Pe;if(j!==V&&m!==p&&V!==j){const Re=m-p;pe=1/(Re*(V-j)),ge=-(p+Re*j)/(Re*(V-j));const ze=Yn(h[4],-1,1);Pe=Math.pow(10,ze),me=255*$<<8|255*Y}else me=65535,pe=0,ge=1,Pe=1;if(i.emplaceBack(P,M,z,me,pe,ge,Pe),v){const Re=v.length;v.clear();for(let ze=0;ze<Re;ze++)v.emplaceBack(P,M,z,me,pe,ge,Pe)}}function EJ(i,n,o){const u=i.node;let h=0;const p=o&y_.HasMeshoptCompression;for(const m of u.meshes){if(u.lights&&u.lightMeshIndex===h||!m.featureData)continue;m.featureArray=new Tw,m.featureArray.reserve(m.featureData.length);let v=n;for(const w of m.featureData){const E=p?65535&w:w>>16&65535,C=p?w>>16&65535:65535&w,P=(15&C)<8?15&C:0,M=i.evaluatedRMEA[P],z=i.evaluatedColor[P],j=i.emissionHeightBasedParams[P];let V;if(v&&P===2&&u.lights&&(V=new Tw,V.resize(10*u.lights.length)),TJ(m.featureArray,E,z,M,j,m.aabb.min[2],m.aabb.max[2],V),V&&v){v=!1;const $=u.meshes[u.lightMeshIndex];$.featureArray=V,$.featureArray._trim()}}m.featureArray._trim(),h++}}function vB(i,n,o,u){const h=1<<i.z;n.lat=eo((u/zt+i.y)/h),n.lng=ya((o/zt+i.x)/h)}qe(TT,"Tiled3dModelBucket",{omit:["layers"]}),qe(yB,"Tiled3dModelFeature");const SJ={circle:class extends _a{constructor(i,n,o,u){super(i,{layout:tz||(tz=new Wr({"circle-sort-key":new un(tt.layout_circle["circle-sort-key"]),visibility:new Rt(tt.layout_circle.visibility)})),paint:nz||(nz=new Wr({"circle-radius":new un(tt.paint_circle["circle-radius"]),"circle-color":new un(tt.paint_circle["circle-color"]),"circle-blur":new un(tt.paint_circle["circle-blur"]),"circle-opacity":new un(tt.paint_circle["circle-opacity"]),"circle-translate":new Rt(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new Rt(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rt(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rt(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new un(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new un(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new un(tt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Rt(tt.paint_circle["circle-emissive-strength"])}))},n,o,u)}createBucket(i){return new SP(i)}queryRadius(i){const n=i;return i_("circle-radius",this,n)+i_("circle-stroke-width",this,n)+Pw(this.paint.get("circle-translate"))}queryIntersectsFeature(i,n,o,u,h,p,m,v){const w=ez(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return _z(i,u,p,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,n,o){const u=gz(this);return{config:new jp(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}},heatmap:class extends _a{createBucket(i){return new vz(i)}constructor(i,n,o,u){super(i,{layout:Tz||(Tz=new Wr({visibility:new Rt(tt.layout_heatmap.visibility)})),paint:Ez||(Ez=new Wr({"heatmap-radius":new un(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new un(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rt(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new wo(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rt(tt.paint_heatmap["heatmap-opacity"])}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ov({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return i_("heatmap-radius",this,i)}queryIntersectsFeature(i,n,o,u,h,p,m,v){const w=this.paint.get("heatmap-radius").evaluate(n,o);return _z(i,u,p,m,v,!0,!0,new Ft(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,n,o){return i==="heatmap"?{config:new jp(this,{zoom:n,lut:o}),overrideFog:!1}:{}}},hillshade:class extends _a{constructor(i,n,o,u){super(i,{layout:Sz||(Sz=new Wr({visibility:new Rt(tt.layout_hillshade.visibility)})),paint:Iz||(Iz=new Wr({"hillshade-illumination-direction":new Rt(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Rt(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rt(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rt(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rt(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rt(tt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Rt(tt.paint_hillshade["hillshade-emissive-strength"])}))},n,o,u)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,n,o){return{overrideFog:!1}}},fill:class extends _a{constructor(i,n,o,u){super(i,{layout:Mz||(Mz=new Wr({"fill-sort-key":new un(tt.layout_fill["fill-sort-key"]),visibility:new Rt(tt.layout_fill.visibility)})),paint:kz||(kz=new Wr({"fill-antialias":new Rt(tt.paint_fill["fill-antialias"]),"fill-opacity":new un(tt.paint_fill["fill-opacity"]),"fill-color":new un(tt.paint_fill["fill-color"]),"fill-outline-color":new un(tt.paint_fill["fill-outline-color"]),"fill-translate":new Rt(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new Rt(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new un(tt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Rt(tt.paint_fill["fill-emissive-strength"])}))},n,o,u)}getProgramIds(){const i=this.paint.get("fill-pattern"),n=i&&i.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(i,n,o){return{config:new jp(this,{zoom:n,lut:o}),overrideFog:!1}}recalculate(i,n){super.recalculate(i,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Fw(i)}queryRadius(){return Pw(this.paint.get("fill-translate"))}queryIntersectsFeature(i,n,o,u,h,p){return!i.queryGeometry.isAboveHorizon&&XL(JL(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends _a{constructor(i,n,o,u){super(i,{layout:gN||(gN=new Wr({visibility:new Rt(tt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Rt(tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:_N||(_N=new Wr({"fill-extrusion-opacity":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new un(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new un(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new un(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new un(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new un(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new un(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new un(tt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new Rt(tt["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Ww(i)}queryRadius(){return Pw(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,n,o,u,h,p,m,v,w){const E=ez(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(n,o),P=this.paint.get("fill-extrusion-base").evaluate(n,o),M=[0,0],z=v&&p.elevation,j=p.elevation?p.elevation.exaggeration():1,V=i.tile.getBucket(this);if(z&&V instanceof Ww){const ge=V.centroidVertexArray,Pe=w+1;Pe<ge.length&&(M[0]=ge.geta_centroid_pos0(Pe),M[1]=ge.geta_centroid_pos1(Pe))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(u=mN([u],[new Ft(0,0),new Ft(zt,zt)],i.tileID.canonical).map(ge=>ge.polygon).flat());const $=z?v:null,[Y,me]=function(ge,Pe,Re,ze,Ge,Ke,it,Je,ut,Ct,ht){return ge.projection.name==="globe"?function(Mt,lt,xt,Ot,ft,jt,Dt,Pt,vn,mn,tn){const Nt=[],Rn=[],gn=Mt.projection.upVectorScale(tn,Mt.center.lat,Mt.worldSize).metersToTile,cn=[0,0,0,1],Bn=[0,0,0,1],Un=(Kn,yr,lr,$r)=>{Kn[0]=yr,Kn[1]=lr,Kn[2]=$r,Kn[3]=1},jn=pN();xt>0&&(xt+=jn),Ot+=jn;for(const Kn of lt){const yr=[],lr=[];for(const $r of Kn){const Hr=$r.x+ft.x,Vn=$r.y+ft.y,Dr=Mt.projection.projectTilePoint(Hr,Vn,tn),Fr=Mt.projection.upVector(tn,$r.x,$r.y);let ii=xt,ji=Ot;if(Dt){const es=vN(Hr,Vn,xt,Ot,Dt,Pt,vn,mn);ii+=es.base,ji+=es.top}xt!==0?Un(cn,Dr.x+Fr[0]*gn*ii,Dr.y+Fr[1]*gn*ii,Dr.z+Fr[2]*gn*ii):Un(cn,Dr.x,Dr.y,Dr.z),Un(Bn,Dr.x+Fr[0]*gn*ji,Dr.y+Fr[1]*gn*ji,Dr.z+Fr[2]*gn*ji),a.$.transformMat4(cn,cn,jt),a.$.transformMat4(Bn,Bn,jt),yr.push(new Gp(cn[0],cn[1],cn[2])),lr.push(new Gp(Bn[0],Bn[1],Bn[2]))}Nt.push(yr),Rn.push(lr)}return[Nt,Rn]}(ge,Pe,Re,ze,Ge,Ke,it,Je,ut,Ct,ht):it?function(Mt,lt,xt,Ot,ft,jt,Dt,Pt,vn){const mn=[],tn=[],Nt=[0,0,0,1];for(const Rn of Mt){const gn=[],cn=[];for(const Bn of Rn){const Un=Bn.x+Ot.x,jn=Bn.y+Ot.y,Kn=vN(Un,jn,lt,xt,jt,Dt,Pt,vn);Nt[0]=Un,Nt[1]=jn,Nt[2]=Kn.base,Nt[3]=1,a.aB.transformMat4(Nt,Nt,ft),Nt[3]=Math.max(Nt[3],1e-5);const yr=new Gp(Nt[0]/Nt[3],Nt[1]/Nt[3],Nt[2]/Nt[3]);Nt[0]=Un,Nt[1]=jn,Nt[2]=Kn.top,Nt[3]=1,a.aB.transformMat4(Nt,Nt,ft),Nt[3]=Math.max(Nt[3],1e-5);const lr=new Gp(Nt[0]/Nt[3],Nt[1]/Nt[3],Nt[2]/Nt[3]);gn.push(yr),cn.push(lr)}mn.push(gn),tn.push(cn)}return[mn,tn]}(Pe,Re,ze,Ge,Ke,it,Je,ut,Ct):function(Mt,lt,xt,Ot,ft){const jt=[],Dt=[],Pt=ft[8]*lt,vn=ft[9]*lt,mn=ft[10]*lt,tn=ft[11]*lt,Nt=ft[8]*xt,Rn=ft[9]*xt,gn=ft[10]*xt,cn=ft[11]*xt;for(const Bn of Mt){const Un=[],jn=[];for(const Kn of Bn){const yr=Kn.x+Ot.x,lr=Kn.y+Ot.y,$r=ft[0]*yr+ft[4]*lr+ft[12],Hr=ft[1]*yr+ft[5]*lr+ft[13],Vn=ft[2]*yr+ft[6]*lr+ft[14],Dr=ft[3]*yr+ft[7]*lr+ft[15],Fr=$r+Pt,ii=Hr+vn,ji=Vn+mn,es=Math.max(Dr+tn,1e-5),Ui=$r+Nt,Ri=Hr+Rn,Ws=Vn+gn,ms=Math.max(Dr+cn,1e-5);Un.push(new Gp(Fr/es,ii/es,ji/es)),jn.push(new Gp(Ui/ms,Ri/ms,Ws/ms))}jt.push(Un),Dt.push(jn)}return[jt,Dt]}(Pe,Re,ze,Ge,Ke)}(p,u,P,C,E,m,$,M,j,p.center.lat,i.tileID.canonical),pe=i.queryGeometry;return function(ge,Pe,Re){let ze=1/0;XL(Re,Pe)&&(ze=yN(Re,Pe[0]));for(let Ge=0;Ge<Pe.length;Ge++){const Ke=Pe[Ge],it=ge[Ge];for(let Je=0;Je<Ke.length-1;Je++){const ut=Ke[Je],Ct=[ut,Ke[Je+1],it[Je+1],it[Je],ut];IP(Re,Ct)&&(ze=Math.min(ze,yN(Re,Ct)))}}return ze!==1/0&&ze}(Y,me,pe.isPointQuery()?pe.screenBounds:pe.screenGeometry)}},line:class extends _a{constructor(i,n,o,u){const h=AF();super(i,h,n,o,u),h.layout&&(this.layout=new Js(h.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof kd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,n){super.recalculate(i,n),this.paint._values["line-floorwidth"]=(()=>{if(Rv)return Rv;const o=AF();return Rv=new YY(o.paint.properties["line-width"].specification),Rv.useIntegerZoom=!0,Rv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Hw(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,n,o){const u=PN(this);return{config:new jp(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}queryRadius(i){const n=i,o=MF(i_("line-width",this,n),i_("line-gap-width",this,n)),u=i_("line-offset",this,n);return o/2+Math.abs(u)+Pw(this.paint.get("line-translate"))}queryIntersectsFeature(i,n,o,u,h,p){if(i.queryGeometry.isAboveHorizon)return!1;const m=JL(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*MF(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),w=this.paint.get("line-offset").evaluate(n,o);return w&&(u=function(E,C){const P=[],M=new Ft(0,0);for(let z=0;z<E.length;z++){const j=E[z],V=[];for(let $=0;$<j.length;$++){const Y=j[$],me=j[$+1],pe=$===0?M:Y.sub(j[$-1])._unit()._perp(),ge=$===j.length-1?M:me.sub(Y)._unit()._perp(),Pe=pe._add(ge)._unit();Pe._mult(1/(Pe.x*ge.x+Pe.y*ge.y)),V.push(Pe._mult(C)._add(Y))}P.push(V)}return P}(u,w*i.pixelToTileUnitsFactor)),function(E,C,P){for(let M=0;M<C.length;M++){const z=C[M];if(E.length>=3){for(let j=0;j<z.length;j++)if($d(E,z[j]))return!0}if(EK(E,z,P))return!0}return!1}(m,u,v)}isTileClipped(){return!0}isDraped(i){const n=this.layout.get("line-z-offset");return n.isConstant()&&!n.constantOr(0)}},symbol:dT,background:class extends _a{constructor(i,n,o,u){super(i,{layout:DF||(DF=new Wr({visibility:new Rt(tt.layout_background.visibility)})),paint:OF||(OF=new Wr({"background-color":new Rt(tt.paint_background["background-color"]),"background-pattern":new Rt(tt.paint_background["background-pattern"]),"background-opacity":new Rt(tt.paint_background["background-opacity"]),"background-emissive-strength":new Rt(tt.paint_background["background-emissive-strength"])}))},n,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,n,o){return{overrideFog:!1}}},raster:BF,"raster-particle":GF,sky:class extends _a{constructor(i,n,o,u){super(i,{layout:VF||(VF=new Wr({visibility:new Rt(tt.layout_sky.visibility)})),paint:$F||($F=new Wr({"sky-type":new Rt(tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Rt(tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Rt(tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Rt(tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Rt(tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new wo(tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Rt(tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Rt(tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Rt(tt.paint_sky["sky-opacity"])}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ov({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(i,n){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,p=i.style.light,m=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&Pi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?_3(m.azimuthal,90-m.polar,n):_3(u[0],90-u[1],n)}const o=this.paint.get("sky-gradient-center");return _3(o[0],90-o[1],n)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends _a{constructor(i,n,o,u){super(i,{paint:qF||(qF=new Wr({}))},n,null)}},model:class extends _a{constructor(i,n,o,u){super(i,{layout:tB||(tB=new Wr({visibility:new Rt(tt.layout_model.visibility),"model-id":new un(tt.layout_model["model-id"])})),paint:nB||(nB=new Wr({"model-opacity":new Rt(tt.paint_model["model-opacity"]),"model-rotation":new un(tt.paint_model["model-rotation"]),"model-scale":new un(tt.paint_model["model-scale"]),"model-translation":new un(tt.paint_model["model-translation"]),"model-color":new un(tt.paint_model["model-color"]),"model-color-mix-intensity":new un(tt.paint_model["model-color-mix-intensity"]),"model-type":new Rt(tt.paint_model["model-type"]),"model-cast-shadows":new Rt(tt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Rt(tt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Rt(tt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new un(tt.paint_model["model-emissive-strength"]),"model-roughness":new un(tt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new un(tt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Rt(tt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Rt(tt.paint_model["model-front-cutoff"])}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new v3(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof TT?zt-1:0}queryIntersectsFeature(i,n,o,u,h,p){if(!this.modelManager)return!1;const m=this.modelManager,v=i.tile.getBucket(this);if(!(v&&v instanceof v3))return!1;const w=v;for(const E in w.instancesPerModel){const C=w.instancesPerModel[E],P=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(P)){const M=C.features[C.idToFeaturesIndex[P]],z=m.getModel(E,this.scope);if(!z)return!1;let j=a.ae.create();const V=new Er(0,0),$=w.canonical;let Y=Number.MAX_VALUE;for(let me=0;me<M.instancedDataCount;++me){const pe=16*(M.instancedDataOffset+me),ge=C.instancedDataArray.float32,Pe=[ge[pe+4],ge[pe+5],ge[pe+6]];vB($,V,ge[pe],0|ge[pe+1]),rB(j,z,p,V,M.rotation,M.scale,Pe,!1,!1,!1),p.projection.name==="globe"&&(j=y3(j,p));const Re=a.ae.multiply([],p.projMatrix,j),ze=i.queryGeometry,Ge=QF(ze.isPointQuery()?ze.screenBounds:ze.screenGeometry,p,Re,z.aabb);Ge!=null&&(Y=Math.min(Ge,Y))}return Y!==Number.MAX_VALUE&&Y}}return!1}_handleOverridablePaintPropertyUpdate(i,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){const n=this._transitionablePaint._values[i];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Ce}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,n,o,u){const h=i.tile,p=h.getBucket(this);let m=null,v=Number.MAX_VALUE;if(!(p&&p instanceof TT))return{queryFeature:m,intersectionZ:v};const w=p.getNodesInfo()[n];if(w.hiddenByReplacement||!w.node.meshes||!o.filter(new Mn(h.tileID.overscaledZ),w.feature,h.tileID.canonical))return{queryFeature:m,intersectionZ:v};const E=w.node,C=u.calculatePosMatrix(h.tileID.toUnwrapped(),u.worldSize),P=w.evaluatedScale;let M=0;u.elevation&&E.elevation&&(M=E.elevation*u.elevation.exaggeration()),a.ae.translate(C,C,[(E.anchor?E.anchor[0]:0)*(P[0]-1),(E.anchor?E.anchor[1]:0)*(P[1]-1),M]),a.ae.scale(C,C,P),a.ae.multiply(C,C,E.matrix);const z=i.queryGeometry,j=z.isPointQuery()?z.screenBounds:z.screenGeometry,V=function(Y){const me=a.ae.multiply([],C,Y.matrix),pe=a.ae.multiply(me,u.expandedFarZProjMatrix,me);for(let ge=0;ge<Y.meshes.length;++ge){const Pe=Y.meshes[ge];if(ge===Y.lightMeshIndex)continue;const Re=QF(j,u,pe,Pe.aabb);Re!=null&&(v=Math.min(Re,v))}if(Y.children)for(const ge of Y.children)V(ge)};if(V(E),v===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:v};const $=new Er(0,0);return vB(h.tileID.canonical,$,w.node.anchor[0],w.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[$.lng,$.lat]},properties:w.feature.properties,id:w.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:v}}},clip:class extends _a{constructor(i,n,o,u){super(i,{layout:Dz||(Dz=new Wr({"clip-layer-types":new Rt(tt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Rt(tt.layout_clip["clip-layer-scope"])})),paint:Oz||(Oz=new Wr({}))},n,o,u)}recalculate(i,n){super.recalculate(i,n)}createBucket(i){return new Lz(i)}isTileClipped(){return!0}is3D(){return!0}}};qe(SF,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const xB=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class A3{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=xB[15&u];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(n,2,1),[v]=new Uint32Array(n,4,1);return new A3(v,m,p,n)}constructor(n,o=64,u=Float64Array,h){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const p=xB.indexOf(this.ArrayType),m=2*n*this.ArrayType.BYTES_PER_ELEMENT,v=n*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+w,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+w),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+w,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=n,this.coords[this._pos++]=o,u}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return P3(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:v}=this,w=[0,p.length-1,0],E=[];for(;w.length;){const C=w.pop()||0,P=w.pop()||0,M=w.pop()||0;if(P-M<=v){for(let $=M;$<=P;$++){const Y=m[2*$],me=m[2*$+1];Y>=n&&Y<=u&&me>=o&&me<=h&&E.push(p[$])}continue}const z=M+P>>1,j=m[2*z],V=m[2*z+1];j>=n&&j<=u&&V>=o&&V<=h&&E.push(p[z]),(C===0?n<=j:o<=V)&&(w.push(M),w.push(z-1),w.push(1-C)),(C===0?u>=j:h>=V)&&(w.push(z+1),w.push(P),w.push(1-C))}return E}within(n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,v=[0,h.length-1,0],w=[],E=u*u;for(;v.length;){const C=v.pop()||0,P=v.pop()||0,M=v.pop()||0;if(P-M<=m){for(let $=M;$<=P;$++)wB(p[2*$],p[2*$+1],n,o)<=E&&w.push(h[$]);continue}const z=M+P>>1,j=p[2*z],V=p[2*z+1];wB(j,V,n,o)<=E&&w.push(h[z]),(C===0?n-u<=j:o-u<=V)&&(v.push(M),v.push(z-1),v.push(1-C)),(C===0?n+u>=j:o+u>=V)&&(v.push(z+1),v.push(P),v.push(1-C))}return w}}function P3(i,n,o,u,h,p){if(h-u<=o)return;const m=u+h>>1;bB(i,n,m,u,h,p),P3(i,n,o,u,m-1,1-p),P3(i,n,o,m+1,h,1-p)}function bB(i,n,o,u,h,p){for(;h>u;){if(h-u>600){const E=h-u+1,C=o-u+1,P=Math.log(E),M=.5*Math.exp(2*P/3),z=.5*Math.sqrt(P*M*(E-M)/E)*(C-E/2<0?-1:1);bB(i,n,o,Math.max(u,Math.floor(o-C*M/E+z)),Math.min(h,Math.floor(o+(E-C)*M/E+z)),p)}const m=n[2*o+p];let v=u,w=h;for(Nv(i,n,u,o),n[2*h+p]>m&&Nv(i,n,u,h);v<w;){for(Nv(i,n,v,w),v++,w--;n[2*v+p]<m;)v++;for(;n[2*w+p]>m;)w--}n[2*u+p]===m?Nv(i,n,u,w):(w++,Nv(i,n,w,h)),w<=o&&(u=w+1),o<=w&&(h=w-1)}}function Nv(i,n,o,u){R3(i,o,u),R3(n,2*o,2*u),R3(n,2*o+1,2*u+1)}function R3(i,n,o){const u=i[n];i[n]=i[o],i[o]=u}function wB(i,n,o,u){const h=i-o,p=n-u;return h*h+p*p}a.A=Bg,a.B=Mp,a.C=Ir,a.D=Pp,a.E=uh,a.F=qo,a.H=bc,a.I=Hp,a.J=B,a.K=A,a.L=function(i){const n=i.value;let o=[];if(!n)return o;const u=cu(n);return u!=="string"?(o=o.concat([new _T(i.key,n,`string expected, "${u}" found`)]),o):(YF(n,!0)||(o=o.concat([new _T(i.key,n,`invalid url "${n}"`)])),o)},a.M=class{constructor(i,n,o,u){this.id=i,this.position=n!=null?new Er(n[0],n[1]):new Er(0,0),this.orientation=o!=null?o:[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,n){if(a.ae.multiply(i.matrix,n,i.matrix),i.meshes)for(const o of i.meshes){const u=gi.applyTransformFast(o.aabb,i.matrix);this.aabb.encapsulate(u)}if(i.children)for(const o of i.children)this._applyTransformations(o,i.matrix)}computeBoundsAndApplyParent(){const i=a.ae.identity([]);for(const n of this.nodes)this._applyTransformations(n,i)}computeModelMatrix(i,n,o,u,h,p,m=!1){rB(this.matrix,this,i.transform,this.position,n,o,u,h,p,m)}upload(i){if(!this.uploaded){for(const n of this.nodes)x3(n,i);for(const n of this.nodes)yT(n);this.uploaded=!0}}destroy(){for(const i of this.nodes)b3(i)}},a.N=tt,a.O=co,a.P=Ft,a.Q=ks,a.R=up,a.S=uP,a.T=Ll,a.U=Wr,a.V=_T,a.W=Rt,a.X=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return fc(i.expression.evaluate(n))}interpolate(i,n,o){return{x:Tn(i.x,n.x,o),y:Tn(i.y,n.y,o),z:Tn(i.z,n.z,o),azimuthal:Tn(i.azimuthal,n.azimuthal,o),polar:Tn(i.polar,n.polar,o)}}},a.Y=Mn,a.Z=Ce,a._=To,a.a=Oa,a.a$=MP,a.a0=aa,a.a1=Js,a.a2=Eh,a.a3=Tn,a.a4=zt,a.a5=A0,a.a6=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return function([o,u]){const h=fc([1,o,u]);return{x:h.x,y:h.y,z:h.z}}(i.expression.evaluate(n))}interpolate(i,n,o){return{x:Tn(i.x,n.x,o),y:Tn(i.y,n.y,o),z:Tn(i.z,n.z,o)}}},a.a7=ev,a.a8=Sw,a.a9=xh,a.aA=function(i,n,o){i[4*n+0]=o[0],i[4*n+1]=o[1],i[4*n+2]=o[2],i[4*n+3]=o[3]},a.aC=function(i,n){const{x:o,y:u}=i.point,h=fz(o,u,i.worldSize/i._pixelsPerMercatorPixel,0,0);return a.ae.multiply(h,h,LP(_u(n)))},a.aE=u_,a.aF=sl,a.aG=Kw,a.aH=function(i,n,o,u,h){const p=5*n+2;i.float32[p+0]=o,i.float32[p+1]=u,i.float32[p+2]=h},a.aI=aT,a.aJ=Er,a.aK=pF,a.aL=$L,a.aM=kP,a.aN=HF,a.aO=Vp,a.aP=uz,a.aQ=ws,a.aR=function(i,n,o,u,h,p,m,v,w){if(w.name==="globe")return uz(i,n,new Vp(o,u,h),!1);const E=Wp({z:o,x:u,y:h},w);return new gi([(p+E.x/E.scale)*n,n*(E.y/E.scale),m],[(p+E.x2/E.scale)*n,n*(E.y2/E.scale),v])},a.aS=function(i,n,o){let u=0;for(let h=0;h<2;++h)i[h]>0&&(u+=(i[h]-0)*(i[h]-0)),n[h]<0&&(u+=(0-n[h])*(0-n[h]));return u},a.aT=Zi,a.aU=RP,a.aV=UL,a.aW=function(i){const n=a.ae.identity(new Float64Array(16));a.ae.multiply(n,i.pixelMatrix,i.globeMatrix);const o=[0,Dl,0],u=[0,Ol,0];return a.$.transformMat4(o,o,n),a.$.transformMat4(u,u,n),[o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!NP(i,new Er(i.center.lat,90)),u[0]>0&&u[0]<=i.width&&u[1]>0&&u[1]<=i.height&&!NP(i,new Er(i.center.lat,-90))]},a.aX=function(i,n){const{scale:o}=i.tileTransform,u=o*zt/(i.tileSize*Math.pow(2,n.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return a.aD.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[u,u])},a.aY=mT,a.aZ=WF,a.a_=function(i){const n=WF(i,!0);return a.aD.invert([],[n[0],n[1],n[4],n[5]])},a.aa=BL,a.ab=Go,a.ac=sr,a.ad=function(i,n,o){const u=Math.sqrt(i*i+n*n+o*o),h=u>0?Math.acos(o/u)*pi:0;let p=i!==0||n!==0?Math.atan2(-n,-i)*pi+90:0;return p<0&&(p+=360),[u,p,h]},a.af=g_,a.ag=Ac,a.ah=a3,a.ai=function(i,n){const o={};for(let u=0;u<n.length;u++){const h=n[u];h in i&&(o[h]=i[h])}return o},a.aj=Vd,a.ak=mu,a.al=gu,a.am=wL,a.an=function(i){xg++,xg>Ls&&(i.getActor().send("enforceCacheSizeLimit",Os),xg=0)},a.ao=T0,a.ap=class{constructor(i){this.entries={},this.scheduler=i}request(i,n,o,u){const h=this.entries[i]=this.entries[i]||{callbacks:[]};if(h.result){const[p,m]=h.result;return this.scheduler?this.scheduler.add(()=>{u(p,m)},n):u(p,m),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=o((p,m)=>{h.result=[p,m];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,m)},n):v(p,m);setTimeout(()=>delete this.entries[i],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==u),h.callbacks.length||(h.cancel(),delete this.entries[i]))}}},a.aq=function(i,n,o){const u=JSON.stringify(i.request);return i.data&&(this.deduped.entries[u]={result:[null,i.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const p=oh(i.request,(m,v,w,E)=>{m?h(m):v&&h(null,{vectorTile:o?void 0:new qP(new mv(v)),rawData:v,cacheControl:w,expires:E})});return()=>{p.cancel(),h()}},n)},a.ar=pP,a.as=class extends vh{constructor(i){super(i),this.current=uK}set(i,n,o){if(this.fetchUniformLocation(i,n)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},a.at=mP,a.au=Yn,a.av=cc,a.ax=R,a.ay=Ho,a.az=eo,a.b=Ei,a.b$=yK,a.b0=function(i){const{x:n,y:o}=i.point,{lng:u,lat:h}=i._center;return fz(n,o,i.worldSize,u,h)},a.b1=oo,a.b2=n_,a.b3=yP,a.b4=function(i){const n=Math.round((i+45+360)%360/90)%4;return ru[n]},a.b5=45,a.b6=bP,a.b7=Iw,a.b8=gi,a.b9=fc,a.bA=hT,a.bB=wz,a.bC=function(i,n){return[Math.pow(i[0],2.2)*n,Math.pow(i[1],2.2)*n,Math.pow(i[2],2.2)*n]},a.bD=IN,a.bF=dz,a.bG=mt,a.bH=De,a.bI=256,a.bJ=function(i,n){const o=[0,0,0],u=sv(_u(n.canonical));return a.$.transformMat4(o,o,u),a.$.transformMat4(o,o,i),o},a.bK=i=>({u_camera_to_center_distance:new Go(i),u_extrude_scale:new gP(i),u_device_pixel_ratio:new Go(i),u_matrix:new ev(i),u_inv_rot_matrix:new ev(i),u_merc_center:new xh(i),u_tile_id:new pP(i),u_zoom_transition:new Go(i),u_up_dir:new pP(i),u_emissive_strength:new Go(i)}),a.bL=i=>({u_matrix:new ev(i),u_pixels_to_tile_units:new gP(i),u_device_pixel_ratio:new Go(i),u_units_to_pixels:new xh(i),u_dash_image:new Sw(i),u_gradient_image:new Sw(i),u_image_height:new Go(i),u_texsize:new xh(i),u_tile_units_to_pixels:new Go(i),u_alpha_discard_threshold:new Go(i),u_trim_offset:new xh(i),u_trim_fade_range:new xh(i),u_trim_color:new mP(i),u_emissive_strength:new Go(i)}),a.bM=i=>({u_matrix:new ev(i),u_texsize:new xh(i),u_pixels_to_tile_units:new gP(i),u_device_pixel_ratio:new Go(i),u_image:new Sw(i),u_units_to_pixels:new xh(i),u_tile_units_to_pixels:new Go(i),u_alpha_discard_threshold:new Go(i),u_trim_offset:new xh(i)}),a.bN=rP,a.bO=DQ,a.bP=fo,a.bQ=KQ,a.bR=sF,a.bS=YP,a.bT=gz,a.bU=(i,n,o,u,h,p)=>{const m=i.transform,v=m.projection.name==="globe";let w;if(p.paint.get("circle-pitch-alignment")==="map")if(v){const C=dz(m.zoom,n.canonical)*m._pixelsPerMercatorPixel;w=Float32Array.from([C,0,0,C])}else w=m.calculatePixelsToTileUnitsMatrix(o);else w=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(m.projection),u_matrix:i.translatePosMatrix(n.projMatrix,o,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:rn.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:kK,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){E.u_inv_rot_matrix=u,E.u_merc_center=h,E.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],E.u_zoom_transition=Eh(m.zoom);const C=h[0]*zt,P=h[1]*zt;E.u_up_dir=m.projection.upVector(new Vp(0,0,0),C,P)}return E},a.bV=PN,a.bW=(i,n,o,u,h,p)=>{const m=i.transform;return{u_matrix:AN(i,n,o,u),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:CN(n,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p}},a.bX=(i,n,o,u,h,p,m)=>{const v=i.transform,w=v.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:AN(i,n,o,u),u_pixels_to_tile_units:w,u_device_pixel_ratio:p,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:RN(o)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:CN(n,i.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength")}},a.bY=Pa,a.bZ=ov,a.b_=pN,a.ba=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},a.bb=nh,a.bc=function(i,n,o){const u=Eh(o.zoom),h=i.style.map._antialias,p=n.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return u===0&&!h&&!p},a.bd=function(i){const n=i.pixelsPerMeter,o=n/Ho(1,i.center.lat),u=a.ae.identity(new Float64Array(16));return a.ae.translate(u,u,[i.point.x,i.point.y,0]),a.ae.scale(u,u,[o,o,n]),Float32Array.from(u)},a.be=kw,a.bf=function(i){const n=Zi-5;i=Yn(i,-n,n)/n*90;const o=Math.pow(Math.abs(Math.sin(sr(i))),3);return Math.round(o*(vP.length-1))},a.bg=function(i,n,o,u){const h=n.getNorth(),p=n.getSouth(),m=n.getWest(),v=n.getEast(),w=1<<i.z,E=v-m,C=h-p,P=E/Jg,M=-C/vP[o],z=[0,P,0,M,0,0,h,m,0];if(i.z>0){const j=180/u;a.bE.multiply(z,z,[j/E+1,0,0,0,j/C+1,0,-.5*j/P,.5*j/M,1])}return z[2]=w,z[5]=i.x,z[8]=i.y,z},a.bh=sv,a.bi=_u,a.bj=function(i,n,o){const u=a.ae.identity(new Float64Array(16)),h=(n/(1<<i)-.5)*Math.PI*2;return a.ae.rotateY(u,o.globeMatrix,h),Float32Array.from(u)},a.bk=kt,a.bl=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.bm=BF,a.bn=GF,a.bo=FF,a.bp=function(i,n){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let u=0;u<i.length;u++){const h=document.createElement("source");EA(i[u])||(o.crossOrigin="Anonymous"),h.src=i[u],o.appendChild(h)}return{cancel:()=>{}}},a.bq=lT,a.br=sh,a.bs=class{isDataAvailableAtPoint(i){const n=this._source();if(this.isUsingMockSource()||!n||i.y<0||i.y>1)return!1;const o=n.getSource().maxzoom,u=1<<o,h=Math.floor(i.x),p=Math.floor((i.x-h)*u),m=Math.floor(i.y*u),v=this.findDEMTileFor(new ws(o,h,o,p,m));return!(!v||!v.dem)}getAtPointOrZero(i,n=0){return this.getAtPoint(i,n)||0}getAtPoint(i,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const u=this._source();if(!u||i.y<0||i.y>1)return n;const h=u.getSource().maxzoom,p=1<<h,m=Math.floor(i.x),v=i.x-m,w=new ws(h,m,h,Math.floor(v*p),Math.floor(i.y*p)),E=this.findDEMTileFor(w);if(!E||!E.dem)return n;const C=E.dem,P=1<<E.tileID.canonical.z,M=(v*P-E.tileID.canonical.x)*C.dim,z=(i.y*P-E.tileID.canonical.y)*C.dim,j=Math.floor(M),V=Math.floor(z);return(o?this.exaggeration():1)*Tn(Tn(C.get(j,V),C.get(j,V+1),z-V),Tn(C.get(j+1,V),C.get(j+1,V+1),z-V),M-j)}getAtTileOffset(i,n,o){const u=1<<i.canonical.z;return this.getAtPointOrZero(new To(i.wrap+(i.canonical.x+n/zt)/u,(i.canonical.y+o/zt)/u))}getAtTileOffsetFunc(i,n,o,u){return h=>{const p=this.getAtTileOffset(i,h.x,h.y),m=u.upVector(i.canonical,h.x,h.y),v=u.upVectorScale(i.canonical,n,o).metersToTile;return a.$.scale(m,m,p*v),m}}getForTilePoints(i,n,o,u){if(this.isUsingMockSource())return!1;const h=a_.create(this,i,u);return!!h&&(n.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],o)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(i);if(!n||!n.dem)return null;const o=n.dem.tree,u=n.tileID,h=1<<i.canonical.z-u.canonical.z;let p=i.canonical.x/h-u.canonical.x,m=i.canonical.y/h-u.canonical.y,v=0;for(let w=0;w<i.canonical.z-u.canonical.z&&!o.leaves[v];w++){p*=2,m*=2;const E=2*Math.floor(m)+Math.floor(p);v=o.childOffsets[v]+E,p%=1,m%=1}return{min:this.exaggeration()*o.minimums[v],max:this.exaggeration()*o.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const i=this.visibleDemTiles;if(i.length===0)return null;let n=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of i){const p=this.getMinMaxForTile(h.tileID);p&&(o=Math.min(o,p.min),u=Math.max(u,p.max),n=!0)}return n?{min:o,max:u}:null}},a.bt=rv,a.bu=Mw,a.bv=Tc,a.bw=Gs,a.bx=Zp,a.by=v_,a.bz=vT,a.c=pB,a.c$=function(i,n,o,u){return i.type==="custom"?new eJ(i,n):new SJ[i.type](i,n,o,u)},a.c0=Ww,a.c1=Wd,a.c2=450,a.c3=7,a.c4=JY,a.c5=IF,a.c6=256,a.c7=lz,a.c8=LP,a.c9=kr,a.cA=YL,a.cB=function(i,n,o=0){return a.$.fromValues(((n.x-o)*i.scale-i.x)*zt,(n.y*i.scale-i.y)*zt,qL(n.z,n.y))},a.cC=function(i){let n=1/0,o=1/0,u=-1/0,h=-1/0;for(const p of i)n=Math.min(n,p.x),o=Math.min(o,p.y),u=Math.max(u,p.x),h=Math.max(h,p.y);return{min:new Ft(n,o),max:new Ft(u,h)}},a.cD=$d,a.cE=HL,a.cF=Wo,a.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.cH=YN,a.cI=IP,a.cJ=Vz,a.cK=Hz,a.cL=Zz,a.cM=n3,a.cN=A3,a.cO=function(i){return i({pluginStatus:jr,pluginURL:_r}),rr.on("pluginStateChange",i),i},a.cP=d_,a.cQ=e3,a.cR=v0,a.cS=Br,a.cT=H,a.cU=xs,a.cV=Eg,a.cW=$s,a.cX=function(i){const n=i.indexOf(yw);return n>=0?i.slice(0,n):i},a.cY=function(i){return i.indexOf(yw)>=0},a.cZ=function(i){const n=i.indexOf(yw);return n>=0?i.slice(n+1):""},a.c_=function(i){const n=[],o=i.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},a.ca=Nd,a.cb=Bp,a.cc=1,a.cd=Ev,a.ce=0,a.cf=aP,a.cg=function(i,n,o,u,h){return Yn((i-n)/(o-n)*(h-u)+u,u,h)},a.ch=mw,a.ci=$p,a.cj=class{constructor(i,n,o,u){this.context=i,this.format=u,this.size=o,this.texture=i.gl.createTexture();const[h,p,m]=this.size,{gl:v}=i;v.bindTexture(v.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1);let w=this.format,E=v.UNSIGNED_BYTE;this.format===v.DEPTH_COMPONENT&&(w=v.DEPTH_COMPONENT16,E=v.UNSIGNED_SHORT),this.format===v.R8&&(u=v.RED),this.format===v.R32F&&(E=v.FLOAT,u=v.RED),v.texImage3D(v.TEXTURE_3D,0,w,h,p,m,0,u,E,n.data)}bind(i,n){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),i!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,i),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,i),this.minFilter=i),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},a.ck=y3,a.cl=[1,1,1],a.cm=a_,a.cn=y_,a.co=Bd,a.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ft(1/0,1/0),max:new Ft(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,n=!1){const o=qz(new Ft(0,0),new Ft(zt,zt),i),u=[];if(n&&!GP(o,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!GP(o,h))continue;const p=lQ(h.min,h.max,i);u.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(i){this._setSources(i.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const o=[];for(const u of n.cache.getVisibleCoordinates()){const h=n.cache.getTile(u).buckets[n.layer];h&&h.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(i){const n=i.getFootprints();if(n.length===0)return;const o=i.getOrder(),u=i.getClipMask(),h=i.getClipScope();for(const p of n){if(!p.footprint)continue;const m=qz(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:o,clipMask:u,clipScope:h})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,o)=>n.priority-o.priority||$w(n.min,o.min)||$w(n.max,o.max)||n.order-o.order||n.clipMask-o.clipMask||function(u,h){const p=(m,v)=>m+v;return u.length-h.length||u.reduce(p,"").localeCompare(h.reduce(p,""))}(n.clipScope,o.clipScope));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let n=0;for(;!i&&n!==this._activeRegions.length;){const o=this._activeRegions[n],u=this._prevRegions[n];i=o.priority!==u.priority||!$z(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!lc(o.clipScope,u.clipScope),++n}}if(i){++this._updateTime;for(const o of this._activeRegions)o.order!==Vw&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const n=o=>{const u=this._activeRegions;if(o>=u.length)return o;const h=u[o].priority;for(;o<u.length&&u[o].priority===h;)++o;return o};if(this._sourceIds.length>1){let o=0,u=n(o);for(;o!==u;){let h=o;const p=o;for(;h!==u;){const m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let v=0;v<p;v++){const w=this._activeRegions[v];if(!w.hiddenByOverlap&&m.order===Vw&&GP(m,w)&&(m.hiddenByOverlap=Wz(m.footprint,m.tileId,w.footprint,w.tileId),m.hiddenByOverlap))break}++h}o=u,u=n(o)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=i.length-1;n>=0;n--)this._addSource(i[n]);this._computeReplacement()}},a.cq=yh,a.cr=uT,a.cs=Q0,a.ct=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,n){const o=new Tc,u=new Gs,h=[],p=i+1+2,m=n[0]+1,v=n[0]+1+(1+n.length),w=(E,C,P)=>{let M=E===p-1?E-2:E===0?E:E-1;return M+=P?24575:0,[M,C]};for(let E=0;E<p;++E)o.emplaceBack(...w(E,0,!0));for(let E=0;E<m;++E)for(let C=0;C<p;++C)o.emplaceBack(...w(C,E,(C===0||C===p-1)&&!0));for(let E=0;E<n.length;++E){const C=n[E];for(let P=0;P<p;++P)o.emplaceBack(...w(P,C,!0))}for(let E=0;E<n.length;++E){const C=u.length,P=n[E]+1+2,M=new Gs;for(let V=0;V<P-1;V++){const $=V===P-2,Y=$?p*(v-n.length+E-V):p;for(let me=0;me<p-1;me++){const pe=V*p+me;V===0||$||me===0||me===p-2?(M.emplaceBack(pe+1,pe,pe+Y),M.emplaceBack(pe+Y,pe+Y+1,pe+1)):(u.emplaceBack(pe+1,pe,pe+Y),u.emplaceBack(pe+Y,pe+Y+1,pe+1))}}const z=Ei.simpleSegment(0,C,o.length,u.length-C);for(let V=0;V<M.uint16.length;V+=3)u.emplaceBack(M.uint16[V],M.uint16[V+1],M.uint16[V+2]);const j=Ei.simpleSegment(0,C,o.length,u.length-C);h.push({withoutSkirts:z,withSkirts:j})}return{vertices:o,indices:u,segments:h}}_createGrid(i){const n=this._fillGridMeshWithLods(Jg,vP);this._gridSegments=n.segments,this._gridBuffer=i.createVertexBuffer(n.vertices,rv.members),this._gridIndexBuffer=i.createIndexBuffer(n.indices,!0)}_createPoles(i){const n=new Gs;for(let m=0;m<=Jg;m++)n.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=i.createIndexBuffer(n,!0);const o=new Bp,u=new Bp,h=new Bp,p=new Bp;this._poleSegments=[];for(let m=0,v=0;m<yP;m++){const w=360/(1<<m);o.emplaceBack(0,-Wo,0,.5,0),u.emplaceBack(0,-Wo,0,.5,1),h.emplaceBack(0,-Wo,0,.5,.5),p.emplaceBack(0,-Wo,0,.5,.5);for(let E=0;E<=Jg;E++){let C=E/Jg,P=0;const M=Tn(0,w,C),[z,j,V]=e_(RK,MK,M,Wo);o.emplaceBack(z,j,V,C,P),u.emplaceBack(z,j,V,C,1-P);const $=sr(M);C=.5+.5*Math.sin($),P=.5+.5*Math.cos($),h.emplaceBack(z,j,V,C,P),p.emplaceBack(z,j,V,C,1-P)}this._poleSegments.push(Ei.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(o,Rw,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(u,Rw,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(h,Rw,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(p,Rw,!1)}getGridBuffers(i,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},a.cu=function(i){return mp.has(i)},a.cv=Vw,a.cw=nN,a.cx=function(i,n,o=0,u=!0){const h=new Ft(o,o),p=i.sub(h),m=n.add(h),v=[p,new Ft(m.x,p.y),m,new Ft(p.x,m.y)];return u&&v.push(p.clone()),v},a.cy=function(i,n){const o=[];for(let u=0;u<i.length;u++){const h=cc(u-1,-1,i.length-1),p=cc(u+1,-1,i.length-1),m=i[u],v=i[p],w=i[h].sub(m).unit(),E=v.sub(m).unit(),C=E.angleWithSep(w.x,w.y),P=w.add(E).unit().mult(-1*n/Math.sin(C/2));o.push(m.add(P))}return o},a.cz=cF,a.d=lc,a.d$=Av,a.d0=Ds,a.d1=rr,a.d2=Pl,a.d3=rh,a.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.d5=xo,a.d6=WL,a.d7=Up,a.d8=function([i,n,o]){const u=Math.hypot(i,n,o),h=Math.atan2(i,o),p=.5*Math.PI-Math.acos(-n/u);return new Er(oo(h),oo(p))},a.d9=ya,a.dA=function(){vT().acquire(w3)},a.dB=function(){const i=Ov;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(w3),Ov=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.dC=Dv,a.dD=function(i){const n=xd();if(!n)return;const o=n.delete(Gr);i&&o.catch(i).then(()=>i())},a.dE=kv,a.dF=sB,a.dG=function(i){T3=rn.resolveURL(i),b_||(b_=new v_(vT(),new uh)),b_.broadcast("setDracoUrl",T3)},a.dH=oB,a.dI=function(i){x_=rn.resolveURL(i),b_||(b_=new v_(vT(),new uh)),b_.broadcast("setMeshoptUrl",x_)},a.dJ=uc,a.dK=qe,a.dL=qd,a.dM=Cc,a.dN=Wp,a.dO=dP,a.dP=MN,a.dQ=FN,a.dR=wN,a.dS=iu,a.dT=eF,a.dU=m_,a.dV=function(i,n,o,u,h,p,m,v,w,E,C){i.createArrays(),i.tilePixelRatio=zt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const P=i.layers[0].layout,M=i.layers[0]._unevaluatedLayout._values,z={};if(i.textSizeData.kind==="composite"){const{minZoom:Y,maxZoom:me}=i.textSizeData;z.compositeTextSizes=[M["text-size"].possiblyEvaluate(new Mn(Y),v),M["text-size"].possiblyEvaluate(new Mn(me),v)]}if(i.iconSizeData.kind==="composite"){const{minZoom:Y,maxZoom:me}=i.iconSizeData;z.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new Mn(Y),v),M["icon-size"].possiblyEvaluate(new Mn(me),v)]}z.layoutTextSize=M["text-size"].possiblyEvaluate(new Mn(w+1),v),z.layoutIconSize=M["icon-size"].possiblyEvaluate(new Mn(w+1),v),z.textMaxSize=M["text-size"].possiblyEvaluate(new Mn(18),v);const j=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",V=P.get("text-size");let $=!1;for(const Y of i.features)if(Y.icon&&Y.icon.nameSecondary){$=!0;break}for(const Y of i.features){const me=P.get("text-font").evaluate(Y,{},v).join(","),pe=V.evaluate(Y,{},v),ge=z.layoutTextSize.evaluate(Y,{},v),Pe=(z.layoutIconSize.evaluate(Y,{},v),{horizontal:{},vertical:void 0}),Re=Y.text;let ze,Ge=[0,0];if(Re){const Je=Re.toString(),ut=P.get("text-letter-spacing").evaluate(Y,{},v)*fo,Ct=P.get("text-line-height").evaluate(Y,{},v)*fo,ht=bt(Je)?ut:0,Mt=P.get("text-anchor").evaluate(Y,{},v),lt=P.get("text-variable-anchor");if(!lt){const Dt=P.get("text-radial-offset").evaluate(Y,{},v);Ge=Dt?sF(Mt,[Dt*fo,t3]):P.get("text-offset").evaluate(Y,{},v).map(Pt=>Pt*fo)}let xt=j?"center":P.get("text-justify").evaluate(Y,{},v);const Ot=P.get("symbol-placement")==="point",ft=Ot?P.get("text-max-width").evaluate(Y,{},v)*fo:1/0,jt=Dt=>{i.allowVerticalPlacement&&vt(Je)&&(Pe.vertical=QP(Re,n,o,h,me,ft,Ct,Mt,Dt,ht,Ge,sl.vertical,!0,ge,pe))};if(!j&&lt){const Dt=xt==="auto"?lt.map(vn=>n3(vn)):[xt];let Pt=!1;for(let vn=0;vn<Dt.length;vn++){const mn=Dt[vn];if(!Pe.horizontal[mn])if(Pt)Pe.horizontal[mn]=Pe.horizontal[0];else{const tn=QP(Re,n,o,h,me,ft,Ct,"center",mn,ht,Ge,sl.horizontal,!1,ge,pe);tn&&(Pe.horizontal[mn]=tn,Pt=tn.positionedLines.length===1)}}jt("left")}else{if(xt==="auto"&&(xt=n3(Mt)),Ot||P.get("text-writing-mode").indexOf("horizontal")>=0||!vt(Je)){const Dt=QP(Re,n,o,h,me,ft,Ct,Mt,xt,ht,Ge,sl.horizontal,!1,ge,pe);Dt&&(Pe.horizontal[xt]=Dt)}jt(Ot?"left":xt)}}let Ke=!1;if(Y.icon&&Y.icon.namePrimary){const Je=u[Y.icon.namePrimary];Je&&(ze=sY(h[Y.icon.namePrimary],Y.icon.nameSecondary?h[Y.icon.nameSecondary]:void 0,P.get("icon-offset").evaluate(Y,{},v),P.get("icon-anchor").evaluate(Y,{},v)),Ke=Je.sdf,i.sdfIcons===void 0?i.sdfIcons=Je.sdf:i.sdfIcons!==Je.sdf&&Pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Je.pixelRatio!==i.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const it=aF(Pe.horizontal)||Pe.vertical;i.iconsInText||(i.iconsInText=!!it&&it.iconsInText),(it||ze)&&dY(i,Y,Pe,ze,u,z,ge,0,Ge,Ke,m,v,E,C,$)}p&&i.generateCollisionDebugBuffers(w,i.collisionBoxArray)},a.dW=Hw,a.dX=Fw,a.dY=qP,a.dZ=mv,a.d_=qw,a.da=t_,a.db=O,a.dc=NP,a.dd=pz,a.de=function(i){const n=[0,0,0],o=a.ae.identity(new Float64Array(16));return a.ae.multiply(o,i.pixelMatrix,i.globeMatrix),a.$.transformMat4(n,n,o),new Ft(n[0],n[1])},a.df=X,a.dg=W,a.dh=function(i){const n=i.navigator?i.navigator.userAgent:null;return!!function(o){if(lu==null){const u=o.navigator?o.navigator.userAgent:null;lu=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return lu}(i)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.di=hc,a.dj=class{constructor(i,n,o){this._transformRequestFn=i,this._customAccessToken=n,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const i=function(){let n="";for(let o=0;o<10;o++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",x0,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,n){return this._transformRequestFn&&this._transformRequestFn(i,n)||{url:i}}normalizeStyleURL(i,n){if(!H(i))return i;const o=Ra(i);return o.params.push(`sdk=js-${I}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeGlyphsURL(i,n){if(!H(i))return i;const o=Ra(i);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeModelURL(i,n){if(!H(i))return i;const o=Ra(i);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeSourceURL(i,n,o,u){if(!H(i))return i;const h=Ra(i);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),o&&h.params.push(`language=${o}`),u&&h.params.push(`worldview=${u}`),this._makeAPIURL(h,this._customAccessToken||n)}normalizeSpriteURL(i,n,o,u){const h=Ra(i);return H(i)?(h.path=`/styles/v1${h.path}/sprite${n}${o}`,this._makeAPIURL(h,this._customAccessToken||u)):(h.path+=`${n}${o}`,ah(h))}normalizeTileURL(i,n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!H(i))return i;const u=Ra(i);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||o&&u.authority!=="raster"&&o===512?"@2x":""}${bg.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${O.RASTER_URL_PREFIX}${u.path}`:u.authority==="rasterarrays"?u.path=`/${O.RASTERARRAYS_URL_PREFIX}${u.path}`:u.authority==="3dtiles"?u.path=`/${O.TILES3D_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${O.TILE_URL_VERSION}${u.path}`);const h=this._customAccessToken||function(p){for(const m of p){const v=m.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(u.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,h)}canonicalizeTileURL(i,n){const o=Ra(i);if(!o.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!o.path.match(/\.[\w]+$/))return i;let u="mapbox://";o.path.match(/^\/raster\/v1\//)?u+=`raster/${o.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:o.path.match(/^\/rasterarrays\/v1\//)?u+=`rasterarrays/${o.path.replace(`/${O.RASTERARRAYS_URL_PREFIX}/`,"")}`:u+=`tiles/${o.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let h=o.params;return n&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(u+=`?${h.join("&")}`),u}canonicalizeTileset(i,n){const o=!!n&&H(n),u=[];for(const h of i.tiles||[])F(h)?u.push(this.canonicalizeTileURL(h,o)):u.push(h);return u}_makeAPIURL(i,n){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Ra(O.API_URL);if(i.protocol=u.protocol,i.authority=u.authority,i.protocol==="http"){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(u.path!=="/"&&(i.path=`${u.path}${i.path}`),!O.REQUIRE_ACCESS_TOKEN)return ah(i);if(n=n||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${n||""}`),ah(i)}},a.dk=function(i,n){n?mp.add(i):mp.delete(i)},a.dl=bg,a.dm=IA,a.dn=E0,a.dp=b0,a.dq=jb,a.dr=Ub,a.ds=function(i){mp.delete(i)},a.dt=pp,a.du=Td,a.dv=ih,a.dw=I,a.dx=function(i,n){Os=i,Ls=n},a.dy=function(i,n,o=!1){if(jr===In||jr===Xn||jr===pr)throw new Error("setRTLTextPlugin cannot be called multiple times.");_r=rn.resolveURL(i),jr=In,ei=n,Jn(),o||wr()},a.dz=Wn,a.e=rn,a.e0=jw,a.e1=Bw,a.e2=nu,a.e3=kN,a.e4=fe,a.e5=oh,a.e6=function(i){let n=0;if(new Uint32Array(i,0,1)[0]!==lB){const o=new Uint32Array(i,0,7),[,,u,h,p,m]=o;n=o.byteLength+h+p+m+p,(u!==i.byteLength||n>=i.byteLength)&&Pi("Invalid b3dm header information.")}return dB(i,n)},a.e7=function(i,n){const o=pB(i);for(const u of o){for(const h of u.meshes)bJ(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(wJ(u.lights,n)))}return o},a.e8=TT,a.e9=iB,a.ea=or,a.eb=function(i){lp(),fs&&fs.then(n=>{n.keys().then(o=>{for(let u=0;u<o.length-i;u++)n.delete(o[u])})})},a.f=gp,a.g=Rl,a.h=function(i,n){return Pl(ks(i,{type:"json"}),n)},a.i=dp,a.j=il,a.k=JN,a.l=function(i){return fetch(i).then(n=>n.arrayBuffer()).then(n=>dB(n,0,i))},a.m=JP,a.n=class extends _T{},a.o=cu,a.p=SY,a.q=Sd,a.r=S,a.s=L,a.t=k,a.u=xc,a.v=be,a.w=Pi,a.x=rl,a.y=Ae,a.z=ve}),_(["./shared"],function(a){function I(Ve){const ne=Ve?Ve.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function D(Ve){if(typeof Ve=="number"||typeof Ve=="boolean"||typeof Ve=="string"||Ve==null)return JSON.stringify(Ve);if(Array.isArray(Ve)){let le="[";for(const Te of Ve)le+=`${D(Te)},`;return`${le}]`}let ne="{";for(const le of Object.keys(Ve).sort())ne+=`${le}:${D(Ve[le])},`;return`${ne}}`}function O(Ve){let ne="";for(const le of a.cG)ne+=`/${D(Ve[le])}`;return ne}class F{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,le){this._layerConfigs={},this._layers={},this.update(ne,[],le)}update(ne,le,Te){this._options=Te;for(const Oe of ne)this._layerConfigs[Oe.id]=Oe,(this._layers[Oe.id]=a.c$(Oe,this.scope,null,this._options)).compileFilter(),this.keyCache[Oe.id]&&delete this.keyCache[Oe.id];for(const Oe of le)delete this.keyCache[Oe],delete this._layerConfigs[Oe],delete this._layers[Oe];this.familiesBySource={};const Le=function(Oe,He){const st={};for(let rt=0;rt<Oe.length;rt++){const wt=He&&He[Oe[rt].id]||O(Oe[rt]);He&&(He[Oe[rt].id]=wt);let Tt=st[wt];Tt||(Tt=st[wt]=[]),Tt.push(Oe[rt])}const We=[];for(const rt in st)We.push(st[rt]);return We}(a.dJ(this._layerConfigs),this.keyCache);for(const Oe of Le){const He=Oe.map(Qt=>this._layers[Qt.id]),st=He[0];if(st.visibility==="none")continue;const We=st.source||"";let rt=this.familiesBySource[We];rt||(rt=this.familiesBySource[We]={});const wt=st.sourceLayer||"_geojsonTileLayer";let Tt=rt[wt];Tt||(Tt=rt[wt]=[]),Tt.push(He)}}}const H=1*a.dM;class Q{constructor(ne){const le={},Te=[];for(const st in ne){const We=ne[st],rt=le[st]={};for(const wt in We.glyphs){const Tt=We.glyphs[+wt];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const Qt=Tt.metrics.localGlyph?H:1,_n={x:0,y:0,w:Tt.bitmap.width+2*Qt,h:Tt.bitmap.height+2*Qt};Te.push(_n),rt[wt]=_n}}const{w:Le,h:Oe}=a.k(Te),He=new a.dL({width:Le||1,height:Oe||1});for(const st in ne){const We=ne[st];for(const rt in We.glyphs){const wt=We.glyphs[+rt];if(!wt||wt.bitmap.width===0||wt.bitmap.height===0)continue;const Tt=le[st][rt],Qt=wt.metrics.localGlyph?H:1;a.dL.copy(wt.bitmap,He,{x:0,y:0},{x:Tt.x+Qt,y:Tt.y+Qt},wt.bitmap)}}this.image=He,this.positions=le}}a.dK(Q,"GlyphAtlas");class ie{constructor(ne){this.tileID=new a.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=a.dN(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep}parse(ne,le,Te,Le,Oe){this.status="parsing",this.data=ne,this.collisionBoxArray=new a.dO;const He=new a.dP(Object.keys(ne.layers).sort()),st=new a.dQ(this.tileID,this.promoteId);st.bucketLayerIDs=[];const We={},rt=new a.dR(256,256),wt={featureIndex:st,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:rt,availableImages:Te,brightness:this.brightness},Tt=le.familiesBySource[this.source];for(const dn in Tt){const Jr=ne.layers[dn];if(!Jr)continue;let vr=!1,dr=!1,wi=!1;for(const Ms of Tt[dn])Ms[0].type==="symbol"?vr=!0:dr=!0,Ms[0].is3D()&&Ms[0].type!=="model"&&(wi=!0);if(this.extraShadowCaster&&!wi||this.isSymbolTile===!0&&!vr||this.isSymbolTile===!1&&!dr)continue;Jr.version===1&&a.w(`Vector tile source "${this.source}" layer "${dn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ti=He.encode(dn),Yi=[];for(let Ms=0;Ms<Jr.length;Ms++){const Qs=Jr.feature(Ms),sc=st.getId(Qs,dn);Yi.push({feature:Qs,id:sc,index:Ms,sourceLayerIndex:Ti})}for(const Ms of Tt[dn]){const Qs=Ms[0];(!this.extraShadowCaster||Qs.is3D()&&Qs.type!=="model")&&(this.isSymbolTile!==void 0&&Qs.type==="symbol"!==this.isSymbolTile||Qs.minzoom&&this.zoom<Math.floor(Qs.minzoom)||Qs.maxzoom&&this.zoom>=Qs.maxzoom||Qs.visibility!=="none"&&(te(Ms,this.zoom,wt.brightness,Te),(We[Qs.id]=Qs.createBucket({index:st.bucketLayerIDs.length,layers:Ms,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ti,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Yi,wt,this.tileID.canonical,this.tileTransform),st.bucketLayerIDs.push(Ms.map(sc=>sc.id))))}}let Qt,_n,Cn,ur;rt.trim();const Dn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},hr=()=>{if(Qt)return this.status="done",Oe(Qt);if(this.extraShadowCaster)this.status="done",Oe(null,{buckets:a.dJ(We).filter(dn=>!dn.isEmpty()),featureIndex:st,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:wt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(_n&&Cn&&ur){const dn=new Q(_n),Jr=new a.dT(Cn,ur,this.lut);for(const vr in We){const dr=We[vr];dr instanceof a.dU?(te(dr.layers,this.zoom,wt.brightness,Te),a.dV(dr,_n,dn.positions,Cn,Jr.iconPositions,this.showCollisionBoxes,Te,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):dr.hasPattern&&(dr instanceof a.dW||dr instanceof a.dX||dr instanceof a.c0)&&(te(dr.layers,this.zoom,wt.brightness,Te),dr.addFeatures(wt,this.tileID.canonical,Jr.patternPositions,Te,this.tileTransform,this.brightness))}this.status="done",Oe(null,{buckets:a.dJ(We).filter(vr=>!vr.isEmpty()),featureIndex:st,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dn.image,lineAtlas:rt,imageAtlas:Jr,brightness:wt.brightness})}};if(!this.extraShadowCaster){const dn=a.dS(wt.glyphDependencies,dr=>Object.keys(dr).map(Number));Object.keys(dn).length?Le.send("getGlyphs",{uid:this.uid,stacks:dn,scope:this.scope},(dr,wi)=>{Qt||(Qt=dr,_n=wi,hr())},void 0,!1,Dn):_n={};const Jr=Object.keys(wt.iconDependencies);Jr.length?Le.send("getImages",{icons:Jr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(dr,wi)=>{Qt||(Qt=dr,Cn=wi,hr())},void 0,!1,Dn):Cn={};const vr=Object.keys(wt.patternDependencies);vr.length?Le.send("getImages",{icons:vr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(dr,wi)=>{Qt||(Qt=dr,ur=wi,hr())},void 0,!1,Dn):ur={}}hr()}}function te(Ve,ne,le,Te){const Le=new a.Y(ne,{brightness:le});for(const Oe of Ve)Oe.recalculate(Le,Te)}class W extends a.E{constructor(ne,le,Te,Le,Oe,He){super(),this.actor=ne,this.layerIndex=le,this.availableImages=Te,this.loadVectorData=Oe||a.aq,this.loading={},this.loaded={},this.deduped=new a.ap(ne.scheduler),this.isSpriteLoaded=Le,this.scheduler=ne.scheduler,this.brightness=He}loadTile(ne,le){const Te=ne.uid,Le=ne&&ne.request,Oe=Le&&Le.collectResourceTiming,He=this.loading[Te]=new ie(ne);He.abort=this.loadVectorData(ne,(st,We)=>{const rt=!this.loading[Te];if(delete this.loading[Te],rt||st||!We)return He.status="done",rt||(this.loaded[Te]=He),le(st);const wt=We.rawData,Tt={};We.expires&&(Tt.expires=We.expires),We.cacheControl&&(Tt.cacheControl=We.cacheControl),He.vectorTile=We.vectorTile||new a.dY(new a.dZ(wt));const Qt=()=>{He.parse(He.vectorTile,this.layerIndex,this.availableImages,this.actor,(_n,Cn)=>{if(_n||!Cn)return le(_n);const ur={};if(Oe){const Dn=I(Le);Dn.length>0&&(ur.resourceTiming=JSON.parse(JSON.stringify(Dn)))}le(null,a.Q({rawTileData:wt.slice(0)},Cn,Tt,ur))})};this.isSpriteLoaded?Qt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Qt,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):Qt()}),this.loaded=this.loaded||{},this.loaded[Te]=He})}reloadTile(ne,le){const Te=this.loaded,Le=ne.uid;if(Te&&Te[Le]){const Oe=Te[Le];Oe.showCollisionBoxes=ne.showCollisionBoxes,Oe.projection=ne.projection,Oe.brightness=ne.brightness,Oe.tileTransform=a.dN(ne.tileID.canonical,ne.projection),Oe.extraShadowCaster=ne.extraShadowCaster,Oe.lut=ne.lut;const He=(st,We)=>{const rt=Oe.reloadCallback;rt&&(delete Oe.reloadCallback,Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,rt)),le(st,We)};Oe.status==="parsing"?Oe.reloadCallback=He:Oe.status==="done"&&(Oe.vectorTile?Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,He):He())}else le(null,void 0)}abortTile(ne,le){const Te=ne.uid,Le=this.loading[Te];Le&&(Le.abort&&Le.abort(),delete this.loading[Te]),le()}removeTile(ne,le){const Te=this.loaded,Le=ne.uid;Te&&Te[Le]&&delete Te[Le],le()}}class X{loadTile(ne,le){const{uid:Te,encoding:Le,rawImageData:Oe,padding:He}=ne,st=ImageBitmap&&Oe instanceof ImageBitmap?this.getImageData(Oe,He):Oe;le(null,new a.d_(Te,st,Le,He<1))}getImageData(ne,le){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const Te=this.offscreenCanvasContext.getImageData(-le,-le,ne.width+2*le,ne.height+2*le);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Te}}a.d$.setPbf(a.dZ);class ee{decodeRasterArray({task:ne,buffer:le},Te){a.d$.performDecoding(le,ne).then(Le=>{Te(null,Le)},Le=>{Te(Le)})}}const fe=a.e0.prototype.toGeoJSON;let ye=class{constructor(Ve){this._feature=Ve,this.extent=a.a4,this.type=Ve.type,this.properties=Ve.tags,"id"in Ve&&!isNaN(Ve.id)&&(this.id=parseInt(Ve.id,10))}loadGeometry(){if(this._feature.type===1){const Ve=[];for(const ne of this._feature.geometry)Ve.push([new a.P(ne[0],ne[1])]);return Ve}{const Ve=[];for(const ne of this._feature.geometry){const le=[];for(const Te of ne)le.push(new a.P(Te[0],Te[1]));Ve.push(le)}return Ve}}toGeoJSON(Ve,ne,le){return fe.call(this,Ve,ne,le)}},Ee=class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.a4,this.length=Ve.length,this._features=Ve}feature(Ve){return new ye(this._features[Ve])}};const re=64/4096,he=128;class _e{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],le){for(const Te of ne){const Le=Te.id;if(Le==null)continue;let Oe=this.features.get(Le);Oe&&this.updateCache(Oe,le),Te.geometry?(Oe=J(Te),this.updateCache(Oe,le),this.features.set(Le,Oe)):this.features.delete(Le),this.updateCache(Oe,le)}}updateCache(ne,le){for(const{canonical:Te,uid:Le}of Object.values(le)){const{z:Oe,x:He,y:st}=Te;Se(ne,Math.pow(2,Oe),He,st)&&delete le[Le]}}getTile(ne,le,Te){const Le=Math.pow(2,ne),Oe=[];for(const He of this.features.values())Se(He,Le,le,Te)&&Oe.push(Gt(He,Le,le,Te));return{features:Oe}}getFeatures(){return[...this.features.values()]}}function Se({minX:Ve,minY:ne,maxX:le,maxY:Te},Le,Oe,He){return Ve<(Oe+1+re)/Le&&ne<(He+1+re)/Le&&le>(Oe-re)/Le&&Te>(He-re)/Le}function J(Ve){const{id:ne,geometry:le,properties:Te}=Ve;if(!le)return;if(le.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Le,coordinates:Oe}=le,He={id:ne,type:1,geometry:[],tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},st=He.geometry;if(Le==="Point")Ie(Oe,st,He);else if(Le==="MultiPoint")for(const We of Oe)Ie(We,st,He);else if(Le==="LineString")He.type=2,we(Oe,st,He);else if(Le==="MultiLineString")He.type=2,Lt(Oe,st,He);else if(Le==="Polygon")He.type=3,Lt(Oe,st,He,!0);else{if(Le!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");He.type=3;for(const We of Oe)Lt(We,st,He,!0)}return He}function Ie([Ve,ne],le,Te){const Le=a.ak(Ve);let Oe=a.al(ne);Oe=Oe<0?0:Oe>1?1:Oe,le.push(Le,Oe),Te.minX=Math.min(Te.minX,Le),Te.minY=Math.min(Te.minY,Oe),Te.maxX=Math.max(Te.maxX,Le),Te.maxY=Math.max(Te.maxY,Oe)}function we(Ve,ne,le,Te=!1,Le=!1){const Oe=[];for(const He of Ve)Ie(He,Oe,le);ne.push(Oe),Te&&function(He,st){let We=0;for(let rt=0,wt=He.length,Tt=wt-2;rt<wt;Tt=rt,rt+=2)We+=(He[rt]-He[Tt])*(He[rt+1]+He[Tt+1]);if(We>0===st)for(let rt=0,wt=He.length;rt<wt/2;rt+=2){const Tt=He[rt],Qt=He[rt+1];He[rt]=He[wt-2-rt],He[rt+1]=He[wt-1-rt],He[wt-2-rt]=Tt,He[wt-1-rt]=Qt}}(Oe,Le)}function Lt(Ve,ne,le,Te=!1){for(let Le=0;Le<Ve.length;Le++)we(Ve[Le],ne,le,Te,Le===0)}function Gt(Ve,ne,le,Te){const{id:Le,type:Oe,geometry:He,tags:st}=Ve,We=[];if(Oe===1)(function(rt,wt,Tt,Qt,_n){for(let Cn=0;Cn<rt.length;Cn+=2){const ur=Math.round(a.a4*(rt[Cn+0]*wt-Tt)),Dn=Math.round(a.a4*(rt[Cn+1]*wt-Qt));_n.push([ur,Dn])}})(He,ne,le,Te,We);else for(const rt of He)qt(rt,ne,le,Te,We);return{id:Le,type:Oe,geometry:We,tags:st}}function qt(Ve,ne,le,Te,Le){const Oe=-he,He=a.a4+he;let st;for(let We=0;We<Ve.length-2;We+=2){let rt=Math.round(a.a4*(Ve[We+0]*ne-le)),wt=Math.round(a.a4*(Ve[We+1]*ne-Te)),Tt=Math.round(a.a4*(Ve[We+2]*ne-le)),Qt=Math.round(a.a4*(Ve[We+3]*ne-Te));const _n=Tt-rt,Cn=Qt-wt;rt<Oe&&Tt<Oe||(rt<Oe?(wt+=Math.round(Cn*((Oe-rt)/_n)),rt=Oe):Tt<Oe&&(Qt=wt+Math.round(Cn*((Oe-rt)/_n)),Tt=Oe),wt<Oe&&Qt<Oe||(wt<Oe?(rt+=Math.round(_n*((Oe-wt)/Cn)),wt=Oe):Qt<Oe&&(Tt=rt+Math.round(_n*((Oe-wt)/Cn)),Qt=Oe),rt>=He&&Tt>=He||(rt>=He?(wt+=Math.round(Cn*((He-rt)/_n)),rt=He):Tt>=He&&(Qt=wt+Math.round(Cn*((He-rt)/_n)),Tt=He),wt>=He&&Qt>=He||(wt>=He?(rt+=Math.round(_n*((He-wt)/Cn)),wt=He):Qt>=He&&(Tt=rt+Math.round(_n*((He-wt)/Cn)),Qt=He),st&&rt===st[st.length-1][0]&&wt===st[st.length-1][1]||(st=[[rt,wt]],Le.push(st)),st.push([Tt,Qt])))))}}var It={exports:{}},ct=a.e2,Ut=a.e1.VectorTileFeature,Kt=at;function at(Ve,ne){this.options=ne||{},this.features=Ve,this.length=Ve.length}function At(Ve,ne){this.id=typeof Ve.id=="number"?Ve.id:void 0,this.type=Ve.type,this.rawGeometry=Ve.type===1?[Ve.geometry]:Ve.geometry,this.properties=Ve.tags,this.extent=ne||4096}at.prototype.feature=function(Ve){return new At(this.features[Ve],this.options.extent)},At.prototype.loadGeometry=function(){var Ve=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Ve.length;ne++){for(var le=Ve[ne],Te=[],Le=0;Le<le.length;Le++)Te.push(new ct(le[Le][0],le[Le][1]));this.geometry.push(Te)}return this.geometry},At.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ve=this.geometry,ne=1/0,le=-1/0,Te=1/0,Le=-1/0,Oe=0;Oe<Ve.length;Oe++)for(var He=Ve[Oe],st=0;st<He.length;st++){var We=He[st];ne=Math.min(ne,We.x),le=Math.max(le,We.x),Te=Math.min(Te,We.y),Le=Math.max(Le,We.y)}return[ne,Te,le,Le]},At.prototype.toGeoJSON=Ut.prototype.toGeoJSON;var Et=a.e3,Jt=Kt;function Bt(Ve){var ne=new Et;return function(le,Te){for(var Le in le.layers)Te.writeMessage(3,Pn,le.layers[Le])}(Ve,ne),ne.finish()}function Pn(Ve,ne){var le;ne.writeVarintField(15,Ve.version||1),ne.writeStringField(1,Ve.name||""),ne.writeVarintField(5,Ve.extent||4096);var Te={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<Ve.length;le++)Te.feature=Ve.feature(le),ne.writeMessage(2,$n,Te);var Le=Te.keys;for(le=0;le<Le.length;le++)ne.writeStringField(3,Le[le]);var Oe=Te.values;for(le=0;le<Oe.length;le++)ne.writeMessage(4,cr,Oe[le])}function $n(Ve,ne){var le=Ve.feature;le.id!==void 0&&ne.writeVarintField(1,le.id),ne.writeMessage(2,Qn,Ve),ne.writeVarintField(3,le.type),ne.writeMessage(4,An,le)}function Qn(Ve,ne){var le=Ve.feature,Te=Ve.keys,Le=Ve.values,Oe=Ve.keycache,He=Ve.valuecache;for(var st in le.properties){var We=le.properties[st],rt=Oe[st];if(We!==null){rt===void 0&&(Te.push(st),Oe[st]=rt=Te.length-1),ne.writeVarint(rt);var wt=typeof We;wt!=="string"&&wt!=="boolean"&&wt!=="number"&&(We=JSON.stringify(We));var Tt=wt+":"+We,Qt=He[Tt];Qt===void 0&&(Le.push(We),He[Tt]=Qt=Le.length-1),ne.writeVarint(Qt)}}}function Xt(Ve,ne){return(ne<<3)+(7&Ve)}function mr(Ve){return Ve<<1^Ve>>31}function An(Ve,ne){for(var le=Ve.loadGeometry(),Te=Ve.type,Le=0,Oe=0,He=le.length,st=0;st<He;st++){var We=le[st],rt=1;Te===1&&(rt=We.length),ne.writeVarint(Xt(1,rt));for(var wt=Te===3?We.length-1:We.length,Tt=0;Tt<wt;Tt++){Tt===1&&Te!==1&&ne.writeVarint(Xt(2,wt-1));var Qt=We[Tt].x-Le,_n=We[Tt].y-Oe;ne.writeVarint(mr(Qt)),ne.writeVarint(mr(_n)),Le+=Qt,Oe+=_n}Te===3&&ne.writeVarint(Xt(7,1))}}function cr(Ve,ne){var le=typeof Ve;le==="string"?ne.writeStringField(1,Ve):le==="boolean"?ne.writeBooleanField(7,Ve):le==="number"&&(Ve%1!=0?ne.writeDoubleField(3,Ve):Ve<0?ne.writeSVarintField(6,Ve):ne.writeVarintField(5,Ve))}It.exports=Bt,It.exports.fromVectorTileJs=Bt,It.exports.fromGeojsonVt=function(Ve,ne){ne=ne||{};var le={};for(var Te in Ve)le[Te]=new Jt(Ve[Te].features,ne),le[Te].name=Te,le[Te].version=ne.version,le[Te].extent=ne.extent;return Bt({layers:le})},It.exports.GeoJSONWrapper=Jt;var zr=a.e4(It.exports);const qn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ve=>Ve},Mr=Math.fround||(Vr=new Float32Array(1),Ve=>(Vr[0]=+Ve,Vr[0]));var Vr;const kn=3,zn=5,Ue=6;class Ye{constructor(ne){this.options=Object.assign(Object.create(qn),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:le,minZoom:Te,maxZoom:Le}=this.options;le&&console.time("total time");const Oe=`prepare ${ne.length} points`;le&&console.time(Oe),this.points=ne;const He=[];for(let We=0;We<ne.length;We++){const rt=ne[We];if(!rt.geometry)continue;const[wt,Tt]=rt.geometry.coordinates,Qt=Mr(pt(wt)),_n=Mr(dt(Tt));He.push(Qt,_n,1/0,We,-1,1),this.options.reduce&&He.push(0)}let st=this.trees[Le+1]=this._createTree(He);le&&console.timeEnd(Oe);for(let We=Le;We>=Te;We--){const rt=+Date.now();st=this.trees[We]=this._createTree(this._cluster(st,We)),le&&console.log("z%d: %d clusters in %dms",We,st.numItems,+Date.now()-rt)}return le&&console.timeEnd("total time"),this}getClusters(ne,le){let Te=((ne[0]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,ne[1]));let Oe=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)Te=-180,Oe=180;else if(Te>Oe){const Tt=this.getClusters([Te,Le,180,He],le),Qt=this.getClusters([-180,Le,Oe,He],le);return Tt.concat(Qt)}const st=this.trees[this._limitZoom(le)],We=st.range(pt(Te),dt(He),pt(Oe),dt(Le)),rt=st.data,wt=[];for(const Tt of We){const Qt=this.stride*Tt;wt.push(rt[Qt+zn]>1?gt(rt,Qt,this.clusterProps):this.points[rt[Qt+kn]])}return wt}getChildren(ne){const le=this._getOriginId(ne),Te=this._getOriginZoom(ne),Le="No cluster with the specified id.",Oe=this.trees[Te];if(!Oe)throw new Error(Le);const He=Oe.data;if(le*this.stride>=He.length)throw new Error(Le);const st=this.options.radius/(this.options.extent*Math.pow(2,Te-1)),We=Oe.within(He[le*this.stride],He[le*this.stride+1],st),rt=[];for(const wt of We){const Tt=wt*this.stride;He[Tt+4]===ne&&rt.push(He[Tt+zn]>1?gt(He,Tt,this.clusterProps):this.points[He[Tt+kn]])}if(rt.length===0)throw new Error(Le);return rt}getLeaves(ne,le,Te){const Le=[];return this._appendLeaves(Le,ne,le=le||10,Te=Te||0,0),Le}getTile(ne,le,Te){const Le=this.trees[this._limitZoom(ne)],Oe=Math.pow(2,ne),{extent:He,radius:st}=this.options,We=st/He,rt=(Te-We)/Oe,wt=(Te+1+We)/Oe,Tt={features:[]};return this._addTileFeatures(Le.range((le-We)/Oe,rt,(le+1+We)/Oe,wt),Le.data,le,Te,Oe,Tt),le===0&&this._addTileFeatures(Le.range(1-We/Oe,rt,1,wt),Le.data,Oe,Te,Oe,Tt),le===Oe-1&&this._addTileFeatures(Le.range(0,rt,We/Oe,wt),Le.data,-1,Te,Oe,Tt),Tt.features.length?Tt:null}getClusterExpansionZoom(ne){let le=this._getOriginZoom(ne)-1;for(;le<=this.options.maxZoom;){const Te=this.getChildren(ne);if(le++,Te.length!==1)break;ne=Te[0].properties.cluster_id}return le}_appendLeaves(ne,le,Te,Le,Oe){const He=this.getChildren(le);for(const st of He){const We=st.properties;if(We&&We.cluster?Oe+We.point_count<=Le?Oe+=We.point_count:Oe=this._appendLeaves(ne,We.cluster_id,Te,Le,Oe):Oe<Le?Oe++:ne.push(st),ne.length===Te)break}return Oe}_createTree(ne){const le=new a.cN(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Te=0;Te<ne.length;Te+=this.stride)le.add(ne[Te],ne[Te+1]);return le.finish(),le.data=ne,le}_addTileFeatures(ne,le,Te,Le,Oe,He){for(const st of ne){const We=st*this.stride,rt=le[We+zn]>1;let wt,Tt,Qt;if(rt)wt=Qe(le,We,this.clusterProps),Tt=le[We],Qt=le[We+1];else{const ur=this.points[le[We+kn]];wt=ur.properties;const[Dn,hr]=ur.geometry.coordinates;Tt=pt(Dn),Qt=dt(hr)}const _n={type:1,geometry:[[Math.round(this.options.extent*(Tt*Oe-Te)),Math.round(this.options.extent*(Qt*Oe-Le))]],tags:wt};let Cn;Cn=rt||this.options.generateId?le[We+kn]:this.points[le[We+kn]].id,Cn!==void 0&&(_n.id=Cn),He.features.push(_n)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,le){const{radius:Te,extent:Le,reduce:Oe,minPoints:He}=this.options,st=Te/(Le*Math.pow(2,le)),We=ne.data,rt=[],wt=this.stride;for(let Tt=0;Tt<We.length;Tt+=wt){if(We[Tt+2]<=le)continue;We[Tt+2]=le;const Qt=We[Tt],_n=We[Tt+1],Cn=ne.within(We[Tt],We[Tt+1],st),ur=We[Tt+zn];let Dn=ur;for(const hr of Cn){const dn=hr*wt;We[dn+2]>le&&(Dn+=We[dn+zn])}if(Dn>ur&&Dn>=He){let hr,dn=Qt*ur,Jr=_n*ur,vr=-1;const dr=(Tt/wt<<5)+(le+1)+this.points.length;for(const wi of Cn){const Ti=wi*wt;if(We[Ti+2]<=le)continue;We[Ti+2]=le;const Yi=We[Ti+zn];dn+=We[Ti]*Yi,Jr+=We[Ti+1]*Yi,We[Ti+4]=dr,Oe&&(hr||(hr=this._map(We,Tt,!0),vr=this.clusterProps.length,this.clusterProps.push(hr)),Oe(hr,this._map(We,Ti)))}We[Tt+4]=dr,rt.push(dn/Dn,Jr/Dn,1/0,dr,-1,Dn),Oe&&rt.push(vr)}else{for(let hr=0;hr<wt;hr++)rt.push(We[Tt+hr]);if(Dn>1)for(const hr of Cn){const dn=hr*wt;if(!(We[dn+2]<=le)){We[dn+2]=le;for(let Jr=0;Jr<wt;Jr++)rt.push(We[dn+Jr])}}}}return rt}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,le,Te){if(ne[le+zn]>1){const He=this.clusterProps[ne[le+Ue]];return Te?Object.assign({},He):He}const Le=this.points[ne[le+kn]].properties,Oe=this.options.map(Le);return Te&&Oe===Le?Object.assign({},Oe):Oe}}function gt(Ve,ne,le){return{type:"Feature",id:Ve[ne+kn],properties:Qe(Ve,ne,le),geometry:{type:"Point",coordinates:[(Te=Ve[ne],360*(Te-.5)),sn(Ve[ne+1])]}};var Te}function Qe(Ve,ne,le){const Te=Ve[ne+zn],Le=Te>=1e4?`${Math.round(Te/1e3)}k`:Te>=1e3?Math.round(Te/100)/10+"k":Te,Oe=Ve[ne+Ue],He=Oe===-1?{}:Object.assign({},le[Oe]);return Object.assign(He,{cluster:!0,cluster_id:Ve[ne+kn],point_count:Te,point_count_abbreviated:Le})}function pt(Ve){return Ve/360+.5}function dt(Ve){const ne=Math.sin(Ve*Math.PI/180),le=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return le<0?0:le>1?1:le}function sn(Ve){const ne=(180-360*Ve)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function Wt(Ve,ne,le,Te){let Le=Te;const Oe=ne+(le-ne>>1);let He,st=le-ne;const We=Ve[ne],rt=Ve[ne+1],wt=Ve[le],Tt=Ve[le+1];for(let Qt=ne+3;Qt<le;Qt+=3){const _n=pn(Ve[Qt],Ve[Qt+1],We,rt,wt,Tt);if(_n>Le)He=Qt,Le=_n;else if(_n===Le){const Cn=Math.abs(Qt-Oe);Cn<st&&(He=Qt,st=Cn)}}Le>Te&&(He-ne>3&&Wt(Ve,ne,He,Te),Ve[He+2]=Le,le-He>3&&Wt(Ve,He,le,Te))}function pn(Ve,ne,le,Te,Le,Oe){let He=Le-le,st=Oe-Te;if(He!==0||st!==0){const We=((Ve-le)*He+(ne-Te)*st)/(He*He+st*st);We>1?(le=Le,Te=Oe):We>0&&(le+=He*We,Te+=st*We)}return He=Ve-le,st=ne-Te,He*He+st*st}function Sn(Ve,ne,le,Te){const Le={id:Ve!=null?Ve:null,type:ne,geometry:le,tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")gr(Le,le);else if(ne==="Polygon")gr(Le,le[0]);else if(ne==="MultiLineString")for(const Oe of le)gr(Le,Oe);else if(ne==="MultiPolygon")for(const Oe of le)gr(Le,Oe[0]);return Le}function gr(Ve,ne){for(let le=0;le<ne.length;le+=3)Ve.minX=Math.min(Ve.minX,ne[le]),Ve.minY=Math.min(Ve.minY,ne[le+1]),Ve.maxX=Math.max(Ve.maxX,ne[le]),Ve.maxY=Math.max(Ve.maxY,ne[le+1])}function xi(Ve,ne,le,Te){if(!ne.geometry)return;const Le=ne.geometry.coordinates;if(Le&&Le.length===0)return;const Oe=ne.geometry.type,He=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let st=[],We=ne.id;if(le.promoteId?We=ne.properties[le.promoteId]:le.generateId&&(We=Te||0),Oe==="Point")Yr(Le,st);else if(Oe==="MultiPoint")for(const rt of Le)Yr(rt,st);else if(Oe==="LineString")Li(Le,st,He,!1);else if(Oe==="MultiLineString"){if(le.lineMetrics){for(const rt of Le)st=[],Li(rt,st,He,!1),Ve.push(Sn(We,"LineString",st,ne.properties));return}Nr(Le,st,He,!1)}else if(Oe==="Polygon")Nr(Le,st,He,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(const rt of ne.geometry.geometries)xi(Ve,{id:We,geometry:rt,properties:ne.properties},le,Te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const rt of Le){const wt=[];Nr(rt,wt,He,!0),st.push(wt)}}Ve.push(Sn(We,Oe,st,ne.properties))}function Yr(Ve,ne){ne.push(di(Ve[0]),En(Ve[1]),0)}function Li(Ve,ne,le,Te){let Le,Oe,He=0;for(let We=0;We<Ve.length;We++){const rt=di(Ve[We][0]),wt=En(Ve[We][1]);ne.push(rt,wt,0),We>0&&(He+=Te?(Le*wt-rt*Oe)/2:Math.sqrt(Math.pow(rt-Le,2)+Math.pow(wt-Oe,2))),Le=rt,Oe=wt}const st=ne.length-3;ne[2]=1,Wt(ne,0,st,le),ne[st+2]=1,ne.size=Math.abs(He),ne.start=0,ne.end=ne.size}function Nr(Ve,ne,le,Te){for(let Le=0;Le<Ve.length;Le++){const Oe=[];Li(Ve[Le],Oe,le,Te),ne.push(Oe)}}function di(Ve){return Ve/360+.5}function En(Ve){const ne=Math.sin(Ve*Math.PI/180),le=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return le<0?0:le>1?1:le}function hn(Ve,ne,le,Te,Le,Oe,He,st){if(Te/=ne,Oe>=(le/=ne)&&He<Te)return Ve;if(He<le||Oe>=Te)return null;const We=[];for(const rt of Ve){const wt=rt.geometry;let Tt=rt.type;const Qt=Le===0?rt.minX:rt.minY,_n=Le===0?rt.maxX:rt.maxY;if(Qt>=le&&_n<Te){We.push(rt);continue}if(_n<le||Qt>=Te)continue;let Cn=[];if(Tt==="Point"||Tt==="MultiPoint")bi(wt,Cn,le,Te,Le);else if(Tt==="LineString")ci(wt,Cn,le,Te,Le,!1,st.lineMetrics);else if(Tt==="MultiLineString")Ca(wt,Cn,le,Te,Le,!1);else if(Tt==="Polygon")Ca(wt,Cn,le,Te,Le,!0);else if(Tt==="MultiPolygon")for(const ur of wt){const Dn=[];Ca(ur,Dn,le,Te,Le,!0),Dn.length&&Cn.push(Dn)}if(Cn.length){if(st.lineMetrics&&Tt==="LineString"){for(const ur of Cn)We.push(Sn(rt.id,Tt,ur,rt.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(Cn.length===1?(Tt="LineString",Cn=Cn[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=Cn.length===3?"Point":"MultiPoint"),We.push(Sn(rt.id,Tt,Cn,rt.tags))}}return We.length?We:null}function bi(Ve,ne,le,Te,Le){for(let Oe=0;Oe<Ve.length;Oe+=3){const He=Ve[Oe+Le];He>=le&&He<=Te&&an(ne,Ve[Oe],Ve[Oe+1],Ve[Oe+2])}}function ci(Ve,ne,le,Te,Le,Oe,He){let st=Us(Ve);const We=Le===0?ir:oi;let rt,wt,Tt=Ve.start;for(let Dn=0;Dn<Ve.length-3;Dn+=3){const hr=Ve[Dn],dn=Ve[Dn+1],Jr=Ve[Dn+2],vr=Ve[Dn+3],dr=Ve[Dn+4],wi=Le===0?hr:dn,Ti=Le===0?vr:dr;let Yi=!1;He&&(rt=Math.sqrt(Math.pow(hr-vr,2)+Math.pow(dn-dr,2))),wi<le?Ti>le&&(wt=We(st,hr,dn,vr,dr,le),He&&(st.start=Tt+rt*wt)):wi>Te?Ti<Te&&(wt=We(st,hr,dn,vr,dr,Te),He&&(st.start=Tt+rt*wt)):an(st,hr,dn,Jr),Ti<le&&wi>=le&&(wt=We(st,hr,dn,vr,dr,le),Yi=!0),Ti>Te&&wi<=Te&&(wt=We(st,hr,dn,vr,dr,Te),Yi=!0),!Oe&&Yi&&(He&&(st.end=Tt+rt*wt),ne.push(st),st=Us(Ve)),He&&(Tt+=rt)}let Qt=Ve.length-3;const _n=Ve[Qt],Cn=Ve[Qt+1],ur=Le===0?_n:Cn;ur>=le&&ur<=Te&&an(st,_n,Cn,Ve[Qt+2]),Qt=st.length-3,Oe&&Qt>=3&&(st[Qt]!==st[0]||st[Qt+1]!==st[1])&&an(st,st[0],st[1],st[2]),st.length&&ne.push(st)}function Us(Ve){const ne=[];return ne.size=Ve.size,ne.start=Ve.start,ne.end=Ve.end,ne}function Ca(Ve,ne,le,Te,Le,Oe){for(const He of Ve)ci(He,ne,le,Te,Le,Oe,!1)}function an(Ve,ne,le,Te){Ve.push(ne,le,Te)}function ir(Ve,ne,le,Te,Le,Oe){const He=(Oe-ne)/(Te-ne);return an(Ve,Oe,le+(Le-le)*He,1),He}function oi(Ve,ne,le,Te,Le,Oe){const He=(Oe-le)/(Le-le);return an(Ve,ne+(Te-ne)*He,Oe,1),He}function Fi(Ve,ne){const le=[];for(let Te=0;Te<Ve.length;Te++){const Le=Ve[Te],Oe=Le.type;let He;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")He=Ps(Le.geometry,ne);else if(Oe==="MultiLineString"||Oe==="Polygon"){He=[];for(const st of Le.geometry)He.push(Ps(st,ne))}else if(Oe==="MultiPolygon"){He=[];for(const st of Le.geometry){const We=[];for(const rt of st)We.push(Ps(rt,ne));He.push(We)}}le.push(Sn(Le.id,Oe,He,Le.tags))}return le}function Ps(Ve,ne){const le=[];le.size=Ve.size,Ve.start!==void 0&&(le.start=Ve.start,le.end=Ve.end);for(let Te=0;Te<Ve.length;Te+=3)le.push(Ve[Te]+ne,Ve[Te+1],Ve[Te+2]);return le}function Rs(Ve,ne){if(Ve.transformed)return Ve;const le=1<<Ve.z,Te=Ve.x,Le=Ve.y;for(const Oe of Ve.features){const He=Oe.geometry,st=Oe.type;if(Oe.geometry=[],st===1)for(let We=0;We<He.length;We+=2)Oe.geometry.push(Vs(He[We],He[We+1],ne,le,Te,Le));else for(let We=0;We<He.length;We++){const rt=[];for(let wt=0;wt<He[We].length;wt+=2)rt.push(Vs(He[We][wt],He[We][wt+1],ne,le,Te,Le));Oe.geometry.push(rt)}}return Ve.transformed=!0,Ve}function Vs(Ve,ne,le,Te,Le,Oe){return[Math.round(le*(Ve*Te-Le)),Math.round(le*(ne*Te-Oe))]}function Ks(Ve,ne,le,Te,Le){const Oe=ne===Le.maxZoom?0:Le.tolerance/((1<<ne)*Le.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:Ve.length,source:null,x:le,y:Te,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const st of Ve)jo(He,st,Oe,Le);return He}function jo(Ve,ne,le,Te){const Le=ne.geometry,Oe=ne.type,He=[];if(Ve.minX=Math.min(Ve.minX,ne.minX),Ve.minY=Math.min(Ve.minY,ne.minY),Ve.maxX=Math.max(Ve.maxX,ne.maxX),Ve.maxY=Math.max(Ve.maxY,ne.maxY),Oe==="Point"||Oe==="MultiPoint")for(let st=0;st<Le.length;st+=3)He.push(Le[st],Le[st+1]),Ve.numPoints++,Ve.numSimplified++;else if(Oe==="LineString")qr(He,Le,Ve,le,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(let st=0;st<Le.length;st++)qr(He,Le[st],Ve,le,Oe==="Polygon",st===0);else if(Oe==="MultiPolygon")for(let st=0;st<Le.length;st++){const We=Le[st];for(let rt=0;rt<We.length;rt++)qr(He,We[rt],Ve,le,!0,rt===0)}if(He.length){let st=ne.tags||null;if(Oe==="LineString"&&Te.lineMetrics){st={};for(const rt in ne.tags)st[rt]=ne.tags[rt];st.mapbox_clip_start=Le.start/Le.size,st.mapbox_clip_end=Le.end/Le.size}const We={geometry:He,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:st};ne.id!==null&&(We.id=ne.id),Ve.features.push(We)}}function qr(Ve,ne,le,Te,Le,Oe){const He=Te*Te;if(Te>0&&ne.size<(Le?He:Te))return void(le.numPoints+=ne.length/3);const st=[];for(let We=0;We<ne.length;We+=3)(Te===0||ne[We+2]>He)&&(le.numSimplified++,st.push(ne[We],ne[We+1])),le.numPoints++;Le&&function(We,rt){let wt=0;for(let Tt=0,Qt=We.length,_n=Qt-2;Tt<Qt;_n=Tt,Tt+=2)wt+=(We[Tt]-We[_n])*(We[Tt+1]+We[_n+1]);if(wt>0===rt)for(let Tt=0,Qt=We.length;Tt<Qt/2;Tt+=2){const _n=We[Tt],Cn=We[Tt+1];We[Tt]=We[Qt-2-Tt],We[Tt+1]=We[Qt-1-Tt],We[Qt-2-Tt]=_n,We[Qt-1-Tt]=Cn}}(st,Oe),Ve.push(st)}const Qa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ai{constructor(ne,le){const Te=(le=this.options=function(Oe,He){for(const st in He)Oe[st]=He[st];return Oe}(Object.create(Qa),le)).debug;if(Te&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Le=function(Oe,He){const st=[];if(Oe.type==="FeatureCollection")for(let We=0;We<Oe.features.length;We++)xi(st,Oe.features[We],He,We);else xi(st,Oe.type==="Feature"?Oe:{geometry:Oe},He);return st}(ne,le);this.tiles={},this.tileCoords=[],Te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Le=function(Oe,He){const st=He.buffer/He.extent;let We=Oe;const rt=hn(Oe,1,-1-st,st,0,-1,2,He),wt=hn(Oe,1,1-st,2+st,0,-1,2,He);return(rt||wt)&&(We=hn(Oe,1,-st,1+st,0,-1,2,He)||[],rt&&(We=Fi(rt,1).concat(We)),wt&&(We=We.concat(Fi(wt,-1)))),We}(Le,le),Le.length&&this.splitTile(Le,0,0,0),Te&&(Le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,le,Te,Le,Oe,He,st){const We=[ne,le,Te,Le],rt=this.options,wt=rt.debug;for(;We.length;){Le=We.pop(),Te=We.pop(),le=We.pop(),ne=We.pop();const Tt=1<<le,Qt=Ai(le,Te,Le);let _n=this.tiles[Qt];if(!_n&&(wt>1&&console.time("creation"),_n=this.tiles[Qt]=Ks(ne,le,Te,Le,rt),this.tileCoords.push({z:le,x:Te,y:Le}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,Te,Le,_n.numFeatures,_n.numPoints,_n.numSimplified),console.timeEnd("creation"));const Yi=`z${le}`;this.stats[Yi]=(this.stats[Yi]||0)+1,this.total++}if(_n.source=ne,Oe==null){if(le===rt.indexMaxZoom||_n.numPoints<=rt.indexMaxPoints)continue}else{if(le===rt.maxZoom||le===Oe)continue;if(Oe!=null){const Yi=Oe-le;if(Te!==He>>Yi||Le!==st>>Yi)continue}}if(_n.source=null,ne.length===0)continue;wt>1&&console.time("clipping");const Cn=.5*rt.buffer/rt.extent,ur=.5-Cn,Dn=.5+Cn,hr=1+Cn;let dn=null,Jr=null,vr=null,dr=null,wi=hn(ne,Tt,Te-Cn,Te+Dn,0,_n.minX,_n.maxX,rt),Ti=hn(ne,Tt,Te+ur,Te+hr,0,_n.minX,_n.maxX,rt);ne=null,wi&&(dn=hn(wi,Tt,Le-Cn,Le+Dn,1,_n.minY,_n.maxY,rt),Jr=hn(wi,Tt,Le+ur,Le+hr,1,_n.minY,_n.maxY,rt),wi=null),Ti&&(vr=hn(Ti,Tt,Le-Cn,Le+Dn,1,_n.minY,_n.maxY,rt),dr=hn(Ti,Tt,Le+ur,Le+hr,1,_n.minY,_n.maxY,rt),Ti=null),wt>1&&console.timeEnd("clipping"),We.push(dn||[],le+1,2*Te,2*Le),We.push(Jr||[],le+1,2*Te,2*Le+1),We.push(vr||[],le+1,2*Te+1,2*Le),We.push(dr||[],le+1,2*Te+1,2*Le+1)}}getTile(ne,le,Te){ne=+ne,le=+le,Te=+Te;const Le=this.options,{extent:Oe,debug:He}=Le;if(ne<0||ne>24)return null;const st=1<<ne,We=Ai(ne,le=le+st&st-1,Te);if(this.tiles[We])return Rs(this.tiles[We],Oe);He>1&&console.log("drilling down to z%d-%d-%d",ne,le,Te);let rt,wt=ne,Tt=le,Qt=Te;for(;!rt&&wt>0;)wt--,Tt>>=1,Qt>>=1,rt=this.tiles[Ai(wt,Tt,Qt)];return rt&&rt.source?(He>1&&(console.log("found parent tile z%d-%d-%d",wt,Tt,Qt),console.time("drilling down")),this.splitTile(rt.source,wt,Tt,Qt,ne,le,Te),He>1&&console.timeEnd("drilling down"),this.tiles[We]?Rs(this.tiles[We],Oe):null):null}}function Ai(Ve,ne,le){return 32*((1<<Ve)*le+ne)+Ve}function Cl(Ve,ne){const le=Ve.tileID.canonical;if(!this._geoJSONIndex)return ne(null,null);const Te=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!Te)return ne(null,null);const Le=new Ee(Te.features);let Oe=zr(Le);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),ne(null,{vectorTile:Le,rawData:Oe.buffer})}class Aa extends W{constructor(ne,le,Te,Le,Oe,He){super(ne,le,Te,Le,Cl,He),Oe&&(this.loadGeoJSON=Oe),this._dynamicIndex=new _e}loadData(ne,le){const Te=ne&&ne.request,Le=Te&&Te.collectResourceTiming;this.loadGeoJSON(ne,(Oe,He)=>{if(Oe||!He)return le(Oe);if(typeof He!="object")return le(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const We=a.z(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(We.result==="error")throw new Error(We.value.map(rt=>`${rt.key}: ${rt.message}`).join(", "));He.features=He.features.filter(rt=>We.value.evaluate({zoom:0},rt))}ne.dynamic?(He.type==="Feature"&&(He={type:"FeatureCollection",features:[He]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(He.features,this.loaded),ne.cluster&&(He.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new Ye(function({superclusterOptions:We,clusterProperties:rt}){if(!rt||!We)return We;const wt={},Tt={},Qt={accumulated:null,zoom:0},_n={properties:null},Cn=Object.keys(rt);for(const ur of Cn){const[Dn,hr]=rt[ur],dn=a.z(hr),Jr=a.z(typeof Dn=="string"?[Dn,["accumulated"],["get",ur]]:Dn);wt[ur]=dn.value,Tt[ur]=Jr.value}return We.map=ur=>{_n.properties=ur;const Dn={};for(const hr of Cn)Dn[hr]=wt[hr].evaluate(Qt,_n);return Dn},We.reduce=(ur,Dn)=>{_n.properties=Dn;for(const hr of Cn)Qt.accumulated=ur[hr],ur[hr]=Tt[hr].evaluate(Qt,_n)},We}(ne)).load(He.features):ne.dynamic?this._dynamicIndex:function(We,rt){return new ai(We,rt)}(He,ne.geojsonVtOptions)}catch(We){return le(We)}const st={};if(Le){const We=I(Te);We&&(st.resourceTiming={},st.resourceTiming[ne.source]=JSON.parse(JSON.stringify(We)))}le(null,st)}})}reloadTile(ne,le){const Te=this.loaded;return Te&&Te[ne.uid]?ne.partial?le(null,void 0):super.reloadTile(ne,le):this.loadTile(ne,le)}loadGeoJSON(ne,le){if(ne.request)a.h(ne.request,le);else{if(typeof ne.data!="string")return le(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));try{return le(null,JSON.parse(ne.data))}catch(Te){return le(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ne,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(Te){le(Te)}}getClusterChildren(ne,le){try{le(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(Te){le(Te)}}getClusterLeaves(ne,le){try{le(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(Te){le(Te)}}}class vo{constructor(ne,le){this.tileID=new a.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=le}parse(ne,le,Te,Le){this.status="parsing";const Oe=new a.aQ(Te.tileID.overscaledZ,Te.tileID.wrap,Te.tileID.canonical.z,Te.tileID.canonical.x,Te.tileID.canonical.y),He={},st=le.familiesBySource[Te.source],We=new a.dQ(Oe,Te.promoteId);return We.bucketLayerIDs=[],We.is3DTile=!0,a.e6(ne).then(rt=>{if(!rt)return Le(new Error("Could not parse tile"));const wt=a.e7(rt,1/a.b7(Te.tileID.canonical)),Tt=rt.json.extensionsUsed&&rt.json.extensionsUsed.includes("MAPBOX_mesh_features")||rt.json.asset.extras&&rt.json.asset.extras.MAPBOX_mesh_features,Qt=rt.json.extensionsUsed&&rt.json.extensionsUsed.includes("EXT_meshopt_compression"),_n=new a.Y(this.zoom,{brightness:this.brightness});for(const Cn in st)for(const ur of st[Cn]){const Dn=ur[0];We.bucketLayerIDs.push(ur.map(dn=>dn.id)),Dn.recalculate(_n,[]);const hr=new a.e8(wt,Oe,Tt,Qt,this.brightness,We);Tt||(hr.needsUpload=!0),He[Dn.fqid]=hr,hr.evaluate(Dn)}this.status="done",Le(null,{buckets:He,featureIndex:We})}).catch(rt=>Le(new Error(rt.message)))}}class Gi{constructor(ne,le,Te,Le,Oe,He){this.actor=ne,this.layerIndex=le,this.brightness=He,this.loading={},this.loaded={}}loadTile(ne,le){const Te=ne.uid,Le=this.loading[Te]=new vo(ne,this.brightness);a.e5(ne.request,(Oe,He)=>{const st=!this.loading[Te];return delete this.loading[Te],st||Oe?(Le.status="done",st||(this.loaded[Te]=Le),le(Oe)):He&&He.byteLength!==0?void Le.parse(He,this.layerIndex,ne,(We,rt)=>{Le.status="done",this.loaded=this.loaded||{},this.loaded[Te]=Le,We||!rt?le(We):le(null,rt)}):(Le.status="done",this.loaded[Te]=Le,le())})}reloadTile(ne,le){const Te=this.loaded,Le=ne.uid;if(Te&&Te[Le]){const Oe=Te[Le];Oe.projection=ne.projection,Oe.brightness=ne.brightness;const He=(st,We)=>{Oe.reloadCallback&&(delete Oe.reloadCallback,this.loadTile(ne,le)),le(st,We)};Oe.status==="parsing"?Oe.reloadCallback=He:Oe.status==="done"&&this.loadTile(ne,le)}}abortTile(ne,le){const Te=ne.uid;this.loading[Te]&&delete this.loading[Te],le()}removeTile(ne,le){const Te=this.loaded,Le=ne.uid;Te&&Te[Le]&&delete Te[Le],le()}}class Ju{constructor(ne){this.self=ne,this.actor=new a.e9(ne,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.aK({name:"mercator"}),this.workerSourceTypes={vector:W,geojson:Aa,"batched-model":Gi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(le,Te)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=Te},this.self.registerRTLTextPlugin=le=>{if(a.ea.isParsed())throw new Error("RTL text plugin already registered.");a.ea.applyArabicShaping=le.applyArabicShaping,a.ea.processBidirectionalText=le.processBidirectionalText,a.ea.processStyledBidirectionalText=le.processStyledBidirectionalText}}clearCaches(ne,le,Te){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.workerSources[ne],delete this.demWorkerSources[ne],delete this.rasterArrayWorkerSource,Te()}checkIfReady(ne,le,Te){Te()}setReferrer(ne,le){this.referrer=le}spriteLoaded(ne,{scope:le,isLoaded:Te}){if(this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.isSpriteLoaded[ne][le]=Te,this.workerSources[ne]&&this.workerSources[ne][le])for(const Le in this.workerSources[ne][le]){const Oe=this.workerSources[ne][le][Le];for(const He in Oe){const st=Oe[He];st instanceof W&&(st.isSpriteLoaded=Te,st.fire(new a.g("isSpriteLoaded")))}}}setImages(ne,{scope:le,images:Te},Le){if(this.availableImages[ne]||(this.availableImages[ne]={}),this.availableImages[ne][le]=Te,this.workerSources[ne]&&this.workerSources[ne][le]){for(const Oe in this.workerSources[ne][le]){const He=this.workerSources[ne][le][Oe];for(const st in He)He[st].availableImages=Te}Le()}else Le()}setProjection(ne,le){this.projections[ne]=a.aK(le)}setBrightness(ne,le,Te){this.brightness=le,Te()}setLayers(ne,le,Te){this.getLayerIndex(ne,le.scope).replace(le.layers,le.options),Te()}updateLayers(ne,le,Te){this.getLayerIndex(ne,le.scope).update(le.layers,le.removedIds,le.options),Te()}loadTile(ne,le,Te){le.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,le.type,le.source,le.scope).loadTile(le,Te)}loadDEMTile(ne,le,Te){this.getDEMWorkerSource(ne,le.source,le.scope).loadTile(le,Te)}decodeRasterArray(ne,le,Te){this.getRasterArrayWorkerSource().decodeRasterArray(le,Te)}reloadTile(ne,le,Te){le.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,le.type,le.source,le.scope).reloadTile(le,Te)}abortTile(ne,le,Te){this.getWorkerSource(ne,le.type,le.source,le.scope).abortTile(le,Te)}removeTile(ne,le,Te){this.getWorkerSource(ne,le.type,le.source,le.scope).removeTile(le,Te)}removeSource(ne,le,Te){if(!(this.workerSources[ne]&&this.workerSources[ne][le.scope]&&this.workerSources[ne][le.scope][le.type]&&this.workerSources[ne][le.scope][le.type][le.source]))return;const Le=this.workerSources[ne][le.scope][le.type][le.source];delete this.workerSources[ne][le.scope][le.type][le.source],Le.removeSource!==void 0?Le.removeSource(le,Te):Te()}loadWorkerSource(ne,le,Te){try{this.self.importScripts(le.url),Te()}catch(Le){Te(Le.toString())}}syncRTLPluginState(ne,le,Te){try{a.ea.setState(le);const Le=a.ea.getPluginURL();if(a.ea.isLoaded()&&!a.ea.isParsed()&&Le!=null){this.self.importScripts(Le);const Oe=a.ea.isParsed();Te(Oe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Le}`),Oe)}}catch(Le){Te(Le.toString())}}setDracoUrl(ne,le){this.dracoUrl=le}getAvailableImages(ne,le){this.availableImages[ne]||(this.availableImages[ne]={});let Te=this.availableImages[ne][le];return Te||(Te=[]),Te}getLayerIndex(ne,le){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let Te=this.layerIndexes[ne][le];return Te||(Te=this.layerIndexes[ne][le]=new F,Te.scope=le),Te}getWorkerSource(ne,le,Te,Le){return this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][Le]||(this.workerSources[ne][Le]={}),this.workerSources[ne][Le][le]||(this.workerSources[ne][Le][le]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.workerSources[ne][Le][le][Te]||(this.workerSources[ne][Le][le][Te]=new this.workerSourceTypes[le]({send:(Oe,He,st,We,rt,wt)=>{this.actor.send(Oe,He,st,ne,rt,wt)},scheduler:this.actor.scheduler},this.getLayerIndex(ne,Le),this.getAvailableImages(ne,Le),this.isSpriteLoaded[ne][Le],void 0,this.brightness)),this.workerSources[ne][Le][le][Te]}getDEMWorkerSource(ne,le,Te){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][Te]||(this.demWorkerSources[ne][Te]={}),this.demWorkerSources[ne][Te][le]||(this.demWorkerSources[ne][Te][le]=new X),this.demWorkerSources[ne][Te][le]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new ee),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ne,le){a.eb(le)}getWorkerPerformanceMetrics(ne,le,Te){Te(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ju(self)),Ju}),_(["./shared"],function(a){var I=D;function D(g){return!function(l){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,T=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(T);try{b=new Worker(S),y=!0}catch(A){y=!1}return b&&b.terminate(),URL.revokeObjectURL(S),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var T=b.getImageData(0,0,1,1);return T&&T.width===y.width}()?(O[d=l&&l.failIfMajorPerformanceCaveat]===void 0&&(O[d]=function(y){var b,T=function(S){var A=document.createElement("canvas"),k=Object.create(D.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=S,A.getContext("webgl2",k)}(y);if(!T)return!1;try{b=T.createShader(T.VERTEX_SHADER)}catch(S){return!1}return!(!b||T.isContextLost())&&(T.shaderSource(b,"void main() {}"),T.compileShader(b),T.getShaderParameter(b,T.COMPILE_STATUS)===!0)}(d)),O[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var d}(g)}var O={};function F(g,l,d){const y=document.createElement(g);return l!=null&&(y.className=l),d&&d.appendChild(y),y}function H(g,l,d){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(l))y.setAttributeNS(null,b,String(l[b]));return d&&d.appendChild(y),y}D.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Q=typeof document!="undefined"?document.documentElement&&document.documentElement.style:null,ie=Q&&Q.userSelect!==void 0?"userSelect":"WebkitUserSelect";let te;function W(){Q&&ie&&(te=Q[ie],Q[ie]="none")}function X(){Q&&ie&&(Q[ie]=te)}function ee(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",ee,!0)}function fe(){window.addEventListener("click",ee,!0),window.setTimeout(()=>{window.removeEventListener("click",ee,!0)},0)}function ye(g,l){const d=g.getBoundingClientRect();return he(g,d,l)}function Ee(g,l){const d=g.getBoundingClientRect(),y=[];for(let b=0;b<l.length;b++)y.push(he(g,d,l[b]));return y}function re(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function he(g,l,d){const y=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new a.P((d.clientX-l.left)*y,(d.clientY-l.top)*y)}class _e{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,d){this._updatedSourceCaches[l]=d,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const d=l.scope;this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._updatedLayers[d].add(l.id),this.setDirty()}removeLayer(l){const d=l.scope;this._removedLayers[d]=this._removedLayers[d]||{},this._updatedLayers[d]=this._updatedLayers[d]||new Set,this._removedLayers[d][l.id]=l,this._updatedLayers[d].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const d in this._updatedLayers)l[d]=l[d]||{},l[d].updatedIds=Array.from(this._updatedLayers[d].values());for(const d in this._removedLayers)l[d]=l[d]||{},l[d].removedIds=Object.keys(this._removedLayers[d]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const Se={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class J{constructor(l,d,y,b,T,S){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=b,this.instanceCount=S,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||T||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let y=0;y<this.attributes.length;y++){const b=d.attributes[this.attributes[y].name];b!==void 0&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,d,y){for(let b=0;b<this.attributes.length;b++){const T=this.attributes[b],S=d.attributes[T.name];S!==void 0&&l.vertexAttribPointer(S,T.components,l[Se[T.type]],!1,this.itemSize,T.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(l,d,y){for(let b=0;b<this.attributes.length;b++){const T=d.attributes[this.attributes[b].name];T!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(T,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ie{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class we extends Ie{getDefault(){return a.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Lt extends Ie{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Gt extends Ie{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class qt extends Ie{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class It extends Ie{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ct extends Ie{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Ut extends Ie{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Kt extends Ie{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class at extends Ie{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class At extends Ie{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Et extends Ie{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class Jt extends Ie{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Bt extends Ie{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class Pn extends Ie{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class $n extends Ie{getDefault(){return a.C.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Qn extends Ie{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class Xt extends Ie{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class mr extends Ie{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class An extends Ie{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let cr=class extends Ie{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class zr extends Ie{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class qn extends Ie{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Mr extends Ie{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Vr extends Ie{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class kn extends Ie{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class zn extends Ie{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ue extends Ie{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ye extends Ie{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class gt extends Ie{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Qe extends Ie{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class pt extends Ie{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class dt extends Ie{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class sn extends dt{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Wt extends dt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class pn extends dt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,this.attachment(),d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Sn extends Wt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class gr{constructor(l,d,y,b,T){this.context=l,this.width=d,this.height=y;const S=this.framebuffer=l.gl.createFramebuffer();b&&(this.colorAttachment=new sn(l,S)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new Wt(l,S):new pn(l,S))}destroy(){const l=this.context.gl;if(this.colorAttachment){const d=this.colorAttachment.get();d&&l.deleteTexture(d)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const d=this.depthAttachment.get();d&&l.deleteRenderbuffer(d)}else{const d=this.depthAttachment.get();d&&l.deleteTexture(d)}l.deleteFramebuffer(this.framebuffer)}}class xi{constructor(l,d){this.gl=l,this.clearColor=new we(this),this.clearDepth=new Lt(this),this.clearStencil=new Gt(this),this.colorMask=new qt(this),this.depthMask=new It(this),this.stencilMask=new ct(this),this.stencilFunc=new Ut(this),this.stencilOp=new Kt(this),this.stencilTest=new at(this),this.depthRange=new At(this),this.depthTest=new Et(this),this.depthFunc=new Jt(this),this.blend=new Bt(this),this.blendFunc=new Pn(this),this.blendColor=new $n(this),this.blendEquation=new Qn(this),this.cullFace=new Xt(this),this.cullFaceSide=new mr(this),this.frontFace=new An(this),this.program=new cr(this),this.activeTexture=new zr(this),this.viewport=new qn(this),this.bindFramebuffer=new Mr(this),this.bindRenderbuffer=new Vr(this),this.bindTexture=new kn(this),this.bindVertexBuffer=new zn(this),this.bindElementBuffer=new Ue(this),this.bindVertexArrayOES=new Ye(this),this.pixelStoreUnpack=new gt(this),this.pixelStoreUnpackPremultiplyAlpha=new Qe(this),this.pixelStoreUnpackFlipY=new pt(this),this.options=d?de({},d):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d,y){return new a.I(this,l,d,y)}createVertexBuffer(l,d,y,b,T){return new J(this,l,d,y,b,T)}createRenderbuffer(l,d,y){const b=this.gl,T=b.createRenderbuffer();return this.bindRenderbuffer.set(T),b.renderbufferStorage(b.RENDERBUFFER,l,d,y),this.bindRenderbuffer.set(null),T}createFramebuffer(l,d,y,b){return new gr(this,l,d,y,b)}clear({color:l,depth:d,stencil:y,colorMask:b}){const T=this.gl;let S=0;l&&(S|=T.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(b||[!0,!0,!0,!0])),d!==void 0&&(S|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),y!==void 0&&(S|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),T.clear(S)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){a.d(l.blendFunction,a.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Yr{constructor(l,d,y,b){const T={width:y[0],height:y[1],data:null},S=l.gl;this.targetColorTexture=new a.T(l,T,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new a.T(l,T,S.RGBA,{useMipmap:!1}),this.context=l,this.updateParticleTexture(d,b),this.lastInvalidatedAt=0}updateParticleTexture(l,d){if(this.particleTextureDimension===d.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,b=d.width*d.height;this.particleTexture0=new a.T(this.context,d,y.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,d,y.RGBA,{premultiply:!1,useMipmap:!1});const T=new a.S;T.reserve(b);for(let S=0;S<b;S++)T.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(T,a.p.members,!0),this.particleSegment=a.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=d.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=a.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Li extends a.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,d){return a.l(this.requestManager.transformRequest(d,a.R.Model).url).then(y=>{if(!y)return;const b=a.c(y),T=new a.M(l,void 0,void 0,b);return T.computeBoundsAndApplyParent(),T}).catch(y=>{if(y&&y.status===404)return null;this.fire(new a.f(new Error(`Could not load model ${l} from ${d}: ${y.message}`)))})}load(l,d){this.models[d]||(this.models[d]={});const y=Object.keys(l);this.numModelsLoading[d]=(this.numModelsLoading[d]||0)+y.length;const b=[];for(const T of y)b.push(this.loadModel(T,l[T]));Promise.allSettled(b).then(T=>{for(let S=0;S<T.length;S++){const{status:A,value:k}=T[S];A==="fulfilled"&&k&&(this.models[d][y[S]]={model:k,numReferences:1})}this.numModelsLoading[d]-=y.length,this.fire(new a.g("data",{dataType:"style"}))}).catch(T=>{this.fire(new a.f(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,d){return!!this.getModel(l,d)}getModel(l,d){return this.models[d]||(this.models[d]={}),this.models[d][l]?this.models[d][l].model:void 0}addModel(l,d,y){this.models[y]||(this.models[y]={}),this.hasModel(l,y)&&this.models[y][l].numReferences++,this.load({[l]:this.requestManager.normalizeModelURL(d)},y)}addModels(l,d){this.models[d]||(this.models[d]={});const y={};for(const b in l)this.models[d][b]={},y[b]=this.requestManager.normalizeModelURL(l[b]);this.load(y,d)}addModelsFromBucket(l,d){this.models[d]||(this.models[d]={});const y={};for(const b of l)this.hasModel(b,d)?this.models[d][b].numReferences++:y[b]=this.requestManager.normalizeModelURL(b);this.load(y,d)}removeModel(l,d){if(this.models[d]&&this.models[d][l]&&(this.models[d][l].numReferences--,this.models[d][l].numReferences===0)){const y=this.models[d][l].model;delete this.models[d][l],y.destroy()}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,d){this.models[d]||(this.models[d]={});for(const y in this.models[d])this.models[d][y].model&&this.models[d][y].model.upload(l.context)}}function Nr(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class di extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new a.j({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,d){if(this.loaded[d]!==l&&(this.loaded[d]=l,l)){for(const{ids:y,callback:b}of this.requestors)this._notify(y,d,b);this.requestors=[]}}hasImage(l,d){return!!this.getImage(l,d)}getImage(l,d){return this.images[d][l]}addImage(l,d,y){this._validate(l,y)&&(this.images[d][l]=y)}_validate(l,d){let y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,d){if(!l)return!0;let y=0;for(const b of l){if(b[0]<y||b[1]<b[0]||d<b[1])return!1;y=b[1]}return!0}_validateContent(l,d){return!(l&&(l.length!==4||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d,y){y.version=this.images[d][l].version+1,this.images[d][l]=y,this.updatedImages[d][l]=!0}removeImage(l,d){const y=this.images[d][l];delete this.images[d][l],delete this.patterns[d][l],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,d,y){let b=!0;const T=!!this.loaded[d];if(!T)for(const S of l)this.images[d][S]||(b=!1);T||b?this._notify(l,d,y):this.requestors.push({ids:l,scope:d,callback:y})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,d,y){const b={};for(const T of l){this.images[d][T]||this.fire(new a.g("styleimagemissing",{id:T}));const S=this.images[d][T];S?b[T]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:a.w(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,b)}getPixelSize(l){const{width:d,height:y}=this.atlasImage[l];return{width:d,height:y}}getPattern(l,d,y){const b=this.patterns[d][l],T=this.getImage(l,d);if(!T)return null;if(b&&b.position.version===T.version)return b.position;if(b)b.position.version=T.version;else{const S={w:T.data.width+2,h:T.data.height+2,x:0,y:0},A=new a.m(S,T);this.patterns[d][l]={bin:S,position:A}}return this._updatePatternAtlas(d,y),this.patterns[d][l].position}bind(l,d){const y=l.gl;let b=this.atlasTexture[d];b?this.dirty&&(b.update(this.atlasImage[d]),this.dirty=!1):(b=new a.T(l,this.atlasImage[d],y.RGBA),this.atlasTexture[d]=b),b.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(l,d){const y=[];for(const A in this.patterns[l])y.push(this.patterns[l][A].bin);const{w:b,h:T}=a.k(y),S=this.atlasImage[l];S.resize({width:b||1,height:T||1});for(const A in this.patterns[l]){const{bin:k}=this.patterns[l][A],L=k.x+1,B=k.y+1,U=this.images[l][A].data,q=U.width,Z=U.height;a.j.copy(U,S,{x:0,y:0},{x:L,y:B},{width:q,height:Z},d),a.j.copy(U,S,{x:0,y:Z-1},{x:L,y:B-1},{width:q,height:1},d),a.j.copy(U,S,{x:0,y:0},{x:L,y:B+Z},{width:q,height:1},d),a.j.copy(U,S,{x:q-1,y:0},{x:L-1,y:B},{width:1,height:Z},d),a.j.copy(U,S,{x:0,y:0},{x:L+q,y:B},{width:1,height:Z},d)}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,d){for(const y of l){if(this.callbackDispatchedThisFrame[d][y])continue;this.callbackDispatchedThisFrame[d][y]=!0;const b=this.images[d][y];Nr(b)&&this.updateImage(y,d,b)}}}function En(g){const l=g.key,d=g.value,y=g.valueSpec||{},b=g.objectElementValidators||{},T=g.style,S=g.styleSpec;let A=[];const k=a.o(d);if(k!=="object")return[new a.V(l,d,`object expected, ${k} found`)];for(const L in d){const B=L.split(".")[0];let U;b[B]?U=b[B]:y[B]?U=Gi:b["*"]?U=b["*"]:y["*"]&&(U=Gi),U?A=A.concat(U({key:(l&&`${l}.`)+L,value:d[L],valueSpec:y[B]||y["*"],style:T,styleSpec:S,object:d,objectKey:L},d)):A.push(new a.n(l,d[L],`unknown property "${L}"`))}for(const L in y)b[L]||y[L].required&&y[L].default===void 0&&d[L]===void 0&&A.push(new a.V(l,d,`missing required property "${L}"`));return A}function hn(g){const l=g.value,d=g.valueSpec,y=g.style,b=g.styleSpec,T=g.key,S=g.arrayElementValidator||Gi;if(a.o(l)!=="array")return[new a.V(T,l,`array expected, ${a.o(l)} found`)];if(d.length&&l.length!==d.length)return[new a.V(T,l,`array length ${d.length} expected, length ${l.length} found`)];if(d["min-length"]&&l.length<d["min-length"])return[new a.V(T,l,`array length at least ${d["min-length"]} expected, length ${l.length} found`)];let A={type:d.value,values:d.values,minimum:d.minimum,maximum:d.maximum,function:void 0};b.$version<7&&(A.function=d.function),a.o(d.value)==="object"&&(A=d.value);let k=[];for(let L=0;L<l.length;L++)k=k.concat(S({array:l,arrayIndex:L,value:l[L],valueSpec:A,style:y,styleSpec:b,key:`${T}[${L}]`},!0));return k}function bi(g){const l=g.key,d=g.value,y=g.valueSpec;let b=a.o(d);if(b==="number"&&d!=d&&(b="NaN"),b!=="number")return[new a.V(l,d,`number expected, ${b} found`)];if("minimum"in y){let T=y.minimum;if(a.o(y.minimum)==="array"&&(T=y.minimum[g.arrayIndex]),d<T)return[new a.V(l,d,`${d} is less than the minimum value ${T}`)]}if("maximum"in y){let T=y.maximum;if(a.o(y.maximum)==="array"&&(T=y.maximum[g.arrayIndex]),d>T)return[new a.V(l,d,`${d} is greater than the maximum value ${T}`)]}return[]}function ci(g){const l=g.valueSpec,d=a.u(g.value.type);let y,b,T,S={};const A=d!=="categorical"&&g.value.property===void 0,k=!A,L=a.o(g.value.stops)==="array"&&a.o(g.value.stops[0])==="array"&&a.o(g.value.stops[0][0])==="object",B=En({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(Z){if(d==="identity")return[new a.V(Z.key,Z.value,'identity function may not have a "stops" property')];let se=[];const oe=Z.value;return se=se.concat(hn({key:Z.key,value:oe,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:U})),a.o(oe)==="array"&&oe.length===0&&se.push(new a.V(Z.key,oe,"array must have at least one stop")),se},default:function(Z){return Gi({key:Z.key,value:Z.value,valueSpec:l,style:Z.style,styleSpec:Z.styleSpec})}}});return d==="identity"&&A&&B.push(new a.V(g.key,g.value,'missing required property "property"')),d==="identity"||g.value.stops||B.push(new a.V(g.key,g.value,'missing required property "stops"')),d==="exponential"&&g.valueSpec.expression&&!a.s(g.valueSpec)&&B.push(new a.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(k&&!a.r(g.valueSpec)?B.push(new a.V(g.key,g.value,"property functions not supported")):A&&!a.t(g.valueSpec)&&B.push(new a.V(g.key,g.value,"zoom functions not supported"))),d!=="categorical"&&!L||g.value.property!==void 0||B.push(new a.V(g.key,g.value,'"property" property is required')),B;function U(Z){let se=[];const oe=Z.value,ae=Z.key;if(a.o(oe)!=="array")return[new a.V(ae,oe,`array expected, ${a.o(oe)} found`)];if(oe.length!==2)return[new a.V(ae,oe,`array length 2 expected, length ${oe.length} found`)];if(L){if(a.o(oe[0])!=="object")return[new a.V(ae,oe,`object expected, ${a.o(oe[0])} found`)];if(oe[0].zoom===void 0)return[new a.V(ae,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new a.V(ae,oe,"object stop key must have value")];const ce=a.u(oe[0].zoom);if(typeof ce!="number")return[new a.V(ae,oe[0].zoom,"stop zoom values must be numbers")];if(T&&T>ce)return[new a.V(ae,oe[0].zoom,"stop zoom values must appear in ascending order")];ce!==T&&(T=ce,b=void 0,S={}),se=se.concat(En({key:`${ae}[0]`,value:oe[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:bi,value:q}}))}else se=se.concat(q({key:`${ae}[0]`,value:oe[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},oe));return a.v(a.x(oe[1]))?se.concat([new a.V(`${ae}[1]`,oe[1],"expressions are not allowed in function stops.")]):se.concat(Gi({key:`${ae}[1]`,value:oe[1],valueSpec:l,style:Z.style,styleSpec:Z.styleSpec}))}function q(Z,se){const oe=a.o(Z.value),ae=a.u(Z.value),ce=Z.value!==null?Z.value:se;if(y){if(oe!==y)return[new a.V(Z.key,ce,`${oe} stop domain type must match previous stop domain type ${y}`)]}else y=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new a.V(Z.key,ce,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&d!=="categorical"){let xe=`number expected, ${oe} found`;return a.r(l)&&d===void 0&&(xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(Z.key,ce,xe)]}return d!=="categorical"||oe!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?d!=="categorical"&&oe==="number"&&typeof ae=="number"&&typeof b=="number"&&b!==void 0&&ae<b?[new a.V(Z.key,ce,"stop domain values must appear in ascending order")]:(b=ae,d==="categorical"&&ae in S?[new a.V(Z.key,ce,"stop domain values must be unique")]:(S[ae]=!0,[])):[new a.V(Z.key,ce,`integer expected, found ${String(ae)}`)]}}function Us(g){const l=(g.expressionContext==="property"?a.y:a.z)(a.x(g.value),g.valueSpec);if(l.result==="error")return l.value.map(y=>new a.V(`${g.key}${y.key}`,g.value,y.message));const d=l.value.expression||l.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!d.outputDefined())return[new a.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!a.A(d))return[new a.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return Ca(d,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!a.B(d,["zoom","feature-state"]))return[new a.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!a.D(d))return[new a.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ca(g,l){const d=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const b of l.valueSpec.expression.parameters)d.delete(b);if(d.size===0)return[];const y=[];return g instanceof a.F&&d.has(g.name)?[new a.V(l.key,l.value,`["${g.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(g.eachChild(b=>{y.push(...Ca(b,l))}),y)}function an(g){const l=g.key,d=g.value,y=g.valueSpec,b=[];return Array.isArray(y.values)?y.values.indexOf(a.u(d))===-1&&b.push(new a.V(l,d,`expected one of [${y.values.join(", ")}], ${JSON.stringify(d)} found`)):Object.keys(y.values).indexOf(a.u(d))===-1&&b.push(new a.V(l,d,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(d)} found`)),b}function ir(g){return a.H(a.x(g.value))?Us(a.q({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):oi(g)}function oi(g){const l=g.value,d=g.key;if(a.o(l)!=="array")return[new a.V(d,l,`array expected, ${a.o(l)} found`)];const y=g.styleSpec;let b,T=[];if(l.length<1)return[new a.V(d,l,"filter array must have at least 1 element")];switch(T=T.concat(an({key:`${d}[0]`,value:l[0],valueSpec:y.filter_operator,style:g.style,styleSpec:g.styleSpec})),a.u(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&a.u(l[1])==="$type"&&T.push(new a.V(d,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&T.push(new a.V(d,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(b=a.o(l[1]),b!=="string"&&T.push(new a.V(`${d}[1]`,l[1],`string expected, ${b} found`)));for(let S=2;S<l.length;S++)b=a.o(l[S]),a.u(l[1])==="$type"?T=T.concat(an({key:`${d}[${S}]`,value:l[S],valueSpec:y.geometry_type,style:g.style,styleSpec:g.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&T.push(new a.V(`${d}[${S}]`,l[S],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let S=1;S<l.length;S++)T=T.concat(oi({key:`${d}[${S}]`,value:l[S],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":b=a.o(l[1]),l.length!==2?T.push(new a.V(d,l,`filter array for "${l[0]}" operator must have 2 elements`)):b!=="string"&&T.push(new a.V(`${d}[1]`,l[1],`string expected, ${b} found`))}return T}function Fi(g,l){const d=g.key,y=g.style,b=g.layer,T=g.styleSpec,S=g.value,A=g.objectKey,k=T[`${l}_${g.layerType}`];if(!k)return[];const L=A.match(/^(.*)-transition$/);if(l==="paint"&&L&&k[L[1]]&&k[L[1]].transition)return Gi({key:d,value:S,valueSpec:T.transition,style:y,styleSpec:T});const B=g.valueSpec||k[A];if(!B)return[new a.n(d,S,`unknown property "${A}"`)];let U;if(a.o(S)==="string"&&a.r(B)&&!B.tokens&&(U=/^{([^}]+)}$/.exec(S))){const Z=`\`{ "type": "identity", "property": ${U?JSON.stringify(U[1]):'"_"'} }\``;return[new a.V(d,S,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}const q=[];if(g.layerType==="symbol")A!=="text-field"||!y||y.glyphs||y.imports||q.push(new a.V(d,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&a.J(a.x(S))&&a.u(S.type)==="identity"&&q.push(new a.V(d,S,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&l==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&a.r(B)&&(a.K(B)||a.t(B))){const Z=a.y(a.x(S),B),se=Z.value.expression||Z.value._styleExpression.expression;se&&!a.B(se,["measure-light"])&&(A==="model-emissive-strength"&&a.D(se)&&a.A(se)||q.push(new a.V(d,S,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(Gi({key:g.key,value:S,valueSpec:B,style:y,styleSpec:T,expressionContext:"property",propertyType:l,propertyKey:A}))}function Ps(g){return Fi(g,"paint")}function Rs(g){return Fi(g,"layout")}function Vs(g){let l=[];const d=g.value,y=g.key,b=g.style,T=g.styleSpec;d.type||d.ref||l.push(new a.V(y,d,'either "type" or "ref" is required'));let S=a.u(d.type);const A=a.u(d.ref);if(d.id){const k=a.u(d.id);for(let L=0;L<g.arrayIndex;L++){const B=b.layers[L];a.u(B.id)===k&&l.push(new a.V(y,d.id,`duplicate layer id "${d.id}", previously used at line ${B.id.__line__}`))}}if("ref"in d){let k;["type","source","source-layer","filter","layout"].forEach(L=>{L in d&&l.push(new a.V(y,d[L],`"${L}" is prohibited for ref layers`))}),b.layers.forEach(L=>{a.u(L.id)===A&&(k=L)}),k?k.ref?l.push(new a.V(y,d.ref,"ref cannot reference another ref layer")):S=a.u(k.type):typeof A=="string"&&l.push(new a.V(y,d.ref,`ref layer "${A}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(d.source){const k=b.sources&&b.sources[d.source],L=k&&a.u(k.type);k?L==="vector"&&S==="raster"?l.push(new a.V(y,d.source,`layer "${d.id}" requires a raster source`)):L==="raster"&&S!=="raster"?l.push(new a.V(y,d.source,`layer "${d.id}" requires a vector source`)):L!=="vector"||d["source-layer"]?L==="raster-dem"&&S!=="hillshade"?l.push(new a.V(y,d.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!d.paint||!d.paint["line-gradient"]&&!d.paint["line-trim-offset"]||L==="geojson"&&k.lineMetrics?S==="raster-particle"&&L!=="raster-array"&&l.push(new a.V(y,d.source,`layer "${d.id}" requires a 'raster-array' source.`)):l.push(new a.V(y,d,`layer "${d.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new a.V(y,d.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new a.V(y,d,`layer "${d.id}" must specify a "source-layer"`)):l.push(new a.V(y,d.source,`source "${d.source}" not found`))}else l.push(new a.V(y,d,'missing required property "source"'));return l=l.concat(En({key:y,value:d,valueSpec:T.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gi({key:`${y}.type`,value:d.type,valueSpec:T.layer.type,style:g.style,styleSpec:g.styleSpec,object:d,objectKey:"type"}),filter:k=>ir(a.q({layerType:S},k)),layout:k=>En({layer:d,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>Rs(a.q({layerType:S},L))}}),paint:k=>En({layer:d,key:k.key,value:k.value,valueSpec:{},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>Ps(a.q({layerType:S,layer:d},L))}})}})),l}function Ks(g){const l=g.value,d=g.key,y=a.o(l);return y!=="string"?[new a.V(d,l,`string expected, ${y} found`)]:[]}const jo={promoteId:function({key:g,value:l}){if(a.o(l)==="string")return Ks({key:g,value:l});{const d=[];for(const y in l)d.push(...Ks({key:`${g}.${y}`,value:l[y]}));return d}}};function qr(g){const l=g.value,d=g.key,y=g.styleSpec,b=g.style;if(!l.type)return[new a.V(d,l,'"type" is required')];const T=a.u(l.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&(l.url||l.tiles||S.push(new a.n(d,l,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(En({key:d,value:l,valueSpec:y[`source_${T.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:jo})),S;case"geojson":if(S=En({key:d,value:l,valueSpec:y.source_geojson,style:b,styleSpec:y,objectElementValidators:jo}),l.cluster)for(const A in l.clusterProperties){const[k,L]=l.clusterProperties[A],B=typeof k=="string"?[k,["accumulated"],["get",A]]:k;S.push(...Us({key:`${d}.${A}.map`,value:L,expressionContext:"cluster-map"})),S.push(...Us({key:`${d}.${A}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return S;case"video":return En({key:d,value:l,valueSpec:y.source_video,style:b,styleSpec:y});case"image":return En({key:d,value:l,valueSpec:y.source_image,style:b,styleSpec:y});case"canvas":return[new a.V(d,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return an({key:`${d}.type`,value:l.type,valueSpec:{values:Qa(y)},style:b,styleSpec:y})}}function Qa(g){return g.source.reduce((l,d)=>{const y=g[d];return y.type.type==="enum"&&(l=l.concat(Object.keys(y.type.values))),l},[])}function ai(g){const l=g.value,d=g.styleSpec,y=d.light,b=g.style;let T=[];const S=a.o(l);if(l===void 0)return T;if(S!=="object")return T=T.concat([new a.V("light",l,`object expected, ${S} found`)]),T;for(const A in l){const k=A.match(/^(.*)-transition$/);T=T.concat(k&&y[k[1]]&&y[k[1]].transition?Gi({key:A,value:l[A],valueSpec:d.transition,style:b,styleSpec:d}):y[A]?Gi({key:A,value:l[A],valueSpec:y[A],style:b,styleSpec:d}):[new a.V(A,l[A],`unknown property "${A}"`)])}return T}function Ai(g){const l=g.value;let d=[];if(!l)return d;const y=a.o(l);if(y!=="object")return d=d.concat([new a.V("light-3d",l,`object expected, ${y} found`)]),d;const b=g.styleSpec,T=b["light-3d"],S=g.key,A=g.style,k=g.style.lights;for(const U of["type","id"])if(!(U in l))return d=d.concat([new a.V("light-3d",l,`missing property ${U} on light`)]),d;if(l.type&&k)for(let U=0;U<g.arrayIndex;U++){const q=a.u(l.type),Z=k[U];a.u(Z.type)===q&&d.push(new a.V(S,l.id,`duplicate light type "${l.type}", previously defined at line ${Z.id.__line__}`))}const L=`properties_light_${l.type}`;if(!(L in b))return d=d.concat([new a.V("light-3d",l,`Invalid light type ${l.type}`)]),d;const B=b[L];for(const U in l)if(U==="properties"){const q=l[U],Z=a.o(q);if(Z!=="object")return d=d.concat([new a.V("properties",q,`object expected, ${Z} found`)]),d;for(const se in q)d=d.concat(B[se]?Gi({key:se,value:q[se],valueSpec:B[se],style:A,styleSpec:b}):[new a.n(g.key,q[se],`unknown property "${se}"`)])}else{const q=U.match(/^(.*)-transition$/);d=d.concat(q&&T[q[1]]&&T[q[1]].transition?Gi({key:U,value:l[U],valueSpec:b.transition,style:A,styleSpec:b}):T[U]?Gi({key:U,value:l[U],valueSpec:T[U],style:A,styleSpec:b}):[new a.n(U,l[U],`unknown property "${U}"`)])}return d}function Cl(g){const l=g.value,d=g.key,y=g.style,b=g.styleSpec,T=b.terrain;let S=[];const A=a.o(l);if(l===void 0||A==="null")return S;if(A!=="object")return S=S.concat([new a.V("terrain",l,`object expected, ${A} found`)]),S;for(const k in l){const L=k.match(/^(.*)-transition$/);S=S.concat(L&&T[L[1]]&&T[L[1]].transition?Gi({key:k,value:l[k],valueSpec:b.transition,style:y,styleSpec:b}):T[k]?Gi({key:k,value:l[k],valueSpec:T[k],style:y,styleSpec:b}):[new a.n(k,l[k],`unknown property "${k}"`)])}if(l.source){const k=y.sources&&y.sources[l.source],L=k&&a.u(k.type);k?L!=="raster-dem"&&S.push(new a.V(d,l.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):S.push(new a.V(d,l.source,`source "${l.source}" not found`))}else S.push(new a.V(d,l,'terrain is missing required property "source"'));return S}function Aa(g){const l=g.value,d=g.style,y=g.styleSpec,b=y.fog;let T=[];const S=a.o(l);if(l===void 0)return T;if(S!=="object")return T=T.concat([new a.V("fog",l,`object expected, ${S} found`)]),T;for(const A in l){const k=A.match(/^(.*)-transition$/);T=T.concat(k&&b[k[1]]&&b[k[1]].transition?Gi({key:A,value:l[A],valueSpec:y.transition,style:d,styleSpec:y}):b[A]?Gi({key:A,value:l[A],valueSpec:b[A],style:d,styleSpec:y}):[new a.n(A,l[A],`unknown property "${A}"`)])}return T}const vo={"*":()=>[],array:hn,boolean:function(g){const l=g.value,d=g.key,y=a.o(l);return y!=="boolean"?[new a.V(d,l,`boolean expected, ${y} found`)]:[]},number:bi,color:function(g){const l=g.key,d=g.value,y=a.o(d);return y!=="string"?[new a.V(l,d,`color expected, ${y} found`)]:a.G(d)===null?[new a.V(l,d,`color expected, "${d}" found`)]:[]},enum:an,filter:ir,function:ci,layer:Vs,object:En,source:qr,model:a.L,light:ai,"light-3d":Ai,terrain:Cl,fog:Aa,string:Ks,formatted:function(g){return Ks(g).length===0?[]:Us(g)},resolvedImage:function(g){return Ks(g).length===0?[]:Us(g)},projection:function(g){const l=g.value,d=g.styleSpec,y=d.projection,b=g.style;let T=[];const S=a.o(l);if(S==="object")for(const A in l)T=T.concat(Gi({key:A,value:l[A],valueSpec:y[A],style:b,styleSpec:d}));else S!=="string"&&(T=T.concat([new a.V("projection",l,`object or string expected, ${S} found`)]));return T},import:function(g){const{value:l,styleSpec:d}=g,S=l,{data:y}=S,b=On(S,["data"]);Object.defineProperty(b,"__line__",{value:l.__line__,enumerable:!1});let T=En(a.q({},g,{value:b,valueSpec:d.import}));return a.u(b.id)===""&&T.push(new a.V(`${g.key}.id`,b,"import id can't be an empty string")),y&&(T=T.concat(Ve(y,d,{key:`${g.key}.data`}))),T}};function Gi(g,l=!1){const d=g.value,y=g.valueSpec,b=g.styleSpec;if(y.expression&&a.J(a.u(d)))return ci(g);if(y.expression&&a.v(a.x(d)))return Us(g);if(y.type&&vo[y.type]){const T=vo[y.type](g);return l===!0&&T.length>0&&a.o(g.value)==="array"?Us(g):T}return En(a.q({},g,{valueSpec:y.type?b[y.type]:y}))}function Ju(g){const l=g.value,d=g.key,y=Ks(g);return y.length||(l.indexOf("{fontstack}")===-1&&y.push(new a.V(d,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&y.push(new a.V(d,l,'"glyphs" url must include a "{range}" token'))),y}function Ve(g,l=a.N,d={}){return Gi({key:d.key||"",value:g,valueSpec:l.$root,styleSpec:l,style:g,objectElementValidators:{glyphs:Ju,"*":()=>[]}})}function ne(g,l=a.N){return Qt(Ve(g,l))}const le=g=>Qt(qr(g)),Te=g=>Qt(ai(g)),Le=g=>Qt(Ai(g)),Oe=g=>Qt(Cl(g)),He=g=>Qt(Aa(g)),st=g=>Qt(Vs(g)),We=g=>Qt(ir(g)),rt=g=>Qt(Ps(g)),wt=g=>Qt(Rs(g)),Tt=g=>Qt(a.L(g));function Qt(g){return g.slice().sort((l,d)=>l.line&&d.line?l.line-d.line:0)}function _n(g,l){let d=!1;if(l&&l.length)for(const y of l)y instanceof a.n?a.w(y.message):(g.fire(new a.f(new Error(y.message))),d=!0);return d}let Cn;class ur extends a.E{constructor(l,d="flat"){super(),this._transitionable=new a.O(Cn||(Cn=new a.U({anchor:new a.W(a.N.light.anchor),position:new a.X(a.N.light.position),color:new a.W(a.N.light.color),intensity:new a.W(a.N.light.intensity)}))),this.setLight(l,d),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d,y={}){this._validate(Te,l,y)||(this._transitionable.setTransitionOrValue(l),this.id=d)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,y){return(!y||y.validate!==!1)&&_n(this,l.call(ne,a.Q({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}const Dn=new a.U({source:new a.W(a.N.terrain.source),exaggeration:new a.W(a.N.terrain.exaggeration)});let hr=class extends a.E{constructor(g,l,d,y){super(),this.scope=d,this._transitionable=new a.O(Dn,d,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g,l){this._transitionable.setTransitionOrValue(g,l)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new a.Y(g)).get("exaggeration")}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof a.Z}};const dn=45,Jr=65,vr=.05;function dr(g,l,d,y){const b=a.a0(dn,Jr,d),[T,S]=wi(g,y);let A=1-Math.min(1,Math.exp((l-T)/(S-T)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*b*g.alpha}function wi(g,l){const d=.5/Math.tan(.5*l);return[g.range[0]+d,g.range[1]+d]}function Ti(g,l,d,y,b){const T=a.$.transformMat4([],[l,d,y],b.mercatorFogMatrix);return dr(g,a.$.length(T),b.pitch,b._fov)}function Yi(g,l,d,y,b,T,S){const A=[[d,y,0],[b,y,0],[b,T,0],[d,T,0]];let k=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const B of A){const U=a.$.transformMat4([],B,l),q=a.$.length(U);k=Math.min(k,q),L=Math.max(L,q)}return[dr(g,k,S.pitch,S._fov),dr(g,L,S.pitch,S._fov)]}const Ms=new a.U({range:new a.W(a.N.fog.range),color:new a.W(a.N.fog.color),"high-color":new a.W(a.N.fog["high-color"]),"space-color":new a.W(a.N.fog["space-color"]),"horizon-blend":new a.W(a.N.fog["horizon-blend"]),"star-intensity":new a.W(a.N.fog["star-intensity"]),"vertical-range":new a.W(a.N.fog["vertical-range"])});class Qs extends a.E{constructor(l,d,y,b){super(),this._transitionable=new a.O(Ms,y,new Map(b)),this.set(l,b),this._transitioning=this._transitionable.untransitioned(),this._transform=d,this.properties=new a.a1(Ms),this.scope=y}get state(){const l=this._transform,d=l.projection.name==="globe",y=a.a2(l.zoom),b=this.properties.get("range"),T=[.5,3];return{range:d?[a.a3(T[0],b[0],y),a.a3(T[1],b[1],y)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,d,y={}){if(this._validate(He,l,y))return;const b=a.Q({},l);for(const T of Object.keys(a.N.fog))b[T]===void 0&&(b[T]=a.N.fog[T].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,d)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.a0(dn,Jr,l))*d.a}getOpacityAtLatLng(l,d){return this._transform.projection.supportsFog?function(y,b,T){const S=a._.fromLngLat(b),A=T.elevation?T.elevation.getAtPointOrZero(S):0;return Ti(y,S.x,S.y,A,T)}(this.state,l,d):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const d=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Yi(this.state,d,0,0,a.a4,a.a4,this._transform)}getOpacityForBounds(l,d,y,b,T){return this._transform.projection.supportsFog?Yi(this.state,l,d,y,b,T,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?wi(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const d=[4,5,6,7];for(const y of d){const b=l.points[y];let T;if(b[2]>=0)T=b;else{const S=l.points[y-4];T=a.a5(S,b,S[2]/(S[2]-b[2]))}if(Ti(this.state,T[0],T[1],0,this._transform)>=vr)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,y){return(!y||y.validate!==!1)&&_n(this,l.call(ne,a.Q({value:d,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}class sc extends a.E{constructor(l,d,y,b){super(),this.scope=y,this._options=l,this.properties=new a.a1(d),this._transitionable=new a.O(d,y,new Map(b)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,d){this._options=l,this._transitionable.setTransitionOrValue(l.properties,d)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let dd,fd;var eh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Nn=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Uo=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,sa="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Xc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,pd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,fi=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Kc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,oc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ac=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,sp=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Qc=[];Po(eh,Qc),Po(Uo,Qc),Po(Nn,Qc);const th={"_prelude_fog.vertex.glsl":pd,"_prelude_terrain.vertex.glsl":Xc,"_prelude_shadow.vertex.glsl":ac,"_prelude_fog.fragment.glsl":fi,"_prelude_shadow.fragment.glsl":sp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Kc,"_prelude_raster_particle.glsl":oc},md={};fr("",Xc),fr(fi,pd),fr(sp,ac),fr(Kc,""),fr(oc,"");const gd=fr(Nn,Uo),pg=eh;var Yc={background:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:fr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:fr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:fr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:fr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:fr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:fr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:fr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:fr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:fr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:fr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:fr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:fr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:fr(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:fr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:fr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:fr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:fr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,sa),skyboxGradient:fr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,sa),skyboxCapture:fr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:fr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:fr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:fr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:fr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:fr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Po(g,l){const d=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of d)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=y.split(" ");for(const T of b)l.includes(T)||l.push(T)}}function fr(g,l){const d=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(L=>{const B=L.split(" ");return B[B.length-1]}),b=[...new Set(b)]);const T={},S=[],A=[];if(g=g.replace(d,(L,B)=>(A.push(B),"")),(l=l.replace(d,(L,B)=>(S.push(B),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let k=[...Qc];Po(g,k),Po(l,k);for(const L of[...S,...A])th[L]||console.error(`Undefined include: ${L}`),md[L]||(md[L]=[],Po(th[L],md[L])),k=[...k,...md[L]];return{fragmentSource:g=g.replace(y,(L,B,U,q,Z)=>(T[Z]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
in ${U} ${q} ${Z};
#else
uniform ${U} ${q} u_${Z};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${Z}
    ${U} ${q} ${Z} = u_${Z};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    in ${U} ${q} ${Z};
#endif
`:B==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(y,(L,B,U,q,Z)=>{const se=q==="float"?"vec2":q,oe=Z.match(/color/)?"color":se;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
in ${U} ${q} a_${Z};
#endif
`:T[Z]?B==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${U} ${se} a_${Z};
out ${U} ${q} ${Z};
#else
uniform ${U} ${q} u_${Z};
#endif
`:B==="initialize"?oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${U} ${q} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${oe}(a_${Z}, u_${Z}_t);
#else
    ${U} ${q} ${Z} = u_${Z};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    in ${U} ${q} a_${Z};
    out ${U} ${q} ${Z};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    ${Z} = a_${Z};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
in ${U} ${se} a_${Z};
#else
uniform ${U} ${q} u_${Z};
#endif
`:B==="define-instanced"?oe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Z}0;
in vec4 a_${Z}1;
in vec4 a_${Z}2;
in vec4 a_${Z}3;
#else
uniform ${U} ${q} u_${Z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${se} a_${Z};
#else
uniform ${U} ${q} u_${Z};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Z}
    ${U} ${q} ${Z} = a_${Z};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${U} ${q} ${Z} = a_${Z};
#else
    ${U} ${q} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${U} ${q} ${Z} = unpack_mix_${oe}(a_${Z}, u_${Z}_t);
#else
    ${U} ${q} ${Z} = u_${Z};
#endif
`}),staticAttributes:b,usedDefines:k,vertexIncludes:S,fragmentIncludes:A}}class mg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,d,y,b,T,S,A,k){this.context=l;let L=this.boundPaintVertexBuffers.length!==b.length;for(let U=0;!L&&U<b.length;U++)this.boundPaintVertexBuffers[U]!==b[U]&&(L=!0);let B=this.boundDynamicVertexBuffers.length!==A.length;for(let U=0;!B&&U<A.length;U++)this.boundDynamicVertexBuffers[U]!==A[U]&&(B=!0);if(!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==y||L||B||this.boundIndexBuffer!==T||this.boundVertexOffset!==S)this.freshBind(d,y,b,T,S,A,k);else{l.bindVertexArrayOES.set(this.vao);for(const U of A)U&&(U.bind(),k&&U.instanceCount&&U.setVertexAttribDivisor(l.gl,d,k));T&&T.dynamicDraw&&T.bind()}}freshBind(l,d,y,b,T,S,A){const k=l.numAttributes,L=this.context,B=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=S,d.enableAttributes(B,l),d.bind(),d.setVertexAttribPointers(B,l,T);for(const U of y)U.enableAttributes(B,l),U.bind(),U.setVertexAttribPointers(B,l,T);for(const U of S)U&&(U.enableAttributes(B,l),U.bind(),U.setVertexAttribPointers(B,l,T),A&&U.instanceCount&&U.setVertexAttribDivisor(B,l,A));b&&b.bind(),L.currentNumAttributes=k}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function gg(g,l){const d=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new a._(0,y/d).toLngLat().lat,new a._(0,(y+1)/d).toLngLat().lat]}function Jc(g,l,d,y,b,T,S){const A=g.context,k=A.gl,L=d.hillshadeFBO;if(!L)return;g.prepareDrawTile();const B=g.isTileAffectedByFog(l),U=g.getOrCreateProgram("hillshade",{overrideFog:B});A.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get());const q=((ae,ce,xe,be)=>{const ve=xe.paint.get("hillshade-shadow-color"),ke=xe.paint.get("hillshade-highlight-color"),Ce=xe.paint.get("hillshade-accent-color"),Ae=xe.paint.get("hillshade-emissive-strength");let Ne=a.ac(xe.paint.get("hillshade-illumination-direction"));if(xe.paint.get("hillshade-illumination-anchor")==="viewport")Ne-=ae.transform.angle;else if(ae.style&&ae.style.enable3dLights()&&ae.style.directionalLight){const Ze=ae.style.directionalLight.properties.get("direction"),je=a.ad(Ze.x,Ze.y,Ze.z);Ne=a.ac(je[1])}const Fe=!ae.options.moving;return{u_matrix:be||ae.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:gg(0,ce.tileID),u_light:[xe.paint.get("hillshade-exaggeration"),Ne],u_shadow:ve.toRenderColor(xe.lut),u_highlight:ke.toRenderColor(xe.lut),u_emissive_strength:Ae,u_accent:Ce.toRenderColor(xe.lut)}})(g,d,y,g.terrain?l.projMatrix:null);g.uploadCommonUniforms(A,U,l.toUnwrapped());const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:se,tileBoundsSegments:oe}=g.getTileBoundsBuffers(d);U.draw(g,k.TRIANGLES,b,T,S,a.ag.disabled,q,y.id,Z,se,oe)}function _g(g,l,d){if(!l.needsDEMTextureUpload)return;const y=g.context,b=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(d.stride);const T=d.getPixels();l.demTexture?l.demTexture.update(T,{premultiply:!1}):l.demTexture=new a.T(y,T,b.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function _0(g,l,d){const y=g.context,b=y.gl;if(!l.dem)return;const T=l.dem;if(y.activeTexture.set(b.TEXTURE1),_g(g,l,T),!l.demTexture)return;l.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const S=T.dim;y.activeTexture.set(b.TEXTURE0);let A=l.hillshadeFBO;if(!A){const q=new a.T(y,{width:S,height:S,data:null},b.RGBA);q.bind(b.LINEAR,b.CLAMP_TO_EDGE),A=l.hillshadeFBO=y.createFramebuffer(S,S,!0,"renderbuffer"),A.colorAttachment.set(q.texture)}y.bindFramebuffer.set(A.framebuffer),y.viewport.set([0,0,S,S]);const{tileBoundsBuffer:k,tileBoundsIndexBuffer:L,tileBoundsSegments:B}=g.getMercatorTileBoundsBuffers(),U=[];g.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(g,b.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,((q,Z)=>{const se=Z.stride,oe=a.ae.create();return a.ae.ortho(oe,0,a.a4,-a.a4,0,0,1),a.ae.translate(oe,oe,[0,-a.a4,0]),{u_matrix:oe,u_image:1,u_dimension:[se,se],u_zoom:q.overscaledZ}})(l.tileID,T),d.id,k,L,B),l.needsHillshadePrepare=!1}function op(g,l,d,y,b){const T=function(A,k){if(A)return b(A);if(k){if(g.url&&k.tiles&&g.tiles&&delete g.tiles,k.variants){if(!Array.isArray(k.variants))return b(new Error("variants must be an array"));for(const B of k.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return b(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){k=a.Q(k,B);break}}}const L=a.ai(a.Q(k,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(L.vectorLayers=k.vector_layers,L.vectorLayerIds=L.vectorLayers.map(B=>B.id)),k.raster_layers&&(L.rasterLayers=k.raster_layers,L.rasterLayerIds=L.rasterLayers.map(B=>B.id)),L.tiles=l.canonicalizeTileset(L,g.url),b(null,L)}},S=function(A,k,L){if(!A)return null;if(!k&&!L)return A;L=L||A.worldview_default;const B=Object.values(A.language||{});if(B.length===0)return null;const U=Object.values(A.worldview||{});if(U.length===0)return null;const q=B.every(se=>se===k),Z=U.every(se=>se===L);return q&&Z?A:k in(A.language_options||{})||L in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null}(g.data,d,y);return S?a.e.frame(()=>T(null,S)):g.url?a.h(l.transformRequest(l.normalizeSourceURL(g.url,null,d,y),a.R.Source),T):a.e.frame(()=>{const L=g,{data:A}=L,k=On(L,["data"]);T(null,k)})}class Vo{constructor(l,d,y){this.bounds=a.aj.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),y=Math.floor(a.ak(this.bounds.getWest())*d),b=Math.floor(a.al(this.bounds.getNorth())*d),T=Math.ceil(a.ak(this.bounds.getEast())*d),S=Math.ceil(a.al(this.bounds.getSouth())*d);return l.x>=y&&l.x<T&&l.y>=b&&l.y<S}}class Ro extends a.E{constructor(l,d,y,b){super(),this.id=l,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.Q({type:"raster"},d),a.Q(this,a.ai(d,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._tileJSONRequest=op(this._options,this.map._requestManager,null,null,(d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new a.f(d)):y&&(a.Q(this,y),y.bounds&&(this.tileBounds=new Vo(y.bounds,this.minzoom,this.maxzoom)),a.ao(y.tiles),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(d)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){const y=a.e.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);l.request=a.i(this.map._requestManager.transformRequest(b,a.R.Tile),(T,S,A,k)=>(delete l.request,l.aborted?(l.state="unloaded",d(null)):T?(l.state="errored",d(T)):S?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:A,expires:k}),l.setTexture(S,this.map.painter),l.state="loaded",a.an(this.dispatcher),void d(null)):d(null)))}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d&&d()}unloadTile(l,d){l.texture&&l.texture instanceof a.T?(l.destroy(!0),l.texture&&l.texture instanceof a.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),d&&d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class yg extends a.E{constructor(l,d,y,b){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.Q(this,a.ai(d,["url","scheme","tileSize","promoteId"])),this._options=a.Q({type:"vector"},d),this._collectResourceTiming=!!d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new a.ap}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=op(this._options,this.map._requestManager,d,y,(b,T)=>{this._tileJSONRequest=null,this._loaded=!0,b?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),y&&y.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new a.f(b))):T&&(a.Q(this,T),T.bounds&&(this.tileBounds=new Vo(T.bounds,this.minzoom,this.maxzoom)),a.ao(T.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(b)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}loadTile(l,d){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),b=this.map._requestManager.transformRequest(y,a.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,S={request:b,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,lut:T?{image:T.image.clone()}:null,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=d:l.request=l.actor.send("reloadTile",S,A.bind(this));else if(l.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",S,A.bind(this),void 0,!0);else{const k=a.aq.call({deduped:this._deduped},S,(L,B)=>{L||!B?A.call(this,L):(S.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},l.actor&&l.actor.send("loadTile",S,A.bind(this),void 0,!0))},!0);l.request={cancel:k}}function A(k,L){return delete l.request,l.aborted?d(null):k&&k.status!==404?d(k):(L&&L.resourceTiming&&(l.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&l.setExpiryData(L),l.loadVectorData(L,this.map.painter),a.an(this.dispatcher),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,d){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const eu=(g,l,d)=>({u_matrix:g,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:d}),tu=(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:d,u_zoom_transition:b,u_merc_center:T,u_image0:0,u_frustum_tl:S,u_frustum_tr:A,u_frustum_br:k,u_frustum_bl:L,u_globe_pos:B,u_globe_radius:U,u_viewport:q,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:Z,u_far_z_cutoff:se});class nu{constructor(l=0,d=0,y=0,b=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=y,this.right=b}interpolate(l,d,y){return d.top!=null&&l.top!=null&&(this.top=a.a3(l.top,d.top,y)),d.bottom!=null&&l.bottom!=null&&(this.bottom=a.a3(l.bottom,d.bottom,y)),d.left!=null&&l.left!=null&&(this.left=a.a3(l.left,d.left,y)),d.right!=null&&l.right!=null&&(this.right=a.a3(l.right,d.right,y)),this}getCenter(l,d){const y=a.au((this.left+l-this.right)/2,0,l),b=a.au((this.top+d-this.bottom)/2,0,d);return new a.P(y,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new nu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function oa(g,l){const d=a.ax(g,3);a.ae.fromQuat(g,l),a.aA(g,3,d)}function Ft(g,l){const d=a.aw.identity([]);return a.aw.rotateZ(d,d,-l),a.aw.rotateX(d,d,-g),d}function lc(g,l){const d=[g[0],g[1],0],y=[l[0],l[1],0];if(a.$.length(d)>=1e-15){const S=a.$.normalize([],d);a.$.scale(y,S,a.$.dot(y,S)),l[0]=y[0],l[1]=y[1]}const b=a.$.cross([],l,g);if(a.$.len(b)<1e-15)return null;const T=Math.atan2(-b[1],b[0]);return Ft(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),T)}class _d{constructor(l,d){this.position=l,this.orientation=d}get position(){return this._position}set position(l){if(l){const d=l instanceof a._?l:new a._(l[0],l[1],l[2]);this._renderWorldCopies&&(d.x=a.av(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(l,d){if(this.orientation=null,!this.position)return;const y=this.position,b=this._elevation?this._elevation.getAtPointOrZero(a._.fromLngLat(l)):0,T=a._.fromLngLat(l,b),S=[T.x-y.x,T.y-y.y,T.z-y.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=lc(S,d)}setPitchBearing(l,d){this.orientation=Ft(a.ac(l),a.ac(-d))}}class pi{constructor(l,d){this._transform=a.ae.identity([]),this.orientation=d,this.position=l}get mercatorPosition(){const l=this.position;return new a._(l[0],l[1],l[2])}get position(){const l=a.ax(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var d;l&&a.aA(this._transform,3,[(d=l)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||a.aw.identity([]),l&&oa(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,d){this._orientation=Ft(l,d),oa(this._transform,this._orientation)}forward(){const l=a.ax(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=a.ax(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=a.ax(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,d){const y=new Float64Array(16);return a.ae.invert(y,this.getWorldToCamera(l,d)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,d,y){const b=this.position;a.$.scale(b,b,-l);const T=new Float64Array(16);return a.ae.fromScaling(T,[y,y,y]),a.ae.translate(T,T,b),T[10]*=d,T}getWorldToCamera(l,d){const y=new Float64Array(16),b=new Float64Array(4),T=this.position;return a.aw.conjugate(b,this._orientation),a.$.scale(T,T,-l),a.ae.fromQuat(y,b),a.ae.translate(y,y,T),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=d,y[9]*=d,y[10]*=d,y[11]*=d,y}getCameraToClipPerspective(l,d,y,b){const T=new Float64Array(16);return a.ae.perspective(T,l,d,y,b),T}getCameraToClipOrthographic(l,d,y,b,T,S){const A=new Float64Array(16);return a.ae.ortho(A,l,d,y,b,T,S),A}getDistanceToElevation(l,d=!1){const y=l===0?0:a.ay(l,d?a.az(this.position[1]):this.position[1]),b=this.forward();return(y-this.position[2])/b[2]}clone(){return new pi([...this.position],[...this.orientation])}}const sr={unknown:0,flipRequired:1,flipNotRequired:2},oo=Math.tan(85*Math.PI/180);function ru(g,l,d,y,b,T,S){const A=a.ae.create();if(d)if(T.name==="globe"){const k=a.aC(b,l);a.ae.multiply(A,A,k)}else{const k=a.aD.invert([],S);A[0]=k[0],A[1]=k[1],A[4]=k[2],A[5]=k[3],y||a.ae.rotateZ(A,A,b.angle)}else a.ae.multiply(A,b.labelPlaneMatrix,g);return A}function nh(g,l,d,y,b,T,S){const A=ru(g,l,d,y,b,T,S);return T.name==="globe"&&d||(A[2]=A[6]=A[10]=A[14]=0),A}function rh(g,l,d,y,b,T,S){if(d){if(T.name==="globe"){const A=ru(g,l,d,y,b,T,S);return a.ae.invert(A,A),a.ae.multiply(A,g,A),A}{const A=a.ae.clone(g),k=a.ae.identity([]);return k[0]=S[0],k[1]=S[1],k[4]=S[2],k[5]=S[3],a.ae.multiply(A,A,k),y||a.ae.rotateZ(A,A,-b.angle),A}}return b.glCoordMatrix}function xo(g,l,d,y){const b=[g,l,d,1];d?a.aB.transformMat4(b,b,y):ap(b,b,y);const T=b[3];return b[0]/=T,b[1]/=T,b[2]/=T,b}function Yn(g,l){return Math.min(.5+g/l*.5,1.5)}function aa(g,l){const d=g[0]/g[3],y=g[1]/g[3];return d>=-l[0]&&d<=l[0]&&y>=-l[1]&&y<=l[1]}function cc(g,l,d,y,b,T,S,A,k,L){const B=d.transform,U=y?g.textSizeData:g.iconSizeData,q=a.aE(U,d.transform.zoom),Z=B.projection.name==="globe",se=[256/d.width*2+1,256/d.height*2+1],oe=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();let ae=null;Z&&(ae=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const ce=g.lineVertexArray,xe=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,be=d.transform.width/d.transform.height;let ve,ke=!1;for(let Ce=0;Ce<xe.length;Ce++){const Ae=xe.get(Ce),{numGlyphs:Ne,writingMode:Fe}=Ae;if(Fe!==a.aF.vertical||ke||ve===a.aF.horizontal||(ke=!0),ve=Fe,(Ae.hidden||Fe===a.aF.vertical)&&!ke){Pa(Ne,oe);continue}ke=!1;const Ze=new a.P(Ae.tileAnchorX,Ae.tileAnchorY);let{x:je,y:Me,z:nt}=B.projection.projectTilePoint(Ze.x,Ze.y,L.canonical);if(k){const[Vt,Ht,ln]=k(Ze);je+=Vt,Me+=Ht,nt+=ln}const et=[je,Me,nt,1];if(a.aB.transformMat4(et,et,l),!aa(et,se)){Pa(Ne,oe);continue}const qe=et[3],St=Yn(d.transform.getCameraToCenterDistance(B.projection),qe),yt=a.aG(U,q,Ae),Xe=S?yt/St:yt*St,ot=xo(je,Me,nt,b);if(ot[3]<=0){Pa(Ne,oe);continue}let $e={};const vt=S?null:k,bt=ks(Ae,Xe,!1,A,l,b,T,g.glyphOffsetArray,ce,oe,ae,ot,Ze,$e,be,vt,B.projection,L,S);ke=bt.useVertical,vt&&bt.needsFlipping&&($e={}),(bt.notEnoughRoom||ke||bt.needsFlipping&&ks(Ae,Xe,!0,A,l,b,T,g.glyphOffsetArray,ce,oe,ae,ot,Ze,$e,be,vt,B.projection,L,S).notEnoughRoom)&&Pa(Ne,oe)}y?(g.text.dynamicLayoutVertexBuffer.updateData(oe),ae&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(ae)):(g.icon.dynamicLayoutVertexBuffer.updateData(oe),ae&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(ae))}function ih(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe){const{lineStartIndex:ae,glyphStartIndex:ce,segment:xe}=A,be=ce+A.numGlyphs,ve=ae+A.lineLength,ke=l.getoffsetX(ce),Ce=l.getoffsetX(be-1),Ae=dc(g*ke,d,y,b,T,S,xe,ae,ve,k,L,B,U,q,!0,Z,se,oe);if(!Ae)return null;const Ne=dc(g*Ce,d,y,b,T,S,xe,ae,ve,k,L,B,U,q,!0,Z,se,oe);return Ne?{first:Ae,last:Ne}:null}function uc(g,l,d,y){return g===a.aF.horizontal&&Math.abs(y)>Math.abs(d)?{useVertical:!0}:g===a.aF.vertical?y>0?{needsFlipping:!0}:null:l!==sr.unknown&&function(b,T){return b===0||Math.abs(T/b)>oo}(d,y)?l===sr.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null}function ks(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe,ae,ce,xe){const be=l/24,ve=g.lineOffsetX*be,ke=g.lineOffsetY*be,{lineStartIndex:Ce,glyphStartIndex:Ae,numGlyphs:Ne,segment:Fe,writingMode:Ze,flipState:je}=g,Me=Ce+g.lineLength,nt=et=>{if(B){const[Xe,ot,$e]=et.up,vt=L.length;a.aH(B,vt+0,Xe,ot,$e),a.aH(B,vt+1,Xe,ot,$e),a.aH(B,vt+2,Xe,ot,$e),a.aH(B,vt+3,Xe,ot,$e)}const[qe,St,yt]=et.point;a.aI(L,qe,St,yt,et.angle)};if(Ne>1){const et=ih(be,A,ve,ke,d,U,q,g,k,T,Z,oe,!1,ae,ce,xe);if(!et)return{notEnoughRoom:!0};if(y&&!d){let[qe,St,yt]=et.first.point,[Xe,ot,$e]=et.last.point;[qe,St]=xo(qe,St,yt,S),[Xe,ot]=xo(Xe,ot,$e,S);const vt=uc(Ze,je,(Xe-qe)*se,ot-St);if(g.flipState=vt&&vt.needsFlipping?sr.flipRequired:sr.flipNotRequired,vt)return vt}nt(et.first);for(let qe=Ae+1;qe<Ae+Ne-1;qe++){const St=dc(be*A.getoffsetX(qe),ve,ke,d,U,q,Fe,Ce,Me,k,T,Z,oe,!1,!1,ae,ce,xe);if(!St)return L.length-=4*(qe-Ae),{notEnoughRoom:!0};nt(St)}nt(et.last)}else{if(y&&!d){const qe=xo(q.x,q.y,0,b),St=Ce+Fe+1,yt=new a.P(k.getx(St),k.gety(St)),Xe=xo(yt.x,yt.y,0,b),ot=Xe[3]>0?Xe:hc(q,yt,qe,1,b,void 0,ae,ce.canonical),$e=uc(Ze,je,(ot[0]-qe[0])*se,ot[1]-qe[1]);if(g.flipState=$e&&$e.needsFlipping?sr.flipRequired:sr.flipNotRequired,$e)return $e}const et=dc(be*A.getoffsetX(Ae),ve,ke,d,U,q,Fe,Ce,Me,k,T,Z,oe,!1,!1,ae,ce,xe);if(!et)return{notEnoughRoom:!0};nt(et)}return{}}function yd(g,l,d,y,b){const{x:T,y:S,z:A}=y.projectTilePoint(g.x,g.y,l);if(!b)return xo(T,S,A,d);const[k,L,B]=b(g);return xo(T+k,S+L,A+B,d)}function hc(g,l,d,y,b,T,S,A){const k=yd(g.sub(l)._unit()._add(g),A,b,S,T);return a.$.sub(k,d,k),a.$.normalize(k,k),a.$.scaleAndAdd(k,d,k,y)}function dc(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe,ae,ce){const xe=y?g-l:g+l;let be=xe>0?1:-1,ve=0;y&&(be*=-1,ve=Math.PI),be<0&&(ve+=Math.PI);let ke=A+S+(be>0?0:1)|0,Ce=b,Ae=b,Ne=0,Fe=0;const Ze=Math.abs(xe),je=[],Me=[];let nt=T,et=nt;const qe=()=>hc(et,nt,Ae,Ze-Ne+1,B,q,oe,ae.canonical);for(;Ne+Fe<=Ze;){if(ke+=be,ke<A||ke>=k)return null;if(Ae=Ce,et=nt,je.push(Ae),Z&&Me.push(et),nt=new a.P(L.getx(ke),L.gety(ke)),Ce=U[ke],!Ce){const Ht=yd(nt,ae.canonical,B,oe,q);Ce=Ht[3]>0?U[ke]=Ht:qe()}Ne+=Fe,Fe=a.$.distance(Ae,Ce)}se&&q&&(U[ke]&&(Ce=qe(),Fe=a.$.distance(Ae,Ce)),U[ke]=Ce);const St=(Ze-Ne)/Fe,yt=nt.sub(et)._mult(St)._add(et),Xe=a.$.sub([],Ce,Ae),ot=a.$.scaleAndAdd([],Ae,Xe,St);let $e=[0,0,1],vt=Xe[0],bt=Xe[1];if(ce&&($e=oe.upVector(ae.canonical,yt.x,yt.y),$e[0]!==0||$e[1]!==0||$e[2]!==1)){const Ht=[$e[2],0,-$e[0]],ln=a.$.cross([],$e,Ht);a.$.normalize(Ht,Ht),a.$.normalize(ln,ln),vt=a.$.dot(Xe,Ht),bt=a.$.dot(Xe,ln)}if(d){const Ht=a.$.cross([],$e,Xe);a.$.normalize(Ht,Ht),a.$.scaleAndAdd(ot,ot,Ht,d*be)}const Vt=ve+Math.atan2(bt,vt);return je.push(ot),Z&&Me.push(yt),{point:ot,angle:Vt,path:je,tilePath:Me,up:$e}}function Pa(g,l){const d=l.length,y=d+4*g;l.resize(y),l.float32.fill(-1/0,4*d,4*y)}function ap(g,l,d){const y=l[0],b=l[1];return g[0]=d[0]*y+d[4]*b+d[12],g[1]=d[1]*y+d[5]*b+d[13],g[3]=d[3]*y+d[7]*b+d[15],g}const sh=(g,l,d)=>(1-d)*g+d*l,Ya=g=>g*g*g*g*g;class iu{constructor(l,d,y,b,T,S,A){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=y!=null?y:0,this._maxPitch=b!=null?b:60,this.setProjection(S),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new a.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new nu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new pi,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new iu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,d=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(l||y)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return a.ai(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=a.aK(this.projectionOptions);const y=this.getProjection(),b=!a.d(d,y);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.aK({name:"mercator"});const d=l!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.av(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const d=-l*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=a.aD.create(),a.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=a.au(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=a.ac(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,d=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!d||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;d||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let b=0,T=0;for(let S=0;S<d.length;S++){const A=new a.P(d[S][0]*this.width,y+d[S][1]*(this.height-y)),k=l.pointCoordinate(A);if(!k)continue;const L=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);b+=k[3]*L,T+=L}return T===0?NaN:b/T}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*d,b=this._mercatorZfromZoom(l),T=this._mercatorZfromZoom(this._maxZoom),S=Math.max(b-y,T);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let y;y=l.z<this._camera.position[2]?[d.x,d.y,d.z]:[l.x,l.y,l.z];const b=a.$.length(a.$.sub([],this._camera.position,y));return a.au(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let d=!1;if(l.orientation&&!a.aw.exactEquals(l.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(l.orientation)),l.position){const y=[l.position.x,l.position.y,l.position.z];a.$.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,d=new _d;return d.position=new a._(l[0],l[1],l[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(l){if(!a.aw.length(l))return!1;a.aw.normalize(l,l);const d=a.$.transformQuat([],[0,0,-1],l),y=a.$.transformQuat([],[0,-1,0],l);if(y[2]<0)return!1;const b=lc(d,y);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(l){const d=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;l[2]=a.au(l[2],b/y,b/d),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,y){this._unmodified=!1,this._edgeInsets.interpolate(l,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new a.aL(0,l)];if(this.renderWorldCopies){const y=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),T=this.pointCoordinate(new a.P(this.width,this.height)),S=this.pointCoordinate(new a.P(0,this.height)),A=Math.floor(Math.min(y.x,b.x,T.x,S.x)),k=Math.floor(Math.max(y.x,b.x,T.x,S.x)),L=1;for(let B=A-L;B<=k+L;B++)B!==0&&d.push(new a.aL(B,l))}return d}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(l,d,y){let b=[];const T=y!==void 0,S=!T;if(S&&this.zoom<d||T&&y[0]===0&&y[1]===0)return b;const A=new Set,k=(B,U,q,Z,se)=>{const oe=a.b2(U,B,q,Z,se);A.has(oe)||(b.push(new a.aQ(B,U,q,Z,se)),A.add(oe))};for(let B=0;B<l.length;B++){const U=l[B];if(S&&U.canonical.z!==d)continue;const q=U.canonical,Z=U.overscaledZ,se=U.wrap,oe=1<<q.z,ae=q.x+1<oe,ce=q.x>0,xe=q.y+1<oe,be=q.y>0,ve=U.wrap-(ce?0:1),ke=U.wrap+(ae?0:1),Ce=ce?q.x-1:oe-1,Ae=ae?q.x+1:0;if(T)y[0]<0?(k(Z,ke,q.z,Ae,q.y),y[1]<0&&xe&&(k(Z,se,q.z,q.x,q.y+1),k(Z,ke,q.z,Ae,q.y+1)),y[1]>0&&be&&(k(Z,se,q.z,q.x,q.y-1),k(Z,ke,q.z,Ae,q.y-1))):y[0]>0?(k(Z,ve,q.z,Ce,q.y),y[1]<0&&xe&&(k(Z,se,q.z,q.x,q.y+1),k(Z,ve,q.z,Ce,q.y+1)),y[1]>0&&be&&(k(Z,se,q.z,q.x,q.y-1),k(Z,ve,q.z,Ce,q.y-1))):y[1]<0&&xe?k(Z,se,q.z,q.x,q.y+1):be&&k(Z,se,q.z,q.x,q.y-1);else{const Ne=U.visibleQuadrants;1&Ne&&(k(Z,ve,q.z,Ce,q.y),be&&(k(Z,se,q.z,q.x,q.y-1),k(Z,ve,q.z,Ce,q.y-1))),2&Ne&&(k(Z,ke,q.z,Ae,q.y),be&&(k(Z,se,q.z,q.x,q.y-1),k(Z,ke,q.z,Ae,q.y-1))),4&Ne&&(k(Z,ve,q.z,Ce,q.y),xe&&(k(Z,se,q.z,q.x,q.y+1),k(Z,ve,q.z,Ce,q.y+1))),8&Ne&&(k(Z,ke,q.z,Ae,q.y),xe&&(k(Z,se,q.z,q.x,q.y+1),k(Z,ke,q.z,Ae,q.y+1)))}}const L=[];for(const B of b)b.some(U=>B.isChildOf(U))||L.push(B);if(b=L.filter(B=>!l.some(U=>!!(B.overscaledZ<d&&U.isChildOf(B))||B.equals(U)||B.isChildOf(U))),S){const B=1<<d,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=[B*U.x,B*U.y],Z=4,se=Z*Z;b=b.filter(oe=>{const ae=oe.canonical.x+.5-q[0],ce=oe.canonical.y+.5-q[1];return ae*ae+ce*ce<se})}return b}coveringTiles(l){let d=this.coveringZoomLevel(l);const y=d,b=this.elevation&&this.elevation.exaggeration(),T=b&&!l.isTerrainDEM,S=this.projection.name==="mercator";if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);const A=this.locationCoordinate(this.center),k=this.center.lat,L=1<<d,B=[L*A.x,L*A.y,0],U=this.projection.name==="globe",q=!U,Z=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,q),se=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=L*a.ay(1,this.center.lat),ae=this._camera.position[2]/a.ay(1,this.center.lat),ce=[L*se.x,L*se.y,ae*(q?1:oe)],xe=U||b,be=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),ve=this.isLODDisabled(!0)?d:0;let ke;if(this._elevation&&l.isTerrainDEM)ke=1e4*this._elevation.exaggeration();else if(this._elevation){const Xe=this._elevation.getMinMaxForVisibleTiles();ke=Xe?Xe.max:this._centerAltitude}else ke=this._centerAltitude;const Ce=l.isTerrainDEM?-ke:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ae=this.projection.isReprojectedInTileSpace?a.aN(this):1,Ne=Xe=>{const $e=new a._(Xe.x+25e-6,Xe.y,Xe.z),vt=new a._(Xe.x,Xe.y+25e-6,Xe.z),bt=Xe.toLngLat(),Vt=$e.toLngLat(),Ht=vt.toLngLat(),ln=this.locationCoordinate(bt),Yt=this.locationCoordinate(Vt),wn=this.locationCoordinate(Ht),Gn=Math.hypot(Yt.x-ln.x,Yt.y-ln.y),In=Math.hypot(wn.x-ln.x,wn.y-ln.y);return Math.sqrt(Gn*In)*Ae/25e-6},Fe=Xe=>{const ot=ke,$e=Ce;return{aabb:a.aR(this,L,0,0,0,Xe,$e,ot,this.projection),zoom:0,x:0,y:0,minZ:$e,maxZ:ot,wrap:Xe,fullyVisible:!1}},Ze=[];let je=[];const Me=d,nt=l.reparseOverscaled?y:d,et=(ae-this._centerAltitude)*oe,qe=Xe=>{if(!this._elevation||!Xe.tileID||!S)return;const ot=this._elevation.getMinMaxForTile(Xe.tileID),$e=Xe.aabb;ot?($e.min[2]=ot.min,$e.max[2]=ot.max,$e.center[2]=($e.min[2]+$e.max[2])/2):(Xe.shouldSplit=yt(Xe),Xe.shouldSplit||($e.min[2]=$e.max[2]=$e.center[2]=this._centerAltitude))},St=(Xe,ot)=>{if(.707*ot<Xe)return 1;const $e=ot/Xe;return $e/(1.4144271570014144+(Math.pow(1.1,$e-1.4144271570014144+1)-1)/(1.1-1)-1)},yt=Xe=>{if(Xe.zoom<ve)return!0;if(Xe.zoom===Me)return!1;if(Xe.shouldSplit!=null)return Xe.shouldSplit;const ot=Xe.aabb.distanceX(ce),$e=Xe.aabb.distanceY(ce);let vt=et,bt=1;if(U){vt=Xe.aabb.distanceZ(ce);const In=Math.pow(2,Xe.zoom),Xn=a.az((Xe.y+1)/In),pr=a.az(Xe.y/In),ei=Math.min(Math.max(k,Xn),pr),jr=a.b6(ei)/a.b6(k);if(bt=ei===k?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,jr/this._mercatorScaleRatio),this.zoom<=a.b3&&Xe.zoom===Me-1&&jr>=.9)return!0}else if(T&&(vt=Xe.aabb.distanceZ(ce)*oe),this.projection.isReprojectedInTileSpace&&y<=5){const In=Math.pow(2,Xe.zoom),Xn=Ne(new a._((Xe.x+.5)/In,(Xe.y+.5)/In));bt=Xn>.85?1:Xn}if(!S){const In=Math.sqrt(ot*ot+$e*$e+vt*vt);let Xn=(1<<Me-Xe.zoom)*be*bt;return Xn*=St(Math.max(vt,et),In),In<Xn}let Vt=Number.MAX_VALUE,Ht=0;const ln=Xe.aabb.getCorners(),Yt=[];for(const In of ln){a.$.sub(Yt,In,ce),U||(T?Yt[2]*=oe:Yt[2]=et);const Xn=a.$.dot(Yt,this._camera.forward());Xn<Vt&&(Vt=Xn,Ht=Math.abs(Yt[2]))}let wn=(1<<Me-Xe.zoom)*be*bt;if(wn*=St(Math.max(Ht,et),Vt),Vt<wn)return!0;const Gn=Xe.aabb.closestPoint(B);return Gn[0]===B[0]&&Gn[1]===B[1]};if(this.renderWorldCopies)for(let Xe=1;Xe<=3;Xe++)Ze.push(Fe(-Xe)),Ze.push(Fe(Xe));for(Ze.push(Fe(0));Ze.length>0;){const Xe=Ze.pop(),ot=Xe.x,$e=Xe.y;let vt=Xe.fullyVisible;const bt=()=>this.projection.name==="globe"&&(Xe.y===0||Xe.y===(1<<Xe.zoom)-1);if(!vt){let Vt=xe?Xe.aabb.intersects(Z):Xe.aabb.intersectsFlat(Z);if(Vt===0&&bt()){const Ht=new a.aO(Xe.zoom,ot,$e);Vt=a.aP(this,L,Ht,!0).intersects(Z)}if(Vt===0)continue;vt=Vt===2}if(Xe.zoom!==Me&&yt(Xe))for(let Vt=0;Vt<4;Vt++){const Ht=(ot<<1)+Vt%2,ln=($e<<1)+(Vt>>1),Yt={aabb:S?Xe.aabb.quadrant(Vt):a.aR(this,L,Xe.zoom+1,Ht,ln,Xe.wrap,Xe.minZ,Xe.maxZ,this.projection),zoom:Xe.zoom+1,x:Ht,y:ln,wrap:Xe.wrap,fullyVisible:vt,tileID:void 0,shouldSplit:void 0,minZ:Xe.minZ,maxZ:Xe.maxZ};T&&!U&&(Yt.tileID=new a.aQ(Xe.zoom+1===Me?nt:Xe.zoom+1,Xe.wrap,Xe.zoom+1,Ht,ln),qe(Yt)),Ze.push(Yt)}else{const Vt=Xe.zoom===Me?nt:Xe.zoom;if(l.minzoom&&l.minzoom>Vt)continue;let Ht=0;if(!vt){let Gn=xe?Xe.aabb.intersectsPrecise(Z):Xe.aabb.intersectsPreciseFlat(Z);if(Gn===0&&bt()){const In=new a.aO(Xe.zoom,ot,$e);Gn=a.aP(this,L,In,!0).intersectsPrecise(Z)}if(Gn===0)continue;if(l.calculateQuadrantVisibility)if(Z.containsPoint(Xe.aabb.center))Ht=15;else for(let In=0;In<4;In++)Xe.aabb.quadrant(In).intersects(Z)!==0&&(Ht|=1<<In)}const ln=B[0]-(.5+ot+(Xe.wrap<<Xe.zoom))*(1<<d-Xe.zoom),Yt=B[1]-.5-$e,wn=Xe.tileID?Xe.tileID:new a.aQ(Vt,Xe.wrap,Xe.zoom,ot,$e);l.calculateQuadrantVisibility&&(wn.visibleQuadrants=Ht),je.push({tileID:wn,distanceSq:ln*ln+Yt*Yt})}}if(this.fogCullDistSq){const Xe=this.fogCullDistSq,ot=this.horizonLineFromTop();je=je.filter($e=>{const vt=[0,0,0,1],bt=[a.a4,a.a4,0,1],Vt=this.calculateFogTileMatrix($e.tileID.toUnwrapped());a.aB.transformMat4(vt,vt,Vt),a.aB.transformMat4(bt,bt,Vt);const Ht=a.aB.min([],vt,bt),ln=a.aB.max([],vt,bt),Yt=a.aS(Ht,ln);if(Yt===0)return!0;let wn=!1;const Gn=this._elevation;if(Gn&&Yt>Xe&&ot!==0){const In=this.calculateProjMatrix($e.tileID.toUnwrapped());let Xn;l.isTerrainDEM||(Xn=Gn.getMinMaxForTile($e.tileID)),Xn||(Xn={min:Ce,max:ke});const pr=a.b4(this.rotation),ei=[pr[0]*a.a4,pr[1]*a.a4,Xn.max];a.$.transformMat4(ei,ei,In),wn=(1-ei[1])*this.height*.5<ot}return Yt<Xe||wn})}return je.sort((Xe,ot)=>Xe.distanceSq-ot.distanceSq).map(Xe=>Xe.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=a.au(l.lat,-a.aT,a.aT),y=this.projection.project(l.lng,d);return new a.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,d){let y,b;const T=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;y=(d.x-T.x)/A,b=(d.y-T.y)/A}else{const A=this.pointCoordinate(d),k=this.pointCoordinate(T);y=A.x-k.x,b=A.y-k.y}const S=this.locationCoordinate(l);this.setLocation(new a._(S.x-y,S.y-b))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,d){const y=d?a.ay(d,l.lat):void 0,b=this.projection.project(l.lng,l.lat);return new a._(b.x,b.y,y)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,d){const y=d!=null?d:this._centerAltitude,b=[l.x,l.y,0,1],T=[l.x,l.y,1,1];a.aB.transformMat4(b,b,this.pixelMatrixInverse),a.aB.transformMat4(T,T,this.pixelMatrixInverse);const S=T[3];a.aB.scale(b,b,1/b[3]),a.aB.scale(T,T,1/S);const A=b[2],k=T[2];return{p0:b,p1:T,t:A===k?0:(y-A)/(k-A)}}screenPointToMercatorRay(l){const d=[l.x,l.y,0,1],y=[l.x,l.y,1,1];return a.aB.transformMat4(d,d,this.pixelMatrixInverse),a.aB.transformMat4(y,y,this.pixelMatrixInverse),a.aB.scale(d,d,1/d[3]),a.aB.scale(y,y,1/y[3]),d[2]=a.ay(d[2],this._center.lat)*this.worldSize,y[2]=a.ay(y[2],this._center.lat)*this.worldSize,a.aB.scale(d,d,1/this.worldSize),a.aB.scale(y,y,1/this.worldSize),new a.aU([d[0],d[1],d[2]],a.$.normalize([],a.$.sub([],y,d)))}rayIntersectionCoordinate(l){const{p0:d,p1:y,t:b}=l,T=a.ay(d[2],this._center.lat),S=a.ay(y[2],this._center.lat);return new a._(a.a3(d[0],y[0],b)/this.worldSize,a.a3(d[1],y[1],b)/this.worldSize,a.a3(T,S,b))}pointCoordinate(l,d=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,d)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let d=this.projection.pointCoordinate3D(this,l.x,l.y);if(d)return new a._(d[0],d[1],d[2]);let y=0,b=this.horizonLineFromTop();if(l.y>b)return this.pointCoordinate(l);const T=.02*b,S=l.clone();for(let A=0;A<10&&b-y>T;A++){S.y=a.a3(y,b,.66);const k=this.projection.pointCoordinate3D(this,S.x,S.y);k?(b=S.y,d=k):y=S.y}return d?new a._(d[0],d[1],d[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=a.aV)return!this.isPointAboveHorizon(l);const d=this.pointCoordinate(l);return d.y>=0&&d.y<=1}_coordinatePoint(l,d){const y=d&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,b=[l.x*this.worldSize,l.y*this.worldSize,y+l.toAltitude(),1];return a.aB.transformMat4(b,b,this.pixelMatrix),b[3]>0?new a.P(b[0]/b[3],b[1]/b[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:d}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=this.pointLocation3D(new a.P(d,l)),S=this.pointLocation3D(new a.P(b,l)),A=this.pointLocation3D(new a.P(b,y)),k=this.pointLocation3D(new a.P(d,y));let L=Math.min(T.lng,S.lng,A.lng,k.lng),B=Math.max(T.lng,S.lng,A.lng,k.lng),U=Math.min(T.lat,S.lat,A.lat,k.lat),q=Math.max(T.lat,S.lat,A.lat,k.lat);const Z=Math.pow(2,-this.zoom)/16*270,se=this.projection.name==="globe"?1:4,oe=(ae,ce,xe,be,ve)=>{const ke=(ae+xe)/2,Ce=(ce+be)/2,Ae=new a.P(ke,Ce),{lng:Ne,lat:Fe}=this.pointLocation3D(Ae),Ze=Math.max(0,L-Ne,U-Fe,Ne-B,Fe-q);L=Math.min(L,Ne),B=Math.max(B,Ne),U=Math.min(U,Fe),q=Math.max(q,Fe),(ve<se||Ze>Z)&&(oe(ae,ce,ke,Ce,ve+1),oe(ke,Ce,xe,be,ve+1))};if(oe(d,l,b,l,1),oe(b,l,b,y,1),oe(b,y,d,y,1),oe(d,y,d,l,1),this.projection.name==="globe"){const[ae,ce]=a.aW(this);ae?(q=90,B=180,L=-180):ce&&(U=-90,B=180,L=-180)}return new a.aj(new a.aJ(L,U),new a.aJ(B,q))}_getBoundsRectangular(l,d){const{top:y,left:b}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,A=new a.P(b,y),k=new a.P(S,y),L=new a.P(S,T),B=new a.P(b,T);let U=this.pointCoordinate(A,l),q=this.pointCoordinate(k,l);const Z=this.pointCoordinate(L,d),se=this.pointCoordinate(B,d),oe=(ae,ce)=>(ce.y-ae.y)/(ce.x-ae.x);return U.y>1&&q.y>=0?U=new a._((1-se.y)/oe(se,U)+se.x,1):U.y<0&&q.y<=1&&(U=new a._(-se.y/oe(se,U)+se.x,0)),q.y>1&&U.y>=0?q=new a._((1-Z.y)/oe(Z,q)+Z.x,1):q.y<0&&U.y<=1&&(q=new a._(-Z.y/oe(Z,q)+Z.x,0)),new a.aj().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=l.visibleDemTiles.reduce((y,b)=>{if(b.dem){const T=b.dem.tree;y.min=Math.min(y.min,T.minimums[0]),y.max=Math.max(y.max,T.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*l.exaggeration(),d.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-d*(1-this._horizonShift);return l?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-a.aT,this.maxLat=a.aT,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.ak(this.minLng)*this.tileSize,this.worldMaxX=a.ak(this.maxLng)*this.tileSize,this.worldMinY=a.al(this.maxLat)*this.tileSize,this.worldMaxY=a.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,d){return this.projection.createTileMatrix(this,d,l)}calculateDistanceTileData(l){const d=l.key,y=this._distanceTileDataCache;if(y[d])return y[d];const b=l.canonical,T=1/this.height,S=this.cameraWorldSize,A=S/this.zoomScale(b.z),k=(b.x+Math.pow(2,b.z)*l.wrap)*A,L=b.y*A,B=this.point;B.x*=S/this.worldSize,B.y*=S/this.worldSize;const U=this.angle,q=Math.sin(-U),Z=-Math.cos(-U);return y[d]={bearing:[q,Z],center:[(B.x-k)*T,(B.y-L)*T],scale:A/a.a4*T},y[d]}calculateFogTileMatrix(l){const d=l.key,y=this._fogTileMatrixCache;if(y[d])return y[d];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return a.ae.multiply(b,this.worldToFogMatrix,b),y[d]=new Float32Array(b),y[d]}calculateProjMatrix(l,d=!1,y=!1){const b=l.key;let T;if(T=y?this._expandedProjMatrixCache:d?this._alignedProjMatrixCache:this._projMatrixCache,T[b])return T[b];const S=this.calculatePosMatrix(l,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:d?this.alignedProjMatrix:this.projMatrix,a.ae.multiply(S,A,S),T[b]=new Float32Array(S),T[b]}calculatePixelsToTileUnitsMatrix(l){const d=l.tileID.key,y=this._pixelsToTileUnitsCache;if(y[d])return y[d];const b=a.aX(l,this);return y[d]=b,y[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,d=a.ae.fromScaling([],[l,l,l]);return a.ae.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const d=a.ay(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),b=this._camera.forward(),T=a.ay(1,this._center.lat);y[2]/=T,b[2]/=T,a.$.normalize(b,b);const S=l.raycast(y,b,l.exaggeration());if(S){const A=a.$.scaleAndAdd([],y,b,S),k=new a._(A[0],A[1],a.ay(A[2],a.az(A[1]))),L=(k.z+a.$.length([k.x-y[0],k.y-y[1],k.z-y[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const d=this._elevation,y=a.ay(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(y),T=d.getAtPointOrZero(new a._(...b)),S=this.pixelsPerMeter/this.worldSize*T,A=this._minimumHeightOverTerrain(),k=b[2]-S;if(k<=A)if(k<0||l){const L=this.locationCoordinate(this._center,this._centerAltitude),B=[b[0],b[1],L.z-b[2]],U=a.$.length(B);B[2]-=(A-k)/this._pixelsPerMercatorPixel;const q=a.$.length(B);if(q===0)return;a.$.scale(B,B,U/q*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],L.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const q=this.center;return q.lat=a.au(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(q.lng=a.au(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const d=this._unmodified,{x:y,y:b}=this.point;let T=0,S=y,A=b;const k=this.width/2,L=this.height/2,B=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(b-L<B&&(A=B+L),b+L>U&&(A=U-L),U-B<this.height&&(T=Math.max(T,this.height/(U-B)),A=(U+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,se=this.worldSize/2-(q+Z)/2;S=(y+se+this.worldSize)%this.worldSize-se,S-k<q&&(S=q+k),S+k>Z&&(S=Z-k),Z-q<this.width&&(T=Math.max(T,this.width/(Z-q)),S=(Z+q)/2)}S===y&&A===b||(this.center=this.unproject(new a.P(S,A))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.ay(1,this.center.lat)/a.ay(1,a.b5));const b=a.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?y:1,S=this._camera.getWorldToCamera(this.worldSize,T);let A;const k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(k[8]=2*-l.x/this.width,k[9]=2*l.y/this.height,this.isOrthographic){let Fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ze=Fe*this.aspect,je=-Ze,Me=-Fe;Ze-=l.x,je-=l.x,Fe+=l.y,Me+=l.y,A=this._camera.getCameraToClipOrthographic(je,Ze,Me,Fe,this._nearZ,this._farZ),((nt,et,qe,St)=>{for(let yt=0;yt<16;yt++)nt[yt]=sh(et[yt],qe[yt],St)})(A,A,k,Ya(this.pitch>=15?1:this.pitch/15))}else A=k;const L=a.ae.mul([],k,S);let B=a.ae.mul([],A,S);if(this.projection.isReprojectedInTileSpace){const Fe=this.locationCoordinate(this.center),Ze=a.ae.identity([]);a.ae.translate(Ze,Ze,[Fe.x*this.worldSize,Fe.y*this.worldSize,0]),a.ae.multiply(Ze,Ze,a.aZ(this)),a.ae.translate(Ze,Ze,[-Fe.x*this.worldSize,-Fe.y*this.worldSize,0]),a.ae.multiply(B,B,Ze),a.ae.multiply(L,L,Ze),this.inverseAdjustmentMatrix=a.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.ae.scale([],B,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=B,this.invProjMatrix=a.ae.invert(new Float64Array(16),this.projMatrix),d){const Fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Fe[8]=2*-l.x/this.width,Fe[9]=2*l.y/this.height,this.expandedFarZProjMatrix=a.ae.mul([],Fe,S)}else this.expandedFarZProjMatrix=this.projMatrix;const U=a.ae.invert([],A);this.frustumCorners=a.a$.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!d);const q=new Float32Array(16);a.ae.identity(q),a.ae.scale(q,q,[1,-1,1]),a.ae.rotateX(q,q,this._pitch),a.ae.rotateZ(q,q,this.angle);const Z=a.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.ae.clone(Z);const se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Z[8]=2*-l.x/this.width,Z[9]=2*(l.y+se)/this.height,this.skyboxMatrix=a.ae.multiply(q,Z,q);const oe=this.point,ae=oe.x,ce=oe.y,xe=this.width%2/2,be=this.height%2/2,ve=Math.cos(this.angle),ke=Math.sin(this.angle),Ce=ae-Math.round(ae)+ve*xe+ke*be,Ae=ce-Math.round(ce)+ve*be+ke*xe,Ne=new Float64Array(B);if(a.ae.translate(Ne,Ne,[Ce>.5?Ce-1:Ce,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=Ne,B=a.ae.create(),a.ae.scale(B,B,[this.width/2,-this.height/2,1]),a.ae.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=a.ae.create(),a.ae.scale(B,B,[1,-1,1]),a.ae.translate(B,B,[-1,-1,0]),a.ae.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=a.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},B=a.ae.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.b0(this);const Fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.$.transformMat4(Fe,Fe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,y=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,T=[l,l,d];a.$.scale(T,T,b),a.$.scale(y,y,-1),a.$.multiply(y,y,T);const S=a.ae.create();a.ae.translate(S,S,y),a.ae.scale(S,S,T),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,d,b)}_computeCameraPosition(l){const d=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),b=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-l/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-y[0]*T,b.y/this.worldSize-y[1]*T,l/this.worldSize*this._centerAltitude-y[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],b=l[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(T=Math.min((d-y)/b,1)),this._camera.position=a.$.scaleAndAdd([],this._camera.position,l,T),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,d=this._camera.forward(),{pitch:y,bearing:b}=this._camera.getPitchBearing(),T=a.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.ac(this._maxPitch)),A=Math.max((l[2]-T)/Math.cos(y),S),k=this._zoomFromMercatorZ(A);a.$.scaleAndAdd(l,l,d,A),this._pitch=a.au(y,a.ac(this.minPitch),a.ac(this.maxPitch)),this.angle=a.av(b,-Math.PI,Math.PI),this._setZoom(a.au(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a._(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let d=0,y=a.aV,b=0,T=1/0;for(;y-d>1e-6&&y>d;){const S=d+.5*(y-d),A=this.tileSize*Math.pow(2,S),k=this.getCameraToCenterDistance(this.projection,S,A),L=this.scaleZoom(k/(l*this.tileSize)),B=Math.abs(S-L);B<T&&(T=B,b=S),S<L?d=S:y=S}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,d){const y=Math.min(l.x,d.x),b=Math.max(l.x,d.x),T=Math.min(l.y,d.y),S=Math.max(l.y,d.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new a.P(y,T),new a.P(b,S),new a.P(y,S),new a.P(b,T)],k=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const B of A){const U=this.pointRayIntersection(B);if(U.t<0)return!0;const q=this.rayIntersectionCoordinate(U);if(q.x<k||q.y<0||q.x>L||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(l,d){const y=a.$.length(a.$.sub([],this._camera.position,l)),b=this._zoomFromMercatorZ(y)+d;return y-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([d,y,b],T){const S=[d,y,b,1];a.aB.transformMat4(S,S,T);const A=S[3]=Math.max(S[3],1e-6);return S[0]/=A,S[1]/=A,S[2]/=A,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,l))}}getCameraToCenterDistance(l,d=this.zoom,y=this.worldSize){const b=a.aY(l,d,this.width,this.height,1024),T=l.pixelSpaceConversion(this.center.lat,y,b);let S=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(S=sh(1,S,Ya(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.ae.multiply(l,l,this.globeMatrix),l}getFrustum(l){return a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}const Ds={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},$s=(g,l)=>{if(l>0&&g.terrain&&a.w("Cutoff is currently disabled on terrain"),l<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const d=g.transform,y=Math.max(Math.abs(d._zoom-(g.minCutoffZoom-1)),1),b=d.isLODDisabled(!1)?a.a0(60,45,d.pitch):a.a0(30,15,d.pitch),T=d._farZ-d._nearZ,S=l*d.height,A=((1-(k=b))*d.cameraToCenterDistance+k*(d._farZ+S))*y;var k;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[d._nearZ,d._farZ,(A-d._nearZ)/T,(A-S-d._nearZ)/T]}}},vs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Pi{constructor(l,d){this.aabb=l,this.lastCascade=d}}class la{add(l,d){const y=this.receivers[l.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],d.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],d.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],d.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],d.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],d.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],d.max[2])):this.receivers[l.key]=new Pi(d,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,d,y){const b=a.b8.fromPoints(l.points);let T=0;for(const S in this.receivers){const A=this.receivers[S];if(!A||!b.intersectsAabb(A.aabb))continue;A.aabb.min=b.closestPoint(A.aabb.min),A.aabb.max=b.closestPoint(A.aabb.max);const k=A.aabb.getCorners();for(let L=0;L<y.length;L++){let B=!0;for(const U of k){const q=[U[0]*d,U[1]*d,U[2]];if(a.$.transformMat4(q,q,y[L].matrix),q[0]<-1||q[0]>1||q[1]<-1||q[1]>1){B=!1;break}}if(A.lastCascade=L,T=Math.max(T,L),B)break}}return T+1}}class vg{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new la,this._depthMode=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(vs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(vs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),l.tp.registerParameter(vs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,d){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!d||!d.properties)return;const b=d.properties.get("shadow-intensity");if(!d.shadowsEnabled()||b<=0||(this._shadowLayerCount=y.style.order.reduce((se,oe)=>{const ae=y.style._mergedLayers[oe];return se+(ae.hasShadowPass()&&!ae.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=y.context,S=vs.shadowMapResolution,A=vs.shadowMapResolution;if(this._cascades.length===0||vs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let se=0;se<vs.cascadeCount;++se){const oe=y._shadowMapDebug,ae=T.gl,ce=T.createFramebuffer(S,A,oe,"texture"),xe=new a.T(T,{width:S,height:A,data:null},ae.DEPTH_COMPONENT);if(ce.depthAttachment.set(xe.texture),oe){const be=new a.T(T,{width:S,height:A,data:null},ae.RGBA);ce.colorAttachment.set(be.texture)}this._cascades.push({framebuffer:ce,texture:xe,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.aM,scale:0})}}this.shadowDirection=$o(d);let k=0;if(l.elevation){const se=l.elevation,oe=[1e4,-1e4];se.visibleDemTiles.filter(ae=>ae.dem).forEach(ae=>{const ce=ae.dem.tree;oe[0]=Math.min(oe[0],ce.minimums[0]),oe[1]=Math.max(oe[1],ce.maximums[0])}),oe[0]!==1e4&&(k=(oe[1]-oe[0])*se.exaggeration())}const L=1.5*l.cameraToCenterDistance,B=3*L,U=new Float64Array(16);for(let se=0;se<this._cascades.length;++se){const oe=this._cascades[se];let ae=l.height/50,ce=1;vs.cascadeCount===1?ce=B:se===0?ce=L:(ae=L,ce=B);const[xe,be]=vd(l,this.shadowDirection,ae,ce,vs.shadowMapResolution,k);oe.scale=l.scale,oe.matrix=xe,oe.boundingSphereRadius=be,a.ae.invert(U,oe.matrix),oe.frustum=a.aM.fromInvProjectionMatrix(U,1,0,!0),oe.far=ce}const q=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[q].far,this._cascades[q].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/vs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=vs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ds.ShadowMap0,this._uniformValues.u_shadowmap_1=Ds.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Z=y.transform.elevation;for(const se of this._groundShadowTiles){let oe={min:0,max:0};if(Z){const ae=Z.getMinMaxForTile(se);ae&&(oe=ae)}this.addShadowReceiver(se.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,d){if(!this.enabled)return;const y=this.painter,b=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),b.viewport.set([0,0,vs.shadowMapResolution,vs.shadowMapResolution]);for(let T=0;T<this._numCascadesToRender;++T){y.currentShadowCascade=T,b.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),b.clear({color:a.C.white,depth:1});for(const S of l.order){const A=l._mergedLayers[S];if(!A.hasShadowPass()||A.isHidden(y.transform.zoom))continue;const k=l.getLayerSourceCache(A),L=k?d[k.id]:void 0;(A.type==="model"||L&&L.length)&&y.renderLayer(y,k,A,L)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const l=this.painter,d=l.style,y=l.context,b=d.directionalLight,T=d.ambientLight;if(!b||!T)return;const S=[],A=$s(l,l.longestCutoffRange);A.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const k=su(d,b,T),L=new a.af(y.gl.LEQUAL,a.af.ReadOnly,l.depthRangeFor3D);for(const B of this._groundShadowTiles){const U=B.toUnwrapped(),q=l.isTileAffectedByFog(B),Z=l.getOrCreateProgram("groundShadow",{defines:S,overrideFog:q});this.setupShadows(U,Z),l.uploadCommonUniforms(y,Z,U,null,A);const se={u_matrix:l.transform.calculateProjMatrix(U),u_ground_shadow_factor:k};Z.draw(l,y.gl.TRIANGLES,L,a.ah.disabled,a.a.multiply,a.ag.disabled,se,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?a.a.unblended:a.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const d=this.painter.transform,y=d.calculatePosMatrix(l,d.worldSize);return a.ae.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(l){return a.ae.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,d,y,b=0){if(!this.enabled)return;const T=this.painter.transform,S=this.painter.context,A=S.gl,k=this._uniformValues,L=new Float64Array(16),B=T.calculatePosMatrix(l,T.worldSize);for(let U=0;U<this._cascades.length;U++)a.ae.multiply(L,this._cascades[U].matrix,B),k[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),S.activeTexture.set(A.TEXTURE0+Ds.ShadowMap0+U),this._cascades[U].texture.bind(A.NEAREST,A.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const U=a.b7(l.canonical),q=2/T.tileSize*a.a4/vs.shadowMapResolution,Z=q*this._cascades[0].boundingSphereRadius,se=q*this._cascades[this._cascades.length-1].boundingSphereRadius,oe=(y==="vector-tile"?1:3)/Math.pow(2,b-l.canonical.z-(1-T.zoom+Math.floor(T.zoom)));k.u_shadow_normal_offset=[U,Z*oe,se*oe],k.u_shadow_bias=[6e-5,.0012,.012]}else k.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(S,k)}setupShadowsFromMatrix(l,d,y=!1){if(!this.enabled)return;const b=this.painter.context,T=b.gl,S=this._uniformValues,A=new Float64Array(16);for(let k=0;k<vs.cascadeCount;k++)a.ae.multiply(A,this._cascades[k].matrix,l),S[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),b.activeTexture.set(T.TEXTURE0+Ds.ShadowMap0+k),this._cascades[k].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=y,y){const k=vs.normalOffset;S.u_shadow_normal_offset=[1,k,k],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];d.setShadowUniformValues(b,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,d,y,b){if(b[2]>=0)return{};const T=function(k,L,B){const U=B/(1<<k.canonical.z);return new a.b8([k.canonical.x*U+k.wrap*B,k.canonical.y*U+k.wrap*B,0],[(k.canonical.x+1)*U+k.wrap*B,(k.canonical.y+1)*U+k.wrap*B,L])}(l,d,y).getCorners(),S=d/-b[2];b[0]<0?(a.$.add(T[0],T[0],[b[0]*S,0,0]),a.$.add(T[3],T[3],[b[0]*S,0,0])):b[0]>0&&(a.$.add(T[1],T[1],[b[0]*S,0,0]),a.$.add(T[2],T[2],[b[0]*S,0,0])),b[1]<0?(a.$.add(T[0],T[0],[0,b[1]*S,0]),a.$.add(T[1],T[1],[0,b[1]*S,0])):b[1]>0&&(a.$.add(T[2],T[2],[0,b[1]*S,0]),a.$.add(T[3],T[3],[0,b[1]*S,0]));const A={};return A.vertices=T,A.planes=[fc(T[1],T[0],T[4]),fc(T[2],T[1],T[5]),fc(T[3],T[2],T[6]),fc(T[0],T[3],T[7])],A}addShadowReceiver(l,d,y){this._receivers.add(l,a.b8.fromTileIdAndHeight(l,d,y))}getMaxCascadeForTile(l){const d=this._receivers.get(l);return d&&d.lastCascade?d.lastCascade:0}}function fc(g,l,d){const y=a.$.sub([],d,l),b=a.$.sub([],g,l),T=a.$.cross([],y,b),S=a.$.length(T);return S===0?[0,0,1,0]:(a.$.scale(T,T,1/S),[T[0],T[1],T[2],-a.$.dot(T,l)])}function $o(g){const l=g.properties.get("direction"),d=a.ad(l.x,l.y,l.z);d[2]=a.au(d[2],0,75);const y=a.b9([d[0],d[1],d[2]]);return a.$.fromValues(y.x,y.y,y.z)}function su(g,l,d){const y=l.properties.get("color"),b=l.properties.get("intensity"),T=l.properties.get("direction"),S=[T.x,T.y,T.z],A=d.properties.get("color"),k=d.properties.get("intensity"),L=Math.max(a.$.dot([0,0,1],S),0),B=[0,0,0];a.$.scale(B,A.toRenderColor(g.getLut(l.scope)).toArray01Linear().slice(0,3),k);const U=[0,0,0];return a.$.scale(U,y.toRenderColor(g.getLut(d.scope)).toArray01Linear().slice(0,3),L*b),a.ba([B[0]>0?B[0]/(B[0]+U[0]):0,B[1]>0?B[1]/(B[1]+U[1]):0,B[2]>0?B[2]/(B[2]+U[2]):0])}function vd(g,l,d,y,b,T){const S=g.zoom,A=g.scale,k=g.worldSize,L=1/k,B=g.aspect,U=Math.sqrt(1+B*B)*Math.tan(.5*g.fovX),q=U*U,Z=y-d,se=y+d;let oe,ae;q>Z/se?(oe=y,ae=y*U):(oe=.5*se*(1+q),ae=.5*Math.sqrt(Z*Z+2*(y*y+d*d)*q+se*se*q*q));const ce=g.projection.pixelsPerMeter(g.center.lat,k),xe=g._camera.getCameraToWorldMercator(),be=[0,0,-oe*L];a.$.transformMat4(be,be,xe);let ve=ae*L;const ke=g._edgeInsets;if(!(ke.left===0&&ke.top===0&&ke.right===0&&ke.bottom===0||ke.left===ke.right&&ke.top===ke.bottom)){const vt=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?ce:1),bt=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,d,y);bt[8]=2*-g.centerOffset.x/g.width,bt[9]=2*g.centerOffset.y/g.height;const Vt=new Float64Array(16);a.ae.mul(Vt,bt,vt);const Ht=new Float64Array(16);a.ae.invert(Ht,Vt);const ln=a.aM.fromInvProjectionMatrix(Ht,k,S,!0);for(const Yt of ln.points){const wn=((Ce=Yt)[0]/=A,Ce[1]/=A,Ce[2]=a.ay(Ce[2],g._center.lat),Ce);ve=Math.max(ve,a.$.len(a.$.subtract([],be,wn)))}}var Ce;ve*=b/(b-1);const Ae=Math.acos(l[2]),Ne=Math.atan2(-l[0],-l[1]),Fe=new pi;Fe.position=be,Fe.setPitchBearing(Ae,Ne);const Ze=Fe.getWorldToCamera(k,ce),je=ve*k,Me=Math.min(g._mercatorZfromZoom(17)*k*-2,-2*je),nt=Fe.getCameraToClipOrthographic(-je,je,-je,je,Me,(je+T*ce)/l[2]),et=new Float64Array(16);a.ae.multiply(et,nt,Ze);const qe=a.$.fromValues(Math.floor(1e6*be[0])/1e6*k,Math.floor(1e6*be[1])/1e6*k,0),St=.5*b,yt=[0,0,0];a.$.transformMat4(yt,qe,et),a.$.scale(yt,yt,St);const Xe=[Math.floor(yt[0]),Math.floor(yt[1]),Math.floor(yt[2])],ot=[0,0,0];a.$.sub(ot,yt,Xe),a.$.scale(ot,ot,-1/St);const $e=new Float64Array(16);return a.ae.identity($e),a.ae.translate($e,$e,ot),a.ae.multiply(et,$e,et),[et,je]}function ou(g,l){return g!=null&&l!=null&&!(!g.hasData()||!l.hasData())&&g.demTexture!=null&&l.demTexture!=null&&g.tileID.key!==l.tileID.key}const Ja=new class{constructor(){this.operations={}}newMorphing(g,l,d,y,b){if(g in this.operations){const T=this.operations[g];T.to.tileID.key!==d.tileID.key&&(T.queued=d)}else this.operations[g]={startTime:y,phase:0,duration:b,from:l,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const d=this.operations[l];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Al={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ds(g,l,d){if(l===0)return 0;const y=l<1&&d===514?.25/l:1;return 6*Math.pow(1.5,22-g)*Math.max(l,1)*y}function au(g,l){const d=1<<g.z;return!l&&(g.x===0||g.x===d-1)||g.y===0||g.y===d-1}const lu=g=>({u_matrix:g});function el(g,l,d,y,b){if(b>0){const T=a.e.now(),S=(T-g.timeAdded)/b,A=l?(T-l.timeAdded)/b:-1,k=d.getSource(),L=y.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),B=!l||Math.abs(l.tileID.overscaledZ-L)>Math.abs(g.tileID.overscaledZ-L),U=B&&g.refreshedUponExpiration?1:a.au(B?S:1-A,0,1);return g.refreshedUponExpiration&&S>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class R extends Ro{constructor(l,d,y,b){super(l,d,y,b),this.type="raster-array",this.maxzoom=22,this._options=a.Q({type:"raster-array"},d)}triggerRepaint(l){const d=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);d&&d.enabled&&y&&d._clearRenderCacheForTile(y.id,l.tileID),this.map.triggerRepaint()}loadTile(l,d){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(y,a.R.Tile);l.requestParams=b,l.actor||(l.actor=this.dispatcher.getActor()),l.request=l.fetchHeader(void 0,(T,S,A,k)=>{if(delete l.request,l.aborted)return l.state="unloaded",d(null);if(T)return T.code===20?void 0:(l.state="errored",d(T));this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:A,expires:k}),l.state="empty",d(null)})}unloadTile(l,d){const y=l.texture;y&&y instanceof a.T?(l.destroy(!0),this.map.painter.saveTileTexture(y)):(l.destroy(),l.flushQueues(),l._isHeaderLoaded=!1,delete l._mrt,delete l.textureDescriptor),l.fbo&&(l.fbo.destroy(),delete l.fbo),delete l.request,delete l.requestParams,delete l.neighboringTiles,l.state="unloaded"}prepareTile(l,d,y){l._isHeaderLoaded&&(l.state!=="empty"&&(l.state="reloading"),l.fetchBand(d,y,(b,T)=>{if(b)return l.state="errored",this.fire(new a.f(b)),void this.triggerRepaint(l);T&&(l.setTexture(T,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;const d=this.rasterLayers.find(({id:T})=>T===l),y=d&&d.fields,b=y&&y.bands&&y.bands;return b?b[0]:0}getTextureDescriptor(l,d,y){if(!l)return;const b=d.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let T=null;d instanceof a.bm?T=d.paint.get("raster-array-band"):d instanceof a.bn&&(T=d.paint.get("raster-particle-array-band"));const S=T||this.getInitialBand(b);if(S!=null)if(l.textureDescriptor){if(!l.updateNeeded(b,S)||y)return Object.assign({},l.textureDescriptor,{texture:l.texture})}else this.prepareTile(l,b,S)}}const K={vector:yg,raster:Ro,"raster-dem":class extends Ro{constructor(g,l,d,y){super(g,l,d,y),this.type="raster-dem",this.maxzoom=22,this._options=a.Q({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(b,T){b&&(g.state="errored",l(b)),T&&(g.dem=T,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=a.i(this.map._requestManager.transformRequest(d,a.R.Tile),function(b,T,S,A){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(b)g.state="errored",l(b);else if(T){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:S,expires:A});const k=ImageBitmap&&T instanceof ImageBitmap&&a.bk(),L=1-(T.width-a.bl(T.width))/2;L<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const B=k?T:a.e.getImageData(T,L),U={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:L};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",U,y.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const l=g.canonical,d=Math.pow(2,l.z),y=(l.x-1+d)%d,b=l.x===0?g.wrap-1:g.wrap,T=(l.x+1+d)%d,S=l.x+1===d?g.wrap+1:g.wrap,A={};return A[new a.aQ(g.overscaledZ,b,l.z,y,l.y).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,S,l.z,T,l.y).key]={backfilled:!1},l.y>0&&(A[new a.aQ(g.overscaledZ,b,l.z,y,l.y-1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,S,l.z,T,l.y-1).key]={backfilled:!1}),l.y+1<d&&(A[new a.aQ(g.overscaledZ,b,l.z,y,l.y+1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,S,l.z,T,l.y+1).key]={backfilled:!1}),A}},"raster-array":R,geojson:class extends a.E{constructor(g,l,d,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(y),this._data=l.data,this._options=a.Q({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.minzoom!==void 0&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const b=a.a4/this.tileSize;this.workerOptions=a.Q({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*b,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*b,extent:a.a4,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:a.a4,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*b,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new a.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new a.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const l=new Map;for(const d of this._data.features)l.set(d.id,d);for(const d of g.features)l.set(d.id,d);this._data.features=[...l.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterLeaves(g,l,d,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:l,offset:d},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.g("dataloading",{dataType:"source"})),this._loaded=!1;const l=a.Q({append:g},this.workerOptions);l.scope=this.scope;const d=this._data;typeof d=="string"?(l.request=this.map._requestManager.transformRequest(a.e.resolveURL(d),a.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(d),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(y,b)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new a.f(y));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(T.resourceTiming=b.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new a.g("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,b=this._partialReload,T={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y?{image:y.image.clone()}:null,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:b};g.request=this.actor.send(d,T,(S,A)=>b&&!A?(g.state="loaded",l(null)):(delete g.request,g.destroy(),g.aborted?l(null):S?l(S):(g.loadVectorData(A,this.map.painter,d==="reloadTile"),l(null))),void 0,d==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,l){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.bo{constructor(g,l,d,y){super(g,l,d,y),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,a.R.Source).url);a.bp(this.urls,(l,d)=>{this._loaded=!0,l?this.fire(new a.f(l)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new a.f(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(g,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.bo,model:class extends a.E{constructor(g,l,d,y){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const g=[];for(const l in this._options.models){const d=this._options.models[l],y=a.l(this.map._requestManager.transformRequest(d.uri,a.R.Model).url).then(b=>{if(!b)return;const T=a.c(b),S=new a.M(l,d.position,d.orientation,T);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(b=>{this.fire(new a.f(new Error(`Could not load model ${l} from ${d.uri}: ${b.message}`)))});g.push(y)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new a.f(new Error(`Could not load models: ${l.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,l){}serialize(){return{type:"model"}}},"batched-model":class extends a.E{constructor(g,l,d,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=d,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map._worldview;this._tileJSONRequest=op(this._options,this.map._requestManager,l,d,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),d&&d.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.f(y))):b&&(a.Q(this,b),b.bounds&&(this.tileBounds=new Vo(b.bounds,this.minzoom,this.maxzoom)),a.ao(b.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(d,a.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=l;else{if(g.buckets){const T=Object.values(g.buckets);for(const S of T)S.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,b.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,b.bind(this),void 0,!0);function b(T,S){return g.aborted?l(null):T&&T.status!==404?l(T):(S&&(S.resourceTiming&&(g.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(S),g.buckets=de(de({},g.buckets),S.buckets),S.featureIndex&&(g.latestFeatureIndex=S.featureIndex)),g.state="loaded",void l(null))}}serialize(){return a.Q({},this._options)}},canvas:class extends a.bo{constructor(g,l,d,y){super(g,l,d,y),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new a.f(new a.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new a.f(new a.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new a.f(new a.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof a.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends a.E{constructor(g,l,d,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=l,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Vo(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),a.Q(this,a.ai(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:d,z:y}=g.canonical;return this._implementation.hasTile({x:l,y:d,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:d,y,z:b}=g.tileID.canonical,T=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y,z:b},{signal:T.signal})).then(function(S){return delete g.request,g.aborted?(g.state="unloaded",l(null)):S===void 0?(g.state="errored",l(null)):S===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement}(S)?(this.loadTileData(g,S),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(S=>{S.code!==20&&(g.state="errored",l(S))}),g.request.cancel=()=>T.abort()}loadTileData(g,l){g.setTexture(l,this.map.painter)}unloadTile(g,l){if(g.texture&&g.texture instanceof a.T?(g.destroy(!0),g.texture&&g.texture instanceof a.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:d,y,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:d,y,z:b})}l&&l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=a.am(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}}},ue=function(g,l,d,y){const b=new K[l.type](g,l,d,y);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return a.br(["load","abort","unload","serialize","prepare"],b),b};class De extends a.bx{constructor(l){const d={type:"raster-dem",maxzoom:l.transform.maxZoom},y=new a.by(a.bz(),null),b=ue("mock-dem",d,y,l.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,d){l.state="loaded",d(null)}}class mt extends a.bx{constructor(l){const d=ue("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new a.by(a.bz(),null),l.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,d,y){if(l.freezeTileCoverage)return;this.transform=l;const b=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,S)=>{if(T[S.key]="",!this._tiles[S.key]){const A=new a.bA(S,this._source.tileSize*S.overscaleFactor(),l.tileZoom);A.state="loaded",this._tiles[S.key]=A}return T},{});for(const T in this._tiles)T in b||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(l){const d=this.proxyCachedFBO[l];if(d!==void 0){const y=Object.values(d);this.renderCachePool.push(...y),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class kt extends a.aQ{constructor(l,d,y){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=d,this.projMatrix=y}}class rn extends a.bs{constructor(l,d){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,b,T]=function(k){const L=new a.bv,B=new a.bw,U=131;L.reserve(17161),B.reserve(33800);const q=a.a4/128,Z=a.a4+q/2,se=Z+q;for(let ae=-q;ae<se;ae+=q)for(let ce=-q;ce<se;ce+=q){const xe=ce<0||ce>Z||ae<0||ae>Z?24575:0,be=a.au(Math.round(ce),0,a.a4),ve=a.au(Math.round(ae),0,a.a4);L.emplaceBack(be+xe,ve)}const oe=(ae,ce)=>{const xe=ce*U+ae;B.emplaceBack(xe+1,xe,xe+U),B.emplaceBack(xe+U,xe+U+1,xe+1)};for(let ae=1;ae<129;ae++)for(let ce=1;ce<129;ce++)oe(ce,ae);return[0,129].forEach(ae=>{for(let ce=0;ce<130;ce++)oe(ce,ae),oe(ae,ce)}),[L,B,32768]}(),S=l.context;this.gridBuffer=S.createVertexBuffer(y,a.bt.members),this.gridIndexBuffer=S.createIndexBuffer(b),this.gridSegments=a.b.simpleSegment(0,0,y.length,b.length),this.gridNoSkirtSegments=a.b.simpleSegment(0,0,y.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new mt(d.map),this.orthoMatrix=a.ae.create(),a.ae.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.a4,0,a.a4,0,1);const A=S.gl;this._overlapStencilMode=new a.ah({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new De(d.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,d,y){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const b=l.terrain.properties,T=l.terrain.drapeRenderMode===0,S=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.e.now();const A=l.terrain&&l.terrain.scope,k=b.get("source"),L=T?this._mockSourceCache:l.getSourceCache(k,A);if(!L)return void a.w(`Couldn't find terrain source "${k}".`);if(this.sourceCache=L,this._exaggeration=S?this.calculateExaggeration(d):b.get("exaggeration"),!d.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(d,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),d.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0,this._previousZoom=d.zoom}else this._disable()}calculateExaggeration(l){const d=this._previousCameraAltitude,y=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=y;const b=d!=null?y-d:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const T=l.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(T);let A=T-this._previousZoom;const k=this._previousUpdateTimestamp;let L=T;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(T-L)>.5&&(A=.5*(T-L+A)),A*b<0&&(L+=A)),this._evaluationZoom=L;const B=S.getExaggeration(L),U=B===S.getExaggeration(Math.max(0,L-.1));if(U&&Math.abs(B-this._exaggeration)<.01)return B;let q=Math.min(.1,.00375*(this._updateTimestamp-k));return(U||B<.1||Math.abs(A)<1e-4)&&(q=Math.min(.2,4*q)),a.a3(this._exaggeration,B,q)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(a._.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=d.getIds().map(k=>{const L=d.getTileByID(k).tileID;return L.projMatrix=y.calculateProjMatrix(L.toUnwrapped()),L});(function(k,L){const B=L.transform.pointCoordinate(L.transform.getCameraPoint()),U=new a.P(B.x,B.y);k.sort((q,Z)=>{if(Z.overscaledZ-q.overscaledZ)return Z.overscaledZ-q.overscaledZ;const se=new a.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),oe=new a.P(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),ae=U.mult(1<<q.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(se)-ae.distSqr(oe)})})(b,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},b.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const k in S){const L=S[k];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,l[k],T),L.usedForTerrain))continue;const B=l[k];L.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[d.id]=b.map(k=>new kt(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const L=this.terrainTileForTile[k.key];if(!L)continue;const B=L.tileID.key;B in A||(this._visibleDemTiles.push(L),A[B]=B)}}_assignTerrainTiles(l){this._initializing||l.forEach(d=>{if(this.terrainTileForTile[d.key])return;const y=this._findTileCoveringTileID(d,this.sourceCache);y&&(this.terrainTileForTile[d.key]=y)})}_prepareDEMTextures(){const l=this.painter.context,d=l.gl;for(const y in this.terrainTileForTile){const b=this.terrainTileForTile[y],T=b.dem;!T||b.demTexture&&!b.needsDEMTextureUpload||(l.activeTexture.set(d.TEXTURE1),_g(this.painter,b,T))}}_prepareDemTileUniforms(l,d,y,b){if(!d||d.demTexture==null)return!1;const T=l.tileID.canonical,S=Math.pow(2,d.tileID.canonical.z-T.z),A=b||"";return y[`u_dem_tl${A}`]=[T.x*S%1,T.y*S%1],y[`u_dem_scale${A}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0;const d=this._visibleDemTiles.reduce((y,b)=>{if(!b.dem)return y;const T=b.dem.tree.minimums[0];return T>0&&l++,y+T},0);return l?d/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,d=l.gl;l.activeTexture.set(d.TEXTURE2);const y=this._getLoadedAreaMinimum(),[b,T]=(()=>{const A=new a.bB({width:1,height:1},new Float32Array([y]));return[d.R32F,A]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(T,{premultiply:!1}):S=this._emptyDEMTexture=new a.T(l,T,b,{premultiply:!1}),S}setupElevationDraw(l,d,y){const b=this.painter.context,T=b.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let A=null,k=null,L=1;if(y&&y.morphing&&this._useVertexMorphing){const Z=y.morphing.srcDemTile,se=y.morphing.dstDemTile;L=y.morphing.phase,Z&&se&&(this._prepareDemTileUniforms(l,Z,S,"_prev")&&(k=Z),this._prepareDemTileUniforms(l,se,S)&&(A=se))}const B=Z=>Z&&Z.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let U=null;var q;if(this.enabled?k&&A?(U=A.demTexture,b.activeTexture.set(T.TEXTURE4),k.demTexture.bind(B(k),T.CLAMP_TO_EDGE),S.u_dem_lerp=L):(A=this.terrainTileForTile[l.tileID.key],U=this._prepareDemTileUniforms(l,A,S)?A.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,b.activeTexture.set(T.TEXTURE2),U&&(S.u_dem_size=(q=U).size[0]===1?1:q.size[0]-2,U.bind(B(A),T.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,d,S),y&&y.useMeterToDem&&A){const Z=(1<<A.tileID.canonical.z)*a.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=Z}if(y&&y.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),d.setTerrainUniformValues(b,S),this.painter.transform.projection.name==="globe"){const Z=this.globeUniformValues(this.painter.transform,l.tileID.canonical,y&&y.useDenormalizedUpVectorScale);d.setGlobeUniformValues(b,Z)}}globeUniformValues(l,d,y){const b=l.projection;return{u_tile_tl_up:b.upVector(d,0,0),u_tile_tr_up:b.upVector(d,a.a4,0),u_tile_br_up:b.upVector(d,a.a4,a.a4),u_tile_bl_up:b.upVector(d,0,a.a4),u_tile_up_scale:y?a.bu(1):b.upVectorScale(d,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const d=this.painter,y=this.painter.context;l.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,T,S,A,k){if(b.transform.projection.name==="globe")(function(L,B,U,q,Z){const se=L.context,oe=se.gl;let ae,ce;const xe=L.transform,be=a.bc(L,se,xe),ve=(nt,et)=>{if(ce===et)return;const qe=[Al[et],"PROJECTION_GLOBE_VIEW"];be&&qe.push("CUSTOM_ANTIALIASING");const St=L.isTileAffectedByFog(nt);ae=L.getOrCreateProgram("globeRaster",{defines:qe,overrideFog:St}),ce=et},ke=L.colorModeForRenderPass(),Ce=new a.af(oe.LEQUAL,a.af.ReadWrite,L.depthRangeFor3D);Ja.update(Z);const Ae=a.bd(xe),Ne=[a.ak(xe.center.lng),a.al(xe.center.lat)],Fe=L.globeSharedBuffers,Ze=[xe.width*a.e.devicePixelRatio,xe.height*a.e.devicePixelRatio],je=Float32Array.from(xe.globeMatrix),Me={useDenormalizedUpVectorScale:!0};{const nt=L.transform,et=ds(nt.zoom,B.exaggeration(),B.sourceCache._source.tileSize);ce=-1;const qe=oe.TRIANGLES;for(const St of q){const yt=U.getTile(St),Xe=a.ah.disabled,ot=B.prevTerrainTileForTile[St.key],$e=B.terrainTileForTile[St.key];ou(ot,$e)&&Ja.newMorphing(St.key,ot,$e,Z,250),se.activeTexture.set(oe.TEXTURE0),yt.texture&&yt.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const vt=Ja.getMorphValuesForProxy(St.key),bt=vt?1:0;vt&&a.q(Me,{morphing:{srcDemTile:vt.from,dstDemTile:vt.to,phase:a.bb(vt.phase)}});const Vt=a.be(St.canonical),Ht=a.bf(Vt.getCenter().lat),ln=a.bg(St.canonical,Vt,Ht,nt.worldSize/nt._pixelsPerMercatorPixel),Yt=a.bh(a.bi(St.canonical)),wn=tu(nt.expandedFarZProjMatrix,je,Ae,Yt,a.a2(nt.zoom),Ne,nt.frustumCorners.TL,nt.frustumCorners.TR,nt.frustumCorners.BR,nt.frustumCorners.BL,nt.globeCenterInViewSpace,nt.globeRadius,Ze,et,nt._farZ,ln);if(ve(St,bt),ae&&(B.setupElevationDraw(yt,ae,Me),L.uploadCommonUniforms(se,ae,St.toUnwrapped()),Fe)){const[Gn,In,Xn]=Fe.getGridBuffers(Ht,et!==0);ae.draw(L,qe,Ce,Xe,ke,a.ag.backCCW,wn,"globe_raster",Gn,In,Xn)}}}if(Fe&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&nt.push("CUSTOM_ANTIALIASING"),ae=L.getOrCreateProgram("globeRaster",{defines:nt});for(const et of q){const{x:qe,y:St,z:yt}=et.canonical,Xe=St===0,ot=St===(1<<yt)-1,[$e,vt,bt,Vt]=Fe.getPoleBuffers(yt,!1);if(Vt&&(Xe||ot)){const Ht=U.getTile(et);se.activeTexture.set(oe.TEXTURE0),Ht.texture&&Ht.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let ln=a.bj(yt,qe,xe);const Yt=a.bh(a.bi(et.canonical)),wn=(Gn,In)=>Gn.draw(L,oe.TRIANGLES,Ce,a.ah.disabled,ke,a.ag.disabled,tu(xe.expandedFarZProjMatrix,ln,ln,Yt,0,Ne,xe.frustumCorners.TL,xe.frustumCorners.TR,xe.frustumCorners.BR,xe.frustumCorners.BL,xe.globeCenterInViewSpace,xe.globeRadius,Ze,0,xe._farZ),"globe_pole_raster",In,bt,Vt);B.setupElevationDraw(Ht,ae,Me),L.uploadCommonUniforms(se,ae,et.toUnwrapped()),Xe&&L.renderDefaultNorthPole&&wn(ae,$e),ot&&L.renderDefaultSouthPole&&(ln=a.ae.scale(a.ae.create(),ln,[1,-1,1]),wn(ae,vt))}}}})(b,T,S,A,k);else{const L=b.context,B=L.gl;let U,q;const Z=b.shadowRenderer,se=$s(b,b.longestCutoffRange),oe=ke=>{if(q===ke)return;const Ce=[];Ce.push(Al[ke]),se.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),U=b.getOrCreateProgram("terrainRaster",{defines:Ce}),q=ke},ae=b.colorModeForRenderPass(),ce=new a.af(B.LEQUAL,a.af.ReadWrite,b.depthRangeFor3D);Ja.update(k);const xe=b.transform,be=ds(xe.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let ve=[0,0,0];if(Z){const ke=b.style.directionalLight,Ce=b.style.ambientLight;ke&&Ce&&(ve=su(b.style,ke,Ce))}{q=-1;const ke=B.TRIANGLES,[Ce,Ae]=[T.gridIndexBuffer,T.gridSegments];for(const Ne of A){const Fe=S.getTile(Ne),Ze=a.ah.disabled,je=T.prevTerrainTileForTile[Ne.key],Me=T.terrainTileForTile[Ne.key];ou(je,Me)&&Ja.newMorphing(Ne.key,je,Me,k,250),L.activeTexture.set(B.TEXTURE0),Fe.texture&&Fe.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const nt=Ja.getMorphValuesForProxy(Ne.key),et=nt?1:0;let qe;nt&&(qe={morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:a.bb(nt.phase)}});const St=eu(Ne.projMatrix,au(Ne.canonical,xe.renderWorldCopies)?be/10:be,ve);if(oe(et),!U)continue;T.setupElevationDraw(Fe,U,qe);const yt=Ne.toUnwrapped();Z&&Z.setupShadows(yt,U),b.uploadCommonUniforms(L,U,yt,null,se),U.draw(b,ke,ce,Ze,ae,a.ag.backCCW,St,"terrain_raster",T.gridBuffer,Ce,Ae)}}}}(d,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const d=this.painter,y=this.painter.context,b=this.proxySourceCache,T=this.proxiedCoords[b.id],S=this._drapedRenderBatches.shift(),A=d.style.order,k=[];let L=0;for(const B of T){const U=b.getTileByID(B.proxyTileKey),q=b.proxyCachedFBO[B.key]?b.proxyCachedFBO[B.key][l]:void 0,Z=q!==void 0?b.renderCache[q]:this.pool[L++],se=q!==void 0;if(U.texture=Z.tex,se&&!Z.dirty){k.push(U.tileID);continue}let oe;y.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(y.clear({color:a.C.transparent,stencil:0}),Z.dirty=!1);for(let ae=S.start;ae<=S.end;++ae){const ce=d.style._mergedLayers[A[ae]];if(ce.isHidden(d.transform.zoom))continue;const xe=d.style.getLayerSourceCache(ce),be=xe?this.proxyToSource[B.key][xe.id]:[B];if(!be)continue;const ve=be;y.viewport.set([0,0,Z.fb.width,Z.fb.height]),oe!==(xe?xe.id:null)&&(this._setupStencil(Z,be,ce,xe),oe=xe?xe.id:null),d.renderLayer(d,xe,ce,ve)}if(this._drapedRenderBatches.length===0)for(const ae of this._pendingGroundEffectLayers){const ce=d.style._mergedLayers[A[ae]];if(ce.isHidden(d.transform.zoom))continue;const xe=d.style.getLayerSourceCache(ce),be=xe?this.proxyToSource[B.key][xe.id]:[B];if(!be)continue;const ve=be;y.viewport.set([0,0,Z.fb.width,Z.fb.height]),oe!==(xe?xe.id:null)&&(this._setupStencil(Z,be,ce,xe),oe=xe?xe.id:null),d.renderLayer(d,xe,ce,ve)}this.renderedToTile?(Z.dirty=!0,k.push(U.tileID)):se||--L,L===5&&(L=0,this.renderToBackBuffer(k))}return this.renderToBackBuffer(k),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),S.end+1}postRender(){}isLayerOrderingCorrect(l){const d=l.order.length;let y=-1,b=d;for(let T=0;T<d;++T)this._style.isLayerDraped(l._mergedLayers[l.order[T]])?y=Math.max(y,T):b=Math.min(b,T);return b>y}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{l=Math.min(l,d.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,d,y){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const S=T.tileID,A=1<<S.overscaledZ,{x:k,y:L}=S.canonical,B=k/A,U=(k+1)/A,q=L/A,Z=(L+1)/A;return{minx:B,miny:q,maxx:U,maxy:Z,t:T.dem.tree.raycastRoot(B,q,U,Z,l,d,y),tile:T}});b.sort((T,S)=>(T.t!==null?T.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const T of b){if(T.t==null)return null;const S=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,l,d,y);if(S!=null)return S}return null}_createFBO(){const l=this.painter.context,d=l.gl,y=this.drapeBufferSize;l.activeTexture.set(d.TEXTURE0);const b=new a.T(l,{width:y[0],height:y[1],data:null},d.RGBA);b.bind(d.LINEAR,d.CLAMP_TO_EDGE);const T=l.createFramebuffer(y[0],y[1],!0,null);return T.colorAttachment.set(b.texture),T.depthAttachment=new Sn(l,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:T,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const d=this._style._mergedLayers[l],y=d.isHidden(this.painter.transform.zoom);return d.type==="custom"?!y&&d.shouldRedrape():!y&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const y of this._style.getSources())if(y instanceof yg){l=!0;break}if(!l)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(T&&!d[T.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof a.Z){d[T.id]=!0;for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][T.id];if(A)for(const k of A)this._clearRenderCacheForTile(T.id,k)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof Ro){l=!0;break}if(!l)return;const d={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(!T||d[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const S=b.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const k=this.proxyToSource[A.key][T.id];if(k)for(const L of k){const B=el(T.getTile(L),T.findLoadedParent(L,0),T,this.painter.transform,S);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(T.id,L)}}}}_setupDrapedRenderBatches(){const l=this._style.order,d=l.length;if(d===0)return;const y=[];this._pendingGroundEffectLayers=[];let b,T=0,S=this._style._mergedLayers[l[T]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++T<d;)S=this._style._mergedLayers[l[T]];for(;T<d;++T){const A=this._style._mergedLayers[l[T]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?b===void 0&&(b=T):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),b!==void 0&&(y.push({start:b,end:T-1}),b=void 0)))}if(b!==void 0&&y.push({start:b,end:T-1}),y.length!==0){const A=y[y.length-1];this._pendingGroundEffectLayers.every(k=>k>A.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(l){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const S=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let A=0;A<S.length;++A){const k=Object.values(S[A]);d.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,b=this._tilesDirty;for(let S=y.length-1;S>=0;S--){const A=y[S];if(d.getTileByID(A.key),d.proxyCachedFBO[A.key]!==void 0){const k=l[A.key],L=this.proxyToSource[A.key];let B=0;for(const U in L){const q=L[U],Z=k[U];if(!Z||Z.length!==q.length||q.some((se,oe)=>se!==Z[oe]||b[U]&&b[U].hasOwnProperty(se.key))){B=-1;break}++B}for(const U in d.proxyCachedFBO[A.key])d.renderCache[d.proxyCachedFBO[A.key][U]].dirty=B<0||B!==Object.values(k).length}}const T=[...this._drapedRenderBatches];T.sort((S,A)=>A.end-A.start-(S.end-S.start));for(const S of T)for(const A of y){if(d.proxyCachedFBO[A.key])continue;let k=d.renderCachePool.pop();k===void 0&&d.renderCache.length<50&&(k=d.renderCache.length,d.renderCache.push(this._createFBO())),k!==void 0&&(d.proxyCachedFBO[A.key]={},d.proxyCachedFBO[A.key][S.start]=k,d.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(l,d,y,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,S=T.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let A;if(y.isTileClipped())A=d.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):a.ah.disabled}_renderTileClippingMasks(l,d){const y=this.painter,b=this.painter.context,T=b.gl;y._tileClippingMaskIDs={},b.setColorMode(a.a.disabled),b.setDepthMode(a.af.disabled);const S=y.getOrCreateProgram("clippingMask");for(const A of l){const k=y._tileClippingMaskIDs[A.key]=--d;S.draw(y,T.TRIANGLES,a.af.disabled,new a.ah({func:T.ALWAYS,mask:0},k,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.ag.disabled,lu(A.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(l){const d=this.painter.transform;if(l.x<0||l.x>d.width||l.y<0||l.y>d.height)return null;const y=[l.x,l.y,1,1];a.aB.transformMat4(y,y,d.pixelMatrixInverse),a.aB.scale(y,y,1/y[3]),y[0]/=d.worldSize,y[1]/=d.worldSize;const b=d._camera.position,T=a.ay(1,d.center.lat),S=[b[0],b[1],b[2]/T,0],A=a.$.subtract([],y.slice(0,3),S);a.$.normalize(A,A);const k=this.raycast(S,A,this._exaggeration);return k!==null&&k?(a.$.scaleAndAdd(S,S,A,k),S[3]=S[2],S[2]*=T,S):null}_setupProxiedCoordsForOrtho(l,d,y){if(l.getSource()instanceof a.bo)return this._setupProxiedCoordsForImageSource(l,d,y);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const b=this.proxiedCoords[l.id]=[],T=this.proxyCoords;for(let k=0;k<T.length;k++){const L=T[k],B=this._findTileCoveringTileID(L,l);if(B){const U=this._createProxiedId(L,B,y[L.key]&&y[L.key][l.id]);b.push(U),this.proxyToSource[L.key][l.id]=[U]}}let S=!1;const A=new Set;for(let k=0;k<d.length;k++){const L=l.getTile(d[k]);if(!L||!L.hasData())continue;const B=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==L.tileID.canonical.z){const U=this.proxyToSource[B.tileID.key][l.id],q=this._createProxiedId(B.tileID,L,y[B.tileID.key]&&y[B.tileID.key][l.id]);U?U.splice(U.length-1,0,q):this.proxyToSource[B.tileID.key][l.id]=[q];const Z=this.proxyToSource[B.tileID.key][l.id];A.has(Z)||A.add(Z),b.push(q),S=!0}}if(this._sourceTilesOverlap[l.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const k of A)k.sort((L,B)=>B.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(l,d,y){if(!l.getSource().loaded())return;const b=this.proxiedCoords[l.id]=[],T=this.proxyCoords,S=l.getSource(),A=S.tileID;if(!A)return;const k=new a.P(A.x,A.y)._div(1<<A.z),L=S.coordinates.map(a._.fromLngLat).reduce((U,q)=>(U.min.x=Math.min(U.min.x,q.x-k.x),U.min.y=Math.min(U.min.y,q.y-k.y),U.max.x=Math.max(U.max.x,q.x-k.x),U.max.y=Math.max(U.max.y,q.y-k.y),U),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(U,q)=>{const Z=U.wrap+U.canonical.x/(1<<U.canonical.z),se=U.canonical.y/(1<<U.canonical.z),oe=a.a4/(1<<U.canonical.z),ae=q.wrap+q.canonical.x/(1<<q.canonical.z),ce=q.canonical.y/(1<<q.canonical.z);return Z+oe<ae+L.min.x||Z>ae+L.max.x||se+oe<ce+L.min.y||se>ce+L.max.y};for(let U=0;U<T.length;U++){const q=T[U];for(let Z=0;Z<d.length;Z++){const se=l.getTile(d[Z]);if(!se||!se.hasData()||B(q,se.tileID))continue;const oe=this._createProxiedId(q,se,y[q.key]&&y[q.key][l.id]),ae=this.proxyToSource[q.key][l.id];ae?ae.push(oe):this.proxyToSource[q.key][l.id]=[oe],b.push(oe)}}}_createProxiedId(l,d,y){let b=this.orthoMatrix;if(y){const T=y.find(S=>S.key===d.tileID.key);if(T)return T}if(d.tileID.key!==l.key){const T=l.canonical.z-d.tileID.canonical.z;let S,A,k;b=a.ae.create();const L=d.tileID.wrap-l.wrap<<l.overscaledZ;T>0?(S=a.a4>>T,A=S*((d.tileID.canonical.x<<T)-l.canonical.x+L),k=S*((d.tileID.canonical.y<<T)-l.canonical.y)):(S=a.a4<<-T,A=a.a4*(d.tileID.canonical.x-(l.canonical.x+L<<-T)),k=a.a4*(d.tileID.canonical.y-(l.canonical.y<<-T))),a.ae.ortho(b,0,S,0,S,0,1),a.ae.translate(b,b,[A,k,0])}return new kt(d.tileID,l.key,b)}_findTileCoveringTileID(l,d){let y=d.getTile(l);if(y&&y.hasData())return y;const b=this._findCoveringTileCache[d.id],T=b[l.key];if(y=T?d.getTileByID(T):null,y&&y.hasData()||T===null)return y;let S=y?y.tileID:l,A=S.overscaledZ;const k=d.getSource().minzoom,L=[];if(!T){const U=d.getSource().maxzoom;if(l.canonical.z>=U){const q=l.canonical.z-U;d.getSource().reparseOverscaled?(A=Math.max(l.canonical.z+2,d.transform.tileZoom),S=new a.aQ(A,l.wrap,U,l.canonical.x>>q,l.canonical.y>>q)):q!==0&&(A=U,S=new a.aQ(A,l.wrap,U,l.canonical.x>>q,l.canonical.y>>q))}S.key!==l.key&&(L.push(S.key),y=d.getTile(S))}const B=U=>{L.forEach(q=>{b[q]=U}),L.length=0};for(A-=1;A>=k&&(!y||!y.hasData());A--){y&&B(y.tileID.key);const U=S.calculateScaledKey(A);if(y=d.getTileByID(U),y&&y.hasData())break;const q=b[U];if(q===null)break;q===void 0?L.push(U):y=d.getTileByID(q)}return B(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,d){let y=this._tilesDirty[l];y||(y=this._tilesDirty[l]={}),y[d.key]=!0}}function ui(g,l,d){const y=function(A,k,L){const B=a.$.dot(k,A),U=a.$.dot(L,[.2126,.7152,.0722]),q=(se,oe,ae)=>(1-ae)*se+ae*oe,Z=q(1-.3*Math.min(U,1),1,Math.min(B+1,1));return q(.92,1,Math.asin(a.au(k[2],-1,1))/Math.PI+.5)*Z}(g,[0,0,1],l),b=[0,0,0];a.$.scale(b,d.slice(0,3),y);const T=[0,0,0];a.$.scale(T,l.slice(0,3),g[2]);const S=[0,0,0];return a.$.add(S,b,T),a.ba(S)}const xs=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Gr=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Os{static cacheKey(l,d,y,b){let T=`${d}${b?b.cacheKey:""}`;for(const S of y)l.usedDefines.includes(S)&&(T+=`/${S}`);return T}constructor(l,d,y,b,T,S){const A=l.gl;this.program=A.createProgram(),this.configuration=b,this.name=d,this.fixedDefines=[...S];const k=b?b.getBinderAttributes():[],L=(y.staticAttributes||[]).concat(k);let B=b?b.defines():[];B=B.concat(S.map(ae=>`#define ${ae}`));const U=`#version 300 es
`;let q=U+B.concat("precision mediump float;",pg,gd.fragmentSource).join(`
`);for(const ae of y.fragmentIncludes)q+=`
${th[ae]}`;q+=`
${y.fragmentSource}`;let Z=U+B.concat("precision highp float;",pg,gd.vertexSource).join(`
`);for(const ae of y.vertexIncludes)Z+=`
${th[ae]}`;Z+=`
${y.vertexSource}`;const se=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(se,q),A.compileShader(se),A.attachShader(this.program,se);const oe=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(oe,Z),A.compileShader(oe),A.attachShader(this.program,oe),this.attributes={},this.numAttributes=L.length;for(let ae=0;ae<this.numAttributes;ae++)if(L[ae]){const ce=L[ae].startsWith("a_")?L[ae]:`a_${L[ae]}`;A.bindAttribLocation(this.program,ae,ce),this.attributes[ce]=ae}A.linkProgram(this.program),A.deleteShader(oe),A.deleteShader(se),this.fixedUniforms=T(l),this.binderUniforms=b?b.getUniforms(l):[],(S.includes("TERRAIN")||d.indexOf("symbol")!==-1||d.indexOf("circle")!==-1)&&(this.terrainUniforms=(ae=>({u_dem:new a.a8(ae),u_dem_prev:new a.a8(ae),u_dem_tl:new a.a9(ae),u_dem_scale:new a.ab(ae),u_dem_tl_prev:new a.a9(ae),u_dem_scale_prev:new a.ab(ae),u_dem_size:new a.ab(ae),u_dem_lerp:new a.ab(ae),u_exaggeration:new a.ab(ae),u_depth:new a.a8(ae),u_depth_size_inv:new a.a9(ae),u_depth_range_unpack:new a.a9(ae),u_occluder_half_size:new a.ab(ae),u_occlusion_depth_offset:new a.ab(ae),u_meter_to_dem:new a.ab(ae),u_label_plane_matrix_inv:new a.a7(ae)}))(l)),S.includes("GLOBE")&&(this.globeUniforms=(ae=>({u_tile_tl_up:new a.ar(ae),u_tile_tr_up:new a.ar(ae),u_tile_br_up:new a.ar(ae),u_tile_bl_up:new a.ar(ae),u_tile_up_scale:new a.ab(ae)}))(l)),S.includes("FOG")&&(this.fogUniforms=(ae=>({u_fog_matrix:new a.a7(ae),u_fog_range:new a.a9(ae),u_fog_color:new a.at(ae),u_fog_horizon_blend:new a.ab(ae),u_fog_vertical_limit:new a.a9(ae),u_fog_temporal_offset:new a.ab(ae),u_frustum_tl:new a.ar(ae),u_frustum_tr:new a.ar(ae),u_frustum_br:new a.ar(ae),u_frustum_bl:new a.ar(ae),u_globe_pos:new a.ar(ae),u_globe_radius:new a.ab(ae),u_globe_transition:new a.ab(ae),u_is_globe:new a.a8(ae),u_viewport:new a.a9(ae)}))(l)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ae=>({u_cutoff_params:new a.at(ae)}))(l)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ae=>({u_lighting_ambient_color:new a.ar(ae),u_lighting_directional_dir:new a.ar(ae),u_lighting_directional_color:new a.ar(ae),u_ground_radiance:new a.ar(ae)}))(l)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ae=>({u_light_matrix_0:new a.a7(ae),u_light_matrix_1:new a.a7(ae),u_fade_range:new a.a9(ae),u_shadow_normal_offset:new a.ar(ae),u_shadow_intensity:new a.ab(ae),u_shadow_texel_size:new a.ab(ae),u_shadow_map_resolution:new a.ab(ae),u_shadow_direction:new a.ar(ae),u_shadow_bias:new a.ar(ae),u_shadowmap_0:new a.a8(ae),u_shadowmap_1:new a.a8(ae)}))(l))}}setTerrainUniformValues(l,d){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setGlobeUniformValues(l,d){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b]&&y[b].set(this.program,b,d[b])}}setFogUniformValues(l,d){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setCutoffUniformValues(l,d){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setLightsUniformValues(l,d){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}}setShadowUniformValues(l,d){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;l.program.set(this.program);for(const b in d)y[b].set(this.program,b,d[b])}_drawDebugWireframe(l,d,y,b,T,S,A,k,L,B){const U=l.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const q=l.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||l._terrain&&l._terrain.renderingToTexture||!xs.includes(this.name))||!(!U.layers3D||!Gr.includes(this.name))))return;const Z=q.gl,se=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,T,q);if(!se)return;const oe=[...this.fixedDefines];oe.push("DEBUG_WIREFRAME");const ae=l.getOrCreateProgram(this.name,{config:this.configuration,defines:oe});q.program.set(ae.program);const ce=(ve,ke,Ce)=>{if(ke[ve]&&Ce[ve])for(const Ae in ke[ve])Ce[ve][Ae]&&Ce[ve][Ae].set(Ce.program,Ae,ke[ve][Ae].current)};L&&L.setUniforms(ae.program,q,ae.binderUniforms,A,{zoom:k}),ce("fixedUniforms",this,ae),ce("terrainUniforms",this,ae),ce("globeUniforms",this,ae),ce("fogUniforms",this,ae),ce("lightsUniforms",this,ae),ce("shadowUniforms",this,ae),se.bind(),q.setColorMode(new a.a([Z.ONE,Z.ONE_MINUS_SRC_ALPHA,Z.ZERO,Z.ONE],a.C.transparent,[!0,!0,!0,!1])),q.setDepthMode(new a.af(d.func===Z.LESS?Z.LEQUAL:d.func,a.af.ReadOnly,d.range)),q.setStencilMode(a.ah.disabled);const xe=3*S.primitiveLength*2,be=3*S.primitiveOffset*2*2;B&&B>1?Z.drawElementsInstanced(Z.LINES,xe,Z.UNSIGNED_SHORT,be,B):Z.drawElements(Z.LINES,xe,Z.UNSIGNED_SHORT,be),T.bind(),q.program.set(this.program),q.setDepthMode(d),q.setStencilMode(y),q.setColorMode(b)}draw(l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe,ae){const ce=l.context,xe=ce.gl;if(this.failedToCreate)return;ce.program.set(this.program),ce.setDepthMode(y),ce.setStencilMode(b),ce.setColorMode(T),ce.setCullFace(S);for(const ke of Object.keys(this.fixedUniforms))this.fixedUniforms[ke].set(this.program,ke,A[ke]);se&&se.setUniforms(this.program,ce,this.binderUniforms,q,{zoom:Z});const be={[xe.POINTS]:1,[xe.LINES]:2,[xe.TRIANGLES]:3,[xe.LINE_STRIP]:1}[d],ve=ae&&ae>0?1:void 0;for(const ke of U.get()){const Ce=ke.vaos||(ke.vaos={});(Ce[k]||(Ce[k]=new mg)).bind(ce,this,L,se?se.getPaintVertexBuffers():[],B,ke.vertexOffset,oe||[],ve),ae&&ae>1?xe.drawElementsInstanced(d,ke.primitiveLength*be,xe.UNSIGNED_SHORT,ke.primitiveOffset*be*2,ae):B?xe.drawElements(d,ke.primitiveLength*be,xe.UNSIGNED_SHORT,ke.primitiveOffset*be*2):xe.drawArrays(d,ke.vertexOffset,ke.vertexLength),d===xe.TRIANGLES&&B&&this._drawDebugWireframe(l,y,b,T,B,ke,q,Z,se,ae)}}}function Ls(g,l){const d=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,g.transform.tileZoom)/d,b=y*(l.tileID.canonical.x+l.tileID.wrap*d),T=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.bD(l,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T]}}const pc=a.ae.create(),fs=(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe,ae,ce)=>{const xe=l.style.light,be=xe.properties.get("position"),ve=[be.x,be.y,be.z],ke=a.bE.create();xe.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(ke,-l.transform.angle),a.$.transformMat3(ve,ve,ke));const Ce=xe.properties.get("color"),Ae=l.transform,Ne={u_matrix:g,u_lightpos:ve,u_lightintensity:xe.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+d,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:T,u_alignment:S,u_width_scale:A,u_flood_light_color:Z,u_vertical_scale:se,u_flood_light_intensity:oe,u_ground_shadow_factor:ae,u_emissive_strength:ce};return Ae.projection.name==="globe"&&(Ne.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],Ne.u_zoom_transition=B,Ne.u_inv_rot_matrix=q,Ne.u_merc_center=U,Ne.u_up_dir=Ae.projection.upVector(new a.aO(0,0,0),U[0]*a.a4,U[1]*a.a4),Ne.u_height_lift=L),Ne},mc=(g,l,d,y,b)=>({u_matrix:g,u_edge_radius:l,u_alignment:d,u_width_scale:y,u_vertical_scale:b}),xd=(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe)=>{const ae=fs(g,l,d,y,b,T,S,A,k,B,U,q,Z,se,oe,1,[0,0,0],0),ce={u_height_factor:-Math.pow(2,k.overscaledZ)/L.tileSize/8};return a.Q(ae,Ls(l,L),ce)},lp=(g,l)=>({u_matrix:g,u_emissive_strength:l}),xg=(g,l,d,y)=>a.Q(lp(g,l),Ls(d,y)),bg=(g,l,d)=>({u_matrix:g,u_world:d,u_emissive_strength:l}),cp=(g,l,d,y,b)=>a.Q(xg(g,l,d,y),{u_world:b}),bd=(g,l,d,y)=>{const b=a.a4/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(y),u_extrude_scale:[l.pixelsToGLUnits[0]/b,l.pixelsToGLUnits[1]/b]}},wg=(g,l,d=1)=>({u_matrix:g,u_color:l.toRenderColor(null),u_overlay:0,u_overlay_scale:d}),Lb=a.ae.create(),zb=(g,l,d,y,b,T,S)=>{const A=g.transform,k=A.projection.name==="globe",L=k?a.bF(A.zoom,l.canonical)*A._pixelsPerMercatorPixel:a.bD(d,1,T),B={u_matrix:l.projMatrix,u_extrude_scale:L,u_intensity:S,u_inv_rot_matrix:Lb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){B.u_inv_rot_matrix=y,B.u_merc_center=b,B.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],B.u_zoom_transition=a.a2(A.zoom);const U=b[0]*a.a4,q=b[1]*a.a4;B.u_up_dir=A.projection.upVector(new a.aO(0,0,0),U,q)}return B};function y0(g,[l,d,y,b],[T,S]){if(T===S)return[0,0,0,0];const A=255*(g-1)/(g*(S-T));return[l*A,d*A,y*A,b*A]}function up(g,l,[d,y]){return d===y?0:.5/g+(l-d)*(g-1)/(g*(y-d))}const Tg=(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe,ae,ce,xe,be,ve)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:d,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:L,u_fade_t:B.mix,u_opacity:B.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:a.bG(U.paint.get("raster-saturation")),u_contrast_factor:a.bH(U.paint.get("raster-contrast")),u_spin_weights:v0(U.paint.get("raster-hue-rotate")),u_perspective_transform:q,u_raster_elevation:Z,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:k,u_colorization_mix:y0(a.bI,oe,ce),u_colorization_offset:up(a.bI,ae,ce),u_color_ramp:se,u_texture_offset:[be/(xe+2*be),xe/(xe+2*be)],u_texture_res:[xe+2*be,xe+2*be],u_emissive_strength:ve});function v0(g){g*=Math.PI/180;const l=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const Pl=.05,oh=(g,l,d,y,b,T,S,A,k,L,B,U)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:d,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:L,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:k}),EA=(g,l,d,y,b,T,S,A,k,L)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_tile_offset:d,u_velocity:y,u_color_ramp:T,u_velocity_res:b,u_max_speed:S,u_uv_offset:A,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Pl,Pl]}),Nb=(g,l,d,y,b,T,S,A,k,L)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_velocity:d,u_velocity_res:y,u_max_speed:b,u_speed_factor:T,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*k[0],255*k[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Pl,Pl]}),hp=a.ae.create(),wd=(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe,ae,ce)=>{const xe=b.transform,be={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:xe.getCameraToCenterDistance(oe),u_rotate_symbol:+d,u_aspect_ratio:xe.width/xe.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+k,u_pitch_with_map:+y,u_texsize:L,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:hp,u_up_vector:[0,-1,0],u_color_adj_mat:ae,u_icon_transition:ce||0};return oe.name==="globe"&&(be.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],be.u_zoom_transition=U,be.u_inv_rot_matrix=Z,be.u_merc_center=q,be.u_camera_forward=xe._camera.forward(),be.u_ecef_origin=a.bJ(xe.globeMatrix,B.toUnwrapped()),be.u_tile_matrix=Float32Array.from(xe.globeMatrix),be.u_up_vector=se),be},dp=(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe,ae)=>a.Q(wd(g,l,d,y,b,T,S,A,k,L,U,q,Z,se,oe,ae),{u_gamma_scale:y?b.transform.getCameraToCenterDistance(ae)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:a.e.devicePixelRatio,u_is_halo:+B,undefined:void 0}),x0=(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe)=>a.Q(dp(g,l,d,y,b,T,S,A,!0,k,!0,B,U,q,Z,se,oe),{u_texsize_icon:L,u_texture_icon:1}),b0=(g,l,d,y)=>({u_matrix:g,u_emissive_strength:l,u_opacity:d,u_color:y}),SA=(g,l,d,y,b,T,S,A)=>a.Q(function(k,L,B,U,q){const{width:Z,height:se}=U.imageManager.getPixelSize(L),oe=Math.pow(2,q.tileID.overscaledZ),ae=q.tileSize*Math.pow(2,U.transform.tileZoom)/oe,ce=ae*(q.tileID.canonical.x+q.tileID.wrap*oe),xe=ae*q.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[Z,se],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/a.bD(q,1,U.transform.tileZoom),u_pixel_coord_upper:[ce>>16,xe>>16],u_pixel_coord_lower:[65535&ce,65535&xe]}}(0,T,S,y,A),{u_matrix:g,u_emissive_strength:l,u_opacity:d}),Ra=new Float32Array(a.ae.identity([])),ah=(g,l,d,y,b,T,S,A,k,L,B,U,q,Z=[0,0,0],se)=>{const oe=b.style.light,ae=oe.properties.get("position"),ce=[-ae.x,-ae.y,ae.z],xe=a.bE.create();oe.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(xe,-b.transform.angle),a.$.transformMat3(ce,ce,xe));const be=B.alphaMode==="MASK",ve=oe.properties.get("color").toRenderColor(null),ke=q.paint.get("model-ambient-occlusion-intensity"),Ce=q.paint.get("model-color").constantOr(a.C.white).toRenderColor(null),Ae=q.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:l,u_normal_matrix:d,u_node_matrix:y||Ra,u_lightpos:ce,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[ve.r,ve.g,ve.b],u_camera_pos:Z,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+be,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:k,u_roughnessFactor:L,u_baseColorTexture:Ds.BaseColor,u_metallicRoughnessTexture:Ds.MetallicRoughness,u_normalTexture:Ds.Normal,u_occlusionTexture:Ds.Occlusion,u_emissionTexture:Ds.Emission,u_lutTexture:Ds.LUT,u_color_mix:[Ce.r,Ce.g,Ce.b,Ae],u_aoIntensity:ke,u_emissive_strength:U,u_occlusionTextureTransform:se||[0,0,0,0]}},w0=(g,l=Ra,d=Ra)=>({u_matrix:g,u_instance:l,u_node_matrix:d}),Fb={fillExtrusion:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_opacity:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_flood_light_color:new a.ar(g),u_vertical_scale:new a.ab(g),u_flood_light_intensity:new a.ab(g),u_ground_shadow_factor:new a.ar(g),u_emissive_strength:new a.ab(g)}),fillExtrusionDepth:g=>({u_matrix:new a.a7(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_vertical_scale:new a.ab(g)}),fillExtrusionPattern:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_height_factor:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g),u_opacity:new a.ab(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new a.a7(g),u_opacity:new a.ab(g),u_ao_pass:new a.ab(g),u_meter_to_tile:new a.ab(g),u_ao:new a.a9(g),u_flood_light_intensity:new a.ab(g),u_flood_light_color:new a.ar(g),u_attenuation:new a.ab(g),u_edge_radius:new a.ab(g),u_fb:new a.a8(g),u_fb_size:new a.ab(g)}),fill:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g)}),fillPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),fillOutline:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g)}),fillOutlinePattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),circle:a.bK,collisionBox:g=>({u_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_extrude_scale:new a.a9(g)}),collisionCircle:g=>({u_matrix:new a.a7(g),u_inv_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_viewport_size:new a.a9(g)}),debug:g=>({u_color:new a.aa(g),u_matrix:new a.a7(g),u_overlay:new a.a8(g),u_overlay_scale:new a.ab(g)}),clippingMask:g=>({u_matrix:new a.a7(g)}),heatmap:g=>({u_extrude_scale:new a.ab(g),u_intensity:new a.ab(g),u_matrix:new a.a7(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_up_dir:new a.ar(g)}),heatmapTexture:g=>({u_image:new a.a8(g),u_color_ramp:new a.a8(g),u_opacity:new a.ab(g)}),hillshade:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_latrange:new a.a9(g),u_light:new a.a9(g),u_shadow:new a.aa(g),u_highlight:new a.aa(g),u_emissive_strength:new a.ab(g),u_accent:new a.aa(g)}),hillshadePrepare:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_dimension:new a.a9(g),u_zoom:new a.ab(g)}),line:a.bL,linePattern:a.bM,raster:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_brightness_low:new a.ab(g),u_brightness_high:new a.ab(g),u_saturation_factor:new a.ab(g),u_contrast_factor:new a.ab(g),u_spin_weights:new a.ar(g),u_perspective_transform:new a.a9(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g),u_colorization_mix:new a.at(g),u_colorization_offset:new a.ab(g),u_color_ramp:new a.a8(g),u_texture_offset:new a.a9(g),u_texture_res:new a.a9(g),u_emissive_strength:new a.ab(g)}),rasterParticle:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g)}),rasterParticleTexture:g=>({u_texture:new a.a8(g),u_opacity:new a.ab(g)}),rasterParticleDraw:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_tile_offset:new a.a9(g),u_velocity:new a.a8(g),u_color_ramp:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),rasterParticleUpdate:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_velocity:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_speed_factor:new a.ab(g),u_reset_rate:new a.ab(g),u_rand_seed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_texture:new a.a8(g),u_icon_transition:new a.ab(g),u_color_adj_mat:new a.a7(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texture:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_is_halo:new a.a8(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texsize_icon:new a.a9(g),u_texture:new a.a8(g),u_texture_icon:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_is_halo:new a.a8(g)}),background:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_color:new a.aa(g)}),backgroundPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_image:new a.a8(g),u_pattern_tl:new a.a9(g),u_pattern_br:new a.a9(g),u_texsize:new a.a9(g),u_pattern_size:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),terrainRaster:g=>({u_matrix:new a.a7(g),u_image0:new a.a8(g),u_skirt_height:new a.ab(g),u_ground_shadow_factor:new a.ar(g)}),skybox:g=>({u_matrix:new a.a7(g),u_sun_direction:new a.ar(g),u_cubemap:new a.a8(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxGradient:g=>({u_matrix:new a.a7(g),u_color_ramp:new a.a8(g),u_center_direction:new a.ar(g),u_radius:new a.ab(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxCapture:g=>({u_matrix_3f:new a.as(g),u_sun_direction:new a.ar(g),u_sun_intensity:new a.ab(g),u_color_tint_r:new a.at(g),u_color_tint_m:new a.at(g),u_luminance:new a.ab(g)}),globeRaster:g=>({u_proj_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_image0:new a.a8(g),u_grid_matrix:new a.as(g),u_skirt_height:new a.ab(g),u_far_z_cutoff:new a.ab(g),u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_globe_pos:new a.ar(g),u_globe_radius:new a.ab(g),u_viewport:new a.a9(g)}),globeAtmosphere:g=>({u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_horizon:new a.ab(g),u_transition:new a.ab(g),u_fadeout_range:new a.ab(g),u_color:new a.at(g),u_high_color:new a.at(g),u_space_color:new a.at(g),u_temporal_offset:new a.ab(g),u_horizon_angle:new a.ab(g)}),model:g=>({u_matrix:new a.a7(g),u_lighting_matrix:new a.a7(g),u_normal_matrix:new a.a7(g),u_node_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_camera_pos:new a.ar(g),u_opacity:new a.ab(g),u_baseColorFactor:new a.at(g),u_emissiveFactor:new a.at(g),u_metallicFactor:new a.ab(g),u_roughnessFactor:new a.ab(g),u_baseTextureIsAlpha:new a.a8(g),u_alphaMask:new a.a8(g),u_alphaCutoff:new a.ab(g),u_baseColorTexture:new a.a8(g),u_metallicRoughnessTexture:new a.a8(g),u_normalTexture:new a.a8(g),u_occlusionTexture:new a.a8(g),u_emissionTexture:new a.a8(g),u_lutTexture:new a.a8(g),u_color_mix:new a.at(g),u_aoIntensity:new a.ab(g),u_emissive_strength:new a.ab(g),u_occlusionTextureTransform:new a.at(g)}),modelDepth:g=>({u_matrix:new a.a7(g),u_instance:new a.a7(g),u_node_matrix:new a.a7(g)}),groundShadow:g=>({u_matrix:new a.a7(g),u_ground_shadow_factor:new a.ar(g)}),stars:g=>({u_matrix:new a.a7(g),u_up:new a.ar(g),u_right:new a.ar(g),u_intensity_multiplier:new a.ab(g)}),occlusion:g=>({u_matrix:new a.a7(g),u_anchorPos:new a.ar(g),u_screenSizePx:new a.a9(g),u_occluderSizePx:new a.a9(g),u_color:new a.at(g)})};function lh(g,l,d){const y=l.createTileMatrix(g,g.worldSize,d.toUnwrapped());return a.ae.multiply(new Float32Array(16),g.projMatrix,y)}function Bb(g,l,d){if(l.projection.name===d.projection.name)return g.projMatrix;const y=d.clone();return y.setProjection(l.projection),lh(y,l.getProjection(),g)}function T0(g,l,d){return l.name===d.projection.name?g.projMatrix:lh(d,l,g)}let Td;function jb(g,l,d,y,b,T,S){const A=g.context,k=A.gl,L=g.transform,B=g.getOrCreateProgram("collisionBox"),U=[];let q=0,Z=0;for(let ve=0;ve<y.length;ve++){const ke=y[ve],Ce=l.getTile(ke),Ae=Ce.getBucket(d);if(!Ae)continue;const Ne=Bb(ke,Ae,L);let Fe=Ne;b[0]===0&&b[1]===0||(Fe=g.translatePosMatrix(Ne,Ce,b,T));const Ze=S?Ae.textCollisionBox:Ae.iconCollisionBox,je=Ae.collisionCircleArray;if(je.length>0){const Me=a.ae.create(),nt=Fe;a.ae.mul(Me,Ae.placementInvProjMatrix,L.glCoordMatrix),a.ae.mul(Me,Me,Ae.placementViewportMatrix),U.push({circleArray:je,circleOffset:Z,transform:nt,invTransform:Me,projection:Ae.getProjection()}),q+=je.length/4,Z=q}Ze&&(g.terrain&&g.terrain.setupElevationDraw(Ce,B),B.draw(g,k.LINES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,bd(Fe,L,Ce,Ae.getProjection()),d.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,null,L.zoom,null,[Ze.collisionVertexBuffer,Ze.collisionVertexBufferExt]))}if(!S||!U.length)return;const se=g.getOrCreateProgram("collisionCircle"),oe=new a.bN;oe.resize(4*q),oe._trim();let ae=0;for(const ve of U)for(let ke=0;ke<ve.circleArray.length/4;ke++){const Ce=4*ke,Ae=ve.circleArray[Ce+0],Ne=ve.circleArray[Ce+1],Fe=ve.circleArray[Ce+2],Ze=ve.circleArray[Ce+3];oe.emplace(ae++,Ae,Ne,Fe,Ze,0),oe.emplace(ae++,Ae,Ne,Fe,Ze,1),oe.emplace(ae++,Ae,Ne,Fe,Ze,2),oe.emplace(ae++,Ae,Ne,Fe,Ze,3)}(!Td||Td.length<2*q)&&(Td=function(ve){const ke=2*ve,Ce=new a.bw;Ce.resize(ke),Ce._trim();for(let Ae=0;Ae<ke;Ae++){const Ne=6*Ae;Ce.uint16[Ne+0]=4*Ae+0,Ce.uint16[Ne+1]=4*Ae+1,Ce.uint16[Ne+2]=4*Ae+2,Ce.uint16[Ne+3]=4*Ae+2,Ce.uint16[Ne+4]=4*Ae+3,Ce.uint16[Ne+5]=4*Ae+0}return Ce}(q));const ce=A.createIndexBuffer(Td,!0),xe=A.createVertexBuffer(oe,a.bO.members,!0);for(const ve of U){const ke={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(be=L).getCameraToCenterDistance(ve.projection),u_viewport_size:[be.width,be.height]};se.draw(g,k.TRIANGLES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,ke,d.id,xe,ce,a.b.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,L.zoom)}var be;xe.destroy(),ce.destroy()}const fp=a.ae.create();function Ub(g){const l=g._camera.getWorldToCamera(g.worldSize,1),d=a.ae.multiply([],l,g.globeMatrix);a.ae.invert(d,d);const y=[0,0,0],b=[0,1,0,0];return a.aB.transformMat4(b,b,d),y[0]=b[0],y[1]=b[1],y[2]=b[2],a.$.normalize(y,y),y}function Vb({width:g,height:l,anchor:d,textOffset:y,textScale:b},T){const{horizontalAlign:S,verticalAlign:A}=a.bS(d),k=-(S-.5)*g,L=-(A-.5)*l,B=a.bR(d,y);return new a.P((k/b+B[0])*T,(L/b+B[1])*T)}function IA(g,l,d,y,b,T,S,A,k,L,B){const U=g.text.placedSymbolArray,q=g.text.dynamicLayoutVertexArray,Z=g.icon.dynamicLayoutVertexArray,se={},oe=g.getProjection(),ae=T0(A,oe,T),ce=T.elevation,xe=oe.upVectorScale(A.canonical,T.center.lat,T.worldSize).metersToTile;q.clear();for(let be=0;be<U.length;be++){const ve=U.get(be),{tileAnchorX:ke,tileAnchorY:Ce,numGlyphs:Ae}=ve,Ne=ve.hidden||!ve.crossTileID||g.allowVerticalPlacement&&!ve.placedOrientation?null:y[ve.crossTileID];if(Ne){let Fe=0,Ze=0,je=0;if(ce){const $e=ce?ce.getAtTileOffset(A,ke,Ce):0,[vt,bt,Vt]=oe.upVector(A.canonical,ke,Ce);Fe=$e*vt*xe,Ze=$e*bt*xe,je=$e*Vt*xe}let[Me,nt,et,qe]=xo(ve.projectedAnchorX+Fe,ve.projectedAnchorY+Ze,ve.projectedAnchorZ+je,d?ae:S);const St=Yn(T.getCameraToCenterDistance(oe),qe);let yt=b.evaluateSizeForFeature(g.textSizeData,L,ve)*St/a.bP;d&&(yt*=g.tilePixelRatio/k);const Xe=Vb(Ne,yt);d?({x:Me,y:nt,z:et}=oe.projectTilePoint(ke+Xe.x,Ce+Xe.y,A.canonical),[Me,nt,et]=xo(Me+Fe,nt+Ze,et+je,S)):(l&&Xe._rotate(-T.angle),Me+=Xe.x,nt+=Xe.y,et=0);const ot=g.allowVerticalPlacement&&ve.placedOrientation===a.aF.vertical?Math.PI/2:0;for(let $e=0;$e<Ae;$e++)a.aI(q,Me,nt,et,ot);B&&ve.associatedIconIndex>=0&&(se[ve.associatedIconIndex]={x:Me,y:nt,z:et,angle:ot})}else Pa(Ae,q)}if(B){Z.clear();const be=g.icon.placedSymbolArray;for(let ve=0;ve<be.length;ve++){const ke=be.get(ve),{numGlyphs:Ce}=ke,Ae=se[ve];if(ke.hidden||!Ae)Pa(Ce,Z);else{const{x:Ne,y:Fe,z:Ze,angle:je}=Ae;for(let Me=0;Me<Ce;Me++)a.aI(Z,Ne,Fe,Ze,je)}}g.icon.dynamicLayoutVertexBuffer.updateData(Z)}g.text.dynamicLayoutVertexBuffer.updateData(q)}function pp(g,l,d,y,b,T,S={}){const A=d.paint.get("icon-translate"),k=d.paint.get("text-translate"),L=d.paint.get("icon-translate-anchor"),B=d.paint.get("text-translate-anchor"),U=d.layout.get("icon-rotation-alignment"),q=d.layout.get("text-rotation-alignment"),Z=d.layout.get("icon-pitch-alignment"),se=d.layout.get("text-pitch-alignment"),oe=d.layout.get("icon-keep-upright"),ae=d.layout.get("text-keep-upright"),ce=d.paint.get("icon-color-saturation"),xe=d.paint.get("icon-color-contrast"),be=d.paint.get("icon-color-brightness-min"),ve=d.paint.get("icon-color-brightness-max");d.paint.get("icon-occlusion-opacity").constantOr(0),d.paint.get("text-occlusion-opacity").constantOr(0);const ke=g.context,Ce=ke.gl,Ae=g.transform,Ne=U==="map",Fe=q==="map",Ze=Z==="map",je=se==="map",Me=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let nt=!1;const et=g.depthModeForSublayer(0,a.af.ReadOnly),qe=[a.ak(Ae.center.lng),a.al(Ae.center.lat)],St=d.layout.get("text-variable-anchor"),yt=Ae.projection.name==="globe",Xe=[],ot=[0,-1,0];for(const $e of y){const vt=l.getTile($e),bt=vt.getBucket(d);if(!bt||bt.projection.name==="mercator"&&yt||bt.fullyClipped)continue;const Vt=bt.projection.name==="globe",Ht=Vt?a.a2(Ae.zoom):0,ln=T0($e,bt.getProjection(),Ae),Yt=Ae.calculatePixelsToTileUnitsMatrix(vt),wn=St&&bt.hasTextData(),Gn=bt.hasIconTextFit()&&wn&&bt.hasIconData(),In=bt.getProjection().createInversionMatrix(Ae,$e.canonical),Xn=wr=>{Ae.depthOcclusionForSymbolsAndCircles&&(d.hasInitialOcclusionOpacityProperties||g.terrain)&&(wr.push("DEPTH_D24"),wr.push("DEPTH_OCCLUSION"))},pr=()=>{const wr=Ne&&d.layout.get("symbol-placement")!=="point",or=[];Xn(or);const Mn=wr||Gn,Wi=d.paint.get("icon-image-cross-fade").constantOr(0);g.terrainRenderModeElevated()&&Ze&&or.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(or.push("PROJECTION_GLOBE_VIEW"),Mn&&or.push("PROJECTED_POS_ON_VIEWPORT")),Wi>0&&or.push("ICON_TRANSITION"),bt.icon.zOffsetVertexBuffer&&or.push("Z_OFFSET"),ce===0&&xe===0&&be===0&&ve===1||or.push("COLOR_ADJUSTMENT");const Hi=bt.icon.programConfigurations.get(d.id),co=g.getOrCreateProgram(bt.sdfIcons?"symbolSDF":"symbolIcon",{config:Hi,defines:or});let uo;const Ys=vt.imageAtlasTexture?vt.imageAtlasTexture.size:[0,0],ho=bt.iconSizeData,qs=a.aE(ho,Ae.zoom),Js=Ze||Ae.pitch!==0,Rt=ru(ln,vt.tileID.canonical,Ze,Ne,Ae,bt.getProjection(),Yt),un=rh(ln,vt.tileID.canonical,Ze,Ne,Ae,bt.getProjection(),Yt),wo=g.translatePosMatrix(un,vt,A,L,!0),Wr=g.translatePosMatrix(ln,vt,A,L),tt=Mn?fp:Rt,xc=Ne&&!Ze&&!wr;let rl=ot;!yt&&!Ae.mercatorFromTransition||Ne||(rl=Ub(Ae));const bc=Vt?rl:ot;if(bt.sdfIcons&&!bt.iconsInText)uo=dp(ho.kind,qs,xc,Ze,g,Wr,tt,wo,!1,Ys,!0,$e,Ht,qe,In,bc,bt.getProjection());else{const _h=d.getColorAdjustmentMatrix(ce,xe,be,ve);uo=wd(ho.kind,qs,xc,Ze,g,Wr,tt,wo,!1,Ys,$e,Ht,qe,In,bc,bt.getProjection(),_h,Wi)}const wc=vt.imageAtlasTexture?vt.imageAtlasTexture:null,Zg=d.layout.get("icon-size").constantOr(0)!==1||bt.iconsNeedLinear,Xg=bt.sdfIcons||g.options.rotating||g.options.zooming||Zg||Js?Ce.LINEAR:Ce.NEAREST,pu=bt.sdfIcons&&d.paint.get("icon-halo-width").constantOr(1)!==0,X0=g.terrain&&Ze&&wr?a.ae.invert(a.ae.create(),Rt):fp;if(wr&&bt.icon){const _h=Ae.elevation,Kg=_h?_h.getAtTileOffsetFunc($e,Ae.center.lat,Ae.worldSize,bt.getProjection()):null,Ld=nh(ln,vt.tileID.canonical,Ze,Ne,Ae,bt.getProjection(),Yt);cc(bt,ln,g,!1,Ld,un,Ze,oe,Kg,$e)}return{program:co,buffers:bt.icon,uniformValues:uo,atlasTexture:wc,atlasTextureIcon:null,atlasInterpolation:Xg,atlasInterpolationIcon:null,isSDF:bt.sdfIcons,hasHalo:pu,tile:vt,labelPlaneMatrixInv:X0}},ei=()=>{const wr=Fe&&d.layout.get("symbol-placement")!=="point",or=[],Mn=wr||St||Gn;g.terrainRenderModeElevated()&&je&&or.push("PITCH_WITH_MAP_TERRAIN"),Vt&&(or.push("PROJECTION_GLOBE_VIEW"),Mn&&or.push("PROJECTED_POS_ON_VIEWPORT")),bt.text.zOffsetVertexBuffer&&or.push("Z_OFFSET"),Xn(or);const Wi=bt.text.programConfigurations.get(d.id),Hi=g.getOrCreateProgram(bt.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Wi,defines:or});let co,uo=[0,0],Ys=null;const ho=bt.textSizeData;bt.iconsInText&&(uo=vt.imageAtlasTexture?vt.imageAtlasTexture.size:[0,0],Ys=vt.imageAtlasTexture?vt.imageAtlasTexture:null,co=je||Ae.pitch!==0||g.options.rotating||g.options.zooming||ho.kind==="composite"||ho.kind==="camera"?Ce.LINEAR:Ce.NEAREST);const qs=vt.glyphAtlasTexture?vt.glyphAtlasTexture.size:[0,0],Js=a.aE(ho,Ae.zoom),Rt=ru(ln,vt.tileID.canonical,je,Fe,Ae,bt.getProjection(),Yt),un=rh(ln,vt.tileID.canonical,je,Fe,Ae,bt.getProjection(),Yt),wo=g.translatePosMatrix(un,vt,k,B,!0),Wr=g.translatePosMatrix(ln,vt,k,B),tt=Mn?fp:Rt,xc=Fe&&!je&&!wr;let rl=ot;!yt&&!Ae.mercatorFromTransition||Fe||(rl=Ub(Ae));const bc=Vt?rl:ot;let wc;wc=bt.iconsInText?x0(ho.kind,Js,xc,je,g,Wr,tt,wo,qs,uo,$e,Ht,qe,In,bc,bt.getProjection()):dp(ho.kind,Js,xc,je,g,Wr,tt,wo,!0,qs,!0,$e,Ht,qe,In,bc,bt.getProjection());const Zg=vt.glyphAtlasTexture?vt.glyphAtlasTexture:null,Xg=Ce.LINEAR,pu=d.paint.get("text-halo-width").constantOr(1)!==0,X0=g.terrain&&je&&wr?a.ae.invert(a.ae.create(),Rt):fp;if(wr&&bt.text){const _h=Ae.elevation,Kg=_h?_h.getAtTileOffsetFunc($e,Ae.center.lat,Ae.worldSize,bt.getProjection()):null,Ld=nh(ln,vt.tileID.canonical,je,Fe,Ae,bt.getProjection(),Yt);cc(bt,ln,g,!0,Ld,un,je,ae,Kg,$e)}return{program:Hi,buffers:bt.text,uniformValues:wc,atlasTexture:Zg,atlasTextureIcon:Ys,atlasInterpolation:Xg,atlasInterpolationIcon:co,isSDF:!0,hasHalo:pu,tile:vt,labelPlaneMatrixInv:X0}},jr=bt.icon.segments.get().length,_r=bt.text.segments.get().length,Br=jr&&!S.onlyText?pr():null,Jn=_r&&!S.onlyIcons?ei():null,rr=d.paint.get("icon-opacity").constantOr(1),Wn=d.paint.get("text-opacity").constantOr(1);if(Me&&bt.canOverlap){nt=!0;const wr=rr&&!S.onlyText?bt.icon.segments.get():[],or=Wn&&!S.onlyIcons?bt.text.segments.get():[];for(const Mn of wr)Xe.push({segments:new a.b([Mn]),sortKey:Mn.sortKey,state:Br});for(const Mn of or)Xe.push({segments:new a.b([Mn]),sortKey:Mn.sortKey,state:Jn})}else S.onlyText||Xe.push({segments:rr?bt.icon.segments:new a.b([]),sortKey:0,state:Br}),S.onlyIcons||Xe.push({segments:Wn?bt.text.segments:new a.b([]),sortKey:0,state:Jn})}nt&&Xe.sort(($e,vt)=>$e.sortKey-vt.sortKey);for(const $e of Xe){const vt=$e.state;if(vt)if(g.terrain?g.terrain.setupElevationDraw(vt.tile,vt.program,{useDepthForOcclusion:Ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:vt.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Ae.depthOcclusionForSymbolsAndCircles,vt.program),ke.activeTexture.set(Ce.TEXTURE0),vt.atlasTexture&&vt.atlasTexture.bind(vt.atlasInterpolation,Ce.CLAMP_TO_EDGE,!0),vt.atlasTextureIcon&&(ke.activeTexture.set(Ce.TEXTURE1),vt.atlasTextureIcon&&vt.atlasTextureIcon.bind(vt.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,vt.program),vt.hasHalo){const bt=vt.uniformValues;bt.u_is_halo=1,E0(vt.buffers,$e.segments,d,g,vt.program,et,b,T,bt,2),bt.u_is_halo=0}else{if(vt.isSDF){const bt=vt.uniformValues;vt.hasHalo&&(bt.u_is_halo=1,E0(vt.buffers,$e.segments,d,g,vt.program,et,b,T,bt,1)),bt.u_is_halo=0}E0(vt.buffers,$e.segments,d,g,vt.program,et,b,T,vt.uniformValues,1)}}}function E0(g,l,d,y,b,T,S,A,k,L){const B=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];b.draw(y,y.context.gl.TRIANGLES,T,S,A,a.ag.disabled,k,d.id,g.layoutVertexBuffer,g.indexBuffer,l,d.paint,y.transform.zoom,g.programConfigurations.get(d.id),B,L)}function mp(g,l,d,y,b,T,S){const A=g.context.gl,k=d.paint.get("fill-pattern"),L=k&&k.constantOr(1);let B,U,q,Z,se;S?(U=L&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):(U=L?"fillPattern":"fill",B=A.TRIANGLES);for(const oe of y){const ae=l.getTile(oe);if(L&&!ae.patternsLoaded())continue;const ce=ae.getBucket(d);if(!ce)continue;g.prepareDrawTile();const xe=ce.programConfigurations.get(d.id),be=g.isTileAffectedByFog(oe),ve=g.getOrCreateProgram(U,{config:xe,overrideFog:be});L&&(g.context.activeTexture.set(A.TEXTURE0),ae.imageAtlasTexture&&ae.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),xe.updatePaintBuffers());const ke=k.constantOr(null);if(ke&&ae.imageAtlas){const Ne=ae.imageAtlas.patternPositions[ke.toString()];Ne&&xe.setConstantPatternPositions(Ne)}const Ce=g.translatePosMatrix(oe.projMatrix,ae,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor")),Ae=d.paint.get("fill-emissive-strength");if(S){Z=ce.indexBuffer2,se=ce.segments2;const Ne=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];q=U==="fillOutlinePattern"&&L?cp(Ce,Ae,g,ae,Ne):bg(Ce,Ae,Ne)}else Z=ce.indexBuffer,se=ce.segments,q=L?xg(Ce,Ae,g,ae):lp(Ce,Ae);g.uploadCommonUniforms(g.context,ve,oe.toUnwrapped()),ve.draw(g,B,b,g.stencilModeForClipping(oe),T,a.ag.disabled,q,d.id,ce.layoutVertexBuffer,Z,se,d.paint,g.transform.zoom,xe,void 0)}}function ch(g,l,d,y,b,T,S,A){d.resetLayerRenderingStats(g);const k=g.context,L=k.gl,B=g.transform,U=d.paint.get("fill-extrusion-pattern"),q=U.constantOr(1),Z=d.paint.get("fill-extrusion-opacity"),se=g.style.enable3dLights(),oe=d.paint.get(se&&!q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],ce=d.layout.get("fill-extrusion-edge-radius"),xe=ce>0&&!d.paint.get("fill-extrusion-rounded-roof"),be=xe?0:ce,ve=B.projection.name==="globe"?a.b_():0,ke=B.projection.name==="globe",Ce=ke?a.a2(B.zoom):0,Ae=[a.ak(B.center.lng),a.al(B.center.lat)],Ne=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(d.lut).toArray01().slice(0,3),Fe=d.paint.get("fill-extrusion-flood-light-intensity"),Ze=d.paint.get("fill-extrusion-vertical-scale"),je=d.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Me=$s(g,d.paint.get("fill-extrusion-cutoff-fade-range")),nt=d.paint.get("fill-extrusion-emissive-strength"),et=[];ke&&et.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&et.push("FAUX_AO"),xe&&et.push("ZERO_ROOF_RADIUS"),A&&et.push("HAS_CENTROID"),Fe>0&&et.push("FLOOD_LIGHT"),Me.shouldRenderCutoff&&et.push("RENDER_CUTOFF"),je&&et.push("RENDER_WALL_MODE");const qe=(()=>{const Vt=d.paint.get("fill-extrusion-line-alignment");switch(Vt){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return a.w(`Unsupported value for fill-extrusion-line-alignment: ${Vt}`),0}})();let St;const yt=g.renderPass==="shadow",Xe=g.shadowRenderer,ot=yt&&!!Xe;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let $e=[0,0,0];if(Xe){const Vt=g.style.directionalLight,Ht=g.style.ambientLight;Vt&&Ht&&($e=su(g.style,Vt,Ht)),St=et.concat(["SHADOWS_SINGLE_CASCADE"])}const vt=ot?"fillExtrusionDepth":q?"fillExtrusionPattern":"fillExtrusion",bt=d.getLayerRenderingStats();for(const Vt of y){const Ht=l.getTile(Vt),ln=Ht.getBucket(d);if(!ln||ln.projection.name!==B.projection.name)continue;let Yt=!1;Xe&&(Yt=Xe.getMaxCascadeForTile(Vt.toUnwrapped())===0);const wn=g.isTileAffectedByFog(Vt),Gn=ln.programConfigurations.get(d.id),In=g.getOrCreateProgram(vt,{config:Gn,defines:Yt?St:et,overrideFog:wn});if(g.terrain&&g.terrain.setupElevationDraw(Ht,In,{useMeterToDem:!0}),!ln.centroidVertexBuffer){const Jn=In.attributes.a_centroid_pos;Jn!==void 0&&L.vertexAttrib2f(Jn,0,0)}!yt&&Xe&&Xe.setupShadows(Ht.tileID.toUnwrapped(),In,"vector-tile",Ht.tileID.overscaledZ),q&&(g.context.activeTexture.set(L.TEXTURE0),Ht.imageAtlasTexture&&Ht.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Gn.updatePaintBuffers());const Xn=U.constantOr(null);if(Xn&&Ht.imageAtlas){const Jn=Ht.imageAtlas.patternPositions[Xn.toString()];Jn&&Gn.setConstantPatternPositions(Jn)}const pr=d.paint.get("fill-extrusion-vertical-gradient"),ei=1/ln.tileToMeter;let jr;if(yt&&Xe){if(Rl(Ht.tileID,ln,g))continue;const Jn=Xe.calculateShadowPassMatrixFromTile(Ht.tileID.toUnwrapped());jr=mc(Jn,be,qe,ei,Ze)}else{const Jn=g.translatePosMatrix(Vt.expandedProjMatrix,Ht,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),rr=B.projection.createInversionMatrix(B,Vt.canonical);jr=q?xd(Jn,g,pr,Z,ae,be,qe,ei,Vt,Ht,ve,Ce,Ae,rr,Ne,Ze):fs(Jn,g,pr,Z,ae,be,qe,ei,Vt,ve,Ce,Ae,rr,Ne,Ze,Fe,$e,nt)}g.uploadCommonUniforms(k,In,Vt.toUnwrapped(),null,Me);let _r=ln.segments;if(B.projection.name==="mercator"&&!yt&&(_r=ln.getVisibleSegments(Ht.tileID,g.terrain,g.transform.getFrustum(0)),!_r.get().length))continue;if(bt)if(yt)for(const Jn of _r.get())bt.numRenderedVerticesInShadowPass+=Jn.primitiveLength;else for(const Jn of _r.get())bt.numRenderedVerticesInTransparentPass+=Jn.primitiveLength;const Br=[];(g.terrain||A)&&Br.push(ln.centroidVertexBuffer),ke&&Br.push(ln.layoutVertexExtBuffer),je&&Br.push(ln.wallVertexBuffer),In.draw(g,k.gl.TRIANGLES,b,T,S,a.ag.backCCW,jr,d.id,ln.layoutVertexBuffer,ln.indexBuffer,_r,d.paint,g.transform.zoom,Gn,Br)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function Ed(g,l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe,ae,ce,xe){const be=g.context,ve=be.gl,ke=g.transform,Ce=g.transform.zoom,Ae=[],Ne=$s(g,d.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(Ae.push("CLEAR_SUBPASS"),xe&&(Ae.push("CLEAR_FROM_TEXTURE"),be.activeTexture.set(ve.TEXTURE0),xe.bind(ve.LINEAR,ve.CLAMP_TO_EDGE))):L==="sdf"&&Ae.push("SDF_SUBPASS"),ae&&Ae.push("HAS_CENTROID"),Ne.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF");const Fe=d.layout.get("fill-extrusion-edge-radius"),Ze=(je,Me,nt,et,qe)=>{const St=Me.programConfigurations.get(d.id),yt=g.isTileAffectedByFog(je),Xe=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:St,defines:Ae,overrideFog:yt}),ot=((vt,bt,Vt,Ht,ln,Yt,wn,Gn,In,Xn,pr)=>({u_matrix:bt,u_opacity:Vt,u_ao_pass:Ht?1:0,u_meter_to_tile:ln,u_ao:Yt,u_flood_light_intensity:wn,u_flood_light_color:Gn,u_attenuation:In,u_edge_radius:Xn,u_fb:0,u_fb_size:pr}))(0,et,B,k,qe,[U,q*qe],Z,se,oe,Ce>=17?0:Fe*qe,xe?xe.size[0]:0),$e=[];ae&&$e.push(Me.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(be,Xe,je.toUnwrapped(),null,Ne),Xe.draw(g,be.gl.TRIANGLES,b,T,S,A,ot,d.id,Me.vertexBuffer,Me.indexBuffer,nt,d.paint,Ce,St,$e)};for(const je of y){const Me=l.getTile(je),nt=Me.getBucket(d);if(!nt||nt.projection.name!==ke.projection.name||!nt.groundEffect||nt.groundEffect&&!nt.groundEffect.hasData())continue;const et=nt.groundEffect,qe=1/nt.tileToMeter;{const St=g.translatePosMatrix(je.projMatrix,Me,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),yt=et.getDefaultSegment();Ze(je,et,yt,St,qe)}if(ce)for(let St=0;St<4;St++){const yt=a.b$[St](je),Xe=l.getTile(yt);if(!Xe)continue;const ot=Xe.getBucket(d);if(!ot||ot.projection.name!==ke.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;const $e=ot.groundEffect;let vt,bt;St===0?(vt=[-a.a4,0,0],bt=1):St===1?(vt=[a.a4,0,0],bt=0):St===2?(vt=[0,-a.a4,0],bt=3):(vt=[0,a.a4,0],bt=2);const Vt=$e.regionSegments[bt];if(!Vt)continue;const Ht=new Float32Array(16);a.ae.translate(Ht,je.projMatrix,vt),Ze(je,$e,Vt,g.translatePosMatrix(Ht,Me,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),qe)}}}function CA(g,l,d,y,b,T,S){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const A=T?T.findDEMTileFor(d):null;if(!(A&&A.dem||S))return;const k=ce=>new a.P(Math.ceil((ce+a.c2)*a.c3),0),L=ce=>{const xe=l.getSource().minzoom,be=ke=>{const Ce=l.getTileByID(ke);if(Ce&&Ce.hasData())return Ce.getBucket(b)},ve=[0,-1,1];for(const ke of ve){if(ce.overscaledZ+ke<xe)continue;const Ce=be(ce.calculateScaledKey(ce.overscaledZ+ke));if(Ce)return Ce}},B=[0,0,0],U=(ce,xe)=>(B[0]=Math.min(ce.min.y,xe.min.y),B[1]=Math.max(ce.max.y,xe.max.y),B[2]=a.a4-xe.min.x>ce.max.x?xe.min.x-a.a4:ce.max.x,B),q=(ce,xe)=>(B[0]=Math.min(ce.min.x,xe.min.x),B[1]=Math.max(ce.max.x,xe.max.x),B[2]=a.a4-xe.min.y>ce.max.y?xe.min.y-a.a4:ce.max.y,B),Z=[(ce,xe)=>U(ce,xe),(ce,xe)=>U(xe,ce),(ce,xe)=>q(ce,xe),(ce,xe)=>q(xe,ce)],se=(ce,xe,be,ve,ke,Ce,Ae)=>{if(!T)return 0;const Ne=[[Ce?be:ce,Ce?ce:be,0],[Ce?be:xe,Ce?xe:be,0]],Fe=Ae<0?a.a4+Ae:Ae,Ze=[Ce?Fe:(ce+xe)/2,Ce?(ce+xe)/2:Fe,0];return be===0&&Ae<0||be!==0&&Ae>0?T.getForTilePoints(ke,[Ze],!0,ve):Ne.push(Ze),T.getForTilePoints(d,Ne,!0,A),Math.max(Ne[0][2],Ne[1][2],Ze[2])/T.exaggeration()};for(let ce=0;ce<4;ce++){const xe=y.borderFeatureIndices[ce];if(xe.length===0)continue;const be=a.b$[ce](d),ve=L(be);if(!(ve&&ve instanceof a.c0)||y.borderDoneWithNeighborZ[ce]===ve.canonical.z)continue;ve.centroidVertexArray.length===0&&ve.createCentroidsBuffer();const ke=T?T.findDEMTileFor(be):null;if(!(ke&&ke.dem||S))continue;const Ce=(ce<2?1:5)-ce,Ae=ve.borderDoneWithNeighborZ[Ce]!==y.canonical.z,Ne=ve.borderFeatureIndices[Ce];let Fe=0;if(y.canonical.z!==ve.canonical.z){for(const Ze of xe)y.showCentroid(y.featuresOnBorder[Ze]);if(Ae)for(const Ze of Ne)ve.showCentroid(ve.featuresOnBorder[Ze]);y.borderDoneWithNeighborZ[ce]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ce]=y.canonical.z}for(const Ze of xe){const je=y.featuresOnBorder[Ze],Me=y.centroidData[je.centroidDataIndex],nt=je.borders[ce];let et;for(;Fe<Ne.length;){et=ve.featuresOnBorder[Ne[Fe]];const qe=et.borders[Ce];if(qe[1]>nt[0]+3||qe[0]>nt[0]-3)break;ve.showCentroid(et),Fe++}if(et&&Fe<Ne.length){const qe=Fe;let St=0;for(;!(et.borders[Ce][0]>nt[1]-3)&&(St++,++Fe!==Ne.length);)et=ve.featuresOnBorder[Ne[Fe]];if(et=ve.featuresOnBorder[Ne[qe]],St>1){const ot=et.borders[Ce];Math.abs(nt[0]-ot[0])<3&&Math.abs(nt[1]-ot[1])<3&&(St=1,Fe=qe+1)}else if(St===0){y.showCentroid(je);continue}const yt=ve.centroidData[et.centroidDataIndex];S&&St===1&&(((oe=Me).flags|(ae=yt).flags)&a.c1?(oe.flags|=a.c1,ae.flags|=a.c1):(oe.flags&=~a.c1,ae.flags&=~a.c1));const Xe=je.intersectsCount()>1||et.intersectsCount()>1;if(St>1)Fe=qe,Me.centroidXY=yt.centroidXY=new a.P(0,0);else if(ke&&ke.dem&&!Xe){const ot=Z[ce](Me,yt),$e=ce%2?a.a4-1:0,vt=se(ot[0],Math.min(a.a4-1,ot[1]),$e,ke,be,ce<2,ot[2]);Me.centroidXY=yt.centroidXY=k(vt)}else Xe?Me.centroidXY=yt.centroidXY=new a.P(0,0):(Me.centroidXY=y.encodeBorderCentroid(je),yt.centroidXY=ve.encodeBorderCentroid(et));y.writeCentroidToBuffer(Me),ve.writeCentroidToBuffer(yt)}else y.showCentroid(je)}y.borderDoneWithNeighborZ[ce]=ve.canonical.z,ve.borderDoneWithNeighborZ[Ce]=y.canonical.z}var oe,ae;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const $b=[1,0,0],AA=[0,1,0],Eg=[0,0,1];function Rl(g,l,d){const y=d.transform,b=d.shadowRenderer;if(!b)return!0;const T=g.toUnwrapped(),S=y.tileSize*b._cascades[d.currentShadowCascade].scale;let A=l.maxHeight;if(y.elevation){const oe=y.elevation.getMinMaxForTile(g);oe&&(A+=oe.max)}const k=[...b.shadowDirection];k[2]=-k[2];const L=b.computeSimplifiedTileShadowVolume(T,A,S,k);if(!L)return!1;const B=[$b,AA,Eg,k,[k[0],0,k[2]],[0,k[1],k[2]]],U=y.projection.name==="globe",q=y.scaleZoom(S),Z=a.aM.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,q,!U),se=b.getCurrentCascadeFrustum();return Z.intersectsPrecise(L.vertices,L.planes,B)===0||se.intersectsPrecise(L.vertices,L.planes,B)===0}function gp(g){return[g[0]*a.c4,g[1]*a.c4,g[2]*a.c4,0]}function Sg(g,l,d,y,b,T,S,A,k){const L=y.getSource(),B=d.globeSharedBuffers;if(!B)return;let U,q,Z;if(l&&(U=y.getTile(l)),L instanceof a.bo?(q=L.texture,Z=a.bj(0,0,d.transform)):U&&l&&(q=U.texture,Z=a.bj(l.canonical.z,l.canonical.x,d.transform)),!q||!Z)return;g||(Z=a.ae.scale(a.ae.create(),Z,[1,-1,1]));const se=d.context,oe=se.gl,ae=b.paint.get("raster-resampling")==="nearest"?oe.NEAREST:oe.LINEAR,ce=d.colorModeForDrapableLayerRenderPass(T),xe=S.defines;xe.push("GLOBE_POLES");const be=new a.af(oe.LEQUAL,a.af.ReadWrite,d.depthRangeFor3D),ve=Float32Array.from(d.transform.expandedFarZProjMatrix),ke=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0))));d.terrain&&d.terrain.prepareDrawTile(),se.activeTexture.set(oe.TEXTURE0),q.bind(ae,oe.CLAMP_TO_EDGE),se.activeTexture.set(oe.TEXTURE1),q.bind(ae,oe.CLAMP_TO_EDGE),q.useMipmap&&se.extTextureFilterAnisotropic&&d.transform.pitch>20&&oe.texParameterf(oe.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const[Ce,Ae,Ne,Fe]=l?B.getPoleBuffers(l.canonical.z,!1):B.getPoleBuffers(0,!0),Ze=b.paint.get("raster-elevation");let je;g?(je=Ce,d.renderDefaultNorthPole=Ze!==0):(je=Ae,d.renderDefaultSouthPole=Ze!==0);const Me=gp(S.mix),nt=((qe,St,yt,Xe,ot,$e,vt,bt,Vt,Ht,ln,Yt,wn)=>Tg(qe,St,yt,new Float32Array(16),new Float32Array(9),[0,0],Xe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},$e,[0,0],bt,2,Ht,ln,Yt,1,0,wn))(ve,ke,Z,a.a2(d.transform.zoom),0,b,0,Ze,0,Me,S.offset,S.range,T),et=d.getOrCreateProgram("raster",{defines:xe});d.uploadCommonUniforms(se,et,null),et.draw(d,oe.TRIANGLES,be,k,ce,A,nt,b.id,je,Ne,Fe)}function S0(g){const l=g._nearZ,d=g.projection.farthestPixelDistance(g),y=d-l,b=.2*g.height,T=l+b;return[l,d,(T-b-l)/y,(T-l)/y]}function uh(g,l,d,y){if(g)return l instanceof R&&g instanceof a.c5?l.getTextureDescriptor(g,d,!0):{texture:g.texture,mix:gp(y.mix),offset:y.offset,buffer:0,tileSize:1}}function qb(g,l,d){if(!g)return null;const y=l.getTextureDescriptor(g,d,!0);if(!y)return null;let{texture:b,mix:T,offset:S,tileSize:A,buffer:k,format:L}=y;if(!b||!L)return null;let B=!1;return L==="uint32"&&(B=!0,T[3]=0,T=y0(a.c6,T,[0,d.paint.get("raster-particle-max-speed")]),S=up(a.c6,S,[0,d.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[k/(A+2*k),A/(A+2*k)],tileSize:A,scalarData:B,scale:T,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function Ig(g){const l=g._nearZ,d=g.projection.farthestPixelDistance(g),y=d-l,b=.2*g.height,T=l+b;return[l,d,(T-b-l)/y,(T-l)/y]}const I0=new a.C(1,0,0,1),Cg=new a.C(0,1,0,1),C0=new a.C(0,0,1,1),Ir=new a.C(1,0,1,1),PA=new a.C(0,1,1,1);function Tn(g,l,d,y,b,T,S){const A=g.context,k=g.transform,L=A.gl,B=k.projection.name==="globe",U=B?["PROJECTION_GLOBE_VIEW"]:[];let q=a.ae.clone(d.projMatrix);if(B&&a.a2(k.zoom)>0){const Me=a.c7(d.canonical,k),nt=a.c8(Me);q=a.ae.multiply(new Float32Array(16),k.globeMatrix,nt),a.ae.multiply(q,k.projMatrix,q)}const Z=a.ae.create();Z[12]+=2*b/(a.e.devicePixelRatio*k.width),Z[13]+=2*T/(a.e.devicePixelRatio*k.height),a.ae.multiply(q,Z,q);const se=g.getOrCreateProgram("debug",{defines:U}),oe=l.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(oe,se);const ae=a.af.disabled,ce=a.ah.disabled,xe=g.colorModeForRenderPass(),be="$debug";A.activeTexture.set(L.TEXTURE0),g.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),B?oe._makeGlobeTileDebugBuffers(g.context,k):oe._makeDebugTileBoundsBuffers(g.context,k.projection);const ve=oe._tileDebugBuffer||g.debugBuffer,ke=oe._tileDebugIndexBuffer||g.debugIndexBuffer,Ce=oe._tileDebugSegments||g.debugSegments;if(se.draw(g,L.LINE_STRIP,ae,ce,xe,a.ag.disabled,wg(q,y),be,ve,ke,Ce,null,null,null,[oe._globeTileDebugBorderBuffer]),S){const Me=oe.latestRawTileData,nt=Math.floor((Me&&Me.byteLength||0)/1024);let et=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(et+=` => ${d.overscaledZ}`),et+=` ${oe.state}`,et+=` ${nt}kb`,function(qe,St){qe.initDebugOverlayCanvas();const yt=qe.debugOverlayCanvas,Xe=qe.context.gl,ot=qe.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,yt.width,yt.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(St,5,5),ot.strokeText(St,5,5),qe.debugOverlayTexture.update(yt),qe.debugOverlayTexture.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE)}(g,et)}const Ae=l.getTile(d).tileSize,Ne=512/Math.min(Ae,512)*(d.overscaledZ/k.zoom)*.5,Fe=oe._tileDebugTextBuffer||g.debugBuffer,Ze=oe._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,je=oe._tileDebugTextSegments||g.debugSegments;se.draw(g,L.TRIANGLES,ae,ce,a.a.alphaBlended,a.ag.disabled,wg(q,a.C.transparent,Ne),be,Fe,Ze,je,null,null,null,[oe._globeTileDebugTextBuffer])}function A0(g,l,d,y){Sd(g,0,l+d/2,g.transform.width,d,y)}function _p(g,l,d,y){Sd(g,l-d/2,0,d,g.transform.height,y)}function Sd(g,l,d,y,b,T){const S=g.context,A=S.gl;A.enable(A.SCISSOR_TEST),A.scissor(l*a.e.devicePixelRatio,d*a.e.devicePixelRatio,y*a.e.devicePixelRatio,b*a.e.devicePixelRatio),S.clear({color:T}),A.disable(A.SCISSOR_TEST)}const Ml=a.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:P0}=Ml;function ca(g,l,d,y){g.emplaceBack(l,d,y)}class nn{constructor(l){this.vertexArray=new a.ca,this.indices=new a.bw,ca(this.vertexArray,-1,-1,1),ca(this.vertexArray,1,-1,1),ca(this.vertexArray,-1,1,1),ca(this.vertexArray,1,1,1),ca(this.vertexArray,-1,-1,-1),ca(this.vertexArray,1,-1,-1),ca(this.vertexArray,-1,1,-1),ca(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,P0),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=a.b.simpleSegment(0,0,36,12)}}function xr(g,l,d,y,b,T){const S=g.context.gl,A=l.paint.get("sky-atmosphere-color"),k=l.paint.get("sky-atmosphere-halo-color"),L=l.paint.get("sky-atmosphere-sun-intensity"),B=((U,q,Z,se,oe)=>({u_matrix_3f:U,u_sun_direction:q,u_sun_intensity:Z,u_color_tint_r:[se.r,se.g,se.b,se.a],u_color_tint_m:[oe.r,oe.g,oe.b,oe.a],u_luminance:5e-5}))(a.bE.fromMat4(a.bE.create(),y),b,L,A,k);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+T,l.skyboxTexture,0),d.draw(g,S.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.frontCW,B,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Ar=a.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ma{constructor(l){const d=new a.cb;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const y=new a.bw;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(d,Ar.members),this.indexBuffer=l.createIndexBuffer(y),this.segments=a.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Id=a.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Tr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ag{constructor(l){this.colorModeAlphaBlendedWriteRGB=new a.a([a.cc,a.cd,a.cc,a.cd],a.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new a.a([a.cc,a.ce,a.cc,a.ce],a.C.transparent,[!1,!1,!1,!0]),this.params=new Tr,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){const d=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ma(d);const y=this.params.sizeRange,b=this.params.intensityRange,T=function(B){const U=a.ch(30),q=[];for(let Z=0;Z<B;++Z){const se=2*Math.PI*U(),oe=Math.acos(1-2*U())-.5*Math.PI;q.push(a.$.fromValues(Math.cos(oe)*Math.cos(se),Math.cos(oe)*Math.sin(se),Math.sin(oe)))}return q}(this.params.starsCount),S=a.ch(300),A=new a.cf,k=new a.bw;let L=0;for(let B=0;B<T.length;++B){const U=a.$.scale([],T[B],200),q=Math.max(0,1+.01*y*(1*S()-.5)),Z=Math.max(0,1+.01*b*(1*S()-.5));A.emplaceBack(U[0],U[1],U[2],-1,-1,q,Z),A.emplaceBack(U[0],U[1],U[2],1,-1,q,Z),A.emplaceBack(U[0],U[1],U[2],1,1,q,Z),A.emplaceBack(U[0],U[1],U[2],-1,1,q,Z),k.emplaceBack(L+0,L+1,L+2),k.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=d.createVertexBuffer(A,Id.members),this.starsIdx=d.createIndexBuffer(k),this.starsSegments=a.b.simpleSegment(0,0,A.length,k.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,d){const y=l.context,b=y.gl,T=l.transform,S=new a.af(b.LEQUAL,a.af.ReadOnly,[0,1]),A=a.a2(T.zoom),k=l.style.getLut(d.scope),L=d.properties.get("color").toRenderColor(k).toArray01(),B=d.properties.get("high-color").toRenderColor(k).toArray01(),U=d.properties.get("space-color").toRenderColor(k).toArray01PremultipliedAlpha(),q=5e-4,Z=a.cg(d.properties.get("horizon-blend"),0,1,q,.25),se=a.bc(l,y,T)&&Z===q?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,oe=l.frameCounter/1e3%1,ae=a.$.length(T.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(ae,2)-Math.pow(se,2)),xe=Math.acos(ce/ae),be=ve=>{const ke=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&ke.push("ALPHA_PASS");const Ce=l.getOrCreateProgram("globeAtmosphere",{defines:ke}),Ae=((Fe,Ze,je,Me,nt,et,qe,St,yt,Xe,ot,$e)=>({u_frustum_tl:Fe,u_frustum_tr:Ze,u_frustum_br:je,u_frustum_bl:Me,u_horizon:nt,u_transition:et,u_fadeout_range:qe,u_color:St,u_high_color:yt,u_space_color:Xe,u_temporal_offset:ot,u_horizon_angle:$e}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,A,Z,L,B,U,oe,xe);l.uploadCommonUniforms(y,Ce);const Ne=this.atmosphereBuffer;Ne&&Ce.draw(l,b.TRIANGLES,S,a.ah.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,a.ag.backCW,Ae,ve?"atmosphere_glow_alpha":"atmosphere_glow",Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)};be(!1),be(!0)}drawStars(l,d){const y=a.au(d.properties.get("star-intensity"),0,1);if(y===0)return;const b=l.context,T=b.gl,S=l.transform,A=l.getOrCreateProgram("stars"),k=a.aw.identity([]);a.aw.rotateX(k,k,-S._pitch),a.aw.rotateZ(k,k,-S.angle),a.aw.rotateX(k,k,a.ac(S._center.lat)),a.aw.rotateY(k,k,-a.ac(S._center.lng));const L=a.ae.fromQuat(new Float32Array(16),k),B=a.ae.multiply([],S.starsProjMatrix,L),U=a.bE.fromMat4([],L),q=a.bE.invert([],U),Z=[0,1,0];a.$.transformMat3(Z,Z,q),a.$.scale(Z,Z,this.params.sizeMultiplier);const se=[1,0,0];a.$.transformMat3(se,se,q),a.$.scale(se,se,this.params.sizeMultiplier);const oe=(ae=Z,ce=se,xe=y,{u_matrix:Float32Array.from(B),u_up:ae,u_right:ce,u_intensity_multiplier:xe});var ae,ce,xe;l.uploadCommonUniforms(b,A),this.starsVx&&this.starsIdx&&A.draw(l,T.TRIANGLES,a.af.disabled,a.ah.disabled,this.colorModeAlphaBlendedWriteRGB,a.ag.disabled,oe,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Cd(g,l){const d=[...g],y=l.cameraWorldSizeForFog/l.worldSize,b=a.ae.identity([]);return a.ae.scale(b,b,[y,y,1]),a.ae.multiply(d,b,d),a.ae.multiply(d,l.worldToFogMatrix,d),d}function hh(g,l,d,y,b){const T=d.material,S=y.context,{baseColorTexture:A,metallicRoughnessTexture:k}=T.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:B,emissionTexture:U}=T;function q(Z,se,oe){if(Z&&(g.push(se),S.activeTexture.set(S.gl.TEXTURE0+oe),Z.gfxTexture)){const{minFilter:ae,magFilter:ce,wrapS:xe,wrapT:be}=Z.sampler;Z.gfxTexture.bindExtraParam(ae,ce,xe,be)}}q(A,"HAS_TEXTURE_u_baseColorTexture",Ds.BaseColor),q(k,"HAS_TEXTURE_u_metallicRoughnessTexture",Ds.MetallicRoughness),q(L,"HAS_TEXTURE_u_normalTexture",Ds.Normal),q(B,"HAS_TEXTURE_u_occlusionTexture",Ds.Occlusion),q(U,"HAS_TEXTURE_u_emissionTexture",Ds.Emission),b&&(b.texture||(b.texture=new a.cj(y.context,b.image,[b.image.height,b.image.height,b.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Ds.LUT),b.texture&&b.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),d.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(d.texcoordBuffer)),d.colorBuffer&&(g.push(d.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(d.colorBuffer)),d.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(d.normalBuffer)),d.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(d.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function ao(g,l,d,y,b,T){const S=d.paint.get("model-opacity"),A=l.context,k=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,l.depthRangeFor3D),L=l.transform,B=g.mesh,U=B.material,q=U.pbrMetallicRoughness,Z=l.style.fog;let se;se=l.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:a.ae.multiply([],y.zScaleMatrix,g.nodeModelMatrix),a.ae.multiply(se,y.negCameraPosMatrix,se);const oe=a.ae.invert([],se);a.ae.transpose(oe,oe);const ae=d.paint.get("model-emissive-strength").constantOr(0),ce=ah(new Float32Array(g.worldViewProjection),new Float32Array(se),new Float32Array(oe),null,l,S,q.baseColorFactor.toRenderColor(null),U.emissiveFactor,q.metallicFactor,q.roughnessFactor,U,ae,d),xe={defines:[]},be=[];hh(xe.defines,be,B,l,d.lut);const ve=l.shadowRenderer;ve&&(ve.useNormalOffset=!1);let ke=null;if(Z){const Ne=Cd(g.nodeModelMatrix,l.transform);if(ke=new Float32Array(Ne),L.projection.name!=="globe"){const Fe=B.aabb.min,Ze=B.aabb.max,[je,Me]=Z.getOpacityForBounds(Ne,Fe[0],Fe[1],Ze[0],Ze[1]);xe.overrideFog=je>=vr||Me>=vr}}const Ce=$s(l,d.paint.get("model-cutoff-fade-range"));Ce.shouldRenderCutoff&&xe.defines.push("RENDER_CUTOFF");const Ae=l.getOrCreateProgram("model",xe);l.uploadCommonUniforms(A,Ae,null,ke,Ce),l.renderPass!=="shadow"&&ve&&ve.setupShadowsFromMatrix(g.nodeModelMatrix,Ae),Ae.draw(l,A.gl.TRIANGLES,k,b,T,B.material.doubleSided?a.ag.disabled:a.ag.backCCW,ce,d.id,B.vertexBuffer,B.indexBuffer,B.segments,d.paint,l.transform.zoom,void 0,be)}function Bi(g,l,d,y,b,T,S){let A;A=g.projection.name==="globe"?a.ck(d,g):[...d],a.ae.multiply(A,A,l.matrix);const k=a.ae.multiply([],y,A);if(l.meshes)for(const L of l.meshes){if(L.material.alphaMode!=="BLEND"){S.push({mesh:L,depth:0,modelIndex:b,worldViewProjection:k,nodeModelMatrix:A});continue}const B=a.$.transformMat4([],L.centroid,k);B[2]>0&&T.push({mesh:L,depth:B[2],modelIndex:b,worldViewProjection:k,nodeModelMatrix:A})}if(l.children)for(const L of l.children)Bi(g,L,d,y,b,T,S)}function R0(g,l,d,y){const b=d.shadowRenderer;if(!b)return;const T=b.getShadowPassDepthMode(),S=b.getShadowPassColorMode(),A=b.calculateShadowPassMatrixFromMatrix(l),k=w0(A);d.getOrCreateProgram("modelDepth",{defines:d._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(d,d.context.gl.TRIANGLES,T,a.ah.disabled,S,a.ag.backCCW,k,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,d.transform.zoom,void 0,void 0)}function yp(g,l,d){const y=l.updateZoomBasedPaintProperties(),b=function(T,S,A){let k,L,B,U=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&U>0){const q=T.terrain,Z=q.findDEMTileFor(A);Z&&Z.dem?k=a.cm.create(q,A,Z):U=0}if(U===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),U===S.validForExaggeration&&(U===0||k&&k._demTile&&k._demTile.tileID===S.validForDEMTile.id&&k._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const q in S.instancesPerModel){const Z=S.instancesPerModel[q];for(let se=0;se<Z.instancedDataArray.length;++se){const oe=(k?U*k.getElevationAt(0|Z.instancedDataArray.float32[16*se],0|Z.instancedDataArray.float32[16*se+1],!0,!0):0)+Z.instancesEvaluatedElevation[se];Z.instancedDataArray.float32[16*se+6]=oe,L=L?Math.min(S.terrainElevationMin,oe):oe,B=B?Math.max(S.terrainElevationMax,oe):oe}}return S.terrainElevationMin=L||0,S.terrainElevationMax=B||0,S.validForExaggeration=U,S.validForDEMTile=k&&k._demTile?{id:k._demTile.tileID,timestamp:k._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,l,d);(y||b)&&(l.uploaded=!1,l.upload(g.context))}const ka={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.b8([0,0,0],[a.a4,a.a4,0])};function vp(g,l){const d=1<<g.canonical.z,y=l.getFreeCameraOptions().position,b=l.elevation,T=g.canonical.x/d,S=(g.canonical.x+1)/d,A=g.canonical.y/d,k=(g.canonical.y+1)/d;let L=l._centerAltitude;if(b){const Z=b.getMinMaxForTile(g);Z&&Z.max>L&&(L=Z.max)}const B=a.au(y.x,T,S)-y.x,U=a.au(y.y,A,k)-y.y,q=a.ay(L,l.center.lat)-y.z;return l._zoomFromMercatorZ(Math.sqrt(B*B+U*U+q*q))}function Pg(g,l,d,y,b,T,S){const A=g.context,k=g.renderPass==="shadow",L=g.shadowRenderer,B=k&&L?L.getShadowPassDepthMode():new a.af(A.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),U=g.isTileAffectedByFog(T);if(d.meshes)for(const q of d.meshes){const Z=["MODEL_POSITION_ON_GPU"],se=[];let oe,ae,ce;y.instancedDataArray.length>20&&Z.push("INSTANCED_ARRAYS");const xe=$s(g,l.paint.get("model-cutoff-fade-range"));if(xe.shouldRenderCutoff&&Z.push("RENDER_CUTOFF"),k&&L)oe=g.getOrCreateProgram("modelDepth",{defines:Z}),ae=w0(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(d.matrix)),ce=L.getShadowPassColorMode();else{hh(Z,se,q,g,l.lut),oe=g.getOrCreateProgram("model",{defines:Z,overrideFog:U});const ve=q.material,ke=ve.pbrMetallicRoughness,Ce=l.paint.get("model-opacity"),Ae=l.paint.get("model-emissive-strength").constantOr(0);ae=ah(T.expandedProjMatrix,Float32Array.from(d.matrix),new Float32Array(16),null,g,Ce,ke.baseColorFactor.toRenderColor(null),ve.emissiveFactor,ke.metallicFactor,ke.roughnessFactor,ve,Ae,l,b),L&&(S.shadowUniformsInitialized?oe.setShadowUniformValues(A,L.getShadowUniformValues()):(L.setupShadows(T.toUnwrapped(),oe,"model-tile",T.overscaledZ),S.shadowUniformsInitialized=!0)),ce=xe.shouldRenderCutoff||Ce<1||ve.alphaMode!=="OPAQUE"?a.a.alphaBlended:a.a.unblended}g.uploadCommonUniforms(A,oe,T.toUnwrapped(),null,xe);const be=q.material.doubleSided?a.ag.disabled:a.ag.backCCW;if(y.instancedDataArray.length>20)se.push(y.instancedDataBuffer),oe.draw(g,A.gl.TRIANGLES,B,a.ah.disabled,ce,be,ae,l.id,q.vertexBuffer,q.indexBuffer,q.segments,l.paint,g.transform.zoom,void 0,se,y.instancedDataArray.length);else{const ve=k?"u_instance":"u_normal_matrix";for(let ke=0;ke<y.instancedDataArray.length;++ke)ae[ve]=new Float32Array(y.instancedDataArray.arrayBuffer,64*ke,16),oe.draw(g,A.gl.TRIANGLES,B,a.ah.disabled,ce,be,ae,l.id,q.vertexBuffer,q.indexBuffer,q.segments,l.paint,g.transform.zoom,void 0,se)}}if(d.children)for(const q of d.children)Pg(g,l,q,y,b,T,S)}const Rg=[1,-1,1];function bo(g,l,d,y){if(!d.modelManager)return!0;const b=d.modelManager;if(!d.shadowRenderer)return!0;const T=d.shadowRenderer,S=l.aabb;let A=!0,k=g.maxHeight;if(k===0){let B=0;for(const U in g.instancesPerModel){const q=b.getModel(U,y);q?B=Math.max(B,Math.max(Math.max(q.aabb.max[0],q.aabb.max[1]),q.aabb.max[2])):A=!1}k=g.maxScale*B*1.41+g.maxVerticalOffset,A&&(g.maxHeight=k)}S.max[2]=k,S.min[2]+=g.terrainElevationMin,S.max[2]+=g.terrainElevationMax,a.$.transformMat4(S.min,S.min,l.tileMatrix),a.$.transformMat4(S.max,S.max,l.tileMatrix);const L=S.intersects(T.getCurrentCascadeFrustum());return d.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=L===2),L===0}function ua(g,l){const d=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],b=g.uniformValues.u_cutoff_params[2],T=g.uniformValues.u_cutoff_params[3];return y===d||T===b?1:a.au(((l-d)/(y-d)-b)/(T-b),0,1)}function Gb(g,l,d,y){if(l.pitch<20)return 1;const b=l.getWorldToCameraMatrix(),T=a.ae.multiply([],b,g),S=[...d.min,1];let A=a.aB.transformMat4([],S,T),k=A,L=A;S[1]=d.max[1],A=a.aB.transformMat4([],S,T),k=A[1]<k[1]?A:k,L=A[1]>L[1]?A:L,S[0]=d.max[0],A=a.aB.transformMat4([],S,T),k=A[1]<k[1]?A:k,L=A[1]>L[1]?A:L,S[1]=d.min[1],A=a.aB.transformMat4([],S,T),k=A[1]<k[1]?A:k,L=A[1]>L[1]?A:L;const B=a.au(y[0],0,1),U=100*l.pixelsPerMeter*a.au(y[1],0,1),q=a.au(y[2],0,1),Z=a.$.lerp([],k,L,B),se=Math.tan(.5*l.fovX),oe=-Z[2]*se;if(U===0)return Z[1]<-Math.abs(oe)?q:1;const ae=(-Math.abs(oe)-Z[1])/U,ce=(be,ve,ke)=>(1-ke)*be+ke*ve,xe=a.au(ce(1,q,ae),q,1);return ce(1,xe,a.au((l.pitch-20)/20,0,1))}class Ad{}class ps{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,d,y){{const U=this._storage.get(d.id);if(U)return U.lastUsedFrameIdx=l,U.buf}const b=y.gl,T=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),S=new ArrayBuffer(T),A=new Int16Array(S);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const k=new a.co;for(let U=0;U<T/2;U+=3){const q=A[U],Z=A[U+1],se=A[U+2];k.emplaceBack(q,Z),k.emplaceBack(Z,se),k.emplaceBack(se,q)}const L=y.bindVertexArrayOES.current,B=new Ad;return B.buf=new a.I(y,k),B.lastUsedFrameIdx=l,this._storage.set(d.id,B),y.bindVertexArrayOES.set(L),B.buf}update(l){for(const[d,y]of this._storage)l-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(d))}destroy(){for(const[l,d]of this._storage)d.buf.destroy(),this._storage.delete(l)}}class tl{constructor(l){this.occluderSize=30,this.depthOffset=-1e-4,l.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const nl={symbol:function(g,l,d,y,b){if(g.renderPass!=="translucent")return;const T=a.ah.disabled,S=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(L,B,U,q,Z,se,oe){const ae=B.transform,ce=Z==="map",xe=se==="map";for(const be of L){const ve=q.getTile(be),ke=ve.getBucket(U);if(!ke||!ke.text||!ke.text.segments.get().length)continue;const Ce=a.aE(ke.textSizeData,ae.zoom),Ae=T0(be,ke.getProjection(),ae),Ne=ae.calculatePixelsToTileUnitsMatrix(ve),Fe=ru(Ae,ve.tileID.canonical,xe,ce,ae,ke.getProjection(),Ne),Ze=ke.hasIconTextFit()&&ke.hasIconData();if(Ce){const je=Math.pow(2,ae.zoom-ve.tileID.overscaledZ);IA(ke,ce,xe,oe,a.bQ,ae,Fe,be,je,Ce,Ze)}}}(y,g,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),b);const A=d.paint.get("icon-opacity").constantOr(1)!==0,k=d.paint.get("text-opacity").constantOr(1)!==0;d.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(A||k)?pp(g,l,d,y,T,S):(A&&pp(g,l,d,y,T,S,{onlyIcons:!0}),k&&pp(g,l,d,y,T,S,{onlyText:!0})),l.map.showCollisionBoxes&&(jb(g,l,d,y,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),jb(g,l,d,y,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("circle-opacity"),T=d.paint.get("circle-stroke-width"),S=d.paint.get("circle-stroke-opacity"),A=d.layout.get("circle-sort-key").constantOr(1)!==void 0,k=d.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(T.constantOr(1)===0||S.constantOr(1)===0))return;const L=g.context,B=L.gl,U=g.transform,q=g.depthModeForSublayer(0,a.af.ReadOnly),Z=a.ah.disabled,se=g.colorModeForDrapableLayerRenderPass(k),oe=U.projection.name==="globe",ae=[a.ak(U.center.lng),a.al(U.center.lat)],ce=[];for(let be=0;be<y.length;be++){const ve=y[be],ke=l.getTile(ve),Ce=ke.getBucket(d);if(!Ce||Ce.projection.name!==U.projection.name)continue;const Ae=Ce.programConfigurations.get(d.id),Ne=a.bT(d),Fe=g.isTileAffectedByFog(ve);oe&&Ne.push("PROJECTION_GLOBE_VIEW"),Ne.push("DEPTH_D24"),g.terrain&&U.depthOcclusionForSymbolsAndCircles&&Ne.push("DEPTH_OCCLUSION");const Ze=g.getOrCreateProgram("circle",{config:Ae,defines:Ne,overrideFog:Fe}),je=Ce.layoutVertexBuffer,Me=Ce.globeExtVertexBuffer,nt=Ce.indexBuffer,et=U.projection.createInversionMatrix(U,ve.canonical),qe={programConfiguration:Ae,program:Ze,layoutVertexBuffer:je,globeExtVertexBuffer:Me,indexBuffer:nt,uniformValues:a.bU(g,ve,ke,et,ae,d),tile:ke};if(A){const St=Ce.segments.get();for(const yt of St)ce.push({segments:new a.b([yt]),sortKey:yt.sortKey,state:qe})}else ce.push({segments:Ce.segments,sortKey:0,state:qe})}A&&ce.sort((be,ve)=>be.sortKey-ve.sortKey);const xe={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const be of ce){const{programConfiguration:ve,program:ke,layoutVertexBuffer:Ce,globeExtVertexBuffer:Ae,indexBuffer:Ne,uniformValues:Fe,tile:Ze}=be.state,je=be.segments;g.terrain&&g.terrain.setupElevationDraw(Ze,ke,xe),g.uploadCommonUniforms(L,ke,Ze.tileID.toUnwrapped()),ke.draw(g,B.TRIANGLES,q,Z,se,a.ag.disabled,Fe,d.id,Ce,Ne,je,d.paint,U.zoom,ve,[Ae])}},heatmap:function(g,l,d,y){if(d.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const b=g.context,T=b.gl,S=a.ah.disabled,A=new a.a([T.ONE,T.ONE,T.ONE,T.ONE],a.C.transparent,[!0,!0,!0,!0]);(function(Z,se,oe,ae){const ce=Z.gl,xe=se.width*ae,be=se.height*ae;Z.activeTexture.set(ce.TEXTURE1),Z.viewport.set([0,0,xe,be]);let ve=oe.heatmapFbo;if(!ve||ve&&(ve.width!==xe||ve.height!==be)){ve&&ve.destroy();const ke=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,ke),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),ve=oe.heatmapFbo=Z.createFramebuffer(xe,be,!0,null),function(Ce,Ae,Ne,Fe,Ze,je){const Me=Ce.gl;Me.texImage2D(Me.TEXTURE_2D,0,Ce.extRenderToTextureHalfFloat?Me.RGBA16F:Me.RGBA,Ze,je,0,Me.RGBA,Ce.extRenderToTextureHalfFloat?Me.HALF_FLOAT:Me.UNSIGNED_BYTE,null),Fe.colorAttachment.set(Ne)}(Z,0,ke,ve,xe,be)}else ce.bindTexture(ce.TEXTURE_2D,ve.colorAttachment.get()),Z.bindFramebuffer.set(ve.framebuffer)})(b,g,d,g.transform.projection.name==="globe"?.5:.25),b.clear({color:a.C.transparent});const k=g.transform,L=k.projection.name==="globe",B=L?["PROJECTION_GLOBE_VIEW"]:[],U=L?a.ag.frontCCW:a.ag.disabled,q=[a.ak(k.center.lng),a.al(k.center.lat)];for(let Z=0;Z<y.length;Z++){const se=y[Z];if(l.hasRenderableParent(se))continue;const oe=l.getTile(se),ae=oe.getBucket(d);if(!ae||ae.projection.name!==k.projection.name)continue;const ce=g.isTileAffectedByFog(se),xe=ae.programConfigurations.get(d.id),be=g.getOrCreateProgram("heatmap",{config:xe,defines:B,overrideFog:ce}),{zoom:ve}=g.transform;g.terrain&&g.terrain.setupElevationDraw(oe,be),g.uploadCommonUniforms(b,be,se.toUnwrapped());const ke=k.projection.createInversionMatrix(k,se.canonical);be.draw(g,T.TRIANGLES,a.af.disabled,S,A,U,zb(g,se,oe,ke,q,ve,d.paint.get("heatmap-intensity")),d.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,d.paint,g.transform.zoom,xe,L?[ae.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,T){const S=b.context,A=S.gl,k=T.heatmapFbo;if(!k)return;S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,k.colorAttachment.get()),S.activeTexture.set(A.TEXTURE1);let L=T.colorRampTexture;L||(L=T.colorRampTexture=new a.T(S,T.colorRamp,A.RGBA)),L.bind(A.LINEAR,A.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,A.TRIANGLES,a.af.disabled,a.ah.disabled,b.colorModeForRenderPass(),a.ag.disabled,((B,U,q,Z)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,T),T.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,T.paint,b.transform.zoom)}(g,d))},line:function(g,l,d,y){if(g.renderPass!=="translucent")return;const b=d.paint.get("line-opacity"),T=d.paint.get("line-width");if(b.constantOr(1)===0||T.constantOr(1)===0)return;const S=d.paint.get("line-emissive-strength"),A=d.paint.get("line-occlusion-opacity"),k=g.context,L=k.gl,B=d.layout.get("line-z-offset"),U=!B.isConstant()||!!B.constantOr(0),q=U?new a.af(g.depthOcclusion?L.GREATER:L.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly),Z=g.colorModeForDrapableLayerRenderPass(S),se=g.terrain&&g.terrain.renderingToTexture,oe=se?1:a.e.devicePixelRatio,ae=d.paint.get("line-dasharray"),ce=ae.constantOr(1),xe=d.layout.get("line-cap"),be=ae.constantOr(null),ve=xe.constantOr(null),ke=d.paint.get("line-pattern"),Ce=ke.constantOr(1),Ae=ke.constantOr(null),Ne=d.paint.get("line-opacity").constantOr(1);let Fe=!Ce&&Ne!==1||g.depthOcclusion&&A>0&&A<1;const Ze=d.paint.get("line-gradient"),je=Ce?"linePattern":"line",Me=a.bV(d);let nt;if(se&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Fe=!1),A!==0&&g.depthOcclusion){const qe=d.paint._values["line-opacity"];qe&&qe.value&&qe.value.kind==="constant"?nt=qe.value:a.w(`Occlusion opacity for layer ${d.id} is supported only when line-opacity isn't data-driven.`)}if(U&&(g.forceTerrainMode=!0),!U&&A!==0&&g.terrain&&!se)return void a.w(`Occlusion opacity for layer ${d.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const et=Fe&&U?g.stencilModeFor3D():a.ah.disabled;for(const qe of y){const St=l.getTile(qe);if(Ce&&!St.patternsLoaded())continue;const yt=St.getBucket(d);if(!yt)continue;g.prepareDrawTile();const Xe=yt.programConfigurations.get(d.id),ot=g.isTileAffectedByFog(qe),$e=g.getOrCreateProgram(je,{config:Xe,defines:U?[...Me,"ELEVATED"]:Me,overrideFog:ot});if(Ae&&St.imageAtlas){const Yt=St.imageAtlas.patternPositions[Ae.toString()];Yt&&Xe.setConstantPatternPositions(Yt)}if(!Ce&&be&&ve&&St.lineAtlas){const Yt=St.lineAtlas.getDash(be,ve);Yt&&Xe.setConstantPatternPositions(Yt)}let[vt,bt]=d.paint.get("line-trim-offset");(ve==="round"||ve==="square")&&vt!==bt&&(vt===0&&(vt-=1),bt===1&&(bt+=1));const Vt=se?qe.projMatrix:null,Ht=Ce?a.bW(g,St,d,Vt,oe,[vt,bt]):a.bX(g,St,d,Vt,yt.lineClipsArray.length,oe,[vt,bt]);if(Ze){const Yt=yt.gradients[d.id];let wn=Yt.texture;if(d.gradientVersion!==Yt.version){let Gn=256;if(d.stepInterpolant){const In=l.getSource().maxzoom,Xn=qe.canonical.z===In?Math.ceil(1<<g.transform.maxZoom-qe.canonical.z):1;Gn=a.au(a.bY(yt.maxLineLength/a.a4*1024*Xn),256,k.maxTextureSize)}Yt.gradient=a.bZ({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Gn,image:Yt.gradient||void 0,clips:yt.lineClipsArray}),Yt.texture?Yt.texture.update(Yt.gradient):Yt.texture=new a.T(k,Yt.gradient,L.RGBA),Yt.version=d.gradientVersion,wn=Yt.texture}k.activeTexture.set(L.TEXTURE1),wn.bind(d.stepInterpolant?L.NEAREST:L.LINEAR,L.CLAMP_TO_EDGE)}ce&&(k.activeTexture.set(L.TEXTURE0),St.lineAtlasTexture&&St.lineAtlasTexture.bind(L.LINEAR,L.REPEAT),Xe.updatePaintBuffers()),Ce&&(k.activeTexture.set(L.TEXTURE0),St.imageAtlasTexture&&St.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Xe.updatePaintBuffers()),U&&g.terrain.setupElevationDraw(St,$e),g.uploadCommonUniforms(k,$e,qe.toUnwrapped());const ln=Yt=>{nt!=null&&(nt.value=Ne*A),$e.draw(g,L.TRIANGLES,q,Yt,Z,a.ag.disabled,Ht,d.id,yt.layoutVertexBuffer,yt.indexBuffer,yt.segments,d.paint,g.transform.zoom,Xe,[yt.layoutVertexBuffer2,yt.patternVertexBuffer,yt.zOffsetVertexBuffer]),nt!=null&&(nt.value=Ne)};if(Fe&&!U){const Yt=g.stencilModeForClipping(qe).ref;Yt===0&&se&&k.clear({stencil:0});const wn={func:L.EQUAL,mask:255};Ht.u_alpha_discard_threshold=.8,ln(new a.ah(wn,Yt,255,L.KEEP,L.KEEP,L.INVERT)),Ht.u_alpha_discard_threshold=0,ln(new a.ah(wn,Yt,255,L.KEEP,L.KEEP,L.KEEP))}else Fe&&U&&(Ht.u_alpha_discard_threshold=.001),ln(U?et:g.stencilModeForClipping(qe))}Fe&&(g.resetStencilClippingMasks(),se&&k.clear({stencil:0})),A===0||g.depthOcclusion||se||g.layersWithOcclusionOpacity.push(g.currentLayer),U&&(g.forceTerrainMode=!1)},fill:function(g,l,d,y){const b=d.paint.get("fill-color"),T=d.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const S=d.paint.get("fill-emissive-strength"),A=g.colorModeForDrapableLayerRenderPass(S),k=d.paint.get("fill-pattern"),L=g.opaquePassEnabledForLayer()&&!k.constantOr(1)&&b.constantOr(a.C.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===L){const B=g.depthModeForSublayer(1,g.renderPass==="opaque"?a.af.ReadWrite:a.af.ReadOnly);mp(g,l,d,y,B,A,!1)}if(g.renderPass==="translucent"&&d.paint.get("fill-antialias")){const B=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,a.af.ReadOnly);mp(g,l,d,y,B,A,!0)}},"fill-extrusion":function(g,l,d,y){const b=d.paint.get("fill-extrusion-opacity"),T=g.context,S=T.gl,A=g.terrain,k=A&&A.renderingToTexture;if(b===0)return;const L=g.conflationActive&&g.style.isLayerClipped(d,l.getSource()),B=g.style.order.indexOf(d.fqid);if(L&&function(U,q,Z,se,oe){for(const ae of se){const ce=q.getTile(ae).getBucket(Z);ce&&(ce.updateReplacement(ae,U.replacementSource,oe),ce.uploadCentroid(U.context))}}(g,l,d,y,B),A||L)for(const U of y){const q=l.getTile(U).getBucket(d);q&&CA(g.context,l,U,q,d,A,L)}if(g.renderPass==="shadow"&&g.shadowRenderer){const U=g.shadowRenderer;if(A&&b<.65&&d._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.Z)return;const q=U.getShadowPassDepthMode(),Z=U.getShadowPassColorMode();ch(g,l,d,y,q,a.ah.disabled,Z,L)}else if(g.renderPass==="translucent"){const U=!d.paint.get("fill-extrusion-pattern").constantOr(1),q=d.paint.get("fill-extrusion-color").constantOr(a.C.white);if(!k&&q.a!==0){const Z=new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D);b===1&&U?ch(g,l,d,y,Z,a.ah.disabled,a.a.unblended,L):(ch(g,l,d,y,Z,a.ah.disabled,a.a.disabled,L),ch(g,l,d,y,Z,g.stencilModeFor3D(),g.colorModeForRenderPass(),L),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&U&&(!A&&g.transform.projection.name!=="globe"||k)){const Z=d.paint.get("fill-extrusion-opacity"),se=d.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=d.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ae=d.paint.get("fill-extrusion-flood-light-intensity"),ce=d.paint.get("fill-extrusion-flood-light-color").toRenderColor(d.lut).toArray01().slice(0,3),xe=se>0&&oe>0,be=ae>0,ve=(Ce,Ae,Ne)=>(1-Ne)*Ce+Ne*Ae,ke=Ce=>{const Ae=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!0),Ne=d.paint.get(Ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Fe=ve(.1,3,Ne),Ze=g._showOverdrawInspector;if(!Ze){const je=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Me=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);Ed(g,l,d,y,Ae,je,Me,a.ag.disabled,Ce,"sdf",Z,se,oe,ae,ce,Fe,L,!1)}{const je=Ze?a.ah.disabled:new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Me=Ze?g.colorModeForRenderPass():new a.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],a.C.transparent,[!0,!0,!0,!0]);Ed(g,l,d,y,Ae,je,Me,a.ag.disabled,Ce,"color",Z,se,oe,ae,ce,Fe,L,!1)}};if(k){const Ce=(Ae,Ne,Fe)=>{const Ze=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!1),je=d.paint.get(Ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=ve(.1,3,je);{const nt=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0]);Ed(g,l,d,y,Ze,a.ah.disabled,nt,a.ag.disabled,Ae,"clear",Z,se,oe,ae,ce,Me,L,Ne)}{const nt=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),et=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);Ed(g,l,d,y,Ze,nt,et,a.ag.disabled,Ae,"sdf",Z,se,oe,ae,ce,Me,L,Ne)}{const nt=Ae?S.ZERO:S.ONE_MINUS_DST_ALPHA,et=new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),qe=new a.a([nt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],a.C.transparent,[!0,!0,!0,!0]);Ed(g,l,d,y,Ze,et,qe,a.ag.disabled,Ae,"color",Z,se,oe,ae,ce,Me,L,Ne)}{const nt=new a.a([S.ONE,S.ONE,S.ONE,Ae?S.ZERO:S.ONE],a.C.transparent,[!1,!1,!1,!0],Ae?S.FUNC_ADD:S.MAX);Ed(g,l,d,y,Ze,a.ah.disabled,nt,a.ag.disabled,Ae,"clear",Z,se,oe,ae,ce,Me,L,Ne,Fe)}};if(xe||be){let Ae;if(g.prepareDrawTile(),A){const Ne=A.drapeBufferSize[0],Fe=A.drapeBufferSize[1];Ae=A.framebufferCopyTexture,Ae&&(!Ae||Ae.size[0]===Ne&&Ae.size[1]===Fe)||(Ae&&Ae.destroy(),Ae=A.framebufferCopyTexture=new a.T(T,new a.j({width:Ne,height:Fe}),S.RGBA)),Ae.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,Ne,Fe,0)}xe&&Ce(!0,!1,Ae),be&&Ce(!1,!0,Ae)}}else xe&&ke(!0),be&&ke(!1),(xe||be)&&g.resetStencilClippingMasks()}}},hillshade:function(g,l,d,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const b=g.context,T=g.terrain&&g.terrain.renderingToTexture,[S,A]=g.renderPass!=="translucent"||T?[{},y]:g.stencilConfigForOverlap(y);for(const k of A){const L=l.getTile(k);if(L.needsHillshadePrepare&&g.renderPass==="offscreen")_0(g,L,d);else if(g.renderPass==="translucent"){const B=g.depthModeForSublayer(0,a.af.ReadOnly),U=d.paint.get("hillshade-emissive-strength"),q=g.colorModeForDrapableLayerRenderPass(U),Z=T&&g.terrain?g.terrain.stencilModeForRTTOverlap(k):S[k.overscaledZ];Jc(g,k,L,d,B,Z,q)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,d,y,b,T){if(g.renderPass!=="translucent"||d.paint.get("raster-opacity")===0)return;const S=g.transform.projection.name==="globe",A=d.paint.get("raster-elevation")!==0,k=A&&S;if(g.renderElevatedRasterBackface&&!k)return;const L=g.context,B=L.gl,U=l.getSource(),q=function(Ce,Ae,Ne,Fe){const Ze=Ae.paint.get("raster-color"),je=Ce.type==="raster-array",Me=[],nt=Ae.paint.get("raster-resampling"),et=Ae.paint.get("raster-color-mix");let qe=Ae.paint.get("raster-color-range");const St=[et[0],et[1],et[2],0],yt=et[3];let Xe=nt==="nearest"?Fe.NEAREST:Fe.LINEAR;if(je&&(Me.push("RASTER_ARRAY"),Ze||Me.push("RASTER_COLOR"),nt==="linear"&&Me.push("RASTER_ARRAY_LINEAR"),Xe=Fe.NEAREST,!qe&&Ce.rasterLayers)){const ot=Ce.rasterLayers.find(({id:$e})=>$e===Ae.sourceLayer);ot&&ot.fields&&ot.fields.range&&(qe=ot.fields.range)}if(qe=qe||[0,1],Ze){Me.push("RASTER_COLOR"),Ne.activeTexture.set(Fe.TEXTURE2),Ae.updateColorRamp(qe);let ot=Ae.colorRampTexture;ot||(ot=Ae.colorRampTexture=new a.T(Ne,Ae.colorRamp,Fe.RGBA)),ot.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}return{mix:St,range:qe,offset:yt,defines:Me,resampling:Xe}}(U,d,L,B);if(U instanceof a.bo&&!y.length&&!S)return;const Z=d.paint.get("raster-emissive-strength"),se=g.colorModeForDrapableLayerRenderPass(Z),oe=g.terrain&&g.terrain.renderingToTexture,ae=!g.options.moving,ce=d.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(U instanceof a.bo&&!y.length&&(U.onNorthPole||U.onSouthPole)){const Ce=A?g.stencilModeFor3D():a.ah.disabled;return void Sg(!!U.onNorthPole,null,g,l,d,Z,q,a.ag.disabled,Ce)}if(!y.length)return;const[xe,be]=U instanceof a.bo||oe?[{},y]:g.stencilConfigForOverlap(y),ve=be[be.length-1].overscaledZ;k&&q.defines.push("PROJECTION_GLOBE_VIEW"),A&&q.defines.push("RENDER_CUTOFF");const ke=(Ce,Ae,Ne)=>{for(const Fe of Ce){const Ze=Fe.toUnwrapped(),je=l.getTile(Fe);if(oe&&(!je||!je.hasData()))continue;L.activeTexture.set(B.TEXTURE0);const Me=uh(je,U,d,q);if(!Me||!Me.texture)continue;const{texture:nt,mix:et,offset:qe,tileSize:St,buffer:yt}=Me;let Xe,ot;oe?(Xe=a.af.disabled,ot=Fe.projMatrix):A?(Xe=new a.af(B.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),ot=S?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Ze,ae)):(Xe=g.depthModeForSublayer(Fe.overscaledZ-ve,d.paint.get("raster-opacity")===1?a.af.ReadWrite:a.af.ReadOnly,B.LESS),ot=g.transform.calculateProjMatrix(Ze,ae));const $e=g.terrain&&oe?g.terrain.stencilModeForRTTOverlap(Fe):xe[Fe.overscaledZ],vt=T?0:d.paint.get("raster-fade-duration");je.registerFadeDuration(vt);const bt=l.findLoadedParent(Fe,0),Vt=el(je,bt,l,g.transform,vt);let Ht,ln;g.terrain&&g.terrain.prepareDrawTile(),L.activeTexture.set(B.TEXTURE0),nt.bind(ce,B.CLAMP_TO_EDGE),L.activeTexture.set(B.TEXTURE1),bt?(bt.texture&&bt.texture.bind(ce,B.CLAMP_TO_EDGE),Ht=Math.pow(2,bt.tileID.overscaledZ-je.tileID.overscaledZ),ln=[je.tileID.canonical.x*Ht%1,je.tileID.canonical.y*Ht%1]):nt.bind(ce,B.CLAMP_TO_EDGE),nt.useMipmap&&L.extTextureFilterAnisotropic&&g.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Yt=g.transform;let wn;const Gn=A?S0(Yt):[0,0,0,0];let In,Xn,pr,ei,jr,_r=0;if(k&&U instanceof a.bo&&U.coordinates.length>3)In=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0)))),Xn=Float32Array.from(Yt.globeMatrix),pr=Float32Array.from(a.bd(Yt)),ei=[a.ak(Yt.center.lng),a.al(Yt.center.lat)],wn=U.elevatedGlobePerspectiveTransform,jr=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(k){const Wn=a.be(Fe.canonical);_r=a.bf(Wn.getCenter().lat),In=Float32Array.from(a.bh(a.bi(Fe.canonical))),Xn=Float32Array.from(Yt.globeMatrix),pr=Float32Array.from(a.bd(Yt)),ei=[a.ak(Yt.center.lng),a.al(Yt.center.lat)],wn=[0,0],jr=Float32Array.from(a.bg(Fe.canonical,Wn,_r,Yt.worldSize/Yt._pixelsPerMercatorPixel))}else wn=U instanceof a.bo?U.perspectiveTransform:[0,0],In=new Float32Array(16),Xn=new Float32Array(9),pr=new Float32Array(16),ei=[0,0],jr=new Float32Array(9);const Br=Tg(ot,In,Xn,pr,jr,ln||[0,0],a.a2(g.transform.zoom),ei,Gn,Ht||1,Vt,d,wn,A?d.paint.get("raster-elevation"):0,2,et,qe,q.range,St,yt,Z),Jn=g.isTileAffectedByFog(Fe),rr=g.getOrCreateProgram("raster",{defines:q.defines,overrideFog:Jn});if(g.uploadCommonUniforms(L,rr,Ze),U instanceof a.bo){const Wn=U.elevatedGlobeVertexBuffer,wr=U.elevatedGlobeIndexBuffer;if(oe||!S)U.boundsBuffer&&U.boundsSegments&&rr.draw(g,B.TRIANGLES,Xe,a.ah.disabled,se,a.ag.disabled,Br,d.id,U.boundsBuffer,g.quadTriangleIndexBuffer,U.boundsSegments);else if(Wn&&wr){const or=Yt.zoom<=a.b3?U.elevatedGlobeSegments:U.getSegmentsForLongitude(Yt.center.lng);or&&rr.draw(g,B.TRIANGLES,Xe,a.ah.disabled,se,Ae,Br,d.id,Wn,wr,or)}}else if(k){Xe=new a.af(B.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D);const Wn=g.globeSharedBuffers;if(Wn){const[wr,or,Mn]=Wn.getGridBuffers(_r,!1);rr.draw(g,B.TRIANGLES,Xe,Ne||$e,g.colorModeForRenderPass(),Ae,Br,d.id,wr,or,Mn)}}else{const{tileBoundsBuffer:Wn,tileBoundsIndexBuffer:wr,tileBoundsSegments:or}=g.getTileBoundsBuffers(je);rr.draw(g,B.TRIANGLES,Xe,$e,se,a.ag.disabled,Br,d.id,Wn,wr,or)}}if(!(U instanceof a.bo)&&k)for(const Fe of Ce){const Ze=Fe.canonical.y===(1<<Fe.canonical.z)-1;Fe.canonical.y===0&&Sg(!0,Fe,g,l,d,Z,q,Ae,Ne||a.ah.disabled),Ze&&Sg(!1,Fe,g,l,d,Z,q,Ae===a.ag.frontCW?a.ag.backCW:a.ag.frontCW,Ne||a.ah.disabled)}};k?ke(be,g.renderElevatedRasterBackface?a.ag.backCW:a.ag.frontCW,g.stencilModeFor3D()):ke(be,a.ag.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,l,d,y,b,T){g.renderPass==="offscreen"&&function(S,A,k,L){if(!L.length)return;const B=S.context,U=B.gl,q=A.getSource();if(!(q instanceof R))return;const Z=Math.ceil(Math.sqrt(k.paint.get("raster-particle-count")));let se=k.particlePositionRGBAImage;if(!se||se.width!==Z){const be=function(ve){const ke=ve*ve,Ce=new Uint8Array(4*ke),Ae=function(Fe){return Fe|=0,Fe=Math.imul(2747636419^Fe,2654435769),Fe=Math.imul(Fe^Fe>>>16,2654435769),((Fe=Math.imul(Fe^Fe>>>16,2654435769))>>>0)/4294967296},Ne=1/1.1;for(let Fe=0;Fe<ke;Fe++){const Ze=Ne*(Ae(2*Fe+0)+Pl),je=Ne*(Ae(2*Fe+1)+Pl),Me=255*Ze%1,nt=255*je%1,et=Me,qe=je-nt/255,St=nt;Ce[4*Fe+0]=255*(Ze-Me/255),Ce[4*Fe+1]=255*et,Ce[4*Fe+2]=255*qe,Ce[4*Fe+3]=255*St}return Ce}(Z);se=k.particlePositionRGBAImage=new a.j({width:Z,height:Z},be)}let oe=k.particleFramebuffer;oe?oe.width!==Z&&(oe.destroy(),oe=k.particleFramebuffer=B.createFramebuffer(Z,Z,!0,null)):oe=k.particleFramebuffer=B.createFramebuffer(Z,Z,!0,null);const ae=[];for(const be of L){const ve=A.getTile(be);if(!(ve instanceof a.c5))continue;const ke=qb(ve,q,k);if(!ke)continue;const Ce=[ve.tileSize,ve.tileSize];let Ae=k.tileFramebuffer;Ae||(Ae=k.tileFramebuffer=B.createFramebuffer(Ce[0],Ce[1],!0,null));let Ne=ve.rasterParticleState;Ne||(Ne=ve.rasterParticleState=new Yr(B,be,Ce,se));const Fe=Ne.update(k.lastInvalidatedAt);Ne.particleTextureDimension!==Z&&Ne.updateParticleTexture(be,se);const Ze=Ne.targetColorTexture;Ne.targetColorTexture=Ne.backgroundColorTexture,Ne.backgroundColorTexture=Ze;const je=Ne.particleTexture0;Ne.particleTexture0=Ne.particleTexture1,Ne.particleTexture1=je,ae.push([be,ke,Ne,Fe])}if(ae.length===0)return;const ce=a.e.now(),xe=k.previousDrawTimestamp?.001*(ce-k.previousDrawTimestamp):.0167;if(k.previousDrawTimestamp=ce,k.hasColorMap()){B.activeTexture.set(U.TEXTURE0+2);let be=k.colorRampTexture;be||(be=k.colorRampTexture=new a.T(B,k.colorRamp,U.RGBA)),be.bind(U.LINEAR,U.CLAMP_TO_EDGE)}B.bindFramebuffer.set(k.tileFramebuffer.framebuffer),function(be,ve,ke){const Ce=be.context,Ae=Ce.gl,Ne=ve.tileFramebuffer;Ce.activeTexture.set(Ae.TEXTURE0);const Fe={u_texture:0,u_opacity:1.05*(je=ve.paint.get("raster-particle-fade-opacity-factor"))/(je+.05)},Ze=be.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var je;for(const Me of ke){const[,,nt,et]=Me;Ne.colorAttachment.set(nt.targetColorTexture.texture),Ce.viewport.set([0,0,Ne.width,Ne.height]),Ce.clear({color:a.C.transparent}),et&&(nt.backgroundColorTexture.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE),Ze.draw(be,Ae.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,Fe,ve.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments))}}(S,k,ae),function(be,ve,ke,Ce){const Ae=be.context,Ne=Ae.gl,Fe=ke.tileFramebuffer,Ze=be.transform.projection.name==="globe",je=ke.paint.get("raster-particle-max-speed");for(const Me of Ce){const[nt,et,qe]=Me;Ae.activeTexture.set(Ne.TEXTURE0+0),et.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Fe.colorAttachment.set(qe.targetColorTexture.texture);const St=be.getOrCreateProgram("rasterParticleDraw",{defines:et.defines,overrideFog:!1});Ae.activeTexture.set(Ne.TEXTURE0+1);const yt=et.scalarData?[]:[0,1,2,3].map($e=>a.b$[$e](nt));yt.push(nt);const Xe=nt.canonical.x,ot=nt.canonical.y;for(const $e of yt){const vt=ve.getTile(Ze?$e.wrapped():$e);if(!vt)continue;const bt=vt.rasterParticleState;if(!bt)continue;const Vt=$e.canonical.x+(1<<$e.canonical.z)*($e.wrap-nt.wrap),Ht=$e.canonical.y;bt.particleTexture0.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const ln=EA(1,bt.particleTexture0.size[0],[Vt-Xe,Ht-ot],0,et.texture.size,2,je,et.textureOffset,et.scale,et.offset);St.draw(be,Ne.POINTS,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,ln,ke.id,bt.particleIndexBuffer,void 0,bt.particleSegment)}}}(S,A,k,ae),B.bindFramebuffer.set(k.particleFramebuffer.framebuffer),function(be,ve,ke,Ce){const Ae=be.context,Ne=Ae.gl,Fe=ve.paint.get("raster-particle-max-speed"),Ze=Ce*ve.paint.get("raster-particle-speed-factor")*.15,je=function(nt){return Math.pow(nt,6)}(.01+1*ve.paint.get("raster-particle-reset-rate-factor")),Me=ve.particleFramebuffer;Ae.viewport.set([0,0,Me.width,Me.height]);for(const nt of ke){const[,et,qe]=nt;Ae.activeTexture.set(Ne.TEXTURE0+0),et.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Ae.activeTexture.set(Ne.TEXTURE0+1);const St=qe.particleTexture0;St.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const yt=Nb(1,St.size[0],0,et.texture.size,Fe,Ze,je,et.textureOffset,et.scale,et.offset);Me.colorAttachment.set(qe.particleTexture1.texture),Ae.clear({color:a.C.transparent}),be.getOrCreateProgram("rasterParticleUpdate",{defines:et.defines}).draw(be,Ne.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,yt,ve.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments)}}(S,k,ae,xe)}(g,l,d,y),g.renderPass==="translucent"&&(function(S,A,k,L,B){const U=S.context,q=U.gl,Z=A.getSource().tileSize,se=5*(1-a.a0(a.aV,a.aV+1,S.transform.zoom))*Z+k.paint.get("raster-particle-elevation"),oe=!S.options.moving,ae=S.transform.projection.name==="globe";if(!L.length)return;const[ce,xe]=S.stencilConfigForOverlap(L),be=[];ae&&be.push("PROJECTION_GLOBE_VIEW");const ve=S.stencilModeFor3D();for(const ke of xe){const Ce=ke.toUnwrapped(),Ae=A.getTile(ke);if(!Ae.rasterParticleState)continue;const Ne=Ae.rasterParticleState,Fe=100;Ae.registerFadeDuration(Fe);const Ze=A.findLoadedParent(ke,0),je=el(Ae,Ze,A,S.transform,Fe);let Me,nt;S.terrain&&S.terrain.prepareDrawTile(),U.activeTexture.set(q.TEXTURE0),Ne.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),U.activeTexture.set(q.TEXTURE1),Ze&&Ze.rasterParticleState?(Ze.rasterParticleState.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Me=Math.pow(2,Ze.tileID.overscaledZ-Ae.tileID.overscaledZ),nt=[Ae.tileID.canonical.x*Me%1,Ae.tileID.canonical.y*Me%1]):Ne.targetColorTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const et=ae?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Ce,oe),qe=S.transform,St=Ig(qe),yt=a.be(ke.canonical),Xe=a.bf(yt.getCenter().lat);let ot,$e,vt,bt,Vt;ae?(ot=Float32Array.from(a.bh(a.bi(ke.canonical))),$e=Float32Array.from(qe.globeMatrix),vt=Float32Array.from(a.bd(qe)),bt=[a.ak(qe.center.lng),a.al(qe.center.lat)],Vt=Float32Array.from(a.bg(ke.canonical,yt,Xe,qe.worldSize/qe._pixelsPerMercatorPixel))):(ot=new Float32Array(16),$e=new Float32Array(9),vt=new Float32Array(16),bt=[0,0],Vt=new Float32Array(9));const Ht=oh(et,ot,$e,vt,Vt,nt||[0,0],a.a2(S.transform.zoom),bt,St,Me||1,je,se),ln=S.isTileAffectedByFog(ke),Yt=S.getOrCreateProgram("rasterParticle",{defines:be,overrideFog:ln});if(S.uploadCommonUniforms(U,Yt,Ce),ae){const wn=new a.af(q.LEQUAL,a.af.ReadOnly,S.depthRangeFor3D),Gn=0,In=S.globeSharedBuffers;if(In){const[Xn,pr,ei]=In.getGridBuffers(Xe,Gn!==0);Yt.draw(S,q.TRIANGLES,wn,ve,a.a.alphaBlended,S.renderElevatedRasterBackface?a.ag.frontCCW:a.ag.backCCW,Ht,k.id,Xn,pr,ei)}}else{const wn=S.depthModeForSublayer(0,a.af.ReadOnly),Gn=ce[ke.overscaledZ],{tileBoundsBuffer:In,tileBoundsIndexBuffer:Xn,tileBoundsSegments:pr}=S.getTileBoundsBuffers(Ae);Yt.draw(S,q.TRIANGLES,wn,Gn,a.a.alphaBlended,a.ag.disabled,Ht,k.id,In,Xn,pr)}}S.resetStencilClippingMasks()}(g,l,d,y),g.style.map.triggerRepaint())},background:function(g,l,d,y){const b=d.paint.get("background-color"),T=d.paint.get("background-opacity"),S=d.paint.get("background-emissive-strength");if(T===0)return;const A=g.context,k=A.gl,L=g.transform,B=L.tileSize,U=d.paint.get("background-pattern");let q;if(U!==void 0&&(U===null||(q=g.imageManager.getPattern(U.toString(),d.scope,g.style.getLut(d.scope)),!q)))return;const Z=!U&&b.a===1&&T===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==Z)return;const se=a.ah.disabled,oe=g.depthModeForSublayer(0,Z==="opaque"?a.af.ReadWrite:a.af.ReadOnly),ae=g.colorModeForDrapableLayerRenderPass(S),ce=U?"backgroundPattern":"background";let xe,be=y;be||(xe=g.getBackgroundTiles(),be=Object.values(xe).map(ve=>ve.tileID)),U&&(A.activeTexture.set(k.TEXTURE0),g.imageManager.bind(g.context,d.scope));for(const ve of be){const ke=g.isTileAffectedByFog(ve),Ce=g.getOrCreateProgram(ce,{overrideFog:ke}),Ae=ve.toUnwrapped(),Ne=y?ve.projMatrix:g.transform.calculateProjMatrix(Ae);g.prepareDrawTile();const Fe=l?l.getTile(ve):xe?xe[ve.key]:new a.bA(ve,B,L.zoom,g),Ze=U?SA(Ne,S,T,g,0,d.scope,q,{tileID:ve,tileSize:B}):b0(Ne,S,T,b.toRenderColor(d.lut));g.uploadCommonUniforms(A,Ce,Ae);const{tileBoundsBuffer:je,tileBoundsIndexBuffer:Me,tileBoundsSegments:nt}=g.getTileBoundsBuffers(Fe);Ce.draw(g,k.TRIANGLES,oe,se,ae,a.ag.disabled,Ze,d.id,je,Me,nt)}},sky:function(g,l,d){const y=g._atmosphere?a.a2(g.transform.zoom):1,b=d.paint.get("sky-opacity")*y;if(b===0)return;const T=g.context,S=d.paint.get("sky-type"),A=new a.af(T.gl.LEQUAL,a.af.ReadOnly,[0,1]),k=g.frameCounter/1e3%1;S==="atmosphere"?g.renderPass==="offscreen"?d.needsSkyboxCapture(g)&&(function(L,B,U,q){const Z=L.context,se=Z.gl;let oe=B.skyboxFbo;if(!oe){oe=B.skyboxFbo=Z.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new nn(Z),B.skyboxTexture=Z.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,B.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let be=0;be<6;++be)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(oe.framebuffer),Z.viewport.set([0,0,32,32]);const ae=B.getCenter(L,!0),ce=L.getOrCreateProgram("skyboxCapture"),xe=new Float64Array(16);a.ae.identity(xe),a.ae.rotateY(xe,xe,.5*-Math.PI),xr(L,B,ce,xe,ae,0),a.ae.identity(xe),a.ae.rotateY(xe,xe,.5*Math.PI),xr(L,B,ce,xe,ae,1),a.ae.identity(xe),a.ae.rotateX(xe,xe,.5*-Math.PI),xr(L,B,ce,xe,ae,2),a.ae.identity(xe),a.ae.rotateX(xe,xe,.5*Math.PI),xr(L,B,ce,xe,ae,3),a.ae.identity(xe),xr(L,B,ce,xe,ae,4),a.ae.identity(xe),a.ae.rotateY(xe,xe,Math.PI),xr(L,B,ce,xe,ae,5),Z.viewport.set([0,0,L.width,L.height])}(g,d),d.markSkyboxValid(g)):g.renderPass==="sky"&&function(L,B,U,q,Z){const se=L.context,oe=se.gl,ae=L.transform,ce=L.getOrCreateProgram("skybox");se.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_CUBE_MAP,B.skyboxTexture);const xe=((be,ve,ke,Ce,Ae)=>({u_matrix:be,u_sun_direction:ve,u_cubemap:0,u_opacity:Ce,u_temporal_offset:Ae}))(ae.skyboxMatrix,B.getCenter(L,!1),0,q,Z);L.uploadCommonUniforms(se,ce),ce.draw(L,oe.TRIANGLES,U,a.ah.disabled,L.colorModeForRenderPass(),a.ag.backCW,xe,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(g,d,A,b,k):S==="gradient"&&g.renderPass==="sky"&&function(L,B,U,q,Z){const se=L.context,oe=se.gl,ae=L.transform,ce=L.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new nn(se)),se.activeTexture.set(oe.TEXTURE0);let xe=B.colorRampTexture;xe||(xe=B.colorRampTexture=new a.T(se,B.colorRamp,oe.RGBA)),xe.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const be=((ve,ke,Ce,Ae,Ne)=>({u_matrix:ve,u_color_ramp:0,u_center_direction:ke,u_radius:a.ac(Ce),u_opacity:Ae,u_temporal_offset:Ne}))(ae.skyboxMatrix,B.getCenter(L,!1),B.paint.get("sky-gradient-radius"),q,Z);L.uploadCommonUniforms(se,ce),ce.draw(L,oe.TRIANGLES,U,a.ah.disabled,L.colorModeForRenderPass(),a.ag.backCW,be,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(g,d,A,b,k)},debug:function(g,l,d,y,b,T){for(let S=0;S<d.length;S++)if(b){const L=new a.C(y.r*.8,y.g*.8,y.b*.8,1);Tn(g,l,d[S],y,-1,-1,T),Tn(g,l,d[S],y,-1,1,T),Tn(g,l,d[S],y,1,1,T),Tn(g,l,d[S],y,1,-1,T),Tn(g,l,d[S],L,0,0,T)}else Tn(g,l,d[S],y,0,0,T)},custom:function(g,l,d,y){const b=g.context,T=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&d.isDraped(l)){if(g.renderPass==="offscreen"){const S=T.prerender;if(S){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const A=g.transform.pointMerc;S.call(T,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else S.call(T,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const A=T.renderToTile;if(A){const k=y[0].canonical,L=new a._(k.x+y[0].wrap*(1<<k.z),k.y,k.z);b.setDepthMode(a.af.disabled),b.setStencilMode(a.ah.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),A.call(T,b.gl,L),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(a.ah.disabled);const S=T.renderingMode==="3d"?new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly);if(b.setDepthMode(S),g.transform.projection.name==="globe"){const A=g.transform.pointMerc;T.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else T.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,l,d,y){if(g.renderPass==="opaque")return;const b=d.paint.get("model-opacity");if(b===0)return;const T=d.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!T||g.terrain&&b<.65&&d._transitionablePaint._values["model-opacity"].value.expression instanceof a.Z))return;const S=g.shadowRenderer,A=d.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,A||(S.enabled=!1));const k=()=>{S&&(S.useNormalOffset=!0,A||(S.enabled=!0))},L=l.getSource();if(g.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(ce,xe,be,ve,ke){const Ce=ce.transform;if(Ce.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${Ce.projection.name} projection is not yet implemented`);const Ae=Ce.getFreeCameraOptions().position;if(!ce.modelManager)return;const Ne=ce.modelManager;be.modelManager=Ne;const Fe=ce.shadowRenderer;if(!be._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ze=be._unevaluatedLayout._values["model-id"],je=de({},be.layout.get("model-id").parameters),Me=ce.style.order.indexOf(be.fqid);for(const nt of ve){const et=xe.getTile(nt).getBucket(be);if(!et||et.projection.name!==Ce.projection.name)continue;const qe=et.getModelUris();qe&&!et.modelsRequested&&(Ne.addModelsFromBucket(qe,ke),et.modelsRequested=!0);const St=vp(nt,Ce);je.zoom=St;const yt=Ze.possiblyEvaluate(je);if(yp(ce,et,nt),ka.shadowUniformsInitialized=!1,ka.useSingleShadowCascade=!!Fe&&Fe.getMaxCascadeForTile(nt.toUnwrapped())===0,ce.renderPass==="shadow"&&Fe){if(ce.currentShadowCascade===1&&et.isInsideFirstShadowMapFrustum)continue;const $e=Ce.calculatePosMatrix(nt.toUnwrapped(),Ce.worldSize);if(ka.tileMatrix.set($e),ka.shadowTileMatrix=Float32Array.from(Fe.calculateShadowPassMatrixFromMatrix($e)),ka.aabb.min.fill(0),ka.aabb.max[0]=ka.aabb.max[1]=a.a4,ka.aabb.max[2]=0,bo(et,ka,ce,be.scope))continue}const Xe=1<<nt.canonical.z,ot=[((Ae.x-nt.wrap)*Xe-nt.canonical.x)*a.a4,(Ae.y*Xe-nt.canonical.y)*a.a4,Ae.z*Xe*a.a4];ce.conflationActive&&Object.keys(et.instancesPerModel).length>0&&ce.style.isLayerClipped(be,xe.getSource())&&et.updateReplacement(nt,ce.replacementSource,Me,ke)&&(et.uploaded=!1,et.upload(ce.context));for(let $e in et.instancesPerModel){const vt=et.instancesPerModel[$e];vt.features.length>0&&($e=yt.evaluate(vt.features[0].feature,{}));const bt=Ne.getModel($e,ke);if(bt&&bt.uploaded)for(const Vt of bt.nodes)Pg(ce,be,Vt,vt,ot,nt,ka)}}}(g,l,d,y,L.type==="vector"?d.scope:""),void k();if(!L.loaded())return;if(L.type==="batched-model")return function(ce,xe,be,ve){be.resetLayerRenderingStats(ce);const ke=ce.context,Ce=ce.transform,Ae=ce.style.fog,Ne=ce.shadowRenderer;if(Ce.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Ce.projection.name} projection is not yet implemented`);const Fe=ce.transform.getFreeCameraOptions().position,Ze=a.$.scale([],[Fe.x,Fe.y,Fe.z],ce.transform.worldSize);a.$.negate(Ze,Ze);const je=a.ae.identity([]),Me=a.ci(Ce.center.lat,Ce.zoom),nt=a.ae.fromScaling([],[1,1,1/Me]);a.ae.translate(je,je,Ze);const et=be.paint.get("model-opacity"),qe=new a.af(ke.gl.LEQUAL,a.af.ReadWrite,ce.depthRangeFor3D),St=new a.af(ke.gl.LEQUAL,a.af.ReadOnly,ce.depthRangeFor3D),yt=new a.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Xe=ce.renderPass==="shadow",ot=Xe&&Ne?Ne.getCurrentCascadeFrustum():Ce.getFrustum(Ce.scaleZoom(Ce.worldSize)),$e=be.paint.get("model-front-cutoff"),vt=$e[2]<1,bt=$s(ce,be.paint.get("model-cutoff-fade-range")),Vt=be.getLayerRenderingStats();(function(Ht,ln,Yt,wn){const Gn=Ht.terrain?Ht.terrain.exaggeration():0,In=Ht.transform.zoom;for(const Xn of wn){const pr=ln.getTile(Xn).getBucket(Yt);pr&&(Ht.conflationActive&&pr.updateReplacement(Xn,Ht.replacementSource),pr.evaluateScale(Ht,Yt),Ht.terrain&&Gn>0&&pr.elevationUpdate(Ht.terrain,Gn,Xn,Yt.source),pr.needsReEvaluation(Ht,In,Yt)&&pr.evaluate(Yt))}})(ce,xe,be,ve),function(){let Ht,ln,Yt;vt?(Ht=ve.length-1,ln=-1,Yt=-1):(Ht=0,ln=ve.length,Yt=1);for(let wn=Ht;wn!==ln;wn+=Yt){const Gn=ve[wn],In=xe.getTile(Gn).getBucket(be);if(!In||!In.uploaded)continue;let Xn=!1;Ne&&(Xn=Ne.getMaxCascadeForTile(Gn.toUnwrapped())===0);const pr=Ce.calculatePosMatrix(Gn.toUnwrapped(),Ce.worldSize),ei=In.modelTraits,jr=[];for(const _r of In.getNodesInfo()){if(_r.hiddenByReplacement||!_r.node.meshes)continue;const Br=_r.node;let Jn=0;ce.terrain&&Br.elevation&&(Jn=Br.elevation*ce.terrain.exaggeration());const rr=_r.evaluatedScale;if(rr[0]<=1&&rr[1]<=1&&rr[2]<=1&&(()=>{const Ys=_r.aabb;return yt.min=[...Ys.min],yt.max=[...Ys.max],yt.min[2]+=Jn,yt.max[2]+=Jn,a.$.transformMat4(yt.min,yt.min,pr),a.$.transformMat4(yt.max,yt.max,pr),yt})().intersects(ot)===0)continue;const Wn=[...pr],wr=Br.anchor?Br.anchor[0]:0,or=Br.anchor?Br.anchor[1]:0;a.ae.translate(Wn,Wn,[wr*(rr[0]-1),or*(rr[1]-1),Jn]),a.$.exactEquals(rr,a.cl)||a.ae.scale(Wn,Wn,rr);const Mn=a.ae.multiply([],Wn,Br.matrix),Wi=a.ae.multiply([],Ce.expandedFarZProjMatrix,Mn),Hi=a.ae.multiply([],Ce.expandedFarZProjMatrix,Wn),co=a.aB.transformMat4([],[wr,or,Jn,1],Wi)[2];Br.hidden=!1;let uo=et;Xe||(vt&&(uo*=Gb(Wn,Ce,_r.aabb,$e)),uo*=ua(bt,co)),uo!==0?jr.push({nodeInfo:_r,depth:co,opacity:uo,wvpForNode:Wi,wvpForTile:Hi,nodeModelMatrix:Mn,tileModelMatrix:Wn}):Br.hidden=!0}Xe||jr.sort((_r,Br)=>!vt||_r.opacity===1&&Br.opacity===1?_r.depth<Br.depth?-1:1:_r.opacity===1?-1:Br.opacity===1?1:_r.depth>Br.depth?-1:1);for(const _r of jr){const Br=_r.nodeInfo,Jn=Br.node;let rr=a.ae.multiply([],nt,_r.tileModelMatrix);a.ae.multiply(rr,je,rr);const Wn=a.ae.invert([],rr);a.ae.transpose(Wn,Wn),a.ae.scale(Wn,Wn,Rg),rr=a.ae.multiply(rr,rr,Jn.matrix);const wr=ce.renderPass==="light-beam",or=ei&a.cn.HasMapboxMeshFeatures,Mn=or?0:Br.evaluatedRMEA[0][2];for(let Wi=0;Wi<Jn.meshes.length;++Wi){const Hi=Jn.meshes[Wi],co=Wi===Jn.lightMeshIndex;let uo=_r.wvpForNode;if(co){if(!wr&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}uo=_r.wvpForTile}else if(wr)continue;const Ys={defines:[]},ho=[];if(hh(Ys.defines,ho,Hi,ce,be.lut),or||Ys.defines.push("DIFFUSE_SHADED"),Xn&&Ys.defines.push("SHADOWS_SINGLE_CASCADE"),Vt&&(Xe?Vt.numRenderedVerticesInShadowPass+=Hi.vertexArray.length:Vt.numRenderedVerticesInTransparentPass+=Hi.vertexArray.length),Xe){R0(Hi,_r.nodeModelMatrix,ce,be);continue}let qs=null;if(Ae){const tt=Cd(_r.nodeModelMatrix,ce.transform);if(qs=new Float32Array(tt),Ce.projection.name!=="globe"){const xc=Hi.aabb.min,rl=Hi.aabb.max,[bc,wc]=Ae.getOpacityForBounds(tt,xc[0],xc[1],rl[0],rl[1]);Ys.overrideFog=bc>=vr||wc>=vr}}const Js=Hi.material;let Rt;Js.occlusionTexture&&Js.occlusionTexture.offsetScale&&(Rt=Js.occlusionTexture.offsetScale,Ys.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Xe&&Ne&&(Ne.useNormalOffset=!!Hi.normalBuffer);const un=ce.getOrCreateProgram("model",Ys);!Xe&&Ne&&Ne.setupShadowsFromMatrix(_r.tileModelMatrix,un,Ne.useNormalOffset),ce.uploadCommonUniforms(ke,un,null,qs);const wo=Js.pbrMetallicRoughness;wo.metallicFactor=.9,wo.roughnessFactor=.5;const Wr=ah(new Float32Array(uo),new Float32Array(rr),new Float32Array(Wn),new Float32Array(Jn.matrix),ce,_r.opacity,wo.baseColorFactor.toRenderColor(null),Js.emissiveFactor,wo.metallicFactor,wo.roughnessFactor,Js,Mn,be,[0,0,0],Rt);!co&&(Br.hasTranslucentParts||_r.opacity<1)&&un.draw(ce,ke.gl.TRIANGLES,qe,a.ah.disabled,a.a.disabled,a.ag.backCCW,Wr,be.id,Hi.vertexBuffer,Hi.indexBuffer,Hi.segments,be.paint,ce.transform.zoom,void 0,ho),un.draw(ce,ke.gl.TRIANGLES,co?St:qe,a.ah.disabled,co||_r.opacity<1||Br.hasTranslucentParts?a.a.alphaBlended:a.a.unblended,a.ag.backCCW,Wr,be.id,Hi.vertexBuffer,Hi.indexBuffer,Hi.segments,be.paint,ce.transform.zoom,void 0,ho)}}}}()}(g,l,d,y),void k();if(L.type!=="model")return;const B=L.getModels(),U=[],q=g.transform.getFreeCameraOptions().position,Z=a.$.scale([],[q.x,q.y,q.z],g.transform.worldSize);a.$.negate(Z,Z);const se=[],oe=[];let ae=0;for(const ce of B){const xe=d.paint.get("model-rotation").constantOr(null),be=d.paint.get("model-scale").constantOr(null),ve=d.paint.get("model-translation").constantOr(null);ce.computeModelMatrix(g,xe,be,ve,!0,!0,!1);const ke=a.ae.identity([]),Ce=a.ci(ce.position.lat,g.transform.zoom),Ae=a.ae.fromScaling([],[1,1,1/Ce]);a.ae.translate(ke,ke,Z),U.push({zScaleMatrix:Ae,negCameraPosMatrix:ke});for(const Ne of ce.nodes)Bi(g.transform,Ne,ce.matrix,g.transform.expandedFarZProjMatrix,ae,se,oe);ae++}if(se.sort((ce,xe)=>xe.depth-ce.depth),g.renderPass!=="shadow"){if(b===1)for(const ce of oe)ao(ce,g,d,U[ce.modelIndex],a.ah.disabled,g.colorModeForRenderPass());else{for(const ce of oe)ao(ce,g,d,U[ce.modelIndex],a.ah.disabled,a.a.disabled);for(const ce of oe)ao(ce,g,d,U[ce.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const ce of se)ao(ce,g,d,U[ce.modelIndex],a.ah.disabled,g.colorModeForRenderPass());k()}else{for(const ce of oe)R0(ce.mesh,ce.nodeModelMatrix,g,d);for(const ce of se)R0(ce.mesh,ce.nodeModelMatrix,g,d);k()}}},bs={model:function(g,l,d){const y=l.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(d.modelManager&&d.modelManager.upload(d,y.type==="vector"?g.scope:""));if(y.type==="batched-model"||y.type!=="model")return;const b=y.getModels();for(const T of b)T.upload(d.context)},raster:function(g,l,d){const y=l.getSource();if(!(y instanceof R&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=g.paint.get("raster-array-band")||y.getInitialBand(b);if(T==null)return;const S=l.getIds().map(A=>l.getTileByID(A));for(const A of S)A.updateNeeded(b,T)&&y.prepareTile(A,b,T)},"raster-particle":function(g,l,d){const y=l.getSource();if(!(y instanceof R&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=g.paint.get("raster-particle-array-band")||y.getInitialBand(b);if(T==null)return;const S=l.getIds().map(A=>l.getTileByID(A));for(const A of S)A.updateNeeded(b,T)&&y.prepareTile(A,b,T)}};class M0{constructor(l,d,y,b){this.context=new xi(l,d),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=a.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const A of T)this._debugParams.enabledLayers[A]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const A of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new tl(b),this.setup(),this.numSublayers=a.bx.maxUnderzooming+a.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new vg(this),this._wireframeDebugCache=new ps,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new a.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,S,l.RGBA)}updateTerrain(l,d){const y=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new rn(this,l));const b=this._terrain;this.transform.elevation=y?b:null,b.update(l,this.transform,d),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(l){const d=l.fog;if(!d||this.transform.projection.name==="globe"||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,b]=d.getFovAdjustedRange(this.transform._fov);if(y>b)return void(this.transform.fogCullDistSq=null);const T=y+.78*(b-y);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new rn(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,d){if(this.width=l*a.e.devicePixelRatio,this.height=d*a.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const l=this.context,d=new a.bv;d.emplaceBack(0,0),d.emplaceBack(a.a4,0),d.emplaceBack(0,a.a4),d.emplaceBack(a.a4,a.a4),this.tileExtentBuffer=l.createVertexBuffer(d,a.bt.members),this.tileExtentSegments=a.b.simpleSegment(0,0,4,2);const y=new a.bv;y.emplaceBack(0,0),y.emplaceBack(a.a4,0),y.emplaceBack(0,a.a4),y.emplaceBack(a.a4,a.a4),this.debugBuffer=l.createVertexBuffer(y,a.bt.members),this.debugSegments=a.b.simpleSegment(0,0,4,5);const b=new a.bv;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,a.bt.members),this.viewportSegments=a.b.simpleSegment(0,0,4,2);const T=new a.cq;T.emplaceBack(0,0,0,0),T.emplaceBack(a.a4,0,a.a4,0),T.emplaceBack(0,a.a4,0,a.a4),T.emplaceBack(a.a4,a.a4,a.a4,a.a4),this.mercatorBoundsBuffer=l.createVertexBuffer(T,a.cr.members),this.mercatorBoundsSegments=a.b.simpleSegment(0,0,4,2);const S=new a.bw;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S);const A=new a.cs;for(const L of[0,1,3,2,0])A.emplaceBack(L);this.debugIndexBuffer=l.createIndexBuffer(A),this.emptyTexture=new a.T(l,new a.j({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=a.ae.create();const k=this.context.gl;this.stencilClearMode=new a.ah({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,a.af.disabled,this.stencilClearMode,a.a.disabled,a.ag.disabled,lu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,d,y){if(!d||this.currentStencilSource===d.id||!l.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const k of y)if(this._tileClippingMaskIDs[k.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=d.id;const b=this.context,T=b.gl;this.nextStencilID+y.length>256&&this.clearStencil(),b.setColorMode(a.a.disabled),b.setDepthMode(a.af.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of y){const k=d.getTile(A),L=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:U,tileBoundsSegments:q}=this.getTileBoundsBuffers(k);S.draw(this,T.TRIANGLES,a.af.disabled,new a.ah({func:T.ALWAYS,mask:0},L,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.ag.disabled,lu(A.projMatrix),"$clipping",B,U,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new a.ah({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const d=this.context.gl;return new a.ah({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,y=l.sort((S,A)=>A.overscaledZ-S.overscaledZ),b=y[y.length-1].overscaledZ,T=y[0].overscaledZ-b+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const S={};for(let A=0;A<T;A++)S[A+b]=new a.ah({func:d.GEQUAL,mask:255},A+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[S,y]}return[{[b]:a.ah.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new a.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new a.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.a.unblended:a.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const d=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new a.a([d.ONE,d.ONE_MINUS_SRC_ALPHA,d.CONSTANT_ALPHA,d.ONE_MINUS_SRC_ALPHA],new a.C(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,d,y,b=!1){if(this.depthOcclusion)return new a.af(this.context.gl.GREATER,a.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return a.af.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new a.af(y||this.context.gl.LEQUAL,d,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const l=this.context.gl,d=Math.ceil(this.width),y=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),T=l.getParameter(l.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===d&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),d!==0&&y!==0&&(this.depthFBO=new gr(this.context,d,y,!1,"texture"),this.depthTexture=new a.T(this.context,{width:d,height:y,data:null},l.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),l.bindTexture(l.TEXTURE_2D,T),this.depthFBO&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),l.blitFramebuffer(0,0,d,y,0,0,d,y,l.DEPTH_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,d)=>l+d/this._fpsHistory.length,0))}render(l,d){const y=a.e.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=d;const b=this.style._mergedLayers,T=this.style.order.filter(je=>{const Me=b[je];return!(Me.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Me.type]});let S=!1,A=!1;for(const je of T){const Me=b[je];Me.type==="circle"&&(S=!0),Me.type==="symbol"&&(Me.hasInitialOcclusionOpacityProperties?A=!0:S=!0)}const k=T.map(je=>b[je]),L=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(a.e.now()),this.imageManager.beginFrame();let B=0,U=!1;for(const je in L){const Me=L[je];Me.used&&(Me.prepare(this.context),Me.getSource().usedInConflation&&++B)}let q=!1;for(const je of k)je.isHidden(this.transform.zoom)||(je.type==="clip"&&(q=!0),this.prepareLayer(je));const Z={},se={},oe={},ae={},ce={};for(const je in L){const Me=L[je];Z[je]=Me.getVisibleCoordinates(),se[je]=Z[je].slice().reverse(),oe[je]=Me.getVisibleCoordinates(!0).reverse(),ae[je]=Me.getShadowCasterCoordinates(),ce[je]=Me.sortCoordinatesByDistance(Z[je])}const xe=je=>{const Me=this.style.getLayerSourceCache(je);return Me&&Me.used?Me.getSource():null};if(B||q){const je=[],Me=[];let nt=0;for(const et of k)this.isSourceForClippingOrConflation(et,xe(et))&&(je.push(et),Me.push(nt)),nt++;if(je&&(q||je.length>1)){const et=[];for(let qe=0;qe<je.length;qe++){const St=je[qe],yt=Me[qe],Xe=this.style.getLayerSourceCache(St);if(!Xe||!Xe.used||!Xe.getSource().usedInConflation&&St.type!=="clip")continue;let ot=a.cv,$e=a.cw.None;const vt=[];if(St.type==="clip"){ot=yt;for(const bt of St.layout.get("clip-layer-types"))$e|=bt==="model"?a.cw.Model:bt==="symbol"?a.cw.Symbol:a.cw.FillExtrusion;for(const bt of St.layout.get("clip-layer-scope"))vt.push(bt)}et.push({layer:St.fqid,cache:Xe,order:ot,clipMask:$e,clipScope:vt})}this.replacementSource.setSources(et),U=!0}}U||this.replacementSource.clear(),this.conflationActive=U,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let je=0;je<k.length;je++){const Me=k[je],nt=Me.cutoffRange();if(this.longestCutoffRange=Math.max(nt,this.longestCutoffRange),nt>0){const et=xe(Me);et&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom)),Me.minzoom&&(this.minCutoffZoom=Math.max(Me.minzoom,this.minCutoffZoom))}Me.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=je),this._lastOcclusionLayer=je)}const be=this.style&&this.style.fog;be?(this._fogVisible=be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(oe),this.opaquePassCutoff=0);const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const je in L)for(const Me of Z[je]){let nt={min:0,max:0};this.terrain&&(nt=this.terrain.getMinMaxForTile(Me)||nt),ve.addShadowReceiver(Me.toUnwrapped(),nt.min,nt.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ag(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!a.cu(this.context.gl))return;this.renderPass="offscreen";for(const je of k){const Me=l.getLayerSourceCache(je);if(!je.hasOffscreenPass()||je.isHidden(this.transform.zoom))continue;const nt=Me?se[Me.id]:void 0;(je.type==="custom"||je.type==="raster"||je.type==="raster-particle"||je.isSky()||nt&&nt.length)&&this.renderLayer(this,Me,je,nt)}this.depthRangeFor3D=[0,1-(k.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ke=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ce=(()=>{if(d.showOverdrawInspector)return a.C.black;const je=this.style.fog;if(je&&this.transform.projection.supportsFog){const Me=this.style.getLut(je.scope);if(!ke){const nt=je.properties.get("color").toRenderColor(Me).toArray01();return new a.C(...nt)}if(ke){const nt=je.properties.get("space-color").toRenderColor(Me).toArray01();return new a.C(...nt)}}return a.C.transparent})();if(this.context.clear({color:Ce,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ke&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const je=k[this.currentLayer],Me=l.getLayerSourceCache(je);if(je.isSky())continue;const nt=Me?(je.is3D()?ce:se)[Me.id]:void 0;this._renderTileClippingMasks(je,Me,nt),this.renderLayer(this,Me,je,nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ke&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.a2(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const je=k[this.currentLayer],Me=l.getLayerSourceCache(je);je.isSky()&&this.renderLayer(this,Me,je,Me?se[Me.id]:void 0)}function Ae(je,Me){let nt;return Me&&(nt=(je.type==="symbol"?oe:je.is3D()?ce:se)[Me.id]),nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<T.length;){const je=k[this.currentLayer];if(je.type==="raster"||je.type==="raster-particle"){const Me=l.getLayerSourceCache(je);this.renderLayer(this,Me,je,Ae(je,Me))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ne=0;ve&&(Ne=ve.getShadowCastingLayerCount());let Fe=!1,Ze=-1;for(let je=0;je<T.length;++je){const Me=k[je];Me.isHidden(this.transform.zoom)||Me.is3D()&&(Ze=je)}for(A&&Ze===-1&&(S=!0);this.currentLayer<T.length;){const je=k[this.currentLayer],Me=l.getLayerSourceCache(je);if(je.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(je)){if(je.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(S&&!Fe&&this.terrain&&!this.transform.isOrthographic&&(Fe=!0,this.blitDepth()),A&&Ze!==-1&&this.currentLayer===Ze+1&&!this.transform.isOrthographic&&this.blitDepth(),je.is3D()||this.terrain||this._renderTileClippingMasks(je,Me,Me?Z[Me.id]:void 0),this.renderLayer(this,Me,je,Ae(je,Me)),!this.terrain&&ve&&Ne>0&&je.hasShadowPass()&&--Ne==0&&(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=nt;this.currentLayer++){const et=k[this.currentLayer];if(!et.hasLightBeamPass())continue;const qe=l.getLayerSourceCache(et);this.renderLayer(this,qe,et,qe?se[qe.id]:void 0)}this.currentLayer=nt,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const nt=this.currentLayer;this.depthOcclusion=!0;for(const et of this.layersWithOcclusionOpacity){this.currentLayer=et;const qe=k[this.currentLayer],St=l.getLayerSourceCache(qe),yt=St?se[St.id]:void 0;qe.is3D()||this.terrain||this._renderTileClippingMasks(qe,St,St?Z[St.id]:void 0),this.renderLayer(this,St,qe,yt)}this.depthOcclusion=!1,this.currentLayer=nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let je=null;k.forEach(Me=>{const nt=l.getLayerSourceCache(Me);nt&&!Me.isHidden(this.transform.zoom)&&nt.getVisibleCoordinates().length&&(!je||je.getSource().maxzoom<nt.getSource().maxzoom)&&(je=nt)}),je&&this.options.showTileBoundaries&&nl.debug(this,je,je.getVisibleCoordinates(),a.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&nl.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(je){const Me=je.transform.padding;A0(je,je.transform.height-(Me.top||0),3,I0),A0(je,Me.bottom||0,3,Cg),_p(je,Me.left||0,3,C0),_p(je,je.transform.width-(Me.right||0),3,Ir);const nt=je.transform.centerPoint;(function(et,qe,St,yt){Sd(et,qe-1,St-10,2,20,yt),Sd(et,qe-10,St-1,20,2,yt)})(je,nt.x,je.transform.height-nt.y,PA)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),U||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);const{unsupportedLayers:d}=this.transform.projection,y=!d||!d.includes(l.type);if(bs[l.type]&&(y||this.terrain&&l.type==="custom")){const b=this.style.getLayerSourceCache(l);bs[l.type](l,b,this)}this.gpuTimingEnd()}renderLayer(l,d,y,b){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||b&&b.length)&&(this.id=y.id,this.gpuTimingStart(y),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(y.type)&&(!l.terrain||y.type!=="custom")||y.type==="clip"||nl[y.type](l,d,y,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery,y=this.context.gl;let b=this.gpuTimers[l.id];b||(b=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:y.createQuery()}),b.calls++,y.beginQuery(d.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,d=this.context.gl,y=d.createQuery();this.deferredRenderGpuTimeQueries.push(y),d.beginQuery(l.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const d={};for(const y in l){const b=l[y],T=this.context.extTimerQuery,S=T.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(b.query),d[y]=S}return d}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery,y=this.context.gl;let b=0;for(const T of l)b+=d.getQueryParameter(T,y.QUERY_RESULT)/1e6,d.deleteQueryEXT(T);return b}translatePosMatrix(l,d,y,b,T){if(!y[0]&&!y[1])return l;const S=T?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(S){const L=Math.sin(S),B=Math.cos(S);y=[y[0]*B-y[1]*L,y[0]*L+y[1]*B]}const A=[T?y[0]:a.bD(d,y[0],this.transform.zoom),T?y[1]:a.bD(d,y[1],this.transform.zoom),0],k=new Float32Array(16);return a.ae.translate(k,l,A),k}saveTileTexture(l){const d=l.size[0],y=this._tileTextures[d];y?y.push(l):this._tileTextures[d]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,d,y){const b=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,T=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||T.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?T.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):T.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||b||d!==void 0&&!d||T.push("FOG","FOG_DITHERING"),b&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(l,d){this.cache=this.cache||{};const y=d&&d.defines||[],b=d&&d.config,T=this.currentGlobalDefines(l,d&&d.overrideFog,d&&d.overrideRtt).concat(y),S=Os.cacheKey(Yc[l],l,T,b);return this.cache[S]||(this.cache[S]=new Os(this.context,l,Yc[l],b,Fb[l],T)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,d){if(this.style.enable3dLights()){const y=this.style.directionalLight,b=this.style.ambientLight;if(y&&b){const T=((S,A,k)=>{const L=S.properties.get("direction"),B=S.properties.get("color").toRenderColor(k.getLut(S.scope)).toArray01(),U=S.properties.get("intensity"),q=A.properties.get("color").toRenderColor(k.getLut(A.scope)).toArray01(),Z=A.properties.get("intensity"),se=[L.x,L.y,L.z],oe=a.bC(q,Z),ae=a.bC(B,U);return{u_lighting_ambient_color:oe,u_lighting_directional_dir:se,u_lighting_directional_color:ae,u_ground_radiance:ui(se,ae,oe)}})(y,b,this.style);d.setLightsUniformValues(l,T)}}}uploadCommonUniforms(l,d,y,b,T){if(this.uploadCommonLightUniforms(l,d),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const A=S.getOpacity(this.transform.pitch),k=((L,B,U,q,Z,se,oe,ae,ce,xe,be,ve)=>{const ke=L.transform,Ce=B.properties.get("color").toRenderColor(L.style.getLut(B.scope)).toArray01();Ce[3]=q;const Ae=L.frameCounter/1e3%1,[Ne,Fe]=B.properties.get("vertical-range");return{u_fog_matrix:U?ke.calculateFogTileMatrix(U):ve||L.identityMat,u_fog_range:B.getFovAdjustedRange(ke._fov),u_fog_color:Ce,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ne,Fe),Fe],u_fog_temporal_offset:Ae,u_frustum_tl:Z,u_frustum_tr:se,u_frustum_br:oe,u_frustum_bl:ae,u_globe_pos:ce,u_globe_radius:xe,u_viewport:be,u_globe_transition:a.a2(ke.zoom),u_is_globe:+(ke.projection.name==="globe")}})(this,S,y,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.e.devicePixelRatio,this.transform.height*a.e.devicePixelRatio],b);d.setFogUniformValues(l,k)}T&&d.setCutoffUniformValues(l,T.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,d=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const b of y)d[b.key]=l[b.key]||new a.bA(b,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,d){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||l.sourceLayer!=="building")&&l.type!=="clip"&&(!d||d.type!=="batched-model"))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let d=this._cachedTileFogOpacities[l.key];return d||(this._cachedTileFogOpacities[l.key]=d=this.style.fog.getOpacityForTile(l)),d[0]>=vr||d[1]>=vr}setupDepthForOcclusion(l,d,y){const b=this.context,T=b.gl,S=!!y;var A;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(T.TEXTURE3),l&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),b.activeTexture.set(T.TEXTURE0),S||d.setTerrainUniformValues(b,y)}}class ha{constructor(l,d,y,b){this.screenBounds=l,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(l,d){let y,b;if(l instanceof a.P||typeof l[0]=="number"){const T=a.P.convert(l);y=[T],b=d.isPointAboveHorizon(T)}else{const T=a.P.convert(l[0]),S=a.P.convert(l[1]);y=[T,S],b=a.cx(T,S).every(A=>d.isPointAboveHorizon(A))}return new ha(y,d.getCameraPoint(),b,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return a.cx(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cx(d,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<y.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?b[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(b[3]=this.cameraPoint)),a.cy(b,l)}bufferedCameraGeometryGlobe(l){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cx(d,y,l),T=this.cameraPoint.clone();switch(3*((T.y>d.y)+(T.y>y.y))+((T.x>d.x)+(T.x>y.x))){case 0:b[0]=T,b[4]=T.clone();break;case 1:b.splice(1,0,T);break;case 2:b[1]=T;break;case 3:b.splice(4,0,T);break;case 5:b.splice(2,0,T);break;case 6:b[3]=T;break;case 7:b.splice(3,0,T);break;case 8:b[2]=T}return b}containsTile(l,d,y,b=0){const T=l.queryPadding/d._pixelsPerMercatorPixel+1,S=y?this._bufferedCameraMercator(T,d):this._bufferedScreenMercator(T,d);let A=l.tileID.wrap+(S.unwrapped?b:0);const k=S.polygon.map(ae=>a.cz(l.tileTransform,ae,A));if(!a.cA(k,0,0,a.a4,a.a4))return;A=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const L=this.screenGeometryMercator.polygon.map(ae=>a.cB(l.tileTransform,ae,A)),B=L.map(ae=>new a.P(ae[0],ae[1])),U=d.getFreeCameraOptions().position||new a._(0,0,0),q=a.cB(l.tileTransform,U,A),Z=L.map(ae=>{const ce=a.$.sub(ae,ae,q);return a.$.normalize(ce,ce),new a.aU(q,ce)}),se=a.bD(l,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:Z,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(oe=a.cC(k),oe.min.x=a.au(oe.min.x,0,a.a4),oe.min.y=a.au(oe.min.y,0,a.a4),oe.max.x=a.au(oe.max.x,0,a.a4),oe.max.y=a.au(oe.max.y,0,a.a4),oe),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:se};var oe}_bufferedScreenMercator(l,d){const y=cu(l);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),d):{polygon:this.bufferedScreenGeometry(l).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[y]=b,b}}_bufferedCameraMercator(l,d){const y=cu(l);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let b;return b=d.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),d):{polygon:this.bufferedCameraGeometry(l).map(T=>d.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[y]=b,b}}_projectAndResample(l,d){const y=function(T,S){const A=a.ae.multiply([],S.pixelMatrix,S.globeMatrix),k=[0,-a.cF,0,1],L=[0,a.cF,0,1],B=[0,0,0,1];a.aB.transformMat4(k,k,A),a.aB.transformMat4(L,L,A),a.aB.transformMat4(B,B,A);const U=new a.P(k[0]/k[3],k[1]/k[3]),q=new a.P(L[0]/L[3],L[1]/L[3]),Z=a.cD(T,U)&&k[3]<B[3],se=a.cD(T,q)&&L[3]<B[3];if(!Z&&!se)return null;const oe=function(Ae,Ne,Fe){for(let Ze=1;Ze<Ae.length;Ze++){const je=gc(Ne.pointCoordinate3D(Ae[Ze-1]).x),Me=gc(Ne.pointCoordinate3D(Ae[Ze]).x);if(Fe<0){if(je<Me)return{idx:Ze,t:-je/(Me-1-je)}}else if(Me<je)return{idx:Ze,t:(1-je)/(Me+1-je)}}return null}(T,S,Z?-1:1);if(!oe)return null;const{idx:ae,t:ce}=oe;let xe=ae>1?dh(T.slice(0,ae),S):[],be=ae<T.length?dh(T.slice(ae),S):[];xe=xe.map(Ae=>new a.P(gc(Ae.x),Ae.y)),be=be.map(Ae=>new a.P(gc(Ae.x),Ae.y));const ve=[...xe];ve.length===0&&ve.push(be[be.length-1]);const ke=a.a3(ve[ve.length-1].y,(be.length===0?xe[0]:be[0]).y,ce);let Ce;return Ce=Z?[new a.P(0,ke),new a.P(0,0),new a.P(1,0),new a.P(1,ke)]:[new a.P(1,ke),new a.P(1,1),new a.P(0,1),new a.P(0,ke)],ve.push(...Ce),be.length===0?ve.push(xe[0]):ve.push(...be),{polygon:ve.map(Ae=>new a._(Ae.x,Ae.y)),unwrapped:!1}}(l,d);if(y)return y;const b=function(T,S){let A=!1,k=-1/0,L=0;for(let U=0;U<T.length-1;U++)T[U].x>k&&(k=T[U].x,L=U);for(let U=0;U<T.length-1;U++){const q=(L+U)%(T.length-1),Z=T[q],se=T[q+1];Math.abs(Z.x-se.x)>.5&&(Z.x<se.x?(Z.x+=1,q===0&&(T[T.length-1].x+=1)):(se.x+=1,q+1===T.length-1&&(T[0].x+=1)),A=!0)}const B=a.ak(S.center.lng);return A&&B<Math.abs(B-1)&&T.forEach(U=>{U.x-=1}),{polygon:T,unwrapped:A}}(dh(l,d).map(T=>new a.P(gc(T.x),T.y)),d);return{polygon:b.polygon.map(T=>new a._(T.x,T.y)),unwrapped:b.unwrapped}}}function dh(g,l){return a.cE(g,d=>{const y=l.pointCoordinate3D(d);d.x=y.x,d.y=y.y},1/256)}function gc(g){return g<0?1+g%1:g%1}function cu(g){return 100*g|0}function RA(g,l){const d=a.ae.identity([]);return a.ae.scale(d,d,[.5*g.width,.5*-g.height,1]),a.ae.translate(d,d,[1,-1,0]),a.ae.multiply(d,d,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(d)}function _c(g,l,d,y,b,T,S,A=!1){const k=g.tilesIn(y,S,A);k.sort(k0);const L=[];for(const U of k)L.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(l,d,g._state,U,b,T,RA(g.transform,U.tile.tileID),A)});const B=function(U){const q={},Z={};for(const se of U){const oe=se.queryResults,ae=se.wrappedTileID,ce=Z[ae]=Z[ae]||{};for(const xe in oe){const be=oe[xe],ve=ce[xe]=ce[xe]||{},ke=q[xe]=q[xe]||[];for(const Ce of be)ve[Ce.featureIndex]||(ve[Ce.featureIndex]=!0,ke.push(Ce))}}return q}(L);for(const U in B)B[U].forEach(q=>{const Z=q.feature,se=Z.layer;se&&se.type!=="background"&&se.type!=="sky"&&se.type!=="slot"&&(Z.source=se.source,se["source-layer"]&&(Z.sourceLayer=se["source-layer"]),Z.state=Z.id!==void 0?g.getFeatureState(se["source-layer"],Z.id):{})});return B}function MA(g,l){const d=g.getRenderableIds().map(T=>g.getTileByID(T)),y=[],b={};for(let T=0;T<d.length;T++){const S=d[T],A=S.tileID.canonical.key;b[A]||(b[A]=!0,S.querySourceFeatures(y,l))}return y}function k0(g,l){const d=g.tileID,y=l.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}class qo{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const l=!1,d=!1;for(const y in this.style._mergedLayers){const b=this.style._mergedLayers[y];if(b.type==="fill-extrusion")this.layers.push({layer:b,visible:l,visibilityChanged:d});else if(b.type==="model"){const T=this.style.getLayerSource(b);T&&T.type==="batched-model"&&this.layers.push({layer:b,visible:l,visibilityChanged:d})}}}onNewFrame(l){this.layersGotHidden=!1;for(const d of this.layers){const y=d.layer;let b=!1;y.type==="fill-extrusion"?b=!y.isHidden(l)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="model"&&(b=!y.isHidden(l)&&y.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!b&&d.visible,d.visible=b}}updateZOffset(l,d){this.currentBuildingBuckets=[];for(const b of this.layers){const T=b.layer,S=this.style.getLayerSourceCache(T);let A=1;T.type==="fill-extrusion"&&(A=b.visible?T.paint.get("fill-extrusion-vertical-scale"):0);let k=S?S.getTile(d):null;if(!k&&S&&d.canonical.z>S.getSource().minzoom){let L=d.scaledTo(Math.min(S.getSource().maxzoom,d.overscaledZ-1));for(;L.overscaledZ>=S.getSource().minzoom&&(k=S.getTile(L),!k&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:k?k.getBucket(T):null,tileID:k?k.tileID:d,verticalScale:A})}l.hasAnyZOffset=!1;let y=!1;for(let b=0;b<l.symbolInstances.length;b++){const T=l.symbolInstances.get(b),S=T.zOffset,A=this._getHeightAtTileOffset(d,T.tileAnchorX,T.tileAnchorY);T.zOffset=A!==Number.NEGATIVE_INFINITY?A:S,y||S===T.zOffset||(y=!0),l.hasAnyZOffset||T.zOffset===0||(l.hasAnyZOffset=!0)}y&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,d,y,b){let T=d,S=y;if(l.canonical.z!==b.canonical.z){const A=b.canonical,k=1/(1<<l.canonical.z-A.z);T=(d+l.canonical.x*a.a4)*k-A.x*a.a4|0,S=(y+l.canonical.y*a.a4)*k-A.y*a.a4|0}return{tileX:T,tileY:S}}_getHeightAtTileOffset(l,d,y){let b,T;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:A,tileID:k,verticalScale:L}=this.currentBuildingBuckets[S];if(!A)continue;const{tileX:B,tileY:U}=this._mapCoordToOverlappingTile(l,d,y,k),q=A.getHeightAtTileCoord(B,U);q&&q.height!==void 0&&(q.hidden?b=q.height:T=Math.max(q.height*L,T||0))}if(T!==void 0)return T;for(let S=0;S<this.layers.length;++S){const A=this.layers[S];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:k,tileID:L}=this.currentBuildingBuckets[S];if(!k)continue;const{tileX:B,tileY:U}=this._mapCoordToOverlappingTile(l,d,y,L),q=k.getHeightAtTileCoord(B,U);if(q&&!q.hidden)return q.height===void 0&&b!==void 0?Math.min(q.maxHeight,b)*q.verticalScale:q.height?q.height*q.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function kA(g,l){const d={};for(const y in g)y!=="ref"&&(d[y]=g[y]);return a.cG.forEach(y=>{y in l&&(d[y]=l[y])}),d}function xp(g){g=g.slice();const l=Object.create(null);for(let d=0;d<g.length;d++)l[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=kA(g[d],l[g[d].ref]));return g}const Cr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Pd(g,l,d){d.push({command:Cr.addSource,args:[g,l[g]]})}function Wb(g,l,d){l.push({command:Cr.removeSource,args:[g]}),d[g]=!0}function DA(g,l,d,y){Wb(g,d,y),Pd(g,l,d)}function bp(g,l,d){let y;for(y in g[d])if(g[d].hasOwnProperty(y)&&y!=="data"&&!a.d(g[d][y],l[d][y]))return!1;for(y in l[d])if(l[d].hasOwnProperty(y)&&y!=="data"&&!a.d(g[d][y],l[d][y]))return!1;return!0}function uu(g,l,d,y,b,T){let S;for(S in l=l||{},g=g||{})g.hasOwnProperty(S)&&(a.d(g[S],l[S])||d.push({command:T,args:[y,S,l[S],b]}));for(S in l)l.hasOwnProperty(S)&&!g.hasOwnProperty(S)&&(a.d(g[S],l[S])||d.push({command:T,args:[y,S,l[S],b]}))}function Mg(g){return g.id}function yc(g,l){return g[l.id]=l,g}class Hb{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=a.au(l,0,1);let d=1,y=this._distances[d];const b=l*this.paddedLength+this.padding;for(;y<b&&d<this._distances.length;)y=this._distances[++d];const T=d-1,S=this._distances[T],A=y-S,k=A>0?(b-S)/A:0;return this.points[T].mult(1-k).add(this.points[d].mult(k))}}class wp{constructor(l,d,y){const b=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(d/y);for(let S=0;S<this.xCellCount*this.yCellCount;S++)b.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,y,b,T){this._forEachCell(d,y,b,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(T)}insertCircle(l,d,y,b){this._forEachCell(d-b,y-b,d+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(y),this.circles.push(b)}_insertBoxCell(l,d,y,b,T,S){this.boxCells[T].push(S)}_insertCircleCell(l,d,y,b,T,S){this.circleCells[T].push(S)}_query(l,d,y,b,T,S){if(y<0||l>this.width||b<0||d>this.height)return!T&&[];const A=[];if(l<=0&&d<=0&&this.width<=y&&this.height<=b){if(T)return!0;for(let k=0;k<this.boxKeys.length;k++)A.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const L=this.circles[3*k],B=this.circles[3*k+1],U=this.circles[3*k+2];A.push({key:this.circleKeys[k],x1:L-U,y1:B-U,x2:L+U,y2:B+U})}return S?A.filter(S):A}return this._forEachCell(l,d,y,b,this._queryCell,A,{hitTest:T,seenUids:{box:{},circle:{}}},S),T?A.length>0:A}_queryCircle(l,d,y,b,T){const S=l-y,A=l+y,k=d-y,L=d+y;if(A<0||S>this.width||L<0||k>this.height)return!b&&[];const B=[];return this._forEachCell(S,k,A,L,this._queryCellCircle,B,{hitTest:b,circle:{x:l,y:d,radius:y},seenUids:{box:{},circle:{}}},T),b?B.length>0:B}query(l,d,y,b,T){return this._query(l,d,y,b,!1,T)}hitTest(l,d,y,b,T){return this._query(l,d,y,b,!0,T)}hitTestCircle(l,d,y,b){return this._queryCircle(l,d,y,!0,b)}_queryCell(l,d,y,b,T,S,A,k){const L=A.seenUids,B=this.boxCells[T];if(B!==null){const q=this.bboxes;for(const Z of B)if(!L.box[Z]){L.box[Z]=!0;const se=4*Z;if(l<=q[se+2]&&d<=q[se+3]&&y>=q[se+0]&&b>=q[se+1]&&(!k||k(this.boxKeys[Z]))){if(A.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Z],x1:q[se],y1:q[se+1],x2:q[se+2],y2:q[se+3]})}}}const U=this.circleCells[T];if(U!==null){const q=this.circles;for(const Z of U)if(!L.circle[Z]){L.circle[Z]=!0;const se=3*Z;if(this._circleAndRectCollide(q[se],q[se+1],q[se+2],l,d,y,b)&&(!k||k(this.circleKeys[Z]))){if(A.hitTest)return S.push(!0),!0;{const oe=q[se],ae=q[se+1],ce=q[se+2];S.push({key:this.circleKeys[Z],x1:oe-ce,y1:ae-ce,x2:oe+ce,y2:ae+ce})}}}}}_queryCellCircle(l,d,y,b,T,S,A,k){const L=A.circle,B=A.seenUids,U=this.boxCells[T];if(U!==null){const Z=this.bboxes;for(const se of U)if(!B.box[se]){B.box[se]=!0;const oe=4*se;if(this._circleAndRectCollide(L.x,L.y,L.radius,Z[oe+0],Z[oe+1],Z[oe+2],Z[oe+3])&&(!k||k(this.boxKeys[se])))return S.push(!0),!0}}const q=this.circleCells[T];if(q!==null){const Z=this.circles;for(const se of q)if(!B.circle[se]){B.circle[se]=!0;const oe=3*se;if(this._circlesCollide(Z[oe],Z[oe+1],Z[oe+2],L.x,L.y,L.radius)&&(!k||k(this.circleKeys[se])))return S.push(!0),!0}}}_forEachCell(l,d,y,b,T,S,A,k){const L=this._convertToXCellCoord(l),B=this._convertToYCellCoord(d),U=this._convertToXCellCoord(y),q=this._convertToYCellCoord(b);for(let Z=L;Z<=U;Z++)for(let se=B;se<=q;se++)if(T.call(this,l,d,y,b,this.xCellCount*se+Z,S,A,k))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,y,b,T,S){const A=b-l,k=T-d,L=y+S;return L*L>A*A+k*k}_circleAndRectCollide(l,d,y,b,T,S,A){const k=(S-b)/2,L=Math.abs(l-(b+k));if(L>k+y)return!1;const B=(A-T)/2,U=Math.abs(d-(T+B));if(U>B+y)return!1;if(L<=k||U<=B)return!0;const q=L-k,Z=U-B;return q*q+Z*Z<=y*y}}const lo=100;class OA{constructor(l,d,y=new wp(l.width+200,l.height+200,25),b=new wp(l.width+200,l.height+200,25)){this.transform=l,this.grid=y,this.ignoredGrid=b,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+lo,this.screenBottomBoundary=l.height+lo,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=d}placeCollisionBox(l,d,y,b,T,S,A,k){let L=y.projectedAnchorX,B=y.projectedAnchorY,U=y.projectedAnchorZ;const q=y.elevation,Z=y.tileID,se=l.getProjection();if(q&&Z){const[Ce,Ae,Ne]=se.upVector(Z.canonical,y.tileAnchorX,y.tileAnchorY),Fe=se.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=Ce*q*Fe,B+=Ae*q*Fe,U+=Ne*q*Fe}const oe=this.projectAndGetPerspectiveRatio(A,L,B,U,y.tileID,se.name==="globe"||!!q||this.transform.pitch>0,se),ae=S*oe.perspectiveRatio,ce=(y.x1*d+b.x-y.padding)*ae+oe.point.x,xe=(y.y1*d+b.y-y.padding)*ae+oe.point.y,be=(y.x2*d+b.x+y.padding)*ae+oe.point.x,ve=(y.y2*d+b.y+y.padding)*ae+oe.point.y,ke=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(ce,xe,be,ve)||!T&&this.grid.hitTest(ce,xe,be,ve,k)||ke?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[ce,xe,be,ve],offscreen:this.isOffscreen(ce,xe,be,ve),occluded:!1}}placeCollisionCircles(l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe){const ae=[],ce=this.transform.elevation,xe=l.getProjection(),be=ce?ce.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,xe):null,ve=new a.P(y.tileAnchorX,y.tileAnchorY);let{x:ke,y:Ce,z:Ae}=xe.projectTilePoint(ve.x,ve.y,oe.canonical);if(be){const[yt,Xe,ot]=be(ve);ke+=yt,Ce+=Xe,Ae+=ot}const Ne=xe.name==="globe",Fe=this.projectAndGetPerspectiveRatio(A,ke,Ce,Ae,oe,Ne||!!ce||this.transform.pitch>0,xe),{perspectiveRatio:Ze}=Fe,je=(U?S/Ze:S*Ze)/a.bP,Me=xo(ke,Ce,Ae,k),nt=Fe.signedDistanceFromCamera>0?ih(je,T,y.lineOffsetX*je,y.lineOffsetY*je,!1,Me,ve,y,b,k,{},ce&&!U?be:null,U&&!!ce,xe,oe,U):null;let et=!1,qe=!1,St=!0;if(nt&&!Fe.occluded){const yt=.5*Z*Ze+se,Xe=new a.P(-100,-100),ot=new a.P(this.screenRightBoundary,this.screenBottomBoundary),$e=new Hb,{first:vt,last:bt}=nt,Vt=vt.path.length;let Ht=[];for(let wn=Vt-1;wn>=1;wn--)Ht.push(vt.path[wn]);for(let wn=1;wn<bt.path.length;wn++)Ht.push(bt.path[wn]);const ln=2.5*yt;L&&(Ht=Ht.map(([wn,Gn,In],Xn)=>(be&&!Ne&&(In=be(Xn<Vt-1?vt.tilePath[Vt-1-Xn]:bt.tilePath[Xn-Vt+2])[2]),xo(wn,Gn,In,L))),Ht.some(wn=>wn[3]<=0)&&(Ht=[]));let Yt=[];if(Ht.length>0){let wn=1/0,Gn=-1/0,In=1/0,Xn=-1/0;for(const pr of Ht)wn=Math.min(wn,pr[0]),In=Math.min(In,pr[1]),Gn=Math.max(Gn,pr[0]),Xn=Math.max(Xn,pr[1]);Gn>=Xe.x&&wn<=ot.x&&Xn>=Xe.y&&In<=ot.y&&(Yt=[Ht.map(pr=>new a.P(pr[0],pr[1]))],(wn<Xe.x||Gn>ot.x||In<Xe.y||Xn>ot.y)&&(Yt=a.cH(Yt,Xe.x,Xe.y,ot.x,ot.y)))}for(const wn of Yt){$e.reset(wn,.25*yt);let Gn=0;Gn=$e.length<=.5*yt?1:Math.ceil($e.paddedLength/ln)+1;for(let In=0;In<Gn;In++){const Xn=In/Math.max(Gn-1,1),pr=$e.lerp(Xn),ei=pr.x+lo,jr=pr.y+lo;ae.push(ei,jr,yt,0);const _r=ei-yt,Br=jr-yt,Jn=ei+yt,rr=jr+yt;if(St=St&&this.isOffscreen(_r,Br,Jn,rr),qe=qe||this.isInsideGrid(_r,Br,Jn,rr),!d&&this.grid.hitTestCircle(ei,jr,yt,q)&&(et=!0,!B))return{circles:[],offscreen:!1,collisionDetected:et,occluded:!1}}}}return{circles:!B&&et||!qe?[]:ae,offscreen:St,collisionDetected:et,occluded:Fe.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,b=1/0,T=-1/0,S=-1/0;for(const B of l){const U=new a.P(B.x+lo,B.y+lo);y=Math.min(y,U.x),b=Math.min(b,U.y),T=Math.max(T,U.x),S=Math.max(S,U.y),d.push(U)}const A=this.grid.query(y,b,T,S).concat(this.ignoredGrid.query(y,b,T,S)),k={},L={};for(const B of A){const U=B.key;if(k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]={}),k[U.bucketInstanceId][U.featureIndex])continue;const q=[new a.P(B.x1,B.y1),new a.P(B.x2,B.y1),new a.P(B.x2,B.y2),new a.P(B.x1,B.y2)];a.cI(d,q)&&(k[U.bucketInstanceId][U.featureIndex]=!0,L[U.bucketInstanceId]===void 0&&(L[U.bucketInstanceId]=[]),L[U.bucketInstanceId].push(U.featureIndex))}return L}insertCollisionBox(l,d,y,b,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:T},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,y,b,T){const S=d?this.ignoredGrid:this.grid,A={bucketInstanceId:y,featureIndex:b,collisionGroupID:T};for(let k=0;k<l.length;k+=4)S.insertCircle(A,l[k],l[k+1],l[k+2])}projectAndGetPerspectiveRatio(l,d,y,b,T,S,A){const k=[d,y,b,1];let L=!1;b||this.transform.pitch>0?(a.aB.transformMat4(k,k,l),this.fogState&&T&&A.name!=="globe"&&(L=function(q,Z,se,oe,ae,ce){const xe=ce.calculateFogTileMatrix(ae),be=[Z,se,oe];return a.$.transformMat4(be,be,xe),dr(q,a.$.length(be),ce.pitch,ce._fov)}(this.fogState,d,y,b,T.toUnwrapped(),this.transform)>.9)):ap(k,k,l);const B=k[3];return{point:new a.P((k[0]/B+1)/2*this.transform.width+lo,(-k[1]/B+1)/2*this.transform.height+lo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/B*.5,1.5),signedDistanceFromCamera:B,occluded:S&&k[2]>B||L}}isOffscreen(l,d,y,b){return y<lo||l>=this.screenRightBoundary||b<lo||d>this.screenBottomBoundary}isInsideGrid(l,d,y,b){return y>=0&&l<this.gridRightBoundary&&b>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=a.ae.identity([]);return a.ae.translate(l,l,[-100,-100,0]),l}}class Zb{constructor(l,d,y,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):b&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Tp{constructor(l,d,y,b,T,S=!1){this.text=new Zb(l?l.text:null,d,y,T),this.icon=new Zb(l?l.icon:null,d,b,T),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kg{constructor(l,d,y,b=!1){this.text=l,this.icon=d,this.skipFade=y,this.clipped=b}}class LA{constructor(){this.invProjMatrix=a.ae.create(),this.viewportMatrix=a.ae.create(),this.circles=[]}}class D0{constructor(l,d,y,b,T){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=T}}class Xb{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[l]}}function O0(g,l,d,y,b){const{horizontalAlign:T,verticalAlign:S}=a.bS(g),A=-(T-.5)*l,k=-(S-.5)*d,L=a.bR(g,y);return new a.P(A+L[0]*b,k+L[1]*b)}function Dg(g,l,d,y,b){const T=new a.P(g,l);return d&&T._rotate(y?b:-b),T}class Kb{constructor(l,d,y,b,T,S){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new OA(this.transform,T),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Xb(y),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,y,b){const T=y.getBucket(d),S=y.latestFeatureIndex;if(!T||!S||d.fqid!==T.layerIds[0])return;const A=T.layers[0].layout,k=y.collisionBoxArray,L=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),B=y.tileSize/a.a4,U=y.tileID.toUnwrapped();this.transform.setProjection(T.projection);const q=(Z=y.tileID,se=T.getProjection(),oe=this.transform,se.name===this.projection?oe.calculateProjMatrix(Z.toUnwrapped()):lh(oe,se,Z));var Z,se,oe;const ae=A.get("text-pitch-alignment")==="map",ce=A.get("text-rotation-alignment")==="map";d.compileFilter();const xe=d.dynamicFilter(),be=d.dynamicFilterNeedsFeature(),ve=this.transform.calculatePixelsToTileUnitsMatrix(y),ke=nh(q,y.tileID.canonical,ae,ce,this.transform,T.getProjection(),ve);let Ce=null;if(ae){const Fe=rh(q,y.tileID.canonical,ae,ce,this.transform,T.getProjection(),ve);Ce=a.ae.multiply([],this.transform.labelPlaneMatrix,Fe)}let Ae=null;xe&&y.latestFeatureIndex&&(Ae={unwrappedTileID:U,dynamicFilter:xe,dynamicFilterNeedsFeature:be,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new D0(T.bucketInstanceId,S,T.sourceLayerIndex,T.index,y.tileID);const Ne={bucket:T,layout:A,posMatrix:q,textLabelPlaneMatrix:ke,labelToScreenMatrix:Ce,clippingData:Ae,scale:L,textPixelRatio:B,holdingForFade:y.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:a.aE(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.aE(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(b)for(const Fe of T.sortKeyRanges){const{sortKey:Ze,symbolInstanceStart:je,symbolInstanceEnd:Me}=Fe;l.push({sortKey:Ze,symbolInstanceStart:je,symbolInstanceEnd:Me,parameters:Ne})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(l,d,y,b,T,S,A,k,L,B,U,q,Z,se,oe,ae,ce,xe){const{textOffset0:be,textOffset1:ve,crossTileID:ke}=q,Ce=[be,ve],Ae=O0(l,y,b,Ce,T),Ne=this.collisionIndex.placeCollisionBox(se,T,d,Dg(Ae.x,Ae.y,S,A,this.transform.angle),U,k,L,B.predicate);if(ae){const Fe=se.getSymbolInstanceIconSize(xe,this.transform.zoom,q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(se,Fe,ae,Dg(Ae.x,Ae.y,S,A,this.transform.angle),U,k,L,B.predicate).box.length===0)return}if(Ne.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ke]&&this.prevPlacement.placements[ke]&&this.prevPlacement.placements[ke].text&&(Fe=this.prevPlacement.variableOffsets[ke].anchor),this.variableOffsets[ke]={textOffset:Ce,width:y,height:b,anchor:l,textScale:T,prevAnchor:Fe},this.markUsedJustification(se,l,q,oe),se.allowVerticalPlacement&&(this.markUsedOrientation(se,oe,q),this.placedOrientations[ke]=oe),{shift:Ae,placedGlyphBoxes:Ne}}}placeLayerBucketPart(l,d,y,b){const{bucket:T,layout:S,posMatrix:A,textLabelPlaneMatrix:k,labelToScreenMatrix:L,clippingData:B,textPixelRatio:U,holdingForFade:q,collisionBoxArray:Z,partiallyEvaluatedTextSize:se,partiallyEvaluatedIconSize:oe,collisionGroup:ae}=l.parameters,ce=S.get("text-optional"),xe=S.get("icon-optional"),be=S.get("text-allow-overlap"),ve=S.get("icon-allow-overlap"),ke=S.get("text-rotation-alignment")==="map",Ce=S.get("text-pitch-alignment")==="map",Ae=S.get("symbol-z-order")==="viewport-y",Ne=S.get("symbol-z-elevate");this.transform.setProjection(T.projection);let Fe=be&&(ve||!T.hasIconData()||xe),Ze=ve&&(be||!T.hasTextData()||ce);!T.collisionArrays&&Z&&T.deserializeCollisionBoxes(Z),y&&b&&T.updateCollisionDebugBuffers(this.transform.zoom,Z);const je=(Me,nt,et)=>{const{crossTileID:qe,numVerticalGlyphVertices:St}=Me;if(B){const Jn={zoom:this.transform.zoom,pitch:this.transform.pitch};let rr=null;if(B.dynamicFilterNeedsFeature){const Wn=this.retainedQueryData[T.bucketInstanceId];rr=B.featureIndex.loadFeature({featureIndex:Me.featureIndex,bucketIndex:Wn.bucketIndex,sourceLayerIndex:Wn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,B.dynamicFilter)(Jn,rr,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new a.P(Me.tileAnchorX,Me.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[qe]=new kg(!1,!1,!1,!0),void d.add(qe)}if(d.has(qe))return;if(q)return void(this.placements[qe]=new kg(!1,!1,!1));let yt=!1,Xe=!1,ot=!0,$e=!1,vt=!1,bt=null,Vt={box:null,offscreen:null,occluded:null},Ht={box:null,offscreen:null,occluded:null},ln=null,Yt=null,wn=null,Gn=0,In=0,Xn=0;et.textFeatureIndex?Gn=et.textFeatureIndex:Me.useRuntimeCollisionCircles&&(Gn=Me.featureIndex),et.verticalTextFeatureIndex&&(In=et.verticalTextFeatureIndex);const pr=Jn=>{Jn.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const rr=this.transform.elevation;Jn.elevation=Me.zOffset+(rr?rr.getAtTileOffset(Jn.tileID,Jn.tileAnchorX,Jn.tileAnchorY):0)},ei=et.textBox;if(ei){pr(ei);const Jn=Wn=>{let wr=a.aF.horizontal;if(T.allowVerticalPlacement&&!Wn&&this.prevPlacement){const or=this.prevPlacement.placedOrientations[qe];or&&(this.placedOrientations[qe]=or,wr=or,this.markUsedOrientation(T,wr,Me))}return wr},rr=(Wn,wr)=>{if(T.allowVerticalPlacement&&St>0&&et.verticalTextBox){for(const or of T.writingModes)if(or===a.aF.vertical?(Vt=wr(),Ht=Vt):Vt=Wn(),Vt&&Vt.box&&Vt.box.length)break}else Vt=Wn()};if(S.get("text-variable-anchor")){let Wn=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qe]){const Mn=this.prevPlacement.variableOffsets[qe];Wn.indexOf(Mn.anchor)>0&&(Wn=Wn.filter(Wi=>Wi!==Mn.anchor),Wn.unshift(Mn.anchor))}const wr=(Mn,Wi,Hi)=>{const co=T.getSymbolInstanceTextSize(se,Me,this.transform.zoom,nt),uo=(Mn.x2-Mn.x1)*co+2*Mn.padding,Ys=(Mn.y2-Mn.y1)*co+2*Mn.padding,ho=Me.hasIconTextFit&&!ve?Wi:null;ho&&pr(ho);let qs={box:[],offscreen:!1,occluded:!1};const Js=be?2*Wn.length:Wn.length;for(let Rt=0;Rt<Js;++Rt){const un=this.attemptAnchorPlacement(Wn[Rt%Wn.length],Mn,uo,Ys,co,ke,Ce,U,A,ae,Rt>=Wn.length,Me,nt,T,Hi,ho,se,oe);if(un&&(qs=un.placedGlyphBoxes,qs&&qs.box&&qs.box.length)){yt=!0,bt=un.shift;break}}return qs};rr(()=>wr(ei,et.iconBox,a.aF.horizontal),()=>{const Mn=et.verticalTextBox;return Mn&&pr(Mn),T.allowVerticalPlacement&&!(Vt&&Vt.box&&Vt.box.length)&&St>0&&Mn?wr(Mn,et.verticalIconBox,a.aF.vertical):{box:null,offscreen:null,occluded:null}}),Vt&&(yt=Vt.box,ot=Vt.offscreen,$e=Vt.occluded);const or=Jn(!(!Vt||!Vt.box));if(!yt&&this.prevPlacement){const Mn=this.prevPlacement.variableOffsets[qe];Mn&&(this.variableOffsets[qe]=Mn,this.markUsedJustification(T,Mn.anchor,Me,or))}}else{const Wn=(wr,or)=>{const Mn=T.getSymbolInstanceTextSize(se,Me,this.transform.zoom,nt),Wi=this.collisionIndex.placeCollisionBox(T,Mn,wr,new a.P(0,0),be,U,A,ae.predicate);return Wi&&Wi.box&&Wi.box.length&&(this.markUsedOrientation(T,or,Me),this.placedOrientations[qe]=or),Wi};rr(()=>Wn(ei,a.aF.horizontal),()=>{const wr=et.verticalTextBox;return T.allowVerticalPlacement&&St>0&&wr?(pr(wr),Wn(wr,a.aF.vertical)):{box:null,offscreen:null,occluded:null}}),Jn(!!(Vt&&Vt.box&&Vt.box.length))}}if(ln=Vt,yt=ln&&ln.box&&ln.box.length>0,ot=ln&&ln.offscreen,$e=ln&&ln.occluded,Me.useRuntimeCollisionCircles){const Jn=T.text.placedSymbolArray.get(Me.centerJustifiedTextSymbolIndex>=0?Me.centerJustifiedTextSymbolIndex:Me.verticalPlacedTextSymbolIndex),rr=a.aG(T.textSizeData,se,Jn),Wn=S.get("text-padding");Yt=this.collisionIndex.placeCollisionCircles(T,be,Jn,T.lineVertexArray,T.glyphOffsetArray,rr,A,k,L,y,Ce,ae.predicate,Me.collisionCircleDiameter*rr/a.bP,Wn,this.retainedQueryData[T.bucketInstanceId].tileID),yt=be||Yt.circles.length>0&&!Yt.collisionDetected,ot=ot&&Yt.offscreen,$e=Yt.occluded}if(et.iconFeatureIndex&&(Xn=et.iconFeatureIndex),et.iconBox){const Jn=rr=>{pr(rr);const Wn=Me.hasIconTextFit&&bt?Dg(bt.x,bt.y,ke,Ce,this.transform.angle):new a.P(0,0),wr=T.getSymbolInstanceIconSize(oe,this.transform.zoom,Me.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,wr,rr,Wn,ve,U,A,ae.predicate)};Ht&&Ht.box&&Ht.box.length&&et.verticalIconBox?(wn=Jn(et.verticalIconBox),Xe=wn.box.length>0):(wn=Jn(et.iconBox),Xe=wn.box.length>0),ot=ot&&wn.offscreen,vt=wn.occluded}const jr=ce||Me.numHorizontalGlyphVertices===0&&St===0,_r=xe||Me.numIconVertices===0;if(jr||_r?_r?jr||(Xe=Xe&&yt):yt=Xe&&yt:Xe=yt=Xe&&yt,yt&&ln&&ln.box&&this.collisionIndex.insertCollisionBox(ln.box,S.get("text-ignore-placement"),T.bucketInstanceId,Ht&&Ht.box&&In?In:Gn,ae.ID),Xe&&wn&&this.collisionIndex.insertCollisionBox(wn.box,S.get("icon-ignore-placement"),T.bucketInstanceId,Xn,ae.ID),Yt&&(yt&&this.collisionIndex.insertCollisionCircles(Yt.circles,S.get("text-ignore-placement"),T.bucketInstanceId,Gn,ae.ID),y)){const Jn=T.bucketInstanceId;let rr=this.collisionCircleArrays[Jn];rr===void 0&&(rr=this.collisionCircleArrays[Jn]=new LA);for(let Wn=0;Wn<Yt.circles.length;Wn+=4)rr.circles.push(Yt.circles[Wn+0]),rr.circles.push(Yt.circles[Wn+1]),rr.circles.push(Yt.circles[Wn+2]),rr.circles.push(Yt.collisionDetected?1:0)}const Br=T.projection.name!=="globe";Fe=Fe&&(Br||!$e),Ze=Ze&&(Br||!vt),this.placements[qe]=new kg(yt||Fe,Xe||Ze,ot||T.justReloaded),d.add(qe)};if(Ne&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),Ae){const Me=T.getSortedSymbolIndexes(this.transform.angle);for(let nt=Me.length-1;nt>=0;--nt){const et=Me[nt];je(T.symbolInstances.get(et),et,T.collisionArrays[et])}T.hasAnyZOffset&&a.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Me=T.getSortedIndexesByZOffset();for(let nt=0;nt<Me.length;++nt){const et=Me[nt];je(T.symbolInstances.get(et),et,T.collisionArrays[et])}}else for(let Me=l.symbolInstanceStart;Me<l.symbolInstanceEnd;Me++)je(T.symbolInstances.get(Me),Me,T.collisionArrays[Me]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[T.bucketInstanceId];a.ae.invert(Me.invProjMatrix,A),Me.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(l,d,y,b){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:k,crossTileID:L}=y,B=a.cM(d),U=b===a.aF.vertical?k:B==="left"?T:B==="center"?S:B==="right"?A:-1;T>=0&&(l.text.placedSymbolArray.get(T).crossTileID=U>=0&&T!==U?0:L),S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=U>=0&&S!==U?0:L),A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=U>=0&&A!==U?0:L),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=U>=0&&k!==U?0:L)}markUsedOrientation(l,d,y){const b=d===a.aF.horizontal||d===a.aF.horizontalOnly?d:0,T=d===a.aF.vertical?d:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L}=y,B=l.text.placedSymbolArray;S>=0&&(B.get(S).placedOrientation=b),A>=0&&(B.get(A).placedOrientation=b),k>=0&&(B.get(k).placedOrientation=b),L>=0&&(B.get(L).placedOrientation=T)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const b=d?d.symbolFadeChange(l):1,T=d?d.opacities:{},S=d?d.variableOffsets:{},A=d?d.placedOrientations:{};for(const k in this.placements){const L=this.placements[k],B=T[k];B?(this.opacities[k]=new Tp(B,b,L.text,L.icon,null,L.clipped),y=y||L.text!==B.text.placed||L.icon!==B.icon.placed):(this.opacities[k]=new Tp(null,b,L.text,L.icon,L.skipFade,L.clipped),y=y||L.text||L.icon)}for(const k in T){const L=T[k];if(!this.opacities[k]){const B=new Tp(L,b,!1,!1);B.isHidden()||(this.opacities[k]=B,y=y||L.text.placed||L.icon.placed)}}for(const k in S)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=S[k]);for(const k in A)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=A[k]);y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d,y,b){const T=new Set;for(const S of d){const A=S.getBucket(l);A&&S.latestFeatureIndex&&l.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,T,S.collisionBoxArray,y,b,S.tileID,l.scope),A.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(A,S.tileID),A.updateZOffset()))}}updateBucketOpacities(l,d,y,b,T,S,A){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const k=l.layers[0].layout,L=!!l.layers[0].dynamicFilter(),B=new Tp(null,0,!1,!1,!0),U=k.get("text-allow-overlap"),q=k.get("icon-allow-overlap"),Z=k.get("text-variable-anchor"),se=k.get("text-rotation-alignment")==="map",oe=k.get("text-pitch-alignment")==="map",ae=new Tp(null,0,U&&(q||!l.hasIconData()||k.get("icon-optional")),q&&(U||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const ce=(be,ve,ke)=>{for(let Ce=0;Ce<ve/4;Ce++)be.opacityVertexArray.emplaceBack(ke)};let xe=0;T&&l.updateReplacement(S,T);for(let be=0;be<l.symbolInstances.length;be++){const ve=l.symbolInstances.get(be),{numHorizontalGlyphVertices:ke,numVerticalGlyphVertices:Ce,crossTileID:Ae,numIconVertices:Ne,tileAnchorX:Fe,tileAnchorY:Ze}=ve,je=d.has(Ae);let Me=this.opacities[Ae];je?Me=B:Me||(Me=ae,this.opacities[Ae]=Me),d.add(Ae);const nt=ke>0||Ce>0,et=Ne>0,qe=this.placedOrientations[Ae],St=qe===a.aF.vertical,yt=qe===a.aF.horizontal||qe===a.aF.horizontalOnly;!nt&&!et||Me.isHidden()||xe++;let Xe=!1;if((nt||et)&&T)for(const ot of l.activeReplacements){if(a.cJ(ot,b,a.cw.Symbol,A)||ot.min.x>Fe||Fe>ot.max.x||ot.min.y>Ze||Ze>ot.max.y)continue;const $e=a.cK(Fe,Ze,S.canonical,ot.footprintTileId.canonical);if(Xe=a.cL($e,ot),Xe)break}if(nt){const ot=Xe?hu:da(Me.text);ce(l.text,ke,St?hu:ot),ce(l.text,Ce,yt?hu:ot);const $e=Me.text.isHidden(),{leftJustifiedTextSymbolIndex:vt,centerJustifiedTextSymbolIndex:bt,rightJustifiedTextSymbolIndex:Vt,verticalPlacedTextSymbolIndex:Ht}=ve,ln=l.text.placedSymbolArray,Yt=$e||St?1:0;vt>=0&&(ln.get(vt).hidden=Yt),bt>=0&&(ln.get(bt).hidden=Yt),Vt>=0&&(ln.get(Vt).hidden=Yt),Ht>=0&&(ln.get(Ht).hidden=$e||yt?1:0);const wn=this.variableOffsets[Ae];wn&&this.markUsedJustification(l,wn.anchor,ve,qe);const Gn=this.placedOrientations[Ae];Gn&&(this.markUsedJustification(l,"left",ve,Gn),this.markUsedOrientation(l,Gn,ve))}if(et){const ot=Xe?hu:da(Me.icon),{placedIconSymbolIndex:$e,verticalPlacedIconSymbolIndex:vt}=ve,bt=l.icon.placedSymbolArray,Vt=Me.icon.isHidden()?1:0;$e>=0&&(ce(l.icon,Ne,St?hu:ot),bt.get($e).hidden=Vt),vt>=0&&(ce(l.icon,ve.numVerticalIconVertices,yt?hu:ot),bt.get(vt).hidden=Vt)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const ot=l.collisionArrays[be];if(ot){let $e=new a.P(0,0),vt=!0;if(ot.textBox||ot.verticalTextBox){if(Z){const Vt=this.variableOffsets[Ae];Vt?($e=O0(Vt.anchor,Vt.width,Vt.height,Vt.textOffset,Vt.textScale),se&&$e._rotate(oe?this.transform.angle:-this.transform.angle)):vt=!1}L&&(vt=!Me.clipped),ot.textBox&&kl(l.textCollisionBox.collisionVertexArray,Me.text.placed,!vt||St,$e.x,$e.y),ot.verticalTextBox&&kl(l.textCollisionBox.collisionVertexArray,Me.text.placed,!vt||yt,$e.x,$e.y)}const bt=vt&&!!(!yt&&ot.verticalIconBox);ot.iconBox&&kl(l.iconCollisionBox.collisionVertexArray,Me.icon.placed,bt,ve.hasIconTextFit?$e.x:0,ve.hasIconTextFit?$e.y:0),ot.verticalIconBox&&kl(l.iconCollisionBox.collisionVertexArray,Me.icon.placed,!bt,ve.hasIconTextFit?$e.x:0,ve.hasIconTextFit?$e.y:0)}}}if(l.fullyClipped=xe===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=be.invProjMatrix,l.placementViewportMatrix=be.viewportMatrix,l.collisionCircleArray=be.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function kl(g,l,d,y,b){g.emplaceBack(l?1:0,d?1:0,y||0,b||0),g.emplaceBack(l?1:0,d?1:0,y||0,b||0),g.emplaceBack(l?1:0,d?1:0,y||0,b||0),g.emplaceBack(l?1:0,d?1:0,y||0,b||0)}const Og=Math.pow(2,25),Qb=Math.pow(2,24),Yb=Math.pow(2,17),Ep=Math.pow(2,16),Sp=Math.pow(2,9),Jb=Math.pow(2,8),L0=Math.pow(2,1);function da(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const l=g.placed?1:0,d=Math.floor(127*g.opacity);return d*Og+l*Qb+d*Yb+l*Ep+d*Sp+l*Jb+d*L0+l}const hu=0;class zt{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,d,y,b,T){const S=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(S,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,k)=>A.sortKey-k.sortKey));this._currentPartIndex<S.length;){const A=S[this._currentPartIndex];if(d.placeLayerBucketPart(A,this._seenCrossTileIDs,y,A.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class ew{constructor(l,d,y,b,T,S,A,k,L){this.placement=new Kb(l,T,S,A,k,L),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(l,d,y,b){const T=a.e.now(),S=()=>{const A=a.e.now()-T;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=d[l[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=k)&&(!A.maxzoom||A.maxzoom>k)){const L=A,B=L.layout.get("symbol-z-elevate"),U=this._inProgressLayer=this._inProgressLayer||new zt(L),q=a.am(A.source,A.scope);if(U.continuePlacement(B?b[q]:y[q],this.placement,this._showCollisionBoxes,A,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Ip=512/a.a4/2;class z0{constructor(l,d,y){this.tileID=l,this.bucketInstanceId=y,this.index=new a.cN(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=l.canonical.x*a.a4,T=l.canonical.y*a.a4;for(let S=0;S<d.length;S++){const{key:A,crossTileID:k,tileAnchorX:L,tileAnchorY:B}=d.get(S),U=Math.floor((b+L)*Ip),q=Math.floor((T+B)*Ip);this.index.add(U,q),this.keys.push(A),this.crossTileIDs.push(k)}this.index.finish()}findMatches(l,d,y){const b=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),T=Ip/Math.pow(2,d.canonical.z-this.tileID.canonical.z),S=d.canonical.x*a.a4,A=d.canonical.y*a.a4;for(let k=0;k<l.length;k++){const L=l.get(k);if(L.crossTileID)continue;const{key:B,tileAnchorX:U,tileAnchorY:q}=L,Z=Math.floor((S+U)*T),se=Math.floor((A+q)*T),oe=this.index.range(Z-b,se-b,Z+b,se+b);for(const ae of oe){const ce=this.crossTileIDs[ae];if(this.keys[ae]===B&&!y.has(ce)){y.add(ce),L.crossTileID=ce;break}}}}}class tw{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Lg{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(d!==0)for(const y in this.indexes){const b=this.indexes[y],T={};for(const S in b){const A=b[S];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+d),T[A.tileID.key]=A}this.indexes[y]=T}this.lng=l}addBucket(l,d,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const b=this.usedCrossTileIDs[l.overscaledZ];for(const T in this.indexes){const S=this.indexes[T];if(Number(T)>l.overscaledZ)for(const A in S){const k=S[A];k.tileID.isChildOf(l)&&k.findMatches(d.symbolInstances,l,b)}else{const A=S[l.scaledTo(Number(T)).key];A&&A.findMatches(d.symbolInstances,l,b)}}for(let T=0;T<d.symbolInstances.length;T++){const S=d.symbolInstances.get(T);S.crossTileID||(S.crossTileID=y.generate(),b.add(S.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new z0(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const y of d.crossTileIDs)this.usedCrossTileIDs[l].delete(y)}removeStaleBuckets(l){let d=!1;for(const y in this.indexes){const b=this.indexes[y];for(const T in b)l[b[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[T]),delete b[T],d=!0)}return d}}class vc{constructor(){this.layerIndexes={},this.crossTileIDs=new tw,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,y,b){let T=this.layerIndexes[l.fqid];T===void 0&&(T=this.layerIndexes[l.fqid]=new Lg);let S=!1;const A={};b.name!=="globe"&&T.handleWrapJump(y);for(const k of d){const L=k.getBucket(l);L&&l.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(k.tileID,L,this.crossTileIDs)&&(S=!0),A[L.bucketInstanceId]=!0)}return T.removeStaleBuckets(A)&&(S=!0),S}pruneUnusedLayers(l){const d={};l.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const N0=new a.U({data:new a.W(a.N.colorTheme.data)}),fa=(g,l)=>_n(g,l&&l.filter(d=>d.identifier!=="source.canvas")),zg=a.ai(Cr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Rd=a.ai(Cr,["setCenter","setZoom","setBearing","setPitch"]),nw={version:8,layers:[],sources:{}},rw={duration:300,delay:0};class pa extends a.E{constructor(l,d={}){super(),this.map=l,this.scope=d.scope||"",this.globalId=null,this.fragments=[],this.importDepth=d.importDepth||0,this.importsCache=d.importsCache||new Map,this.resolvedImports=d.resolvedImports||new Set,this.transition=a.Q({},rw),this._buildingIndex=new qo(this),this.crossTileSymbolIndex=new vc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=d.styleChanges||new _e,this.dispatcher=d.dispatcher?d.dispatcher:new a.by(a.bz(),this),d.imageManager?this.imageManager=d.imageManager:(this.imageManager=new di,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=d.glyphManager?d.glyphManager:new a.cP(l._requestManager,d.localFontFamily?a.cQ.all:d.localIdeographFontFamily?a.cQ.ideographs:a.cQ.none,d.localFontFamily||d.localIdeographFontFamily),d.modelManager?this.modelManager=d.modelManager:(this.modelManager=new Li(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=d.configOptions?d.configOptions:new Map,this._configDependentLayers=d.configDependentLayers?d.configDependentLayers:new Set,this._config=d.config,this._initialConfig=d.initialConfig,this.dispatcher.broadcast("setReferrer",a.cR());const y=this;this._rtlTextPluginCallback=pa.registerForPluginStateChange(b=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(T,S)=>{if(a.cS(T),S&&S.every(A=>A))for(const A in y._sourceCaches){const k=y._sourceCaches[A],L=k.getSource().type;L!=="vector"&&L!=="geojson"||k.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const T=this.getOwnSource(b.sourceId);if(T&&T.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===T.id&&this._validateLayer(A)}})}load(l){return l?(typeof l=="string"?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if(typeof l=="string"){if(a.cT(l))return l;const d=a.cU(l);if(!d.startsWith("http"))try{return new URL(d,location.href).toString()}catch(y){return d}return d}return`json://${a.cV(JSON.stringify(l))}`}_diffStyle(l,d,y){this.globalId=this._getGlobalId(l);const b=(T,S)=>{try{S(null,this.setState(T,y))}catch(A){S(A,!1)}};if(typeof l=="string"){const T=this.map._requestManager.normalizeStyleURL(l),S=this.map._requestManager.transformRequest(T,a.R.Style);a.h(S,(A,k)=>{A?this.fire(new a.f(A)):k&&b(k,d)})}else typeof l=="object"&&b(l,d)}loadURL(l,d={}){this.fire(new a.g("dataloading",{dataType:"style"}));const y=typeof d.validate=="boolean"?d.validate:!a.cT(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,d.accessToken),this.resolvedImports.add(l);const b=this.importsCache.get(l);if(b)return this._load(b,y);const T=this.map._requestManager.transformRequest(l,a.R.Style);this._request=a.h(T,(S,A)=>{if(this._request=null,S)this.fire(new a.f(S));else if(A)return this.importsCache.set(l,A),this._load(A,y)})}loadJSON(l,d={}){this.fire(new a.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=a.e.frame(()=>{this._request=null,this._load(l,d.validate!==!1)})}loadEmpty(){this.fire(new a.g("dataloading",{dataType:"style"})),this._load(nw,!1)}_loadImports(l,d,y){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const T of l){const S=this._createFragmentStyle(T),A=new Promise(B=>{S.once("style.import.load",B),S.once("error",B)}).then(()=>this.mergeAll());if(b.push(A),this.resolvedImports.has(T.url)){S.loadEmpty();continue}const k=T.data||this.importsCache.get(T.url);k?(S.loadJSON(k,{validate:d}),this._isInternalStyle(k)&&(S.globalId=null)):T.url?S.loadURL(T.url,{validate:d}):S.loadEmpty();const L={style:S,id:T.id,config:T.config};if(y){const B=this.fragments.findIndex(({id:U})=>U===y);this.fragments=this.fragments.slice(0,B).concat(L).concat(this.fragments.slice(B))}else this.fragments.push(L)}return Promise.allSettled(b)}getImportGlobalIds(l=this,d=new Set){for(const y of l.fragments)y.style.globalId&&d.add(y.style.globalId),this.getImportGlobalIds(y.style,d);return[...d.values()]}_createFragmentStyle(l){const d=this.scope?a.am(l.id,this.scope):l.id;let y;const b=this._initialConfig&&this._initialConfig[d];(l.config||b)&&(y=a.Q({},l.config,b));const T=new pa(this.map,{scope:d,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,configDependentLayers:this._configDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&l.fragment!==!1)}_load(l,d){const y=l.schema;if(this._isInternalStyle(l)){const S=a.Q({},nw,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(S,d)}if(this.updateConfig(this._config,y),d&&fa(this,ne(l)))return;this._loaded=!0,this.stylesheet=a.cW(l);const b=()=>{for(const L in l.sources)this.addSource(L,l.sources[L],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const S=xp(this.stylesheet.layers);if(this._order=S.map(L=>L.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new ur(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ur(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const L of S){const B=a.c$(L,this.scope,this._styleColorTheme.lut,this.options);B.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B,this._serializedLayers[B.id]=B.serialize();const U=this.getOwnLayerSourceCache(B),q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&B.canCastShadows()&&q&&(U.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.g("data",{dataType:"style"}));const k=this.isRootStyle();l.imports?this._loadImports(l.imports,d).then(()=>{this._reloadImports(),this.fire(new a.g(k?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.g(k?"style.load":"style.import.load")))},T=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=T,T){const S=this._evaluateColorThemeData(T);this._loadColorTheme(S).then(()=>{b()}).catch(A=>{a.w(`Couldn't load color theme from the stylesheet: ${A}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,d,y,b,T,S,A,k;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(l=B.light),B.stylesheet.lights)for(const U of B.stylesheet.lights)U.type==="ambient"&&B.ambientLight!=null&&(d=B.ambientLight),U.type==="directional"&&B.directionalLight!=null&&(y=B.directionalLight);b=this._prioritizeTerrain(b,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(T=B.fog),B.stylesheet.camera!=null&&(k=B.stylesheet.camera),B.stylesheet.projection!=null&&(S=B.stylesheet.projection),B.stylesheet.transition!=null&&(A=B.stylesheet.transition),L[B.scope]=B._styleColorTheme}}),this.light=l,this.ambientLight=d,this.directionalLight=y,this.fog=T,this._styleColorThemeForScope=L,b===null?delete this.terrain:this.terrain=b,this.camera=k||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=a.Q({},rw,A),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const d=y=>{for(const b of y.fragments)d(b.style);l(y)};d(this)}_prioritizeTerrain(l,d,y){const b=l&&l.drapeRenderMode===0;return y===null?d&&d.drapeRenderMode===0?d:b?l:null:d!=null&&(!l||b||d&&d.drapeRenderMode===1)?d:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{l=this._prioritizeTerrain(l,d.terrain,d.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(d=>{d.stylesheet.projection!=null&&(l=d.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},d={},y={};this.forEachFragmentStyle(b=>{for(const T in b._sourceCaches){const S=a.am(T,b.scope);l[S]=b._sourceCaches[T]}for(const T in b._otherSourceCaches){const S=a.am(T,b.scope);d[S]=b._otherSourceCaches[T]}for(const T in b._symbolSourceCaches){const S=a.am(T,b.scope);y[S]=b._symbolSourceCaches[T]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=d,this._mergedSymbolSourceCaches=y}mergeLayers(){const l={},d=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const A of S._order){const k=S._layers[A];if(k.type==="slot"){const L=a.cX(A);if(l[L])continue;l[L]=[]}k.slot&&l[k.slot]?l[k.slot].push(k):d.push(k)}}),this._mergedOrder=[],this._clipLayerIndices=[];let b=0;const T=(S=[])=>{for(const A of S)if(A.type==="slot"){const k=a.cX(A.id);l[k]&&T(l[k]),this._mergedSlots.push(k)}else{const k=a.am(A.id,A.scope);this._mergedOrder.push(k),y[k]=A,A.is3D()&&(this._has3DLayers=!0),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0),A.type==="clip"&&this._clipLayerIndices.push(b),b++}};T(d),this._mergedOrder.sort((S,A)=>{const k=y[S],L=y[A];return k.hasInitialOcclusionOpacityProperties?L.is3D()?1:0:k.is3D()&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=a.Q({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(d,y,b){const T=a.Q({},y);for(const A of Object.keys(a.N.colorTheme))T[A]===void 0&&(T[A]=a.N.colorTheme[A].default);const S=new a.O(N0,d,new Map(b));return S.setTransitionOrValue(T,b),S.untransitioned().possiblyEvaluate(new a.Y(0))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const d=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,b)=>{const T="data:image/png;base64,";if(!l||l.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let S=l;S.startsWith(T)||(S=T+S);const A="mapbox-reserved-lut",k=new Image;k.src=S,k.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},k.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==d)return void y();this._styleColorTheme.lutLoading=!1;const{width:L,height:B,data:U}=a.e.getImageData(k);if(B>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==B*B)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new a.j({width:L,height:B},U),pixelRatio:1,sdf:!1,version:0});const q=this.imageManager.getImage(A,this.scope);q?(this._styleColorTheme.lut={image:q.data,data:l},y()):b(new Error("Missing LUT image."))}})}getLut(l){const d=this._styleColorThemeForScope[l];return d?d.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(d,y,b){let T,S,A;const k=a.e.devicePixelRatio>1?"@2x":"";let L=a.h(y.transformRequest(y.normalizeSpriteURL(d,k,".json"),a.R.SpriteJSON),(q,Z)=>{L=null,A||(A=q,T=Z,U())}),B=a.i(y.transformRequest(y.normalizeSpriteURL(d,k,".png"),a.R.SpriteImage),(q,Z)=>{B=null,A||(A=q,S=Z,U())});function U(){if(A)b(A);else if(T&&S){const q=a.e.getImageData(S),Z={};for(const se in T){const{width:oe,height:ae,x:ce,y:xe,sdf:be,pixelRatio:ve,stretchX:ke,stretchY:Ce,content:Ae}=T[se],Ne=new a.j({width:oe,height:ae});a.j.copy(q,Ne,{x:ce,y:xe},{x:0,y:0},{width:oe,height:ae},null),Z[se]={data:Ne,pixelRatio:ve,sdf:be,stretchX:ke,stretchY:Ce,content:Ae}}b(null,Z)}}return{cancel(){L&&(L.cancel(),L=null),B&&(B.cancel(),B=null)}}}(l,this.map._requestManager,(d,y)=>{if(this._spriteRequest=null,d)this.fire(new a.f(d));else if(y)for(const b in y)this.imageManager.addImage(b,this.scope,y[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.g("data",{dataType:"style"}))})}_validateLayer(l){const d=this.getOwnSource(l.source);if(!d)return;const y=l.sourceLayer;y&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(y)===-1)&&this.fire(new a.f(new Error(`Source layer "${y}" does not exist on source "${d.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,d)=>{const y=this.fragments[d];return y&&y.style&&(l.data=y.style.serialize()),l})}_serializeSources(){const l={};for(const d in this._sourceCaches){const y=this._sourceCaches[d].getSource();l[y.id]||(l[y.id]=y.serialize())}return l}_serializeLayers(l){const d=[];for(const y of l){const b=this._layers[y];b&&b.type!=="custom"&&d.push(b.serialize())}return d}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const d=this.getOwnLayer(l);if(d)return d;this.fire(new a.f(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const d=this.getOwnSource(l);if(d)return d;this.fire(new a.f(new Error(`The source '${l}' does not exist in the map's style.`)))}precompilePrograms(l,d){const y=this.map.painter;if(y)for(let b=l.minzoom||0;b<(l.maxzoom||25.5);b++){const T=l.getProgramIds();if(T)for(const S of T){const A=l.getDefaultProgramParams(S,d.zoom,this._styleColorTheme.lut);A&&(y.style=this,this.fog&&(y._fogVisible=!0,A.overrideFog=!0,y.getOrCreateProgram(S,A)),y._fogVisible=!1,A.overrideFog=!1,y.getOrCreateProgram(S,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,y.getOrCreateProgram(S,A)))}}}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const d=this.calculateLightsBrightness();l.brightness=d||0,d!==this._brightness&&(this._brightness=d,this.dispatcher.broadcast("setBrightness",d));const y=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const A in S){const{updatedIds:k,removedIds:L}=S[A];(k||L)&&(this._updateWorkerLayers(A,k,L),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const T={};for(const S in this._mergedSourceCaches){const A=this._mergedSourceCaches[S];T[S]=A.used,A.used=!1,A.tileCoverLift=0}for(const S of this._mergedOrder){const A=this._mergedLayers[S];if(A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)){const k=this.getLayerSourceCache(A);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,l)}):this.precompilePrograms(A,l))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();for(const S in T){const A=this._mergedSourceCaches[S];T[S]!==A.used&&A.getSource().fire(new a.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new a.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,d,y){const b=this.getFragmentStyle(l);b&&this.dispatcher.broadcast("updateLayers",{layers:d?b._serializeLayers(d):[],scope:l,removedIds:y||[],options:b.options})}setState(l,d){if(this._checkLoaded(),fa(this,ne(l)))return!1;(l=a.cW(l)).layers=xp(l.layers);const y=function(S,A){if(!S)return[{command:Cr.setStyle,args:[A]}];let k=[];try{if(!a.d(S.version,A.version))return[{command:Cr.setStyle,args:[A]}];if(a.d(S.center,A.center)||k.push({command:Cr.setCenter,args:[A.center]}),a.d(S.zoom,A.zoom)||k.push({command:Cr.setZoom,args:[A.zoom]}),a.d(S.bearing,A.bearing)||k.push({command:Cr.setBearing,args:[A.bearing]}),a.d(S.pitch,A.pitch)||k.push({command:Cr.setPitch,args:[A.pitch]}),a.d(S.sprite,A.sprite)||k.push({command:Cr.setSprite,args:[A.sprite]}),a.d(S.glyphs,A.glyphs)||k.push({command:Cr.setGlyphs,args:[A.glyphs]}),a.d(S.imports,A.imports)||function(Z=[],se=[],oe){se=se||[];const ae=(Z=Z||[]).map(Mg),ce=se.map(Mg),xe=Z.reduce(yc,{}),be=se.reduce(yc,{}),ve=ae.slice();let ke,Ce,Ae,Ne;for(ke=0,Ce=0;ke<ae.length;ke++)Ae=ae[ke],be.hasOwnProperty(Ae)?Ce++:(oe.push({command:Cr.removeImport,args:[Ae]}),ve.splice(ve.indexOf(Ae,Ce),1));for(ke=0,Ce=0;ke<ce.length;ke++)Ae=ce[ce.length-1-ke],ve[ve.length-1-ke]!==Ae&&(xe.hasOwnProperty(Ae)?(oe.push({command:Cr.removeImport,args:[Ae]}),ve.splice(ve.lastIndexOf(Ae,ve.length-Ce),1)):Ce++,Ne=ve[ve.length-ke],oe.push({command:Cr.addImport,args:[be[Ae],Ne]}),ve.splice(ve.length-ke,0,Ae));for(const Fe of se){const Ze=xe[Fe.id];Ze&&!a.d(Ze,Fe)&&oe.push({command:Cr.updateImport,args:[Fe.id,Fe]})}}(S.imports,A.imports,k),a.d(S.transition,A.transition)||k.push({command:Cr.setTransition,args:[A.transition]}),a.d(S.light,A.light)||k.push({command:Cr.setLight,args:[A.light]}),a.d(S.fog,A.fog)||k.push({command:Cr.setFog,args:[A.fog]}),a.d(S.projection,A.projection)||k.push({command:Cr.setProjection,args:[A.projection]}),a.d(S.lights,A.lights)||k.push({command:Cr.setLights,args:[A.lights]}),a.d(S.camera,A.camera)||k.push({command:Cr.setCamera,args:[A.camera]}),!a.d(S["color-theme"],A["color-theme"]))return[{command:Cr.setStyle,args:[A]}];const L={},B=[];(function(Z,se,oe,ae){let ce;for(ce in se=se||{},Z=Z||{})Z.hasOwnProperty(ce)&&(se.hasOwnProperty(ce)||Wb(ce,oe,ae));for(ce in se){if(!se.hasOwnProperty(ce))continue;const xe=se[ce];Z.hasOwnProperty(ce)?a.d(Z[ce],xe)||(Z[ce].type==="geojson"&&xe.type==="geojson"&&bp(Z,se,ce)?oe.push({command:Cr.setGeoJSONSourceData,args:[ce,xe.data]}):DA(ce,se,oe,ae)):Pd(ce,se,oe)}})(S.sources,A.sources,B,L);const U=[];S.layers&&S.layers.forEach(Z=>{Z.source&&L[Z.source]?k.push({command:Cr.removeLayer,args:[Z.id]}):U.push(Z)});let q=S.terrain;q&&L[q.source]&&(k.push({command:Cr.setTerrain,args:[void 0]}),q=void 0),k=k.concat(B),a.d(q,A.terrain)||k.push({command:Cr.setTerrain,args:[A.terrain]}),function(Z,se,oe){se=se||[];const ae=(Z=Z||[]).map(Mg),ce=se.map(Mg),xe=Z.reduce(yc,{}),be=se.reduce(yc,{}),ve=ae.slice(),ke=Object.create(null);let Ce,Ae,Ne,Fe,Ze,je,Me;for(Ce=0,Ae=0;Ce<ae.length;Ce++)Ne=ae[Ce],be.hasOwnProperty(Ne)?Ae++:(oe.push({command:Cr.removeLayer,args:[Ne]}),ve.splice(ve.indexOf(Ne,Ae),1));for(Ce=0,Ae=0;Ce<ce.length;Ce++)Ne=ce[ce.length-1-Ce],ve[ve.length-1-Ce]!==Ne&&(xe.hasOwnProperty(Ne)?(oe.push({command:Cr.removeLayer,args:[Ne]}),ve.splice(ve.lastIndexOf(Ne,ve.length-Ae),1)):Ae++,je=ve[ve.length-Ce],oe.push({command:Cr.addLayer,args:[be[Ne],je]}),ve.splice(ve.length-Ce,0,Ne),ke[Ne]=!0);for(Ce=0;Ce<ce.length;Ce++)if(Ne=ce[Ce],Fe=xe[Ne],Ze=be[Ne],!ke[Ne]&&!a.d(Fe,Ze))if(a.d(Fe.source,Ze.source)&&a.d(Fe["source-layer"],Ze["source-layer"])&&a.d(Fe.type,Ze.type)){for(Me in uu(Fe.layout,Ze.layout,oe,Ne,null,Cr.setLayoutProperty),uu(Fe.paint,Ze.paint,oe,Ne,null,Cr.setPaintProperty),a.d(Fe.slot,Ze.slot)||oe.push({command:Cr.setSlot,args:[Ne,Ze.slot]}),a.d(Fe.filter,Ze.filter)||oe.push({command:Cr.setFilter,args:[Ne,Ze.filter]}),a.d(Fe.minzoom,Ze.minzoom)&&a.d(Fe.maxzoom,Ze.maxzoom)||oe.push({command:Cr.setLayerZoomRange,args:[Ne,Ze.minzoom,Ze.maxzoom]}),Fe)Fe.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&Me!=="slot"&&(Me.indexOf("paint.")===0?uu(Fe[Me],Ze[Me],oe,Ne,Me.slice(6),Cr.setPaintProperty):a.d(Fe[Me],Ze[Me])||oe.push({command:Cr.setLayerProperty,args:[Ne,Me,Ze[Me]]}));for(Me in Ze)Ze.hasOwnProperty(Me)&&!Fe.hasOwnProperty(Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&Me!=="slot"&&(Me.indexOf("paint.")===0?uu(Fe[Me],Ze[Me],oe,Ne,Me.slice(6),Cr.setPaintProperty):a.d(Fe[Me],Ze[Me])||oe.push({command:Cr.setLayerProperty,args:[Ne,Me,Ze[Me]]}))}else oe.push({command:Cr.removeLayer,args:[Ne]}),je=ve[ve.lastIndexOf(Ne)+1],oe.push({command:Cr.addLayer,args:[Ze,je]})}(U,A.layers,k)}catch(L){console.warn("Unable to compute style diff:",L),k=[{command:Cr.setStyle,args:[A]}]}return k}(this.serialize(),l).filter(S=>!(S.command in Rd));if(y.length===0)return!1;const b=y.filter(S=>!(S.command in zg));if(b.length>0)throw new Error(`Unimplemented: ${b.map(S=>S.command).join(", ")}.`);const T=[];return y.forEach(S=>{T.push(this[S.command].apply(this,S.args))}),d&&Promise.all(T).then(d),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,d){return this.getImage(l)?this.fire(new a.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,d),this._afterImageUpdated(l),this)}updateImage(l,d){this.imageManager.updateImage(l,this.scope,d)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new a.f(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new a.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,d,y={}){return this._checkLoaded(),this._validate(Tt,`models.${l}`,d,null,y)||(this.modelManager.addModel(l,d,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new a.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,d,y={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(le,`sources.${l}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const b=ue(l,d,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const T=S=>{const A=(S?"symbol:":"other:")+b.id,k=a.am(A,this.scope),L=this._sourceCaches[A]=new a.bx(k,b,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=L,L.onAdd(this.map)};T(!1),d.type!=="vector"&&d.type!=="geojson"||T(!0),b.onAdd&&b.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const d=this.getOwnSource(l);if(!d)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(l);for(const b of y){const T=a.cX(b.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(b.id),b.fire(new a.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,d){this._checkLoaded(),this.getOwnSource(l).setData(d),this._changes.setDirty()}getOwnSource(l){const d=this.getOwnSourceCache(l);return d&&d.getSource()}getOwnSources(){const l=[];for(const d in this._otherSourceCaches){const y=this.getOwnSourceCache(d);y&&l.push(y.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const d in l){const y=l[d]._tiles;for(const b in y){const T=y[b];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const d=this._getTransitionParameters();for(const b of l){if(this._validate(Le,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(d)}else this.ambientLight=new sc(b,dd||(dd=new a.U({color:new a.W(a.N.properties_light_ambient.color),intensity:new a.W(a.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(d)}else this.directionalLight=new sc(b,fd||(fd=new a.U({direction:new a.a6(a.N.properties_light_directional.direction),color:new a.W(a.N.properties_light_directional.color),intensity:new a.W(a.N.properties_light_directional.intensity),"cast-shadows":new a.W(a.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new a.W(a.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=new a.Y(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,d=this.ambientLight;if(!l||!d)return;const y=U=>.2126*(U[0]<=.03928?U[0]/12.92:Math.pow((U[0]+.055)/1.055,2.4))+.7152*(U[1]<=.03928?U[1]/12.92:Math.pow((U[1]+.055)/1.055,2.4))+.0722*(U[2]<=.03928?U[2]/12.92:Math.pow((U[2]+.055)/1.055,2.4)),b=l.properties.get("color").toRenderColor(null).toArray01(),T=l.properties.get("intensity"),S=l.properties.get("direction"),A=1-a.ad(S.x,S.y,S.z)[2]/90,k=y(b)*T*A,L=d.properties.get("color").toRenderColor(null).toArray01(),B=d.properties.get("intensity");return(k+y(L)*B)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(a.cY(l)){const d=a.cZ(l),y=this.fragments.find(({id:T})=>T===d);if(!y)throw new Error(`Style import not found: ${l}`);const b=a.cX(l);return y.style.getFragmentStyle(b)}{const d=this.fragments.find(({id:y})=>y===l);if(!d)throw new Error(`Style import not found: ${l}`);return d.style}}getConfigProperty(l,d){const y=this.getFragmentStyle(l);if(!y)return null;const b=a.am(d,y.scope),T=y.options.get(b),S=T?T.value||T.default:null;return S?S.serialize():null}setConfigProperty(l,d,y){const b=this.getFragmentStyle(l);if(!b)return;const T=b.stylesheet.schema;if(!T||!T[d])return;const S=a.z(y);if(S.result!=="success")return void fa(this,S.value);const A=S.value.expression,k=a.am(d,b.scope),L=b.options.get(k);if(!L)return;let B;const{minValue:U,maxValue:q,stepValue:Z,type:se,values:oe}=T[d],ae=a.z(T[d].default);ae.result==="success"&&(B=ae.value.expression),B?(this.options.set(k,_t(de({},L),{value:A,default:B,minValue:U,maxValue:q,stepValue:Z,type:se,values:oe})),this.updateConfigDependencies(d)):this.fire(new a.f(new Error(`No schema defined for the config option "${d}" in the "${l}" fragment.`)))}getConfig(l){const d=this.getFragmentStyle(l);if(!d)return null;const y=d.stylesheet.schema;if(!y)return null;const b={};for(const T in y){const S=a.am(T,d.scope),A=d.options.get(S),k=A?A.value||A.default:null;b[T]=k?k.serialize():null}return b}setConfig(l,d){const y=this.getFragmentStyle(l);y&&(y.updateConfig(d,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){const d=this.getFragmentStyle(l);return d?d.stylesheet.schema:null}setSchema(l,d){const y=this.getFragmentStyle(l);y&&(y.stylesheet.schema=d,y.updateConfig(y._config,d),this.updateConfigDependencies())}updateConfig(l,d){if(this._config=l,l||d)if(d)for(const y in d){let b,T;const S=a.z(d[y].default);if(S.result==="success"&&(b=S.value.expression),l&&l[y]!==void 0){const q=a.z(l[y]);q.result==="success"&&(T=q.value.expression)}const{minValue:A,maxValue:k,stepValue:L,type:B,values:U}=d[y];if(b){const q=a.am(y,this.scope);this.options.set(q,{default:b,value:T,minValue:A,maxValue:k,stepValue:L,type:B,values:U})}else this.fire(new a.f(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new a.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(l){for(const d of this._configDependentLayers){const y=this.getLayer(d);if(y){if(l&&!y.configDependencies.has(l))continue;y.possiblyEvaluateVisibility(),this._updateLayer(y)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(d=>{if(d._styleColorTheme.colorTheme){const y=d._evaluateColorThemeData(d._styleColorTheme.colorTheme);(!d._styleColorTheme.lut&&y!==""||d._styleColorTheme.lut&&y!==d._styleColorTheme.lut.data)&&d.setColorTheme(d._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(l,d,y={}){this._checkLoaded();const b=l.id;if(this._layers[b])return void this.fire(new a.f(new Error(`Layer with id "${b}" already exists on this map`)));let T;if(l.type==="custom"){if(fa(this,a.c_(l)))return;T=a.c$(l,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof l.source=="object"&&(this.addSource(b,l.source),l=a.cW(l),l=a.Q(l,{source:b})),this._validate(st,`layers.${b}`,l,{arrayIndex:-1},y))return;T=a.c$(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[T.id]=T.serialize()}T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid);let S=this._order.length;if(d){const B=this._order.indexOf(d);if(B===-1)return void this.fire(new a.f(new Error(`Layer with id "${d}" does not exist on this map.`)));T.slot===this._layers[d].slot?S=B:a.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,b),this._layerOrderChanged=!0,this._layers[b]=T;const A=this.getOwnLayerSourceCache(T),k=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&T.canCastShadows()&&k&&(A.castsShadows=!0);const L=this._changes.getRemovedLayer(T);if(L&&T.source&&A&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const B=a.am(T.source,T.scope);L.type!==T.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),A.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(l,d){this._checkLoaded();const y=this._checkLayer(l);if(!y||l===d)return;const b=this._order.indexOf(l);this._order.splice(b,1);let T=this._order.length;if(d){const S=this._order.indexOf(d);if(S===-1)return void this.fire(new a.f(new Error(`Layer with id "${d}" does not exist on this map.`)));y.slot===this._layers[d].slot?T=S:a.w(`Layer with id "${d}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const d=this._checkLayer(l);if(!d)return;d.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(d.fqid),this._changes.removeLayer(d);const b=this.getOwnLayerSourceCache(d);if(b&&b.castsShadows){let T=!1;for(const S in this._layers)if(this._layers[S].source===d.source&&this._layers[S].canCastShadows()){T=!0;break}b.castsShadows=T}d.onRemove&&d.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const d in this._layers)if(this._layers[d].type===l)return!0;return!1}setLayerZoomRange(l,d,y){this._checkLoaded();const b=this._checkLayer(l);b&&(b.minzoom===d&&b.maxzoom===y||(d!=null&&(b.minzoom=d),y!=null&&(b.maxzoom=y),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,d){this._checkLoaded();const y=this._checkLayer(l);y&&y.slot!==d&&(y.slot=d,this._updateLayer(y))}setFilter(l,d,y={}){this._checkLoaded();const b=this._checkLayer(l);if(b&&!a.d(b.filter,d))return d==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(We,`layers.${b.id}.filter`,d,{layerType:b.type},y)||(b.filter=a.cW(d),this._updateLayer(b)))}getFilter(l){const d=this._checkLayer(l);if(d)return a.cW(d.filter)}setLayoutProperty(l,d,y,b={}){this._checkLoaded();const T=this._checkLayer(l);if(T&&!a.d(T.getLayoutProperty(d),y)){if(y!=null&&(!b||b.validate!==!1)&&fa(T,wt.call(ne,{key:`layers.${l}.layout.${d}`,layerType:T.type,objectKey:d,value:y,styleSpec:a.N,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(d,y),T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),this._updateLayer(T)}}getLayoutProperty(l,d){const y=this._checkLayer(l);if(y)return y.getLayoutProperty(d)}setPaintProperty(l,d,y,b={}){this._checkLoaded();const T=this._checkLayer(l);if(!T||a.d(T.getPaintProperty(d),y)||y!=null&&(!b||b.validate!==!1)&&fa(T,rt.call(ne,{key:`layers.${l}.paint.${d}`,layerType:T.type,objectKey:d,value:y,styleSpec:a.N})))return;const S=T.setPaintProperty(d,y);T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),S&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(l,d){const y=this._checkLayer(l);if(y)return y.getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const y=l.source,b=l.sourceLayer,T=this._checkSource(y);if(!T)return;const S=T.type;if(S==="geojson"&&b)return void this.fire(new a.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!b)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(y);for(const k of A)k.setFeatureState(b,l.id,d)}removeFeatureState(l,d){this._checkLoaded();const y=l.source,b=this._checkSource(y);if(!b)return;const T=b.type,S=T==="vector"?l.sourceLayer:void 0;if(T==="vector"&&!S)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new a.f(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(y);for(const k of A)k.removeFeatureState(S,l.id,d)}getFeatureState(l){this._checkLoaded();const d=l.source,y=l.sourceLayer,b=this._checkSource(d);if(b){if(b.type!=="vector"||y)return l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(d)[0].getFeatureState(y,l.id);this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=a.Q({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return a.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),d=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return a.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:d,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateLayer(l){this._changes.updateLayer(l);const d=this.getLayerSourceCache(l),y=a.am(l.source,l.scope),b=this._changes.getUpdatedSourceCaches();l.source&&!b[y]&&d&&d.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),d.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const d=A=>this._mergedLayers[A].type==="fill-extrusion"||this._mergedLayers[A].type==="model",y=this.order,b={},T=[];for(let A=y.length-1;A>=0;A--){const k=y[A];if(d(k)){b[k]=A;for(const L of l){const B=L[k];if(B)for(const U of B)T.push(U)}}}T.sort((A,k)=>k.intersectionZ-A.intersectionZ);const S=[];for(let A=y.length-1;A>=0;A--){const k=y[A];if(d(k))for(let L=T.length-1;L>=0;L--){const B=T[L].feature;if(B.layer&&b[B.layer.id]<A)break;S.push(B),T.pop()}else for(const L of l){const B=L[k];if(B)for(const U of B)S.push(U.feature)}}return S}queryRenderedFeatures(l,d,y){d&&d.filter&&this._validate(We,"queryRenderedFeatures.filter",d.filter,null,d),d.scope=this.scope,d.availableImages=this._availableImages,d.serializedLayers=this._serializedLayers;const b={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new a.f(new Error("parameters.layers must be an Array."))),[];for(const L of d.layers){const B=this._mergedLayers[L];if(!B)return this.fire(new a.f(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const T=[],S=d.serializedLayers||{},A=d&&d.layers?d.layers.some(L=>{const B=this.getLayer(L);return B&&B.is3D()}):this.has3DLayers(),k=ha.createFromScreenPoints(l,y);for(const L in this._mergedSourceCaches){const B=this._mergedSourceCaches[L].getSource();if(!B||B.scope!==d.scope)continue;const U=this._mergedSourceCaches[L].getSource().id;d.layers&&!b[U]||T.push(_c(this._mergedSourceCaches[L],this._mergedLayers,S,k,d,y,A,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(L,B,U,q,Z,se,oe){const ae={},ce=se.queryRenderedSymbols(q),xe=[];for(const be of Object.keys(ce).map(Number))xe.push(oe[be]);xe.sort(k0);for(const be of xe){const ve=be.featureIndex.lookupSymbolFeatures(ce[be.bucketInstanceId],B,be.bucketIndex,be.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,L);for(const ke in ve){const Ce=ae[ke]=ae[ke]||[],Ae=ve[ke];Ae.sort((Ne,Fe)=>{const Ze=be.featureSortOrder;if(Ze){const je=Ze.indexOf(Ne.featureIndex);return Ze.indexOf(Fe.featureIndex)-je}return Fe.featureIndex-Ne.featureIndex});for(const Ne of Ae)Ce.push(Ne)}}for(const be in ae)ae[be].forEach(ve=>{const ke=ve.feature,Ce=U(L[be]);if(!Ce)return;const Ae=Ce.getFeatureState(ke.layer["source-layer"],ke.id);ke.source=ke.layer.source,ke.layer["source-layer"]&&(ke.sourceLayer=ke.layer["source-layer"]),ke.state=Ae});return ae}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),k.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(l,d){d&&d.filter&&this._validate(We,"querySourceFeatures.filter",d.filter,null,d);const y=this.getOwnSourceCaches(l);let b=[];for(const T of y)b=b.concat(MA(T,d));return b}addSourceType(l,d,y){return pa.getSourceType(l)?y(new Error(`A source type called "${l}" already exists.`)):(pa.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,d,y={}){this._checkLoaded();const b=this.light.getLight();let T=!1;for(const A in l)if(!a.d(l[A],b[A])){T=!0;break}if(!T)return;const S=this._getTransitionParameters();this.light.setLight(l,d,y),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,d=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),d===0&&delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=l;const b=l.source==null;if(d===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const A="terrain-dem-src";this.addSource(A,y.source),y=a.cW(y),y=a.Q(y,{source:A})}const T=a.Q({},y),S={};if(this.terrain&&b){T.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(S.style=A.serialize())}if(this._validate(Oe,"terrain",T,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&d!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,d),this.fire(new a.g("data",{dataType:"style"}))}else{const T=this.terrain,S=T.get();for(const A of Object.keys(a.N.terrain))!y.hasOwnProperty(A)&&a.N.terrain[A].default&&(y[A]=a.N.terrain[A].default);for(const A in l)if(!a.d(l[A],S[A])){T.set(l,this.options),this.stylesheet.terrain=l;const k=this._getTransitionParameters({duration:0});T.updateTransitions(k),this.fire(new a.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const d=this.fog=new Qs(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog;if(!a.d(d.get(),l)){d.set(l,this.options),this.stylesheet.fog=d.get();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}}else this._createFog(l);this._markersNeedUpdate=!0}setColorTheme(l){this._checkLoaded();const d=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()};if(this._styleColorTheme.colorTheme=l,!l)return this._styleColorTheme.lut=null,void d();const y=this._evaluateColorThemeData(l);this._loadColorTheme(y).then(()=>{this.fire(new a.g("colorthemeset")),d()}).catch(b=>{a.w(`Couldn't set color theme: ${b}`)})}_getTransitionParameters(l){return{now:a.e.now(),transition:a.Q(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],d=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?l.push(y):d.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...d)}_createTerrain(l,d){const y=this.terrain=new hr(l,d,this.scope,this.options);d===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});y.updateTransitions(b)}_force3DLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const d=this._layers[l];d.type==="symbol"&&this._updateLayer(d)}}_validate(l,d,y,b,T={}){if(T&&T.validate===!1)return!1;const S=a.Q({},this.serialize());return fa(this,l.call(ne,a.Q({key:d,style:S,value:y,styleSpec:a.N},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const d=this.getSourceCaches(l);for(const y of d)y.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const d=this.getSourceCaches(l);for(const y of d)y.resume(),y.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let d;this.directionalLight&&(d=$o(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(l,void 0,void 0,d)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const d=this._sourceCaches[l];d.resume(),d.reload()}}_updatePlacement(l,d,y,b,T,S,A=!1){let k=!1,L=!1;const B={},U={};for(const q of this._mergedOrder){const Z=this._mergedLayers[q];if(Z.type!=="symbol")continue;const se=a.am(Z.source,Z.scope);let oe=B[se];if(!oe){const ce=this.getLayerSourceCache(Z);if(!ce)continue;const xe=ce.getRenderableIds(!0).map(be=>ce.getTileByID(be));U[se]=xe.slice(),oe=B[se]=xe.sort((be,ve)=>ve.tileID.overscaledZ-be.tileID.overscaledZ||(be.tileID.isLessThan(ve.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(Z,oe,d.center.lng,d.projection);k=k||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||b===0,this._layerOrderChanged&&this.fire(new a.g("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.e.now(),d.zoom))&&(this.pauseablePlacement=new ew(d,this._mergedOrder,A,y,b,T,this.placement,this.fog&&d.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,U),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.e.now()),L=!0),k&&this.pauseablePlacement.placement.setStale()),L||k){this._buildingIndex.onNewFrame(d.zoom);for(let q=0;q<this._mergedOrder.length;q++){const Z=this._mergedLayers[this._mergedOrder[q]];if(Z.type!=="symbol")continue;const se=this.isLayerClipped(Z)&&this._clipLayerIndices.some(oe=>q<oe);this.placement.updateLayerOpacities(Z,B[a.am(Z.source,Z.scope)],q,se?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.e.now())}}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,d){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:T})=>T===l.id)!==-1)return void this.fire(new a.f(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!d)return y.push(l),this._loadImports([l],!0);const b=y.findIndex(({id:T})=>T===d);return b===-1&&this.fire(new a.f(new Error(`Import with id "${d}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,b).concat(l).concat(y.slice(b)),this._loadImports([l],!0,d)}updateImport(l,d){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);return b===-1?this:typeof d=="string"?(this.setImportUrl(l,d),this):(d.url&&d.url!==y[b].url&&this.setImportUrl(l,d.url),a.d(d.config,y[b].config)||this.setImportConfig(l,d.config),a.d(d.data,y[b].data)||this.setImportData(l,d.data),this)}moveImport(l,d){this._checkLoaded();let y=this.stylesheet.imports||[];const b=this.getImportIndex(l);if(b===-1)return this;const T=this.getImportIndex(d);if(T===-1)return this;const S=y[b],A=this.fragments[b];return y=y.filter(({id:k})=>k!==l),this.fragments=this.fragments.filter(({id:k})=>k!==l),this.stylesheet.imports=y.slice(0,T).concat(S).concat(y.slice(T)),this.fragments=this.fragments.slice(0,T).concat(A).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(l,d){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);if(b===-1)return this;y[b].url=d;const T=this.fragments[b];return T.style=this._createFragmentStyle(y[b]),T.style.on("style.import.load",()=>this.mergeAll()),T.style.loadURL(d),this}setImportData(l,d){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];return y===-1?this:d?(this.fragments[y].style.setState(d),this._reloadImports(),this):(delete b[y].data,this.setImportUrl(l,b[y].url))}setImportConfig(l,d){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];if(y===-1)return this;d?b[y].config=d:delete b[y].config;const T=this.fragments[y],S=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=d,T.style.updateConfig(d,S),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(l);y!==-1&&(d.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(l){const d=(this.stylesheet.imports||[]).findIndex(y=>y.id===l);return d===-1&&this.fire(new a.f(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),d}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const d in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[d];y&&l.push(y.getSource())}return l}getSource(l,d){const y=this.getSourceCache(l,d);return y&&y.getSource()}getLayerSource(l){const d=this.getLayerSourceCache(l);return d&&d.getSource()}getSourceCache(l,d){const y=a.am(l,d);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(l){const d=a.am(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[d]:this._mergedOtherSourceCaches[d]}getSourceCaches(l){if(l==null)return Object.values(this._mergedSourceCaches);const d=[];return this._mergedOtherSourceCaches[l]&&d.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&d.push(this._mergedSymbolSourceCaches[l]),d}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const d in l){const y=l[d];y==="reload"?this.reloadSource(d):y==="clear"&&this.clearSource(d)}}updateLayers(l){const d=this._changes.getUpdatedPaintProperties();for(const y of d){const b=this.getLayer(y);b&&b.updateTransitions(l)}}getImages(l,d,y){this.imageManager.getImages(d.icons,d.scope,y),this._updateTilesForChangedImages();const b=T=>{T&&T.setDependencies(d.tileID.key,d.type,d.icons)};b(this._otherSourceCaches[d.source]),b(this._symbolSourceCaches[d.source])}getGlyphs(l,d,y){this.glyphManager.getGlyphs(d.stacks,d.scope,y)}getResource(l,d,y){return a.d2(d,y)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const d=[];return this._otherSourceCaches[l]&&d.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&d.push(this._symbolSourceCaches[l]),d}_isSourceCacheLoaded(l){const d=this.getOwnSourceCaches(l);return d.length===0?(this.fire(new a.f(new Error(`There is no source with ID '${l}'`))),!1):d.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,d){if(this._clipLayerIndices.length===0&&l.type!=="fill-extrusion")return!1;const y=l.type==="fill-extrusion"&&l.sourceLayer==="building";let b=0;if(l.is3D()){if(y||d&&d.type==="batched-model")return!0;l.type==="model"&&(b=a.cw.Model)}else l.type==="symbol"&&(b=a.cw.Symbol);for(const T of this._clipLayerIndices){const S=this._mergedLayers[this._mergedOrder[T]];if(!S)continue;const A=[];for(const k of S.layout.get("clip-layer-types"))A.push(k==="model"?a.cw.Model:k==="symbol"?a.cw.Symbol:a.cw.FillExtrusion);for(const k of A)if(b&k)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function iw(g,l){let d=!1,y=null;const b=()=>{y=null,d&&(g(),y=setTimeout(b,l),d=!1)};return()=>(d=!0,y||b(),y)}pa.getSourceType=function(g){return K[g]},pa.setSourceType=function(g,l){K[g]=l},pa.registerForPluginStateChange=a.cO;class sw{constructor(l){this._hashName=l&&encodeURIComponent(l),a.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=iw(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const d=F0(l);if(this._hashName){const y=this._hashName;let b=!1;const T=location.hash.slice(1).split("&").map(S=>{const A=S.split("=")[0];return A===y?(b=!0,`${A}=${d}`):S}).filter(S=>S);return b||T.push(`${y}=${d}`),`#${T.join("&")}`}return`#${d}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(d=y)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(d[3]||0):l.getBearing();return l.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function F0(g,l){const d=g.getCenter(),y=Math.round(100*g.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),S=Math.round(d.lng*T)/T,A=Math.round(d.lat*T)/T,k=g.getBearing(),L=g.getPitch();let B=l?`/${S}/${A}/${y}`:`${y}/${A}/${S}`;return(k||L)&&(B+="/"+Math.round(10*k)/10),L&&(B+=`/${Math.round(L)}`),B}const Md={linearity:.3,easing:a.d3(0,0,.3,1)},zA=a.Q({deceleration:2500,maxSpeed:1400},Md),NA=a.Q({deceleration:20,maxSpeed:1400},Md),FA=a.Q({deceleration:1e3,maxSpeed:360},Md),BA=a.Q({deceleration:1e3,maxSpeed:90},Md);class ow{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.e.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=a.e.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(d.pan.mag()){const T=fh(d.pan.mag(),y,a.Q({},zA,l||{}));b.offset=d.pan.mult(T.amount/d.pan.mag()),b.center=this._map.transform.center,Ng(b,T)}if(d.zoom){const T=fh(d.zoom,y,NA);b.zoom=this._map.transform.zoom+T.amount,Ng(b,T)}if(d.bearing){const T=fh(d.bearing,y,FA);b.bearing=this._map.transform.bearing+a.au(T.amount,-179,179),Ng(b,T)}if(d.pitch){const T=fh(d.pitch,y,BA);b.pitch=this._map.transform.pitch+T.amount,Ng(b,T)}if(b.zoom||b.bearing){const T=d.pinchAround===void 0?d.around:d.pinchAround;b.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Ng(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function fh(g,l,d){const{maxSpeed:y,linearity:b,deceleration:T}=d,S=a.au(g*b/(l/1e3),-y,y),A=Math.abs(S)/(T*b);return{easing:d.easing,duration:1e3*A,amount:S*(A/2)}}class ma extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y,b={}){const T=ye(d.getCanvasContainer(),y),S=d.unproject(T);super(l,a.Q({point:T,lngLat:S,originalEvent:y},b)),this._defaultPrevented=!1,this.target=d}}class Cp extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,y){const b=l==="touchend"?y.changedTouches:y.touches,T=Ee(d.getCanvasContainer(),b),S=T.map(k=>d.unproject(k)),A=T.reduce((k,L,B,U)=>k.add(L.div(U.length)),new a.P(0,0));super(l,{points:T,point:A,lngLats:S,lngLat:d.unproject(A),originalEvent:y}),this._defaultPrevented=!1}}class B0 extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d){super("wheel",{originalEvent:d}),this._defaultPrevented=!1}}class Fg{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new B0(this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new ma(l.type,this._map,l))}mouseup(l){this._map.fire(new ma(l.type,this._map,l))}preclick(l){const d=a.Q({},l);d.type="preclick",this._map.fire(new ma(d.type,this._map,d))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(l),this._map.fire(new ma(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new ma(l.type,this._map,l))}mouseover(l){this._map.fire(new ma(l.type,this._map,l))}mouseout(l){this._map.fire(new ma(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Cp(l.type,this._map,l))}touchmove(l){this._map.fire(new Cp(l.type,this._map,l))}touchend(l){this._map.fire(new Cp(l.type,this._map,l))}touchcancel(l){this._map.fire(new Cp(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class j0{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new ma(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ma("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ma(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ph{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(W(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const y=d,b=this._startPos,T=this._lastPos;if(!b||!T||T.equals(y)||!this._box&&y.dist(b)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=F("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const S=Math.min(b.x,y.x),A=Math.max(b.x,y.x),k=Math.min(b.y,y.y),L=Math.max(b.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${k}px)`,this._box.style.width=A-S+"px",this._box.style.height=L-k+"px")})}mouseupWindow(l,d){if(!this._active)return;const y=this._startPos,b=d;if(y&&l.button===0){if(this.reset(),fe(),y.x!==b.x||y.y!==b.y)return this._map.fire(new a.g("boxzoomend",{originalEvent:l})),{cameraAnimation:T=>T.fitScreenCoordinates(y,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),X(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new a.g(l,{originalEvent:d}))}}function Ap(g,l){const d={};for(let y=0;y<g.length;y++)d[g[y].identifier]=l[y];return d}class aw{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const T=new a.P(0,0);for(const S of b)T._add(S);return T.div(b.length)}(d),this.touches=Ap(y,d)))}touchmove(l,d,y){if(this.aborted||!this.centroid)return;const b=Ap(y,d);for(const T in this.touches){const S=b[T];(!S||S.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(l,d,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class du{constructor(l){this.singleTap=new aw(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,d,y){this.singleTap.touchstart(l,d,y)}touchmove(l,d,y){this.singleTap.touchmove(l,d,y)}touchend(l,d,y){const b=this.singleTap.touchend(l,d,y);if(b){const T=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(b)<30;if(T&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Pp{constructor(){this._zoomIn=new du({numTouches:1,numTaps:2}),this._zoomOut=new du({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,y){this._zoomIn.touchstart(l,d,y),this._zoomOut.touchstart(l,d,y)}touchmove(l,d,y){this._zoomIn.touchmove(l,d,y),this._zoomOut.touchmove(l,d,y)}touchend(l,d,y){const b=this._zoomIn.touchend(l,d,y),T=this._zoomOut.touchend(l,d,y);return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(b)},{originalEvent:l})}):T?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(T)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Bg={0:1,2:2};class Rp{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;const y=re(l);this._correctButton(l,y)&&(this._lastPoint=d,this._eventButton=y)}mousemoveWindow(l,d){const y=this._lastPoint;if(y){if(l.preventDefault(),this._eventButton!=null&&function(b,T){const S=Bg[T];return b.buttons===void 0||(b.buttons&S)!==S}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(y,d)}}mouseupWindow(l){this._lastPoint&&re(l)===this._eventButton&&(this._moved&&fe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mp extends Rp{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return d===0&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class kp extends Rp{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const y=.8*(d.x-l.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(l){l.preventDefault()}}class jg extends Rp{_correctButton(l,d){return d===0&&l.ctrlKey||d===2}_move(l,d){const y=-.5*(d.y-l.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(l){l.preventDefault()}}class lw{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),a.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(l,d,y){return this._calculateTransform(l,d,y)}touchmove(l,d,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!a.d4())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,d,y)}}touchend(l,d,y){this._calculateTransform(l,d,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,y){y.length>0&&(this._active=!0);const b=Ap(y,d),T=new a.P(0,0),S=new a.P(0,0);let A=0;for(const L in b){const B=b[L],U=this._touches[L];U&&(T._add(B),S._add(B.sub(U)),A++,b[L]=B)}if(this._touches=b,A<this._minTouches||!S.mag())return;const k=S.div(A);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(A),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Dp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,d,y){return{}}touchstart(l,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,y){const b=this._firstTwoTouches;if(!b)return;l.preventDefault();const[T,S]=b,A=mh(y,d,T),k=mh(y,d,S);if(!A||!k)return;const L=this._aroundCenter?null:A.add(k).div(2);return this._move([A,k],L,l)}touchend(l,d,y){if(!this._firstTwoTouches)return;const[b,T]=this._firstTwoTouches,S=mh(y,d,b),A=mh(y,d,T);S&&A||(this._active&&fe(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function mh(g,l,d){for(let y=0;y<g.length;y++)if(g[y].identifier===d)return l[y]}function kd(g,l){return Math.log(g/l)/Math.LN2}class cw extends Dp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(kd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:kd(this._distance,y),pinchAround:d}}}function U0(g,l){return 180*g.angleWith(l)/Math.PI}class uw extends Dp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){const y=this._vector;if(this._vector=l[0].sub(l[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:U0(this._vector,y),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const b=U0(l,y);return Math.abs(b)<d}}function fu(g){return Math.abs(g.y)>Math.abs(g.x)}class hw extends Dp{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,fu(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,y){const b=this._lastPoints;if(!b)return;const T=l[0].sub(b[0]),S=l[1].sub(b[1]);return this._map._cooperativeGestures&&!a.d4()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(T,S,y.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(T.y+S.y)/2*-.5})}gestureBeginsVertically(l,d,y){if(this._valid!==void 0)return this._valid;const b=l.mag()>=2,T=d.mag()>=2;if(!b&&!T)return;if(!b||!T)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const S=l.y>0==d.y>0;return fu(l)&&fu(d)&&S}}const jA={panStep:100,bearingStep:15,pitchStep:10};class UA{constructor(){const l=jA;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,y=0,b=0,T=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),T=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),T=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:A=>{const k=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:VA,zoom:d?Math.round(k)+d*(l.shiftKey?2:1):k,bearing:A.getBearing()+y*this._bearingStep,pitch:A.getPitch()+b*this._pitchStep,offset:[-T*this._panStep,-S*this._panStep],center:A.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function VA(g){return g*(2-g)}const Ug=4.000244140625,V0=1/450;class $0{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=V0,a.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||a.d4()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=a.e.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%Ug==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=d,this._timeout=window.setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=ye(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>Ug?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&B!==0&&(B=1/B);const U=d(),q=Math.pow(2,U),Z=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):q;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(Z*B))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:d(),b=this._startZoom,T=this._easing;let S,A=!1;if(this._type==="wheel"&&b&&T){const L=Math.min((a.e.now()-this._lastWheelEventTime)/200,1),B=T(L);S=a.a3(b,y,B),L<1?this._frameId||(this._frameId=!0):A=!0}else S=y,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let k=S-d();return k*this._lastDelta<0&&(k=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:k,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=a.d5;if(this._prevEase){const y=this._prevEase,b=(a.e.now()-y.start)/y.duration,T=y.easing(b+.01)-y.easing(b),S=.27/Math.sqrt(T*T+1e-4)*.01,A=Math.sqrt(.0729-S*S);d=a.d3(S,A,.25,1)}return this._prevEase={start:a.e.now(),duration:l,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=F("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class q0{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dw{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,d){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(l.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fw{constructor(){this._tap=new du({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,d,y){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=d[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(l,d,y))}touchmove(l,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=d[0],T=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(l,d,y)}touchend(l,d,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(l,d,y)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $A{constructor(l,d,y){this._el=l,this._mousePan=d,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Op{constructor(l,d,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Lp{constructor(l,d,y,b){this._el=l,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const zp=g=>g.zoom||g.drag||g.pitch||g.rotate;class ga extends a.g{}class G0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,d){const y=a.$.sub([],d,l);this.radius=a.$.length(y[2]<0?a.$.div([],y,this.constants):[y[0],y[1],0])}projectRay(l){a.$.div(l,l,this.constants),a.$.normalize(l,l),a.$.mul(l,l,this.constants);const d=a.$.scale([],l,this.radius);if(d[2]>0){const y=a.$.scale([],[0,0,1],a.$.dot(d,[0,0,1])),b=a.$.scale([],a.$.normalize([],[d[0],d[1],0]),this.radius),T=a.$.add([],d,a.$.scale([],a.$.sub([],a.$.add([],b,y),d),2));d[0]=T[0],d[1]=T[1]}return d}}function gh(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Vg{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ow(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new G0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),a.br(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,T,S]of this._listeners){const A=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(T,A,S)}}destroy(){for(const[l,d,y]of this._listeners){const b=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(d,b,y)}}_addDefaultHandlers(l){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new Fg(d,l));const b=d.boxZoom=new ph(d,l);this._add("boxZoom",b);const T=new Pp,S=new dw;d.doubleClickZoom=new q0(S,T),this._add("tapZoom",T),this._add("clickZoom",S);const A=new fw;this._add("tapDragZoom",A);const k=d.touchPitch=new hw(d);this._add("touchPitch",k);const L=new kp(l),B=new jg(l);d.dragRotate=new Op(l,L,B),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const U=new Mp(l),q=new lw(d,l);d.dragPan=new $A(y,U,q),this._add("mousePan",U),this._add("touchPan",q,["touchZoom","touchRotate"]);const Z=new uw,se=new cw;d.touchZoomRotate=new Lp(y,se,Z,A),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new j0(d));const oe=d.scrollZoom=new $0(d,this);this._add("scrollZoom",oe,["mousePan"]);const ae=d.keyboard=new UA;this._add("keyboard",ae);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ce]&&d[ce].enable(l[ce])}_add(l,d,y){this._handlers.push({handlerName:l,handler:d,allowed:y}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,d,y){for(const b in l)if(b!==y&&(!d||d.indexOf(b)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const d=[];for(const y of l)this._el.contains(y.target)&&d.push(y);return d}handleEvent(l,d){this._updatingCamera=!0;const y=l.type==="renderFrame",b=y?void 0:l,T={needsRenderFrame:!1},S={},A={},k=l.touches?this._getMapTouches(l.touches):void 0,L=k?Ee(this._el,k):y?void 0:ye(this._el,l);for(const{handlerName:q,handler:Z,allowed:se}of this._handlers){if(!Z.isEnabled())continue;let oe;this._blockedByActive(A,se,q)?Z.reset():Z[d||l.type]&&(oe=Z[d||l.type](l,L,k),this.mergeHandlerResult(T,S,oe,q,b),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||Z.isActive())&&(A[q]=Z)}const B={};for(const q in this._previousActiveHandlers)A[q]||(B[q]=b);this._previousActiveHandlers=A,(Object.keys(B).length||gh(T))&&(this._changes.push([T,S,B]),this._triggerRenderFrame()),(Object.keys(A).length||gh(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=T;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(l,d,y,b,T){if(!y)return;a.Q(l,y);const S={handlerName:b,originalEvent:y.originalEvent||T};y.zoomDelta!==void 0&&(d.zoom=S),y.panDelta!==void 0&&(d.drag=S),y.pitchDelta!==void 0&&(d.pitch=S),y.bearingDelta!==void 0&&(d.rotate=S)}_applyChanges(){const l={},d={},y={};for(const[b,T,S]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(l.around=b.around),b.aroundCoord!==void 0&&(l.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),a.Q(d,T),a.Q(y,S);this._updateMapTransform(l,d,y),this._changes=[]}_updateMapTransform(l,d,y){const b=this._map,T=b.transform,S=xe=>[xe.x,xe.y,xe.z];if((xe=>{const be=this._eventsInProgress.drag;return be&&!this._handlersById[be.handlerName].isActive()})()&&!gh(l)){const xe=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),xe!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&b._stop(!0),!gh(l))return void this._fireEvents(d,y,!0);let{panDelta:A,zoomDelta:k,bearingDelta:L,pitchDelta:B,around:U,aroundCoord:q,pinchAround:Z}=l;T._isCameraConstrained&&(k>0&&(k=0),T._isCameraConstrained=!1),Z!==void 0&&(U=Z),(k||(xe=>d[xe]&&!this._eventsInProgress[xe])("drag"))&&U&&(this._dragOrigin=S(T.pointCoordinate3D(U)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",b._stop(!0),U=U||b.transform.centerPoint,L&&(T.bearing+=L),B&&(T.pitch+=B),T._updateCameraState();const se=[0,0,0];if(A)if(T.projection.name==="mercator"){const xe=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(U).dir),be=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(U.sub(A)).dir);se[0]=be[0]-xe[0],se[1]=be[1]-xe[1]}else{const xe=T.pointCoordinate(U);if(T.projection.name==="globe"){A=A.rotate(-T.angle);const be=T._pixelsPerMercatorPixel/T.worldSize;se[0]=-A.x*a.d6(a.az(xe.y))*be,se[1]=-A.y*a.d6(T.center.lat)*be}else{const be=T.pointCoordinate(U.sub(A));xe&&be&&(se[0]=be.x-xe.x,se[1]=be.y-xe.y)}}const oe=T.zoom,ae=[0,0,0];if(k){const xe=S(q||T.pointCoordinate3D(U)),be={dir:a.$.normalize([],a.$.sub([],xe,T._camera.position))};if(be.dir[2]<0){const ve=T.zoomDeltaToMovement(xe,k);a.$.scale(ae,be.dir,ve)}}const ce=a.$.add(se,se,ae);T._translateCameraConstrained(ce),k&&Math.abs(T.zoom-oe)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,y,!0)}_fireEvents(l,d,y){const b=zp(this._eventsInProgress),T=zp(l),S={};for(const B in l){const{originalEvent:U}=l[B];this._eventsInProgress[B]||(S[`${B}start`]=U),this._eventsInProgress[B]=l[B]}!b&&T&&this._fireEvent("movestart",T.originalEvent);for(const B in S)this._fireEvent(B,S[B]);T&&this._fireEvent("move",T.originalEvent);for(const B in l){const{originalEvent:U}=l[B];this._fireEvent(B,U)}const A={};let k;for(const B in this._eventsInProgress){const{handlerName:U,originalEvent:q}=this._eventsInProgress[B];this._handlersById[U].isActive()||(delete this._eventsInProgress[B],k=d[U]||q,A[`${B}end`]=k)}for(const B in A)this._fireEvent(B,A[B]);const L=zp(this._eventsInProgress);if(y&&(b||T)&&!L){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;B?(U(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:k})):(this._map.fire(new a.g("moveend",{originalEvent:k})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new a.g(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new ga("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const $g="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class W0 extends a.E{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=d.respectPrefersReducedMotion!==!1,a.br(["_renderFrameCallback"],this)}getCenter(){return new a.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,y){return l=a.P.convert(l).mult(-1),this.panTo(this.transform.center,a.Q({offset:l},d),y)}panTo(l,d,y){return this.easeTo(a.Q({center:l},d),y)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,y){return this.easeTo(a.Q({zoom:l},d),y)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,y){return this.easeTo(a.Q({bearing:l},d),y)}resetNorth(l,d){return this.rotateTo(0,a.Q({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(a.Q({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=a.aj.convert(l);const y=d&&d.bearing||0,b=d&&d.pitch||0,T=l.getNorthWest(),S=l.getSouthEast();return this._cameraForBounds(this.transform,T,S,y,b,d)}_extendPadding(l){const d={top:0,right:0,bottom:0,left:0};return l==null?a.Q({},d,this.transform.padding):typeof l=="number"?{top:l,bottom:l,right:l,left:l}:a.Q({},d,l)}_extendCameraOptions(l){return(l=a.Q({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,d){const y=d.max[0]-d.min[0],b=d.max[1]-d.min[1];return y/b>l.aspect?y/(2*Math.tan(.5*l.fovX)*l.aspect):b/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,d,y,b,T,S){const A=l.clone(),k=this._extendCameraOptions(S);A.bearing=b,A.pitch=T;const L=a.aJ.convert(d),B=a.aJ.convert(y),U=.5*(L.lat+B.lat),q=.5*(L.lng+B.lng),Z=a.d7(U,q),se=a.$.normalize([],Z),oe=a.$.normalize([],a.$.cross([],se,[0,1,0])),ae=a.$.cross([],oe,se),ce=[oe[0],oe[1],oe[2],0,ae[0],ae[1],ae[2],0,se[0],se[1],se[2],0,0,0,0,1],xe=[Z,a.d7(L.lat,L.lng),a.d7(B.lat,L.lng),a.d7(B.lat,B.lng),a.d7(L.lat,B.lng),a.d7(U,L.lng),a.d7(U,B.lng),a.d7(L.lat,q),a.d7(B.lat,q)];let be=a.b8.fromPoints(xe.map($e=>[a.$.dot(oe,$e),a.$.dot(ae,$e),a.$.dot(se,$e)]));const ve=a.$.transformMat4([],be.center,ce);a.$.squaredLength(ve)===0&&a.$.set(ve,0,0,1),a.$.normalize(ve,ve),a.$.scale(ve,ve,a.cF),A.center=a.d8(ve);const ke=A.getWorldToCameraMatrix(),Ce=a.ae.invert(new Float64Array(16),ke);be=a.b8.applyTransform(be,a.ae.multiply([],ke,ce));const Ae=this._extendAABB(be,A,k,b);if(!Ae)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");be=Ae,a.$.transformMat4(ve,ve,ke);const Ne=.5*(be.max[2]-be.min[2]),Fe=this._minimumAABBFrustumDistance(A,be),Ze=a.$.scale([],[0,0,1],Ne),je=a.$.add(Ze,ve,Ze),Me=Fe+(A.pitch===0?0:a.$.distance(ve,je)),nt=A.globeCenterInViewSpace,et=a.$.sub([],ve,[nt[0],nt[1],nt[2]]);a.$.normalize(et,et),a.$.scale(et,et,Me);const qe=a.$.add([],ve,et);a.$.transformMat4(qe,qe,Ce);const St=a.da/a.cF,yt=a.$.length(qe),Xe=a.ay(Math.max(yt*St-a.da,Number.EPSILON),0),ot=Math.min(A.zoomFromMercatorZAdjusted(Xe),k.maxZoom);return ot>.5*(a.b3+a.aV)?(A.setProjection({name:"mercator"}),A.zoom=ot,this._cameraForBounds(A,d,y,b,T,S)):{center:A.center,zoom:ot,bearing:b,pitch:T}}_extendAABB(l,d,y,b){const T=.5*((y.padding.left||0)+(y.padding.right||0)),S=.5*((y.padding.top||0)+(y.padding.bottom||0)),A=S,k=T,L=T,B=S,U=d.width-(k+L),q=d.height-(A+B),Z=a.$.sub([],l.max,l.min),se=Math.min(U/Z[0],q/Z[1]),oe=Math.min(d.scaleZoom(d.scale*se),y.maxZoom);if(isNaN(oe))return null;const ae=d.scale/d.zoomScale(oe),ce=new a.b8([l.min[0]-k*ae,l.min[1]-B*ae,l.min[2]],[l.max[0]+L*ae,l.max[1]+A*ae,l.max[2]]),xe=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new a.P(y.offset.x,y.offset.y):a.P.convert(y.offset)).rotate(-a.ac(b));return ce.center[0]-=xe.x*ae,ce.center[1]+=xe.y*ae,ce}queryTerrainElevation(l,d){const y=this.transform.elevation;return y?(d=a.Q({},{exaggerated:!0},d),y.getAtPoint(a._.fromLngLat(l),null,d.exaggerated)):null}_cameraForBounds(l,d,y,b,T,S){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,d,y,b,T,S);const A=l.clone(),k=this._extendCameraOptions(S);A.bearing=b,A.pitch=T;const L=a.aJ.convert(d),B=a.aJ.convert(y),U=new a.aJ(L.lng,B.lat),q=new a.aJ(B.lng,L.lat),Z=A.project(L),se=A.project(B),oe=this.queryTerrainElevation(L),ae=this.queryTerrainElevation(B),ce=this.queryTerrainElevation(U),xe=this.queryTerrainElevation(q),be=[[Z.x,Z.y,Math.min(oe||0,ae||0,ce||0,xe||0)],[se.x,se.y,Math.max(oe||0,ae||0,ce||0,xe||0)]];let ve=a.b8.fromPoints(be);const ke=A.getWorldToCameraMatrix(),Ce=a.ae.invert(new Float64Array(16),ke);ve=a.b8.applyTransform(ve,ke);const Ae=this._extendAABB(ve,A,k,b);if(!Ae)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ve=Ae;const Ne=.5*a.$.sub([],ve.max,ve.min)[2],Fe=this._minimumAABBFrustumDistance(A,ve),Ze=[0,0,1,0];a.aB.transformMat4(Ze,Ze,ke),a.aB.normalize(Ze,Ze);const je=a.$.scale([],Ze,Fe+Ne),Me=a.$.add([],ve.center,je);a.$.transformMat4(ve.center,ve.center,Ce),a.$.transformMat4(Me,Me,Ce);const nt=[ve.center[0],ve.center[1],Me[2]*A.pixelsPerMeter];a.$.scale(nt,nt,1/A.worldSize);const et=a.d9(nt[0]),qe=a.az(nt[1]),St=Math.min(A._zoomFromMercatorZ(nt[2]),k.maxZoom),yt=new a.aJ(et,qe);return A.mercatorFromTransition&&St<.5*(a.b3+a.aV)?(A.setProjection({name:"globe"}),A.zoom=St,this._cameraForBounds(A,d,y,b,T,S)):{center:yt,zoom:St,bearing:b,pitch:T}}fitBounds(l,d,y){const b=this.cameraForBounds(l,d);return this._fitInternal(b,d,y)}fitScreenCoordinates(l,d,y,b,T){const S=a.P.convert(l),A=a.P.convert(d),k=new a.P(Math.min(S.x,A.x),Math.min(S.y,A.y)),L=new a.P(Math.max(S.x,A.x),Math.max(S.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,A))return this;const B=this.transform.pointLocation3D(k),U=this.transform.pointLocation3D(L),q=this.transform.pointLocation3D(new a.P(k.x,L.y)),Z=this.transform.pointLocation3D(new a.P(L.x,k.y)),se=[Math.min(B.lng,U.lng,q.lng,Z.lng),Math.min(B.lat,U.lat,q.lat,Z.lat)],oe=[Math.max(B.lng,U.lng,q.lng,Z.lng),Math.max(B.lat,U.lat,q.lat,Z.lat)],ae=b&&b.pitch?b.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,se,oe,y,ae,b);return this._fitInternal(ce,b,T)}_fitInternal(l,d,y){return l?(d=a.Q(l,d)).linear?this.easeTo(d,y):this.flyTo(d,y):this}jumpTo(l,d){this.stop();const y=l.preloadOnly?this.transform.clone():this.transform;let b=!1,T=!1,S=!1;if("zoom"in l&&y.zoom!==+l.zoom&&(b=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=a.aJ.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(T=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(S=!0,y.pitch=+l.pitch),l.padding!=null){const A=typeof l.padding=="number"?this._extendPadding(l.padding):l.padding;y.isPaddingEqual(A)||(y.padding=A)}return l.preloadOnly?(this._preloadTiles(y),this):(this.fire(new a.g("movestart",d)).fire(new a.g("move",d)),b&&this.fire(new a.g("zoomstart",d)).fire(new a.g("zoom",d)).fire(new a.g("zoomend",d)),T&&this.fire(new a.g("rotatestart",d)).fire(new a.g("rotate",d)).fire(new a.g("rotateend",d)),S&&this.fire(new a.g("pitchstart",d)).fire(new a.g("pitch",d)).fire(new a.g("pitchend",d)),this.fire(new a.g("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w($g),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,d){const y=this.transform;if(!y.projection.supportsFreeCamera)return a.w($g),this;this.stop();const b=y.zoom,T=y.pitch,S=y.bearing;y.setFreeCameraOptions(l);const A=b!==y.zoom,k=T!==y.pitch,L=S!==y.bearing;return this.fire(new a.g("movestart",d)).fire(new a.g("move",d)),A&&this.fire(new a.g("zoomstart",d)).fire(new a.g("zoom",d)).fire(new a.g("zoomend",d)),L&&this.fire(new a.g("rotatestart",d)).fire(new a.g("rotate",d)).fire(new a.g("rotateend",d)),k&&this.fire(new a.g("pitchstart",d)).fire(new a.g("pitch",d)).fire(new a.g("pitchend",d)),this.fire(new a.g("moveend",d)),this}easeTo(l,d){this._stop(!1,l.easeId),((l=a.Q({offset:[0,0],duration:500,easing:a.d5},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),A=this.getPadding(),k="zoom"in l?+l.zoom:b,L="bearing"in l?this._normalizeBearing(l.bearing,T):T,B="pitch"in l?+l.pitch:S,U=this._extendPadding(l.padding),q=a.P.convert(l.offset);let Z,se,oe;if(y.projection.name==="globe"){const Fe=a._.fromLngLat(y.center),Ze=q.rotate(-y.angle);Fe.x+=Ze.x/y.worldSize,Fe.y+=Ze.y/y.worldSize;const je=Fe.toLngLat(),Me=a.aJ.convert(l.center||je);this._normalizeCenter(Me),Z=y.centerPoint.add(Ze),se=new a.P(Fe.x,Fe.y).mult(y.worldSize),oe=new a.P(a.ak(Me.lng),a.al(Me.lat)).mult(y.worldSize).sub(se)}else{Z=y.centerPoint.add(q);const Fe=y.pointLocation(Z),Ze=a.aJ.convert(l.center||Fe);this._normalizeCenter(Ze),se=y.project(Fe),oe=y.project(Ze).sub(se)}const ae=y.zoomScale(k-b);let ce,xe;l.around&&(ce=a.aJ.convert(l.around),xe=y.locationPoint(ce));const be=this._zooming||k!==b,ve=this._rotating||T!==L,ke=this._pitching||B!==S,Ce=!y.isPaddingEqual(U),Ae=Fe=>Ze=>{if(be&&(Fe.zoom=a.a3(b,k,Ze)),ve&&(Fe.bearing=a.a3(T,L,Ze)),ke&&(Fe.pitch=a.a3(S,B,Ze)),Ce&&(Fe.interpolatePadding(A,U,Ze),Z=Fe.centerPoint.add(q)),ce)Fe.setLocationAtPoint(ce,xe);else{const je=Fe.zoomScale(Fe.zoom-b),Me=k>b?Math.min(2,ae):Math.max(.5,ae),nt=Math.pow(Me,1-Ze),et=Fe.unproject(se.add(oe.mult(Ze*nt)).mult(je));Fe.setLocationAtPoint(Fe.renderWorldCopies?et.wrap():et,Z)}return l.preloadOnly||this._fireMoveEvents(d),Fe};if(l.preloadOnly){const Fe=this._emulate(Ae,l.duration,y);return this._preloadTiles(Fe),this}const Ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=be,this._rotating=ve,this._pitching=ke,this._padding=Ce,this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,Ne),this._ease(Ae(y),Fe=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(d,Fe)},l),this}_prepareEase(l,d,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),d||y.moving||this.fire(new a.g("movestart",l)),this._zooming&&!y.zooming&&this.fire(new a.g("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new a.g("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new a.g("pitchstart",l))}_fireMoveEvents(l){this.fire(new a.g("move",l)),this._zooming&&this.fire(new a.g("zoom",l)),this._rotating&&this.fire(new a.g("rotate",l)),this._pitching&&this.fire(new a.g("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new a.g("zoomend",l)),b&&this.fire(new a.g("rotateend",l)),T&&this.fire(new a.g("pitchend",l)),this.fire(new a.g("moveend",l))}flyTo(l,d){if(this._prefersReducedMotion(l)){const ot=a.ai(l,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(ot,d)}this.stop(),l=a.Q({offset:[0,0],speed:1.2,curve:1.42,easing:a.d5},l);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),A=this.getPadding(),k="zoom"in l?a.au(+l.zoom,y.minZoom,y.maxZoom):b,L="bearing"in l?this._normalizeBearing(l.bearing,T):T,B="pitch"in l?+l.pitch:S,U=this._extendPadding(l.padding),q=y.zoomScale(k-b),Z=a.P.convert(l.offset);let se=y.centerPoint.add(Z);const oe=y.pointLocation(se),ae=a.aJ.convert(l.center||oe);this._normalizeCenter(ae);const ce=y.project(oe),xe=y.project(ae).sub(ce);let be=l.curve;const ve=Math.max(y.width,y.height),ke=ve/q,Ce=xe.mag();if("minZoom"in l){const ot=a.au(Math.min(l.minZoom,b,k),y.minZoom,y.maxZoom),$e=ve/y.zoomScale(ot-b);be=Math.sqrt($e/Ce*2)}const Ae=be*be;function Ne(ot){const $e=(ke*ke-ve*ve+(ot?-1:1)*Ae*Ae*Ce*Ce)/(2*(ot?ke:ve)*Ae*Ce);return Math.log(Math.sqrt($e*$e+1)-$e)}function Fe(ot){return(Math.exp(ot)-Math.exp(-ot))/2}function Ze(ot){return(Math.exp(ot)+Math.exp(-ot))/2}const je=Ne(0);let Me=function(ot){return Ze(je)/Ze(je+be*ot)},nt=function(ot){return ve*((Ze(je)*(Fe($e=je+be*ot)/Ze($e))-Fe(je))/Ae)/Ce;var $e},et=(Ne(1)-je)/be;if(Math.abs(Ce)<1e-6||!isFinite(et)){if(Math.abs(ve-ke)<1e-6)return this.easeTo(l,d);const ot=ke<ve?-1:1;et=Math.abs(Math.log(ke/ve))/be,nt=function(){return 0},Me=function($e){return Math.exp(ot*be*$e)}}l.duration="duration"in l?+l.duration:1e3*et/("screenSpeed"in l?+l.screenSpeed/be:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const qe=T!==L,St=B!==S,yt=!y.isPaddingEqual(U),Xe=ot=>$e=>{const vt=$e*et,bt=1/Me(vt);ot.zoom=$e===1?k:b+ot.scaleZoom(bt),qe&&(ot.bearing=a.a3(T,L,$e)),St&&(ot.pitch=a.a3(S,B,$e)),yt&&(ot.interpolatePadding(A,U,$e),se=ot.centerPoint.add(Z));const Vt=$e===1?ae:ot.unproject(ce.add(xe.mult(nt(vt))).mult(bt));return ot.setLocationAtPoint(ot.renderWorldCopies?Vt.wrap():Vt,se),ot._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(d),ot};if(l.preloadOnly){const ot=this._emulate(Xe,l.duration,y);return this._preloadTiles(ot),this}return this._zooming=!0,this._rotating=qe,this._pitching=St,this._padding=yt,this._prepareEase(d,!1),this._ease(Xe(y),()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,d)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,d,y){y.animate===!1||y.duration===0?(l(1),d()):(this._easeStart=a.e.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((a.e.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=a.av(l,-180,180);const y=Math.abs(l-d);return Math.abs(l-360-d)<y&&(l-=360),Math.abs(l+360-d)<y&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(d.maxBounds||d.projection.name!=="globe"&&!d.renderWorldCopies)return;const y=l.lng-d.center.lng;l.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&a.e.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,d,y){const b=Math.ceil(15*d/1e3),T=[],S=l(y.clone());for(let A=0;A<=b;A++){const k=S(A/b);T.push(k.clone())}return T}_preloadTiles(l,d){}}class Np{constructor(l={}){this.options=l,a.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const d=this.options&&this.options.compact,y=l._getUIString("AttributionControl.ToggleAttribution");this._map=l,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const b=F("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",y),this._innerContainer=F("div","mapboxgl-ctrl-attrib-inner",this._container),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.db.ACCESS_TOKEN}];if(l){const y=d.reduce((b,T,S)=>(T.value&&(b+=`${T.key}=${T.value}${S<d.length-1?"&":""}`),b),"?");l.href=`${a.db.FEEDBACK_URL}/${y}#${F0(this._map,!0)}`,l.rel="noopener nofollow"}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const d=this._map.style._mergedSourceCaches;for(const b in d){const T=d[b];if(T.used){const S=T.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l.sort((b,T)=>b.length-T.length),l=l.filter((b,T)=>{for(let S=T+1;S<l.length;S++)if(l[S].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class qg{constructor(){a.br(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=F("div","mapboxgl-ctrl");const d=F("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const d in l){const y=l[d].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class Gg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const b of y)if(b.id===l)return void(b.cancelled=!0)}run(l=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fp(g,l,d){if(g=new a.aJ(g.lng,g.lat),l){const y=new a.aJ(g.lng-360,g.lat),b=new a.aJ(g.lng+360,g.lat),T=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),S=d.locationPoint(g).distSqr(l),A=l.x<0||l.y<0||l.x>d.width||l.y>d.height;d.locationPoint(y).distSqr(l)<S&&(A||Math.abs(y.lng-d.center.lng)<T)?g=y:d.locationPoint(b).distSqr(l)<S&&(A||Math.abs(b.lng-d.center.lng)<T)&&(g=b)}for(;Math.abs(g.lng-d.center.lng)>180;){const y=d.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=d.width&&y.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const Wg={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Hg extends a.E{constructor(l,d){if(super(),(l instanceof HTMLElement||d)&&(l=a.Q({element:l},d)),a.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=a.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=F("div");const T=41,S=27,A=H("svg",{display:"block",height:T*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${T}`},this._element),k=H("radialGradient",{id:"shadowGradient"},H("defs",{},A));H("stop",{offset:"10%","stop-opacity":.4},k),H("stop",{offset:"100%","stop-opacity":.05},k),H("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),H("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),H("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),H("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=a.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()});const y=this._element.classList;for(const T in Wg)y.remove(`mapboxgl-marker-anchor-${T}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const b=l&&l.className?l.className.trim().split(/\s+/):[];y.add(...b),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.aJ.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const d=l.code,y=l.charCode||l.keyCode;d!=="Space"&&d!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(l){const d=l.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,d=this._pos;if(!l||!d)return!1;const y=l.unproject(d),b=l.getFreeCameraOptions();if(!b.position)return!1;const T=b.position.toLngLat();return T.distanceTo(y)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const d=this._pos;if(!d||d.x<0||d.x>l.transform.width||d.y<0||d.y>l.transform.height)return void this._clearFadeTimer();const y=l.unproject(d);let b;l._showingGlobe()&&a.dc(l.transform,this._lngLat)?b=0:(b=1-l._queryFogOpacity(y),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${Wg[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${d.x}px,${d.y}px)
        `}_calculateXYTransform(){const l=this._pos,d=this._map,y=this.getPitchAlignment();if(!d||!l||y!=="map")return"";if(!d._showingGlobe()){const k=d.getPitch();return k?`rotateX(${k}deg)`:""}const b=a.b1(a.dd(d.transform,this._lngLat)),T=l.sub(a.de(d.transform)),S=Math.abs(T.x)+Math.abs(T.y);if(S===0)return"";const A=b/S;return`rotateX(${-T.y*A}deg) rotateY(${T.x*A}deg)`}_calculateZTransform(){const l=this._pos,d=this._map;if(!d||!l)return"";let y=0;const b=this.getRotationAlignment();if(b==="map")if(d._showingGlobe()){const T=d.project(new a.aJ(this._lngLat.lng,this._lngLat.lat+.001)),S=d.project(new a.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);y=a.b1(Math.atan2(S.y,S.x))-90}else y=-d.getBearing();else if(b==="horizon"){const T=a.a0(4,6,d.getZoom()),S=a.de(d.transform);S.y+=T*d.transform.height;const A=l.sub(S),k=a.b1(Math.atan2(A.y,A.x));y=(k>90?k-270:k+90)*(1-T)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Fp(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=a.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const d=this._map;if(!d)return;const y=this._pointerdownPos,b=this._positionDelta;if(y&&b){if(!this._isDragging){const T=this._clickTolerance||d._clickTolerance;if(l.point.dist(y)<T)return;this._isDragging=!0}this._pos=l.point.sub(b),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.g("dragstart"))),this.fire(new a.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.g("dragend")),this._state="inactive"}_addDragHandler(l){const d=this._map,y=this._pos;d&&y&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(y),this._pointerdownPos=l.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const d=this._map;return d&&(l?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Dd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qA=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function pw(g=new a.P(0,0),l="bottom"){if(typeof g=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new a.P(0,g);case"top-left":return new a.P(d,d);case"top-right":return new a.P(-d,d);case"bottom":return new a.P(0,-g);case"bottom-left":return new a.P(d,-d);case"bottom-right":return new a.P(-d,-d);case"left":return new a.P(g,0);case"right":return new a.P(-g,0)}return new a.P(0,0)}return g instanceof a.P||Array.isArray(g)?a.P.convert(g):a.P.convert(g[l]||[0,0])}class GA{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const d=a.bb((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,d,y){this._start=this.getValue(d),this._end=l,this._startTime=d,this._endTime=d+y}}const WA={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class HA{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const ZA={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},H0={showCompass:!0,showZoom:!0,visualizePitch:!1};class Z0{constructor(l,d,y=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new kp({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,y&&(this.mousePitch=new jg({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),a.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),W()}move(l,d){const y=this.map,b=this.mouseRotate.mousemoveWindow(l,d),T=b&&b.bearingDelta;if(T&&y.setBearing(y.getBearing()+T),this.mousePitch){const S=this.mousePitch.mousemoveWindow(l,d),A=S&&S.pitchDelta;A&&y.setPitch(y.getPitch()+A)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){X(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(a.Q({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),ye(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,ye(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ee(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=Ee(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const mw={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Od={maxWidth:100,unit:"metric"},gw={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:a.dw,supported:I,setRTLTextPlugin:a.dy,getRTLTextPluginStatus:a.dz,Map:class extends W0{constructor(g){a.df.mark(a.dg.create);const l=g;if((g=a.Q({},ZA,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&a.dh(window)&&(g.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new iu(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Gg,this._domRenderTaskQueue=new Gg,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.di(),this._locale=a.Q({},WA,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new GA(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new a.dj(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?de({},g.contextCreateOptions):{},typeof g.container=="string"){const d=document.getElementById(g.container);if(!d)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=d}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),a.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new HA),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Vg(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||a.db.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new sw(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const d=g.bounds;d&&(this.resize(),this.fitBounds(d,a.Q({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Np({customAttribution:g.customAttribution})),this._logoControl=new qg,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",d=>{this._update(d.dataType==="style"),this.fire(new a.g(`${d.dataType}data`,d))}),this.on("dataloading",d=>{this.fire(new a.g(`${d.dataType}dataloading`,d))})}_getMapId(){return this._mapId}addControl(g,l){if(l===void 0&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new a.g("movestart",g)).fire(new a.g("move",g)),this.fire(new a.g("resize",g)),l&&this.fire(new a.g("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(a.aj.convert(g)),this._update()}setMinZoom(g){if((g=g!=null?g:-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g!=null?g:22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g!=null?g:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g!=null?g:85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(l=>l==="auto"?navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,l=g.projection.name;let d;l==="globe"&&g.zoom>=a.aV?(g.setMercatorFromTransition(),d=!0):l==="mercator"&&g.zoom<a.aV&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;return l=g.name==="globe"&&this.transform.zoom>=a.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(a.aJ.convert(g))}unproject(g){return this.transform.pointLocation3D(a.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,d){if(g==="mouseenter"||g==="mouseover"){let y=!1;const b=S=>{const A=l.filter(L=>this.getLayer(L)),k=A.length?this.queryRenderedFeatures(S.point,{layers:A}):[];k.length?y||(y=!0,d.call(this,new ma(g,this,S.originalEvent,{features:k}))):y=!1},T=()=>{y=!1};return{layers:new Set(l),listener:d,delegates:{mousemove:b,mouseout:T}}}if(g==="mouseleave"||g==="mouseout"){let y=!1;const b=S=>{const A=l.filter(k=>this.getLayer(k));(A.length?this.queryRenderedFeatures(S.point,{layers:A}):[]).length?y=!0:y&&(y=!1,d.call(this,new ma(g,this,S.originalEvent)))},T=S=>{y&&(y=!1,d.call(this,new ma(g,this,S.originalEvent)))};return{layers:new Set(l),listener:d,delegates:{mousemove:b,mouseout:T}}}{const y=b=>{const T=l.filter(A=>this.getLayer(A)),S=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];S.length&&(b.features=S,d.call(this,b),delete b.features)};return{layers:new Set(l),listener:d,delegates:{[g]:y}}}}on(g,l,d){if(typeof l=="function"||d===void 0)return super.on(g,l);if(Array.isArray(l)||(l=[l]),l){for(const b of l)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(g,l,d){if(typeof l=="function"||d===void 0)return super.once(g,l);if(Array.isArray(l)||(l=[l]),l){for(const b of l)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,l,d);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(g,l,d){if(typeof l=="function"||d===void 0)return super.off(g,l);const y=new Set(Array.isArray(l)?l:[l]);for(const S of y)if(!this._isValidId(S))return this;const b=(S,A)=>{if(S.size!==A.size)return!1;for(const k of S)if(!A.has(k))return!1;return!0},T=this._delegatedListeners?this._delegatedListeners[g]:void 0;return T&&(S=>{for(let A=0;A<S.length;A++){const k=S[A];if(k.listener===d&&b(k.layers,y)){for(const L in k.delegates)this.off(L,k.delegates[L]);return S.splice(A,1),this}}})(T),this}queryRenderedFeatures(g,l){if(!this.style)return[];if(l!==void 0||g===void 0||g instanceof a.P||Array.isArray(g)||(l=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers)){for(const d of l.layers)if(!this._isValidId(d))return[]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(g,l){return this._isValidId(g)?this.style.querySourceFeatures(g,l):[]}isPointOnSurface(g){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&a.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(g))}setStyle(g,l){return l=a.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&g&&l.diff!==!1&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(g,(d,y)=>{d?(a.w(`Unable to perform style diff: ${String(d.message||d.error||d)}. Rebuilding the style from scratch.`),this._updateStyle(g,l)):y&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(l==null)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const d=a.Q({},l);l&&l.config&&(d.initialConfig=l.config,delete d.config),this.style=new pa(this,d).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new pa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new a.f(new Error("IDs can't be empty."))),!1):!a.cY(g)||(this.fire(new a.f(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,l){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,l,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,d)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,l,{pixelRatio:d=1,sdf:y=!1,stretchX:b,stretchY:T,content:S}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:A,height:k,data:L}=a.e.getImageData(l);this.style.addImage(g,{data:new a.j({width:A,height:k},L),pixelRatio:d,stretchX:b,stretchY:T,content:S,sdf:y,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new a.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:k}=l,L=l;this.style.addImage(g,{data:new a.j({width:A,height:k},new Uint8Array(L.data)),pixelRatio:d,stretchX:b,stretchY:T,content:S,sdf:y,version:0,userImage:L}),L.onAdd&&L.onAdd(this,g)}}updateImage(g,l){this._lazyInitEmptyStyle();const d=this.style.getImage(g);if(!d)return void this.fire(new a.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?a.e.getImageData(l):l,{width:b,height:T,data:S}=y;if(b===void 0||T===void 0)return void this.fire(new a.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==d.data.width||T!==d.data.height)return void this.fire(new a.f(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const A=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);d.data.replace(S,A),this.style.updateImage(g,d)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new a.f(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){a.i(this._requestManager.transformRequest(g,a.R.Image),(d,y)=>{l(d,y instanceof HTMLImageElement?a.e.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(g,l){this._lazyInitEmptyStyle(),this.style.addModel(g,l)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new a.f(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,l){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)):this}getSlot(g){const l=this.getLayer(g);return l&&l.slot||null}setSlot(g,l){return this.style.setSlot(g,l),this.style.mergeLayers(),this._update(!0)}addImport(g,l){return this.style.addImport(g,l),this}updateImport(g,l){return typeof l!="string"&&l.id!==g?(this.removeImport(g),this.addImport(l)):(this.style.updateImport(g,l),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,l){return this.style.moveImport(g,l),this._update(!0)}moveLayer(g,l){return this._isValidId(g)?(this.style.moveLayer(g,l),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const l=this.style.getOwnLayer(g);return l?l.type==="custom"?l.implementation:l.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,l,d){return this._isValidId(g)?(this.style.setLayerZoomRange(g,l,d),this._update(!0)):this}setFilter(g,l,d={}){return this._isValidId(g)?(this.style.setFilter(g,l,d),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,l,d,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,l,d,y),this._update(!0)):this}getPaintProperty(g,l){return this._isValidId(g)?this.style.getPaintProperty(g,l):null}setLayoutProperty(g,l,d,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,l,d,y),this._update(!0)):this}getLayoutProperty(g,l){return this._isValidId(g)?this.style.getLayoutProperty(g,l):null}getSchema(g){return this.style.getSchema(g)}setSchema(g,l){return this.style.setSchema(g,l),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,l){return this.style.setConfig(g,l),this._update(!0)}getConfigProperty(g,l){return this.style.getConfigProperty(g,l)}setConfigProperty(g,l,d){return this.style.setConfigProperty(g,l,d),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const l=g[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aJ.convert(g),this.transform):0}setFeatureState(g,l){return this._isValidId(g.source)?(this.style.setFeatureState(g,l),this._update()):this}removeFeatureState(g,l){return this._isValidId(g.source)?(this.style.removeFeatureState(g,l),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let d,y,b,T=this._container;for(;T&&(!y||!b);){const S=window.getComputedStyle(T).transform;S&&S!=="none"&&(d=S.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(y=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(b=d[3])),T=T.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=b?Math.abs(l/b):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=F("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=F("div","mapboxgl-canvas-container",g);this._canvas=F("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=F("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=F("div",`mapboxgl-ctrl-${b}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const d=a.e.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);l!==-1&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const g=a.Q({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",g);l?(a.dk(l,!0),this.painter=new M0(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.dl.testSupport(l)):this.fire(new a.f(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.g("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new a.g("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;this.fire(new a.g("renderstart")),++this._frameId;const d=this.painter.context.extTimerQuery,y=a.e.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=b.createQuery(),b.beginQuery(d.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,B=this.transform.pitch,U=a.e.now(),q=new a.Y(L,{now:U,fadeDuration:T,pitch:B,transition:this.style.transition});this.style.update(q)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(y);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource);if(A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.df.mark(a.dg.load),this.fire(new a.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const L=a.e.now()-y;b.endQuery(d.TIME_ELAPSED_EXT),setTimeout(()=>{const B=b.getQueryParameter(l,b.QUERY_RESULT)/1e6;b.deleteQuery(l),this.fire(new a.g("gpu-timing-frame",{cpuTime:L,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(L);this.fire(new a.g("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(L);this.fire(new a.g("gpu-timing-deferred-render",{gpuTime:B}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(k||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(S=this._updateAverageElevation(y,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new a.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new a.g("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,a.df.mark(a.dg.fullLoad),this._performanceMetricsCollection&&a.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const d=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const b=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=g;const S=Math.abs(b-T);if(S>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(T),d(T);this._averageElevation.easeTo(T,g,300)}else if(S>1e-4)return this._averageElevation.jumpTo(T),d(T)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){a.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===a.dp||g.status===401)){const l=this.painter.context.gl;a.dk(l,!1),this._logoControl instanceof qg&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&a.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const d=this.painter.context.gl,y=d.createFramebuffer();function b(T){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,T,0);const S=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,S),S}return d.bindFramebuffer(d.FRAMEBUFFER,y),this._canvasPixelComparison(b(g),l.canvasCopies.map(b),l.timeStamps)}_canvasPixelComparison(g,l,d){let y=d[1]-d[0];const b=g.length/4;for(let T=0;T<l.length;T++){const S=l[T];let A=0;for(let k=0;k<S.length;k+=4)S[k]===g[k]&&S[k+1]===g[k+1]&&S[k+2]===g[k+2]&&S[k+3]===g[k+3]&&(A+=1);y+=(d[T+2]-d[T+1])*(1-A/b)}return y}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.ds(this.painter.context.gl),a.dt.remove(),a.du.remove(),this._removed=!0,this.fire(new a.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=a.e.frame(l=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(l)}))}_preloadTiles(g){const l=this.style?this.style.getSourceCaches():[];return a.dv(l,(d,y)=>d._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,l){a.dx(g,l)}get version(){return a.dw}},NavigationControl:class{constructor(g={}){this.options=a.Q({},H0,g),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(a.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),F("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),F("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:l}):d.resetNorth({},{originalEvent:l}))}),this._compassIcon=F("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),d=l===g.getMaxZoom(),y=l===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Z0(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const d=F("button",g,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(g,l){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends a.E{constructor(g={}){super();const l=navigator.geolocation;this.options=a.Q({geolocation:l},mw,g),a.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=iw(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(d=>l(d.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),d=g.coords;return!!l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new a.g("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("geolocate",g)),this._finish()}}_updateCamera(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,y=this._map.getBearing(),b=a.Q({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),b,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=a.ay(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=F("button","mapboxgl-ctrl-geolocate",this._container),F("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F("div","mapboxgl-user-location"),this._dotElement.appendChild(F("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(F("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Hg({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=F("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hg({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.g("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent!="undefined"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Np,ScaleControl:class{constructor(g={}){this.options=a.Q({},Od,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(l){return!1}}(),a.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,d=l._containerHeight/2,y=l._containerWidth/2-g/2,b=l.unproject([y,d]),T=l.unproject([y+g,d]),S=b.distanceTo(T);if(this.options.unit==="imperial"){const A=3.2808*S;A>5280?this._setScale(g,A/5280,"mile"):this._setScale(g,A,"foot")}else this.options.unit==="nautical"?this._setScale(g,S/1852,"nautical-mile"):S>=1e3?this._setScale(g,S/1e3,"kilometer"):this._setScale(g,S,"meter")}_setScale(g,l,d){this._map._requestDomTask(()=>{const y=function(T){const S=Math.pow(10,`${Math.floor(T)}`.length-1);let A=T/S;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(k){const L=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*L)/L}(A),S*A}(l),b=y/l;this._container.innerHTML=this._isNumberFormatSupported&&d!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(y):`${y}&nbsp;${gw[d]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=F("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.w("Full screen control 'container' must be a DOM element.")),a.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=F("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=F("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(g){super(),this.options=a.Q(Object.create(Dd),g),a.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new a.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new a.g("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=a.aJ.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const l=document.createDocumentFragment(),d=document.createElement("body");let y;for(d.innerHTML=g;y=d.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=F("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const d=this._closeButton=F("button","mapboxgl-popup-close-button",l);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,d=this._container,y=this._pos;if(!l||!d||!y)return"bottom";const b=d.offsetWidth,T=d.offsetHeight,S=y.x<b/2,A=y.x>l.transform.width-b/2;if(y.y+g<T)return S?"top-left":A?"top-right":"top";if(y.y>l.transform.height-T){if(S)return"bottom-left";if(A)return"bottom-right"}return S?"left":A?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,d=this._content;if(!l||!this._lngLat&&!this._trackPointer||!d)return;let y=this._container;if(y||(y=this._container=F("div","mapboxgl-popup",l.getContainer()),this._tip=F("div","mapboxgl-popup-tip",y),y.appendChild(d)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fp(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g instanceof a.P?g:l.project(this._lngLat),T=pw(this.options.offset),S=this._anchor=this._getAnchor(T.y),A=pw(this.options.offset,S),k=b.add(A).round();l._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Wg[S]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&l._showingGlobe()){const b=a.dc(l.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(qA);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Hg,Style:pa,LngLat:a.aJ,LngLatBounds:a.aj,Point:a.P,MercatorCoordinate:a._,FreeCameraOptions:_d,Evented:a.E,config:a.db,prewarm:a.dA,clearPrewarmedResources:a.dB,get accessToken(){return a.db.ACCESS_TOKEN},set accessToken(g){a.db.ACCESS_TOKEN=g},get baseApiUrl(){return a.db.API_URL},set baseApiUrl(g){a.db.API_URL=g},get workerCount(){return a.dC.workerCount},set workerCount(g){a.dC.workerCount=g},get maxParallelImageRequests(){return a.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){a.db.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){a.dD(g)},get workerUrl(){return a.dE.workerUrl},set workerUrl(g){a.dE.workerUrl=g},get workerClass(){return a.dE.workerClass},set workerClass(g){a.dE.workerClass=g},get workerParams(){return a.dE.workerParams},set workerParams(g){a.dE.workerParams=g},get dracoUrl(){return a.dF()},set dracoUrl(g){a.dG(g)},get meshoptUrl(){return a.dH()},set meshoptUrl(g){a.dI(g)},setNow:a.e.setNow,restoreNow:a.e.restoreNow}});var x=f;return x})})(RZ);var eEe=RZ.exports;const Qm=Yy(eEe),kZ="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";Qm.accessToken=kZ;let uE=null,I$=!1;const Ul={},tEe=(e,t)=>Be(xn,null,function*(){if(Zt.currentUser){const r=er(bn,"users",Zt.currentUser.uid);try{yield ss(r,{location:{latitude:e,longitude:t,timestamp:new Date().toISOString()}})}catch(s){console.error("Error updating location:",s)}}}),DZ=(e,t,r,s)=>{if(console.log("Adding marker for user:",s),!e||typeof e.addLayer!="function")return console.error("Invalid map object in addMarker"),null;if(!e.loaded())return console.log("Map not yet loaded, waiting..."),e.on("load",()=>DZ(e,t,r,s)),null;const c=document.createElement("div");c.className="marker-container";const f=document.createElement("img");f.src=s.profilePhoto||"/default-profile.png",f.alt=s.name||"User",f.className="marker-image";let _=!1;f.onerror=()=>{_||(console.warn(`Failed to load image for ${s.name||"user"}, default profile used.`),_=!0),f.src="/default-profile.png"},c.appendChild(f);const x=document.createElement("div");x.className="marker-dot",c.appendChild(x);try{const a=new Qm.Marker(c).setLngLat([r,t]).addTo(e);console.log("Marker created:",a);const I=new Qm.Popup({offset:25,closeButton:!1,closeOnClick:!1,maxWidth:"none"}),D=document.createElement("div");D.className="custom-popup",D.innerHTML=`
      <div class="profile-container">
        <div class="profile-header">
          <div class="profile-photo-container">
            <img src="${s.profilePhoto||"/default-profile.png"}" alt="${s.name||"User"}" class="profile-photo">
          </div>
          <div class="profile-info">
            <h2 class="profile-name">${s.name||"Unknown User"}</h2>
            <p class="profile-status"><span class="status-dot"></span> Active</p>
            <p class="profile-bio">${s.bio||"No bio available"}</p>
          </div>
        </div>
        <div class="tags-container">
          ${(s.tags||[]).map(F=>`<div class="tag">${F}</div>`).join("")}
        </div>
        <button class="add-friend-button">Add Friend</button>
      </div>
    `;const O=D.querySelector(".add-friend-button");return O.addEventListener("click",()=>Be(xn,null,function*(){console.log("Add friend button clicked");try{const F=er(bn,"users",Zt.currentUser.uid),ie=(yield Ki(F)).data().friends||[];ie.includes(s.id)||(yield ss(F,{friends:[...ie,s.id]}),O.textContent="Friend Added",O.disabled=!0)}catch(F){console.error("Error adding friend:",F)}})),I.setDOMContent(D),a.setPopup(I),a.getElement().addEventListener("click",F=>{console.log("Marker clicked:",s),F.stopPropagation(),I.addTo(e)}),a}catch(a){return console.error("Error creating marker:",a),null}},OZ=(e,t)=>{if(console.log("Setting up user locations listener"),!e||typeof e.addLayer!="function")return console.error("Invalid map object in setupUserLocationsListener"),()=>{};if(!e.loaded())return e.on("load",()=>OZ(e,t)),()=>{};const r=Ci(bn,"users"),s=go(r,Ii("isActive","==",!0));return Gh(s,c=>Be(xn,null,function*(){console.log("User locations snapshot received");const f=new Set,_=Zt.currentUser;if(!_){console.warn("No authenticated user found");return}const a=(yield Ki(er(bn,"users",_.uid))).data(),I=(a==null?void 0:a.friends)||[],D=(a==null?void 0:a.isPrivate)||!1;c.forEach(O=>Be(xn,null,function*(){const F=O.id,H=O.data();console.log("Processing user:",F,H);const Q=!H.isPrivate||F===_.uid||D&&I.includes(F)||!D&&I.includes(F);if(H.isActive&&H.location&&Q){f.add(F);const ie=new Date(H.location.timestamp).getTime();if(new Date().getTime()-ie>3e5)console.log("Removing inactive user:",F),Ul[F]&&(Ul[F].remove(),delete Ul[F]);else if(Ul[F])console.log("Updating marker for user:",F),Ul[F].setLngLat([H.location.longitude,H.location.latitude]);else{console.log("Adding new marker for user:",F);const X=DZ(e,H.location.latitude,H.location.longitude,{id:F,name:H.name,profilePhoto:H.profilePhoto,bio:H.bio,tags:H.tags});X&&(Ul[F]=X)}}else console.log("Removing marker for non-visible user:",F),Ul[F]&&(Ul[F].remove(),delete Ul[F])})),Object.keys(Ul).forEach(O=>{f.has(O)||(console.log("Removing marker for user no longer in snapshot:",O),Ul[O].remove(),delete Ul[O])}),typeof t=="function"?t([...f]):console.warn("setCurrentUserIds is not a function")}))},nEe=(e,t)=>{if(console.log("Setting up user location tracking"),!e||typeof e.addLayer!="function"){console.error("Invalid map object in trackUserLocation");return}if("geolocation"in navigator)return navigator.geolocation.watchPosition(s=>{const{latitude:c,longitude:f}=s.coords;tEe(c,f),(!uE||!I$||Math.abs(c-uE.latitude)>.001||Math.abs(f-uE.longitude)>.001)&&(e.flyTo({center:[f,c],zoom:15}),uE={latitude:c,longitude:f},I$=!0),fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${f},${c}.json?access_token=${kZ}`).then(x=>x.json()).then(x=>{x.features&&x.features.length>0&&t(x.features[0].place_name)}).catch(x=>{console.error("Error fetching address:",x)})},s=>{console.error("Error getting location:",s)},{enableHighAccuracy:!0,maximumAge:0,timeout:27e3});console.error("Geolocation is not supported by this browser.")},p4=(e,t)=>Be(xn,null,function*(){if(!e){console.error("Map object is not available");return}try{const s=(yield Ki(er(bn,"users",t))).data();s&&s.location?e.flyTo({center:[s.location.longitude,s.location.latitude],zoom:15,duration:1e3}):console.warn(`No location data found for user ${t}`)}catch(r){console.error("Error centering map on user:",r)}}),m4=e=>Be(xn,null,function*(){if(Zt.currentUser){const t=er(bn,"users",Zt.currentUser.uid);try{yield ss(t,{isActive:e})}catch(r){console.error("Error updating active status:",r)}}}),rEe=e=>Zt.onAuthStateChanged(t=>{t?m4(!0):(m4(!1),e("/login"))}),LZ=(e,t)=>{Zt.currentUser?m4(!1).then(()=>{localStorage.clear(),Zt.signOut().then(()=>{e("/login")}).catch(r=>{console.error("Error signing out:",r)})}):(localStorage.clear(),Zt.signOut().then(()=>{e("/login")}).catch(r=>{console.error("Error signing out:",r)}))},zZ=G.createContext(),iEe=()=>G.useContext(zZ),sEe=({children:e})=>{const[t,r]=G.useState("offline"),[s,c]=G.useState(Date.now());G.useEffect(()=>{const x=Zt.onAuthStateChanged(a=>{a?(r("online"),c(Date.now()),_(a.uid,"online"),f(a.uid)):(r("offline"),c(Date.now()))});return()=>{x()}},[]);const f=x=>{const a=["mousedown","keydown","scroll","touchstart"],I=()=>{c(Date.now()),t!=="online"&&(r("online"),_(x,"online"))};a.forEach(F=>{window.addEventListener(F,I)});const D=setInterval(()=>{Date.now()-s>3*60*1e3&&(r("idle"),_(x,"idle"))},60*1e3),O=()=>{document.hidden?(r("offline"),_(x,"offline")):(r("online"),c(Date.now()),_(x,"online"))};return document.addEventListener("visibilitychange",O),()=>{a.forEach(F=>{window.removeEventListener(F,I)}),clearInterval(D),document.removeEventListener("visibilitychange",O)}},_=(x,a)=>Be(xn,null,function*(){try{const I=er(bn,"users",x);yield ss(I,{status:a})}catch(I){console.error("Error updating user status in Firestore:",I)}});return G.useEffect(()=>{if(Zt.currentUser){const x=er(bn,"users",Zt.currentUser.uid),a=Gh(x,I=>{I.exists()&&I.data().activeQuest&&r("on quest")});return()=>a()}},[]),N.jsx(zZ.Provider,{value:{userStatus:t,setUserStatus:r},children:e})},C$=()=>{};let iL={},NZ={},FZ=null,BZ={mark:C$,measure:C$};try{typeof window!="undefined"&&(iL=window),typeof document!="undefined"&&(NZ=document),typeof MutationObserver!="undefined"&&(FZ=MutationObserver),typeof performance!="undefined"&&(BZ=performance)}catch(e){}const{userAgent:A$=""}=iL.navigator||{},Wf=iL,ls=NZ,P$=FZ,hE=BZ;Wf.document;const hd=!!ls.documentElement&&!!ls.head&&typeof ls.addEventListener=="function"&&typeof ls.createElement=="function",jZ=~A$.indexOf("MSIE")||~A$.indexOf("Trident/");var ys="classic",UZ="duotone",xl="sharp",bl="sharp-duotone",oEe=[ys,UZ,xl,bl],aEe={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds"}},R$={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},lEe=["kit"],cEe=/fa(s|r|l|t|d|b|k|kd|ss|sr|sl|st|sds)?[\-\ ]/,uEe=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit)?.*/i,hEe={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}},dEe={"Font Awesome 6 Free":{900:"fas",400:"far"},"Font Awesome 6 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 6 Brands":{400:"fab",normal:"fab"},"Font Awesome 6 Duotone":{900:"fad"},"Font Awesome 6 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 6 Sharp Duotone":{900:"fasds"}},fEe={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds"}},pEe={classic:["fas","far","fal","fat"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds"]},mEe={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid"}},gEe={classic:{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab"},sharp:{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"},"sharp-duotone":{solid:"fasds"}},VZ={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid"}},_Ee=["solid","regular","light","thin","duotone","brands"],$Z=[1,2,3,4,5,6,7,8,9,10],yEe=$Z.concat([11,12,13,14,15,16,17,18,19,20]),b1={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},vEe=[...Object.keys(pEe),..._Ee,"2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",b1.GROUP,b1.SWAP_OPACITY,b1.PRIMARY,b1.SECONDARY].concat($Z.map(e=>"".concat(e,"x"))).concat(yEe.map(e=>"w-".concat(e))),xEe={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},bEe={kit:{"fa-kit":"fak"},"kit-duotone":{"fa-kit-duotone":"fakd"}},wEe={kit:{fak:"fa-kit"},"kit-duotone":{fakd:"fa-kit-duotone"}},M$={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}};const id="___FONT_AWESOME___",g4=16,qZ="fa",GZ="svg-inline--fa",Ym="data-fa-i2svg",_4="data-fa-pseudo-element",TEe="data-fa-pseudo-element-pending",sL="data-prefix",oL="data-icon",k$="fontawesome-i2svg",EEe="async",SEe=["HTML","HEAD","STYLE","SCRIPT"],WZ=(()=>{try{return!0}catch(e){return!1}})(),HZ=[ys,xl,bl];function Mb(e){return new Proxy(e,{get(t,r){return r in t?t[r]:t[ys]}})}const ZZ=de({},VZ);ZZ[ys]=de(de(de({},VZ[ys]),R$.kit),R$["kit-duotone"]);const km=Mb(ZZ),y4=de({},gEe);y4[ys]=de(de(de({},y4[ys]),M$.kit),M$["kit-duotone"]);const Hx=Mb(y4),v4=de({},mEe);v4[ys]=de(de({},v4[ys]),wEe.kit);const Dm=Mb(v4),x4=de({},fEe);x4[ys]=de(de({},x4[ys]),bEe.kit);const IEe=Mb(x4),CEe=cEe,XZ="fa-layers-text",AEe=uEe,PEe=de({},aEe);Mb(PEe);const REe=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],KR=b1,Gy=new Set;Object.keys(Hx[ys]).map(Gy.add.bind(Gy));Object.keys(Hx[xl]).map(Gy.add.bind(Gy));Object.keys(Hx[bl]).map(Gy.add.bind(Gy));const MEe=[...lEe,...vEe],Q1=Wf.FontAwesomeConfig||{};function kEe(e){var t=ls.querySelector("script["+e+"]");if(t)return t.getAttribute(e)}function DEe(e){return e===""?!0:e==="false"?!1:e==="true"?!0:e}ls&&typeof ls.querySelector=="function"&&[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(t=>{let[r,s]=t;const c=DEe(kEe(r));c!=null&&(Q1[s]=c)});const KZ={styleDefault:"solid",familyDefault:"classic",cssPrefix:qZ,replacementClass:GZ,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};Q1.familyPrefix&&(Q1.cssPrefix=Q1.familyPrefix);const Wy=de(de({},KZ),Q1);Wy.autoReplaceSvg||(Wy.observeMutations=!1);const Zn={};Object.keys(KZ).forEach(e=>{Object.defineProperty(Zn,e,{enumerable:!0,set:function(t){Wy[e]=t,Y1.forEach(r=>r(Zn))},get:function(){return Wy[e]}})});Object.defineProperty(Zn,"familyPrefix",{enumerable:!0,set:function(e){Wy.cssPrefix=e,Y1.forEach(t=>t(Zn))},get:function(){return Wy.cssPrefix}});Wf.FontAwesomeConfig=Zn;const Y1=[];function OEe(e){return Y1.push(e),()=>{Y1.splice(Y1.indexOf(e),1)}}const of=g4,zu={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function LEe(e){if(!e||!hd)return;const t=ls.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e;const r=ls.head.childNodes;let s=null;for(let c=r.length-1;c>-1;c--){const f=r[c],_=(f.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(_)>-1&&(s=f)}return ls.head.insertBefore(t,s),e}const zEe="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function Zx(){let e=12,t="";for(;e-- >0;)t+=zEe[Math.random()*62|0];return t}function p0(e){const t=[];for(let r=(e||[]).length>>>0;r--;)t[r]=e[r];return t}function aL(e){return e.classList?p0(e.classList):(e.getAttribute("class")||"").split(" ").filter(t=>t)}function QZ(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function NEe(e){return Object.keys(e||{}).reduce((t,r)=>t+"".concat(r,'="').concat(QZ(e[r]),'" '),"").trim()}function fA(e){return Object.keys(e||{}).reduce((t,r)=>t+"".concat(r,": ").concat(e[r].trim(),";"),"")}function lL(e){return e.size!==zu.size||e.x!==zu.x||e.y!==zu.y||e.rotate!==zu.rotate||e.flipX||e.flipY}function FEe(e){let{transform:t,containerWidth:r,iconWidth:s}=e;const c={transform:"translate(".concat(r/2," 256)")},f="translate(".concat(t.x*32,", ").concat(t.y*32,") "),_="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),x="rotate(".concat(t.rotate," 0 0)"),a={transform:"".concat(f," ").concat(_," ").concat(x)},I={transform:"translate(".concat(s/2*-1," -256)")};return{outer:c,inner:a,path:I}}function BEe(e){let{transform:t,width:r=g4,height:s=g4,startCentered:c=!1}=e,f="";return c&&jZ?f+="translate(".concat(t.x/of-r/2,"em, ").concat(t.y/of-s/2,"em) "):c?f+="translate(calc(-50% + ".concat(t.x/of,"em), calc(-50% + ").concat(t.y/of,"em)) "):f+="translate(".concat(t.x/of,"em, ").concat(t.y/of,"em) "),f+="scale(".concat(t.size/of*(t.flipX?-1:1),", ").concat(t.size/of*(t.flipY?-1:1),") "),f+="rotate(".concat(t.rotate,"deg) "),f}var jEe=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 6 Sharp Duotone";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    animation-delay: -1ms;
    animation-duration: 1ms;
    animation-iteration-count: 1;
    transition-delay: 0s;
    transition-duration: 0s;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function YZ(){const e=qZ,t=GZ,r=Zn.cssPrefix,s=Zn.replacementClass;let c=jEe;if(r!==e||s!==t){const f=new RegExp("\\.".concat(e,"\\-"),"g"),_=new RegExp("\\--".concat(e,"\\-"),"g"),x=new RegExp("\\.".concat(t),"g");c=c.replace(f,".".concat(r,"-")).replace(_,"--".concat(r,"-")).replace(x,".".concat(s))}return c}let D$=!1;function QR(){Zn.autoAddCss&&!D$&&(LEe(YZ()),D$=!0)}var UEe={mixout(){return{dom:{css:YZ,insertCss:QR}}},hooks(){return{beforeDOMElementCreation(){QR()},beforeI2svg(){QR()}}}};const sd=Wf||{};sd[id]||(sd[id]={});sd[id].styles||(sd[id].styles={});sd[id].hooks||(sd[id].hooks={});sd[id].shims||(sd[id].shims=[]);var Nu=sd[id];const JZ=[],eX=function(){ls.removeEventListener("DOMContentLoaded",eX),hI=1,JZ.map(e=>e())};let hI=!1;hd&&(hI=(ls.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(ls.readyState),hI||ls.addEventListener("DOMContentLoaded",eX));function VEe(e){hd&&(hI?setTimeout(e,0):JZ.push(e))}function kb(e){const{tag:t,attributes:r={},children:s=[]}=e;return typeof e=="string"?QZ(e):"<".concat(t," ").concat(NEe(r),">").concat(s.map(kb).join(""),"</").concat(t,">")}function O$(e,t,r){if(e&&e[t]&&e[t][r])return{prefix:t,iconName:r,icon:e[t][r]}}var YR=function(t,r,s,c){var f=Object.keys(t),_=f.length,x=r,a,I,D;for(s===void 0?(a=1,D=t[f[0]]):(a=0,D=s);a<_;a++)I=f[a],D=x(D,t[I],I,t);return D};function $Ee(e){const t=[];let r=0;const s=e.length;for(;r<s;){const c=e.charCodeAt(r++);if(c>=55296&&c<=56319&&r<s){const f=e.charCodeAt(r++);(f&64512)==56320?t.push(((c&1023)<<10)+(f&1023)+65536):(t.push(c),r--)}else t.push(c)}return t}function b4(e){const t=$Ee(e);return t.length===1?t[0].toString(16):null}function qEe(e,t){const r=e.length;let s=e.charCodeAt(t),c;return s>=55296&&s<=56319&&r>t+1&&(c=e.charCodeAt(t+1),c>=56320&&c<=57343)?(s-55296)*1024+c-56320+65536:s}function L$(e){return Object.keys(e).reduce((t,r)=>{const s=e[r];return!!s.icon?t[s.iconName]=s.icon:t[r]=s,t},{})}function w4(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{skipHooks:s=!1}=r,c=L$(t);typeof Nu.hooks.addPack=="function"&&!s?Nu.hooks.addPack(e,L$(t)):Nu.styles[e]=de(de({},Nu.styles[e]||{}),c),e==="fas"&&w4("fa",t)}const{styles:mm,shims:GEe}=Nu,WEe={[ys]:Object.values(Dm[ys]),[xl]:Object.values(Dm[xl]),[bl]:Object.values(Dm[bl])};let cL=null,tX={},nX={},rX={},iX={},sX={};const HEe={[ys]:Object.keys(km[ys]),[xl]:Object.keys(km[xl]),[bl]:Object.keys(km[bl])};function ZEe(e){return~MEe.indexOf(e)}function XEe(e,t){const r=t.split("-"),s=r[0],c=r.slice(1).join("-");return s===e&&c!==""&&!ZEe(c)?c:null}const oX=()=>{const e=s=>YR(mm,(c,f,_)=>(c[_]=YR(f,s,{}),c),{});tX=e((s,c,f)=>(c[3]&&(s[c[3]]=f),c[2]&&c[2].filter(x=>typeof x=="number").forEach(x=>{s[x.toString(16)]=f}),s)),nX=e((s,c,f)=>(s[f]=f,c[2]&&c[2].filter(x=>typeof x=="string").forEach(x=>{s[x]=f}),s)),sX=e((s,c,f)=>{const _=c[2];return s[f]=f,_.forEach(x=>{s[x]=f}),s});const t="far"in mm||Zn.autoFetchSvg,r=YR(GEe,(s,c)=>{const f=c[0];let _=c[1];const x=c[2];return _==="far"&&!t&&(_="fas"),typeof f=="string"&&(s.names[f]={prefix:_,iconName:x}),typeof f=="number"&&(s.unicodes[f.toString(16)]={prefix:_,iconName:x}),s},{names:{},unicodes:{}});rX=r.names,iX=r.unicodes,cL=pA(Zn.styleDefault,{family:Zn.familyDefault})};OEe(e=>{cL=pA(e.styleDefault,{family:Zn.familyDefault})});oX();function uL(e,t){return(tX[e]||{})[t]}function KEe(e,t){return(nX[e]||{})[t]}function wf(e,t){return(sX[e]||{})[t]}function aX(e){return rX[e]||{prefix:null,iconName:null}}function QEe(e){const t=iX[e],r=uL("fas",e);return t||(r?{prefix:"fas",iconName:r}:null)||{prefix:null,iconName:null}}function Hf(){return cL}const hL=()=>({prefix:null,iconName:null,rest:[]});function pA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{family:r=ys}=t,s=km[r][e],c=Hx[r][e]||Hx[r][s],f=e in Nu.styles?e:null;return c||f||null}const YEe={[ys]:Object.keys(Dm[ys]),[xl]:Object.keys(Dm[xl]),[bl]:Object.keys(Dm[bl])};function mA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{skipLookups:r=!1}=t,s={[ys]:"".concat(Zn.cssPrefix,"-").concat(ys),[xl]:"".concat(Zn.cssPrefix,"-").concat(xl),[bl]:"".concat(Zn.cssPrefix,"-").concat(bl)};let c=null,f=ys;const _=oEe.filter(a=>a!==UZ);_.forEach(a=>{(e.includes(s[a])||e.some(I=>YEe[a].includes(I)))&&(f=a)});const x=e.reduce((a,I)=>{const D=XEe(Zn.cssPrefix,I);if(mm[I]?(I=WEe[f].includes(I)?IEe[f][I]:I,c=I,a.prefix=I):HEe[f].indexOf(I)>-1?(c=I,a.prefix=pA(I,{family:f})):D?a.iconName=D:I!==Zn.replacementClass&&!_.some(O=>I===s[O])&&a.rest.push(I),!r&&a.prefix&&a.iconName){const O=c==="fa"?aX(a.iconName):{},F=wf(a.prefix,a.iconName);O.prefix&&(c=null),a.iconName=O.iconName||F||a.iconName,a.prefix=O.prefix||a.prefix,a.prefix==="far"&&!mm.far&&mm.fas&&!Zn.autoFetchSvg&&(a.prefix="fas")}return a},hL());return(e.includes("fa-brands")||e.includes("fab"))&&(x.prefix="fab"),(e.includes("fa-duotone")||e.includes("fad"))&&(x.prefix="fad"),!x.prefix&&f===xl&&(mm.fass||Zn.autoFetchSvg)&&(x.prefix="fass",x.iconName=wf(x.prefix,x.iconName)||x.iconName),!x.prefix&&f===bl&&(mm.fasds||Zn.autoFetchSvg)&&(x.prefix="fasds",x.iconName=wf(x.prefix,x.iconName)||x.iconName),(x.prefix==="fa"||c==="fa")&&(x.prefix=Hf()||"fas"),x}class JEe{constructor(){this.definitions={}}add(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const c=r.reduce(this._pullDefinitions,{});Object.keys(c).forEach(f=>{this.definitions[f]=de(de({},this.definitions[f]||{}),c[f]),w4(f,c[f]);const _=Dm[ys][f];_&&w4(_,c[f]),oX()})}reset(){this.definitions={}}_pullDefinitions(t,r){const s=r.prefix&&r.iconName&&r.icon?{0:r}:r;return Object.keys(s).map(c=>{const{prefix:f,iconName:_,icon:x}=s[c],a=x[2];t[f]||(t[f]={}),a.length>0&&a.forEach(I=>{typeof I=="string"&&(t[f][I]=x)}),t[f][_]=x}),t}}let z$=[],ty={};const wy={},eSe=Object.keys(wy);function tSe(e,t){let{mixoutsTo:r}=t;return z$=e,ty={},Object.keys(wy).forEach(s=>{eSe.indexOf(s)===-1&&delete wy[s]}),z$.forEach(s=>{const c=s.mixout?s.mixout():{};if(Object.keys(c).forEach(f=>{typeof c[f]=="function"&&(r[f]=c[f]),typeof c[f]=="object"&&Object.keys(c[f]).forEach(_=>{r[f]||(r[f]={}),r[f][_]=c[f][_]})}),s.hooks){const f=s.hooks();Object.keys(f).forEach(_=>{ty[_]||(ty[_]=[]),ty[_].push(f[_])})}s.provides&&s.provides(wy)}),r}function T4(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];return(ty[e]||[]).forEach(_=>{t=_.apply(null,[t,...s])}),t}function Jm(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];(ty[e]||[]).forEach(f=>{f.apply(null,r)})}function Zf(){const e=arguments[0],t=Array.prototype.slice.call(arguments,1);return wy[e]?wy[e].apply(null,t):void 0}function E4(e){e.prefix==="fa"&&(e.prefix="fas");let{iconName:t}=e;const r=e.prefix||Hf();if(t)return t=wf(r,t)||t,O$(lX.definitions,r,t)||O$(Nu.styles,r,t)}const lX=new JEe,nSe=()=>{Zn.autoReplaceSvg=!1,Zn.observeMutations=!1,Jm("noAuto")},rSe={i2svg:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return hd?(Jm("beforeI2svg",e),Zf("pseudoElements2svg",e),Zf("i2svg",e)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:t}=e;Zn.autoReplaceSvg===!1&&(Zn.autoReplaceSvg=!0),Zn.observeMutations=!0,VEe(()=>{sSe({autoReplaceSvgRoot:t}),Jm("watch",e)})}},iSe={icon:e=>{if(e===null)return null;if(typeof e=="object"&&e.prefix&&e.iconName)return{prefix:e.prefix,iconName:wf(e.prefix,e.iconName)||e.iconName};if(Array.isArray(e)&&e.length===2){const t=e[1].indexOf("fa-")===0?e[1].slice(3):e[1],r=pA(e[0]);return{prefix:r,iconName:wf(r,t)||t}}if(typeof e=="string"&&(e.indexOf("".concat(Zn.cssPrefix,"-"))>-1||e.match(CEe))){const t=mA(e.split(" "),{skipLookups:!0});return{prefix:t.prefix||Hf(),iconName:wf(t.prefix,t.iconName)||t.iconName}}if(typeof e=="string"){const t=Hf();return{prefix:t,iconName:wf(t,e)||e}}}},Il={noAuto:nSe,config:Zn,dom:rSe,parse:iSe,library:lX,findIconDefinition:E4,toHtml:kb},sSe=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:t=ls}=e;(Object.keys(Nu.styles).length>0||Zn.autoFetchSvg)&&hd&&Zn.autoReplaceSvg&&Il.dom.i2svg({node:t})};function gA(e,t){return Object.defineProperty(e,"abstract",{get:t}),Object.defineProperty(e,"html",{get:function(){return e.abstract.map(r=>kb(r))}}),Object.defineProperty(e,"node",{get:function(){if(!hd)return;const r=ls.createElement("div");return r.innerHTML=e.html,r.children}}),e}function oSe(e){let{children:t,main:r,mask:s,attributes:c,styles:f,transform:_}=e;if(lL(_)&&r.found&&!s.found){const{width:x,height:a}=r,I={x:x/a/2,y:.5};c.style=fA(_t(de({},f),{"transform-origin":"".concat(I.x+_.x/16,"em ").concat(I.y+_.y/16,"em")}))}return[{tag:"svg",attributes:c,children:t}]}function aSe(e){let{prefix:t,iconName:r,children:s,attributes:c,symbol:f}=e;const _=f===!0?"".concat(t,"-").concat(Zn.cssPrefix,"-").concat(r):f;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:_t(de({},c),{id:_}),children:s}]}]}function dL(e){const{icons:{main:t,mask:r},prefix:s,iconName:c,transform:f,symbol:_,title:x,maskId:a,titleId:I,extra:D,watchable:O=!1}=e,{width:F,height:H}=r.found?r:t,Q=s==="fak",ie=[Zn.replacementClass,c?"".concat(Zn.cssPrefix,"-").concat(c):""].filter(ye=>D.classes.indexOf(ye)===-1).filter(ye=>ye!==""||!!ye).concat(D.classes).join(" ");let te={children:[],attributes:_t(de({},D.attributes),{"data-prefix":s,"data-icon":c,class:ie,role:D.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(F," ").concat(H)})};const W=Q&&!~D.classes.indexOf("fa-fw")?{width:"".concat(F/H*16*.0625,"em")}:{};O&&(te.attributes[Ym]=""),x&&(te.children.push({tag:"title",attributes:{id:te.attributes["aria-labelledby"]||"title-".concat(I||Zx())},children:[x]}),delete te.attributes.title);const X=_t(de({},te),{prefix:s,iconName:c,main:t,mask:r,maskId:a,transform:f,symbol:_,styles:de(de({},W),D.styles)}),{children:ee,attributes:fe}=r.found&&t.found?Zf("generateAbstractMask",X)||{children:[],attributes:{}}:Zf("generateAbstractIcon",X)||{children:[],attributes:{}};return X.children=ee,X.attributes=fe,_?aSe(X):oSe(X)}function N$(e){const{content:t,width:r,height:s,transform:c,title:f,extra:_,watchable:x=!1}=e,a=_t(de(de({},_.attributes),f?{title:f}:{}),{class:_.classes.join(" ")});x&&(a[Ym]="");const I=de({},_.styles);lL(c)&&(I.transform=BEe({transform:c,startCentered:!0,width:r,height:s}),I["-webkit-transform"]=I.transform);const D=fA(I);D.length>0&&(a.style=D);const O=[];return O.push({tag:"span",attributes:a,children:[t]}),f&&O.push({tag:"span",attributes:{class:"sr-only"},children:[f]}),O}function lSe(e){const{content:t,title:r,extra:s}=e,c=_t(de(de({},s.attributes),r?{title:r}:{}),{class:s.classes.join(" ")}),f=fA(s.styles);f.length>0&&(c.style=f);const _=[];return _.push({tag:"span",attributes:c,children:[t]}),r&&_.push({tag:"span",attributes:{class:"sr-only"},children:[r]}),_}const{styles:JR}=Nu;function S4(e){const t=e[0],r=e[1],[s]=e.slice(4);let c=null;return Array.isArray(s)?c={tag:"g",attributes:{class:"".concat(Zn.cssPrefix,"-").concat(KR.GROUP)},children:[{tag:"path",attributes:{class:"".concat(Zn.cssPrefix,"-").concat(KR.SECONDARY),fill:"currentColor",d:s[0]}},{tag:"path",attributes:{class:"".concat(Zn.cssPrefix,"-").concat(KR.PRIMARY),fill:"currentColor",d:s[1]}}]}:c={tag:"path",attributes:{fill:"currentColor",d:s}},{found:!0,width:t,height:r,icon:c}}const cSe={found:!1,width:512,height:512};function uSe(e,t){!WZ&&!Zn.showMissingIcons&&e&&console.error('Icon with name "'.concat(e,'" and prefix "').concat(t,'" is missing.'))}function I4(e,t){let r=t;return t==="fa"&&Zn.styleDefault!==null&&(t=Hf()),new Promise((s,c)=>{if(r==="fa"){const f=aX(e)||{};e=f.iconName||e,t=f.prefix||t}if(e&&t&&JR[t]&&JR[t][e]){const f=JR[t][e];return s(S4(f))}uSe(e,t),s(_t(de({},cSe),{icon:Zn.showMissingIcons&&e?Zf("missingIconAbstract")||{}:{}}))})}const F$=()=>{},C4=Zn.measurePerformance&&hE&&hE.mark&&hE.measure?hE:{mark:F$,measure:F$},w1='FA "6.6.0"',hSe=e=>(C4.mark("".concat(w1," ").concat(e," begins")),()=>cX(e)),cX=e=>{C4.mark("".concat(w1," ").concat(e," ends")),C4.measure("".concat(w1," ").concat(e),"".concat(w1," ").concat(e," begins"),"".concat(w1," ").concat(e," ends"))};var fL={begin:hSe,end:cX};const $E=()=>{};function B$(e){return typeof(e.getAttribute?e.getAttribute(Ym):null)=="string"}function dSe(e){const t=e.getAttribute?e.getAttribute(sL):null,r=e.getAttribute?e.getAttribute(oL):null;return t&&r}function fSe(e){return e&&e.classList&&e.classList.contains&&e.classList.contains(Zn.replacementClass)}function pSe(){return Zn.autoReplaceSvg===!0?qE.replace:qE[Zn.autoReplaceSvg]||qE.replace}function mSe(e){return ls.createElementNS("http://www.w3.org/2000/svg",e)}function gSe(e){return ls.createElement(e)}function uX(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{ceFn:r=e.tag==="svg"?mSe:gSe}=t;if(typeof e=="string")return ls.createTextNode(e);const s=r(e.tag);return Object.keys(e.attributes||[]).forEach(function(f){s.setAttribute(f,e.attributes[f])}),(e.children||[]).forEach(function(f){s.appendChild(uX(f,{ceFn:r}))}),s}function _Se(e){let t=" ".concat(e.outerHTML," ");return t="".concat(t,"Font Awesome fontawesome.com "),t}const qE={replace:function(e){const t=e[0];if(t.parentNode)if(e[1].forEach(r=>{t.parentNode.insertBefore(uX(r),t)}),t.getAttribute(Ym)===null&&Zn.keepOriginalSource){let r=ls.createComment(_Se(t));t.parentNode.replaceChild(r,t)}else t.remove()},nest:function(e){const t=e[0],r=e[1];if(~aL(t).indexOf(Zn.replacementClass))return qE.replace(e);const s=new RegExp("".concat(Zn.cssPrefix,"-.*"));if(delete r[0].attributes.id,r[0].attributes.class){const f=r[0].attributes.class.split(" ").reduce((_,x)=>(x===Zn.replacementClass||x.match(s)?_.toSvg.push(x):_.toNode.push(x),_),{toNode:[],toSvg:[]});r[0].attributes.class=f.toSvg.join(" "),f.toNode.length===0?t.removeAttribute("class"):t.setAttribute("class",f.toNode.join(" "))}const c=r.map(f=>kb(f)).join(`
`);t.setAttribute(Ym,""),t.innerHTML=c}};function j$(e){e()}function hX(e,t){const r=typeof t=="function"?t:$E;if(e.length===0)r();else{let s=j$;Zn.mutateApproach===EEe&&(s=Wf.requestAnimationFrame||j$),s(()=>{const c=pSe(),f=fL.begin("mutate");e.map(c),f(),r()})}}let pL=!1;function dX(){pL=!0}function A4(){pL=!1}let dI=null;function U$(e){if(!P$||!Zn.observeMutations)return;const{treeCallback:t=$E,nodeCallback:r=$E,pseudoElementsCallback:s=$E,observeMutationsRoot:c=ls}=e;dI=new P$(f=>{if(pL)return;const _=Hf();p0(f).forEach(x=>{if(x.type==="childList"&&x.addedNodes.length>0&&!B$(x.addedNodes[0])&&(Zn.searchPseudoElements&&s(x.target),t(x.target)),x.type==="attributes"&&x.target.parentNode&&Zn.searchPseudoElements&&s(x.target.parentNode),x.type==="attributes"&&B$(x.target)&&~REe.indexOf(x.attributeName))if(x.attributeName==="class"&&dSe(x.target)){const{prefix:a,iconName:I}=mA(aL(x.target));x.target.setAttribute(sL,a||_),I&&x.target.setAttribute(oL,I)}else fSe(x.target)&&r(x.target)})}),hd&&dI.observe(c,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}function ySe(){dI&&dI.disconnect()}function vSe(e){const t=e.getAttribute("style");let r=[];return t&&(r=t.split(";").reduce((s,c)=>{const f=c.split(":"),_=f[0],x=f.slice(1);return _&&x.length>0&&(s[_]=x.join(":").trim()),s},{})),r}function xSe(e){const t=e.getAttribute("data-prefix"),r=e.getAttribute("data-icon"),s=e.innerText!==void 0?e.innerText.trim():"";let c=mA(aL(e));return c.prefix||(c.prefix=Hf()),t&&r&&(c.prefix=t,c.iconName=r),c.iconName&&c.prefix||(c.prefix&&s.length>0&&(c.iconName=KEe(c.prefix,e.innerText)||uL(c.prefix,b4(e.innerText))),!c.iconName&&Zn.autoFetchSvg&&e.firstChild&&e.firstChild.nodeType===Node.TEXT_NODE&&(c.iconName=e.firstChild.data)),c}function bSe(e){const t=p0(e.attributes).reduce((c,f)=>(c.name!=="class"&&c.name!=="style"&&(c[f.name]=f.value),c),{}),r=e.getAttribute("title"),s=e.getAttribute("data-fa-title-id");return Zn.autoA11y&&(r?t["aria-labelledby"]="".concat(Zn.replacementClass,"-title-").concat(s||Zx()):(t["aria-hidden"]="true",t.focusable="false")),t}function wSe(){return{iconName:null,title:null,titleId:null,prefix:null,transform:zu,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function V$(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0};const{iconName:r,prefix:s,rest:c}=xSe(e),f=bSe(e),_=T4("parseNodeAttributes",{},e);let x=t.styleParser?vSe(e):[];return de({iconName:r,title:e.getAttribute("title"),titleId:e.getAttribute("data-fa-title-id"),prefix:s,transform:zu,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:c,styles:x,attributes:f}},_)}const{styles:TSe}=Nu;function fX(e){const t=Zn.autoReplaceSvg==="nest"?V$(e,{styleParser:!1}):V$(e);return~t.extra.classes.indexOf(XZ)?Zf("generateLayersText",e,t):Zf("generateSvgReplacementMutation",e,t)}let Zu=new Set;HZ.map(e=>{Zu.add("fa-".concat(e))});Object.keys(km[ys]).map(Zu.add.bind(Zu));Object.keys(km[xl]).map(Zu.add.bind(Zu));Object.keys(km[bl]).map(Zu.add.bind(Zu));Zu=[...Zu];function $$(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!hd)return Promise.resolve();const r=ls.documentElement.classList,s=D=>r.add("".concat(k$,"-").concat(D)),c=D=>r.remove("".concat(k$,"-").concat(D)),f=Zn.autoFetchSvg?Zu:HZ.map(D=>"fa-".concat(D)).concat(Object.keys(TSe));f.includes("fa")||f.push("fa");const _=[".".concat(XZ,":not([").concat(Ym,"])")].concat(f.map(D=>".".concat(D,":not([").concat(Ym,"])"))).join(", ");if(_.length===0)return Promise.resolve();let x=[];try{x=p0(e.querySelectorAll(_))}catch(D){}if(x.length>0)s("pending"),c("complete");else return Promise.resolve();const a=fL.begin("onTree"),I=x.reduce((D,O)=>{try{const F=fX(O);F&&D.push(F)}catch(F){WZ||F.name==="MissingIcon"&&console.error(F)}return D},[]);return new Promise((D,O)=>{Promise.all(I).then(F=>{hX(F,()=>{s("active"),s("complete"),c("pending"),typeof t=="function"&&t(),a(),D()})}).catch(F=>{a(),O(F)})})}function ESe(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;fX(e).then(r=>{r&&hX([r],t)})}function SSe(e){return function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=(t||{}).icon?t:E4(t||{});let{mask:c}=r;return c&&(c=(c||{}).icon?c:E4(c||{})),e(s,_t(de({},r),{mask:c}))}}const ISe=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=zu,symbol:s=!1,mask:c=null,maskId:f=null,title:_=null,titleId:x=null,classes:a=[],attributes:I={},styles:D={}}=t;if(!e)return;const{prefix:O,iconName:F,icon:H}=e;return gA(de({type:"icon"},e),()=>(Jm("beforeDOMElementCreation",{iconDefinition:e,params:t}),Zn.autoA11y&&(_?I["aria-labelledby"]="".concat(Zn.replacementClass,"-title-").concat(x||Zx()):(I["aria-hidden"]="true",I.focusable="false")),dL({icons:{main:S4(H),mask:c?S4(c.icon):{found:!1,width:null,height:null,icon:{}}},prefix:O,iconName:F,transform:de(de({},zu),r),symbol:s,title:_,maskId:f,titleId:x,extra:{attributes:I,styles:D,classes:a}})))};var CSe={mixout(){return{icon:SSe(ISe)}},hooks(){return{mutationObserverCallbacks(e){return e.treeCallback=$$,e.nodeCallback=ESe,e}}},provides(e){e.i2svg=function(t){const{node:r=ls,callback:s=()=>{}}=t;return $$(r,s)},e.generateSvgReplacementMutation=function(t,r){const{iconName:s,title:c,titleId:f,prefix:_,transform:x,symbol:a,mask:I,maskId:D,extra:O}=r;return new Promise((F,H)=>{Promise.all([I4(s,_),I.iconName?I4(I.iconName,I.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(Q=>{let[ie,te]=Q;F([t,dL({icons:{main:ie,mask:te},prefix:_,iconName:s,transform:x,symbol:a,maskId:D,title:c,titleId:f,extra:O,watchable:!0})])}).catch(H)})},e.generateAbstractIcon=function(t){let{children:r,attributes:s,main:c,transform:f,styles:_}=t;const x=fA(_);x.length>0&&(s.style=x);let a;return lL(f)&&(a=Zf("generateAbstractTransformGrouping",{main:c,transform:f,containerWidth:c.width,iconWidth:c.width})),r.push(a||c.icon),{children:r,attributes:s}}}},ASe={mixout(){return{layer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{classes:r=[]}=t;return gA({type:"layer"},()=>{Jm("beforeDOMElementCreation",{assembler:e,params:t});let s=[];return e(c=>{Array.isArray(c)?c.map(f=>{s=s.concat(f.abstract)}):s=s.concat(c.abstract)}),[{tag:"span",attributes:{class:["".concat(Zn.cssPrefix,"-layers"),...r].join(" ")},children:s}]})}}}},PSe={mixout(){return{counter(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{title:r=null,classes:s=[],attributes:c={},styles:f={}}=t;return gA({type:"counter",content:e},()=>(Jm("beforeDOMElementCreation",{content:e,params:t}),lSe({content:e.toString(),title:r,extra:{attributes:c,styles:f,classes:["".concat(Zn.cssPrefix,"-layers-counter"),...s]}})))}}}},RSe={mixout(){return{text(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=zu,title:s=null,classes:c=[],attributes:f={},styles:_={}}=t;return gA({type:"text",content:e},()=>(Jm("beforeDOMElementCreation",{content:e,params:t}),N$({content:e,transform:de(de({},zu),r),title:s,extra:{attributes:f,styles:_,classes:["".concat(Zn.cssPrefix,"-layers-text"),...c]}})))}}},provides(e){e.generateLayersText=function(t,r){const{title:s,transform:c,extra:f}=r;let _=null,x=null;if(jZ){const a=parseInt(getComputedStyle(t).fontSize,10),I=t.getBoundingClientRect();_=I.width/a,x=I.height/a}return Zn.autoA11y&&!s&&(f.attributes["aria-hidden"]="true"),Promise.resolve([t,N$({content:t.innerHTML,width:_,height:x,transform:c,title:s,extra:f,watchable:!0})])}}};const MSe=new RegExp('"',"ug"),q$=[1105920,1112319],G$=de(de(de({FontAwesome:{normal:"fas",400:"fas"}},dEe),hEe),xEe),P4=Object.keys(G$).reduce((e,t)=>(e[t.toLowerCase()]=G$[t],e),{}),kSe=Object.keys(P4).reduce((e,t)=>{const r=P4[t];return e[t]=r[900]||[...Object.entries(r)][0][1],e},{});function DSe(e){const t=e.replace(MSe,""),r=qEe(t,0),s=r>=q$[0]&&r<=q$[1],c=t.length===2?t[0]===t[1]:!1;return{value:b4(c?t[0]:t),isSecondary:s||c}}function OSe(e,t){const r=e.replace(/^['"]|['"]$/g,"").toLowerCase(),s=parseInt(t),c=isNaN(s)?"normal":s;return(P4[r]||{})[c]||kSe[r]}function W$(e,t){const r="".concat(TEe).concat(t.replace(":","-"));return new Promise((s,c)=>{if(e.getAttribute(r)!==null)return s();const _=p0(e.children).filter(F=>F.getAttribute(_4)===t)[0],x=Wf.getComputedStyle(e,t),a=x.getPropertyValue("font-family"),I=a.match(AEe),D=x.getPropertyValue("font-weight"),O=x.getPropertyValue("content");if(_&&!I)return e.removeChild(_),s();if(I&&O!=="none"&&O!==""){const F=x.getPropertyValue("content");let H=OSe(a,D);const{value:Q,isSecondary:ie}=DSe(F),te=I[0].startsWith("FontAwesome");let W=uL(H,Q),X=W;if(te){const ee=QEe(Q);ee.iconName&&ee.prefix&&(W=ee.iconName,H=ee.prefix)}if(W&&!ie&&(!_||_.getAttribute(sL)!==H||_.getAttribute(oL)!==X)){e.setAttribute(r,X),_&&e.removeChild(_);const ee=wSe(),{extra:fe}=ee;fe.attributes[_4]=t,I4(W,H).then(ye=>{const Ee=dL(_t(de({},ee),{icons:{main:ye,mask:hL()},prefix:H,iconName:X,extra:fe,watchable:!0})),re=ls.createElementNS("http://www.w3.org/2000/svg","svg");t==="::before"?e.insertBefore(re,e.firstChild):e.appendChild(re),re.outerHTML=Ee.map(he=>kb(he)).join(`
`),e.removeAttribute(r),s()}).catch(c)}else s()}else s()})}function LSe(e){return Promise.all([W$(e,"::before"),W$(e,"::after")])}function zSe(e){return e.parentNode!==document.head&&!~SEe.indexOf(e.tagName.toUpperCase())&&!e.getAttribute(_4)&&(!e.parentNode||e.parentNode.tagName!=="svg")}function H$(e){if(hd)return new Promise((t,r)=>{const s=p0(e.querySelectorAll("*")).filter(zSe).map(LSe),c=fL.begin("searchPseudoElements");dX(),Promise.all(s).then(()=>{c(),A4(),t()}).catch(()=>{c(),A4(),r()})})}var NSe={hooks(){return{mutationObserverCallbacks(e){return e.pseudoElementsCallback=H$,e}}},provides(e){e.pseudoElements2svg=function(t){const{node:r=ls}=t;Zn.searchPseudoElements&&H$(r)}}};let Z$=!1;var FSe={mixout(){return{dom:{unwatch(){dX(),Z$=!0}}}},hooks(){return{bootstrap(){U$(T4("mutationObserverCallbacks",{}))},noAuto(){ySe()},watch(e){const{observeMutationsRoot:t}=e;Z$?A4():U$(T4("mutationObserverCallbacks",{observeMutationsRoot:t}))}}}};const X$=e=>{let t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e.toLowerCase().split(" ").reduce((r,s)=>{const c=s.toLowerCase().split("-"),f=c[0];let _=c.slice(1).join("-");if(f&&_==="h")return r.flipX=!0,r;if(f&&_==="v")return r.flipY=!0,r;if(_=parseFloat(_),isNaN(_))return r;switch(f){case"grow":r.size=r.size+_;break;case"shrink":r.size=r.size-_;break;case"left":r.x=r.x-_;break;case"right":r.x=r.x+_;break;case"up":r.y=r.y-_;break;case"down":r.y=r.y+_;break;case"rotate":r.rotate=r.rotate+_;break}return r},t)};var BSe={mixout(){return{parse:{transform:e=>X$(e)}}},hooks(){return{parseNodeAttributes(e,t){const r=t.getAttribute("data-fa-transform");return r&&(e.transform=X$(r)),e}}},provides(e){e.generateAbstractTransformGrouping=function(t){let{main:r,transform:s,containerWidth:c,iconWidth:f}=t;const _={transform:"translate(".concat(c/2," 256)")},x="translate(".concat(s.x*32,", ").concat(s.y*32,") "),a="scale(".concat(s.size/16*(s.flipX?-1:1),", ").concat(s.size/16*(s.flipY?-1:1),") "),I="rotate(".concat(s.rotate," 0 0)"),D={transform:"".concat(x," ").concat(a," ").concat(I)},O={transform:"translate(".concat(f/2*-1," -256)")},F={outer:_,inner:D,path:O};return{tag:"g",attributes:de({},F.outer),children:[{tag:"g",attributes:de({},F.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:de(de({},r.icon.attributes),F.path)}]}]}}}};const eM={x:0,y:0,width:"100%",height:"100%"};function K$(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return e.attributes&&(e.attributes.fill||t)&&(e.attributes.fill="black"),e}function jSe(e){return e.tag==="g"?e.children:[e]}var USe={hooks(){return{parseNodeAttributes(e,t){const r=t.getAttribute("data-fa-mask"),s=r?mA(r.split(" ").map(c=>c.trim())):hL();return s.prefix||(s.prefix=Hf()),e.mask=s,e.maskId=t.getAttribute("data-fa-mask-id"),e}}},provides(e){e.generateAbstractMask=function(t){let{children:r,attributes:s,main:c,mask:f,maskId:_,transform:x}=t;const{width:a,icon:I}=c,{width:D,icon:O}=f,F=FEe({transform:x,containerWidth:D,iconWidth:a}),H={tag:"rect",attributes:_t(de({},eM),{fill:"white"})},Q=I.children?{children:I.children.map(K$)}:{},ie={tag:"g",attributes:de({},F.inner),children:[K$(de({tag:I.tag,attributes:de(de({},I.attributes),F.path)},Q))]},te={tag:"g",attributes:de({},F.outer),children:[ie]},W="mask-".concat(_||Zx()),X="clip-".concat(_||Zx()),ee={tag:"mask",attributes:_t(de({},eM),{id:W,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[H,te]},fe={tag:"defs",children:[{tag:"clipPath",attributes:{id:X},children:jSe(O)},ee]};return r.push(fe,{tag:"rect",attributes:de({fill:"currentColor","clip-path":"url(#".concat(X,")"),mask:"url(#".concat(W,")")},eM)}),{children:r,attributes:s}}}},VSe={provides(e){let t=!1;Wf.matchMedia&&(t=Wf.matchMedia("(prefers-reduced-motion: reduce)").matches),e.missingIconAbstract=function(){const r=[],s={fill:"currentColor"},c={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};r.push({tag:"path",attributes:_t(de({},s),{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});const f=_t(de({},c),{attributeName:"opacity"}),_={tag:"circle",attributes:_t(de({},s),{cx:"256",cy:"364",r:"28"}),children:[]};return t||_.children.push({tag:"animate",attributes:_t(de({},c),{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:_t(de({},f),{values:"1;0;1;1;0;1;"})}),r.push(_),r.push({tag:"path",attributes:_t(de({},s),{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:t?[]:[{tag:"animate",attributes:_t(de({},f),{values:"1;0;0;0;0;1;"})}]}),t||r.push({tag:"path",attributes:_t(de({},s),{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:_t(de({},f),{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:r}}}},$Se={hooks(){return{parseNodeAttributes(e,t){const r=t.getAttribute("data-fa-symbol"),s=r===null?!1:r===""?!0:r;return e.symbol=s,e}}}},qSe=[UEe,CSe,ASe,PSe,RSe,NSe,FSe,BSe,USe,VSe,$Se];tSe(qSe,{mixoutsTo:Il});Il.noAuto;Il.config;Il.library;Il.dom;const R4=Il.parse;Il.findIconDefinition;Il.toHtml;const GSe=Il.icon;Il.layer;Il.text;Il.counter;function Q$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,s)}return r}function Mu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q$(Object(r),!0).forEach(function(s){ny(e,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q$(Object(r)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(r,s))})}return e}function fI(e){"@babel/helpers - typeof";return fI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fI(e)}function ny(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WSe(e,t){if(e==null)return{};var r={},s=Object.keys(e),c,f;for(f=0;f<s.length;f++)c=s[f],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function HSe(e,t){if(e==null)return{};var r=WSe(e,t),s,c;if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(e);for(c=0;c<f.length;c++)s=f[c],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(r[s]=e[s])}return r}function M4(e){return ZSe(e)||XSe(e)||KSe(e)||QSe()}function ZSe(e){if(Array.isArray(e))return k4(e)}function XSe(e){if(typeof Symbol!="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function KSe(e,t){if(e){if(typeof e=="string")return k4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k4(e,t)}}function k4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=e[r];return s}function QSe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YSe(e){var t,r=e.beat,s=e.fade,c=e.beatFade,f=e.bounce,_=e.shake,x=e.flash,a=e.spin,I=e.spinPulse,D=e.spinReverse,O=e.pulse,F=e.fixedWidth,H=e.inverse,Q=e.border,ie=e.listItem,te=e.flip,W=e.size,X=e.rotation,ee=e.pull,fe=(t={"fa-beat":r,"fa-fade":s,"fa-beat-fade":c,"fa-bounce":f,"fa-shake":_,"fa-flash":x,"fa-spin":a,"fa-spin-reverse":D,"fa-spin-pulse":I,"fa-pulse":O,"fa-fw":F,"fa-inverse":H,"fa-border":Q,"fa-li":ie,"fa-flip":te===!0,"fa-flip-horizontal":te==="horizontal"||te==="both","fa-flip-vertical":te==="vertical"||te==="both"},ny(t,"fa-".concat(W),typeof W!="undefined"&&W!==null),ny(t,"fa-rotate-".concat(X),typeof X!="undefined"&&X!==null&&X!==0),ny(t,"fa-pull-".concat(ee),typeof ee!="undefined"&&ee!==null),ny(t,"fa-swap-opacity",e.swapOpacity),t);return Object.keys(fe).map(function(ye){return fe[ye]?ye:null}).filter(function(ye){return ye})}function JSe(e){return e=e-0,e===e}function pX(e){return JSe(e)?e:(e=e.replace(/[\-_\s]+(.)?/g,function(t,r){return r?r.toUpperCase():""}),e.substr(0,1).toLowerCase()+e.substr(1))}var eIe=["style"];function tIe(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nIe(e){return e.split(";").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,r){var s=r.indexOf(":"),c=pX(r.slice(0,s)),f=r.slice(s+1).trim();return c.startsWith("webkit")?t[tIe(c)]=f:t[c]=f,t},{})}function mX(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof t=="string")return t;var s=(t.children||[]).map(function(a){return mX(e,a)}),c=Object.keys(t.attributes||{}).reduce(function(a,I){var D=t.attributes[I];switch(I){case"class":a.attrs.className=D,delete t.attributes.class;break;case"style":a.attrs.style=nIe(D);break;default:I.indexOf("aria-")===0||I.indexOf("data-")===0?a.attrs[I.toLowerCase()]=D:a.attrs[pX(I)]=D}return a},{attrs:{}}),f=r.style,_=f===void 0?{}:f,x=HSe(r,eIe);return c.attrs.style=Mu(Mu({},c.attrs.style),_),e.apply(void 0,[t.tag,Mu(Mu({},c.attrs),x)].concat(M4(s)))}var gX=!1;try{gX=!0}catch(e){}function rIe(){if(!gX&&console&&typeof console.error=="function"){var e;(e=console).error.apply(e,arguments)}}function Y$(e){if(e&&fI(e)==="object"&&e.prefix&&e.iconName&&e.icon)return e;if(R4.icon)return R4.icon(e);if(e===null)return null;if(e&&fI(e)==="object"&&e.prefix&&e.iconName)return e;if(Array.isArray(e)&&e.length===2)return{prefix:e[0],iconName:e[1]};if(typeof e=="string")return{prefix:"fas",iconName:e}}function tM(e,t){return Array.isArray(t)&&t.length>0||!Array.isArray(t)&&t?ny({},e,t):{}}var J$={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1},_X=Xr.forwardRef(function(e,t){var r=Mu(Mu({},J$),e),s=r.icon,c=r.mask,f=r.symbol,_=r.className,x=r.title,a=r.titleId,I=r.maskId,D=Y$(s),O=tM("classes",[].concat(M4(YSe(r)),M4((_||"").split(" ")))),F=tM("transform",typeof r.transform=="string"?R4.transform(r.transform):r.transform),H=tM("mask",Y$(c)),Q=GSe(D,Mu(Mu(Mu(Mu({},O),F),H),{},{symbol:f,title:x,titleId:a,maskId:I}));if(!Q)return rIe("Could not find icon",D),null;var ie=Q.abstract,te={ref:t};return Object.keys(r).forEach(function(W){J$.hasOwnProperty(W)||(te[W]=r[W])}),iIe(ie[0],te)});_X.displayName="FontAwesomeIcon";_X.propTypes={beat:Zr.bool,border:Zr.bool,beatFade:Zr.bool,bounce:Zr.bool,className:Zr.string,fade:Zr.bool,flash:Zr.bool,mask:Zr.oneOfType([Zr.object,Zr.array,Zr.string]),maskId:Zr.string,fixedWidth:Zr.bool,inverse:Zr.bool,flip:Zr.oneOf([!0,!1,"horizontal","vertical","both"]),icon:Zr.oneOfType([Zr.object,Zr.array,Zr.string]),listItem:Zr.bool,pull:Zr.oneOf(["right","left"]),pulse:Zr.bool,rotation:Zr.oneOf([0,90,180,270]),shake:Zr.bool,size:Zr.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:Zr.bool,spinPulse:Zr.bool,spinReverse:Zr.bool,symbol:Zr.oneOfType([Zr.bool,Zr.string]),title:Zr.string,titleId:Zr.string,transform:Zr.oneOfType([Zr.string,Zr.object]),swapOpacity:Zr.bool};var iIe=mX.bind(null,Xr.createElement);const sIe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M414-46q-32 0-55-20.5T332-118l-9-67q-5-2-10-5l-10-6-61 26q-29 12-59 2.5T137-205L71-322q-16-27-9.5-57.5T93-429l52-40v-22l-52-39q-26-19-32-49.5T71-638l66-116q16-27 45.5-37t58.5 2l64 26q5-3 9-5.5t9-4.5l9-68q4-32 27-52.5t55-20.5h132q32 0 55 20.5t27 52.5l9 68q5 2 10 4.5t10 5.5l61-26q29-12 59-2t46 37l66 116q16 28 10 58.5T867-530l-53 39v11q0 3-.5 5.5t-.5 5.5l53 39q26 19 32 49.5T888-322l-67 117q-16 27-45.5 37t-58.5-2l-62-26q-5 3-9 6t-9 5l-9 67q-4 31-27 51.5T546-46H414Zm37-126h56l15-104q32-8 61-24t51-42l98 41 27-50-83-63q5-16 8-32.5t3-33.5q0-17-3-33.5t-8-32.5l85-63-29-50-97 42q-22-26-51-43t-62-24l-13-104h-58l-12 103q-34 7-63.5 24T323-618l-96-41-28 50 82 61q-5 17-8 33.5t-3 34.5q0 17 3 34t8 34l-82 61 28 50 96-41q23 25 53 42t63 25l12 103Zm28-168q58 0 99-41t41-99q0-58-41-99t-99-41q-58 0-99 41t-41 99q0 58 41 99t99 41Zm1-140Z"})),e8=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M202.63-202.87h57.24l374.74-374.74-56.76-57-375.22 375.22v56.52Zm-45.26 91q-19.15 0-32.33-13.17-13.17-13.18-13.17-32.33v-102.26q0-18.15 6.84-34.69 6.83-16.53 19.51-29.2l501.17-500.41q12.48-11.72 27.7-17.96 15.21-6.24 31.93-6.24 16.48 0 32.2 6.24 15.71 6.24 27.67 18.72l65.28 65.56q12.48 11.72 18.34 27.56 5.86 15.83 5.86 31.79 0 16.72-5.86 32.05-5.86 15.34-18.34 27.82L324-138.22q-12.67 12.68-29.21 19.51-16.53 6.84-34.68 6.84H157.37Zm597.37-586.39-56.24-56.48 56.24 56.48Zm-148.89 92.41-28-28.76 56.76 57-28.76-28.24Z"})),yX=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"m421-443-60-60q-17-17-42-17t-42 17q-17 17-16.5 42t17.5 42l98 98q19.36 19 45.18 19T466-321l211-211q17-17 17-41.5T677-615q-17-17-42-17t-42 17L421-443Zm59 397q-91 0-169.99-34.08-78.98-34.09-137.41-92.52-58.43-58.43-92.52-137.41Q46-389 46-480q0-91 34.08-169.99 34.09-78.98 92.52-137.41 58.43-58.43 137.41-92.52Q389-914 480-914q91 0 169.99 34.08 78.98 34.09 137.41 92.52 58.43 58.43 92.52 137.41Q914-571 914-480q0 91-34.08 169.99-34.09 78.98-92.52 137.41-58.43 58.43-137.41 92.52Q571-46 480-46Zm0-126q130 0 219-89t89-219q0-130-89-219t-219-89q-130 0-219 89t-89 219q0 130 89 219t219 89Zm0-308Z"})),vX=({handleLogout:e,isNavExpanded:t})=>{const[r,s]=G.useState("placeholder.jpg"),[c,f]=G.useState("Default Name"),[_,x]=G.useState("default_username"),[a,I]=G.useState("Default Bio"),[D,O]=G.useState(!1),[F,H]=G.useState(!1),[Q,ie]=G.useState(null),[te,W]=G.useState([]);G.useState(!1);const[X,ee]=G.useState([]),[fe,ye]=G.useState(null),Ee=G.useRef(null),{showNotification:re}=f0();iEe();const he=rg(),[_e,Se]=G.useState(window.innerWidth<768),[J,Ie]=G.useState(window.innerHeight*.5),we=[{img:"/education.png",value:"education"},{img:"/food.png",value:"food"},{img:"/games.png",value:"games"},{img:"/other.png",value:"other"}];G.useEffect(()=>{const at=()=>{Se(window.innerWidth<768)};return window.addEventListener("resize",at),()=>window.removeEventListener("resize",at)},[]),G.useEffect(()=>{Zt.currentUser&&(Lt(),Gt(),qt())},[]);const Lt=()=>Be(xn,null,function*(){try{const at=yield _y(Zt.currentUser.uid);at&&(f(at.name||"Default Name"),x(at.username||"default_username"),s(at.profilePhoto||"placeholder.jpg"),I(at.bio||"Default Bio"),H(at.isPrivate||!1),W(at.tags||[]))}catch(at){console.error("Error fetching user data:",at),re("Failed to load user data","error")}}),Gt=()=>Be(xn,null,function*(){if(Zt.currentUser)try{const at=go(Ci(bn,"quests"),Ii("uid","==",Zt.currentUser.uid),Mx("createdAt","desc"),i5(5)),Et=(yield wa(at)).docs.map(Jt=>de({id:Jt.id},Jt.data()));ee(Et)}catch(at){console.error("Error fetching recent quests:",at),re("Failed to load recent quests","error")}}),qt=()=>Be(xn,null,function*(){if(Zt.currentUser)try{const at=go(Ci(bn,"quests"),Ii("uid","==",Zt.currentUser.uid),Ii("status","==","accepted")),At=yield wa(at);if(At.empty)ye(null);else{const Et=At.docs[0].data();if(Et.targetUser){const Jt=yield _y(Et.targetUser);ye(_t(de({},Et),{partnerName:(Jt==null?void 0:Jt.name)||"Unknown",partnerPhoto:(Jt==null?void 0:Jt.profilePhoto)||"placeholder.jpg",partnerUsername:(Jt==null?void 0:Jt.username)||"unknown_user"}))}else ye(Et)}}catch(at){console.error("Error fetching active quest:",at),re("Failed to load active quest","error")}}),It=()=>Be(xn,null,function*(){try{let at=r;Q&&(at=yield Age(Q)),yield Bk(Zt.currentUser.uid,{name:c,username:_,bio:a,profilePhoto:at,tags:te}),O(!1),ie(null),re("Profile updated successfully!","success")}catch(at){console.error("Error updating profile:",at),re("Failed to update profile","error")}}),ct=at=>{const At=at.target.files[0];At&&(ie(At),s(URL.createObjectURL(At)))},Ut=()=>{D&&Ee.current.click()},Kt=at=>Be(xn,null,function*(){const At=te.filter(Et=>Et!==at);W(At);try{yield Bk(Zt.currentUser.uid,{tags:At}),re("Tag removed successfully","success")}catch(Et){console.error("Error removing tag:",Et),re("Failed to remove tag","error")}});return Rb(({movement:[,at],down:At,event:Et})=>{if(_e){if(At){const Jt=window.innerHeight*.5-at;Ie(Math.max(100,Math.min(Jt,window.innerHeight-60)))}Et.preventDefault()}},{delay:0,threshold:5}),Ab({height:_e?J:"auto",config:{tension:300,friction:30}}),N.jsx(_A,{children:N.jsxs("div",{className:"prof-container",children:[N.jsxs("header",{children:[N.jsxs("div",{className:"prof",children:[N.jsxs("div",{className:"prof-picture",onClick:()=>D&&Ut(),style:D?{cursor:"pointer"}:{},children:[D&&N.jsxs(N.Fragment,{children:[N.jsx("input",{type:"file",ref:Ee,onChange:ct,style:{display:"none"}}),N.jsx(e8,{})]}),N.jsx("img",{src:r,alt:"ProfilePicture"})]}),N.jsx("div",{className:"prof-name-container",style:D?{gap:"4px"}:{},children:D?N.jsxs(N.Fragment,{children:[N.jsx("input",{type:"text",value:c,onChange:at=>f(at.target.value),className:"prof-input",placeholder:"Name"}),N.jsx("div",{children:N.jsx("input",{type:"text",value:_,onChange:at=>x(at.target.value),className:"prof-input",placeholder:"Username"})})]}):N.jsxs(N.Fragment,{children:[N.jsx("p",{className:"prof-name",children:c}),N.jsxs("p",{className:"prof-username",children:["@",_]})]})}),N.jsxs("div",{className:"prof-header-buttons",children:[D?N.jsx(yX,{onClick:It}):N.jsx(e8,{onClick:()=>O(!0)}),N.jsx(sIe,{onClick:()=>he("/home/settings")})]})]}),N.jsxs("div",{className:"prof-bio",children:[N.jsx("h3",{children:"Bio"}),D?N.jsx("textarea",{value:a,onChange:at=>I(at.target.value),className:"prof-bio-edit",placeholder:"Bio",maxLength:150}):N.jsx("p",{children:a})]})]}),N.jsxs("div",{className:"prof-body",children:[N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Tags"}),N.jsx("div",{className:"tags-container",children:te.map(at=>{var At;return N.jsxs("div",{className:"tag",children:[N.jsx("img",{src:((At=we.find(Et=>Et.value===at))==null?void 0:At.img)||"/other.png",alt:at,className:"tag-icon"}),N.jsx("button",{onClick:()=>Kt(at),children:"x"})]},at)})})]}),N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Active Quests"}),fe?N.jsxs("div",{className:"quest-item",children:[N.jsxs("p",{children:['"',fe.title,'" with']}),fe.partnerName&&N.jsxs("div",{className:"quest-partner",children:[N.jsx("img",{src:fe.partnerPhoto||"placeholder.jpg",alt:fe.partnerName,className:"partner-photo"}),N.jsxs("p",{children:[fe.partnerName," @",fe.partnerUsername]})]})]}):N.jsx("p",{className:"section-empty-msg",children:"No quests ongoing. Ready to start a new adventure?"})]}),N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Recent Quests"}),X.length>0?X.map(at=>N.jsxs("div",{className:"quest-item",children:[N.jsx("p",{children:at.title}),at.targetUser&&N.jsxs("p",{children:["with"," ",typeof at.targetUser=="string"?at.targetUser:at.targetUser.name||"Unknown User"]})]},at.id)):N.jsx("p",{className:"section-empty-msg",children:"No recent quests. Time to explore!"})]})]})]})})},oIe=Qu("div")({backgroundColor:"#000000",borderRadius:"20px",width:"90%",maxWidth:"500px",height:"90%",display:"flex",flexDirection:"column",overflow:"hidden"}),aIe=Qu("div")({position:"relative",width:"100%",height:"calc(100% - 150px)",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",backgroundColor:"#000000"}),lIe=Qu("img")({maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),cIe=Qu("div")({position:"absolute",border:"2px solid white",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"}),uIe=Qu("div")({padding:"20px",backgroundColor:"#000000"}),hIe=Qu(pbe)({display:"flex",justifyContent:"space-between",marginBottom:"20px"}),dIe=Qu(hbe)({color:"white","&.Mui-checked":{color:"white"}}),fIe=Qu(rxe)({"& .MuiFormControlLabel-label":{color:"white"}}),pIe=Qu("div")({display:"flex",justifyContent:"space-between"}),t8=Qu(fm)({flex:1,margin:"0 5px",fontWeight:"bold",borderRadius:"25px",padding:"12px 0"}),nM=[{value:"standard",label:"Standard (2:3)",width:1e3,height:1500},{value:"square",label:"Square (1:1)",width:1e3,height:1e3},{value:"long",label:"Long (1:2.1)",width:1e3,height:2100}],mIe=({photoPreview:e,onUpload:t,onCancel:r})=>{const[s,c]=G.useState("standard"),[f,_]=G.useState({x:0,y:0}),[x,a]=G.useState({width:0,height:0}),[I,D]=G.useState({width:0,height:0}),O=G.useRef(null),F=G.useRef(null),H=G.useRef(null);G.useEffect(()=>{const W=new Image;W.onload=()=>{D({width:W.width,height:W.height})},W.src=e},[e]),G.useEffect(()=>{Q()},[s,I]);const Q=()=>{if(O.current&&I.width&&I.height){const W=O.current.getBoundingClientRect(),X=nM.find(re=>re.value===s);W.width/W.height;const ee=I.width/I.height,fe=X.width/X.height;let ye,Ee;fe>ee?(ye=W.width,Ee=ye/fe):(Ee=W.height,ye=Ee*fe),a({width:ye,height:Ee}),_({x:(W.width-ye)/2,y:(W.height-Ee)/2})}},ie=W=>{W.preventDefault();const X=W.clientX-f.x,ee=W.clientY-f.y,fe=Ee=>{if(O.current&&H.current&&F.current){const re=O.current.getBoundingClientRect(),he=F.current.getBoundingClientRect();let _e=Ee.clientX-X,Se=Ee.clientY-ee;_e=Math.max(he.left-re.left,Math.min(_e,he.right-re.left-x.width)),Se=Math.max(he.top-re.top,Math.min(Se,he.bottom-re.top-x.height)),_({x:_e,y:Se})}},ye=()=>{document.removeEventListener("mousemove",fe),document.removeEventListener("mouseup",ye)};document.addEventListener("mousemove",fe),document.addEventListener("mouseup",ye)},te=()=>{if(F.current&&H.current){const W=F.current.getBoundingClientRect(),X=H.current.getBoundingClientRect(),ee={x:(X.left-W.left)/W.width,y:(X.top-W.top)/W.height,width:X.width/W.width,height:X.height/W.height},fe=nM.find(ye=>ye.value===s);t(ee,`${fe.width}:${fe.height}`)}};return N.jsxs(oIe,{children:[N.jsxs(aIe,{ref:O,children:[N.jsx(lIe,{ref:F,src:e,alt:"Preview"}),N.jsx(cIe,{ref:H,style:{width:`${x.width}px`,height:`${x.height}px`,left:`${f.x}px`,top:`${f.y}px`},onMouseDown:ie})]}),N.jsxs(uIe,{children:[N.jsx(hIe,{row:!0,"aria-label":"aspect-ratio",name:"aspect-ratio",value:s,onChange:W=>c(W.target.value),children:nM.map(W=>N.jsx(fIe,{value:W.value,control:N.jsx(dIe,{}),label:W.label},W.value))}),N.jsxs(pIe,{children:[N.jsx(t8,{onClick:te,variant:"contained",color:"primary",children:"Done"}),N.jsx(t8,{onClick:r,variant:"outlined",children:"Cancel"})]})]})]})};function _A({children:e}){return N.jsxs("div",{className:"navigation-modal-container",children:[N.jsx(jI,{className:"navigation-modal-bg",to:"/home"}),N.jsx("div",{className:"navigation-modal",children:e})]})}const gIe=e=>{e.getLayer("route")&&e.removeLayer("route"),e.getSource("route")&&e.removeSource("route")},xX=({currentUserIds:e,map:t,setLockedUserId:r,lockedUserId:s,lockedUserData:c,isCreateQuestOpen:f,setIsCreateQuestOpen:_})=>{console.log("Quests component rendering"),G.useState(!1);const[x,a]=G.useState(""),[I,D]=G.useState(""),[O,F]=G.useState(""),[H,Q]=G.useState([]),[ie,te]=G.useState(""),[W,X]=G.useState([]),[ee,fe]=G.useState(null),[ye,Ee]=G.useState(!1),[re,he]=G.useState(!1),[_e,Se]=G.useState(null),[J,Ie]=G.useState(null),[we,Lt]=G.useState(null),[Gt,qt]=G.useState({acceptors:[],pendingAcceptors:[]}),[It,ct]=G.useState(!1);G.useState(null),G.useState(!1);const[Ut,Kt]=G.useState([]),[at,At]=G.useState("public"),[Et,Jt]=G.useState(window.innerHeight*.5),{showNotification:Bt}=f0();G.useEffect(()=>{Be(xn,null,function*(){try{const Ye=go(Ci(bn,"users")),gt=Gh(Ye,Qe=>{if(Qe.empty){console.error("No users found."),X([]);return}const pt=Qe.docs.map(dt=>de({id:dt.id},dt.data()));X(pt)});return()=>gt()}catch(Ye){console.error("Error fetching users:",Ye)}})},[]),G.useEffect(()=>{Zt.currentUser&&Be(xn,null,function*(){try{const Ye=go(Ci(bn,"quests"),Ii("isPublic","==",!0)),gt=go(Ci(bn,"quests"),Ii("uid","==",Zt.currentUser.uid)),Qe=go(Ci(bn,"quests"),Ii("targetUser","==",Zt.currentUser.uid)),[pt,dt,sn]=yield Promise.all([wa(Ye),wa(gt),wa(Qe)]),Wt=pt.docs.map(Yr=>de({id:Yr.id},Yr.data())),pn=dt.docs.map(Yr=>de({id:Yr.id},Yr.data())),Sn=yield Promise.all(sn.docs.map(Yr=>Be(xn,null,function*(){const Li=Yr.data(),Nr=yield Ki(er(bn,"users",Li.uid)),di=Nr.exists()?Nr.data():{};return _t(de({id:Yr.id},Li),{senderName:di.name||"Unknown sender"})}))),gr=[...Wt,...pn,...Sn],xi=new Map(gr.map(Yr=>[Yr.id,Yr]));Q(Array.from(xi.values()))}catch(Ye){console.error("Error fetching quests:",Ye)}})},[Zt.currentUser,Bt,W]),W.filter(Ue=>Ue.name.toLowerCase().includes(ie.toLowerCase()));const Pn=()=>Be(xn,null,function*(){if(Zt.currentUser){if(!_e){console.error("Pending quest is null.");return}try{const Ue=er(Ci(bn,"quests"));if(_e.isPublic)yield Rm(Ue,_t(de({},_e),{id:Ue.id,uid:Zt.currentUser.uid,acceptedBy:[],pendingAcceptors:[]}));else{if(!_e.targetUser){console.error("Target user is missing in the quest");return}const Ye=go(Ci(bn,"quests"),Ii("uid","==",Zt.currentUser.uid),Ii("targetUser","==",_e.targetUser),Ii("title","==",_e.title),Ii("description","==",_e.description),Ii("isPublic","==",!1));if(!(yield wa(Ye)).empty){Bt("A similar private quest already exists for this user.","info");return}yield Rm(Ue,_t(de({},_e),{id:Ue.id,uid:Zt.currentUser.uid,acceptedBy:[],pendingAcceptors:[]}))}Bt("Quest created!","success"),Se(null),he(!1),a(""),D(""),F(""),fe(null),te(""),Ee(!1)}catch(Ue){console.error("Error creating quest:",Ue),Bt("Failed to create quest.","error")}}}),$n=Ue=>Be(xn,null,function*(){if(Zt.currentUser)try{const Ye=er(bn,"quests",Ue),Qe=(yield Ki(Ye)).data();if(!Qe.isPublic&&Qe.targetUser===Zt.currentUser.uid)yield V1(Ye),Q(H.filter(pt=>pt.id!==Ue)),Bt("Quest declined!","success");else if(Qe.isPublic)yield ss(Ye,{declinedBy:gy(Zt.currentUser.uid)}),Q(H.filter(pt=>pt.id!==Ue)),Bt("Quest declined!","success");else{const pt=Qe.acceptedBy.filter(dt=>dt!==Zt.currentUser.uid);yield ss(Ye,{acceptedBy:pt}),Q(H.map(dt=>dt.id===Ue?_t(de({},dt),{acceptedBy:pt}):dt)),Bt("Quest declined!","success")}}catch(Ye){console.error("Error declining quest:",Ye),Bt("Failed to decline quest.","error")}}),Qn=Ue=>Be(xn,null,function*(){if(!Zt.currentUser){console.error("No authenticated user"),Bt("You must be logged in to accept quests.","error");return}if(!Ue.id){console.error("Quest ID is missing"),Bt("Invalid quest. Please try again.","error");return}try{const Ye=er(bn,"quests",Ue.id),gt=yield Ki(Ye);if(!gt.exists()){console.error("Quest does not exist"),Bt("This quest no longer exists.","error");return}const Qe=gt.data();let pt=_t(de({},Qe),{status:Ue.isPublic?"pending":"accepted"});Ue.isPublic?pt.pendingAcceptors=gy(Zt.currentUser.uid):pt.acceptedBy=Zt.currentUser.uid;const dt=yield Ki(er(bn,"users",Ue.uid)),sn=yield Ki(er(bn,"users",Zt.currentUser.uid));if(!dt.exists()||!sn.exists()){console.error("Sender or receiver data not found"),Bt("Unable to process quest. User data missing.","error");return}const Wt=dt.data(),pn=sn.data();if(!Wt.location||!pn.location?(console.error("Sender or receiver location missing"),Bt("Location data is missing. Unable to display route.","warning")):pt.routeInfo={senderLocation:Wt.location,receiverLocation:pn.location},yield ss(Ye,pt),Q(Sn=>Sn.map(gr=>gr.id===Ue.id?pt:gr)),Ue.isPublic||(Kt(Sn=>[...Sn,pt]),pt.routeInfo&&t&&Xt(t,pt.routeInfo.senderLocation,pt.routeInfo.receiverLocation)),Bt("Quest accepted!","success"),Ue.isPublic){const Sn=er(Ci(bn,"notifications"));yield Rm(Sn,{type:"quest_accepted",questId:Ue.id,recipientId:Ue.uid,senderId:Zt.currentUser.uid,content:`${Zt.currentUser.displayName||"Someone"} has accepted your quest: ${Ue.title}`,createdAt:new Date,read:!1})}}catch(Ye){console.error("Error accepting quest:",Ye),Bt("Failed to accept quest. Please try again.","error")}}),Xt=G.useCallback((Ue,Ye)=>{if(!t||!t.loaded()){console.error("Map is not fully loaded");return}if(!Ue||!Ye){console.error("Invalid locations for route display");return}const gt=`https://api.mapbox.com/directions/v5/mapbox/walking/${Ue.longitude},${Ue.latitude};${Ye.longitude},${Ye.latitude}?geometries=geojson&access_token=${Qm.accessToken}`;fetch(gt).then(Qe=>Qe.json()).then(Qe=>{if(!Qe.routes||Qe.routes.length===0){console.error("No route found in the response");return}const pt=Qe.routes[0].geometry;t.getSource("route")?t.getSource("route").setData(pt):t.addLayer({id:"route",type:"line",source:{type:"geojson",data:pt},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00FFFF","line-width":5,"line-opacity":.75}});const dt=new Qm.LngLatBounds().extend([Ue.longitude,Ue.latitude]).extend([Ye.longitude,Ye.latitude]);t.fitBounds(dt,{padding:50})}).catch(Qe=>{console.error("Error fetching or displaying route:",Qe)})},[t]);G.useEffect(()=>{if(Zt.currentUser&&t){const Ue=Gh(go(Ci(bn,"quests"),Ii("status","in",["approved","accepted"]),Ii("uid","==",Zt.currentUser.uid)),Ye=>{const gt=Ye.docs.map(Qe=>de({id:Qe.id},Qe.data()));Kt(gt),gt.forEach(Qe=>{!Qe.isPublic&&Qe.routeInfo&&Xt(Qe.routeInfo.senderLocation,Qe.routeInfo.receiverLocation)})});return()=>Ue()}},[Zt.currentUser,t,Xt]);const mr=(Ue,Ye)=>Be(xn,null,function*(){if(console.log("Approving acceptor:",Ye),!Ye||!Ye.id){console.error("Selected acceptor is not defined or missing id."),Bt("Invalid acceptor data.","error");return}try{const gt=er(bn,"quests",Ue),Qe=yield Ki(gt);if(!Qe.exists()){console.error("Quest document does not exist."),Bt("Quest not found.","error");return}const pt=Qe.data(),dt=_t(de({},pt),{pendingAcceptors:Nk(Ye.id),acceptedBy:gy(Ye.id),targetUser:Ye.id,status:"approved"});if(Zt.currentUser){const sn=er(bn,"users",Zt.currentUser.uid),Wt=er(bn,"users",Ye.id),[pn,Sn]=yield Promise.all([Ki(sn),Ki(Wt)]);if(pn.exists()&&Sn.exists()){const gr=pn.data(),xi=Sn.data();gr.location&&xi.location&&(dt.routeInfo={senderLocation:gr.location,receiverLocation:xi.location})}}yield ss(gt,dt),Q(sn=>sn.map(Wt=>Wt.id===Ue?de(de({},Wt),dt):Wt)),Kt(sn=>[...sn,_t(de(de({},pt),dt),{id:Ue})]),dt.routeInfo&&t&&Xt(t,dt.routeInfo.senderLocation,dt.routeInfo.receiverLocation),Bt(`Quest approved for ${Ye.name}!`,"success"),ct(!1)}catch(gt){console.error("Error approving acceptor:",gt),Bt("Failed to approve acceptor.","error")}}),An=Ue=>Be(xn,null,function*(){try{const Ye=er(bn,"quests",Ue);yield V1(Ye),Q(H.filter(gt=>gt.id!==Ue)),Kt(Ut.filter(gt=>gt.id!==Ue)),t&&gIe(t),Bt("Quest completed and deleted!","success")}catch(Ye){console.error("Error completing quest:",Ye),Bt("Failed to complete quest.","error")}}),cr=Ue=>Be(xn,null,function*(){try{const Ye=er(bn,"quests",Ue);yield V1(Ye),Q(H.filter(gt=>gt.id!==Ue)),Bt("Quest canceled!","success")}catch(Ye){console.error("Error canceling quest:",Ye),Bt("Failed to cancel quest.","error")}}),zr=Ue=>Be(xn,null,function*(){try{const Ye=er(bn,"quests",Ue.id),Qe=(yield Ki(Ye)).data(),pt=Qe.acceptedBy||[],dt=Qe.pendingAcceptors||[],sn=yield Promise.all(pt.map(pn=>Be(xn,null,function*(){const Sn=yield Ki(er(bn,"users",pn));return de({id:pn},Sn.data())}))),Wt=yield Promise.all(dt.map(pn=>Be(xn,null,function*(){const Sn=yield Ki(er(bn,"users",pn));return de({id:pn},Sn.data())})));qt({acceptors:sn,pendingAcceptors:Wt}),Lt(Ue),ct(!0)}catch(Ye){console.error("Error fetching acceptors:",Ye),Bt("Failed to fetch acceptors.","error")}}),qn=H.filter(Ue=>{var Ye,gt,Qe,pt;return Ue.isPublic?Ue.uid===((Ye=Zt.currentUser)==null?void 0:Ye.uid)||Ue.approvedUser===((gt=Zt.currentUser)==null?void 0:gt.uid):Ue.targetUser===((Qe=Zt.currentUser)==null?void 0:Qe.uid)||Ue.uid===((pt=Zt.currentUser)==null?void 0:pt.uid)}),Mr=(Ue,Ye)=>Be(xn,null,function*(){try{const gt=er(bn,"quests",Ue.id);yield ss(gt,{acceptedBy:Ye.id,pendingAcceptors:[]}),Q(H.map(Qe=>Qe.id===Ue.id?_t(de({},Qe),{acceptedBy:Ye.id,pendingAcceptors:[]}):Qe)),qt([]),Bt(`Quest assigned to ${Ye.name}!`,"success")}catch(gt){console.error("Error selecting acceptor:",gt),Bt("Failed to assign quest.","error")}}),Vr=()=>{Ie(null)},kn=()=>{switch(at){case"public":return N.jsx("div",{className:"quests-column",children:qn.filter(Ue=>{var Ye;return Ue.isPublic&&(!Ue.declinedBy||!Ue.declinedBy.includes((Ye=Zt.currentUser)==null?void 0:Ye.uid))}).length>0?qn.filter(Ue=>{var Ye;return Ue.isPublic&&(!Ue.declinedBy||!Ue.declinedBy.includes((Ye=Zt.currentUser)==null?void 0:Ye.uid))}).map(Ue=>{var Qe,pt,dt,sn,Wt;const gt=(W.find(pn=>pn.id===Ue.uid)||{}).name||"";return N.jsxs("div",{className:"quest-item",children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Title:"})," ",Ue.title]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Description:"})," ",Ue.description]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Time Frame:"})," ",Ue.timeFrame]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Sender:"})," ",gt]}),Ue.isPublic&&((Qe=Zt.currentUser)==null?void 0:Qe.uid)!==Ue.uid&&!(Array.isArray(Ue.acceptedBy)&&Ue.acceptedBy.includes((pt=Zt.currentUser)==null?void 0:pt.uid))&&!(Array.isArray(Ue.pendingAcceptors)&&Ue.pendingAcceptors.includes((dt=Zt.currentUser)==null?void 0:dt.uid))&&N.jsxs("div",{className:"quest-actions",children:[N.jsx("button",{className:"confirm-button",onClick:()=>Qn(Ue),children:"Accept"}),N.jsx("button",{className:"cancel-button",onClick:()=>$n(Ue.id),children:"Decline"})]}),Ue.uid===((sn=Zt.currentUser)==null?void 0:sn.uid)&&N.jsxs("div",{className:"quest-actions",children:[N.jsx("button",{className:"select-button",onClick:()=>zr(Ue),children:"View Pending Acceptors"}),N.jsx("button",{className:"cancel-button",onClick:()=>cr(Ue.id),children:"Cancel Quest"})]}),Array.isArray(Ue.acceptedBy)&&Ue.acceptedBy.includes((Wt=Zt.currentUser)==null?void 0:Wt.uid)&&N.jsx("div",{className:"quest-actions",children:N.jsx("button",{className:"confirm-button",onClick:()=>An(Ue.id),children:"Complete"})})]},Ue.id)}):N.jsx("p",{children:"No public quests."})});case"received":return N.jsx("div",{className:"quests-column",children:H.filter(Ue=>{var Ye;return Ue.targetUser===((Ye=Zt.currentUser)==null?void 0:Ye.uid)&&!Ue.isPublic}).length>0?H.filter(Ue=>{var Ye;return Ue.targetUser===((Ye=Zt.currentUser)==null?void 0:Ye.uid)&&!Ue.isPublic}).map(Ue=>{var dt,sn,Wt,pn;const gt=(W.find(Sn=>Sn.id===Ue.uid)||{}).name||"",Qe=Ue.targetUser===((dt=Zt.currentUser)==null?void 0:dt.uid),pt=Ue.uid===((sn=Zt.currentUser)==null?void 0:sn.uid);return N.jsxs("div",{className:"quest-item",children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Title:"})," ",Ue.title]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Description:"})," ",Ue.description]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Time Frame:"})," ",Ue.timeFrame]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Sender:"})," ",gt]}),Qe&&Ue.status==="accepted"&&N.jsxs("div",{className:"quest-actions",children:[N.jsx("button",{className:"confirm-button",onClick:()=>An(Ue.id),children:"Complete"}),N.jsx("button",{className:"cancel-button",onClick:()=>cr(Ue.id),children:"Cancel"})]}),Qe&&Ue.status==="pending"&&N.jsxs("div",{className:"quest-actions",children:[N.jsx("button",{className:"confirm-button",onClick:()=>Qn(Ue),children:"Accept"}),N.jsx("button",{className:"cancel-button",onClick:()=>$n(Ue.id),children:"Decline"})]}),pt&&N.jsxs("p",{children:["Status: ",Ue.status]}),Ue.acceptedBy&&N.jsxs("div",{children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Accepted By:"})," ",((Wt=W.find(Sn=>Sn.id===Ue.acceptedBy))==null?void 0:Wt.name)||"Pending acceptance"]}),N.jsx("img",{src:((pn=W.find(Sn=>Sn.id===Ue.acceptedBy))==null?void 0:pn.profilePhotoUrl)||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},Ue.id)}):N.jsx("p",{children:"No received quests."})});case"sent":return N.jsx("div",{className:"quests-column",children:H.filter(Ue=>{var Ye;return Ue.uid===((Ye=Zt.currentUser)==null?void 0:Ye.uid)&&!Ue.isPublic}).length>0?H.filter(Ue=>{var Ye;return Ue.uid===((Ye=Zt.currentUser)==null?void 0:Ye.uid)&&!Ue.isPublic}).map(Ue=>{const Ye=W.find(pt=>pt.id===Ue.acceptedBy)||{},gt=Ye.name||"",Qe=W.filter(pt=>Ue.pendingAcceptors&&Ue.pendingAcceptors.includes(pt.id));return N.jsxs("div",{className:"quest-item",children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Title:"})," ",Ue.title]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Description:"})," ",Ue.description]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Time Frame:"})," ",Ue.timeFrame]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Status:"})," ",Ue.status]}),Qe.length>0&&N.jsxs("div",{children:[N.jsx("p",{children:N.jsx("strong",{children:"Pending Acceptors:"})}),N.jsx("ul",{children:Qe.map(pt=>N.jsxs("li",{onClick:()=>Mr(Ue,pt),children:[pt.name,N.jsx("img",{src:pt.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]},pt.id))})]}),Ue.acceptedBy&&N.jsxs("div",{children:[N.jsxs("p",{children:[N.jsx("strong",{children:"Accepted By:"})," ",gt]}),N.jsx("img",{src:Ye.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},Ue.id)}):N.jsx("p",{children:"No sent quests."})});default:return null}},zn=Rb(({movement:[,Ue],down:Ye})=>{if(Ye){const gt=window.innerHeight*.5-Ue;Jt(Math.max(100,Math.min(gt,window.innerHeight-60)))}});return Ab({height:Et,config:{tension:300,friction:30}}),N.jsx(_A,{children:N.jsxs("div",{className:"quests-page",children:[N.jsx("div",de({className:"drag-handle"},zn())),N.jsx("div",{className:"quests-header",children:N.jsx("h1",{children:"Quests"})}),N.jsxs("div",{className:"tab-container",children:[N.jsx("button",{className:`tab-button ${at==="public"?"selected":""}`,onClick:()=>At("public"),children:"Public"}),N.jsx("button",{className:`tab-button ${at==="received"?"selected":""}`,onClick:()=>At("received"),children:"Received"}),N.jsx("button",{className:`tab-button ${at==="sent"?"selected":""}`,onClick:()=>At("sent"),children:"Sent"})]}),kn(),re&&_e&&N.jsx("div",{className:"modal-overlay",children:N.jsxs("div",{className:"modal confirmation-dialog",children:[N.jsx("h3",{children:"Confirm Quest Sending"}),N.jsx("p",{children:"Are you sure you want to send the quest with the following details?"}),N.jsxs("p",{children:[N.jsx("strong",{children:"Title:"})," ",_e.title]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Description:"})," ",_e.description]}),N.jsxs("p",{children:[N.jsx("strong",{children:"Time Frame:"})," ",_e.timeFrame]}),N.jsxs("div",{className:"modal-actions",children:[N.jsx("button",{className:"confirm-button",onClick:Pn,children:"Confirm"}),N.jsx("button",{className:"cancel-button",onClick:()=>he(!1),children:"Cancel"})]})]})}),J&&N.jsx("div",{className:"modal-overlay",children:N.jsxs("div",{className:"modal profile-popup",children:[N.jsx("button",{className:"close-button",onClick:Vr,children:"X"}),N.jsx("h3",{children:J.name}),N.jsx("img",{src:J.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"profile-pic"}),N.jsxs("p",{children:[N.jsx("strong",{children:"Bio:"})," ",J.bio]})]})}),It&&N.jsx("div",{className:"modal-overlay",children:N.jsxs("div",{className:"modal acceptors-modal",children:[N.jsx("h3",{children:"Accepted By"}),N.jsx("ul",{children:Gt.acceptors.map((Ue,Ye)=>N.jsx("li",{children:Ue.name},Ye))}),N.jsx("h3",{children:"Pending Acceptors"}),N.jsx("ul",{children:Gt.pendingAcceptors.map((Ue,Ye)=>N.jsx("li",{onClick:()=>mr(we.id,Ue),className:"selectable-user",children:Ue.name},Ye))}),N.jsx("button",{className:"close-button",onClick:()=>ct(!1),children:"Close"})]})})]})})},_Ie=({isOpen:e,quests:t,currentUserIds:r,map:s})=>N.jsx("div",{className:`quests-window ${e?"show-section":"hide-section"}`,children:N.jsx(xX,{quests:t,currentUserIds:r,map:s})}),bX={"--background-color":"rgb(33,33,35)","--text-color":"#ffffff","--accent-color":"#0a91ff","--nav-background":"#1a1a1a","--card-background":"#2c2c2c","--hover-color":"#3a3a3a","--border-color":"#333333"},wX={"--background-color":"#f5f5f5","--text-color":"#333333","--accent-color":"#3c68c6","--nav-background":"#ffffff","--card-background":"#ffffff","--hover-color":"#e0e0e0","--border-color":"#e0e0e0"},yIe="mapbox://styles/mapbox/dark-v10",vIe="mapbox://styles/mapbox/light-v10";function D4(e){for(let[t,r]of Object.entries(e))document.documentElement.style.setProperty(t,r)}function TX(e,t){e&&e.setStyle&&e.setStyle(t?vIe:yIe)}function EX(){const e=document.body.classList.toggle("light-mode");D4(e?wX:bX),localStorage.setItem("theme",e?"light":"dark");const r=window.currentMap;TX(r,e),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{isLightMode:e}}))}function SX(){const t=localStorage.getItem("theme")==="light";t?(D4(wX),document.body.classList.add("light-mode")):D4(bX);const r=window.currentMap;TX(r,t)}function O4(){return document.body.classList.contains("light-mode")?"light":"dark"}const xIe="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";Qm.accessToken=xIe;const n8="mapbox://styles/kyim50/clzniqnmq009s01qgee0a13s0",r8="mapbox://styles/mapbox/light-v10",B_=({address:e,setAddress:t,setCurrentUserIds:r,setMap:s,activeSection:c,lockedUser:f,showAddressBar:_,isFullScreen:x})=>{const a=G.useRef(null),I=G.useRef(null),[D,O]=G.useState(!1),[F,H]=G.useState([]),Q=G.useRef({}),ie=G.useCallback(()=>{if(!I.current){const te=JSON.parse(localStorage.getItem("mapState")),W=O4();I.current=new Qm.Map({container:a.current,style:W==="light"?r8:n8,center:(te==null?void 0:te.center)||[0,0],zoom:(te==null?void 0:te.zoom)||2,attributionControl:!1}),I.current.on("load",()=>{O(!0),s(I.current),window.currentMap=I.current}),I.current.on("moveend",()=>{const X=I.current.getCenter(),ee=I.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:X,zoom:ee}))})}},[s]);return G.useEffect(()=>(ie(),SX(),()=>{if(I.current){const te=I.current.getCenter(),W=I.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:te,zoom:W})),I.current.remove(),I.current=null,window.currentMap=null}}),[ie]),G.useEffect(()=>{const te=W=>{const{isLightMode:X}=W.detail;I.current&&D&&I.current.setStyle(X?r8:n8)};return window.addEventListener("themeChanged",te),()=>{window.removeEventListener("themeChanged",te)}},[D]),G.useEffect(()=>{let te;return D&&I.current&&(nEe(I.current,t),te=OZ(I.current,(W,X)=>{H(W),r(W),Q.current=X})),()=>{te&&te()}},[D,t,r]),G.useEffect(()=>{if(I.current&&D){const te=()=>{I.current.resize()};return te(),window.addEventListener("resize",te),()=>window.removeEventListener("resize",te)}},[D,c,x]),G.useEffect(()=>{I.current&&D&&f&&(p4(I.current,f),Object.keys(Q.current).forEach(te=>{const X=Q.current[te].getElement(),ee=X.querySelector(".lock-indicator");if(te===f){if(!ee){const fe=document.createElement("div");fe.className="lock-indicator",X.appendChild(fe)}}else ee&&X.removeChild(ee)}))},[D,f]),N.jsxs(N.Fragment,{children:[N.jsx("div",{ref:a,className:`map-placeholder ${x?"full-screen":""}`,style:{width:"100%",height:"100%"}}),_&&N.jsx("div",{className:"address-bar",id:"address-bar",children:e})]})},bIe=({activeSection:e,showSection:t,logo:r,title:s})=>{const c=[{id:"home",icon:"/home.png",label:"Feed"},{id:"profile",icon:"/user-avatar.png",label:"Profile"},{id:"connections",icon:"/happy.png",label:"Connections"},{id:"quests",icon:"/letter.png",label:"Quests"},{id:"privacy",icon:"/privacy1.png",label:"Privacy"}];return N.jsxs("div",{className:"nav-bar",children:[N.jsxs("div",{className:"nav-header",children:[N.jsx("img",{src:r,alt:"Quests Logo",className:"qlogo"}),N.jsx("span",{className:"nav-title",children:s})]}),N.jsx("nav",{children:c.map(f=>N.jsxs("button",{onClick:()=>t(f.id),className:`nav-button ${e===f.id?"active":""}`,children:[N.jsx("img",{src:f.icon,alt:f.label}),N.jsx("span",{children:f.label})]},f.id))})]})},rM="/assets/chatbubble-DDibP9i3.png",IX=({currentUserIds:e,map:t,setLockedUserId:r,lockedUserId:s,lockedUserData:c})=>{const[f,_]=G.useState([]),[x,a]=G.useState([]),[I,D]=G.useState([]),[O,F]=G.useState(null),[H,Q]=G.useState(""),[ie,te]=G.useState(""),[W,X]=G.useState(null),[ee,fe]=G.useState([]),[ye,Ee]=G.useState(""),[re,he]=G.useState([]),[_e,Se]=G.useState(!1),[J,Ie]=G.useState(null),[we,Lt]=G.useState(null),[Gt,qt]=G.useState("friends"),[It,ct]=G.useState(window.innerHeight*.5),Ut=G.useCallback(()=>Be(xn,null,function*(){if(!Zt.currentUser){console.error("User is not authenticated");return}const Ue=Ci(bn,"users"),Ye=go(Ue,Ii("isActive","==",!0)),Qe=(yield wa(Ye)).docs.map(pt=>de({id:pt.id},pt.data())).filter(pt=>pt.id!==Zt.currentUser.uid&&!x.some(dt=>dt.id===pt.id)&&e.includes(pt.id));_(Qe)}),[x,e]),Kt=G.useCallback(()=>Be(xn,null,function*(){if(!Zt.currentUser){console.error("User is not authenticated");return}try{const Ue=er(bn,"users",Zt.currentUser.uid),gt=(yield Ki(Ue)).data(),Qe=(gt==null?void 0:gt.friends)||[],pt=yield Promise.all(Qe.map(dt=>Be(xn,null,function*(){const sn=er(bn,"users",dt),Wt=yield Ki(sn);return de({id:dt},Wt.data())})));a(pt)}catch(Ue){console.error("Error fetching friends:",Ue)}}),[]);G.useEffect(()=>{if(!Zt.currentUser){console.error("User is not authenticated");return}const Ue=Gh(Ci(bn,"friend_requests"),Ye=>Be(xn,null,function*(){const gt=Ye.docs.map(Wt=>de({id:Wt.id},Wt.data())),Qe=gt.filter(Wt=>Wt.status==="pending"&&Wt.receiverId===Zt.currentUser.uid),dt=gt.filter(Wt=>Wt.status==="accepted"&&(Wt.senderId===Zt.currentUser.uid||Wt.receiverId===Zt.currentUser.uid)).map(Wt=>Wt.senderId===Zt.currentUser.uid?Wt.receiverId:Wt.senderId);Kt().then(()=>{a(Wt=>Wt.filter(pn=>dt.includes(pn.id)))});const sn=yield Promise.all(Qe.map(Wt=>Be(xn,null,function*(){const pn=er(bn,"users",Wt.senderId),gr=(yield Ki(pn)).data();return{id:Wt.id,senderId:Wt.senderId,senderName:(gr==null?void 0:gr.name)||"User",senderPhoto:(gr==null?void 0:gr.profilePhoto)||"default_photo_url"}})));D(sn),Ut()}));return Kt(),()=>Ue()},[Ut,Kt]);const at=Ue=>Be(xn,null,function*(){if(console.log("Attempting to send friend request to:",Ue),!Ue){console.error("Receiver ID is undefined.");return}try{const Ye=go(Ci(bn,"friend_requests"),Ii("senderId","==",Zt.currentUser.uid),Ii("receiverId","==",Ue),Ii("status","==","pending"));if(!(yield wa(Ye)).empty){console.log("Friend request already exists"),te("Friend request already exists!");return}yield kx(Ci(bn,"friend_requests"),{senderId:Zt.currentUser.uid,senderName:Zt.currentUser.displayName,senderPhoto:Zt.currentUser.photoURL,receiverId:Ue,status:"pending",timestamp:$S()}),te("Friend request sent!")}catch(Ye){console.error("Error sending friend request:",Ye)}}),At=(Ue,Ye)=>Be(xn,null,function*(){try{yield ss(er(bn,"friend_requests",Ue),{status:"accepted"}),yield ss(er(bn,"users",Zt.currentUser.uid),{friends:gy(Ye)}),yield ss(er(bn,"users",Ye),{friends:gy(Zt.currentUser.uid)}),te("Friend request accepted!"),Kt()}catch(gt){console.error("Error accepting friend request:",gt)}}),Et=Ue=>Be(xn,null,function*(){try{yield V1(er(bn,"friend_requests",Ue)),te("Friend request declined!")}catch(Ye){console.error("Error declining friend request:",Ye)}}),Jt=Ue=>Be(xn,null,function*(){try{yield ss(er(bn,"users",Zt.currentUser.uid),{friends:Nk(Ue)}),yield ss(er(bn,"users",Ue),{friends:Nk(Zt.currentUser.uid)}),a(Ye=>Ye.filter(gt=>gt.id!==Ue)),te("Friend removed!")}catch(Ye){console.error("Error removing friend:",Ye)}}),Bt=Ue=>Be(xn,null,function*(){if(we===Ue.id)Lt(null),t&&Zt.currentUser&&(p4(t,Zt.currentUser.uid),setTimeout(()=>t.resize(),300));else{Lt(Ue.id);const gt=(yield Ki(er(bn,"users",Ue.id))).data();gt&&gt.location&&t&&(p4(t,Ue.id),setTimeout(()=>t.resize(),300))}}),Pn=()=>{F(null)},$n=Ue=>{Q(Ue.target.value)},Qn=Ue=>{X(Ue),An(Ue.id),mr(Ue)},Xt=()=>{X(null),fe([])},mr=Ue=>{he(Ye=>{const gt=Ye.filter(Qe=>Qe.id!==Ue.id);return[Ue,...gt]})},An=Ue=>Be(xn,null,function*(){if(!Zt.currentUser){console.error("User is not authenticated");return}const Ye=Ci(bn,"messages"),gt=go(Ye,Ii("senderId","in",[Zt.currentUser.uid,Ue]),Ii("receiverId","in",[Zt.currentUser.uid,Ue]),Mx("timestamp","desc"),i5(20)),pt=(yield wa(gt)).docs.map(dt=>de({id:dt.id},dt.data())).reverse();fe(pt)}),cr=()=>Be(xn,null,function*(){if(ye.trim())try{yield kx(Ci(bn,"messages"),{senderId:Zt.currentUser.uid,receiverId:W.id,content:ye,timestamp:$S()}),Ee(""),mr(W)}catch(Ue){console.error("Error sending message:",Ue)}}),zr=Ue=>{Ee(Ue.target.value),J&&clearTimeout(J),ss(er(bn,"users",Zt.currentUser.uid),{isTyping:!0});const Ye=setTimeout(()=>{ss(er(bn,"users",Zt.currentUser.uid),{isTyping:!1})},2e3);Ie(Ye)};G.useEffect(()=>{if(W){const Ue=Gh(go(Ci(bn,"messages"),Ii("senderId","in",[Zt.currentUser.uid,W.id]),Ii("receiverId","in",[Zt.currentUser.uid,W.id]),Mx("timestamp")),gt=>{const Qe=gt.docs.map(pt=>de({id:pt.id},pt.data()));fe(Qe)}),Ye=Gh(er(bn,"users",W.id),gt=>{const Qe=gt.data();Qe&&Qe.isTyping?Se(!0):Se(!1)});return()=>{Ue(),Ye()}}},[W]);const qn=f.filter(Ue=>Ue.name.toLowerCase().includes(H.toLowerCase())),Mr=()=>{if(!we)return null;const Ue=f.find(Ye=>Ye.id===we)||x.find(Ye=>Ye.id===we);return Ue?(x.some(Ye=>Ye.id===Ue.id),N.jsxs("div",{className:"profile-container",children:[N.jsxs("div",{className:"profile-header",children:[N.jsx("div",{className:"profile-photo-container",children:N.jsx("img",{src:Ue.profilePhoto,alt:"Profile",className:"profile-photo"})}),N.jsxs("div",{className:"profile-name-status",children:[N.jsx("h2",{className:"profile-name",children:Ue.name}),N.jsxs("p",{className:"profile-status",children:[N.jsx("span",{className:"status-dot"})," Active"]})]})]}),N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Bio"}),N.jsx("p",{className:"profile-bio",children:Ue.bio||"No bio available"})]}),N.jsxs("div",{className:"profile-section",children:[N.jsx("h3",{className:"section-title",children:"Tags"}),N.jsx("div",{className:"tags-container",children:Ue.tags&&Ue.tags.map(Ye=>N.jsx("div",{className:"tag",children:Ye},Ye))})]}),N.jsxs("div",{className:"profile-actions",children:[N.jsx("button",{className:"add-friend-btn1",onClick:()=>at(Ue.id),children:"Add Friend"}),N.jsx("button",{className:"chat-btn2",onClick:()=>Qn(Ue),children:N.jsx("img",{src:rM,alt:"Chat",className:"icon-img"})})]}),N.jsx("button",{className:"unlock-btn1",onClick:()=>Lt(null),children:"Unlock User"})]})):null},Vr=()=>{switch(Gt){case"friends":return N.jsxs("section",{className:"friends-section",children:[I.length>0&&N.jsx("h2",{children:"Pending"}),I.map(Ue=>N.jsxs("div",{className:"pending-request",children:[N.jsx("img",{src:Ue.senderPhoto,alt:"User"}),N.jsx("div",{children:Ue.senderName}),N.jsxs("div",{className:"button-group",children:[N.jsx("button",{className:"accept-btn",onClick:()=>At(Ue.id,Ue.senderId),children:"Accept"}),N.jsx("button",{className:"decline-btn",onClick:()=>Et(Ue.id),children:"Decline"})]})]},Ue.id)),N.jsx("h2",{children:"All"}),x.map(Ue=>N.jsxs("div",{className:"friend-item1",onClick:()=>Bt(Ue),children:[N.jsx("img",{src:Ue.profilePhoto,alt:"Friend"}),N.jsx("div",{children:Ue.name}),N.jsxs("div",{className:"button-group",children:[N.jsx("button",{className:"remove-friend-btn1",onClick:Ye=>{Ye.stopPropagation(),Jt(Ue.id)},children:"Remove"}),N.jsx("button",{className:"chat-btn1",onClick:Ye=>{Ye.stopPropagation(),Qn(Ue)},children:N.jsx("img",{src:rM,alt:"Chat",className:"icon-img"})})]})]},Ue.id))]});case"pending":return N.jsxs("section",{className:"pending-requests-section",children:[N.jsx("h2",{children:"Pending Requests"}),I.map(Ue=>N.jsxs("div",{className:"pending-request",children:[N.jsx("img",{src:Ue.senderPhoto,alt:"User"}),N.jsx("div",{children:Ue.senderName}),N.jsxs("div",{className:"button-group",children:[N.jsx("button",{className:"accept-btn",onClick:()=>At(Ue.id,Ue.senderId),children:"Accept"}),N.jsx("button",{className:"decline-btn",onClick:()=>Et(Ue.id),children:"Decline"})]})]},Ue.id))]});case"people":return N.jsx("section",{className:"people-section",children:qn.map(Ue=>N.jsxs("div",{className:`people-item ${we===Ue.id?"locked":""}`,onClick:()=>Bt(Ue),children:[N.jsx("img",{src:Ue.profilePhoto,alt:"User"}),N.jsx("div",{children:Ue.name}),N.jsxs("div",{className:"button-group",children:[N.jsx("button",{className:"add-friend-btn1",onClick:Ye=>{Ye.stopPropagation(),at(Ue.id)},children:"Add Friend"}),N.jsx("button",{className:"chat-btn1",onClick:Ye=>{Ye.stopPropagation(),Qn(Ue)},children:N.jsx("img",{src:rM,alt:"Chat",className:"icon-img"})})]})]},Ue.id))});case"recentChats":return N.jsxs("section",{className:"recent-chats-section",children:[N.jsx("h2",{children:"Recent Chats"}),re.map(Ue=>N.jsxs("div",{className:"chat-history-item",onClick:()=>Qn(Ue),children:[N.jsx("img",{src:Ue.profilePhoto,alt:"Profile"}),N.jsx("div",{children:Ue.name})]},Ue.id))]});default:return null}},kn=Rb(({movement:[,Ue],down:Ye})=>{if(Ye){const gt=window.innerHeight*.5-Ue;ct(Math.max(100,Math.min(gt,window.innerHeight-60)))}}),zn=Ab({height:It,config:{tension:300,friction:30}});return N.jsx(_A,{children:N.jsxs("div",{className:`connections-container2 ${we?"user-locked1":""}`,style:zn,children:[N.jsx("div",{className:"connections-header",children:N.jsx("h1",{children:"Connections"})}),N.jsx("div",de({className:"drag-handle"},kn())),ie&&N.jsx("div",{className:"notification1",children:ie}),we?Mr():N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"tab-container",children:[N.jsx("button",{className:`tab-button ${Gt==="friends"?"active1 selected":""}`,onClick:()=>qt("friends"),children:"Friends"}),N.jsx("button",{className:`tab-button ${Gt==="people"?"active1 selected":""}`,onClick:()=>qt("people"),children:"People"}),N.jsx("button",{className:`tab-button ${Gt==="recentChats"?"active1 selected":""}`,onClick:()=>qt("recentChats"),children:"Chat"})]}),Gt==="people"&&N.jsx("div",{className:"search-bar1",children:N.jsx("input",{type:"text",placeholder:"Search users...",value:H,onChange:$n})}),Vr()]}),O&&N.jsxs("div",{className:"user-popup1",children:[N.jsx("button",{className:"close-popup1",onClick:Pn,children:""}),N.jsx("img",{src:O.profilePhoto,alt:"Profile"}),N.jsx("div",{children:O.name}),N.jsx("div",{children:O.bio}),N.jsx("button",{className:"view-profile-btn1",onClick:()=>at(O.id),children:"Add Friend"}),N.jsx("button",{className:"remove-friend-btn1",onClick:()=>Jt(O.id),children:"Remove"})]}),W&&N.jsxs("div",{className:"chat-container1",children:[N.jsxs("div",{className:"chat-header1",children:[N.jsx("button",{className:"back-btn1",onClick:Xt,children:""}),N.jsx("img",{src:W.profilePhoto,alt:"Profile"}),N.jsx("div",{children:W.name})]}),N.jsxs("div",{className:"chat-messages1",children:[ee.map(Ue=>N.jsx("div",{className:`message1 ${Ue.senderId===Zt.currentUser.uid?"sent1":"received1"}`,children:N.jsx("div",{children:Ue.content})},Ue.id)),_e&&N.jsxs("div",{className:"typing-indicator1",children:[N.jsx("span",{}),N.jsx("span",{}),N.jsx("span",{})]})]}),N.jsxs("div",{className:"chat-input1",children:[N.jsx("input",{type:"text",placeholder:"Type a message...",value:ye,onChange:zr}),N.jsx("button",{onClick:cr,children:N.jsx("img",{className:"sendchatimg",src:"sendchat.png",alt:"Send"})})]})]})]})})},wIe=()=>{const[e,t]=G.useState({friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),[r,s]=G.useState([]),[c,f]=G.useState(""),[_,x]=G.useState([]),[a,I]=G.useState(window.innerHeight*.5);G.useEffect(()=>{D()},[]);const D=()=>Be(xn,null,function*(){try{const X=(yield Ki(er(bn,"users",Zt.currentUser.uid))).data();t(X.privacySettings||{friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),s(X.customVisibilityList||[])}catch(W){console.error("Error fetching privacy settings:",W)}}),O=(W,X)=>Be(xn,null,function*(){try{const ee=_t(de({},e),{[W]:X});t(ee),yield ss(er(bn,"users",Zt.currentUser.uid),{privacySettings:ee})}catch(ee){console.error("Error updating privacy setting:",ee)}}),F=W=>Be(xn,null,function*(){if(f(W.target.value),W.target.value.length>2)try{const X=Ci(bn,"users"),ee=go(X,Ii("username",">=",W.target.value),Ii("username","<=",W.target.value+"")),ye=(yield wa(ee)).docs.map(Ee=>de({id:Ee.id},Ee.data()));x(ye)}catch(X){console.error("Error searching users:",X)}else x([])}),H=W=>Be(xn,null,function*(){if(W&&!r.some(X=>X.id===W.id)){const X=[...r,W];s(X),f(""),x([]);try{yield ss(er(bn,"users",Zt.currentUser.uid),{customVisibilityList:X})}catch(ee){console.error("Error updating custom list:",ee)}}}),Q=W=>Be(xn,null,function*(){const X=r.filter(ee=>ee.id!==W);s(X);try{yield ss(er(bn,"users",Zt.currentUser.uid),{customVisibilityList:X})}catch(ee){console.error("Error updating custom list:",ee)}}),ie=Rb(({movement:[,W],down:X})=>{if(X){const ee=window.innerHeight*.5-W;I(Math.max(100,Math.min(ee,window.innerHeight-60)))}}),te=Ab({height:a,config:{tension:300,friction:30}});return N.jsxs(_Z.div,{className:"privacy-container",style:te,children:[N.jsx("div",de({className:"drag-handle"},ie())),N.jsx("h2",{children:"Privacy Settings"}),N.jsxs("div",{className:"privacy-section",children:[N.jsx("h3",{className:"section-title1",children:"Location Visibility"}),N.jsxs("div",{className:"privacy-option",children:[N.jsxs("label",{className:"toggle-switch",children:[N.jsx("input",{type:"checkbox",checked:e.friendsCanSeeLocation,onChange:W=>O("friendsCanSeeLocation",W.target.checked)}),N.jsx("span",{className:"slider round"})]}),N.jsx("span",{children:"Friends can see my location in privacy mode"})]}),N.jsxs("div",{className:"privacy-option",children:[N.jsxs("label",{className:"toggle-switch",children:[N.jsx("input",{type:"checkbox",checked:e.quietMap,onChange:W=>O("quietMap",W.target.checked)}),N.jsx("span",{className:"slider round"})]}),N.jsx("span",{children:"Quiet Map (Hide my location from everyone)"})]}),N.jsxs("div",{className:"privacy-option",children:[N.jsxs("label",{className:"toggle-switch",children:[N.jsx("input",{type:"checkbox",checked:e.canSeeOtherMarkers,onChange:W=>O("canSeeOtherMarkers",W.target.checked)}),N.jsx("span",{className:"slider round"})]}),N.jsx("span",{children:"See other users' markers on the map"})]})]}),N.jsxs("div",{className:"privacy-section",children:[N.jsx("h3",{className:"section-title1",children:"Custom Visibility List"}),N.jsxs("div",{className:"privacy-option",children:[N.jsxs("label",{className:"toggle-switch",children:[N.jsx("input",{type:"checkbox",checked:e.useCustomVisibilityList,onChange:W=>O("useCustomVisibilityList",W.target.checked)}),N.jsx("span",{className:"slider round"})]}),N.jsx("span",{children:"Use Custom Visibility List"})]}),e.useCustomVisibilityList&&N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"search-user",children:[N.jsx("input",{type:"text",value:c,onChange:F,placeholder:"Search users..."}),N.jsx("div",{className:"search-results",children:_.map(W=>N.jsxs("div",{className:"search-result-item",onClick:()=>H(W),children:[N.jsx("img",{src:W.profilePhoto||"/default-profile.png",alt:W.username,className:"user-avatar"}),N.jsx("span",{children:W.username})]},W.id))})]}),N.jsx("div",{className:"custom-list",children:r.map(W=>N.jsxs("div",{className:"custom-list-item",children:[N.jsx("img",{src:W.profilePhoto||"/default-profile.png",alt:W.username,className:"user-avatar"}),N.jsx("span",{children:W.username}),N.jsx("button",{onClick:()=>Q(W.id),children:"Remove"})]},W.id))})]})]})]})},TIe="/assets/notification-bPXQTjjH.png",EIe="/assets/day-and-night-DlaE3U3y.png",i8=Xr.memo(({items:e,onItemClick:t})=>{const r=G.useCallback(s=>{const c=s.split(":").map(Number);return c[0]===c[1]?"square":c[0]*3===c[1]*2?"standard":c[0]*21===c[1]*10?"long":"standard"},[]);return N.jsx("div",{className:"pin-container",children:e.map(s=>{const c=r(s.aspectRatio||"2:3");return N.jsxs("div",{className:"pin-item",children:[N.jsx("div",{className:`card-wrapper pin-${c}`,children:N.jsxs("div",{className:"card",onClick:()=>t(s),children:[N.jsx("div",{className:"card-image-container",children:N.jsx("img",{src:s.image,alt:s.caption||`Photo by ${s.user.name}`,className:"card-image"})}),N.jsx("div",{className:"card-content",children:s.caption&&N.jsx("p",{className:"card-caption",children:s.caption})})]})}),N.jsxs("div",{className:"card-user-info",children:[N.jsx("img",{src:s.user.profilePhoto||"/default-profile-image.jpg",alt:s.user.name,className:"card-user-avatar"}),N.jsx("span",{className:"card-username",children:s.user.name})]})]},s.id)})})}),SIe=Xr.memo(({selectedImage:e,comments:t,onClose:r,onAddComment:s,onDeletePost:c})=>{var a,I,D;const[f,_]=G.useState(""),x=()=>{s(f),_("")};return N.jsx("div",{className:"image-preview-overlay",onClick:r,children:N.jsxs("div",{className:"image-preview-content",onClick:O=>O.stopPropagation(),children:[N.jsx("div",{className:"image-preview-main",children:N.jsx("img",{src:e==null?void 0:e.image,alt:"Preview",className:"preview-image"})}),N.jsxs("div",{className:"image-preview-sidebar",children:[N.jsxs("div",{className:"image-preview-header",children:[N.jsxs("div",{className:"user-info",children:[N.jsx("img",{src:((a=e==null?void 0:e.user)==null?void 0:a.profilePhoto)||"/default-profile-image.jpg",alt:"User",className:"user-avatar"}),N.jsx("span",{className:"username",children:((I=e==null?void 0:e.user)==null?void 0:I.name)||"Unknown User"})]}),N.jsx(IconButton,{onClick:r,className:"close-button",children:N.jsx(Close,{})})]}),N.jsx("div",{className:"quest-info",children:e!=null&&e.questTitle?N.jsx("p",{className:"quest-title",children:e.questTitle}):N.jsx("p",{className:"quest-break",children:"Taking a break from quests"})}),(e==null?void 0:e.caption)&&N.jsx("p",{className:"image-caption",children:e.caption}),N.jsx("div",{className:"comments-section",children:t.map(O=>N.jsxs("div",{className:"comment",children:[N.jsx("img",{src:O.userProfileImage||"/default-profile-image.jpg",alt:O.username,className:"comment-user-avatar"}),N.jsxs("div",{className:"comment-content",children:[N.jsx("strong",{children:O.username}),N.jsx("p",{children:O.text})]})]},O.id))}),N.jsx("div",{className:"add-comment",children:N.jsx(TextField,{value:f,onChange:O=>_(O.target.value),placeholder:"Add a comment...",fullWidth:!0,InputProps:{endAdornment:N.jsx(IconButton,{onClick:x,children:N.jsx(Send,{})})}})}),(e==null?void 0:e.userId)===((D=auth.currentUser)==null?void 0:D.uid)&&N.jsx(Button,{startIcon:N.jsx(Delete,{}),onClick:c,className:"delete-button",children:"Delete Post"})]})]})})}),IIe=({currentUser:e})=>G.useMemo(()=>N.jsxs("div",{className:"profile-display",children:[N.jsx("div",{className:"profile-photo-container",children:N.jsx("img",{src:(e==null?void 0:e.profilePhoto)||"/default-profile-image.jpg",alt:(e==null?void 0:e.name)||"Profile",className:"profile-photo"})}),N.jsxs("div",{className:"profile-name-status",children:[N.jsx("h2",{className:"profile-name",children:(e==null?void 0:e.name)||"Loading..."}),N.jsxs("p",{className:"profile-status",children:[N.jsx("span",{className:"status-dot"}),"Active now"]})]})]}),[e]);Xr.memo(()=>{const[e,t]=G.useState(""),[r,s]=G.useState([]),[c,f]=G.useState("Loading address..."),[_,x]=G.useState(null),[a,I]=G.useState(null),[D,O]=G.useState(null);G.useState(null);const[F,H]=G.useState("environment"),[Q,ie]=G.useState(!1),[te,W]=G.useState(null),[X,ee]=G.useState(!1),[fe,ye]=G.useState(null);G.useState("medium"),G.useState([]);const[Ee,re]=G.useState(!1),[he,_e]=G.useState(null),[Se,J]=G.useState(""),[Ie,we]=G.useState([]);G.useState("");const[Lt,Gt]=G.useState([]),[qt,It]=G.useState(!0),[ct,Ut]=G.useState(null),[Kt,at]=G.useState(!1),[At,Et]=G.useState([]),[Jt,Bt]=G.useState(!0),[Pn,$n]=G.useState({width:1920,height:1080}),[Qn,Xt]=G.useState([]),[mr,An]=G.useState(!1),[cr,zr]=G.useState(window.innerHeight*.5),[qn,Mr]=G.useState(window.innerWidth<=768),Vr=rg(),{showNotification:kn}=f0();G.useRef(null);const zn=G.useCallback(an=>Be(xn,null,function*(){return yield _y(an)}),[]);G.useEffect(()=>{const an=Zt.onAuthStateChanged(ir=>Be(xn,null,function*(){if(ir){const oi=yield zn(ir.uid);oi?(Ut(de({uid:ir.uid},oi)),W(oi),Ue(ir.uid),Ye(ir.uid)):console.error("User document not found")}else Ut(null),W(null),Xt([]),Gt([]);It(!1)}));return()=>an()},[zn]),G.useEffect(()=>{const an=rEe(Vr);return()=>an()},[Vr]),G.useEffect(()=>{const an=()=>{Mr(window.innerWidth<=768)};return window.addEventListener("resize",an),()=>window.removeEventListener("resize",an)},[]),G.useEffect(()=>{const an=()=>{const ir=window.innerWidth>=1024;$n(ir?{width:3840,height:2160}:{width:1920,height:1080})};return an(),window.addEventListener("resize",an),()=>window.removeEventListener("resize",an)},[]);const Ue=G.useCallback(an=>Be(xn,null,function*(){const ir=er(bn,"users",an),oi=yield Ki(ir);if(oi.exists()){const Ps=oi.data().friends||[],Rs=yield Promise.all(Ps.map(Vs=>Be(xn,null,function*(){const Ks=er(bn,"users",Vs),jo=yield Ki(Ks);if(jo.exists()){const qr=jo.data(),Qa=go(Ci(bn,"quests"),Ii("uid","==",Vs),Ii("status","==","accepted")),ai=yield wa(Qa);let Ai="Idle",Cl=null;if(!ai.empty){const Aa=ai.docs[0].data();if(Ai="On a quest",Aa.targetUser){const vo=yield Ki(er(bn,"users",Aa.targetUser));vo.exists()&&(Cl=vo.data())}}return{id:Vs,name:qr.name,username:qr.username,profilePhoto:qr.profilePhoto,status:Ai,questPartner:Cl}}return null})));Xt(Rs.filter(Vs=>Vs!==null))}}),[]),Ye=G.useCallback(an=>Be(xn,null,function*(){if(an)try{const ir=er(bn,"users",an),oi=yield Ki(ir);if(oi.exists()){const Ps=oi.data().friends||[],Rs=Ci(bn,"photos"),Vs=go(Rs,Ii("userId","in",[an,...Ps]),Mx("timestamp","desc")),Ks=yield wa(Vs),jo=yield Promise.all(Ks.docs.map(qr=>Be(xn,null,function*(){const Qa=qr.data(),ai=yield _y(Qa.userId);return _t(de({id:qr.id},Qa),{username:(ai==null?void 0:ai.name)||"Unknown User",user:{name:(ai==null?void 0:ai.name)||"Unknown User",profilePhoto:(ai==null?void 0:ai.profilePhoto)||"/default-profile-image.jpg"}})})));Gt(jo)}}catch(ir){console.error("Error fetching grid data:",ir),kn("Failed to load posts. Please try again.")}}),[_y,kn]),gt=G.useCallback(an=>{t(ir=>{const oi=an===ir?"":an;return Bt(oi===""||oi==="home"),ee(!1),oi})},[]),Qe=G.useCallback(an=>Be(xn,null,function*(){if(an)try{const ir=yield zn(an);ir?(I(an),O(de({id:an},ir)),t("connections"),_&&_.flyTo({center:[ir.location.longitude,ir.location.latitude],zoom:15})):console.error("No user found with ID:",an)}catch(ir){console.error("Error fetching user data:",ir)}else if(I(null),O(null),_&&Zt.currentUser){const ir=yield zn(Zt.currentUser.uid);_.flyTo({center:[ir.location.longitude,ir.location.latitude],zoom:15})}}),[_,zn]),pt=G.useCallback(an=>{ye(an),ie(!1)},[]),dt=G.useCallback(()=>{H(an=>an==="user"?"environment":"user")},[]),sn=G.useCallback(()=>{ie(an=>!an),An(an=>!an)},[]),Wt=G.useCallback(()=>{ee(an=>{const ir=!an;return!ir&&_&&(te!=null&&te.location)&&_.flyTo({center:[te.location.longitude,te.location.latitude],zoom:15,duration:2e3}),ir})},[_,te]),pn=G.useCallback(an=>{_e(an),re(ir=>!ir),an&&Sn(an.id)},[]),Sn=G.useCallback(an=>Be(xn,null,function*(){const ir=Ci(bn,"photos",an,"comments"),oi=yield wa(ir),Fi=yield Promise.all(oi.docs.map(Ps=>Be(xn,null,function*(){const Rs=Ps.data(),Vs=yield zn(Rs.userId);return _t(de({id:Ps.id},Rs),{userProfileImage:Vs.profilePhoto})})));we(Fi)}),[zn]),gr=G.useCallback(an=>Be(xn,null,function*(){if(an.trim()&&he){const ir=yield kx(Ci(bn,"photos",he.id,"comments"),{text:an,userId:Zt.currentUser.uid,username:Zt.currentUser.displayName,timestamp:new Date}),oi=yield zn(Zt.currentUser.uid);we(Fi=>[...Fi,{id:ir.id,text:an,userId:Zt.currentUser.uid,username:Zt.currentUser.displayName,timestamp:new Date,userProfileImage:oi.profilePhoto}])}}),[he,zn]),xi=G.useCallback((an,ir,oi="")=>Be(xn,null,function*(){if(Zt.currentUser&&fe)try{const Fi=er(Ci(bn,"photos")),Ps={id:Fi.id,userId:Zt.currentUser.uid,user:{name:Zt.currentUser.displayName||"Unknown User",profilePhoto:(ct==null?void 0:ct.profilePhoto)||null},image:fe,aspectRatio:ir,caption:oi,cropInfo:an,timestamp:$S()};yield Rm(Fi,Ps),kn("Photo uploaded successfully"),ye(null),J(""),Gt(Rs=>[Ps,...Rs]),Ye(Zt.currentUser.uid)}catch(Fi){console.error("Error uploading photo:",Fi),kn("Failed to upload photo. Please try again.")}}),[Zt.currentUser,fe,ct,kn,Ye]),Yr=G.useCallback(()=>Be(xn,null,function*(){if(he&&he.userId===Zt.currentUser.uid)try{yield V1(er(bn,"photos",he.id)),re(!1),Gt(an=>an.filter(ir=>ir.id!==he.id)),kn("Post deleted successfully"),Ye(Zt.currentUser.uid)}catch(an){console.error("Error deleting post:",an),kn("Failed to delete post. Please try again.")}}),[he,kn,Ye]),Li=G.useCallback(()=>at(an=>!an),[]),Nr=G.useCallback(()=>Et([]),[]),di=Rb(({movement:[,an],down:ir})=>{if(ir&&qn){const oi=window.innerHeight*.5-an;zr(Math.max(100,Math.min(oi,window.innerHeight-60)))}}),En=Ab({height:cr,config:{tension:300,friction:30}}),hn=G.useCallback(()=>N.jsxs("div",{className:"home-content",children:[N.jsxs("div",{className:"top-bar-old",children:[N.jsx(IIe,{}),N.jsx("div",{className:"top-bar-old-center",children:N.jsx(zH,{className:"search-bar-home",placeholder:"Search...",variant:"outlined",fullWidth:!0,InputProps:{startAdornment:N.jsx(Tm,{children:N.jsx(kbe,{})})}})}),N.jsxs("div",{className:"top-bar-old-right",children:[N.jsx(Tm,{onClick:Li,children:N.jsx(d1e,{badgeContent:At.length,color:"primary",children:N.jsx("img",{src:TIe,alt:"Notifications",className:"top-bar-old-icon"})})}),N.jsx(Tm,{onClick:EX,children:N.jsx("img",{src:EIe,alt:"Toggle Theme",className:"top-bar-old-icon"})})]})]}),N.jsx("div",{className:"section-container",children:N.jsx("div",{className:"friends-list2",children:Qn.map(an=>N.jsxs("div",{className:"friend-item",children:[N.jsx("div",{className:"friend-photo-container",children:N.jsx("img",{src:an.profilePhoto||"/default-profile-image.jpg",alt:an.name,className:"friend-photo"})}),N.jsxs("div",{className:"friend-info",children:[N.jsx("div",{className:"friend-name",children:an.name}),N.jsxs("div",{className:"friend-username",children:["@",an.username]}),N.jsxs("div",{className:`friend-status ${an.status==="Idle"?"idle":"on-quest"}`,children:[an.status,an.status==="On a quest"&&an.questPartner&&N.jsxs("span",{className:"quest-partner",children:["with ",N.jsx("img",{src:an.questPartner.profilePhoto||"/default-profile-image.jpg",alt:an.questPartner.name,className:"partner-photo"}),"@",an.questPartner.username]})]})]})]},an.id))})}),Kt&&N.jsxs("div",{className:"notifications-dropdown",children:[N.jsx("h3",{children:"Notifications"}),At.map((an,ir)=>N.jsx("div",{className:"notification-item",children:an},ir)),N.jsx(fm,{onClick:Nr,children:"Clear All"})]}),N.jsx("div",{className:"main-area",children:qn?N.jsxs("div",{className:"mobile-layout",children:[N.jsx("div",{className:"full-map-container",children:N.jsx(B_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!1,isFullScreen:!0})}),N.jsxs(_Z.div,{className:"draggable-container",style:En,children:[N.jsx("div",de({className:"drag-handle"},di())),N.jsxs("div",{className:"mobile-content",children:[N.jsx("div",{className:"camera-button",onClick:sn,children:N.jsx(GV,{})}),N.jsxs("div",{className:"section-container",children:[N.jsx("h2",{className:"section-title3",children:"Feed"}),N.jsx(i8,{items:Lt,onItemClick:pn})]})]})]})]}):N.jsxs(N.Fragment,{children:[N.jsx("div",{className:"grid-area",children:N.jsxs("div",{className:"section-container",children:[N.jsx("h2",{className:"section-title3",children:"Feed"}),N.jsx(i8,{items:Lt,onItemClick:pn})]})}),N.jsx("div",{className:"side-area",children:N.jsxs("div",{className:"section-container",children:[N.jsx("h2",{className:"section-title",children:"Camera & Map"}),N.jsxs("div",{className:"camera-map-area",children:[mr?N.jsx(CameraComponent,{facingMode:F,toggleCamera:sn,handleCapture:pt,handleFlipCamera:dt,isFullScreenCamera:mr,cameraResolution:Pn}):N.jsxs("div",{className:"camera-placeholder",onClick:sn,children:[N.jsx(GV,{}),N.jsx("span",{children:"Open Camera"})]}),N.jsx("div",{className:"mini-map",onClick:Wt,children:N.jsx(B_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!1,isFullScreen:!1})})]})]})})]})}),N.jsxs($be,{children:[Ee&&N.jsx(SIe,{selectedImage:he,comments:Ie,onClose:()=>re(!1),onAddComment:gr,onDeletePost:Yr}),fe&&N.jsx(mIe,{photoPreview:fe,onUpload:xi,onCancel:()=>ye(null),currentUser:ct})]})]}),[Q,F,sn,pt,dt,Wt,c,e,a,Ee,he,Ie,gr,Yr,fe,xi,ct,At,Li,Nr,Pn,Qn,Lt,qn,En,di]),bi=G.useCallback(()=>N.jsxs("div",{className:"full-map-container",children:[N.jsx(Tm,{onClick:Wt,className:"back-button",children:N.jsx(NH,{})}),N.jsx(B_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!0,isFullScreen:!0})]}),[Wt,c,e,a]),ci=G.useCallback(()=>Be(xn,null,function*(){try{yield LZ(),kn("Logged out successfully"),Vr("/login")}catch(an){console.error("Logout failed:",an),kn("Logout failed. Please try again.")}}),[kn,Vr]),Us=G.useCallback(()=>{const an=Jt?hn():N.jsx("div",{className:`section-content ${qn?"mobile-section":""}`,children:(()=>{switch(e){case"profile":return N.jsx(vX,{handleLogout:ci});case"quests":return N.jsx(_Ie,{currentUserIds:r,map:_});case"connections":return N.jsx(IX,{currentUserIds:r,map:_,setLockedUser:Qe,lockedUser:a,lockedUserData:D});case"privacy":return N.jsx(wIe,{});default:return null}})()});return qn&&!Jt?N.jsxs("div",{className:"mobile-section-with-map",children:[N.jsx("div",{className:"mobile-map-container",children:N.jsx(B_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!1,isFullScreen:!1})}),N.jsx("div",{className:"mobile-section-content",children:an})]}):an},[e,Jt,r,_,Qe,a,D,hn,ci,qn,c]),Ca=G.useCallback(()=>Jt?"home-active":e==="profile"||e==="privacy"?`${e}-active`:e==="connections"?a?"connections-locked-active":"connections-active":e?`${e}-active`:"",[e,a,Jt]);return G.useEffect(()=>{Jt&&x(null)},[Jt]),N.jsxs("div",{className:`home-screen-container2 ${qn?"mobile-view":""}`,children:[N.jsx(bIe,{activeSection:e,showSection:gt,logo:"Questslogo blue.png",title:"QUESTS"}),qn&&N.jsx("nav",{className:"mobile-nav-bar-container",children:N.jsxs("nav",{className:"mobile-nav-bar",children:[N.jsx("a",{href:"#home",className:`mobile-nav-button ${e===""?"active":""}`,onClick:()=>gt(""),children:N.jsx("img",{src:"home.png",alt:"Home"})}),N.jsx("a",{href:"#profile",className:`mobile-nav-button ${e==="profile"?"active":""}`,onClick:()=>gt("profile"),children:N.jsx("img",{src:"user-avatar.png",alt:"Profile"})}),N.jsx("a",{href:"#connections",className:`mobile-nav-button ${e==="connections"?"active":""}`,onClick:()=>gt("connections"),children:N.jsx("img",{src:"happy.png",alt:"Connections"})}),N.jsx("a",{href:"#quests",className:`mobile-nav-button ${e==="quests"?"active":""}`,onClick:()=>gt("quests"),children:N.jsx("img",{src:"letter.png",alt:"Quests"})}),N.jsx("a",{href:"#privacy",className:`mobile-nav-button ${e==="privacy"?"active":""}`,onClick:()=>gt("privacy"),children:N.jsx("img",{src:"privacy1.png",alt:"Privacy"})})]})}),N.jsxs("div",{className:`main-content2 ${Ca()}`,children:[X?bi():Us(),!Jt&&!X&&!qn&&N.jsx("div",{className:"map-container2",children:N.jsx(B_,{address:c,setAddress:f,setCurrentUserIds:s,setMap:x,activeSection:e,lockedUser:a,showAddressBar:!0,isFullScreen:!1})})]})]})});const s8=()=>{const{notifications:e}=f0();return N.jsx("div",{className:"notification-container",children:e.map(t=>N.jsx("div",{className:`notification ${t.type} ${t.show?"show":"hide"}`,children:t.message},t.id))})};function CIe(){return N.jsxs("div",{className:"landing-page",children:[N.jsx("header",{className:"landing-header",children:N.jsx("img",{src:"Quests Logo.png",alt:"Quests Logo",className:"logo"})}),N.jsxs("main",{className:"landing-main",children:[N.jsxs("div",{className:"headline",children:["Connect ",N.jsx("span",{className:"Today",children:"Today"})]}),N.jsx("h1",{className:"mainheadline",children:"Promoting daily connections & making networking easier than ever"}),N.jsx("p",{className:"subtext",children:"Quests makes networking easy by encouraging you to connect with nearby individuals, helping you build meaningful relationships effortlessly and fostering stronger communities."}),N.jsx("button",{className:"login-button",onClick:()=>window.location.href="/login",children:"Get Started"})]}),N.jsxs("section",{className:"Functions",children:[N.jsx("h2",{className:"Functionsh1",children:"Functions"}),N.jsx("div",{className:"functions-container",children:[{icon:"profile_hover.png",title:"Create a profile",text:"Express yourself and give others insight to who you are by uploading a profile photo, creating a bio, showing your current status and more. You can choose to make your account public or private"},{icon:"connections_hover.png",title:"Make a friend",text:"You can search for existing users who you may know, add someone you went on a quest with as a friend, view your friend's profile and so much more."},{icon:"quest_hover.png",title:"Go on a quest",text:"Using built in map functions and interactive social features to allow you to create public or private quests which you can accept, decline, complete, and view current quests."},{icon:"privacy.png",title:"Privacy & Security",text:"We ensure you and your data are safe and sound. Once your account is private, you won't be seen by and can't see people nearby unless they are a friend. Additionally, there is an SOS feature that alerts nearby personnel that you are in danger or in need of help."},{icon:"history_hover.png",title:"History",text:"Keep track of previous quests and specific details of that quest such as the location, date, time and who you went on that quest with."},{icon:"feed.png",title:"Photo Feed",text:"Look at pictures from quests your friends are currently on and take pictures of your own. Like and leave a message on your friends' pictures."}].map((e,t)=>N.jsxs("div",{className:"function-box",children:[N.jsx("div",{className:"functionicon",children:N.jsx("img",{src:e.icon,alt:e.title})}),N.jsx("div",{className:"functionrectheader",children:e.title.split(" ").map((r,s)=>s===e.title.split(" ").length-1?N.jsx("span",{children:r},s):r+" ")}),N.jsx("div",{className:"functiontext",children:e.text})]},t))})]}),N.jsx("footer",{className:"landing-footer",children:N.jsx("p",{children:" 2024 Quests. All rights reserved."})})]})}const CX=G.createContext(),AX=()=>G.useContext(CX),AIe=({children:e})=>{const[t,r]=G.useState(null),[s,c]=G.useState(!0);return G.useEffect(()=>{const f=Zt.onAuthStateChanged(_=>Be(xn,null,function*(){if(_){const x=yield _y(_.uid);console.log("Fetched user data:",x),r(x)}else r(null);c(!1)}));return()=>f()},[]),N.jsx(CX.Provider,{value:t,children:s?N.jsx("div",{}):e})},PIe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M202.87-520q-37.54 0-64.27-26.73-26.73-26.73-26.73-64.27v-146.13q0-37.54 26.73-64.27 26.73-26.73 64.27-26.73H349q37.54 0 64.27 26.73Q440-794.67 440-757.13V-611q0 37.54-26.73 64.27Q386.54-520 349-520H202.87Zm0 408.13q-37.54 0-64.27-26.73-26.73-26.73-26.73-64.27V-349q0-37.54 26.73-64.27Q165.33-440 202.87-440H349q37.54 0 64.27 26.73Q440-386.54 440-349v146.13q0 37.54-26.73 64.27-26.73 26.73-64.27 26.73H202.87ZM611-520q-37.54 0-64.27-26.73Q520-573.46 520-611v-146.13q0-37.54 26.73-64.27 26.73-26.73 64.27-26.73h146.13q37.54 0 64.27 26.73 26.73 26.73 26.73 64.27V-611q0 37.54-26.73 64.27Q794.67-520 757.13-520H611Zm0 408.13q-37.54 0-64.27-26.73Q520-165.33 520-202.87V-349q0-37.54 26.73-64.27Q573.46-440 611-440h146.13q37.54 0 64.27 26.73 26.73 26.73 26.73 64.27v146.13q0 37.54-26.73 64.27-26.73 26.73-64.27 26.73H611ZM202.87-611H349v-146.13H202.87V-611ZM611-611h146.13v-146.13H611V-611Zm0 408.13h146.13V-349H611v146.13Zm-408.13 0H349V-349H202.87v146.13ZM611-611Zm0 262Zm-262 0Zm0-262Z"})),RIe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M479.94-258.09q75.78 0 128.88-53.04 53.09-53.04 53.09-128.81 0-75.78-53.04-128.88-53.04-53.09-128.81-53.09-75.78 0-128.88 53.04-53.09 53.04-53.09 128.81 0 75.78 53.04 128.88 53.04 53.09 128.81 53.09Zm.06-86.21q-40.33 0-68.01-27.69Q384.3-399.67 384.3-440q0-40.33 27.69-68.01Q439.67-535.7 480-535.7q40.33 0 68.01 27.69Q575.7-480.33 575.7-440q0 40.33-27.69 68.01Q520.33-344.3 480-344.3ZM162.87-111.87q-37.78 0-64.39-26.61t-26.61-64.39v-474.26q0-37.78 26.61-64.39t64.39-26.61H281.7l50.47-52.33q12.44-12.95 29.61-20.31 17.18-7.36 35.61-7.36h165.22q18.43 0 35.61 7.36 17.17 7.36 29.61 20.31l50.47 52.33h118.83q37.78 0 64.39 26.61t26.61 64.39v474.26q0 37.78-26.61 64.39t-64.39 26.61H162.87Zm0-91h634.26v-474.26H638.72l-75.63-80H397.63l-77.06 80h-157.7v474.26ZM480-440Z"})),MIe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M412.84-170.87q44.64-90.04 118.93-120.42 74.29-30.38 126.8-30.38 22.52 0 44.52 4 22 4 42.77 10 23.75-37.53 37.63-81.22 13.88-43.69 13.88-91.35 0-132.56-92.28-224.73-92.29-92.16-224.85-92.16-132.57 0-224.85 92.16-92.28 92.17-92.28 224.73 0 44.75 11.5 85.52 11.5 40.76 34.02 75.05 40.76-19.76 84.28-30.65 43.52-10.88 88.29-10.88 31.52 0 60.9 5.5t57.9 14.5q-22.76 12.24-43.14 27.88-20.38 15.65-38.38 33.65-12.48-2-20.38-2h-16.9q-32 0-63.15 6.88-31.14 6.88-59.9 20.88 31.52 31.52 70.78 52.78 39.27 21.26 83.91 30.26Zm67.4 99q-84.65 0-159.1-32.1-74.44-32.1-129.64-87.29-55.2-55.2-87.29-129.65-32.1-74.46-32.1-159.11 0-84.65 32.1-159.09 32.09-74.43 87.29-129.63 55.2-55.19 129.65-87.29 74.46-32.1 159.11-32.1 84.65 0 158.97 32.1 74.31 32.1 129.51 87.29 55.19 55.2 87.29 129.65 32.1 74.46 32.1 159.11 0 84.65-32.1 159.09-32.1 74.43-87.29 129.63-55.2 55.19-129.57 87.29-74.37 32.1-158.93 32.1ZM381.2-420.48q-57.77 0-98.41-40.64-40.64-40.64-40.64-98.4 0-57.76 40.64-98.28 40.64-40.53 98.41-40.53 57.76 0 98.28 40.53Q520-617.28 520-559.52t-40.52 98.4q-40.52 40.64-98.28 40.64Zm0-79.52q24.52 0 41.9-17.5t17.38-42.02q0-24.52-17.38-41.9t-41.9-17.38q-24.53 0-42.03 17.38t-17.5 41.9q0 24.52 17.5 42.02 17.5 17.5 42.03 17.5Zm277.66 119.04q-41.58 0-70.46-28.7-28.88-28.71-28.88-70.29 0-41.57 28.88-70.33 28.88-28.76 70.46-28.76 41.57 0 70.28 28.7 28.71 28.71 28.71 70.29 0 41.57-28.71 70.33-28.71 28.76-70.28 28.76ZM480.24-480Z"})),PX=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M320-148.52q-37.78 0-64.39-26.61T229-239.52v-77.13q0-19.15 13.17-32.33 13.18-13.17 32.33-13.17h77.37v-90q-29.04-2.72-57.47-13.34-28.42-10.62-50.42-30.9-6.48-6.24-9.98-14.1-3.5-7.86-3.5-16.34v-25.08h-25.65q-9.2 0-17.53-3.48-8.34-3.48-15.06-10.2l-88.8-88.8q-12.48-12.48-12.48-29.44 0-16.95 12.72-29.43 31.15-29 78.95-42.62 47.81-13.62 89.76-13.62 25.33 0 49.87 3.88 24.55 3.88 49.59 13.92 0-25.15 17.43-42.58 17.44-17.44 42.59-17.44h345.24q37.78 0 64.39 26.61t26.61 64.39v444.07q0 53.11-37.51 90.62-37.51 37.51-90.62 37.51H320Zm122.87-213.63h194.5q19.15 0 32.33 13.17 13.17 13.18 13.17 32.33v40q0 15.8 10.66 26.47 10.67 10.66 26.47 10.66 15.8 0 26.47-10.66 10.66-10.67 10.66-26.47v-444.07H442.87V-696l219.91 220.15q9.48 9.48 11.6 21.7 2.12 12.22-2.88 23.45-5 11.24-14.6 18.22-9.6 6.98-24.07 6.98-8.48 0-16.22-3.5-7.74-3.5-13.22-8.98l-96.98-97.22-6.56 6.57q-13.05 13.04-27.23 23.45-14.19 10.4-29.75 16.16v106.87ZM221.13-635.5h47.46q19.15 0 32.32 13.17 13.18 13.18 13.18 32.33v41.22q11.52 7.28 24.28 10.28 12.76 3 26.04 3 22.29 0 40.43-6.88t35.18-23.92l7.28-7.29-54.32-54.56q-29-29-64.52-43.38-35.53-14.38-76.05-14.38-19.04 0-36.2 2.76-17.17 2.76-34.21 8.52l39.13 39.13Zm370.74 356.93H320v39.05h277.87q-3-8.76-4.5-18.4-1.5-9.65-1.5-20.65ZM320-239.52v-39.05 39.05Z"}));function kIe(){const[e,t]=G.useState("/home"),r=AX();return N.jsx("div",{className:"navigation-bar-container",children:N.jsxs("div",{className:"navigation-bar",children:[N.jsx(s,{link:"/home",children:N.jsx(PIe,{})}),N.jsx(s,{link:"camera",children:N.jsx(RIe,{})}),N.jsx(s,{link:"profile",replace:!0,children:N.jsx("div",{className:"profile-icon",children:N.jsx("img",{src:(r==null?void 0:r.profilePhoto)||"/default-profile-image.jpg",alt:(r==null?void 0:r.name)||"User Profile",className:"profile-photo"})})}),N.jsx(s,{link:"connections",replace:!0,children:N.jsx(MIe,{})}),N.jsx(s,{link:"quests",replace:!0,children:N.jsx(PX,{})})]})});function s({link:c,children:f,replace:_=!1}){return N.jsx(nre,{end:!0,className:({isActive:x})=>`navigation-bar-button ${x?"selected":""}`,id:c,to:c,replace:_,onClick:()=>t(c),children:f})}}function o8({id:e,imageUrl:t,aspectRatio:r,time:s,user:c,description:f,comments:_,onAddComment:x}){const[a,I]=G.useState(!1),[D,O]=G.useState(""),F=()=>{I(!a)},H=X=>{X.stopPropagation()},Q=X=>{X.preventDefault(),D.trim()&&(x(e,D),O(""))},[ie,te]=r?r.split(":").map(Number):[1,1];let W=ie/te;return r==="16:9"&&(W=9/16),N.jsx("div",{className:`quest-card ${a?"expanded":""}`,onClick:F,children:N.jsxs("div",{className:"quest-card-inner",children:[N.jsxs("div",{className:"quest-card-content",style:{backgroundImage:`url(${t})`,aspectRatio:W},children:[N.jsx("div",{className:"header",children:N.jsx("div",{className:"time",children:s})}),N.jsxs("div",{className:"footer",children:[N.jsx("p",{className:"user",children:c}),N.jsx("p",{className:"description",children:f})]})]}),a&&N.jsxs("div",{className:"comments-section",onClick:H,children:[N.jsx("h3",{children:"Comments"}),N.jsx("div",{className:"comments-list",children:_.map((X,ee)=>N.jsxs("div",{className:"comment",children:[N.jsx("img",{src:X.userPhoto,alt:X.userName,className:"user-photo"}),N.jsxs("div",{className:"comment-content",children:[N.jsx("p",{className:"comment-user",children:X.userName}),N.jsx("p",{className:"comment-text",children:X.text})]})]},ee))}),N.jsxs("form",{className:"add-comment",onSubmit:Q,children:[N.jsx("input",{type:"text",value:D,onChange:X=>O(X.target.value),placeholder:"Add a comment..."}),N.jsx("button",{type:"submit",children:"Post"})]})]})]})})}function DIe(){const[e,t]=G.useState([]);G.useEffect(()=>{const f=Ci(bn,"quests"),_=go(f,Mx("createdAt","desc"),i5(20)),x=Gh(_,a=>{const I=a.docs.map(D=>_t(de({id:D.id},D.data()),{comments:D.data().comments||[]}));t(I)});return()=>x()},[]);const r=(f,_)=>Be(this,null,function*(){try{const x=er(bn,"quests",f);yield ss(x,{comments:gy({userName:"Current User",userPhoto:"https://example.com/user-photo.jpg",text:_,createdAt:new Date})})}catch(x){console.error("Error adding comment:",x)}}),s=[{aspectRatio:"3:4"},{aspectRatio:"9:16"},{aspectRatio:"1:1"},{aspectRatio:"3:4"},{aspectRatio:"1:1"},{aspectRatio:"9:16"},{aspectRatio:"1:1"},{aspectRatio:"1:1"},{aspectRatio:"9:16"},{aspectRatio:"3:4"},{aspectRatio:"9:16"}],c=[...e,...s];return c.sort(()=>Math.random()-.5),N.jsx("div",{className:"feed",children:c.map((f,_)=>f.id?N.jsx(o8,{id:f.id,imageUrl:f.imageUrl,aspectRatio:f.aspectRatio,time:f.time,user:f.user,description:f.description,comments:f.comments,onAddComment:r},f.id):N.jsx(o8,{imageUrl:"https://media.tenor.com/o_5RQarGvJ0AAAAM/kiss.gif",aspectRatio:f.aspectRatio,time:"8:08 PM",user:"Kiity :3",description:"I am cat and i love yuu",comments:[],onAddComment:()=>{}},`dummy-${_}`))})}const RX=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M472-480 332-620q-18-18-18-44t18-44q18-18 44-18t44 18l183 183q9 9 14 21t5 24q0 12-5 24t-14 21L420-252q-18 18-44 18t-44-18q-18-18-18-44t18-44l140-140Z"}));function MX({small:e=!1}){const[t,r]=G.useState("Loading address..."),[s,c]=G.useState([]),[f,_]=G.useState(null),[x,a]=G.useState(""),[I,D]=G.useState(null),[O,F]=G.useState(!1);return N.jsxs("div",{className:`map-container ${e?"small":""} ${O?"full-screen":""}`,onClick:()=>{!O&&F(!0)},children:[N.jsx(B_,{address:t,setAddress:r,setCurrentUserIds:c,setMap:_,activeSection:x,lockedUser:I,showAddressBar:!1,isFullScreen:O}),O&&N.jsx("button",{className:"full-screen-toggle",onClick:()=>F(!1),"aria-label":O?"Exit full screen":"Enter full screen",children:N.jsx(RX,{})})]})}function OIe({ref:e,show:t}){return N.jsx("div",{className:"top-bar-container",style:{opacity:t?1:0},children:N.jsxs("div",{className:"top-bar",children:[N.jsx(V4,{small:!0}),N.jsx(q4,{small:!0}),N.jsx($4,{small:!0}),N.jsx(MX,{small:!0})]})})}const LIe=({isOpen:e,onClose:t})=>{const[r,s]=G.useState(""),[c,f]=G.useState(""),[_,x]=G.useState(""),[a,I]=G.useState(!1),[D,O]=G.useState(""),[F,H]=G.useState(null),[Q,ie]=G.useState([]),[te,W]=G.useState([]),{showNotification:X}=f0();G.useEffect(()=>{Be(xn,null,function*(){const _e=Ci(bn,"users"),J=(yield wa(_e)).docs.map(Ie=>de({id:Ie.id},Ie.data()));ie(J)})},[]),G.useEffect(()=>{if(D){const he=Q.filter(_e=>_e.name.toLowerCase().includes(D.toLowerCase()));W(he)}else W([])},[D,Q]);const ee=()=>Be(xn,null,function*(){if(!Zt.currentUser){X("You must be logged in to create a quest.","error");return}if(!r||!c||!_){X("Please fill in all fields.","error");return}if(!a&&!F){X("Please select a user for private quest.","error");return}try{const he={uid:Zt.currentUser.uid,title:r,description:c,timeFrame:_,createdAt:$S(),isPublic:a,targetUser:a?null:F.id,status:"pending",acceptedBy:a?[]:null};yield kx(Ci(bn,"quests"),he),X("Quest created successfully!","success"),re(),t()}catch(he){console.error("Error creating quest:",he),X("Failed to create quest.","error")}}),fe=()=>{I(!a),H(null),O("")},ye=he=>{he.target.value.split(/\s+/).length<=300&&f(he.target.value)},Ee=he=>{H(he),O("")},re=()=>{s(""),f(""),x(""),I(!1),O(""),H(null)};return e?N.jsx("div",{className:"modal-overlay",children:N.jsx("div",{className:"quest-popup",children:N.jsxs("div",{className:"modal-content",children:[N.jsxs("div",{className:"modal-header",children:[N.jsx("svg",{onClick:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:N.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})}),N.jsx("h2",{children:"Create a New Quest"})]}),N.jsxs("div",{className:"input-group",children:[N.jsx("label",{htmlFor:"quest-title",children:"Title"}),N.jsx("input",{id:"quest-title",type:"text",placeholder:"Enter quest title",value:r,onChange:he=>s(he.target.value),className:"profile-input"})]}),N.jsxs("div",{className:"input-group",children:[N.jsx("label",{htmlFor:"quest-description",children:"Description"}),N.jsx("textarea",{id:"quest-description",placeholder:"Enter quest description",value:c,onChange:ye,className:"profile-bio-edit"})]}),N.jsxs("div",{className:"input-group",children:[N.jsx("label",{htmlFor:"quest-timeframe",children:"Time Frame"}),N.jsxs("select",{id:"quest-timeframe",value:_,onChange:he=>x(he.target.value),className:"profile-input",children:[N.jsx("option",{value:"",children:"Select Time Frame"}),N.jsx("option",{value:"5 mins",children:"5 mins"}),N.jsx("option",{value:"10 mins",children:"10 mins"}),N.jsx("option",{value:"15 mins",children:"15 mins"}),N.jsx("option",{value:"30 mins",children:"30 mins"}),N.jsx("option",{value:"1 hour",children:"1 hour"})]})]}),N.jsxs("div",{className:"toggle-container",children:[N.jsx("p",{children:"Public Quest"}),N.jsxs("label",{className:"switch",children:[N.jsx("input",{type:"checkbox",checked:a,onChange:fe}),N.jsx("span",{className:"slider"})]})]}),!a&&N.jsxs("div",{className:"user-search-container",children:[N.jsx("input",{type:"text",placeholder:"Search users...",value:D,onChange:he=>O(he.target.value),className:"user-search-input"}),D&&te.length>0&&N.jsx("div",{className:"user-search-results",children:te.map(he=>N.jsxs("div",{className:"user-search-result",onClick:()=>Ee(he),children:[N.jsx("img",{src:he.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"}),he.name]},he.id))}),F&&N.jsx("div",{className:"selected-user",children:N.jsxs("p",{children:["Selected User: ",F.name]})})]}),N.jsxs("div",{className:"modal-actions",children:[N.jsx("button",{className:"cancel-button",onClick:t,children:"Cancel"}),N.jsx("button",{className:"create-quest-button",onClick:ee,children:"Create Quest"})]})]})})}):null};var qa=function(){return qa=Object.assign||function(t){for(var r,s=1,c=arguments.length;s<c;s++){r=arguments[s];for(var f in r)Object.prototype.hasOwnProperty.call(r,f)&&(t[f]=r[f])}return t},qa.apply(this,arguments)};function pI(e,t,r){if(r||arguments.length===2)for(var s=0,c=t.length,f;s<c;s++)(f||!(s in t))&&(f||(f=Array.prototype.slice.call(t,0,s)),f[s]=t[s]);return e.concat(f||Array.prototype.slice.call(t))}var ns="-ms-",J1="-moz-",Si="-webkit-",kX="comm",yA="rule",mL="decl",zIe="@import",DX="@keyframes",NIe="@layer",OX=Math.abs,gL=String.fromCharCode,L4=Object.assign;function FIe(e,t){return Io(e,0)^45?(((t<<2^Io(e,0))<<2^Io(e,1))<<2^Io(e,2))<<2^Io(e,3):0}function LX(e){return e.trim()}function Dh(e,t){return(e=t.exec(e))?e[0]:e}function Ur(e,t,r){return e.replace(t,r)}function GE(e,t,r){return e.indexOf(t,r)}function Io(e,t){return e.charCodeAt(t)|0}function Hy(e,t,r){return e.slice(t,r)}function ku(e){return e.length}function zX(e){return e.length}function T1(e,t){return t.push(e),e}function BIe(e,t){return e.map(t).join("")}function a8(e,t){return e.filter(function(r){return!Dh(r,t)})}var vA=1,Zy=1,NX=0,nc=0,ro=0,m0="";function xA(e,t,r,s,c,f,_,x){return{value:e,root:t,parent:r,type:s,props:c,children:f,line:vA,column:Zy,length:_,return:"",siblings:x}}function af(e,t){return L4(xA("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function O_(e){for(;e.root;)e=af(e.root,{children:[e]});T1(e,e.siblings)}function jIe(){return ro}function UIe(){return ro=nc>0?Io(m0,--nc):0,Zy--,ro===10&&(Zy=1,vA--),ro}function Gc(){return ro=nc<NX?Io(m0,nc++):0,Zy++,ro===10&&(Zy=1,vA++),ro}function Om(){return Io(m0,nc)}function WE(){return nc}function bA(e,t){return Hy(m0,e,t)}function z4(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function VIe(e){return vA=Zy=1,NX=ku(m0=e),nc=0,[]}function $Ie(e){return m0="",e}function iM(e){return LX(bA(nc-1,N4(e===91?e+2:e===40?e+1:e)))}function qIe(e){for(;(ro=Om())&&ro<33;)Gc();return z4(e)>2||z4(ro)>3?"":" "}function GIe(e,t){for(;--t&&Gc()&&!(ro<48||ro>102||ro>57&&ro<65||ro>70&&ro<97););return bA(e,WE()+(t<6&&Om()==32&&Gc()==32))}function N4(e){for(;Gc();)switch(ro){case e:return nc;case 34:case 39:e!==34&&e!==39&&N4(ro);break;case 40:e===41&&N4(e);break;case 92:Gc();break}return nc}function WIe(e,t){for(;Gc()&&e+ro!==57;)if(e+ro===84&&Om()===47)break;return"/*"+bA(t,nc-1)+"*"+gL(e===47?e:Gc())}function HIe(e){for(;!z4(Om());)Gc();return bA(e,nc)}function ZIe(e){return $Ie(HE("",null,null,null,[""],e=VIe(e),0,[0],e))}function HE(e,t,r,s,c,f,_,x,a){for(var I=0,D=0,O=_,F=0,H=0,Q=0,ie=1,te=1,W=1,X=0,ee="",fe=c,ye=f,Ee=s,re=ee;te;)switch(Q=X,X=Gc()){case 40:if(Q!=108&&Io(re,O-1)==58){GE(re+=Ur(iM(X),"&","&\f"),"&\f",OX(I?x[I-1]:0))!=-1&&(W=-1);break}case 34:case 39:case 91:re+=iM(X);break;case 9:case 10:case 13:case 32:re+=qIe(Q);break;case 92:re+=GIe(WE()-1,7);continue;case 47:switch(Om()){case 42:case 47:T1(XIe(WIe(Gc(),WE()),t,r,a),a);break;default:re+="/"}break;case 123*ie:x[I++]=ku(re)*W;case 125*ie:case 59:case 0:switch(X){case 0:case 125:te=0;case 59+D:W==-1&&(re=Ur(re,/\f/g,"")),H>0&&ku(re)-O&&T1(H>32?c8(re+";",s,r,O-1,a):c8(Ur(re," ","")+";",s,r,O-2,a),a);break;case 59:re+=";";default:if(T1(Ee=l8(re,t,r,I,D,c,x,ee,fe=[],ye=[],O,f),f),X===123)if(D===0)HE(re,t,Ee,Ee,fe,f,O,x,ye);else switch(F===99&&Io(re,3)===110?100:F){case 100:case 108:case 109:case 115:HE(e,Ee,Ee,s&&T1(l8(e,Ee,Ee,0,0,c,x,ee,c,fe=[],O,ye),ye),c,ye,O,x,s?fe:ye);break;default:HE(re,Ee,Ee,Ee,[""],ye,0,x,ye)}}I=D=H=0,ie=W=1,ee=re="",O=_;break;case 58:O=1+ku(re),H=Q;default:if(ie<1){if(X==123)--ie;else if(X==125&&ie++==0&&UIe()==125)continue}switch(re+=gL(X),X*ie){case 38:W=D>0?1:(re+="\f",-1);break;case 44:x[I++]=(ku(re)-1)*W,W=1;break;case 64:Om()===45&&(re+=iM(Gc())),F=Om(),D=O=ku(ee=re+=HIe(WE())),X++;break;case 45:Q===45&&ku(re)==2&&(ie=0)}}return f}function l8(e,t,r,s,c,f,_,x,a,I,D,O){for(var F=c-1,H=c===0?f:[""],Q=zX(H),ie=0,te=0,W=0;ie<s;++ie)for(var X=0,ee=Hy(e,F+1,F=OX(te=_[ie])),fe=e;X<Q;++X)(fe=LX(te>0?H[X]+" "+ee:Ur(ee,/&\f/g,H[X])))&&(a[W++]=fe);return xA(e,t,r,c===0?yA:x,a,I,D,O)}function XIe(e,t,r,s){return xA(e,t,r,kX,gL(jIe()),Hy(e,2,-2),0,s)}function c8(e,t,r,s,c){return xA(e,t,r,mL,Hy(e,0,s),Hy(e,s+1,-1),s,c)}function FX(e,t,r){switch(FIe(e,t)){case 5103:return Si+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Si+e+e;case 4789:return J1+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Si+e+J1+e+ns+e+e;case 5936:switch(Io(e,t+11)){case 114:return Si+e+ns+Ur(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Si+e+ns+Ur(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Si+e+ns+Ur(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Si+e+ns+e+e;case 6165:return Si+e+ns+"flex-"+e+e;case 5187:return Si+e+Ur(e,/(\w+).+(:[^]+)/,Si+"box-$1$2"+ns+"flex-$1$2")+e;case 5443:return Si+e+ns+"flex-item-"+Ur(e,/flex-|-self/g,"")+(Dh(e,/flex-|baseline/)?"":ns+"grid-row-"+Ur(e,/flex-|-self/g,""))+e;case 4675:return Si+e+ns+"flex-line-pack"+Ur(e,/align-content|flex-|-self/g,"")+e;case 5548:return Si+e+ns+Ur(e,"shrink","negative")+e;case 5292:return Si+e+ns+Ur(e,"basis","preferred-size")+e;case 6060:return Si+"box-"+Ur(e,"-grow","")+Si+e+ns+Ur(e,"grow","positive")+e;case 4554:return Si+Ur(e,/([^-])(transform)/g,"$1"+Si+"$2")+e;case 6187:return Ur(Ur(Ur(e,/(zoom-|grab)/,Si+"$1"),/(image-set)/,Si+"$1"),e,"")+e;case 5495:case 3959:return Ur(e,/(image-set\([^]*)/,Si+"$1$`$1");case 4968:return Ur(Ur(e,/(.+:)(flex-)?(.*)/,Si+"box-pack:$3"+ns+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Si+e+e;case 4200:if(!Dh(e,/flex-|baseline/))return ns+"grid-column-align"+Hy(e,t)+e;break;case 2592:case 3360:return ns+Ur(e,"template-","")+e;case 4384:case 3616:return r&&r.some(function(s,c){return t=c,Dh(s.props,/grid-\w+-end/)})?~GE(e+(r=r[t].value),"span",0)?e:ns+Ur(e,"-start","")+e+ns+"grid-row-span:"+(~GE(r,"span",0)?Dh(r,/\d+/):+Dh(r,/\d+/)-+Dh(e,/\d+/))+";":ns+Ur(e,"-start","")+e;case 4896:case 4128:return r&&r.some(function(s){return Dh(s.props,/grid-\w+-start/)})?e:ns+Ur(Ur(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return Ur(e,/(.+)-inline(.+)/,Si+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(ku(e)-1-t>6)switch(Io(e,t+1)){case 109:if(Io(e,t+4)!==45)break;case 102:return Ur(e,/(.+:)(.+)-([^]+)/,"$1"+Si+"$2-$3$1"+J1+(Io(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~GE(e,"stretch",0)?FX(Ur(e,"stretch","fill-available"),t,r)+e:e}break;case 5152:case 5920:return Ur(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(s,c,f,_,x,a,I){return ns+c+":"+f+I+(_?ns+c+"-span:"+(x?a:+a-+f)+I:"")+e});case 4949:if(Io(e,t+6)===121)return Ur(e,":",":"+Si)+e;break;case 6444:switch(Io(e,Io(e,14)===45?18:11)){case 120:return Ur(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Si+(Io(e,14)===45?"inline-":"")+"box$3$1"+Si+"$2$3$1"+ns+"$2box$3")+e;case 100:return Ur(e,":",":"+ns)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Ur(e,"scroll-","scroll-snap-")+e}return e}function mI(e,t){for(var r="",s=0;s<e.length;s++)r+=t(e[s],s,e,t)||"";return r}function KIe(e,t,r,s){switch(e.type){case NIe:if(e.children.length)break;case zIe:case mL:return e.return=e.return||e.value;case kX:return"";case DX:return e.return=e.value+"{"+mI(e.children,s)+"}";case yA:if(!ku(e.value=e.props.join(",")))return""}return ku(r=mI(e.children,s))?e.return=e.value+"{"+r+"}":""}function QIe(e){var t=zX(e);return function(r,s,c,f){for(var _="",x=0;x<t;x++)_+=e[x](r,s,c,f)||"";return _}}function YIe(e){return function(t){t.root||(t=t.return)&&e(t)}}function JIe(e,t,r,s){if(e.length>-1&&!e.return)switch(e.type){case mL:e.return=FX(e.value,e.length,r);return;case DX:return mI([af(e,{value:Ur(e.value,"@","@"+Si)})],s);case yA:if(e.length)return BIe(r=e.props,function(c){switch(Dh(c,s=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":O_(af(e,{props:[Ur(c,/:(read-\w+)/,":"+J1+"$1")]})),O_(af(e,{props:[c]})),L4(e,{props:a8(r,s)});break;case"::placeholder":O_(af(e,{props:[Ur(c,/:(plac\w+)/,":"+Si+"input-$1")]})),O_(af(e,{props:[Ur(c,/:(plac\w+)/,":"+J1+"$1")]})),O_(af(e,{props:[Ur(c,/:(plac\w+)/,ns+"input-$1")]})),O_(af(e,{props:[c]})),L4(e,{props:a8(r,s)});break}return""})}}var eCe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},cl={},Xy=typeof process!="undefined"&&cl!==void 0&&(cl.REACT_APP_SC_ATTR||cl.SC_ATTR)||"data-styled",BX="active",jX="data-styled-version",wA="6.1.13",_L=`/*!sc*/
`,gI=typeof window!="undefined"&&"HTMLElement"in window,tCe=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process!="undefined"&&cl!==void 0&&cl.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&cl.REACT_APP_SC_DISABLE_SPEEDY!==""?cl.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&cl.REACT_APP_SC_DISABLE_SPEEDY:typeof process!="undefined"&&cl!==void 0&&cl.SC_DISABLE_SPEEDY!==void 0&&cl.SC_DISABLE_SPEEDY!==""&&cl.SC_DISABLE_SPEEDY!=="false"&&cl.SC_DISABLE_SPEEDY),TA=Object.freeze([]),Ky=Object.freeze({});function nCe(e,t,r){return r===void 0&&(r=Ky),e.theme!==r.theme&&e.theme||t||r.theme}var UX=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),rCe=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,iCe=/(^-|-$)/g;function u8(e){return e.replace(rCe,"-").replace(iCe,"")}var sCe=/(a)(d)/gi,dE=52,h8=function(e){return String.fromCharCode(e+(e>25?39:97))};function F4(e){var t,r="";for(t=Math.abs(e);t>dE;t=t/dE|0)r=h8(t%dE)+r;return(h8(t%dE)+r).replace(sCe,"$1-$2")}var sM,VX=5381,ry=function(e,t){for(var r=t.length;r;)e=33*e^t.charCodeAt(--r);return e},$X=function(e){return ry(VX,e)};function oCe(e){return F4($X(e)>>>0)}function aCe(e){return e.displayName||e.name||"Component"}function oM(e){return typeof e=="string"&&!0}var qX=typeof Symbol=="function"&&Symbol.for,GX=qX?Symbol.for("react.memo"):60115,lCe=qX?Symbol.for("react.forward_ref"):60112,cCe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},uCe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},WX={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},hCe=((sM={})[lCe]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},sM[GX]=WX,sM);function d8(e){return("type"in(t=e)&&t.type.$$typeof)===GX?WX:"$$typeof"in e?hCe[e.$$typeof]:cCe;var t}var dCe=Object.defineProperty,fCe=Object.getOwnPropertyNames,f8=Object.getOwnPropertySymbols,pCe=Object.getOwnPropertyDescriptor,mCe=Object.getPrototypeOf,p8=Object.prototype;function HX(e,t,r){if(typeof t!="string"){if(p8){var s=mCe(t);s&&s!==p8&&HX(e,s,r)}var c=fCe(t);f8&&(c=c.concat(f8(t)));for(var f=d8(e),_=d8(t),x=0;x<c.length;++x){var a=c[x];if(!(a in uCe||r&&r[a]||_&&a in _||f&&a in f)){var I=pCe(t,a);try{dCe(e,a,I)}catch(D){}}}}return e}function Qy(e){return typeof e=="function"}function yL(e){return typeof e=="object"&&"styledComponentId"in e}function Em(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function m8(e,t){if(e.length===0)return"";for(var r=e[0],s=1;s<e.length;s++)r+=e[s];return r}function Xx(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function B4(e,t,r){if(r===void 0&&(r=!1),!r&&!Xx(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var s=0;s<t.length;s++)e[s]=B4(e[s],t[s]);else if(Xx(t))for(var s in t)e[s]=B4(e[s],t[s]);return e}function vL(e,t){Object.defineProperty(e,"toString",{value:t})}function Db(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var gCe=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var r=0,s=0;s<t;s++)r+=this.groupSizes[s];return r},e.prototype.insertRules=function(t,r){if(t>=this.groupSizes.length){for(var s=this.groupSizes,c=s.length,f=c;t>=f;)if((f<<=1)<0)throw Db(16,"".concat(t));this.groupSizes=new Uint32Array(f),this.groupSizes.set(s),this.length=f;for(var _=c;_<f;_++)this.groupSizes[_]=0}for(var x=this.indexOfGroup(t+1),a=(_=0,r.length);_<a;_++)this.tag.insertRule(x,r[_])&&(this.groupSizes[t]++,x++)},e.prototype.clearGroup=function(t){if(t<this.length){var r=this.groupSizes[t],s=this.indexOfGroup(t),c=s+r;this.groupSizes[t]=0;for(var f=s;f<c;f++)this.tag.deleteRule(s)}},e.prototype.getGroup=function(t){var r="";if(t>=this.length||this.groupSizes[t]===0)return r;for(var s=this.groupSizes[t],c=this.indexOfGroup(t),f=c+s,_=c;_<f;_++)r+="".concat(this.tag.getRule(_)).concat(_L);return r},e}(),ZE=new Map,_I=new Map,XE=1,fE=function(e){if(ZE.has(e))return ZE.get(e);for(;_I.has(XE);)XE++;var t=XE++;return ZE.set(e,t),_I.set(t,e),t},_Ce=function(e,t){XE=t+1,ZE.set(e,t),_I.set(t,e)},yCe="style[".concat(Xy,"][").concat(jX,'="').concat(wA,'"]'),vCe=new RegExp("^".concat(Xy,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),xCe=function(e,t,r){for(var s,c=r.split(","),f=0,_=c.length;f<_;f++)(s=c[f])&&e.registerName(t,s)},bCe=function(e,t){for(var r,s=((r=t.textContent)!==null&&r!==void 0?r:"").split(_L),c=[],f=0,_=s.length;f<_;f++){var x=s[f].trim();if(x){var a=x.match(vCe);if(a){var I=0|parseInt(a[1],10),D=a[2];I!==0&&(_Ce(D,I),xCe(e,D,a[3]),e.getTag().insertRules(I,c)),c.length=0}else c.push(x)}}},g8=function(e){for(var t=document.querySelectorAll(yCe),r=0,s=t.length;r<s;r++){var c=t[r];c&&c.getAttribute(Xy)!==BX&&(bCe(e,c),c.parentNode&&c.parentNode.removeChild(c))}};function wCe(){return typeof __webpack_nonce__!="undefined"?__webpack_nonce__:null}var ZX=function(e){var t=document.head,r=e||t,s=document.createElement("style"),c=function(x){var a=Array.from(x.querySelectorAll("style[".concat(Xy,"]")));return a[a.length-1]}(r),f=c!==void 0?c.nextSibling:null;s.setAttribute(Xy,BX),s.setAttribute(jX,wA);var _=wCe();return _&&s.setAttribute("nonce",_),r.insertBefore(s,f),s},TCe=function(){function e(t){this.element=ZX(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(r){if(r.sheet)return r.sheet;for(var s=document.styleSheets,c=0,f=s.length;c<f;c++){var _=s[c];if(_.ownerNode===r)return _}throw Db(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,r){try{return this.sheet.insertRule(r,t),this.length++,!0}catch(s){return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var r=this.sheet.cssRules[t];return r&&r.cssText?r.cssText:""},e}(),ECe=function(){function e(t){this.element=ZX(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,r){if(t<=this.length&&t>=0){var s=document.createTextNode(r);return this.element.insertBefore(s,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),SCe=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,r){return t<=this.length&&(this.rules.splice(t,0,r),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),_8=gI,ICe={isServer:!gI,useCSSOMInjection:!tCe},XX=function(){function e(t,r,s){t===void 0&&(t=Ky),r===void 0&&(r={});var c=this;this.options=qa(qa({},ICe),t),this.gs=r,this.names=new Map(s),this.server=!!t.isServer,!this.server&&gI&&_8&&(_8=!1,g8(this)),vL(this,function(){return function(f){for(var _=f.getTag(),x=_.length,a="",I=function(O){var F=function(W){return _I.get(W)}(O);if(F===void 0)return"continue";var H=f.names.get(F),Q=_.getGroup(O);if(H===void 0||!H.size||Q.length===0)return"continue";var ie="".concat(Xy,".g").concat(O,'[id="').concat(F,'"]'),te="";H!==void 0&&H.forEach(function(W){W.length>0&&(te+="".concat(W,","))}),a+="".concat(Q).concat(ie,'{content:"').concat(te,'"}').concat(_L)},D=0;D<x;D++)I(D);return a}(c)})}return e.registerId=function(t){return fE(t)},e.prototype.rehydrate=function(){!this.server&&gI&&g8(this)},e.prototype.reconstructWithOptions=function(t,r){return r===void 0&&(r=!0),new e(qa(qa({},this.options),t),this.gs,r&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(r){var s=r.useCSSOMInjection,c=r.target;return r.isServer?new SCe(c):s?new TCe(c):new ECe(c)}(this.options),new gCe(t)));var t},e.prototype.hasNameForId=function(t,r){return this.names.has(t)&&this.names.get(t).has(r)},e.prototype.registerName=function(t,r){if(fE(t),this.names.has(t))this.names.get(t).add(r);else{var s=new Set;s.add(r),this.names.set(t,s)}},e.prototype.insertRules=function(t,r,s){this.registerName(t,r),this.getTag().insertRules(fE(t),s)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(fE(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),CCe=/&/g,ACe=/^\s*\/\/.*$/gm;function KX(e,t){return e.map(function(r){return r.type==="rule"&&(r.value="".concat(t," ").concat(r.value),r.value=r.value.replaceAll(",",",".concat(t," ")),r.props=r.props.map(function(s){return"".concat(t," ").concat(s)})),Array.isArray(r.children)&&r.type!=="@keyframes"&&(r.children=KX(r.children,t)),r})}function PCe(e){var t,r,s,c=Ky,f=c.options,_=f===void 0?Ky:f,x=c.plugins,a=x===void 0?TA:x,I=function(F,H,Q){return Q.startsWith(r)&&Q.endsWith(r)&&Q.replaceAll(r,"").length>0?".".concat(t):F},D=a.slice();D.push(function(F){F.type===yA&&F.value.includes("&")&&(F.props[0]=F.props[0].replace(CCe,r).replace(s,I))}),_.prefix&&D.push(JIe),D.push(KIe);var O=function(F,H,Q,ie){H===void 0&&(H=""),Q===void 0&&(Q=""),ie===void 0&&(ie="&"),t=ie,r=H,s=new RegExp("\\".concat(r,"\\b"),"g");var te=F.replace(ACe,""),W=ZIe(Q||H?"".concat(Q," ").concat(H," { ").concat(te," }"):te);_.namespace&&(W=KX(W,_.namespace));var X=[];return mI(W,QIe(D.concat(YIe(function(ee){return X.push(ee)})))),X};return O.hash=a.length?a.reduce(function(F,H){return H.name||Db(15),ry(F,H.name)},VX).toString():"",O}var RCe=new XX,j4=PCe(),QX=Xr.createContext({shouldForwardProp:void 0,styleSheet:RCe,stylis:j4});QX.Consumer;Xr.createContext(void 0);function y8(){return G.useContext(QX)}var MCe=function(){function e(t,r){var s=this;this.inject=function(c,f){f===void 0&&(f=j4);var _=s.name+f.hash;c.hasNameForId(s.id,_)||c.insertRules(s.id,_,f(s.rules,_,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=r,vL(this,function(){throw Db(12,String(s.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=j4),this.name+t.hash},e}(),kCe=function(e){return e>="A"&&e<="Z"};function v8(e){for(var t="",r=0;r<e.length;r++){var s=e[r];if(r===1&&s==="-"&&e[0]==="-")return e;kCe(s)?t+="-"+s.toLowerCase():t+=s}return t.startsWith("ms-")?"-"+t:t}var YX=function(e){return e==null||e===!1||e===""},JX=function(e){var t,r,s=[];for(var c in e){var f=e[c];e.hasOwnProperty(c)&&!YX(f)&&(Array.isArray(f)&&f.isCss||Qy(f)?s.push("".concat(v8(c),":"),f,";"):Xx(f)?s.push.apply(s,pI(pI(["".concat(c," {")],JX(f),!1),["}"],!1)):s.push("".concat(v8(c),": ").concat((t=c,(r=f)==null||typeof r=="boolean"||r===""?"":typeof r!="number"||r===0||t in eCe||t.startsWith("--")?String(r).trim():"".concat(r,"px")),";")))}return s};function Lm(e,t,r,s){if(YX(e))return[];if(yL(e))return[".".concat(e.styledComponentId)];if(Qy(e)){if(!Qy(f=e)||f.prototype&&f.prototype.isReactComponent||!t)return[e];var c=e(t);return Lm(c,t,r,s)}var f;return e instanceof MCe?r?(e.inject(r,s),[e.getName(s)]):[e]:Xx(e)?JX(e):Array.isArray(e)?Array.prototype.concat.apply(TA,e.map(function(_){return Lm(_,t,r,s)})):[e.toString()]}function DCe(e){for(var t=0;t<e.length;t+=1){var r=e[t];if(Qy(r)&&!yL(r))return!1}return!0}var OCe=$X(wA),LCe=function(){function e(t,r,s){this.rules=t,this.staticRulesId="",this.isStatic=(s===void 0||s.isStatic)&&DCe(t),this.componentId=r,this.baseHash=ry(OCe,r),this.baseStyle=s,XX.registerId(r)}return e.prototype.generateAndInjectStyles=function(t,r,s){var c=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,r,s):"";if(this.isStatic&&!s.hash)if(this.staticRulesId&&r.hasNameForId(this.componentId,this.staticRulesId))c=Em(c,this.staticRulesId);else{var f=m8(Lm(this.rules,t,r,s)),_=F4(ry(this.baseHash,f)>>>0);if(!r.hasNameForId(this.componentId,_)){var x=s(f,".".concat(_),void 0,this.componentId);r.insertRules(this.componentId,_,x)}c=Em(c,_),this.staticRulesId=_}else{for(var a=ry(this.baseHash,s.hash),I="",D=0;D<this.rules.length;D++){var O=this.rules[D];if(typeof O=="string")I+=O;else if(O){var F=m8(Lm(O,t,r,s));a=ry(a,F+D),I+=F}}if(I){var H=F4(a>>>0);r.hasNameForId(this.componentId,H)||r.insertRules(this.componentId,H,s(I,".".concat(H),void 0,this.componentId)),c=Em(c,H)}}return c},e}(),eK=Xr.createContext(void 0);eK.Consumer;var aM={};function zCe(e,t,r){var s=yL(e),c=e,f=!oM(e),_=t.attrs,x=_===void 0?TA:_,a=t.componentId,I=a===void 0?function(fe,ye){var Ee=typeof fe!="string"?"sc":u8(fe);aM[Ee]=(aM[Ee]||0)+1;var re="".concat(Ee,"-").concat(oCe(wA+Ee+aM[Ee]));return ye?"".concat(ye,"-").concat(re):re}(t.displayName,t.parentComponentId):a,D=t.displayName,O=D===void 0?function(fe){return oM(fe)?"styled.".concat(fe):"Styled(".concat(aCe(fe),")")}(e):D,F=t.displayName&&t.componentId?"".concat(u8(t.displayName),"-").concat(t.componentId):t.componentId||I,H=s&&c.attrs?c.attrs.concat(x).filter(Boolean):x,Q=t.shouldForwardProp;if(s&&c.shouldForwardProp){var ie=c.shouldForwardProp;if(t.shouldForwardProp){var te=t.shouldForwardProp;Q=function(fe,ye){return ie(fe,ye)&&te(fe,ye)}}else Q=ie}var W=new LCe(r,F,s?c.componentStyle:void 0);function X(fe,ye){return function(Ee,re,he){var _e=Ee.attrs,Se=Ee.componentStyle,J=Ee.defaultProps,Ie=Ee.foldedComponentIds,we=Ee.styledComponentId,Lt=Ee.target,Gt=Xr.useContext(eK),qt=y8(),It=Ee.shouldForwardProp||qt.shouldForwardProp,ct=nCe(re,Gt,J)||Ky,Ut=function(Bt,Pn,$n){for(var Qn,Xt=qa(qa({},Pn),{className:void 0,theme:$n}),mr=0;mr<Bt.length;mr+=1){var An=Qy(Qn=Bt[mr])?Qn(Xt):Qn;for(var cr in An)Xt[cr]=cr==="className"?Em(Xt[cr],An[cr]):cr==="style"?qa(qa({},Xt[cr]),An[cr]):An[cr]}return Pn.className&&(Xt.className=Em(Xt.className,Pn.className)),Xt}(_e,re,ct),Kt=Ut.as||Lt,at={};for(var At in Ut)Ut[At]===void 0||At[0]==="$"||At==="as"||At==="theme"&&Ut.theme===ct||(At==="forwardedAs"?at.as=Ut.forwardedAs:It&&!It(At,Kt)||(at[At]=Ut[At]));var Et=function(Bt,Pn){var $n=y8(),Qn=Bt.generateAndInjectStyles(Pn,$n.styleSheet,$n.stylis);return Qn}(Se,Ut),Jt=Em(Ie,we);return Et&&(Jt+=" "+Et),Ut.className&&(Jt+=" "+Ut.className),at[oM(Kt)&&!UX.has(Kt)?"class":"className"]=Jt,at.ref=he,G.createElement(Kt,at)}(ee,fe,ye)}X.displayName=O;var ee=Xr.forwardRef(X);return ee.attrs=H,ee.componentStyle=W,ee.displayName=O,ee.shouldForwardProp=Q,ee.foldedComponentIds=s?Em(c.foldedComponentIds,c.styledComponentId):"",ee.styledComponentId=F,ee.target=s?c.target:e,Object.defineProperty(ee,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(fe){this._foldedDefaultProps=s?function(ye){for(var Ee=[],re=1;re<arguments.length;re++)Ee[re-1]=arguments[re];for(var he=0,_e=Ee;he<_e.length;he++)B4(ye,_e[he],!0);return ye}({},c.defaultProps,fe):fe}}),vL(ee,function(){return".".concat(ee.styledComponentId)}),f&&HX(ee,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),ee}function x8(e,t){for(var r=[e[0]],s=0,c=t.length;s<c;s+=1)r.push(t[s],e[s+1]);return r}var b8=function(e){return Object.assign(e,{isCss:!0})};function NCe(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(Qy(e)||Xx(e))return b8(Lm(x8(TA,pI([e],t,!0))));var s=e;return t.length===0&&s.length===1&&typeof s[0]=="string"?Lm(s):b8(Lm(x8(s,t)))}function U4(e,t,r){if(r===void 0&&(r=Ky),!t)throw Db(1,t);var s=function(c){for(var f=[],_=1;_<arguments.length;_++)f[_-1]=arguments[_];return e(t,r,NCe.apply(void 0,pI([c],f,!1)))};return s.attrs=function(c){return U4(e,t,qa(qa({},r),{attrs:Array.prototype.concat(r.attrs,c).filter(Boolean)}))},s.withConfig=function(c){return U4(e,t,qa(qa({},r),c))},s}var tK=function(e){return U4(zCe,e)},g0=tK;UX.forEach(function(e){g0[e]=tK(e)});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function yI(e,t,r,s){return new(r||(r=Promise))(function(c,f){function _(I){try{a(s.next(I))}catch(D){f(D)}}function x(I){try{a(s.throw(I))}catch(D){f(D)}}function a(I){I.done?c(I.value):new r(function(D){D(I.value)}).then(_,x)}a((s=s.apply(e,[])).next())})}function vI(e,t){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},s,c,f,_;return _={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function x(I){return function(D){return a([I,D])}}function a(I){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,c&&(f=I[0]&2?c.return:I[0]?c.throw||((f=c.return)&&f.call(c),0):c.next)&&!(f=f.call(c,I[1])).done)return f;switch(c=0,f&&(I=[I[0]&2,f.value]),I[0]){case 0:case 1:f=I;break;case 4:return r.label++,{value:I[1],done:!1};case 5:r.label++,c=I[1],I=[0];continue;case 7:I=r.ops.pop(),r.trys.pop();continue;default:if(f=r.trys,!(f=f.length>0&&f[f.length-1])&&(I[0]===6||I[0]===2)){r=0;continue}if(I[0]===3&&(!f||I[1]>f[0]&&I[1]<f[3])){r.label=I[1];break}if(I[0]===6&&r.label<f[1]){r.label=f[1],f=I;break}if(f&&r.label<f[2]){r.label=f[2],r.ops.push(I);break}f[2]&&r.ops.pop(),r.trys.pop();continue}I=t.call(e,r)}catch(D){I=[6,D],c=0}finally{s=f=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}}function Ob(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var FCe=g0.div(T8||(T8=Ob([`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`],[`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`]))),BCe=g0.div(E8||(E8=Ob([`
  width: 100%;
  `,`
`],[`
  width: 100%;
  `,`
`])),function(e){var t=e.aspectRatio;return t==="cover"?`
    position: absolute;
    bottom: 0;
    top: 0;
    left: 0;
    right: 0;`:`
    position: relative;
    padding-bottom: `+100/t+"%;"}),w8=g0.div(S8||(S8=Ob([`
  padding: 40px;
`],[`
  padding: 40px;
`]))),jCe=g0.video(I8||(I8=Ob([`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`],[`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`])),function(e){var t=e.mirrored;return t?"180deg":"0deg"}),UCe=g0.canvas(C8||(C8=Ob([`
  display: none;
`],[`
  display: none;
`]))),T8,E8,S8,I8,C8,nK=Xr.forwardRef(function(e,t){var r=e.facingMode,s=r===void 0?"user":r,c=e.aspectRatio,f=c===void 0?"cover":c,_=e.numberOfCamerasCallback,x=_===void 0?function(){return null}:_,a=e.videoSourceDeviceId,I=a===void 0?void 0:a,D=e.errorMessages,O=D===void 0?{noCameraAccessible:"No camera device accessible. Please connect your camera or try a different browser.",permissionDenied:"Permission denied. Please refresh and give camera permission.",switchCamera:"It is not possible to switch camera to different one because there is only one video device accessible.",canvas:"Canvas is not supported."}:D,F=e.videoReadyCallback,H=F===void 0?function(){return null}:F,Q=G.useRef(null),ie=G.useRef(null),te=G.useRef(null),W=G.useRef(null),X=G.useState(0),ee=X[0],fe=X[1],ye=G.useState(null),Ee=ye[0],re=ye[1],he=G.useState(s),_e=he[0],Se=he[1],J=G.useState(!1),Ie=J[0],we=J[1],Lt=G.useState(!1),Gt=Lt[0],qt=Lt[1],It=G.useState(!1),ct=It[0],Ut=It[1],Kt=G.useState(!1),at=Kt[0],At=Kt[1],Et=G.useRef(!1);G.useEffect(function(){return Et.current=!0,function(){Et.current=!1}},[]),G.useEffect(function(){x(ee)},[ee]);var Jt=function(Bt){return Bt===void 0&&(Bt=!1),yI(void 0,void 0,void 0,function(){var Pn,$n;return vI(this,function(Qn){switch(Qn.label){case 0:if(!(Ee&&(navigator!=null&&navigator.mediaDevices)&&Et.current))return[3,4];if(Pn=navigator.mediaDevices.getSupportedConstraints(),$n=Ee.getTracks()[0],!(Pn&&"torch"in Pn&&$n))return[3,4];Qn.label=1;case 1:return Qn.trys.push([1,3,,4]),[4,$n.applyConstraints({advanced:[{torch:Bt}]})];case 2:return Qn.sent(),[2,!0];case 3:return Qn.sent(),[2,!1];case 4:return[2,!1]}})})};return G.useEffect(function(){Jt(at)},[at]),G.useImperativeHandle(t,function(){return{takePhoto:function(Bt){var Pn,$n,Qn,Xt,mr;if(ee<1)throw new Error(O.noCameraAccessible);if(ie!=null&&ie.current){var An=((Pn=Q==null?void 0:Q.current)===null||Pn===void 0?void 0:Pn.videoWidth)||1280,cr=(($n=Q==null?void 0:Q.current)===null||$n===void 0?void 0:$n.videoHeight)||720,zr=An/cr,qn=((Qn=W==null?void 0:W.current)===null||Qn===void 0?void 0:Qn.offsetWidth)||1280,Mr=((Xt=W==null?void 0:W.current)===null||Xt===void 0?void 0:Xt.offsetHeight)||1280,Vr=qn/Mr,kn=void 0,zn=void 0,Ue=void 0,Ye=void 0,gt=void 0;switch(zr>Vr?(Ye=cr,Ue=cr*Vr,kn=(An-Ue)/2,zn=0):(Ue=An,Ye=An/Vr,kn=0,zn=(cr-Ye)/2),ie.current.width=Ue,ie.current.height=Ye,te.current||(te.current=ie.current.getContext("2d",{willReadFrequently:!0})),te.current&&(Q!=null&&Q.current)&&te.current.drawImage(Q.current,kn,zn,Ue,Ye,0,0,Ue,Ye),Bt){case"imgData":gt=(mr=te.current)===null||mr===void 0?void 0:mr.getImageData(0,0,Ue,Ye);break;default:gt=ie.current.toDataURL("image/jpeg");break}return gt}else throw new Error(O.canvas)},switchCamera:function(){if(ee<1)throw new Error(O.noCameraAccessible);ee<2&&console.error("Error: Unable to switch camera. Only one device is accessible.");var Bt=_e==="user"?"environment":"user";return Se(Bt),Bt},getNumberOfCameras:function(){return ee},toggleTorch:function(){var Bt=!at;return At(Bt),Bt},torchSupported:ct}}),G.useEffect(function(){$Ce(Ee,re,_e,I,fe,we,qt,!!Et.current)},[_e,I]),G.useEffect(function(){return Jt(!1).then(function(Bt){return Ut(Bt)}),Ee&&Q&&Q.current&&(Q.current.srcObject=Ee),function(){Ee&&Ee.getTracks().forEach(function(Bt){Bt.stop()})}},[Ee]),Xr.createElement(BCe,{ref:W,aspectRatio:f},Xr.createElement(FCe,null,Ie?Xr.createElement(w8,null,O.noCameraAccessible):null,Gt?Xr.createElement(w8,null,O.permissionDenied):null,Xr.createElement(jCe,{ref:Q,id:"video",muted:!0,autoPlay:!0,playsInline:!0,mirrored:_e==="user",onLoadedData:function(){H()}}),Xr.createElement(UCe,{ref:ie})))});nK.displayName="Camera";var VCe=function(e){return yI(void 0,void 0,void 0,function(){var t;return vI(this,function(r){switch(r.label){case 0:return t=[],e!=="environment"?[3,2]:[4,navigator.mediaDevices.enumerateDevices().then(function(s){var c=s.filter(function(f){return f.kind=="videoinput"});c.forEach(function(f){var _=f.getCapabilities();_.facingMode&&_.facingMode.indexOf("environment")>=0&&_.deviceId&&t.push(_.deviceId)})})];case 1:r.sent(),r.label=2;case 2:return t.length>1?[2,t.pop()]:[2,void 0]}})})},$Ce=function(e,t,r,s,c,f,_,x){return yI(void 0,void 0,void 0,function(){var a,I,D,O,F;return vI(this,function(H){switch(H.label){case 0:return e&&e.getTracks().forEach(function(Q){Q.stop()}),[4,VCe(r)];case 1:return I=H.sent(),I?a=I:a=s?{exact:s}:void 0,D={audio:!1,video:{deviceId:a,facingMode:r}},!((F=navigator==null?void 0:navigator.mediaDevices)===null||F===void 0)&&F.getUserMedia?navigator.mediaDevices.getUserMedia(D).then(function(Q){x&&t(A8(Q,c))}).catch(function(Q){P8(Q,f,_)}):(O=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,O?O(D,function(Q){return yI(void 0,void 0,void 0,function(){return vI(this,function(ie){return x&&t(A8(Q,c)),[2]})})},function(Q){P8(Q,f,_)}):f(!0)),[2]}})})},A8=function(e,t){return navigator.mediaDevices.enumerateDevices().then(function(r){return t(r.filter(function(s){return s.kind==="videoinput"}).length)}),e},P8=function(e,t,r){console.error(e),e.name==="PermissionDeniedError"?r(!0):t(!0)};const qCe=()=>{const[e,t]=G.useState(null),[r,s]=G.useState("1:1"),[c,f]=G.useState(""),[_,x]=G.useState(!1),[a,I]=G.useState({x:0,y:0}),[D,O]=G.useState({width:0,height:0}),[F,H]=G.useState(""),[Q,ie]=G.useState("user"),[te,W]=G.useState(!1),[X,ee]=G.useState(null),[fe,ye]=G.useState(!1),Ee=AX(),re=rg(),he=G.useRef(null),_e=G.useRef(null),Se=G.useRef(null),J=G.useCallback(()=>{if(he.current){const at=he.current.takePhoto(),At=new Image;At.onload=()=>{const Et=document.createElement("canvas");Et.width=At.width,Et.height=At.height,Et.getContext("2d").drawImage(At,0,0,At.width,At.height);const Bt=Et.toDataURL("image/png",1);t(Bt),H(new Date().toLocaleTimeString())},At.src=at}},[]),Ie=at=>{s(at),ye(!0),W(!1),we(at)},we=at=>{if(_e.current){const At=_e.current.getBoundingClientRect(),[Et,Jt]=at.split(":").map(Number);let Bt,Pn;At.width/At.height>Et/Jt?(Pn=At.height,Bt=Pn*Et/Jt):(Bt=At.width,Pn=Bt*Jt/Et),Bt=Math.min(Bt,At.width),Pn=Math.min(Pn,At.height),O({width:Bt,height:Pn}),I({x:(At.width-Bt)/2,y:(At.height-Pn)/2})}},Lt=()=>Be(xn,null,function*(){x(!0);try{const at=yield Gt(),At=k2(Tge,`quest_images/${Date.now()}_${Zt.currentUser.uid}.jpg`);yield _ge(At,at,"data_url");const Jt={imageUrl:yield M2(At),aspectRatio:r,time:new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),user:(Ee==null?void 0:Ee.name)||"Anonymous",description:c,createdAt:new Date().toISOString(),userId:Zt.currentUser.uid};yield kx(Ci(bn,"quests"),Jt),re("/home")}catch(at){console.error("Error uploading quest:",at)}finally{x(!1)}}),Gt=()=>new Promise(at=>{const At=document.createElement("canvas"),Et=At.getContext("2d"),Jt=_e.current,Bt=Se.current;if(!Jt||!Bt){console.error("Image or crop reference is missing"),at(null);return}const Pn=Jt.naturalWidth/Jt.width,$n=Jt.naturalHeight/Jt.height;At.width=D.width*Pn,At.height=D.height*$n,Et.drawImage(Jt,a.x*Pn,a.y*$n,D.width*Pn,D.height*$n,0,0,At.width,At.height),At.toBlob(Qn=>{if(!Qn){console.error("Failed to create blob from canvas"),at(null);return}const Xt=new FileReader;Xt.onloadend=()=>at(Xt.result),Xt.readAsDataURL(Qn)},"image/jpeg")}),qt=at=>{if(Se.current&&_e.current){const At=_e.current.getBoundingClientRect(),Et=Se.current.getBoundingClientRect();let Jt=at.clientX-At.left-Et.width/2,Bt=at.clientY-At.top-Et.height/2;Jt=Math.max(0,Math.min(Jt,At.width-Et.width)),Bt=Math.max(0,Math.min(Bt,At.height-Et.height)),I({x:Jt,y:Bt})}},It=()=>{e?(t(null),W(!1),ye(!1)):re("/home")},ct=()=>{ie(at=>at==="user"?"environment":"user")},Ut=()=>{W(!0),ye(!1)},Kt=()=>{W(!1),ye(!0),we(r)};return G.useEffect(()=>{if(_e.current&&Se.current){const at=_e.current.getBoundingClientRect(),At=Se.current.getBoundingClientRect();I({x:(at.width-At.width)/2,y:(at.height-At.height)/2})}},[r]),N.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",width:"100vw",backgroundColor:"#000",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:10001,border:"solid 50px white",borderRadius:"50px"},children:[X&&N.jsx("div",{style:{color:"red"},children:X}),e?N.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"space-between",height:"100%",width:"100%",backgroundColor:"#000"},children:[N.jsxs("div",{style:{position:"relative",width:"100%",height:"calc(100% - 200px)",overflow:"hidden"},onMouseMove:qt,children:[N.jsx("img",{ref:_e,src:e,alt:"Captured",style:{width:"100%",height:"100%",objectFit:"cover",transform:"scalex(-1)"}}),N.jsx("div",{ref:Se,style:{position:"absolute",border:"2px solid #fff",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)",left:`${a.x}px`,top:`${a.y}px`,width:`${D.width}px`,height:`${D.height}px`},children:N.jsx(Rbe,{style:{position:"absolute",top:"10px",left:"10px",color:"#fff",fontSize:"24px"}})})]}),N.jsxs("div",{style:{width:"100%",padding:"20px",backgroundColor:"#fff",borderTopLeftRadius:"20px",borderTopRightRadius:"20px"},children:[N.jsx("div",{style:{display:"flex",justifyContent:"space-around",marginBottom:"20px"},children:["1:1","4:5","9:16"].map(at=>N.jsx(fm,{onClick:()=>Ie(at),style:{flex:1,margin:"0 5px",padding:"10px",borderRadius:"20px",fontWeight:"bold",height:"70px",width:"70px",textTransform:"none",backgroundColor:r===at?"#3797EF":"transparent",color:r===at?"#fff":"#3797EF",border:r===at?"none":"2px solid #333333"},disabled:te,children:at},at))}),fe&&!te&&N.jsx(fm,{variant:"contained",onClick:Ut,style:{width:"100%",marginBottom:"20px",borderRadius:"20px",backgroundColor:"#3797EF",color:"#fff",fontWeight:"bold",textTransform:"none"},children:"Finalize Crop"}),te&&N.jsx(fm,{variant:"outlined",onClick:Kt,style:{width:"100%",marginBottom:"20px",borderRadius:"20px",color:"#3797EF",borderColor:"#3797EF"},startIcon:N.jsx(Dbe,{}),children:"Reset Crop"}),N.jsx(zH,{fullWidth:!0,variant:"outlined",placeholder:"Add a description...",value:c,onChange:at=>f(at.target.value),style:{marginBottom:"20px"},InputProps:{style:{borderRadius:"20px"}}}),N.jsx(fm,{variant:"contained",color:"primary",onClick:Lt,disabled:_||!te,style:{width:"100%",padding:"10px",borderRadius:"20px",backgroundColor:"#3797EF",color:"#fff",fontWeight:"bold",textTransform:"none"},children:"Done"})]}),N.jsx(fm,{onClick:It,style:{position:"absolute",top:"20px",left:"20px",color:"#fff",fontWeight:"bold"},children:"Cancel"})]}):N.jsxs(N.Fragment,{children:[N.jsx("div",{style:{borderRadius:"25px",overflow:"",border:"solid 10px blue",width:"105%",height:"100%",display:"inline-block",position:"absolute"},children:N.jsx(nK,{ref:he,facingMode:Q,aspectRatio:"cover",errorMessages:{},videoSourceDeviceId:void 0,numberOfCamerasCallback:at=>console.log(at),videoResolution:"highest",onError:at=>ee("Could not start video source. Please check your camera permissions.")})}),N.jsxs("div",{style:{position:"absolute",bottom:"40px",left:0,right:0,display:"flex",justifyContent:"center",alignItems:"center"},children:[N.jsx(Tm,{onClick:It,style:{color:"#fff"},children:N.jsx(NH,{})}),N.jsx(Tm,{onClick:J,style:{width:"70px",height:"70px",borderRadius:"50%",backgroundColor:"rgba(255, 255, 255, 0.3)",display:"flex",justifyContent:"center",alignItems:"center",marginRight:"30px",marginLeft:"30px"},children:N.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",backgroundColor:"#fff"}})}),N.jsx(Tm,{onClick:ct,style:{color:"#fff"},children:N.jsx(Mbe,{})})]})]})]})},GCe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M380-320q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l224 224q11 11 11 28t-11 28q-11 11-28 11t-28-11L532-372q-30 24-69 38t-83 14Zm0-80q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"})),WCe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M459-381 314-526q-3-3-4.5-6.5T308-540q0-8 5.5-14t14.5-6h304q9 0 14.5 6t5.5 14q0 2-6 14L501-381q-5 5-10 7t-11 2q-6 0-11-2t-10-7Z"})),R8=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M480-320q75 0 127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75 0-127.5 52.5T300-500q0 75 52.5 127.5T480-320Zm.18-93q-36.18 0-61.68-25.32-25.5-25.33-25.5-61.5 0-36.18 25.32-61.68 25.33-25.5 61.5-25.5 36.18 0 61.68 25.32 25.5 25.33 25.5 61.5 0 36.18-25.32 61.68-25.33 25.5-61.5 25.5ZM480-169q-140 0-256.5-74T41-441q-8-14-11.5-29T26-500q0-15 3.5-30T41-559q66-124 182.5-198T480-831q140 0 256.5 74T919-559q8 14 11.5 29t3.5 30q0 15-3.5 30T919-441q-66 124-182.5 198T480-169Zm0-331Zm.09 220Q592-280 685.5-340T829-500q-50-100-143.59-160t-205.5-60Q368-720 274.5-660T131-500q50 100 143.59 160t205.5 60Z"})),M8=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M607-627q15 15 27 36.5t19 44.5q0 22-15 37t-37 15q-22 0-37-15t-15-37q2-7 0-12.5t-7-10.5q-5-5-10.5-7.5T518-577q-20 0-34.5-15T469-627q0-20 14.5-34.5T518-676q25 5 47 17t42 32Zm-127-93q-10 0-19.5.5T441-718q-23 2-43-10t-26-35q-6-23 6-42t35-22q17-2 33.5-3t33.5-1q144 0 264.5 76.5T928-547q5 11 8 23t3 24q0 12-2 24.5t-7 23.5q-17 34-39 64.5T843-329q-15 17-37.5 15T768-333q-15-17-14-40t16-40q17-20 32-42t28-45q-52-100-145-160t-205-60Zm0 551q-140 0-257.5-74.5T39-443q-7-14-10.5-28T25-500q0-15 3-29.5T38-558q18-37 42.5-69.5T134-689l-73-73q-14-14-14-33t14-33q14-14 33.5-14t33.5 14l685 685q14 14 14 33t-14 33q-14 14-33 14t-33-14L630-193q-36 13-74 18.5t-76 5.5ZM213-613q-25 26-45 54t-37 59q50 101 143.5 160.5T480-280q15 0 30-1.5t30-3.5l-36-38q-6 2-12 2.5t-12 .5q-75 0-127.5-52.5T300-500v-12q0-6 1-12l-88-89Zm343 74Zm-180 90Z"})),k8=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M9-257q0-43.3 22.7-79.6Q54.39-372.9 92-392q65-32 132.96-48.5Q292.92-457 363-457q72 0 140 16t131 48q37.61 18.96 60.3 54.98Q717-302 717-257v22q0 53-36.5 89.5T591-109H135q-53 0-89.5-36.5T9-235v-22Zm816 148h-71q22-27 32.5-59t10.5-67v-22q0-51-24.5-105T689-454q44 7 91.5 24t85.5 37q40 20 62.5 55.81T951-259v24q0 53-36.5 89.5T825-109ZM363-497q-74 0-125.5-51.5T186-674q0-74 51.5-125.5T363-851q74 0 125.5 51.5T540-674q0 74-51.5 125.5T363-497Zm449-177.01Q812-601 760.05-549q-51.94 52-124.89 52-12.16 0-28.16-3t-31-8q29-34 44-76.85 15-42.85 15-89T620-763q-15-43-44-77 15-6 29-8.5t29.53-2.5q73.21 0 125.34 51.99 52.13 51.99 52.13 125ZM135-235h456v-17q0-10.03-5.5-18.24-5.5-8.2-14.5-12.76-48-23-100-35.5T363-331q-54 0-108 12.5T155-283q-9 4.56-14.5 12.76-5.5 8.21-5.5 18.24v17Zm227.84-373q27.16 0 46.66-19.34 19.5-19.34 19.5-46.5t-19.34-46.66q-19.34-19.5-46.5-19.5t-46.66 19.34q-19.5 19.34-19.5 46.5t19.34 46.66q19.34 19.5 46.5 19.5Zm.16 373Zm0-439Z"})),HCe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"m480-413 100 100q14 14 33.5 13.5T647-314q14-14 14-33.5T647-381l-100-99 100-100q14-14 14-33.5T647-647q-14-14-33.5-14T580-647L480-547 380-647q-14-14-33-14t-33 14q-14 14-14 33.5t14 33.5l99 100-100 100q-14 14-13.5 33t14.5 33q14 14 33.5 14t33.5-14l99-99Zm0 367q-91 0-170-34t-137.5-92.5Q114-231 80-310T46-480q0-91 34-170t92.5-137.5Q231-846 310-880t170-34q91 0 170 34t137.5 92.5Q846-729 880-650t34 170q0 91-34 170t-92.5 137.5Q729-114 650-80T480-46Zm0-126q130 0 219-89t89-219q0-130-89-219t-219-89q-130 0-219 89t-89 219q0 130 89 219t219 89Zm0-308Z"})),ZCe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M481-105q-162 0-269-106.5T105-480q0-121 68-222.5T375-840q23-8 42-5.5t32.5 12.5q13.5 10 19.5 26t4 36q-4 22-8 41t-4 38q0 97.08 68.54 165.04T696-459q20 0 40.5-2.5T776-468q19-2 33.5 3.5t23.03 16.5q9.47 11 11.97 28.5T840-379q-32 123-131.5 198.5T481-105Zm0-126q62 0 115.5-28.5T683-337q-10 1-19.5 1t-18.5-2q-119-17-203-98.5T339-645q-1-9-1.5-19t1.5-19q-48 34-77.5 88T232-480q0 103.16 72.92 176.08Q377.84-231 481-231Zm-23-226Z"})),XCe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M480-406q31 0 52.5-21.5T554-480q0-31-21.5-52.5T480-554q-31 0-52.5 21.5T406-480q0 31 21.5 52.5T480-406Zm0 126q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM80-417q-26 0-44.5-18.5T17-480q0-26 18.5-44.5T80-543h80q26 0 44.5 18.5T223-480q0 26-18.5 44.5T160-417H80Zm720 0q-26 0-44.5-18.5T737-480q0-26 18.5-44.5T800-543h80q26 0 44.5 18.5T943-480q0 26-18.5 44.5T880-417h-80ZM480-737q-26 0-44.5-18.5T417-800v-80q0-26 18.5-44.5T480-943q26 0 44.5 18.5T543-880v80q0 26-18.5 44.5T480-737Zm0 720q-26 0-44.5-18.5T417-80v-80q0-26 18.5-44.5T480-223q26 0 44.5 18.5T543-160v80q0 26-18.5 44.5T480-17ZM210-661l-43-42q-19-18-18.5-44t18.5-46q18-19 44-19t45 19l43 43q18 18 17.5 43.5T299-662q-18 19-44 19.5T210-661Zm494 494-43-43q-18-18-18-43.5t18-44.5q18-19 44-18.5t45 18.5l43 41q19 18 18.5 44T793-167q-18 19-44 19t-45-19Zm-42-494q-19-18-18.5-44t18.5-45l41-43q18-19 44-18.5t46 18.5q19 18 19 44t-19 45l-43 43q-18 18-43.5 17.5T662-661ZM167-167q-19-18-19-44t19-45l43-43q18-18 43.5-18t44.5 18q19 18 18.5 44T298-210l-41 43q-18 19-44 18.5T167-167Zm313-313Z"})),KCe=e=>G.createElement("svg",de({xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#e8eaed"},e),G.createElement("path",{d:"M634-380H291q-86 0-145.5-60.5T86-587q0-86 59.5-146.5T291-794q26 0 44.5 18.5T354-731q0 26-18.5 44.5T291-668q-33 0-56 24t-23 57q0 33 23 57t56 24h343l-81-81q-18-18-18.5-43.5T553-675q19-19 44.5-19t44.5 19l188 188q18 19 18 44t-18 44L642-211q-18 19-43.5 19T554-211q-18-18-18-44t18-44l80-81Z"}));function QCe(){const{showNotification:e}=f0(),t=rg(),[r,s]=G.useState(O4()),c=()=>{EX(),s(O4())};G.useEffect(()=>{const _=x=>{s(x.detail.isLightMode?"light":"dark")};return window.addEventListener("themeChanged",_),()=>{window.removeEventListener("themeChanged",_)}},[]);const f=G.useCallback(()=>Be(this,null,function*(){try{yield LZ(),e("Logged out successfully"),t("/login")}catch(_){console.error("Logout failed:",_),e("Logout failed. Please try again.")}}),[e,t]);return N.jsx(_A,{children:N.jsxs("div",{className:"settings-container",children:[N.jsxs("header",{children:[N.jsx(RX,{onClick:()=>t("/home/profile")}),N.jsx("h2",{children:"Settings"})]}),N.jsxs("section",{children:[N.jsx("h3",{children:"Privacy"}),N.jsx(YCe,{})]}),N.jsxs("section",{children:[N.jsx("h3",{children:"Theme"}),N.jsxs("div",{className:"setting-option",onClick:c,children:[N.jsx("div",{children:N.jsx("p",{children:r==="light"?"Light Mode":"Dark Mode"})}),N.jsx("div",{className:"setting-icons",children:r==="light"?N.jsx(XCe,{}):N.jsx(ZCe,{})})]})]}),N.jsxs("section",{children:[N.jsx("h3",{children:"Account"}),N.jsxs("div",{className:"setting-option nogap",id:"logout",children:["Logout",N.jsx("div",{className:"logout-button",onClick:f,children:N.jsx(KCe,{})})]})]})]})})}function YCe(){const[e,t]=G.useState({friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),[r,s]=G.useState(1),[c,f]=G.useState([]),[_,x]=G.useState(""),[a,I]=G.useState([]);G.useState(window.innerHeight*.5),G.useEffect(()=>{D()},[]),G.useEffect(()=>{const te=(e.friendsCanSeeLocation?1:0)+(e.quietMap?2:0);s(te)},[e.friendsCanSeeLocation,e.quietMap]);const D=()=>Be(this,null,function*(){try{const W=(yield Ki(er(bn,"users",Zt.currentUser.uid))).data();t(W.privacySettings||{friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),f(W.customVisibilityList||[])}catch(te){console.error("Error fetching privacy settings:",te)}}),O=()=>{const te=(r+1)%4;switch(s(te),te){case 0:F("friendsCanSeeLocation",!1),F("quietMap",!1);break;case 1:F("friendsCanSeeLocation",!0),F("quietMap",!1);break;case 2:F("friendsCanSeeLocation",!1),F("quietMap",!0);break;case 3:F("friendsCanSeeLocation",!0),F("quietMap",!0);break}},F=(te,W)=>Be(this,null,function*(){try{const X=_t(de({},e),{[te]:W});t(X),yield ss(er(bn,"users",Zt.currentUser.uid),{privacySettings:X})}catch(X){console.error("Error updating privacy setting:",X)}}),H=te=>Be(this,null,function*(){if(x(te.target.value),te.target.value.length>2)try{const W=Ci(bn,"users"),X=go(W,Ii("username",">=",te.target.value),Ii("username","<=",te.target.value+"")),fe=(yield wa(X)).docs.map(ye=>de({id:ye.id},ye.data()));I(fe)}catch(W){console.error("Error searching users:",W)}else I([])}),Q=te=>Be(this,null,function*(){if(te&&!c.some(W=>W.id===te.id)){const W=[...c,te];f(W),x(""),I([]);try{yield ss(er(bn,"users",Zt.currentUser.uid),{customVisibilityList:W})}catch(X){console.error("Error updating custom list:",X)}}}),ie=te=>Be(this,null,function*(){const W=c.filter(X=>X.id!==te);f(W);try{yield ss(er(bn,"users",Zt.currentUser.uid),{customVisibilityList:W})}catch(X){console.error("Error updating custom list:",X)}});return N.jsxs("div",{children:[N.jsxs("div",{className:"setting-option",children:[N.jsxs("div",{children:[N.jsx("p",{children:"Location Visibility"}),N.jsx("span",{children:"Only Friends can see my Location"})]}),N.jsxs("div",{className:"setting-icons",onClick:O,children:[r===0&&N.jsx(R8,{}),r===1&&N.jsxs(N.Fragment,{children:[N.jsx(R8,{}),N.jsx(k8,{})]}),r===2&&N.jsx(M8,{}),r===3&&N.jsxs(N.Fragment,{children:[N.jsx(M8,{}),N.jsx(k8,{})]})]})]}),N.jsxs("div",{className:"setting-option",children:[N.jsxs("div",{children:[N.jsx("p",{children:"Visibility List"}),N.jsx("span",{children:"Use Custom Visibility List"})]}),N.jsx("div",{className:"setting-icons",onClick:()=>F("useCustomVisibilityList",!e.useCustomVisibilityList),children:e.useCustomVisibilityList?N.jsx(yX,{}):N.jsx(HCe,{})})]}),e.useCustomVisibilityList&&N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"search-user",children:[N.jsx("input",{type:"text",value:_,onChange:H,placeholder:"Search users..."}),N.jsx("div",{className:"search-results",children:a.map(te=>N.jsxs("div",{className:"search-result-item",onClick:()=>Q(te),children:[N.jsx("img",{src:te.profilePhoto||"/default-profile.png",alt:te.username,className:"user-avatar"}),N.jsx("span",{children:te.username})]},te.id))})]}),N.jsx("div",{className:"custom-list",children:c.map(te=>N.jsxs("div",{className:"custom-list-item",children:[N.jsx("img",{src:te.profilePhoto||"/default-profile.png",alt:te.username,className:"user-avatar"}),N.jsx("span",{children:te.username}),N.jsx("button",{onClick:()=>ie(te.id),children:"Remove"})]},te.id))})]})]})}function JCe(){const e=hV("(max-width:800px)"),t=hV("(max-width:550px)"),r=G.useRef(null),[s,c]=G.useState(!1),[f,_]=G.useState(!1);G.useState(!1),Xr.useState(!1),G.useEffect(()=>{const a=()=>{if(console.debug("scroll"),r.current){const I=r.current.getBoundingClientRect();c(I.bottom<48)}};return window.addEventListener("scroll",a,!0),a(),()=>{window.removeEventListener("scroll",a,!0)}},[]);const x=()=>{_(!0)};return N.jsxs("div",{className:"main-page",children:[t&&N.jsx(OIe,{show:s}),N.jsxs("div",{className:"left-panel",children:[N.jsx(kIe,{}),N.jsxs(rq,{children:[N.jsx(Fc,{path:"profile",element:N.jsx(vX,{})}),N.jsx(Fc,{path:"settings",element:N.jsx(QCe,{})}),N.jsx(Fc,{path:"connections",element:N.jsx(IX,{})}),N.jsx(Fc,{path:"camera",element:N.jsx(qCe,{})}),N.jsx(Fc,{path:"quests",element:N.jsx(xX,{isCreateQuestOpen:f,setIsCreateQuestOpen:_})})]})]}),N.jsxs("div",{className:"body-section",children:[N.jsx("div",{className:"middle-panel",children:N.jsx(DIe,{})}),N.jsx("div",{className:"right-panel",ref:r,children:N.jsxs("div",{className:"right-panel right-panel-sticky",children:[N.jsx(MX,{}),N.jsx("div",{className:"button-section",children:e?N.jsxs(N.Fragment,{children:[N.jsx(V4,{}),N.jsx(q4,{onClick:x}),N.jsx($4,{})]}):N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"actions-container",children:[N.jsx(V4,{}),N.jsx($4,{})]}),N.jsx(q4,{onClick:x})]})})]})})]}),f&&N.jsx(LIe,{isOpen:f,onClose:()=>_(!1)})]})}function V4({small:e=!1}){return N.jsxs("div",{className:`search ${e&&"small"}`,children:[N.jsx("div",{className:"icon-container",children:N.jsx(GCe,{})}),!e&&N.jsx("input",{className:"search-input",type:"text",placeholder:"Find Quests"})]})}function $4({small:e=!1}){const[t,r]=G.useState("Near You");return N.jsxs("button",{className:`filter-button ${e&&"small"}`,children:[N.jsx("div",{className:"icon-container",children:N.jsx(WCe,{})}),t]})}function q4({small:e=!1,onClick:t}){return N.jsxs("button",{className:`create-button ${e&&"small"}`,onClick:t,children:[N.jsx("div",{className:"icon-container",children:N.jsx(PX,{})}),!e&&"Create Quest"]})}function eAe(){return G.useEffect(()=>{SX()},[]),N.jsx(JTe,{children:N.jsx(sEe,{children:N.jsxs(AIe,{children:[" ",N.jsx(Jne,{children:N.jsxs(rq,{children:[N.jsx(Fc,{path:"/",element:N.jsx(CIe,{})}),N.jsx(Fc,{path:"/login",element:N.jsx(zge,{})}),N.jsx(Fc,{path:"/register",element:N.jsx(Nge,{})}),N.jsx(Fc,{path:"/home/*",element:N.jsxs(N.Fragment,{children:[N.jsx(JCe,{}),N.jsx(s8,{})]})}),N.jsx(Fc,{path:"/adventure-feed",element:N.jsx(N.Fragment,{children:N.jsx(s8,{})})})]})})]})})})}G7(document.getElementById("root")).render(N.jsx(G.StrictMode,{children:N.jsx(eAe,{})}))});export default tAe();
//# sourceMappingURL=index-CAdqVA_r.js.map
