var uJ=Object.defineProperty;var hJ=(t,e,r)=>e in t?uJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var dJ=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Mv=(t,e,r)=>hJ(t,typeof e!="symbol"?e+"":e,r);var jCe=dJ((hl,dl)=>{function fJ(t,e){for(var r=0;r<e.length;r++){const s=e[r];if(typeof s!="string"&&!Array.isArray(s)){for(const c in s)if(c!=="default"&&!(c in t)){const d=Object.getOwnPropertyDescriptor(s,c);d&&Object.defineProperty(t,c,d.get?d:{enumerable:!0,get:()=>s[c]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const _ of d.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function r(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function s(c){if(c.ep)return;c.ep=!0;const d=r(c);fetch(c.href,d)}})();var v8=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var x8={exports:{}},uI={},b8={exports:{}},Wr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ux=Symbol.for("react.element"),pJ=Symbol.for("react.portal"),mJ=Symbol.for("react.fragment"),gJ=Symbol.for("react.strict_mode"),_J=Symbol.for("react.profiler"),yJ=Symbol.for("react.provider"),vJ=Symbol.for("react.context"),xJ=Symbol.for("react.forward_ref"),bJ=Symbol.for("react.suspense"),wJ=Symbol.for("react.memo"),TJ=Symbol.for("react.lazy"),xB=Symbol.iterator;function EJ(t){return t===null||typeof t!="object"?null:(t=xB&&t[xB]||t["@@iterator"],typeof t=="function"?t:null)}var w8={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T8=Object.assign,E8={};function Wy(t,e,r){this.props=t,this.context=e,this.refs=E8,this.updater=r||w8}Wy.prototype.isReactComponent={};Wy.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Wy.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function S8(){}S8.prototype=Wy.prototype;function D4(t,e,r){this.props=t,this.context=e,this.refs=E8,this.updater=r||w8}var L4=D4.prototype=new S8;L4.constructor=D4;T8(L4,Wy.prototype);L4.isPureReactComponent=!0;var bB=Array.isArray,I8=Object.prototype.hasOwnProperty,z4={current:null},C8={key:!0,ref:!0,__self:!0,__source:!0};function A8(t,e,r){var s,c={},d=null,_=null;if(e!=null)for(s in e.ref!==void 0&&(_=e.ref),e.key!==void 0&&(d=""+e.key),e)I8.call(e,s)&&!C8.hasOwnProperty(s)&&(c[s]=e[s]);var x=arguments.length-2;if(x===1)c.children=r;else if(1<x){for(var a=Array(x),I=0;I<x;I++)a[I]=arguments[I+2];c.children=a}if(t&&t.defaultProps)for(s in x=t.defaultProps,x)c[s]===void 0&&(c[s]=x[s]);return{$$typeof:Ux,type:t,key:d,ref:_,props:c,_owner:z4.current}}function SJ(t,e){return{$$typeof:Ux,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function N4(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ux}function IJ(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var wB=/\/+/g;function C3(t,e){return typeof t=="object"&&t!==null&&t.key!=null?IJ(""+t.key):e.toString(36)}function iE(t,e,r,s,c){var d=typeof t;(d==="undefined"||d==="boolean")&&(t=null);var _=!1;if(t===null)_=!0;else switch(d){case"string":case"number":_=!0;break;case"object":switch(t.$$typeof){case Ux:case pJ:_=!0}}if(_)return _=t,c=c(_),t=s===""?"."+C3(_,0):s,bB(c)?(r="",t!=null&&(r=t.replace(wB,"$&/")+"/"),iE(c,e,r,"",function(I){return I})):c!=null&&(N4(c)&&(c=SJ(c,r+(!c.key||_&&_.key===c.key?"":(""+c.key).replace(wB,"$&/")+"/")+t)),e.push(c)),1;if(_=0,s=s===""?".":s+":",bB(t))for(var x=0;x<t.length;x++){d=t[x];var a=s+C3(d,x);_+=iE(d,e,r,a,c)}else if(a=EJ(t),typeof a=="function")for(t=a.call(t),x=0;!(d=t.next()).done;)d=d.value,a=s+C3(d,x++),_+=iE(d,e,r,a,c);else if(d==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return _}function gT(t,e,r){if(t==null)return t;var s=[],c=0;return iE(t,s,"","",function(d){return e.call(r,d,c++)}),s}function CJ(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var xa={current:null},sE={transition:null},AJ={ReactCurrentDispatcher:xa,ReactCurrentBatchConfig:sE,ReactCurrentOwner:z4};function P8(){throw Error("act(...) is not supported in production builds of React.")}Wr.Children={map:gT,forEach:function(t,e,r){gT(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return gT(t,function(){e++}),e},toArray:function(t){return gT(t,function(e){return e})||[]},only:function(t){if(!N4(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Wr.Component=Wy;Wr.Fragment=mJ;Wr.Profiler=_J;Wr.PureComponent=D4;Wr.StrictMode=gJ;Wr.Suspense=bJ;Wr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=AJ;Wr.act=P8;Wr.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=T8({},t.props),c=t.key,d=t.ref,_=t._owner;if(e!=null){if(e.ref!==void 0&&(d=e.ref,_=z4.current),e.key!==void 0&&(c=""+e.key),t.type&&t.type.defaultProps)var x=t.type.defaultProps;for(a in e)I8.call(e,a)&&!C8.hasOwnProperty(a)&&(s[a]=e[a]===void 0&&x!==void 0?x[a]:e[a])}var a=arguments.length-2;if(a===1)s.children=r;else if(1<a){x=Array(a);for(var I=0;I<a;I++)x[I]=arguments[I+2];s.children=x}return{$$typeof:Ux,type:t.type,key:c,ref:d,props:s,_owner:_}};Wr.createContext=function(t){return t={$$typeof:vJ,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:yJ,_context:t},t.Consumer=t};Wr.createElement=A8;Wr.createFactory=function(t){var e=A8.bind(null,t);return e.type=t,e};Wr.createRef=function(){return{current:null}};Wr.forwardRef=function(t){return{$$typeof:xJ,render:t}};Wr.isValidElement=N4;Wr.lazy=function(t){return{$$typeof:TJ,_payload:{_status:-1,_result:t},_init:CJ}};Wr.memo=function(t,e){return{$$typeof:wJ,type:t,compare:e===void 0?null:e}};Wr.startTransition=function(t){var e=sE.transition;sE.transition={};try{t()}finally{sE.transition=e}};Wr.unstable_act=P8;Wr.useCallback=function(t,e){return xa.current.useCallback(t,e)};Wr.useContext=function(t){return xa.current.useContext(t)};Wr.useDebugValue=function(){};Wr.useDeferredValue=function(t){return xa.current.useDeferredValue(t)};Wr.useEffect=function(t,e){return xa.current.useEffect(t,e)};Wr.useId=function(){return xa.current.useId()};Wr.useImperativeHandle=function(t,e,r){return xa.current.useImperativeHandle(t,e,r)};Wr.useInsertionEffect=function(t,e){return xa.current.useInsertionEffect(t,e)};Wr.useLayoutEffect=function(t,e){return xa.current.useLayoutEffect(t,e)};Wr.useMemo=function(t,e){return xa.current.useMemo(t,e)};Wr.useReducer=function(t,e,r){return xa.current.useReducer(t,e,r)};Wr.useRef=function(t){return xa.current.useRef(t)};Wr.useState=function(t){return xa.current.useState(t)};Wr.useSyncExternalStore=function(t,e,r){return xa.current.useSyncExternalStore(t,e,r)};Wr.useTransition=function(){return xa.current.useTransition()};Wr.version="18.3.1";b8.exports=Wr;var Y=b8.exports;const Gr=Gy(Y),jE=fJ({__proto__:null,default:Gr},[Y]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PJ=Y,RJ=Symbol.for("react.element"),MJ=Symbol.for("react.fragment"),kJ=Object.prototype.hasOwnProperty,OJ=PJ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,DJ={key:!0,ref:!0,__self:!0,__source:!0};function R8(t,e,r){var s,c={},d=null,_=null;r!==void 0&&(d=""+r),e.key!==void 0&&(d=""+e.key),e.ref!==void 0&&(_=e.ref);for(s in e)kJ.call(e,s)&&!DJ.hasOwnProperty(s)&&(c[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)c[s]===void 0&&(c[s]=e[s]);return{$$typeof:RJ,type:t,key:d,ref:_,props:c,_owner:OJ.current}}uI.Fragment=MJ;uI.jsx=R8;uI.jsxs=R8;x8.exports=uI;var F=x8.exports,M8={exports:{}},vl={},k8={exports:{}},O8={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(at,bt){var Zt=at.length;at.push(bt);e:for(;0<Zt;){var tt=Zt-1>>>1,Et=at[tt];if(0<c(Et,bt))at[tt]=bt,at[Zt]=Et,Zt=tt;else break e}}function r(at){return at.length===0?null:at[0]}function s(at){if(at.length===0)return null;var bt=at[0],Zt=at.pop();if(Zt!==bt){at[0]=Zt;e:for(var tt=0,Et=at.length,mt=Et>>>1;tt<mt;){var Vt=2*(tt+1)-1,Pt=at[Vt],pn=Vt+1,dn=at[pn];if(0>c(Pt,Zt))pn<Et&&0>c(dn,Pt)?(at[tt]=dn,at[pn]=Zt,tt=pn):(at[tt]=Pt,at[Vt]=Zt,tt=Vt);else if(pn<Et&&0>c(dn,Zt))at[tt]=dn,at[pn]=Zt,tt=pn;else break e}}return bt}function c(at,bt){var Zt=at.sortIndex-bt.sortIndex;return Zt!==0?Zt:at.id-bt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;t.unstable_now=function(){return d.now()}}else{var _=Date,x=_.now();t.unstable_now=function(){return _.now()-x}}var a=[],I=[],M=1,D=null,L=3,G=!1,Q=!1,re=!1,ee=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,H=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(at){for(var bt=r(I);bt!==null;){if(bt.callback===null)s(I);else if(bt.startTime<=at)s(I),bt.sortIndex=bt.expirationTime,e(a,bt);else break;bt=r(I)}}function de(at){if(re=!1,Z(at),!Q)if(r(a)!==null)Q=!0,Tt(ve);else{var bt=r(I);bt!==null&&gt(de,bt.startTime-at)}}function ve(at,bt){Q=!1,re&&(re=!1,U(ue),ue=-1),G=!0;var Zt=L;try{for(Z(bt),D=r(a);D!==null&&(!(D.expirationTime>bt)||at&&!_e());){var tt=D.callback;if(typeof tt=="function"){D.callback=null,L=D.priorityLevel;var Et=tt(D.expirationTime<=bt);bt=t.unstable_now(),typeof Et=="function"?D.callback=Et:D===r(a)&&s(a),Z(bt)}else s(a);D=r(a)}if(D!==null)var mt=!0;else{var Vt=r(I);Vt!==null&&gt(de,Vt.startTime-bt),mt=!1}return mt}finally{D=null,L=Zt,G=!1}}var Ee=!1,ie=null,ue=-1,K=5,ge=-1;function _e(){return!(t.unstable_now()-ge<K)}function Se(){if(ie!==null){var at=t.unstable_now();ge=at;var bt=!0;try{bt=ie(!0,at)}finally{bt?xe():(Ee=!1,ie=null)}}else Ee=!1}var xe;if(typeof H=="function")xe=function(){H(Se)};else if(typeof MessageChannel<"u"){var wt=new MessageChannel,ft=wt.port2;wt.port1.onmessage=Se,xe=function(){ft.postMessage(null)}}else xe=function(){ee(Se,0)};function Tt(at){ie=at,Ee||(Ee=!0,xe())}function gt(at,bt){ue=ee(function(){at(t.unstable_now())},bt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(at){at.callback=null},t.unstable_continueExecution=function(){Q||G||(Q=!0,Tt(ve))},t.unstable_forceFrameRate=function(at){0>at||125<at?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<at?Math.floor(1e3/at):5},t.unstable_getCurrentPriorityLevel=function(){return L},t.unstable_getFirstCallbackNode=function(){return r(a)},t.unstable_next=function(at){switch(L){case 1:case 2:case 3:var bt=3;break;default:bt=L}var Zt=L;L=bt;try{return at()}finally{L=Zt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(at,bt){switch(at){case 1:case 2:case 3:case 4:case 5:break;default:at=3}var Zt=L;L=at;try{return bt()}finally{L=Zt}},t.unstable_scheduleCallback=function(at,bt,Zt){var tt=t.unstable_now();switch(typeof Zt=="object"&&Zt!==null?(Zt=Zt.delay,Zt=typeof Zt=="number"&&0<Zt?tt+Zt:tt):Zt=tt,at){case 1:var Et=-1;break;case 2:Et=250;break;case 5:Et=1073741823;break;case 4:Et=1e4;break;default:Et=5e3}return Et=Zt+Et,at={id:M++,callback:bt,priorityLevel:at,startTime:Zt,expirationTime:Et,sortIndex:-1},Zt>tt?(at.sortIndex=Zt,e(I,at),r(a)===null&&at===r(I)&&(re?(U(ue),ue=-1):re=!0,gt(de,Zt-tt))):(at.sortIndex=Et,e(a,at),Q||G||(Q=!0,Tt(ve))),at},t.unstable_shouldYield=_e,t.unstable_wrapCallback=function(at){var bt=L;return function(){var Zt=L;L=bt;try{return at.apply(this,arguments)}finally{L=Zt}}}})(O8);k8.exports=O8;var LJ=k8.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zJ=Y,yl=LJ;function hn(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var D8=new Set,G1={};function Hm(t,e){gy(t,e),gy(t+"Capture",e)}function gy(t,e){for(G1[t]=e,t=0;t<e.length;t++)D8.add(e[t])}var Vh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),QR=Object.prototype.hasOwnProperty,NJ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,TB={},EB={};function FJ(t){return QR.call(EB,t)?!0:QR.call(TB,t)?!1:NJ.test(t)?EB[t]=!0:(TB[t]=!0,!1)}function BJ(t,e,r,s){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function jJ(t,e,r,s){if(e===null||typeof e>"u"||BJ(t,e,r,s))return!0;if(s)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ba(t,e,r,s,c,d,_){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=c,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=d,this.removeEmptyString=_}var ko={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ko[t]=new ba(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ko[e]=new ba(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ko[t]=new ba(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ko[t]=new ba(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ko[t]=new ba(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ko[t]=new ba(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ko[t]=new ba(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ko[t]=new ba(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ko[t]=new ba(t,5,!1,t.toLowerCase(),null,!1,!1)});var F4=/[\-:]([a-z])/g;function B4(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(F4,B4);ko[e]=new ba(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(F4,B4);ko[e]=new ba(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(F4,B4);ko[e]=new ba(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ko[t]=new ba(t,1,!1,t.toLowerCase(),null,!1,!1)});ko.xlinkHref=new ba("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ko[t]=new ba(t,1,!1,t.toLowerCase(),null,!0,!0)});function j4(t,e,r,s){var c=ko.hasOwnProperty(e)?ko[e]:null;(c!==null?c.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(jJ(e,r,c,s)&&(r=null),s||c===null?FJ(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):c.mustUseProperty?t[c.propertyName]=r===null?c.type===3?!1:"":r:(e=c.attributeName,s=c.attributeNamespace,r===null?t.removeAttribute(e):(c=c.type,r=c===3||c===4&&r===!0?"":""+r,s?t.setAttributeNS(s,e,r):t.setAttribute(e,r))))}var td=zJ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_T=Symbol.for("react.element"),O_=Symbol.for("react.portal"),D_=Symbol.for("react.fragment"),U4=Symbol.for("react.strict_mode"),YR=Symbol.for("react.profiler"),L8=Symbol.for("react.provider"),z8=Symbol.for("react.context"),V4=Symbol.for("react.forward_ref"),JR=Symbol.for("react.suspense"),eM=Symbol.for("react.suspense_list"),$4=Symbol.for("react.memo"),nf=Symbol.for("react.lazy"),N8=Symbol.for("react.offscreen"),SB=Symbol.iterator;function kv(t){return t===null||typeof t!="object"?null:(t=SB&&t[SB]||t["@@iterator"],typeof t=="function"?t:null)}var xs=Object.assign,A3;function Yv(t){if(A3===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);A3=e&&e[1]||""}return`
`+A3+t}var P3=!1;function R3(t,e){if(!t||P3)return"";P3=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(I){var s=I}Reflect.construct(t,[],e)}else{try{e.call()}catch(I){s=I}t.call(e.prototype)}else{try{throw Error()}catch(I){s=I}t()}}catch(I){if(I&&s&&typeof I.stack=="string"){for(var c=I.stack.split(`
`),d=s.stack.split(`
`),_=c.length-1,x=d.length-1;1<=_&&0<=x&&c[_]!==d[x];)x--;for(;1<=_&&0<=x;_--,x--)if(c[_]!==d[x]){if(_!==1||x!==1)do if(_--,x--,0>x||c[_]!==d[x]){var a=`
`+c[_].replace(" at new "," at ");return t.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",t.displayName)),a}while(1<=_&&0<=x);break}}}finally{P3=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?Yv(t):""}function UJ(t){switch(t.tag){case 5:return Yv(t.type);case 16:return Yv("Lazy");case 13:return Yv("Suspense");case 19:return Yv("SuspenseList");case 0:case 2:case 15:return t=R3(t.type,!1),t;case 11:return t=R3(t.type.render,!1),t;case 1:return t=R3(t.type,!0),t;default:return""}}function tM(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case D_:return"Fragment";case O_:return"Portal";case YR:return"Profiler";case U4:return"StrictMode";case JR:return"Suspense";case eM:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case z8:return(t.displayName||"Context")+".Consumer";case L8:return(t._context.displayName||"Context")+".Provider";case V4:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case $4:return e=t.displayName||null,e!==null?e:tM(t.type)||"Memo";case nf:e=t._payload,t=t._init;try{return tM(t(e))}catch{}}return null}function VJ(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return tM(e);case 8:return e===U4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function kf(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function F8(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function $J(t){var e=F8(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,d=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return c.call(this)},set:function(_){s=""+_,d.call(this,_)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return s},setValue:function(_){s=""+_},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function yT(t){t._valueTracker||(t._valueTracker=$J(t))}function B8(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),s="";return t&&(s=F8(t)?t.checked?"true":"false":t.value),t=s,t!==r?(e.setValue(t),!0):!1}function UE(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function nM(t,e){var r=e.checked;return xs({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function IB(t,e){var r=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;r=kf(e.value!=null?e.value:r),t._wrapperState={initialChecked:s,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function j8(t,e){e=e.checked,e!=null&&j4(t,"checked",e,!1)}function rM(t,e){j8(t,e);var r=kf(e.value),s=e.type;if(r!=null)s==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?iM(t,e.type,r):e.hasOwnProperty("defaultValue")&&iM(t,e.type,kf(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function CB(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function iM(t,e,r){(e!=="number"||UE(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var Jv=Array.isArray;function Y_(t,e,r,s){if(t=t.options,e){e={};for(var c=0;c<r.length;c++)e["$"+r[c]]=!0;for(r=0;r<t.length;r++)c=e.hasOwnProperty("$"+t[r].value),t[r].selected!==c&&(t[r].selected=c),c&&s&&(t[r].defaultSelected=!0)}else{for(r=""+kf(r),e=null,c=0;c<t.length;c++){if(t[c].value===r){t[c].selected=!0,s&&(t[c].defaultSelected=!0);return}e!==null||t[c].disabled||(e=t[c])}e!==null&&(e.selected=!0)}}function sM(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(hn(91));return xs({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function AB(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(hn(92));if(Jv(r)){if(1<r.length)throw Error(hn(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:kf(r)}}function U8(t,e){var r=kf(e.value),s=kf(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),s!=null&&(t.defaultValue=""+s)}function PB(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function V8(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function oM(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?V8(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var vT,$8=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,s,c){MSApp.execUnsafeLocalFunction(function(){return t(e,r,s,c)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(vT=vT||document.createElement("div"),vT.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=vT.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function W1(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var g1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qJ=["Webkit","ms","Moz","O"];Object.keys(g1).forEach(function(t){qJ.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),g1[e]=g1[t]})});function q8(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||g1.hasOwnProperty(t)&&g1[t]?(""+e).trim():e+"px"}function G8(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var s=r.indexOf("--")===0,c=q8(r,e[r],s);r==="float"&&(r="cssFloat"),s?t.setProperty(r,c):t[r]=c}}var GJ=xs({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function aM(t,e){if(e){if(GJ[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(hn(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(hn(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(hn(61))}if(e.style!=null&&typeof e.style!="object")throw Error(hn(62))}}function lM(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cM=null;function q4(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var uM=null,J_=null,ey=null;function RB(t){if(t=qx(t)){if(typeof uM!="function")throw Error(hn(280));var e=t.stateNode;e&&(e=mI(e),uM(t.stateNode,t.type,e))}}function W8(t){J_?ey?ey.push(t):ey=[t]:J_=t}function H8(){if(J_){var t=J_,e=ey;if(ey=J_=null,RB(t),e)for(t=0;t<e.length;t++)RB(e[t])}}function Z8(t,e){return t(e)}function X8(){}var M3=!1;function K8(t,e,r){if(M3)return t(e,r);M3=!0;try{return Z8(t,e,r)}finally{M3=!1,(J_!==null||ey!==null)&&(X8(),H8())}}function H1(t,e){var r=t.stateNode;if(r===null)return null;var s=mI(r);if(s===null)return null;r=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(hn(231,e,typeof r));return r}var hM=!1;if(Vh)try{var Ov={};Object.defineProperty(Ov,"passive",{get:function(){hM=!0}}),window.addEventListener("test",Ov,Ov),window.removeEventListener("test",Ov,Ov)}catch{hM=!1}function WJ(t,e,r,s,c,d,_,x,a){var I=Array.prototype.slice.call(arguments,3);try{e.apply(r,I)}catch(M){this.onError(M)}}var _1=!1,VE=null,$E=!1,dM=null,HJ={onError:function(t){_1=!0,VE=t}};function ZJ(t,e,r,s,c,d,_,x,a){_1=!1,VE=null,WJ.apply(HJ,arguments)}function XJ(t,e,r,s,c,d,_,x,a){if(ZJ.apply(this,arguments),_1){if(_1){var I=VE;_1=!1,VE=null}else throw Error(hn(198));$E||($E=!0,dM=I)}}function Zm(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function Q8(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function MB(t){if(Zm(t)!==t)throw Error(hn(188))}function KJ(t){var e=t.alternate;if(!e){if(e=Zm(t),e===null)throw Error(hn(188));return e!==t?null:t}for(var r=t,s=e;;){var c=r.return;if(c===null)break;var d=c.alternate;if(d===null){if(s=c.return,s!==null){r=s;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===r)return MB(c),t;if(d===s)return MB(c),e;d=d.sibling}throw Error(hn(188))}if(r.return!==s.return)r=c,s=d;else{for(var _=!1,x=c.child;x;){if(x===r){_=!0,r=c,s=d;break}if(x===s){_=!0,s=c,r=d;break}x=x.sibling}if(!_){for(x=d.child;x;){if(x===r){_=!0,r=d,s=c;break}if(x===s){_=!0,s=d,r=c;break}x=x.sibling}if(!_)throw Error(hn(189))}}if(r.alternate!==s)throw Error(hn(190))}if(r.tag!==3)throw Error(hn(188));return r.stateNode.current===r?t:e}function Y8(t){return t=KJ(t),t!==null?J8(t):null}function J8(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=J8(t);if(e!==null)return e;t=t.sibling}return null}var e9=yl.unstable_scheduleCallback,kB=yl.unstable_cancelCallback,QJ=yl.unstable_shouldYield,YJ=yl.unstable_requestPaint,Us=yl.unstable_now,JJ=yl.unstable_getCurrentPriorityLevel,G4=yl.unstable_ImmediatePriority,t9=yl.unstable_UserBlockingPriority,qE=yl.unstable_NormalPriority,eee=yl.unstable_LowPriority,n9=yl.unstable_IdlePriority,hI=null,Du=null;function tee(t){if(Du&&typeof Du.onCommitFiberRoot=="function")try{Du.onCommitFiberRoot(hI,t,void 0,(t.current.flags&128)===128)}catch{}}var Fc=Math.clz32?Math.clz32:iee,nee=Math.log,ree=Math.LN2;function iee(t){return t>>>=0,t===0?32:31-(nee(t)/ree|0)|0}var xT=64,bT=4194304;function e1(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function GE(t,e){var r=t.pendingLanes;if(r===0)return 0;var s=0,c=t.suspendedLanes,d=t.pingedLanes,_=r&268435455;if(_!==0){var x=_&~c;x!==0?s=e1(x):(d&=_,d!==0&&(s=e1(d)))}else _=r&~c,_!==0?s=e1(_):d!==0&&(s=e1(d));if(s===0)return 0;if(e!==0&&e!==s&&!(e&c)&&(c=s&-s,d=e&-e,c>=d||c===16&&(d&4194240)!==0))return e;if(s&4&&(s|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)r=31-Fc(e),c=1<<r,s|=t[r],e&=~c;return s}function see(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oee(t,e){for(var r=t.suspendedLanes,s=t.pingedLanes,c=t.expirationTimes,d=t.pendingLanes;0<d;){var _=31-Fc(d),x=1<<_,a=c[_];a===-1?(!(x&r)||x&s)&&(c[_]=see(x,e)):a<=e&&(t.expiredLanes|=x),d&=~x}}function fM(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function r9(){var t=xT;return xT<<=1,!(xT&4194240)&&(xT=64),t}function k3(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function Vx(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fc(e),t[e]=r}function aee(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<r;){var c=31-Fc(r),d=1<<c;e[c]=0,s[c]=-1,t[c]=-1,r&=~d}}function W4(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var s=31-Fc(r),c=1<<s;c&e|t[s]&e&&(t[s]|=e),r&=~c}}var Ti=0;function i9(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var s9,H4,o9,a9,l9,pM=!1,wT=[],yf=null,vf=null,xf=null,Z1=new Map,X1=new Map,sf=[],lee="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function OB(t,e){switch(t){case"focusin":case"focusout":yf=null;break;case"dragenter":case"dragleave":vf=null;break;case"mouseover":case"mouseout":xf=null;break;case"pointerover":case"pointerout":Z1.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":X1.delete(e.pointerId)}}function Dv(t,e,r,s,c,d){return t===null||t.nativeEvent!==d?(t={blockedOn:e,domEventName:r,eventSystemFlags:s,nativeEvent:d,targetContainers:[c]},e!==null&&(e=qx(e),e!==null&&H4(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,c!==null&&e.indexOf(c)===-1&&e.push(c),t)}function cee(t,e,r,s,c){switch(e){case"focusin":return yf=Dv(yf,t,e,r,s,c),!0;case"dragenter":return vf=Dv(vf,t,e,r,s,c),!0;case"mouseover":return xf=Dv(xf,t,e,r,s,c),!0;case"pointerover":var d=c.pointerId;return Z1.set(d,Dv(Z1.get(d)||null,t,e,r,s,c)),!0;case"gotpointercapture":return d=c.pointerId,X1.set(d,Dv(X1.get(d)||null,t,e,r,s,c)),!0}return!1}function c9(t){var e=lm(t.target);if(e!==null){var r=Zm(e);if(r!==null){if(e=r.tag,e===13){if(e=Q8(r),e!==null){t.blockedOn=e,l9(t.priority,function(){o9(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function oE(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=mM(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var s=new r.constructor(r.type,r);cM=s,r.target.dispatchEvent(s),cM=null}else return e=qx(r),e!==null&&H4(e),t.blockedOn=r,!1;e.shift()}return!0}function DB(t,e,r){oE(t)&&r.delete(e)}function uee(){pM=!1,yf!==null&&oE(yf)&&(yf=null),vf!==null&&oE(vf)&&(vf=null),xf!==null&&oE(xf)&&(xf=null),Z1.forEach(DB),X1.forEach(DB)}function Lv(t,e){t.blockedOn===e&&(t.blockedOn=null,pM||(pM=!0,yl.unstable_scheduleCallback(yl.unstable_NormalPriority,uee)))}function K1(t){function e(c){return Lv(c,t)}if(0<wT.length){Lv(wT[0],t);for(var r=1;r<wT.length;r++){var s=wT[r];s.blockedOn===t&&(s.blockedOn=null)}}for(yf!==null&&Lv(yf,t),vf!==null&&Lv(vf,t),xf!==null&&Lv(xf,t),Z1.forEach(e),X1.forEach(e),r=0;r<sf.length;r++)s=sf[r],s.blockedOn===t&&(s.blockedOn=null);for(;0<sf.length&&(r=sf[0],r.blockedOn===null);)c9(r),r.blockedOn===null&&sf.shift()}var ty=td.ReactCurrentBatchConfig,WE=!0;function hee(t,e,r,s){var c=Ti,d=ty.transition;ty.transition=null;try{Ti=1,Z4(t,e,r,s)}finally{Ti=c,ty.transition=d}}function dee(t,e,r,s){var c=Ti,d=ty.transition;ty.transition=null;try{Ti=4,Z4(t,e,r,s)}finally{Ti=c,ty.transition=d}}function Z4(t,e,r,s){if(WE){var c=mM(t,e,r,s);if(c===null)V3(t,e,s,HE,r),OB(t,s);else if(cee(c,t,e,r,s))s.stopPropagation();else if(OB(t,s),e&4&&-1<lee.indexOf(t)){for(;c!==null;){var d=qx(c);if(d!==null&&s9(d),d=mM(t,e,r,s),d===null&&V3(t,e,s,HE,r),d===c)break;c=d}c!==null&&s.stopPropagation()}else V3(t,e,s,null,r)}}var HE=null;function mM(t,e,r,s){if(HE=null,t=q4(s),t=lm(t),t!==null)if(e=Zm(t),e===null)t=null;else if(r=e.tag,r===13){if(t=Q8(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return HE=t,null}function u9(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(JJ()){case G4:return 1;case t9:return 4;case qE:case eee:return 16;case n9:return 536870912;default:return 16}default:return 16}}var hf=null,X4=null,aE=null;function h9(){if(aE)return aE;var t,e=X4,r=e.length,s,c="value"in hf?hf.value:hf.textContent,d=c.length;for(t=0;t<r&&e[t]===c[t];t++);var _=r-t;for(s=1;s<=_&&e[r-s]===c[d-s];s++);return aE=c.slice(t,1<s?1-s:void 0)}function lE(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function TT(){return!0}function LB(){return!1}function xl(t){function e(r,s,c,d,_){this._reactName=r,this._targetInst=c,this.type=s,this.nativeEvent=d,this.target=_,this.currentTarget=null;for(var x in t)t.hasOwnProperty(x)&&(r=t[x],this[x]=r?r(d):d[x]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?TT:LB,this.isPropagationStopped=LB,this}return xs(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=TT)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=TT)},persist:function(){},isPersistent:TT}),e}var Hy={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},K4=xl(Hy),$x=xs({},Hy,{view:0,detail:0}),fee=xl($x),O3,D3,zv,dI=xs({},$x,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Q4,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==zv&&(zv&&t.type==="mousemove"?(O3=t.screenX-zv.screenX,D3=t.screenY-zv.screenY):D3=O3=0,zv=t),O3)},movementY:function(t){return"movementY"in t?t.movementY:D3}}),zB=xl(dI),pee=xs({},dI,{dataTransfer:0}),mee=xl(pee),gee=xs({},$x,{relatedTarget:0}),L3=xl(gee),_ee=xs({},Hy,{animationName:0,elapsedTime:0,pseudoElement:0}),yee=xl(_ee),vee=xs({},Hy,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),xee=xl(vee),bee=xs({},Hy,{data:0}),NB=xl(bee),wee={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tee={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Eee={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function See(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Eee[t])?!!e[t]:!1}function Q4(){return See}var Iee=xs({},$x,{key:function(t){if(t.key){var e=wee[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=lE(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Tee[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Q4,charCode:function(t){return t.type==="keypress"?lE(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?lE(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Cee=xl(Iee),Aee=xs({},dI,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),FB=xl(Aee),Pee=xs({},$x,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Q4}),Ree=xl(Pee),Mee=xs({},Hy,{propertyName:0,elapsedTime:0,pseudoElement:0}),kee=xl(Mee),Oee=xs({},dI,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Dee=xl(Oee),Lee=[9,13,27,32],Y4=Vh&&"CompositionEvent"in window,y1=null;Vh&&"documentMode"in document&&(y1=document.documentMode);var zee=Vh&&"TextEvent"in window&&!y1,d9=Vh&&(!Y4||y1&&8<y1&&11>=y1),BB=" ",jB=!1;function f9(t,e){switch(t){case"keyup":return Lee.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function p9(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var L_=!1;function Nee(t,e){switch(t){case"compositionend":return p9(e);case"keypress":return e.which!==32?null:(jB=!0,BB);case"textInput":return t=e.data,t===BB&&jB?null:t;default:return null}}function Fee(t,e){if(L_)return t==="compositionend"||!Y4&&f9(t,e)?(t=h9(),aE=X4=hf=null,L_=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return d9&&e.locale!=="ko"?null:e.data;default:return null}}var Bee={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function UB(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Bee[t.type]:e==="textarea"}function m9(t,e,r,s){W8(s),e=ZE(e,"onChange"),0<e.length&&(r=new K4("onChange","change",null,r,s),t.push({event:r,listeners:e}))}var v1=null,Q1=null;function jee(t){I9(t,0)}function fI(t){var e=F_(t);if(B8(e))return t}function Uee(t,e){if(t==="change")return e}var g9=!1;if(Vh){var z3;if(Vh){var N3="oninput"in document;if(!N3){var VB=document.createElement("div");VB.setAttribute("oninput","return;"),N3=typeof VB.oninput=="function"}z3=N3}else z3=!1;g9=z3&&(!document.documentMode||9<document.documentMode)}function $B(){v1&&(v1.detachEvent("onpropertychange",_9),Q1=v1=null)}function _9(t){if(t.propertyName==="value"&&fI(Q1)){var e=[];m9(e,Q1,t,q4(t)),K8(jee,e)}}function Vee(t,e,r){t==="focusin"?($B(),v1=e,Q1=r,v1.attachEvent("onpropertychange",_9)):t==="focusout"&&$B()}function $ee(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return fI(Q1)}function qee(t,e){if(t==="click")return fI(e)}function Gee(t,e){if(t==="input"||t==="change")return fI(e)}function Wee(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Vc=typeof Object.is=="function"?Object.is:Wee;function Y1(t,e){if(Vc(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),s=Object.keys(e);if(r.length!==s.length)return!1;for(s=0;s<r.length;s++){var c=r[s];if(!QR.call(e,c)||!Vc(t[c],e[c]))return!1}return!0}function qB(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function GB(t,e){var r=qB(t);t=0;for(var s;r;){if(r.nodeType===3){if(s=t+r.textContent.length,t<=e&&s>=e)return{node:r,offset:e-t};t=s}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=qB(r)}}function y9(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?y9(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function v9(){for(var t=window,e=UE();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=UE(t.document)}return e}function J4(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Hee(t){var e=v9(),r=t.focusedElem,s=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&y9(r.ownerDocument.documentElement,r)){if(s!==null&&J4(r)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var c=r.textContent.length,d=Math.min(s.start,c);s=s.end===void 0?d:Math.min(s.end,c),!t.extend&&d>s&&(c=s,s=d,d=c),c=GB(r,d);var _=GB(r,s);c&&_&&(t.rangeCount!==1||t.anchorNode!==c.node||t.anchorOffset!==c.offset||t.focusNode!==_.node||t.focusOffset!==_.offset)&&(e=e.createRange(),e.setStart(c.node,c.offset),t.removeAllRanges(),d>s?(t.addRange(e),t.extend(_.node,_.offset)):(e.setEnd(_.node,_.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Zee=Vh&&"documentMode"in document&&11>=document.documentMode,z_=null,gM=null,x1=null,_M=!1;function WB(t,e,r){var s=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;_M||z_==null||z_!==UE(s)||(s=z_,"selectionStart"in s&&J4(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),x1&&Y1(x1,s)||(x1=s,s=ZE(gM,"onSelect"),0<s.length&&(e=new K4("onSelect","select",null,e,r),t.push({event:e,listeners:s}),e.target=z_)))}function ET(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var N_={animationend:ET("Animation","AnimationEnd"),animationiteration:ET("Animation","AnimationIteration"),animationstart:ET("Animation","AnimationStart"),transitionend:ET("Transition","TransitionEnd")},F3={},x9={};Vh&&(x9=document.createElement("div").style,"AnimationEvent"in window||(delete N_.animationend.animation,delete N_.animationiteration.animation,delete N_.animationstart.animation),"TransitionEvent"in window||delete N_.transitionend.transition);function pI(t){if(F3[t])return F3[t];if(!N_[t])return t;var e=N_[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in x9)return F3[t]=e[r];return t}var b9=pI("animationend"),w9=pI("animationiteration"),T9=pI("animationstart"),E9=pI("transitionend"),S9=new Map,HB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $f(t,e){S9.set(t,e),Hm(e,[t])}for(var B3=0;B3<HB.length;B3++){var j3=HB[B3],Xee=j3.toLowerCase(),Kee=j3[0].toUpperCase()+j3.slice(1);$f(Xee,"on"+Kee)}$f(b9,"onAnimationEnd");$f(w9,"onAnimationIteration");$f(T9,"onAnimationStart");$f("dblclick","onDoubleClick");$f("focusin","onFocus");$f("focusout","onBlur");$f(E9,"onTransitionEnd");gy("onMouseEnter",["mouseout","mouseover"]);gy("onMouseLeave",["mouseout","mouseover"]);gy("onPointerEnter",["pointerout","pointerover"]);gy("onPointerLeave",["pointerout","pointerover"]);Hm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Hm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Hm("onBeforeInput",["compositionend","keypress","textInput","paste"]);Hm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Hm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Hm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var t1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qee=new Set("cancel close invalid load scroll toggle".split(" ").concat(t1));function ZB(t,e,r){var s=t.type||"unknown-event";t.currentTarget=r,XJ(s,e,void 0,t),t.currentTarget=null}function I9(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var s=t[r],c=s.event;s=s.listeners;e:{var d=void 0;if(e)for(var _=s.length-1;0<=_;_--){var x=s[_],a=x.instance,I=x.currentTarget;if(x=x.listener,a!==d&&c.isPropagationStopped())break e;ZB(c,x,I),d=a}else for(_=0;_<s.length;_++){if(x=s[_],a=x.instance,I=x.currentTarget,x=x.listener,a!==d&&c.isPropagationStopped())break e;ZB(c,x,I),d=a}}}if($E)throw t=dM,$E=!1,dM=null,t}function Zi(t,e){var r=e[wM];r===void 0&&(r=e[wM]=new Set);var s=t+"__bubble";r.has(s)||(C9(e,t,2,!1),r.add(s))}function U3(t,e,r){var s=0;e&&(s|=4),C9(r,t,s,e)}var ST="_reactListening"+Math.random().toString(36).slice(2);function J1(t){if(!t[ST]){t[ST]=!0,D8.forEach(function(r){r!=="selectionchange"&&(Qee.has(r)||U3(r,!1,t),U3(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ST]||(e[ST]=!0,U3("selectionchange",!1,e))}}function C9(t,e,r,s){switch(u9(e)){case 1:var c=hee;break;case 4:c=dee;break;default:c=Z4}r=c.bind(null,e,r,t),c=void 0,!hM||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(c=!0),s?c!==void 0?t.addEventListener(e,r,{capture:!0,passive:c}):t.addEventListener(e,r,!0):c!==void 0?t.addEventListener(e,r,{passive:c}):t.addEventListener(e,r,!1)}function V3(t,e,r,s,c){var d=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var _=s.tag;if(_===3||_===4){var x=s.stateNode.containerInfo;if(x===c||x.nodeType===8&&x.parentNode===c)break;if(_===4)for(_=s.return;_!==null;){var a=_.tag;if((a===3||a===4)&&(a=_.stateNode.containerInfo,a===c||a.nodeType===8&&a.parentNode===c))return;_=_.return}for(;x!==null;){if(_=lm(x),_===null)return;if(a=_.tag,a===5||a===6){s=d=_;continue e}x=x.parentNode}}s=s.return}K8(function(){var I=d,M=q4(r),D=[];e:{var L=S9.get(t);if(L!==void 0){var G=K4,Q=t;switch(t){case"keypress":if(lE(r)===0)break e;case"keydown":case"keyup":G=Cee;break;case"focusin":Q="focus",G=L3;break;case"focusout":Q="blur",G=L3;break;case"beforeblur":case"afterblur":G=L3;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":G=zB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":G=mee;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":G=Ree;break;case b9:case w9:case T9:G=yee;break;case E9:G=kee;break;case"scroll":G=fee;break;case"wheel":G=Dee;break;case"copy":case"cut":case"paste":G=xee;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":G=FB}var re=(e&4)!==0,ee=!re&&t==="scroll",U=re?L!==null?L+"Capture":null:L;re=[];for(var H=I,Z;H!==null;){Z=H;var de=Z.stateNode;if(Z.tag===5&&de!==null&&(Z=de,U!==null&&(de=H1(H,U),de!=null&&re.push(ex(H,de,Z)))),ee)break;H=H.return}0<re.length&&(L=new G(L,Q,null,r,M),D.push({event:L,listeners:re}))}}if(!(e&7)){e:{if(L=t==="mouseover"||t==="pointerover",G=t==="mouseout"||t==="pointerout",L&&r!==cM&&(Q=r.relatedTarget||r.fromElement)&&(lm(Q)||Q[$h]))break e;if((G||L)&&(L=M.window===M?M:(L=M.ownerDocument)?L.defaultView||L.parentWindow:window,G?(Q=r.relatedTarget||r.toElement,G=I,Q=Q?lm(Q):null,Q!==null&&(ee=Zm(Q),Q!==ee||Q.tag!==5&&Q.tag!==6)&&(Q=null)):(G=null,Q=I),G!==Q)){if(re=zB,de="onMouseLeave",U="onMouseEnter",H="mouse",(t==="pointerout"||t==="pointerover")&&(re=FB,de="onPointerLeave",U="onPointerEnter",H="pointer"),ee=G==null?L:F_(G),Z=Q==null?L:F_(Q),L=new re(de,H+"leave",G,r,M),L.target=ee,L.relatedTarget=Z,de=null,lm(M)===I&&(re=new re(U,H+"enter",Q,r,M),re.target=Z,re.relatedTarget=ee,de=re),ee=de,G&&Q)t:{for(re=G,U=Q,H=0,Z=re;Z;Z=g_(Z))H++;for(Z=0,de=U;de;de=g_(de))Z++;for(;0<H-Z;)re=g_(re),H--;for(;0<Z-H;)U=g_(U),Z--;for(;H--;){if(re===U||U!==null&&re===U.alternate)break t;re=g_(re),U=g_(U)}re=null}else re=null;G!==null&&XB(D,L,G,re,!1),Q!==null&&ee!==null&&XB(D,ee,Q,re,!0)}}e:{if(L=I?F_(I):window,G=L.nodeName&&L.nodeName.toLowerCase(),G==="select"||G==="input"&&L.type==="file")var ve=Uee;else if(UB(L))if(g9)ve=Gee;else{ve=$ee;var Ee=Vee}else(G=L.nodeName)&&G.toLowerCase()==="input"&&(L.type==="checkbox"||L.type==="radio")&&(ve=qee);if(ve&&(ve=ve(t,I))){m9(D,ve,r,M);break e}Ee&&Ee(t,L,I),t==="focusout"&&(Ee=L._wrapperState)&&Ee.controlled&&L.type==="number"&&iM(L,"number",L.value)}switch(Ee=I?F_(I):window,t){case"focusin":(UB(Ee)||Ee.contentEditable==="true")&&(z_=Ee,gM=I,x1=null);break;case"focusout":x1=gM=z_=null;break;case"mousedown":_M=!0;break;case"contextmenu":case"mouseup":case"dragend":_M=!1,WB(D,r,M);break;case"selectionchange":if(Zee)break;case"keydown":case"keyup":WB(D,r,M)}var ie;if(Y4)e:{switch(t){case"compositionstart":var ue="onCompositionStart";break e;case"compositionend":ue="onCompositionEnd";break e;case"compositionupdate":ue="onCompositionUpdate";break e}ue=void 0}else L_?f9(t,r)&&(ue="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(ue="onCompositionStart");ue&&(d9&&r.locale!=="ko"&&(L_||ue!=="onCompositionStart"?ue==="onCompositionEnd"&&L_&&(ie=h9()):(hf=M,X4="value"in hf?hf.value:hf.textContent,L_=!0)),Ee=ZE(I,ue),0<Ee.length&&(ue=new NB(ue,t,null,r,M),D.push({event:ue,listeners:Ee}),ie?ue.data=ie:(ie=p9(r),ie!==null&&(ue.data=ie)))),(ie=zee?Nee(t,r):Fee(t,r))&&(I=ZE(I,"onBeforeInput"),0<I.length&&(M=new NB("onBeforeInput","beforeinput",null,r,M),D.push({event:M,listeners:I}),M.data=ie))}I9(D,e)})}function ex(t,e,r){return{instance:t,listener:e,currentTarget:r}}function ZE(t,e){for(var r=e+"Capture",s=[];t!==null;){var c=t,d=c.stateNode;c.tag===5&&d!==null&&(c=d,d=H1(t,r),d!=null&&s.unshift(ex(t,d,c)),d=H1(t,e),d!=null&&s.push(ex(t,d,c))),t=t.return}return s}function g_(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function XB(t,e,r,s,c){for(var d=e._reactName,_=[];r!==null&&r!==s;){var x=r,a=x.alternate,I=x.stateNode;if(a!==null&&a===s)break;x.tag===5&&I!==null&&(x=I,c?(a=H1(r,d),a!=null&&_.unshift(ex(r,a,x))):c||(a=H1(r,d),a!=null&&_.push(ex(r,a,x)))),r=r.return}_.length!==0&&t.push({event:e,listeners:_})}var Yee=/\r\n?/g,Jee=/\u0000|\uFFFD/g;function KB(t){return(typeof t=="string"?t:""+t).replace(Yee,`
`).replace(Jee,"")}function IT(t,e,r){if(e=KB(e),KB(t)!==e&&r)throw Error(hn(425))}function XE(){}var yM=null,vM=null;function xM(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var bM=typeof setTimeout=="function"?setTimeout:void 0,ete=typeof clearTimeout=="function"?clearTimeout:void 0,QB=typeof Promise=="function"?Promise:void 0,tte=typeof queueMicrotask=="function"?queueMicrotask:typeof QB<"u"?function(t){return QB.resolve(null).then(t).catch(nte)}:bM;function nte(t){setTimeout(function(){throw t})}function $3(t,e){var r=e,s=0;do{var c=r.nextSibling;if(t.removeChild(r),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(s===0){t.removeChild(c),K1(e);return}s--}else r!=="$"&&r!=="$?"&&r!=="$!"||s++;r=c}while(r);K1(e)}function bf(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function YB(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var Zy=Math.random().toString(36).slice(2),Pu="__reactFiber$"+Zy,tx="__reactProps$"+Zy,$h="__reactContainer$"+Zy,wM="__reactEvents$"+Zy,rte="__reactListeners$"+Zy,ite="__reactHandles$"+Zy;function lm(t){var e=t[Pu];if(e)return e;for(var r=t.parentNode;r;){if(e=r[$h]||r[Pu]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=YB(t);t!==null;){if(r=t[Pu])return r;t=YB(t)}return e}t=r,r=t.parentNode}return null}function qx(t){return t=t[Pu]||t[$h],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function F_(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(hn(33))}function mI(t){return t[tx]||null}var TM=[],B_=-1;function qf(t){return{current:t}}function Ji(t){0>B_||(t.current=TM[B_],TM[B_]=null,B_--)}function qi(t,e){B_++,TM[B_]=t.current,t.current=e}var Of={},Yo=qf(Of),ja=qf(!1),Am=Of;function _y(t,e){var r=t.type.contextTypes;if(!r)return Of;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var c={},d;for(d in r)c[d]=e[d];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=c),c}function Ua(t){return t=t.childContextTypes,t!=null}function KE(){Ji(ja),Ji(Yo)}function JB(t,e,r){if(Yo.current!==Of)throw Error(hn(168));qi(Yo,e),qi(ja,r)}function A9(t,e,r){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return r;s=s.getChildContext();for(var c in s)if(!(c in e))throw Error(hn(108,VJ(t)||"Unknown",c));return xs({},r,s)}function QE(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Of,Am=Yo.current,qi(Yo,t),qi(ja,ja.current),!0}function e6(t,e,r){var s=t.stateNode;if(!s)throw Error(hn(169));r?(t=A9(t,e,Am),s.__reactInternalMemoizedMergedChildContext=t,Ji(ja),Ji(Yo),qi(Yo,t)):Ji(ja),qi(ja,r)}var Ph=null,gI=!1,q3=!1;function P9(t){Ph===null?Ph=[t]:Ph.push(t)}function ste(t){gI=!0,P9(t)}function Gf(){if(!q3&&Ph!==null){q3=!0;var t=0,e=Ti;try{var r=Ph;for(Ti=1;t<r.length;t++){var s=r[t];do s=s(!0);while(s!==null)}Ph=null,gI=!1}catch(c){throw Ph!==null&&(Ph=Ph.slice(t+1)),e9(G4,Gf),c}finally{Ti=e,q3=!1}}return null}var j_=[],U_=0,YE=null,JE=0,Bl=[],jl=0,Pm=null,kh=1,Oh="";function Yp(t,e){j_[U_++]=JE,j_[U_++]=YE,YE=t,JE=e}function R9(t,e,r){Bl[jl++]=kh,Bl[jl++]=Oh,Bl[jl++]=Pm,Pm=t;var s=kh;t=Oh;var c=32-Fc(s)-1;s&=~(1<<c),r+=1;var d=32-Fc(e)+c;if(30<d){var _=c-c%5;d=(s&(1<<_)-1).toString(32),s>>=_,c-=_,kh=1<<32-Fc(e)+c|r<<c|s,Oh=d+t}else kh=1<<d|r<<c|s,Oh=t}function eO(t){t.return!==null&&(Yp(t,1),R9(t,1,0))}function tO(t){for(;t===YE;)YE=j_[--U_],j_[U_]=null,JE=j_[--U_],j_[U_]=null;for(;t===Pm;)Pm=Bl[--jl],Bl[jl]=null,Oh=Bl[--jl],Bl[jl]=null,kh=Bl[--jl],Bl[jl]=null}var fl=null,al=null,hs=!1,kc=null;function M9(t,e){var r=Wl(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function t6(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,fl=t,al=bf(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,fl=t,al=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Pm!==null?{id:kh,overflow:Oh}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=Wl(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,fl=t,al=null,!0):!1;default:return!1}}function EM(t){return(t.mode&1)!==0&&(t.flags&128)===0}function SM(t){if(hs){var e=al;if(e){var r=e;if(!t6(t,e)){if(EM(t))throw Error(hn(418));e=bf(r.nextSibling);var s=fl;e&&t6(t,e)?M9(s,r):(t.flags=t.flags&-4097|2,hs=!1,fl=t)}}else{if(EM(t))throw Error(hn(418));t.flags=t.flags&-4097|2,hs=!1,fl=t}}}function n6(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;fl=t}function CT(t){if(t!==fl)return!1;if(!hs)return n6(t),hs=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!xM(t.type,t.memoizedProps)),e&&(e=al)){if(EM(t))throw k9(),Error(hn(418));for(;e;)M9(t,e),e=bf(e.nextSibling)}if(n6(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(hn(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){al=bf(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}al=null}}else al=fl?bf(t.stateNode.nextSibling):null;return!0}function k9(){for(var t=al;t;)t=bf(t.nextSibling)}function yy(){al=fl=null,hs=!1}function nO(t){kc===null?kc=[t]:kc.push(t)}var ote=td.ReactCurrentBatchConfig;function Nv(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(hn(309));var s=r.stateNode}if(!s)throw Error(hn(147,t));var c=s,d=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===d?e.ref:(e=function(_){var x=c.refs;_===null?delete x[d]:x[d]=_},e._stringRef=d,e)}if(typeof t!="string")throw Error(hn(284));if(!r._owner)throw Error(hn(290,t))}return t}function AT(t,e){throw t=Object.prototype.toString.call(e),Error(hn(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function r6(t){var e=t._init;return e(t._payload)}function O9(t){function e(U,H){if(t){var Z=U.deletions;Z===null?(U.deletions=[H],U.flags|=16):Z.push(H)}}function r(U,H){if(!t)return null;for(;H!==null;)e(U,H),H=H.sibling;return null}function s(U,H){for(U=new Map;H!==null;)H.key!==null?U.set(H.key,H):U.set(H.index,H),H=H.sibling;return U}function c(U,H){return U=Sf(U,H),U.index=0,U.sibling=null,U}function d(U,H,Z){return U.index=Z,t?(Z=U.alternate,Z!==null?(Z=Z.index,Z<H?(U.flags|=2,H):Z):(U.flags|=2,H)):(U.flags|=1048576,H)}function _(U){return t&&U.alternate===null&&(U.flags|=2),U}function x(U,H,Z,de){return H===null||H.tag!==6?(H=Q3(Z,U.mode,de),H.return=U,H):(H=c(H,Z),H.return=U,H)}function a(U,H,Z,de){var ve=Z.type;return ve===D_?M(U,H,Z.props.children,de,Z.key):H!==null&&(H.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===nf&&r6(ve)===H.type)?(de=c(H,Z.props),de.ref=Nv(U,H,Z),de.return=U,de):(de=mE(Z.type,Z.key,Z.props,null,U.mode,de),de.ref=Nv(U,H,Z),de.return=U,de)}function I(U,H,Z,de){return H===null||H.tag!==4||H.stateNode.containerInfo!==Z.containerInfo||H.stateNode.implementation!==Z.implementation?(H=Y3(Z,U.mode,de),H.return=U,H):(H=c(H,Z.children||[]),H.return=U,H)}function M(U,H,Z,de,ve){return H===null||H.tag!==7?(H=ym(Z,U.mode,de,ve),H.return=U,H):(H=c(H,Z),H.return=U,H)}function D(U,H,Z){if(typeof H=="string"&&H!==""||typeof H=="number")return H=Q3(""+H,U.mode,Z),H.return=U,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case _T:return Z=mE(H.type,H.key,H.props,null,U.mode,Z),Z.ref=Nv(U,null,H),Z.return=U,Z;case O_:return H=Y3(H,U.mode,Z),H.return=U,H;case nf:var de=H._init;return D(U,de(H._payload),Z)}if(Jv(H)||kv(H))return H=ym(H,U.mode,Z,null),H.return=U,H;AT(U,H)}return null}function L(U,H,Z,de){var ve=H!==null?H.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return ve!==null?null:x(U,H,""+Z,de);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case _T:return Z.key===ve?a(U,H,Z,de):null;case O_:return Z.key===ve?I(U,H,Z,de):null;case nf:return ve=Z._init,L(U,H,ve(Z._payload),de)}if(Jv(Z)||kv(Z))return ve!==null?null:M(U,H,Z,de,null);AT(U,Z)}return null}function G(U,H,Z,de,ve){if(typeof de=="string"&&de!==""||typeof de=="number")return U=U.get(Z)||null,x(H,U,""+de,ve);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case _T:return U=U.get(de.key===null?Z:de.key)||null,a(H,U,de,ve);case O_:return U=U.get(de.key===null?Z:de.key)||null,I(H,U,de,ve);case nf:var Ee=de._init;return G(U,H,Z,Ee(de._payload),ve)}if(Jv(de)||kv(de))return U=U.get(Z)||null,M(H,U,de,ve,null);AT(H,de)}return null}function Q(U,H,Z,de){for(var ve=null,Ee=null,ie=H,ue=H=0,K=null;ie!==null&&ue<Z.length;ue++){ie.index>ue?(K=ie,ie=null):K=ie.sibling;var ge=L(U,ie,Z[ue],de);if(ge===null){ie===null&&(ie=K);break}t&&ie&&ge.alternate===null&&e(U,ie),H=d(ge,H,ue),Ee===null?ve=ge:Ee.sibling=ge,Ee=ge,ie=K}if(ue===Z.length)return r(U,ie),hs&&Yp(U,ue),ve;if(ie===null){for(;ue<Z.length;ue++)ie=D(U,Z[ue],de),ie!==null&&(H=d(ie,H,ue),Ee===null?ve=ie:Ee.sibling=ie,Ee=ie);return hs&&Yp(U,ue),ve}for(ie=s(U,ie);ue<Z.length;ue++)K=G(ie,U,ue,Z[ue],de),K!==null&&(t&&K.alternate!==null&&ie.delete(K.key===null?ue:K.key),H=d(K,H,ue),Ee===null?ve=K:Ee.sibling=K,Ee=K);return t&&ie.forEach(function(_e){return e(U,_e)}),hs&&Yp(U,ue),ve}function re(U,H,Z,de){var ve=kv(Z);if(typeof ve!="function")throw Error(hn(150));if(Z=ve.call(Z),Z==null)throw Error(hn(151));for(var Ee=ve=null,ie=H,ue=H=0,K=null,ge=Z.next();ie!==null&&!ge.done;ue++,ge=Z.next()){ie.index>ue?(K=ie,ie=null):K=ie.sibling;var _e=L(U,ie,ge.value,de);if(_e===null){ie===null&&(ie=K);break}t&&ie&&_e.alternate===null&&e(U,ie),H=d(_e,H,ue),Ee===null?ve=_e:Ee.sibling=_e,Ee=_e,ie=K}if(ge.done)return r(U,ie),hs&&Yp(U,ue),ve;if(ie===null){for(;!ge.done;ue++,ge=Z.next())ge=D(U,ge.value,de),ge!==null&&(H=d(ge,H,ue),Ee===null?ve=ge:Ee.sibling=ge,Ee=ge);return hs&&Yp(U,ue),ve}for(ie=s(U,ie);!ge.done;ue++,ge=Z.next())ge=G(ie,U,ue,ge.value,de),ge!==null&&(t&&ge.alternate!==null&&ie.delete(ge.key===null?ue:ge.key),H=d(ge,H,ue),Ee===null?ve=ge:Ee.sibling=ge,Ee=ge);return t&&ie.forEach(function(Se){return e(U,Se)}),hs&&Yp(U,ue),ve}function ee(U,H,Z,de){if(typeof Z=="object"&&Z!==null&&Z.type===D_&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case _T:e:{for(var ve=Z.key,Ee=H;Ee!==null;){if(Ee.key===ve){if(ve=Z.type,ve===D_){if(Ee.tag===7){r(U,Ee.sibling),H=c(Ee,Z.props.children),H.return=U,U=H;break e}}else if(Ee.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===nf&&r6(ve)===Ee.type){r(U,Ee.sibling),H=c(Ee,Z.props),H.ref=Nv(U,Ee,Z),H.return=U,U=H;break e}r(U,Ee);break}else e(U,Ee);Ee=Ee.sibling}Z.type===D_?(H=ym(Z.props.children,U.mode,de,Z.key),H.return=U,U=H):(de=mE(Z.type,Z.key,Z.props,null,U.mode,de),de.ref=Nv(U,H,Z),de.return=U,U=de)}return _(U);case O_:e:{for(Ee=Z.key;H!==null;){if(H.key===Ee)if(H.tag===4&&H.stateNode.containerInfo===Z.containerInfo&&H.stateNode.implementation===Z.implementation){r(U,H.sibling),H=c(H,Z.children||[]),H.return=U,U=H;break e}else{r(U,H);break}else e(U,H);H=H.sibling}H=Y3(Z,U.mode,de),H.return=U,U=H}return _(U);case nf:return Ee=Z._init,ee(U,H,Ee(Z._payload),de)}if(Jv(Z))return Q(U,H,Z,de);if(kv(Z))return re(U,H,Z,de);AT(U,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,H!==null&&H.tag===6?(r(U,H.sibling),H=c(H,Z),H.return=U,U=H):(r(U,H),H=Q3(Z,U.mode,de),H.return=U,U=H),_(U)):r(U,H)}return ee}var vy=O9(!0),D9=O9(!1),eS=qf(null),tS=null,V_=null,rO=null;function iO(){rO=V_=tS=null}function sO(t){var e=eS.current;Ji(eS),t._currentValue=e}function IM(t,e,r){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===r)break;t=t.return}}function ny(t,e){tS=t,rO=V_=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Fa=!0),t.firstContext=null)}function Xl(t){var e=t._currentValue;if(rO!==t)if(t={context:t,memoizedValue:e,next:null},V_===null){if(tS===null)throw Error(hn(308));V_=t,tS.dependencies={lanes:0,firstContext:t}}else V_=V_.next=t;return e}var cm=null;function oO(t){cm===null?cm=[t]:cm.push(t)}function L9(t,e,r,s){var c=e.interleaved;return c===null?(r.next=r,oO(e)):(r.next=c.next,c.next=r),e.interleaved=r,qh(t,s)}function qh(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var rf=!1;function aO(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function z9(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Nh(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function wf(t,e,r){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,ri&2){var c=s.pending;return c===null?e.next=e:(e.next=c.next,c.next=e),s.pending=e,qh(t,r)}return c=s.interleaved,c===null?(e.next=e,oO(s)):(e.next=c.next,c.next=e),s.interleaved=e,qh(t,r)}function cE(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,r|=s,e.lanes=r,W4(t,r)}}function i6(t,e){var r=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,r===s)){var c=null,d=null;if(r=r.firstBaseUpdate,r!==null){do{var _={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};d===null?c=d=_:d=d.next=_,r=r.next}while(r!==null);d===null?c=d=e:d=d.next=e}else c=d=e;r={baseState:s.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:s.shared,effects:s.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function nS(t,e,r,s){var c=t.updateQueue;rf=!1;var d=c.firstBaseUpdate,_=c.lastBaseUpdate,x=c.shared.pending;if(x!==null){c.shared.pending=null;var a=x,I=a.next;a.next=null,_===null?d=I:_.next=I,_=a;var M=t.alternate;M!==null&&(M=M.updateQueue,x=M.lastBaseUpdate,x!==_&&(x===null?M.firstBaseUpdate=I:x.next=I,M.lastBaseUpdate=a))}if(d!==null){var D=c.baseState;_=0,M=I=a=null,x=d;do{var L=x.lane,G=x.eventTime;if((s&L)===L){M!==null&&(M=M.next={eventTime:G,lane:0,tag:x.tag,payload:x.payload,callback:x.callback,next:null});e:{var Q=t,re=x;switch(L=e,G=r,re.tag){case 1:if(Q=re.payload,typeof Q=="function"){D=Q.call(G,D,L);break e}D=Q;break e;case 3:Q.flags=Q.flags&-65537|128;case 0:if(Q=re.payload,L=typeof Q=="function"?Q.call(G,D,L):Q,L==null)break e;D=xs({},D,L);break e;case 2:rf=!0}}x.callback!==null&&x.lane!==0&&(t.flags|=64,L=c.effects,L===null?c.effects=[x]:L.push(x))}else G={eventTime:G,lane:L,tag:x.tag,payload:x.payload,callback:x.callback,next:null},M===null?(I=M=G,a=D):M=M.next=G,_|=L;if(x=x.next,x===null){if(x=c.shared.pending,x===null)break;L=x,x=L.next,L.next=null,c.lastBaseUpdate=L,c.shared.pending=null}}while(!0);if(M===null&&(a=D),c.baseState=a,c.firstBaseUpdate=I,c.lastBaseUpdate=M,e=c.shared.interleaved,e!==null){c=e;do _|=c.lane,c=c.next;while(c!==e)}else d===null&&(c.shared.lanes=0);Mm|=_,t.lanes=_,t.memoizedState=D}}function s6(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],c=s.callback;if(c!==null){if(s.callback=null,s=r,typeof c!="function")throw Error(hn(191,c));c.call(s)}}}var Gx={},Lu=qf(Gx),nx=qf(Gx),rx=qf(Gx);function um(t){if(t===Gx)throw Error(hn(174));return t}function lO(t,e){switch(qi(rx,e),qi(nx,t),qi(Lu,Gx),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:oM(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=oM(e,t)}Ji(Lu),qi(Lu,e)}function xy(){Ji(Lu),Ji(nx),Ji(rx)}function N9(t){um(rx.current);var e=um(Lu.current),r=oM(e,t.type);e!==r&&(qi(nx,t),qi(Lu,r))}function cO(t){nx.current===t&&(Ji(Lu),Ji(nx))}var ys=qf(0);function rS(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var G3=[];function uO(){for(var t=0;t<G3.length;t++)G3[t]._workInProgressVersionPrimary=null;G3.length=0}var uE=td.ReactCurrentDispatcher,W3=td.ReactCurrentBatchConfig,Rm=0,vs=null,lo=null,xo=null,iS=!1,b1=!1,ix=0,ate=0;function $o(){throw Error(hn(321))}function hO(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Vc(t[r],e[r]))return!1;return!0}function dO(t,e,r,s,c,d){if(Rm=d,vs=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,uE.current=t===null||t.memoizedState===null?hte:dte,t=r(s,c),b1){d=0;do{if(b1=!1,ix=0,25<=d)throw Error(hn(301));d+=1,xo=lo=null,e.updateQueue=null,uE.current=fte,t=r(s,c)}while(b1)}if(uE.current=sS,e=lo!==null&&lo.next!==null,Rm=0,xo=lo=vs=null,iS=!1,e)throw Error(hn(300));return t}function fO(){var t=ix!==0;return ix=0,t}function wu(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xo===null?vs.memoizedState=xo=t:xo=xo.next=t,xo}function Kl(){if(lo===null){var t=vs.alternate;t=t!==null?t.memoizedState:null}else t=lo.next;var e=xo===null?vs.memoizedState:xo.next;if(e!==null)xo=e,lo=t;else{if(t===null)throw Error(hn(310));lo=t,t={memoizedState:lo.memoizedState,baseState:lo.baseState,baseQueue:lo.baseQueue,queue:lo.queue,next:null},xo===null?vs.memoizedState=xo=t:xo=xo.next=t}return xo}function sx(t,e){return typeof e=="function"?e(t):e}function H3(t){var e=Kl(),r=e.queue;if(r===null)throw Error(hn(311));r.lastRenderedReducer=t;var s=lo,c=s.baseQueue,d=r.pending;if(d!==null){if(c!==null){var _=c.next;c.next=d.next,d.next=_}s.baseQueue=c=d,r.pending=null}if(c!==null){d=c.next,s=s.baseState;var x=_=null,a=null,I=d;do{var M=I.lane;if((Rm&M)===M)a!==null&&(a=a.next={lane:0,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null}),s=I.hasEagerState?I.eagerState:t(s,I.action);else{var D={lane:M,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null};a===null?(x=a=D,_=s):a=a.next=D,vs.lanes|=M,Mm|=M}I=I.next}while(I!==null&&I!==d);a===null?_=s:a.next=x,Vc(s,e.memoizedState)||(Fa=!0),e.memoizedState=s,e.baseState=_,e.baseQueue=a,r.lastRenderedState=s}if(t=r.interleaved,t!==null){c=t;do d=c.lane,vs.lanes|=d,Mm|=d,c=c.next;while(c!==t)}else c===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function Z3(t){var e=Kl(),r=e.queue;if(r===null)throw Error(hn(311));r.lastRenderedReducer=t;var s=r.dispatch,c=r.pending,d=e.memoizedState;if(c!==null){r.pending=null;var _=c=c.next;do d=t(d,_.action),_=_.next;while(_!==c);Vc(d,e.memoizedState)||(Fa=!0),e.memoizedState=d,e.baseQueue===null&&(e.baseState=d),r.lastRenderedState=d}return[d,s]}function F9(){}function B9(t,e){var r=vs,s=Kl(),c=e(),d=!Vc(s.memoizedState,c);if(d&&(s.memoizedState=c,Fa=!0),s=s.queue,pO(V9.bind(null,r,s,t),[t]),s.getSnapshot!==e||d||xo!==null&&xo.memoizedState.tag&1){if(r.flags|=2048,ox(9,U9.bind(null,r,s,c,e),void 0,null),wo===null)throw Error(hn(349));Rm&30||j9(r,e,c)}return c}function j9(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=vs.updateQueue,e===null?(e={lastEffect:null,stores:null},vs.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function U9(t,e,r,s){e.value=r,e.getSnapshot=s,$9(e)&&q9(t)}function V9(t,e,r){return r(function(){$9(e)&&q9(t)})}function $9(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Vc(t,r)}catch{return!0}}function q9(t){var e=qh(t,1);e!==null&&Bc(e,t,1,-1)}function o6(t){var e=wu();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sx,lastRenderedState:t},e.queue=t,t=t.dispatch=ute.bind(null,vs,t),[e.memoizedState,t]}function ox(t,e,r,s){return t={tag:t,create:e,destroy:r,deps:s,next:null},e=vs.updateQueue,e===null?(e={lastEffect:null,stores:null},vs.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(s=r.next,r.next=t,t.next=s,e.lastEffect=t)),t}function G9(){return Kl().memoizedState}function hE(t,e,r,s){var c=wu();vs.flags|=t,c.memoizedState=ox(1|e,r,void 0,s===void 0?null:s)}function _I(t,e,r,s){var c=Kl();s=s===void 0?null:s;var d=void 0;if(lo!==null){var _=lo.memoizedState;if(d=_.destroy,s!==null&&hO(s,_.deps)){c.memoizedState=ox(e,r,d,s);return}}vs.flags|=t,c.memoizedState=ox(1|e,r,d,s)}function a6(t,e){return hE(8390656,8,t,e)}function pO(t,e){return _I(2048,8,t,e)}function W9(t,e){return _I(4,2,t,e)}function H9(t,e){return _I(4,4,t,e)}function Z9(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function X9(t,e,r){return r=r!=null?r.concat([t]):null,_I(4,4,Z9.bind(null,e,t),r)}function mO(){}function K9(t,e){var r=Kl();e=e===void 0?null:e;var s=r.memoizedState;return s!==null&&e!==null&&hO(e,s[1])?s[0]:(r.memoizedState=[t,e],t)}function Q9(t,e){var r=Kl();e=e===void 0?null:e;var s=r.memoizedState;return s!==null&&e!==null&&hO(e,s[1])?s[0]:(t=t(),r.memoizedState=[t,e],t)}function Y9(t,e,r){return Rm&21?(Vc(r,e)||(r=r9(),vs.lanes|=r,Mm|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Fa=!0),t.memoizedState=r)}function lte(t,e){var r=Ti;Ti=r!==0&&4>r?r:4,t(!0);var s=W3.transition;W3.transition={};try{t(!1),e()}finally{Ti=r,W3.transition=s}}function J9(){return Kl().memoizedState}function cte(t,e,r){var s=Ef(t);if(r={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null},e2(t))t2(e,r);else if(r=L9(t,e,r,s),r!==null){var c=va();Bc(r,t,s,c),n2(r,e,s)}}function ute(t,e,r){var s=Ef(t),c={lane:s,action:r,hasEagerState:!1,eagerState:null,next:null};if(e2(t))t2(e,c);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=e.lastRenderedReducer,d!==null))try{var _=e.lastRenderedState,x=d(_,r);if(c.hasEagerState=!0,c.eagerState=x,Vc(x,_)){var a=e.interleaved;a===null?(c.next=c,oO(e)):(c.next=a.next,a.next=c),e.interleaved=c;return}}catch{}finally{}r=L9(t,e,c,s),r!==null&&(c=va(),Bc(r,t,s,c),n2(r,e,s))}}function e2(t){var e=t.alternate;return t===vs||e!==null&&e===vs}function t2(t,e){b1=iS=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function n2(t,e,r){if(r&4194240){var s=e.lanes;s&=t.pendingLanes,r|=s,e.lanes=r,W4(t,r)}}var sS={readContext:Xl,useCallback:$o,useContext:$o,useEffect:$o,useImperativeHandle:$o,useInsertionEffect:$o,useLayoutEffect:$o,useMemo:$o,useReducer:$o,useRef:$o,useState:$o,useDebugValue:$o,useDeferredValue:$o,useTransition:$o,useMutableSource:$o,useSyncExternalStore:$o,useId:$o,unstable_isNewReconciler:!1},hte={readContext:Xl,useCallback:function(t,e){return wu().memoizedState=[t,e===void 0?null:e],t},useContext:Xl,useEffect:a6,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,hE(4194308,4,Z9.bind(null,e,t),r)},useLayoutEffect:function(t,e){return hE(4194308,4,t,e)},useInsertionEffect:function(t,e){return hE(4,2,t,e)},useMemo:function(t,e){var r=wu();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var s=wu();return e=r!==void 0?r(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=cte.bind(null,vs,t),[s.memoizedState,t]},useRef:function(t){var e=wu();return t={current:t},e.memoizedState=t},useState:o6,useDebugValue:mO,useDeferredValue:function(t){return wu().memoizedState=t},useTransition:function(){var t=o6(!1),e=t[0];return t=lte.bind(null,t[1]),wu().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var s=vs,c=wu();if(hs){if(r===void 0)throw Error(hn(407));r=r()}else{if(r=e(),wo===null)throw Error(hn(349));Rm&30||j9(s,e,r)}c.memoizedState=r;var d={value:r,getSnapshot:e};return c.queue=d,a6(V9.bind(null,s,d,t),[t]),s.flags|=2048,ox(9,U9.bind(null,s,d,r,e),void 0,null),r},useId:function(){var t=wu(),e=wo.identifierPrefix;if(hs){var r=Oh,s=kh;r=(s&~(1<<32-Fc(s)-1)).toString(32)+r,e=":"+e+"R"+r,r=ix++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=ate++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},dte={readContext:Xl,useCallback:K9,useContext:Xl,useEffect:pO,useImperativeHandle:X9,useInsertionEffect:W9,useLayoutEffect:H9,useMemo:Q9,useReducer:H3,useRef:G9,useState:function(){return H3(sx)},useDebugValue:mO,useDeferredValue:function(t){var e=Kl();return Y9(e,lo.memoizedState,t)},useTransition:function(){var t=H3(sx)[0],e=Kl().memoizedState;return[t,e]},useMutableSource:F9,useSyncExternalStore:B9,useId:J9,unstable_isNewReconciler:!1},fte={readContext:Xl,useCallback:K9,useContext:Xl,useEffect:pO,useImperativeHandle:X9,useInsertionEffect:W9,useLayoutEffect:H9,useMemo:Q9,useReducer:Z3,useRef:G9,useState:function(){return Z3(sx)},useDebugValue:mO,useDeferredValue:function(t){var e=Kl();return lo===null?e.memoizedState=t:Y9(e,lo.memoizedState,t)},useTransition:function(){var t=Z3(sx)[0],e=Kl().memoizedState;return[t,e]},useMutableSource:F9,useSyncExternalStore:B9,useId:J9,unstable_isNewReconciler:!1};function Rc(t,e){if(t&&t.defaultProps){e=xs({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}function CM(t,e,r,s){e=t.memoizedState,r=r(s,e),r=r==null?e:xs({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var yI={isMounted:function(t){return(t=t._reactInternals)?Zm(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var s=va(),c=Ef(t),d=Nh(s,c);d.payload=e,r!=null&&(d.callback=r),e=wf(t,d,c),e!==null&&(Bc(e,t,c,s),cE(e,t,c))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var s=va(),c=Ef(t),d=Nh(s,c);d.tag=1,d.payload=e,r!=null&&(d.callback=r),e=wf(t,d,c),e!==null&&(Bc(e,t,c,s),cE(e,t,c))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=va(),s=Ef(t),c=Nh(r,s);c.tag=2,e!=null&&(c.callback=e),e=wf(t,c,s),e!==null&&(Bc(e,t,s,r),cE(e,t,s))}};function l6(t,e,r,s,c,d,_){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,d,_):e.prototype&&e.prototype.isPureReactComponent?!Y1(r,s)||!Y1(c,d):!0}function r2(t,e,r){var s=!1,c=Of,d=e.contextType;return typeof d=="object"&&d!==null?d=Xl(d):(c=Ua(e)?Am:Yo.current,s=e.contextTypes,d=(s=s!=null)?_y(t,c):Of),e=new e(r,d),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=yI,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=c,t.__reactInternalMemoizedMaskedChildContext=d),e}function c6(t,e,r,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,s),e.state!==t&&yI.enqueueReplaceState(e,e.state,null)}function AM(t,e,r,s){var c=t.stateNode;c.props=r,c.state=t.memoizedState,c.refs={},aO(t);var d=e.contextType;typeof d=="object"&&d!==null?c.context=Xl(d):(d=Ua(e)?Am:Yo.current,c.context=_y(t,d)),c.state=t.memoizedState,d=e.getDerivedStateFromProps,typeof d=="function"&&(CM(t,e,d,r),c.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(e=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),e!==c.state&&yI.enqueueReplaceState(c,c.state,null),nS(t,r,c,s),c.state=t.memoizedState),typeof c.componentDidMount=="function"&&(t.flags|=4194308)}function by(t,e){try{var r="",s=e;do r+=UJ(s),s=s.return;while(s);var c=r}catch(d){c=`
Error generating stack: `+d.message+`
`+d.stack}return{value:t,source:e,stack:c,digest:null}}function X3(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function PM(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var pte=typeof WeakMap=="function"?WeakMap:Map;function i2(t,e,r){r=Nh(-1,r),r.tag=3,r.payload={element:null};var s=e.value;return r.callback=function(){aS||(aS=!0,BM=s),PM(t,e)},r}function s2(t,e,r){r=Nh(-1,r),r.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var c=e.value;r.payload=function(){return s(c)},r.callback=function(){PM(t,e)}}var d=t.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(r.callback=function(){PM(t,e),typeof s!="function"&&(Tf===null?Tf=new Set([this]):Tf.add(this));var _=e.stack;this.componentDidCatch(e.value,{componentStack:_!==null?_:""})}),r}function u6(t,e,r){var s=t.pingCache;if(s===null){s=t.pingCache=new pte;var c=new Set;s.set(e,c)}else c=s.get(e),c===void 0&&(c=new Set,s.set(e,c));c.has(r)||(c.add(r),t=Ate.bind(null,t,e,r),e.then(t,t))}function h6(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function d6(t,e,r,s,c){return t.mode&1?(t.flags|=65536,t.lanes=c,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Nh(-1,1),e.tag=2,wf(r,e,1))),r.lanes|=1),t)}var mte=td.ReactCurrentOwner,Fa=!1;function ga(t,e,r,s){e.child=t===null?D9(e,null,r,s):vy(e,t.child,r,s)}function f6(t,e,r,s,c){r=r.render;var d=e.ref;return ny(e,c),s=dO(t,e,r,s,d,c),r=fO(),t!==null&&!Fa?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,Gh(t,e,c)):(hs&&r&&eO(e),e.flags|=1,ga(t,e,s,c),e.child)}function p6(t,e,r,s,c){if(t===null){var d=r.type;return typeof d=="function"&&!TO(d)&&d.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=d,o2(t,e,d,s,c)):(t=mE(r.type,null,s,e,e.mode,c),t.ref=e.ref,t.return=e,e.child=t)}if(d=t.child,!(t.lanes&c)){var _=d.memoizedProps;if(r=r.compare,r=r!==null?r:Y1,r(_,s)&&t.ref===e.ref)return Gh(t,e,c)}return e.flags|=1,t=Sf(d,s),t.ref=e.ref,t.return=e,e.child=t}function o2(t,e,r,s,c){if(t!==null){var d=t.memoizedProps;if(Y1(d,s)&&t.ref===e.ref)if(Fa=!1,e.pendingProps=s=d,(t.lanes&c)!==0)t.flags&131072&&(Fa=!0);else return e.lanes=t.lanes,Gh(t,e,c)}return RM(t,e,r,s,c)}function a2(t,e,r){var s=e.pendingProps,c=s.children,d=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},qi(q_,sl),sl|=r;else{if(!(r&1073741824))return t=d!==null?d.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,qi(q_,sl),sl|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=d!==null?d.baseLanes:r,qi(q_,sl),sl|=s}else d!==null?(s=d.baseLanes|r,e.memoizedState=null):s=r,qi(q_,sl),sl|=s;return ga(t,e,c,r),e.child}function l2(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function RM(t,e,r,s,c){var d=Ua(r)?Am:Yo.current;return d=_y(e,d),ny(e,c),r=dO(t,e,r,s,d,c),s=fO(),t!==null&&!Fa?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~c,Gh(t,e,c)):(hs&&s&&eO(e),e.flags|=1,ga(t,e,r,c),e.child)}function m6(t,e,r,s,c){if(Ua(r)){var d=!0;QE(e)}else d=!1;if(ny(e,c),e.stateNode===null)dE(t,e),r2(e,r,s),AM(e,r,s,c),s=!0;else if(t===null){var _=e.stateNode,x=e.memoizedProps;_.props=x;var a=_.context,I=r.contextType;typeof I=="object"&&I!==null?I=Xl(I):(I=Ua(r)?Am:Yo.current,I=_y(e,I));var M=r.getDerivedStateFromProps,D=typeof M=="function"||typeof _.getSnapshotBeforeUpdate=="function";D||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(x!==s||a!==I)&&c6(e,_,s,I),rf=!1;var L=e.memoizedState;_.state=L,nS(e,s,_,c),a=e.memoizedState,x!==s||L!==a||ja.current||rf?(typeof M=="function"&&(CM(e,r,M,s),a=e.memoizedState),(x=rf||l6(e,r,x,s,L,a,I))?(D||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(e.flags|=4194308)):(typeof _.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=a),_.props=s,_.state=a,_.context=I,s=x):(typeof _.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{_=e.stateNode,z9(t,e),x=e.memoizedProps,I=e.type===e.elementType?x:Rc(e.type,x),_.props=I,D=e.pendingProps,L=_.context,a=r.contextType,typeof a=="object"&&a!==null?a=Xl(a):(a=Ua(r)?Am:Yo.current,a=_y(e,a));var G=r.getDerivedStateFromProps;(M=typeof G=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(x!==D||L!==a)&&c6(e,_,s,a),rf=!1,L=e.memoizedState,_.state=L,nS(e,s,_,c);var Q=e.memoizedState;x!==D||L!==Q||ja.current||rf?(typeof G=="function"&&(CM(e,r,G,s),Q=e.memoizedState),(I=rf||l6(e,r,I,s,L,Q,a)||!1)?(M||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(s,Q,a),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(s,Q,a)),typeof _.componentDidUpdate=="function"&&(e.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof _.componentDidUpdate!="function"||x===t.memoizedProps&&L===t.memoizedState||(e.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&L===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=Q),_.props=s,_.state=Q,_.context=a,s=I):(typeof _.componentDidUpdate!="function"||x===t.memoizedProps&&L===t.memoizedState||(e.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&L===t.memoizedState||(e.flags|=1024),s=!1)}return MM(t,e,r,s,d,c)}function MM(t,e,r,s,c,d){l2(t,e);var _=(e.flags&128)!==0;if(!s&&!_)return c&&e6(e,r,!1),Gh(t,e,d);s=e.stateNode,mte.current=e;var x=_&&typeof r.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&_?(e.child=vy(e,t.child,null,d),e.child=vy(e,null,x,d)):ga(t,e,x,d),e.memoizedState=s.state,c&&e6(e,r,!0),e.child}function c2(t){var e=t.stateNode;e.pendingContext?JB(t,e.pendingContext,e.pendingContext!==e.context):e.context&&JB(t,e.context,!1),lO(t,e.containerInfo)}function g6(t,e,r,s,c){return yy(),nO(c),e.flags|=256,ga(t,e,r,s),e.child}var kM={dehydrated:null,treeContext:null,retryLane:0};function OM(t){return{baseLanes:t,cachePool:null,transitions:null}}function u2(t,e,r){var s=e.pendingProps,c=ys.current,d=!1,_=(e.flags&128)!==0,x;if((x=_)||(x=t!==null&&t.memoizedState===null?!1:(c&2)!==0),x?(d=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(c|=1),qi(ys,c&1),t===null)return SM(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(_=s.children,t=s.fallback,d?(s=e.mode,d=e.child,_={mode:"hidden",children:_},!(s&1)&&d!==null?(d.childLanes=0,d.pendingProps=_):d=bI(_,s,0,null),t=ym(t,s,r,null),d.return=e,t.return=e,d.sibling=t,e.child=d,e.child.memoizedState=OM(r),e.memoizedState=kM,t):gO(e,_));if(c=t.memoizedState,c!==null&&(x=c.dehydrated,x!==null))return gte(t,e,_,s,x,c,r);if(d){d=s.fallback,_=e.mode,c=t.child,x=c.sibling;var a={mode:"hidden",children:s.children};return!(_&1)&&e.child!==c?(s=e.child,s.childLanes=0,s.pendingProps=a,e.deletions=null):(s=Sf(c,a),s.subtreeFlags=c.subtreeFlags&14680064),x!==null?d=Sf(x,d):(d=ym(d,_,r,null),d.flags|=2),d.return=e,s.return=e,s.sibling=d,e.child=s,s=d,d=e.child,_=t.child.memoizedState,_=_===null?OM(r):{baseLanes:_.baseLanes|r,cachePool:null,transitions:_.transitions},d.memoizedState=_,d.childLanes=t.childLanes&~r,e.memoizedState=kM,s}return d=t.child,t=d.sibling,s=Sf(d,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=r),s.return=e,s.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=s,e.memoizedState=null,s}function gO(t,e){return e=bI({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function PT(t,e,r,s){return s!==null&&nO(s),vy(e,t.child,null,r),t=gO(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function gte(t,e,r,s,c,d,_){if(r)return e.flags&256?(e.flags&=-257,s=X3(Error(hn(422))),PT(t,e,_,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(d=s.fallback,c=e.mode,s=bI({mode:"visible",children:s.children},c,0,null),d=ym(d,c,_,null),d.flags|=2,s.return=e,d.return=e,s.sibling=d,e.child=s,e.mode&1&&vy(e,t.child,null,_),e.child.memoizedState=OM(_),e.memoizedState=kM,d);if(!(e.mode&1))return PT(t,e,_,null);if(c.data==="$!"){if(s=c.nextSibling&&c.nextSibling.dataset,s)var x=s.dgst;return s=x,d=Error(hn(419)),s=X3(d,s,void 0),PT(t,e,_,s)}if(x=(_&t.childLanes)!==0,Fa||x){if(s=wo,s!==null){switch(_&-_){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(s.suspendedLanes|_)?0:c,c!==0&&c!==d.retryLane&&(d.retryLane=c,qh(t,c),Bc(s,t,c,-1))}return wO(),s=X3(Error(hn(421))),PT(t,e,_,s)}return c.data==="$?"?(e.flags|=128,e.child=t.child,e=Pte.bind(null,t),c._reactRetry=e,null):(t=d.treeContext,al=bf(c.nextSibling),fl=e,hs=!0,kc=null,t!==null&&(Bl[jl++]=kh,Bl[jl++]=Oh,Bl[jl++]=Pm,kh=t.id,Oh=t.overflow,Pm=e),e=gO(e,s.children),e.flags|=4096,e)}function _6(t,e,r){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),IM(t.return,e,r)}function K3(t,e,r,s,c){var d=t.memoizedState;d===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:r,tailMode:c}:(d.isBackwards=e,d.rendering=null,d.renderingStartTime=0,d.last=s,d.tail=r,d.tailMode=c)}function h2(t,e,r){var s=e.pendingProps,c=s.revealOrder,d=s.tail;if(ga(t,e,s.children,r),s=ys.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&_6(t,r,e);else if(t.tag===19)_6(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(qi(ys,s),!(e.mode&1))e.memoizedState=null;else switch(c){case"forwards":for(r=e.child,c=null;r!==null;)t=r.alternate,t!==null&&rS(t)===null&&(c=r),r=r.sibling;r=c,r===null?(c=e.child,e.child=null):(c=r.sibling,r.sibling=null),K3(e,!1,c,r,d);break;case"backwards":for(r=null,c=e.child,e.child=null;c!==null;){if(t=c.alternate,t!==null&&rS(t)===null){e.child=c;break}t=c.sibling,c.sibling=r,r=c,c=t}K3(e,!0,r,null,d);break;case"together":K3(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function dE(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Gh(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Mm|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(hn(153));if(e.child!==null){for(t=e.child,r=Sf(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Sf(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function _te(t,e,r){switch(e.tag){case 3:c2(e),yy();break;case 5:N9(e);break;case 1:Ua(e.type)&&QE(e);break;case 4:lO(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,c=e.memoizedProps.value;qi(eS,s._currentValue),s._currentValue=c;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(qi(ys,ys.current&1),e.flags|=128,null):r&e.child.childLanes?u2(t,e,r):(qi(ys,ys.current&1),t=Gh(t,e,r),t!==null?t.sibling:null);qi(ys,ys.current&1);break;case 19:if(s=(r&e.childLanes)!==0,t.flags&128){if(s)return h2(t,e,r);e.flags|=128}if(c=e.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),qi(ys,ys.current),s)break;return null;case 22:case 23:return e.lanes=0,a2(t,e,r)}return Gh(t,e,r)}var d2,DM,f2,p2;d2=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};DM=function(){};f2=function(t,e,r,s){var c=t.memoizedProps;if(c!==s){t=e.stateNode,um(Lu.current);var d=null;switch(r){case"input":c=nM(t,c),s=nM(t,s),d=[];break;case"select":c=xs({},c,{value:void 0}),s=xs({},s,{value:void 0}),d=[];break;case"textarea":c=sM(t,c),s=sM(t,s),d=[];break;default:typeof c.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=XE)}aM(r,s);var _;r=null;for(I in c)if(!s.hasOwnProperty(I)&&c.hasOwnProperty(I)&&c[I]!=null)if(I==="style"){var x=c[I];for(_ in x)x.hasOwnProperty(_)&&(r||(r={}),r[_]="")}else I!=="dangerouslySetInnerHTML"&&I!=="children"&&I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(G1.hasOwnProperty(I)?d||(d=[]):(d=d||[]).push(I,null));for(I in s){var a=s[I];if(x=c!=null?c[I]:void 0,s.hasOwnProperty(I)&&a!==x&&(a!=null||x!=null))if(I==="style")if(x){for(_ in x)!x.hasOwnProperty(_)||a&&a.hasOwnProperty(_)||(r||(r={}),r[_]="");for(_ in a)a.hasOwnProperty(_)&&x[_]!==a[_]&&(r||(r={}),r[_]=a[_])}else r||(d||(d=[]),d.push(I,r)),r=a;else I==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,x=x?x.__html:void 0,a!=null&&x!==a&&(d=d||[]).push(I,a)):I==="children"?typeof a!="string"&&typeof a!="number"||(d=d||[]).push(I,""+a):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&(G1.hasOwnProperty(I)?(a!=null&&I==="onScroll"&&Zi("scroll",t),d||x===a||(d=[])):(d=d||[]).push(I,a))}r&&(d=d||[]).push("style",r);var I=d;(e.updateQueue=I)&&(e.flags|=4)}};p2=function(t,e,r,s){r!==s&&(e.flags|=4)};function Fv(t,e){if(!hs)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var s=null;r!==null;)r.alternate!==null&&(s=r),r=r.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function qo(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,s=0;if(e)for(var c=t.child;c!==null;)r|=c.lanes|c.childLanes,s|=c.subtreeFlags&14680064,s|=c.flags&14680064,c.return=t,c=c.sibling;else for(c=t.child;c!==null;)r|=c.lanes|c.childLanes,s|=c.subtreeFlags,s|=c.flags,c.return=t,c=c.sibling;return t.subtreeFlags|=s,t.childLanes=r,e}function yte(t,e,r){var s=e.pendingProps;switch(tO(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(e),null;case 1:return Ua(e.type)&&KE(),qo(e),null;case 3:return s=e.stateNode,xy(),Ji(ja),Ji(Yo),uO(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(CT(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,kc!==null&&(VM(kc),kc=null))),DM(t,e),qo(e),null;case 5:cO(e);var c=um(rx.current);if(r=e.type,t!==null&&e.stateNode!=null)f2(t,e,r,s,c),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(hn(166));return qo(e),null}if(t=um(Lu.current),CT(e)){s=e.stateNode,r=e.type;var d=e.memoizedProps;switch(s[Pu]=e,s[tx]=d,t=(e.mode&1)!==0,r){case"dialog":Zi("cancel",s),Zi("close",s);break;case"iframe":case"object":case"embed":Zi("load",s);break;case"video":case"audio":for(c=0;c<t1.length;c++)Zi(t1[c],s);break;case"source":Zi("error",s);break;case"img":case"image":case"link":Zi("error",s),Zi("load",s);break;case"details":Zi("toggle",s);break;case"input":IB(s,d),Zi("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!d.multiple},Zi("invalid",s);break;case"textarea":AB(s,d),Zi("invalid",s)}aM(r,d),c=null;for(var _ in d)if(d.hasOwnProperty(_)){var x=d[_];_==="children"?typeof x=="string"?s.textContent!==x&&(d.suppressHydrationWarning!==!0&&IT(s.textContent,x,t),c=["children",x]):typeof x=="number"&&s.textContent!==""+x&&(d.suppressHydrationWarning!==!0&&IT(s.textContent,x,t),c=["children",""+x]):G1.hasOwnProperty(_)&&x!=null&&_==="onScroll"&&Zi("scroll",s)}switch(r){case"input":yT(s),CB(s,d,!0);break;case"textarea":yT(s),PB(s);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(s.onclick=XE)}s=c,e.updateQueue=s,s!==null&&(e.flags|=4)}else{_=c.nodeType===9?c:c.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=V8(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=_.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=_.createElement(r,{is:s.is}):(t=_.createElement(r),r==="select"&&(_=t,s.multiple?_.multiple=!0:s.size&&(_.size=s.size))):t=_.createElementNS(t,r),t[Pu]=e,t[tx]=s,d2(t,e,!1,!1),e.stateNode=t;e:{switch(_=lM(r,s),r){case"dialog":Zi("cancel",t),Zi("close",t),c=s;break;case"iframe":case"object":case"embed":Zi("load",t),c=s;break;case"video":case"audio":for(c=0;c<t1.length;c++)Zi(t1[c],t);c=s;break;case"source":Zi("error",t),c=s;break;case"img":case"image":case"link":Zi("error",t),Zi("load",t),c=s;break;case"details":Zi("toggle",t),c=s;break;case"input":IB(t,s),c=nM(t,s),Zi("invalid",t);break;case"option":c=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},c=xs({},s,{value:void 0}),Zi("invalid",t);break;case"textarea":AB(t,s),c=sM(t,s),Zi("invalid",t);break;default:c=s}aM(r,c),x=c;for(d in x)if(x.hasOwnProperty(d)){var a=x[d];d==="style"?G8(t,a):d==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&$8(t,a)):d==="children"?typeof a=="string"?(r!=="textarea"||a!=="")&&W1(t,a):typeof a=="number"&&W1(t,""+a):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(G1.hasOwnProperty(d)?a!=null&&d==="onScroll"&&Zi("scroll",t):a!=null&&j4(t,d,a,_))}switch(r){case"input":yT(t),CB(t,s,!1);break;case"textarea":yT(t),PB(t);break;case"option":s.value!=null&&t.setAttribute("value",""+kf(s.value));break;case"select":t.multiple=!!s.multiple,d=s.value,d!=null?Y_(t,!!s.multiple,d,!1):s.defaultValue!=null&&Y_(t,!!s.multiple,s.defaultValue,!0);break;default:typeof c.onClick=="function"&&(t.onclick=XE)}switch(r){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return qo(e),null;case 6:if(t&&e.stateNode!=null)p2(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(hn(166));if(r=um(rx.current),um(Lu.current),CT(e)){if(s=e.stateNode,r=e.memoizedProps,s[Pu]=e,(d=s.nodeValue!==r)&&(t=fl,t!==null))switch(t.tag){case 3:IT(s.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&IT(s.nodeValue,r,(t.mode&1)!==0)}d&&(e.flags|=4)}else s=(r.nodeType===9?r:r.ownerDocument).createTextNode(s),s[Pu]=e,e.stateNode=s}return qo(e),null;case 13:if(Ji(ys),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(hs&&al!==null&&e.mode&1&&!(e.flags&128))k9(),yy(),e.flags|=98560,d=!1;else if(d=CT(e),s!==null&&s.dehydrated!==null){if(t===null){if(!d)throw Error(hn(318));if(d=e.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(hn(317));d[Pu]=e}else yy(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qo(e),d=!1}else kc!==null&&(VM(kc),kc=null),d=!0;if(!d)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||ys.current&1?uo===0&&(uo=3):wO())),e.updateQueue!==null&&(e.flags|=4),qo(e),null);case 4:return xy(),DM(t,e),t===null&&J1(e.stateNode.containerInfo),qo(e),null;case 10:return sO(e.type._context),qo(e),null;case 17:return Ua(e.type)&&KE(),qo(e),null;case 19:if(Ji(ys),d=e.memoizedState,d===null)return qo(e),null;if(s=(e.flags&128)!==0,_=d.rendering,_===null)if(s)Fv(d,!1);else{if(uo!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(_=rS(t),_!==null){for(e.flags|=128,Fv(d,!1),s=_.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=r,r=e.child;r!==null;)d=r,t=s,d.flags&=14680066,_=d.alternate,_===null?(d.childLanes=0,d.lanes=t,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=_.childLanes,d.lanes=_.lanes,d.child=_.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=_.memoizedProps,d.memoizedState=_.memoizedState,d.updateQueue=_.updateQueue,d.type=_.type,t=_.dependencies,d.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return qi(ys,ys.current&1|2),e.child}t=t.sibling}d.tail!==null&&Us()>wy&&(e.flags|=128,s=!0,Fv(d,!1),e.lanes=4194304)}else{if(!s)if(t=rS(_),t!==null){if(e.flags|=128,s=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),Fv(d,!0),d.tail===null&&d.tailMode==="hidden"&&!_.alternate&&!hs)return qo(e),null}else 2*Us()-d.renderingStartTime>wy&&r!==1073741824&&(e.flags|=128,s=!0,Fv(d,!1),e.lanes=4194304);d.isBackwards?(_.sibling=e.child,e.child=_):(r=d.last,r!==null?r.sibling=_:e.child=_,d.last=_)}return d.tail!==null?(e=d.tail,d.rendering=e,d.tail=e.sibling,d.renderingStartTime=Us(),e.sibling=null,r=ys.current,qi(ys,s?r&1|2:r&1),e):(qo(e),null);case 22:case 23:return bO(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?sl&1073741824&&(qo(e),e.subtreeFlags&6&&(e.flags|=8192)):qo(e),null;case 24:return null;case 25:return null}throw Error(hn(156,e.tag))}function vte(t,e){switch(tO(e),e.tag){case 1:return Ua(e.type)&&KE(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return xy(),Ji(ja),Ji(Yo),uO(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return cO(e),null;case 13:if(Ji(ys),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(hn(340));yy()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ji(ys),null;case 4:return xy(),null;case 10:return sO(e.type._context),null;case 22:case 23:return bO(),null;case 24:return null;default:return null}}var RT=!1,Zo=!1,xte=typeof WeakSet=="function"?WeakSet:Set,Ln=null;function $_(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(s){ks(t,e,s)}else r.current=null}function LM(t,e,r){try{r()}catch(s){ks(t,e,s)}}var y6=!1;function bte(t,e){if(yM=WE,t=v9(),J4(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var s=r.getSelection&&r.getSelection();if(s&&s.rangeCount!==0){r=s.anchorNode;var c=s.anchorOffset,d=s.focusNode;s=s.focusOffset;try{r.nodeType,d.nodeType}catch{r=null;break e}var _=0,x=-1,a=-1,I=0,M=0,D=t,L=null;t:for(;;){for(var G;D!==r||c!==0&&D.nodeType!==3||(x=_+c),D!==d||s!==0&&D.nodeType!==3||(a=_+s),D.nodeType===3&&(_+=D.nodeValue.length),(G=D.firstChild)!==null;)L=D,D=G;for(;;){if(D===t)break t;if(L===r&&++I===c&&(x=_),L===d&&++M===s&&(a=_),(G=D.nextSibling)!==null)break;D=L,L=D.parentNode}D=G}r=x===-1||a===-1?null:{start:x,end:a}}else r=null}r=r||{start:0,end:0}}else r=null;for(vM={focusedElem:t,selectionRange:r},WE=!1,Ln=e;Ln!==null;)if(e=Ln,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ln=t;else for(;Ln!==null;){e=Ln;try{var Q=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(Q!==null){var re=Q.memoizedProps,ee=Q.memoizedState,U=e.stateNode,H=U.getSnapshotBeforeUpdate(e.elementType===e.type?re:Rc(e.type,re),ee);U.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var Z=e.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(hn(163))}}catch(de){ks(e,e.return,de)}if(t=e.sibling,t!==null){t.return=e.return,Ln=t;break}Ln=e.return}return Q=y6,y6=!1,Q}function w1(t,e,r){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var c=s=s.next;do{if((c.tag&t)===t){var d=c.destroy;c.destroy=void 0,d!==void 0&&LM(e,r,d)}c=c.next}while(c!==s)}}function vI(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var s=r.create;r.destroy=s()}r=r.next}while(r!==e)}}function zM(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function m2(t){var e=t.alternate;e!==null&&(t.alternate=null,m2(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Pu],delete e[tx],delete e[wM],delete e[rte],delete e[ite])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function g2(t){return t.tag===5||t.tag===3||t.tag===4}function v6(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||g2(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function NM(t,e,r){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=XE));else if(s!==4&&(t=t.child,t!==null))for(NM(t,e,r),t=t.sibling;t!==null;)NM(t,e,r),t=t.sibling}function FM(t,e,r){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(FM(t,e,r),t=t.sibling;t!==null;)FM(t,e,r),t=t.sibling}var Io=null,Mc=!1;function Kd(t,e,r){for(r=r.child;r!==null;)_2(t,e,r),r=r.sibling}function _2(t,e,r){if(Du&&typeof Du.onCommitFiberUnmount=="function")try{Du.onCommitFiberUnmount(hI,r)}catch{}switch(r.tag){case 5:Zo||$_(r,e);case 6:var s=Io,c=Mc;Io=null,Kd(t,e,r),Io=s,Mc=c,Io!==null&&(Mc?(t=Io,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Io.removeChild(r.stateNode));break;case 18:Io!==null&&(Mc?(t=Io,r=r.stateNode,t.nodeType===8?$3(t.parentNode,r):t.nodeType===1&&$3(t,r),K1(t)):$3(Io,r.stateNode));break;case 4:s=Io,c=Mc,Io=r.stateNode.containerInfo,Mc=!0,Kd(t,e,r),Io=s,Mc=c;break;case 0:case 11:case 14:case 15:if(!Zo&&(s=r.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){c=s=s.next;do{var d=c,_=d.destroy;d=d.tag,_!==void 0&&(d&2||d&4)&&LM(r,e,_),c=c.next}while(c!==s)}Kd(t,e,r);break;case 1:if(!Zo&&($_(r,e),s=r.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=r.memoizedProps,s.state=r.memoizedState,s.componentWillUnmount()}catch(x){ks(r,e,x)}Kd(t,e,r);break;case 21:Kd(t,e,r);break;case 22:r.mode&1?(Zo=(s=Zo)||r.memoizedState!==null,Kd(t,e,r),Zo=s):Kd(t,e,r);break;default:Kd(t,e,r)}}function x6(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new xte),e.forEach(function(s){var c=Rte.bind(null,t,s);r.has(s)||(r.add(s),s.then(c,c))})}}function Pc(t,e){var r=e.deletions;if(r!==null)for(var s=0;s<r.length;s++){var c=r[s];try{var d=t,_=e,x=_;e:for(;x!==null;){switch(x.tag){case 5:Io=x.stateNode,Mc=!1;break e;case 3:Io=x.stateNode.containerInfo,Mc=!0;break e;case 4:Io=x.stateNode.containerInfo,Mc=!0;break e}x=x.return}if(Io===null)throw Error(hn(160));_2(d,_,c),Io=null,Mc=!1;var a=c.alternate;a!==null&&(a.return=null),c.return=null}catch(I){ks(c,e,I)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)y2(e,t),e=e.sibling}function y2(t,e){var r=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Pc(e,t),yu(t),s&4){try{w1(3,t,t.return),vI(3,t)}catch(re){ks(t,t.return,re)}try{w1(5,t,t.return)}catch(re){ks(t,t.return,re)}}break;case 1:Pc(e,t),yu(t),s&512&&r!==null&&$_(r,r.return);break;case 5:if(Pc(e,t),yu(t),s&512&&r!==null&&$_(r,r.return),t.flags&32){var c=t.stateNode;try{W1(c,"")}catch(re){ks(t,t.return,re)}}if(s&4&&(c=t.stateNode,c!=null)){var d=t.memoizedProps,_=r!==null?r.memoizedProps:d,x=t.type,a=t.updateQueue;if(t.updateQueue=null,a!==null)try{x==="input"&&d.type==="radio"&&d.name!=null&&j8(c,d),lM(x,_);var I=lM(x,d);for(_=0;_<a.length;_+=2){var M=a[_],D=a[_+1];M==="style"?G8(c,D):M==="dangerouslySetInnerHTML"?$8(c,D):M==="children"?W1(c,D):j4(c,M,D,I)}switch(x){case"input":rM(c,d);break;case"textarea":U8(c,d);break;case"select":var L=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!d.multiple;var G=d.value;G!=null?Y_(c,!!d.multiple,G,!1):L!==!!d.multiple&&(d.defaultValue!=null?Y_(c,!!d.multiple,d.defaultValue,!0):Y_(c,!!d.multiple,d.multiple?[]:"",!1))}c[tx]=d}catch(re){ks(t,t.return,re)}}break;case 6:if(Pc(e,t),yu(t),s&4){if(t.stateNode===null)throw Error(hn(162));c=t.stateNode,d=t.memoizedProps;try{c.nodeValue=d}catch(re){ks(t,t.return,re)}}break;case 3:if(Pc(e,t),yu(t),s&4&&r!==null&&r.memoizedState.isDehydrated)try{K1(e.containerInfo)}catch(re){ks(t,t.return,re)}break;case 4:Pc(e,t),yu(t);break;case 13:Pc(e,t),yu(t),c=t.child,c.flags&8192&&(d=c.memoizedState!==null,c.stateNode.isHidden=d,!d||c.alternate!==null&&c.alternate.memoizedState!==null||(vO=Us())),s&4&&x6(t);break;case 22:if(M=r!==null&&r.memoizedState!==null,t.mode&1?(Zo=(I=Zo)||M,Pc(e,t),Zo=I):Pc(e,t),yu(t),s&8192){if(I=t.memoizedState!==null,(t.stateNode.isHidden=I)&&!M&&t.mode&1)for(Ln=t,M=t.child;M!==null;){for(D=Ln=M;Ln!==null;){switch(L=Ln,G=L.child,L.tag){case 0:case 11:case 14:case 15:w1(4,L,L.return);break;case 1:$_(L,L.return);var Q=L.stateNode;if(typeof Q.componentWillUnmount=="function"){s=L,r=L.return;try{e=s,Q.props=e.memoizedProps,Q.state=e.memoizedState,Q.componentWillUnmount()}catch(re){ks(s,r,re)}}break;case 5:$_(L,L.return);break;case 22:if(L.memoizedState!==null){w6(D);continue}}G!==null?(G.return=L,Ln=G):w6(D)}M=M.sibling}e:for(M=null,D=t;;){if(D.tag===5){if(M===null){M=D;try{c=D.stateNode,I?(d=c.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(x=D.stateNode,a=D.memoizedProps.style,_=a!=null&&a.hasOwnProperty("display")?a.display:null,x.style.display=q8("display",_))}catch(re){ks(t,t.return,re)}}}else if(D.tag===6){if(M===null)try{D.stateNode.nodeValue=I?"":D.memoizedProps}catch(re){ks(t,t.return,re)}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===t)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===t)break e;for(;D.sibling===null;){if(D.return===null||D.return===t)break e;M===D&&(M=null),D=D.return}M===D&&(M=null),D.sibling.return=D.return,D=D.sibling}}break;case 19:Pc(e,t),yu(t),s&4&&x6(t);break;case 21:break;default:Pc(e,t),yu(t)}}function yu(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(g2(r)){var s=r;break e}r=r.return}throw Error(hn(160))}switch(s.tag){case 5:var c=s.stateNode;s.flags&32&&(W1(c,""),s.flags&=-33);var d=v6(t);FM(t,d,c);break;case 3:case 4:var _=s.stateNode.containerInfo,x=v6(t);NM(t,x,_);break;default:throw Error(hn(161))}}catch(a){ks(t,t.return,a)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function wte(t,e,r){Ln=t,v2(t)}function v2(t,e,r){for(var s=(t.mode&1)!==0;Ln!==null;){var c=Ln,d=c.child;if(c.tag===22&&s){var _=c.memoizedState!==null||RT;if(!_){var x=c.alternate,a=x!==null&&x.memoizedState!==null||Zo;x=RT;var I=Zo;if(RT=_,(Zo=a)&&!I)for(Ln=c;Ln!==null;)_=Ln,a=_.child,_.tag===22&&_.memoizedState!==null?T6(c):a!==null?(a.return=_,Ln=a):T6(c);for(;d!==null;)Ln=d,v2(d),d=d.sibling;Ln=c,RT=x,Zo=I}b6(t)}else c.subtreeFlags&8772&&d!==null?(d.return=c,Ln=d):b6(t)}}function b6(t){for(;Ln!==null;){var e=Ln;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Zo||vI(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Zo)if(r===null)s.componentDidMount();else{var c=e.elementType===e.type?r.memoizedProps:Rc(e.type,r.memoizedProps);s.componentDidUpdate(c,r.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var d=e.updateQueue;d!==null&&s6(e,d,s);break;case 3:var _=e.updateQueue;if(_!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}s6(e,_,r)}break;case 5:var x=e.stateNode;if(r===null&&e.flags&4){r=x;var a=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&r.focus();break;case"img":a.src&&(r.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var I=e.alternate;if(I!==null){var M=I.memoizedState;if(M!==null){var D=M.dehydrated;D!==null&&K1(D)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(hn(163))}Zo||e.flags&512&&zM(e)}catch(L){ks(e,e.return,L)}}if(e===t){Ln=null;break}if(r=e.sibling,r!==null){r.return=e.return,Ln=r;break}Ln=e.return}}function w6(t){for(;Ln!==null;){var e=Ln;if(e===t){Ln=null;break}var r=e.sibling;if(r!==null){r.return=e.return,Ln=r;break}Ln=e.return}}function T6(t){for(;Ln!==null;){var e=Ln;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{vI(4,e)}catch(a){ks(e,r,a)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var c=e.return;try{s.componentDidMount()}catch(a){ks(e,c,a)}}var d=e.return;try{zM(e)}catch(a){ks(e,d,a)}break;case 5:var _=e.return;try{zM(e)}catch(a){ks(e,_,a)}}}catch(a){ks(e,e.return,a)}if(e===t){Ln=null;break}var x=e.sibling;if(x!==null){x.return=e.return,Ln=x;break}Ln=e.return}}var Tte=Math.ceil,oS=td.ReactCurrentDispatcher,_O=td.ReactCurrentOwner,Hl=td.ReactCurrentBatchConfig,ri=0,wo=null,Qs=null,Ro=0,sl=0,q_=qf(0),uo=0,ax=null,Mm=0,xI=0,yO=0,T1=null,La=null,vO=0,wy=1/0,Ih=null,aS=!1,BM=null,Tf=null,MT=!1,df=null,lS=0,E1=0,jM=null,fE=-1,pE=0;function va(){return ri&6?Us():fE!==-1?fE:fE=Us()}function Ef(t){return t.mode&1?ri&2&&Ro!==0?Ro&-Ro:ote.transition!==null?(pE===0&&(pE=r9()),pE):(t=Ti,t!==0||(t=window.event,t=t===void 0?16:u9(t.type)),t):1}function Bc(t,e,r,s){if(50<E1)throw E1=0,jM=null,Error(hn(185));Vx(t,r,s),(!(ri&2)||t!==wo)&&(t===wo&&(!(ri&2)&&(xI|=r),uo===4&&of(t,Ro)),Va(t,s),r===1&&ri===0&&!(e.mode&1)&&(wy=Us()+500,gI&&Gf()))}function Va(t,e){var r=t.callbackNode;oee(t,e);var s=GE(t,t===wo?Ro:0);if(s===0)r!==null&&kB(r),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(r!=null&&kB(r),e===1)t.tag===0?ste(E6.bind(null,t)):P9(E6.bind(null,t)),tte(function(){!(ri&6)&&Gf()}),r=null;else{switch(i9(s)){case 1:r=G4;break;case 4:r=t9;break;case 16:r=qE;break;case 536870912:r=n9;break;default:r=qE}r=C2(r,x2.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function x2(t,e){if(fE=-1,pE=0,ri&6)throw Error(hn(327));var r=t.callbackNode;if(ry()&&t.callbackNode!==r)return null;var s=GE(t,t===wo?Ro:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=cS(t,s);else{e=s;var c=ri;ri|=2;var d=w2();(wo!==t||Ro!==e)&&(Ih=null,wy=Us()+500,_m(t,e));do try{Ite();break}catch(x){b2(t,x)}while(!0);iO(),oS.current=d,ri=c,Qs!==null?e=0:(wo=null,Ro=0,e=uo)}if(e!==0){if(e===2&&(c=fM(t),c!==0&&(s=c,e=UM(t,c))),e===1)throw r=ax,_m(t,0),of(t,s),Va(t,Us()),r;if(e===6)of(t,s);else{if(c=t.current.alternate,!(s&30)&&!Ete(c)&&(e=cS(t,s),e===2&&(d=fM(t),d!==0&&(s=d,e=UM(t,d))),e===1))throw r=ax,_m(t,0),of(t,s),Va(t,Us()),r;switch(t.finishedWork=c,t.finishedLanes=s,e){case 0:case 1:throw Error(hn(345));case 2:Jp(t,La,Ih);break;case 3:if(of(t,s),(s&130023424)===s&&(e=vO+500-Us(),10<e)){if(GE(t,0)!==0)break;if(c=t.suspendedLanes,(c&s)!==s){va(),t.pingedLanes|=t.suspendedLanes&c;break}t.timeoutHandle=bM(Jp.bind(null,t,La,Ih),e);break}Jp(t,La,Ih);break;case 4:if(of(t,s),(s&4194240)===s)break;for(e=t.eventTimes,c=-1;0<s;){var _=31-Fc(s);d=1<<_,_=e[_],_>c&&(c=_),s&=~d}if(s=c,s=Us()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*Tte(s/1960))-s,10<s){t.timeoutHandle=bM(Jp.bind(null,t,La,Ih),s);break}Jp(t,La,Ih);break;case 5:Jp(t,La,Ih);break;default:throw Error(hn(329))}}}return Va(t,Us()),t.callbackNode===r?x2.bind(null,t):null}function UM(t,e){var r=T1;return t.current.memoizedState.isDehydrated&&(_m(t,e).flags|=256),t=cS(t,e),t!==2&&(e=La,La=r,e!==null&&VM(e)),t}function VM(t){La===null?La=t:La.push.apply(La,t)}function Ete(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var s=0;s<r.length;s++){var c=r[s],d=c.getSnapshot;c=c.value;try{if(!Vc(d(),c))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function of(t,e){for(e&=~yO,e&=~xI,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Fc(e),s=1<<r;t[r]=-1,e&=~s}}function E6(t){if(ri&6)throw Error(hn(327));ry();var e=GE(t,0);if(!(e&1))return Va(t,Us()),null;var r=cS(t,e);if(t.tag!==0&&r===2){var s=fM(t);s!==0&&(e=s,r=UM(t,s))}if(r===1)throw r=ax,_m(t,0),of(t,e),Va(t,Us()),r;if(r===6)throw Error(hn(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Jp(t,La,Ih),Va(t,Us()),null}function xO(t,e){var r=ri;ri|=1;try{return t(e)}finally{ri=r,ri===0&&(wy=Us()+500,gI&&Gf())}}function km(t){df!==null&&df.tag===0&&!(ri&6)&&ry();var e=ri;ri|=1;var r=Hl.transition,s=Ti;try{if(Hl.transition=null,Ti=1,t)return t()}finally{Ti=s,Hl.transition=r,ri=e,!(ri&6)&&Gf()}}function bO(){sl=q_.current,Ji(q_)}function _m(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,ete(r)),Qs!==null)for(r=Qs.return;r!==null;){var s=r;switch(tO(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&KE();break;case 3:xy(),Ji(ja),Ji(Yo),uO();break;case 5:cO(s);break;case 4:xy();break;case 13:Ji(ys);break;case 19:Ji(ys);break;case 10:sO(s.type._context);break;case 22:case 23:bO()}r=r.return}if(wo=t,Qs=t=Sf(t.current,null),Ro=sl=e,uo=0,ax=null,yO=xI=Mm=0,La=T1=null,cm!==null){for(e=0;e<cm.length;e++)if(r=cm[e],s=r.interleaved,s!==null){r.interleaved=null;var c=s.next,d=r.pending;if(d!==null){var _=d.next;d.next=c,s.next=_}r.pending=s}cm=null}return t}function b2(t,e){do{var r=Qs;try{if(iO(),uE.current=sS,iS){for(var s=vs.memoizedState;s!==null;){var c=s.queue;c!==null&&(c.pending=null),s=s.next}iS=!1}if(Rm=0,xo=lo=vs=null,b1=!1,ix=0,_O.current=null,r===null||r.return===null){uo=1,ax=e,Qs=null;break}e:{var d=t,_=r.return,x=r,a=e;if(e=Ro,x.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var I=a,M=x,D=M.tag;if(!(M.mode&1)&&(D===0||D===11||D===15)){var L=M.alternate;L?(M.updateQueue=L.updateQueue,M.memoizedState=L.memoizedState,M.lanes=L.lanes):(M.updateQueue=null,M.memoizedState=null)}var G=h6(_);if(G!==null){G.flags&=-257,d6(G,_,x,d,e),G.mode&1&&u6(d,I,e),e=G,a=I;var Q=e.updateQueue;if(Q===null){var re=new Set;re.add(a),e.updateQueue=re}else Q.add(a);break e}else{if(!(e&1)){u6(d,I,e),wO();break e}a=Error(hn(426))}}else if(hs&&x.mode&1){var ee=h6(_);if(ee!==null){!(ee.flags&65536)&&(ee.flags|=256),d6(ee,_,x,d,e),nO(by(a,x));break e}}d=a=by(a,x),uo!==4&&(uo=2),T1===null?T1=[d]:T1.push(d),d=_;do{switch(d.tag){case 3:d.flags|=65536,e&=-e,d.lanes|=e;var U=i2(d,a,e);i6(d,U);break e;case 1:x=a;var H=d.type,Z=d.stateNode;if(!(d.flags&128)&&(typeof H.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(Tf===null||!Tf.has(Z)))){d.flags|=65536,e&=-e,d.lanes|=e;var de=s2(d,x,e);i6(d,de);break e}}d=d.return}while(d!==null)}E2(r)}catch(ve){e=ve,Qs===r&&r!==null&&(Qs=r=r.return);continue}break}while(!0)}function w2(){var t=oS.current;return oS.current=sS,t===null?sS:t}function wO(){(uo===0||uo===3||uo===2)&&(uo=4),wo===null||!(Mm&268435455)&&!(xI&268435455)||of(wo,Ro)}function cS(t,e){var r=ri;ri|=2;var s=w2();(wo!==t||Ro!==e)&&(Ih=null,_m(t,e));do try{Ste();break}catch(c){b2(t,c)}while(!0);if(iO(),ri=r,oS.current=s,Qs!==null)throw Error(hn(261));return wo=null,Ro=0,uo}function Ste(){for(;Qs!==null;)T2(Qs)}function Ite(){for(;Qs!==null&&!QJ();)T2(Qs)}function T2(t){var e=I2(t.alternate,t,sl);t.memoizedProps=t.pendingProps,e===null?E2(t):Qs=e,_O.current=null}function E2(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=vte(r,e),r!==null){r.flags&=32767,Qs=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{uo=6,Qs=null;return}}else if(r=yte(r,e,sl),r!==null){Qs=r;return}if(e=e.sibling,e!==null){Qs=e;return}Qs=e=t}while(e!==null);uo===0&&(uo=5)}function Jp(t,e,r){var s=Ti,c=Hl.transition;try{Hl.transition=null,Ti=1,Cte(t,e,r,s)}finally{Hl.transition=c,Ti=s}return null}function Cte(t,e,r,s){do ry();while(df!==null);if(ri&6)throw Error(hn(327));r=t.finishedWork;var c=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(hn(177));t.callbackNode=null,t.callbackPriority=0;var d=r.lanes|r.childLanes;if(aee(t,d),t===wo&&(Qs=wo=null,Ro=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||MT||(MT=!0,C2(qE,function(){return ry(),null})),d=(r.flags&15990)!==0,r.subtreeFlags&15990||d){d=Hl.transition,Hl.transition=null;var _=Ti;Ti=1;var x=ri;ri|=4,_O.current=null,bte(t,r),y2(r,t),Hee(vM),WE=!!yM,vM=yM=null,t.current=r,wte(r),YJ(),ri=x,Ti=_,Hl.transition=d}else t.current=r;if(MT&&(MT=!1,df=t,lS=c),d=t.pendingLanes,d===0&&(Tf=null),tee(r.stateNode),Va(t,Us()),e!==null)for(s=t.onRecoverableError,r=0;r<e.length;r++)c=e[r],s(c.value,{componentStack:c.stack,digest:c.digest});if(aS)throw aS=!1,t=BM,BM=null,t;return lS&1&&t.tag!==0&&ry(),d=t.pendingLanes,d&1?t===jM?E1++:(E1=0,jM=t):E1=0,Gf(),null}function ry(){if(df!==null){var t=i9(lS),e=Hl.transition,r=Ti;try{if(Hl.transition=null,Ti=16>t?16:t,df===null)var s=!1;else{if(t=df,df=null,lS=0,ri&6)throw Error(hn(331));var c=ri;for(ri|=4,Ln=t.current;Ln!==null;){var d=Ln,_=d.child;if(Ln.flags&16){var x=d.deletions;if(x!==null){for(var a=0;a<x.length;a++){var I=x[a];for(Ln=I;Ln!==null;){var M=Ln;switch(M.tag){case 0:case 11:case 15:w1(8,M,d)}var D=M.child;if(D!==null)D.return=M,Ln=D;else for(;Ln!==null;){M=Ln;var L=M.sibling,G=M.return;if(m2(M),M===I){Ln=null;break}if(L!==null){L.return=G,Ln=L;break}Ln=G}}}var Q=d.alternate;if(Q!==null){var re=Q.child;if(re!==null){Q.child=null;do{var ee=re.sibling;re.sibling=null,re=ee}while(re!==null)}}Ln=d}}if(d.subtreeFlags&2064&&_!==null)_.return=d,Ln=_;else e:for(;Ln!==null;){if(d=Ln,d.flags&2048)switch(d.tag){case 0:case 11:case 15:w1(9,d,d.return)}var U=d.sibling;if(U!==null){U.return=d.return,Ln=U;break e}Ln=d.return}}var H=t.current;for(Ln=H;Ln!==null;){_=Ln;var Z=_.child;if(_.subtreeFlags&2064&&Z!==null)Z.return=_,Ln=Z;else e:for(_=H;Ln!==null;){if(x=Ln,x.flags&2048)try{switch(x.tag){case 0:case 11:case 15:vI(9,x)}}catch(ve){ks(x,x.return,ve)}if(x===_){Ln=null;break e}var de=x.sibling;if(de!==null){de.return=x.return,Ln=de;break e}Ln=x.return}}if(ri=c,Gf(),Du&&typeof Du.onPostCommitFiberRoot=="function")try{Du.onPostCommitFiberRoot(hI,t)}catch{}s=!0}return s}finally{Ti=r,Hl.transition=e}}return!1}function S6(t,e,r){e=by(r,e),e=i2(t,e,1),t=wf(t,e,1),e=va(),t!==null&&(Vx(t,1,e),Va(t,e))}function ks(t,e,r){if(t.tag===3)S6(t,t,r);else for(;e!==null;){if(e.tag===3){S6(e,t,r);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Tf===null||!Tf.has(s))){t=by(r,t),t=s2(e,t,1),e=wf(e,t,1),t=va(),e!==null&&(Vx(e,1,t),Va(e,t));break}}e=e.return}}function Ate(t,e,r){var s=t.pingCache;s!==null&&s.delete(e),e=va(),t.pingedLanes|=t.suspendedLanes&r,wo===t&&(Ro&r)===r&&(uo===4||uo===3&&(Ro&130023424)===Ro&&500>Us()-vO?_m(t,0):yO|=r),Va(t,e)}function S2(t,e){e===0&&(t.mode&1?(e=bT,bT<<=1,!(bT&130023424)&&(bT=4194304)):e=1);var r=va();t=qh(t,e),t!==null&&(Vx(t,e,r),Va(t,r))}function Pte(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),S2(t,r)}function Rte(t,e){var r=0;switch(t.tag){case 13:var s=t.stateNode,c=t.memoizedState;c!==null&&(r=c.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(hn(314))}s!==null&&s.delete(e),S2(t,r)}var I2;I2=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||ja.current)Fa=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return Fa=!1,_te(t,e,r);Fa=!!(t.flags&131072)}else Fa=!1,hs&&e.flags&1048576&&R9(e,JE,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;dE(t,e),t=e.pendingProps;var c=_y(e,Yo.current);ny(e,r),c=dO(null,e,s,t,c,r);var d=fO();return e.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ua(s)?(d=!0,QE(e)):d=!1,e.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,aO(e),c.updater=yI,e.stateNode=c,c._reactInternals=e,AM(e,s,t,r),e=MM(null,e,s,!0,d,r)):(e.tag=0,hs&&d&&eO(e),ga(null,e,c,r),e=e.child),e;case 16:s=e.elementType;e:{switch(dE(t,e),t=e.pendingProps,c=s._init,s=c(s._payload),e.type=s,c=e.tag=kte(s),t=Rc(s,t),c){case 0:e=RM(null,e,s,t,r);break e;case 1:e=m6(null,e,s,t,r);break e;case 11:e=f6(null,e,s,t,r);break e;case 14:e=p6(null,e,s,Rc(s.type,t),r);break e}throw Error(hn(306,s,""))}return e;case 0:return s=e.type,c=e.pendingProps,c=e.elementType===s?c:Rc(s,c),RM(t,e,s,c,r);case 1:return s=e.type,c=e.pendingProps,c=e.elementType===s?c:Rc(s,c),m6(t,e,s,c,r);case 3:e:{if(c2(e),t===null)throw Error(hn(387));s=e.pendingProps,d=e.memoizedState,c=d.element,z9(t,e),nS(e,s,null,r);var _=e.memoizedState;if(s=_.element,d.isDehydrated)if(d={element:s,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},e.updateQueue.baseState=d,e.memoizedState=d,e.flags&256){c=by(Error(hn(423)),e),e=g6(t,e,s,r,c);break e}else if(s!==c){c=by(Error(hn(424)),e),e=g6(t,e,s,r,c);break e}else for(al=bf(e.stateNode.containerInfo.firstChild),fl=e,hs=!0,kc=null,r=D9(e,null,s,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(yy(),s===c){e=Gh(t,e,r);break e}ga(t,e,s,r)}e=e.child}return e;case 5:return N9(e),t===null&&SM(e),s=e.type,c=e.pendingProps,d=t!==null?t.memoizedProps:null,_=c.children,xM(s,c)?_=null:d!==null&&xM(s,d)&&(e.flags|=32),l2(t,e),ga(t,e,_,r),e.child;case 6:return t===null&&SM(e),null;case 13:return u2(t,e,r);case 4:return lO(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=vy(e,null,s,r):ga(t,e,s,r),e.child;case 11:return s=e.type,c=e.pendingProps,c=e.elementType===s?c:Rc(s,c),f6(t,e,s,c,r);case 7:return ga(t,e,e.pendingProps,r),e.child;case 8:return ga(t,e,e.pendingProps.children,r),e.child;case 12:return ga(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(s=e.type._context,c=e.pendingProps,d=e.memoizedProps,_=c.value,qi(eS,s._currentValue),s._currentValue=_,d!==null)if(Vc(d.value,_)){if(d.children===c.children&&!ja.current){e=Gh(t,e,r);break e}}else for(d=e.child,d!==null&&(d.return=e);d!==null;){var x=d.dependencies;if(x!==null){_=d.child;for(var a=x.firstContext;a!==null;){if(a.context===s){if(d.tag===1){a=Nh(-1,r&-r),a.tag=2;var I=d.updateQueue;if(I!==null){I=I.shared;var M=I.pending;M===null?a.next=a:(a.next=M.next,M.next=a),I.pending=a}}d.lanes|=r,a=d.alternate,a!==null&&(a.lanes|=r),IM(d.return,r,e),x.lanes|=r;break}a=a.next}}else if(d.tag===10)_=d.type===e.type?null:d.child;else if(d.tag===18){if(_=d.return,_===null)throw Error(hn(341));_.lanes|=r,x=_.alternate,x!==null&&(x.lanes|=r),IM(_,r,e),_=d.sibling}else _=d.child;if(_!==null)_.return=d;else for(_=d;_!==null;){if(_===e){_=null;break}if(d=_.sibling,d!==null){d.return=_.return,_=d;break}_=_.return}d=_}ga(t,e,c.children,r),e=e.child}return e;case 9:return c=e.type,s=e.pendingProps.children,ny(e,r),c=Xl(c),s=s(c),e.flags|=1,ga(t,e,s,r),e.child;case 14:return s=e.type,c=Rc(s,e.pendingProps),c=Rc(s.type,c),p6(t,e,s,c,r);case 15:return o2(t,e,e.type,e.pendingProps,r);case 17:return s=e.type,c=e.pendingProps,c=e.elementType===s?c:Rc(s,c),dE(t,e),e.tag=1,Ua(s)?(t=!0,QE(e)):t=!1,ny(e,r),r2(e,s,c),AM(e,s,c,r),MM(null,e,s,!0,t,r);case 19:return h2(t,e,r);case 22:return a2(t,e,r)}throw Error(hn(156,e.tag))};function C2(t,e){return e9(t,e)}function Mte(t,e,r,s){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wl(t,e,r,s){return new Mte(t,e,r,s)}function TO(t){return t=t.prototype,!(!t||!t.isReactComponent)}function kte(t){if(typeof t=="function")return TO(t)?1:0;if(t!=null){if(t=t.$$typeof,t===V4)return 11;if(t===$4)return 14}return 2}function Sf(t,e){var r=t.alternate;return r===null?(r=Wl(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function mE(t,e,r,s,c,d){var _=2;if(s=t,typeof t=="function")TO(t)&&(_=1);else if(typeof t=="string")_=5;else e:switch(t){case D_:return ym(r.children,c,d,e);case U4:_=8,c|=8;break;case YR:return t=Wl(12,r,e,c|2),t.elementType=YR,t.lanes=d,t;case JR:return t=Wl(13,r,e,c),t.elementType=JR,t.lanes=d,t;case eM:return t=Wl(19,r,e,c),t.elementType=eM,t.lanes=d,t;case N8:return bI(r,c,d,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case L8:_=10;break e;case z8:_=9;break e;case V4:_=11;break e;case $4:_=14;break e;case nf:_=16,s=null;break e}throw Error(hn(130,t==null?t:typeof t,""))}return e=Wl(_,r,e,c),e.elementType=t,e.type=s,e.lanes=d,e}function ym(t,e,r,s){return t=Wl(7,t,s,e),t.lanes=r,t}function bI(t,e,r,s){return t=Wl(22,t,s,e),t.elementType=N8,t.lanes=r,t.stateNode={isHidden:!1},t}function Q3(t,e,r){return t=Wl(6,t,null,e),t.lanes=r,t}function Y3(t,e,r){return e=Wl(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Ote(t,e,r,s,c){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=k3(0),this.expirationTimes=k3(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=k3(0),this.identifierPrefix=s,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function EO(t,e,r,s,c,d,_,x,a){return t=new Ote(t,e,r,x,a),e===1?(e=1,d===!0&&(e|=8)):e=0,d=Wl(3,null,null,e),t.current=d,d.stateNode=t,d.memoizedState={element:s,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},aO(d),t}function Dte(t,e,r){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:O_,key:s==null?null:""+s,children:t,containerInfo:e,implementation:r}}function A2(t){if(!t)return Of;t=t._reactInternals;e:{if(Zm(t)!==t||t.tag!==1)throw Error(hn(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ua(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(hn(171))}if(t.tag===1){var r=t.type;if(Ua(r))return A9(t,r,e)}return e}function P2(t,e,r,s,c,d,_,x,a){return t=EO(r,s,!0,t,c,d,_,x,a),t.context=A2(null),r=t.current,s=va(),c=Ef(r),d=Nh(s,c),d.callback=e??null,wf(r,d,c),t.current.lanes=c,Vx(t,c,s),Va(t,s),t}function wI(t,e,r,s){var c=e.current,d=va(),_=Ef(c);return r=A2(r),e.context===null?e.context=r:e.pendingContext=r,e=Nh(d,_),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=wf(c,e,_),t!==null&&(Bc(t,c,_,d),cE(t,c,_)),_}function uS(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function I6(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function SO(t,e){I6(t,e),(t=t.alternate)&&I6(t,e)}function Lte(){return null}var R2=typeof reportError=="function"?reportError:function(t){console.error(t)};function IO(t){this._internalRoot=t}TI.prototype.render=IO.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(hn(409));wI(t,e,null,null)};TI.prototype.unmount=IO.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;km(function(){wI(null,t,null,null)}),e[$h]=null}};function TI(t){this._internalRoot=t}TI.prototype.unstable_scheduleHydration=function(t){if(t){var e=a9();t={blockedOn:null,target:t,priority:e};for(var r=0;r<sf.length&&e!==0&&e<sf[r].priority;r++);sf.splice(r,0,t),r===0&&c9(t)}};function CO(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function EI(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function C6(){}function zte(t,e,r,s,c){if(c){if(typeof s=="function"){var d=s;s=function(){var I=uS(_);d.call(I)}}var _=P2(e,s,t,0,null,!1,!1,"",C6);return t._reactRootContainer=_,t[$h]=_.current,J1(t.nodeType===8?t.parentNode:t),km(),_}for(;c=t.lastChild;)t.removeChild(c);if(typeof s=="function"){var x=s;s=function(){var I=uS(a);x.call(I)}}var a=EO(t,0,!1,null,null,!1,!1,"",C6);return t._reactRootContainer=a,t[$h]=a.current,J1(t.nodeType===8?t.parentNode:t),km(function(){wI(e,a,r,s)}),a}function SI(t,e,r,s,c){var d=r._reactRootContainer;if(d){var _=d;if(typeof c=="function"){var x=c;c=function(){var a=uS(_);x.call(a)}}wI(e,_,t,c)}else _=zte(r,e,t,c,s);return uS(_)}s9=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=e1(e.pendingLanes);r!==0&&(W4(e,r|1),Va(e,Us()),!(ri&6)&&(wy=Us()+500,Gf()))}break;case 13:km(function(){var s=qh(t,1);if(s!==null){var c=va();Bc(s,t,1,c)}}),SO(t,1)}};H4=function(t){if(t.tag===13){var e=qh(t,134217728);if(e!==null){var r=va();Bc(e,t,134217728,r)}SO(t,134217728)}};o9=function(t){if(t.tag===13){var e=Ef(t),r=qh(t,e);if(r!==null){var s=va();Bc(r,t,e,s)}SO(t,e)}};a9=function(){return Ti};l9=function(t,e){var r=Ti;try{return Ti=t,e()}finally{Ti=r}};uM=function(t,e,r){switch(e){case"input":if(rM(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var s=r[e];if(s!==t&&s.form===t.form){var c=mI(s);if(!c)throw Error(hn(90));B8(s),rM(s,c)}}}break;case"textarea":U8(t,r);break;case"select":e=r.value,e!=null&&Y_(t,!!r.multiple,e,!1)}};Z8=xO;X8=km;var Nte={usingClientEntryPoint:!1,Events:[qx,F_,mI,W8,H8,xO]},Bv={findFiberByHostInstance:lm,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Fte={bundleType:Bv.bundleType,version:Bv.version,rendererPackageName:Bv.rendererPackageName,rendererConfig:Bv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:td.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Y8(t),t===null?null:t.stateNode},findFiberByHostInstance:Bv.findFiberByHostInstance||Lte,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kT=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kT.isDisabled&&kT.supportsFiber)try{hI=kT.inject(Fte),Du=kT}catch{}}vl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Nte;vl.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!CO(e))throw Error(hn(200));return Dte(t,e,null,r)};vl.createRoot=function(t,e){if(!CO(t))throw Error(hn(299));var r=!1,s="",c=R2;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(c=e.onRecoverableError)),e=EO(t,1,!1,null,null,r,!1,s,c),t[$h]=e.current,J1(t.nodeType===8?t.parentNode:t),new IO(e)};vl.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(hn(188)):(t=Object.keys(t).join(","),Error(hn(268,t)));return t=Y8(e),t=t===null?null:t.stateNode,t};vl.flushSync=function(t){return km(t)};vl.hydrate=function(t,e,r){if(!EI(e))throw Error(hn(200));return SI(null,t,e,!0,r)};vl.hydrateRoot=function(t,e,r){if(!CO(t))throw Error(hn(405));var s=r!=null&&r.hydratedSources||null,c=!1,d="",_=R2;if(r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onRecoverableError!==void 0&&(_=r.onRecoverableError)),e=P2(e,null,t,1,r??null,c,!1,d,_),t[$h]=e.current,J1(t),s)for(t=0;t<s.length;t++)r=s[t],c=r._getVersion,c=c(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,c]:e.mutableSourceEagerHydrationData.push(r,c);return new TI(e)};vl.render=function(t,e,r){if(!EI(e))throw Error(hn(200));return SI(null,t,e,!1,r)};vl.unmountComponentAtNode=function(t){if(!EI(t))throw Error(hn(40));return t._reactRootContainer?(km(function(){SI(null,null,t,!1,function(){t._reactRootContainer=null,t[$h]=null})}),!0):!1};vl.unstable_batchedUpdates=xO;vl.unstable_renderSubtreeIntoContainer=function(t,e,r,s){if(!EI(r))throw Error(hn(200));if(t==null||t._reactInternals===void 0)throw Error(hn(38));return SI(t,e,r,!1,s)};vl.version="18.3.1-next-f1338f8080-20240426";function M2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(M2)}catch(t){console.error(t)}}M2(),M8.exports=vl;var II=M8.exports;const OT=Gy(II);var k2,A6=II;k2=A6.createRoot,A6.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function lx(){return lx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},lx.apply(this,arguments)}var ff;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(ff||(ff={}));const P6="popstate";function Bte(t){t===void 0&&(t={});function e(s,c){let{pathname:d,search:_,hash:x}=s.location;return $M("",{pathname:d,search:_,hash:x},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function r(s,c){return typeof c=="string"?c:hS(c)}return Ute(e,r,null,t)}function Os(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function O2(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function jte(){return Math.random().toString(36).substr(2,8)}function R6(t,e){return{usr:t.state,key:t.key,idx:e}}function $M(t,e,r,s){return r===void 0&&(r=null),lx({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Xy(e):e,{state:r,key:e&&e.key||s||jte()})}function hS(t){let{pathname:e="/",search:r="",hash:s=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),s&&s!=="#"&&(e+=s.charAt(0)==="#"?s:"#"+s),e}function Xy(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let s=t.indexOf("?");s>=0&&(e.search=t.substr(s),t=t.substr(0,s)),t&&(e.pathname=t)}return e}function Ute(t,e,r,s){s===void 0&&(s={});let{window:c=document.defaultView,v5Compat:d=!1}=s,_=c.history,x=ff.Pop,a=null,I=M();I==null&&(I=0,_.replaceState(lx({},_.state,{idx:I}),""));function M(){return(_.state||{idx:null}).idx}function D(){x=ff.Pop;let ee=M(),U=ee==null?null:ee-I;I=ee,a&&a({action:x,location:re.location,delta:U})}function L(ee,U){x=ff.Push;let H=$M(re.location,ee,U);I=M()+1;let Z=R6(H,I),de=re.createHref(H);try{_.pushState(Z,"",de)}catch(ve){if(ve instanceof DOMException&&ve.name==="DataCloneError")throw ve;c.location.assign(de)}d&&a&&a({action:x,location:re.location,delta:1})}function G(ee,U){x=ff.Replace;let H=$M(re.location,ee,U);I=M();let Z=R6(H,I),de=re.createHref(H);_.replaceState(Z,"",de),d&&a&&a({action:x,location:re.location,delta:0})}function Q(ee){let U=c.location.origin!=="null"?c.location.origin:c.location.href,H=typeof ee=="string"?ee:hS(ee);return H=H.replace(/ $/,"%20"),Os(U,"No window.location.(origin|href) available to create URL for href: "+H),new URL(H,U)}let re={get action(){return x},get location(){return t(c,_)},listen(ee){if(a)throw new Error("A history only accepts one active listener");return c.addEventListener(P6,D),a=ee,()=>{c.removeEventListener(P6,D),a=null}},createHref(ee){return e(c,ee)},createURL:Q,encodeLocation(ee){let U=Q(ee);return{pathname:U.pathname,search:U.search,hash:U.hash}},push:L,replace:G,go(ee){return _.go(ee)}};return re}var M6;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(M6||(M6={}));function Vte(t,e,r){return r===void 0&&(r="/"),$te(t,e,r,!1)}function $te(t,e,r,s){let c=typeof e=="string"?Xy(e):e,d=Ty(c.pathname||"/",r);if(d==null)return null;let _=D2(t);qte(_);let x=null;for(let a=0;x==null&&a<_.length;++a){let I=tne(d);x=Jte(_[a],I,s)}return x}function D2(t,e,r,s){e===void 0&&(e=[]),r===void 0&&(r=[]),s===void 0&&(s="");let c=(d,_,x)=>{let a={relativePath:x===void 0?d.path||"":x,caseSensitive:d.caseSensitive===!0,childrenIndex:_,route:d};a.relativePath.startsWith("/")&&(Os(a.relativePath.startsWith(s),'Absolute route path "'+a.relativePath+'" nested under path '+('"'+s+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),a.relativePath=a.relativePath.slice(s.length));let I=If([s,a.relativePath]),M=r.concat(a);d.children&&d.children.length>0&&(Os(d.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+I+'".')),D2(d.children,e,M,I)),!(d.path==null&&!d.index)&&e.push({path:I,score:Qte(I,d.index),routesMeta:M})};return t.forEach((d,_)=>{var x;if(d.path===""||!((x=d.path)!=null&&x.includes("?")))c(d,_);else for(let a of L2(d.path))c(d,_,a)}),e}function L2(t){let e=t.split("/");if(e.length===0)return[];let[r,...s]=e,c=r.endsWith("?"),d=r.replace(/\?$/,"");if(s.length===0)return c?[d,""]:[d];let _=L2(s.join("/")),x=[];return x.push(..._.map(a=>a===""?d:[d,a].join("/"))),c&&x.push(..._),x.map(a=>t.startsWith("/")&&a===""?"/":a)}function qte(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:Yte(e.routesMeta.map(s=>s.childrenIndex),r.routesMeta.map(s=>s.childrenIndex)))}const Gte=/^:[\w-]+$/,Wte=3,Hte=2,Zte=1,Xte=10,Kte=-2,k6=t=>t==="*";function Qte(t,e){let r=t.split("/"),s=r.length;return r.some(k6)&&(s+=Kte),e&&(s+=Hte),r.filter(c=>!k6(c)).reduce((c,d)=>c+(Gte.test(d)?Wte:d===""?Zte:Xte),s)}function Yte(t,e){return t.length===e.length&&t.slice(0,-1).every((s,c)=>s===e[c])?t[t.length-1]-e[e.length-1]:0}function Jte(t,e,r){let{routesMeta:s}=t,c={},d="/",_=[];for(let x=0;x<s.length;++x){let a=s[x],I=x===s.length-1,M=d==="/"?e:e.slice(d.length)||"/",D=dS({path:a.relativePath,caseSensitive:a.caseSensitive,end:I},M),L=a.route;if(!D&&I&&r&&!s[s.length-1].route.index&&(D=dS({path:a.relativePath,caseSensitive:a.caseSensitive,end:!1},M)),!D)return null;Object.assign(c,D.params),_.push({params:c,pathname:If([d,D.pathname]),pathnameBase:sne(If([d,D.pathnameBase])),route:L}),D.pathnameBase!=="/"&&(d=If([d,D.pathnameBase]))}return _}function dS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,s]=ene(t.path,t.caseSensitive,t.end),c=e.match(r);if(!c)return null;let d=c[0],_=d.replace(/(.)\/+$/,"$1"),x=c.slice(1);return{params:s.reduce((I,M,D)=>{let{paramName:L,isOptional:G}=M;if(L==="*"){let re=x[D]||"";_=d.slice(0,d.length-re.length).replace(/(.)\/+$/,"$1")}const Q=x[D];return G&&!Q?I[L]=void 0:I[L]=(Q||"").replace(/%2F/g,"/"),I},{}),pathname:d,pathnameBase:_,pattern:t}}function ene(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),O2(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let s=[],c="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(_,x,a)=>(s.push({paramName:x,isOptional:a!=null}),a?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(s.push({paramName:"*"}),c+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":t!==""&&t!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,e?void 0:"i"),s]}function tne(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return O2(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function Ty(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,s=t.charAt(r);return s&&s!=="/"?null:t.slice(r)||"/"}function nne(t,e){e===void 0&&(e="/");let{pathname:r,search:s="",hash:c=""}=typeof t=="string"?Xy(t):t;return{pathname:r?r.startsWith("/")?r:rne(r,e):e,search:one(s),hash:ane(c)}}function rne(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(c=>{c===".."?r.length>1&&r.pop():c!=="."&&r.push(c)}),r.length>1?r.join("/"):"/"}function J3(t,e,r,s){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(s)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ine(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function z2(t,e){let r=ine(t);return e?r.map((s,c)=>c===r.length-1?s.pathname:s.pathnameBase):r.map(s=>s.pathnameBase)}function N2(t,e,r,s){s===void 0&&(s=!1);let c;typeof t=="string"?c=Xy(t):(c=lx({},t),Os(!c.pathname||!c.pathname.includes("?"),J3("?","pathname","search",c)),Os(!c.pathname||!c.pathname.includes("#"),J3("#","pathname","hash",c)),Os(!c.search||!c.search.includes("#"),J3("#","search","hash",c)));let d=t===""||c.pathname==="",_=d?"/":c.pathname,x;if(_==null)x=r;else{let D=e.length-1;if(!s&&_.startsWith("..")){let L=_.split("/");for(;L[0]==="..";)L.shift(),D-=1;c.pathname=L.join("/")}x=D>=0?e[D]:"/"}let a=nne(c,x),I=_&&_!=="/"&&_.endsWith("/"),M=(d||_===".")&&r.endsWith("/");return!a.pathname.endsWith("/")&&(I||M)&&(a.pathname+="/"),a}const If=t=>t.join("/").replace(/\/\/+/g,"/"),sne=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),one=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,ane=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function lne(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const F2=["post","put","patch","delete"];new Set(F2);const cne=["get",...F2];new Set(cne);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function cx(){return cx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},cx.apply(this,arguments)}const CI=Y.createContext(null),B2=Y.createContext(null),Wf=Y.createContext(null),AI=Y.createContext(null),Xm=Y.createContext({outlet:null,matches:[],isDataRoute:!1}),j2=Y.createContext(null);function une(t,e){let{relative:r}=e===void 0?{}:e;Wx()||Os(!1);let{basename:s,navigator:c}=Y.useContext(Wf),{hash:d,pathname:_,search:x}=PI(t,{relative:r}),a=_;return s!=="/"&&(a=_==="/"?s:If([s,_])),c.createHref({pathname:a,search:x,hash:d})}function Wx(){return Y.useContext(AI)!=null}function Hx(){return Wx()||Os(!1),Y.useContext(AI).location}function U2(t){Y.useContext(Wf).static||Y.useLayoutEffect(t)}function Km(){let{isDataRoute:t}=Y.useContext(Xm);return t?Tne():hne()}function hne(){Wx()||Os(!1);let t=Y.useContext(CI),{basename:e,future:r,navigator:s}=Y.useContext(Wf),{matches:c}=Y.useContext(Xm),{pathname:d}=Hx(),_=JSON.stringify(z2(c,r.v7_relativeSplatPath)),x=Y.useRef(!1);return U2(()=>{x.current=!0}),Y.useCallback(function(I,M){if(M===void 0&&(M={}),!x.current)return;if(typeof I=="number"){s.go(I);return}let D=N2(I,JSON.parse(_),d,M.relative==="path");t==null&&e!=="/"&&(D.pathname=D.pathname==="/"?e:If([e,D.pathname])),(M.replace?s.replace:s.push)(D,M.state,M)},[e,s,_,d,t])}function PI(t,e){let{relative:r}=e===void 0?{}:e,{future:s}=Y.useContext(Wf),{matches:c}=Y.useContext(Xm),{pathname:d}=Hx(),_=JSON.stringify(z2(c,s.v7_relativeSplatPath));return Y.useMemo(()=>N2(t,JSON.parse(_),d,r==="path"),[t,_,d,r])}function dne(t,e){return fne(t,e)}function fne(t,e,r,s){Wx()||Os(!1);let{navigator:c}=Y.useContext(Wf),{matches:d}=Y.useContext(Xm),_=d[d.length-1],x=_?_.params:{};_&&_.pathname;let a=_?_.pathnameBase:"/";_&&_.route;let I=Hx(),M;if(e){var D;let ee=typeof e=="string"?Xy(e):e;a==="/"||(D=ee.pathname)!=null&&D.startsWith(a)||Os(!1),M=ee}else M=I;let L=M.pathname||"/",G=L;if(a!=="/"){let ee=a.replace(/^\//,"").split("/");G="/"+L.replace(/^\//,"").split("/").slice(ee.length).join("/")}let Q=Vte(t,{pathname:G}),re=yne(Q&&Q.map(ee=>Object.assign({},ee,{params:Object.assign({},x,ee.params),pathname:If([a,c.encodeLocation?c.encodeLocation(ee.pathname).pathname:ee.pathname]),pathnameBase:ee.pathnameBase==="/"?a:If([a,c.encodeLocation?c.encodeLocation(ee.pathnameBase).pathname:ee.pathnameBase])})),d,r,s);return e&&re?Y.createElement(AI.Provider,{value:{location:cx({pathname:"/",search:"",hash:"",state:null,key:"default"},M),navigationType:ff.Pop}},re):re}function pne(){let t=wne(),e=lne(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Y.createElement(Y.Fragment,null,Y.createElement("h2",null,"Unexpected Application Error!"),Y.createElement("h3",{style:{fontStyle:"italic"}},e),r?Y.createElement("pre",{style:c},r):null,null)}const mne=Y.createElement(pne,null);class gne extends Y.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error!==void 0?Y.createElement(Xm.Provider,{value:this.props.routeContext},Y.createElement(j2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function _ne(t){let{routeContext:e,match:r,children:s}=t,c=Y.useContext(CI);return c&&c.static&&c.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=r.route.id),Y.createElement(Xm.Provider,{value:e},s)}function yne(t,e,r,s){var c;if(e===void 0&&(e=[]),r===void 0&&(r=null),s===void 0&&(s=null),t==null){var d;if(!r)return null;if(r.errors)t=r.matches;else if((d=s)!=null&&d.v7_partialHydration&&e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let _=t,x=(c=r)==null?void 0:c.errors;if(x!=null){let M=_.findIndex(D=>D.route.id&&(x==null?void 0:x[D.route.id])!==void 0);M>=0||Os(!1),_=_.slice(0,Math.min(_.length,M+1))}let a=!1,I=-1;if(r&&s&&s.v7_partialHydration)for(let M=0;M<_.length;M++){let D=_[M];if((D.route.HydrateFallback||D.route.hydrateFallbackElement)&&(I=M),D.route.id){let{loaderData:L,errors:G}=r,Q=D.route.loader&&L[D.route.id]===void 0&&(!G||G[D.route.id]===void 0);if(D.route.lazy||Q){a=!0,I>=0?_=_.slice(0,I+1):_=[_[0]];break}}}return _.reduceRight((M,D,L)=>{let G,Q=!1,re=null,ee=null;r&&(G=x&&D.route.id?x[D.route.id]:void 0,re=D.route.errorElement||mne,a&&(I<0&&L===0?(Q=!0,ee=null):I===L&&(Q=!0,ee=D.route.hydrateFallbackElement||null)));let U=e.concat(_.slice(0,L+1)),H=()=>{let Z;return G?Z=re:Q?Z=ee:D.route.Component?Z=Y.createElement(D.route.Component,null):D.route.element?Z=D.route.element:Z=M,Y.createElement(_ne,{match:D,routeContext:{outlet:M,matches:U,isDataRoute:r!=null},children:Z})};return r&&(D.route.ErrorBoundary||D.route.errorElement||L===0)?Y.createElement(gne,{location:r.location,revalidation:r.revalidation,component:re,error:G,children:H(),routeContext:{outlet:null,matches:U,isDataRoute:!0}}):H()},null)}var V2=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(V2||{}),fS=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(fS||{});function vne(t){let e=Y.useContext(CI);return e||Os(!1),e}function xne(t){let e=Y.useContext(B2);return e||Os(!1),e}function bne(t){let e=Y.useContext(Xm);return e||Os(!1),e}function $2(t){let e=bne(),r=e.matches[e.matches.length-1];return r.route.id||Os(!1),r.route.id}function wne(){var t;let e=Y.useContext(j2),r=xne(fS.UseRouteError),s=$2(fS.UseRouteError);return e!==void 0?e:(t=r.errors)==null?void 0:t[s]}function Tne(){let{router:t}=vne(V2.UseNavigateStable),e=$2(fS.UseNavigateStable),r=Y.useRef(!1);return U2(()=>{r.current=!0}),Y.useCallback(function(c,d){d===void 0&&(d={}),r.current&&(typeof c=="number"?t.navigate(c):t.navigate(c,cx({fromRouteId:e},d)))},[t,e])}function Dc(t){Os(!1)}function Ene(t){let{basename:e="/",children:r=null,location:s,navigationType:c=ff.Pop,navigator:d,static:_=!1,future:x}=t;Wx()&&Os(!1);let a=e.replace(/^\/*/,"/"),I=Y.useMemo(()=>({basename:a,navigator:d,static:_,future:cx({v7_relativeSplatPath:!1},x)}),[a,x,d,_]);typeof s=="string"&&(s=Xy(s));let{pathname:M="/",search:D="",hash:L="",state:G=null,key:Q="default"}=s,re=Y.useMemo(()=>{let ee=Ty(M,a);return ee==null?null:{location:{pathname:ee,search:D,hash:L,state:G,key:Q},navigationType:c}},[a,M,D,L,G,Q,c]);return re==null?null:Y.createElement(Wf.Provider,{value:I},Y.createElement(AI.Provider,{children:r,value:re}))}function q2(t){let{children:e,location:r}=t;return dne(qM(e),r)}new Promise(()=>{});function qM(t,e){e===void 0&&(e=[]);let r=[];return Y.Children.forEach(t,(s,c)=>{if(!Y.isValidElement(s))return;let d=[...e,c];if(s.type===Y.Fragment){r.push.apply(r,qM(s.props.children,d));return}s.type!==Dc&&Os(!1),!s.props.index||!s.props.children||Os(!1);let _={id:s.props.id||d.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,loader:s.props.loader,action:s.props.action,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(_.children=qM(s.props.children,d)),r.push(_)}),r}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pS(){return pS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},pS.apply(this,arguments)}function G2(t,e){if(t==null)return{};var r={},s=Object.keys(t),c,d;for(d=0;d<s.length;d++)c=s[d],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}function Sne(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Ine(t,e){return t.button===0&&(!e||e==="_self")&&!Sne(t)}const Cne=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],Ane=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],Pne="6";try{window.__reactRouterVersion=Pne}catch{}const Rne=Y.createContext({isTransitioning:!1}),Mne="startTransition",O6=jE[Mne];function kne(t){let{basename:e,children:r,future:s,window:c}=t,d=Y.useRef();d.current==null&&(d.current=Bte({window:c,v5Compat:!0}));let _=d.current,[x,a]=Y.useState({action:_.action,location:_.location}),{v7_startTransition:I}=s||{},M=Y.useCallback(D=>{I&&O6?O6(()=>a(D)):a(D)},[a,I]);return Y.useLayoutEffect(()=>_.listen(M),[_,M]),Y.createElement(Ene,{basename:e,children:r,location:x.location,navigationType:x.action,navigator:_,future:s})}const One=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Dne=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,RI=Y.forwardRef(function(e,r){let{onClick:s,relative:c,reloadDocument:d,replace:_,state:x,target:a,to:I,preventScrollReset:M,unstable_viewTransition:D}=e,L=G2(e,Cne),{basename:G}=Y.useContext(Wf),Q,re=!1;if(typeof I=="string"&&Dne.test(I)&&(Q=I,One))try{let Z=new URL(window.location.href),de=I.startsWith("//")?new URL(Z.protocol+I):new URL(I),ve=Ty(de.pathname,G);de.origin===Z.origin&&ve!=null?I=ve+de.search+de.hash:re=!0}catch{}let ee=une(I,{relative:c}),U=Nne(I,{replace:_,state:x,target:a,preventScrollReset:M,relative:c,unstable_viewTransition:D});function H(Z){s&&s(Z),Z.defaultPrevented||U(Z)}return Y.createElement("a",pS({},L,{href:Q||ee,onClick:re||d?s:H,ref:r,target:a}))}),Lne=Y.forwardRef(function(e,r){let{"aria-current":s="page",caseSensitive:c=!1,className:d="",end:_=!1,style:x,to:a,unstable_viewTransition:I,children:M}=e,D=G2(e,Ane),L=PI(a,{relative:D.relative}),G=Hx(),Q=Y.useContext(B2),{navigator:re,basename:ee}=Y.useContext(Wf),U=Q!=null&&Fne(L)&&I===!0,H=re.encodeLocation?re.encodeLocation(L).pathname:L.pathname,Z=G.pathname,de=Q&&Q.navigation&&Q.navigation.location?Q.navigation.location.pathname:null;c||(Z=Z.toLowerCase(),de=de?de.toLowerCase():null,H=H.toLowerCase()),de&&ee&&(de=Ty(de,ee)||de);const ve=H!=="/"&&H.endsWith("/")?H.length-1:H.length;let Ee=Z===H||!_&&Z.startsWith(H)&&Z.charAt(ve)==="/",ie=de!=null&&(de===H||!_&&de.startsWith(H)&&de.charAt(H.length)==="/"),ue={isActive:Ee,isPending:ie,isTransitioning:U},K=Ee?s:void 0,ge;typeof d=="function"?ge=d(ue):ge=[d,Ee?"active":null,ie?"pending":null,U?"transitioning":null].filter(Boolean).join(" ");let _e=typeof x=="function"?x(ue):x;return Y.createElement(RI,pS({},D,{"aria-current":K,className:ge,ref:r,style:_e,to:a,unstable_viewTransition:I}),typeof M=="function"?M(ue):M)});var GM;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(GM||(GM={}));var D6;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(D6||(D6={}));function zne(t){let e=Y.useContext(CI);return e||Os(!1),e}function Nne(t,e){let{target:r,replace:s,state:c,preventScrollReset:d,relative:_,unstable_viewTransition:x}=e===void 0?{}:e,a=Km(),I=Hx(),M=PI(t,{relative:_});return Y.useCallback(D=>{if(Ine(D,r)){D.preventDefault();let L=s!==void 0?s:hS(I)===hS(M);a(t,{replace:L,state:c,preventScrollReset:d,relative:_,unstable_viewTransition:x})}},[I,a,M,s,c,r,t,d,_,x])}function Fne(t,e){e===void 0&&(e={});let r=Y.useContext(Rne);r==null&&Os(!1);let{basename:s}=zne(GM.useViewTransitionState),c=PI(t,{relative:e.relative});if(!r.isTransitioning)return!1;let d=Ty(r.currentLocation.pathname,s)||r.currentLocation.pathname,_=Ty(r.nextLocation.pathname,s)||r.nextLocation.pathname;return dS(c.pathname,_)!=null||dS(c.pathname,d)!=null}var Bne=function(e){return jne(e)&&!Une(e)};function jne(t){return!!t&&typeof t=="object"}function Une(t){var e=Object.prototype.toString.call(t);return e==="[object RegExp]"||e==="[object Date]"||qne(t)}var Vne=typeof Symbol=="function"&&Symbol.for,$ne=Vne?Symbol.for("react.element"):60103;function qne(t){return t.$$typeof===$ne}function Gne(t){return Array.isArray(t)?[]:{}}function mS(t,e){return e.clone!==!1&&e.isMergeableObject(t)?ux(Gne(t),t,e):t}function Wne(t,e,r){return t.concat(e).map(function(s){return mS(s,r)})}function Hne(t,e,r){var s={};return r.isMergeableObject(t)&&Object.keys(t).forEach(function(c){s[c]=mS(t[c],r)}),Object.keys(e).forEach(function(c){!r.isMergeableObject(e[c])||!t[c]?s[c]=mS(e[c],r):s[c]=ux(t[c],e[c],r)}),s}function ux(t,e,r){r=r||{},r.arrayMerge=r.arrayMerge||Wne,r.isMergeableObject=r.isMergeableObject||Bne;var s=Array.isArray(e),c=Array.isArray(t),d=s===c;return d?s?r.arrayMerge(t,e,r):Hne(t,e,r):mS(e,r)}ux.all=function(e,r){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(s,c){return ux(s,c,r)},{})};var WM=ux,W2=typeof global=="object"&&global&&global.Object===Object&&global,Zne=typeof self=="object"&&self&&self.Object===Object&&self,Gu=W2||Zne||Function("return this")(),Df=Gu.Symbol,H2=Object.prototype,Xne=H2.hasOwnProperty,Kne=H2.toString,jv=Df?Df.toStringTag:void 0;function Qne(t){var e=Xne.call(t,jv),r=t[jv];try{t[jv]=void 0;var s=!0}catch{}var c=Kne.call(t);return s&&(e?t[jv]=r:delete t[jv]),c}var Yne=Object.prototype,Jne=Yne.toString;function ere(t){return Jne.call(t)}var tre="[object Null]",nre="[object Undefined]",L6=Df?Df.toStringTag:void 0;function Qm(t){return t==null?t===void 0?nre:tre:L6&&L6 in Object(t)?Qne(t):ere(t)}function Z2(t,e){return function(r){return t(e(r))}}var AO=Z2(Object.getPrototypeOf,Object);function Ym(t){return t!=null&&typeof t=="object"}var rre="[object Object]",ire=Function.prototype,sre=Object.prototype,X2=ire.toString,ore=sre.hasOwnProperty,are=X2.call(Object);function z6(t){if(!Ym(t)||Qm(t)!=rre)return!1;var e=AO(t);if(e===null)return!0;var r=ore.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&X2.call(r)==are}function lre(){this.__data__=[],this.size=0}function K2(t,e){return t===e||t!==t&&e!==e}function MI(t,e){for(var r=t.length;r--;)if(K2(t[r][0],e))return r;return-1}var cre=Array.prototype,ure=cre.splice;function hre(t){var e=this.__data__,r=MI(e,t);if(r<0)return!1;var s=e.length-1;return r==s?e.pop():ure.call(e,r,1),--this.size,!0}function dre(t){var e=this.__data__,r=MI(e,t);return r<0?void 0:e[r][1]}function fre(t){return MI(this.__data__,t)>-1}function pre(t,e){var r=this.__data__,s=MI(r,t);return s<0?(++this.size,r.push([t,e])):r[s][1]=e,this}function nd(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}nd.prototype.clear=lre;nd.prototype.delete=hre;nd.prototype.get=dre;nd.prototype.has=fre;nd.prototype.set=pre;function mre(){this.__data__=new nd,this.size=0}function gre(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function _re(t){return this.__data__.get(t)}function yre(t){return this.__data__.has(t)}function Zx(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var vre="[object AsyncFunction]",xre="[object Function]",bre="[object GeneratorFunction]",wre="[object Proxy]";function Q2(t){if(!Zx(t))return!1;var e=Qm(t);return e==xre||e==bre||e==vre||e==wre}var eR=Gu["__core-js_shared__"],N6=function(){var t=/[^.]+$/.exec(eR&&eR.keys&&eR.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Tre(t){return!!N6&&N6 in t}var Ere=Function.prototype,Sre=Ere.toString;function Jm(t){if(t!=null){try{return Sre.call(t)}catch{}try{return t+""}catch{}}return""}var Ire=/[\\^$.*+?()[\]{}|]/g,Cre=/^\[object .+?Constructor\]$/,Are=Function.prototype,Pre=Object.prototype,Rre=Are.toString,Mre=Pre.hasOwnProperty,kre=RegExp("^"+Rre.call(Mre).replace(Ire,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ore(t){if(!Zx(t)||Tre(t))return!1;var e=Q2(t)?kre:Cre;return e.test(Jm(t))}function Dre(t,e){return t==null?void 0:t[e]}function eg(t,e){var r=Dre(t,e);return Ore(r)?r:void 0}var hx=eg(Gu,"Map"),dx=eg(Object,"create");function Lre(){this.__data__=dx?dx(null):{},this.size=0}function zre(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Nre="__lodash_hash_undefined__",Fre=Object.prototype,Bre=Fre.hasOwnProperty;function jre(t){var e=this.__data__;if(dx){var r=e[t];return r===Nre?void 0:r}return Bre.call(e,t)?e[t]:void 0}var Ure=Object.prototype,Vre=Ure.hasOwnProperty;function $re(t){var e=this.__data__;return dx?e[t]!==void 0:Vre.call(e,t)}var qre="__lodash_hash_undefined__";function Gre(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=dx&&e===void 0?qre:e,this}function Om(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}Om.prototype.clear=Lre;Om.prototype.delete=zre;Om.prototype.get=jre;Om.prototype.has=$re;Om.prototype.set=Gre;function Wre(){this.size=0,this.__data__={hash:new Om,map:new(hx||nd),string:new Om}}function Hre(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function kI(t,e){var r=t.__data__;return Hre(e)?r[typeof e=="string"?"string":"hash"]:r.map}function Zre(t){var e=kI(this,t).delete(t);return this.size-=e?1:0,e}function Xre(t){return kI(this,t).get(t)}function Kre(t){return kI(this,t).has(t)}function Qre(t,e){var r=kI(this,t),s=r.size;return r.set(t,e),this.size+=r.size==s?0:1,this}function Hf(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var s=t[e];this.set(s[0],s[1])}}Hf.prototype.clear=Wre;Hf.prototype.delete=Zre;Hf.prototype.get=Xre;Hf.prototype.has=Kre;Hf.prototype.set=Qre;var Yre=200;function Jre(t,e){var r=this.__data__;if(r instanceof nd){var s=r.__data__;if(!hx||s.length<Yre-1)return s.push([t,e]),this.size=++r.size,this;r=this.__data__=new Hf(s)}return r.set(t,e),this.size=r.size,this}function Ky(t){var e=this.__data__=new nd(t);this.size=e.size}Ky.prototype.clear=mre;Ky.prototype.delete=gre;Ky.prototype.get=_re;Ky.prototype.has=yre;Ky.prototype.set=Jre;function eie(t,e){for(var r=-1,s=t==null?0:t.length;++r<s&&e(t[r],r,t)!==!1;);return t}var F6=function(){try{var t=eg(Object,"defineProperty");return t({},"",{}),t}catch{}}();function Y2(t,e,r){e=="__proto__"&&F6?F6(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var tie=Object.prototype,nie=tie.hasOwnProperty;function J2(t,e,r){var s=t[e];(!(nie.call(t,e)&&K2(s,r))||r===void 0&&!(e in t))&&Y2(t,e,r)}function OI(t,e,r,s){var c=!r;r||(r={});for(var d=-1,_=e.length;++d<_;){var x=e[d],a=void 0;a===void 0&&(a=t[x]),c?Y2(r,x,a):J2(r,x,a)}return r}function rie(t,e){for(var r=-1,s=Array(t);++r<t;)s[r]=e(r);return s}var iie="[object Arguments]";function B6(t){return Ym(t)&&Qm(t)==iie}var e7=Object.prototype,sie=e7.hasOwnProperty,oie=e7.propertyIsEnumerable,aie=B6(function(){return arguments}())?B6:function(t){return Ym(t)&&sie.call(t,"callee")&&!oie.call(t,"callee")},Xx=Array.isArray;function lie(){return!1}var t7=typeof hl=="object"&&hl&&!hl.nodeType&&hl,j6=t7&&typeof dl=="object"&&dl&&!dl.nodeType&&dl,cie=j6&&j6.exports===t7,U6=cie?Gu.Buffer:void 0,uie=U6?U6.isBuffer:void 0,n7=uie||lie,hie=9007199254740991,die=/^(?:0|[1-9]\d*)$/;function fie(t,e){var r=typeof t;return e=e??hie,!!e&&(r=="number"||r!="symbol"&&die.test(t))&&t>-1&&t%1==0&&t<e}var pie=9007199254740991;function r7(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=pie}var mie="[object Arguments]",gie="[object Array]",_ie="[object Boolean]",yie="[object Date]",vie="[object Error]",xie="[object Function]",bie="[object Map]",wie="[object Number]",Tie="[object Object]",Eie="[object RegExp]",Sie="[object Set]",Iie="[object String]",Cie="[object WeakMap]",Aie="[object ArrayBuffer]",Pie="[object DataView]",Rie="[object Float32Array]",Mie="[object Float64Array]",kie="[object Int8Array]",Oie="[object Int16Array]",Die="[object Int32Array]",Lie="[object Uint8Array]",zie="[object Uint8ClampedArray]",Nie="[object Uint16Array]",Fie="[object Uint32Array]",Ki={};Ki[Rie]=Ki[Mie]=Ki[kie]=Ki[Oie]=Ki[Die]=Ki[Lie]=Ki[zie]=Ki[Nie]=Ki[Fie]=!0;Ki[mie]=Ki[gie]=Ki[Aie]=Ki[_ie]=Ki[Pie]=Ki[yie]=Ki[vie]=Ki[xie]=Ki[bie]=Ki[wie]=Ki[Tie]=Ki[Eie]=Ki[Sie]=Ki[Iie]=Ki[Cie]=!1;function Bie(t){return Ym(t)&&r7(t.length)&&!!Ki[Qm(t)]}function PO(t){return function(e){return t(e)}}var i7=typeof hl=="object"&&hl&&!hl.nodeType&&hl,S1=i7&&typeof dl=="object"&&dl&&!dl.nodeType&&dl,jie=S1&&S1.exports===i7,tR=jie&&W2.process,Ey=function(){try{var t=S1&&S1.require&&S1.require("util").types;return t||tR&&tR.binding&&tR.binding("util")}catch{}}(),V6=Ey&&Ey.isTypedArray,Uie=V6?PO(V6):Bie,Vie=Object.prototype,$ie=Vie.hasOwnProperty;function s7(t,e){var r=Xx(t),s=!r&&aie(t),c=!r&&!s&&n7(t),d=!r&&!s&&!c&&Uie(t),_=r||s||c||d,x=_?rie(t.length,String):[],a=x.length;for(var I in t)(e||$ie.call(t,I))&&!(_&&(I=="length"||c&&(I=="offset"||I=="parent")||d&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||fie(I,a)))&&x.push(I);return x}var qie=Object.prototype;function RO(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||qie;return t===r}var Gie=Z2(Object.keys,Object),Wie=Object.prototype,Hie=Wie.hasOwnProperty;function Zie(t){if(!RO(t))return Gie(t);var e=[];for(var r in Object(t))Hie.call(t,r)&&r!="constructor"&&e.push(r);return e}function o7(t){return t!=null&&r7(t.length)&&!Q2(t)}function MO(t){return o7(t)?s7(t):Zie(t)}function Xie(t,e){return t&&OI(e,MO(e),t)}function Kie(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}var Qie=Object.prototype,Yie=Qie.hasOwnProperty;function Jie(t){if(!Zx(t))return Kie(t);var e=RO(t),r=[];for(var s in t)s=="constructor"&&(e||!Yie.call(t,s))||r.push(s);return r}function kO(t){return o7(t)?s7(t,!0):Jie(t)}function ese(t,e){return t&&OI(e,kO(e),t)}var a7=typeof hl=="object"&&hl&&!hl.nodeType&&hl,$6=a7&&typeof dl=="object"&&dl&&!dl.nodeType&&dl,tse=$6&&$6.exports===a7,q6=tse?Gu.Buffer:void 0,G6=q6?q6.allocUnsafe:void 0;function nse(t,e){if(e)return t.slice();var r=t.length,s=G6?G6(r):new t.constructor(r);return t.copy(s),s}function l7(t,e){var r=-1,s=t.length;for(e||(e=Array(s));++r<s;)e[r]=t[r];return e}function rse(t,e){for(var r=-1,s=t==null?0:t.length,c=0,d=[];++r<s;){var _=t[r];e(_,r,t)&&(d[c++]=_)}return d}function c7(){return[]}var ise=Object.prototype,sse=ise.propertyIsEnumerable,W6=Object.getOwnPropertySymbols,OO=W6?function(t){return t==null?[]:(t=Object(t),rse(W6(t),function(e){return sse.call(t,e)}))}:c7;function ose(t,e){return OI(t,OO(t),e)}function u7(t,e){for(var r=-1,s=e.length,c=t.length;++r<s;)t[c+r]=e[r];return t}var ase=Object.getOwnPropertySymbols,h7=ase?function(t){for(var e=[];t;)u7(e,OO(t)),t=AO(t);return e}:c7;function lse(t,e){return OI(t,h7(t),e)}function d7(t,e,r){var s=e(t);return Xx(t)?s:u7(s,r(t))}function cse(t){return d7(t,MO,OO)}function use(t){return d7(t,kO,h7)}var HM=eg(Gu,"DataView"),ZM=eg(Gu,"Promise"),XM=eg(Gu,"Set"),KM=eg(Gu,"WeakMap"),H6="[object Map]",hse="[object Object]",Z6="[object Promise]",X6="[object Set]",K6="[object WeakMap]",Q6="[object DataView]",dse=Jm(HM),fse=Jm(hx),pse=Jm(ZM),mse=Jm(XM),gse=Jm(KM),Rh=Qm;(HM&&Rh(new HM(new ArrayBuffer(1)))!=Q6||hx&&Rh(new hx)!=H6||ZM&&Rh(ZM.resolve())!=Z6||XM&&Rh(new XM)!=X6||KM&&Rh(new KM)!=K6)&&(Rh=function(t){var e=Qm(t),r=e==hse?t.constructor:void 0,s=r?Jm(r):"";if(s)switch(s){case dse:return Q6;case fse:return H6;case pse:return Z6;case mse:return X6;case gse:return K6}return e});var _se=Object.prototype,yse=_se.hasOwnProperty;function vse(t){var e=t.length,r=new t.constructor(e);return e&&typeof t[0]=="string"&&yse.call(t,"index")&&(r.index=t.index,r.input=t.input),r}var Y6=Gu.Uint8Array;function DO(t){var e=new t.constructor(t.byteLength);return new Y6(e).set(new Y6(t)),e}function xse(t,e){var r=e?DO(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}var bse=/\w*$/;function wse(t){var e=new t.constructor(t.source,bse.exec(t));return e.lastIndex=t.lastIndex,e}var J6=Df?Df.prototype:void 0,ej=J6?J6.valueOf:void 0;function Tse(t){return ej?Object(ej.call(t)):{}}function Ese(t,e){var r=e?DO(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}var Sse="[object Boolean]",Ise="[object Date]",Cse="[object Map]",Ase="[object Number]",Pse="[object RegExp]",Rse="[object Set]",Mse="[object String]",kse="[object Symbol]",Ose="[object ArrayBuffer]",Dse="[object DataView]",Lse="[object Float32Array]",zse="[object Float64Array]",Nse="[object Int8Array]",Fse="[object Int16Array]",Bse="[object Int32Array]",jse="[object Uint8Array]",Use="[object Uint8ClampedArray]",Vse="[object Uint16Array]",$se="[object Uint32Array]";function qse(t,e,r){var s=t.constructor;switch(e){case Ose:return DO(t);case Sse:case Ise:return new s(+t);case Dse:return xse(t,r);case Lse:case zse:case Nse:case Fse:case Bse:case jse:case Use:case Vse:case $se:return Ese(t,r);case Cse:return new s;case Ase:case Mse:return new s(t);case Pse:return wse(t);case Rse:return new s;case kse:return Tse(t)}}var tj=Object.create,Gse=function(){function t(){}return function(e){if(!Zx(e))return{};if(tj)return tj(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function Wse(t){return typeof t.constructor=="function"&&!RO(t)?Gse(AO(t)):{}}var Hse="[object Map]";function Zse(t){return Ym(t)&&Rh(t)==Hse}var nj=Ey&&Ey.isMap,Xse=nj?PO(nj):Zse,Kse="[object Set]";function Qse(t){return Ym(t)&&Rh(t)==Kse}var rj=Ey&&Ey.isSet,Yse=rj?PO(rj):Qse,Jse=1,eoe=2,toe=4,f7="[object Arguments]",noe="[object Array]",roe="[object Boolean]",ioe="[object Date]",soe="[object Error]",p7="[object Function]",ooe="[object GeneratorFunction]",aoe="[object Map]",loe="[object Number]",m7="[object Object]",coe="[object RegExp]",uoe="[object Set]",hoe="[object String]",doe="[object Symbol]",foe="[object WeakMap]",poe="[object ArrayBuffer]",moe="[object DataView]",goe="[object Float32Array]",_oe="[object Float64Array]",yoe="[object Int8Array]",voe="[object Int16Array]",xoe="[object Int32Array]",boe="[object Uint8Array]",woe="[object Uint8ClampedArray]",Toe="[object Uint16Array]",Eoe="[object Uint32Array]",Vi={};Vi[f7]=Vi[noe]=Vi[poe]=Vi[moe]=Vi[roe]=Vi[ioe]=Vi[goe]=Vi[_oe]=Vi[yoe]=Vi[voe]=Vi[xoe]=Vi[aoe]=Vi[loe]=Vi[m7]=Vi[coe]=Vi[uoe]=Vi[hoe]=Vi[doe]=Vi[boe]=Vi[woe]=Vi[Toe]=Vi[Eoe]=!0;Vi[soe]=Vi[p7]=Vi[foe]=!1;function I1(t,e,r,s,c,d){var _,x=e&Jse,a=e&eoe,I=e&toe;if(_!==void 0)return _;if(!Zx(t))return t;var M=Xx(t);if(M){if(_=vse(t),!x)return l7(t,_)}else{var D=Rh(t),L=D==p7||D==ooe;if(n7(t))return nse(t,x);if(D==m7||D==f7||L&&!c){if(_=a||L?{}:Wse(t),!x)return a?lse(t,ese(_,t)):ose(t,Xie(_,t))}else{if(!Vi[D])return c?t:{};_=qse(t,D,x)}}d||(d=new Ky);var G=d.get(t);if(G)return G;d.set(t,_),Yse(t)?t.forEach(function(ee){_.add(I1(ee,e,r,ee,t,d))}):Xse(t)&&t.forEach(function(ee,U){_.set(U,I1(ee,e,r,U,t,d))});var Q=I?a?use:cse:a?kO:MO,re=M?void 0:Q(t);return eie(re||t,function(ee,U){re&&(U=ee,ee=t[U]),J2(_,U,I1(ee,e,r,U,t,d))}),_}var Soe=1,Ioe=4;function DT(t){return I1(t,Soe|Ioe)}var ij=Array.isArray,sj=Object.keys,Coe=Object.prototype.hasOwnProperty,Aoe=typeof Element<"u";function QM(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var r=ij(t),s=ij(e),c,d,_;if(r&&s){if(d=t.length,d!=e.length)return!1;for(c=d;c--!==0;)if(!QM(t[c],e[c]))return!1;return!0}if(r!=s)return!1;var x=t instanceof Date,a=e instanceof Date;if(x!=a)return!1;if(x&&a)return t.getTime()==e.getTime();var I=t instanceof RegExp,M=e instanceof RegExp;if(I!=M)return!1;if(I&&M)return t.toString()==e.toString();var D=sj(t);if(d=D.length,d!==sj(e).length)return!1;for(c=d;c--!==0;)if(!Coe.call(e,D[c]))return!1;if(Aoe&&t instanceof Element&&e instanceof Element)return t===e;for(c=d;c--!==0;)if(_=D[c],!(_==="_owner"&&t.$$typeof)&&!QM(t[_],e[_]))return!1;return!0}return t!==t&&e!==e}var Poe=function(e,r){try{return QM(e,r)}catch(s){if(s.message&&s.message.match(/stack|recursion/i)||s.number===-2146828260)return console.warn("Warning: react-fast-compare does not handle circular references.",s.name,s.message),!1;throw s}};const em=Gy(Poe);var Roe=4;function oj(t){return I1(t,Roe)}function g7(t,e){for(var r=-1,s=t==null?0:t.length,c=Array(s);++r<s;)c[r]=e(t[r],r,t);return c}var Moe="[object Symbol]";function LO(t){return typeof t=="symbol"||Ym(t)&&Qm(t)==Moe}var koe="Expected a function";function zO(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(koe);var r=function(){var s=arguments,c=e?e.apply(this,s):s[0],d=r.cache;if(d.has(c))return d.get(c);var _=t.apply(this,s);return r.cache=d.set(c,_)||d,_};return r.cache=new(zO.Cache||Hf),r}zO.Cache=Hf;var Ooe=500;function Doe(t){var e=zO(t,function(s){return r.size===Ooe&&r.clear(),s}),r=e.cache;return e}var Loe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,zoe=/\\(\\)?/g,Noe=Doe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(Loe,function(r,s,c,d){e.push(c?d.replace(zoe,"$1"):s||r)}),e}),Foe=1/0;function Boe(t){if(typeof t=="string"||LO(t))return t;var e=t+"";return e=="0"&&1/t==-Foe?"-0":e}var joe=1/0,aj=Df?Df.prototype:void 0,lj=aj?aj.toString:void 0;function _7(t){if(typeof t=="string")return t;if(Xx(t))return g7(t,_7)+"";if(LO(t))return lj?lj.call(t):"";var e=t+"";return e=="0"&&1/t==-joe?"-0":e}function Uoe(t){return t==null?"":_7(t)}function y7(t){return Xx(t)?g7(t,Boe):LO(t)?[t]:l7(Noe(Uoe(t)))}var v7={exports:{}},Ei={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var To=typeof Symbol=="function"&&Symbol.for,NO=To?Symbol.for("react.element"):60103,FO=To?Symbol.for("react.portal"):60106,DI=To?Symbol.for("react.fragment"):60107,LI=To?Symbol.for("react.strict_mode"):60108,zI=To?Symbol.for("react.profiler"):60114,NI=To?Symbol.for("react.provider"):60109,FI=To?Symbol.for("react.context"):60110,BO=To?Symbol.for("react.async_mode"):60111,BI=To?Symbol.for("react.concurrent_mode"):60111,jI=To?Symbol.for("react.forward_ref"):60112,UI=To?Symbol.for("react.suspense"):60113,Voe=To?Symbol.for("react.suspense_list"):60120,VI=To?Symbol.for("react.memo"):60115,$I=To?Symbol.for("react.lazy"):60116,$oe=To?Symbol.for("react.block"):60121,qoe=To?Symbol.for("react.fundamental"):60117,Goe=To?Symbol.for("react.responder"):60118,Woe=To?Symbol.for("react.scope"):60119;function bl(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case NO:switch(t=t.type,t){case BO:case BI:case DI:case zI:case LI:case UI:return t;default:switch(t=t&&t.$$typeof,t){case FI:case jI:case $I:case VI:case NI:return t;default:return e}}case FO:return e}}}function x7(t){return bl(t)===BI}Ei.AsyncMode=BO;Ei.ConcurrentMode=BI;Ei.ContextConsumer=FI;Ei.ContextProvider=NI;Ei.Element=NO;Ei.ForwardRef=jI;Ei.Fragment=DI;Ei.Lazy=$I;Ei.Memo=VI;Ei.Portal=FO;Ei.Profiler=zI;Ei.StrictMode=LI;Ei.Suspense=UI;Ei.isAsyncMode=function(t){return x7(t)||bl(t)===BO};Ei.isConcurrentMode=x7;Ei.isContextConsumer=function(t){return bl(t)===FI};Ei.isContextProvider=function(t){return bl(t)===NI};Ei.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===NO};Ei.isForwardRef=function(t){return bl(t)===jI};Ei.isFragment=function(t){return bl(t)===DI};Ei.isLazy=function(t){return bl(t)===$I};Ei.isMemo=function(t){return bl(t)===VI};Ei.isPortal=function(t){return bl(t)===FO};Ei.isProfiler=function(t){return bl(t)===zI};Ei.isStrictMode=function(t){return bl(t)===LI};Ei.isSuspense=function(t){return bl(t)===UI};Ei.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===DI||t===BI||t===zI||t===LI||t===UI||t===Voe||typeof t=="object"&&t!==null&&(t.$$typeof===$I||t.$$typeof===VI||t.$$typeof===NI||t.$$typeof===FI||t.$$typeof===jI||t.$$typeof===qoe||t.$$typeof===Goe||t.$$typeof===Woe||t.$$typeof===$oe)};Ei.typeOf=bl;v7.exports=Ei;var Hoe=v7.exports,b7=Hoe,Zoe={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Xoe={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},w7={};w7[b7.ForwardRef]=Zoe;w7[b7.Memo]=Xoe;function Qi(){return Qi=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},Qi.apply(this,arguments)}function G_(t,e){if(t==null)return{};var r={},s=Object.keys(t),c,d;for(d=0;d<s.length;d++)c=s[d],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}var qI=Y.createContext(void 0);qI.displayName="FormikContext";var Koe=qI.Provider;qI.Consumer;function T7(){var t=Y.useContext(qI);return t}var rl=function(e){return typeof e=="function"},GI=function(e){return e!==null&&typeof e=="object"},Qoe=function(e){return String(Math.floor(Number(e)))===e},nR=function(e){return Object.prototype.toString.call(e)==="[object String]"},Yoe=function(e){return Y.Children.count(e)===0},rR=function(e){return GI(e)&&rl(e.then)};function nl(t,e,r,s){s===void 0&&(s=0);for(var c=y7(e);t&&s<c.length;)t=t[c[s++]];return s!==c.length&&!t||t===void 0?r:t}function vm(t,e,r){for(var s=oj(t),c=s,d=0,_=y7(e);d<_.length-1;d++){var x=_[d],a=nl(t,_.slice(0,d+1));if(a&&(GI(a)||Array.isArray(a)))c=c[x]=oj(a);else{var I=_[d+1];c=c[x]=Qoe(I)&&Number(I)>=0?[]:{}}}return(d===0?t:c)[_[d]]===r?t:(r===void 0?delete c[_[d]]:c[_[d]]=r,d===0&&r===void 0&&delete s[_[d]],s)}function E7(t,e,r,s){r===void 0&&(r=new WeakMap),s===void 0&&(s={});for(var c=0,d=Object.keys(t);c<d.length;c++){var _=d[c],x=t[_];GI(x)?r.get(x)||(r.set(x,!0),s[_]=Array.isArray(x)?[]:{},E7(x,e,r,s[_])):s[_]=e}return s}function Joe(t,e){switch(e.type){case"SET_VALUES":return Qi({},t,{values:e.payload});case"SET_TOUCHED":return Qi({},t,{touched:e.payload});case"SET_ERRORS":return em(t.errors,e.payload)?t:Qi({},t,{errors:e.payload});case"SET_STATUS":return Qi({},t,{status:e.payload});case"SET_ISSUBMITTING":return Qi({},t,{isSubmitting:e.payload});case"SET_ISVALIDATING":return Qi({},t,{isValidating:e.payload});case"SET_FIELD_VALUE":return Qi({},t,{values:vm(t.values,e.payload.field,e.payload.value)});case"SET_FIELD_TOUCHED":return Qi({},t,{touched:vm(t.touched,e.payload.field,e.payload.value)});case"SET_FIELD_ERROR":return Qi({},t,{errors:vm(t.errors,e.payload.field,e.payload.value)});case"RESET_FORM":return Qi({},t,e.payload);case"SET_FORMIK_STATE":return e.payload(t);case"SUBMIT_ATTEMPT":return Qi({},t,{touched:E7(t.values,!0),isSubmitting:!0,submitCount:t.submitCount+1});case"SUBMIT_FAILURE":return Qi({},t,{isSubmitting:!1});case"SUBMIT_SUCCESS":return Qi({},t,{isSubmitting:!1});default:return t}}var Kp={},LT={};function eae(t){var e=t.validateOnChange,r=e===void 0?!0:e,s=t.validateOnBlur,c=s===void 0?!0:s,d=t.validateOnMount,_=d===void 0?!1:d,x=t.isInitialValid,a=t.enableReinitialize,I=a===void 0?!1:a,M=t.onSubmit,D=G_(t,["validateOnChange","validateOnBlur","validateOnMount","isInitialValid","enableReinitialize","onSubmit"]),L=Qi({validateOnChange:r,validateOnBlur:c,validateOnMount:_,onSubmit:M},D),G=Y.useRef(L.initialValues),Q=Y.useRef(L.initialErrors||Kp),re=Y.useRef(L.initialTouched||LT),ee=Y.useRef(L.initialStatus),U=Y.useRef(!1),H=Y.useRef({});Y.useEffect(function(){return U.current=!0,function(){U.current=!1}},[]);var Z=Y.useState(0),de=Z[1],ve=Y.useRef({values:DT(L.initialValues),errors:DT(L.initialErrors)||Kp,touched:DT(L.initialTouched)||LT,status:DT(L.initialStatus),isSubmitting:!1,isValidating:!1,submitCount:0}),Ee=ve.current,ie=Y.useCallback(function(Ke){var st=ve.current;ve.current=Joe(st,Ke),st!==ve.current&&de(function(zt){return zt+1})},[]),ue=Y.useCallback(function(Ke,st){return new Promise(function(zt,ln){var Ht=L.validate(Ke,st);Ht==null?zt(Kp):rR(Ht)?Ht.then(function(vn){zt(vn||Kp)},function(vn){ln(vn)}):zt(Ht)})},[L.validate]),K=Y.useCallback(function(Ke,st){var zt=L.validationSchema,ln=rl(zt)?zt(st):zt,Ht=st&&ln.validateAt?ln.validateAt(st,Ke):nae(Ke,ln);return new Promise(function(vn,Fn){Ht.then(function(){vn(Kp)},function(pr){pr.name==="ValidationError"?vn(tae(pr)):Fn(pr)})})},[L.validationSchema]),ge=Y.useCallback(function(Ke,st){return new Promise(function(zt){return zt(H.current[Ke].validate(st))})},[]),_e=Y.useCallback(function(Ke){var st=Object.keys(H.current).filter(function(ln){return rl(H.current[ln].validate)}),zt=st.length>0?st.map(function(ln){return ge(ln,nl(Ke,ln))}):[Promise.resolve("DO_NOT_DELETE_YOU_WILL_BE_FIRED")];return Promise.all(zt).then(function(ln){return ln.reduce(function(Ht,vn,Fn){return vn==="DO_NOT_DELETE_YOU_WILL_BE_FIRED"||vn&&(Ht=vm(Ht,st[Fn],vn)),Ht},{})})},[ge]),Se=Y.useCallback(function(Ke){return Promise.all([_e(Ke),L.validationSchema?K(Ke):{},L.validate?ue(Ke):{}]).then(function(st){var zt=st[0],ln=st[1],Ht=st[2],vn=WM.all([zt,ln,Ht],{arrayMerge:rae});return vn})},[L.validate,L.validationSchema,_e,ue,K]),xe=zl(function(Ke){return Ke===void 0&&(Ke=Ee.values),ie({type:"SET_ISVALIDATING",payload:!0}),Se(Ke).then(function(st){return U.current&&(ie({type:"SET_ISVALIDATING",payload:!1}),ie({type:"SET_ERRORS",payload:st})),st})});Y.useEffect(function(){_&&U.current===!0&&em(G.current,L.initialValues)&&xe(G.current)},[_,xe]);var wt=Y.useCallback(function(Ke){var st=Ke&&Ke.values?Ke.values:G.current,zt=Ke&&Ke.errors?Ke.errors:Q.current?Q.current:L.initialErrors||{},ln=Ke&&Ke.touched?Ke.touched:re.current?re.current:L.initialTouched||{},Ht=Ke&&Ke.status?Ke.status:ee.current?ee.current:L.initialStatus;G.current=st,Q.current=zt,re.current=ln,ee.current=Ht;var vn=function(){ie({type:"RESET_FORM",payload:{isSubmitting:!!Ke&&!!Ke.isSubmitting,errors:zt,touched:ln,status:Ht,values:st,isValidating:!!Ke&&!!Ke.isValidating,submitCount:Ke&&Ke.submitCount&&typeof Ke.submitCount=="number"?Ke.submitCount:0}})};if(L.onReset){var Fn=L.onReset(Ee.values,xr);rR(Fn)?Fn.then(vn):vn()}else vn()},[L.initialErrors,L.initialStatus,L.initialTouched,L.onReset]);Y.useEffect(function(){U.current===!0&&!em(G.current,L.initialValues)&&I&&(G.current=L.initialValues,wt(),_&&xe(G.current))},[I,L.initialValues,wt,_,xe]),Y.useEffect(function(){I&&U.current===!0&&!em(Q.current,L.initialErrors)&&(Q.current=L.initialErrors||Kp,ie({type:"SET_ERRORS",payload:L.initialErrors||Kp}))},[I,L.initialErrors]),Y.useEffect(function(){I&&U.current===!0&&!em(re.current,L.initialTouched)&&(re.current=L.initialTouched||LT,ie({type:"SET_TOUCHED",payload:L.initialTouched||LT}))},[I,L.initialTouched]),Y.useEffect(function(){I&&U.current===!0&&!em(ee.current,L.initialStatus)&&(ee.current=L.initialStatus,ie({type:"SET_STATUS",payload:L.initialStatus}))},[I,L.initialStatus,L.initialTouched]);var ft=zl(function(Ke){if(H.current[Ke]&&rl(H.current[Ke].validate)){var st=nl(Ee.values,Ke),zt=H.current[Ke].validate(st);return rR(zt)?(ie({type:"SET_ISVALIDATING",payload:!0}),zt.then(function(ln){return ln}).then(function(ln){ie({type:"SET_FIELD_ERROR",payload:{field:Ke,value:ln}}),ie({type:"SET_ISVALIDATING",payload:!1})})):(ie({type:"SET_FIELD_ERROR",payload:{field:Ke,value:zt}}),Promise.resolve(zt))}else if(L.validationSchema)return ie({type:"SET_ISVALIDATING",payload:!0}),K(Ee.values,Ke).then(function(ln){return ln}).then(function(ln){ie({type:"SET_FIELD_ERROR",payload:{field:Ke,value:nl(ln,Ke)}}),ie({type:"SET_ISVALIDATING",payload:!1})});return Promise.resolve()}),Tt=Y.useCallback(function(Ke,st){var zt=st.validate;H.current[Ke]={validate:zt}},[]),gt=Y.useCallback(function(Ke){delete H.current[Ke]},[]),at=zl(function(Ke,st){ie({type:"SET_TOUCHED",payload:Ke});var zt=st===void 0?c:st;return zt?xe(Ee.values):Promise.resolve()}),bt=Y.useCallback(function(Ke){ie({type:"SET_ERRORS",payload:Ke})},[]),Zt=zl(function(Ke,st){var zt=rl(Ke)?Ke(Ee.values):Ke;ie({type:"SET_VALUES",payload:zt});var ln=st===void 0?r:st;return ln?xe(zt):Promise.resolve()}),tt=Y.useCallback(function(Ke,st){ie({type:"SET_FIELD_ERROR",payload:{field:Ke,value:st}})},[]),Et=zl(function(Ke,st,zt){ie({type:"SET_FIELD_VALUE",payload:{field:Ke,value:st}});var ln=zt===void 0?r:zt;return ln?xe(vm(Ee.values,Ke,st)):Promise.resolve()}),mt=Y.useCallback(function(Ke,st){var zt=st,ln=Ke,Ht;if(!nR(Ke)){Ke.persist&&Ke.persist();var vn=Ke.target?Ke.target:Ke.currentTarget,Fn=vn.type,pr=vn.name,fi=vn.id,ir=vn.value,Ci=vn.checked,is=vn.outerHTML,An=vn.options,ar=vn.multiple;zt=st||pr||fi,ln=/number|range/.test(Fn)?(Ht=parseFloat(ir),isNaN(Ht)?"":Ht):/checkbox/.test(Fn)?sae(nl(Ee.values,zt),Ci,ir):An&&ar?iae(An):ir}zt&&Et(zt,ln)},[Et,Ee.values]),Vt=zl(function(Ke){if(nR(Ke))return function(st){return mt(st,Ke)};mt(Ke)}),Pt=zl(function(Ke,st,zt){st===void 0&&(st=!0),ie({type:"SET_FIELD_TOUCHED",payload:{field:Ke,value:st}});var ln=zt===void 0?c:zt;return ln?xe(Ee.values):Promise.resolve()}),pn=Y.useCallback(function(Ke,st){Ke.persist&&Ke.persist();var zt=Ke.target,ln=zt.name,Ht=zt.id,vn=zt.outerHTML,Fn=st||ln||Ht;Pt(Fn,!0)},[Pt]),dn=zl(function(Ke){if(nR(Ke))return function(st){return pn(st,Ke)};pn(Ke)}),yn=Y.useCallback(function(Ke){rl(Ke)?ie({type:"SET_FORMIK_STATE",payload:Ke}):ie({type:"SET_FORMIK_STATE",payload:function(){return Ke}})},[]),Mt=Y.useCallback(function(Ke){ie({type:"SET_STATUS",payload:Ke})},[]),cn=Y.useCallback(function(Ke){ie({type:"SET_ISSUBMITTING",payload:Ke})},[]),Yt=zl(function(){return ie({type:"SUBMIT_ATTEMPT"}),xe().then(function(Ke){var st=Ke instanceof Error,zt=!st&&Object.keys(Ke).length===0;if(zt){var ln;try{if(ln=On(),ln===void 0)return}catch(Ht){throw Ht}return Promise.resolve(ln).then(function(Ht){return U.current&&ie({type:"SUBMIT_SUCCESS"}),Ht}).catch(function(Ht){if(U.current)throw ie({type:"SUBMIT_FAILURE"}),Ht})}else if(U.current&&(ie({type:"SUBMIT_FAILURE"}),st))throw Ke})}),Tn=zl(function(Ke){Ke&&Ke.preventDefault&&rl(Ke.preventDefault)&&Ke.preventDefault(),Ke&&Ke.stopPropagation&&rl(Ke.stopPropagation)&&Ke.stopPropagation(),Yt().catch(function(st){console.warn("Warning: An unhandled error was caught from submitForm()",st)})}),xr={resetForm:wt,validateForm:xe,validateField:ft,setErrors:bt,setFieldError:tt,setFieldTouched:Pt,setFieldValue:Et,setStatus:Mt,setSubmitting:cn,setTouched:at,setValues:Zt,setFormikState:yn,submitForm:Yt},On=zl(function(){return M(Ee.values,xr)}),fr=zl(function(Ke){Ke&&Ke.preventDefault&&rl(Ke.preventDefault)&&Ke.preventDefault(),Ke&&Ke.stopPropagation&&rl(Ke.stopPropagation)&&Ke.stopPropagation(),wt()}),Lr=Y.useCallback(function(Ke){return{value:nl(Ee.values,Ke),error:nl(Ee.errors,Ke),touched:!!nl(Ee.touched,Ke),initialValue:nl(G.current,Ke),initialTouched:!!nl(re.current,Ke),initialError:nl(Q.current,Ke)}},[Ee.errors,Ee.touched,Ee.values]),or=Y.useCallback(function(Ke){return{setValue:function(zt,ln){return Et(Ke,zt,ln)},setTouched:function(zt,ln){return Pt(Ke,zt,ln)},setError:function(zt){return tt(Ke,zt)}}},[Et,Pt,tt]),Yn=Y.useCallback(function(Ke){var st=GI(Ke),zt=st?Ke.name:Ke,ln=nl(Ee.values,zt),Ht={name:zt,value:ln,onChange:Vt,onBlur:dn};if(st){var vn=Ke.type,Fn=Ke.value,pr=Ke.as,fi=Ke.multiple;vn==="checkbox"?Fn===void 0?Ht.checked=!!ln:(Ht.checked=!!(Array.isArray(ln)&&~ln.indexOf(Fn)),Ht.value=Fn):vn==="radio"?(Ht.checked=ln===Fn,Ht.value=Fn):pr==="select"&&fi&&(Ht.value=Ht.value||[],Ht.multiple=!0)}return Ht},[dn,Vt,Ee.values]),ke=Y.useMemo(function(){return!em(G.current,Ee.values)},[G.current,Ee.values]),He=Y.useMemo(function(){return typeof x<"u"?ke?Ee.errors&&Object.keys(Ee.errors).length===0:x!==!1&&rl(x)?x(L):x:Ee.errors&&Object.keys(Ee.errors).length===0},[x,ke,Ee.errors,L]),lt=Qi({},Ee,{initialValues:G.current,initialErrors:Q.current,initialTouched:re.current,initialStatus:ee.current,handleBlur:dn,handleChange:Vt,handleReset:fr,handleSubmit:Tn,resetForm:wt,setErrors:bt,setFormikState:yn,setFieldTouched:Pt,setFieldValue:Et,setFieldError:tt,setStatus:Mt,setSubmitting:cn,setTouched:at,setValues:Zt,submitForm:Yt,validateForm:xe,validateField:ft,isValid:He,dirty:ke,unregisterField:gt,registerField:Tt,getFieldProps:Yn,getFieldMeta:Lr,getFieldHelpers:or,validateOnBlur:c,validateOnChange:r,validateOnMount:_});return lt}function S7(t){var e=eae(t),r=t.component,s=t.children,c=t.render,d=t.innerRef;return Y.useImperativeHandle(d,function(){return e}),Y.createElement(Koe,{value:e},r?Y.createElement(r,e):c?c(e):s?rl(s)?s(e):Yoe(s)?null:Y.Children.only(s):null)}function tae(t){var e={};if(t.inner){if(t.inner.length===0)return vm(e,t.path,t.message);for(var c=t.inner,r=Array.isArray(c),s=0,c=r?c:c[Symbol.iterator]();;){var d;if(r){if(s>=c.length)break;d=c[s++]}else{if(s=c.next(),s.done)break;d=s.value}var _=d;nl(e,_.path)||(e=vm(e,_.path,_.message))}}return e}function nae(t,e,r,s){r===void 0&&(r=!1);var c=YM(t);return e[r?"validateSync":"validate"](c,{abortEarly:!1,context:c})}function YM(t){var e=Array.isArray(t)?[]:{};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var s=String(r);Array.isArray(t[s])===!0?e[s]=t[s].map(function(c){return Array.isArray(c)===!0||z6(c)?YM(c):c!==""?c:void 0}):z6(t[s])?e[s]=YM(t[s]):e[s]=t[s]!==""?t[s]:void 0}return e}function rae(t,e,r){var s=t.slice();return e.forEach(function(d,_){if(typeof s[_]>"u"){var x=r.clone!==!1,a=x&&r.isMergeableObject(d);s[_]=a?WM(Array.isArray(d)?[]:{},d,r):d}else r.isMergeableObject(d)?s[_]=WM(t[_],d,r):t.indexOf(d)===-1&&s.push(d)}),s}function iae(t){return Array.from(t).filter(function(e){return e.selected}).map(function(e){return e.value})}function sae(t,e,r){if(typeof t=="boolean")return!!e;var s=[],c=!1,d=-1;if(Array.isArray(t))s=t,d=t.indexOf(r),c=d>=0;else if(!r||r=="true"||r=="false")return!!e;return e&&r&&!c?s.concat(r):c?s.slice(0,d).concat(s.slice(d+1)):s}var oae=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?Y.useLayoutEffect:Y.useEffect;function zl(t){var e=Y.useRef(t);return oae(function(){e.current=t}),Y.useCallback(function(){for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return e.current.apply(void 0,s)},[])}function C1(t){var e=t.validate,r=t.name,s=t.render,c=t.children,d=t.as,_=t.component,x=t.className,a=G_(t,["validate","name","render","children","as","component","className"]),I=T7(),M=G_(I,["validate","validationSchema"]),D=M.registerField,L=M.unregisterField;Y.useEffect(function(){return D(r,{validate:e}),function(){L(r)}},[D,L,r,e]);var G=M.getFieldProps(Qi({name:r},a)),Q=M.getFieldMeta(r),re={field:G,form:M};if(s)return s(Qi({},re,{meta:Q}));if(rl(c))return c(Qi({},re,{meta:Q}));if(_){if(typeof _=="string"){var ee=a.innerRef,U=G_(a,["innerRef"]);return Y.createElement(_,Qi({ref:ee},G,U,{className:x}),c)}return Y.createElement(_,Qi({field:G,form:M},a,{className:x}),c)}var H=d||"input";if(typeof H=="string"){var Z=a.innerRef,de=G_(a,["innerRef"]);return Y.createElement(H,Qi({ref:Z},G,de,{className:x}),c)}return Y.createElement(H,Qi({},G,a,{className:x}),c)}var jO=Y.forwardRef(function(t,e){var r=t.action,s=G_(t,["action"]),c=r??"#",d=T7(),_=d.handleReset,x=d.handleSubmit;return Y.createElement("form",Qi({onSubmit:x,ref:e,onReset:_,action:c},s))});jO.displayName="Form";function tg(t){this._maxSize=t,this.clear()}tg.prototype.clear=function(){this._size=0,this._values=Object.create(null)};tg.prototype.get=function(t){return this._values[t]};tg.prototype.set=function(t,e){return this._size>=this._maxSize&&this.clear(),t in this._values||this._size++,this._values[t]=e};var aae=/[^.^\]^[]+|(?=\[\]|\.\.)/g,I7=/^\d+$/,lae=/^\d/,cae=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,uae=/^\s*(['"]?)(.*?)(\1)\s*$/,UO=512,cj=new tg(UO),uj=new tg(UO),hj=new tg(UO),xm={Cache:tg,split:JM,normalizePath:iR,setter:function(t){var e=iR(t);return uj.get(t)||uj.set(t,function(s,c){for(var d=0,_=e.length,x=s;d<_-1;){var a=e[d];if(a==="__proto__"||a==="constructor"||a==="prototype")return s;x=x[e[d++]]}x[e[d]]=c})},getter:function(t,e){var r=iR(t);return hj.get(t)||hj.set(t,function(c){for(var d=0,_=r.length;d<_;)if(c!=null||!e)c=c[r[d++]];else return;return c})},join:function(t){return t.reduce(function(e,r){return e+(VO(r)||I7.test(r)?"["+r+"]":(e?".":"")+r)},"")},forEach:function(t,e,r){hae(Array.isArray(t)?t:JM(t),e,r)}};function iR(t){return cj.get(t)||cj.set(t,JM(t).map(function(e){return e.replace(uae,"$2")}))}function JM(t){return t.match(aae)||[""]}function hae(t,e,r){var s=t.length,c,d,_,x;for(d=0;d<s;d++)c=t[d],c&&(pae(c)&&(c='"'+c+'"'),x=VO(c),_=!x&&/^\d+$/.test(c),e.call(r,c,x,_,d,t))}function VO(t){return typeof t=="string"&&t&&["'",'"'].indexOf(t.charAt(0))!==-1}function dae(t){return t.match(lae)&&!t.match(I7)}function fae(t){return cae.test(t)}function pae(t){return!VO(t)&&(dae(t)||fae(t))}const mae=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,WI=t=>t.match(mae)||[],HI=t=>t[0].toUpperCase()+t.slice(1),$O=(t,e)=>WI(t).join(e).toLowerCase(),C7=t=>WI(t).reduce((e,r)=>`${e}${e?r[0].toUpperCase()+r.slice(1).toLowerCase():r.toLowerCase()}`,""),gae=t=>HI(C7(t)),_ae=t=>$O(t,"_"),yae=t=>$O(t,"-"),vae=t=>HI($O(t," ")),xae=t=>WI(t).map(HI).join(" ");var sR={words:WI,upperFirst:HI,camelCase:C7,pascalCase:gae,snakeCase:_ae,kebabCase:yae,sentenceCase:vae,titleCase:xae},qO={exports:{}};qO.exports=function(t){return A7(bae(t),t)};qO.exports.array=A7;function A7(t,e){var r=t.length,s=new Array(r),c={},d=r,_=wae(e),x=Tae(t);for(e.forEach(function(I){if(!x.has(I[0])||!x.has(I[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});d--;)c[d]||a(t[d],d,new Set);return s;function a(I,M,D){if(D.has(I)){var L;try{L=", node was:"+JSON.stringify(I)}catch{L=""}throw new Error("Cyclic dependency"+L)}if(!x.has(I))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(I));if(!c[M]){c[M]=!0;var G=_.get(I)||new Set;if(G=Array.from(G),M=G.length){D.add(I);do{var Q=G[--M];a(Q,x.get(Q),D)}while(M);D.delete(I)}s[--r]=I}}}function bae(t){for(var e=new Set,r=0,s=t.length;r<s;r++){var c=t[r];e.add(c[0]),e.add(c[1])}return Array.from(e)}function wae(t){for(var e=new Map,r=0,s=t.length;r<s;r++){var c=t[r];e.has(c[0])||e.set(c[0],new Set),e.has(c[1])||e.set(c[1],new Set),e.get(c[0]).add(c[1])}return e}function Tae(t){for(var e=new Map,r=0,s=t.length;r<s;r++)e.set(t[r],r);return e}var Eae=qO.exports;const Sae=Gy(Eae),Iae=Object.prototype.toString,Cae=Error.prototype.toString,Aae=RegExp.prototype.toString,Pae=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",Rae=/^Symbol\((.*)\)(.*)$/;function Mae(t){return t!=+t?"NaN":t===0&&1/t<0?"-0":""+t}function dj(t,e=!1){if(t==null||t===!0||t===!1)return""+t;const r=typeof t;if(r==="number")return Mae(t);if(r==="string")return e?`"${t}"`:t;if(r==="function")return"[Function "+(t.name||"anonymous")+"]";if(r==="symbol")return Pae.call(t).replace(Rae,"Symbol($1)");const s=Iae.call(t).slice(8,-1);return s==="Date"?isNaN(t.getTime())?""+t:t.toISOString(t):s==="Error"||t instanceof Error?"["+Cae.call(t)+"]":s==="RegExp"?Aae.call(t):null}function Cf(t,e){let r=dj(t,e);return r!==null?r:JSON.stringify(t,function(s,c){let d=dj(this[s],e);return d!==null?d:c},2)}function P7(t){return t==null?[]:[].concat(t)}let R7,M7,k7,kae=/\$\{\s*(\w+)\s*\}/g;R7=Symbol.toStringTag;class fj{constructor(e,r,s,c){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[R7]="Error",this.name="ValidationError",this.value=r,this.path=s,this.type=c,this.errors=[],this.inner=[],P7(e).forEach(d=>{if(za.isError(d)){this.errors.push(...d.errors);const _=d.inner.length?d.inner:[d];this.inner.push(..._)}else this.errors.push(d)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}M7=Symbol.hasInstance;k7=Symbol.toStringTag;class za extends Error{static formatError(e,r){const s=r.label||r.path||"this";return s!==r.path&&(r=Object.assign({},r,{path:s})),typeof e=="string"?e.replace(kae,(c,d)=>Cf(r[d])):typeof e=="function"?e(r):e}static isError(e){return e&&e.name==="ValidationError"}constructor(e,r,s,c,d){const _=new fj(e,r,s,c);if(d)return _;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[k7]="Error",this.name=_.name,this.message=_.message,this.type=_.type,this.value=_.value,this.path=_.path,this.errors=_.errors,this.inner=_.inner,Error.captureStackTrace&&Error.captureStackTrace(this,za)}static[M7](e){return fj[Symbol.hasInstance](e)||super[Symbol.hasInstance](e)}}let Tu={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:t,type:e,value:r,originalValue:s})=>{const c=s!=null&&s!==r?` (cast from the value \`${Cf(s,!0)}\`).`:".";return e!=="mixed"?`${t} must be a \`${e}\` type, but the final value was: \`${Cf(r,!0)}\``+c:`${t} must match the configured type. The validated value was: \`${Cf(r,!0)}\``+c}},ka={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},Oae={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},ek={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},Dae={isValue:"${path} field must be ${value}"},tk={noUnknown:"${path} field has unspecified keys: ${unknown}"},Lae={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},zae={notType:t=>{const{path:e,value:r,spec:s}=t,c=s.types.length;if(Array.isArray(r)){if(r.length<c)return`${e} tuple value has too few items, expected a length of ${c} but got ${r.length} for value: \`${Cf(r,!0)}\``;if(r.length>c)return`${e} tuple value has too many items, expected a length of ${c} but got ${r.length} for value: \`${Cf(r,!0)}\``}return za.formatError(Tu.notType,t)}};Object.assign(Object.create(null),{mixed:Tu,string:ka,number:Oae,date:ek,object:tk,array:Lae,boolean:Dae,tuple:zae});const GO=t=>t&&t.__isYupSchema__;class gS{static fromOptions(e,r){if(!r.then&&!r.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:s,then:c,otherwise:d}=r,_=typeof s=="function"?s:(...x)=>x.every(a=>a===s);return new gS(e,(x,a)=>{var I;let M=_(...x)?c:d;return(I=M==null?void 0:M(a))!=null?I:a})}constructor(e,r){this.fn=void 0,this.refs=e,this.refs=e,this.fn=r}resolve(e,r){let s=this.refs.map(d=>d.getValue(r==null?void 0:r.value,r==null?void 0:r.parent,r==null?void 0:r.context)),c=this.fn(s,e,r);if(c===void 0||c===e)return e;if(!GO(c))throw new TypeError("conditions must return a schema object");return c.resolve(r)}}const zT={context:"$",value:"."};let ng=class{constructor(e,r={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof e!="string")throw new TypeError("ref must be a string, got: "+e);if(this.key=e.trim(),e==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===zT.context,this.isValue=this.key[0]===zT.value,this.isSibling=!this.isContext&&!this.isValue;let s=this.isContext?zT.context:this.isValue?zT.value:"";this.path=this.key.slice(s.length),this.getter=this.path&&xm.getter(this.path,!0),this.map=r.map}getValue(e,r,s){let c=this.isContext?s:this.isValue?e:r;return this.getter&&(c=this.getter(c||{})),this.map&&(c=this.map(c)),c}cast(e,r){return this.getValue(e,r==null?void 0:r.parent,r==null?void 0:r.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(e){return e&&e.__isYupRef}};ng.prototype.__isYupRef=!0;const hm=t=>t==null;function __(t){function e({value:r,path:s="",options:c,originalValue:d,schema:_},x,a){const{name:I,test:M,params:D,message:L,skipAbsent:G}=t;let{parent:Q,context:re,abortEarly:ee=_.spec.abortEarly,disableStackTrace:U=_.spec.disableStackTrace}=c;function H(_e){return ng.isRef(_e)?_e.getValue(r,Q,re):_e}function Z(_e={}){const Se=Object.assign({value:r,originalValue:d,label:_.spec.label,path:_e.path||s,spec:_.spec,disableStackTrace:_e.disableStackTrace||U},D,_e.params);for(const wt of Object.keys(Se))Se[wt]=H(Se[wt]);const xe=new za(za.formatError(_e.message||L,Se),r,Se.path,_e.type||I,Se.disableStackTrace);return xe.params=Se,xe}const de=ee?x:a;let ve={path:s,parent:Q,type:I,from:c.from,createError:Z,resolve:H,options:c,originalValue:d,schema:_};const Ee=_e=>{za.isError(_e)?de(_e):_e?a(null):de(Z())},ie=_e=>{za.isError(_e)?de(_e):x(_e)};if(G&&hm(r))return Ee(!0);let K;try{var ge;if(K=M.call(ve,r,ve),typeof((ge=K)==null?void 0:ge.then)=="function"){if(c.sync)throw new Error(`Validation test of type: "${ve.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(K).then(Ee,ie)}}catch(_e){ie(_e);return}Ee(K)}return e.OPTIONS=t,e}function Nae(t,e,r,s=r){let c,d,_;return e?(xm.forEach(e,(x,a,I)=>{let M=a?x.slice(1,x.length-1):x;t=t.resolve({context:s,parent:c,value:r});let D=t.type==="tuple",L=I?parseInt(M,10):0;if(t.innerType||D){if(D&&!I)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${_}" must contain an index to the tuple element, e.g. "${_}[0]"`);if(r&&L>=r.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${x}, in the path: ${e}. because there is no value at that index. `);c=r,r=r&&r[L],t=D?t.spec.types[L]:t.innerType}if(!I){if(!t.fields||!t.fields[M])throw new Error(`The schema does not contain the path: ${e}. (failed at: ${_} which is a type: "${t.type}")`);c=r,r=r&&r[M],t=t.fields[M]}d=M,_=a?"["+x+"]":"."+x}),{schema:t,parent:c,parentPath:d}):{parent:c,parentPath:e,schema:t}}class _S extends Set{describe(){const e=[];for(const r of this.values())e.push(ng.isRef(r)?r.describe():r);return e}resolveAll(e){let r=[];for(const s of this.values())r.push(e(s));return r}clone(){return new _S(this.values())}merge(e,r){const s=this.clone();return e.forEach(c=>s.add(c)),r.forEach(c=>s.delete(c)),s}}function W_(t,e=new Map){if(GO(t)||!t||typeof t!="object")return t;if(e.has(t))return e.get(t);let r;if(t instanceof Date)r=new Date(t.getTime()),e.set(t,r);else if(t instanceof RegExp)r=new RegExp(t),e.set(t,r);else if(Array.isArray(t)){r=new Array(t.length),e.set(t,r);for(let s=0;s<t.length;s++)r[s]=W_(t[s],e)}else if(t instanceof Map){r=new Map,e.set(t,r);for(const[s,c]of t.entries())r.set(s,W_(c,e))}else if(t instanceof Set){r=new Set,e.set(t,r);for(const s of t)r.add(W_(s,e))}else if(t instanceof Object){r={},e.set(t,r);for(const[s,c]of Object.entries(t))r[s]=W_(c,e)}else throw Error(`Unable to clone ${t}`);return r}class Uu{constructor(e){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new _S,this._blacklist=new _S,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(Tu.notType)}),this.type=e.type,this._typeCheck=e.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},e==null?void 0:e.spec),this.withMutation(r=>{r.nonNullable()})}get _type(){return this.type}clone(e){if(this._mutate)return e&&Object.assign(this.spec,e),this;const r=Object.create(Object.getPrototypeOf(this));return r.type=this.type,r._typeCheck=this._typeCheck,r._whitelist=this._whitelist.clone(),r._blacklist=this._blacklist.clone(),r.internalTests=Object.assign({},this.internalTests),r.exclusiveTests=Object.assign({},this.exclusiveTests),r.deps=[...this.deps],r.conditions=[...this.conditions],r.tests=[...this.tests],r.transforms=[...this.transforms],r.spec=W_(Object.assign({},this.spec,e)),r}label(e){let r=this.clone();return r.spec.label=e,r}meta(...e){if(e.length===0)return this.spec.meta;let r=this.clone();return r.spec.meta=Object.assign(r.spec.meta||{},e[0]),r}withMutation(e){let r=this._mutate;this._mutate=!0;let s=e(this);return this._mutate=r,s}concat(e){if(!e||e===this)return this;if(e.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${e.type}`);let r=this,s=e.clone();const c=Object.assign({},r.spec,s.spec);return s.spec=c,s.internalTests=Object.assign({},r.internalTests,s.internalTests),s._whitelist=r._whitelist.merge(e._whitelist,e._blacklist),s._blacklist=r._blacklist.merge(e._blacklist,e._whitelist),s.tests=r.tests,s.exclusiveTests=r.exclusiveTests,s.withMutation(d=>{e.tests.forEach(_=>{d.test(_.OPTIONS)})}),s.transforms=[...r.transforms,...s.transforms],s}isType(e){return e==null?!!(this.spec.nullable&&e===null||this.spec.optional&&e===void 0):this._typeCheck(e)}resolve(e){let r=this;if(r.conditions.length){let s=r.conditions;r=r.clone(),r.conditions=[],r=s.reduce((c,d)=>d.resolve(c,e),r),r=r.resolve(e)}return r}resolveOptions(e){var r,s,c,d;return Object.assign({},e,{from:e.from||[],strict:(r=e.strict)!=null?r:this.spec.strict,abortEarly:(s=e.abortEarly)!=null?s:this.spec.abortEarly,recursive:(c=e.recursive)!=null?c:this.spec.recursive,disableStackTrace:(d=e.disableStackTrace)!=null?d:this.spec.disableStackTrace})}cast(e,r={}){let s=this.resolve(Object.assign({value:e},r)),c=r.assert==="ignore-optionality",d=s._cast(e,r);if(r.assert!==!1&&!s.isType(d)){if(c&&hm(d))return d;let _=Cf(e),x=Cf(d);throw new TypeError(`The value of ${r.path||"field"} could not be cast to a value that satisfies the schema type: "${s.type}". 

attempted value: ${_} 
`+(x!==_?`result of cast: ${x}`:""))}return d}_cast(e,r){let s=e===void 0?e:this.transforms.reduce((c,d)=>d.call(this,c,e,this),e);return s===void 0&&(s=this.getDefault(r)),s}_validate(e,r={},s,c){let{path:d,originalValue:_=e,strict:x=this.spec.strict}=r,a=e;x||(a=this._cast(a,Object.assign({assert:!1},r)));let I=[];for(let M of Object.values(this.internalTests))M&&I.push(M);this.runTests({path:d,value:a,originalValue:_,options:r,tests:I},s,M=>{if(M.length)return c(M,a);this.runTests({path:d,value:a,originalValue:_,options:r,tests:this.tests},s,c)})}runTests(e,r,s){let c=!1,{tests:d,value:_,originalValue:x,path:a,options:I}=e,M=re=>{c||(c=!0,r(re,_))},D=re=>{c||(c=!0,s(re,_))},L=d.length,G=[];if(!L)return D([]);let Q={value:_,originalValue:x,path:a,options:I,schema:this};for(let re=0;re<d.length;re++){const ee=d[re];ee(Q,M,function(H){H&&(Array.isArray(H)?G.push(...H):G.push(H)),--L<=0&&D(G)})}}asNestedTest({key:e,index:r,parent:s,parentPath:c,originalParent:d,options:_}){const x=e??r;if(x==null)throw TypeError("Must include `key` or `index` for nested validations");const a=typeof x=="number";let I=s[x];const M=Object.assign({},_,{strict:!0,parent:s,value:I,originalValue:d[x],key:void 0,[a?"index":"key"]:x,path:a||x.includes(".")?`${c||""}[${a?x:`"${x}"`}]`:(c?`${c}.`:"")+e});return(D,L,G)=>this.resolve(M)._validate(I,M,L,G)}validate(e,r){var s;let c=this.resolve(Object.assign({},r,{value:e})),d=(s=r==null?void 0:r.disableStackTrace)!=null?s:c.spec.disableStackTrace;return new Promise((_,x)=>c._validate(e,r,(a,I)=>{za.isError(a)&&(a.value=I),x(a)},(a,I)=>{a.length?x(new za(a,I,void 0,void 0,d)):_(I)}))}validateSync(e,r){var s;let c=this.resolve(Object.assign({},r,{value:e})),d,_=(s=r==null?void 0:r.disableStackTrace)!=null?s:c.spec.disableStackTrace;return c._validate(e,Object.assign({},r,{sync:!0}),(x,a)=>{throw za.isError(x)&&(x.value=a),x},(x,a)=>{if(x.length)throw new za(x,e,void 0,void 0,_);d=a}),d}isValid(e,r){return this.validate(e,r).then(()=>!0,s=>{if(za.isError(s))return!1;throw s})}isValidSync(e,r){try{return this.validateSync(e,r),!0}catch(s){if(za.isError(s))return!1;throw s}}_getDefault(e){let r=this.spec.default;return r==null?r:typeof r=="function"?r.call(this,e):W_(r)}getDefault(e){return this.resolve(e||{})._getDefault(e)}default(e){return arguments.length===0?this._getDefault():this.clone({default:e})}strict(e=!0){return this.clone({strict:e})}nullability(e,r){const s=this.clone({nullable:e});return s.internalTests.nullable=__({message:r,name:"nullable",test(c){return c===null?this.schema.spec.nullable:!0}}),s}optionality(e,r){const s=this.clone({optional:e});return s.internalTests.optionality=__({message:r,name:"optionality",test(c){return c===void 0?this.schema.spec.optional:!0}}),s}optional(){return this.optionality(!0)}defined(e=Tu.defined){return this.optionality(!1,e)}nullable(){return this.nullability(!0)}nonNullable(e=Tu.notNull){return this.nullability(!1,e)}required(e=Tu.required){return this.clone().withMutation(r=>r.nonNullable(e).defined(e))}notRequired(){return this.clone().withMutation(e=>e.nullable().optional())}transform(e){let r=this.clone();return r.transforms.push(e),r}test(...e){let r;if(e.length===1?typeof e[0]=="function"?r={test:e[0]}:r=e[0]:e.length===2?r={name:e[0],test:e[1]}:r={name:e[0],message:e[1],test:e[2]},r.message===void 0&&(r.message=Tu.default),typeof r.test!="function")throw new TypeError("`test` is a required parameters");let s=this.clone(),c=__(r),d=r.exclusive||r.name&&s.exclusiveTests[r.name]===!0;if(r.exclusive&&!r.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return r.name&&(s.exclusiveTests[r.name]=!!r.exclusive),s.tests=s.tests.filter(_=>!(_.OPTIONS.name===r.name&&(d||_.OPTIONS.test===c.OPTIONS.test))),s.tests.push(c),s}when(e,r){!Array.isArray(e)&&typeof e!="string"&&(r=e,e=".");let s=this.clone(),c=P7(e).map(d=>new ng(d));return c.forEach(d=>{d.isSibling&&s.deps.push(d.key)}),s.conditions.push(typeof r=="function"?new gS(c,r):gS.fromOptions(c,r)),s}typeError(e){let r=this.clone();return r.internalTests.typeError=__({message:e,name:"typeError",skipAbsent:!0,test(s){return this.schema._typeCheck(s)?!0:this.createError({params:{type:this.schema.type}})}}),r}oneOf(e,r=Tu.oneOf){let s=this.clone();return e.forEach(c=>{s._whitelist.add(c),s._blacklist.delete(c)}),s.internalTests.whiteList=__({message:r,name:"oneOf",skipAbsent:!0,test(c){let d=this.schema._whitelist,_=d.resolveAll(this.resolve);return _.includes(c)?!0:this.createError({params:{values:Array.from(d).join(", "),resolved:_}})}}),s}notOneOf(e,r=Tu.notOneOf){let s=this.clone();return e.forEach(c=>{s._blacklist.add(c),s._whitelist.delete(c)}),s.internalTests.blacklist=__({message:r,name:"notOneOf",test(c){let d=this.schema._blacklist,_=d.resolveAll(this.resolve);return _.includes(c)?this.createError({params:{values:Array.from(d).join(", "),resolved:_}}):!0}}),s}strip(e=!0){let r=this.clone();return r.spec.strip=e,r}describe(e){const r=(e?this.resolve(e):this).clone(),{label:s,meta:c,optional:d,nullable:_}=r.spec;return{meta:c,label:s,optional:d,nullable:_,default:r.getDefault(e),type:r.type,oneOf:r._whitelist.describe(),notOneOf:r._blacklist.describe(),tests:r.tests.map(a=>({name:a.OPTIONS.name,params:a.OPTIONS.params})).filter((a,I,M)=>M.findIndex(D=>D.name===a.name)===I)}}}Uu.prototype.__isYupSchema__=!0;for(const t of["validate","validateSync"])Uu.prototype[`${t}At`]=function(e,r,s={}){const{parent:c,parentPath:d,schema:_}=Nae(this,e,r,s.context);return _[t](c&&c[d],Object.assign({},s,{parent:c,path:e}))};for(const t of["equals","is"])Uu.prototype[t]=Uu.prototype.oneOf;for(const t of["not","nope"])Uu.prototype[t]=Uu.prototype.notOneOf;const Fae=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function Bae(t){const e=nk(t);if(!e)return Date.parse?Date.parse(t):Number.NaN;if(e.z===void 0&&e.plusMinus===void 0)return new Date(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond).valueOf();let r=0;return e.z!=="Z"&&e.plusMinus!==void 0&&(r=e.hourOffset*60+e.minuteOffset,e.plusMinus==="+"&&(r=0-r)),Date.UTC(e.year,e.month,e.day,e.hour,e.minute+r,e.second,e.millisecond)}function nk(t){var e,r;const s=Fae.exec(t);return s?{year:Th(s[1]),month:Th(s[2],1)-1,day:Th(s[3],1),hour:Th(s[4]),minute:Th(s[5]),second:Th(s[6]),millisecond:s[7]?Th(s[7].substring(0,3)):0,precision:(e=(r=s[7])==null?void 0:r.length)!=null?e:void 0,z:s[8]||void 0,plusMinus:s[9]||void 0,hourOffset:Th(s[10]),minuteOffset:Th(s[11])}:null}function Th(t,e=0){return Number(t)||e}let jae=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Uae=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,Vae=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,$ae="^\\d{4}-\\d{2}-\\d{2}",qae="\\d{2}:\\d{2}:\\d{2}",Gae="(([+-]\\d{2}(:?\\d{2})?)|Z)",Wae=new RegExp(`${$ae}T${qae}(\\.\\d+)?${Gae}$`),Hae=t=>hm(t)||t===t.trim(),Zae={}.toString();function iy(){return new O7}class O7 extends Uu{constructor(){super({type:"string",check(e){return e instanceof String&&(e=e.valueOf()),typeof e=="string"}}),this.withMutation(()=>{this.transform((e,r,s)=>{if(!s.spec.coerce||s.isType(e)||Array.isArray(e))return e;const c=e!=null&&e.toString?e.toString():e;return c===Zae?e:c})})}required(e){return super.required(e).withMutation(r=>r.test({message:e||Tu.required,name:"required",skipAbsent:!0,test:s=>!!s.length}))}notRequired(){return super.notRequired().withMutation(e=>(e.tests=e.tests.filter(r=>r.OPTIONS.name!=="required"),e))}length(e,r=ka.length){return this.test({message:r,name:"length",exclusive:!0,params:{length:e},skipAbsent:!0,test(s){return s.length===this.resolve(e)}})}min(e,r=ka.min){return this.test({message:r,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(s){return s.length>=this.resolve(e)}})}max(e,r=ka.max){return this.test({name:"max",exclusive:!0,message:r,params:{max:e},skipAbsent:!0,test(s){return s.length<=this.resolve(e)}})}matches(e,r){let s=!1,c,d;return r&&(typeof r=="object"?{excludeEmptyString:s=!1,message:c,name:d}=r:c=r),this.test({name:d||"matches",message:c||ka.matches,params:{regex:e},skipAbsent:!0,test:_=>_===""&&s||_.search(e)!==-1})}email(e=ka.email){return this.matches(jae,{name:"email",message:e,excludeEmptyString:!0})}url(e=ka.url){return this.matches(Uae,{name:"url",message:e,excludeEmptyString:!0})}uuid(e=ka.uuid){return this.matches(Vae,{name:"uuid",message:e,excludeEmptyString:!1})}datetime(e){let r="",s,c;return e&&(typeof e=="object"?{message:r="",allowOffset:s=!1,precision:c=void 0}=e:r=e),this.matches(Wae,{name:"datetime",message:r||ka.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:r||ka.datetime_offset,params:{allowOffset:s},skipAbsent:!0,test:d=>{if(!d||s)return!0;const _=nk(d);return _?!!_.z:!1}}).test({name:"datetime_precision",message:r||ka.datetime_precision,params:{precision:c},skipAbsent:!0,test:d=>{if(!d||c==null)return!0;const _=nk(d);return _?_.precision===c:!1}})}ensure(){return this.default("").transform(e=>e===null?"":e)}trim(e=ka.trim){return this.transform(r=>r!=null?r.trim():r).test({message:e,name:"trim",test:Hae})}lowercase(e=ka.lowercase){return this.transform(r=>hm(r)?r:r.toLowerCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:r=>hm(r)||r===r.toLowerCase()})}uppercase(e=ka.uppercase){return this.transform(r=>hm(r)?r:r.toUpperCase()).test({message:e,name:"string_case",exclusive:!0,skipAbsent:!0,test:r=>hm(r)||r===r.toUpperCase()})}}iy.prototype=O7.prototype;let Xae=new Date(""),Kae=t=>Object.prototype.toString.call(t)==="[object Date]";class ZI extends Uu{constructor(){super({type:"date",check(e){return Kae(e)&&!isNaN(e.getTime())}}),this.withMutation(()=>{this.transform((e,r,s)=>!s.spec.coerce||s.isType(e)||e===null?e:(e=Bae(e),isNaN(e)?ZI.INVALID_DATE:new Date(e)))})}prepareParam(e,r){let s;if(ng.isRef(e))s=e;else{let c=this.cast(e);if(!this._typeCheck(c))throw new TypeError(`\`${r}\` must be a Date or a value that can be \`cast()\` to a Date`);s=c}return s}min(e,r=ek.min){let s=this.prepareParam(e,"min");return this.test({message:r,name:"min",exclusive:!0,params:{min:e},skipAbsent:!0,test(c){return c>=this.resolve(s)}})}max(e,r=ek.max){let s=this.prepareParam(e,"max");return this.test({message:r,name:"max",exclusive:!0,params:{max:e},skipAbsent:!0,test(c){return c<=this.resolve(s)}})}}ZI.INVALID_DATE=Xae;ZI.prototype;function Qae(t,e=[]){let r=[],s=new Set,c=new Set(e.map(([_,x])=>`${_}-${x}`));function d(_,x){let a=xm.split(_)[0];s.add(a),c.has(`${x}-${a}`)||r.push([x,a])}for(const _ of Object.keys(t)){let x=t[_];s.add(_),ng.isRef(x)&&x.isSibling?d(x.path,_):GO(x)&&"deps"in x&&x.deps.forEach(a=>d(a,_))}return Sae.array(Array.from(s),r).reverse()}function pj(t,e){let r=1/0;return t.some((s,c)=>{var d;if((d=e.path)!=null&&d.includes(s))return r=c,!0}),r}function D7(t){return(e,r)=>pj(t,e)-pj(t,r)}const Yae=(t,e,r)=>{if(typeof t!="string")return t;let s=t;try{s=JSON.parse(t)}catch{}return r.isType(s)?s:t};function gE(t){if("fields"in t){const e={};for(const[r,s]of Object.entries(t.fields))e[r]=gE(s);return t.setFields(e)}if(t.type==="array"){const e=t.optional();return e.innerType&&(e.innerType=gE(e.innerType)),e}return t.type==="tuple"?t.optional().clone({types:t.spec.types.map(gE)}):"optional"in t?t.optional():t}const Jae=(t,e)=>{const r=[...xm.normalizePath(e)];if(r.length===1)return r[0]in t;let s=r.pop(),c=xm.getter(xm.join(r),!0)(t);return!!(c&&s in c)};let mj=t=>Object.prototype.toString.call(t)==="[object Object]";function ele(t,e){let r=Object.keys(t.fields);return Object.keys(e).filter(s=>r.indexOf(s)===-1)}const tle=D7([]);function WO(t){return new L7(t)}class L7 extends Uu{constructor(e){super({type:"object",check(r){return mj(r)||typeof r=="function"}}),this.fields=Object.create(null),this._sortErrors=tle,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{e&&this.shape(e)})}_cast(e,r={}){var s;let c=super._cast(e,r);if(c===void 0)return this.getDefault(r);if(!this._typeCheck(c))return c;let d=this.fields,_=(s=r.stripUnknown)!=null?s:this.spec.noUnknown,x=[].concat(this._nodes,Object.keys(c).filter(D=>!this._nodes.includes(D))),a={},I=Object.assign({},r,{parent:a,__validating:r.__validating||!1}),M=!1;for(const D of x){let L=d[D],G=D in c;if(L){let Q,re=c[D];I.path=(r.path?`${r.path}.`:"")+D,L=L.resolve({value:re,context:r.context,parent:a});let ee=L instanceof Uu?L.spec:void 0,U=ee==null?void 0:ee.strict;if(ee!=null&&ee.strip){M=M||D in c;continue}Q=!r.__validating||!U?L.cast(c[D],I):c[D],Q!==void 0&&(a[D]=Q)}else G&&!_&&(a[D]=c[D]);(G!==D in a||a[D]!==c[D])&&(M=!0)}return M?a:c}_validate(e,r={},s,c){let{from:d=[],originalValue:_=e,recursive:x=this.spec.recursive}=r;r.from=[{schema:this,value:_},...d],r.__validating=!0,r.originalValue=_,super._validate(e,r,s,(a,I)=>{if(!x||!mj(I)){c(a,I);return}_=_||I;let M=[];for(let D of this._nodes){let L=this.fields[D];!L||ng.isRef(L)||M.push(L.asNestedTest({options:r,key:D,parent:I,parentPath:r.path,originalParent:_}))}this.runTests({tests:M,value:I,originalValue:_,options:r},s,D=>{c(D.sort(this._sortErrors).concat(a),I)})})}clone(e){const r=super.clone(e);return r.fields=Object.assign({},this.fields),r._nodes=this._nodes,r._excludedEdges=this._excludedEdges,r._sortErrors=this._sortErrors,r}concat(e){let r=super.concat(e),s=r.fields;for(let[c,d]of Object.entries(this.fields)){const _=s[c];s[c]=_===void 0?d:_}return r.withMutation(c=>c.setFields(s,[...this._excludedEdges,...e._excludedEdges]))}_getDefault(e){if("default"in this.spec)return super._getDefault(e);if(!this._nodes.length)return;let r={};return this._nodes.forEach(s=>{var c;const d=this.fields[s];let _=e;(c=_)!=null&&c.value&&(_=Object.assign({},_,{parent:_.value,value:_.value[s]})),r[s]=d&&"getDefault"in d?d.getDefault(_):void 0}),r}setFields(e,r){let s=this.clone();return s.fields=e,s._nodes=Qae(e,r),s._sortErrors=D7(Object.keys(e)),r&&(s._excludedEdges=r),s}shape(e,r=[]){return this.clone().withMutation(s=>{let c=s._excludedEdges;return r.length&&(Array.isArray(r[0])||(r=[r]),c=[...s._excludedEdges,...r]),s.setFields(Object.assign(s.fields,e),c)})}partial(){const e={};for(const[r,s]of Object.entries(this.fields))e[r]="optional"in s&&s.optional instanceof Function?s.optional():s;return this.setFields(e)}deepPartial(){return gE(this)}pick(e){const r={};for(const s of e)this.fields[s]&&(r[s]=this.fields[s]);return this.setFields(r,this._excludedEdges.filter(([s,c])=>e.includes(s)&&e.includes(c)))}omit(e){const r=[];for(const s of Object.keys(this.fields))e.includes(s)||r.push(s);return this.pick(r)}from(e,r,s){let c=xm.getter(e,!0);return this.transform(d=>{if(!d)return d;let _=d;return Jae(d,e)&&(_=Object.assign({},d),s||delete _[e],_[r]=c(d)),_})}json(){return this.transform(Yae)}noUnknown(e=!0,r=tk.noUnknown){typeof e!="boolean"&&(r=e,e=!0);let s=this.test({name:"noUnknown",exclusive:!0,message:r,test(c){if(c==null)return!0;const d=ele(this.schema,c);return!e||d.length===0||this.createError({params:{unknown:d.join(", ")}})}});return s.spec.noUnknown=e,s}unknown(e=!0,r=tk.noUnknown){return this.noUnknown(!e,r)}transformKeys(e){return this.transform(r=>{if(!r)return r;const s={};for(const c of Object.keys(r))s[e(c)]=r[c];return s})}camelCase(){return this.transformKeys(sR.camelCase)}snakeCase(){return this.transformKeys(sR.snakeCase)}constantCase(){return this.transformKeys(e=>sR.snakeCase(e).toUpperCase())}describe(e){const r=(e?this.resolve(e):this).clone(),s=super.describe(e);s.fields={};for(const[d,_]of Object.entries(r.fields)){var c;let x=e;(c=x)!=null&&c.value&&(x=Object.assign({},x,{parent:x.value,value:x.value[d]})),s.fields[d]=_.describe(x)}return s}}WO.prototype=L7.prototype;var gj={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z7=function(t){const e=[];let r=0;for(let s=0;s<t.length;s++){let c=t.charCodeAt(s);c<128?e[r++]=c:c<2048?(e[r++]=c>>6|192,e[r++]=c&63|128):(c&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(c=65536+((c&1023)<<10)+(t.charCodeAt(++s)&1023),e[r++]=c>>18|240,e[r++]=c>>12&63|128,e[r++]=c>>6&63|128,e[r++]=c&63|128):(e[r++]=c>>12|224,e[r++]=c>>6&63|128,e[r++]=c&63|128)}return e},nle=function(t){const e=[];let r=0,s=0;for(;r<t.length;){const c=t[r++];if(c<128)e[s++]=String.fromCharCode(c);else if(c>191&&c<224){const d=t[r++];e[s++]=String.fromCharCode((c&31)<<6|d&63)}else if(c>239&&c<365){const d=t[r++],_=t[r++],x=t[r++],a=((c&7)<<18|(d&63)<<12|(_&63)<<6|x&63)-65536;e[s++]=String.fromCharCode(55296+(a>>10)),e[s++]=String.fromCharCode(56320+(a&1023))}else{const d=t[r++],_=t[r++];e[s++]=String.fromCharCode((c&15)<<12|(d&63)<<6|_&63)}}return e.join("")},N7={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let c=0;c<t.length;c+=3){const d=t[c],_=c+1<t.length,x=_?t[c+1]:0,a=c+2<t.length,I=a?t[c+2]:0,M=d>>2,D=(d&3)<<4|x>>4;let L=(x&15)<<2|I>>6,G=I&63;a||(G=64,_||(L=64)),s.push(r[M],r[D],r[L],r[G])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(z7(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):nle(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let c=0;c<t.length;){const d=r[t.charAt(c++)],x=c<t.length?r[t.charAt(c)]:0;++c;const I=c<t.length?r[t.charAt(c)]:64;++c;const D=c<t.length?r[t.charAt(c)]:64;if(++c,d==null||x==null||I==null||D==null)throw new rle;const L=d<<2|x>>4;if(s.push(L),I!==64){const G=x<<4&240|I>>2;if(s.push(G),D!==64){const Q=I<<6&192|D;s.push(Q)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class rle extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ile=function(t){const e=z7(t);return N7.encodeByteArray(e,!0)},yS=function(t){return ile(t).replace(/\./g,"")},F7=function(t){try{return N7.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sle(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ole=()=>sle().__FIREBASE_DEFAULTS__,ale=()=>{if(typeof process>"u"||typeof gj>"u")return;const t=gj.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},lle=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&F7(t[1]);return e&&JSON.parse(e)},XI=()=>{try{return ole()||ale()||lle()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},B7=t=>{var e,r;return(r=(e=XI())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},j7=t=>{const e=B7(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),s]:[e.substring(0,r),s]},U7=()=>{var t;return(t=XI())===null||t===void 0?void 0:t.config},V7=t=>{var e;return(e=XI())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cle{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,s)=>{r?this.reject(r):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $7(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},s=e||"demo-project",c=t.iat||0,d=t.sub||t.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const _=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:c,exp:c+3600,auth_time:c,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},t);return[yS(JSON.stringify(r)),yS(JSON.stringify(_)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ule(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Jo())}function hle(){var t;const e=(t=XI())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function dle(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function fle(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ple(){const t=Jo();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function mle(){return!hle()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function gle(){try{return typeof indexedDB=="object"}catch{return!1}}function _le(){return new Promise((t,e)=>{try{let r=!0;const s="validate-browser-context-for-indexeddb-analytics-module",c=self.indexedDB.open(s);c.onsuccess=()=>{c.result.close(),r||self.indexedDB.deleteDatabase(s),t(!0)},c.onupgradeneeded=()=>{r=!1},c.onerror=()=>{var d;e(((d=c.error)===null||d===void 0?void 0:d.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yle="FirebaseError";class Wu extends Error{constructor(e,r,s){super(r),this.code=e,this.customData=s,this.name=yle,Object.setPrototypeOf(this,Wu.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Kx.prototype.create)}}class Kx{constructor(e,r,s){this.service=e,this.serviceName=r,this.errors=s}create(e,...r){const s=r[0]||{},c=`${this.service}/${e}`,d=this.errors[e],_=d?vle(d,s):"Error",x=`${this.serviceName}: ${_} (${c}).`;return new Wu(c,x,s)}}function vle(t,e){return t.replace(xle,(r,s)=>{const c=e[s];return c!=null?String(c):`<${s}?>`})}const xle=/\{\$([^}]+)}/g;function ble(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Sy(t,e){if(t===e)return!0;const r=Object.keys(t),s=Object.keys(e);for(const c of r){if(!s.includes(c))return!1;const d=t[c],_=e[c];if(_j(d)&&_j(_)){if(!Sy(d,_))return!1}else if(d!==_)return!1}for(const c of s)if(!r.includes(c))return!1;return!0}function _j(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qx(t){const e=[];for(const[r,s]of Object.entries(t))Array.isArray(s)?s.forEach(c=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(c))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function n1(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[c,d]=s.split("=");e[decodeURIComponent(c)]=decodeURIComponent(d)}}),e}function r1(t){const e=t.indexOf("?");if(!e)return"";const r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}function wle(t,e){const r=new Tle(t,e);return r.subscribe.bind(r)}class Tle{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,s){let c;if(e===void 0&&r===void 0&&s===void 0)throw new Error("Missing Observer.");Ele(e,["next","error","complete"])?c=e:c={next:e,error:r,complete:s},c.next===void 0&&(c.next=oR),c.error===void 0&&(c.error=oR),c.complete===void 0&&(c.complete=oR);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?c.error(this.finalError):c.complete()}catch{}}),this.observers.push(c),d}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ele(t,e){if(typeof t!="object"||t===null)return!1;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function oR(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ds(t){return t&&t._delegate?t._delegate:t}class Lf{constructor(e,r,s){this.name=e,this.instanceFactory=r,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tm="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sle{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const s=new cle;if(this.instancesDeferred.set(r,s),this.isInitialized(r)||this.shouldAutoInitialize())try{const c=this.getOrInitializeService({instanceIdentifier:r});c&&s.resolve(c)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),c=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(d){if(c)return null;throw d}else{if(c)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Cle(e))try{this.getOrInitializeService({instanceIdentifier:tm})}catch{}for(const[r,s]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(r);try{const d=this.getOrInitializeService({instanceIdentifier:c});s.resolve(d)}catch{}}}}clearInstance(e=tm){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=tm){return this.instances.has(e)}getOptions(e=tm){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const c=this.getOrInitializeService({instanceIdentifier:s,options:r});for(const[d,_]of this.instancesDeferred.entries()){const x=this.normalizeInstanceIdentifier(d);s===x&&_.resolve(c)}return c}onInit(e,r){var s;const c=this.normalizeInstanceIdentifier(r),d=(s=this.onInitCallbacks.get(c))!==null&&s!==void 0?s:new Set;d.add(e),this.onInitCallbacks.set(c,d);const _=this.instances.get(c);return _&&e(_,c),()=>{d.delete(e)}}invokeOnInitCallbacks(e,r){const s=this.onInitCallbacks.get(r);if(s)for(const c of s)try{c(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Ile(e),options:r}),this.instances.set(e,s),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=tm){return this.component?this.component.multipleInstances?e:tm:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ile(t){return t===tm?void 0:t}function Cle(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ale{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new Sle(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qr;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Qr||(Qr={}));const Ple={debug:Qr.DEBUG,verbose:Qr.VERBOSE,info:Qr.INFO,warn:Qr.WARN,error:Qr.ERROR,silent:Qr.SILENT},Rle=Qr.INFO,Mle={[Qr.DEBUG]:"log",[Qr.VERBOSE]:"log",[Qr.INFO]:"info",[Qr.WARN]:"warn",[Qr.ERROR]:"error"},kle=(t,e,...r)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),c=Mle[e];if(c)console[c](`[${s}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class HO{constructor(e){this.name=e,this._logLevel=Rle,this._logHandler=kle,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Qr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Ple[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Qr.DEBUG,...e),this._logHandler(this,Qr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Qr.VERBOSE,...e),this._logHandler(this,Qr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Qr.INFO,...e),this._logHandler(this,Qr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Qr.WARN,...e),this._logHandler(this,Qr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Qr.ERROR,...e),this._logHandler(this,Qr.ERROR,...e)}}const Ole=(t,e)=>e.some(r=>t instanceof r);let yj,vj;function Dle(){return yj||(yj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Lle(){return vj||(vj=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const q7=new WeakMap,rk=new WeakMap,G7=new WeakMap,aR=new WeakMap,ZO=new WeakMap;function zle(t){const e=new Promise((r,s)=>{const c=()=>{t.removeEventListener("success",d),t.removeEventListener("error",_)},d=()=>{r(Af(t.result)),c()},_=()=>{s(t.error),c()};t.addEventListener("success",d),t.addEventListener("error",_)});return e.then(r=>{r instanceof IDBCursor&&q7.set(r,t)}).catch(()=>{}),ZO.set(e,t),e}function Nle(t){if(rk.has(t))return;const e=new Promise((r,s)=>{const c=()=>{t.removeEventListener("complete",d),t.removeEventListener("error",_),t.removeEventListener("abort",_)},d=()=>{r(),c()},_=()=>{s(t.error||new DOMException("AbortError","AbortError")),c()};t.addEventListener("complete",d),t.addEventListener("error",_),t.addEventListener("abort",_)});rk.set(t,e)}let ik={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return rk.get(t);if(e==="objectStoreNames")return t.objectStoreNames||G7.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Af(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Fle(t){ik=t(ik)}function Ble(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const s=t.call(lR(this),e,...r);return G7.set(s,e.sort?e.sort():[e]),Af(s)}:Lle().includes(t)?function(...e){return t.apply(lR(this),e),Af(q7.get(this))}:function(...e){return Af(t.apply(lR(this),e))}}function jle(t){return typeof t=="function"?Ble(t):(t instanceof IDBTransaction&&Nle(t),Ole(t,Dle())?new Proxy(t,ik):t)}function Af(t){if(t instanceof IDBRequest)return zle(t);if(aR.has(t))return aR.get(t);const e=jle(t);return e!==t&&(aR.set(t,e),ZO.set(e,t)),e}const lR=t=>ZO.get(t);function Ule(t,e,{blocked:r,upgrade:s,blocking:c,terminated:d}={}){const _=indexedDB.open(t,e),x=Af(_);return s&&_.addEventListener("upgradeneeded",a=>{s(Af(_.result),a.oldVersion,a.newVersion,Af(_.transaction),a)}),r&&_.addEventListener("blocked",a=>r(a.oldVersion,a.newVersion,a)),x.then(a=>{d&&a.addEventListener("close",()=>d()),c&&a.addEventListener("versionchange",I=>c(I.oldVersion,I.newVersion,I))}).catch(()=>{}),x}const Vle=["get","getKey","getAll","getAllKeys","count"],$le=["put","add","delete","clear"],cR=new Map;function xj(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(cR.get(e))return cR.get(e);const r=e.replace(/FromIndex$/,""),s=e!==r,c=$le.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(c||Vle.includes(r)))return;const d=async function(_,...x){const a=this.transaction(_,c?"readwrite":"readonly");let I=a.store;return s&&(I=I.index(x.shift())),(await Promise.all([I[r](...x),c&&a.done]))[0]};return cR.set(e,d),d}Fle(t=>({...t,get:(e,r,s)=>xj(e,r)||t.get(e,r,s),has:(e,r)=>!!xj(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qle{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(Gle(r)){const s=r.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(r=>r).join(" ")}}function Gle(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const sk="@firebase/app",bj="0.10.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh=new HO("@firebase/app"),Wle="@firebase/app-compat",Hle="@firebase/analytics-compat",Zle="@firebase/analytics",Xle="@firebase/app-check-compat",Kle="@firebase/app-check",Qle="@firebase/auth",Yle="@firebase/auth-compat",Jle="@firebase/database",ece="@firebase/database-compat",tce="@firebase/functions",nce="@firebase/functions-compat",rce="@firebase/installations",ice="@firebase/installations-compat",sce="@firebase/messaging",oce="@firebase/messaging-compat",ace="@firebase/performance",lce="@firebase/performance-compat",cce="@firebase/remote-config",uce="@firebase/remote-config-compat",hce="@firebase/storage",dce="@firebase/storage-compat",fce="@firebase/firestore",pce="@firebase/vertexai-preview",mce="@firebase/firestore-compat",gce="firebase",_ce="10.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ok="[DEFAULT]",yce={[sk]:"fire-core",[Wle]:"fire-core-compat",[Zle]:"fire-analytics",[Hle]:"fire-analytics-compat",[Kle]:"fire-app-check",[Xle]:"fire-app-check-compat",[Qle]:"fire-auth",[Yle]:"fire-auth-compat",[Jle]:"fire-rtdb",[ece]:"fire-rtdb-compat",[tce]:"fire-fn",[nce]:"fire-fn-compat",[rce]:"fire-iid",[ice]:"fire-iid-compat",[sce]:"fire-fcm",[oce]:"fire-fcm-compat",[ace]:"fire-perf",[lce]:"fire-perf-compat",[cce]:"fire-rc",[uce]:"fire-rc-compat",[hce]:"fire-gcs",[dce]:"fire-gcs-compat",[fce]:"fire-fst",[mce]:"fire-fst-compat",[pce]:"fire-vertex","fire-js":"fire-js",[gce]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vS=new Map,vce=new Map,ak=new Map;function wj(t,e){try{t.container.addComponent(e)}catch(r){Wh.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function Dm(t){const e=t.name;if(ak.has(e))return Wh.debug(`There were multiple attempts to register component ${e}.`),!1;ak.set(e,t);for(const r of vS.values())wj(r,t);for(const r of vce.values())wj(r,t);return!0}function KI(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function Lc(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xce={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Pf=new Kx("app","Firebase",xce);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bce{constructor(e,r,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Lf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Pf.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rg=_ce;function W7(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:ok,automaticDataCollectionEnabled:!1},e),c=s.name;if(typeof c!="string"||!c)throw Pf.create("bad-app-name",{appName:String(c)});if(r||(r=U7()),!r)throw Pf.create("no-options");const d=vS.get(c);if(d){if(Sy(r,d.options)&&Sy(s,d.config))return d;throw Pf.create("duplicate-app",{appName:c})}const _=new Ale(c);for(const a of ak.values())_.addComponent(a);const x=new bce(r,s,_);return vS.set(c,x),x}function XO(t=ok){const e=vS.get(t);if(!e&&t===ok&&U7())return W7();if(!e)throw Pf.create("no-app",{appName:t});return e}function zu(t,e,r){var s;let c=(s=yce[t])!==null&&s!==void 0?s:t;r&&(c+=`-${r}`);const d=c.match(/\s|\//),_=e.match(/\s|\//);if(d||_){const x=[`Unable to register library "${c}" with version "${e}":`];d&&x.push(`library name "${c}" contains illegal characters (whitespace or "/")`),d&&_&&x.push("and"),_&&x.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Wh.warn(x.join(" "));return}Dm(new Lf(`${c}-version`,()=>({library:c,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wce="firebase-heartbeat-database",Tce=1,fx="firebase-heartbeat-store";let uR=null;function H7(){return uR||(uR=Ule(wce,Tce,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(fx)}catch(r){console.warn(r)}}}}).catch(t=>{throw Pf.create("idb-open",{originalErrorMessage:t.message})})),uR}async function Ece(t){try{const r=(await H7()).transaction(fx),s=await r.objectStore(fx).get(Z7(t));return await r.done,s}catch(e){if(e instanceof Wu)Wh.warn(e.message);else{const r=Pf.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Wh.warn(r.message)}}}async function Tj(t,e){try{const s=(await H7()).transaction(fx,"readwrite");await s.objectStore(fx).put(e,Z7(t)),await s.done}catch(r){if(r instanceof Wu)Wh.warn(r.message);else{const s=Pf.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});Wh.warn(s.message)}}}function Z7(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sce=1024,Ice=30*24*60*60*1e3;class Cce{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new Pce(r),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,r;try{const c=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=Ej();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(_=>_.date===d)?void 0:(this._heartbeatsCache.heartbeats.push({date:d,agent:c}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(_=>{const x=new Date(_.date).valueOf();return Date.now()-x<=Ice}),this._storage.overwrite(this._heartbeatsCache))}catch(s){Wh.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=Ej(),{heartbeatsToSend:s,unsentEntries:c}=Ace(this._heartbeatsCache.heartbeats),d=yS(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=r,c.length>0?(this._heartbeatsCache.heartbeats=c,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(r){return Wh.warn(r),""}}}function Ej(){return new Date().toISOString().substring(0,10)}function Ace(t,e=Sce){const r=[];let s=t.slice();for(const c of t){const d=r.find(_=>_.agent===c.agent);if(d){if(d.dates.push(c.date),Sj(r)>e){d.dates.pop();break}}else if(r.push({agent:c.agent,dates:[c.date]}),Sj(r)>e){r.pop();break}s=s.slice(1)}return{heartbeatsToSend:r,unsentEntries:s}}class Pce{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return gle()?_le().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await Ece(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return Tj(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const c=await this.read();return Tj(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:c.lastSentHeartbeatDate,heartbeats:[...c.heartbeats,...e.heartbeats]})}else return}}function Sj(t){return yS(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rce(t){Dm(new Lf("platform-logger",e=>new qle(e),"PRIVATE")),Dm(new Lf("heartbeat",e=>new Cce(e),"PRIVATE")),zu(sk,bj,t),zu(sk,bj,"esm2017"),zu("fire-js","")}Rce("");var Mce="firebase",kce="10.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zu(Mce,kce,"app");function KO(t,e){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,s=Object.getOwnPropertySymbols(t);c<s.length;c++)e.indexOf(s[c])<0&&Object.prototype.propertyIsEnumerable.call(t,s[c])&&(r[s[c]]=t[s[c]]);return r}function X7(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Oce=X7,K7=new Kx("auth","Firebase",X7());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xS=new HO("@firebase/auth");function Dce(t,...e){xS.logLevel<=Qr.WARN&&xS.warn(`Auth (${rg}): ${t}`,...e)}function _E(t,...e){xS.logLevel<=Qr.ERROR&&xS.error(`Auth (${rg}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ql(t,...e){throw YO(t,...e)}function jc(t,...e){return YO(t,...e)}function QO(t,e,r){const s=Object.assign(Object.assign({},Oce()),{[e]:r});return new Kx("auth","Firebase",s).create(e,{appName:t.name})}function Fh(t){return QO(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Lce(t,e,r){const s=r;if(!(e instanceof s))throw s.name!==e.constructor.name&&Ql(t,"argument-error"),QO(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function YO(t,...e){if(typeof t!="string"){const r=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(r,...s)}return K7.create(t,...e)}function vr(t,e,...r){if(!t)throw YO(e,...r)}function Dh(t){const e="INTERNAL ASSERTION FAILED: "+t;throw _E(e),new Error(e)}function Hh(t,e){t||Dh(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lk(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function zce(){return Ij()==="http:"||Ij()==="https:"}function Ij(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nce(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(zce()||dle()||"connection"in navigator)?navigator.onLine:!0}function Fce(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yx{constructor(e,r){this.shortDelay=e,this.longDelay=r,Hh(r>e,"Short delay should be less than long delay!"),this.isMobile=ule()||fle()}get(){return Nce()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JO(t,e){Hh(t.emulator,"Emulator should always be set here");const{url:r}=t.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q7{static initialize(e,r,s){this.fetchImpl=e,r&&(this.headersImpl=r),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Dh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Dh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Dh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bce={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jce=new Yx(3e4,6e4);function Zf(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Xf(t,e,r,s,c={}){return Y7(t,c,async()=>{let d={},_={};s&&(e==="GET"?_=s:d={body:JSON.stringify(s)});const x=Qx(Object.assign({key:t.config.apiKey},_)).slice(1),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),Q7.fetch()(J7(t,t.config.apiHost,r,x),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},d))})}async function Y7(t,e,r){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},Bce),e);try{const c=new Vce(t),d=await Promise.race([r(),c.promise]);c.clearNetworkTimeout();const _=await d.json();if("needConfirmation"in _)throw NT(t,"account-exists-with-different-credential",_);if(d.ok&&!("errorMessage"in _))return _;{const x=d.ok?_.errorMessage:_.error.message,[a,I]=x.split(" : ");if(a==="FEDERATED_USER_ID_ALREADY_LINKED")throw NT(t,"credential-already-in-use",_);if(a==="EMAIL_EXISTS")throw NT(t,"email-already-in-use",_);if(a==="USER_DISABLED")throw NT(t,"user-disabled",_);const M=s[a]||a.toLowerCase().replace(/[_\s]+/g,"-");if(I)throw QO(t,M,I);Ql(t,M)}}catch(c){if(c instanceof Wu)throw c;Ql(t,"network-request-failed",{message:String(c)})}}async function Jx(t,e,r,s,c={}){const d=await Xf(t,e,r,s,c);return"mfaPendingCredential"in d&&Ql(t,"multi-factor-auth-required",{_serverResponse:d}),d}function J7(t,e,r,s){const c=`${e}${r}?${s}`;return t.config.emulator?JO(t.config,c):`${t.config.apiScheme}://${c}`}function Uce(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Vce{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,s)=>{this.timer=setTimeout(()=>s(jc(this.auth,"network-request-failed")),jce.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function NT(t,e,r){const s={appName:t.name};r.email&&(s.email=r.email),r.phoneNumber&&(s.phoneNumber=r.phoneNumber);const c=jc(t,e,s);return c.customData._tokenResponse=r,c}function Cj(t){return t!==void 0&&t.enterprise!==void 0}class $ce{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===e)return Uce(r.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function qce(t,e){return Xf(t,"GET","/v2/recaptchaConfig",Zf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gce(t,e){return Xf(t,"POST","/v1/accounts:delete",e)}async function eq(t,e){return Xf(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A1(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Wce(t,e=!1){const r=Ds(t),s=await r.getIdToken(e),c=eD(s);vr(c&&c.exp&&c.auth_time&&c.iat,r.auth,"internal-error");const d=typeof c.firebase=="object"?c.firebase:void 0,_=d==null?void 0:d.sign_in_provider;return{claims:c,token:s,authTime:A1(hR(c.auth_time)),issuedAtTime:A1(hR(c.iat)),expirationTime:A1(hR(c.exp)),signInProvider:_||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function hR(t){return Number(t)*1e3}function eD(t){const[e,r,s]=t.split(".");if(e===void 0||r===void 0||s===void 0)return _E("JWT malformed, contained fewer than 3 sections"),null;try{const c=F7(r);return c?JSON.parse(c):(_E("Failed to decode base64 JWT payload"),null)}catch(c){return _E("Caught error parsing JWT payload as JSON",c==null?void 0:c.toString()),null}}function Aj(t){const e=eD(t);return vr(e,"internal-error"),vr(typeof e.exp<"u","internal-error"),vr(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function px(t,e,r=!1){if(r)return e;try{return await e}catch(s){throw s instanceof Wu&&Hce(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function Hce({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zce{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const c=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,c)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ck{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=A1(this.lastLoginAt),this.creationTime=A1(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bS(t){var e;const r=t.auth,s=await t.getIdToken(),c=await px(t,eq(r,{idToken:s}));vr(c==null?void 0:c.users.length,r,"internal-error");const d=c.users[0];t._notifyReloadListener(d);const _=!((e=d.providerUserInfo)===null||e===void 0)&&e.length?tq(d.providerUserInfo):[],x=Kce(t.providerData,_),a=t.isAnonymous,I=!(t.email&&d.passwordHash)&&!(x!=null&&x.length),M=a?I:!1,D={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:x,metadata:new ck(d.createdAt,d.lastLoginAt),isAnonymous:M};Object.assign(t,D)}async function Xce(t){const e=Ds(t);await bS(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Kce(t,e){return[...t.filter(s=>!e.some(c=>c.providerId===s.providerId)),...e]}function tq(t){return t.map(e=>{var{providerId:r}=e,s=KO(e,["providerId"]);return{providerId:r,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qce(t,e){const r=await Y7(t,{},async()=>{const s=Qx({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:c,apiKey:d}=t.config,_=J7(t,c,"/v1/token",`key=${d}`),x=await t._getAdditionalHeaders();return x["Content-Type"]="application/x-www-form-urlencoded",Q7.fetch()(_,{method:"POST",headers:x,body:s})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function Yce(t,e){return Xf(t,"POST","/v2/accounts:revokeToken",Zf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){vr(e.idToken,"internal-error"),vr(typeof e.idToken<"u","internal-error"),vr(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Aj(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){vr(e.length!==0,"internal-error");const r=Aj(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(vr(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:s,refreshToken:c,expiresIn:d}=await Qce(e,r);this.updateTokensAndExpiration(s,c,Number(d))}updateTokensAndExpiration(e,r,s){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,r){const{refreshToken:s,accessToken:c,expirationTime:d}=r,_=new sy;return s&&(vr(typeof s=="string","internal-error",{appName:e}),_.refreshToken=s),c&&(vr(typeof c=="string","internal-error",{appName:e}),_.accessToken=c),d&&(vr(typeof d=="number","internal-error",{appName:e}),_.expirationTime=d),_}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new sy,this.toJSON())}_performRefresh(){return Dh("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(t,e){vr(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Lh{constructor(e){var{uid:r,auth:s,stsTokenManager:c}=e,d=KO(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Zce(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=s,this.stsTokenManager=c,this.accessToken=c.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new ck(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(e){const r=await px(this,this.stsTokenManager.getToken(this.auth,e));return vr(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return Wce(this,e)}reload(){return Xce(this)}_assign(e){this!==e&&(vr(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new Lh(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){vr(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),r&&await bS(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Lc(this.auth.app))return Promise.reject(Fh(this.auth));const e=await this.getIdToken();return await px(this,Gce(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var s,c,d,_,x,a,I,M;const D=(s=r.displayName)!==null&&s!==void 0?s:void 0,L=(c=r.email)!==null&&c!==void 0?c:void 0,G=(d=r.phoneNumber)!==null&&d!==void 0?d:void 0,Q=(_=r.photoURL)!==null&&_!==void 0?_:void 0,re=(x=r.tenantId)!==null&&x!==void 0?x:void 0,ee=(a=r._redirectEventId)!==null&&a!==void 0?a:void 0,U=(I=r.createdAt)!==null&&I!==void 0?I:void 0,H=(M=r.lastLoginAt)!==null&&M!==void 0?M:void 0,{uid:Z,emailVerified:de,isAnonymous:ve,providerData:Ee,stsTokenManager:ie}=r;vr(Z&&ie,e,"internal-error");const ue=sy.fromJSON(this.name,ie);vr(typeof Z=="string",e,"internal-error"),Qd(D,e.name),Qd(L,e.name),vr(typeof de=="boolean",e,"internal-error"),vr(typeof ve=="boolean",e,"internal-error"),Qd(G,e.name),Qd(Q,e.name),Qd(re,e.name),Qd(ee,e.name),Qd(U,e.name),Qd(H,e.name);const K=new Lh({uid:Z,auth:e,email:L,emailVerified:de,displayName:D,isAnonymous:ve,photoURL:Q,phoneNumber:G,tenantId:re,stsTokenManager:ue,createdAt:U,lastLoginAt:H});return Ee&&Array.isArray(Ee)&&(K.providerData=Ee.map(ge=>Object.assign({},ge))),ee&&(K._redirectEventId=ee),K}static async _fromIdTokenResponse(e,r,s=!1){const c=new sy;c.updateFromServerResponse(r);const d=new Lh({uid:r.localId,auth:e,stsTokenManager:c,isAnonymous:s});return await bS(d),d}static async _fromGetAccountInfoResponse(e,r,s){const c=r.users[0];vr(c.localId!==void 0,"internal-error");const d=c.providerUserInfo!==void 0?tq(c.providerUserInfo):[],_=!(c.email&&c.passwordHash)&&!(d!=null&&d.length),x=new sy;x.updateFromIdToken(s);const a=new Lh({uid:c.localId,auth:e,stsTokenManager:x,isAnonymous:_}),I={uid:c.localId,displayName:c.displayName||null,photoURL:c.photoUrl||null,email:c.email||null,emailVerified:c.emailVerified||!1,phoneNumber:c.phoneNumber||null,tenantId:c.tenantId||null,providerData:d,metadata:new ck(c.createdAt,c.lastLoginAt),isAnonymous:!(c.email&&c.passwordHash)&&!(d!=null&&d.length)};return Object.assign(a,I),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pj=new Map;function zh(t){Hh(t instanceof Function,"Expected a class definition");let e=Pj.get(t);return e?(Hh(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Pj.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nq{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}nq.type="NONE";const Rj=nq;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yE(t,e,r){return`firebase:${t}:${e}:${r}`}class oy{constructor(e,r,s){this.persistence=e,this.auth=r,this.userKey=s;const{config:c,name:d}=this.auth;this.fullUserKey=yE(this.userKey,c.apiKey,d),this.fullPersistenceKey=yE("persistence",c.apiKey,d),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Lh._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,s="authUser"){if(!r.length)return new oy(zh(Rj),e,s);const c=(await Promise.all(r.map(async I=>{if(await I._isAvailable())return I}))).filter(I=>I);let d=c[0]||zh(Rj);const _=yE(s,e.config.apiKey,e.name);let x=null;for(const I of r)try{const M=await I._get(_);if(M){const D=Lh._fromJSON(e,M);I!==d&&(x=D),d=I;break}}catch{}const a=c.filter(I=>I._shouldAllowMigration);return!d._shouldAllowMigration||!a.length?new oy(d,e,s):(d=a[0],x&&await d._set(_,x.toJSON()),await Promise.all(r.map(async I=>{if(I!==d)try{await I._remove(_)}catch{}})),new oy(d,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mj(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(oq(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(rq(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(lq(e))return"Blackberry";if(cq(e))return"Webos";if(iq(e))return"Safari";if((e.includes("chrome/")||sq(e))&&!e.includes("edge/"))return"Chrome";if(aq(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(r);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function rq(t=Jo()){return/firefox\//i.test(t)}function iq(t=Jo()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function sq(t=Jo()){return/crios\//i.test(t)}function oq(t=Jo()){return/iemobile/i.test(t)}function aq(t=Jo()){return/android/i.test(t)}function lq(t=Jo()){return/blackberry/i.test(t)}function cq(t=Jo()){return/webos/i.test(t)}function tD(t=Jo()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Jce(t=Jo()){var e;return tD(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function eue(){return ple()&&document.documentMode===10}function uq(t=Jo()){return tD(t)||aq(t)||cq(t)||lq(t)||/windows phone/i.test(t)||oq(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hq(t,e=[]){let r;switch(t){case"Browser":r=Mj(Jo());break;case"Worker":r=`${Mj(Jo())}-${t}`;break;default:r=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${rg}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tue{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const s=d=>new Promise((_,x)=>{try{const a=e(d);_(a)}catch(a){x(a)}});s.onAbort=r,this.queue.push(s);const c=this.queue.length-1;return()=>{this.queue[c]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const s of this.queue)await s(e),s.onAbort&&r.push(s.onAbort)}catch(s){r.reverse();for(const c of r)try{c()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nue(t,e={}){return Xf(t,"GET","/v2/passwordPolicy",Zf(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rue=6;class iue{constructor(e){var r,s,c,d;const _=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=_.minPasswordLength)!==null&&r!==void 0?r:rue,_.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=_.maxPasswordLength),_.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=_.containsLowercaseCharacter),_.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=_.containsUppercaseCharacter),_.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=_.containsNumericCharacter),_.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=_.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(c=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&c!==void 0?c:"",this.forceUpgradeOnSignin=(d=e.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,s,c,d,_,x;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=(r=a.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),a.isValid&&(a.isValid=(s=a.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),a.isValid&&(a.isValid=(c=a.containsLowercaseLetter)!==null&&c!==void 0?c:!0),a.isValid&&(a.isValid=(d=a.containsUppercaseLetter)!==null&&d!==void 0?d:!0),a.isValid&&(a.isValid=(_=a.containsNumericCharacter)!==null&&_!==void 0?_:!0),a.isValid&&(a.isValid=(x=a.containsNonAlphanumericCharacter)!==null&&x!==void 0?x:!0),a}validatePasswordLengthOptions(e,r){const s=this.customStrengthOptions.minPasswordLength,c=this.customStrengthOptions.maxPasswordLength;s&&(r.meetsMinPasswordLength=e.length>=s),c&&(r.meetsMaxPasswordLength=e.length<=c)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let s;for(let c=0;c<e.length;c++)s=e.charAt(c),this.updatePasswordCharacterOptionsStatuses(r,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,r,s,c,d){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=c)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sue{constructor(e,r,s,c){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=s,this.config=c,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new kj(this),this.idTokenSubscription=new kj(this),this.beforeStateQueue=new tue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=K7,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=c.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=zh(r)),this._initializationPromise=this.queue(async()=>{var s,c;if(!this._deleted&&(this.persistenceManager=await oy.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((c=this.currentUser)===null||c===void 0?void 0:c.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await eq(this,{idToken:e}),s=await Lh._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(s)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(Lc(this.app)){const _=this.app.settings.authIdToken;return _?new Promise(x=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(_).then(x,x))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let c=s,d=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const _=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,x=c==null?void 0:c._redirectEventId,a=await this.tryRedirectSignIn(e);(!_||_===x)&&(a!=null&&a.user)&&(c=a.user,d=!0)}if(!c)return this.directlySetCurrentUser(null);if(!c._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(c)}catch(_){c=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(_))}return c?this.reloadAndSetCurrentUserOrClear(c):this.directlySetCurrentUser(null)}return vr(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===c._redirectEventId?this.directlySetCurrentUser(c):this.reloadAndSetCurrentUserOrClear(c)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await bS(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Fce()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Lc(this.app))return Promise.reject(Fh(this));const r=e?Ds(e):null;return r&&vr(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&vr(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Lc(this.app)?Promise.reject(Fh(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Lc(this.app)?Promise.reject(Fh(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(zh(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await nue(this),r=new iue(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Kx("auth","Firebase",e())}onAuthStateChanged(e,r,s){return this.registerStateListener(this.authStateSubscription,e,r,s)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,s){return this.registerStateListener(this.idTokenSubscription,e,r,s)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(s.tenantId=this.tenantId),await Yce(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const s=await this.getOrInitRedirectPersistenceManager(r);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&zh(e)||this._popupRedirectResolver;vr(r,this,"argument-error"),this.redirectPersistenceManager=await oy.create(this,[zh(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,s;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,s,c){if(this._deleted)return()=>{};const d=typeof r=="function"?r:r.next.bind(r);let _=!1;const x=this._isInitialized?Promise.resolve():this._initializationPromise;if(vr(x,this,"internal-error"),x.then(()=>{_||d(this.currentUser)}),typeof r=="function"){const a=e.addObserver(r,s,c);return()=>{_=!0,a()}}else{const a=e.addObserver(r);return()=>{_=!0,a()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return vr(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=hq(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(r["X-Firebase-Client"]=s);const c=await this._getAppCheckToken();return c&&(r["X-Firebase-AppCheck"]=c),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&Dce(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function Kf(t){return Ds(t)}class kj{constructor(e){this.auth=e,this.observer=null,this.addObserver=wle(r=>this.observer=r)}get next(){return vr(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let QI={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function oue(t){QI=t}function dq(t){return QI.loadJS(t)}function aue(){return QI.recaptchaEnterpriseScript}function lue(){return QI.gapiScript}function cue(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const uue="recaptcha-enterprise",hue="NO_RECAPTCHA";class due{constructor(e){this.type=uue,this.auth=Kf(e)}async verify(e="verify",r=!1){async function s(d){if(!r){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(_,x)=>{qce(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(a=>{if(a.recaptchaKey===void 0)x(new Error("recaptcha Enterprise site key undefined"));else{const I=new $ce(a);return d.tenantId==null?d._agentRecaptchaConfig=I:d._tenantRecaptchaConfigs[d.tenantId]=I,_(I.siteKey)}}).catch(a=>{x(a)})})}function c(d,_,x){const a=window.grecaptcha;Cj(a)?a.enterprise.ready(()=>{a.enterprise.execute(d,{action:e}).then(I=>{_(I)}).catch(()=>{_(hue)})}):x(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((d,_)=>{s(this.auth).then(x=>{if(!r&&Cj(window.grecaptcha))c(x,d,_);else{if(typeof window>"u"){_(new Error("RecaptchaVerifier is only supported in browser"));return}let a=aue();a.length!==0&&(a+=x),dq(a).then(()=>{c(x,d,_)}).catch(I=>{_(I)})}}).catch(x=>{_(x)})})}}async function Oj(t,e,r,s=!1){const c=new due(t);let d;try{d=await c.verify(r)}catch{d=await c.verify(r,!0)}const _=Object.assign({},e);return s?Object.assign(_,{captchaResp:d}):Object.assign(_,{captchaResponse:d}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function uk(t,e,r,s){var c;if(!((c=t._getRecaptchaConfig())===null||c===void 0)&&c.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const d=await Oj(t,e,r,r==="getOobCode");return s(t,d)}else return s(t,e).catch(async d=>{if(d.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await Oj(t,e,r,r==="getOobCode");return s(t,_)}else return Promise.reject(d)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fue(t,e){const r=KI(t,"auth");if(r.isInitialized()){const c=r.getImmediate(),d=r.getOptions();if(Sy(d,e??{}))return c;Ql(c,"already-initialized")}return r.initialize({options:e})}function pue(t,e){const r=(e==null?void 0:e.persistence)||[],s=(Array.isArray(r)?r:[r]).map(zh);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function mue(t,e,r){const s=Kf(t);vr(s._canInitEmulator,s,"emulator-config-failed"),vr(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const c=!1,d=fq(e),{host:_,port:x}=gue(e),a=x===null?"":`:${x}`;s.config.emulator={url:`${d}//${_}${a}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:_,port:x,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:c})}),_ue()}function fq(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function gue(t){const e=fq(t),r=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!r)return{host:"",port:null};const s=r[2].split("@").pop()||"",c=/^(\[[^\]]+\])(:|$)/.exec(s);if(c){const d=c[1];return{host:d,port:Dj(s.substr(d.length+1))}}else{const[d,_]=s.split(":");return{host:d,port:Dj(_)}}}function Dj(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function _ue(){function t(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nD{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return Dh("not implemented")}_getIdTokenResponse(e){return Dh("not implemented")}_linkToIdToken(e,r){return Dh("not implemented")}_getReauthenticationResolver(e){return Dh("not implemented")}}async function yue(t,e){return Xf(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vue(t,e){return Jx(t,"POST","/v1/accounts:signInWithPassword",Zf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xue(t,e){return Jx(t,"POST","/v1/accounts:signInWithEmailLink",Zf(t,e))}async function bue(t,e){return Jx(t,"POST","/v1/accounts:signInWithEmailLink",Zf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx extends nD{constructor(e,r,s,c=null){super("password",s),this._email=e,this._password=r,this._tenantId=c}static _fromEmailAndPassword(e,r){return new mx(e,r,"password")}static _fromEmailAndCode(e,r,s=null){return new mx(e,r,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uk(e,r,"signInWithPassword",vue);case"emailLink":return xue(e,{email:this._email,oobCode:this._password});default:Ql(e,"internal-error")}}async _linkToIdToken(e,r){switch(this.signInMethod){case"password":const s={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return uk(e,s,"signUpPassword",yue);case"emailLink":return bue(e,{idToken:r,email:this._email,oobCode:this._password});default:Ql(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ay(t,e){return Jx(t,"POST","/v1/accounts:signInWithIdp",Zf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wue="http://localhost";class Lm extends nD{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new Lm(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):Ql("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:c}=r,d=KO(r,["providerId","signInMethod"]);if(!s||!c)return null;const _=new Lm(s,c);return _.idToken=d.idToken||void 0,_.accessToken=d.accessToken||void 0,_.secret=d.secret,_.nonce=d.nonce,_.pendingToken=d.pendingToken||null,_}_getIdTokenResponse(e){const r=this.buildRequest();return ay(e,r)}_linkToIdToken(e,r){const s=this.buildRequest();return s.idToken=r,ay(e,s)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,ay(e,r)}buildRequest(){const e={requestUri:wue,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=Qx(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tue(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Eue(t){const e=n1(r1(t)).link,r=e?n1(r1(e)).deep_link_id:null,s=n1(r1(t)).deep_link_id;return(s?n1(r1(s)).link:null)||s||r||e||t}class rD{constructor(e){var r,s,c,d,_,x;const a=n1(r1(e)),I=(r=a.apiKey)!==null&&r!==void 0?r:null,M=(s=a.oobCode)!==null&&s!==void 0?s:null,D=Tue((c=a.mode)!==null&&c!==void 0?c:null);vr(I&&M&&D,"argument-error"),this.apiKey=I,this.operation=D,this.code=M,this.continueUrl=(d=a.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(_=a.languageCode)!==null&&_!==void 0?_:null,this.tenantId=(x=a.tenantId)!==null&&x!==void 0?x:null}static parseLink(e){const r=Eue(e);try{return new rD(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qy{constructor(){this.providerId=Qy.PROVIDER_ID}static credential(e,r){return mx._fromEmailAndPassword(e,r)}static credentialWithLink(e,r){const s=rD.parseLink(r);return vr(s,"argument-error"),mx._fromEmailAndCode(e,s.code,s.tenantId)}}Qy.PROVIDER_ID="password";Qy.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Qy.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iD{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb extends iD{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af extends eb{constructor(){super("facebook.com")}static credential(e){return Lm._fromParams({providerId:af.PROVIDER_ID,signInMethod:af.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return af.credentialFromTaggedObject(e)}static credentialFromError(e){return af.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return af.credential(e.oauthAccessToken)}catch{return null}}}af.FACEBOOK_SIGN_IN_METHOD="facebook.com";af.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ru extends eb{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return Lm._fromParams({providerId:Ru.PROVIDER_ID,signInMethod:Ru.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return Ru.credentialFromTaggedObject(e)}static credentialFromError(e){return Ru.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:s}=e;if(!r&&!s)return null;try{return Ru.credential(r,s)}catch{return null}}}Ru.GOOGLE_SIGN_IN_METHOD="google.com";Ru.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf extends eb{constructor(){super("github.com")}static credential(e){return Lm._fromParams({providerId:lf.PROVIDER_ID,signInMethod:lf.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return lf.credentialFromTaggedObject(e)}static credentialFromError(e){return lf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return lf.credential(e.oauthAccessToken)}catch{return null}}}lf.GITHUB_SIGN_IN_METHOD="github.com";lf.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cf extends eb{constructor(){super("twitter.com")}static credential(e,r){return Lm._fromParams({providerId:cf.PROVIDER_ID,signInMethod:cf.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return cf.credentialFromTaggedObject(e)}static credentialFromError(e){return cf.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:s}=e;if(!r||!s)return null;try{return cf.credential(r,s)}catch{return null}}}cf.TWITTER_SIGN_IN_METHOD="twitter.com";cf.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sue(t,e){return Jx(t,"POST","/v1/accounts:signUp",Zf(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,s,c=!1){const d=await Lh._fromIdTokenResponse(e,s,c),_=Lj(s);return new zm({user:d,providerId:_,_tokenResponse:s,operationType:r})}static async _forOperation(e,r,s){await e._updateTokensIfNecessary(s,!0);const c=Lj(s);return new zm({user:e,providerId:c,_tokenResponse:s,operationType:r})}}function Lj(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wS extends Wu{constructor(e,r,s,c){var d;super(r.code,r.message),this.operationType=s,this.user=c,Object.setPrototypeOf(this,wS.prototype),this.customData={appName:e.name,tenantId:(d=e.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:r.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,r,s,c){return new wS(e,r,s,c)}}function pq(t,e,r,s){return(e==="reauthenticate"?r._getReauthenticationResolver(t):r._getIdTokenResponse(t)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?wS._fromErrorAndOperation(t,d,e,s):d})}async function Iue(t,e,r=!1){const s=await px(t,e._linkToIdToken(t.auth,await t.getIdToken()),r);return zm._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cue(t,e,r=!1){const{auth:s}=t;if(Lc(s.app))return Promise.reject(Fh(s));const c="reauthenticate";try{const d=await px(t,pq(s,c,e,t),r);vr(d.idToken,s,"internal-error");const _=eD(d.idToken);vr(_,s,"internal-error");const{sub:x}=_;return vr(t.uid===x,s,"user-mismatch"),zm._forOperation(t,c,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Ql(s,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mq(t,e,r=!1){if(Lc(t.app))return Promise.reject(Fh(t));const s="signIn",c=await pq(t,s,e),d=await zm._fromIdTokenResponse(t,s,c);return r||await t._updateCurrentUser(d.user),d}async function Aue(t,e){return mq(Kf(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gq(t){const e=Kf(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Pue(t,e,r){if(Lc(t.app))return Promise.reject(Fh(t));const s=Kf(t),_=await uk(s,{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Sue).catch(a=>{throw a.code==="auth/password-does-not-meet-requirements"&&gq(t),a}),x=await zm._fromIdTokenResponse(s,"signIn",_);return await s._updateCurrentUser(x.user),x}function Rue(t,e,r){return Lc(t.app)?Promise.reject(Fh(t)):Aue(Ds(t),Qy.credential(e,r)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&gq(t),s})}function Mue(t,e,r,s){return Ds(t).onIdTokenChanged(e,r,s)}function kue(t,e,r){return Ds(t).beforeAuthStateChanged(e,r)}const TS="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _q{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(TS,"1"),this.storage.removeItem(TS),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oue=1e3,Due=10;class yq extends _q{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=uq(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const s=this.storage.getItem(r),c=this.localCache[r];s!==c&&e(r,c,s)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((_,x,a)=>{this.notifyListeners(_,a)});return}const s=e.key;r?this.detachListener():this.stopPolling();const c=()=>{const _=this.storage.getItem(s);!r&&this.localCache[s]===_||this.notifyListeners(s,_)},d=this.storage.getItem(s);eue()&&d!==e.newValue&&e.newValue!==e.oldValue?setTimeout(c,Due):c()}notifyListeners(e,r){this.localCache[e]=r;const s=this.listeners[e];if(s)for(const c of Array.from(s))c(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:s}),!0)})},Oue)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}yq.type="LOCAL";const Lue=yq;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vq extends _q{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}vq.type="SESSION";const xq=vq;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zue(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YI{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(c=>c.isListeningto(e));if(r)return r;const s=new YI(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:s,eventType:c,data:d}=r.data,_=this.handlersMap[c];if(!(_!=null&&_.size))return;r.ports[0].postMessage({status:"ack",eventId:s,eventType:c});const x=Array.from(_).map(async I=>I(r.origin,d)),a=await zue(x);r.ports[0].postMessage({status:"done",eventId:s,eventType:c,response:a})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}YI.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sD(t="",e=10){let r="";for(let s=0;s<e;s++)r+=Math.floor(Math.random()*10);return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nue{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,s=50){const c=typeof MessageChannel<"u"?new MessageChannel:null;if(!c)throw new Error("connection_unavailable");let d,_;return new Promise((x,a)=>{const I=sD("",20);c.port1.start();const M=setTimeout(()=>{a(new Error("unsupported_event"))},s);_={messageChannel:c,onMessage(D){const L=D;if(L.data.eventId===I)switch(L.data.status){case"ack":clearTimeout(M),d=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),x(L.data.response);break;default:clearTimeout(M),clearTimeout(d),a(new Error("invalid_response"));break}}},this.handlers.add(_),c.port1.addEventListener("message",_.onMessage),this.target.postMessage({eventType:e,eventId:I,data:r},[c.port2])}).finally(()=>{_&&this.removeMessageHandler(_)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(){return window}function Fue(t){Nu().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bq(){return typeof Nu().WorkerGlobalScope<"u"&&typeof Nu().importScripts=="function"}async function Bue(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function jue(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Uue(){return bq()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wq="firebaseLocalStorageDb",Vue=1,ES="firebaseLocalStorage",Tq="fbase_key";class tb{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function JI(t,e){return t.transaction([ES],e?"readwrite":"readonly").objectStore(ES)}function $ue(){const t=indexedDB.deleteDatabase(wq);return new tb(t).toPromise()}function hk(){const t=indexedDB.open(wq,Vue);return new Promise((e,r)=>{t.addEventListener("error",()=>{r(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(ES,{keyPath:Tq})}catch(c){r(c)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(ES)?e(s):(s.close(),await $ue(),e(await hk()))})})}async function zj(t,e,r){const s=JI(t,!0).put({[Tq]:e,value:r});return new tb(s).toPromise()}async function que(t,e){const r=JI(t,!1).get(e),s=await new tb(r).toPromise();return s===void 0?null:s.value}function Nj(t,e){const r=JI(t,!0).delete(e);return new tb(r).toPromise()}const Gue=800,Wue=3;class Eq{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await hk(),this.db)}async _withRetries(e){let r=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(r++>Wue)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return bq()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=YI._getInstance(Uue()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await Bue(),!this.activeServiceWorker)return;this.sender=new Nue(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((r=s[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||jue()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await hk();return await zj(e,TS,"1"),await Nj(e,TS),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(s=>zj(s,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(s=>que(s,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>Nj(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(c=>{const d=JI(c,!1).getAll();return new tb(d).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],s=new Set;if(e.length!==0)for(const{fbase_key:c,value:d}of e)s.add(c),JSON.stringify(this.localCache[c])!==JSON.stringify(d)&&(this.notifyListeners(c,d),r.push(c));for(const c of Object.keys(this.localCache))this.localCache[c]&&!s.has(c)&&(this.notifyListeners(c,null),r.push(c));return r}notifyListeners(e,r){this.localCache[e]=r;const s=this.listeners[e];if(s)for(const c of Array.from(s))c(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Gue)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Eq.type="LOCAL";const Hue=Eq;new Yx(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sq(t,e){return e?zh(e):(vr(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oD extends nD{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ay(e,this._buildIdpRequest())}_linkToIdToken(e,r){return ay(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return ay(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function Zue(t){return mq(t.auth,new oD(t),t.bypassAuthState)}function Xue(t){const{auth:e,user:r}=t;return vr(r,e,"internal-error"),Cue(r,new oD(t),t.bypassAuthState)}async function Kue(t){const{auth:e,user:r}=t;return vr(r,e,"internal-error"),Iue(r,new oD(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iq{constructor(e,r,s,c,d=!1){this.auth=e,this.resolver=s,this.user=c,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:s,postBody:c,tenantId:d,error:_,type:x}=e;if(_){this.reject(_);return}const a={auth:this.auth,requestUri:r,sessionId:s,tenantId:d||void 0,postBody:c||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(x)(a))}catch(I){this.reject(I)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Zue;case"linkViaPopup":case"linkViaRedirect":return Kue;case"reauthViaPopup":case"reauthViaRedirect":return Xue;default:Ql(this.auth,"internal-error")}}resolve(e){Hh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Hh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Que=new Yx(2e3,1e4);async function Cq(t,e,r){if(Lc(t.app))return Promise.reject(jc(t,"operation-not-supported-in-this-environment"));const s=Kf(t);Lce(t,e,iD);const c=Sq(s,r);return new dm(s,"signInViaPopup",e,c).executeNotNull()}class dm extends Iq{constructor(e,r,s,c,d){super(e,r,c,d),this.provider=s,this.authWindow=null,this.pollId=null,dm.currentPopupAction&&dm.currentPopupAction.cancel(),dm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return vr(e,this.auth,"internal-error"),e}async onExecution(){Hh(this.filter.length===1,"Popup operations only handle one event");const e=sD();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(jc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(jc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,dm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,s;if(!((s=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(jc(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Que.get())};e()}}dm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yue="pendingRedirect",vE=new Map;class Jue extends Iq{constructor(e,r,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,s),this.eventId=null}async execute(){let e=vE.get(this.auth._key());if(!e){try{const s=await ehe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(r){e=()=>Promise.reject(r)}vE.set(this.auth._key(),e)}return this.bypassAuthState||vE.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ehe(t,e){const r=rhe(e),s=nhe(t);if(!await s._isAvailable())return!1;const c=await s._get(r)==="true";return await s._remove(r),c}function the(t,e){vE.set(t._key(),e)}function nhe(t){return zh(t._redirectPersistence)}function rhe(t){return yE(Yue,t.config.apiKey,t.name)}async function ihe(t,e,r=!1){if(Lc(t.app))return Promise.reject(Fh(t));const s=Kf(t),c=Sq(s,e),_=await new Jue(s,c,r).execute();return _&&!r&&(delete _.user._redirectEventId,await s._persistUserIfCurrent(_.user),await s._setRedirectUser(null,e)),_}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const she=10*60*1e3;class ohe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(r=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!ahe(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var s;if(e.error&&!Aq(e)){const c=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";r.onError(jc(this.auth,c))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const s=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=she&&this.cachedEventUids.clear(),this.cachedEventUids.has(Fj(e))}saveEventToCache(e){this.cachedEventUids.add(Fj(e)),this.lastProcessedEventTime=Date.now()}}function Fj(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Aq({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function ahe(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Aq(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lhe(t,e={}){return Xf(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const che=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,uhe=/^https?/;async function hhe(t){if(t.config.emulator)return;const{authorizedDomains:e}=await lhe(t);for(const r of e)try{if(dhe(r))return}catch{}Ql(t,"unauthorized-domain")}function dhe(t){const e=lk(),{protocol:r,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const _=new URL(t);return _.hostname===""&&s===""?r==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&_.hostname===s}if(!uhe.test(r))return!1;if(che.test(t))return s===t;const c=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+c+"|"+c+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fhe=new Yx(3e4,6e4);function Bj(){const t=Nu().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let r=0;r<t.CP.length;r++)t.CP[r]=null}}function phe(t){return new Promise((e,r)=>{var s,c,d;function _(){Bj(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Bj(),r(jc(t,"network-request-failed"))},timeout:fhe.get()})}if(!((c=(s=Nu().gapi)===null||s===void 0?void 0:s.iframes)===null||c===void 0)&&c.Iframe)e(gapi.iframes.getContext());else if(!((d=Nu().gapi)===null||d===void 0)&&d.load)_();else{const x=cue("iframefcb");return Nu()[x]=()=>{gapi.load?_():r(jc(t,"network-request-failed"))},dq(`${lue()}?onload=${x}`).catch(a=>r(a))}}).catch(e=>{throw xE=null,e})}let xE=null;function mhe(t){return xE=xE||phe(t),xE}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ghe=new Yx(5e3,15e3),_he="__/auth/iframe",yhe="emulator/auth/iframe",vhe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},xhe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function bhe(t){const e=t.config;vr(e.authDomain,t,"auth-domain-config-required");const r=e.emulator?JO(e,yhe):`https://${t.config.authDomain}/${_he}`,s={apiKey:e.apiKey,appName:t.name,v:rg},c=xhe.get(t.config.apiHost);c&&(s.eid=c);const d=t._getFrameworks();return d.length&&(s.fw=d.join(",")),`${r}?${Qx(s).slice(1)}`}async function whe(t){const e=await mhe(t),r=Nu().gapi;return vr(r,t,"internal-error"),e.open({where:document.body,url:bhe(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:vhe,dontclear:!0},s=>new Promise(async(c,d)=>{await s.restyle({setHideOnLeave:!1});const _=jc(t,"network-request-failed"),x=Nu().setTimeout(()=>{d(_)},ghe.get());function a(){Nu().clearTimeout(x),c(s)}s.ping(a).then(a,()=>{d(_)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const The={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Ehe=500,She=600,Ihe="_blank",Che="http://localhost";class jj{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Ahe(t,e,r,s=Ehe,c=She){const d=Math.max((window.screen.availHeight-c)/2,0).toString(),_=Math.max((window.screen.availWidth-s)/2,0).toString();let x="";const a=Object.assign(Object.assign({},The),{width:s.toString(),height:c.toString(),top:d,left:_}),I=Jo().toLowerCase();r&&(x=sq(I)?Ihe:r),rq(I)&&(e=e||Che,a.scrollbars="yes");const M=Object.entries(a).reduce((L,[G,Q])=>`${L}${G}=${Q},`,"");if(Jce(I)&&x!=="_self")return Phe(e||"",x),new jj(null);const D=window.open(e||"",x,M);vr(D,t,"popup-blocked");try{D.focus()}catch{}return new jj(D)}function Phe(t,e){const r=document.createElement("a");r.href=t,r.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rhe="__/auth/handler",Mhe="emulator/auth/handler",khe=encodeURIComponent("fac");async function Uj(t,e,r,s,c,d){vr(t.config.authDomain,t,"auth-domain-config-required"),vr(t.config.apiKey,t,"invalid-api-key");const _={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:s,v:rg,eventId:c};if(e instanceof iD){e.setDefaultLanguage(t.languageCode),_.providerId=e.providerId||"",ble(e.getCustomParameters())||(_.customParameters=JSON.stringify(e.getCustomParameters()));for(const[M,D]of Object.entries({}))_[M]=D}if(e instanceof eb){const M=e.getScopes().filter(D=>D!=="");M.length>0&&(_.scopes=M.join(","))}t.tenantId&&(_.tid=t.tenantId);const x=_;for(const M of Object.keys(x))x[M]===void 0&&delete x[M];const a=await t._getAppCheckToken(),I=a?`#${khe}=${encodeURIComponent(a)}`:"";return`${Ohe(t)}?${Qx(x).slice(1)}${I}`}function Ohe({config:t}){return t.emulator?JO(t,Mhe):`https://${t.authDomain}/${Rhe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dR="webStorageSupport";class Dhe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=xq,this._completeRedirectFn=ihe,this._overrideRedirectResult=the}async _openPopup(e,r,s,c){var d;Hh((d=this.eventManagers[e._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const _=await Uj(e,r,s,lk(),c);return Ahe(e,_,sD())}async _openRedirect(e,r,s,c){await this._originValidation(e);const d=await Uj(e,r,s,lk(),c);return Fue(d),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:c,promise:d}=this.eventManagers[r];return c?Promise.resolve(c):(Hh(d,"If manager is not set, promise should be"),d)}const s=this.initAndGetManager(e);return this.eventManagers[r]={promise:s},s.catch(()=>{delete this.eventManagers[r]}),s}async initAndGetManager(e){const r=await whe(e),s=new ohe(e);return r.register("authEvent",c=>(vr(c==null?void 0:c.authEvent,e,"invalid-auth-event"),{status:s.onEvent(c.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=r,s}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(dR,{type:dR},c=>{var d;const _=(d=c==null?void 0:c[0])===null||d===void 0?void 0:d[dR];_!==void 0&&r(!!_),Ql(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=hhe(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return uq()||iq()||tD()}}const Lhe=Dhe;var Vj="@firebase/auth",$j="1.7.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zhe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){vr(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nhe(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Fhe(t){Dm(new Lf("auth",(e,{options:r})=>{const s=e.getProvider("app").getImmediate(),c=e.getProvider("heartbeat"),d=e.getProvider("app-check-internal"),{apiKey:_,authDomain:x}=s.options;vr(_&&!_.includes(":"),"invalid-api-key",{appName:s.name});const a={apiKey:_,authDomain:x,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:hq(t)},I=new sue(s,c,d,a);return pue(I,r),I},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,s)=>{e.getProvider("auth-internal").initialize()})),Dm(new Lf("auth-internal",e=>{const r=Kf(e.getProvider("auth").getImmediate());return(s=>new zhe(s))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),zu(Vj,$j,Nhe(t)),zu(Vj,$j,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bhe=5*60,jhe=V7("authIdTokenMaxAge")||Bhe;let qj=null;const Uhe=t=>async e=>{const r=e&&await e.getIdTokenResult(),s=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(s&&s>jhe)return;const c=r==null?void 0:r.token;qj!==c&&(qj=c,await fetch(t,{method:c?"POST":"DELETE",headers:c?{Authorization:`Bearer ${c}`}:{}}))};function Vhe(t=XO()){const e=KI(t,"auth");if(e.isInitialized())return e.getImmediate();const r=fue(t,{popupRedirectResolver:Lhe,persistence:[Hue,Lue,xq]}),s=V7("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(s,location.origin);if(location.origin===d.origin){const _=Uhe(d.toString());kue(r,_,()=>_(r.currentUser)),Mue(r,x=>_(x))}}const c=B7("auth");return c&&mue(r,`http://${c}`),r}function $he(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}oue({loadJS(t){return new Promise((e,r)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=c=>{const d=jc("internal-error");d.customData=c,r(d)},s.type="text/javascript",s.charset="UTF-8",$he().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Fhe("Browser");var Gj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var bm,Pq;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(ie,ue){function K(){}K.prototype=ue.prototype,ie.D=ue.prototype,ie.prototype=new K,ie.prototype.constructor=ie,ie.C=function(ge,_e,Se){for(var xe=Array(arguments.length-2),wt=2;wt<arguments.length;wt++)xe[wt-2]=arguments[wt];return ue.prototype[_e].apply(ge,xe)}}function r(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,r),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function c(ie,ue,K){K||(K=0);var ge=Array(16);if(typeof ue=="string")for(var _e=0;16>_e;++_e)ge[_e]=ue.charCodeAt(K++)|ue.charCodeAt(K++)<<8|ue.charCodeAt(K++)<<16|ue.charCodeAt(K++)<<24;else for(_e=0;16>_e;++_e)ge[_e]=ue[K++]|ue[K++]<<8|ue[K++]<<16|ue[K++]<<24;ue=ie.g[0],K=ie.g[1],_e=ie.g[2];var Se=ie.g[3],xe=ue+(Se^K&(_e^Se))+ge[0]+3614090360&4294967295;ue=K+(xe<<7&4294967295|xe>>>25),xe=Se+(_e^ue&(K^_e))+ge[1]+3905402710&4294967295,Se=ue+(xe<<12&4294967295|xe>>>20),xe=_e+(K^Se&(ue^K))+ge[2]+606105819&4294967295,_e=Se+(xe<<17&4294967295|xe>>>15),xe=K+(ue^_e&(Se^ue))+ge[3]+3250441966&4294967295,K=_e+(xe<<22&4294967295|xe>>>10),xe=ue+(Se^K&(_e^Se))+ge[4]+4118548399&4294967295,ue=K+(xe<<7&4294967295|xe>>>25),xe=Se+(_e^ue&(K^_e))+ge[5]+1200080426&4294967295,Se=ue+(xe<<12&4294967295|xe>>>20),xe=_e+(K^Se&(ue^K))+ge[6]+2821735955&4294967295,_e=Se+(xe<<17&4294967295|xe>>>15),xe=K+(ue^_e&(Se^ue))+ge[7]+4249261313&4294967295,K=_e+(xe<<22&4294967295|xe>>>10),xe=ue+(Se^K&(_e^Se))+ge[8]+1770035416&4294967295,ue=K+(xe<<7&4294967295|xe>>>25),xe=Se+(_e^ue&(K^_e))+ge[9]+2336552879&4294967295,Se=ue+(xe<<12&4294967295|xe>>>20),xe=_e+(K^Se&(ue^K))+ge[10]+4294925233&4294967295,_e=Se+(xe<<17&4294967295|xe>>>15),xe=K+(ue^_e&(Se^ue))+ge[11]+2304563134&4294967295,K=_e+(xe<<22&4294967295|xe>>>10),xe=ue+(Se^K&(_e^Se))+ge[12]+1804603682&4294967295,ue=K+(xe<<7&4294967295|xe>>>25),xe=Se+(_e^ue&(K^_e))+ge[13]+4254626195&4294967295,Se=ue+(xe<<12&4294967295|xe>>>20),xe=_e+(K^Se&(ue^K))+ge[14]+2792965006&4294967295,_e=Se+(xe<<17&4294967295|xe>>>15),xe=K+(ue^_e&(Se^ue))+ge[15]+1236535329&4294967295,K=_e+(xe<<22&4294967295|xe>>>10),xe=ue+(_e^Se&(K^_e))+ge[1]+4129170786&4294967295,ue=K+(xe<<5&4294967295|xe>>>27),xe=Se+(K^_e&(ue^K))+ge[6]+3225465664&4294967295,Se=ue+(xe<<9&4294967295|xe>>>23),xe=_e+(ue^K&(Se^ue))+ge[11]+643717713&4294967295,_e=Se+(xe<<14&4294967295|xe>>>18),xe=K+(Se^ue&(_e^Se))+ge[0]+3921069994&4294967295,K=_e+(xe<<20&4294967295|xe>>>12),xe=ue+(_e^Se&(K^_e))+ge[5]+3593408605&4294967295,ue=K+(xe<<5&4294967295|xe>>>27),xe=Se+(K^_e&(ue^K))+ge[10]+38016083&4294967295,Se=ue+(xe<<9&4294967295|xe>>>23),xe=_e+(ue^K&(Se^ue))+ge[15]+3634488961&4294967295,_e=Se+(xe<<14&4294967295|xe>>>18),xe=K+(Se^ue&(_e^Se))+ge[4]+3889429448&4294967295,K=_e+(xe<<20&4294967295|xe>>>12),xe=ue+(_e^Se&(K^_e))+ge[9]+568446438&4294967295,ue=K+(xe<<5&4294967295|xe>>>27),xe=Se+(K^_e&(ue^K))+ge[14]+3275163606&4294967295,Se=ue+(xe<<9&4294967295|xe>>>23),xe=_e+(ue^K&(Se^ue))+ge[3]+4107603335&4294967295,_e=Se+(xe<<14&4294967295|xe>>>18),xe=K+(Se^ue&(_e^Se))+ge[8]+1163531501&4294967295,K=_e+(xe<<20&4294967295|xe>>>12),xe=ue+(_e^Se&(K^_e))+ge[13]+2850285829&4294967295,ue=K+(xe<<5&4294967295|xe>>>27),xe=Se+(K^_e&(ue^K))+ge[2]+4243563512&4294967295,Se=ue+(xe<<9&4294967295|xe>>>23),xe=_e+(ue^K&(Se^ue))+ge[7]+1735328473&4294967295,_e=Se+(xe<<14&4294967295|xe>>>18),xe=K+(Se^ue&(_e^Se))+ge[12]+2368359562&4294967295,K=_e+(xe<<20&4294967295|xe>>>12),xe=ue+(K^_e^Se)+ge[5]+4294588738&4294967295,ue=K+(xe<<4&4294967295|xe>>>28),xe=Se+(ue^K^_e)+ge[8]+2272392833&4294967295,Se=ue+(xe<<11&4294967295|xe>>>21),xe=_e+(Se^ue^K)+ge[11]+1839030562&4294967295,_e=Se+(xe<<16&4294967295|xe>>>16),xe=K+(_e^Se^ue)+ge[14]+4259657740&4294967295,K=_e+(xe<<23&4294967295|xe>>>9),xe=ue+(K^_e^Se)+ge[1]+2763975236&4294967295,ue=K+(xe<<4&4294967295|xe>>>28),xe=Se+(ue^K^_e)+ge[4]+1272893353&4294967295,Se=ue+(xe<<11&4294967295|xe>>>21),xe=_e+(Se^ue^K)+ge[7]+4139469664&4294967295,_e=Se+(xe<<16&4294967295|xe>>>16),xe=K+(_e^Se^ue)+ge[10]+3200236656&4294967295,K=_e+(xe<<23&4294967295|xe>>>9),xe=ue+(K^_e^Se)+ge[13]+681279174&4294967295,ue=K+(xe<<4&4294967295|xe>>>28),xe=Se+(ue^K^_e)+ge[0]+3936430074&4294967295,Se=ue+(xe<<11&4294967295|xe>>>21),xe=_e+(Se^ue^K)+ge[3]+3572445317&4294967295,_e=Se+(xe<<16&4294967295|xe>>>16),xe=K+(_e^Se^ue)+ge[6]+76029189&4294967295,K=_e+(xe<<23&4294967295|xe>>>9),xe=ue+(K^_e^Se)+ge[9]+3654602809&4294967295,ue=K+(xe<<4&4294967295|xe>>>28),xe=Se+(ue^K^_e)+ge[12]+3873151461&4294967295,Se=ue+(xe<<11&4294967295|xe>>>21),xe=_e+(Se^ue^K)+ge[15]+530742520&4294967295,_e=Se+(xe<<16&4294967295|xe>>>16),xe=K+(_e^Se^ue)+ge[2]+3299628645&4294967295,K=_e+(xe<<23&4294967295|xe>>>9),xe=ue+(_e^(K|~Se))+ge[0]+4096336452&4294967295,ue=K+(xe<<6&4294967295|xe>>>26),xe=Se+(K^(ue|~_e))+ge[7]+1126891415&4294967295,Se=ue+(xe<<10&4294967295|xe>>>22),xe=_e+(ue^(Se|~K))+ge[14]+2878612391&4294967295,_e=Se+(xe<<15&4294967295|xe>>>17),xe=K+(Se^(_e|~ue))+ge[5]+4237533241&4294967295,K=_e+(xe<<21&4294967295|xe>>>11),xe=ue+(_e^(K|~Se))+ge[12]+1700485571&4294967295,ue=K+(xe<<6&4294967295|xe>>>26),xe=Se+(K^(ue|~_e))+ge[3]+2399980690&4294967295,Se=ue+(xe<<10&4294967295|xe>>>22),xe=_e+(ue^(Se|~K))+ge[10]+4293915773&4294967295,_e=Se+(xe<<15&4294967295|xe>>>17),xe=K+(Se^(_e|~ue))+ge[1]+2240044497&4294967295,K=_e+(xe<<21&4294967295|xe>>>11),xe=ue+(_e^(K|~Se))+ge[8]+1873313359&4294967295,ue=K+(xe<<6&4294967295|xe>>>26),xe=Se+(K^(ue|~_e))+ge[15]+4264355552&4294967295,Se=ue+(xe<<10&4294967295|xe>>>22),xe=_e+(ue^(Se|~K))+ge[6]+2734768916&4294967295,_e=Se+(xe<<15&4294967295|xe>>>17),xe=K+(Se^(_e|~ue))+ge[13]+1309151649&4294967295,K=_e+(xe<<21&4294967295|xe>>>11),xe=ue+(_e^(K|~Se))+ge[4]+4149444226&4294967295,ue=K+(xe<<6&4294967295|xe>>>26),xe=Se+(K^(ue|~_e))+ge[11]+3174756917&4294967295,Se=ue+(xe<<10&4294967295|xe>>>22),xe=_e+(ue^(Se|~K))+ge[2]+718787259&4294967295,_e=Se+(xe<<15&4294967295|xe>>>17),xe=K+(Se^(_e|~ue))+ge[9]+3951481745&4294967295,ie.g[0]=ie.g[0]+ue&4294967295,ie.g[1]=ie.g[1]+(_e+(xe<<21&4294967295|xe>>>11))&4294967295,ie.g[2]=ie.g[2]+_e&4294967295,ie.g[3]=ie.g[3]+Se&4294967295}s.prototype.u=function(ie,ue){ue===void 0&&(ue=ie.length);for(var K=ue-this.blockSize,ge=this.B,_e=this.h,Se=0;Se<ue;){if(_e==0)for(;Se<=K;)c(this,ie,Se),Se+=this.blockSize;if(typeof ie=="string"){for(;Se<ue;)if(ge[_e++]=ie.charCodeAt(Se++),_e==this.blockSize){c(this,ge),_e=0;break}}else for(;Se<ue;)if(ge[_e++]=ie[Se++],_e==this.blockSize){c(this,ge),_e=0;break}}this.h=_e,this.o+=ue},s.prototype.v=function(){var ie=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);ie[0]=128;for(var ue=1;ue<ie.length-8;++ue)ie[ue]=0;var K=8*this.o;for(ue=ie.length-8;ue<ie.length;++ue)ie[ue]=K&255,K/=256;for(this.u(ie),ie=Array(16),ue=K=0;4>ue;++ue)for(var ge=0;32>ge;ge+=8)ie[K++]=this.g[ue]>>>ge&255;return ie};function d(ie,ue){var K=x;return Object.prototype.hasOwnProperty.call(K,ie)?K[ie]:K[ie]=ue(ie)}function _(ie,ue){this.h=ue;for(var K=[],ge=!0,_e=ie.length-1;0<=_e;_e--){var Se=ie[_e]|0;ge&&Se==ue||(K[_e]=Se,ge=!1)}this.g=K}var x={};function a(ie){return-128<=ie&&128>ie?d(ie,function(ue){return new _([ue|0],0>ue?-1:0)}):new _([ie|0],0>ie?-1:0)}function I(ie){if(isNaN(ie)||!isFinite(ie))return D;if(0>ie)return ee(I(-ie));for(var ue=[],K=1,ge=0;ie>=K;ge++)ue[ge]=ie/K|0,K*=4294967296;return new _(ue,0)}function M(ie,ue){if(ie.length==0)throw Error("number format error: empty string");if(ue=ue||10,2>ue||36<ue)throw Error("radix out of range: "+ue);if(ie.charAt(0)=="-")return ee(M(ie.substring(1),ue));if(0<=ie.indexOf("-"))throw Error('number format error: interior "-" character');for(var K=I(Math.pow(ue,8)),ge=D,_e=0;_e<ie.length;_e+=8){var Se=Math.min(8,ie.length-_e),xe=parseInt(ie.substring(_e,_e+Se),ue);8>Se?(Se=I(Math.pow(ue,Se)),ge=ge.j(Se).add(I(xe))):(ge=ge.j(K),ge=ge.add(I(xe)))}return ge}var D=a(0),L=a(1),G=a(16777216);t=_.prototype,t.m=function(){if(re(this))return-ee(this).m();for(var ie=0,ue=1,K=0;K<this.g.length;K++){var ge=this.i(K);ie+=(0<=ge?ge:4294967296+ge)*ue,ue*=4294967296}return ie},t.toString=function(ie){if(ie=ie||10,2>ie||36<ie)throw Error("radix out of range: "+ie);if(Q(this))return"0";if(re(this))return"-"+ee(this).toString(ie);for(var ue=I(Math.pow(ie,6)),K=this,ge="";;){var _e=de(K,ue).g;K=U(K,_e.j(ue));var Se=((0<K.g.length?K.g[0]:K.h)>>>0).toString(ie);if(K=_e,Q(K))return Se+ge;for(;6>Se.length;)Se="0"+Se;ge=Se+ge}},t.i=function(ie){return 0>ie?0:ie<this.g.length?this.g[ie]:this.h};function Q(ie){if(ie.h!=0)return!1;for(var ue=0;ue<ie.g.length;ue++)if(ie.g[ue]!=0)return!1;return!0}function re(ie){return ie.h==-1}t.l=function(ie){return ie=U(this,ie),re(ie)?-1:Q(ie)?0:1};function ee(ie){for(var ue=ie.g.length,K=[],ge=0;ge<ue;ge++)K[ge]=~ie.g[ge];return new _(K,~ie.h).add(L)}t.abs=function(){return re(this)?ee(this):this},t.add=function(ie){for(var ue=Math.max(this.g.length,ie.g.length),K=[],ge=0,_e=0;_e<=ue;_e++){var Se=ge+(this.i(_e)&65535)+(ie.i(_e)&65535),xe=(Se>>>16)+(this.i(_e)>>>16)+(ie.i(_e)>>>16);ge=xe>>>16,Se&=65535,xe&=65535,K[_e]=xe<<16|Se}return new _(K,K[K.length-1]&-2147483648?-1:0)};function U(ie,ue){return ie.add(ee(ue))}t.j=function(ie){if(Q(this)||Q(ie))return D;if(re(this))return re(ie)?ee(this).j(ee(ie)):ee(ee(this).j(ie));if(re(ie))return ee(this.j(ee(ie)));if(0>this.l(G)&&0>ie.l(G))return I(this.m()*ie.m());for(var ue=this.g.length+ie.g.length,K=[],ge=0;ge<2*ue;ge++)K[ge]=0;for(ge=0;ge<this.g.length;ge++)for(var _e=0;_e<ie.g.length;_e++){var Se=this.i(ge)>>>16,xe=this.i(ge)&65535,wt=ie.i(_e)>>>16,ft=ie.i(_e)&65535;K[2*ge+2*_e]+=xe*ft,H(K,2*ge+2*_e),K[2*ge+2*_e+1]+=Se*ft,H(K,2*ge+2*_e+1),K[2*ge+2*_e+1]+=xe*wt,H(K,2*ge+2*_e+1),K[2*ge+2*_e+2]+=Se*wt,H(K,2*ge+2*_e+2)}for(ge=0;ge<ue;ge++)K[ge]=K[2*ge+1]<<16|K[2*ge];for(ge=ue;ge<2*ue;ge++)K[ge]=0;return new _(K,0)};function H(ie,ue){for(;(ie[ue]&65535)!=ie[ue];)ie[ue+1]+=ie[ue]>>>16,ie[ue]&=65535,ue++}function Z(ie,ue){this.g=ie,this.h=ue}function de(ie,ue){if(Q(ue))throw Error("division by zero");if(Q(ie))return new Z(D,D);if(re(ie))return ue=de(ee(ie),ue),new Z(ee(ue.g),ee(ue.h));if(re(ue))return ue=de(ie,ee(ue)),new Z(ee(ue.g),ue.h);if(30<ie.g.length){if(re(ie)||re(ue))throw Error("slowDivide_ only works with positive integers.");for(var K=L,ge=ue;0>=ge.l(ie);)K=ve(K),ge=ve(ge);var _e=Ee(K,1),Se=Ee(ge,1);for(ge=Ee(ge,2),K=Ee(K,2);!Q(ge);){var xe=Se.add(ge);0>=xe.l(ie)&&(_e=_e.add(K),Se=xe),ge=Ee(ge,1),K=Ee(K,1)}return ue=U(ie,_e.j(ue)),new Z(_e,ue)}for(_e=D;0<=ie.l(ue);){for(K=Math.max(1,Math.floor(ie.m()/ue.m())),ge=Math.ceil(Math.log(K)/Math.LN2),ge=48>=ge?1:Math.pow(2,ge-48),Se=I(K),xe=Se.j(ue);re(xe)||0<xe.l(ie);)K-=ge,Se=I(K),xe=Se.j(ue);Q(Se)&&(Se=L),_e=_e.add(Se),ie=U(ie,xe)}return new Z(_e,ie)}t.A=function(ie){return de(this,ie).h},t.and=function(ie){for(var ue=Math.max(this.g.length,ie.g.length),K=[],ge=0;ge<ue;ge++)K[ge]=this.i(ge)&ie.i(ge);return new _(K,this.h&ie.h)},t.or=function(ie){for(var ue=Math.max(this.g.length,ie.g.length),K=[],ge=0;ge<ue;ge++)K[ge]=this.i(ge)|ie.i(ge);return new _(K,this.h|ie.h)},t.xor=function(ie){for(var ue=Math.max(this.g.length,ie.g.length),K=[],ge=0;ge<ue;ge++)K[ge]=this.i(ge)^ie.i(ge);return new _(K,this.h^ie.h)};function ve(ie){for(var ue=ie.g.length+1,K=[],ge=0;ge<ue;ge++)K[ge]=ie.i(ge)<<1|ie.i(ge-1)>>>31;return new _(K,ie.h)}function Ee(ie,ue){var K=ue>>5;ue%=32;for(var ge=ie.g.length-K,_e=[],Se=0;Se<ge;Se++)_e[Se]=0<ue?ie.i(Se+K)>>>ue|ie.i(Se+K+1)<<32-ue:ie.i(Se+K);return new _(_e,ie.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,Pq=s,_.prototype.add=_.prototype.add,_.prototype.multiply=_.prototype.j,_.prototype.modulo=_.prototype.A,_.prototype.compare=_.prototype.l,_.prototype.toNumber=_.prototype.m,_.prototype.toString=_.prototype.toString,_.prototype.getBits=_.prototype.i,_.fromNumber=I,_.fromString=M,bm=_}).apply(typeof Gj<"u"?Gj:typeof self<"u"?self:typeof window<"u"?window:{});var FT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Rq,Mq,i1,kq,bE,dk,Oq,Dq,Lq;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(R,J,he){return R==Array.prototype||R==Object.prototype||(R[J]=he.value),R};function r(R){R=[typeof globalThis=="object"&&globalThis,R,typeof window=="object"&&window,typeof self=="object"&&self,typeof FT=="object"&&FT];for(var J=0;J<R.length;++J){var he=R[J];if(he&&he.Math==Math)return he}throw Error("Cannot find global object")}var s=r(this);function c(R,J){if(J)e:{var he=s;R=R.split(".");for(var Oe=0;Oe<R.length-1;Oe++){var pt=R[Oe];if(!(pt in he))break e;he=he[pt]}R=R[R.length-1],Oe=he[R],J=J(Oe),J!=Oe&&J!=null&&e(he,R,{configurable:!0,writable:!0,value:J})}}function d(R,J){R instanceof String&&(R+="");var he=0,Oe=!1,pt={next:function(){if(!Oe&&he<R.length){var Dt=he++;return{value:J(Dt,R[Dt]),done:!1}}return Oe=!0,{done:!0,value:void 0}}};return pt[Symbol.iterator]=function(){return pt},pt}c("Array.prototype.values",function(R){return R||function(){return d(this,function(J,he){return he})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var _=_||{},x=this||self;function a(R){var J=typeof R;return J=J!="object"?J:R?Array.isArray(R)?"array":J:"null",J=="array"||J=="object"&&typeof R.length=="number"}function I(R){var J=typeof R;return J=="object"&&R!=null||J=="function"}function M(R,J,he){return R.call.apply(R.bind,arguments)}function D(R,J,he){if(!R)throw Error();if(2<arguments.length){var Oe=Array.prototype.slice.call(arguments,2);return function(){var pt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(pt,Oe),R.apply(J,pt)}}return function(){return R.apply(J,arguments)}}function L(R,J,he){return L=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?M:D,L.apply(null,arguments)}function G(R,J){var he=Array.prototype.slice.call(arguments,1);return function(){var Oe=he.slice();return Oe.push.apply(Oe,arguments),R.apply(this,Oe)}}function Q(R,J){function he(){}he.prototype=J.prototype,R.aa=J.prototype,R.prototype=new he,R.prototype.constructor=R,R.Qb=function(Oe,pt,Dt){for(var tn=Array(arguments.length-2),ii=2;ii<arguments.length;ii++)tn[ii-2]=arguments[ii];return J.prototype[pt].apply(Oe,tn)}}function re(R){const J=R.length;if(0<J){const he=Array(J);for(let Oe=0;Oe<J;Oe++)he[Oe]=R[Oe];return he}return[]}function ee(R,J){for(let he=1;he<arguments.length;he++){const Oe=arguments[he];if(a(Oe)){const pt=R.length||0,Dt=Oe.length||0;R.length=pt+Dt;for(let tn=0;tn<Dt;tn++)R[pt+tn]=Oe[tn]}else R.push(Oe)}}class U{constructor(J,he){this.i=J,this.j=he,this.h=0,this.g=null}get(){let J;return 0<this.h?(this.h--,J=this.g,this.g=J.next,J.next=null):J=this.i(),J}}function H(R){return/^[\s\xa0]*$/.test(R)}function Z(){var R=x.navigator;return R&&(R=R.userAgent)?R:""}function de(R){return de[" "](R),R}de[" "]=function(){};var ve=Z().indexOf("Gecko")!=-1&&!(Z().toLowerCase().indexOf("webkit")!=-1&&Z().indexOf("Edge")==-1)&&!(Z().indexOf("Trident")!=-1||Z().indexOf("MSIE")!=-1)&&Z().indexOf("Edge")==-1;function Ee(R,J,he){for(const Oe in R)J.call(he,R[Oe],Oe,R)}function ie(R,J){for(const he in R)J.call(void 0,R[he],he,R)}function ue(R){const J={};for(const he in R)J[he]=R[he];return J}const K="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ge(R,J){let he,Oe;for(let pt=1;pt<arguments.length;pt++){Oe=arguments[pt];for(he in Oe)R[he]=Oe[he];for(let Dt=0;Dt<K.length;Dt++)he=K[Dt],Object.prototype.hasOwnProperty.call(Oe,he)&&(R[he]=Oe[he])}}function _e(R){var J=1;R=R.split(":");const he=[];for(;0<J&&R.length;)he.push(R.shift()),J--;return R.length&&he.push(R.join(":")),he}function Se(R){x.setTimeout(()=>{throw R},0)}function xe(){var R=bt;let J=null;return R.g&&(J=R.g,R.g=R.g.next,R.g||(R.h=null),J.next=null),J}class wt{constructor(){this.h=this.g=null}add(J,he){const Oe=ft.get();Oe.set(J,he),this.h?this.h.next=Oe:this.g=Oe,this.h=Oe}}var ft=new U(()=>new Tt,R=>R.reset());class Tt{constructor(){this.next=this.g=this.h=null}set(J,he){this.h=J,this.g=he,this.next=null}reset(){this.next=this.g=this.h=null}}let gt,at=!1,bt=new wt,Zt=()=>{const R=x.Promise.resolve(void 0);gt=()=>{R.then(tt)}};var tt=()=>{for(var R;R=xe();){try{R.h.call(R.g)}catch(he){Se(he)}var J=ft;J.j(R),100>J.h&&(J.h++,R.next=J.g,J.g=R)}at=!1};function Et(){this.s=this.s,this.C=this.C}Et.prototype.s=!1,Et.prototype.ma=function(){this.s||(this.s=!0,this.N())},Et.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function mt(R,J){this.type=R,this.g=this.target=J,this.defaultPrevented=!1}mt.prototype.h=function(){this.defaultPrevented=!0};var Vt=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var R=!1,J=Object.defineProperty({},"passive",{get:function(){R=!0}});try{const he=()=>{};x.addEventListener("test",he,J),x.removeEventListener("test",he,J)}catch{}return R}();function Pt(R,J){if(mt.call(this,R?R.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,R){var he=this.type=R.type,Oe=R.changedTouches&&R.changedTouches.length?R.changedTouches[0]:null;if(this.target=R.target||R.srcElement,this.g=J,J=R.relatedTarget){if(ve){e:{try{de(J.nodeName);var pt=!0;break e}catch{}pt=!1}pt||(J=null)}}else he=="mouseover"?J=R.fromElement:he=="mouseout"&&(J=R.toElement);this.relatedTarget=J,Oe?(this.clientX=Oe.clientX!==void 0?Oe.clientX:Oe.pageX,this.clientY=Oe.clientY!==void 0?Oe.clientY:Oe.pageY,this.screenX=Oe.screenX||0,this.screenY=Oe.screenY||0):(this.clientX=R.clientX!==void 0?R.clientX:R.pageX,this.clientY=R.clientY!==void 0?R.clientY:R.pageY,this.screenX=R.screenX||0,this.screenY=R.screenY||0),this.button=R.button,this.key=R.key||"",this.ctrlKey=R.ctrlKey,this.altKey=R.altKey,this.shiftKey=R.shiftKey,this.metaKey=R.metaKey,this.pointerId=R.pointerId||0,this.pointerType=typeof R.pointerType=="string"?R.pointerType:pn[R.pointerType]||"",this.state=R.state,this.i=R,R.defaultPrevented&&Pt.aa.h.call(this)}}Q(Pt,mt);var pn={2:"touch",3:"pen",4:"mouse"};Pt.prototype.h=function(){Pt.aa.h.call(this);var R=this.i;R.preventDefault?R.preventDefault():R.returnValue=!1};var dn="closure_listenable_"+(1e6*Math.random()|0),yn=0;function Mt(R,J,he,Oe,pt){this.listener=R,this.proxy=null,this.src=J,this.type=he,this.capture=!!Oe,this.ha=pt,this.key=++yn,this.da=this.fa=!1}function cn(R){R.da=!0,R.listener=null,R.proxy=null,R.src=null,R.ha=null}function Yt(R){this.src=R,this.g={},this.h=0}Yt.prototype.add=function(R,J,he,Oe,pt){var Dt=R.toString();R=this.g[Dt],R||(R=this.g[Dt]=[],this.h++);var tn=xr(R,J,Oe,pt);return-1<tn?(J=R[tn],he||(J.fa=!1)):(J=new Mt(J,this.src,Dt,!!Oe,pt),J.fa=he,R.push(J)),J};function Tn(R,J){var he=J.type;if(he in R.g){var Oe=R.g[he],pt=Array.prototype.indexOf.call(Oe,J,void 0),Dt;(Dt=0<=pt)&&Array.prototype.splice.call(Oe,pt,1),Dt&&(cn(J),R.g[he].length==0&&(delete R.g[he],R.h--))}}function xr(R,J,he,Oe){for(var pt=0;pt<R.length;++pt){var Dt=R[pt];if(!Dt.da&&Dt.listener==J&&Dt.capture==!!he&&Dt.ha==Oe)return pt}return-1}var On="closure_lm_"+(1e6*Math.random()|0),fr={};function Lr(R,J,he,Oe,pt){if(Array.isArray(J)){for(var Dt=0;Dt<J.length;Dt++)Lr(R,J[Dt],he,Oe,pt);return null}return he=ln(he),R&&R[dn]?R.K(J,he,I(Oe)?!!Oe.capture:!!Oe,pt):or(R,J,he,!1,Oe,pt)}function or(R,J,he,Oe,pt,Dt){if(!J)throw Error("Invalid event type");var tn=I(pt)?!!pt.capture:!!pt,ii=st(R);if(ii||(R[On]=ii=new Yt(R)),he=ii.add(J,he,Oe,tn,Dt),he.proxy)return he;if(Oe=Yn(),he.proxy=Oe,Oe.src=R,Oe.listener=he,R.addEventListener)Vt||(pt=tn),pt===void 0&&(pt=!1),R.addEventListener(J.toString(),Oe,pt);else if(R.attachEvent)R.attachEvent(lt(J.toString()),Oe);else if(R.addListener&&R.removeListener)R.addListener(Oe);else throw Error("addEventListener and attachEvent are unavailable.");return he}function Yn(){function R(he){return J.call(R.src,R.listener,he)}const J=Ke;return R}function ke(R,J,he,Oe,pt){if(Array.isArray(J))for(var Dt=0;Dt<J.length;Dt++)ke(R,J[Dt],he,Oe,pt);else Oe=I(Oe)?!!Oe.capture:!!Oe,he=ln(he),R&&R[dn]?(R=R.i,J=String(J).toString(),J in R.g&&(Dt=R.g[J],he=xr(Dt,he,Oe,pt),-1<he&&(cn(Dt[he]),Array.prototype.splice.call(Dt,he,1),Dt.length==0&&(delete R.g[J],R.h--)))):R&&(R=st(R))&&(J=R.g[J.toString()],R=-1,J&&(R=xr(J,he,Oe,pt)),(he=-1<R?J[R]:null)&&He(he))}function He(R){if(typeof R!="number"&&R&&!R.da){var J=R.src;if(J&&J[dn])Tn(J.i,R);else{var he=R.type,Oe=R.proxy;J.removeEventListener?J.removeEventListener(he,Oe,R.capture):J.detachEvent?J.detachEvent(lt(he),Oe):J.addListener&&J.removeListener&&J.removeListener(Oe),(he=st(J))?(Tn(he,R),he.h==0&&(he.src=null,J[On]=null)):cn(R)}}}function lt(R){return R in fr?fr[R]:fr[R]="on"+R}function Ke(R,J){if(R.da)R=!0;else{J=new Pt(J,this);var he=R.listener,Oe=R.ha||R.src;R.fa&&He(R),R=he.call(Oe,J)}return R}function st(R){return R=R[On],R instanceof Yt?R:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function ln(R){return typeof R=="function"?R:(R[zt]||(R[zt]=function(J){return R.handleEvent(J)}),R[zt])}function Ht(){Et.call(this),this.i=new Yt(this),this.M=this,this.F=null}Q(Ht,Et),Ht.prototype[dn]=!0,Ht.prototype.removeEventListener=function(R,J,he,Oe){ke(this,R,J,he,Oe)};function vn(R,J){var he,Oe=R.F;if(Oe)for(he=[];Oe;Oe=Oe.F)he.push(Oe);if(R=R.M,Oe=J.type||J,typeof J=="string")J=new mt(J,R);else if(J instanceof mt)J.target=J.target||R;else{var pt=J;J=new mt(Oe,R),ge(J,pt)}if(pt=!0,he)for(var Dt=he.length-1;0<=Dt;Dt--){var tn=J.g=he[Dt];pt=Fn(tn,Oe,!0,J)&&pt}if(tn=J.g=R,pt=Fn(tn,Oe,!0,J)&&pt,pt=Fn(tn,Oe,!1,J)&&pt,he)for(Dt=0;Dt<he.length;Dt++)tn=J.g=he[Dt],pt=Fn(tn,Oe,!1,J)&&pt}Ht.prototype.N=function(){if(Ht.aa.N.call(this),this.i){var R=this.i,J;for(J in R.g){for(var he=R.g[J],Oe=0;Oe<he.length;Oe++)cn(he[Oe]);delete R.g[J],R.h--}}this.F=null},Ht.prototype.K=function(R,J,he,Oe){return this.i.add(String(R),J,!1,he,Oe)},Ht.prototype.L=function(R,J,he,Oe){return this.i.add(String(R),J,!0,he,Oe)};function Fn(R,J,he,Oe){if(J=R.i.g[String(J)],!J)return!0;J=J.concat();for(var pt=!0,Dt=0;Dt<J.length;++Dt){var tn=J[Dt];if(tn&&!tn.da&&tn.capture==he){var ii=tn.listener,ps=tn.ha||tn.src;tn.fa&&Tn(R.i,tn),pt=ii.call(ps,Oe)!==!1&&pt}}return pt&&!Oe.defaultPrevented}function pr(R,J,he){if(typeof R=="function")he&&(R=L(R,he));else if(R&&typeof R.handleEvent=="function")R=L(R.handleEvent,R);else throw Error("Invalid listener argument");return 2147483647<Number(J)?-1:x.setTimeout(R,J||0)}function fi(R){R.g=pr(()=>{R.g=null,R.i&&(R.i=!1,fi(R))},R.l);const J=R.h;R.h=null,R.m.apply(null,J)}class ir extends Et{constructor(J,he){super(),this.m=J,this.l=he,this.h=null,this.i=!1,this.g=null}j(J){this.h=arguments,this.g?this.i=!0:fi(this)}N(){super.N(),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ci(R){Et.call(this),this.h=R,this.g={}}Q(Ci,Et);var is=[];function An(R){Ee(R.g,function(J,he){this.g.hasOwnProperty(he)&&He(J)},R),R.g={}}Ci.prototype.N=function(){Ci.aa.N.call(this),An(this)},Ci.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ar=x.JSON.stringify,mn=x.JSON.parse,Js=class{stringify(R){return x.JSON.stringify(R,void 0)}parse(R){return x.JSON.parse(R,void 0)}};function Ai(){}Ai.prototype.h=null;function fo(R){return R.h||(R.h=R.i())}function wa(){}var rn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function er(){mt.call(this,"d")}Q(er,mt);function ti(){mt.call(this,"c")}Q(ti,mt);var Mi={},Ts=null;function Es(){return Ts=Ts||new Ht}Mi.La="serverreachability";function Ls(R){mt.call(this,Mi.La,R)}Q(Ls,mt);function $s(R){const J=Es();vn(J,new Ls(J))}Mi.STAT_EVENT="statevent";function Lo(R,J){mt.call(this,Mi.STAT_EVENT,R),this.stat=J}Q(Lo,mt);function jr(R){const J=Es();vn(J,new Lo(J,R))}Mi.Ma="timingevent";function Wa(R,J){mt.call(this,Mi.Ma,R),this.size=J}Q(Wa,mt);function ni(R,J){if(typeof R!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){R()},J)}function xi(){this.g=!0}xi.prototype.xa=function(){this.g=!1};function Tl(R,J,he,Oe,pt,Dt){R.info(function(){if(R.g)if(Dt)for(var tn="",ii=Dt.split("&"),ps=0;ps<ii.length;ps++){var Ur=ii[ps].split("=");if(1<Ur.length){var As=Ur[0];Ur=Ur[1];var Ps=As.split("_");tn=2<=Ps.length&&Ps[1]=="type"?tn+(As+"="+Ur+"&"):tn+(As+"=redacted&")}}else tn=null;else tn=Dt;return"XMLHTTP REQ ("+Oe+") [attempt "+pt+"]: "+J+`
`+he+`
`+tn})}function Ta(R,J,he,Oe,pt,Dt,tn){R.info(function(){return"XMLHTTP RESP ("+Oe+") [ attempt "+pt+"]: "+J+`
`+he+`
`+Dt+" "+tn})}function po(R,J,he,Oe){R.info(function(){return"XMLHTTP TEXT ("+J+"): "+Xu(R,he)+(Oe?" "+Oe:"")})}function Fi(R,J){R.info(function(){return"TIMEOUT: "+J})}xi.prototype.info=function(){};function Xu(R,J){if(!R.g)return J;if(!J)return null;try{var he=JSON.parse(J);if(he){for(R=0;R<he.length;R++)if(Array.isArray(he[R])){var Oe=he[R];if(!(2>Oe.length)){var pt=Oe[1];if(Array.isArray(pt)&&!(1>pt.length)){var Dt=pt[0];if(Dt!="noop"&&Dt!="stop"&&Dt!="close")for(var tn=1;tn<pt.length;tn++)pt[tn]=""}}}}return ar(he)}catch{return J}}var Ue={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ne={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},le;function Te(){}Q(Te,Ai),Te.prototype.g=function(){return new XMLHttpRequest},Te.prototype.i=function(){return{}},le=new Te;function Le(R,J,he,Oe){this.j=R,this.i=J,this.l=he,this.R=Oe||1,this.U=new Ci(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new De}function De(){this.i=null,this.g="",this.h=!1}var Ge={},it={};function qe(R,J,he){R.L=1,R.v=Wc(zo(J)),R.m=he,R.P=!0,nt(R,null)}function nt(R,J){R.F=Date.now(),Xt(R),R.A=zo(R.v);var he=R.A,Oe=R.R;Array.isArray(Oe)||(Oe=[String(Oe)]),cg(he.i,"t",Oe),R.C=0,he=R.j.J,R.h=new De,R.g=nu(R.j,he?J:null,!R.m),0<R.O&&(R.M=new ir(L(R.Y,R,R.g),R.O)),J=R.U,he=R.g,Oe=R.ca;var pt="readystatechange";Array.isArray(pt)||(pt&&(is[0]=pt.toString()),pt=is);for(var Dt=0;Dt<pt.length;Dt++){var tn=Lr(he,pt[Dt],Oe||J.handleEvent,!1,J.h||J);if(!tn)break;J.g[tn.key]=tn}J=R.H?ue(R.H):{},R.m?(R.u||(R.u="POST"),J["Content-Type"]="application/x-www-form-urlencoded",R.g.ea(R.A,R.u,R.m,J)):(R.u="GET",R.g.ea(R.A,R.u,null,J)),$s(),Tl(R.i,R.u,R.A,R.l,R.R,R.m)}Le.prototype.ca=function(R){R=R.target;const J=this.M;J&&na(R)==3?J.j():this.Y(R)},Le.prototype.Y=function(R){try{if(R==this.g)e:{const Ps=na(this.g);var J=this.g.Ba();const uc=this.g.Z();if(!(3>Ps)&&(Ps!=3||this.g&&(this.h.h||this.g.oa()||sc(this.g)))){this.J||Ps!=4||J==7||(J==8||0>=uc?$s(3):$s(2)),Cn(this);var he=this.g.Z();this.X=he;t:if(St(this)){var Oe=sc(this.g);R="";var pt=Oe.length,Dt=na(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Mn(this),lr(this);var tn="";break t}this.h.i=new x.TextDecoder}for(J=0;J<pt;J++)this.h.h=!0,R+=this.h.i.decode(Oe[J],{stream:!(Dt&&J==pt-1)});Oe.length=0,this.h.g+=R,this.C=0,tn=this.h.g}else tn=this.g.oa();if(this.o=he==200,Ta(this.i,this.u,this.A,this.l,this.R,Ps,he),this.o){if(this.T&&!this.K){t:{if(this.g){var ii,ps=this.g;if((ii=ps.g?ps.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(ii)){var Ur=ii;break t}}Ur=null}if(he=Ur)po(this.i,this.l,he,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,cr(this,he);else{this.o=!1,this.s=3,jr(12),Mn(this),lr(this);break e}}if(this.P){he=!0;let os;for(;!this.J&&this.C<tn.length;)if(os=It(this,tn),os==it){Ps==4&&(this.s=4,jr(14),he=!1),po(this.i,this.l,null,"[Incomplete Response]");break}else if(os==Ge){this.s=4,jr(15),po(this.i,this.l,tn,"[Invalid Chunk]"),he=!1;break}else po(this.i,this.l,os,null),cr(this,os);if(St(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ps!=4||tn.length!=0||this.h.h||(this.s=1,jr(16),he=!1),this.o=this.o&&he,!he)po(this.i,this.l,tn,"[Invalid Chunked Response]"),Mn(this),lr(this);else if(0<tn.length&&!this.W){this.W=!0;var As=this.j;As.g==this&&As.ba&&!As.M&&(As.j.info("Great, no buffering proxy detected. Bytes received: "+tn.length),fs(As),As.M=!0,jr(11))}}else po(this.i,this.l,tn,null),cr(this,tn);Ps==4&&Mn(this),this.o&&!this.J&&(Ps==4?dg(this.j,this):(this.o=!1,Xt(this)))}else eh(this.g),he==400&&0<tn.indexOf("Unknown SID")?(this.s=3,jr(12)):(this.s=0,jr(13)),Mn(this),lr(this)}}}catch{}finally{}};function St(R){return R.g?R.u=="GET"&&R.L!=2&&R.j.Ca:!1}function It(R,J){var he=R.C,Oe=J.indexOf(`
`,he);return Oe==-1?it:(he=Number(J.substring(he,Oe)),isNaN(he)?Ge:(Oe+=1,Oe+he>J.length?it:(J=J.slice(Oe,Oe+he),R.C=Oe+he,J)))}Le.prototype.cancel=function(){this.J=!0,Mn(this)};function Xt(R){R.S=Date.now()+R.I,_n(R,R.I)}function _n(R,J){if(R.B!=null)throw Error("WatchDog timer not null");R.B=ni(L(R.ba,R),J)}function Cn(R){R.B&&(x.clearTimeout(R.B),R.B=null)}Le.prototype.ba=function(){this.B=null;const R=Date.now();0<=R-this.S?(Fi(this.i,this.A),this.L!=2&&($s(),jr(17)),Mn(this),this.s=2,lr(this)):_n(this,this.S-R)};function lr(R){R.j.G==0||R.J||dg(R.j,R)}function Mn(R){Cn(R);var J=R.M;J&&typeof J.ma=="function"&&J.ma(),R.M=null,An(R.U),R.g&&(J=R.g,R.g=null,J.abort(),J.ma())}function cr(R,J){try{var he=R.j;if(he.G!=0&&(he.g==R||pi(he.h,R))){if(!R.K&&pi(he.h,R)&&he.G==3){try{var Oe=he.Da.g.parse(J)}catch{Oe=null}if(Array.isArray(Oe)&&Oe.length==3){var pt=Oe;if(pt[0]==0){e:if(!he.u){if(he.g)if(he.g.F+3e3<R.F)ra(he),ac(he);else break e;zs(he),jr(18)}}else he.za=pt[1],0<he.za-he.T&&37500>pt[2]&&he.F&&he.v==0&&!he.C&&(he.C=ni(L(he.Za,he),6e3));if(1>=ur(he.h)&&he.ca){try{he.ca()}catch{}he.ca=void 0}}else Fo(he,11)}else if((R.K||he.g==R)&&ra(he),!H(J))for(pt=he.Da.g.parse(J),J=0;J<pt.length;J++){let Ur=pt[J];if(he.T=Ur[0],Ur=Ur[1],he.G==2)if(Ur[0]=="c"){he.K=Ur[1],he.ia=Ur[2];const As=Ur[3];As!=null&&(he.la=As,he.j.info("VER="+he.la));const Ps=Ur[4];Ps!=null&&(he.Aa=Ps,he.j.info("SVER="+he.Aa));const uc=Ur[5];uc!=null&&typeof uc=="number"&&0<uc&&(Oe=1.5*uc,he.L=Oe,he.j.info("backChannelRequestTimeoutMs_="+Oe)),Oe=he;const os=R.g;if(os){const hc=os.g?os.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hc){var Dt=Oe.h;Dt.g||hc.indexOf("spdy")==-1&&hc.indexOf("quic")==-1&&hc.indexOf("h2")==-1||(Dt.j=Dt.l,Dt.g=new Set,Dt.h&&(mi(Dt,Dt.h),Dt.h=null))}if(Oe.D){const md=os.g?os.g.getResponseHeader("X-HTTP-Session-Id"):null;md&&(Oe.ya=md,oi(Oe.I,Oe.D,md))}}he.G=3,he.l&&he.l.ua(),he.ba&&(he.R=Date.now()-R.F,he.j.info("Handshake RTT: "+he.R+"ms")),Oe=he;var tn=R;if(Oe.qa=pd(Oe,Oe.J?Oe.ia:null,Oe.W),tn.K){Gi(Oe.h,tn);var ii=tn,ps=Oe.L;ps&&(ii.I=ps),ii.B&&(Cn(ii),Xt(ii)),Oe.g=tn}else Cs(Oe);0<he.i.length&&Ea(he)}else Ur[0]!="stop"&&Ur[0]!="close"||Fo(he,7);else he.G==3&&(Ur[0]=="stop"||Ur[0]=="close"?Ur[0]=="stop"?Fo(he,7):fd(he):Ur[0]!="noop"&&he.l&&he.l.ta(Ur),he.v=0)}}$s(4)}catch{}}var un=class{constructor(R,J){this.g=R,this.map=J}};function Zr(R){this.l=R||10,x.PerformanceNavigationTiming?(R=x.performance.getEntriesByType("navigation"),R=0<R.length&&(R[0].nextHopProtocol=="hq"||R[0].nextHopProtocol=="h2")):R=!!(x.chrome&&x.chrome.loadTimes&&x.chrome.loadTimes()&&x.chrome.loadTimes().wasFetchedViaSpdy),this.j=R?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function _r(R){return R.h?!0:R.g?R.g.size>=R.j:!1}function ur(R){return R.h?1:R.g?R.g.size:0}function pi(R,J){return R.h?R.h==J:R.g?R.g.has(J):!1}function mi(R,J){R.g?R.g.add(J):R.h=J}function Gi(R,J){R.h&&R.h==J?R.h=null:R.g&&R.g.has(J)&&R.g.delete(J)}Zr.prototype.cancel=function(){if(this.i=Ss(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const R of this.g.values())R.cancel();this.g.clear()}};function Ss(R){if(R.h!=null)return R.i.concat(R.h.D);if(R.g!=null&&R.g.size!==0){let J=R.i;for(const he of R.g.values())J=J.concat(he.D);return J}return re(R.i)}function qs(R){if(R.V&&typeof R.V=="function")return R.V();if(typeof Map<"u"&&R instanceof Map||typeof Set<"u"&&R instanceof Set)return Array.from(R.values());if(typeof R=="string")return R.split("");if(a(R)){for(var J=[],he=R.length,Oe=0;Oe<he;Oe++)J.push(R[Oe]);return J}J=[],he=0;for(Oe in R)J[he++]=R[Oe];return J}function tc(R){if(R.na&&typeof R.na=="function")return R.na();if(!R.V||typeof R.V!="function"){if(typeof Map<"u"&&R instanceof Map)return Array.from(R.keys());if(!(typeof Set<"u"&&R instanceof Set)){if(a(R)||typeof R=="string"){var J=[];R=R.length;for(var he=0;he<R;he++)J.push(he);return J}J=[],he=0;for(const Oe in R)J[he++]=Oe;return J}}}function ad(R,J){if(R.forEach&&typeof R.forEach=="function")R.forEach(J,void 0);else if(a(R)||typeof R=="string")Array.prototype.forEach.call(R,J,void 0);else for(var he=tc(R),Oe=qs(R),pt=Oe.length,Dt=0;Dt<pt;Dt++)J.call(void 0,Oe[Dt],he&&he[Dt],R)}var ld=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ku(R,J){if(R){R=R.split("&");for(var he=0;he<R.length;he++){var Oe=R[he].indexOf("="),pt=null;if(0<=Oe){var Dt=R[he].substring(0,Oe);pt=R[he].substring(Oe+1)}else Dt=R[he];J(Dt,pt?decodeURIComponent(pt.replace(/\+/g," ")):"")}}}function Dn(R){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,R instanceof Dn){this.h=R.h,ea(this,R.j),this.o=R.o,this.g=R.g,Gc(this,R.s),this.l=R.l;var J=R.i,he=new Zc;he.i=J.i,J.g&&(he.g=new Map(J.g),he.h=J.h),cd(this,he),this.m=R.m}else R&&(J=String(R).match(ld))?(this.h=!1,ea(this,J[1]||"",!0),this.o=nc(J[2]||""),this.g=nc(J[3]||"",!0),Gc(this,J[4]),this.l=nc(J[5]||"",!0),cd(this,J[6]||"",!0),this.m=nc(J[7]||"")):(this.h=!1,this.i=new Zc(null,this.h))}Dn.prototype.toString=function(){var R=[],J=this.j;J&&R.push(rc(J,Hc,!0),":");var he=this.g;return(he||J=="file")&&(R.push("//"),(J=this.o)&&R.push(rc(J,Hc,!0),"@"),R.push(encodeURIComponent(String(he)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),he=this.s,he!=null&&R.push(":",String(he))),(he=this.l)&&(this.g&&he.charAt(0)!="/"&&R.push("/"),R.push(rc(he,he.charAt(0)=="/"?ud:Qu,!0))),(he=this.i.toString())&&R.push("?",he),(he=this.m)&&R.push("#",rc(he,ag)),R.join("")};function zo(R){return new Dn(R)}function ea(R,J,he){R.j=he?nc(J,!0):J,R.j&&(R.j=R.j.replace(/:$/,""))}function Gc(R,J){if(J){if(J=Number(J),isNaN(J)||0>J)throw Error("Bad port number "+J);R.s=J}else R.s=null}function cd(R,J,he){J instanceof Zc?(R.i=J,ug(R.i,R.h)):(he||(J=rc(J,hd)),R.i=new Zc(J,R.h))}function oi(R,J,he){R.i.set(J,he)}function Wc(R){return oi(R,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),R}function nc(R,J){return R?J?decodeURI(R.replace(/%25/g,"%2525")):decodeURIComponent(R):""}function rc(R,J,he){return typeof R=="string"?(R=encodeURI(R).replace(J,Jf),he&&(R=R.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),R):null}function Jf(R){return R=R.charCodeAt(0),"%"+(R>>4&15).toString(16)+(R&15).toString(16)}var Hc=/[#\/\?@]/g,Qu=/[#\?:]/g,ud=/[#\?]/g,hd=/[#\?@]/g,ag=/#/g;function Zc(R,J){this.h=this.g=null,this.i=R||null,this.j=!!J}function Eo(R){R.g||(R.g=new Map,R.h=0,R.i&&Ku(R.i,function(J,he){R.add(decodeURIComponent(J.replace(/\+/g," ")),he)}))}t=Zc.prototype,t.add=function(R,J){Eo(this),this.i=null,R=Xc(this,R);var he=this.g.get(R);return he||this.g.set(R,he=[]),he.push(J),this.h+=1,this};function hr(R,J){Eo(R),J=Xc(R,J),R.g.has(J)&&(R.i=null,R.h-=R.g.get(J).length,R.g.delete(J))}function lg(R,J){return Eo(R),J=Xc(R,J),R.g.has(J)}t.forEach=function(R,J){Eo(this),this.g.forEach(function(he,Oe){he.forEach(function(pt){R.call(J,pt,Oe,this)},this)},this)},t.na=function(){Eo(this);const R=Array.from(this.g.values()),J=Array.from(this.g.keys()),he=[];for(let Oe=0;Oe<J.length;Oe++){const pt=R[Oe];for(let Dt=0;Dt<pt.length;Dt++)he.push(J[Oe])}return he},t.V=function(R){Eo(this);let J=[];if(typeof R=="string")lg(this,R)&&(J=J.concat(this.g.get(Xc(this,R))));else{R=Array.from(this.g.values());for(let he=0;he<R.length;he++)J=J.concat(R[he])}return J},t.set=function(R,J){return Eo(this),this.i=null,R=Xc(this,R),lg(this,R)&&(this.h-=this.g.get(R).length),this.g.set(R,[J]),this.h+=1,this},t.get=function(R,J){return R?(R=this.V(R),0<R.length?String(R[0]):J):J};function cg(R,J,he){hr(R,J),0<he.length&&(R.i=null,R.g.set(Xc(R,J),re(he)),R.h+=he.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const R=[],J=Array.from(this.g.keys());for(var he=0;he<J.length;he++){var Oe=J[he];const Dt=encodeURIComponent(String(Oe)),tn=this.V(Oe);for(Oe=0;Oe<tn.length;Oe++){var pt=Dt;tn[Oe]!==""&&(pt+="="+encodeURIComponent(String(tn[Oe]))),R.push(pt)}}return this.i=R.join("&")};function Xc(R,J){return J=String(J),R.j&&(J=J.toLowerCase()),J}function ug(R,J){J&&!R.j&&(Eo(R),R.i=null,R.g.forEach(function(he,Oe){var pt=Oe.toLowerCase();Oe!=pt&&(hr(this,Oe),cg(this,pt,he))},R)),R.j=J}function c0(R,J){const he=new xi;if(x.Image){const Oe=new Image;Oe.onload=G(No,he,"TestLoadImage: loaded",!0,J,Oe),Oe.onerror=G(No,he,"TestLoadImage: error",!1,J,Oe),Oe.onabort=G(No,he,"TestLoadImage: abort",!1,J,Oe),Oe.ontimeout=G(No,he,"TestLoadImage: timeout",!1,J,Oe),x.setTimeout(function(){Oe.ontimeout&&Oe.ontimeout()},1e4),Oe.src=R}else J(!1)}function ep(R,J){const he=new xi,Oe=new AbortController,pt=setTimeout(()=>{Oe.abort(),No(he,"TestPingServer: timeout",!1,J)},1e4);fetch(R,{signal:Oe.signal}).then(Dt=>{clearTimeout(pt),Dt.ok?No(he,"TestPingServer: ok",!0,J):No(he,"TestPingServer: server error",!1,J)}).catch(()=>{clearTimeout(pt),No(he,"TestPingServer: error",!1,J)})}function No(R,J,he,Oe,pt){try{pt&&(pt.onload=null,pt.onerror=null,pt.onabort=null,pt.ontimeout=null),Oe(he)}catch{}}function So(){this.g=new Js}function hg(R,J,he){const Oe=he||"";try{ad(R,function(pt,Dt){let tn=pt;I(pt)&&(tn=ar(pt)),J.push(Oe+Dt+"="+encodeURIComponent(tn))})}catch(pt){throw J.push(Oe+"type="+encodeURIComponent("_badmap")),pt}}function Kc(R){this.l=R.Ub||null,this.j=R.eb||!1}Q(Kc,Ai),Kc.prototype.g=function(){return new Qc(this.l,this.j)},Kc.prototype.i=function(R){return function(){return R}}({});function Qc(R,J){Ht.call(this),this.D=R,this.o=J,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Q(Qc,Ht),t=Qc.prototype,t.open=function(R,J){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=R,this.A=J,this.readyState=1,jt(this)},t.send=function(R){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const J={headers:this.u,method:this.B,credentials:this.m,cache:void 0};R&&(J.body=R),(this.D||x).fetch(new Request(this.A,J)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ta(this)),this.readyState=0},t.Sa=function(R){if(this.g&&(this.l=R,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=R.headers,this.readyState=2,jt(this)),this.g&&(this.readyState=3,jt(this),this.g)))if(this.responseType==="arraybuffer")R.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof x.ReadableStream<"u"&&"body"in R){if(this.j=R.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Yc(this)}else R.text().then(this.Ra.bind(this),this.ga.bind(this))};function Yc(R){R.j.read().then(R.Pa.bind(R)).catch(R.ga.bind(R))}t.Pa=function(R){if(this.g){if(this.o&&R.value)this.response.push(R.value);else if(!this.o){var J=R.value?R.value:new Uint8Array(0);(J=this.v.decode(J,{stream:!R.done}))&&(this.response=this.responseText+=J)}R.done?ta(this):jt(this),this.readyState==3&&Yc(this)}},t.Ra=function(R){this.g&&(this.response=this.responseText=R,ta(this))},t.Qa=function(R){this.g&&(this.response=R,ta(this))},t.ga=function(){this.g&&ta(this)};function ta(R){R.readyState=4,R.l=null,R.j=null,R.v=null,jt(R)}t.setRequestHeader=function(R,J){this.u.append(R,J)},t.getResponseHeader=function(R){return this.h&&this.h.get(R.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const R=[],J=this.h.entries();for(var he=J.next();!he.done;)he=he.value,R.push(he[0]+": "+he[1]),he=J.next();return R.join(`\r
`)};function jt(R){R.onreadystatechange&&R.onreadystatechange.call(R)}Object.defineProperty(Qc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(R){this.m=R?"include":"same-origin"}});function ic(R){let J="";return Ee(R,function(he,Oe){J+=Oe,J+=":",J+=he,J+=`\r
`}),J}function dd(R,J,he){e:{for(Oe in he){var Oe=!1;break e}Oe=!0}Oe||(he=ic(he),typeof R=="string"?he!=null&&encodeURIComponent(String(he)):oi(R,J,he))}function ai(R){Ht.call(this),this.headers=new Map,this.o=R||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Q(ai,Ht);var tr=/^https?$/i,eo=["POST","PUT"];t=ai.prototype,t.Ha=function(R){this.J=R},t.ea=function(R,J,he,Oe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+R);J=J?J.toUpperCase():"GET",this.D=R,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():le.g(),this.v=this.o?fo(this.o):fo(le),this.g.onreadystatechange=L(this.Ea,this);try{this.B=!0,this.g.open(J,String(R),!0),this.B=!1}catch(Dt){Jc(this,Dt);return}if(R=he||"",he=new Map(this.headers),Oe)if(Object.getPrototypeOf(Oe)===Object.prototype)for(var pt in Oe)he.set(pt,Oe[pt]);else if(typeof Oe.keys=="function"&&typeof Oe.get=="function")for(const Dt of Oe.keys())he.set(Dt,Oe.get(Dt));else throw Error("Unknown input type for opt_headers: "+String(Oe));Oe=Array.from(he.keys()).find(Dt=>Dt.toLowerCase()=="content-type"),pt=x.FormData&&R instanceof x.FormData,!(0<=Array.prototype.indexOf.call(eo,J,void 0))||Oe||pt||he.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Dt,tn]of he)this.g.setRequestHeader(Dt,tn);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Hn(this),this.u=!0,this.g.send(R),this.u=!1}catch(Dt){Jc(this,Dt)}};function Jc(R,J){R.h=!1,R.g&&(R.j=!0,R.g.abort(),R.j=!1),R.l=J,R.m=5,Yu(R),mo(R)}function Yu(R){R.A||(R.A=!0,vn(R,"complete"),vn(R,"error"))}t.abort=function(R){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=R||7,vn(this,"complete"),vn(this,"abort"),mo(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),mo(this,!0)),ai.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Ju(this):this.bb())},t.bb=function(){Ju(this)};function Ju(R){if(R.h&&typeof _<"u"&&(!R.v[1]||na(R)!=4||R.Z()!=2)){if(R.u&&na(R)==4)pr(R.Ea,0,R);else if(vn(R,"readystatechange"),na(R)==4){R.h=!1;try{const tn=R.Z();e:switch(tn){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var J=!0;break e;default:J=!1}var he;if(!(he=J)){var Oe;if(Oe=tn===0){var pt=String(R.D).match(ld)[1]||null;!pt&&x.self&&x.self.location&&(pt=x.self.location.protocol.slice(0,-1)),Oe=!tr.test(pt?pt.toLowerCase():"")}he=Oe}if(he)vn(R,"complete"),vn(R,"success");else{R.m=6;try{var Dt=2<na(R)?R.g.statusText:""}catch{Dt=""}R.l=Dt+" ["+R.Z()+"]",Yu(R)}}finally{mo(R)}}}}function mo(R,J){if(R.g){Hn(R);const he=R.g,Oe=R.v[0]?()=>{}:null;R.g=null,R.v=null,J||vn(R,"ready");try{he.onreadystatechange=Oe}catch{}}}function Hn(R){R.I&&(x.clearTimeout(R.I),R.I=null)}t.isActive=function(){return!!this.g};function na(R){return R.g?R.g.readyState:0}t.Z=function(){try{return 2<na(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(R){if(this.g){var J=this.g.responseText;return R&&J.indexOf(R)==0&&(J=J.substring(R.length)),mn(J)}};function sc(R){try{if(!R.g)return null;if("response"in R.g)return R.g.response;switch(R.H){case"":case"text":return R.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in R.g)return R.g.mozResponseArrayBuffer}return null}catch{return null}}function eh(R){const J={};R=(R.g&&2<=na(R)&&R.g.getAllResponseHeaders()||"").split(`\r
`);for(let Oe=0;Oe<R.length;Oe++){if(H(R[Oe]))continue;var he=_e(R[Oe]);const pt=he[0];if(he=he[1],typeof he!="string")continue;he=he.trim();const Dt=J[pt]||[];J[pt]=Dt,Dt.push(he)}ie(J,function(Oe){return Oe.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function oc(R,J,he){return he&&he.internalChannelParams&&he.internalChannelParams[R]||J}function Is(R){this.Aa=0,this.i=[],this.j=new xi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=oc("failFast",!1,R),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=oc("baseRetryDelayMs",5e3,R),this.cb=oc("retryDelaySeedMs",1e4,R),this.Wa=oc("forwardChannelMaxRetries",2,R),this.wa=oc("forwardChannelRequestTimeoutMs",2e4,R),this.pa=R&&R.xmlHttpFactory||void 0,this.Xa=R&&R.Tb||void 0,this.Ca=R&&R.useFetchStreams||!1,this.L=void 0,this.J=R&&R.supportsCrossDomainXhr||!1,this.K="",this.h=new Zr(R&&R.concurrentRequestLimit),this.Da=new So,this.P=R&&R.fastHandshake||!1,this.O=R&&R.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=R&&R.Rb||!1,R&&R.xa&&this.j.xa(),R&&R.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&R&&R.detectBufferingProxy||!1,this.ja=void 0,R&&R.longPollingTimeout&&0<R.longPollingTimeout&&(this.ja=R.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Is.prototype,t.la=8,t.G=1,t.connect=function(R,J,he,Oe){jr(0),this.W=R,this.H=J||{},he&&Oe!==void 0&&(this.H.OSID=he,this.H.OAID=Oe),this.F=this.X,this.I=pd(this,null,this.W),Ea(this)};function fd(R){if(lc(R),R.G==3){var J=R.U++,he=zo(R.I);if(oi(he,"SID",R.K),oi(he,"RID",J),oi(he,"TYPE","terminate"),Ha(R,he),J=new Le(R,R.j,J),J.L=2,J.v=Wc(zo(he)),he=!1,x.navigator&&x.navigator.sendBeacon)try{he=x.navigator.sendBeacon(J.v.toString(),"")}catch{}!he&&x.Image&&(new Image().src=J.v,he=!0),he||(J.g=nu(J.j,null),J.g.ea(J.v)),J.F=Date.now(),Xt(J)}tu(R)}function ac(R){R.g&&(fs(R),R.g.cancel(),R.g=null)}function lc(R){ac(R),R.u&&(x.clearTimeout(R.u),R.u=null),ra(R),R.h.cancel(),R.s&&(typeof R.s=="number"&&x.clearTimeout(R.s),R.s=null)}function Ea(R){if(!_r(R.h)&&!R.s){R.s=!0;var J=R.Ga;gt||Zt(),at||(gt(),at=!0),bt.add(J,R),R.B=0}}function tp(R,J){return ur(R.h)>=R.h.j-(R.s?1:0)?!1:R.s?(R.i=J.D.concat(R.i),!0):R.G==1||R.G==2||R.B>=(R.Va?0:R.Wa)?!1:(R.s=ni(L(R.Ga,R,J),cc(R,R.B)),R.B++,!0)}t.Ga=function(R){if(this.s)if(this.s=null,this.G==1){if(!R){this.U=Math.floor(1e5*Math.random()),R=this.U++;const pt=new Le(this,this.j,R);let Dt=this.o;if(this.S&&(Dt?(Dt=ue(Dt),ge(Dt,this.S)):Dt=this.S),this.m!==null||this.O||(pt.H=Dt,Dt=null),this.P)e:{for(var J=0,he=0;he<this.i.length;he++){t:{var Oe=this.i[he];if("__data__"in Oe.map&&(Oe=Oe.map.__data__,typeof Oe=="string")){Oe=Oe.length;break t}Oe=void 0}if(Oe===void 0)break;if(J+=Oe,4096<J){J=he;break e}if(J===4096||he===this.i.length-1){J=he+1;break e}}J=1e3}else J=1e3;J=eu(this,pt,J),he=zo(this.I),oi(he,"RID",R),oi(he,"CVER",22),this.D&&oi(he,"X-HTTP-Session-Id",this.D),Ha(this,he),Dt&&(this.O?J="headers="+encodeURIComponent(String(ic(Dt)))+"&"+J:this.m&&dd(he,this.m,Dt)),mi(this.h,pt),this.Ua&&oi(he,"TYPE","init"),this.P?(oi(he,"$req",J),oi(he,"SID","null"),pt.T=!0,qe(pt,he,null)):qe(pt,he,J),this.G=2}}else this.G==3&&(R?th(this,R):this.i.length==0||_r(this.h)||th(this))};function th(R,J){var he;J?he=J.l:he=R.U++;const Oe=zo(R.I);oi(Oe,"SID",R.K),oi(Oe,"RID",he),oi(Oe,"AID",R.T),Ha(R,Oe),R.m&&R.o&&dd(Oe,R.m,R.o),he=new Le(R,R.j,he,R.B+1),R.m===null&&(he.H=R.o),J&&(R.i=J.D.concat(R.i)),J=eu(R,he,1e3),he.I=Math.round(.5*R.wa)+Math.round(.5*R.wa*Math.random()),mi(R.h,he),qe(he,Oe,J)}function Ha(R,J){R.H&&Ee(R.H,function(he,Oe){oi(J,Oe,he)}),R.l&&ad({},function(he,Oe){oi(J,Oe,he)})}function eu(R,J,he){he=Math.min(R.i.length,he);var Oe=R.l?L(R.l.Na,R.l,R):null;e:{var pt=R.i;let Dt=-1;for(;;){const tn=["count="+he];Dt==-1?0<he?(Dt=pt[0].g,tn.push("ofs="+Dt)):Dt=0:tn.push("ofs="+Dt);let ii=!0;for(let ps=0;ps<he;ps++){let Ur=pt[ps].g;const As=pt[ps].map;if(Ur-=Dt,0>Ur)Dt=Math.max(0,pt[ps].g-100),ii=!1;else try{hg(As,tn,"req"+Ur+"_")}catch{Oe&&Oe(As)}}if(ii){Oe=tn.join("&");break e}}}return R=R.i.splice(0,he),J.D=R,Oe}function Cs(R){if(!R.g&&!R.u){R.Y=1;var J=R.Fa;gt||Zt(),at||(gt(),at=!0),bt.add(J,R),R.v=0}}function zs(R){return R.g||R.u||3<=R.v?!1:(R.Y++,R.u=ni(L(R.Fa,R),cc(R,R.v)),R.v++,!0)}t.Fa=function(){if(this.u=null,bi(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var R=2*this.R;this.j.info("BP detection timer enabled: "+R),this.A=ni(L(this.ab,this),R)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,jr(10),ac(this),bi(this))};function fs(R){R.A!=null&&(x.clearTimeout(R.A),R.A=null)}function bi(R){R.g=new Le(R,R.j,"rpc",R.Y),R.m===null&&(R.g.H=R.o),R.g.O=0;var J=zo(R.qa);oi(J,"RID","rpc"),oi(J,"SID",R.K),oi(J,"AID",R.T),oi(J,"CI",R.F?"0":"1"),!R.F&&R.ja&&oi(J,"TO",R.ja),oi(J,"TYPE","xmlhttp"),Ha(R,J),R.m&&R.o&&dd(J,R.m,R.o),R.L&&(R.g.I=R.L);var he=R.g;R=R.ia,he.L=1,he.v=Wc(zo(J)),he.m=null,he.P=!0,nt(he,R)}t.Za=function(){this.C!=null&&(this.C=null,ac(this),zs(this),jr(19))};function ra(R){R.C!=null&&(x.clearTimeout(R.C),R.C=null)}function dg(R,J){var he=null;if(R.g==J){ra(R),fs(R),R.g=null;var Oe=2}else if(pi(R.h,J))he=J.D,Gi(R.h,J),Oe=1;else return;if(R.G!=0){if(J.o)if(Oe==1){he=J.m?J.m.length:0,J=Date.now()-J.F;var pt=R.B;Oe=Es(),vn(Oe,new Wa(Oe,he)),Ea(R)}else Cs(R);else if(pt=J.s,pt==3||pt==0&&0<J.X||!(Oe==1&&tp(R,J)||Oe==2&&zs(R)))switch(he&&0<he.length&&(J=R.h,J.i=J.i.concat(he)),pt){case 1:Fo(R,5);break;case 4:Fo(R,10);break;case 3:Fo(R,6);break;default:Fo(R,2)}}}function cc(R,J){let he=R.Ta+Math.floor(Math.random()*R.cb);return R.isActive()||(he*=2),he*J}function Fo(R,J){if(R.j.info("Error code "+J),J==2){var he=L(R.fb,R),Oe=R.Xa;const pt=!Oe;Oe=new Dn(Oe||"//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||ea(Oe,"https"),Wc(Oe),pt?c0(Oe.toString(),he):ep(Oe.toString(),he)}else jr(2);R.G=0,R.l&&R.l.sa(J),tu(R),lc(R)}t.fb=function(R){R?(this.j.info("Successfully pinged google.com"),jr(2)):(this.j.info("Failed to ping google.com"),jr(1))};function tu(R){if(R.G=0,R.ka=[],R.l){const J=Ss(R.h);(J.length!=0||R.i.length!=0)&&(ee(R.ka,J),ee(R.ka,R.i),R.h.i.length=0,re(R.i),R.i.length=0),R.l.ra()}}function pd(R,J,he){var Oe=he instanceof Dn?zo(he):new Dn(he);if(Oe.g!="")J&&(Oe.g=J+"."+Oe.g),Gc(Oe,Oe.s);else{var pt=x.location;Oe=pt.protocol,J=J?J+"."+pt.hostname:pt.hostname,pt=+pt.port;var Dt=new Dn(null);Oe&&ea(Dt,Oe),J&&(Dt.g=J),pt&&Gc(Dt,pt),he&&(Dt.l=he),Oe=Dt}return he=R.D,J=R.ya,he&&J&&oi(Oe,he,J),oi(Oe,"VER",R.la),Ha(R,Oe),Oe}function nu(R,J,he){if(J&&!R.J)throw Error("Can't create secondary domain capable XhrIo object.");return J=R.Ca&&!R.pa?new ai(new Kc({eb:he})):new ai(R.pa),J.Ha(R.J),J}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Za(){}t=Za.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function El(){}El.prototype.g=function(R,J){return new ss(R,J)};function ss(R,J){Ht.call(this),this.g=new Is(J),this.l=R,this.h=J&&J.messageUrlParams||null,R=J&&J.messageHeaders||null,J&&J.clientProtocolHeaderRequired&&(R?R["X-Client-Protocol"]="webchannel":R={"X-Client-Protocol":"webchannel"}),this.g.o=R,R=J&&J.initMessageHeaders||null,J&&J.messageContentType&&(R?R["X-WebChannel-Content-Type"]=J.messageContentType:R={"X-WebChannel-Content-Type":J.messageContentType}),J&&J.va&&(R?R["X-WebChannel-Client-Profile"]=J.va:R={"X-WebChannel-Client-Profile":J.va}),this.g.S=R,(R=J&&J.Sb)&&!H(R)&&(this.g.m=R),this.v=J&&J.supportsCrossDomainXhr||!1,this.u=J&&J.sendRawJson||!1,(J=J&&J.httpSessionIdParam)&&!H(J)&&(this.g.D=J,R=this.h,R!==null&&J in R&&(R=this.h,J in R&&delete R[J])),this.j=new Xa(this)}Q(ss,Ht),ss.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ss.prototype.close=function(){fd(this.g)},ss.prototype.o=function(R){var J=this.g;if(typeof R=="string"){var he={};he.__data__=R,R=he}else this.u&&(he={},he.__data__=ar(R),R=he);J.i.push(new un(J.Ya++,R)),J.G==3&&Ea(J)},ss.prototype.N=function(){this.g.l=null,delete this.j,fd(this.g),delete this.g,ss.aa.N.call(this)};function ru(R){er.call(this),R.__headers__&&(this.headers=R.__headers__,this.statusCode=R.__status__,delete R.__headers__,delete R.__status__);var J=R.__sm__;if(J){e:{for(const he in J){R=he;break e}R=void 0}(this.i=R)&&(R=this.i,J=J!==null&&R in J?J[R]:void 0),this.data=J}else this.data=R}Q(ru,er);function iu(){ti.call(this),this.status=1}Q(iu,ti);function Xa(R){this.g=R}Q(Xa,Za),Xa.prototype.ua=function(){vn(this.g,"a")},Xa.prototype.ta=function(R){vn(this.g,new ru(R))},Xa.prototype.sa=function(R){vn(this.g,new iu)},Xa.prototype.ra=function(){vn(this.g,"b")},El.prototype.createWebChannel=El.prototype.g,ss.prototype.send=ss.prototype.o,ss.prototype.open=ss.prototype.m,ss.prototype.close=ss.prototype.close,Lq=function(){return new El},Dq=function(){return Es()},Oq=Mi,dk={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ue.NO_ERROR=0,Ue.TIMEOUT=8,Ue.HTTP_ERROR=6,bE=Ue,ne.COMPLETE="complete",kq=ne,wa.EventType=rn,rn.OPEN="a",rn.CLOSE="b",rn.ERROR="c",rn.MESSAGE="d",Ht.prototype.listen=Ht.prototype.K,i1=wa,Mq=Kc,ai.prototype.listenOnce=ai.prototype.L,ai.prototype.getLastError=ai.prototype.Ka,ai.prototype.getLastErrorCode=ai.prototype.Ba,ai.prototype.getStatus=ai.prototype.Z,ai.prototype.getResponseJson=ai.prototype.Oa,ai.prototype.getResponseText=ai.prototype.oa,ai.prototype.send=ai.prototype.ea,ai.prototype.setWithCredentials=ai.prototype.Ha,Rq=ai}).apply(typeof FT<"u"?FT:typeof self<"u"?self:typeof window<"u"?window:{});const Wj="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ho{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ho.UNAUTHENTICATED=new Ho(null),Ho.GOOGLE_CREDENTIALS=new Ho("google-credentials-uid"),Ho.FIRST_PARTY=new Ho("first-party-uid"),Ho.MOCK_USER=new Ho("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yy="10.13.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nm=new HO("@firebase/firestore");function Uv(){return Nm.logLevel}function $n(t,...e){if(Nm.logLevel<=Qr.DEBUG){const r=e.map(aD);Nm.debug(`Firestore (${Yy}): ${t}`,...r)}}function Zh(t,...e){if(Nm.logLevel<=Qr.ERROR){const r=e.map(aD);Nm.error(`Firestore (${Yy}): ${t}`,...r)}}function Iy(t,...e){if(Nm.logLevel<=Qr.WARN){const r=e.map(aD);Nm.warn(`Firestore (${Yy}): ${t}`,...r)}}function aD(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Er(t="Unexpected state"){const e=`FIRESTORE (${Yy}) INTERNAL ASSERTION FAILED: `+t;throw Zh(e),new Error(e)}function Ni(t,e){t||Er()}function Pr(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class kn extends Wu{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bh{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zq{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qhe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(Ho.UNAUTHENTICATED))}shutdown(){}}class Ghe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class Whe{constructor(e){this.t=e,this.currentUser=Ho.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){let s=this.i;const c=a=>this.i!==s?(s=this.i,r(a)):Promise.resolve();let d=new Bh;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Bh,e.enqueueRetryable(()=>c(this.currentUser))};const _=()=>{const a=d;e.enqueueRetryable(async()=>{await a.promise,await c(this.currentUser)})},x=a=>{$n("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=a,this.auth.addAuthTokenListener(this.o),_()};this.t.onInit(a=>x(a)),setTimeout(()=>{if(!this.auth){const a=this.t.getImmediate({optional:!0});a?x(a):($n("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Bh)}},0),_()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(s=>this.i!==e?($n("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Ni(typeof s.accessToken=="string"),new zq(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Ni(e===null||typeof e=="string"),new Ho(e)}}class Hhe{constructor(e,r,s){this.l=e,this.h=r,this.P=s,this.type="FirstParty",this.user=Ho.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Zhe{constructor(e,r,s){this.l=e,this.h=r,this.P=s}getToken(){return Promise.resolve(new Hhe(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(Ho.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Xhe{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Khe{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){const s=d=>{d.error!=null&&$n("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const _=d.token!==this.R;return this.R=d.token,$n("FirebaseAppCheckTokenProvider",`Received ${_?"new":"existing"} token.`),_?r(d.token):Promise.resolve()};this.o=d=>{e.enqueueRetryable(()=>s(d))};const c=d=>{$n("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>c(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?c(d):$n("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(Ni(typeof r.token=="string"),this.R=r.token,new Xhe(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qhe(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let s=0;s<t;s++)r[s]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nq{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const c=Qhe(40);for(let d=0;d<c.length;++d)s.length<20&&c[d]<r&&(s+=e.charAt(c[d]%e.length))}return s}}function si(t,e){return t<e?-1:t>e?1:0}function Cy(t,e,r){return t.length===e.length&&t.every((s,c)=>r(s,e[c]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new kn(Qt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new kn(Qt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new kn(Qt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new kn(Qt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ho.fromMillis(Date.now())}static fromDate(e){return ho.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*r));return new ho(r,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?si(this.nanoseconds,e.nanoseconds):si(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ar(e)}static min(){return new Ar(new ho(0,0))}static max(){return new Ar(new ho(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(e,r,s){r===void 0?r=0:r>e.length&&Er(),s===void 0?s=e.length-r:s>e.length-r&&Er(),this.segments=e,this.offset=r,this.len=s}get length(){return this.len}isEqual(e){return gx.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof gx?e.forEach(s=>{r.push(s)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,s=this.limit();r<s;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const s=Math.min(e.length,r.length);for(let c=0;c<s;c++){const d=e.get(c),_=r.get(c);if(d<_)return-1;if(d>_)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class Yi extends gx{construct(e,r,s){return new Yi(e,r,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const s of e){if(s.indexOf("//")>=0)throw new kn(Qt.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);r.push(...s.split("/").filter(c=>c.length>0))}return new Yi(r)}static emptyPath(){return new Yi([])}}const Yhe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Po extends gx{construct(e,r,s){return new Po(e,r,s)}static isValidIdentifier(e){return Yhe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Po.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Po(["__name__"])}static fromServerFormat(e){const r=[];let s="",c=0;const d=()=>{if(s.length===0)throw new kn(Qt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(s),s=""};let _=!1;for(;c<e.length;){const x=e[c];if(x==="\\"){if(c+1===e.length)throw new kn(Qt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const a=e[c+1];if(a!=="\\"&&a!=="."&&a!=="`")throw new kn(Qt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=a,c+=2}else x==="`"?(_=!_,c++):x!=="."||_?(s+=x,c++):(d(),c++)}if(d(),_)throw new kn(Qt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Po(r)}static emptyPath(){return new Po([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rr{constructor(e){this.path=e}static fromPath(e){return new rr(Yi.fromString(e))}static fromName(e){return new rr(Yi.fromString(e).popFirst(5))}static empty(){return new rr(Yi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Yi.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return Yi.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rr(new Yi(e.slice()))}}function Jhe(t,e){const r=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,c=Ar.fromTimestamp(s===1e9?new ho(r+1,0):new ho(r,s));return new zf(c,rr.empty(),e)}function ede(t){return new zf(t.readTime,t.key,-1)}class zf{constructor(e,r,s){this.readTime=e,this.documentKey=r,this.largestBatchId=s}static min(){return new zf(Ar.min(),rr.empty(),-1)}static max(){return new zf(Ar.max(),rr.empty(),-1)}}function tde(t,e){let r=t.readTime.compareTo(e.readTime);return r!==0?r:(r=rr.comparator(t.documentKey,e.documentKey),r!==0?r:si(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nde="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rde{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nb(t){if(t.code!==Qt.FAILED_PRECONDITION||t.message!==nde)throw t;$n("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&Er(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new nn((s,c)=>{this.nextCallback=d=>{this.wrapSuccess(e,d).next(s,c)},this.catchCallback=d=>{this.wrapFailure(r,d).next(s,c)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof nn?r:nn.resolve(r)}catch(r){return nn.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):nn.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):nn.reject(r)}static resolve(e){return new nn((r,s)=>{r(e)})}static reject(e){return new nn((r,s)=>{s(e)})}static waitFor(e){return new nn((r,s)=>{let c=0,d=0,_=!1;e.forEach(x=>{++c,x.next(()=>{++d,_&&d===c&&r()},a=>s(a))}),_=!0,d===c&&r()})}static or(e){let r=nn.resolve(!1);for(const s of e)r=r.next(c=>c?nn.resolve(c):s());return r}static forEach(e,r){const s=[];return e.forEach((c,d)=>{s.push(r.call(this,c,d))}),this.waitFor(s)}static mapArray(e,r){return new nn((s,c)=>{const d=e.length,_=new Array(d);let x=0;for(let a=0;a<d;a++){const I=a;r(e[I]).next(M=>{_[I]=M,++x,x===d&&s(_)},M=>c(M))}})}static doWhile(e,r){return new nn((s,c)=>{const d=()=>{e()===!0?r().next(()=>{d()},c):s()};d()})}}function ide(t){const e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function rb(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lD{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.ie(s),this.se=s=>r.writeSequenceNumber(s))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}lD.oe=-1;function eC(t){return t==null}function SS(t){return t===0&&1/t==-1/0}function sde(t){return typeof t=="number"&&Number.isInteger(t)&&!SS(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hj(t){let e=0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function ig(t,e){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}function Fq(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e,r){this.comparator=e,this.root=r||Co.EMPTY}insert(e,r){return new bs(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,Co.BLACK,null,null))}remove(e){return new bs(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Co.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return r.value;s<0?r=r.left:s>0&&(r=r.right)}return null}indexOf(e){let r=0,s=this.root;for(;!s.isEmpty();){const c=this.comparator(e,s.key);if(c===0)return r+s.left.size;c<0?s=s.left:(r+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,s)=>(e(r,s),!1))}toString(){const e=[];return this.inorderTraversal((r,s)=>(e.push(`${r}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new BT(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new BT(this.root,e,this.comparator,!1)}getReverseIterator(){return new BT(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new BT(this.root,e,this.comparator,!0)}}class BT{constructor(e,r,s,c){this.isReverse=c,this.nodeStack=[];let d=1;for(;!e.isEmpty();)if(d=r?s(e.key,r):1,r&&c&&(d*=-1),d<0)e=this.isReverse?e.left:e.right;else{if(d===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Co{constructor(e,r,s,c,d){this.key=e,this.value=r,this.color=s??Co.RED,this.left=c??Co.EMPTY,this.right=d??Co.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,s,c,d){return new Co(e??this.key,r??this.value,s??this.color,c??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,s){let c=this;const d=s(e,c.key);return c=d<0?c.copy(null,null,null,c.left.insert(e,r,s),null):d===0?c.copy(null,r,null,null,null):c.copy(null,null,null,null,c.right.insert(e,r,s)),c.fixUp()}removeMin(){if(this.left.isEmpty())return Co.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let s,c=this;if(r(e,c.key)<0)c.left.isEmpty()||c.left.isRed()||c.left.left.isRed()||(c=c.moveRedLeft()),c=c.copy(null,null,null,c.left.remove(e,r),null);else{if(c.left.isRed()&&(c=c.rotateRight()),c.right.isEmpty()||c.right.isRed()||c.right.left.isRed()||(c=c.moveRedRight()),r(e,c.key)===0){if(c.right.isEmpty())return Co.EMPTY;s=c.right.min(),c=c.copy(s.key,s.value,null,null,c.right.removeMin())}c=c.copy(null,null,null,null,c.right.remove(e,r))}return c.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Co.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Co.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Er();const e=this.left.check();if(e!==this.right.check())throw Er();return e+(this.isRed()?0:1)}}Co.EMPTY=null,Co.RED=!0,Co.BLACK=!1;Co.EMPTY=new class{constructor(){this.size=0}get key(){throw Er()}get value(){throw Er()}get color(){throw Er()}get left(){throw Er()}get right(){throw Er()}copy(e,r,s,c,d){return this}insert(e,r,s){return new Co(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(e){this.comparator=e,this.data=new bs(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,s)=>(e(r),!1))}forEachInRange(e,r){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const c=s.getNext();if(this.comparator(c.key,e[1])>=0)return;r(c.key)}}forEachWhile(e,r){let s;for(s=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new Zj(this.data.getIterator())}getIteratorFrom(e){return new Zj(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(s=>{r=r.add(s)}),r}isEqual(e){if(!(e instanceof Mo)||this.size!==e.size)return!1;const r=this.data.getIterator(),s=e.data.getIterator();for(;r.hasNext();){const c=r.getNext().key,d=s.getNext().key;if(this.comparator(c,d)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new Mo(this.comparator);return r.data=e,r}}class Zj{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{constructor(e){this.fields=e,e.sort(Po.comparator)}static empty(){return new ll([])}unionWith(e){let r=new Mo(Po.comparator);for(const s of this.fields)r=r.add(s);for(const s of e)r=r.add(s);return new ll(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return Cy(this.fields,e.fields,(r,s)=>r.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bq extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oo{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(c){try{return atob(c)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new Bq("Invalid base64 string: "+d):d}}(e);return new Oo(r)}static fromUint8Array(e){const r=function(c){let d="";for(let _=0;_<c.length;++_)d+=String.fromCharCode(c[_]);return d}(e);return new Oo(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const s=new Uint8Array(r.length);for(let c=0;c<r.length;c++)s[c]=r.charCodeAt(c);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return si(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Oo.EMPTY_BYTE_STRING=new Oo("");const ode=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Nf(t){if(Ni(!!t),typeof t=="string"){let e=0;const r=ode.exec(t);if(Ni(!!r),r[1]){let c=r[1];c=(c+"000000000").substr(0,9),e=Number(c)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:js(t.seconds),nanos:js(t.nanos)}}function js(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Fm(t){return typeof t=="string"?Oo.fromBase64String(t):Oo.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cD(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function uD(t){const e=t.mapValue.fields.__previous_value__;return cD(e)?uD(e):e}function _x(t){const e=Nf(t.mapValue.fields.__local_write_time__.timestampValue);return new ho(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ade{constructor(e,r,s,c,d,_,x,a,I){this.databaseId=e,this.appId=r,this.persistenceKey=s,this.host=c,this.ssl=d,this.forceLongPolling=_,this.autoDetectLongPolling=x,this.longPollingOptions=a,this.useFetchStreams=I}}class yx{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new yx("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof yx&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jT={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Bm(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?cD(t)?4:cde(t)?9007199254740991:lde(t)?10:11:Er()}function Vu(t,e){if(t===e)return!0;const r=Bm(t);if(r!==Bm(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return _x(t).isEqual(_x(e));case 3:return function(c,d){if(typeof c.timestampValue=="string"&&typeof d.timestampValue=="string"&&c.timestampValue.length===d.timestampValue.length)return c.timestampValue===d.timestampValue;const _=Nf(c.timestampValue),x=Nf(d.timestampValue);return _.seconds===x.seconds&&_.nanos===x.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(c,d){return Fm(c.bytesValue).isEqual(Fm(d.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(c,d){return js(c.geoPointValue.latitude)===js(d.geoPointValue.latitude)&&js(c.geoPointValue.longitude)===js(d.geoPointValue.longitude)}(t,e);case 2:return function(c,d){if("integerValue"in c&&"integerValue"in d)return js(c.integerValue)===js(d.integerValue);if("doubleValue"in c&&"doubleValue"in d){const _=js(c.doubleValue),x=js(d.doubleValue);return _===x?SS(_)===SS(x):isNaN(_)&&isNaN(x)}return!1}(t,e);case 9:return Cy(t.arrayValue.values||[],e.arrayValue.values||[],Vu);case 10:case 11:return function(c,d){const _=c.mapValue.fields||{},x=d.mapValue.fields||{};if(Hj(_)!==Hj(x))return!1;for(const a in _)if(_.hasOwnProperty(a)&&(x[a]===void 0||!Vu(_[a],x[a])))return!1;return!0}(t,e);default:return Er()}}function vx(t,e){return(t.values||[]).find(r=>Vu(r,e))!==void 0}function Ay(t,e){if(t===e)return 0;const r=Bm(t),s=Bm(e);if(r!==s)return si(r,s);switch(r){case 0:case 9007199254740991:return 0;case 1:return si(t.booleanValue,e.booleanValue);case 2:return function(d,_){const x=js(d.integerValue||d.doubleValue),a=js(_.integerValue||_.doubleValue);return x<a?-1:x>a?1:x===a?0:isNaN(x)?isNaN(a)?0:-1:1}(t,e);case 3:return Xj(t.timestampValue,e.timestampValue);case 4:return Xj(_x(t),_x(e));case 5:return si(t.stringValue,e.stringValue);case 6:return function(d,_){const x=Fm(d),a=Fm(_);return x.compareTo(a)}(t.bytesValue,e.bytesValue);case 7:return function(d,_){const x=d.split("/"),a=_.split("/");for(let I=0;I<x.length&&I<a.length;I++){const M=si(x[I],a[I]);if(M!==0)return M}return si(x.length,a.length)}(t.referenceValue,e.referenceValue);case 8:return function(d,_){const x=si(js(d.latitude),js(_.latitude));return x!==0?x:si(js(d.longitude),js(_.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Kj(t.arrayValue,e.arrayValue);case 10:return function(d,_){var x,a,I,M;const D=d.fields||{},L=_.fields||{},G=(x=D.value)===null||x===void 0?void 0:x.arrayValue,Q=(a=L.value)===null||a===void 0?void 0:a.arrayValue,re=si(((I=G==null?void 0:G.values)===null||I===void 0?void 0:I.length)||0,((M=Q==null?void 0:Q.values)===null||M===void 0?void 0:M.length)||0);return re!==0?re:Kj(G,Q)}(t.mapValue,e.mapValue);case 11:return function(d,_){if(d===jT.mapValue&&_===jT.mapValue)return 0;if(d===jT.mapValue)return 1;if(_===jT.mapValue)return-1;const x=d.fields||{},a=Object.keys(x),I=_.fields||{},M=Object.keys(I);a.sort(),M.sort();for(let D=0;D<a.length&&D<M.length;++D){const L=si(a[D],M[D]);if(L!==0)return L;const G=Ay(x[a[D]],I[M[D]]);if(G!==0)return G}return si(a.length,M.length)}(t.mapValue,e.mapValue);default:throw Er()}}function Xj(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return si(t,e);const r=Nf(t),s=Nf(e),c=si(r.seconds,s.seconds);return c!==0?c:si(r.nanos,s.nanos)}function Kj(t,e){const r=t.values||[],s=e.values||[];for(let c=0;c<r.length&&c<s.length;++c){const d=Ay(r[c],s[c]);if(d)return d}return si(r.length,s.length)}function Py(t){return fk(t)}function fk(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const s=Nf(r);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(r){return Fm(r).toBase64()}(t.bytesValue):"referenceValue"in t?function(r){return rr.fromName(r).toString()}(t.referenceValue):"geoPointValue"in t?function(r){return`geo(${r.latitude},${r.longitude})`}(t.geoPointValue):"arrayValue"in t?function(r){let s="[",c=!0;for(const d of r.values||[])c?c=!1:s+=",",s+=fk(d);return s+"]"}(t.arrayValue):"mapValue"in t?function(r){const s=Object.keys(r.fields||{}).sort();let c="{",d=!0;for(const _ of s)d?d=!1:c+=",",c+=`${_}:${fk(r.fields[_])}`;return c+"}"}(t.mapValue):Er()}function Qj(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function pk(t){return!!t&&"integerValue"in t}function hD(t){return!!t&&"arrayValue"in t}function Yj(t){return!!t&&"nullValue"in t}function Jj(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function wE(t){return!!t&&"mapValue"in t}function lde(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function P1(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ig(t.mapValue.fields,(r,s)=>e.mapValue.fields[r]=P1(s)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=P1(t.arrayValue.values[r]);return e}return Object.assign({},t)}function cde(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Na{constructor(e){this.value=e}static empty(){return new Na({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let s=0;s<e.length-1;++s)if(r=(r.mapValue.fields||{})[e.get(s)],!wE(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=P1(r)}setAll(e){let r=Po.emptyPath(),s={},c=[];e.forEach((_,x)=>{if(!r.isImmediateParentOf(x)){const a=this.getFieldsMap(r);this.applyChanges(a,s,c),s={},c=[],r=x.popLast()}_?s[x.lastSegment()]=P1(_):c.push(x.lastSegment())});const d=this.getFieldsMap(r);this.applyChanges(d,s,c)}delete(e){const r=this.field(e.popLast());wE(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return Vu(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let s=0;s<e.length;++s){let c=r.mapValue.fields[e.get(s)];wE(c)&&c.mapValue.fields||(c={mapValue:{fields:{}}},r.mapValue.fields[e.get(s)]=c),r=c}return r.mapValue.fields}applyChanges(e,r,s){ig(r,(c,d)=>e[c]=d);for(const c of s)delete e[c]}clone(){return new Na(P1(this.value))}}function jq(t){const e=[];return ig(t.fields,(r,s)=>{const c=new Po([r]);if(wE(s)){const d=jq(s.mapValue).fields;if(d.length===0)e.push(c);else for(const _ of d)e.push(c.child(_))}else e.push(c)}),new ll(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xo{constructor(e,r,s,c,d,_,x){this.key=e,this.documentType=r,this.version=s,this.readTime=c,this.createTime=d,this.data=_,this.documentState=x}static newInvalidDocument(e){return new Xo(e,0,Ar.min(),Ar.min(),Ar.min(),Na.empty(),0)}static newFoundDocument(e,r,s,c){return new Xo(e,1,r,Ar.min(),s,c,0)}static newNoDocument(e,r){return new Xo(e,2,r,Ar.min(),Ar.min(),Na.empty(),0)}static newUnknownDocument(e,r){return new Xo(e,3,r,Ar.min(),Ar.min(),Na.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(Ar.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Na.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Na.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ar.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Xo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Xo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IS{constructor(e,r){this.position=e,this.inclusive=r}}function eU(t,e,r){let s=0;for(let c=0;c<t.position.length;c++){const d=e[c],_=t.position[c];if(d.field.isKeyField()?s=rr.comparator(rr.fromName(_.referenceValue),r.key):s=Ay(_,r.data.field(d.field)),d.dir==="desc"&&(s*=-1),s!==0)break}return s}function tU(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let r=0;r<t.position.length;r++)if(!Vu(t.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xx{constructor(e,r="asc"){this.field=e,this.dir=r}}function ude(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Uq=class{};class Ys extends Uq{constructor(e,r,s){super(),this.field=e,this.op=r,this.value=s}static create(e,r,s){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,s):new dde(e,r,s):r==="array-contains"?new mde(e,s):r==="in"?new gde(e,s):r==="not-in"?new _de(e,s):r==="array-contains-any"?new yde(e,s):new Ys(e,r,s)}static createKeyFieldInFilter(e,r,s){return r==="in"?new fde(e,s):new pde(e,s)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(Ay(r,this.value)):r!==null&&Bm(this.value)===Bm(r)&&this.matchesComparison(Ay(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Er()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $c extends Uq{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new $c(e,r)}matches(e){return Vq(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Vq(t){return t.op==="and"}function $q(t){return hde(t)&&Vq(t)}function hde(t){for(const e of t.filters)if(e instanceof $c)return!1;return!0}function mk(t){if(t instanceof Ys)return t.field.canonicalString()+t.op.toString()+Py(t.value);if($q(t))return t.filters.map(e=>mk(e)).join(",");{const e=t.filters.map(r=>mk(r)).join(",");return`${t.op}(${e})`}}function qq(t,e){return t instanceof Ys?function(s,c){return c instanceof Ys&&s.op===c.op&&s.field.isEqual(c.field)&&Vu(s.value,c.value)}(t,e):t instanceof $c?function(s,c){return c instanceof $c&&s.op===c.op&&s.filters.length===c.filters.length?s.filters.reduce((d,_,x)=>d&&qq(_,c.filters[x]),!0):!1}(t,e):void Er()}function Gq(t){return t instanceof Ys?function(r){return`${r.field.canonicalString()} ${r.op} ${Py(r.value)}`}(t):t instanceof $c?function(r){return r.op.toString()+" {"+r.getFilters().map(Gq).join(" ,")+"}"}(t):"Filter"}class dde extends Ys{constructor(e,r,s){super(e,r,s),this.key=rr.fromName(s.referenceValue)}matches(e){const r=rr.comparator(e.key,this.key);return this.matchesComparison(r)}}class fde extends Ys{constructor(e,r){super(e,"in",r),this.keys=Wq("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class pde extends Ys{constructor(e,r){super(e,"not-in",r),this.keys=Wq("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function Wq(t,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(s=>rr.fromName(s.referenceValue))}class mde extends Ys{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return hD(r)&&vx(r.arrayValue,this.value)}}class gde extends Ys{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&vx(this.value.arrayValue,r)}}class _de extends Ys{constructor(e,r){super(e,"not-in",r)}matches(e){if(vx(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!vx(this.value.arrayValue,r)}}class yde extends Ys{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!hD(r)||!r.arrayValue.values)&&r.arrayValue.values.some(s=>vx(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vde{constructor(e,r=null,s=[],c=[],d=null,_=null,x=null){this.path=e,this.collectionGroup=r,this.orderBy=s,this.filters=c,this.limit=d,this.startAt=_,this.endAt=x,this.ue=null}}function nU(t,e=null,r=[],s=[],c=null,d=null,_=null){return new vde(t,e,r,s,c,d,_)}function dD(t){const e=Pr(t);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(s=>mk(s)).join(","),r+="|ob:",r+=e.orderBy.map(s=>function(d){return d.field.canonicalString()+d.dir}(s)).join(","),eC(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>Py(s)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>Py(s)).join(",")),e.ue=r}return e.ue}function fD(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<t.orderBy.length;r++)if(!ude(t.orderBy[r],e.orderBy[r]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(!qq(t.filters[r],e.filters[r]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!tU(t.startAt,e.startAt)&&tU(t.endAt,e.endAt)}function gk(t){return rr.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jy{constructor(e,r=null,s=[],c=[],d=null,_="F",x=null,a=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=s,this.filters=c,this.limit=d,this.limitType=_,this.startAt=x,this.endAt=a,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function xde(t,e,r,s,c,d,_,x){return new Jy(t,e,r,s,c,d,_,x)}function tC(t){return new Jy(t)}function rU(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function Hq(t){return t.collectionGroup!==null}function R1(t){const e=Pr(t);if(e.ce===null){e.ce=[];const r=new Set;for(const d of e.explicitOrderBy)e.ce.push(d),r.add(d.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(_){let x=new Mo(Po.comparator);return _.filters.forEach(a=>{a.getFlattenedFilters().forEach(I=>{I.isInequality()&&(x=x.add(I.field))})}),x})(e).forEach(d=>{r.has(d.canonicalString())||d.isKeyField()||e.ce.push(new xx(d,s))}),r.has(Po.keyField().canonicalString())||e.ce.push(new xx(Po.keyField(),s))}return e.ce}function Fu(t){const e=Pr(t);return e.le||(e.le=bde(e,R1(t))),e.le}function bde(t,e){if(t.limitType==="F")return nU(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(c=>{const d=c.dir==="desc"?"asc":"desc";return new xx(c.field,d)});const r=t.endAt?new IS(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new IS(t.startAt.position,t.startAt.inclusive):null;return nU(t.path,t.collectionGroup,e,t.filters,t.limit,r,s)}}function _k(t,e){const r=t.filters.concat([e]);return new Jy(t.path,t.collectionGroup,t.explicitOrderBy.slice(),r,t.limit,t.limitType,t.startAt,t.endAt)}function CS(t,e,r){return new Jy(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,r,t.startAt,t.endAt)}function nC(t,e){return fD(Fu(t),Fu(e))&&t.limitType===e.limitType}function Zq(t){return`${dD(Fu(t))}|lt:${t.limitType}`}function A_(t){return`Query(target=${function(r){let s=r.path.canonicalString();return r.collectionGroup!==null&&(s+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(s+=`, filters: [${r.filters.map(c=>Gq(c)).join(", ")}]`),eC(r.limit)||(s+=", limit: "+r.limit),r.orderBy.length>0&&(s+=`, orderBy: [${r.orderBy.map(c=>function(_){return`${_.field.canonicalString()} (${_.dir})`}(c)).join(", ")}]`),r.startAt&&(s+=", startAt: ",s+=r.startAt.inclusive?"b:":"a:",s+=r.startAt.position.map(c=>Py(c)).join(",")),r.endAt&&(s+=", endAt: ",s+=r.endAt.inclusive?"a:":"b:",s+=r.endAt.position.map(c=>Py(c)).join(",")),`Target(${s})`}(Fu(t))}; limitType=${t.limitType})`}function rC(t,e){return e.isFoundDocument()&&function(s,c){const d=c.key.path;return s.collectionGroup!==null?c.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(d):rr.isDocumentKey(s.path)?s.path.isEqual(d):s.path.isImmediateParentOf(d)}(t,e)&&function(s,c){for(const d of R1(s))if(!d.field.isKeyField()&&c.data.field(d.field)===null)return!1;return!0}(t,e)&&function(s,c){for(const d of s.filters)if(!d.matches(c))return!1;return!0}(t,e)&&function(s,c){return!(s.startAt&&!function(_,x,a){const I=eU(_,x,a);return _.inclusive?I<=0:I<0}(s.startAt,R1(s),c)||s.endAt&&!function(_,x,a){const I=eU(_,x,a);return _.inclusive?I>=0:I>0}(s.endAt,R1(s),c))}(t,e)}function wde(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Xq(t){return(e,r)=>{let s=!1;for(const c of R1(t)){const d=Tde(c,e,r);if(d!==0)return d;s=s||c.field.isKeyField()}return 0}}function Tde(t,e,r){const s=t.field.isKeyField()?rr.comparator(e.key,r.key):function(d,_,x){const a=_.data.field(d),I=x.data.field(d);return a!==null&&I!==null?Ay(a,I):Er()}(t.field,e,r);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Er()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e0{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),s=this.inner[r];if(s!==void 0){for(const[c,d]of s)if(this.equalsFn(c,e))return d}}has(e){return this.get(e)!==void 0}set(e,r){const s=this.mapKeyFn(e),c=this.inner[s];if(c===void 0)return this.inner[s]=[[e,r]],void this.innerSize++;for(let d=0;d<c.length;d++)if(this.equalsFn(c[d][0],e))return void(c[d]=[e,r]);c.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return!1;for(let c=0;c<s.length;c++)if(this.equalsFn(s[c][0],e))return s.length===1?delete this.inner[r]:s.splice(c,1),this.innerSize--,!0;return!1}forEach(e){ig(this.inner,(r,s)=>{for(const[c,d]of s)e(c,d)})}isEmpty(){return Fq(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ede=new bs(rr.comparator);function Xh(){return Ede}const Kq=new bs(rr.comparator);function s1(...t){let e=Kq;for(const r of t)e=e.insert(r.key,r);return e}function Qq(t){let e=Kq;return t.forEach((r,s)=>e=e.insert(r,s.overlayedDocument)),e}function fm(){return M1()}function Yq(){return M1()}function M1(){return new e0(t=>t.toString(),(t,e)=>t.isEqual(e))}const Sde=new bs(rr.comparator),Ide=new Mo(rr.comparator);function Hr(...t){let e=Ide;for(const r of t)e=e.add(r);return e}const Cde=new Mo(si);function Ade(){return Cde}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pD(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:SS(e)?"-0":e}}function Jq(t){return{integerValue:""+t}}function Pde(t,e){return sde(e)?Jq(e):pD(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iC{constructor(){this._=void 0}}function Rde(t,e,r){return t instanceof bx?function(c,d){const _={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:c.seconds,nanos:c.nanoseconds}}}};return d&&cD(d)&&(d=uD(d)),d&&(_.fields.__previous_value__=d),{mapValue:_}}(r,e):t instanceof Ry?tG(t,e):t instanceof My?nG(t,e):function(c,d){const _=eG(c,d),x=iU(_)+iU(c.Pe);return pk(_)&&pk(c.Pe)?Jq(x):pD(c.serializer,x)}(t,e)}function Mde(t,e,r){return t instanceof Ry?tG(t,e):t instanceof My?nG(t,e):r}function eG(t,e){return t instanceof AS?function(s){return pk(s)||function(d){return!!d&&"doubleValue"in d}(s)}(e)?e:{integerValue:0}:null}class bx extends iC{}class Ry extends iC{constructor(e){super(),this.elements=e}}function tG(t,e){const r=rG(e);for(const s of t.elements)r.some(c=>Vu(c,s))||r.push(s);return{arrayValue:{values:r}}}class My extends iC{constructor(e){super(),this.elements=e}}function nG(t,e){let r=rG(e);for(const s of t.elements)r=r.filter(c=>!Vu(c,s));return{arrayValue:{values:r}}}class AS extends iC{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function iU(t){return js(t.integerValue||t.doubleValue)}function rG(t){return hD(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mD{constructor(e,r){this.field=e,this.transform=r}}function kde(t,e){return t.field.isEqual(e.field)&&function(s,c){return s instanceof Ry&&c instanceof Ry||s instanceof My&&c instanceof My?Cy(s.elements,c.elements,Vu):s instanceof AS&&c instanceof AS?Vu(s.Pe,c.Pe):s instanceof bx&&c instanceof bx}(t.transform,e.transform)}class Ode{constructor(e,r){this.version=e,this.transformResults=r}}class Zl{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new Zl}static exists(e){return new Zl(void 0,e)}static updateTime(e){return new Zl(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function TE(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class sC{}function iG(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new gD(t.key,Zl.none()):new ib(t.key,t.data,Zl.none());{const r=t.data,s=Na.empty();let c=new Mo(Po.comparator);for(let d of e.fields)if(!c.has(d)){let _=r.field(d);_===null&&d.length>1&&(d=d.popLast(),_=r.field(d)),_===null?s.delete(d):s.set(d,_),c=c.add(d)}return new Qf(t.key,s,new ll(c.toArray()),Zl.none())}}function Dde(t,e,r){t instanceof ib?function(c,d,_){const x=c.value.clone(),a=oU(c.fieldTransforms,d,_.transformResults);x.setAll(a),d.convertToFoundDocument(_.version,x).setHasCommittedMutations()}(t,e,r):t instanceof Qf?function(c,d,_){if(!TE(c.precondition,d))return void d.convertToUnknownDocument(_.version);const x=oU(c.fieldTransforms,d,_.transformResults),a=d.data;a.setAll(sG(c)),a.setAll(x),d.convertToFoundDocument(_.version,a).setHasCommittedMutations()}(t,e,r):function(c,d,_){d.convertToNoDocument(_.version).setHasCommittedMutations()}(0,e,r)}function k1(t,e,r,s){return t instanceof ib?function(d,_,x,a){if(!TE(d.precondition,_))return x;const I=d.value.clone(),M=aU(d.fieldTransforms,a,_);return I.setAll(M),_.convertToFoundDocument(_.version,I).setHasLocalMutations(),null}(t,e,r,s):t instanceof Qf?function(d,_,x,a){if(!TE(d.precondition,_))return x;const I=aU(d.fieldTransforms,a,_),M=_.data;return M.setAll(sG(d)),M.setAll(I),_.convertToFoundDocument(_.version,M).setHasLocalMutations(),x===null?null:x.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(D=>D.field))}(t,e,r,s):function(d,_,x){return TE(d.precondition,_)?(_.convertToNoDocument(_.version).setHasLocalMutations(),null):x}(t,e,r)}function Lde(t,e){let r=null;for(const s of t.fieldTransforms){const c=e.data.field(s.field),d=eG(s.transform,c||null);d!=null&&(r===null&&(r=Na.empty()),r.set(s.field,d))}return r||null}function sU(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(s,c){return s===void 0&&c===void 0||!(!s||!c)&&Cy(s,c,(d,_)=>kde(d,_))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ib extends sC{constructor(e,r,s,c=[]){super(),this.key=e,this.value=r,this.precondition=s,this.fieldTransforms=c,this.type=0}getFieldMask(){return null}}class Qf extends sC{constructor(e,r,s,c,d=[]){super(),this.key=e,this.data=r,this.fieldMask=s,this.precondition=c,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function sG(t){const e=new Map;return t.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const s=t.data.field(r);e.set(r,s)}}),e}function oU(t,e,r){const s=new Map;Ni(t.length===r.length);for(let c=0;c<r.length;c++){const d=t[c],_=d.transform,x=e.data.field(d.field);s.set(d.field,Mde(_,x,r[c]))}return s}function aU(t,e,r){const s=new Map;for(const c of t){const d=c.transform,_=r.data.field(c.field);s.set(c.field,Rde(d,_,e))}return s}class gD extends sC{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zde extends sC{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nde{constructor(e,r,s,c){this.batchId=e,this.localWriteTime=r,this.baseMutations=s,this.mutations=c}applyToRemoteDocument(e,r){const s=r.mutationResults;for(let c=0;c<this.mutations.length;c++){const d=this.mutations[c];d.key.isEqual(e.key)&&Dde(d,e,s[c])}}applyToLocalView(e,r){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(r=k1(s,e,r,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(r=k1(s,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const s=Yq();return this.mutations.forEach(c=>{const d=e.get(c.key),_=d.overlayedDocument;let x=this.applyToLocalView(_,d.mutatedFields);x=r.has(c.key)?null:x;const a=iG(_,x);a!==null&&s.set(c.key,a),_.isValidDocument()||_.convertToNoDocument(Ar.min())}),s}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),Hr())}isEqual(e){return this.batchId===e.batchId&&Cy(this.mutations,e.mutations,(r,s)=>sU(r,s))&&Cy(this.baseMutations,e.baseMutations,(r,s)=>sU(r,s))}}class _D{constructor(e,r,s,c){this.batch=e,this.commitVersion=r,this.mutationResults=s,this.docVersions=c}static from(e,r,s){Ni(e.mutations.length===s.length);let c=function(){return Sde}();const d=e.mutations;for(let _=0;_<d.length;_++)c=c.insert(d[_].key,s[_].version);return new _D(e,r,s,c)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fde{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bde{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Zs,ei;function jde(t){switch(t){default:return Er();case Qt.CANCELLED:case Qt.UNKNOWN:case Qt.DEADLINE_EXCEEDED:case Qt.RESOURCE_EXHAUSTED:case Qt.INTERNAL:case Qt.UNAVAILABLE:case Qt.UNAUTHENTICATED:return!1;case Qt.INVALID_ARGUMENT:case Qt.NOT_FOUND:case Qt.ALREADY_EXISTS:case Qt.PERMISSION_DENIED:case Qt.FAILED_PRECONDITION:case Qt.ABORTED:case Qt.OUT_OF_RANGE:case Qt.UNIMPLEMENTED:case Qt.DATA_LOSS:return!0}}function oG(t){if(t===void 0)return Zh("GRPC error has no .code"),Qt.UNKNOWN;switch(t){case Zs.OK:return Qt.OK;case Zs.CANCELLED:return Qt.CANCELLED;case Zs.UNKNOWN:return Qt.UNKNOWN;case Zs.DEADLINE_EXCEEDED:return Qt.DEADLINE_EXCEEDED;case Zs.RESOURCE_EXHAUSTED:return Qt.RESOURCE_EXHAUSTED;case Zs.INTERNAL:return Qt.INTERNAL;case Zs.UNAVAILABLE:return Qt.UNAVAILABLE;case Zs.UNAUTHENTICATED:return Qt.UNAUTHENTICATED;case Zs.INVALID_ARGUMENT:return Qt.INVALID_ARGUMENT;case Zs.NOT_FOUND:return Qt.NOT_FOUND;case Zs.ALREADY_EXISTS:return Qt.ALREADY_EXISTS;case Zs.PERMISSION_DENIED:return Qt.PERMISSION_DENIED;case Zs.FAILED_PRECONDITION:return Qt.FAILED_PRECONDITION;case Zs.ABORTED:return Qt.ABORTED;case Zs.OUT_OF_RANGE:return Qt.OUT_OF_RANGE;case Zs.UNIMPLEMENTED:return Qt.UNIMPLEMENTED;case Zs.DATA_LOSS:return Qt.DATA_LOSS;default:return Er()}}(ei=Zs||(Zs={}))[ei.OK=0]="OK",ei[ei.CANCELLED=1]="CANCELLED",ei[ei.UNKNOWN=2]="UNKNOWN",ei[ei.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ei[ei.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ei[ei.NOT_FOUND=5]="NOT_FOUND",ei[ei.ALREADY_EXISTS=6]="ALREADY_EXISTS",ei[ei.PERMISSION_DENIED=7]="PERMISSION_DENIED",ei[ei.UNAUTHENTICATED=16]="UNAUTHENTICATED",ei[ei.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ei[ei.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ei[ei.ABORTED=10]="ABORTED",ei[ei.OUT_OF_RANGE=11]="OUT_OF_RANGE",ei[ei.UNIMPLEMENTED=12]="UNIMPLEMENTED",ei[ei.INTERNAL=13]="INTERNAL",ei[ei.UNAVAILABLE=14]="UNAVAILABLE",ei[ei.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ude(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vde=new bm([4294967295,4294967295],0);function lU(t){const e=Ude().encode(t),r=new Pq;return r.update(e),new Uint8Array(r.digest())}function cU(t){const e=new DataView(t.buffer),r=e.getUint32(0,!0),s=e.getUint32(4,!0),c=e.getUint32(8,!0),d=e.getUint32(12,!0);return[new bm([r,s],0),new bm([c,d],0)]}class yD{constructor(e,r,s){if(this.bitmap=e,this.padding=r,this.hashCount=s,r<0||r>=8)throw new o1(`Invalid padding: ${r}`);if(s<0)throw new o1(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new o1(`Invalid hash count: ${s}`);if(e.length===0&&r!==0)throw new o1(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=bm.fromNumber(this.Ie)}Ee(e,r,s){let c=e.add(r.multiply(bm.fromNumber(s)));return c.compare(Vde)===1&&(c=new bm([c.getBits(0),c.getBits(1)],0)),c.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=lU(e),[s,c]=cU(r);for(let d=0;d<this.hashCount;d++){const _=this.Ee(s,c,d);if(!this.de(_))return!1}return!0}static create(e,r,s){const c=e%8==0?0:8-e%8,d=new Uint8Array(Math.ceil(e/8)),_=new yD(d,c,r);return s.forEach(x=>_.insert(x)),_}insert(e){if(this.Ie===0)return;const r=lU(e),[s,c]=cU(r);for(let d=0;d<this.hashCount;d++){const _=this.Ee(s,c,d);this.Ae(_)}}Ae(e){const r=Math.floor(e/8),s=e%8;this.bitmap[r]|=1<<s}}class o1 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oC{constructor(e,r,s,c,d){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=s,this.documentUpdates=c,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(e,r,s){const c=new Map;return c.set(e,sb.createSynthesizedTargetChangeForCurrentChange(e,r,s)),new oC(Ar.min(),c,new bs(si),Xh(),Hr())}}class sb{constructor(e,r,s,c,d){this.resumeToken=e,this.current=r,this.addedDocuments=s,this.modifiedDocuments=c,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(e,r,s){return new sb(s,r,Hr(),Hr(),Hr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EE{constructor(e,r,s,c){this.Re=e,this.removedTargetIds=r,this.key=s,this.Ve=c}}class aG{constructor(e,r){this.targetId=e,this.me=r}}class lG{constructor(e,r,s=Oo.EMPTY_BYTE_STRING,c=null){this.state=e,this.targetIds=r,this.resumeToken=s,this.cause=c}}class uU{constructor(){this.fe=0,this.ge=dU(),this.pe=Oo.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Hr(),r=Hr(),s=Hr();return this.ge.forEach((c,d)=>{switch(d){case 0:e=e.add(c);break;case 2:r=r.add(c);break;case 1:s=s.add(c);break;default:Er()}}),new sb(this.pe,this.ye,e,r,s)}Ce(){this.we=!1,this.ge=dU()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Ni(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class $de{constructor(e){this.Le=e,this.Be=new Map,this.ke=Xh(),this.qe=hU(),this.Qe=new bs(si)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const s=this.Ge(r);switch(e.state){case 0:this.ze(r)&&s.De(e.resumeToken);break;case 1:s.Oe(),s.Se||s.Ce(),s.De(e.resumeToken);break;case 2:s.Oe(),s.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(s.Ne(),s.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),s.De(e.resumeToken));break;default:Er()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((s,c)=>{this.ze(c)&&r(c)})}He(e){const r=e.targetId,s=e.me.count,c=this.Je(r);if(c){const d=c.target;if(gk(d))if(s===0){const _=new rr(d.path);this.Ue(r,_,Xo.newNoDocument(_,Ar.min()))}else Ni(s===1);else{const _=this.Ye(r);if(_!==s){const x=this.Ze(e),a=x?this.Xe(x,e,_):1;if(a!==0){this.je(r);const I=a===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,I)}}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:s="",padding:c=0},hashCount:d=0}=r;let _,x;try{_=Fm(s).toUint8Array()}catch(a){if(a instanceof Bq)return Iy("Decoding the base64 bloom filter in existence filter failed ("+a.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw a}try{x=new yD(_,c,d)}catch(a){return Iy(a instanceof o1?"BloomFilter error: ":"Applying bloom filter failed: ",a),null}return x.Ie===0?null:x}Xe(e,r,s){return r.me.count===s-this.nt(e,r.targetId)?0:2}nt(e,r){const s=this.Le.getRemoteKeysForTarget(r);let c=0;return s.forEach(d=>{const _=this.Le.tt(),x=`projects/${_.projectId}/databases/${_.database}/documents/${d.path.canonicalString()}`;e.mightContain(x)||(this.Ue(r,d,null),c++)}),c}rt(e){const r=new Map;this.Be.forEach((d,_)=>{const x=this.Je(_);if(x){if(d.current&&gk(x.target)){const a=new rr(x.target.path);this.ke.get(a)!==null||this.it(_,a)||this.Ue(_,a,Xo.newNoDocument(a,e))}d.be&&(r.set(_,d.ve()),d.Ce())}});let s=Hr();this.qe.forEach((d,_)=>{let x=!0;_.forEachWhile(a=>{const I=this.Je(a);return!I||I.purpose==="TargetPurposeLimboResolution"||(x=!1,!1)}),x&&(s=s.add(d))}),this.ke.forEach((d,_)=>_.setReadTime(e));const c=new oC(e,r,this.Qe,this.ke,s);return this.ke=Xh(),this.qe=hU(),this.Qe=new bs(si),c}$e(e,r){if(!this.ze(e))return;const s=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,s),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,s){if(!this.ze(e))return;const c=this.Ge(e);this.it(e,r)?c.Fe(r,1):c.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),s&&(this.ke=this.ke.insert(r,s))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new uU,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new Mo(si),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||$n("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new uU),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function hU(){return new bs(rr.comparator)}function dU(){return new bs(rr.comparator)}const qde={asc:"ASCENDING",desc:"DESCENDING"},Gde={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Wde={and:"AND",or:"OR"};class Hde{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function yk(t,e){return t.useProto3Json||eC(e)?e:{value:e}}function PS(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cG(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Zde(t,e){return PS(t,e.toTimestamp())}function Bu(t){return Ni(!!t),Ar.fromTimestamp(function(r){const s=Nf(r);return new ho(s.seconds,s.nanos)}(t))}function vD(t,e){return vk(t,e).canonicalString()}function vk(t,e){const r=function(c){return new Yi(["projects",c.projectId,"databases",c.database])}(t).child("documents");return e===void 0?r:r.child(e)}function uG(t){const e=Yi.fromString(t);return Ni(mG(e)),e}function xk(t,e){return vD(t.databaseId,e.path)}function fR(t,e){const r=uG(e);if(r.get(1)!==t.databaseId.projectId)throw new kn(Qt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new kn(Qt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new rr(dG(r))}function hG(t,e){return vD(t.databaseId,e)}function Xde(t){const e=uG(t);return e.length===4?Yi.emptyPath():dG(e)}function bk(t){return new Yi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function dG(t){return Ni(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function fU(t,e,r){return{name:xk(t,e),fields:r.value.mapValue.fields}}function Kde(t,e){let r;if("targetChange"in e){e.targetChange;const s=function(I){return I==="NO_CHANGE"?0:I==="ADD"?1:I==="REMOVE"?2:I==="CURRENT"?3:I==="RESET"?4:Er()}(e.targetChange.targetChangeType||"NO_CHANGE"),c=e.targetChange.targetIds||[],d=function(I,M){return I.useProto3Json?(Ni(M===void 0||typeof M=="string"),Oo.fromBase64String(M||"")):(Ni(M===void 0||M instanceof Buffer||M instanceof Uint8Array),Oo.fromUint8Array(M||new Uint8Array))}(t,e.targetChange.resumeToken),_=e.targetChange.cause,x=_&&function(I){const M=I.code===void 0?Qt.UNKNOWN:oG(I.code);return new kn(M,I.message||"")}(_);r=new lG(s,c,d,x||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const c=fR(t,s.document.name),d=Bu(s.document.updateTime),_=s.document.createTime?Bu(s.document.createTime):Ar.min(),x=new Na({mapValue:{fields:s.document.fields}}),a=Xo.newFoundDocument(c,d,_,x),I=s.targetIds||[],M=s.removedTargetIds||[];r=new EE(I,M,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const c=fR(t,s.document),d=s.readTime?Bu(s.readTime):Ar.min(),_=Xo.newNoDocument(c,d),x=s.removedTargetIds||[];r=new EE([],x,_.key,_)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const c=fR(t,s.document),d=s.removedTargetIds||[];r=new EE([],d,c,null)}else{if(!("filter"in e))return Er();{e.filter;const s=e.filter;s.targetId;const{count:c=0,unchangedNames:d}=s,_=new Bde(c,d),x=s.targetId;r=new aG(x,_)}}return r}function Qde(t,e){let r;if(e instanceof ib)r={update:fU(t,e.key,e.value)};else if(e instanceof gD)r={delete:xk(t,e.key)};else if(e instanceof Qf)r={update:fU(t,e.key,e.data),updateMask:ofe(e.fieldMask)};else{if(!(e instanceof zde))return Er();r={verify:xk(t,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(s=>function(d,_){const x=_.transform;if(x instanceof bx)return{fieldPath:_.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(x instanceof Ry)return{fieldPath:_.field.canonicalString(),appendMissingElements:{values:x.elements}};if(x instanceof My)return{fieldPath:_.field.canonicalString(),removeAllFromArray:{values:x.elements}};if(x instanceof AS)return{fieldPath:_.field.canonicalString(),increment:x.Pe};throw Er()}(0,s))),e.precondition.isNone||(r.currentDocument=function(c,d){return d.updateTime!==void 0?{updateTime:Zde(c,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Er()}(t,e.precondition)),r}function Yde(t,e){return t&&t.length>0?(Ni(e!==void 0),t.map(r=>function(c,d){let _=c.updateTime?Bu(c.updateTime):Bu(d);return _.isEqual(Ar.min())&&(_=Bu(d)),new Ode(_,c.transformResults||[])}(r,e))):[]}function Jde(t,e){return{documents:[hG(t,e.path)]}}function efe(t,e){const r={structuredQuery:{}},s=e.path;let c;e.collectionGroup!==null?(c=s,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(c=s.popLast(),r.structuredQuery.from=[{collectionId:s.lastSegment()}]),r.parent=hG(t,c);const d=function(I){if(I.length!==0)return pG($c.create(I,"and"))}(e.filters);d&&(r.structuredQuery.where=d);const _=function(I){if(I.length!==0)return I.map(M=>function(L){return{field:P_(L.field),direction:rfe(L.dir)}}(M))}(e.orderBy);_&&(r.structuredQuery.orderBy=_);const x=yk(t,e.limit);return x!==null&&(r.structuredQuery.limit=x),e.startAt&&(r.structuredQuery.startAt=function(I){return{before:I.inclusive,values:I.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(I){return{before:!I.inclusive,values:I.position}}(e.endAt)),{_t:r,parent:c}}function tfe(t){let e=Xde(t.parent);const r=t.structuredQuery,s=r.from?r.from.length:0;let c=null;if(s>0){Ni(s===1);const M=r.from[0];M.allDescendants?c=M.collectionId:e=e.child(M.collectionId)}let d=[];r.where&&(d=function(D){const L=fG(D);return L instanceof $c&&$q(L)?L.getFilters():[L]}(r.where));let _=[];r.orderBy&&(_=function(D){return D.map(L=>function(Q){return new xx(R_(Q.field),function(ee){switch(ee){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Q.direction))}(L))}(r.orderBy));let x=null;r.limit&&(x=function(D){let L;return L=typeof D=="object"?D.value:D,eC(L)?null:L}(r.limit));let a=null;r.startAt&&(a=function(D){const L=!!D.before,G=D.values||[];return new IS(G,L)}(r.startAt));let I=null;return r.endAt&&(I=function(D){const L=!D.before,G=D.values||[];return new IS(G,L)}(r.endAt)),xde(e,c,_,d,x,"F",a,I)}function nfe(t,e){const r=function(c){switch(c){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Er()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function fG(t){return t.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const s=R_(r.unaryFilter.field);return Ys.create(s,"==",{doubleValue:NaN});case"IS_NULL":const c=R_(r.unaryFilter.field);return Ys.create(c,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=R_(r.unaryFilter.field);return Ys.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const _=R_(r.unaryFilter.field);return Ys.create(_,"!=",{nullValue:"NULL_VALUE"});default:return Er()}}(t):t.fieldFilter!==void 0?function(r){return Ys.create(R_(r.fieldFilter.field),function(c){switch(c){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Er()}}(r.fieldFilter.op),r.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(r){return $c.create(r.compositeFilter.filters.map(s=>fG(s)),function(c){switch(c){case"AND":return"and";case"OR":return"or";default:return Er()}}(r.compositeFilter.op))}(t):Er()}function rfe(t){return qde[t]}function ife(t){return Gde[t]}function sfe(t){return Wde[t]}function P_(t){return{fieldPath:t.canonicalString()}}function R_(t){return Po.fromServerFormat(t.fieldPath)}function pG(t){return t instanceof Ys?function(r){if(r.op==="=="){if(Jj(r.value))return{unaryFilter:{field:P_(r.field),op:"IS_NAN"}};if(Yj(r.value))return{unaryFilter:{field:P_(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(Jj(r.value))return{unaryFilter:{field:P_(r.field),op:"IS_NOT_NAN"}};if(Yj(r.value))return{unaryFilter:{field:P_(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:P_(r.field),op:ife(r.op),value:r.value}}}(t):t instanceof $c?function(r){const s=r.getFilters().map(c=>pG(c));return s.length===1?s[0]:{compositeFilter:{op:sfe(r.op),filters:s}}}(t):Er()}function ofe(t){const e=[];return t.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function mG(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(e,r,s,c,d=Ar.min(),_=Ar.min(),x=Oo.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=r,this.purpose=s,this.sequenceNumber=c,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=_,this.resumeToken=x,this.expectedCount=a}withSequenceNumber(e){return new pf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new pf(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new pf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new pf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class afe{constructor(e){this.ct=e}}function lfe(t){const e=tfe({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?CS(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cfe{constructor(){this.un=new ufe}addToCollectionParentIndex(e,r){return this.un.add(r),nn.resolve()}getCollectionParents(e,r){return nn.resolve(this.un.getEntries(r))}addFieldIndex(e,r){return nn.resolve()}deleteFieldIndex(e,r){return nn.resolve()}deleteAllFieldIndexes(e){return nn.resolve()}createTargetIndexes(e,r){return nn.resolve()}getDocumentsMatchingTarget(e,r){return nn.resolve(null)}getIndexType(e,r){return nn.resolve(0)}getFieldIndexes(e,r){return nn.resolve([])}getNextCollectionGroupToUpdate(e){return nn.resolve(null)}getMinOffset(e,r){return nn.resolve(zf.min())}getMinOffsetFromCollectionGroup(e,r){return nn.resolve(zf.min())}updateCollectionGroup(e,r,s){return nn.resolve()}updateIndexEntries(e,r){return nn.resolve()}}class ufe{constructor(){this.index={}}add(e){const r=e.lastSegment(),s=e.popLast(),c=this.index[r]||new Mo(Yi.comparator),d=!c.has(s);return this.index[r]=c.add(s),d}has(e){const r=e.lastSegment(),s=e.popLast(),c=this.index[r];return c&&c.has(s)}getEntries(e){return(this.index[e]||new Mo(Yi.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ky(0)}static kn(){return new ky(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hfe{constructor(){this.changes=new e0(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,Xo.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const s=this.changes.get(r);return s!==void 0?nn.resolve(s):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dfe{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ffe{constructor(e,r,s,c){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=s,this.indexManager=c}getDocument(e,r){let s=null;return this.documentOverlayCache.getOverlay(e,r).next(c=>(s=c,this.remoteDocumentCache.getEntry(e,r))).next(c=>(s!==null&&k1(s.mutation,c,ll.empty(),ho.now()),c))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(s=>this.getLocalViewOfDocuments(e,s,Hr()).next(()=>s))}getLocalViewOfDocuments(e,r,s=Hr()){const c=fm();return this.populateOverlays(e,c,r).next(()=>this.computeViews(e,r,c,s).next(d=>{let _=s1();return d.forEach((x,a)=>{_=_.insert(x,a.overlayedDocument)}),_}))}getOverlayedDocuments(e,r){const s=fm();return this.populateOverlays(e,s,r).next(()=>this.computeViews(e,r,s,Hr()))}populateOverlays(e,r,s){const c=[];return s.forEach(d=>{r.has(d)||c.push(d)}),this.documentOverlayCache.getOverlays(e,c).next(d=>{d.forEach((_,x)=>{r.set(_,x)})})}computeViews(e,r,s,c){let d=Xh();const _=M1(),x=function(){return M1()}();return r.forEach((a,I)=>{const M=s.get(I.key);c.has(I.key)&&(M===void 0||M.mutation instanceof Qf)?d=d.insert(I.key,I):M!==void 0?(_.set(I.key,M.mutation.getFieldMask()),k1(M.mutation,I,M.mutation.getFieldMask(),ho.now())):_.set(I.key,ll.empty())}),this.recalculateAndSaveOverlays(e,d).next(a=>(a.forEach((I,M)=>_.set(I,M)),r.forEach((I,M)=>{var D;return x.set(I,new dfe(M,(D=_.get(I))!==null&&D!==void 0?D:null))}),x))}recalculateAndSaveOverlays(e,r){const s=M1();let c=new bs((_,x)=>_-x),d=Hr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(_=>{for(const x of _)x.keys().forEach(a=>{const I=r.get(a);if(I===null)return;let M=s.get(a)||ll.empty();M=x.applyToLocalView(I,M),s.set(a,M);const D=(c.get(x.batchId)||Hr()).add(a);c=c.insert(x.batchId,D)})}).next(()=>{const _=[],x=c.getReverseIterator();for(;x.hasNext();){const a=x.getNext(),I=a.key,M=a.value,D=Yq();M.forEach(L=>{if(!d.has(L)){const G=iG(r.get(L),s.get(L));G!==null&&D.set(L,G),d=d.add(L)}}),_.push(this.documentOverlayCache.saveOverlays(e,I,D))}return nn.waitFor(_)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,r,s,c){return function(_){return rr.isDocumentKey(_.path)&&_.collectionGroup===null&&_.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):Hq(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,s,c):this.getDocumentsMatchingCollectionQuery(e,r,s,c)}getNextDocuments(e,r,s,c){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,s,c).next(d=>{const _=c-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,s.largestBatchId,c-d.size):nn.resolve(fm());let x=-1,a=d;return _.next(I=>nn.forEach(I,(M,D)=>(x<D.largestBatchId&&(x=D.largestBatchId),d.get(M)?nn.resolve():this.remoteDocumentCache.getEntry(e,M).next(L=>{a=a.insert(M,L)}))).next(()=>this.populateOverlays(e,I,d)).next(()=>this.computeViews(e,a,I,Hr())).next(M=>({batchId:x,changes:Qq(M)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new rr(r)).next(s=>{let c=s1();return s.isFoundDocument()&&(c=c.insert(s.key,s)),c})}getDocumentsMatchingCollectionGroupQuery(e,r,s,c){const d=r.collectionGroup;let _=s1();return this.indexManager.getCollectionParents(e,d).next(x=>nn.forEach(x,a=>{const I=function(D,L){return new Jy(L,null,D.explicitOrderBy.slice(),D.filters.slice(),D.limit,D.limitType,D.startAt,D.endAt)}(r,a.child(d));return this.getDocumentsMatchingCollectionQuery(e,I,s,c).next(M=>{M.forEach((D,L)=>{_=_.insert(D,L)})})}).next(()=>_))}getDocumentsMatchingCollectionQuery(e,r,s,c){let d;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,s.largestBatchId).next(_=>(d=_,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,s,d,c))).next(_=>{d.forEach((a,I)=>{const M=I.getKey();_.get(M)===null&&(_=_.insert(M,Xo.newInvalidDocument(M)))});let x=s1();return _.forEach((a,I)=>{const M=d.get(a);M!==void 0&&k1(M.mutation,I,ll.empty(),ho.now()),rC(r,I)&&(x=x.insert(a,I))}),x})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pfe{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,r){return nn.resolve(this.hr.get(r))}saveBundleMetadata(e,r){return this.hr.set(r.id,function(c){return{id:c.id,version:c.version,createTime:Bu(c.createTime)}}(r)),nn.resolve()}getNamedQuery(e,r){return nn.resolve(this.Pr.get(r))}saveNamedQuery(e,r){return this.Pr.set(r.name,function(c){return{name:c.name,query:lfe(c.bundledQuery),readTime:Bu(c.readTime)}}(r)),nn.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mfe{constructor(){this.overlays=new bs(rr.comparator),this.Ir=new Map}getOverlay(e,r){return nn.resolve(this.overlays.get(r))}getOverlays(e,r){const s=fm();return nn.forEach(r,c=>this.getOverlay(e,c).next(d=>{d!==null&&s.set(c,d)})).next(()=>s)}saveOverlays(e,r,s){return s.forEach((c,d)=>{this.ht(e,r,d)}),nn.resolve()}removeOverlaysForBatchId(e,r,s){const c=this.Ir.get(s);return c!==void 0&&(c.forEach(d=>this.overlays=this.overlays.remove(d)),this.Ir.delete(s)),nn.resolve()}getOverlaysForCollection(e,r,s){const c=fm(),d=r.length+1,_=new rr(r.child("")),x=this.overlays.getIteratorFrom(_);for(;x.hasNext();){const a=x.getNext().value,I=a.getKey();if(!r.isPrefixOf(I.path))break;I.path.length===d&&a.largestBatchId>s&&c.set(a.getKey(),a)}return nn.resolve(c)}getOverlaysForCollectionGroup(e,r,s,c){let d=new bs((I,M)=>I-M);const _=this.overlays.getIterator();for(;_.hasNext();){const I=_.getNext().value;if(I.getKey().getCollectionGroup()===r&&I.largestBatchId>s){let M=d.get(I.largestBatchId);M===null&&(M=fm(),d=d.insert(I.largestBatchId,M)),M.set(I.getKey(),I)}}const x=fm(),a=d.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((I,M)=>x.set(I,M)),!(x.size()>=c)););return nn.resolve(x)}ht(e,r,s){const c=this.overlays.get(s.key);if(c!==null){const _=this.Ir.get(c.largestBatchId).delete(s.key);this.Ir.set(c.largestBatchId,_)}this.overlays=this.overlays.insert(s.key,new Fde(r,s));let d=this.Ir.get(r);d===void 0&&(d=Hr(),this.Ir.set(r,d)),this.Ir.set(r,d.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gfe{constructor(){this.sessionToken=Oo.EMPTY_BYTE_STRING}getSessionToken(e){return nn.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,nn.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD{constructor(){this.Tr=new Mo(vo.Er),this.dr=new Mo(vo.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,r){const s=new vo(e,r);this.Tr=this.Tr.add(s),this.dr=this.dr.add(s)}Rr(e,r){e.forEach(s=>this.addReference(s,r))}removeReference(e,r){this.Vr(new vo(e,r))}mr(e,r){e.forEach(s=>this.removeReference(s,r))}gr(e){const r=new rr(new Yi([])),s=new vo(r,e),c=new vo(r,e+1),d=[];return this.dr.forEachInRange([s,c],_=>{this.Vr(_),d.push(_.key)}),d}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const r=new rr(new Yi([])),s=new vo(r,e),c=new vo(r,e+1);let d=Hr();return this.dr.forEachInRange([s,c],_=>{d=d.add(_.key)}),d}containsKey(e){const r=new vo(e,0),s=this.Tr.firstAfterOrEqual(r);return s!==null&&e.isEqual(s.key)}}class vo{constructor(e,r){this.key=e,this.wr=r}static Er(e,r){return rr.comparator(e.key,r.key)||si(e.wr,r.wr)}static Ar(e,r){return si(e.wr,r.wr)||rr.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _fe{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new Mo(vo.Er)}checkEmpty(e){return nn.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,s,c){const d=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const _=new Nde(d,r,s,c);this.mutationQueue.push(_);for(const x of c)this.br=this.br.add(new vo(x.key,d)),this.indexManager.addToCollectionParentIndex(e,x.key.path.popLast());return nn.resolve(_)}lookupMutationBatch(e,r){return nn.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(e,r){const s=r+1,c=this.vr(s),d=c<0?0:c;return nn.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return nn.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return nn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const s=new vo(r,0),c=new vo(r,Number.POSITIVE_INFINITY),d=[];return this.br.forEachInRange([s,c],_=>{const x=this.Dr(_.wr);d.push(x)}),nn.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(e,r){let s=new Mo(si);return r.forEach(c=>{const d=new vo(c,0),_=new vo(c,Number.POSITIVE_INFINITY);this.br.forEachInRange([d,_],x=>{s=s.add(x.wr)})}),nn.resolve(this.Cr(s))}getAllMutationBatchesAffectingQuery(e,r){const s=r.path,c=s.length+1;let d=s;rr.isDocumentKey(d)||(d=d.child(""));const _=new vo(new rr(d),0);let x=new Mo(si);return this.br.forEachWhile(a=>{const I=a.key.path;return!!s.isPrefixOf(I)&&(I.length===c&&(x=x.add(a.wr)),!0)},_),nn.resolve(this.Cr(x))}Cr(e){const r=[];return e.forEach(s=>{const c=this.Dr(s);c!==null&&r.push(c)}),r}removeMutationBatch(e,r){Ni(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let s=this.br;return nn.forEach(r.mutations,c=>{const d=new vo(c.key,r.batchId);return s=s.delete(d),this.referenceDelegate.markPotentiallyOrphaned(e,c.key)}).next(()=>{this.br=s})}On(e){}containsKey(e,r){const s=new vo(r,0),c=this.br.firstAfterOrEqual(s);return nn.resolve(r.isEqual(c&&c.key))}performConsistencyCheck(e){return this.mutationQueue.length,nn.resolve()}Fr(e,r){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const r=this.vr(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yfe{constructor(e){this.Mr=e,this.docs=function(){return new bs(rr.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const s=r.key,c=this.docs.get(s),d=c?c.size:0,_=this.Mr(r);return this.docs=this.docs.insert(s,{document:r.mutableCopy(),size:_}),this.size+=_-d,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const s=this.docs.get(r);return nn.resolve(s?s.document.mutableCopy():Xo.newInvalidDocument(r))}getEntries(e,r){let s=Xh();return r.forEach(c=>{const d=this.docs.get(c);s=s.insert(c,d?d.document.mutableCopy():Xo.newInvalidDocument(c))}),nn.resolve(s)}getDocumentsMatchingQuery(e,r,s,c){let d=Xh();const _=r.path,x=new rr(_.child("")),a=this.docs.getIteratorFrom(x);for(;a.hasNext();){const{key:I,value:{document:M}}=a.getNext();if(!_.isPrefixOf(I.path))break;I.path.length>_.length+1||tde(ede(M),s)<=0||(c.has(M.key)||rC(r,M))&&(d=d.insert(M.key,M.mutableCopy()))}return nn.resolve(d)}getAllFromCollectionGroup(e,r,s,c){Er()}Or(e,r){return nn.forEach(this.docs,s=>r(s))}newChangeBuffer(e){return new vfe(this)}getSize(e){return nn.resolve(this.size)}}class vfe extends hfe{constructor(e){super(),this.cr=e}applyChanges(e){const r=[];return this.changes.forEach((s,c)=>{c.isValidDocument()?r.push(this.cr.addEntry(e,c)):this.cr.removeEntry(s)}),nn.waitFor(r)}getFromCache(e,r){return this.cr.getEntry(e,r)}getAllFromCache(e,r){return this.cr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xfe{constructor(e){this.persistence=e,this.Nr=new e0(r=>dD(r),fD),this.lastRemoteSnapshotVersion=Ar.min(),this.highestTargetId=0,this.Lr=0,this.Br=new xD,this.targetCount=0,this.kr=ky.Bn()}forEachTarget(e,r){return this.Nr.forEach((s,c)=>r(c)),nn.resolve()}getLastRemoteSnapshotVersion(e){return nn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return nn.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),nn.resolve(this.highestTargetId)}setTargetsMetadata(e,r,s){return s&&(this.lastRemoteSnapshotVersion=s),r>this.Lr&&(this.Lr=r),nn.resolve()}Kn(e){this.Nr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.kr=new ky(r),this.highestTargetId=r),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,r){return this.Kn(r),this.targetCount+=1,nn.resolve()}updateTargetData(e,r){return this.Kn(r),nn.resolve()}removeTargetData(e,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,nn.resolve()}removeTargets(e,r,s){let c=0;const d=[];return this.Nr.forEach((_,x)=>{x.sequenceNumber<=r&&s.get(x.targetId)===null&&(this.Nr.delete(_),d.push(this.removeMatchingKeysForTargetId(e,x.targetId)),c++)}),nn.waitFor(d).next(()=>c)}getTargetCount(e){return nn.resolve(this.targetCount)}getTargetData(e,r){const s=this.Nr.get(r)||null;return nn.resolve(s)}addMatchingKeys(e,r,s){return this.Br.Rr(r,s),nn.resolve()}removeMatchingKeys(e,r,s){this.Br.mr(r,s);const c=this.persistence.referenceDelegate,d=[];return c&&r.forEach(_=>{d.push(c.markPotentiallyOrphaned(e,_))}),nn.waitFor(d)}removeMatchingKeysForTargetId(e,r){return this.Br.gr(r),nn.resolve()}getMatchingKeysForTargetId(e,r){const s=this.Br.yr(r);return nn.resolve(s)}containsKey(e,r){return nn.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bfe{constructor(e,r){this.qr={},this.overlays={},this.Qr=new lD(0),this.Kr=!1,this.Kr=!0,this.$r=new gfe,this.referenceDelegate=e(this),this.Ur=new xfe(this),this.indexManager=new cfe,this.remoteDocumentCache=function(c){return new yfe(c)}(s=>this.referenceDelegate.Wr(s)),this.serializer=new afe(r),this.Gr=new pfe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new mfe,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let s=this.qr[e.toKey()];return s||(s=new _fe(r,this.referenceDelegate),this.qr[e.toKey()]=s),s}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,r,s){$n("MemoryPersistence","Starting transaction:",e);const c=new wfe(this.Qr.next());return this.referenceDelegate.zr(),s(c).next(d=>this.referenceDelegate.jr(c).next(()=>d)).toPromise().then(d=>(c.raiseOnCommittedEvent(),d))}Hr(e,r){return nn.or(Object.values(this.qr).map(s=>()=>s.containsKey(e,r)))}}class wfe extends rde{constructor(e){super(),this.currentSequenceNumber=e}}class bD{constructor(e){this.persistence=e,this.Jr=new xD,this.Yr=null}static Zr(e){return new bD(e)}get Xr(){if(this.Yr)return this.Yr;throw Er()}addReference(e,r,s){return this.Jr.addReference(s,r),this.Xr.delete(s.toString()),nn.resolve()}removeReference(e,r,s){return this.Jr.removeReference(s,r),this.Xr.add(s.toString()),nn.resolve()}markPotentiallyOrphaned(e,r){return this.Xr.add(r.toString()),nn.resolve()}removeTarget(e,r){this.Jr.gr(r.targetId).forEach(c=>this.Xr.add(c.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,r.targetId).next(c=>{c.forEach(d=>this.Xr.add(d.toString()))}).next(()=>s.removeTargetData(e,r))}zr(){this.Yr=new Set}jr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return nn.forEach(this.Xr,s=>{const c=rr.fromPath(s);return this.ei(e,c).next(d=>{d||r.removeEntry(c,Ar.min())})}).next(()=>(this.Yr=null,r.apply(e)))}updateLimboDocument(e,r){return this.ei(e,r).next(s=>{s?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(e){return 0}ei(e,r){return nn.or([()=>nn.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Hr(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wD{constructor(e,r,s,c){this.targetId=e,this.fromCache=r,this.$i=s,this.Ui=c}static Wi(e,r){let s=Hr(),c=Hr();for(const d of r.docChanges)switch(d.type){case 0:s=s.add(d.doc.key);break;case 1:c=c.add(d.doc.key)}return new wD(e,r.fromCache,s,c)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tfe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Efe{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return mle()?8:ide(Jo())>0?6:4}()}initialize(e,r){this.Ji=e,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(e,r,s,c){const d={result:null};return this.Yi(e,r).next(_=>{d.result=_}).next(()=>{if(!d.result)return this.Zi(e,r,c,s).next(_=>{d.result=_})}).next(()=>{if(d.result)return;const _=new Tfe;return this.Xi(e,r,_).next(x=>{if(d.result=x,this.zi)return this.es(e,r,_,x.size)})}).next(()=>d.result)}es(e,r,s,c){return s.documentReadCount<this.ji?(Uv()<=Qr.DEBUG&&$n("QueryEngine","SDK will not create cache indexes for query:",A_(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),nn.resolve()):(Uv()<=Qr.DEBUG&&$n("QueryEngine","Query:",A_(r),"scans",s.documentReadCount,"local documents and returns",c,"documents as results."),s.documentReadCount>this.Hi*c?(Uv()<=Qr.DEBUG&&$n("QueryEngine","The SDK decides to create cache indexes for query:",A_(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Fu(r))):nn.resolve())}Yi(e,r){if(rU(r))return nn.resolve(null);let s=Fu(r);return this.indexManager.getIndexType(e,s).next(c=>c===0?null:(r.limit!==null&&c===1&&(r=CS(r,null,"F"),s=Fu(r)),this.indexManager.getDocumentsMatchingTarget(e,s).next(d=>{const _=Hr(...d);return this.Ji.getDocuments(e,_).next(x=>this.indexManager.getMinOffset(e,s).next(a=>{const I=this.ts(r,x);return this.ns(r,I,_,a.readTime)?this.Yi(e,CS(r,null,"F")):this.rs(e,I,r,a)}))})))}Zi(e,r,s,c){return rU(r)||c.isEqual(Ar.min())?nn.resolve(null):this.Ji.getDocuments(e,s).next(d=>{const _=this.ts(r,d);return this.ns(r,_,s,c)?nn.resolve(null):(Uv()<=Qr.DEBUG&&$n("QueryEngine","Re-using previous result from %s to execute query: %s",c.toString(),A_(r)),this.rs(e,_,r,Jhe(c,-1)).next(x=>x))})}ts(e,r){let s=new Mo(Xq(e));return r.forEach((c,d)=>{rC(e,d)&&(s=s.add(d))}),s}ns(e,r,s,c){if(e.limit===null)return!1;if(s.size!==r.size)return!0;const d=e.limitType==="F"?r.last():r.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(c)>0)}Xi(e,r,s){return Uv()<=Qr.DEBUG&&$n("QueryEngine","Using full collection scan to execute query:",A_(r)),this.Ji.getDocumentsMatchingQuery(e,r,zf.min(),s)}rs(e,r,s,c){return this.Ji.getDocumentsMatchingQuery(e,s,c).next(d=>(r.forEach(_=>{d=d.insert(_.key,_)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sfe{constructor(e,r,s,c){this.persistence=e,this.ss=r,this.serializer=c,this.os=new bs(si),this._s=new e0(d=>dD(d),fD),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(s)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ffe(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.os))}}function Ife(t,e,r,s){return new Sfe(t,e,r,s)}async function gG(t,e){const r=Pr(t);return await r.persistence.runTransaction("Handle user change","readonly",s=>{let c;return r.mutationQueue.getAllMutationBatches(s).next(d=>(c=d,r.ls(e),r.mutationQueue.getAllMutationBatches(s))).next(d=>{const _=[],x=[];let a=Hr();for(const I of c){_.push(I.batchId);for(const M of I.mutations)a=a.add(M.key)}for(const I of d){x.push(I.batchId);for(const M of I.mutations)a=a.add(M.key)}return r.localDocuments.getDocuments(s,a).next(I=>({hs:I,removedBatchIds:_,addedBatchIds:x}))})})}function Cfe(t,e){const r=Pr(t);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const c=e.batch.keys(),d=r.cs.newChangeBuffer({trackRemovals:!0});return function(x,a,I,M){const D=I.batch,L=D.keys();let G=nn.resolve();return L.forEach(Q=>{G=G.next(()=>M.getEntry(a,Q)).next(re=>{const ee=I.docVersions.get(Q);Ni(ee!==null),re.version.compareTo(ee)<0&&(D.applyToRemoteDocument(re,I),re.isValidDocument()&&(re.setReadTime(I.commitVersion),M.addEntry(re)))})}),G.next(()=>x.mutationQueue.removeMutationBatch(a,D))}(r,s,e,d).next(()=>d.apply(s)).next(()=>r.mutationQueue.performConsistencyCheck(s)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(s,c,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(x){let a=Hr();for(let I=0;I<x.mutationResults.length;++I)x.mutationResults[I].transformResults.length>0&&(a=a.add(x.batch.mutations[I].key));return a}(e))).next(()=>r.localDocuments.getDocuments(s,c))})}function _G(t){const e=Pr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ur.getLastRemoteSnapshotVersion(r))}function Afe(t,e){const r=Pr(t),s=e.snapshotVersion;let c=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const _=r.cs.newChangeBuffer({trackRemovals:!0});c=r.os;const x=[];e.targetChanges.forEach((M,D)=>{const L=c.get(D);if(!L)return;x.push(r.Ur.removeMatchingKeys(d,M.removedDocuments,D).next(()=>r.Ur.addMatchingKeys(d,M.addedDocuments,D)));let G=L.withSequenceNumber(d.currentSequenceNumber);e.targetMismatches.get(D)!==null?G=G.withResumeToken(Oo.EMPTY_BYTE_STRING,Ar.min()).withLastLimboFreeSnapshotVersion(Ar.min()):M.resumeToken.approximateByteSize()>0&&(G=G.withResumeToken(M.resumeToken,s)),c=c.insert(D,G),function(re,ee,U){return re.resumeToken.approximateByteSize()===0||ee.snapshotVersion.toMicroseconds()-re.snapshotVersion.toMicroseconds()>=3e8?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(L,G,M)&&x.push(r.Ur.updateTargetData(d,G))});let a=Xh(),I=Hr();if(e.documentUpdates.forEach(M=>{e.resolvedLimboDocuments.has(M)&&x.push(r.persistence.referenceDelegate.updateLimboDocument(d,M))}),x.push(Pfe(d,_,e.documentUpdates).next(M=>{a=M.Ps,I=M.Is})),!s.isEqual(Ar.min())){const M=r.Ur.getLastRemoteSnapshotVersion(d).next(D=>r.Ur.setTargetsMetadata(d,d.currentSequenceNumber,s));x.push(M)}return nn.waitFor(x).next(()=>_.apply(d)).next(()=>r.localDocuments.getLocalViewOfDocuments(d,a,I)).next(()=>a)}).then(d=>(r.os=c,d))}function Pfe(t,e,r){let s=Hr(),c=Hr();return r.forEach(d=>s=s.add(d)),e.getEntries(t,s).next(d=>{let _=Xh();return r.forEach((x,a)=>{const I=d.get(x);a.isFoundDocument()!==I.isFoundDocument()&&(c=c.add(x)),a.isNoDocument()&&a.version.isEqual(Ar.min())?(e.removeEntry(x,a.readTime),_=_.insert(x,a)):!I.isValidDocument()||a.version.compareTo(I.version)>0||a.version.compareTo(I.version)===0&&I.hasPendingWrites?(e.addEntry(a),_=_.insert(x,a)):$n("LocalStore","Ignoring outdated watch update for ",x,". Current version:",I.version," Watch version:",a.version)}),{Ps:_,Is:c}})}function Rfe(t,e){const r=Pr(t);return r.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function Mfe(t,e){const r=Pr(t);return r.persistence.runTransaction("Allocate target","readwrite",s=>{let c;return r.Ur.getTargetData(s,e).next(d=>d?(c=d,nn.resolve(c)):r.Ur.allocateTargetId(s).next(_=>(c=new pf(e,_,"TargetPurposeListen",s.currentSequenceNumber),r.Ur.addTargetData(s,c).next(()=>c))))}).then(s=>{const c=r.os.get(s.targetId);return(c===null||s.snapshotVersion.compareTo(c.snapshotVersion)>0)&&(r.os=r.os.insert(s.targetId,s),r._s.set(e,s.targetId)),s})}async function wk(t,e,r){const s=Pr(t),c=s.os.get(e),d=r?"readwrite":"readwrite-primary";try{r||await s.persistence.runTransaction("Release target",d,_=>s.persistence.referenceDelegate.removeTarget(_,c))}catch(_){if(!rb(_))throw _;$n("LocalStore",`Failed to update sequence numbers for target ${e}: ${_}`)}s.os=s.os.remove(e),s._s.delete(c.target)}function pU(t,e,r){const s=Pr(t);let c=Ar.min(),d=Hr();return s.persistence.runTransaction("Execute query","readwrite",_=>function(a,I,M){const D=Pr(a),L=D._s.get(M);return L!==void 0?nn.resolve(D.os.get(L)):D.Ur.getTargetData(I,M)}(s,_,Fu(e)).next(x=>{if(x)return c=x.lastLimboFreeSnapshotVersion,s.Ur.getMatchingKeysForTargetId(_,x.targetId).next(a=>{d=a})}).next(()=>s.ss.getDocumentsMatchingQuery(_,e,r?c:Ar.min(),r?d:Hr())).next(x=>(kfe(s,wde(e),x),{documents:x,Ts:d})))}function kfe(t,e,r){let s=t.us.get(e)||Ar.min();r.forEach((c,d)=>{d.readTime.compareTo(s)>0&&(s=d.readTime)}),t.us.set(e,s)}class mU{constructor(){this.activeTargetIds=Ade()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ofe{constructor(){this.so=new mU,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,s){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,r,s){this.oo[e]=r}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new mU,Promise.resolve()}handleUserChange(e,r,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dfe{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){$n("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){$n("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let UT=null;function pR(){return UT===null?UT=function(){return 268435456+Math.round(2147483648*Math.random())}():UT++,"0x"+UT.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lfe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zfe{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Go="WebChannelConnection";class Nfe extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const s=r.ssl?"https":"http",c=encodeURIComponent(this.databaseId.projectId),d=encodeURIComponent(this.databaseId.database);this.Do=s+"://"+r.host,this.vo=`projects/${c}/databases/${d}`,this.Co=this.databaseId.database==="(default)"?`project_id=${c}`:`project_id=${c}&database_id=${d}`}get Fo(){return!1}Mo(r,s,c,d,_){const x=pR(),a=this.xo(r,s.toUriEncodedString());$n("RestConnection",`Sending RPC '${r}' ${x}:`,a,c);const I={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(I,d,_),this.No(r,a,I,c).then(M=>($n("RestConnection",`Received RPC '${r}' ${x}: `,M),M),M=>{throw Iy("RestConnection",`RPC '${r}' ${x} failed with error: `,M,"url: ",a,"request:",c),M})}Lo(r,s,c,d,_,x){return this.Mo(r,s,c,d,_)}Oo(r,s,c){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Yy}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((d,_)=>r[_]=d),c&&c.headers.forEach((d,_)=>r[_]=d)}xo(r,s){const c=Lfe[r];return`${this.Do}/v1/${s}:${c}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,r,s,c){const d=pR();return new Promise((_,x)=>{const a=new Rq;a.setWithCredentials(!0),a.listenOnce(kq.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case bE.NO_ERROR:const M=a.getResponseJson();$n(Go,`XHR for RPC '${e}' ${d} received:`,JSON.stringify(M)),_(M);break;case bE.TIMEOUT:$n(Go,`RPC '${e}' ${d} timed out`),x(new kn(Qt.DEADLINE_EXCEEDED,"Request time out"));break;case bE.HTTP_ERROR:const D=a.getStatus();if($n(Go,`RPC '${e}' ${d} failed with status:`,D,"response text:",a.getResponseText()),D>0){let L=a.getResponseJson();Array.isArray(L)&&(L=L[0]);const G=L==null?void 0:L.error;if(G&&G.status&&G.message){const Q=function(ee){const U=ee.toLowerCase().replace(/_/g,"-");return Object.values(Qt).indexOf(U)>=0?U:Qt.UNKNOWN}(G.status);x(new kn(Q,G.message))}else x(new kn(Qt.UNKNOWN,"Server responded with status "+a.getStatus()))}else x(new kn(Qt.UNAVAILABLE,"Connection failed."));break;default:Er()}}finally{$n(Go,`RPC '${e}' ${d} completed.`)}});const I=JSON.stringify(c);$n(Go,`RPC '${e}' ${d} sending request:`,c),a.send(r,"POST",I,s,15)})}Bo(e,r,s){const c=pR(),d=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],_=Lq(),x=Dq(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},I=this.longPollingOptions.timeoutSeconds;I!==void 0&&(a.longPollingTimeout=Math.round(1e3*I)),this.useFetchStreams&&(a.xmlHttpFactory=new Mq({})),this.Oo(a.initMessageHeaders,r,s),a.encodeInitMessageHeaders=!0;const M=d.join("");$n(Go,`Creating RPC '${e}' stream ${c}: ${M}`,a);const D=_.createWebChannel(M,a);let L=!1,G=!1;const Q=new zfe({Io:ee=>{G?$n(Go,`Not sending because RPC '${e}' stream ${c} is closed:`,ee):(L||($n(Go,`Opening RPC '${e}' stream ${c} transport.`),D.open(),L=!0),$n(Go,`RPC '${e}' stream ${c} sending:`,ee),D.send(ee))},To:()=>D.close()}),re=(ee,U,H)=>{ee.listen(U,Z=>{try{H(Z)}catch(de){setTimeout(()=>{throw de},0)}})};return re(D,i1.EventType.OPEN,()=>{G||($n(Go,`RPC '${e}' stream ${c} transport opened.`),Q.yo())}),re(D,i1.EventType.CLOSE,()=>{G||(G=!0,$n(Go,`RPC '${e}' stream ${c} transport closed`),Q.So())}),re(D,i1.EventType.ERROR,ee=>{G||(G=!0,Iy(Go,`RPC '${e}' stream ${c} transport errored:`,ee),Q.So(new kn(Qt.UNAVAILABLE,"The operation could not be completed")))}),re(D,i1.EventType.MESSAGE,ee=>{var U;if(!G){const H=ee.data[0];Ni(!!H);const Z=H,de=Z.error||((U=Z[0])===null||U===void 0?void 0:U.error);if(de){$n(Go,`RPC '${e}' stream ${c} received error:`,de);const ve=de.status;let Ee=function(K){const ge=Zs[K];if(ge!==void 0)return oG(ge)}(ve),ie=de.message;Ee===void 0&&(Ee=Qt.INTERNAL,ie="Unknown error status: "+ve+" with message "+de.message),G=!0,Q.So(new kn(Ee,ie)),D.close()}else $n(Go,`RPC '${e}' stream ${c} received:`,H),Q.bo(H)}}),re(x,Oq.STAT_EVENT,ee=>{ee.stat===dk.PROXY?$n(Go,`RPC '${e}' stream ${c} detected buffering proxy`):ee.stat===dk.NOPROXY&&$n(Go,`RPC '${e}' stream ${c} detected no buffering proxy`)}),setTimeout(()=>{Q.wo()},0),Q}}function mR(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aC(t){return new Hde(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yG{constructor(e,r,s=1e3,c=1.5,d=6e4){this.ui=e,this.timerId=r,this.ko=s,this.qo=c,this.Qo=d,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const r=Math.floor(this.Ko+this.zo()),s=Math.max(0,Date.now()-this.Uo),c=Math.max(0,r-s);c>0&&$n("ExponentialBackoff",`Backing off for ${c} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${s} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,c,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vG{constructor(e,r,s,c,d,_,x,a){this.ui=e,this.Ho=s,this.Jo=c,this.connection=d,this.authCredentialsProvider=_,this.appCheckCredentialsProvider=x,this.listener=a,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new yG(e,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():r&&r.code===Qt.RESOURCE_EXHAUSTED?(Zh(r.toString()),Zh("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===Qt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(r)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,c])=>{this.Yo===r&&this.P_(s,c)},s=>{e(()=>{const c=new kn(Qt.UNKNOWN,"Fetching auth token failed: "+s.message);return this.I_(c)})})}P_(e,r){const s=this.h_(this.Yo);this.stream=this.T_(e,r),this.stream.Eo(()=>{s(()=>this.listener.Eo())}),this.stream.Ro(()=>{s(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(c=>{s(()=>this.I_(c))}),this.stream.onMessage(c=>{s(()=>++this.e_==1?this.E_(c):this.onNext(c))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return $n("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return r=>{this.ui.enqueueAndForget(()=>this.Yo===e?r():($n("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ffe extends vG{constructor(e,r,s,c,d,_){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,s,c,_),this.serializer=d}T_(e,r){return this.connection.Bo("Listen",e,r)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const r=Kde(this.serializer,e),s=function(d){if(!("targetChange"in d))return Ar.min();const _=d.targetChange;return _.targetIds&&_.targetIds.length?Ar.min():_.readTime?Bu(_.readTime):Ar.min()}(e);return this.listener.d_(r,s)}A_(e){const r={};r.database=bk(this.serializer),r.addTarget=function(d,_){let x;const a=_.target;if(x=gk(a)?{documents:Jde(d,a)}:{query:efe(d,a)._t},x.targetId=_.targetId,_.resumeToken.approximateByteSize()>0){x.resumeToken=cG(d,_.resumeToken);const I=yk(d,_.expectedCount);I!==null&&(x.expectedCount=I)}else if(_.snapshotVersion.compareTo(Ar.min())>0){x.readTime=PS(d,_.snapshotVersion.toTimestamp());const I=yk(d,_.expectedCount);I!==null&&(x.expectedCount=I)}return x}(this.serializer,e);const s=nfe(this.serializer,e);s&&(r.labels=s),this.a_(r)}R_(e){const r={};r.database=bk(this.serializer),r.removeTarget=e,this.a_(r)}}class Bfe extends vG{constructor(e,r,s,c,d,_){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,s,c,_),this.serializer=d}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,r){return this.connection.Bo("Write",e,r)}E_(e){return Ni(!!e.streamToken),this.lastStreamToken=e.streamToken,Ni(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Ni(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const r=Yde(e.writeResults,e.commitTime),s=Bu(e.commitTime);return this.listener.g_(s,r)}p_(){const e={};e.database=bk(this.serializer),this.a_(e)}m_(e){const r={streamToken:this.lastStreamToken,writes:e.map(s=>Qde(this.serializer,s))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jfe extends class{}{constructor(e,r,s,c){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=s,this.serializer=c,this.y_=!1}w_(){if(this.y_)throw new kn(Qt.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,r,s,c){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,_])=>this.connection.Mo(e,vk(r,s),c,d,_)).catch(d=>{throw d.name==="FirebaseError"?(d.code===Qt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new kn(Qt.UNKNOWN,d.toString())})}Lo(e,r,s,c,d){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([_,x])=>this.connection.Lo(e,vk(r,s),c,_,x,d)).catch(_=>{throw _.name==="FirebaseError"?(_.code===Qt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),_):new kn(Qt.UNKNOWN,_.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Ufe{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Zh(r),this.D_=!1):$n("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vfe{constructor(e,r,s,c,d){this.localStore=e,this.datastore=r,this.asyncQueue=s,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=d,this.k_._o(_=>{s.enqueueAndForget(async()=>{sg(this)&&($n("RemoteStore","Restarting streams for network reachability change."),await async function(a){const I=Pr(a);I.L_.add(4),await ob(I),I.q_.set("Unknown"),I.L_.delete(4),await lC(I)}(this))})}),this.q_=new Ufe(s,c)}}async function lC(t){if(sg(t))for(const e of t.B_)await e(!0)}async function ob(t){for(const e of t.B_)await e(!1)}function xG(t,e){const r=Pr(t);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),ID(r)?SD(r):t0(r).r_()&&ED(r,e))}function TD(t,e){const r=Pr(t),s=t0(r);r.N_.delete(e),s.r_()&&bG(r,e),r.N_.size===0&&(s.r_()?s.o_():sg(r)&&r.q_.set("Unknown"))}function ED(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ar.min())>0){const r=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}t0(t).A_(e)}function bG(t,e){t.Q_.xe(e),t0(t).R_(e)}function SD(t){t.Q_=new $de({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),t0(t).start(),t.q_.v_()}function ID(t){return sg(t)&&!t0(t).n_()&&t.N_.size>0}function sg(t){return Pr(t).L_.size===0}function wG(t){t.Q_=void 0}async function $fe(t){t.q_.set("Online")}async function qfe(t){t.N_.forEach((e,r)=>{ED(t,e)})}async function Gfe(t,e){wG(t),ID(t)?(t.q_.M_(e),SD(t)):t.q_.set("Unknown")}async function Wfe(t,e,r){if(t.q_.set("Online"),e instanceof lG&&e.state===2&&e.cause)try{await async function(c,d){const _=d.cause;for(const x of d.targetIds)c.N_.has(x)&&(await c.remoteSyncer.rejectListen(x,_),c.N_.delete(x),c.Q_.removeTarget(x))}(t,e)}catch(s){$n("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),await RS(t,s)}else if(e instanceof EE?t.Q_.Ke(e):e instanceof aG?t.Q_.He(e):t.Q_.We(e),!r.isEqual(Ar.min()))try{const s=await _G(t.localStore);r.compareTo(s)>=0&&await function(d,_){const x=d.Q_.rt(_);return x.targetChanges.forEach((a,I)=>{if(a.resumeToken.approximateByteSize()>0){const M=d.N_.get(I);M&&d.N_.set(I,M.withResumeToken(a.resumeToken,_))}}),x.targetMismatches.forEach((a,I)=>{const M=d.N_.get(a);if(!M)return;d.N_.set(a,M.withResumeToken(Oo.EMPTY_BYTE_STRING,M.snapshotVersion)),bG(d,a);const D=new pf(M.target,a,I,M.sequenceNumber);ED(d,D)}),d.remoteSyncer.applyRemoteEvent(x)}(t,r)}catch(s){$n("RemoteStore","Failed to raise snapshot:",s),await RS(t,s)}}async function RS(t,e,r){if(!rb(e))throw e;t.L_.add(1),await ob(t),t.q_.set("Offline"),r||(r=()=>_G(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{$n("RemoteStore","Retrying IndexedDB access"),await r(),t.L_.delete(1),await lC(t)})}function TG(t,e){return e().catch(r=>RS(t,r,e))}async function cC(t){const e=Pr(t),r=Ff(e);let s=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Hfe(e);)try{const c=await Rfe(e.localStore,s);if(c===null){e.O_.length===0&&r.o_();break}s=c.batchId,Zfe(e,c)}catch(c){await RS(e,c)}EG(e)&&SG(e)}function Hfe(t){return sg(t)&&t.O_.length<10}function Zfe(t,e){t.O_.push(e);const r=Ff(t);r.r_()&&r.V_&&r.m_(e.mutations)}function EG(t){return sg(t)&&!Ff(t).n_()&&t.O_.length>0}function SG(t){Ff(t).start()}async function Xfe(t){Ff(t).p_()}async function Kfe(t){const e=Ff(t);for(const r of t.O_)e.m_(r.mutations)}async function Qfe(t,e,r){const s=t.O_.shift(),c=_D.from(s,e,r);await TG(t,()=>t.remoteSyncer.applySuccessfulWrite(c)),await cC(t)}async function Yfe(t,e){e&&Ff(t).V_&&await async function(s,c){if(function(_){return jde(_)&&_!==Qt.ABORTED}(c.code)){const d=s.O_.shift();Ff(s).s_(),await TG(s,()=>s.remoteSyncer.rejectFailedWrite(d.batchId,c)),await cC(s)}}(t,e),EG(t)&&SG(t)}async function _U(t,e){const r=Pr(t);r.asyncQueue.verifyOperationInProgress(),$n("RemoteStore","RemoteStore received new credentials");const s=sg(r);r.L_.add(3),await ob(r),s&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.L_.delete(3),await lC(r)}async function Jfe(t,e){const r=Pr(t);e?(r.L_.delete(2),await lC(r)):e||(r.L_.add(2),await ob(r),r.q_.set("Unknown"))}function t0(t){return t.K_||(t.K_=function(r,s,c){const d=Pr(r);return d.w_(),new Ffe(s,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}(t.datastore,t.asyncQueue,{Eo:$fe.bind(null,t),Ro:qfe.bind(null,t),mo:Gfe.bind(null,t),d_:Wfe.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),ID(t)?SD(t):t.q_.set("Unknown")):(await t.K_.stop(),wG(t))})),t.K_}function Ff(t){return t.U_||(t.U_=function(r,s,c){const d=Pr(r);return d.w_(),new Bfe(s,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,c)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Xfe.bind(null,t),mo:Yfe.bind(null,t),f_:Kfe.bind(null,t),g_:Qfe.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await cC(t)):(await t.U_.stop(),t.O_.length>0&&($n("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CD{constructor(e,r,s,c,d){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=s,this.op=c,this.removalCallback=d,this.deferred=new Bh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(_=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,s,c,d){const _=Date.now()+s,x=new CD(e,r,_,c,d);return x.start(s),x}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new kn(Qt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function AD(t,e){if(Zh("AsyncQueue",`${e}: ${t}`),rb(t))return new kn(Qt.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly{constructor(e){this.comparator=e?(r,s)=>e(r,s)||rr.comparator(r.key,s.key):(r,s)=>rr.comparator(r.key,s.key),this.keyedMap=s1(),this.sortedSet=new bs(this.comparator)}static emptySet(e){return new ly(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,s)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof ly)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;r.hasNext();){const c=r.getNext().key,d=s.getNext().key;if(!c.isEqual(d))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const s=new ly;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=r,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yU{constructor(){this.W_=new bs(rr.comparator)}track(e){const r=e.doc.key,s=this.W_.get(r);s?e.type!==0&&s.type===3?this.W_=this.W_.insert(r,e):e.type===3&&s.type!==1?this.W_=this.W_.insert(r,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.W_=this.W_.insert(r,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.W_=this.W_.remove(r):e.type===1&&s.type===2?this.W_=this.W_.insert(r,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):Er():this.W_=this.W_.insert(r,e)}G_(){const e=[];return this.W_.inorderTraversal((r,s)=>{e.push(s)}),e}}class Oy{constructor(e,r,s,c,d,_,x,a,I){this.query=e,this.docs=r,this.oldDocs=s,this.docChanges=c,this.mutatedKeys=d,this.fromCache=_,this.syncStateChanged=x,this.excludesMetadataChanges=a,this.hasCachedResults=I}static fromInitialDocuments(e,r,s,c,d){const _=[];return r.forEach(x=>{_.push({type:0,doc:x})}),new Oy(e,r,ly.emptySet(r),_,s,c,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nC(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,s=e.docChanges;if(r.length!==s.length)return!1;for(let c=0;c<r.length;c++)if(r[c].type!==s[c].type||!r[c].doc.isEqual(s[c].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class epe{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class tpe{constructor(){this.queries=vU(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,s){const c=Pr(r),d=c.queries;c.queries=vU(),d.forEach((_,x)=>{for(const a of x.j_)a.onError(s)})})(this,new kn(Qt.ABORTED,"Firestore shutting down"))}}function vU(){return new e0(t=>Zq(t),nC)}async function PD(t,e){const r=Pr(t);let s=3;const c=e.query;let d=r.queries.get(c);d?!d.H_()&&e.J_()&&(s=2):(d=new epe,s=e.J_()?0:1);try{switch(s){case 0:d.z_=await r.onListen(c,!0);break;case 1:d.z_=await r.onListen(c,!1);break;case 2:await r.onFirstRemoteStoreListen(c)}}catch(_){const x=AD(_,`Initialization of query '${A_(e.query)}' failed`);return void e.onError(x)}r.queries.set(c,d),d.j_.push(e),e.Z_(r.onlineState),d.z_&&e.X_(d.z_)&&MD(r)}async function RD(t,e){const r=Pr(t),s=e.query;let c=3;const d=r.queries.get(s);if(d){const _=d.j_.indexOf(e);_>=0&&(d.j_.splice(_,1),d.j_.length===0?c=e.J_()?0:1:!d.H_()&&e.J_()&&(c=2))}switch(c){case 0:return r.queries.delete(s),r.onUnlisten(s,!0);case 1:return r.queries.delete(s),r.onUnlisten(s,!1);case 2:return r.onLastRemoteStoreUnlisten(s);default:return}}function npe(t,e){const r=Pr(t);let s=!1;for(const c of e){const d=c.query,_=r.queries.get(d);if(_){for(const x of _.j_)x.X_(c)&&(s=!0);_.z_=c}}s&&MD(r)}function rpe(t,e,r){const s=Pr(t),c=s.queries.get(e);if(c)for(const d of c.j_)d.onError(r);s.queries.delete(e)}function MD(t){t.Y_.forEach(e=>{e.next()})}var Tk,xU;(xU=Tk||(Tk={})).ea="default",xU.Cache="cache";class kD{constructor(e,r,s){this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=s||{}}X_(e){if(!this.options.includeMetadataChanges){const s=[];for(const c of e.docChanges)c.type!==3&&s.push(c);e=new Oy(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.na?this.ia(e)&&(this.ta.next(e),r=!0):this.sa(e,this.onlineState)&&(this.oa(e),r=!0),this.ra=e,r}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),r=!0),r}sa(e,r){if(!e.fromCache||!this.J_())return!0;const s=r!=="Offline";return(!this.options._a||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(e){e=Oy.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Tk.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IG{constructor(e){this.key=e}}class CG{constructor(e){this.key=e}}class ipe{constructor(e,r){this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Hr(),this.mutatedKeys=Hr(),this.Aa=Xq(e),this.Ra=new ly(this.Aa)}get Va(){return this.Ta}ma(e,r){const s=r?r.fa:new yU,c=r?r.Ra:this.Ra;let d=r?r.mutatedKeys:this.mutatedKeys,_=c,x=!1;const a=this.query.limitType==="F"&&c.size===this.query.limit?c.last():null,I=this.query.limitType==="L"&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((M,D)=>{const L=c.get(M),G=rC(this.query,D)?D:null,Q=!!L&&this.mutatedKeys.has(L.key),re=!!G&&(G.hasLocalMutations||this.mutatedKeys.has(G.key)&&G.hasCommittedMutations);let ee=!1;L&&G?L.data.isEqual(G.data)?Q!==re&&(s.track({type:3,doc:G}),ee=!0):this.ga(L,G)||(s.track({type:2,doc:G}),ee=!0,(a&&this.Aa(G,a)>0||I&&this.Aa(G,I)<0)&&(x=!0)):!L&&G?(s.track({type:0,doc:G}),ee=!0):L&&!G&&(s.track({type:1,doc:L}),ee=!0,(a||I)&&(x=!0)),ee&&(G?(_=_.add(G),d=re?d.add(M):d.delete(M)):(_=_.delete(M),d=d.delete(M)))}),this.query.limit!==null)for(;_.size>this.query.limit;){const M=this.query.limitType==="F"?_.last():_.first();_=_.delete(M.key),d=d.delete(M.key),s.track({type:1,doc:M})}return{Ra:_,fa:s,ns:x,mutatedKeys:d}}ga(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,s,c){const d=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const _=e.fa.G_();_.sort((M,D)=>function(G,Q){const re=ee=>{switch(ee){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Er()}};return re(G)-re(Q)}(M.type,D.type)||this.Aa(M.doc,D.doc)),this.pa(s),c=c!=null&&c;const x=r&&!c?this.ya():[],a=this.da.size===0&&this.current&&!c?1:0,I=a!==this.Ea;return this.Ea=a,_.length!==0||I?{snapshot:new Oy(this.query,e.Ra,d,_,e.mutatedKeys,a===0,I,!1,!!s&&s.resumeToken.approximateByteSize()>0),wa:x}:{wa:x}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new yU,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Hr(),this.Ra.forEach(s=>{this.Sa(s.key)&&(this.da=this.da.add(s.key))});const r=[];return e.forEach(s=>{this.da.has(s)||r.push(new CG(s))}),this.da.forEach(s=>{e.has(s)||r.push(new IG(s))}),r}ba(e){this.Ta=e.Ts,this.da=Hr();const r=this.ma(e.documents);return this.applyChanges(r,!0)}Da(){return Oy.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class spe{constructor(e,r,s){this.query=e,this.targetId=r,this.view=s}}class ope{constructor(e){this.key=e,this.va=!1}}class ape{constructor(e,r,s,c,d,_){this.localStore=e,this.remoteStore=r,this.eventManager=s,this.sharedClientState=c,this.currentUser=d,this.maxConcurrentLimboResolutions=_,this.Ca={},this.Fa=new e0(x=>Zq(x),nC),this.Ma=new Map,this.xa=new Set,this.Oa=new bs(rr.comparator),this.Na=new Map,this.La=new xD,this.Ba={},this.ka=new Map,this.qa=ky.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function lpe(t,e,r=!0){const s=OG(t);let c;const d=s.Fa.get(e);return d?(s.sharedClientState.addLocalQueryTarget(d.targetId),c=d.view.Da()):c=await AG(s,e,r,!0),c}async function cpe(t,e){const r=OG(t);await AG(r,e,!0,!1)}async function AG(t,e,r,s){const c=await Mfe(t.localStore,Fu(e)),d=c.targetId,_=r?t.sharedClientState.addLocalQueryTarget(d):"not-current";let x;return s&&(x=await upe(t,e,d,_==="current",c.resumeToken)),t.isPrimaryClient&&r&&xG(t.remoteStore,c),x}async function upe(t,e,r,s,c){t.Ka=(D,L,G)=>async function(re,ee,U,H){let Z=ee.view.ma(U);Z.ns&&(Z=await pU(re.localStore,ee.query,!1).then(({documents:ie})=>ee.view.ma(ie,Z)));const de=H&&H.targetChanges.get(ee.targetId),ve=H&&H.targetMismatches.get(ee.targetId)!=null,Ee=ee.view.applyChanges(Z,re.isPrimaryClient,de,ve);return wU(re,ee.targetId,Ee.wa),Ee.snapshot}(t,D,L,G);const d=await pU(t.localStore,e,!0),_=new ipe(e,d.Ts),x=_.ma(d.documents),a=sb.createSynthesizedTargetChangeForCurrentChange(r,s&&t.onlineState!=="Offline",c),I=_.applyChanges(x,t.isPrimaryClient,a);wU(t,r,I.wa);const M=new spe(e,r,_);return t.Fa.set(e,M),t.Ma.has(r)?t.Ma.get(r).push(e):t.Ma.set(r,[e]),I.snapshot}async function hpe(t,e,r){const s=Pr(t),c=s.Fa.get(e),d=s.Ma.get(c.targetId);if(d.length>1)return s.Ma.set(c.targetId,d.filter(_=>!nC(_,e))),void s.Fa.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(c.targetId),s.sharedClientState.isActiveQueryTarget(c.targetId)||await wk(s.localStore,c.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(c.targetId),r&&TD(s.remoteStore,c.targetId),Ek(s,c.targetId)}).catch(nb)):(Ek(s,c.targetId),await wk(s.localStore,c.targetId,!0))}async function dpe(t,e){const r=Pr(t),s=r.Fa.get(e),c=r.Ma.get(s.targetId);r.isPrimaryClient&&c.length===1&&(r.sharedClientState.removeLocalQueryTarget(s.targetId),TD(r.remoteStore,s.targetId))}async function fpe(t,e,r){const s=xpe(t);try{const c=await function(_,x){const a=Pr(_),I=ho.now(),M=x.reduce((G,Q)=>G.add(Q.key),Hr());let D,L;return a.persistence.runTransaction("Locally write mutations","readwrite",G=>{let Q=Xh(),re=Hr();return a.cs.getEntries(G,M).next(ee=>{Q=ee,Q.forEach((U,H)=>{H.isValidDocument()||(re=re.add(U))})}).next(()=>a.localDocuments.getOverlayedDocuments(G,Q)).next(ee=>{D=ee;const U=[];for(const H of x){const Z=Lde(H,D.get(H.key).overlayedDocument);Z!=null&&U.push(new Qf(H.key,Z,jq(Z.value.mapValue),Zl.exists(!0)))}return a.mutationQueue.addMutationBatch(G,I,U,x)}).next(ee=>{L=ee;const U=ee.applyToLocalDocumentSet(D,re);return a.documentOverlayCache.saveOverlays(G,ee.batchId,U)})}).then(()=>({batchId:L.batchId,changes:Qq(D)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(c.batchId),function(_,x,a){let I=_.Ba[_.currentUser.toKey()];I||(I=new bs(si)),I=I.insert(x,a),_.Ba[_.currentUser.toKey()]=I}(s,c.batchId,r),await ab(s,c.changes),await cC(s.remoteStore)}catch(c){const d=AD(c,"Failed to persist write");r.reject(d)}}async function PG(t,e){const r=Pr(t);try{const s=await Afe(r.localStore,e);e.targetChanges.forEach((c,d)=>{const _=r.Na.get(d);_&&(Ni(c.addedDocuments.size+c.modifiedDocuments.size+c.removedDocuments.size<=1),c.addedDocuments.size>0?_.va=!0:c.modifiedDocuments.size>0?Ni(_.va):c.removedDocuments.size>0&&(Ni(_.va),_.va=!1))}),await ab(r,s,e)}catch(s){await nb(s)}}function bU(t,e,r){const s=Pr(t);if(s.isPrimaryClient&&r===0||!s.isPrimaryClient&&r===1){const c=[];s.Fa.forEach((d,_)=>{const x=_.view.Z_(e);x.snapshot&&c.push(x.snapshot)}),function(_,x){const a=Pr(_);a.onlineState=x;let I=!1;a.queries.forEach((M,D)=>{for(const L of D.j_)L.Z_(x)&&(I=!0)}),I&&MD(a)}(s.eventManager,e),c.length&&s.Ca.d_(c),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function ppe(t,e,r){const s=Pr(t);s.sharedClientState.updateQueryState(e,"rejected",r);const c=s.Na.get(e),d=c&&c.key;if(d){let _=new bs(rr.comparator);_=_.insert(d,Xo.newNoDocument(d,Ar.min()));const x=Hr().add(d),a=new oC(Ar.min(),new Map,new bs(si),_,x);await PG(s,a),s.Oa=s.Oa.remove(d),s.Na.delete(e),OD(s)}else await wk(s.localStore,e,!1).then(()=>Ek(s,e,r)).catch(nb)}async function mpe(t,e){const r=Pr(t),s=e.batch.batchId;try{const c=await Cfe(r.localStore,e);MG(r,s,null),RG(r,s),r.sharedClientState.updateMutationState(s,"acknowledged"),await ab(r,c)}catch(c){await nb(c)}}async function gpe(t,e,r){const s=Pr(t);try{const c=await function(_,x){const a=Pr(_);return a.persistence.runTransaction("Reject batch","readwrite-primary",I=>{let M;return a.mutationQueue.lookupMutationBatch(I,x).next(D=>(Ni(D!==null),M=D.keys(),a.mutationQueue.removeMutationBatch(I,D))).next(()=>a.mutationQueue.performConsistencyCheck(I)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(I,M,x)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(I,M)).next(()=>a.localDocuments.getDocuments(I,M))})}(s.localStore,e);MG(s,e,r),RG(s,e),s.sharedClientState.updateMutationState(e,"rejected",r),await ab(s,c)}catch(c){await nb(c)}}function RG(t,e){(t.ka.get(e)||[]).forEach(r=>{r.resolve()}),t.ka.delete(e)}function MG(t,e,r){const s=Pr(t);let c=s.Ba[s.currentUser.toKey()];if(c){const d=c.get(e);d&&(r?d.reject(r):d.resolve(),c=c.remove(e)),s.Ba[s.currentUser.toKey()]=c}}function Ek(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Ma.get(e))t.Fa.delete(s),r&&t.Ca.$a(s,r);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(s=>{t.La.containsKey(s)||kG(t,s)})}function kG(t,e){t.xa.delete(e.path.canonicalString());const r=t.Oa.get(e);r!==null&&(TD(t.remoteStore,r),t.Oa=t.Oa.remove(e),t.Na.delete(r),OD(t))}function wU(t,e,r){for(const s of r)s instanceof IG?(t.La.addReference(s.key,e),_pe(t,s)):s instanceof CG?($n("SyncEngine","Document no longer in limbo: "+s.key),t.La.removeReference(s.key,e),t.La.containsKey(s.key)||kG(t,s.key)):Er()}function _pe(t,e){const r=e.key,s=r.path.canonicalString();t.Oa.get(r)||t.xa.has(s)||($n("SyncEngine","New document in limbo: "+r),t.xa.add(s),OD(t))}function OD(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const r=new rr(Yi.fromString(e)),s=t.qa.next();t.Na.set(s,new ope(r)),t.Oa=t.Oa.insert(r,s),xG(t.remoteStore,new pf(Fu(tC(r.path)),s,"TargetPurposeLimboResolution",lD.oe))}}async function ab(t,e,r){const s=Pr(t),c=[],d=[],_=[];s.Fa.isEmpty()||(s.Fa.forEach((x,a)=>{_.push(s.Ka(a,e,r).then(I=>{var M;if((I||r)&&s.isPrimaryClient){const D=I?!I.fromCache:(M=r==null?void 0:r.targetChanges.get(a.targetId))===null||M===void 0?void 0:M.current;s.sharedClientState.updateQueryState(a.targetId,D?"current":"not-current")}if(I){c.push(I);const D=wD.Wi(a.targetId,I);d.push(D)}}))}),await Promise.all(_),s.Ca.d_(c),await async function(a,I){const M=Pr(a);try{await M.persistence.runTransaction("notifyLocalViewChanges","readwrite",D=>nn.forEach(I,L=>nn.forEach(L.$i,G=>M.persistence.referenceDelegate.addReference(D,L.targetId,G)).next(()=>nn.forEach(L.Ui,G=>M.persistence.referenceDelegate.removeReference(D,L.targetId,G)))))}catch(D){if(!rb(D))throw D;$n("LocalStore","Failed to update sequence numbers: "+D)}for(const D of I){const L=D.targetId;if(!D.fromCache){const G=M.os.get(L),Q=G.snapshotVersion,re=G.withLastLimboFreeSnapshotVersion(Q);M.os=M.os.insert(L,re)}}}(s.localStore,d))}async function ype(t,e){const r=Pr(t);if(!r.currentUser.isEqual(e)){$n("SyncEngine","User change. New user:",e.toKey());const s=await gG(r.localStore,e);r.currentUser=e,function(d,_){d.ka.forEach(x=>{x.forEach(a=>{a.reject(new kn(Qt.CANCELLED,_))})}),d.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await ab(r,s.hs)}}function vpe(t,e){const r=Pr(t),s=r.Na.get(e);if(s&&s.va)return Hr().add(s.key);{let c=Hr();const d=r.Ma.get(e);if(!d)return c;for(const _ of d){const x=r.Fa.get(_);c=c.unionWith(x.view.Va)}return c}}function OG(t){const e=Pr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=PG.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=vpe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ppe.bind(null,e),e.Ca.d_=npe.bind(null,e.eventManager),e.Ca.$a=rpe.bind(null,e.eventManager),e}function xpe(t){const e=Pr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=mpe.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=gpe.bind(null,e),e}class TU{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=aC(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,r){return null}createIndexBackfillerScheduler(e,r){return null}createLocalStore(e){return Ife(this.persistence,new Efe,e.initialUser,this.serializer)}createPersistence(e){return new bfe(bD.Zr,this.serializer)}createSharedClientState(e){return new Ofe}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class bpe{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>bU(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=ype.bind(null,this.syncEngine),await Jfe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new tpe}()}createDatastore(e){const r=aC(e.databaseInfo.databaseId),s=function(d){return new Nfe(d)}(e.databaseInfo);return function(d,_,x,a){return new jfe(d,_,x,a)}(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return function(s,c,d,_,x){return new Vfe(s,c,d,_,x)}(this.localStore,this.datastore,e.asyncQueue,r=>bU(this.syncEngine,r,0),function(){return gU.D()?new gU:new Dfe}())}createSyncEngine(e,r){return function(c,d,_,x,a,I,M){const D=new ape(c,d,_,x,a,I);return M&&(D.Qa=!0),D}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(c){const d=Pr(c);$n("RemoteStore","RemoteStore shutting down."),d.L_.add(5),await ob(d),d.k_.shutdown(),d.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DD{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):Zh("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,r){this.muted||setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wpe{constructor(e,r,s,c){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=s,this.databaseInfo=c,this.user=Ho.UNAUTHENTICATED,this.clientId=Nq.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,async d=>{$n("FirestoreClient","Received user=",d.uid),await this.authCredentialListener(d),this.user=d}),this.appCheckCredentials.start(s,d=>($n("FirestoreClient","Received new app check token=",d),this.appCheckCredentialListener(d,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new kn(Qt.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Bh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const s=AD(r,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function gR(t,e){t.asyncQueue.verifyOperationInProgress(),$n("FirestoreClient","Initializing OfflineComponentProvider");const r=t.configuration;await e.initialize(r);let s=r.initialUser;t.setCredentialChangeListener(async c=>{s.isEqual(c)||(await gG(e.localStore,c),s=c)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function EU(t,e){t.asyncQueue.verifyOperationInProgress();const r=await Epe(t);$n("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,t.configuration),t.setCredentialChangeListener(s=>_U(e.remoteStore,s)),t.setAppCheckTokenChangeListener((s,c)=>_U(e.remoteStore,c)),t._onlineComponents=e}function Tpe(t){return t.name==="FirebaseError"?t.code===Qt.FAILED_PRECONDITION||t.code===Qt.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function Epe(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){$n("FirestoreClient","Using user provided OfflineComponentProvider");try{await gR(t,t._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!Tpe(r))throw r;Iy("Error using user provided cache. Falling back to memory cache: "+r),await gR(t,new TU)}}else $n("FirestoreClient","Using default OfflineComponentProvider"),await gR(t,new TU);return t._offlineComponents}async function DG(t){return t._onlineComponents||(t._uninitializedComponentsProvider?($n("FirestoreClient","Using user provided OnlineComponentProvider"),await EU(t,t._uninitializedComponentsProvider._online)):($n("FirestoreClient","Using default OnlineComponentProvider"),await EU(t,new bpe))),t._onlineComponents}function Spe(t){return DG(t).then(e=>e.syncEngine)}async function MS(t){const e=await DG(t),r=e.eventManager;return r.onListen=lpe.bind(null,e.syncEngine),r.onUnlisten=hpe.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=cpe.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=dpe.bind(null,e.syncEngine),r}function Ipe(t,e,r={}){const s=new Bh;return t.asyncQueue.enqueueAndForget(async()=>function(d,_,x,a,I){const M=new DD({next:L=>{_.enqueueAndForget(()=>RD(d,D));const G=L.docs.has(x);!G&&L.fromCache?I.reject(new kn(Qt.UNAVAILABLE,"Failed to get document because the client is offline.")):G&&L.fromCache&&a&&a.source==="server"?I.reject(new kn(Qt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):I.resolve(L)},error:L=>I.reject(L)}),D=new kD(tC(x.path),M,{includeMetadataChanges:!0,_a:!0});return PD(d,D)}(await MS(t),t.asyncQueue,e,r,s)),s.promise}function Cpe(t,e,r={}){const s=new Bh;return t.asyncQueue.enqueueAndForget(async()=>function(d,_,x,a,I){const M=new DD({next:L=>{_.enqueueAndForget(()=>RD(d,D)),L.fromCache&&a.source==="server"?I.reject(new kn(Qt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):I.resolve(L)},error:L=>I.reject(L)}),D=new kD(x,M,{includeMetadataChanges:!0,_a:!0});return PD(d,D)}(await MS(t),t.asyncQueue,e,r,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LG(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SU=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zG(t,e,r){if(!r)throw new kn(Qt.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Ape(t,e,r,s){if(e===!0&&s===!0)throw new kn(Qt.INVALID_ARGUMENT,`${t} and ${r} cannot be used together.`)}function IU(t){if(!rr.isDocumentKey(t))throw new kn(Qt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function CU(t){if(rr.isDocumentKey(t))throw new kn(Qt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function uC(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Er()}function $a(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new kn(Qt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=uC(t);throw new kn(Qt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return t}function Ppe(t,e){if(e<=0)throw new kn(Qt.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(e){var r,s;if(e.host===void 0){if(e.ssl!==void 0)throw new kn(Qt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new kn(Qt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Ape("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=LG((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new kn(Qt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new kn(Qt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new kn(Qt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,c){return s.timeoutSeconds===c.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hC{constructor(e,r,s,c){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=s,this._app=c,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new AU({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new kn(Qt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new kn(Qt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new AU(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new qhe;switch(s.type){case"firstParty":return new Zhe(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new kn(Qt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const s=SU.get(r);s&&($n("ComponentProvider","Removing Datastore"),SU.delete(r),s.terminate())}(this),Promise.resolve()}}function Rpe(t,e,r,s={}){var c;const d=(t=$a(t,hC))._getSettings(),_=`${e}:${r}`;if(d.host!=="firestore.googleapis.com"&&d.host!==_&&Iy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},d),{host:_,ssl:!1})),s.mockUserToken){let x,a;if(typeof s.mockUserToken=="string")x=s.mockUserToken,a=Ho.MOCK_USER;else{x=$7(s.mockUserToken,(c=t._app)===null||c===void 0?void 0:c.options.projectId);const I=s.mockUserToken.sub||s.mockUserToken.user_id;if(!I)throw new kn(Qt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Ho(I)}t._authCredentials=new Ghe(new zq(x,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e,r,s){this.converter=r,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new rd(this.firestore,e,this._query)}}class Ko{constructor(e,r,s){this.converter=r,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Rf(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ko(this.firestore,e,this._key)}}class Rf extends rd{constructor(e,r,s){super(e,r,tC(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ko(this.firestore,null,new rr(e))}withConverter(e){return new Rf(this.firestore,e,this._path)}}function vi(t,e,...r){if(t=Ds(t),zG("collection","path",e),t instanceof hC){const s=Yi.fromString(e,...r);return CU(s),new Rf(t,null,s)}{if(!(t instanceof Ko||t instanceof Rf))throw new kn(Qt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Yi.fromString(e,...r));return CU(s),new Rf(t.firestore,null,s)}}function Xn(t,e,...r){if(t=Ds(t),arguments.length===1&&(e=Nq.newId()),zG("doc","path",e),t instanceof hC){const s=Yi.fromString(e,...r);return IU(s),new Ko(t,null,new rr(s))}{if(!(t instanceof Ko||t instanceof Rf))throw new kn(Qt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Yi.fromString(e,...r));return IU(s),new Ko(t.firestore,t instanceof Rf?t.converter:null,new rr(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mpe{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new yG(this,"async_queue_retry"),this.Eu=()=>{const r=mR();r&&$n("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()};const e=mR();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const r=mR();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const r=new Bh;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}async Ru(){if(this.uu.length!==0){try{await this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!rb(e))throw e;$n("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}}Au(e){const r=this.au.then(()=>(this.Pu=!0,e().catch(s=>{this.hu=s,this.Pu=!1;const c=function(_){let x=_.message||"";return _.stack&&(x=_.stack.includes(_.message)?_.stack:_.message+`
`+_.stack),x}(s);throw Zh("INTERNAL UNHANDLED ERROR: ",c),s}).then(s=>(this.Pu=!1,s))));return this.au=r,r}enqueueAfterDelay(e,r,s){this.du(),this.Tu.indexOf(e)>-1&&(r=0);const c=CD.createAndSchedule(this,e,r,s,d=>this.Vu(d));return this.lu.push(c),c}du(){this.hu&&Er()}verifyOperationInProgress(){}async mu(){let e;do e=this.au,await e;while(e!==this.au)}fu(e){for(const r of this.lu)if(r.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((r,s)=>r.targetTimeMs-s.targetTimeMs);for(const r of this.lu)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const r=this.lu.indexOf(e);this.lu.splice(r,1)}}function PU(t){return function(r,s){if(typeof r!="object"||r===null)return!1;const c=r;for(const d of s)if(d in c&&typeof c[d]=="function")return!0;return!1}(t,["next","error","complete"])}class Kh extends hC{constructor(e,r,s,c){super(e,r,s,c),this.type="firestore",this._queue=function(){return new Mpe}(),this._persistenceKey=(c==null?void 0:c.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||NG(this),this._firestoreClient.terminate()}}function kpe(t,e){const r=typeof t=="object"?t:XO(),s=typeof t=="string"?t:"(default)",c=KI(r,"firestore").getImmediate({identifier:s});if(!c._initialized){const d=j7("firestore");d&&Rpe(c,...d)}return c}function dC(t){return t._firestoreClient||NG(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function NG(t){var e,r,s;const c=t._freezeSettings(),d=function(x,a,I,M){return new ade(x,a,I,M.host,M.ssl,M.experimentalForceLongPolling,M.experimentalAutoDetectLongPolling,LG(M.experimentalLongPollingOptions),M.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,c);t._firestoreClient=new wpe(t._authCredentials,t._appCheckCredentials,t._queue,d),!((r=c.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((s=c.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:c.localCache.kind,_offline:c.localCache._offlineComponentProvider,_online:c.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dy{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Dy(Oo.fromBase64String(e))}catch(r){throw new kn(Qt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new Dy(Oo.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new kn(Qt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Po(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n0{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LD{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new kn(Qt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new kn(Qt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return si(this._lat,e._lat)||si(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zD{constructor(e){this._values=(e||[]).map(r=>r)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,c){if(s.length!==c.length)return!1;for(let d=0;d<s.length;++d)if(s[d]!==c[d])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ope=/^__.*__$/;class Dpe{constructor(e,r,s){this.data=e,this.fieldMask=r,this.fieldTransforms=s}toMutation(e,r){return this.fieldMask!==null?new Qf(e,this.data,this.fieldMask,r,this.fieldTransforms):new ib(e,this.data,r,this.fieldTransforms)}}class FG{constructor(e,r,s){this.data=e,this.fieldMask=r,this.fieldTransforms=s}toMutation(e,r){return new Qf(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function BG(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Er()}}class pC{constructor(e,r,s,c,d,_){this.settings=e,this.databaseId=r,this.serializer=s,this.ignoreUndefinedProperties=c,d===void 0&&this.yu(),this.fieldTransforms=d||[],this.fieldMask=_||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new pC(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.Su({path:s,Du:!1});return c.vu(e),c}Cu(e){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(e),c=this.Su({path:s,Du:!1});return c.yu(),c}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return kS(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(BG(this.wu)&&Ope.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class Lpe{constructor(e,r,s){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=s||aC(e)}Nu(e,r,s,c=!1){return new pC({wu:e,methodName:r,Ou:s,path:Po.emptyPath(),Du:!1,xu:c},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function mC(t){const e=t._freezeSettings(),r=aC(t._databaseId);return new Lpe(t._databaseId,!!e.ignoreUndefinedProperties,r)}function jG(t,e,r,s,c,d={}){const _=t.Nu(d.merge||d.mergeFields?2:0,e,r,c);jD("Data must be an object, but it was:",_,s);const x=VG(s,_);let a,I;if(d.merge)a=new ll(_.fieldMask),I=_.fieldTransforms;else if(d.mergeFields){const M=[];for(const D of d.mergeFields){const L=Sk(e,D,r);if(!_.contains(L))throw new kn(Qt.INVALID_ARGUMENT,`Field '${L}' is specified in your field mask but missing from your input data.`);qG(M,L)||M.push(L)}a=new ll(M),I=_.fieldTransforms.filter(D=>a.covers(D.field))}else a=null,I=_.fieldTransforms;return new Dpe(new Na(x),a,I)}class gC extends n0{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof gC}}function UG(t,e,r){return new pC({wu:3,Ou:e.settings.Ou,methodName:t._methodName,Du:r},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ND extends n0{_toFieldTransform(e){return new mD(e.path,new bx)}isEqual(e){return e instanceof ND}}class FD extends n0{constructor(e,r){super(e),this.Lu=r}_toFieldTransform(e){const r=UG(this,e,!0),s=this.Lu.map(d=>og(d,r)),c=new Ry(s);return new mD(e.path,c)}isEqual(e){return e instanceof FD&&Sy(this.Lu,e.Lu)}}class BD extends n0{constructor(e,r){super(e),this.Lu=r}_toFieldTransform(e){const r=UG(this,e,!0),s=this.Lu.map(d=>og(d,r)),c=new My(s);return new mD(e.path,c)}isEqual(e){return e instanceof BD&&Sy(this.Lu,e.Lu)}}function zpe(t,e,r,s){const c=t.Nu(1,e,r);jD("Data must be an object, but it was:",c,s);const d=[],_=Na.empty();ig(s,(a,I)=>{const M=UD(e,a,r);I=Ds(I);const D=c.Cu(M);if(I instanceof gC)d.push(M);else{const L=og(I,D);L!=null&&(d.push(M),_.set(M,L))}});const x=new ll(d);return new FG(_,x,c.fieldTransforms)}function Npe(t,e,r,s,c,d){const _=t.Nu(1,e,r),x=[Sk(e,s,r)],a=[c];if(d.length%2!=0)throw new kn(Qt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let L=0;L<d.length;L+=2)x.push(Sk(e,d[L])),a.push(d[L+1]);const I=[],M=Na.empty();for(let L=x.length-1;L>=0;--L)if(!qG(I,x[L])){const G=x[L];let Q=a[L];Q=Ds(Q);const re=_.Cu(G);if(Q instanceof gC)I.push(G);else{const ee=og(Q,re);ee!=null&&(I.push(G),M.set(G,ee))}}const D=new ll(I);return new FG(M,D,_.fieldTransforms)}function Fpe(t,e,r,s=!1){return og(r,t.Nu(s?4:3,e))}function og(t,e){if($G(t=Ds(t)))return jD("Unsupported field value:",e,t),VG(t,e);if(t instanceof n0)return function(s,c){if(!BG(c.wu))throw c.Mu(`${s._methodName}() can only be used with update() and set()`);if(!c.path)throw c.Mu(`${s._methodName}() is not currently supported inside arrays`);const d=s._toFieldTransform(c);d&&c.fieldTransforms.push(d)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(s,c){const d=[];let _=0;for(const x of s){let a=og(x,c.Fu(_));a==null&&(a={nullValue:"NULL_VALUE"}),d.push(a),_++}return{arrayValue:{values:d}}}(t,e)}return function(s,c){if((s=Ds(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return Pde(c.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const d=ho.fromDate(s);return{timestampValue:PS(c.serializer,d)}}if(s instanceof ho){const d=new ho(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:PS(c.serializer,d)}}if(s instanceof LD)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof Dy)return{bytesValue:cG(c.serializer,s._byteString)};if(s instanceof Ko){const d=c.databaseId,_=s.firestore._databaseId;if(!_.isEqual(d))throw c.Mu(`Document reference is for database ${_.projectId}/${_.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:vD(s.firestore._databaseId||c.databaseId,s._key.path)}}if(s instanceof zD)return function(_,x){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:_.toArray().map(a=>{if(typeof a!="number")throw x.Mu("VectorValues must only contain numeric values.");return pD(x.serializer,a)})}}}}}}(s,c);throw c.Mu(`Unsupported field value: ${uC(s)}`)}(t,e)}function VG(t,e){const r={};return Fq(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ig(t,(s,c)=>{const d=og(c,e.bu(s));d!=null&&(r[s]=d)}),{mapValue:{fields:r}}}function $G(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ho||t instanceof LD||t instanceof Dy||t instanceof Ko||t instanceof n0||t instanceof zD)}function jD(t,e,r){if(!$G(r)||!function(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)}(r)){const s=uC(r);throw s==="an object"?e.Mu(t+" a custom object"):e.Mu(t+" "+s)}}function Sk(t,e,r){if((e=Ds(e))instanceof fC)return e._internalPath;if(typeof e=="string")return UD(t,e);throw kS("Field path arguments must be of type string or ",t,!1,void 0,r)}const Bpe=new RegExp("[~\\*/\\[\\]]");function UD(t,e,r){if(e.search(Bpe)>=0)throw kS(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new fC(...e.split("."))._internalPath}catch{throw kS(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function kS(t,e,r,s,c){const d=s&&!s.isEmpty(),_=c!==void 0;let x=`Function ${e}() called with invalid data`;r&&(x+=" (via `toFirestore()`)"),x+=". ";let a="";return(d||_)&&(a+=" (found",d&&(a+=` in field ${s}`),_&&(a+=` in document ${c}`),a+=")"),new kn(Qt.INVALID_ARGUMENT,x+t+a)}function qG(t,e){return t.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GG{constructor(e,r,s,c,d){this._firestore=e,this._userDataWriter=r,this._key=s,this._document=c,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new Ko(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new jpe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(_C("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class jpe extends GG{data(){return super.data()}}function _C(t,e){return typeof e=="string"?UD(t,e):e instanceof fC?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WG(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new kn(Qt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class VD{}class $D extends VD{}function co(t,e,...r){let s=[];e instanceof VD&&s.push(e),s=s.concat(r),function(d){const _=d.filter(a=>a instanceof qD).length,x=d.filter(a=>a instanceof yC).length;if(_>1||_>0&&x>0)throw new kn(Qt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const c of s)t=c._apply(t);return t}class yC extends $D{constructor(e,r,s){super(),this._field=e,this._op=r,this._value=s,this.type="where"}static _create(e,r,s){return new yC(e,r,s)}_apply(e){const r=this._parse(e);return HG(e._query,r),new rd(e.firestore,e.converter,_k(e._query,r))}_parse(e){const r=mC(e.firestore);return function(d,_,x,a,I,M,D){let L;if(I.isKeyField()){if(M==="array-contains"||M==="array-contains-any")throw new kn(Qt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${M}' queries on documentId().`);if(M==="in"||M==="not-in"){MU(D,M);const G=[];for(const Q of D)G.push(RU(a,d,Q));L={arrayValue:{values:G}}}else L=RU(a,d,D)}else M!=="in"&&M!=="not-in"&&M!=="array-contains-any"||MU(D,M),L=Fpe(x,_,D,M==="in"||M==="not-in");return Ys.create(I,M,L)}(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}function yi(t,e,r){const s=e,c=_C("where",t);return yC._create(c,s,r)}class qD extends VD{constructor(e,r){super(),this.type=e,this._queryConstraints=r}static _create(e,r){return new qD(e,r)}_parse(e){const r=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return r.length===1?r[0]:$c.create(r,this._getOperator())}_apply(e){const r=this._parse(e);return r.getFilters().length===0?e:(function(c,d){let _=c;const x=d.getFlattenedFilters();for(const a of x)HG(_,a),_=_k(_,a)}(e._query,r),new rd(e.firestore,e.converter,_k(e._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class GD extends $D{constructor(e,r){super(),this._field=e,this._direction=r,this.type="orderBy"}static _create(e,r){return new GD(e,r)}_apply(e){const r=function(c,d,_){if(c.startAt!==null)throw new kn(Qt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(c.endAt!==null)throw new kn(Qt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new xx(d,_)}(e._query,this._field,this._direction);return new rd(e.firestore,e.converter,function(c,d){const _=c.explicitOrderBy.concat([d]);return new Jy(c.path,c.collectionGroup,_,c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt)}(e._query,r))}}function wx(t,e="asc"){const r=e,s=_C("orderBy",t);return GD._create(s,r)}class WD extends $D{constructor(e,r,s){super(),this.type=e,this._limit=r,this._limitType=s}static _create(e,r,s){return new WD(e,r,s)}_apply(e){return new rd(e.firestore,e.converter,CS(e._query,this._limit,this._limitType))}}function HD(t){return Ppe("limit",t),WD._create("limit",t,"F")}function RU(t,e,r){if(typeof(r=Ds(r))=="string"){if(r==="")throw new kn(Qt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Hq(e)&&r.indexOf("/")!==-1)throw new kn(Qt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const s=e.path.child(Yi.fromString(r));if(!rr.isDocumentKey(s))throw new kn(Qt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Qj(t,new rr(s))}if(r instanceof Ko)return Qj(t,r._key);throw new kn(Qt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uC(r)}.`)}function MU(t,e){if(!Array.isArray(t)||t.length===0)throw new kn(Qt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function HG(t,e){const r=function(c,d){for(const _ of c)for(const x of _.getFlattenedFilters())if(d.indexOf(x.op)>=0)return x.op;return null}(t.filters,function(c){switch(c){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(r!==null)throw r===e.op?new kn(Qt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new kn(Qt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}class Upe{convertValue(e,r="none"){switch(Bm(e)){case 0:return null;case 1:return e.booleanValue;case 2:return js(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(Fm(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw Er()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const s={};return ig(e,(c,d)=>{s[c]=this.convertValue(d,r)}),s}convertVectorValue(e){var r,s,c;const d=(c=(s=(r=e.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||s===void 0?void 0:s.values)===null||c===void 0?void 0:c.map(_=>js(_.doubleValue));return new zD(d)}convertGeoPoint(e){return new LD(js(e.latitude),js(e.longitude))}convertArray(e,r){return(e.values||[]).map(s=>this.convertValue(s,r))}convertServerTimestamp(e,r){switch(r){case"previous":const s=uD(e);return s==null?null:this.convertValue(s,r);case"estimate":return this.convertTimestamp(_x(e));default:return null}}convertTimestamp(e){const r=Nf(e);return new ho(r.seconds,r.nanos)}convertDocumentKey(e,r){const s=Yi.fromString(e);Ni(mG(s));const c=new yx(s.get(1),s.get(3)),d=new rr(s.popFirst(5));return c.isEqual(r)||Zh(`Document ${d} contains a document reference within a different database (${c.projectId}/${c.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZG(t,e,r){let s;return s=t?t.toFirestore(e):e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a1{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class XG extends GG{constructor(e,r,s,c,d,_){super(e,r,s,c,_),this._firestore=e,this._firestoreImpl=e,this.metadata=d}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new SE(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const s=this._document.data.field(_C("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,r.serverTimestamps)}}}class SE extends XG{data(e={}){return super.data(e)}}class KG{constructor(e,r,s,c){this._firestore=e,this._userDataWriter=r,this._snapshot=c,this.metadata=new a1(c.hasPendingWrites,c.fromCache),this.query=s}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(s=>{e.call(r,new SE(this._firestore,this._userDataWriter,s.key,s,new a1(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new kn(Qt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(c,d){if(c._snapshot.oldDocs.isEmpty()){let _=0;return c._snapshot.docChanges.map(x=>{const a=new SE(c._firestore,c._userDataWriter,x.doc.key,x.doc,new a1(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);return x.doc,{type:"added",doc:a,oldIndex:-1,newIndex:_++}})}{let _=c._snapshot.oldDocs;return c._snapshot.docChanges.filter(x=>d||x.type!==3).map(x=>{const a=new SE(c._firestore,c._userDataWriter,x.doc.key,x.doc,new a1(c._snapshot.mutatedKeys.has(x.doc.key),c._snapshot.fromCache),c.query.converter);let I=-1,M=-1;return x.type!==0&&(I=_.indexOf(x.doc.key),_=_.delete(x.doc.key)),x.type!==1&&(_=_.add(x.doc),M=_.indexOf(x.doc.key)),{type:Vpe(x.type),doc:a,oldIndex:I,newIndex:M}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function Vpe(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Er()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $i(t){t=$a(t,Ko);const e=$a(t.firestore,Kh);return Ipe(dC(e),t._key).then(r=>QG(e,t,r))}class ZD extends Upe{constructor(e){super(),this.firestore=e}convertBytes(e){return new Dy(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new Ko(this.firestore,null,r)}}function _a(t){t=$a(t,rd);const e=$a(t.firestore,Kh),r=dC(e),s=new ZD(e);return WG(t._query),Cpe(r,t._query).then(c=>new KG(e,s,t,c))}function wm(t,e,r){t=$a(t,Ko);const s=$a(t.firestore,Kh),c=ZG(t.converter,e);return vC(s,[jG(mC(s),"setDoc",t._key,c,t.converter!==null,r).toMutation(t._key,Zl.none())])}function us(t,e,r,...s){t=$a(t,Ko);const c=$a(t.firestore,Kh),d=mC(c);let _;return _=typeof(e=Ds(e))=="string"||e instanceof fC?Npe(d,"updateDoc",t._key,e,r,s):zpe(d,"updateDoc",t._key,e),vC(c,[_.toMutation(t._key,Zl.exists(!0))])}function cy(t){return vC($a(t.firestore,Kh),[new gD(t._key,Zl.none())])}function Tx(t,e){const r=$a(t.firestore,Kh),s=Xn(t),c=ZG(t.converter,e);return vC(r,[jG(mC(t.firestore),"addDoc",s._key,c,t.converter!==null,{}).toMutation(s._key,Zl.exists(!1))]).then(()=>s)}function jh(t,...e){var r,s,c;t=Ds(t);let d={includeMetadataChanges:!1,source:"default"},_=0;typeof e[_]!="object"||PU(e[_])||(d=e[_],_++);const x={includeMetadataChanges:d.includeMetadataChanges,source:d.source};if(PU(e[_])){const D=e[_];e[_]=(r=D.next)===null||r===void 0?void 0:r.bind(D),e[_+1]=(s=D.error)===null||s===void 0?void 0:s.bind(D),e[_+2]=(c=D.complete)===null||c===void 0?void 0:c.bind(D)}let a,I,M;if(t instanceof Ko)I=$a(t.firestore,Kh),M=tC(t._key.path),a={next:D=>{e[_]&&e[_](QG(I,t,D))},error:e[_+1],complete:e[_+2]};else{const D=$a(t,rd);I=$a(D.firestore,Kh),M=D._query;const L=new ZD(I);a={next:G=>{e[_]&&e[_](new KG(I,L,D,G))},error:e[_+1],complete:e[_+2]},WG(t._query)}return function(L,G,Q,re){const ee=new DD(re),U=new kD(G,ee,Q);return L.asyncQueue.enqueueAndForget(async()=>PD(await MS(L),U)),()=>{ee.za(),L.asyncQueue.enqueueAndForget(async()=>RD(await MS(L),U))}}(dC(I),M,x,a)}function vC(t,e){return function(s,c){const d=new Bh;return s.asyncQueue.enqueueAndForget(async()=>fpe(await Spe(s),c,d)),d.promise}(dC(t),e)}function QG(t,e,r){const s=r.docs.get(e._key),c=new ZD(t);return new XG(t,c,e._key,s,new a1(r.hasPendingWrites,r.fromCache),e.converter)}function OS(){return new ND("serverTimestamp")}function O1(...t){return new FD("arrayUnion",t)}function Ik(...t){return new BD("arrayRemove",t)}(function(e,r=!0){(function(c){Yy=c})(rg),Dm(new Lf("firestore",(s,{instanceIdentifier:c,options:d})=>{const _=s.getProvider("app").getImmediate(),x=new Kh(new Whe(s.getProvider("auth-internal")),new Khe(s.getProvider("app-check-internal")),function(I,M){if(!Object.prototype.hasOwnProperty.apply(I.options,["projectId"]))throw new kn(Qt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new yx(I.options.projectId,M)}(_,c),_);return d=Object.assign({useFetchStreams:r},d),x._setSettings(d),x},"PUBLIC").setMultipleInstances(!0)),zu(Wj,"4.7.1",e),zu(Wj,"4.7.1","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YG="firebasestorage.googleapis.com",JG="storageBucket",$pe=2*60*1e3,qpe=10*60*1e3,Gpe=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends Wu{constructor(e,r,s=0){super(_R(e),`Firebase Storage: ${r} (${_R(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ws.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return _R(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ts;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ts||(ts={}));function _R(t){return"storage/"+t}function XD(){const t="An unknown error occurred, please check the error payload for server response.";return new ws(ts.UNKNOWN,t)}function Wpe(t){return new ws(ts.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function Hpe(t){return new ws(ts.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Zpe(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ws(ts.UNAUTHENTICATED,t)}function Xpe(){return new ws(ts.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Kpe(t){return new ws(ts.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function eW(){return new ws(ts.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function tW(){return new ws(ts.CANCELED,"User canceled the upload/download.")}function Qpe(t){return new ws(ts.INVALID_URL,"Invalid URL '"+t+"'.")}function Ype(t){return new ws(ts.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Jpe(){return new ws(ts.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+JG+"' property when initializing the app?")}function nW(){return new ws(ts.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function eme(){return new ws(ts.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function tme(){return new ws(ts.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function nme(t){return new ws(ts.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function Ck(t){return new ws(ts.INVALID_ARGUMENT,t)}function rW(){return new ws(ts.APP_DELETED,"The Firebase app was deleted.")}function rme(t){return new ws(ts.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function D1(t,e){return new ws(ts.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Vv(t){throw new ws(ts.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cl{constructor(e,r){this.bucket=e,this.path_=r}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,r){let s;try{s=cl.makeFromUrl(e,r)}catch{return new cl(e,"")}if(s.path==="")return s;throw Ype(e)}static makeFromUrl(e,r){let s=null;const c="([A-Za-z0-9.\\-_]+)";function d(de){de.path.charAt(de.path.length-1)==="/"&&(de.path_=de.path_.slice(0,-1))}const _="(/(.*))?$",x=new RegExp("^gs://"+c+_,"i"),a={bucket:1,path:3};function I(de){de.path_=decodeURIComponent(de.path)}const M="v[A-Za-z0-9_]+",D=r.replace(/[.]/g,"\\."),L="(/([^?#]*).*)?$",G=new RegExp(`^https?://${D}/${M}/b/${c}/o${L}`,"i"),Q={bucket:1,path:3},re=r===YG?"(?:storage.googleapis.com|storage.cloud.google.com)":r,ee="([^?#]*)",U=new RegExp(`^https?://${re}/${c}/${ee}`,"i"),Z=[{regex:x,indices:a,postModify:d},{regex:G,indices:Q,postModify:I},{regex:U,indices:{bucket:1,path:2},postModify:I}];for(let de=0;de<Z.length;de++){const ve=Z[de],Ee=ve.regex.exec(e);if(Ee){const ie=Ee[ve.indices.bucket];let ue=Ee[ve.indices.path];ue||(ue=""),s=new cl(ie,ue),ve.postModify(s);break}}if(s==null)throw Qpe(e);return s}}class ime{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sme(t,e,r){let s=1,c=null,d=null,_=!1,x=0;function a(){return x===2}let I=!1;function M(...ee){I||(I=!0,e.apply(null,ee))}function D(ee){c=setTimeout(()=>{c=null,t(G,a())},ee)}function L(){d&&clearTimeout(d)}function G(ee,...U){if(I){L();return}if(ee){L(),M.call(null,ee,...U);return}if(a()||_){L(),M.call(null,ee,...U);return}s<64&&(s*=2);let Z;x===1?(x=2,Z=0):Z=(s+Math.random())*1e3,D(Z)}let Q=!1;function re(ee){Q||(Q=!0,L(),!I&&(c!==null?(ee||(x=2),clearTimeout(c),D(0)):ee||(x=1)))}return D(0),d=setTimeout(()=>{_=!0,re(!0)},r),re}function ome(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ame(t){return t!==void 0}function lme(t){return typeof t=="function"}function cme(t){return typeof t=="object"&&!Array.isArray(t)}function xC(t){return typeof t=="string"||t instanceof String}function kU(t){return KD()&&t instanceof Blob}function KD(){return typeof Blob<"u"}function OU(t,e,r,s){if(s<e)throw Ck(`Invalid value for '${t}'. Expected ${e} or greater.`);if(s>r)throw Ck(`Invalid value for '${t}'. Expected ${r} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lb(t,e,r){let s=e;return r==null&&(s=`https://${e}`),`${r}://${s}/v0${t}`}function iW(t){const e=encodeURIComponent;let r="?";for(const s in t)if(t.hasOwnProperty(s)){const c=e(s)+"="+e(t[s]);r=r+c+"&"}return r=r.slice(0,-1),r}var Tm;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Tm||(Tm={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sW(t,e){const r=t>=500&&t<600,c=[408,429].indexOf(t)!==-1,d=e.indexOf(t)!==-1;return r||c||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ume{constructor(e,r,s,c,d,_,x,a,I,M,D,L=!0){this.url_=e,this.method_=r,this.headers_=s,this.body_=c,this.successCodes_=d,this.additionalRetryCodes_=_,this.callback_=x,this.errorCallback_=a,this.timeout_=I,this.progressCallback_=M,this.connectionFactory_=D,this.retry=L,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((G,Q)=>{this.resolve_=G,this.reject_=Q,this.start_()})}start_(){const e=(s,c)=>{if(c){s(!1,new VT(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const _=x=>{const a=x.loaded,I=x.lengthComputable?x.total:-1;this.progressCallback_!==null&&this.progressCallback_(a,I)};this.progressCallback_!==null&&d.addUploadProgressListener(_),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(_),this.pendingConnection_=null;const x=d.getErrorCode()===Tm.NO_ERROR,a=d.getStatus();if(!x||sW(a,this.additionalRetryCodes_)&&this.retry){const M=d.getErrorCode()===Tm.ABORT;s(!1,new VT(!1,null,M));return}const I=this.successCodes_.indexOf(a)!==-1;s(!0,new VT(I,d))})},r=(s,c)=>{const d=this.resolve_,_=this.reject_,x=c.connection;if(c.wasSuccessCode)try{const a=this.callback_(x,x.getResponse());ame(a)?d(a):d()}catch(a){_(a)}else if(x!==null){const a=XD();a.serverResponse=x.getErrorText(),this.errorCallback_?_(this.errorCallback_(x,a)):_(a)}else if(c.canceled){const a=this.appDelete_?rW():tW();_(a)}else{const a=eW();_(a)}};this.canceled_?r(!1,new VT(!1,null,!0)):this.backoffId_=sme(e,r,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&ome(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class VT{constructor(e,r,s){this.wasSuccessCode=e,this.connection=r,this.canceled=!!s}}function hme(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function dme(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function fme(t,e){e&&(t["X-Firebase-GMPID"]=e)}function pme(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function mme(t,e,r,s,c,d,_=!0){const x=iW(t.urlParams),a=t.url+x,I=Object.assign({},t.headers);return fme(I,e),hme(I,r),dme(I,d),pme(I,s),new ume(a,t.method,I,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,c,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gme(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function _me(...t){const e=gme();if(e!==void 0){const r=new e;for(let s=0;s<t.length;s++)r.append(t[s]);return r.getBlob()}else{if(KD())return new Blob(t);throw new ws(ts.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function yme(t,e,r){return t.webkitSlice?t.webkitSlice(e,r):t.mozSlice?t.mozSlice(e,r):t.slice?t.slice(e,r):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vme(t){if(typeof atob>"u")throw nme("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zc={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class yR{constructor(e,r){this.data=e,this.contentType=r||null}}function oW(t,e){switch(t){case zc.RAW:return new yR(aW(e));case zc.BASE64:case zc.BASE64URL:return new yR(lW(t,e));case zc.DATA_URL:return new yR(bme(e),wme(e))}throw XD()}function aW(t){const e=[];for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(r<t.length-1&&(t.charCodeAt(r+1)&64512)===56320))e.push(239,191,189);else{const d=s,_=t.charCodeAt(++r);s=65536|(d&1023)<<10|_&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function xme(t){let e;try{e=decodeURIComponent(t)}catch{throw D1(zc.DATA_URL,"Malformed data URL.")}return aW(e)}function lW(t,e){switch(t){case zc.BASE64:{const c=e.indexOf("-")!==-1,d=e.indexOf("_")!==-1;if(c||d)throw D1(t,"Invalid character '"+(c?"-":"_")+"' found: is it base64url encoded?");break}case zc.BASE64URL:{const c=e.indexOf("+")!==-1,d=e.indexOf("/")!==-1;if(c||d)throw D1(t,"Invalid character '"+(c?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=vme(e)}catch(c){throw c.message.includes("polyfill")?c:D1(t,"Invalid character found")}const s=new Uint8Array(r.length);for(let c=0;c<r.length;c++)s[c]=r.charCodeAt(c);return s}class cW{constructor(e){this.base64=!1,this.contentType=null;const r=e.match(/^data:([^,]+)?,/);if(r===null)throw D1(zc.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=r[1]||null;s!=null&&(this.base64=Tme(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}}function bme(t){const e=new cW(t);return e.base64?lW(zc.BASE64,e.rest):xme(e.rest)}function wme(t){return new cW(t).contentType}function Tme(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mh{constructor(e,r){let s=0,c="";kU(e)?(this.data_=e,s=e.size,c=e.type):e instanceof ArrayBuffer?(r?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(r?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=c}size(){return this.size_}type(){return this.type_}slice(e,r){if(kU(this.data_)){const s=this.data_,c=yme(s,e,r);return c===null?null:new Mh(c)}else{const s=new Uint8Array(this.data_.buffer,e,r-e);return new Mh(s,!0)}}static getBlob(...e){if(KD()){const r=e.map(s=>s instanceof Mh?s.data_:s);return new Mh(_me.apply(null,r))}else{const r=e.map(_=>xC(_)?oW(zc.RAW,_).data:_.data_);let s=0;r.forEach(_=>{s+=_.byteLength});const c=new Uint8Array(s);let d=0;return r.forEach(_=>{for(let x=0;x<_.length;x++)c[d++]=_[x]}),new Mh(c,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uW(t){let e;try{e=JSON.parse(t)}catch{return null}return cme(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eme(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function Sme(t,e){const r=e.split("/").filter(s=>s.length>0).join("/");return t.length===0?r:t+"/"+r}function hW(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ime(t,e){return e}class ma{constructor(e,r,s,c){this.server=e,this.local=r||e,this.writable=!!s,this.xform=c||Ime}}let $T=null;function Cme(t){return!xC(t)||t.length<2?t:hW(t)}function QD(){if($T)return $T;const t=[];t.push(new ma("bucket")),t.push(new ma("generation")),t.push(new ma("metageneration")),t.push(new ma("name","fullPath",!0));function e(d,_){return Cme(_)}const r=new ma("name");r.xform=e,t.push(r);function s(d,_){return _!==void 0?Number(_):_}const c=new ma("size");return c.xform=s,t.push(c),t.push(new ma("timeCreated")),t.push(new ma("updated")),t.push(new ma("md5Hash",null,!0)),t.push(new ma("cacheControl",null,!0)),t.push(new ma("contentDisposition",null,!0)),t.push(new ma("contentEncoding",null,!0)),t.push(new ma("contentLanguage",null,!0)),t.push(new ma("contentType",null,!0)),t.push(new ma("metadata","customMetadata",!0)),$T=t,$T}function Ame(t,e){function r(){const s=t.bucket,c=t.fullPath,d=new cl(s,c);return e._makeStorageReference(d)}Object.defineProperty(t,"ref",{get:r})}function Pme(t,e,r){const s={};s.type="file";const c=r.length;for(let d=0;d<c;d++){const _=r[d];s[_.local]=_.xform(s,e[_.server])}return Ame(s,t),s}function dW(t,e,r){const s=uW(e);return s===null?null:Pme(t,s,r)}function Rme(t,e,r,s){const c=uW(e);if(c===null||!xC(c.downloadTokens))return null;const d=c.downloadTokens;if(d.length===0)return null;const _=encodeURIComponent;return d.split(",").map(I=>{const M=t.bucket,D=t.fullPath,L="/b/"+_(M)+"/o/"+_(D),G=lb(L,r,s),Q=iW({alt:"media",token:I});return G+Q})[0]}function fW(t,e){const r={},s=e.length;for(let c=0;c<s;c++){const d=e[c];d.writable&&(r[d.server]=t[d.local])}return JSON.stringify(r)}class r0{constructor(e,r,s,c){this.url=e,this.method=r,this.handler=s,this.timeout=c,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uh(t){if(!t)throw XD()}function YD(t,e){function r(s,c){const d=dW(t,c,e);return Uh(d!==null),d}return r}function Mme(t,e){function r(s,c){const d=dW(t,c,e);return Uh(d!==null),Rme(d,c,t.host,t._protocol)}return r}function cb(t){function e(r,s){let c;return r.getStatus()===401?r.getErrorText().includes("Firebase App Check token is invalid")?c=Xpe():c=Zpe():r.getStatus()===402?c=Hpe(t.bucket):r.getStatus()===403?c=Kpe(t.path):c=s,c.status=r.getStatus(),c.serverResponse=s.serverResponse,c}return e}function pW(t){const e=cb(t);function r(s,c){let d=e(s,c);return s.getStatus()===404&&(d=Wpe(t.path)),d.serverResponse=c.serverResponse,d}return r}function kme(t,e,r){const s=e.fullServerUrl(),c=lb(s,t.host,t._protocol),d="GET",_=t.maxOperationRetryTime,x=new r0(c,d,YD(t,r),_);return x.errorHandler=pW(e),x}function Ome(t,e,r){const s=e.fullServerUrl(),c=lb(s,t.host,t._protocol),d="GET",_=t.maxOperationRetryTime,x=new r0(c,d,Mme(t,r),_);return x.errorHandler=pW(e),x}function Dme(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function mW(t,e,r){const s=Object.assign({},r);return s.fullPath=t.path,s.size=e.size(),s.contentType||(s.contentType=Dme(null,e)),s}function gW(t,e,r,s,c){const d=e.bucketOnlyServerUrl(),_={"X-Goog-Upload-Protocol":"multipart"};function x(){let Z="";for(let de=0;de<2;de++)Z=Z+Math.random().toString().slice(2);return Z}const a=x();_["Content-Type"]="multipart/related; boundary="+a;const I=mW(e,s,c),M=fW(I,r),D="--"+a+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+M+`\r
--`+a+`\r
Content-Type: `+I.contentType+`\r
\r
`,L=`\r
--`+a+"--",G=Mh.getBlob(D,s,L);if(G===null)throw nW();const Q={name:I.fullPath},re=lb(d,t.host,t._protocol),ee="POST",U=t.maxUploadRetryTime,H=new r0(re,ee,YD(t,r),U);return H.urlParams=Q,H.headers=_,H.body=G.uploadData(),H.errorHandler=cb(e),H}class DS{constructor(e,r,s,c){this.current=e,this.total=r,this.finalized=!!s,this.metadata=c||null}}function JD(t,e){let r=null;try{r=t.getResponseHeader("X-Goog-Upload-Status")}catch{Uh(!1)}return Uh(!!r&&(e||["active"]).indexOf(r)!==-1),r}function Lme(t,e,r,s,c){const d=e.bucketOnlyServerUrl(),_=mW(e,s,c),x={name:_.fullPath},a=lb(d,t.host,t._protocol),I="POST",M={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${s.size()}`,"X-Goog-Upload-Header-Content-Type":_.contentType,"Content-Type":"application/json; charset=utf-8"},D=fW(_,r),L=t.maxUploadRetryTime;function G(re){JD(re);let ee;try{ee=re.getResponseHeader("X-Goog-Upload-URL")}catch{Uh(!1)}return Uh(xC(ee)),ee}const Q=new r0(a,I,G,L);return Q.urlParams=x,Q.headers=M,Q.body=D,Q.errorHandler=cb(e),Q}function zme(t,e,r,s){const c={"X-Goog-Upload-Command":"query"};function d(I){const M=JD(I,["active","final"]);let D=null;try{D=I.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Uh(!1)}D||Uh(!1);const L=Number(D);return Uh(!isNaN(L)),new DS(L,s.size(),M==="final")}const _="POST",x=t.maxUploadRetryTime,a=new r0(r,_,d,x);return a.headers=c,a.errorHandler=cb(e),a}const DU=256*1024;function Nme(t,e,r,s,c,d,_,x){const a=new DS(0,0);if(_?(a.current=_.current,a.total=_.total):(a.current=0,a.total=s.size()),s.size()!==a.total)throw eme();const I=a.total-a.current;let M=I;c>0&&(M=Math.min(M,c));const D=a.current,L=D+M;let G="";M===0?G="finalize":I===M?G="upload, finalize":G="upload";const Q={"X-Goog-Upload-Command":G,"X-Goog-Upload-Offset":`${a.current}`},re=s.slice(D,L);if(re===null)throw nW();function ee(de,ve){const Ee=JD(de,["active","final"]),ie=a.current+M,ue=s.size();let K;return Ee==="final"?K=YD(e,d)(de,ve):K=null,new DS(ie,ue,Ee==="final",K)}const U="POST",H=e.maxUploadRetryTime,Z=new r0(r,U,ee,H);return Z.headers=Q,Z.body=re.uploadData(),Z.progressCallback=x||null,Z.errorHandler=cb(t),Z}const Oa={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function vR(t){switch(t){case"running":case"pausing":case"canceling":return Oa.RUNNING;case"paused":return Oa.PAUSED;case"success":return Oa.SUCCESS;case"canceled":return Oa.CANCELED;case"error":return Oa.ERROR;default:return Oa.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fme{constructor(e,r,s){if(lme(e)||r!=null||s!=null)this.next=e,this.error=r??void 0,this.complete=s??void 0;else{const d=e;this.next=d.next,this.error=d.error,this.complete=d.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y_(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class Bme{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Tm.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Tm.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Tm.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,r,s,c){if(this.sent_)throw Vv("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(r,e,!0),c!==void 0)for(const d in c)c.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,c[d].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Vv("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Vv("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Vv("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Vv("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class jme extends Bme{initXhr(){this.xhr_.responseType="text"}}function sm(){return new jme}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ume{constructor(e,r,s=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=r,this._metadata=s,this._mappings=QD(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=c=>{if(this._request=void 0,this._chunkMultiplier=1,c._codeEquals(ts.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const d=this.isExponentialBackoffExpired();if(sW(c.status,[]))if(d)c=eW();else{this.sleepTime=Math.max(this.sleepTime*2,Gpe),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=c,this._transition("error")}},this._metadataErrorHandler=c=>{this._request=void 0,c._codeEquals(ts.CANCELED)?this.completeTransitions_():(this._error=c,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((c,d)=>{this._resolve=c,this._reject=d,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return r=>this._updateProgress(e+r)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([r,s])=>{switch(this._state){case"running":e(r,s);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,r)=>{const s=Lme(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(s,sm,e,r);this._request=c,c.getPromise().then(d=>{this._request=void 0,this._uploadUrl=d,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((r,s)=>{const c=zme(this._ref.storage,this._ref._location,e,this._blob),d=this._ref.storage._makeRequest(c,sm,r,s);this._request=d,d.getPromise().then(_=>{_=_,this._request=void 0,this._updateProgress(_.current),this._needToFetchStatus=!1,_.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=DU*this._chunkMultiplier,r=new DS(this._transferred,this._blob.size()),s=this._uploadUrl;this._resolveToken((c,d)=>{let _;try{_=Nme(this._ref._location,this._ref.storage,s,this._blob,e,this._mappings,r,this._makeProgressCallback())}catch(a){this._error=a,this._transition("error");return}const x=this._ref.storage._makeRequest(_,sm,c,d,!1);this._request=x,x.getPromise().then(a=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(a.current),a.finalized?(this._metadata=a.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){DU*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,r)=>{const s=kme(this._ref.storage,this._ref._location,this._mappings),c=this._ref.storage._makeRequest(s,sm,e,r);this._request=c,c.getPromise().then(d=>{this._request=void 0,this._metadata=d,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,r)=>{const s=gW(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),c=this._ref.storage._makeRequest(s,sm,e,r);this._request=c,c.getPromise().then(d=>{this._request=void 0,this._metadata=d,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const r=this._transferred;this._transferred=e,this._transferred!==r&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const r=this._state==="paused";this._state=e,r&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=tW(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=vR(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,r,s,c){const d=new Fme(r||void 0,s||void 0,c||void 0);return this._addObserver(d),()=>{this._removeObserver(d)}}then(e,r){return this._promise.then(e,r)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const r=this._observers.indexOf(e);r!==-1&&this._observers.splice(r,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(r=>{this._notifyObserver(r)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(vR(this._state)){case Oa.SUCCESS:y_(this._resolve.bind(null,this.snapshot))();break;case Oa.CANCELED:case Oa.ERROR:const r=this._reject;y_(r.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(vR(this._state)){case Oa.RUNNING:case Oa.PAUSED:e.next&&y_(e.next.bind(e,this.snapshot))();break;case Oa.SUCCESS:e.complete&&y_(e.complete.bind(e))();break;case Oa.CANCELED:case Oa.ERROR:e.error&&y_(e.error.bind(e,this._error))();break;default:e.error&&y_(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e,r){this._service=e,r instanceof cl?this._location=r:this._location=cl.makeFromUrl(r,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,r){return new jm(e,r)}get root(){const e=new cl(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return hW(this._location.path)}get storage(){return this._service}get parent(){const e=Eme(this._location.path);if(e===null)return null;const r=new cl(this._location.bucket,e);return new jm(this._service,r)}_throwIfRoot(e){if(this._location.path==="")throw rme(e)}}function Vme(t,e,r){t._throwIfRoot("uploadBytes");const s=gW(t.storage,t._location,QD(),new Mh(e,!0),r);return t.storage.makeRequestWithTokens(s,sm).then(c=>({metadata:c,ref:t}))}function $me(t,e,r){return t._throwIfRoot("uploadBytesResumable"),new Ume(t,new Mh(e),r)}function qme(t,e,r=zc.RAW,s){t._throwIfRoot("uploadString");const c=oW(r,e),d=Object.assign({},s);return d.contentType==null&&c.contentType!=null&&(d.contentType=c.contentType),Vme(t,c.data,d)}function Gme(t){t._throwIfRoot("getDownloadURL");const e=Ome(t.storage,t._location,QD());return t.storage.makeRequestWithTokens(e,sm).then(r=>{if(r===null)throw tme();return r})}function Wme(t,e){const r=Sme(t._location.path,e),s=new cl(t._location.bucket,r);return new jm(t.storage,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hme(t){return/^[A-Za-z]+:\/\//.test(t)}function Zme(t,e){return new jm(t,e)}function _W(t,e){if(t instanceof e5){const r=t;if(r._bucket==null)throw Jpe();const s=new jm(r,r._bucket);return e!=null?_W(s,e):s}else return e!==void 0?Wme(t,e):t}function Xme(t,e){if(e&&Hme(e)){if(t instanceof e5)return Zme(t,e);throw Ck("To use ref(service, url), the first argument must be a Storage instance.")}else return _W(t,e)}function LU(t,e){const r=e==null?void 0:e[JG];return r==null?null:cl.makeFromBucketSpec(r,t)}function Kme(t,e,r,s={}){t.host=`${e}:${r}`,t._protocol="http";const{mockUserToken:c}=s;c&&(t._overrideAuthToken=typeof c=="string"?c:$7(c,t.app.options.projectId))}class e5{constructor(e,r,s,c,d){this.app=e,this._authProvider=r,this._appCheckProvider=s,this._url=c,this._firebaseVersion=d,this._bucket=null,this._host=YG,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=$pe,this._maxUploadRetryTime=qpe,this._requests=new Set,c!=null?this._bucket=cl.makeFromBucketSpec(c,this._host):this._bucket=LU(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=cl.makeFromBucketSpec(this._url,e):this._bucket=LU(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){OU("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){OU("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const r=await e.getToken();if(r!==null)return r.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new jm(this,e)}_makeRequest(e,r,s,c,d=!0){if(this._deleted)return new ime(rW());{const _=mme(e,this._appId,s,c,r,this._firebaseVersion,d);return this._requests.add(_),_.getPromise().then(()=>this._requests.delete(_),()=>this._requests.delete(_)),_}}async makeRequestWithTokens(e,r){const[s,c]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,r,s,c).getPromise()}}const zU="@firebase/storage",NU="0.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yW="storage";function Qme(t,e,r,s){return t=Ds(t),qme(t,e,r,s)}function Yme(t,e,r){return t=Ds(t),$me(t,e,r)}function vW(t){return t=Ds(t),Gme(t)}function xW(t,e){return t=Ds(t),Xme(t,e)}function bW(t=XO(),e){t=Ds(t);const s=KI(t,yW).getImmediate({identifier:e}),c=j7("storage");return c&&Jme(s,...c),s}function Jme(t,e,r,s={}){Kme(t,e,r,s)}function ege(t,{instanceIdentifier:e}){const r=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),c=t.getProvider("app-check-internal");return new e5(r,s,c,e,rg)}function tge(){Dm(new Lf(yW,ege,"PUBLIC").setMultipleInstances(!0)),zu(zU,NU,""),zu(zU,NU,"esm2017")}tge();const nge={apiKey:"AIzaSyBcfSX72wkSxZ7cPGaWrkJ7OreAjYmuCOo",authDomain:"quests-backup.firebaseapp.com",projectId:"quests-backup",storageBucket:"quests-backup.appspot.com",messagingSenderId:"512930742831",appId:"1:512930742831:web:cd58945dd92b3a4e6e3cda",measurementId:"G-EB4H740XB0"},t5=W7(nge),Wt=Vhe(t5),wn=kpe(t5),rge=bW(t5),ige=async(t,e,r)=>{try{const s=await Pue(Wt,t,e),c=s.user.uid;return await wm(Xn(wn,"users",c),{name:r,email:t,profilePhoto:await n5(),bio:"",isActive:!0,lastActive:Date.now(),receiverId:c,senderId:c,isPrivate:!1}),s}catch(s){console.error("Error signing up:",s)}},wW=new Ru,sge=async()=>{try{const e=(await Cq(Wt,wW)).user,r=Xn(wn,"users",e.uid);return(await $i(r)).exists()||await wm(r,{name:e.displayName||"Unnamed",email:e.email,profilePhoto:e.photoURL||await n5(),bio:"",isActive:!0,receiverId:e.uid,senderId:e.uid,isPrivate:!1}),e}catch(t){throw console.error("Error signing up with Google:",t),t}},oge=async()=>{try{const t=await Cq(Wt,wW),r=Ru.credentialFromResult(t).accessToken,s=t.user;return await Ak(s.uid,{isActive:!0,lastActive:Date.now()}),console.log("User signed in with Google:",s),s}catch(t){console.error("Error signing in with Google:",t)}},age=async(t,e)=>{var r;try{const s=await Rue(Wt,t,e),c=(r=s.user)==null?void 0:r.uid;return c?await us(Xn(wn,"users",c),{isActive:!0,lastActive:Date.now()}):console.error("User ID is not available"),s}catch(s){console.error("Error signing in:",s)}},lge=async t=>{const e=bW(),r=xW(e,`profile_photos/${Wt.currentUser.uid}`),s=Yme(r,t);return new Promise((c,d)=>{s.on("state_changed",_=>{},_=>{console.error("Error uploading image:",_),d(_)},async()=>{try{const _=await vW(s.snapshot.ref);c(_)}catch(_){console.error("Error getting download URL:",_),d(_)}})})},Ak=async(t,e)=>{try{console.log("Updating user profile:",t,e),await us(Xn(wn,"users",t),e),console.log("User profile updated successfully")}catch(r){console.error("Error updating user profile:",r)}},n5=async()=>"https://firebasestorage.googleapis.com/v0/b/quests-b5b92.appspot.com/o/profile_photos%2Fdefault.jpg?alt=media&token=e7424067-7007-4a70-a405-b56c83f0d9d2",uy=async t=>{try{const e=await $i(Xn(wn,"users",t));if(e.exists())return e.data();console.log("No such document!")}catch(e){console.error("Error fetching user data:",e)}};var TW={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},FU=Gr.createContext&&Gr.createContext(TW),cge=["attr","size","title"];function uge(t,e){if(t==null)return{};var r=hge(t,e),s,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(t);for(c=0;c<d.length;c++)s=d[c],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(r[s]=t[s])}return r}function hge(t,e){if(t==null)return{};var r={};for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){if(e.indexOf(s)>=0)continue;r[s]=t[s]}return r}function LS(){return LS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},LS.apply(this,arguments)}function BU(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,s)}return r}function zS(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?BU(Object(r),!0).forEach(function(s){dge(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):BU(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function dge(t,e,r){return e=fge(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function fge(t){var e=pge(t,"string");return typeof e=="symbol"?e:e+""}function pge(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function EW(t){return t&&t.map((e,r)=>Gr.createElement(e.tag,zS({key:r},e.attr),EW(e.child)))}function SW(t){return e=>Gr.createElement(mge,LS({attr:zS({},t.attr)},e),EW(t.child))}function mge(t){var e=r=>{var{attr:s,size:c,title:d}=t,_=uge(t,cge),x=c||r.size||"1em",a;return r.className&&(a=r.className),t.className&&(a=(a?a+" ":"")+t.className),Gr.createElement("svg",LS({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,s,_,{className:a,style:zS(zS({color:t.color||r.color},r.style),t.style),height:x,width:x,xmlns:"http://www.w3.org/2000/svg"}),d&&Gr.createElement("title",null,d),t.children)};return FU!==void 0?Gr.createElement(FU.Consumer,null,r=>e(r)):e(TW)}function IW(t){return SW({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(t)}function CW(t){return SW({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(t)}const gge=()=>{const t=Km(),[e,r]=Y.useState(!1),[s,c]=Y.useState(""),d={email:"",password:""},_=WO({email:iy().email("Invalid email address").required("Required"),password:iy().required("Required")}),x=(M,{setSubmitting:D})=>{c(""),age(M.email,M.password).then(L=>{const G=L.user;console.log("User signed in:",G.uid),t("/home")}).catch(L=>{console.error("Error signing in:",L),c("Incorrect username or password")}).finally(()=>{D(!1)})},a=()=>{r(!e)},I=async()=>{try{await oge()&&t("/home")}catch(M){console.error("Error signing in with Google:",M),c("Error signing in with Google")}};return F.jsxs("section",{className:"login-container",children:[F.jsxs("div",{className:"login-form-container",children:[F.jsx("h1",{children:"Login"}),F.jsxs("p",{className:"linktoregister",children:["Not a user? ",F.jsx(RI,{to:"/register",className:"gotoregister",style:{color:"rgb(10,145,255)"},children:"Create an account here"})]}),F.jsx(S7,{initialValues:d,validationSchema:_,onSubmit:x,children:({isSubmitting:M,errors:D,touched:L})=>F.jsxs(jO,{className:"login-form",children:[F.jsx(C1,{type:"email",name:"email",placeholder:"Email Address"}),F.jsxs("div",{className:"password-container",children:[F.jsx(C1,{type:e?"text":"password",name:"password",placeholder:"Password"}),F.jsx("span",{className:"password-toggle",onClick:a,role:"button","aria-label":"Toggle password visibility",children:e?F.jsx(IW,{}):F.jsx(CW,{})})]}),F.jsx("div",{className:"error-container",children:D.email&&L.email||D.password&&L.password?F.jsx("div",{className:"error-message",children:D.email||D.password}):s?F.jsx("div",{className:"error-message",children:s}):null}),F.jsxs("div",{className:"buttons",children:[F.jsx("button",{className:"google-login-btn",onClick:I,type:"button",children:F.jsx("img",{src:"/google-logo.png",alt:"Google",className:"google-logo"})}),F.jsx("button",{className:"loginbtn",type:"submit",disabled:M,children:"Login"})]})]})})]}),F.jsxs("div",{className:"blue-rectangle",children:[F.jsx("img",{className:"questsimg",src:"/Questslogo white.png",alt:"Quests logo"}),F.jsx("h3",{children:"Welcome Back!"}),F.jsx("p",{children:"We're glad to see you again. Log in to continue where you left off."})]})]})},_ge=()=>{const t=Km(),[e,r]=Y.useState(!1),[s,c]=Y.useState(""),d={name:"",email:"",password:""},_=WO({name:iy().required("Name required"),email:iy().email("Invalid email address").required("Email required"),password:iy().min(6,"Password must be at least 6 characters").required("Password required")}),x=async(I,{setSubmitting:M,setErrors:D})=>{try{c("");const L=await ige(I.email,I.password,I.name);if(!L||!L.user)throw new Error("Failed to sign up");const G=L.user;console.log("User signed up successfully:",G);const Q=await n5();await wm(Xn(wn,"users",G.uid),{name:I.name,email:I.email,profilePhoto:Q,bio:"",isActive:!0}),console.log("User data added to Firestore"),t("/login")}catch(L){console.error("Error signing up:",L),c("Failed to sign up. Please check your details and try again.")}finally{M(!1)}},a=async()=>{try{c("");const I=await sge();console.log("Google user signed up:",I),t("/login")}catch(I){console.error("Error signing up with Google:",I),c("Error signing up with Google")}};return F.jsxs("section",{className:"register-container",children:[F.jsxs("div",{className:"register-form-container",children:[F.jsx("h2",{className:"createacc",children:"Create New Account"}),F.jsxs("p",{className:"aauser",children:["Already a user? ",F.jsx(RI,{to:"/login",style:{color:"rgb(10,145,255)"},children:"Login here."})]}),F.jsx(S7,{initialValues:d,validationSchema:_,onSubmit:x,children:({isSubmitting:I,errors:M,touched:D})=>F.jsxs(jO,{className:"register-form",children:[F.jsx(C1,{className:"username",type:"text",name:"name",placeholder:"Name"}),F.jsx(C1,{type:"email",name:"email",placeholder:"Email"}),F.jsxs("div",{className:"password-container",children:[F.jsx(C1,{type:e?"text":"password",name:"password",placeholder:"Password"}),F.jsx("div",{className:"password-toggle",onClick:()=>r(!e),role:"button","aria-label":"Toggle password visibility",children:e?F.jsx(IW,{}):F.jsx(CW,{})})]}),F.jsx("div",{className:"error-container",children:M.name&&D.name||M.email&&D.email||M.password&&D.password?F.jsx("div",{className:"error-message",children:M.name||M.email||M.password}):s?F.jsx("div",{className:"error-message",children:s}):null}),F.jsxs("div",{className:"button-container",children:[F.jsx("button",{className:"google-register-btn",onClick:a,type:"button",children:F.jsx("img",{src:"/google-logo.png",alt:"Google",className:"google-logo"})}),F.jsx("button",{className:"register-btn",type:"submit",disabled:I,children:"Register"})]})]})})]}),F.jsxs("div",{className:"blue-rectangle",children:[F.jsx("img",{className:"questsimg",src:"/Questslogo white.png",alt:"Quests logo"}),F.jsx("h3",{children:"Welcome!"}),F.jsx("p",{children:"Join our community today and unlock a world of possibilities. Connect, share, and grow with us!"})]})]})},Ex={black:"#000",white:"#fff"},v_={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},x_={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},b_={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},w_={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},T_={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},$v={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},yge={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function Qh(t){let e="https://mui.com/production-error/?code="+t;for(let r=1;r<arguments.length;r+=1)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified MUI error #"+t+"; visit "+e+" for the full message."}const bC="$$material";function NS(){return NS=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)({}).hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},NS.apply(null,arguments)}function AW(t){var e=Object.create(null);return function(r){return e[r]===void 0&&(e[r]=t(r)),e[r]}}var vge=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,xge=AW(function(t){return vge.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91}),bge=!1;function wge(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function Tge(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var Ege=function(){function t(r){var s=this;this._insertTag=function(c){var d;s.tags.length===0?s.insertionPoint?d=s.insertionPoint.nextSibling:s.prepend?d=s.container.firstChild:d=s.before:d=s.tags[s.tags.length-1].nextSibling,s.container.insertBefore(c,d),s.tags.push(c)},this.isSpeedy=r.speedy===void 0?!bge:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(s){s.forEach(this._insertTag)},e.insert=function(s){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Tge(this));var c=this.tags[this.tags.length-1];if(this.isSpeedy){var d=wge(c);try{d.insertRule(s,d.cssRules.length)}catch{}}else c.appendChild(document.createTextNode(s));this.ctr++},e.flush=function(){this.tags.forEach(function(s){var c;return(c=s.parentNode)==null?void 0:c.removeChild(s)}),this.tags=[],this.ctr=0},t}(),Wo="-ms-",FS="-moz-",hi="-webkit-",PW="comm",r5="rule",i5="decl",Sge="@import",RW="@keyframes",Ige="@layer",Cge=Math.abs,wC=String.fromCharCode,Age=Object.assign;function Pge(t,e){return Ao(t,0)^45?(((e<<2^Ao(t,0))<<2^Ao(t,1))<<2^Ao(t,2))<<2^Ao(t,3):0}function MW(t){return t.trim()}function Rge(t,e){return(t=e.exec(t))?t[0]:t}function di(t,e,r){return t.replace(e,r)}function Pk(t,e){return t.indexOf(e)}function Ao(t,e){return t.charCodeAt(e)|0}function Sx(t,e,r){return t.slice(e,r)}function Su(t){return t.length}function s5(t){return t.length}function qT(t,e){return e.push(t),t}function Mge(t,e){return t.map(e).join("")}var TC=1,Ly=1,kW=0,qa=0,Xs=0,i0="";function EC(t,e,r,s,c,d,_){return{value:t,root:e,parent:r,type:s,props:c,children:d,line:TC,column:Ly,length:_,return:""}}function qv(t,e){return Age(EC("",null,null,"",null,null,0),t,{length:-t.length},e)}function kge(){return Xs}function Oge(){return Xs=qa>0?Ao(i0,--qa):0,Ly--,Xs===10&&(Ly=1,TC--),Xs}function pl(){return Xs=qa<kW?Ao(i0,qa++):0,Ly++,Xs===10&&(Ly=1,TC++),Xs}function ju(){return Ao(i0,qa)}function IE(){return qa}function ub(t,e){return Sx(i0,t,e)}function Ix(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function OW(t){return TC=Ly=1,kW=Su(i0=t),qa=0,[]}function DW(t){return i0="",t}function CE(t){return MW(ub(qa-1,Rk(t===91?t+2:t===40?t+1:t)))}function Dge(t){for(;(Xs=ju())&&Xs<33;)pl();return Ix(t)>2||Ix(Xs)>3?"":" "}function Lge(t,e){for(;--e&&pl()&&!(Xs<48||Xs>102||Xs>57&&Xs<65||Xs>70&&Xs<97););return ub(t,IE()+(e<6&&ju()==32&&pl()==32))}function Rk(t){for(;pl();)switch(Xs){case t:return qa;case 34:case 39:t!==34&&t!==39&&Rk(Xs);break;case 40:t===41&&Rk(t);break;case 92:pl();break}return qa}function zge(t,e){for(;pl()&&t+Xs!==57;)if(t+Xs===84&&ju()===47)break;return"/*"+ub(e,qa-1)+"*"+wC(t===47?t:pl())}function Nge(t){for(;!Ix(ju());)pl();return ub(t,qa)}function Fge(t){return DW(AE("",null,null,null,[""],t=OW(t),0,[0],t))}function AE(t,e,r,s,c,d,_,x,a){for(var I=0,M=0,D=_,L=0,G=0,Q=0,re=1,ee=1,U=1,H=0,Z="",de=c,ve=d,Ee=s,ie=Z;ee;)switch(Q=H,H=pl()){case 40:if(Q!=108&&Ao(ie,D-1)==58){Pk(ie+=di(CE(H),"&","&\f"),"&\f")!=-1&&(U=-1);break}case 34:case 39:case 91:ie+=CE(H);break;case 9:case 10:case 13:case 32:ie+=Dge(Q);break;case 92:ie+=Lge(IE()-1,7);continue;case 47:switch(ju()){case 42:case 47:qT(Bge(zge(pl(),IE()),e,r),a);break;default:ie+="/"}break;case 123*re:x[I++]=Su(ie)*U;case 125*re:case 59:case 0:switch(H){case 0:case 125:ee=0;case 59+M:U==-1&&(ie=di(ie,/\f/g,"")),G>0&&Su(ie)-D&&qT(G>32?UU(ie+";",s,r,D-1):UU(di(ie," ","")+";",s,r,D-2),a);break;case 59:ie+=";";default:if(qT(Ee=jU(ie,e,r,I,M,c,x,Z,de=[],ve=[],D),d),H===123)if(M===0)AE(ie,e,Ee,Ee,de,d,D,x,ve);else switch(L===99&&Ao(ie,3)===110?100:L){case 100:case 108:case 109:case 115:AE(t,Ee,Ee,s&&qT(jU(t,Ee,Ee,0,0,c,x,Z,c,de=[],D),ve),c,ve,D,x,s?de:ve);break;default:AE(ie,Ee,Ee,Ee,[""],ve,0,x,ve)}}I=M=G=0,re=U=1,Z=ie="",D=_;break;case 58:D=1+Su(ie),G=Q;default:if(re<1){if(H==123)--re;else if(H==125&&re++==0&&Oge()==125)continue}switch(ie+=wC(H),H*re){case 38:U=M>0?1:(ie+="\f",-1);break;case 44:x[I++]=(Su(ie)-1)*U,U=1;break;case 64:ju()===45&&(ie+=CE(pl())),L=ju(),M=D=Su(Z=ie+=Nge(IE())),H++;break;case 45:Q===45&&Su(ie)==2&&(re=0)}}return d}function jU(t,e,r,s,c,d,_,x,a,I,M){for(var D=c-1,L=c===0?d:[""],G=s5(L),Q=0,re=0,ee=0;Q<s;++Q)for(var U=0,H=Sx(t,D+1,D=Cge(re=_[Q])),Z=t;U<G;++U)(Z=MW(re>0?L[U]+" "+H:di(H,/&\f/g,L[U])))&&(a[ee++]=Z);return EC(t,e,r,c===0?r5:x,a,I,M)}function Bge(t,e,r){return EC(t,e,r,PW,wC(kge()),Sx(t,2,-2),0)}function UU(t,e,r,s){return EC(t,e,r,i5,Sx(t,0,s),Sx(t,s+1,-1),s)}function hy(t,e){for(var r="",s=s5(t),c=0;c<s;c++)r+=e(t[c],c,t,e)||"";return r}function jge(t,e,r,s){switch(t.type){case Ige:if(t.children.length)break;case Sge:case i5:return t.return=t.return||t.value;case PW:return"";case RW:return t.return=t.value+"{"+hy(t.children,s)+"}";case r5:t.value=t.props.join(",")}return Su(r=hy(t.children,s))?t.return=t.value+"{"+r+"}":""}function Uge(t){var e=s5(t);return function(r,s,c,d){for(var _="",x=0;x<e;x++)_+=t[x](r,s,c,d)||"";return _}}function Vge(t){return function(e){e.root||(e=e.return)&&t(e)}}var $ge=function(e,r,s){for(var c=0,d=0;c=d,d=ju(),c===38&&d===12&&(r[s]=1),!Ix(d);)pl();return ub(e,qa)},qge=function(e,r){var s=-1,c=44;do switch(Ix(c)){case 0:c===38&&ju()===12&&(r[s]=1),e[s]+=$ge(qa-1,r,s);break;case 2:e[s]+=CE(c);break;case 4:if(c===44){e[++s]=ju()===58?"&\f":"",r[s]=e[s].length;break}default:e[s]+=wC(c)}while(c=pl());return e},Gge=function(e,r){return DW(qge(OW(e),r))},VU=new WeakMap,Wge=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var r=e.value,s=e.parent,c=e.column===s.column&&e.line===s.line;s.type!=="rule";)if(s=s.parent,!s)return;if(!(e.props.length===1&&r.charCodeAt(0)!==58&&!VU.get(s))&&!c){VU.set(e,!0);for(var d=[],_=Gge(r,d),x=s.props,a=0,I=0;a<_.length;a++)for(var M=0;M<x.length;M++,I++)e.props[I]=d[a]?_[a].replace(/&\f/g,x[M]):x[M]+" "+_[a]}}},Hge=function(e){if(e.type==="decl"){var r=e.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(e.return="",e.value="")}};function LW(t,e){switch(Pge(t,e)){case 5103:return hi+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return hi+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return hi+t+FS+t+Wo+t+t;case 6828:case 4268:return hi+t+Wo+t+t;case 6165:return hi+t+Wo+"flex-"+t+t;case 5187:return hi+t+di(t,/(\w+).+(:[^]+)/,hi+"box-$1$2"+Wo+"flex-$1$2")+t;case 5443:return hi+t+Wo+"flex-item-"+di(t,/flex-|-self/,"")+t;case 4675:return hi+t+Wo+"flex-line-pack"+di(t,/align-content|flex-|-self/,"")+t;case 5548:return hi+t+Wo+di(t,"shrink","negative")+t;case 5292:return hi+t+Wo+di(t,"basis","preferred-size")+t;case 6060:return hi+"box-"+di(t,"-grow","")+hi+t+Wo+di(t,"grow","positive")+t;case 4554:return hi+di(t,/([^-])(transform)/g,"$1"+hi+"$2")+t;case 6187:return di(di(di(t,/(zoom-|grab)/,hi+"$1"),/(image-set)/,hi+"$1"),t,"")+t;case 5495:case 3959:return di(t,/(image-set\([^]*)/,hi+"$1$`$1");case 4968:return di(di(t,/(.+:)(flex-)?(.*)/,hi+"box-pack:$3"+Wo+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+hi+t+t;case 4095:case 3583:case 4068:case 2532:return di(t,/(.+)-inline(.+)/,hi+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Su(t)-1-e>6)switch(Ao(t,e+1)){case 109:if(Ao(t,e+4)!==45)break;case 102:return di(t,/(.+:)(.+)-([^]+)/,"$1"+hi+"$2-$3$1"+FS+(Ao(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~Pk(t,"stretch")?LW(di(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(Ao(t,e+1)!==115)break;case 6444:switch(Ao(t,Su(t)-3-(~Pk(t,"!important")&&10))){case 107:return di(t,":",":"+hi)+t;case 101:return di(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+hi+(Ao(t,14)===45?"inline-":"")+"box$3$1"+hi+"$2$3$1"+Wo+"$2box$3")+t}break;case 5936:switch(Ao(t,e+11)){case 114:return hi+t+Wo+di(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return hi+t+Wo+di(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return hi+t+Wo+di(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return hi+t+Wo+t+t}return t}var Zge=function(e,r,s,c){if(e.length>-1&&!e.return)switch(e.type){case i5:e.return=LW(e.value,e.length);break;case RW:return hy([qv(e,{value:di(e.value,"@","@"+hi)})],c);case r5:if(e.length)return Mge(e.props,function(d){switch(Rge(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return hy([qv(e,{props:[di(d,/:(read-\w+)/,":"+FS+"$1")]})],c);case"::placeholder":return hy([qv(e,{props:[di(d,/:(plac\w+)/,":"+hi+"input-$1")]}),qv(e,{props:[di(d,/:(plac\w+)/,":"+FS+"$1")]}),qv(e,{props:[di(d,/:(plac\w+)/,Wo+"input-$1")]})],c)}return""})}},Xge=[Zge],Kge=function(e){var r=e.key;if(r==="css"){var s=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(s,function(re){var ee=re.getAttribute("data-emotion");ee.indexOf(" ")!==-1&&(document.head.appendChild(re),re.setAttribute("data-s",""))})}var c=e.stylisPlugins||Xge,d={},_,x=[];_=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(re){for(var ee=re.getAttribute("data-emotion").split(" "),U=1;U<ee.length;U++)d[ee[U]]=!0;x.push(re)});var a,I=[Wge,Hge];{var M,D=[jge,Vge(function(re){M.insert(re)})],L=Uge(I.concat(c,D)),G=function(ee){return hy(Fge(ee),L)};a=function(ee,U,H,Z){M=H,G(ee?ee+"{"+U.styles+"}":U.styles),Z&&(Q.inserted[U.name]=!0)}}var Q={key:r,sheet:new Ege({key:r,container:_,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:d,registered:{},insert:a};return Q.sheet.hydrate(x),Q},Qge=!0;function Yge(t,e,r){var s="";return r.split(" ").forEach(function(c){t[c]!==void 0?e.push(t[c]+";"):s+=c+" "}),s}var zW=function(e,r,s){var c=e.key+"-"+r.name;(s===!1||Qge===!1)&&e.registered[c]===void 0&&(e.registered[c]=r.styles)},NW=function(e,r,s){zW(e,r,s);var c=e.key+"-"+r.name;if(e.inserted[r.name]===void 0){var d=r;do e.insert(r===d?"."+c:"",d,e.sheet,!0),d=d.next;while(d!==void 0)}};function Jge(t){for(var e=0,r,s=0,c=t.length;c>=4;++s,c-=4)r=t.charCodeAt(s)&255|(t.charCodeAt(++s)&255)<<8|(t.charCodeAt(++s)&255)<<16|(t.charCodeAt(++s)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,e=(r&65535)*1540483477+((r>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(c){case 3:e^=(t.charCodeAt(s+2)&255)<<16;case 2:e^=(t.charCodeAt(s+1)&255)<<8;case 1:e^=t.charCodeAt(s)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var e_e={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},t_e=!1,n_e=/[A-Z]|^ms/g,r_e=/_EMO_([^_]+?)_([^]*?)_EMO_/g,FW=function(e){return e.charCodeAt(1)===45},$U=function(e){return e!=null&&typeof e!="boolean"},xR=AW(function(t){return FW(t)?t:t.replace(n_e,"-$&").toLowerCase()}),qU=function(e,r){switch(e){case"animation":case"animationName":if(typeof r=="string")return r.replace(r_e,function(s,c,d){return Iu={name:c,styles:d,next:Iu},c})}return e_e[e]!==1&&!FW(e)&&typeof r=="number"&&r!==0?r+"px":r},i_e="Component selectors can only be used in conjunction with @emotion/babel-plugin, the swc Emotion plugin, or another Emotion-aware compiler transform.";function Cx(t,e,r){if(r==null)return"";var s=r;if(s.__emotion_styles!==void 0)return s;switch(typeof r){case"boolean":return"";case"object":{var c=r;if(c.anim===1)return Iu={name:c.name,styles:c.styles,next:Iu},c.name;var d=r;if(d.styles!==void 0){var _=d.next;if(_!==void 0)for(;_!==void 0;)Iu={name:_.name,styles:_.styles,next:Iu},_=_.next;var x=d.styles+";";return x}return s_e(t,e,r)}case"function":{if(t!==void 0){var a=Iu,I=r(t);return Iu=a,Cx(t,e,I)}break}}var M=r;if(e==null)return M;var D=e[M];return D!==void 0?D:M}function s_e(t,e,r){var s="";if(Array.isArray(r))for(var c=0;c<r.length;c++)s+=Cx(t,e,r[c])+";";else for(var d in r){var _=r[d];if(typeof _!="object"){var x=_;e!=null&&e[x]!==void 0?s+=d+"{"+e[x]+"}":$U(x)&&(s+=xR(d)+":"+qU(d,x)+";")}else{if(d==="NO_COMPONENT_SELECTOR"&&t_e)throw new Error(i_e);if(Array.isArray(_)&&typeof _[0]=="string"&&(e==null||e[_[0]]===void 0))for(var a=0;a<_.length;a++)$U(_[a])&&(s+=xR(d)+":"+qU(d,_[a])+";");else{var I=Cx(t,e,_);switch(d){case"animation":case"animationName":{s+=xR(d)+":"+I+";";break}default:s+=d+"{"+I+"}"}}}}return s}var GU=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Iu;function o5(t,e,r){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var s=!0,c="";Iu=void 0;var d=t[0];if(d==null||d.raw===void 0)s=!1,c+=Cx(r,e,d);else{var _=d;c+=_[0]}for(var x=1;x<t.length;x++)if(c+=Cx(r,e,t[x]),s){var a=d;c+=a[x]}GU.lastIndex=0;for(var I="",M;(M=GU.exec(c))!==null;)I+="-"+M[1];var D=Jge(c)+I;return{name:D,styles:c,next:Iu}}var o_e=function(e){return e()},BW=jE.useInsertionEffect?jE.useInsertionEffect:!1,a_e=BW||o_e,WU=BW||Y.useLayoutEffect,jW=Y.createContext(typeof HTMLElement<"u"?Kge({key:"css"}):null);jW.Provider;var UW=function(e){return Y.forwardRef(function(r,s){var c=Y.useContext(jW);return e(r,c,s)})},a5=Y.createContext({}),l_e=UW(function(t,e){var r=t.styles,s=o5([r],void 0,Y.useContext(a5)),c=Y.useRef();return WU(function(){var d=e.key+"-global",_=new e.sheet.constructor({key:d,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),x=!1,a=document.querySelector('style[data-emotion="'+d+" "+s.name+'"]');return e.sheet.tags.length&&(_.before=e.sheet.tags[0]),a!==null&&(x=!0,a.setAttribute("data-emotion",d),_.hydrate([a])),c.current=[_,x],function(){_.flush()}},[e]),WU(function(){var d=c.current,_=d[0],x=d[1];if(x){d[1]=!1;return}if(s.next!==void 0&&NW(e,s.next,!0),_.tags.length){var a=_.tags[_.tags.length-1].nextElementSibling;_.before=a,_.flush()}e.insert("",s,_,!1)},[e,s.name]),null});function c_e(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return o5(e)}var l5=function(){var e=c_e.apply(void 0,arguments),r="animation-"+e.name;return{name:r,styles:"@keyframes "+r+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},u_e=xge,h_e=function(e){return e!=="theme"},HU=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?u_e:h_e},ZU=function(e,r,s){var c;if(r){var d=r.shouldForwardProp;c=e.__emotion_forwardProp&&d?function(_){return e.__emotion_forwardProp(_)&&d(_)}:d}return typeof c!="function"&&s&&(c=e.__emotion_forwardProp),c},d_e=!1,f_e=function(e){var r=e.cache,s=e.serialized,c=e.isStringTag;return zW(r,s,c),a_e(function(){return NW(r,s,c)}),null},p_e=function t(e,r){var s=e.__emotion_real===e,c=s&&e.__emotion_base||e,d,_;r!==void 0&&(d=r.label,_=r.target);var x=ZU(e,r,s),a=x||HU(c),I=!a("as");return function(){var M=arguments,D=s&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(d!==void 0&&D.push("label:"+d+";"),M[0]==null||M[0].raw===void 0)D.push.apply(D,M);else{D.push(M[0][0]);for(var L=M.length,G=1;G<L;G++)D.push(M[G],M[0][G])}var Q=UW(function(re,ee,U){var H=I&&re.as||c,Z="",de=[],ve=re;if(re.theme==null){ve={};for(var Ee in re)ve[Ee]=re[Ee];ve.theme=Y.useContext(a5)}typeof re.className=="string"?Z=Yge(ee.registered,de,re.className):re.className!=null&&(Z=re.className+" ");var ie=o5(D.concat(de),ee.registered,ve);Z+=ee.key+"-"+ie.name,_!==void 0&&(Z+=" "+_);var ue=I&&x===void 0?HU(H):a,K={};for(var ge in re)I&&ge==="as"||ue(ge)&&(K[ge]=re[ge]);return K.className=Z,U&&(K.ref=U),Y.createElement(Y.Fragment,null,Y.createElement(f_e,{cache:ee,serialized:ie,isStringTag:typeof H=="string"}),Y.createElement(H,K))});return Q.displayName=d!==void 0?d:"Styled("+(typeof c=="string"?c:c.displayName||c.name||"Component")+")",Q.defaultProps=e.defaultProps,Q.__emotion_real=Q,Q.__emotion_base=c,Q.__emotion_styles=D,Q.__emotion_forwardProp=x,Object.defineProperty(Q,"toString",{value:function(){return _===void 0&&d_e?"NO_COMPONENT_SELECTOR":"."+_}}),Q.withComponent=function(re,ee){return t(re,NS({},r,ee,{shouldForwardProp:ZU(Q,ee,!0)})).apply(void 0,D)},Q}},m_e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Mk=p_e.bind();m_e.forEach(function(t){Mk[t]=Mk(t)});var VW={exports:{}},g_e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",__e=g_e,y_e=__e;function $W(){}function qW(){}qW.resetWarningCache=$W;var v_e=function(){function t(s,c,d,_,x,a){if(a!==y_e){var I=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw I.name="Invariant Violation",I}}t.isRequired=t;function e(){return t}var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:qW,resetWarningCache:$W};return r.PropTypes=r,r};VW.exports=v_e();var x_e=VW.exports;const qr=Gy(x_e);function b_e(t){return t==null||Object.keys(t).length===0}function w_e(t){const{styles:e,defaultTheme:r={}}=t,s=typeof e=="function"?c=>e(b_e(c)?r:c):e;return F.jsx(l_e,{styles:s})}/**
 * @mui/styled-engine v6.0.2
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function T_e(t,e){return Mk(t,e)}const E_e=(t,e)=>{Array.isArray(t.__emotion_styles)&&(t.__emotion_styles=e(t.__emotion_styles))};function Mu(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function GW(t){if(!Mu(t))return t;const e={};return Object.keys(t).forEach(r=>{e[r]=GW(t[r])}),e}function Qo(t,e,r={clone:!0}){const s=r.clone?{...t}:t;return Mu(t)&&Mu(e)&&Object.keys(e).forEach(c=>{Mu(e[c])&&Object.prototype.hasOwnProperty.call(t,c)&&Mu(t[c])?s[c]=Qo(t[c],e[c],r):r.clone?s[c]=Mu(e[c])?GW(e[c]):e[c]:s[c]=e[c]}),s}const S_e=t=>{const e=Object.keys(t).map(r=>({key:r,val:t[r]}))||[];return e.sort((r,s)=>r.val-s.val),e.reduce((r,s)=>({...r,[s.key]:s.val}),{})};function I_e(t){const{values:e={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:r="px",step:s=5,...c}=t,d=S_e(e),_=Object.keys(d);function x(L){return`@media (min-width:${typeof e[L]=="number"?e[L]:L}${r})`}function a(L){return`@media (max-width:${(typeof e[L]=="number"?e[L]:L)-s/100}${r})`}function I(L,G){const Q=_.indexOf(G);return`@media (min-width:${typeof e[L]=="number"?e[L]:L}${r}) and (max-width:${(Q!==-1&&typeof e[_[Q]]=="number"?e[_[Q]]:G)-s/100}${r})`}function M(L){return _.indexOf(L)+1<_.length?I(L,_[_.indexOf(L)+1]):x(L)}function D(L){const G=_.indexOf(L);return G===0?x(_[1]):G===_.length-1?a(_[G]):I(L,_[_.indexOf(L)+1]).replace("@media","@media not all and")}return{keys:_,values:d,up:x,down:a,between:I,only:M,not:D,unit:r,...c}}function C_e(t,e){if(!t.containerQueries)return e;const r=Object.keys(e).filter(s=>s.startsWith("@container")).sort((s,c)=>{var _,x;const d=/min-width:\s*([0-9.]+)/;return+(((_=s.match(d))==null?void 0:_[1])||0)-+(((x=c.match(d))==null?void 0:x[1])||0)});return r.length?r.reduce((s,c)=>{const d=e[c];return delete s[c],s[c]=d,s},{...e}):e}function A_e(t,e){return e==="@"||e.startsWith("@")&&(t.some(r=>e.startsWith(`@${r}`))||!!e.match(/^@\d/))}function P_e(t,e){const r=e.match(/^@([^/]+)?\/?(.+)?$/);if(!r)return null;const[,s,c]=r,d=Number.isNaN(+s)?s||0:+s;return t.containerQueries(c).up(d)}function R_e(t){const e=(d,_)=>d.replace("@media",_?`@container ${_}`:"@container");function r(d,_){d.up=(...x)=>e(t.breakpoints.up(...x),_),d.down=(...x)=>e(t.breakpoints.down(...x),_),d.between=(...x)=>e(t.breakpoints.between(...x),_),d.only=(...x)=>e(t.breakpoints.only(...x),_),d.not=(...x)=>{const a=e(t.breakpoints.not(...x),_);return a.includes("not all and")?a.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):a}}const s={},c=d=>(r(s,d),s);return r(c),{...t,containerQueries:c}}const M_e={borderRadius:4};function L1(t,e){return e?Qo(t,e,{clone:!1}):t}const SC={xs:0,sm:600,md:900,lg:1200,xl:1536},XU={keys:["xs","sm","md","lg","xl"],up:t=>`@media (min-width:${SC[t]}px)`},k_e={containerQueries:t=>({up:e=>{let r=typeof e=="number"?e:SC[e]||e;return typeof r=="number"&&(r=`${r}px`),t?`@container ${t} (min-width:${r})`:`@container (min-width:${r})`}})};function Yh(t,e,r){const s=t.theme||{};if(Array.isArray(e)){const d=s.breakpoints||XU;return e.reduce((_,x,a)=>(_[d.up(d.keys[a])]=r(e[a]),_),{})}if(typeof e=="object"){const d=s.breakpoints||XU;return Object.keys(e).reduce((_,x)=>{if(A_e(d.keys,x)){const a=P_e(s.containerQueries?s:k_e,x);a&&(_[a]=r(e[x],x))}else if(Object.keys(d.values||SC).includes(x)){const a=d.up(x);_[a]=r(e[x],x)}else{const a=x;_[a]=e[a]}return _},{})}return r(e)}function O_e(t={}){var r;return((r=t.keys)==null?void 0:r.reduce((s,c)=>{const d=t.up(c);return s[d]={},s},{}))||{}}function D_e(t,e){return t.reduce((r,s)=>{const c=r[s];return(!c||Object.keys(c).length===0)&&delete r[s],r},e)}function Kn(t){if(typeof t!="string")throw new Error(Qh(7));return t.charAt(0).toUpperCase()+t.slice(1)}function IC(t,e,r=!0){if(!e||typeof e!="string")return null;if(t&&t.vars&&r){const s=`vars.${e}`.split(".").reduce((c,d)=>c&&c[d]?c[d]:null,t);if(s!=null)return s}return e.split(".").reduce((s,c)=>s&&s[c]!=null?s[c]:null,t)}function BS(t,e,r,s=r){let c;return typeof t=="function"?c=t(r):Array.isArray(t)?c=t[r]||s:c=IC(t,r)||s,e&&(c=e(c,s,t)),c}function Vs(t){const{prop:e,cssProperty:r=t.prop,themeKey:s,transform:c}=t,d=_=>{if(_[e]==null)return null;const x=_[e],a=_.theme,I=IC(a,s)||{};return Yh(_,x,D=>{let L=BS(I,c,D);return D===L&&typeof D=="string"&&(L=BS(I,c,`${e}${D==="default"?"":Kn(D)}`,D)),r===!1?L:{[r]:L}})};return d.propTypes={},d.filterProps=[e],d}function L_e(t){const e={};return r=>(e[r]===void 0&&(e[r]=t(r)),e[r])}const z_e={m:"margin",p:"padding"},N_e={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},KU={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},F_e=L_e(t=>{if(t.length>2)if(KU[t])t=KU[t];else return[t];const[e,r]=t.split(""),s=z_e[e],c=N_e[r]||"";return Array.isArray(c)?c.map(d=>s+d):[s+c]}),c5=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],u5=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...c5,...u5];function hb(t,e,r,s){const c=IC(t,e,!0)??r;return typeof c=="number"||typeof c=="string"?d=>typeof d=="string"?d:typeof c=="string"?`calc(${d} * ${c})`:c*d:Array.isArray(c)?d=>{if(typeof d=="string")return d;const _=Math.abs(d),x=c[_];return d>=0?x:typeof x=="number"?-x:`-${x}`}:typeof c=="function"?c:()=>{}}function h5(t){return hb(t,"spacing",8)}function db(t,e){return typeof e=="string"||e==null?e:t(e)}function B_e(t,e){return r=>t.reduce((s,c)=>(s[c]=db(e,r),s),{})}function j_e(t,e,r,s){if(!e.includes(r))return null;const c=F_e(r),d=B_e(c,s),_=t[r];return Yh(t,_,d)}function WW(t,e){const r=h5(t.theme);return Object.keys(t).map(s=>j_e(t,e,s,r)).reduce(L1,{})}function Rs(t){return WW(t,c5)}Rs.propTypes={};Rs.filterProps=c5;function Ms(t){return WW(t,u5)}Ms.propTypes={};Ms.filterProps=u5;function HW(t=8,e=h5({spacing:t})){if(t.mui)return t;const r=(...s)=>(s.length===0?[1]:s).map(d=>{const _=e(d);return typeof _=="number"?`${_}px`:_}).join(" ");return r.mui=!0,r}function CC(...t){const e=t.reduce((s,c)=>(c.filterProps.forEach(d=>{s[d]=c}),s),{}),r=s=>Object.keys(s).reduce((c,d)=>e[d]?L1(c,e[d](s)):c,{});return r.propTypes={},r.filterProps=t.reduce((s,c)=>s.concat(c.filterProps),[]),r}function Ul(t){return typeof t!="number"?t:`${t}px solid`}function Jl(t,e){return Vs({prop:t,themeKey:"borders",transform:e})}const U_e=Jl("border",Ul),V_e=Jl("borderTop",Ul),$_e=Jl("borderRight",Ul),q_e=Jl("borderBottom",Ul),G_e=Jl("borderLeft",Ul),W_e=Jl("borderColor"),H_e=Jl("borderTopColor"),Z_e=Jl("borderRightColor"),X_e=Jl("borderBottomColor"),K_e=Jl("borderLeftColor"),Q_e=Jl("outline",Ul),Y_e=Jl("outlineColor"),AC=t=>{if(t.borderRadius!==void 0&&t.borderRadius!==null){const e=hb(t.theme,"shape.borderRadius",4),r=s=>({borderRadius:db(e,s)});return Yh(t,t.borderRadius,r)}return null};AC.propTypes={};AC.filterProps=["borderRadius"];CC(U_e,V_e,$_e,q_e,G_e,W_e,H_e,Z_e,X_e,K_e,AC,Q_e,Y_e);const PC=t=>{if(t.gap!==void 0&&t.gap!==null){const e=hb(t.theme,"spacing",8),r=s=>({gap:db(e,s)});return Yh(t,t.gap,r)}return null};PC.propTypes={};PC.filterProps=["gap"];const RC=t=>{if(t.columnGap!==void 0&&t.columnGap!==null){const e=hb(t.theme,"spacing",8),r=s=>({columnGap:db(e,s)});return Yh(t,t.columnGap,r)}return null};RC.propTypes={};RC.filterProps=["columnGap"];const MC=t=>{if(t.rowGap!==void 0&&t.rowGap!==null){const e=hb(t.theme,"spacing",8),r=s=>({rowGap:db(e,s)});return Yh(t,t.rowGap,r)}return null};MC.propTypes={};MC.filterProps=["rowGap"];const J_e=Vs({prop:"gridColumn"}),eye=Vs({prop:"gridRow"}),tye=Vs({prop:"gridAutoFlow"}),nye=Vs({prop:"gridAutoColumns"}),rye=Vs({prop:"gridAutoRows"}),iye=Vs({prop:"gridTemplateColumns"}),sye=Vs({prop:"gridTemplateRows"}),oye=Vs({prop:"gridTemplateAreas"}),aye=Vs({prop:"gridArea"});CC(PC,RC,MC,J_e,eye,tye,nye,rye,iye,sye,oye,aye);function dy(t,e){return e==="grey"?e:t}const lye=Vs({prop:"color",themeKey:"palette",transform:dy}),cye=Vs({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:dy}),uye=Vs({prop:"backgroundColor",themeKey:"palette",transform:dy});CC(lye,cye,uye);function ol(t){return t<=1&&t!==0?`${t*100}%`:t}const hye=Vs({prop:"width",transform:ol}),d5=t=>{if(t.maxWidth!==void 0&&t.maxWidth!==null){const e=r=>{var c,d,_,x,a;const s=((_=(d=(c=t.theme)==null?void 0:c.breakpoints)==null?void 0:d.values)==null?void 0:_[r])||SC[r];return s?((a=(x=t.theme)==null?void 0:x.breakpoints)==null?void 0:a.unit)!=="px"?{maxWidth:`${s}${t.theme.breakpoints.unit}`}:{maxWidth:s}:{maxWidth:ol(r)}};return Yh(t,t.maxWidth,e)}return null};d5.filterProps=["maxWidth"];const dye=Vs({prop:"minWidth",transform:ol}),fye=Vs({prop:"height",transform:ol}),pye=Vs({prop:"maxHeight",transform:ol}),mye=Vs({prop:"minHeight",transform:ol});Vs({prop:"size",cssProperty:"width",transform:ol});Vs({prop:"size",cssProperty:"height",transform:ol});const gye=Vs({prop:"boxSizing"});CC(hye,d5,dye,fye,pye,mye,gye);const fb={border:{themeKey:"borders",transform:Ul},borderTop:{themeKey:"borders",transform:Ul},borderRight:{themeKey:"borders",transform:Ul},borderBottom:{themeKey:"borders",transform:Ul},borderLeft:{themeKey:"borders",transform:Ul},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:Ul},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:AC},color:{themeKey:"palette",transform:dy},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:dy},backgroundColor:{themeKey:"palette",transform:dy},p:{style:Ms},pt:{style:Ms},pr:{style:Ms},pb:{style:Ms},pl:{style:Ms},px:{style:Ms},py:{style:Ms},padding:{style:Ms},paddingTop:{style:Ms},paddingRight:{style:Ms},paddingBottom:{style:Ms},paddingLeft:{style:Ms},paddingX:{style:Ms},paddingY:{style:Ms},paddingInline:{style:Ms},paddingInlineStart:{style:Ms},paddingInlineEnd:{style:Ms},paddingBlock:{style:Ms},paddingBlockStart:{style:Ms},paddingBlockEnd:{style:Ms},m:{style:Rs},mt:{style:Rs},mr:{style:Rs},mb:{style:Rs},ml:{style:Rs},mx:{style:Rs},my:{style:Rs},margin:{style:Rs},marginTop:{style:Rs},marginRight:{style:Rs},marginBottom:{style:Rs},marginLeft:{style:Rs},marginX:{style:Rs},marginY:{style:Rs},marginInline:{style:Rs},marginInlineStart:{style:Rs},marginInlineEnd:{style:Rs},marginBlock:{style:Rs},marginBlockStart:{style:Rs},marginBlockEnd:{style:Rs},displayPrint:{cssProperty:!1,transform:t=>({"@media print":{display:t}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:PC},rowGap:{style:MC},columnGap:{style:RC},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:ol},maxWidth:{style:d5},minWidth:{transform:ol},height:{transform:ol},maxHeight:{transform:ol},minHeight:{transform:ol},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function _ye(...t){const e=t.reduce((s,c)=>s.concat(Object.keys(c)),[]),r=new Set(e);return t.every(s=>r.size===Object.keys(s).length)}function yye(t,e){return typeof t=="function"?t(e):t}function vye(){function t(r,s,c,d){const _={[r]:s,theme:c},x=d[r];if(!x)return{[r]:s};const{cssProperty:a=r,themeKey:I,transform:M,style:D}=x;if(s==null)return null;if(I==="typography"&&s==="inherit")return{[r]:s};const L=IC(c,I)||{};return D?D(_):Yh(_,s,Q=>{let re=BS(L,M,Q);return Q===re&&typeof Q=="string"&&(re=BS(L,M,`${r}${Q==="default"?"":Kn(Q)}`,Q)),a===!1?re:{[a]:re}})}function e(r){const{sx:s,theme:c={}}=r||{};if(!s)return null;const d=c.unstable_sxConfig??fb;function _(x){let a=x;if(typeof x=="function")a=x(c);else if(typeof x!="object")return x;if(!a)return null;const I=O_e(c.breakpoints),M=Object.keys(I);let D=I;return Object.keys(a).forEach(L=>{const G=yye(a[L],c);if(G!=null)if(typeof G=="object")if(d[L])D=L1(D,t(L,G,c,d));else{const Q=Yh({theme:c},G,re=>({[L]:re}));_ye(Q,G)?D[L]=e({sx:G,theme:c}):D=L1(D,Q)}else D=L1(D,t(L,G,c,d))}),C_e(c,D_e(M,D))}return Array.isArray(s)?s.map(_):_(s)}return e}const pb=vye();pb.filterProps=["sx"];function xye(t,e){var s;const r=this;if(r.vars){if(!((s=r.colorSchemes)!=null&&s[t])||typeof r.getColorSchemeSelector!="function")return{};let c=r.getColorSchemeSelector(t);return(c.includes("data-")||c.includes("."))&&(c=`*:where(${c.replace(/\s*&$/,"")}) &`),{[c]:e}}return r.palette.mode===t?e:{}}function f5(t={},...e){const{breakpoints:r={},palette:s={},spacing:c,shape:d={},..._}=t,x=I_e(r),a=HW(c);let I=Qo({breakpoints:x,direction:"ltr",components:{},palette:{mode:"light",...s},spacing:a,shape:{...M_e,...d}},_);return I=R_e(I),I.applyStyles=xye,I=e.reduce((M,D)=>Qo(M,D),I),I.unstable_sxConfig={...fb,..._==null?void 0:_.unstable_sxConfig},I.unstable_sx=function(D){return pb({sx:D,theme:this})},I}function bye(t){return Object.keys(t).length===0}function wye(t=null){const e=Y.useContext(a5);return!e||bye(e)?t:e}const Tye=f5();function p5(t=Tye){return wye(t)}function Eye({styles:t,themeId:e,defaultTheme:r={}}){const s=p5(r),c=typeof t=="function"?t(e&&s[e]||s):t;return F.jsx(w_e,{styles:c})}const Sye=t=>{var s;const e={systemProps:{},otherProps:{}},r=((s=t==null?void 0:t.theme)==null?void 0:s.unstable_sxConfig)??fb;return Object.keys(t).forEach(c=>{r[c]?e.systemProps[c]=t[c]:e.otherProps[c]=t[c]}),e};function Iye(t){const{sx:e,...r}=t,{systemProps:s,otherProps:c}=Sye(r);let d;return Array.isArray(e)?d=[s,...e]:typeof e=="function"?d=(..._)=>{const x=e(..._);return Mu(x)?{...s,...x}:s}:d={...s,...e},{...c,sx:d}}const QU=t=>t,Cye=()=>{let t=QU;return{configure(e){t=e},generate(e){return t(e)},reset(){t=QU}}},Aye=Cye();function ZW(t){var e,r,s="";if(typeof t=="string"||typeof t=="number")s+=t;else if(typeof t=="object")if(Array.isArray(t)){var c=t.length;for(e=0;e<c;e++)t[e]&&(r=ZW(t[e]))&&(s&&(s+=" "),s+=r)}else for(r in t)t[r]&&(s&&(s+=" "),s+=r);return s}function kr(){for(var t,e,r=0,s="",c=arguments.length;r<c;r++)(t=arguments[r])&&(e=ZW(t))&&(s&&(s+=" "),s+=e);return s}const Pye={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Si(t,e,r="Mui"){const s=Pye[e];return s?`${r}-${s}`:`${Aye.generate(t)}-${e}`}function Ii(t,e,r="Mui"){const s={};return e.forEach(c=>{s[c]=Si(t,c,r)}),s}var Pi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m5=Symbol.for("react.element"),g5=Symbol.for("react.portal"),kC=Symbol.for("react.fragment"),OC=Symbol.for("react.strict_mode"),DC=Symbol.for("react.profiler"),LC=Symbol.for("react.provider"),zC=Symbol.for("react.context"),Rye=Symbol.for("react.server_context"),NC=Symbol.for("react.forward_ref"),FC=Symbol.for("react.suspense"),BC=Symbol.for("react.suspense_list"),jC=Symbol.for("react.memo"),UC=Symbol.for("react.lazy"),Mye=Symbol.for("react.offscreen"),XW;XW=Symbol.for("react.module.reference");function ec(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case m5:switch(t=t.type,t){case kC:case DC:case OC:case FC:case BC:return t;default:switch(t=t&&t.$$typeof,t){case Rye:case zC:case NC:case UC:case jC:case LC:return t;default:return e}}case g5:return e}}}Pi.ContextConsumer=zC;Pi.ContextProvider=LC;Pi.Element=m5;Pi.ForwardRef=NC;Pi.Fragment=kC;Pi.Lazy=UC;Pi.Memo=jC;Pi.Portal=g5;Pi.Profiler=DC;Pi.StrictMode=OC;Pi.Suspense=FC;Pi.SuspenseList=BC;Pi.isAsyncMode=function(){return!1};Pi.isConcurrentMode=function(){return!1};Pi.isContextConsumer=function(t){return ec(t)===zC};Pi.isContextProvider=function(t){return ec(t)===LC};Pi.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===m5};Pi.isForwardRef=function(t){return ec(t)===NC};Pi.isFragment=function(t){return ec(t)===kC};Pi.isLazy=function(t){return ec(t)===UC};Pi.isMemo=function(t){return ec(t)===jC};Pi.isPortal=function(t){return ec(t)===g5};Pi.isProfiler=function(t){return ec(t)===DC};Pi.isStrictMode=function(t){return ec(t)===OC};Pi.isSuspense=function(t){return ec(t)===FC};Pi.isSuspenseList=function(t){return ec(t)===BC};Pi.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===kC||t===DC||t===OC||t===FC||t===BC||t===Mye||typeof t=="object"&&t!==null&&(t.$$typeof===UC||t.$$typeof===jC||t.$$typeof===LC||t.$$typeof===zC||t.$$typeof===NC||t.$$typeof===XW||t.getModuleId!==void 0)};Pi.typeOf=ec;const kye=f5();function bR(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}function kk(t,e,r){return Dye(e)?r:e[t]||e}const GT=Symbol("mui.processed_props");function WT(t,e,r){if(GT in t)return t[GT];const s={...t,theme:kk(e,t.theme,r)};return t[GT]=s,s[GT]=s,s}function Oye(t){return t?(e,r)=>r[t]:null}function PE(t,e){var s;const r=typeof t=="function"?t(e):t;if(Array.isArray(r))return r.flatMap(c=>PE(c,e));if(Array.isArray(r==null?void 0:r.variants)){const{variants:c,...d}=r;let _=d,x;e:for(let a=0;a<c.length;a+=1){const I=c[a];if(typeof I.props=="function"){if(x??(x={...e,...e.ownerState,ownerState:e.ownerState}),!I.props(x))continue}else for(const M in I.props)if(e[M]!==I.props[M]&&((s=e.ownerState)==null?void 0:s[M])!==I.props[M])continue e;Array.isArray(_)||(_=[_]),typeof I.style=="function"?(x??(x={...e,...e.ownerState,ownerState:e.ownerState}),_.push(I.style(x))):_.push(I.style)}return _}return r}function KW(t={}){const{themeId:e,defaultTheme:r=kye,rootShouldForwardProp:s=bR,slotShouldForwardProp:c=bR}=t,d=x=>pb(WT(x,e,r));return d.__mui_systemSx=!0,(x,a={})=>{E_e(x,Ee=>Ee.filter(ie=>!(ie!=null&&ie.__mui_systemSx)));const{name:I,slot:M,skipVariantsResolver:D,skipSx:L,overridesResolver:G=Oye(zye(M)),...Q}=a,re=D!==void 0?D:M&&M!=="Root"&&M!=="root"||!1,ee=L||!1;let U,H=bR;M==="Root"||M==="root"?H=s:M?H=c:Lye(x)&&(H=void 0);const Z=T_e(x,{shouldForwardProp:H,label:U,...Q}),de=Ee=>typeof Ee=="function"&&Ee.__emotion_real!==Ee||Mu(Ee)?ie=>PE(Ee,WT(ie,e,r)):Ee,ve=(Ee,...ie)=>{let ue=de(Ee);const K=ie?ie.map(de):[];I&&G&&K.push(Se=>{const xe=kk(e,Se.theme,r);if(!xe.components||!xe.components[I]||!xe.components[I].styleOverrides)return null;const wt=xe.components[I].styleOverrides,ft={},Tt=WT(Se,e,r);for(const gt in wt)ft[gt]=PE(wt[gt],Tt);return G(Se,ft)}),I&&!re&&K.push(Se=>{var ft,Tt;const xe=kk(e,Se.theme,r),wt=(Tt=(ft=xe==null?void 0:xe.components)==null?void 0:ft[I])==null?void 0:Tt.variants;return wt?PE({variants:wt},WT(Se,e,r)):null}),ee||K.push(d);const ge=K.length-ie.length;if(Array.isArray(Ee)&&ge>0){const Se=new Array(ge).fill("");ue=[...Ee,...Se],ue.raw=[...Ee.raw,...Se]}const _e=Z(ue,...K);return x.muiName&&(_e.muiName=x.muiName),_e};return Z.withConfig&&(ve.withConfig=Z.withConfig),ve}}function Dye(t){for(const e in t)return!1;return!0}function Lye(t){return typeof t=="string"&&t.charCodeAt(0)>96}function zye(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}const Hu=KW();function Ax(t,e){const r={...e};for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)){const c=s;if(c==="components"||c==="slots")r[c]={...t[c],...r[c]};else if(c==="componentsProps"||c==="slotProps"){const d=t[c],_=e[c];if(!_)r[c]=d||{};else if(!d)r[c]=_;else{r[c]={..._};for(const x in d)if(Object.prototype.hasOwnProperty.call(d,x)){const a=x;r[c][a]=Ax(d[a],_[a])}}}else r[c]===void 0&&(r[c]=t[c])}return r}function Nye(t){const{theme:e,name:r,props:s}=t;return!e||!e.components||!e.components[r]||!e.components[r].defaultProps?s:Ax(e.components[r].defaultProps,s)}function Fye({props:t,name:e,defaultTheme:r,themeId:s}){let c=p5(r);return s&&(c=c[s]||c),Nye({theme:c,name:e,props:t})}const Um=typeof window<"u"?Y.useLayoutEffect:Y.useEffect;function Bye(t,e=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER){return Math.max(e,Math.min(t,r))}function _5(t,e=0,r=1){return Bye(t,e,r)}function jye(t){t=t.slice(1);const e=new RegExp(`.{1,${t.length>=6?2:1}}`,"g");let r=t.match(e);return r&&r[0].length===1&&(r=r.map(s=>s+s)),r?`rgb${r.length===4?"a":""}(${r.map((s,c)=>c<3?parseInt(s,16):Math.round(parseInt(s,16)/255*1e3)/1e3).join(", ")})`:""}function Bf(t){if(t.type)return t;if(t.charAt(0)==="#")return Bf(jye(t));const e=t.indexOf("("),r=t.substring(0,e);if(!["rgb","rgba","hsl","hsla","color"].includes(r))throw new Error(Qh(9,t));let s=t.substring(e+1,t.length-1),c;if(r==="color"){if(s=s.split(" "),c=s.shift(),s.length===4&&s[3].charAt(0)==="/"&&(s[3]=s[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(c))throw new Error(Qh(10,c))}else s=s.split(",");return s=s.map(d=>parseFloat(d)),{type:r,values:s,colorSpace:c}}const Uye=t=>{const e=Bf(t);return e.values.slice(0,3).map((r,s)=>e.type.includes("hsl")&&s!==0?`${r}%`:r).join(" ")},l1=(t,e)=>{try{return Uye(t)}catch{return t}};function VC(t){const{type:e,colorSpace:r}=t;let{values:s}=t;return e.includes("rgb")?s=s.map((c,d)=>d<3?parseInt(c,10):c):e.includes("hsl")&&(s[1]=`${s[1]}%`,s[2]=`${s[2]}%`),e.includes("color")?s=`${r} ${s.join(" ")}`:s=`${s.join(", ")}`,`${e}(${s})`}function QW(t){t=Bf(t);const{values:e}=t,r=e[0],s=e[1]/100,c=e[2]/100,d=s*Math.min(c,1-c),_=(I,M=(I+r/30)%12)=>c-d*Math.max(Math.min(M-3,9-M,1),-1);let x="rgb";const a=[Math.round(_(0)*255),Math.round(_(8)*255),Math.round(_(4)*255)];return t.type==="hsla"&&(x+="a",a.push(e[3])),VC({type:x,values:a})}function Ok(t){t=Bf(t);let e=t.type==="hsl"||t.type==="hsla"?Bf(QW(t)).values:t.values;return e=e.map(r=>(t.type!=="color"&&(r/=255),r<=.03928?r/12.92:((r+.055)/1.055)**2.4)),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function Vye(t,e){const r=Ok(t),s=Ok(e);return(Math.max(r,s)+.05)/(Math.min(r,s)+.05)}function $l(t,e){return t=Bf(t),e=_5(e),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.type==="color"?t.values[3]=`/${e}`:t.values[3]=e,VC(t)}function HT(t,e,r){try{return $l(t,e)}catch{return t}}function y5(t,e){if(t=Bf(t),e=_5(e),t.type.includes("hsl"))t.values[2]*=1-e;else if(t.type.includes("rgb")||t.type.includes("color"))for(let r=0;r<3;r+=1)t.values[r]*=1-e;return VC(t)}function Li(t,e,r){try{return y5(t,e)}catch{return t}}function v5(t,e){if(t=Bf(t),e=_5(e),t.type.includes("hsl"))t.values[2]+=(100-t.values[2])*e;else if(t.type.includes("rgb"))for(let r=0;r<3;r+=1)t.values[r]+=(255-t.values[r])*e;else if(t.type.includes("color"))for(let r=0;r<3;r+=1)t.values[r]+=(1-t.values[r])*e;return VC(t)}function zi(t,e,r){try{return v5(t,e)}catch{return t}}function $ye(t,e=.15){return Ok(t)>.5?y5(t,e):v5(t,e)}function ZT(t,e,r){try{return $ye(t,e)}catch{return t}}function Dk(...t){return t.reduce((e,r)=>r==null?e:function(...c){e.apply(this,c),r.apply(this,c)},()=>{})}function YW(t,e=166){let r;function s(...c){const d=()=>{t.apply(this,c)};clearTimeout(r),r=setTimeout(d,e)}return s.clear=()=>{clearTimeout(r)},s}function wR(t,e){var r,s,c;return Y.isValidElement(t)&&e.indexOf(t.type.muiName??((c=(s=(r=t.type)==null?void 0:r._payload)==null?void 0:s.value)==null?void 0:c.muiName))!==-1}function ml(t){return t&&t.ownerDocument||document}function Vm(t){return ml(t).defaultView||window}function Lk(t,e){typeof t=="function"?t(e):t&&(t.current=e)}let YU=0;function qye(t){const[e,r]=Y.useState(t),s=t||e;return Y.useEffect(()=>{e==null&&(YU+=1,r(`mui-${YU}`))},[e]),s}const JU=jE.useId;function x5(t){if(JU!==void 0){const e=JU();return t??e}return qye(t)}function jS({controlled:t,default:e,name:r,state:s="value"}){const{current:c}=Y.useRef(t!==void 0),[d,_]=Y.useState(e),x=c?t:d,a=Y.useCallback(I=>{c||_(I)},[]);return[x,a]}function H_(t){const e=Y.useRef(t);return Um(()=>{e.current=t}),Y.useRef((...r)=>(0,e.current)(...r)).current}function Do(...t){return Y.useMemo(()=>t.every(e=>e==null)?null:e=>{t.forEach(r=>{Lk(r,e)})},t)}const eV={};function JW(t,e){const r=Y.useRef(eV);return r.current===eV&&(r.current=t(e)),r}const Gye=[];function Wye(t){Y.useEffect(t,Gye)}class b5{constructor(){Mv(this,"currentId",null);Mv(this,"clear",()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)});Mv(this,"disposeEffect",()=>this.clear)}static create(){return new b5}start(e,r){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,r()},e)}}function eH(){const t=JW(b5.create).current;return Wye(t.disposeEffect),t}function tV(t){try{return t.matches(":focus-visible")}catch{}return!1}function tH(t){const e=t.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}const nH=t=>{const e=Y.useRef({});return Y.useEffect(()=>{e.current=t}),e.current};function Ri(t,e,r=void 0){const s={};for(const c in t){const d=t[c];let _="",x=!0;for(let a=0;a<d.length;a+=1){const I=d[a];I&&(_+=(x===!0?"":" ")+e(I),x=!1,r&&r[I]&&(_+=" "+r[I]))}s[c]=_}return s}function Hye(t){return typeof t=="string"}function rH(t,e,r){return t===void 0||Hye(t)?e:{...e,ownerState:{...e.ownerState,...r}}}function iH(t,e=[]){if(t===void 0)return{};const r={};return Object.keys(t).filter(s=>s.match(/^on[A-Z]/)&&typeof t[s]=="function"&&!e.includes(s)).forEach(s=>{r[s]=t[s]}),r}function nV(t){if(t===void 0)return{};const e={};return Object.keys(t).filter(r=>!(r.match(/^on[A-Z]/)&&typeof t[r]=="function")).forEach(r=>{e[r]=t[r]}),e}function sH(t){const{getSlotProps:e,additionalProps:r,externalSlotProps:s,externalForwardedProps:c,className:d}=t;if(!e){const G=kr(r==null?void 0:r.className,d,c==null?void 0:c.className,s==null?void 0:s.className),Q={...r==null?void 0:r.style,...c==null?void 0:c.style,...s==null?void 0:s.style},re={...r,...c,...s};return G.length>0&&(re.className=G),Object.keys(Q).length>0&&(re.style=Q),{props:re,internalRef:void 0}}const _=iH({...c,...s}),x=nV(s),a=nV(c),I=e(_),M=kr(I==null?void 0:I.className,r==null?void 0:r.className,d,c==null?void 0:c.className,s==null?void 0:s.className),D={...I==null?void 0:I.style,...r==null?void 0:r.style,...c==null?void 0:c.style,...s==null?void 0:s.style},L={...I,...r,...a,...x};return M.length>0&&(L.className=M),Object.keys(D).length>0&&(L.style=D),{props:L,internalRef:I.ref}}function oH(t,e,r){return typeof t=="function"?t(e,r):t}function US(t){var D;const{elementType:e,externalSlotProps:r,ownerState:s,skipResolvingSlotProps:c=!1,...d}=t,_=c?{}:oH(r,s),{props:x,internalRef:a}=sH({...d,externalSlotProps:_}),I=Do(a,_==null?void 0:_.ref,(D=t.additionalProps)==null?void 0:D.ref);return rH(e,{...x,ref:I},s)}function mb(t){return!t||!Y.isValidElement(t)?null:t.props.propertyIsEnumerable("ref")?t.props.ref:t.ref}const Zye=Y.createContext(),Xye=()=>Y.useContext(Zye)??!1,Kye=Y.createContext(void 0);function Qye(t){const{theme:e,name:r,props:s}=t;if(!e||!e.components||!e.components[r])return s;const c=e.components[r];return c.defaultProps?Ax(c.defaultProps,s):!c.styleOverrides&&!c.variants?Ax(c,s):s}function Yye({props:t,name:e}){const r=Y.useContext(Kye);return Qye({props:t,name:e,theme:{components:r}})}function Jye(t=""){function e(...s){if(!s.length)return"";const c=s[0];return typeof c=="string"&&!c.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${t?`${t}-`:""}${c}${e(...s.slice(1))})`:`, ${c}`}return(s,...c)=>`var(--${t?`${t}-`:""}${s}${e(...c)})`}const rV=(t,e,r,s=[])=>{let c=t;e.forEach((d,_)=>{_===e.length-1?Array.isArray(c)?c[Number(d)]=r:c&&typeof c=="object"&&(c[d]=r):c&&typeof c=="object"&&(c[d]||(c[d]=s.includes(d)?[]:{}),c=c[d])})},e0e=(t,e,r)=>{function s(c,d=[],_=[]){Object.entries(c).forEach(([x,a])=>{(!r||r&&!r([...d,x]))&&a!=null&&(typeof a=="object"&&Object.keys(a).length>0?s(a,[...d,x],Array.isArray(a)?[..._,x]:_):e([...d,x],a,_))})}s(t)},t0e=(t,e)=>typeof e=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(s=>t.includes(s))||t[t.length-1].toLowerCase().indexOf("opacity")>=0?e:`${e}px`:e;function TR(t,e){const{prefix:r,shouldSkipGeneratingVar:s}=e||{},c={},d={},_={};return e0e(t,(x,a,I)=>{if((typeof a=="string"||typeof a=="number")&&(!s||!s(x,a))){const M=`--${r?`${r}-`:""}${x.join("-")}`,D=t0e(x,a);Object.assign(c,{[M]:D}),rV(d,x,`var(${M})`,I),rV(_,x,`var(${M}, ${D})`,I)}},x=>x[0]==="vars"),{css:c,vars:d,varsWithDefaults:_}}function n0e(t,e={}){const{getSelector:r=ee,disableCssColorScheme:s,colorSchemeSelector:c}=e,{colorSchemes:d={},components:_,defaultColorScheme:x="light",...a}=t,{vars:I,css:M,varsWithDefaults:D}=TR(a,e);let L=D;const G={},{[x]:Q,...re}=d;if(Object.entries(re||{}).forEach(([Z,de])=>{const{vars:ve,css:Ee,varsWithDefaults:ie}=TR(de,e);L=Qo(L,ie),G[Z]={css:Ee,vars:ve}}),Q){const{css:Z,vars:de,varsWithDefaults:ve}=TR(Q,e);L=Qo(L,ve),G[x]={css:Z,vars:de}}function ee(Z,de){var Ee,ie;let ve=c;if(c==="class"&&(ve=".%s"),c==="data"&&(ve="[data-%s]"),c!=null&&c.startsWith("data-")&&!c.includes("%s")&&(ve=`[${c}="%s"]`),Z){if(ve==="media")return t.defaultColorScheme===Z?":root":{[`@media (prefers-color-scheme: ${((ie=(Ee=d[Z])==null?void 0:Ee.palette)==null?void 0:ie.mode)||Z})`]:{":root":de}};if(ve)return t.defaultColorScheme===Z?`:root, ${ve.replace("%s",String(Z))}`:ve.replace("%s",String(Z))}return":root"}return{vars:L,generateThemeVars:()=>{let Z={...I};return Object.entries(G).forEach(([,{vars:de}])=>{Z=Qo(Z,de)}),Z},generateStyleSheets:()=>{var ue,K;const Z=[],de=t.defaultColorScheme||"light";function ve(ge,_e){Object.keys(_e).length&&Z.push(typeof ge=="string"?{[ge]:{..._e}}:ge)}ve(r(void 0,{...M}),M);const{[de]:Ee,...ie}=G;if(Ee){const{css:ge}=Ee,_e=(K=(ue=d[de])==null?void 0:ue.palette)==null?void 0:K.mode,Se=!s&&_e?{colorScheme:_e,...ge}:{...ge};ve(r(de,{...Se}),Se)}return Object.entries(ie).forEach(([ge,{css:_e}])=>{var wt,ft;const Se=(ft=(wt=d[ge])==null?void 0:wt.palette)==null?void 0:ft.mode,xe=!s&&Se?{colorScheme:Se,..._e}:{..._e};ve(r(ge,{...xe}),xe)}),Z}}}function r0e(t){return function(r){return t==="media"?`@media (prefers-color-scheme: ${r})`:t?t.startsWith("data-")&&!t.includes("%s")?`[${t}="${r}"] &`:t==="class"?`.${r} &`:t==="data"?`[data-${r}] &`:`${t.replace("%s",r)} &`:"&"}}const iV={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Ex.white,default:Ex.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},ER={text:{primary:Ex.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Ex.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function sV(t,e,r,s){const c=s.light||s,d=s.dark||s*1.5;t[e]||(t.hasOwnProperty(r)?t[e]=t[r]:e==="light"?t.light=v5(t.main,c):e==="dark"&&(t.dark=y5(t.main,d)))}function i0e(t="light"){return t==="dark"?{main:b_[200],light:b_[50],dark:b_[400]}:{main:b_[700],light:b_[400],dark:b_[800]}}function s0e(t="light"){return t==="dark"?{main:x_[200],light:x_[50],dark:x_[400]}:{main:x_[500],light:x_[300],dark:x_[700]}}function o0e(t="light"){return t==="dark"?{main:v_[500],light:v_[300],dark:v_[700]}:{main:v_[700],light:v_[400],dark:v_[800]}}function a0e(t="light"){return t==="dark"?{main:w_[400],light:w_[300],dark:w_[700]}:{main:w_[700],light:w_[500],dark:w_[900]}}function l0e(t="light"){return t==="dark"?{main:T_[400],light:T_[300],dark:T_[700]}:{main:T_[800],light:T_[500],dark:T_[900]}}function c0e(t="light"){return t==="dark"?{main:$v[400],light:$v[300],dark:$v[700]}:{main:"#ed6c02",light:$v[500],dark:$v[900]}}function w5(t){const{mode:e="light",contrastThreshold:r=3,tonalOffset:s=.2,...c}=t,d=t.primary||i0e(e),_=t.secondary||s0e(e),x=t.error||o0e(e),a=t.info||a0e(e),I=t.success||l0e(e),M=t.warning||c0e(e);function D(re){return Vye(re,ER.text.primary)>=r?ER.text.primary:iV.text.primary}const L=({color:re,name:ee,mainShade:U=500,lightShade:H=300,darkShade:Z=700})=>{if(re={...re},!re.main&&re[U]&&(re.main=re[U]),!re.hasOwnProperty("main"))throw new Error(Qh(11,ee?` (${ee})`:"",U));if(typeof re.main!="string")throw new Error(Qh(12,ee?` (${ee})`:"",JSON.stringify(re.main)));return sV(re,"light",H,s),sV(re,"dark",Z,s),re.contrastText||(re.contrastText=D(re.main)),re},G={dark:ER,light:iV};return Qo({common:{...Ex},mode:e,primary:L({color:d,name:"primary"}),secondary:L({color:_,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:L({color:x,name:"error"}),warning:L({color:M,name:"warning"}),info:L({color:a,name:"info"}),success:L({color:I,name:"success"}),grey:yge,contrastThreshold:r,getContrastText:D,augmentColor:L,tonalOffset:s,...G[e]},c)}function u0e(t){const e={};return Object.entries(t).forEach(s=>{const[c,d]=s;typeof d=="object"&&(e[c]=`${d.fontStyle?`${d.fontStyle} `:""}${d.fontVariant?`${d.fontVariant} `:""}${d.fontWeight?`${d.fontWeight} `:""}${d.fontStretch?`${d.fontStretch} `:""}${d.fontSize||""}${d.lineHeight?`/${d.lineHeight} `:""}${d.fontFamily||""}`)}),e}function h0e(t,e){return{toolbar:{minHeight:56,[t.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[t.up("sm")]:{minHeight:64}},...e}}function d0e(t){return Math.round(t*1e5)/1e5}const oV={textTransform:"uppercase"},aV='"Roboto", "Helvetica", "Arial", sans-serif';function f0e(t,e){const{fontFamily:r=aV,fontSize:s=14,fontWeightLight:c=300,fontWeightRegular:d=400,fontWeightMedium:_=500,fontWeightBold:x=700,htmlFontSize:a=16,allVariants:I,pxToRem:M,...D}=typeof e=="function"?e(t):e,L=s/14,G=M||(ee=>`${ee/a*L}rem`),Q=(ee,U,H,Z,de)=>({fontFamily:r,fontWeight:ee,fontSize:G(U),lineHeight:H,...r===aV?{letterSpacing:`${d0e(Z/U)}em`}:{},...de,...I}),re={h1:Q(c,96,1.167,-1.5),h2:Q(c,60,1.2,-.5),h3:Q(d,48,1.167,0),h4:Q(d,34,1.235,.25),h5:Q(d,24,1.334,0),h6:Q(_,20,1.6,.15),subtitle1:Q(d,16,1.75,.15),subtitle2:Q(_,14,1.57,.1),body1:Q(d,16,1.5,.15),body2:Q(d,14,1.43,.15),button:Q(_,14,1.75,.4,oV),caption:Q(d,12,1.66,.4),overline:Q(d,12,2.66,1,oV),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return Qo({htmlFontSize:a,pxToRem:G,fontFamily:r,fontSize:s,fontWeightLight:c,fontWeightRegular:d,fontWeightMedium:_,fontWeightBold:x,...re},D,{clone:!1})}const p0e=.2,m0e=.14,g0e=.12;function cs(...t){return[`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px rgba(0,0,0,${p0e})`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px rgba(0,0,0,${m0e})`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px rgba(0,0,0,${g0e})`].join(",")}const _0e=["none",cs(0,2,1,-1,0,1,1,0,0,1,3,0),cs(0,3,1,-2,0,2,2,0,0,1,5,0),cs(0,3,3,-2,0,3,4,0,0,1,8,0),cs(0,2,4,-1,0,4,5,0,0,1,10,0),cs(0,3,5,-1,0,5,8,0,0,1,14,0),cs(0,3,5,-1,0,6,10,0,0,1,18,0),cs(0,4,5,-2,0,7,10,1,0,2,16,1),cs(0,5,5,-3,0,8,10,1,0,3,14,2),cs(0,5,6,-3,0,9,12,1,0,3,16,2),cs(0,6,6,-3,0,10,14,1,0,4,18,3),cs(0,6,7,-4,0,11,15,1,0,4,20,3),cs(0,7,8,-4,0,12,17,2,0,5,22,4),cs(0,7,8,-4,0,13,19,2,0,5,24,4),cs(0,7,9,-4,0,14,21,2,0,5,26,4),cs(0,8,9,-5,0,15,22,2,0,6,28,5),cs(0,8,10,-5,0,16,24,2,0,6,30,5),cs(0,8,11,-5,0,17,26,2,0,6,32,5),cs(0,9,11,-5,0,18,28,2,0,7,34,6),cs(0,9,12,-6,0,19,29,2,0,7,36,6),cs(0,10,13,-6,0,20,31,3,0,8,38,7),cs(0,10,13,-6,0,21,33,3,0,8,40,7),cs(0,10,14,-6,0,22,35,3,0,8,42,7),cs(0,11,14,-7,0,23,36,3,0,9,44,8),cs(0,11,15,-7,0,24,38,3,0,9,46,8)],y0e={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},v0e={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function lV(t){return`${Math.round(t)}ms`}function x0e(t){if(!t)return 0;const e=t/36;return Math.min(Math.round((4+15*e**.25+e/5)*10),3e3)}function b0e(t){const e={...y0e,...t.easing},r={...v0e,...t.duration};return{getAutoHeightDuration:x0e,create:(c=["all"],d={})=>{const{duration:_=r.standard,easing:x=e.easeInOut,delay:a=0,...I}=d;return(Array.isArray(c)?c:[c]).map(M=>`${M} ${typeof _=="string"?_:lV(_)} ${x} ${typeof a=="string"?a:lV(a)}`).join(",")},...t,easing:e,duration:r}}const w0e={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function zk(t={},...e){const{breakpoints:r,mixins:s={},spacing:c,palette:d={},transitions:_={},typography:x={},shape:a,...I}=t;if(t.vars)throw new Error(Qh(20));const M=w5(d),D=f5(t);let L=Qo(D,{mixins:h0e(D.breakpoints,s),palette:M,shadows:_0e.slice(),typography:f0e(M,x),transitions:b0e(_),zIndex:{...w0e}});return L=Qo(L,I),L=e.reduce((G,Q)=>Qo(G,Q),L),L.unstable_sxConfig={...fb,...I==null?void 0:I.unstable_sxConfig},L.unstable_sx=function(Q){return pb({sx:Q,theme:this})},L}function Nk(t){let e;return t<1?e=5.11916*t**2:e=4.5*Math.log(t+1)+2,Math.round(e*10)/1e3}const T0e=[...Array(25)].map((t,e)=>{if(e===0)return;const r=Nk(e);return`linear-gradient(rgba(255 255 255 / ${r}), rgba(255 255 255 / ${r}))`});function aH(t){return{inputPlaceholder:t==="dark"?.5:.42,inputUnderline:t==="dark"?.7:.42,switchTrackDisabled:t==="dark"?.2:.12,switchTrack:t==="dark"?.3:.38}}function lH(t){return t==="dark"?T0e:[]}function E0e(t){const{palette:e={mode:"light"},opacity:r,overlays:s,...c}=t,d=w5(e);return{palette:d,opacity:{...aH(d.mode),...r},overlays:s||lH(d.mode),...c}}function S0e(t){var e;return!!t[0].match(/(cssVarPrefix|colorSchemeSelector|typography|mixins|breakpoints|direction|transitions)/)||!!t[0].match(/sxConfig$/)||t[0]==="palette"&&!!((e=t[1])!=null&&e.match(/(mode|contrastThreshold|tonalOffset)/))}const I0e=t=>[...[...Array(24)].map((e,r)=>`--${t?`${t}-`:""}overlays-${r+1}`),`--${t?`${t}-`:""}palette-AppBar-darkBg`,`--${t?`${t}-`:""}palette-AppBar-darkColor`],C0e=t=>(e,r)=>{const s=t.colorSchemeSelector;let c=s;if(s==="class"&&(c=".%s"),s==="data"&&(c="[data-%s]"),s!=null&&s.startsWith("data-")&&!s.includes("%s")&&(c=`[${s}="%s"]`),t.defaultColorScheme===e){if(e==="dark"){const d={};return I0e(t.cssVarPrefix).forEach(_=>{d[_]=r[_],delete r[_]}),c==="media"?{":root":r,"@media (prefers-color-scheme: dark)":{":root":d}}:c?{[c.replace("%s",e)]:d,[`:root, ${c.replace("%s",e)}`]:r}:{":root":{...r,...d}}}if(c&&c!=="media")return`:root, ${c.replace("%s",String(e))}`}else if(e){if(c==="media")return{[`@media (prefers-color-scheme: ${String(e)})`]:{":root":r}};if(c)return c.replace("%s",String(e))}return":root"};function A0e(t){return Mu(t)||typeof t>"u"||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||Array.isArray(t)}function P0e(t={}){const e={...t};function r(s){const c=Object.entries(s);for(let d=0;d<c.length;d++){const[_,x]=c[d];!A0e(x)||_.startsWith("unstable_")?delete s[_]:Mu(x)&&(s[_]={...x},r(s[_]))}}return r(e),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(e,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function R0e(t,e){e.forEach(r=>{t[r]||(t[r]={})})}function qt(t,e,r){!t[e]&&r&&(t[e]=r)}function c1(t){return!t||!t.startsWith("hsl")?t:QW(t)}function Eh(t,e){`${e}Channel`in t||(t[`${e}Channel`]=l1(c1(t[e]),`MUI: Can't create \`palette.${e}Channel\` because \`palette.${e}\` is not one of these formats: #nnn, #nnnnnn, rgb(), rgba(), hsl(), hsla(), color().
To suppress this warning, you need to explicitly provide the \`palette.${e}Channel\` as a string (in rgb format, for example "12 12 12") or undefined if you want to remove the channel token.`))}function M0e(t){return typeof t=="number"?`${t}px`:typeof t=="string"||typeof t=="function"||Array.isArray(t)?t:"8px"}const vu=t=>{try{return t()}catch{}},k0e=(t="mui")=>Jye(t);function SR(t,e,r,s){if(!e)return;e=e===!0?{}:e;const c=s==="dark"?"dark":"light";if(!r){t[s]=E0e({...e,palette:{mode:c,...e==null?void 0:e.palette}});return}const{palette:d,..._}=zk({...r,palette:{mode:c,...e==null?void 0:e.palette}});return t[s]={...e,palette:d,opacity:{...aH(c),...e==null?void 0:e.opacity},overlays:(e==null?void 0:e.overlays)||lH(c)},_}function O0e(t={},...e){const{colorSchemes:r={light:!0},defaultColorScheme:s,disableCssColorScheme:c=!1,cssVarPrefix:d="mui",shouldSkipGeneratingVar:_=S0e,colorSchemeSelector:x=r.light&&r.dark?"media":void 0,...a}=t,I=Object.keys(r)[0],M=s||(r.light&&I!=="light"?"light":I),D=k0e(d),{[M]:L,light:G,dark:Q,...re}=r,ee={...re};let U=L;if((M==="dark"&&!("dark"in r)||M==="light"&&!("light"in r))&&(U=!0),!U)throw new Error(Qh(21,M));const H=SR(ee,U,a,M);G&&!ee.light&&SR(ee,G,void 0,"light"),Q&&!ee.dark&&SR(ee,Q,void 0,"dark");let Z={defaultColorScheme:M,...H,cssVarPrefix:d,colorSchemeSelector:x,getCssVar:D,colorSchemes:ee,font:{...u0e(H.typography),...H.font},spacing:M0e(a.spacing)};Object.keys(Z.colorSchemes).forEach(ue=>{const K=Z.colorSchemes[ue].palette,ge=_e=>{const Se=_e.split("-"),xe=Se[1],wt=Se[2];return D(_e,K[xe][wt])};if(K.mode==="light"&&(qt(K.common,"background","#fff"),qt(K.common,"onBackground","#000")),K.mode==="dark"&&(qt(K.common,"background","#000"),qt(K.common,"onBackground","#fff")),R0e(K,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),K.mode==="light"){qt(K.Alert,"errorColor",Li(K.error.light,.6)),qt(K.Alert,"infoColor",Li(K.info.light,.6)),qt(K.Alert,"successColor",Li(K.success.light,.6)),qt(K.Alert,"warningColor",Li(K.warning.light,.6)),qt(K.Alert,"errorFilledBg",ge("palette-error-main")),qt(K.Alert,"infoFilledBg",ge("palette-info-main")),qt(K.Alert,"successFilledBg",ge("palette-success-main")),qt(K.Alert,"warningFilledBg",ge("palette-warning-main")),qt(K.Alert,"errorFilledColor",vu(()=>K.getContrastText(K.error.main))),qt(K.Alert,"infoFilledColor",vu(()=>K.getContrastText(K.info.main))),qt(K.Alert,"successFilledColor",vu(()=>K.getContrastText(K.success.main))),qt(K.Alert,"warningFilledColor",vu(()=>K.getContrastText(K.warning.main))),qt(K.Alert,"errorStandardBg",zi(K.error.light,.9)),qt(K.Alert,"infoStandardBg",zi(K.info.light,.9)),qt(K.Alert,"successStandardBg",zi(K.success.light,.9)),qt(K.Alert,"warningStandardBg",zi(K.warning.light,.9)),qt(K.Alert,"errorIconColor",ge("palette-error-main")),qt(K.Alert,"infoIconColor",ge("palette-info-main")),qt(K.Alert,"successIconColor",ge("palette-success-main")),qt(K.Alert,"warningIconColor",ge("palette-warning-main")),qt(K.AppBar,"defaultBg",ge("palette-grey-100")),qt(K.Avatar,"defaultBg",ge("palette-grey-400")),qt(K.Button,"inheritContainedBg",ge("palette-grey-300")),qt(K.Button,"inheritContainedHoverBg",ge("palette-grey-A100")),qt(K.Chip,"defaultBorder",ge("palette-grey-400")),qt(K.Chip,"defaultAvatarColor",ge("palette-grey-700")),qt(K.Chip,"defaultIconColor",ge("palette-grey-700")),qt(K.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),qt(K.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),qt(K.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),qt(K.LinearProgress,"primaryBg",zi(K.primary.main,.62)),qt(K.LinearProgress,"secondaryBg",zi(K.secondary.main,.62)),qt(K.LinearProgress,"errorBg",zi(K.error.main,.62)),qt(K.LinearProgress,"infoBg",zi(K.info.main,.62)),qt(K.LinearProgress,"successBg",zi(K.success.main,.62)),qt(K.LinearProgress,"warningBg",zi(K.warning.main,.62)),qt(K.Skeleton,"bg",`rgba(${ge("palette-text-primaryChannel")} / 0.11)`),qt(K.Slider,"primaryTrack",zi(K.primary.main,.62)),qt(K.Slider,"secondaryTrack",zi(K.secondary.main,.62)),qt(K.Slider,"errorTrack",zi(K.error.main,.62)),qt(K.Slider,"infoTrack",zi(K.info.main,.62)),qt(K.Slider,"successTrack",zi(K.success.main,.62)),qt(K.Slider,"warningTrack",zi(K.warning.main,.62));const _e=ZT(K.background.default,.8);qt(K.SnackbarContent,"bg",_e),qt(K.SnackbarContent,"color",vu(()=>K.getContrastText(_e))),qt(K.SpeedDialAction,"fabHoverBg",ZT(K.background.paper,.15)),qt(K.StepConnector,"border",ge("palette-grey-400")),qt(K.StepContent,"border",ge("palette-grey-400")),qt(K.Switch,"defaultColor",ge("palette-common-white")),qt(K.Switch,"defaultDisabledColor",ge("palette-grey-100")),qt(K.Switch,"primaryDisabledColor",zi(K.primary.main,.62)),qt(K.Switch,"secondaryDisabledColor",zi(K.secondary.main,.62)),qt(K.Switch,"errorDisabledColor",zi(K.error.main,.62)),qt(K.Switch,"infoDisabledColor",zi(K.info.main,.62)),qt(K.Switch,"successDisabledColor",zi(K.success.main,.62)),qt(K.Switch,"warningDisabledColor",zi(K.warning.main,.62)),qt(K.TableCell,"border",zi(HT(K.divider,1),.88)),qt(K.Tooltip,"bg",HT(K.grey[700],.92))}if(K.mode==="dark"){qt(K.Alert,"errorColor",zi(K.error.light,.6)),qt(K.Alert,"infoColor",zi(K.info.light,.6)),qt(K.Alert,"successColor",zi(K.success.light,.6)),qt(K.Alert,"warningColor",zi(K.warning.light,.6)),qt(K.Alert,"errorFilledBg",ge("palette-error-dark")),qt(K.Alert,"infoFilledBg",ge("palette-info-dark")),qt(K.Alert,"successFilledBg",ge("palette-success-dark")),qt(K.Alert,"warningFilledBg",ge("palette-warning-dark")),qt(K.Alert,"errorFilledColor",vu(()=>K.getContrastText(K.error.dark))),qt(K.Alert,"infoFilledColor",vu(()=>K.getContrastText(K.info.dark))),qt(K.Alert,"successFilledColor",vu(()=>K.getContrastText(K.success.dark))),qt(K.Alert,"warningFilledColor",vu(()=>K.getContrastText(K.warning.dark))),qt(K.Alert,"errorStandardBg",Li(K.error.light,.9)),qt(K.Alert,"infoStandardBg",Li(K.info.light,.9)),qt(K.Alert,"successStandardBg",Li(K.success.light,.9)),qt(K.Alert,"warningStandardBg",Li(K.warning.light,.9)),qt(K.Alert,"errorIconColor",ge("palette-error-main")),qt(K.Alert,"infoIconColor",ge("palette-info-main")),qt(K.Alert,"successIconColor",ge("palette-success-main")),qt(K.Alert,"warningIconColor",ge("palette-warning-main")),qt(K.AppBar,"defaultBg",ge("palette-grey-900")),qt(K.AppBar,"darkBg",ge("palette-background-paper")),qt(K.AppBar,"darkColor",ge("palette-text-primary")),qt(K.Avatar,"defaultBg",ge("palette-grey-600")),qt(K.Button,"inheritContainedBg",ge("palette-grey-800")),qt(K.Button,"inheritContainedHoverBg",ge("palette-grey-700")),qt(K.Chip,"defaultBorder",ge("palette-grey-700")),qt(K.Chip,"defaultAvatarColor",ge("palette-grey-300")),qt(K.Chip,"defaultIconColor",ge("palette-grey-300")),qt(K.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),qt(K.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),qt(K.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),qt(K.LinearProgress,"primaryBg",Li(K.primary.main,.5)),qt(K.LinearProgress,"secondaryBg",Li(K.secondary.main,.5)),qt(K.LinearProgress,"errorBg",Li(K.error.main,.5)),qt(K.LinearProgress,"infoBg",Li(K.info.main,.5)),qt(K.LinearProgress,"successBg",Li(K.success.main,.5)),qt(K.LinearProgress,"warningBg",Li(K.warning.main,.5)),qt(K.Skeleton,"bg",`rgba(${ge("palette-text-primaryChannel")} / 0.13)`),qt(K.Slider,"primaryTrack",Li(K.primary.main,.5)),qt(K.Slider,"secondaryTrack",Li(K.secondary.main,.5)),qt(K.Slider,"errorTrack",Li(K.error.main,.5)),qt(K.Slider,"infoTrack",Li(K.info.main,.5)),qt(K.Slider,"successTrack",Li(K.success.main,.5)),qt(K.Slider,"warningTrack",Li(K.warning.main,.5));const _e=ZT(K.background.default,.98);qt(K.SnackbarContent,"bg",_e),qt(K.SnackbarContent,"color",vu(()=>K.getContrastText(_e))),qt(K.SpeedDialAction,"fabHoverBg",ZT(K.background.paper,.15)),qt(K.StepConnector,"border",ge("palette-grey-600")),qt(K.StepContent,"border",ge("palette-grey-600")),qt(K.Switch,"defaultColor",ge("palette-grey-300")),qt(K.Switch,"defaultDisabledColor",ge("palette-grey-600")),qt(K.Switch,"primaryDisabledColor",Li(K.primary.main,.55)),qt(K.Switch,"secondaryDisabledColor",Li(K.secondary.main,.55)),qt(K.Switch,"errorDisabledColor",Li(K.error.main,.55)),qt(K.Switch,"infoDisabledColor",Li(K.info.main,.55)),qt(K.Switch,"successDisabledColor",Li(K.success.main,.55)),qt(K.Switch,"warningDisabledColor",Li(K.warning.main,.55)),qt(K.TableCell,"border",Li(HT(K.divider,1),.68)),qt(K.Tooltip,"bg",HT(K.grey[700],.92))}Eh(K.background,"default"),Eh(K.background,"paper"),Eh(K.common,"background"),Eh(K.common,"onBackground"),Eh(K,"divider"),Object.keys(K).forEach(_e=>{const Se=K[_e];Se&&typeof Se=="object"&&(Se.main&&qt(K[_e],"mainChannel",l1(c1(Se.main))),Se.light&&qt(K[_e],"lightChannel",l1(c1(Se.light))),Se.dark&&qt(K[_e],"darkChannel",l1(c1(Se.dark))),Se.contrastText&&qt(K[_e],"contrastTextChannel",l1(c1(Se.contrastText))),_e==="text"&&(Eh(K[_e],"primary"),Eh(K[_e],"secondary")),_e==="action"&&(Se.active&&Eh(K[_e],"active"),Se.selected&&Eh(K[_e],"selected")))})}),Z=e.reduce((ue,K)=>Qo(ue,K),Z);const de={prefix:d,disableCssColorScheme:c,shouldSkipGeneratingVar:_,getSelector:C0e(Z)},{vars:ve,generateThemeVars:Ee,generateStyleSheets:ie}=n0e(Z,de);return Z.vars=ve,Object.entries(Z.colorSchemes[Z.defaultColorScheme]).forEach(([ue,K])=>{Z[ue]=K}),Z.generateThemeVars=Ee,Z.generateStyleSheets=ie,Z.generateSpacing=function(){return HW(a.spacing,h5(this))},Z.getColorSchemeSelector=r0e(x),Z.spacing=Z.generateSpacing(),Z.shouldSkipGeneratingVar=_,Z.unstable_sxConfig={...fb,...a==null?void 0:a.unstable_sxConfig},Z.unstable_sx=function(K){return pb({sx:K,theme:this})},Z.toRuntimeSource=P0e,Z}function cV(t,e,r){t.colorSchemes&&r&&(t.colorSchemes[e]={...r!==!0&&r,palette:w5({...r===!0?{}:r.palette,mode:e})})}function D0e(t={},...e){const{palette:r,cssVariables:s=!1,colorSchemes:c=r?void 0:{light:!0},defaultColorScheme:d=r==null?void 0:r.mode,..._}=t,x=d||"light",a=c==null?void 0:c[x],I={...c,...r?{[x]:{...typeof a!="boolean"&&a,palette:r}}:void 0};if(s===!1){if(!("colorSchemes"in t))return zk(t,...e);let M=r;"palette"in t||I[x]&&(I[x]!==!0?M=I[x].palette:x==="dark"&&(M={mode:"dark"}));const D=zk({...t,palette:M},...e);return D.defaultColorScheme=x,D.colorSchemes=I,D.palette.mode==="light"&&(D.colorSchemes.light={...I.light!==!0&&I.light,palette:D.palette},cV(D,"dark",I.dark)),D.palette.mode==="dark"&&(D.colorSchemes.dark={...I.dark!==!0&&I.dark,palette:D.palette},cV(D,"light",I.light)),D}return!r&&!("light"in I)&&x==="light"&&(I.light=!0),O0e({..._,colorSchemes:I,defaultColorScheme:x,...typeof s!="boolean"&&s},...e)}const $C=D0e();function T5(){const t=p5($C);return t[bC]||t}function L0e({props:t,name:e}){return Fye({props:t,name:e,defaultTheme:$C,themeId:bC})}function cH(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}const Ga=t=>cH(t)&&t!=="classes",Qn=KW({themeId:bC,defaultTheme:$C,rootShouldForwardProp:Ga});function z0e(t){return F.jsx(Eye,{...t,defaultTheme:$C,themeId:bC})}function N0e(t){return function(r){return F.jsx(z0e,{styles:typeof t=="function"?s=>t({theme:s,...r}):t})}}function F0e(){return Iye}const uV={theme:void 0};function ns(t){let e,r;return s=>{let c=e;return(c===void 0||s.theme!==r)&&(uV.theme=s.theme,c=t(uV),e=c,r=s.theme),c}}function rs(t){return Yye(t)}function B0e(t){return Si("MuiSvgIcon",t)}Ii("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const j0e=t=>{const{color:e,fontSize:r,classes:s}=t,c={root:["root",e!=="inherit"&&`color${Kn(e)}`,`fontSize${Kn(r)}`]};return Ri(c,B0e,s)},U0e=Qn("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.color!=="inherit"&&e[`color${Kn(r.color)}`],e[`fontSize${Kn(r.fontSize)}`]]}})(ns(({theme:t})=>{var e,r,s,c,d,_,x,a,I,M,D,L,G,Q;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:(c=(e=t.transitions)==null?void 0:e.create)==null?void 0:c.call(e,"fill",{duration:(s=(r=(t.vars??t).transitions)==null?void 0:r.duration)==null?void 0:s.shorter}),variants:[{props:re=>!re.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:((_=(d=t.typography)==null?void 0:d.pxToRem)==null?void 0:_.call(d,20))||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:((a=(x=t.typography)==null?void 0:x.pxToRem)==null?void 0:a.call(x,24))||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:((M=(I=t.typography)==null?void 0:I.pxToRem)==null?void 0:M.call(I,35))||"2.1875rem"}},...Object.entries((t.vars??t).palette).filter(([,re])=>re&&re.main).map(([re])=>{var ee,U;return{props:{color:re},style:{color:(U=(ee=(t.vars??t).palette)==null?void 0:ee[re])==null?void 0:U.main}}}),{props:{color:"action"},style:{color:(L=(D=(t.vars??t).palette)==null?void 0:D.action)==null?void 0:L.active}},{props:{color:"disabled"},style:{color:(Q=(G=(t.vars??t).palette)==null?void 0:G.action)==null?void 0:Q.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}})),VS=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiSvgIcon"}),{children:c,className:d,color:_="inherit",component:x="svg",fontSize:a="medium",htmlColor:I,inheritViewBox:M=!1,titleAccess:D,viewBox:L="0 0 24 24",...G}=s,Q=Y.isValidElement(c)&&c.type==="svg",re={...s,color:_,component:x,fontSize:a,instanceFontSize:e.fontSize,inheritViewBox:M,viewBox:L,hasSvgAsChild:Q},ee={};M||(ee.viewBox=L);const U=j0e(re);return F.jsxs(U0e,{as:x,className:kr(U.root,d),focusable:"false",color:I,"aria-hidden":D?void 0:!0,role:D?"img":void 0,ref:r,...ee,...G,...Q&&c.props,ownerState:re,children:[Q?c.props.children:c,D?F.jsx("title",{children:D}):null]})});VS&&(VS.muiName="SvgIcon");function id(t,e){function r(s,c){return F.jsx(VS,{"data-testid":`${e}Icon`,ref:c,...s,children:t})}return r.muiName=VS.muiName,Y.memo(Y.forwardRef(r))}function uH(t,e){if(t==null)return{};var r={};for(var s in t)if({}.hasOwnProperty.call(t,s)){if(e.includes(s))continue;r[s]=t[s]}return r}function Fk(t,e){return Fk=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Fk(t,e)}function hH(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Fk(t,e)}const hV={disabled:!1},$S=Gr.createContext(null);var V0e=function(e){return e.scrollTop},u1="unmounted",nm="exited",rm="entering",M_="entered",Bk="exiting",Zu=function(t){hH(e,t);function e(s,c){var d;d=t.call(this,s,c)||this;var _=c,x=_&&!_.isMounting?s.enter:s.appear,a;return d.appearStatus=null,s.in?x?(a=nm,d.appearStatus=rm):a=M_:s.unmountOnExit||s.mountOnEnter?a=u1:a=nm,d.state={status:a},d.nextCallback=null,d}e.getDerivedStateFromProps=function(c,d){var _=c.in;return _&&d.status===u1?{status:nm}:null};var r=e.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(c){var d=null;if(c!==this.props){var _=this.state.status;this.props.in?_!==rm&&_!==M_&&(d=rm):(_===rm||_===M_)&&(d=Bk)}this.updateStatus(!1,d)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var c=this.props.timeout,d,_,x;return d=_=x=c,c!=null&&typeof c!="number"&&(d=c.exit,_=c.enter,x=c.appear!==void 0?c.appear:_),{exit:d,enter:_,appear:x}},r.updateStatus=function(c,d){if(c===void 0&&(c=!1),d!==null)if(this.cancelNextCallback(),d===rm){if(this.props.unmountOnExit||this.props.mountOnEnter){var _=this.props.nodeRef?this.props.nodeRef.current:OT.findDOMNode(this);_&&V0e(_)}this.performEnter(c)}else this.performExit();else this.props.unmountOnExit&&this.state.status===nm&&this.setState({status:u1})},r.performEnter=function(c){var d=this,_=this.props.enter,x=this.context?this.context.isMounting:c,a=this.props.nodeRef?[x]:[OT.findDOMNode(this),x],I=a[0],M=a[1],D=this.getTimeouts(),L=x?D.appear:D.enter;if(!c&&!_||hV.disabled){this.safeSetState({status:M_},function(){d.props.onEntered(I)});return}this.props.onEnter(I,M),this.safeSetState({status:rm},function(){d.props.onEntering(I,M),d.onTransitionEnd(L,function(){d.safeSetState({status:M_},function(){d.props.onEntered(I,M)})})})},r.performExit=function(){var c=this,d=this.props.exit,_=this.getTimeouts(),x=this.props.nodeRef?void 0:OT.findDOMNode(this);if(!d||hV.disabled){this.safeSetState({status:nm},function(){c.props.onExited(x)});return}this.props.onExit(x),this.safeSetState({status:Bk},function(){c.props.onExiting(x),c.onTransitionEnd(_.exit,function(){c.safeSetState({status:nm},function(){c.props.onExited(x)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(c,d){d=this.setNextCallback(d),this.setState(c,d)},r.setNextCallback=function(c){var d=this,_=!0;return this.nextCallback=function(x){_&&(_=!1,d.nextCallback=null,c(x))},this.nextCallback.cancel=function(){_=!1},this.nextCallback},r.onTransitionEnd=function(c,d){this.setNextCallback(d);var _=this.props.nodeRef?this.props.nodeRef.current:OT.findDOMNode(this),x=c==null&&!this.props.addEndListener;if(!_||x){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[_,this.nextCallback],I=a[0],M=a[1];this.props.addEndListener(I,M)}c!=null&&setTimeout(this.nextCallback,c)},r.render=function(){var c=this.state.status;if(c===u1)return null;var d=this.props,_=d.children;d.in,d.mountOnEnter,d.unmountOnExit,d.appear,d.enter,d.exit,d.timeout,d.addEndListener,d.onEnter,d.onEntering,d.onEntered,d.onExit,d.onExiting,d.onExited,d.nodeRef;var x=uH(d,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Gr.createElement($S.Provider,{value:null},typeof _=="function"?_(c,x):Gr.cloneElement(Gr.Children.only(_),x))},e}(Gr.Component);Zu.contextType=$S;Zu.propTypes={};function E_(){}Zu.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:E_,onEntering:E_,onEntered:E_,onExit:E_,onExiting:E_,onExited:E_};Zu.UNMOUNTED=u1;Zu.EXITED=nm;Zu.ENTERING=rm;Zu.ENTERED=M_;Zu.EXITING=Bk;function $0e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E5(t,e){var r=function(d){return e&&Y.isValidElement(d)?e(d):d},s=Object.create(null);return t&&Y.Children.map(t,function(c){return c}).forEach(function(c){s[c.key]=r(c)}),s}function q0e(t,e){t=t||{},e=e||{};function r(M){return M in e?e[M]:t[M]}var s=Object.create(null),c=[];for(var d in t)d in e?c.length&&(s[d]=c,c=[]):c.push(d);var _,x={};for(var a in e){if(s[a])for(_=0;_<s[a].length;_++){var I=s[a][_];x[s[a][_]]=r(I)}x[a]=r(a)}for(_=0;_<c.length;_++)x[c[_]]=r(c[_]);return x}function pm(t,e,r){return r[e]!=null?r[e]:t.props[e]}function G0e(t,e){return E5(t.children,function(r){return Y.cloneElement(r,{onExited:e.bind(null,r),in:!0,appear:pm(r,"appear",t),enter:pm(r,"enter",t),exit:pm(r,"exit",t)})})}function W0e(t,e,r){var s=E5(t.children),c=q0e(e,s);return Object.keys(c).forEach(function(d){var _=c[d];if(Y.isValidElement(_)){var x=d in e,a=d in s,I=e[d],M=Y.isValidElement(I)&&!I.props.in;a&&(!x||M)?c[d]=Y.cloneElement(_,{onExited:r.bind(null,_),in:!0,exit:pm(_,"exit",t),enter:pm(_,"enter",t)}):!a&&x&&!M?c[d]=Y.cloneElement(_,{in:!1}):a&&x&&Y.isValidElement(I)&&(c[d]=Y.cloneElement(_,{onExited:r.bind(null,_),in:I.props.in,exit:pm(_,"exit",t),enter:pm(_,"enter",t)}))}}),c}var H0e=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},Z0e={component:"div",childFactory:function(e){return e}},S5=function(t){hH(e,t);function e(s,c){var d;d=t.call(this,s,c)||this;var _=d.handleExited.bind($0e(d));return d.state={contextValue:{isMounting:!0},handleExited:_,firstRender:!0},d}var r=e.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(c,d){var _=d.children,x=d.handleExited,a=d.firstRender;return{children:a?G0e(c,x):W0e(c,_,x),firstRender:!1}},r.handleExited=function(c,d){var _=E5(this.props.children);c.key in _||(c.props.onExited&&c.props.onExited(d),this.mounted&&this.setState(function(x){var a=NS({},x.children);return delete a[c.key],{children:a}}))},r.render=function(){var c=this.props,d=c.component,_=c.childFactory,x=uH(c,["component","childFactory"]),a=this.state.contextValue,I=H0e(this.state.children).map(_);return delete x.appear,delete x.enter,delete x.exit,d===null?Gr.createElement($S.Provider,{value:a},I):Gr.createElement($S.Provider,{value:a},Gr.createElement(d,x,I))},e}(Gr.Component);S5.propTypes={};S5.defaultProps=Z0e;const dH=t=>t.scrollTop;function qS(t,e){const{timeout:r,easing:s,style:c={}}=t;return{duration:c.transitionDuration??(typeof r=="number"?r:r[e.mode]||0),easing:c.transitionTimingFunction??(typeof s=="object"?s[e.mode]:s),delay:c.transitionDelay}}function X0e(t){return Si("MuiPaper",t)}Ii("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const K0e=t=>{const{square:e,elevation:r,variant:s,classes:c}=t,d={root:["root",s,!e&&"rounded",s==="elevation"&&`elevation${r}`]};return Ri(d,X0e,c)},Q0e=Qn("div",{name:"MuiPaper",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],!r.square&&e.rounded,r.variant==="elevation"&&e[`elevation${r.elevation}`]]}})(ns(({theme:t})=>({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow"),variants:[{props:({ownerState:e})=>!e.square,style:{borderRadius:t.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(t.vars||t).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),Y0e=Y.forwardRef(function(e,r){var G;const s=rs({props:e,name:"MuiPaper"}),c=T5(),{className:d,component:_="div",elevation:x=1,square:a=!1,variant:I="elevation",...M}=s,D={...s,component:_,elevation:x,square:a,variant:I},L=K0e(D);return F.jsx(Q0e,{as:_,ownerState:D,className:kr(L.root,d),ref:r,...M,style:{...I==="elevation"&&{"--Paper-shadow":(c.vars||c).shadows[x],...c.vars&&{"--Paper-overlay":(G=c.vars.overlays)==null?void 0:G[x]},...!c.vars&&c.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${$l("#fff",Nk(x))}, ${$l("#fff",Nk(x))})`}},...M.style}})});function ql(t,e){const{className:r,elementType:s,ownerState:c,externalForwardedProps:d,getSlotOwnerState:_,internalForwardedProps:x,...a}=e,{component:I,slots:M={[t]:void 0},slotProps:D={[t]:void 0},...L}=d,G=M[t]||s,Q=oH(D[t],c),{props:{component:re,...ee},internalRef:U}=sH({className:r,...a,externalForwardedProps:t==="root"?L:void 0,externalSlotProps:Q}),H=Do(U,Q==null?void 0:Q.ref,e.ref),Z=_?_(ee):{},de={...c,...Z},ve=t==="root"?re||I:re,Ee=rH(G,{...t==="root"&&!I&&!M[t]&&x,...t!=="root"&&!M[t]&&x,...ee,...ve&&{as:ve},ref:H},de);return Object.keys(Z).forEach(ie=>{delete Ee[ie]}),[G,Ee]}class GS{constructor(){Mv(this,"mountEffect",()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())});this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}static create(){return new GS}static use(){const e=JW(GS.create).current,[r,s]=Y.useState(!1);return e.shouldMount=r,e.setShouldMount=s,Y.useEffect(e.mountEffect,[r]),e}mount(){return this.mounted||(this.mounted=eve(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}start(...e){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.start(...e)})}stop(...e){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.stop(...e)})}pulsate(...e){this.mount().then(()=>{var r;return(r=this.ref.current)==null?void 0:r.pulsate(...e)})}}function J0e(){return GS.use()}function eve(){let t,e;const r=new Promise((s,c)=>{t=s,e=c});return r.resolve=t,r.reject=e,r}function tve(t){const{className:e,classes:r,pulsate:s=!1,rippleX:c,rippleY:d,rippleSize:_,in:x,onExited:a,timeout:I}=t,[M,D]=Y.useState(!1),L=kr(e,r.ripple,r.rippleVisible,s&&r.ripplePulsate),G={width:_,height:_,top:-(_/2)+d,left:-(_/2)+c},Q=kr(r.child,M&&r.childLeaving,s&&r.childPulsate);return!x&&!M&&D(!0),Y.useEffect(()=>{if(!x&&a!=null){const re=setTimeout(a,I);return()=>{clearTimeout(re)}}},[a,x,I]),F.jsx("span",{className:L,style:G,children:F.jsx("span",{className:Q})})}const Fl=Ii("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),jk=550,nve=80,rve=l5`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,ive=l5`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,sve=l5`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,ove=Qn("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),ave=Qn(tve,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${Fl.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${rve};
    animation-duration: ${jk}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  &.${Fl.ripplePulsate} {
    animation-duration: ${({theme:t})=>t.transitions.duration.shorter}ms;
  }

  & .${Fl.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${Fl.childLeaving} {
    opacity: 0;
    animation-name: ${ive};
    animation-duration: ${jk}ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
  }

  & .${Fl.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${sve};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:t})=>t.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,lve=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiTouchRipple"}),{center:c=!1,classes:d={},className:_,...x}=s,[a,I]=Y.useState([]),M=Y.useRef(0),D=Y.useRef(null);Y.useEffect(()=>{D.current&&(D.current(),D.current=null)},[a]);const L=Y.useRef(!1),G=eH(),Q=Y.useRef(null),re=Y.useRef(null),ee=Y.useCallback(de=>{const{pulsate:ve,rippleX:Ee,rippleY:ie,rippleSize:ue,cb:K}=de;I(ge=>[...ge,F.jsx(ave,{classes:{ripple:kr(d.ripple,Fl.ripple),rippleVisible:kr(d.rippleVisible,Fl.rippleVisible),ripplePulsate:kr(d.ripplePulsate,Fl.ripplePulsate),child:kr(d.child,Fl.child),childLeaving:kr(d.childLeaving,Fl.childLeaving),childPulsate:kr(d.childPulsate,Fl.childPulsate)},timeout:jk,pulsate:ve,rippleX:Ee,rippleY:ie,rippleSize:ue},M.current)]),M.current+=1,D.current=K},[d]),U=Y.useCallback((de={},ve={},Ee=()=>{})=>{const{pulsate:ie=!1,center:ue=c||ve.pulsate,fakeElement:K=!1}=ve;if((de==null?void 0:de.type)==="mousedown"&&L.current){L.current=!1;return}(de==null?void 0:de.type)==="touchstart"&&(L.current=!0);const ge=K?null:re.current,_e=ge?ge.getBoundingClientRect():{width:0,height:0,left:0,top:0};let Se,xe,wt;if(ue||de===void 0||de.clientX===0&&de.clientY===0||!de.clientX&&!de.touches)Se=Math.round(_e.width/2),xe=Math.round(_e.height/2);else{const{clientX:ft,clientY:Tt}=de.touches&&de.touches.length>0?de.touches[0]:de;Se=Math.round(ft-_e.left),xe=Math.round(Tt-_e.top)}if(ue)wt=Math.sqrt((2*_e.width**2+_e.height**2)/3),wt%2===0&&(wt+=1);else{const ft=Math.max(Math.abs((ge?ge.clientWidth:0)-Se),Se)*2+2,Tt=Math.max(Math.abs((ge?ge.clientHeight:0)-xe),xe)*2+2;wt=Math.sqrt(ft**2+Tt**2)}de!=null&&de.touches?Q.current===null&&(Q.current=()=>{ee({pulsate:ie,rippleX:Se,rippleY:xe,rippleSize:wt,cb:Ee})},G.start(nve,()=>{Q.current&&(Q.current(),Q.current=null)})):ee({pulsate:ie,rippleX:Se,rippleY:xe,rippleSize:wt,cb:Ee})},[c,ee,G]),H=Y.useCallback(()=>{U({},{pulsate:!0})},[U]),Z=Y.useCallback((de,ve)=>{if(G.clear(),(de==null?void 0:de.type)==="touchend"&&Q.current){Q.current(),Q.current=null,G.start(0,()=>{Z(de,ve)});return}Q.current=null,I(Ee=>Ee.length>0?Ee.slice(1):Ee),D.current=ve},[G]);return Y.useImperativeHandle(r,()=>({pulsate:H,start:U,stop:Z}),[H,U,Z]),F.jsx(ove,{className:kr(Fl.root,d.root,_),ref:re,...x,children:F.jsx(S5,{component:null,exit:!0,children:a})})});function cve(t){return Si("MuiButtonBase",t)}const uve=Ii("MuiButtonBase",["root","disabled","focusVisible"]),hve=t=>{const{disabled:e,focusVisible:r,focusVisibleClassName:s,classes:c}=t,_=Ri({root:["root",e&&"disabled",r&&"focusVisible"]},cve,c);return r&&s&&(_.root+=` ${s}`),_},dve=Qn("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(t,e)=>e.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${uve.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),I5=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiButtonBase"}),{action:c,centerRipple:d=!1,children:_,className:x,component:a="button",disabled:I=!1,disableRipple:M=!1,disableTouchRipple:D=!1,focusRipple:L=!1,focusVisibleClassName:G,LinkComponent:Q="a",onBlur:re,onClick:ee,onContextMenu:U,onDragLeave:H,onFocus:Z,onFocusVisible:de,onKeyDown:ve,onKeyUp:Ee,onMouseDown:ie,onMouseLeave:ue,onMouseUp:K,onTouchEnd:ge,onTouchMove:_e,onTouchStart:Se,tabIndex:xe=0,TouchRippleProps:wt,touchRippleRef:ft,type:Tt,...gt}=s,at=Y.useRef(null),bt=J0e(),Zt=Do(bt.ref,ft),[tt,Et]=Y.useState(!1);I&&tt&&Et(!1),Y.useImperativeHandle(c,()=>({focusVisible:()=>{Et(!0),at.current.focus()}}),[]);const mt=bt.shouldMount&&!M&&!I;Y.useEffect(()=>{tt&&L&&!M&&bt.pulsate()},[M,L,tt,bt]);function Vt(st,zt,ln=D){return H_(Ht=>(zt&&zt(Ht),ln||bt[st](Ht),!0))}const Pt=Vt("start",ie),pn=Vt("stop",U),dn=Vt("stop",H),yn=Vt("stop",K),Mt=Vt("stop",st=>{tt&&st.preventDefault(),ue&&ue(st)}),cn=Vt("start",Se),Yt=Vt("stop",ge),Tn=Vt("stop",_e),xr=Vt("stop",st=>{tV(st.target)||Et(!1),re&&re(st)},!1),On=H_(st=>{at.current||(at.current=st.currentTarget),tV(st.target)&&(Et(!0),de&&de(st)),Z&&Z(st)}),fr=()=>{const st=at.current;return a&&a!=="button"&&!(st.tagName==="A"&&st.href)},Lr=H_(st=>{L&&!st.repeat&&tt&&st.key===" "&&bt.stop(st,()=>{bt.start(st)}),st.target===st.currentTarget&&fr()&&st.key===" "&&st.preventDefault(),ve&&ve(st),st.target===st.currentTarget&&fr()&&st.key==="Enter"&&!I&&(st.preventDefault(),ee&&ee(st))}),or=H_(st=>{L&&st.key===" "&&tt&&!st.defaultPrevented&&bt.stop(st,()=>{bt.pulsate(st)}),Ee&&Ee(st),ee&&st.target===st.currentTarget&&fr()&&st.key===" "&&!st.defaultPrevented&&ee(st)});let Yn=a;Yn==="button"&&(gt.href||gt.to)&&(Yn=Q);const ke={};Yn==="button"?(ke.type=Tt===void 0?"button":Tt,ke.disabled=I):(!gt.href&&!gt.to&&(ke.role="button"),I&&(ke["aria-disabled"]=I));const He=Do(r,at),lt={...s,centerRipple:d,component:a,disabled:I,disableRipple:M,disableTouchRipple:D,focusRipple:L,tabIndex:xe,focusVisible:tt},Ke=hve(lt);return F.jsxs(dve,{as:Yn,className:kr(Ke.root,x),ownerState:lt,onBlur:xr,onClick:ee,onContextMenu:pn,onFocus:On,onKeyDown:Lr,onKeyUp:or,onMouseDown:Pt,onMouseLeave:Mt,onMouseUp:yn,onDragLeave:dn,onTouchEnd:Yt,onTouchMove:Tn,onTouchStart:cn,ref:He,tabIndex:I?-1:xe,type:Tt,...ke,...gt,children:[_,mt?F.jsx(lve,{ref:Zt,center:d,...wt}):null]})});function fve(t){return Si("MuiIconButton",t)}const pve=Ii("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]),mve=t=>{const{classes:e,disabled:r,color:s,edge:c,size:d}=t,_={root:["root",r&&"disabled",s!=="default"&&`color${Kn(s)}`,c&&`edge${Kn(c)}`,`size${Kn(d)}`]};return Ri(_,fve,e)},gve=Qn(I5,{name:"MuiIconButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.color!=="default"&&e[`color${Kn(r.color)}`],r.edge&&e[`edge${Kn(r.edge)}`],e[`size${Kn(r.size)}`]]}})(ns(({theme:t})=>({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),variants:[{props:{disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:$l(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}},{props:{edge:"start"},style:{marginLeft:-12}},{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:{edge:"end"},style:{marginRight:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}}]})),ns(({theme:t})=>({variants:[{props:{color:"inherit"},style:{color:"inherit"}},...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{color:(t.vars||t).palette[e].main}})),...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${(t.vars||t).palette[e].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:$l((t.vars||t).palette[e].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}}})),{props:{size:"small"},style:{padding:5,fontSize:t.typography.pxToRem(18)}},{props:{size:"large"},style:{padding:12,fontSize:t.typography.pxToRem(28)}}],[`&.${pve.disabled}`]:{backgroundColor:"transparent",color:(t.vars||t).palette.action.disabled}}))),mm=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiIconButton"}),{edge:c=!1,children:d,className:_,color:x="default",disabled:a=!1,disableFocusRipple:I=!1,disableRipple:M=!1,size:D="medium",...L}=s,G={...s,edge:c,color:x,disabled:a,disableFocusRipple:I,disableRipple:M,size:D},Q=mve(G);return F.jsx(gve,{className:kr(Q.root,_),centerRipple:!0,focusRipple:!I,disabled:a,disableRipple:M,ref:r,...L,ownerState:G,children:d})});function _ve(t){return Si("MuiTypography",t)}Ii("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const yve={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},vve=F0e(),xve=t=>{const{align:e,gutterBottom:r,noWrap:s,paragraph:c,variant:d,classes:_}=t,x={root:["root",d,t.align!=="inherit"&&`align${Kn(e)}`,r&&"gutterBottom",s&&"noWrap",c&&"paragraph"]};return Ri(x,_ve,_)},bve=Qn("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.variant&&e[r.variant],r.align!=="inherit"&&e[`align${Kn(r.align)}`],r.noWrap&&e.noWrap,r.gutterBottom&&e.gutterBottom,r.paragraph&&e.paragraph]}})(ns(({theme:t})=>{var e;return{margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(t.typography).filter(([r,s])=>r!=="inherit"&&s&&typeof s=="object").map(([r,s])=>({props:{variant:r},style:s})),...Object.entries(t.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{color:(t.vars||t).palette[r].main}})),...Object.entries(((e=t.palette)==null?void 0:e.text)||{}).filter(([,r])=>typeof r=="string").map(([r])=>({props:{color:`text${Kn(r)}`},style:{color:(t.vars||t).palette.text[r]}})),{props:({ownerState:r})=>r.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:r})=>r.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:r})=>r.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:r})=>r.paragraph,style:{marginBottom:16}}]}})),dV={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},fV=Y.forwardRef(function(e,r){const{color:s,...c}=rs({props:e,name:"MuiTypography"}),d=!yve[s],_=vve({...c,...d&&{color:s}}),{align:x="inherit",className:a,component:I,gutterBottom:M=!1,noWrap:D=!1,paragraph:L=!1,variant:G="body1",variantMapping:Q=dV,...re}=_,ee={..._,align:x,color:s,className:a,component:I,gutterBottom:M,noWrap:D,paragraph:L,variant:G,variantMapping:Q},U=I||(L?"p":Q[G]||dV[G])||"span",H=xve(ee);return F.jsx(bve,{as:U,ref:r,className:kr(H.root,a),...re,ownerState:ee,style:{...x!=="inherit"&&{"--Typography-textAlign":x},...re.style}})});function wve(t){return typeof t=="function"?t():t}const Tve=Y.forwardRef(function(e,r){const{children:s,container:c,disablePortal:d=!1}=e,[_,x]=Y.useState(null),a=Do(mb(s),r);if(Um(()=>{d||x(wve(c)||document.body)},[c,d]),Um(()=>{if(_&&!d)return Lk(r,_),()=>{Lk(r,null)}},[r,_,d]),d){if(Y.isValidElement(s)){const I={ref:a};return Y.cloneElement(s,I)}return F.jsx(Y.Fragment,{children:s})}return F.jsx(Y.Fragment,{children:_&&II.createPortal(s,_)})});function XT(t){return parseInt(t,10)||0}const Eve={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function Sve(t){return t==null||Object.keys(t).length===0||t.outerHeightStyle===0&&!t.overflowing}const Ive=Y.forwardRef(function(e,r){const{onChange:s,maxRows:c,minRows:d=1,style:_,value:x,...a}=e,{current:I}=Y.useRef(x!=null),M=Y.useRef(null),D=Do(r,M),L=Y.useRef(null),G=Y.useRef(null),Q=Y.useCallback(()=>{const U=M.current,Z=Vm(U).getComputedStyle(U);if(Z.width==="0px")return{outerHeightStyle:0,overflowing:!1};const de=G.current;de.style.width=Z.width,de.value=U.value||e.placeholder||"x",de.value.slice(-1)===`
`&&(de.value+=" ");const ve=Z.boxSizing,Ee=XT(Z.paddingBottom)+XT(Z.paddingTop),ie=XT(Z.borderBottomWidth)+XT(Z.borderTopWidth),ue=de.scrollHeight;de.value="x";const K=de.scrollHeight;let ge=ue;d&&(ge=Math.max(Number(d)*K,ge)),c&&(ge=Math.min(Number(c)*K,ge)),ge=Math.max(ge,K);const _e=ge+(ve==="border-box"?Ee+ie:0),Se=Math.abs(ge-ue)<=1;return{outerHeightStyle:_e,overflowing:Se}},[c,d,e.placeholder]),re=Y.useCallback(()=>{const U=Q();if(Sve(U))return;const H=U.outerHeightStyle,Z=M.current;L.current!==H&&(L.current=H,Z.style.height=`${H}px`),Z.style.overflow=U.overflowing?"hidden":""},[Q]);Um(()=>{const U=()=>{re()};let H;const Z=YW(U),de=M.current,ve=Vm(de);ve.addEventListener("resize",Z);let Ee;return typeof ResizeObserver<"u"&&(Ee=new ResizeObserver(U),Ee.observe(de)),()=>{Z.clear(),cancelAnimationFrame(H),ve.removeEventListener("resize",Z),Ee&&Ee.disconnect()}},[Q,re]),Um(()=>{re()});const ee=U=>{I||re(),s&&s(U)};return F.jsxs(Y.Fragment,{children:[F.jsx("textarea",{value:x,onChange:ee,ref:D,rows:d,style:_,...a}),F.jsx("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:G,tabIndex:-1,style:{...Eve.shadow,..._,paddingTop:0,paddingBottom:0}})]})});function Uk(t){return typeof t=="string"}function Yf({props:t,states:e,muiFormControl:r}){return e.reduce((s,c)=>(s[c]=t[c],r&&typeof t[c]>"u"&&(s[c]=r[c]),s),{})}const C5=Y.createContext(void 0);function sd(){return Y.useContext(C5)}function pV(t){return t!=null&&!(Array.isArray(t)&&t.length===0)}function WS(t,e=!1){return t&&(pV(t.value)&&t.value!==""||e&&pV(t.defaultValue)&&t.defaultValue!=="")}function Cve(t){return t.startAdornment}function Ave(t){return Si("MuiInputBase",t)}const zy=Ii("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var mV;const qC=(t,e)=>{const{ownerState:r}=t;return[e.root,r.formControl&&e.formControl,r.startAdornment&&e.adornedStart,r.endAdornment&&e.adornedEnd,r.error&&e.error,r.size==="small"&&e.sizeSmall,r.multiline&&e.multiline,r.color&&e[`color${Kn(r.color)}`],r.fullWidth&&e.fullWidth,r.hiddenLabel&&e.hiddenLabel]},GC=(t,e)=>{const{ownerState:r}=t;return[e.input,r.size==="small"&&e.inputSizeSmall,r.multiline&&e.inputMultiline,r.type==="search"&&e.inputTypeSearch,r.startAdornment&&e.inputAdornedStart,r.endAdornment&&e.inputAdornedEnd,r.hiddenLabel&&e.inputHiddenLabel]},Pve=t=>{const{classes:e,color:r,disabled:s,error:c,endAdornment:d,focused:_,formControl:x,fullWidth:a,hiddenLabel:I,multiline:M,readOnly:D,size:L,startAdornment:G,type:Q}=t,re={root:["root",`color${Kn(r)}`,s&&"disabled",c&&"error",a&&"fullWidth",_&&"focused",x&&"formControl",L&&L!=="medium"&&`size${Kn(L)}`,M&&"multiline",G&&"adornedStart",d&&"adornedEnd",I&&"hiddenLabel",D&&"readOnly"],input:["input",s&&"disabled",Q==="search"&&"inputTypeSearch",M&&"inputMultiline",L==="small"&&"inputSizeSmall",I&&"inputHiddenLabel",G&&"inputAdornedStart",d&&"inputAdornedEnd",D&&"readOnly"]};return Ri(re,Ave,e)},WC=Qn("div",{name:"MuiInputBase",slot:"Root",overridesResolver:qC})(ns(({theme:t})=>({...t.typography.body1,color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${zy.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:e})=>e.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:e,size:r})=>e.multiline&&r==="small",style:{paddingTop:1}},{props:({ownerState:e})=>e.fullWidth,style:{width:"100%"}}]}))),HC=Qn("input",{name:"MuiInputBase",slot:"Input",overridesResolver:GC})(ns(({theme:t})=>{const e=t.palette.mode==="light",r={color:"currentColor",...t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5},transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})},s={opacity:"0 !important"},c=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:e?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":r,"&::-moz-placeholder":r,"&::-ms-input-placeholder":r,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${zy.formControl} &`]:{"&::-webkit-input-placeholder":s,"&::-moz-placeholder":s,"&::-ms-input-placeholder":s,"&:focus::-webkit-input-placeholder":c,"&:focus::-moz-placeholder":c,"&:focus::-ms-input-placeholder":c},[`&.${zy.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},variants:[{props:({ownerState:d})=>!d.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:d})=>d.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),gV=N0e({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),Rve=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiInputBase"}),{"aria-describedby":c,autoComplete:d,autoFocus:_,className:x,color:a,components:I={},componentsProps:M={},defaultValue:D,disabled:L,disableInjectingGlobalStyles:G,endAdornment:Q,error:re,fullWidth:ee=!1,id:U,inputComponent:H="input",inputProps:Z={},inputRef:de,margin:ve,maxRows:Ee,minRows:ie,multiline:ue=!1,name:K,onBlur:ge,onChange:_e,onClick:Se,onFocus:xe,onKeyDown:wt,onKeyUp:ft,placeholder:Tt,readOnly:gt,renderSuffix:at,rows:bt,size:Zt,slotProps:tt={},slots:Et={},startAdornment:mt,type:Vt="text",value:Pt,...pn}=s,dn=Z.value!=null?Z.value:Pt,{current:yn}=Y.useRef(dn!=null),Mt=Y.useRef(),cn=Y.useCallback(ir=>{},[]),Yt=Do(Mt,de,Z.ref,cn),[Tn,xr]=Y.useState(!1),On=sd(),fr=Yf({props:s,muiFormControl:On,states:["color","disabled","error","hiddenLabel","size","required","filled"]});fr.focused=On?On.focused:Tn,Y.useEffect(()=>{!On&&L&&Tn&&(xr(!1),ge&&ge())},[On,L,Tn,ge]);const Lr=On&&On.onFilled,or=On&&On.onEmpty,Yn=Y.useCallback(ir=>{WS(ir)?Lr&&Lr():or&&or()},[Lr,or]);Um(()=>{yn&&Yn({value:dn})},[dn,Yn,yn]);const ke=ir=>{xe&&xe(ir),Z.onFocus&&Z.onFocus(ir),On&&On.onFocus?On.onFocus(ir):xr(!0)},He=ir=>{ge&&ge(ir),Z.onBlur&&Z.onBlur(ir),On&&On.onBlur?On.onBlur(ir):xr(!1)},lt=(ir,...Ci)=>{if(!yn){const is=ir.target||Mt.current;if(is==null)throw new Error(Qh(1));Yn({value:is.value})}Z.onChange&&Z.onChange(ir,...Ci),_e&&_e(ir,...Ci)};Y.useEffect(()=>{Yn(Mt.current)},[]);const Ke=ir=>{Mt.current&&ir.currentTarget===ir.target&&Mt.current.focus(),Se&&Se(ir)};let st=H,zt=Z;ue&&st==="input"&&(bt?zt={type:void 0,minRows:bt,maxRows:bt,...zt}:zt={type:void 0,maxRows:Ee,minRows:ie,...zt},st=Ive);const ln=ir=>{Yn(ir.animationName==="mui-auto-fill-cancel"?Mt.current:{value:"x"})};Y.useEffect(()=>{On&&On.setAdornedStart(!!mt)},[On,mt]);const Ht={...s,color:fr.color||"primary",disabled:fr.disabled,endAdornment:Q,error:fr.error,focused:fr.focused,formControl:On,fullWidth:ee,hiddenLabel:fr.hiddenLabel,multiline:ue,size:fr.size,startAdornment:mt,type:Vt},vn=Pve(Ht),Fn=Et.root||I.Root||WC,pr=tt.root||M.root||{},fi=Et.input||I.Input||HC;return zt={...zt,...tt.input??M.input},F.jsxs(Y.Fragment,{children:[!G&&typeof gV=="function"&&(mV||(mV=F.jsx(gV,{}))),F.jsxs(Fn,{...pr,ref:r,onClick:Ke,...pn,...!Uk(Fn)&&{ownerState:{...Ht,...pr.ownerState}},className:kr(vn.root,pr.className,x,gt&&"MuiInputBase-readOnly"),children:[mt,F.jsx(C5.Provider,{value:null,children:F.jsx(fi,{"aria-invalid":fr.error,"aria-describedby":c,autoComplete:d,autoFocus:_,defaultValue:D,disabled:fr.disabled,id:U,onAnimationStart:ln,name:K,placeholder:Tt,readOnly:gt,required:fr.required,rows:bt,value:dn,onKeyDown:wt,onKeyUp:ft,type:Vt,...zt,...!Uk(fi)&&{as:st,ownerState:{...Ht,...zt.ownerState}},ref:Yt,className:kr(vn.input,zt.className,gt&&"MuiInputBase-readOnly"),onBlur:He,onChange:lt,onFocus:ke})}),Q,at?at({...fr,startAdornment:mt}):null]})]})}),A5=Rve;function Mve(t){return Si("MuiInput",t)}const Gv={...zy,...Ii("MuiInput",["root","underline","input"])};function kve(t){return Si("MuiOutlinedInput",t)}const xu={...zy,...Ii("MuiOutlinedInput",["root","notchedOutline","input"])};function Ove(t){return Si("MuiFilledInput",t)}const Qp={...zy,...Ii("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},Dve=id(F.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),Lve={entering:{opacity:1},entered:{opacity:1}},zve=Y.forwardRef(function(e,r){const s=T5(),c={enter:s.transitions.duration.enteringScreen,exit:s.transitions.duration.leavingScreen},{addEndListener:d,appear:_=!0,children:x,easing:a,in:I,onEnter:M,onEntered:D,onEntering:L,onExit:G,onExited:Q,onExiting:re,style:ee,timeout:U=c,TransitionComponent:H=Zu,...Z}=e,de=Y.useRef(null),ve=Do(de,mb(x),r),Ee=wt=>ft=>{if(wt){const Tt=de.current;ft===void 0?wt(Tt):wt(Tt,ft)}},ie=Ee(L),ue=Ee((wt,ft)=>{dH(wt);const Tt=qS({style:ee,timeout:U,easing:a},{mode:"enter"});wt.style.webkitTransition=s.transitions.create("opacity",Tt),wt.style.transition=s.transitions.create("opacity",Tt),M&&M(wt,ft)}),K=Ee(D),ge=Ee(re),_e=Ee(wt=>{const ft=qS({style:ee,timeout:U,easing:a},{mode:"exit"});wt.style.webkitTransition=s.transitions.create("opacity",ft),wt.style.transition=s.transitions.create("opacity",ft),G&&G(wt)}),Se=Ee(Q),xe=wt=>{d&&d(de.current,wt)};return F.jsx(H,{appear:_,in:I,nodeRef:de,onEnter:ue,onEntered:K,onEntering:ie,onExit:_e,onExited:Se,onExiting:ge,addEndListener:xe,timeout:U,...Z,children:(wt,ft)=>Y.cloneElement(x,{style:{opacity:0,visibility:wt==="exited"&&!I?"hidden":void 0,...Lve[wt],...ee,...x.props.style},ref:ve,...ft})})});function Nve(t){return Si("MuiBackdrop",t)}Ii("MuiBackdrop",["root","invisible"]);const Fve=t=>{const{classes:e,invisible:r}=t;return Ri({root:["root",r&&"invisible"]},Nve,e)},Bve=Qn("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.invisible&&e.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),jve=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiBackdrop"}),{children:c,className:d,component:_="div",invisible:x=!1,open:a,components:I={},componentsProps:M={},slotProps:D={},slots:L={},TransitionComponent:G,transitionDuration:Q,...re}=s,ee={...s,component:_,invisible:x},U=Fve(ee),H={transition:G,root:I.Root,...L},Z={...M,...D},de={slots:H,slotProps:Z},[ve,Ee]=ql("root",{elementType:Bve,externalForwardedProps:de,className:kr(U.root,d),ownerState:ee}),[ie,ue]=ql("transition",{elementType:zve,externalForwardedProps:de,ownerState:ee});return delete ue.ownerState,F.jsx(ie,{in:a,timeout:Q,...re,...ue,children:F.jsx(ve,{"aria-hidden":!0,...Ee,classes:U,ref:r,children:c})})});function Uve(t){const{badgeContent:e,invisible:r=!1,max:s=99,showZero:c=!1}=t,d=nH({badgeContent:e,max:s});let _=r;r===!1&&e===0&&!c&&(_=!0);const{badgeContent:x,max:a=s}=_?d:t,I=x&&Number(x)>a?`${a}+`:x;return{badgeContent:x,invisible:_,max:a,displayValue:I}}function Vve(t){return Si("MuiBadge",t)}const Yd=Ii("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),IR=10,CR=4,$ve=t=>{const{color:e,anchorOrigin:r,invisible:s,overlap:c,variant:d,classes:_={}}=t,x={root:["root"],badge:["badge",d,s&&"invisible",`anchorOrigin${Kn(r.vertical)}${Kn(r.horizontal)}`,`anchorOrigin${Kn(r.vertical)}${Kn(r.horizontal)}${Kn(c)}`,`overlap${Kn(c)}`,e!=="default"&&`color${Kn(e)}`]};return Ri(x,Vve,_)},qve=Qn("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,e)=>e.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),Gve=Qn("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.badge,e[r.variant],e[`anchorOrigin${Kn(r.anchorOrigin.vertical)}${Kn(r.anchorOrigin.horizontal)}${Kn(r.overlap)}`],r.color!=="default"&&e[`color${Kn(r.color)}`],r.invisible&&e.invisible]}})(ns(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:IR*2,lineHeight:1,padding:"0 6px",height:IR*2,borderRadius:IR,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.entries(t.palette).filter(([,e])=>e&&e.main&&e.contrastText).map(([e])=>({props:{color:e},style:{backgroundColor:(t.vars||t).palette[e].main,color:(t.vars||t).palette[e].contrastText}})),{props:{variant:"dot"},style:{borderRadius:CR,height:CR*2,minWidth:CR*2,padding:0}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="right"&&e.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="top"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:e})=>e.anchorOrigin.vertical==="bottom"&&e.anchorOrigin.horizontal==="left"&&e.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${Yd.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]}))),Wve=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiBadge"}),{anchorOrigin:c={vertical:"top",horizontal:"right"},className:d,classes:_,component:x,components:a={},componentsProps:I={},children:M,overlap:D="rectangular",color:L="default",invisible:G=!1,max:Q=99,badgeContent:re,slots:ee,slotProps:U,showZero:H=!1,variant:Z="standard",...de}=s,{badgeContent:ve,invisible:Ee,max:ie,displayValue:ue}=Uve({max:Q,invisible:G,badgeContent:re,showZero:H}),K=nH({anchorOrigin:c,color:L,overlap:D,variant:Z,badgeContent:re}),ge=Ee||ve==null&&Z!=="dot",{color:_e=L,overlap:Se=D,anchorOrigin:xe=c,variant:wt=Z}=ge?K:s,ft=wt!=="dot"?ue:void 0,Tt={...s,badgeContent:ve,invisible:ge,max:ie,displayValue:ft,showZero:H,anchorOrigin:xe,color:_e,overlap:Se,variant:wt},gt=$ve(Tt),at=(ee==null?void 0:ee.root)??a.Root??qve,bt=(ee==null?void 0:ee.badge)??a.Badge??Gve,Zt=(U==null?void 0:U.root)??I.root,tt=(U==null?void 0:U.badge)??I.badge,Et=US({elementType:at,externalSlotProps:Zt,externalForwardedProps:de,additionalProps:{ref:r,as:x},ownerState:Tt,className:kr(Zt==null?void 0:Zt.className,gt.root,d)}),mt=US({elementType:bt,externalSlotProps:tt,ownerState:Tt,className:kr(gt.badge,tt==null?void 0:tt.className)});return F.jsxs(at,{...Et,children:[M,F.jsx(bt,{...mt,children:ft})]})});function Hve(t){return Si("MuiButton",t)}const S_=Ii("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),Zve=Y.createContext({}),Xve=Y.createContext(void 0),Kve=t=>{const{color:e,disableElevation:r,fullWidth:s,size:c,variant:d,classes:_}=t,x={root:["root",d,`${d}${Kn(e)}`,`size${Kn(c)}`,`${d}Size${Kn(c)}`,`color${Kn(e)}`,r&&"disableElevation",s&&"fullWidth"],label:["label"],startIcon:["icon","startIcon",`iconSize${Kn(c)}`],endIcon:["icon","endIcon",`iconSize${Kn(c)}`]},a=Ri(x,Hve,_);return{..._,...a}},fH=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],Qve=Qn(I5,{shouldForwardProp:t=>Ga(t)||t==="classes",name:"MuiButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],e[`${r.variant}${Kn(r.color)}`],e[`size${Kn(r.size)}`],e[`${r.variant}Size${Kn(r.size)}`],r.color==="inherit"&&e.colorInherit,r.disableElevation&&e.disableElevation,r.fullWidth&&e.fullWidth]}})(ns(({theme:t})=>{var s,c;const e=t.palette.mode==="light"?t.palette.grey[300]:t.palette.grey[800],r=t.palette.mode==="light"?t.palette.grey.A100:t.palette.grey[700];return{...t.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${S_.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(t.vars||t).shadows[2],"&:hover":{boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2]}},"&:active":{boxShadow:(t.vars||t).shadows[8]},[`&.${S_.focusVisible}`]:{boxShadow:(t.vars||t).shadows[6]},[`&.${S_.disabled}`]:{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${S_.disabled}`]:{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(t.palette).filter(([,d])=>d&&d.main&&d.dark&&d.contrastText).map(([d])=>({props:{color:d},style:{"--variant-textColor":(t.vars||t).palette[d].main,"--variant-outlinedColor":(t.vars||t).palette[d].main,"--variant-outlinedBorder":t.vars?`rgba(${t.vars.palette[d].mainChannel} / 0.5)`:$l(t.palette[d].main,.5),"--variant-containedColor":(t.vars||t).palette[d].contrastText,"--variant-containedBg":(t.vars||t).palette[d].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(t.vars||t).palette[d].dark,"--variant-textBg":t.vars?`rgba(${t.vars.palette[d].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:$l(t.palette[d].main,t.palette.action.hoverOpacity),"--variant-outlinedBorder":(t.vars||t).palette[d].main,"--variant-outlinedBg":t.vars?`rgba(${t.vars.palette[d].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:$l(t.palette[d].main,t.palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{"--variant-containedColor":t.vars?t.vars.palette.text.primary:(c=(s=t.palette).getContrastText)==null?void 0:c.call(s,e),"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedBg:e,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":t.vars?t.vars.palette.Button.inheritContainedHoverBg:r,"--variant-textBg":t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:$l(t.palette.text.primary,t.palette.action.hoverOpacity),"--variant-outlinedBg":t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:$l(t.palette.text.primary,t.palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:t.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:t.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:t.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${S_.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${S_.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}}]}})),Yve=Qn("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.startIcon,e[`iconSize${Kn(r.size)}`]]}})({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},...fH]}),Jve=Qn("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.endIcon,e[`iconSize${Kn(r.size)}`]]}})({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},...fH]}),Z_=Y.forwardRef(function(e,r){const s=Y.useContext(Zve),c=Y.useContext(Xve),d=Ax(s,e),_=rs({props:d,name:"MuiButton"}),{children:x,color:a="primary",component:I="button",className:M,disabled:D=!1,disableElevation:L=!1,disableFocusRipple:G=!1,endIcon:Q,focusVisibleClassName:re,fullWidth:ee=!1,size:U="medium",startIcon:H,type:Z,variant:de="text",...ve}=_,Ee={..._,color:a,component:I,disabled:D,disableElevation:L,disableFocusRipple:G,fullWidth:ee,size:U,type:Z,variant:de},ie=Kve(Ee),ue=H&&F.jsx(Yve,{className:ie.startIcon,ownerState:Ee,children:H}),K=Q&&F.jsx(Jve,{className:ie.endIcon,ownerState:Ee,children:Q}),ge=c||"";return F.jsxs(Qve,{ownerState:Ee,className:kr(s.className,ie.root,M,ge),component:I,disabled:D,focusRipple:!G,focusVisibleClassName:kr(ie.focusVisible,re),ref:r,type:Z,...ve,classes:ie,children:[ue,x,K]})});function e1e(t){return Si("PrivateSwitchBase",t)}Ii("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const t1e=t=>{const{classes:e,checked:r,disabled:s,edge:c}=t,d={root:["root",r&&"checked",s&&"disabled",c&&`edge${Kn(c)}`],input:["input"]};return Ri(d,e1e,e)},n1e=Qn(I5)({padding:9,borderRadius:"50%",variants:[{props:{edge:"start",size:"small"},style:{marginLeft:-3}},{props:({edge:t,ownerState:e})=>t==="start"&&e.size!=="small",style:{marginLeft:-12}},{props:{edge:"end",size:"small"},style:{marginRight:-3}},{props:({edge:t,ownerState:e})=>t==="end"&&e.size!=="small",style:{marginRight:-12}}]}),r1e=Qn("input",{shouldForwardProp:Ga})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),i1e=Y.forwardRef(function(e,r){const{autoFocus:s,checked:c,checkedIcon:d,className:_,defaultChecked:x,disabled:a,disableFocusRipple:I=!1,edge:M=!1,icon:D,id:L,inputProps:G,inputRef:Q,name:re,onBlur:ee,onChange:U,onFocus:H,readOnly:Z,required:de=!1,tabIndex:ve,type:Ee,value:ie,...ue}=e,[K,ge]=jS({controlled:c,default:!!x,name:"SwitchBase",state:"checked"}),_e=sd(),Se=bt=>{H&&H(bt),_e&&_e.onFocus&&_e.onFocus(bt)},xe=bt=>{ee&&ee(bt),_e&&_e.onBlur&&_e.onBlur(bt)},wt=bt=>{if(bt.nativeEvent.defaultPrevented)return;const Zt=bt.target.checked;ge(Zt),U&&U(bt,Zt)};let ft=a;_e&&typeof ft>"u"&&(ft=_e.disabled);const Tt=Ee==="checkbox"||Ee==="radio",gt={...e,checked:K,disabled:ft,disableFocusRipple:I,edge:M},at=t1e(gt);return F.jsxs(n1e,{component:"span",className:kr(at.root,_),centerRipple:!0,focusRipple:!I,disabled:ft,tabIndex:null,role:void 0,onFocus:Se,onBlur:xe,ownerState:gt,ref:r,...ue,children:[F.jsx(r1e,{autoFocus:s,checked:c,defaultChecked:x,className:at.input,disabled:ft,id:Tt?L:void 0,name:re,onChange:wt,readOnly:Z,ref:Q,required:de,ownerState:gt,tabIndex:ve,type:Ee,...Ee==="checkbox"&&ie===void 0?{}:{value:ie},...G}),K?d:D]})});function s1e(t){const e=ml(t);return e.body===t?Vm(t).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function z1(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function _V(t){return parseInt(Vm(t).getComputedStyle(t).paddingRight,10)||0}function o1e(t){const r=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(t.tagName)!==-1,s=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return r||s}function yV(t,e,r,s,c){const d=[e,r,...s];[].forEach.call(t.children,_=>{const x=d.indexOf(_)===-1,a=!o1e(_);x&&a&&z1(_,c)})}function AR(t,e){let r=-1;return t.some((s,c)=>e(s)?(r=c,!0):!1),r}function a1e(t,e){const r=[],s=t.container;if(!e.disableScrollLock){if(s1e(s)){const _=tH(ml(s));r.push({value:s.style.paddingRight,property:"padding-right",el:s}),s.style.paddingRight=`${_V(s)+_}px`;const x=ml(s).querySelectorAll(".mui-fixed");[].forEach.call(x,a=>{r.push({value:a.style.paddingRight,property:"padding-right",el:a}),a.style.paddingRight=`${_V(a)+_}px`})}let d;if(s.parentNode instanceof DocumentFragment)d=ml(s).body;else{const _=s.parentElement,x=Vm(s);d=(_==null?void 0:_.nodeName)==="HTML"&&x.getComputedStyle(_).overflowY==="scroll"?_:s}r.push({value:d.style.overflow,property:"overflow",el:d},{value:d.style.overflowX,property:"overflow-x",el:d},{value:d.style.overflowY,property:"overflow-y",el:d}),d.style.overflow="hidden"}return()=>{r.forEach(({value:d,el:_,property:x})=>{d?_.style.setProperty(x,d):_.style.removeProperty(x)})}}function l1e(t){const e=[];return[].forEach.call(t.children,r=>{r.getAttribute("aria-hidden")==="true"&&e.push(r)}),e}class c1e{constructor(){this.modals=[],this.containers=[]}add(e,r){let s=this.modals.indexOf(e);if(s!==-1)return s;s=this.modals.length,this.modals.push(e),e.modalRef&&z1(e.modalRef,!1);const c=l1e(r);yV(r,e.mount,e.modalRef,c,!0);const d=AR(this.containers,_=>_.container===r);return d!==-1?(this.containers[d].modals.push(e),s):(this.containers.push({modals:[e],container:r,restore:null,hiddenSiblings:c}),s)}mount(e,r){const s=AR(this.containers,d=>d.modals.indexOf(e)!==-1),c=this.containers[s];c.restore||(c.restore=a1e(c,r))}remove(e,r=!0){const s=this.modals.indexOf(e);if(s===-1)return s;const c=AR(this.containers,_=>_.modals.indexOf(e)!==-1),d=this.containers[c];if(d.modals.splice(d.modals.indexOf(e),1),this.modals.splice(s,1),d.modals.length===0)d.restore&&d.restore(),e.modalRef&&z1(e.modalRef,r),yV(d.container,e.mount,e.modalRef,d.hiddenSiblings,!1),this.containers.splice(c,1);else{const _=d.modals[d.modals.length-1];_.modalRef&&z1(_.modalRef,!1)}return s}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}const u1e=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function h1e(t){const e=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(e)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:e}function d1e(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const e=s=>t.ownerDocument.querySelector(`input[type="radio"]${s}`);let r=e(`[name="${t.name}"]:checked`);return r||(r=e(`[name="${t.name}"]`)),r!==t}function f1e(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||d1e(t))}function p1e(t){const e=[],r=[];return Array.from(t.querySelectorAll(u1e)).forEach((s,c)=>{const d=h1e(s);d===-1||!f1e(s)||(d===0?e.push(s):r.push({documentOrder:c,tabIndex:d,node:s}))}),r.sort((s,c)=>s.tabIndex===c.tabIndex?s.documentOrder-c.documentOrder:s.tabIndex-c.tabIndex).map(s=>s.node).concat(e)}function m1e(){return!0}function g1e(t){const{children:e,disableAutoFocus:r=!1,disableEnforceFocus:s=!1,disableRestoreFocus:c=!1,getTabbable:d=p1e,isEnabled:_=m1e,open:x}=t,a=Y.useRef(!1),I=Y.useRef(null),M=Y.useRef(null),D=Y.useRef(null),L=Y.useRef(null),G=Y.useRef(!1),Q=Y.useRef(null),re=Do(mb(e),Q),ee=Y.useRef(null);Y.useEffect(()=>{!x||!Q.current||(G.current=!r)},[r,x]),Y.useEffect(()=>{if(!x||!Q.current)return;const Z=ml(Q.current);return Q.current.contains(Z.activeElement)||(Q.current.hasAttribute("tabIndex")||Q.current.setAttribute("tabIndex","-1"),G.current&&Q.current.focus()),()=>{c||(D.current&&D.current.focus&&(a.current=!0,D.current.focus()),D.current=null)}},[x]),Y.useEffect(()=>{if(!x||!Q.current)return;const Z=ml(Q.current),de=ie=>{ee.current=ie,!(s||!_()||ie.key!=="Tab")&&Z.activeElement===Q.current&&ie.shiftKey&&(a.current=!0,M.current&&M.current.focus())},ve=()=>{var K,ge;const ie=Q.current;if(ie===null)return;if(!Z.hasFocus()||!_()||a.current){a.current=!1;return}if(ie.contains(Z.activeElement)||s&&Z.activeElement!==I.current&&Z.activeElement!==M.current)return;if(Z.activeElement!==L.current)L.current=null;else if(L.current!==null)return;if(!G.current)return;let ue=[];if((Z.activeElement===I.current||Z.activeElement===M.current)&&(ue=d(Q.current)),ue.length>0){const _e=!!((K=ee.current)!=null&&K.shiftKey&&((ge=ee.current)==null?void 0:ge.key)==="Tab"),Se=ue[0],xe=ue[ue.length-1];typeof Se!="string"&&typeof xe!="string"&&(_e?xe.focus():Se.focus())}else ie.focus()};Z.addEventListener("focusin",ve),Z.addEventListener("keydown",de,!0);const Ee=setInterval(()=>{Z.activeElement&&Z.activeElement.tagName==="BODY"&&ve()},50);return()=>{clearInterval(Ee),Z.removeEventListener("focusin",ve),Z.removeEventListener("keydown",de,!0)}},[r,s,c,_,x,d]);const U=Z=>{D.current===null&&(D.current=Z.relatedTarget),G.current=!0,L.current=Z.target;const de=e.props.onFocus;de&&de(Z)},H=Z=>{D.current===null&&(D.current=Z.relatedTarget),G.current=!0};return F.jsxs(Y.Fragment,{children:[F.jsx("div",{tabIndex:x?0:-1,onFocus:H,ref:I,"data-testid":"sentinelStart"}),Y.cloneElement(e,{ref:re,onFocus:U}),F.jsx("div",{tabIndex:x?0:-1,onFocus:H,ref:M,"data-testid":"sentinelEnd"})]})}function _1e(t){return typeof t=="function"?t():t}function y1e(t){return t?t.props.hasOwnProperty("in"):!1}const v1e=new c1e;function x1e(t){const{container:e,disableEscapeKeyDown:r=!1,disableScrollLock:s=!1,manager:c=v1e,closeAfterTransition:d=!1,onTransitionEnter:_,onTransitionExited:x,children:a,onClose:I,open:M,rootRef:D}=t,L=Y.useRef({}),G=Y.useRef(null),Q=Y.useRef(null),re=Do(Q,D),[ee,U]=Y.useState(!M),H=y1e(a);let Z=!0;(t["aria-hidden"]==="false"||t["aria-hidden"]===!1)&&(Z=!1);const de=()=>ml(G.current),ve=()=>(L.current.modalRef=Q.current,L.current.mount=G.current,L.current),Ee=()=>{c.mount(ve(),{disableScrollLock:s}),Q.current&&(Q.current.scrollTop=0)},ie=H_(()=>{const Tt=_1e(e)||de().body;c.add(ve(),Tt),Q.current&&Ee()}),ue=Y.useCallback(()=>c.isTopModal(ve()),[c]),K=H_(Tt=>{G.current=Tt,Tt&&(M&&ue()?Ee():Q.current&&z1(Q.current,Z))}),ge=Y.useCallback(()=>{c.remove(ve(),Z)},[Z,c]);Y.useEffect(()=>()=>{ge()},[ge]),Y.useEffect(()=>{M?ie():(!H||!d)&&ge()},[M,ge,H,d,ie]);const _e=Tt=>gt=>{var at;(at=Tt.onKeyDown)==null||at.call(Tt,gt),!(gt.key!=="Escape"||gt.which===229||!ue())&&(r||(gt.stopPropagation(),I&&I(gt,"escapeKeyDown")))},Se=Tt=>gt=>{var at;(at=Tt.onClick)==null||at.call(Tt,gt),gt.target===gt.currentTarget&&I&&I(gt,"backdropClick")};return{getRootProps:(Tt={})=>{const gt=iH(t);delete gt.onTransitionEnter,delete gt.onTransitionExited;const at={...gt,...Tt};return{role:"presentation",...at,onKeyDown:_e(at),ref:re}},getBackdropProps:(Tt={})=>{const gt=Tt;return{"aria-hidden":!0,...gt,onClick:Se(gt),open:M}},getTransitionProps:()=>{const Tt=()=>{U(!1),_&&_()},gt=()=>{U(!0),x&&x(),d&&ge()};return{onEnter:Dk(Tt,a==null?void 0:a.props.onEnter),onExited:Dk(gt,a==null?void 0:a.props.onExited)}},rootRef:re,portalRef:K,isTopModal:ue,exited:ee,hasTransition:H}}function b1e(t){return Si("MuiModal",t)}Ii("MuiModal",["root","hidden","backdrop"]);const w1e=t=>{const{open:e,exited:r,classes:s}=t;return Ri({root:["root",!e&&r&&"hidden"],backdrop:["backdrop"]},b1e,s)},T1e=Qn("div",{name:"MuiModal",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.open&&r.exited&&e.hidden]}})(ns(({theme:t})=>({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:e})=>!e.open&&e.exited,style:{visibility:"hidden"}}]}))),E1e=Qn(jve,{name:"MuiModal",slot:"Backdrop",overridesResolver:(t,e)=>e.backdrop})({zIndex:-1}),S1e=Y.forwardRef(function(e,r){const s=rs({name:"MuiModal",props:e}),{BackdropComponent:c=E1e,BackdropProps:d,classes:_,className:x,closeAfterTransition:a=!1,children:I,container:M,component:D,components:L={},componentsProps:G={},disableAutoFocus:Q=!1,disableEnforceFocus:re=!1,disableEscapeKeyDown:ee=!1,disablePortal:U=!1,disableRestoreFocus:H=!1,disableScrollLock:Z=!1,hideBackdrop:de=!1,keepMounted:ve=!1,onBackdropClick:Ee,onClose:ie,onTransitionEnter:ue,onTransitionExited:K,open:ge,slotProps:_e={},slots:Se={},theme:xe,...wt}=s,ft={...s,closeAfterTransition:a,disableAutoFocus:Q,disableEnforceFocus:re,disableEscapeKeyDown:ee,disablePortal:U,disableRestoreFocus:H,disableScrollLock:Z,hideBackdrop:de,keepMounted:ve},{getRootProps:Tt,getBackdropProps:gt,getTransitionProps:at,portalRef:bt,isTopModal:Zt,exited:tt,hasTransition:Et}=x1e({...ft,rootRef:r}),mt={...ft,exited:tt},Vt=w1e(mt),Pt={};if(I.props.tabIndex===void 0&&(Pt.tabIndex="-1"),Et){const{onEnter:Tn,onExited:xr}=at();Pt.onEnter=Tn,Pt.onExited=xr}const pn={slots:{root:L.Root,backdrop:L.Backdrop,...Se},slotProps:{...G,..._e}},[dn,yn]=ql("root",{elementType:T1e,externalForwardedProps:pn,getSlotProps:Tt,additionalProps:{ref:r,as:D},ownerState:mt,className:kr(x,Vt==null?void 0:Vt.root,!mt.open&&mt.exited&&(Vt==null?void 0:Vt.hidden))}),[Mt,cn]=ql("backdrop",{elementType:c,externalForwardedProps:pn,additionalProps:d,getSlotProps:Tn=>gt({...Tn,onClick:xr=>{Ee&&Ee(xr),Tn!=null&&Tn.onClick&&Tn.onClick(xr)}}),className:kr(d==null?void 0:d.className,Vt==null?void 0:Vt.backdrop),ownerState:mt}),Yt=Do(d==null?void 0:d.ref,cn.ref);return!ve&&!ge&&(!Et||tt)?null:F.jsx(Tve,{ref:bt,container:M,disablePortal:U,children:F.jsxs(dn,{...yn,...wt,children:[!de&&c?F.jsx(Mt,{...cn,ref:Yt}):null,F.jsx(g1e,{disableEnforceFocus:re,disableAutoFocus:Q,disableRestoreFocus:H,isEnabled:Zt,open:ge,children:Y.cloneElement(I,Pt)})]})})}),I1e=t=>{const{classes:e,disableUnderline:r,startAdornment:s,endAdornment:c,size:d,hiddenLabel:_,multiline:x}=t,a={root:["root",!r&&"underline",s&&"adornedStart",c&&"adornedEnd",d==="small"&&`size${Kn(d)}`,_&&"hiddenLabel",x&&"multiline"],input:["input"]},I=Ri(a,Ove,e);return{...e,...I}},C1e=Qn(WC,{shouldForwardProp:t=>Ga(t)||t==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[...qC(t,e),!r.disableUnderline&&e.underline]}})(ns(({theme:t})=>{const e=t.palette.mode==="light",r=e?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",s=e?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",c=e?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",d=e?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:c,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s}},[`&.${Qp.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s},[`&.${Qp.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:d},variants:[{props:({ownerState:_})=>!_.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Qp.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Qp.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Qp.disabled}, .${Qp.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${Qp.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(([,_])=>_&&_.main).map(([_])=>{var x;return{props:{disableUnderline:!1,color:_},style:{"&::after":{borderBottom:`2px solid ${(x=(t.vars||t).palette[_])==null?void 0:x.main}`}}}}),{props:({ownerState:_})=>_.startAdornment,style:{paddingLeft:12}},{props:({ownerState:_})=>_.endAdornment,style:{paddingRight:12}},{props:({ownerState:_})=>_.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:_,size:x})=>_.multiline&&x==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:_})=>_.multiline&&_.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:_})=>_.multiline&&_.hiddenLabel&&_.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),A1e=Qn(HC,{name:"MuiFilledInput",slot:"Input",overridesResolver:GC})(ns(({theme:t})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:e})=>e.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}},{props:({ownerState:e})=>e.hiddenLabel&&e.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:e})=>e.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),HS=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiFilledInput"}),{disableUnderline:c=!1,components:d={},componentsProps:_,fullWidth:x=!1,hiddenLabel:a,inputComponent:I="input",multiline:M=!1,slotProps:D,slots:L={},type:G="text",...Q}=s,re={...s,disableUnderline:c,fullWidth:x,inputComponent:I,multiline:M,type:G},ee=I1e(s),U={root:{ownerState:re},input:{ownerState:re}},H=D??_?Qo(U,D??_):U,Z=L.root??d.Root??C1e,de=L.input??d.Input??A1e;return F.jsx(A5,{slots:{root:Z,input:de},componentsProps:H,fullWidth:x,inputComponent:I,multiline:M,ref:r,type:G,...Q,classes:ee})});HS&&(HS.muiName="Input");function P1e(t){return Si("MuiFormControl",t)}Ii("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const R1e=t=>{const{classes:e,margin:r,fullWidth:s}=t,c={root:["root",r!=="none"&&`margin${Kn(r)}`,s&&"fullWidth"]};return Ri(c,P1e,e)},M1e=Qn("div",{name:"MuiFormControl",slot:"Root",overridesResolver:({ownerState:t},e)=>({...e.root,...e[`margin${Kn(t.margin)}`],...t.fullWidth&&e.fullWidth})})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),k1e=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiFormControl"}),{children:c,className:d,color:_="primary",component:x="div",disabled:a=!1,error:I=!1,focused:M,fullWidth:D=!1,hiddenLabel:L=!1,margin:G="none",required:Q=!1,size:re="medium",variant:ee="outlined",...U}=s,H={...s,color:_,component:x,disabled:a,error:I,fullWidth:D,hiddenLabel:L,margin:G,required:Q,size:re,variant:ee},Z=R1e(H),[de,ve]=Y.useState(()=>{let xe=!1;return c&&Y.Children.forEach(c,wt=>{if(!wR(wt,["Input","Select"]))return;const ft=wR(wt,["Select"])?wt.props.input:wt;ft&&Cve(ft.props)&&(xe=!0)}),xe}),[Ee,ie]=Y.useState(()=>{let xe=!1;return c&&Y.Children.forEach(c,wt=>{wR(wt,["Input","Select"])&&(WS(wt.props,!0)||WS(wt.props.inputProps,!0))&&(xe=!0)}),xe}),[ue,K]=Y.useState(!1);a&&ue&&K(!1);const ge=M!==void 0&&!a?M:ue;let _e;const Se=Y.useMemo(()=>({adornedStart:de,setAdornedStart:ve,color:_,disabled:a,error:I,filled:Ee,focused:ge,fullWidth:D,hiddenLabel:L,size:re,onBlur:()=>{K(!1)},onEmpty:()=>{ie(!1)},onFilled:()=>{ie(!0)},onFocus:()=>{K(!0)},registerEffect:_e,required:Q,variant:ee}),[de,_,a,I,Ee,ge,D,L,_e,Q,re,ee]);return F.jsx(C5.Provider,{value:Se,children:F.jsx(M1e,{as:x,ownerState:H,className:kr(Z.root,d),ref:r,...U,children:c})})});function O1e(t){return Si("MuiFormControlLabel",t)}const h1=Ii("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),D1e=t=>{const{classes:e,disabled:r,labelPlacement:s,error:c,required:d}=t,_={root:["root",r&&"disabled",`labelPlacement${Kn(s)}`,c&&"error",d&&"required"],label:["label",r&&"disabled"],asterisk:["asterisk",c&&"error"]};return Ri(_,O1e,e)},L1e=Qn("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${h1.label}`]:e.label},e.root,e[`labelPlacement${Kn(r.labelPlacement)}`]]}})(ns(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${h1.disabled}`]:{cursor:"default"},[`& .${h1.label}`]:{[`&.${h1.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:e})=>e==="start"||e==="top"||e==="bottom",style:{marginLeft:16}}]}))),z1e=Qn("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(ns(({theme:t})=>({[`&.${h1.error}`]:{color:(t.vars||t).palette.error.main}}))),N1e=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiFormControlLabel"}),{checked:c,className:d,componentsProps:_={},control:x,disabled:a,disableTypography:I,inputRef:M,label:D,labelPlacement:L="end",name:G,onChange:Q,required:re,slots:ee={},slotProps:U={},value:H,...Z}=s,de=sd(),ve=a??x.props.disabled??(de==null?void 0:de.disabled),Ee=re??x.props.required,ie={disabled:ve,required:Ee};["checked","name","onChange","value","inputRef"].forEach(ft=>{typeof x.props[ft]>"u"&&typeof s[ft]<"u"&&(ie[ft]=s[ft])});const ue=Yf({props:s,muiFormControl:de,states:["error"]}),K={...s,disabled:ve,labelPlacement:L,required:Ee,error:ue.error},ge=D1e(K),_e={slots:ee,slotProps:{..._,...U}},[Se,xe]=ql("typography",{elementType:fV,externalForwardedProps:_e,ownerState:K});let wt=D;return wt!=null&&wt.type!==fV&&!I&&(wt=F.jsx(Se,{component:"span",...xe,className:kr(ge.label,xe==null?void 0:xe.className),children:wt})),F.jsxs(L1e,{className:kr(ge.root,d),ownerState:K,ref:r,...Z,children:[Y.cloneElement(x,ie),Ee?F.jsxs("div",{children:[wt,F.jsxs(z1e,{ownerState:K,"aria-hidden":!0,className:ge.asterisk,children:["","*"]})]}):wt]})});function F1e(t){return Si("MuiFormGroup",t)}Ii("MuiFormGroup",["root","row","error"]);const B1e=t=>{const{classes:e,row:r,error:s}=t;return Ri({root:["root",r&&"row",s&&"error"]},F1e,e)},j1e=Qn("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.row&&e.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),U1e=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiFormGroup"}),{className:c,row:d=!1,..._}=s,x=sd(),a=Yf({props:s,muiFormControl:x,states:["error"]}),I={...s,row:d,error:a.error},M=B1e(I);return F.jsx(j1e,{className:kr(M.root,c),ownerState:I,ref:r,..._})});function V1e(t){return Si("MuiFormHelperText",t)}const vV=Ii("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var xV;const $1e=t=>{const{classes:e,contained:r,size:s,disabled:c,error:d,filled:_,focused:x,required:a}=t,I={root:["root",c&&"disabled",d&&"error",s&&`size${Kn(s)}`,r&&"contained",x&&"focused",_&&"filled",a&&"required"]};return Ri(I,V1e,e)},q1e=Qn("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.size&&e[`size${Kn(r.size)}`],r.contained&&e.contained,r.filled&&e.filled]}})(ns(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.caption,textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${vV.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${vV.error}`]:{color:(t.vars||t).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:e})=>e.contained,style:{marginLeft:14,marginRight:14}}]}))),G1e=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiFormHelperText"}),{children:c,className:d,component:_="p",disabled:x,error:a,filled:I,focused:M,margin:D,required:L,variant:G,...Q}=s,re=sd(),ee=Yf({props:s,muiFormControl:re,states:["variant","size","disabled","error","filled","focused","required"]}),U={...s,component:_,contained:ee.variant==="filled"||ee.variant==="outlined",variant:ee.variant,size:ee.size,disabled:ee.disabled,error:ee.error,filled:ee.filled,focused:ee.focused,required:ee.required};delete U.ownerState;const H=$1e(U);return F.jsx(q1e,{as:_,className:kr(H.root,d),ref:r,...Q,ownerState:U,children:c===" "?xV||(xV=F.jsx("span",{className:"notranslate",children:""})):c})});function W1e(t){return Si("MuiFormLabel",t)}const N1=Ii("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),H1e=t=>{const{classes:e,color:r,focused:s,disabled:c,error:d,filled:_,required:x}=t,a={root:["root",`color${Kn(r)}`,c&&"disabled",d&&"error",_&&"filled",s&&"focused",x&&"required"],asterisk:["asterisk",d&&"error"]};return Ri(a,W1e,e)},Z1e=Qn("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:({ownerState:t},e)=>({...e.root,...t.color==="secondary"&&e.colorSecondary,...t.filled&&e.filled})})(ns(({theme:t})=>({color:(t.vars||t).palette.text.secondary,...t.typography.body1,lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{[`&.${N1.focused}`]:{color:(t.vars||t).palette[e].main}}})),{props:{},style:{[`&.${N1.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${N1.error}`]:{color:(t.vars||t).palette.error.main}}}]}))),X1e=Qn("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(ns(({theme:t})=>({[`&.${N1.error}`]:{color:(t.vars||t).palette.error.main}}))),K1e=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiFormLabel"}),{children:c,className:d,color:_,component:x="label",disabled:a,error:I,filled:M,focused:D,required:L,...G}=s,Q=sd(),re=Yf({props:s,muiFormControl:Q,states:["color","required","focused","disabled","error","filled"]}),ee={...s,color:re.color||"primary",component:x,disabled:re.disabled,error:re.error,filled:re.filled,focused:re.focused,required:re.required},U=H1e(ee);return F.jsxs(Z1e,{as:x,ownerState:ee,className:kr(U.root,d),ref:r,...G,children:[c,re.required&&F.jsxs(X1e,{ownerState:ee,"aria-hidden":!0,className:U.asterisk,children:["","*"]})]})});function Vk(t){return`scale(${t}, ${t**2})`}const Q1e={entering:{opacity:1,transform:Vk(1)},entered:{opacity:1,transform:"none"}},PR=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),$k=Y.forwardRef(function(e,r){const{addEndListener:s,appear:c=!0,children:d,easing:_,in:x,onEnter:a,onEntered:I,onEntering:M,onExit:D,onExited:L,onExiting:G,style:Q,timeout:re="auto",TransitionComponent:ee=Zu,...U}=e,H=eH(),Z=Y.useRef(),de=T5(),ve=Y.useRef(null),Ee=Do(ve,mb(d),r),ie=ft=>Tt=>{if(ft){const gt=ve.current;Tt===void 0?ft(gt):ft(gt,Tt)}},ue=ie(M),K=ie((ft,Tt)=>{dH(ft);const{duration:gt,delay:at,easing:bt}=qS({style:Q,timeout:re,easing:_},{mode:"enter"});let Zt;re==="auto"?(Zt=de.transitions.getAutoHeightDuration(ft.clientHeight),Z.current=Zt):Zt=gt,ft.style.transition=[de.transitions.create("opacity",{duration:Zt,delay:at}),de.transitions.create("transform",{duration:PR?Zt:Zt*.666,delay:at,easing:bt})].join(","),a&&a(ft,Tt)}),ge=ie(I),_e=ie(G),Se=ie(ft=>{const{duration:Tt,delay:gt,easing:at}=qS({style:Q,timeout:re,easing:_},{mode:"exit"});let bt;re==="auto"?(bt=de.transitions.getAutoHeightDuration(ft.clientHeight),Z.current=bt):bt=Tt,ft.style.transition=[de.transitions.create("opacity",{duration:bt,delay:gt}),de.transitions.create("transform",{duration:PR?bt:bt*.666,delay:PR?gt:gt||bt*.333,easing:at})].join(","),ft.style.opacity=0,ft.style.transform=Vk(.75),D&&D(ft)}),xe=ie(L),wt=ft=>{re==="auto"&&H.start(Z.current||0,ft),s&&s(ve.current,ft)};return F.jsx(ee,{appear:c,in:x,nodeRef:ve,onEnter:K,onEntered:ge,onEntering:ue,onExit:Se,onExited:xe,onExiting:_e,addEndListener:wt,timeout:re==="auto"?null:re,...U,children:(ft,Tt)=>Y.cloneElement(d,{style:{opacity:0,transform:Vk(.75),visibility:ft==="exited"&&!x?"hidden":void 0,...Q1e[ft],...Q,...d.props.style},ref:Ee,...Tt})})});$k&&($k.muiSupportAuto=!0);const Y1e=t=>{const{classes:e,disableUnderline:r}=t,c=Ri({root:["root",!r&&"underline"],input:["input"]},Mve,e);return{...e,...c}},J1e=Qn(WC,{shouldForwardProp:t=>Ga(t)||t==="classes",name:"MuiInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[...qC(t,e),!r.disableUnderline&&e.underline]}})(ns(({theme:t})=>{let r=t.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(r=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),{position:"relative",variants:[{props:({ownerState:s})=>s.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:s})=>!s.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Gv.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Gv.error}`]:{"&::before, &::after":{borderBottomColor:(t.vars||t).palette.error.main}},"&::before":{borderBottom:`1px solid ${r}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Gv.disabled}, .${Gv.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${r}`}},[`&.${Gv.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(t.palette).filter(([,s])=>s&&s.main).map(([s])=>({props:{color:s,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(t.vars||t).palette[s].main}`}}}))]}})),exe=Qn(HC,{name:"MuiInput",slot:"Input",overridesResolver:GC})({}),ZS=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiInput"}),{disableUnderline:c=!1,components:d={},componentsProps:_,fullWidth:x=!1,inputComponent:a="input",multiline:I=!1,slotProps:M,slots:D={},type:L="text",...G}=s,Q=Y1e(s),ee={root:{ownerState:{disableUnderline:c}}},U=M??_?Qo(M??_,ee):ee,H=D.root??d.Root??J1e,Z=D.input??d.Input??exe;return F.jsx(A5,{slots:{root:H,input:Z},slotProps:U,fullWidth:x,inputComponent:a,multiline:I,ref:r,type:L,...G,classes:Q})});ZS&&(ZS.muiName="Input");function txe(t){return Si("MuiInputLabel",t)}Ii("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const nxe=t=>{const{classes:e,formControl:r,size:s,shrink:c,disableAnimation:d,variant:_,required:x}=t,a={root:["root",r&&"formControl",!d&&"animated",c&&"shrink",s&&s!=="normal"&&`size${Kn(s)}`,_],asterisk:[x&&"asterisk"]},I=Ri(a,txe,e);return{...e,...I}},rxe=Qn(K1e,{shouldForwardProp:t=>Ga(t)||t==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${N1.asterisk}`]:e.asterisk},e.root,r.formControl&&e.formControl,r.size==="small"&&e.sizeSmall,r.shrink&&e.shrink,!r.disableAnimation&&e.animated,r.focused&&e.focused,e[r.variant]]}})(ns(({theme:t})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:e})=>e.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:e})=>e.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:e})=>!e.disableAnimation,style:{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:e,ownerState:r})=>e==="filled"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:e,ownerState:r,size:s})=>e==="filled"&&r.shrink&&s==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:e,ownerState:r})=>e==="outlined"&&r.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),ixe=Y.forwardRef(function(e,r){const s=rs({name:"MuiInputLabel",props:e}),{disableAnimation:c=!1,margin:d,shrink:_,variant:x,className:a,...I}=s,M=sd();let D=_;typeof D>"u"&&M&&(D=M.filled||M.focused||M.adornedStart);const L=Yf({props:s,muiFormControl:M,states:["size","variant","required","focused"]}),G={...s,disableAnimation:c,formControl:M,shrink:D,size:L.size,variant:L.variant,required:L.required,focused:L.focused},Q=nxe(G);return F.jsx(rxe,{"data-shrink":D,ref:r,className:kr(Q.root,a),...I,ownerState:G,classes:Q})}),sxe=Y.createContext({});function oxe(t){return Si("MuiList",t)}Ii("MuiList",["root","padding","dense","subheader"]);const axe=t=>{const{classes:e,disablePadding:r,dense:s,subheader:c}=t;return Ri({root:["root",!r&&"padding",s&&"dense",c&&"subheader"]},oxe,e)},lxe=Qn("ul",{name:"MuiList",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.disablePadding&&e.padding,r.dense&&e.dense,r.subheader&&e.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:t})=>!t.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:t})=>t.subheader,style:{paddingTop:0}}]}),cxe=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiList"}),{children:c,className:d,component:_="ul",dense:x=!1,disablePadding:a=!1,subheader:I,...M}=s,D=Y.useMemo(()=>({dense:x}),[x]),L={...s,component:_,dense:x,disablePadding:a},G=axe(L);return F.jsx(sxe.Provider,{value:D,children:F.jsxs(lxe,{as:_,className:kr(G.root,d),ref:r,ownerState:L,...M,children:[I,c]})})});function RR(t,e,r){return t===e?t.firstChild:e&&e.nextElementSibling?e.nextElementSibling:r?null:t.firstChild}function bV(t,e,r){return t===e?r?t.firstChild:t.lastChild:e&&e.previousElementSibling?e.previousElementSibling:r?null:t.lastChild}function pH(t,e){if(e===void 0)return!0;let r=t.innerText;return r===void 0&&(r=t.textContent),r=r.trim().toLowerCase(),r.length===0?!1:e.repeating?r[0]===e.keys[0]:r.startsWith(e.keys.join(""))}function Wv(t,e,r,s,c,d){let _=!1,x=c(t,e,e?r:!1);for(;x;){if(x===t.firstChild){if(_)return!1;_=!0}const a=s?!1:x.disabled||x.getAttribute("aria-disabled")==="true";if(!x.hasAttribute("tabindex")||!pH(x,d)||a)x=c(t,x,r);else return x.focus(),!0}return!1}const uxe=Y.forwardRef(function(e,r){const{actions:s,autoFocus:c=!1,autoFocusItem:d=!1,children:_,className:x,disabledItemsFocusable:a=!1,disableListWrap:I=!1,onKeyDown:M,variant:D="selectedMenu",...L}=e,G=Y.useRef(null),Q=Y.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});Um(()=>{c&&G.current.focus()},[c]),Y.useImperativeHandle(s,()=>({adjustStyleForScrollbar:(Z,{direction:de})=>{const ve=!G.current.style.width;if(Z.clientHeight<G.current.clientHeight&&ve){const Ee=`${tH(ml(Z))}px`;G.current.style[de==="rtl"?"paddingLeft":"paddingRight"]=Ee,G.current.style.width=`calc(100% + ${Ee})`}return G.current}}),[]);const re=Z=>{const de=G.current,ve=Z.key;if(Z.ctrlKey||Z.metaKey||Z.altKey){M&&M(Z);return}const ie=ml(de).activeElement;if(ve==="ArrowDown")Z.preventDefault(),Wv(de,ie,I,a,RR);else if(ve==="ArrowUp")Z.preventDefault(),Wv(de,ie,I,a,bV);else if(ve==="Home")Z.preventDefault(),Wv(de,null,I,a,RR);else if(ve==="End")Z.preventDefault(),Wv(de,null,I,a,bV);else if(ve.length===1){const ue=Q.current,K=ve.toLowerCase(),ge=performance.now();ue.keys.length>0&&(ge-ue.lastTime>500?(ue.keys=[],ue.repeating=!0,ue.previousKeyMatched=!0):ue.repeating&&K!==ue.keys[0]&&(ue.repeating=!1)),ue.lastTime=ge,ue.keys.push(K);const _e=ie&&!ue.repeating&&pH(ie,ue);ue.previousKeyMatched&&(_e||Wv(de,ie,!1,a,RR,ue))?Z.preventDefault():ue.previousKeyMatched=!1}M&&M(Z)},ee=Do(G,r);let U=-1;Y.Children.forEach(_,(Z,de)=>{if(!Y.isValidElement(Z)){U===de&&(U+=1,U>=_.length&&(U=-1));return}Z.props.disabled||(D==="selectedMenu"&&Z.props.selected||U===-1)&&(U=de),U===de&&(Z.props.disabled||Z.props.muiSkipListHighlight||Z.type.muiSkipListHighlight)&&(U+=1,U>=_.length&&(U=-1))});const H=Y.Children.map(_,(Z,de)=>{if(de===U){const ve={};return d&&(ve.autoFocus=!0),Z.props.tabIndex===void 0&&D==="selectedMenu"&&(ve.tabIndex=0),Y.cloneElement(Z,ve)}return Z});return F.jsx(cxe,{role:"menu",ref:ee,className:x,onKeyDown:re,tabIndex:c?0:-1,...L,children:H})});function hxe(t){return Si("MuiPopover",t)}Ii("MuiPopover",["root","paper"]);function wV(t,e){let r=0;return typeof e=="number"?r=e:e==="center"?r=t.height/2:e==="bottom"&&(r=t.height),r}function TV(t,e){let r=0;return typeof e=="number"?r=e:e==="center"?r=t.width/2:e==="right"&&(r=t.width),r}function EV(t){return[t.horizontal,t.vertical].map(e=>typeof e=="number"?`${e}px`:e).join(" ")}function MR(t){return typeof t=="function"?t():t}const dxe=t=>{const{classes:e}=t;return Ri({root:["root"],paper:["paper"]},hxe,e)},fxe=Qn(S1e,{name:"MuiPopover",slot:"Root",overridesResolver:(t,e)=>e.root})({}),mH=Qn(Y0e,{name:"MuiPopover",slot:"Paper",overridesResolver:(t,e)=>e.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),pxe=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiPopover"}),{action:c,anchorEl:d,anchorOrigin:_={vertical:"top",horizontal:"left"},anchorPosition:x,anchorReference:a="anchorEl",children:I,className:M,container:D,elevation:L=8,marginThreshold:G=16,open:Q,PaperProps:re={},slots:ee={},slotProps:U={},transformOrigin:H={vertical:"top",horizontal:"left"},TransitionComponent:Z=$k,transitionDuration:de="auto",TransitionProps:{onEntering:ve,...Ee}={},disableScrollLock:ie=!1,...ue}=s,K=(U==null?void 0:U.paper)??re,ge=Y.useRef(),_e={...s,anchorOrigin:_,anchorReference:a,elevation:L,marginThreshold:G,externalPaperSlotProps:K,transformOrigin:H,TransitionComponent:Z,transitionDuration:de,TransitionProps:Ee},Se=dxe(_e),xe=Y.useCallback(()=>{if(a==="anchorPosition")return x;const cn=MR(d),Tn=(cn&&cn.nodeType===1?cn:ml(ge.current).body).getBoundingClientRect();return{top:Tn.top+wV(Tn,_.vertical),left:Tn.left+TV(Tn,_.horizontal)}},[d,_.horizontal,_.vertical,x,a]),wt=Y.useCallback(cn=>({vertical:wV(cn,H.vertical),horizontal:TV(cn,H.horizontal)}),[H.horizontal,H.vertical]),ft=Y.useCallback(cn=>{const Yt={width:cn.offsetWidth,height:cn.offsetHeight},Tn=wt(Yt);if(a==="none")return{top:null,left:null,transformOrigin:EV(Tn)};const xr=xe();let On=xr.top-Tn.vertical,fr=xr.left-Tn.horizontal;const Lr=On+Yt.height,or=fr+Yt.width,Yn=Vm(MR(d)),ke=Yn.innerHeight-G,He=Yn.innerWidth-G;if(G!==null&&On<G){const lt=On-G;On-=lt,Tn.vertical+=lt}else if(G!==null&&Lr>ke){const lt=Lr-ke;On-=lt,Tn.vertical+=lt}if(G!==null&&fr<G){const lt=fr-G;fr-=lt,Tn.horizontal+=lt}else if(or>He){const lt=or-He;fr-=lt,Tn.horizontal+=lt}return{top:`${Math.round(On)}px`,left:`${Math.round(fr)}px`,transformOrigin:EV(Tn)}},[d,a,xe,wt,G]),[Tt,gt]=Y.useState(Q),at=Y.useCallback(()=>{const cn=ge.current;if(!cn)return;const Yt=ft(cn);Yt.top!==null&&(cn.style.top=Yt.top),Yt.left!==null&&(cn.style.left=Yt.left),cn.style.transformOrigin=Yt.transformOrigin,gt(!0)},[ft]);Y.useEffect(()=>(ie&&window.addEventListener("scroll",at),()=>window.removeEventListener("scroll",at)),[d,ie,at]);const bt=(cn,Yt)=>{ve&&ve(cn,Yt),at()},Zt=()=>{gt(!1)};Y.useEffect(()=>{Q&&at()}),Y.useImperativeHandle(c,()=>Q?{updatePosition:()=>{at()}}:null,[Q,at]),Y.useEffect(()=>{if(!Q)return;const cn=YW(()=>{at()}),Yt=Vm(d);return Yt.addEventListener("resize",cn),()=>{cn.clear(),Yt.removeEventListener("resize",cn)}},[d,Q,at]);let tt=de;de==="auto"&&!Z.muiSupportAuto&&(tt=void 0);const Et=D||(d?ml(MR(d)).body:void 0),mt={slots:ee,slotProps:{...U,paper:K}},[Vt,Pt]=ql("paper",{elementType:mH,externalForwardedProps:mt,additionalProps:{elevation:L,className:kr(Se.paper,K==null?void 0:K.className),style:Tt?K.style:{...K.style,opacity:0}},ownerState:_e}),[pn,{slotProps:dn,...yn}]=ql("root",{elementType:fxe,externalForwardedProps:mt,additionalProps:{slotProps:{backdrop:{invisible:!0}},container:Et,open:Q},ownerState:_e,className:kr(Se.root,M)}),Mt=Do(ge,Pt.ref);return F.jsx(pn,{...yn,...!Uk(pn)&&{slotProps:dn,disableScrollLock:ie},...ue,ref:r,children:F.jsx(Z,{appear:!0,in:Q,onEntering:bt,onExited:Zt,timeout:tt,...Ee,children:F.jsx(Vt,{...Pt,ref:Mt,children:I})})})});function mxe(t){return Si("MuiMenu",t)}Ii("MuiMenu",["root","paper","list"]);const gxe={vertical:"top",horizontal:"right"},_xe={vertical:"top",horizontal:"left"},yxe=t=>{const{classes:e}=t;return Ri({root:["root"],paper:["paper"],list:["list"]},mxe,e)},vxe=Qn(pxe,{shouldForwardProp:t=>Ga(t)||t==="classes",name:"MuiMenu",slot:"Root",overridesResolver:(t,e)=>e.root})({}),xxe=Qn(mH,{name:"MuiMenu",slot:"Paper",overridesResolver:(t,e)=>e.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),bxe=Qn(uxe,{name:"MuiMenu",slot:"List",overridesResolver:(t,e)=>e.list})({outline:0}),wxe=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiMenu"}),{autoFocus:c=!0,children:d,className:_,disableAutoFocusItem:x=!1,MenuListProps:a={},onClose:I,open:M,PaperProps:D={},PopoverClasses:L,transitionDuration:G="auto",TransitionProps:{onEntering:Q,...re}={},variant:ee="selectedMenu",slots:U={},slotProps:H={},...Z}=s,de=Xye(),ve={...s,autoFocus:c,disableAutoFocusItem:x,MenuListProps:a,onEntering:Q,PaperProps:D,transitionDuration:G,TransitionProps:re,variant:ee},Ee=yxe(ve),ie=c&&!x&&M,ue=Y.useRef(null),K=(Tt,gt)=>{ue.current&&ue.current.adjustStyleForScrollbar(Tt,{direction:de?"rtl":"ltr"}),Q&&Q(Tt,gt)},ge=Tt=>{Tt.key==="Tab"&&(Tt.preventDefault(),I&&I(Tt,"tabKeyDown"))};let _e=-1;Y.Children.map(d,(Tt,gt)=>{Y.isValidElement(Tt)&&(Tt.props.disabled||(ee==="selectedMenu"&&Tt.props.selected||_e===-1)&&(_e=gt))});const Se=U.paper??xxe,xe=H.paper??D,wt=US({elementType:U.root,externalSlotProps:H.root,ownerState:ve,className:[Ee.root,_]}),ft=US({elementType:Se,externalSlotProps:xe,ownerState:ve,className:Ee.paper});return F.jsx(vxe,{onClose:I,anchorOrigin:{vertical:"bottom",horizontal:de?"right":"left"},transformOrigin:de?gxe:_xe,slots:{paper:Se,root:U.root},slotProps:{root:wt,paper:ft},open:M,ref:r,transitionDuration:G,TransitionProps:{onEntering:K,...re},ownerState:ve,...Z,classes:L,children:F.jsx(bxe,{onKeyDown:ge,actions:ue,autoFocus:c&&(_e===-1||x),autoFocusItem:ie,variant:ee,...a,className:kr(Ee.list,a.className),children:d})})});function Txe(t){return Si("MuiNativeSelect",t)}const P5=Ii("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),Exe=t=>{const{classes:e,variant:r,disabled:s,multiple:c,open:d,error:_}=t,x={select:["select",r,s&&"disabled",c&&"multiple",_&&"error"],icon:["icon",`icon${Kn(r)}`,d&&"iconOpen",s&&"disabled"]};return Ri(x,Txe,e)},gH=Qn("select")(({theme:t})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${P5.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(t.vars||t).palette.background.paper},variants:[{props:({ownerState:e})=>e.variant!=="filled"&&e.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(t.vars||t).shape.borderRadius,"&:focus":{borderRadius:(t.vars||t).shape.borderRadius},"&&&":{paddingRight:32}}}]})),Sxe=Qn(gH,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:Ga,overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.select,e[r.variant],r.error&&e.error,{[`&.${P5.multiple}`]:e.multiple}]}})({}),_H=Qn("svg")(({theme:t})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(t.vars||t).palette.action.active,[`&.${P5.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:({ownerState:e})=>e.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),Ixe=Qn(_H,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.icon,r.variant&&e[`icon${Kn(r.variant)}`],r.open&&e.iconOpen]}})({}),Cxe=Y.forwardRef(function(e,r){const{className:s,disabled:c,error:d,IconComponent:_,inputRef:x,variant:a="standard",...I}=e,M={...e,disabled:c,variant:a,error:d},D=Exe(M);return F.jsxs(Y.Fragment,{children:[F.jsx(Sxe,{ownerState:M,className:kr(D.select,s),disabled:c,ref:x||r,...I}),e.multiple?null:F.jsx(Ixe,{as:_,ownerState:M,className:D.icon})]})});var SV;const Axe=Qn("fieldset",{shouldForwardProp:Ga})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),Pxe=Qn("legend",{shouldForwardProp:Ga})(ns(({theme:t})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:e})=>!e.withLabel,style:{padding:0,lineHeight:"11px",transition:t.transitions.create("width",{duration:150,easing:t.transitions.easing.easeOut})}},{props:({ownerState:e})=>e.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:t.transitions.create("max-width",{duration:50,easing:t.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:e})=>e.withLabel&&e.notched,style:{maxWidth:"100%",transition:t.transitions.create("max-width",{duration:100,easing:t.transitions.easing.easeOut,delay:50})}}]})));function Rxe(t){const{children:e,classes:r,className:s,label:c,notched:d,..._}=t,x=c!=null&&c!=="",a={...t,notched:d,withLabel:x};return F.jsx(Axe,{"aria-hidden":!0,className:s,ownerState:a,..._,children:F.jsx(Pxe,{ownerState:a,children:x?F.jsx("span",{children:c}):SV||(SV=F.jsx("span",{className:"notranslate",children:""}))})})}const Mxe=t=>{const{classes:e}=t,s=Ri({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},kve,e);return{...e,...s}},kxe=Qn(WC,{shouldForwardProp:t=>Ga(t)||t==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:qC})(ns(({theme:t})=>{const e=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${xu.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},[`&.${xu.focused} .${xu.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(t.palette).filter(([,r])=>r&&r.main).map(([r])=>({props:{color:r},style:{[`&.${xu.focused} .${xu.notchedOutline}`]:{borderColor:(t.vars||t).palette[r].main}}})),{props:{},style:{"@media (hover: none)":{[`&:hover .${xu.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:e}},[`&.${xu.error} .${xu.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${xu.disabled} .${xu.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}}},{props:({ownerState:r})=>r.startAdornment,style:{paddingLeft:14}},{props:({ownerState:r})=>r.endAdornment,style:{paddingRight:14}},{props:({ownerState:r})=>r.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:r,size:s})=>r.multiline&&s==="small",style:{padding:"8.5px 14px"}}]}})),Oxe=Qn(Rxe,{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(t,e)=>e.notchedOutline})(ns(({theme:t})=>{const e=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:e}})),Dxe=Qn(HC,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:GC})(ns(({theme:t})=>({padding:"16.5px 14px",...!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:e})=>e.multiline,style:{padding:0}},{props:({ownerState:e})=>e.startAdornment,style:{paddingLeft:0}},{props:({ownerState:e})=>e.endAdornment,style:{paddingRight:0}}]}))),XS=Y.forwardRef(function(e,r){var s;const c=rs({props:e,name:"MuiOutlinedInput"}),{components:d={},fullWidth:_=!1,inputComponent:x="input",label:a,multiline:I=!1,notched:M,slots:D={},type:L="text",...G}=c,Q=Mxe(c),re=sd(),ee=Yf({props:c,muiFormControl:re,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),U={...c,color:ee.color||"primary",disabled:ee.disabled,error:ee.error,focused:ee.focused,formControl:re,fullWidth:_,hiddenLabel:ee.hiddenLabel,multiline:I,size:ee.size,type:L},H=D.root??d.Root??kxe,Z=D.input??d.Input??Dxe;return F.jsx(A5,{slots:{root:H,input:Z},renderSuffix:de=>F.jsx(Oxe,{ownerState:U,className:Q.notchedOutline,label:a!=null&&a!==""&&ee.required?s||(s=F.jsxs(Y.Fragment,{children:[a,"","*"]})):a,notched:typeof M<"u"?M:!!(de.startAdornment||de.filled||de.focused)}),fullWidth:_,inputComponent:x,multiline:I,ref:r,type:L,...G,classes:{...Q,notchedOutline:null}})});XS&&(XS.muiName="Input");const Lxe=id(F.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),zxe=id(F.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),Nxe=Qn("span",{shouldForwardProp:Ga})({position:"relative",display:"flex"}),Fxe=Qn(Lxe)({transform:"scale(1)"}),Bxe=Qn(zxe)(ns(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function yH(t){const{checked:e=!1,classes:r={},fontSize:s}=t,c={...t,checked:e};return F.jsxs(Nxe,{className:r.root,ownerState:c,children:[F.jsx(Fxe,{fontSize:s,className:r.background,ownerState:c}),F.jsx(Bxe,{fontSize:s,className:r.dot,ownerState:c})]})}const vH=Y.createContext(void 0);function jxe(){return Y.useContext(vH)}function Uxe(t){return Si("MuiRadio",t)}const IV=Ii("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),Vxe=t=>{const{classes:e,color:r,size:s}=t,c={root:["root",`color${Kn(r)}`,s!=="medium"&&`size${Kn(s)}`]};return{...e,...Ri(c,Uxe,e)}},$xe=Qn(i1e,{shouldForwardProp:t=>Ga(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.size!=="medium"&&e[`size${Kn(r.size)}`],e[`color${Kn(r.color)}`]]}})(ns(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${IV.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:$l(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[e].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:$l(t.palette[e].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(([,e])=>e&&e.main).map(([e])=>({props:{color:e},style:{[`&.${IV.checked}`]:{color:(t.vars||t).palette[e].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function qxe(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}const CV=F.jsx(yH,{checked:!0}),AV=F.jsx(yH,{}),Gxe=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiRadio"}),{checked:c,checkedIcon:d=CV,color:_="primary",icon:x=AV,name:a,onChange:I,size:M="medium",className:D,disableRipple:L=!1,...G}=s,Q={...s,disableRipple:L,color:_,size:M},re=Vxe(Q),ee=jxe();let U=c;const H=Dk(I,ee&&ee.onChange);let Z=a;return ee&&(typeof U>"u"&&(U=qxe(ee.value,s.value)),typeof Z>"u"&&(Z=ee.name)),F.jsx($xe,{type:"radio",icon:Y.cloneElement(x,{fontSize:AV.props.fontSize??M}),checkedIcon:Y.cloneElement(d,{fontSize:CV.props.fontSize??M}),ownerState:Q,classes:re,name:Z,checked:U,onChange:H,ref:r,className:kr(re.root,D),...G})});function Wxe(t){return Si("MuiRadioGroup",t)}Ii("MuiRadioGroup",["root","row","error"]);const Hxe=t=>{const{classes:e,row:r,error:s}=t;return Ri({root:["root",r&&"row",s&&"error"]},Wxe,e)},Zxe=Y.forwardRef(function(e,r){const{actions:s,children:c,className:d,defaultValue:_,name:x,onChange:a,value:I,...M}=e,D=Y.useRef(null),L=Hxe(e),[G,Q]=jS({controlled:I,default:_,name:"RadioGroup"});Y.useImperativeHandle(s,()=>({focus:()=>{let H=D.current.querySelector("input:not(:disabled):checked");H||(H=D.current.querySelector("input:not(:disabled)")),H&&H.focus()}}),[]);const re=Do(r,D),ee=x5(x),U=Y.useMemo(()=>({name:ee,onChange(H){Q(H.target.value),a&&a(H,H.target.value)},value:G}),[ee,a,Q,G]);return F.jsx(vH.Provider,{value:U,children:F.jsx(U1e,{role:"radiogroup",ref:re,className:kr(L.root,d),...M,children:c})})});function Xxe(t){return Si("MuiSelect",t)}const Hv=Ii("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var PV;const Kxe=Qn(gH,{name:"MuiSelect",slot:"Select",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`&.${Hv.select}`]:e.select},{[`&.${Hv.select}`]:e[r.variant]},{[`&.${Hv.error}`]:e.error},{[`&.${Hv.multiple}`]:e.multiple}]}})({[`&.${Hv.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),Qxe=Qn(_H,{name:"MuiSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.icon,r.variant&&e[`icon${Kn(r.variant)}`],r.open&&e.iconOpen]}})({}),Yxe=Qn("input",{shouldForwardProp:t=>cH(t)&&t!=="classes",name:"MuiSelect",slot:"NativeInput",overridesResolver:(t,e)=>e.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function RV(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}function Jxe(t){return t==null||typeof t=="string"&&!t.trim()}const ebe=t=>{const{classes:e,variant:r,disabled:s,multiple:c,open:d,error:_}=t,x={select:["select",r,s&&"disabled",c&&"multiple",_&&"error"],icon:["icon",`icon${Kn(r)}`,d&&"iconOpen",s&&"disabled"],nativeInput:["nativeInput"]};return Ri(x,Xxe,e)},tbe=Y.forwardRef(function(e,r){var is;const{"aria-describedby":s,"aria-label":c,autoFocus:d,autoWidth:_,children:x,className:a,defaultOpen:I,defaultValue:M,disabled:D,displayEmpty:L,error:G=!1,IconComponent:Q,inputRef:re,labelId:ee,MenuProps:U={},multiple:H,name:Z,onBlur:de,onChange:ve,onClose:Ee,onFocus:ie,onOpen:ue,open:K,readOnly:ge,renderValue:_e,SelectDisplayProps:Se={},tabIndex:xe,type:wt,value:ft,variant:Tt="standard",...gt}=e,[at,bt]=jS({controlled:ft,default:M,name:"Select"}),[Zt,tt]=jS({controlled:K,default:I,name:"Select"}),Et=Y.useRef(null),mt=Y.useRef(null),[Vt,Pt]=Y.useState(null),{current:pn}=Y.useRef(K!=null),[dn,yn]=Y.useState(),Mt=Do(r,re),cn=Y.useCallback(An=>{mt.current=An,An&&Pt(An)},[]),Yt=Vt==null?void 0:Vt.parentNode;Y.useImperativeHandle(Mt,()=>({focus:()=>{mt.current.focus()},node:Et.current,value:at}),[at]),Y.useEffect(()=>{I&&Zt&&Vt&&!pn&&(yn(_?null:Yt.clientWidth),mt.current.focus())},[Vt,_]),Y.useEffect(()=>{d&&mt.current.focus()},[d]),Y.useEffect(()=>{if(!ee)return;const An=ml(mt.current).getElementById(ee);if(An){const ar=()=>{getSelection().isCollapsed&&mt.current.focus()};return An.addEventListener("click",ar),()=>{An.removeEventListener("click",ar)}}},[ee]);const Tn=(An,ar)=>{An?ue&&ue(ar):Ee&&Ee(ar),pn||(yn(_?null:Yt.clientWidth),tt(An))},xr=An=>{An.button===0&&(An.preventDefault(),mt.current.focus(),Tn(!0,An))},On=An=>{Tn(!1,An)},fr=Y.Children.toArray(x),Lr=An=>{const ar=fr.find(mn=>mn.props.value===An.target.value);ar!==void 0&&(bt(ar.props.value),ve&&ve(An,ar))},or=An=>ar=>{let mn;if(ar.currentTarget.hasAttribute("tabindex")){if(H){mn=Array.isArray(at)?at.slice():[];const Js=at.indexOf(An.props.value);Js===-1?mn.push(An.props.value):mn.splice(Js,1)}else mn=An.props.value;if(An.props.onClick&&An.props.onClick(ar),at!==mn&&(bt(mn),ve)){const Js=ar.nativeEvent||ar,Ai=new Js.constructor(Js.type,Js);Object.defineProperty(Ai,"target",{writable:!0,value:{value:mn,name:Z}}),ve(Ai,An)}H||Tn(!1,ar)}},Yn=An=>{ge||[" ","ArrowUp","ArrowDown","Enter"].includes(An.key)&&(An.preventDefault(),Tn(!0,An))},ke=Vt!==null&&Zt,He=An=>{!ke&&de&&(Object.defineProperty(An,"target",{writable:!0,value:{value:at,name:Z}}),de(An))};delete gt["aria-invalid"];let lt,Ke;const st=[];let zt=!1;(WS({value:at})||L)&&(_e?lt=_e(at):zt=!0);const ln=fr.map(An=>{if(!Y.isValidElement(An))return null;let ar;if(H){if(!Array.isArray(at))throw new Error(Qh(2));ar=at.some(mn=>RV(mn,An.props.value)),ar&&zt&&st.push(An.props.children)}else ar=RV(at,An.props.value),ar&&zt&&(Ke=An.props.children);return Y.cloneElement(An,{"aria-selected":ar?"true":"false",onClick:or(An),onKeyUp:mn=>{mn.key===" "&&mn.preventDefault(),An.props.onKeyUp&&An.props.onKeyUp(mn)},role:"option",selected:ar,value:void 0,"data-value":An.props.value})});zt&&(H?st.length===0?lt=null:lt=st.reduce((An,ar,mn)=>(An.push(ar),mn<st.length-1&&An.push(", "),An),[]):lt=Ke);let Ht=dn;!_&&pn&&Vt&&(Ht=Yt.clientWidth);let vn;typeof xe<"u"?vn=xe:vn=D?null:0;const Fn=Se.id||(Z?`mui-component-select-${Z}`:void 0),pr={...e,variant:Tt,value:at,open:ke,error:G},fi=ebe(pr),ir={...U.PaperProps,...(is=U.slotProps)==null?void 0:is.paper},Ci=x5();return F.jsxs(Y.Fragment,{children:[F.jsx(Kxe,{as:"div",ref:cn,tabIndex:vn,role:"combobox","aria-controls":Ci,"aria-disabled":D?"true":void 0,"aria-expanded":ke?"true":"false","aria-haspopup":"listbox","aria-label":c,"aria-labelledby":[ee,Fn].filter(Boolean).join(" ")||void 0,"aria-describedby":s,onKeyDown:Yn,onMouseDown:D||ge?null:xr,onBlur:He,onFocus:ie,...Se,ownerState:pr,className:kr(Se.className,fi.select,a),id:Fn,children:Jxe(lt)?PV||(PV=F.jsx("span",{className:"notranslate",children:""})):lt}),F.jsx(Yxe,{"aria-invalid":G,value:Array.isArray(at)?at.join(","):at,name:Z,ref:Et,"aria-hidden":!0,onChange:Lr,tabIndex:-1,disabled:D,className:fi.nativeInput,autoFocus:d,...gt,ownerState:pr}),F.jsx(Qxe,{as:Q,className:fi.icon,ownerState:pr}),F.jsx(wxe,{id:`menu-${Z||""}`,anchorEl:Yt,open:ke,onClose:On,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...U,MenuListProps:{"aria-labelledby":ee,role:"listbox","aria-multiselectable":H?"true":void 0,disableListWrap:!0,id:Ci,...U.MenuListProps},slotProps:{...U.slotProps,paper:{...ir,style:{minWidth:Ht,...ir!=null?ir.style:null}}},children:ln})]})}),nbe=t=>{const{classes:e}=t;return e},R5={name:"MuiSelect",overridesResolver:(t,e)=>e.root,shouldForwardProp:t=>Ga(t)&&t!=="variant",slot:"Root"},rbe=Qn(ZS,R5)(""),ibe=Qn(XS,R5)(""),sbe=Qn(HS,R5)(""),xH=Y.forwardRef(function(e,r){const s=L0e({name:"MuiSelect",props:e}),{autoWidth:c=!1,children:d,classes:_={},className:x,defaultOpen:a=!1,displayEmpty:I=!1,IconComponent:M=Dve,id:D,input:L,inputProps:G,label:Q,labelId:re,MenuProps:ee,multiple:U=!1,native:H=!1,onClose:Z,onOpen:de,open:ve,renderValue:Ee,SelectDisplayProps:ie,variant:ue="outlined",...K}=s,ge=H?Cxe:tbe,_e=sd(),Se=Yf({props:s,muiFormControl:_e,states:["variant","error"]}),xe=Se.variant||ue,wt={...s,variant:xe,classes:_},ft=nbe(wt),{root:Tt,...gt}=ft,at=L||{standard:F.jsx(rbe,{ownerState:wt}),outlined:F.jsx(ibe,{label:Q,ownerState:wt}),filled:F.jsx(sbe,{ownerState:wt})}[xe],bt=Do(r,mb(at));return F.jsx(Y.Fragment,{children:Y.cloneElement(at,{inputComponent:ge,inputProps:{children:d,error:Se.error,IconComponent:M,variant:xe,type:void 0,multiple:U,...H?{id:D}:{autoWidth:c,defaultOpen:a,displayEmpty:I,labelId:re,MenuProps:ee,onClose:Z,onOpen:de,open:ve,renderValue:Ee,SelectDisplayProps:{id:D,...ie}},...G,classes:G?Qo(gt,G.classes):gt,...L?L.props.inputProps:{}},...(U&&H||I)&&xe==="outlined"?{notched:!0}:{},ref:bt,className:kr(at.props.className,x,ft.root),...!L&&{variant:xe},...K})})});xH.muiName="Select";function obe(t){return Si("MuiTextField",t)}Ii("MuiTextField",["root"]);const abe={standard:ZS,filled:HS,outlined:XS},lbe=t=>{const{classes:e}=t;return Ri({root:["root"]},obe,e)},cbe=Qn(k1e,{name:"MuiTextField",slot:"Root",overridesResolver:(t,e)=>e.root})({}),bH=Y.forwardRef(function(e,r){const s=rs({props:e,name:"MuiTextField"}),{autoComplete:c,autoFocus:d=!1,children:_,className:x,color:a="primary",defaultValue:I,disabled:M=!1,error:D=!1,FormHelperTextProps:L,fullWidth:G=!1,helperText:Q,id:re,InputLabelProps:ee,inputProps:U,InputProps:H,inputRef:Z,label:de,maxRows:ve,minRows:Ee,multiline:ie=!1,name:ue,onBlur:K,onChange:ge,onFocus:_e,placeholder:Se,required:xe=!1,rows:wt,select:ft=!1,SelectProps:Tt,slots:gt={},slotProps:at={},type:bt,value:Zt,variant:tt="outlined",...Et}=s,mt={...s,autoFocus:d,color:a,disabled:M,error:D,fullWidth:G,multiline:ie,required:xe,select:ft,variant:tt},Vt=lbe(mt),Pt=x5(re),pn=Q&&Pt?`${Pt}-helper-text`:void 0,dn=de&&Pt?`${Pt}-label`:void 0,yn=abe[tt],Mt={slots:gt,slotProps:{input:H,inputLabel:ee,htmlInput:U,formHelperText:L,select:Tt,...at}},cn={},Yt=Mt.slotProps.inputLabel;tt==="outlined"&&(Yt&&typeof Yt.shrink<"u"&&(cn.notched=Yt.shrink),cn.label=de),ft&&((!Tt||!Tt.native)&&(cn.id=void 0),cn["aria-describedby"]=void 0);const[Tn,xr]=ql("input",{elementType:yn,externalForwardedProps:Mt,additionalProps:cn,ownerState:mt}),[On,fr]=ql("inputLabel",{elementType:ixe,externalForwardedProps:Mt,ownerState:mt}),[Lr,or]=ql("htmlInput",{elementType:"input",externalForwardedProps:Mt,ownerState:mt}),[Yn,ke]=ql("formHelperText",{elementType:G1e,externalForwardedProps:Mt,ownerState:mt}),[He,lt]=ql("select",{elementType:xH,externalForwardedProps:Mt,ownerState:mt}),Ke=F.jsx(Tn,{"aria-describedby":pn,autoComplete:c,autoFocus:d,defaultValue:I,fullWidth:G,multiline:ie,name:ue,rows:wt,maxRows:ve,minRows:Ee,type:bt,value:Zt,id:Pt,inputRef:Z,onBlur:K,onChange:ge,onFocus:_e,placeholder:Se,inputProps:or,slots:{input:gt.htmlInput?Lr:void 0},...xr});return F.jsxs(cbe,{className:kr(Vt.root,x),disabled:M,error:D,fullWidth:G,ref:r,required:xe,color:a,variant:tt,ownerState:mt,...Et,children:[de!=null&&de!==""&&F.jsx(On,{htmlFor:Pt,id:dn,...fr,children:de}),ft?F.jsx(He,{"aria-describedby":pn,id:Pt,labelId:dn,value:Zt,input:Ke,...lt,children:_}):Ke,Q&&F.jsx(Yn,{id:pn,...ke,children:Q})]})}),wH=id(F.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack"),MV=id([F.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),F.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")],"CameraAlt"),ube=id(F.jsx("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2z"}),"Crop"),hbe=id(F.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),dbe=id(F.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),fbe=id(F.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo"),pbe=Y.createContext(null),mbe=Y.createContext({}),gbe=Y.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),_be=typeof window<"u",ybe=_be?Y.useLayoutEffect:Y.useEffect;function TH(t){const e=Y.useRef(null);return e.current===null&&(e.current=t()),e.current}class vbe extends Y.Component{getSnapshotBeforeUpdate(e){const r=this.props.childRef.current;if(r&&e.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=r.offsetHeight||0,s.width=r.offsetWidth||0,s.top=r.offsetTop,s.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function xbe({children:t,isPresent:e}){const r=Y.useId(),s=Y.useRef(null),c=Y.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=Y.useContext(gbe);return Y.useInsertionEffect(()=>{const{width:_,height:x,top:a,left:I}=c.current;if(e||!s.current||!_||!x)return;s.current.dataset.motionPopId=r;const M=document.createElement("style");return d&&(M.nonce=d),document.head.appendChild(M),M.sheet&&M.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${_}px !important;
            height: ${x}px !important;
            top: ${a}px !important;
            left: ${I}px !important;
          }
        `),()=>{document.head.removeChild(M)}},[e]),F.jsx(vbe,{isPresent:e,childRef:s,sizeRef:c,children:Y.cloneElement(t,{ref:s})})}const bbe=({children:t,initial:e,isPresent:r,onExitComplete:s,custom:c,presenceAffectsLayout:d,mode:_})=>{const x=TH(wbe),a=Y.useId(),I=Y.useMemo(()=>({id:a,initial:e,isPresent:r,custom:c,onExitComplete:M=>{x.set(M,!0);for(const D of x.values())if(!D)return;s&&s()},register:M=>(x.set(M,!1),()=>x.delete(M))}),d?[Math.random()]:[r]);return Y.useMemo(()=>{x.forEach((M,D)=>x.set(D,!1))},[r]),Y.useEffect(()=>{!r&&!x.size&&s&&s()},[r]),_==="popLayout"&&(t=F.jsx(xbe,{isPresent:r,children:t})),F.jsx(pbe.Provider,{value:I,children:t})};function wbe(){return new Map}const KT=t=>t.key||"";function kV(t){const e=[];return Y.Children.forEach(t,r=>{Y.isValidElement(r)&&e.push(r)}),e}const Tbe=({children:t,exitBeforeEnter:e,custom:r,initial:s=!0,onExitComplete:c,presenceAffectsLayout:d=!0,mode:_="sync"})=>{const x=Y.useMemo(()=>kV(t),[t]),a=x.map(KT),I=Y.useRef(!0),M=Y.useRef(x),D=TH(()=>new Map),[L,G]=Y.useState(x),[Q,re]=Y.useState(x);ybe(()=>{I.current=!1,M.current=x;for(let H=0;H<Q.length;H++){const Z=KT(Q[H]);a.includes(Z)?D.delete(Z):D.get(Z)!==!0&&D.set(Z,!1)}},[Q,a.length,a.join("-")]);const ee=[];if(x!==L){let H=[...x];for(let Z=0;Z<Q.length;Z++){const de=Q[Z],ve=KT(de);a.includes(ve)||(H.splice(Z,0,de),ee.push(de))}_==="wait"&&ee.length&&(H=ee),re(kV(H)),G(x);return}const{forceRender:U}=Y.useContext(mbe);return F.jsx(F.Fragment,{children:Q.map(H=>{const Z=KT(H),de=x===Q||a.includes(Z),ve=()=>{if(D.has(Z))D.set(Z,!0);else return;let Ee=!0;D.forEach(ie=>{ie||(Ee=!1)}),Ee&&(U==null||U(),re(M.current),c&&c())};return F.jsx(bbe,{isPresent:de,initial:!I.current||s?void 0:!1,custom:de?void 0:r,presenceAffectsLayout:d,mode:_,onExitComplete:de?void 0:ve,children:H},Z)})})};var M5=_b(),Or=t=>gb(t,M5),k5=_b();Or.write=t=>gb(t,k5);var ZC=_b();Or.onStart=t=>gb(t,ZC);var O5=_b();Or.onFrame=t=>gb(t,O5);var D5=_b();Or.onFinish=t=>gb(t,D5);var fy=[];Or.setTimeout=(t,e)=>{const r=Or.now()+e,s=()=>{const d=fy.findIndex(_=>_.cancel==s);~d&&fy.splice(d,1),gf-=~d?1:0},c={time:r,handler:t,cancel:s};return fy.splice(EH(r),0,c),gf+=1,SH(),c};var EH=t=>~(~fy.findIndex(e=>e.time>t)||~fy.length);Or.cancel=t=>{ZC.delete(t),O5.delete(t),D5.delete(t),M5.delete(t),k5.delete(t)};Or.sync=t=>{qk=!0,Or.batchedUpdates(t),qk=!1};Or.throttle=t=>{let e;function r(){try{t(...e)}finally{e=null}}function s(...c){e=c,Or.onStart(r)}return s.handler=t,s.cancel=()=>{ZC.delete(r),e=null},s};var L5=typeof window<"u"?window.requestAnimationFrame:()=>{};Or.use=t=>L5=t;Or.now=typeof performance<"u"?()=>performance.now():Date.now;Or.batchedUpdates=t=>t();Or.catch=console.error;Or.frameLoop="always";Or.advance=()=>{Or.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):CH()};var mf=-1,gf=0,qk=!1;function gb(t,e){qk?(e.delete(t),t(0)):(e.add(t),SH())}function SH(){mf<0&&(mf=0,Or.frameLoop!=="demand"&&L5(IH))}function Ebe(){mf=-1}function IH(){~mf&&(L5(IH),Or.batchedUpdates(CH))}function CH(){const t=mf;mf=Or.now();const e=EH(mf);if(e&&(AH(fy.splice(0,e),r=>r.handler()),gf-=e),!gf){Ebe();return}ZC.flush(),M5.flush(t?Math.min(64,mf-t):16.667),O5.flush(),k5.flush(),D5.flush()}function _b(){let t=new Set,e=t;return{add(r){gf+=e==t&&!t.has(r)?1:0,t.add(r)},delete(r){return gf-=e==t&&t.has(r)?1:0,t.delete(r)},flush(r){e.size&&(t=new Set,gf-=e.size,AH(e,s=>s(r)&&t.add(s)),gf+=t.size,e=t)}}}function AH(t,e){t.forEach(r=>{try{e(r)}catch(s){Or.catch(s)}})}var Sbe=Object.defineProperty,Ibe=(t,e)=>{for(var r in e)Sbe(t,r,{get:e[r],enumerable:!0})},qc={};Ibe(qc,{assign:()=>Abe,colors:()=>Mf,createStringInterpolator:()=>N5,skipAnimation:()=>RH,to:()=>PH,willAdvance:()=>F5});function Gk(){}var Cbe=(t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,configurable:!0}),xn={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function Ch(t,e){if(xn.arr(t)){if(!xn.arr(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}return t===e}var Yr=(t,e)=>t.forEach(e);function $u(t,e,r){if(xn.arr(t)){for(let s=0;s<t.length;s++)e.call(r,t[s],`${s}`);return}for(const s in t)t.hasOwnProperty(s)&&e.call(r,t[s],s)}var ul=t=>xn.und(t)?[]:xn.arr(t)?t:[t];function F1(t,e){if(t.size){const r=Array.from(t);t.clear(),Yr(r,e)}}var d1=(t,...e)=>F1(t,r=>r(...e)),z5=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),N5,PH,Mf=null,RH=!1,F5=Gk,Abe=t=>{t.to&&(PH=t.to),t.now&&(Or.now=t.now),t.colors!==void 0&&(Mf=t.colors),t.skipAnimation!=null&&(RH=t.skipAnimation),t.createStringInterpolator&&(N5=t.createStringInterpolator),t.requestAnimationFrame&&Or.use(t.requestAnimationFrame),t.batchedUpdates&&(Or.batchedUpdates=t.batchedUpdates),t.willAdvance&&(F5=t.willAdvance),t.frameLoop&&(Or.frameLoop=t.frameLoop)},B1=new Set,Gl=[],kR=[],KS=0,XC={get idle(){return!B1.size&&!Gl.length},start(t){KS>t.priority?(B1.add(t),Or.onStart(Pbe)):(MH(t),Or(Wk))},advance:Wk,sort(t){if(KS)Or.onFrame(()=>XC.sort(t));else{const e=Gl.indexOf(t);~e&&(Gl.splice(e,1),kH(t))}},clear(){Gl=[],B1.clear()}};function Pbe(){B1.forEach(MH),B1.clear(),Or(Wk)}function MH(t){Gl.includes(t)||kH(t)}function kH(t){Gl.splice(Rbe(Gl,e=>e.priority>t.priority),0,t)}function Wk(t){const e=kR;for(let r=0;r<Gl.length;r++){const s=Gl[r];KS=s.priority,s.idle||(F5(s),s.advance(t),s.idle||e.push(s))}return KS=0,kR=Gl,kR.length=0,Gl=e,Gl.length>0}function Rbe(t,e){const r=t.findIndex(e);return r<0?t.length:r}var Mbe=(t,e,r)=>Math.min(Math.max(r,t),e),kbe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Nc="[-+]?\\d*\\.?\\d+",QS=Nc+"%";function KC(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var Obe=new RegExp("rgb"+KC(Nc,Nc,Nc)),Dbe=new RegExp("rgba"+KC(Nc,Nc,Nc,Nc)),Lbe=new RegExp("hsl"+KC(Nc,QS,QS)),zbe=new RegExp("hsla"+KC(Nc,QS,QS,Nc)),Nbe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Fbe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,Bbe=/^#([0-9a-fA-F]{6})$/,jbe=/^#([0-9a-fA-F]{8})$/;function Ube(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=Bbe.exec(t))?parseInt(e[1]+"ff",16)>>>0:Mf&&Mf[t]!==void 0?Mf[t]:(e=Obe.exec(t))?(I_(e[1])<<24|I_(e[2])<<16|I_(e[3])<<8|255)>>>0:(e=Dbe.exec(t))?(I_(e[1])<<24|I_(e[2])<<16|I_(e[3])<<8|LV(e[4]))>>>0:(e=Nbe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=jbe.exec(t))?parseInt(e[1],16)>>>0:(e=Fbe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=Lbe.exec(t))?(OV(DV(e[1]),QT(e[2]),QT(e[3]))|255)>>>0:(e=zbe.exec(t))?(OV(DV(e[1]),QT(e[2]),QT(e[3]))|LV(e[4]))>>>0:null}function OR(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}function OV(t,e,r){const s=r<.5?r*(1+e):r+e-r*e,c=2*r-s,d=OR(c,s,t+1/3),_=OR(c,s,t),x=OR(c,s,t-1/3);return Math.round(d*255)<<24|Math.round(_*255)<<16|Math.round(x*255)<<8}function I_(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function DV(t){return(parseFloat(t)%360+360)%360/360}function LV(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function QT(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function zV(t){let e=Ube(t);if(e===null)return t;e=e||0;const r=(e&4278190080)>>>24,s=(e&16711680)>>>16,c=(e&65280)>>>8,d=(e&255)/255;return`rgba(${r}, ${s}, ${c}, ${d})`}var Px=(t,e,r)=>{if(xn.fun(t))return t;if(xn.arr(t))return Px({range:t,output:e,extrapolate:r});if(xn.str(t.output[0]))return N5(t);const s=t,c=s.output,d=s.range||[0,1],_=s.extrapolateLeft||s.extrapolate||"extend",x=s.extrapolateRight||s.extrapolate||"extend",a=s.easing||(I=>I);return I=>{const M=$be(I,d);return Vbe(I,d[M],d[M+1],c[M],c[M+1],a,_,x,s.map)}};function Vbe(t,e,r,s,c,d,_,x,a){let I=a?a(t):t;if(I<e){if(_==="identity")return I;_==="clamp"&&(I=e)}if(I>r){if(x==="identity")return I;x==="clamp"&&(I=r)}return s===c?s:e===r?t<=e?s:c:(e===-1/0?I=-I:r===1/0?I=I-e:I=(I-e)/(r-e),I=d(I),s===-1/0?I=-I:c===1/0?I=I+s:I=I*(c-s)+s,I)}function $be(t,e){for(var r=1;r<e.length-1&&!(e[r]>=t);++r);return r-1}var qbe=(t,e="end")=>r=>{r=e==="end"?Math.min(r,.999):Math.max(r,.001);const s=r*t,c=e==="end"?Math.floor(s):Math.ceil(s);return Mbe(0,1,c/t)},YS=1.70158,YT=YS*1.525,NV=YS+1,FV=2*Math.PI/3,BV=2*Math.PI/4.5,JT=t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,Gbe={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>NV*t*t*t-YS*t*t,easeOutBack:t=>1+NV*Math.pow(t-1,3)+YS*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*((YT+1)*2*t-YT)/2:(Math.pow(2*t-2,2)*((YT+1)*(t*2-2)+YT)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*FV),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*FV)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*BV))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*BV)/2+1,easeInBounce:t=>1-JT(1-t),easeOutBounce:JT,easeInOutBounce:t=>t<.5?(1-JT(1-2*t))/2:(1+JT(2*t-1))/2,steps:qbe},Rx=Symbol.for("FluidValue.get"),Ny=Symbol.for("FluidValue.observers"),Vl=t=>!!(t&&t[Rx]),Da=t=>t&&t[Rx]?t[Rx]():t,jV=t=>t[Ny]||null;function Wbe(t,e){t.eventObserved?t.eventObserved(e):t(e)}function Mx(t,e){const r=t[Ny];r&&r.forEach(s=>{Wbe(s,e)})}var OH=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");Hbe(this,t)}},Hbe=(t,e)=>DH(t,Rx,e);function s0(t,e){if(t[Rx]){let r=t[Ny];r||DH(t,Ny,r=new Set),r.has(e)||(r.add(e),t.observerAdded&&t.observerAdded(r.size,e))}return e}function kx(t,e){const r=t[Ny];if(r&&r.has(e)){const s=r.size-1;s?r.delete(e):t[Ny]=null,t.observerRemoved&&t.observerRemoved(s,e)}}var DH=(t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,configurable:!0}),RE=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Zbe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,UV=new RegExp(`(${RE.source})(%|[a-z]+)`,"i"),Xbe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,QC=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,LH=t=>{const[e,r]=Kbe(t);if(!e||z5())return t;const s=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(s)return s.trim();if(r&&r.startsWith("--")){const c=window.getComputedStyle(document.documentElement).getPropertyValue(r);return c||t}else{if(r&&QC.test(r))return LH(r);if(r)return r}return t},Kbe=t=>{const e=QC.exec(t);if(!e)return[,];const[,r,s]=e;return[r,s]},DR,Qbe=(t,e,r,s,c)=>`rgba(${Math.round(e)}, ${Math.round(r)}, ${Math.round(s)}, ${c})`,zH=t=>{DR||(DR=Mf?new RegExp(`(${Object.keys(Mf).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(d=>Da(d).replace(QC,LH).replace(Zbe,zV).replace(DR,zV)),r=e.map(d=>d.match(RE).map(Number)),c=r[0].map((d,_)=>r.map(x=>{if(!(_ in x))throw Error('The arity of each "output" value must be equal');return x[_]})).map(d=>Px({...t,output:d}));return d=>{var a;const _=!UV.test(e[0])&&((a=e.find(I=>UV.test(I)))==null?void 0:a.replace(RE,""));let x=0;return e[0].replace(RE,()=>`${c[x++](d)}${_||""}`).replace(Xbe,Qbe)}},B5="react-spring: ",NH=t=>{const e=t;let r=!1;if(typeof e!="function")throw new TypeError(`${B5}once requires a function parameter`);return(...s)=>{r||(e(...s),r=!0)}},Ybe=NH(console.warn);function Jbe(){Ybe(`${B5}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var ewe=NH(console.warn);function twe(){ewe(`${B5}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function YC(t){return xn.str(t)&&(t[0]=="#"||/\d/.test(t)||!z5()&&QC.test(t)||t in(Mf||{}))}var j5=z5()?Y.useEffect:Y.useLayoutEffect,nwe=()=>{const t=Y.useRef(!1);return j5(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function FH(){const t=Y.useState()[1],e=nwe();return()=>{e.current&&t(Math.random())}}function rwe(t,e){const[r]=Y.useState(()=>({inputs:e,result:t()})),s=Y.useRef(),c=s.current;let d=c;return d?e&&d.inputs&&iwe(e,d.inputs)||(d={inputs:e,result:t()}):d=r,Y.useEffect(()=>{s.current=d,c==r&&(r.inputs=r.result=void 0)},[d]),d.result}function iwe(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}var BH=t=>Y.useEffect(t,swe),swe=[];function VV(t){const e=Y.useRef();return Y.useEffect(()=>{e.current=t}),e.current}var Ox=Symbol.for("Animated:node"),owe=t=>!!t&&t[Ox]===t,Eu=t=>t&&t[Ox],U5=(t,e)=>Cbe(t,Ox,e),JC=t=>t&&t[Ox]&&t[Ox].getPayload(),jH=class{constructor(){U5(this,this)}getPayload(){return this.payload||[]}},yb=class extends jH{constructor(t){super(),this._value=t,this.done=!0,this.durationProgress=0,xn.num(this._value)&&(this.lastPosition=this._value)}static create(t){return new yb(t)}getPayload(){return[this]}getValue(){return this._value}setValue(t,e){return xn.num(t)&&(this.lastPosition=t,e&&(t=Math.round(t/e)*e,this.done&&(this.lastPosition=t))),this._value===t?!1:(this._value=t,!0)}reset(){const{done:t}=this;this.done=!1,xn.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,t&&(this.lastVelocity=null),this.v0=null)}},Dx=class extends yb{constructor(t){super(0),this._string=null,this._toString=Px({output:[t,t]})}static create(t){return new Dx(t)}getValue(){const t=this._string;return t??(this._string=this._toString(this._value))}setValue(t){if(xn.str(t)){if(t==this._string)return!1;this._string=t,this._value=1}else if(super.setValue(t))this._string=null;else return!1;return!0}reset(t){t&&(this._toString=Px({output:[this.getValue(),t]})),this._value=0,super.reset()}},JS={dependencies:null},eA=class extends jH{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return $u(this.source,(r,s)=>{owe(r)?e[s]=r.getValue(t):Vl(r)?e[s]=Da(r):t||(e[s]=r)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&Yr(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return $u(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){JS.dependencies&&Vl(t)&&JS.dependencies.add(t);const e=JC(t);e&&Yr(e,r=>this.add(r))}},UH=class extends eA{constructor(t){super(t)}static create(t){return new UH(t)}getValue(){return this.source.map(t=>t.getValue())}setValue(t){const e=this.getPayload();return t.length==e.length?e.map((r,s)=>r.setValue(t[s])).some(Boolean):(super.setValue(t.map(awe)),!0)}};function awe(t){return(YC(t)?Dx:yb).create(t)}function Hk(t){const e=Eu(t);return e?e.constructor:xn.arr(t)?UH:YC(t)?Dx:yb}var $V=(t,e)=>{const r=!xn.fun(t)||t.prototype&&t.prototype.isReactComponent;return Y.forwardRef((s,c)=>{const d=Y.useRef(null),_=r&&Y.useCallback(Q=>{d.current=uwe(c,Q)},[c]),[x,a]=cwe(s,e),I=FH(),M=()=>{const Q=d.current;if(r&&!Q)return;(Q?e.applyAnimatedValues(Q,x.getValue(!0)):!1)===!1&&I()},D=new lwe(M,a),L=Y.useRef();j5(()=>(L.current=D,Yr(a,Q=>s0(Q,D)),()=>{L.current&&(Yr(L.current.deps,Q=>kx(Q,L.current)),Or.cancel(L.current.update))})),Y.useEffect(M,[]),BH(()=>()=>{const Q=L.current;Yr(Q.deps,re=>kx(re,Q))});const G=e.getComponentProps(x.getValue());return Y.createElement(t,{...G,ref:_})})},lwe=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&Or.write(this.update)}};function cwe(t,e){const r=new Set;return JS.dependencies=r,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new eA(t),JS.dependencies=null,[t,r]}function uwe(t,e){return t&&(xn.fun(t)?t(e):t.current=e),e}var qV=Symbol.for("AnimatedComponent"),hwe=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:r=c=>new eA(c),getComponentProps:s=c=>c}={})=>{const c={applyAnimatedValues:e,createAnimatedStyle:r,getComponentProps:s},d=_=>{const x=GV(_)||"Anonymous";return xn.str(_)?_=d[_]||(d[_]=$V(_,c)):_=_[qV]||(_[qV]=$V(_,c)),_.displayName=`Animated(${x})`,_};return $u(t,(_,x)=>{xn.arr(t)&&(x=GV(_)),d[x]=d(_)}),{animated:d}},GV=t=>xn.str(t)?t:t&&xn.str(t.displayName)?t.displayName:xn.fun(t)&&t.name||null;function om(t,...e){return xn.fun(t)?t(...e):t}var j1=(t,e)=>t===!0||!!(e&&t&&(xn.fun(t)?t(e):ul(t).includes(e))),VH=(t,e)=>xn.obj(t)?e&&t[e]:t,$H=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,dwe=t=>t,V5=(t,e=dwe)=>{let r=fwe;t.default&&t.default!==!0&&(t=t.default,r=Object.keys(t));const s={};for(const c of r){const d=e(t[c],c);xn.und(d)||(s[c]=d)}return s},fwe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],pwe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function mwe(t){const e={};let r=0;if($u(t,(s,c)=>{pwe[c]||(e[c]=s,r++)}),r)return e}function qH(t){const e=mwe(t);if(e){const r={to:e};return $u(t,(s,c)=>c in e||(r[c]=s)),r}return{...t}}function Lx(t){return t=Da(t),xn.arr(t)?t.map(Lx):YC(t)?qc.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function gwe(t){for(const e in t)return!0;return!1}function Zk(t){return xn.fun(t)||xn.arr(t)&&xn.obj(t[0])}function _we(t,e){var r;(r=t.ref)==null||r.delete(t),e==null||e.delete(t)}function ywe(t,e){var r;e&&t.ref!==e&&((r=t.ref)==null||r.delete(t),e.add(t),t.ref=e)}var vwe={default:{tension:170,friction:26},gentle:{tension:120,friction:14},wobbly:{tension:180,friction:12},stiff:{tension:210,friction:20},slow:{tension:280,friction:60},molasses:{tension:280,friction:120}},Xk={...vwe.default,mass:1,damping:1,easing:Gbe.linear,clamp:!1},xwe=class{constructor(){this.velocity=0,Object.assign(this,Xk)}};function bwe(t,e,r){r&&(r={...r},WV(r,e),e={...r,...e}),WV(t,e),Object.assign(t,e);for(const _ in Xk)t[_]==null&&(t[_]=Xk[_]);let{frequency:s,damping:c}=t;const{mass:d}=t;return xn.und(s)||(s<.01&&(s=.01),c<0&&(c=0),t.tension=Math.pow(2*Math.PI/s,2)*d,t.friction=4*Math.PI*c*d/s),t}function WV(t,e){if(!xn.und(e.decay))t.duration=void 0;else{const r=!xn.und(e.tension)||!xn.und(e.friction);(r||!xn.und(e.frequency)||!xn.und(e.damping)||!xn.und(e.mass))&&(t.duration=void 0,t.decay=void 0),r&&(t.frequency=void 0)}}var HV=[],wwe=class{constructor(){this.changed=!1,this.values=HV,this.toValues=null,this.fromValues=HV,this.config=new xwe,this.immediate=!1}};function GH(t,{key:e,props:r,defaultProps:s,state:c,actions:d}){return new Promise((_,x)=>{let a,I,M=j1(r.cancel??(s==null?void 0:s.cancel),e);if(M)G();else{xn.und(r.pause)||(c.paused=j1(r.pause,e));let Q=s==null?void 0:s.pause;Q!==!0&&(Q=c.paused||j1(Q,e)),a=om(r.delay||0,e),Q?(c.resumeQueue.add(L),d.pause()):(d.resume(),L())}function D(){c.resumeQueue.add(L),c.timeouts.delete(I),I.cancel(),a=I.time-Or.now()}function L(){a>0&&!qc.skipAnimation?(c.delayed=!0,I=Or.setTimeout(G,a),c.pauseQueue.add(D),c.timeouts.add(I)):G()}function G(){c.delayed&&(c.delayed=!1),c.pauseQueue.delete(D),c.timeouts.delete(I),t<=(c.cancelId||0)&&(M=!0);try{d.start({...r,callId:t,cancel:M},_)}catch(Q){x(Q)}}})}var $5=(t,e)=>e.length==1?e[0]:e.some(r=>r.cancelled)?py(t.get()):e.every(r=>r.noop)?WH(t.get()):Oc(t.get(),e.every(r=>r.finished)),WH=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),Oc=(t,e,r=!1)=>({value:t,finished:e,cancelled:r}),py=t=>({value:t,cancelled:!0,finished:!1});function HH(t,e,r,s){const{callId:c,parentId:d,onRest:_}=e,{asyncTo:x,promise:a}=r;return!d&&t===x&&!e.reset?a:r.promise=(async()=>{r.asyncId=c,r.asyncTo=t;const I=V5(e,(ee,U)=>U==="onRest"?void 0:ee);let M,D;const L=new Promise((ee,U)=>(M=ee,D=U)),G=ee=>{const U=c<=(r.cancelId||0)&&py(s)||c!==r.asyncId&&Oc(s,!1);if(U)throw ee.result=U,D(ee),ee},Q=(ee,U)=>{const H=new ZV,Z=new XV;return(async()=>{if(qc.skipAnimation)throw zx(r),Z.result=Oc(s,!1),D(Z),Z;G(H);const de=xn.obj(ee)?{...ee}:{...U,to:ee};de.parentId=c,$u(I,(Ee,ie)=>{xn.und(de[ie])&&(de[ie]=Ee)});const ve=await s.start(de);return G(H),r.paused&&await new Promise(Ee=>{r.resumeQueue.add(Ee)}),ve})()};let re;if(qc.skipAnimation)return zx(r),Oc(s,!1);try{let ee;xn.arr(t)?ee=(async U=>{for(const H of U)await Q(H)})(t):ee=Promise.resolve(t(Q,s.stop.bind(s))),await Promise.all([ee.then(M),L]),re=Oc(s.get(),!0,!1)}catch(ee){if(ee instanceof ZV)re=ee.result;else if(ee instanceof XV)re=ee.result;else throw ee}finally{c==r.asyncId&&(r.asyncId=d,r.asyncTo=d?x:void 0,r.promise=d?a:void 0)}return xn.fun(_)&&Or.batchedUpdates(()=>{_(re,s,s.item)}),re})()}function zx(t,e){F1(t.timeouts,r=>r.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var ZV=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},XV=class extends Error{constructor(){super("SkipAnimationSignal")}},Kk=t=>t instanceof q5,Twe=1,q5=class extends OH{constructor(){super(...arguments),this.id=Twe++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=Eu(this);return t&&t.getValue()}to(...t){return qc.to(this,t)}interpolate(...t){return Jbe(),qc.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){Mx(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||XC.sort(this),Mx(this,{type:"priority",parent:this,priority:t})}},$m=Symbol.for("SpringPhase"),ZH=1,Qk=2,Yk=4,LR=t=>(t[$m]&ZH)>0,Jd=t=>(t[$m]&Qk)>0,Zv=t=>(t[$m]&Yk)>0,KV=(t,e)=>e?t[$m]|=Qk|ZH:t[$m]&=~Qk,QV=(t,e)=>e?t[$m]|=Yk:t[$m]&=~Yk,Ewe=class extends q5{constructor(t,e){if(super(),this.animation=new wwe,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!xn.und(t)||!xn.und(e)){const r=xn.obj(t)?{...t}:{...e,from:t};xn.und(r.default)&&(r.default=!0),this.start(r)}}get idle(){return!(Jd(this)||this._state.asyncTo)||Zv(this)}get goal(){return Da(this.animation.to)}get velocity(){const t=Eu(this);return t instanceof yb?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return LR(this)}get isAnimating(){return Jd(this)}get isPaused(){return Zv(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,r=!1;const s=this.animation;let{toValues:c}=s;const{config:d}=s,_=JC(s.to);!_&&Vl(s.to)&&(c=ul(Da(s.to))),s.values.forEach((I,M)=>{if(I.done)return;const D=I.constructor==Dx?1:_?_[M].lastPosition:c[M];let L=s.immediate,G=D;if(!L){if(G=I.lastPosition,d.tension<=0){I.done=!0;return}let Q=I.elapsedTime+=t;const re=s.fromValues[M],ee=I.v0!=null?I.v0:I.v0=xn.arr(d.velocity)?d.velocity[M]:d.velocity;let U;const H=d.precision||(re==D?.005:Math.min(1,Math.abs(D-re)*.001));if(xn.und(d.duration))if(d.decay){const Z=d.decay===!0?.998:d.decay,de=Math.exp(-(1-Z)*Q);G=re+ee/(1-Z)*(1-de),L=Math.abs(I.lastPosition-G)<=H,U=ee*de}else{U=I.lastVelocity==null?ee:I.lastVelocity;const Z=d.restVelocity||H/10,de=d.clamp?0:d.bounce,ve=!xn.und(de),Ee=re==D?I.v0>0:re<D;let ie,ue=!1;const K=1,ge=Math.ceil(t/K);for(let _e=0;_e<ge&&(ie=Math.abs(U)>Z,!(!ie&&(L=Math.abs(D-G)<=H,L)));++_e){ve&&(ue=G==D||G>D==Ee,ue&&(U=-U*de,G=D));const Se=-d.tension*1e-6*(G-D),xe=-d.friction*.001*U,wt=(Se+xe)/d.mass;U=U+wt*K,G=G+U*K}}else{let Z=1;d.duration>0&&(this._memoizedDuration!==d.duration&&(this._memoizedDuration=d.duration,I.durationProgress>0&&(I.elapsedTime=d.duration*I.durationProgress,Q=I.elapsedTime+=t)),Z=(d.progress||0)+Q/this._memoizedDuration,Z=Z>1?1:Z<0?0:Z,I.durationProgress=Z),G=re+d.easing(Z)*(D-re),U=(G-I.lastPosition)/t,L=Z==1}I.lastVelocity=U,Number.isNaN(G)&&(console.warn("Got NaN while animating:",this),L=!0)}_&&!_[M].done&&(L=!1),L?I.done=!0:e=!1,I.setValue(G,d.round)&&(r=!0)});const x=Eu(this),a=x.getValue();if(e){const I=Da(s.to);(a!==I||r)&&!d.decay?(x.setValue(I),this._onChange(I)):r&&d.decay&&this._onChange(a),this._stop()}else r&&this._onChange(a)}set(t){return Or.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(Jd(this)){const{to:t,config:e}=this.animation;Or.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let r;return xn.und(t)?(r=this.queue||[],this.queue=[]):r=[xn.obj(t)?t:{...e,to:t}],Promise.all(r.map(s=>this._update(s))).then(s=>$5(this,s))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),zx(this._state,t&&this._lastCallId),Or.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:r,from:s}=t;r=xn.obj(r)?r[e]:r,(r==null||Zk(r))&&(r=void 0),s=xn.obj(s)?s[e]:s,s==null&&(s=void 0);const c={to:r,from:s};return LR(this)||(t.reverse&&([r,s]=[s,r]),s=Da(s),xn.und(s)?Eu(this)||this._set(r):this._set(s)),c}_update({...t},e){const{key:r,defaultProps:s}=this;t.default&&Object.assign(s,V5(t,(_,x)=>/^on/.test(x)?VH(_,r):_)),JV(this,t,"onProps"),Kv(this,"onProps",t,this);const c=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const d=this._state;return GH(++this._lastCallId,{key:r,props:t,defaultProps:s,state:d,actions:{pause:()=>{Zv(this)||(QV(this,!0),d1(d.pauseQueue),Kv(this,"onPause",Oc(this,Xv(this,this.animation.to)),this))},resume:()=>{Zv(this)&&(QV(this,!1),Jd(this)&&this._resume(),d1(d.resumeQueue),Kv(this,"onResume",Oc(this,Xv(this,this.animation.to)),this))},start:this._merge.bind(this,c)}}).then(_=>{if(t.loop&&_.finished&&!(e&&_.noop)){const x=XH(t);if(x)return this._update(x,!0)}return _})}_merge(t,e,r){if(e.cancel)return this.stop(!0),r(py(this));const s=!xn.und(t.to),c=!xn.und(t.from);if(s||c)if(e.callId>this._lastToId)this._lastToId=e.callId;else return r(py(this));const{key:d,defaultProps:_,animation:x}=this,{to:a,from:I}=x;let{to:M=a,from:D=I}=t;c&&!s&&(!e.default||xn.und(M))&&(M=D),e.reverse&&([M,D]=[D,M]);const L=!Ch(D,I);L&&(x.from=D),D=Da(D);const G=!Ch(M,a);G&&this._focus(M);const Q=Zk(e.to),{config:re}=x,{decay:ee,velocity:U}=re;(s||c)&&(re.velocity=0),e.config&&!Q&&bwe(re,om(e.config,d),e.config!==_.config?om(_.config,d):void 0);let H=Eu(this);if(!H||xn.und(M))return r(Oc(this,!0));const Z=xn.und(e.reset)?c&&!e.default:!xn.und(D)&&j1(e.reset,d),de=Z?D:this.get(),ve=Lx(M),Ee=xn.num(ve)||xn.arr(ve)||YC(ve),ie=!Q&&(!Ee||j1(_.immediate||e.immediate,d));if(G){const _e=Hk(M);if(_e!==H.constructor)if(ie)H=this._set(ve);else throw Error(`Cannot animate between ${H.constructor.name} and ${_e.name}, as the "to" prop suggests`)}const ue=H.constructor;let K=Vl(M),ge=!1;if(!K){const _e=Z||!LR(this)&&L;(G||_e)&&(ge=Ch(Lx(de),ve),K=!ge),(!Ch(x.immediate,ie)&&!ie||!Ch(re.decay,ee)||!Ch(re.velocity,U))&&(K=!0)}if(ge&&Jd(this)&&(x.changed&&!Z?K=!0:K||this._stop(a)),!Q&&((K||Vl(a))&&(x.values=H.getPayload(),x.toValues=Vl(M)?null:ue==Dx?[1]:ul(ve)),x.immediate!=ie&&(x.immediate=ie,!ie&&!Z&&this._set(a)),K)){const{onRest:_e}=x;Yr(Iwe,xe=>JV(this,e,xe));const Se=Oc(this,Xv(this,a));d1(this._pendingCalls,Se),this._pendingCalls.add(r),x.changed&&Or.batchedUpdates(()=>{var xe;x.changed=!Z,_e==null||_e(Se,this),Z?om(_.onRest,Se):(xe=x.onStart)==null||xe.call(x,Se,this)})}Z&&this._set(de),Q?r(HH(e.to,e,this._state,this)):K?this._start():Jd(this)&&!G?this._pendingCalls.add(r):r(WH(de))}_focus(t){const e=this.animation;t!==e.to&&(jV(this)&&this._detach(),e.to=t,jV(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;Vl(e)&&(s0(e,this),Kk(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;Vl(t)&&kx(t,this)}_set(t,e=!0){const r=Da(t);if(!xn.und(r)){const s=Eu(this);if(!s||!Ch(r,s.getValue())){const c=Hk(r);!s||s.constructor!=c?U5(this,c.create(r)):s.setValue(r),s&&Or.batchedUpdates(()=>{this._onChange(r,e)})}}return Eu(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,Kv(this,"onStart",Oc(this,Xv(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),om(this.animation.onChange,t,this)),om(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;Eu(this).reset(Da(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),Jd(this)||(KV(this,!0),Zv(this)||this._resume())}_resume(){qc.skipAnimation?this.finish():XC.start(this)}_stop(t,e){if(Jd(this)){KV(this,!1);const r=this.animation;Yr(r.values,c=>{c.done=!0}),r.toValues&&(r.onChange=r.onPause=r.onResume=void 0),Mx(this,{type:"idle",parent:this});const s=e?py(this.get()):Oc(this.get(),Xv(this,t??r.to));d1(this._pendingCalls,s),r.changed&&(r.changed=!1,Kv(this,"onRest",s,this))}}};function Xv(t,e){const r=Lx(e),s=Lx(t.get());return Ch(s,r)}function XH(t,e=t.loop,r=t.to){const s=om(e);if(s){const c=s!==!0&&qH(s),d=(c||t).reverse,_=!c||c.reset;return Nx({...t,loop:e,default:!1,pause:void 0,to:!d||Zk(r)?r:void 0,from:_?t.from:void 0,reset:_,...c})}}function Nx(t){const{to:e,from:r}=t=qH(t),s=new Set;return xn.obj(e)&&YV(e,s),xn.obj(r)&&YV(r,s),t.keys=s.size?Array.from(s):null,t}function Swe(t){const e=Nx(t);return xn.und(e.default)&&(e.default=V5(e)),e}function YV(t,e){$u(t,(r,s)=>r!=null&&e.add(s))}var Iwe=["onStart","onRest","onChange","onPause","onResume"];function JV(t,e,r){t.animation[r]=e[r]!==$H(e,r)?VH(e[r],t.key):void 0}function Kv(t,e,...r){var s,c,d,_;(c=(s=t.animation)[e])==null||c.call(s,...r),(_=(d=t.defaultProps)[e])==null||_.call(d,...r)}var Cwe=["onStart","onChange","onRest"],Awe=1,Pwe=class{constructor(e,r){this.id=Awe++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),r&&(this._flush=r),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((r,s)=>e[s]=r.get()),e}set(e){for(const r in e){const s=e[r];xn.und(s)||this.springs[r].set(s)}}update(e){return e&&this.queue.push(Nx(e)),this}start(e){let{queue:r}=this;return e?r=ul(e).map(Nx):this.queue=[],this._flush?this._flush(this,r):(eZ(this,r),Jk(this,r))}stop(e,r){if(e!==!!e&&(r=e),r){const s=this.springs;Yr(ul(r),c=>s[c].stop(!!e))}else zx(this._state,this._lastAsyncId),this.each(s=>s.stop(!!e));return this}pause(e){if(xn.und(e))this.start({pause:!0});else{const r=this.springs;Yr(ul(e),s=>r[s].pause())}return this}resume(e){if(xn.und(e))this.start({pause:!1});else{const r=this.springs;Yr(ul(e),s=>r[s].resume())}return this}each(e){$u(this.springs,e)}_onFrame(){const{onStart:e,onChange:r,onRest:s}=this._events,c=this._active.size>0,d=this._changed.size>0;(c&&!this._started||d&&!this._started)&&(this._started=!0,F1(e,([a,I])=>{I.value=this.get(),a(I,this,this._item)}));const _=!c&&this._started,x=d||_&&s.size?this.get():null;d&&r.size&&F1(r,([a,I])=>{I.value=x,a(I,this,this._item)}),_&&(this._started=!1,F1(s,([a,I])=>{I.value=x,a(I,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;Or.onFrame(this._onFrame)}};function Jk(t,e){return Promise.all(e.map(r=>KH(t,r))).then(r=>$5(t,r))}async function KH(t,e,r){const{keys:s,to:c,from:d,loop:_,onRest:x,onResolve:a}=e,I=xn.obj(e.default)&&e.default;_&&(e.loop=!1),c===!1&&(e.to=null),d===!1&&(e.from=null);const M=xn.arr(c)||xn.fun(c)?c:void 0;M?(e.to=void 0,e.onRest=void 0,I&&(I.onRest=void 0)):Yr(Cwe,re=>{const ee=e[re];if(xn.fun(ee)){const U=t._events[re];e[re]=({finished:H,cancelled:Z})=>{const de=U.get(ee);de?(H||(de.finished=!1),Z&&(de.cancelled=!0)):U.set(ee,{value:null,finished:H||!1,cancelled:Z||!1})},I&&(I[re]=e[re])}});const D=t._state;e.pause===!D.paused?(D.paused=e.pause,d1(e.pause?D.pauseQueue:D.resumeQueue)):D.paused&&(e.pause=!0);const L=(s||Object.keys(t.springs)).map(re=>t.springs[re].start(e)),G=e.cancel===!0||$H(e,"cancel")===!0;(M||G&&D.asyncId)&&L.push(GH(++t._lastAsyncId,{props:e,state:D,actions:{pause:Gk,resume:Gk,start(re,ee){G?(zx(D,t._lastAsyncId),ee(py(t))):(re.onRest=x,ee(HH(M,re,D,t)))}}})),D.paused&&await new Promise(re=>{D.resumeQueue.add(re)});const Q=$5(t,await Promise.all(L));if(_&&Q.finished&&!(r&&Q.noop)){const re=XH(e,_,c);if(re)return eZ(t,[re]),KH(t,re,!0)}return a&&Or.batchedUpdates(()=>a(Q,t,t.item)),Q}function e$(t,e){const r={...t.springs};return e&&Yr(ul(e),s=>{xn.und(s.keys)&&(s=Nx(s)),xn.obj(s.to)||(s={...s,to:void 0}),JH(r,s,c=>YH(c))}),QH(t,r),r}function QH(t,e){$u(e,(r,s)=>{t.springs[s]||(t.springs[s]=r,s0(r,t))})}function YH(t,e){const r=new Ewe;return r.key=t,e&&s0(r,e),r}function JH(t,e,r){e.keys&&Yr(e.keys,s=>{(t[s]||(t[s]=r(s)))._prepareNode(e)})}function eZ(t,e){Yr(e,r=>{JH(t.springs,r,s=>YH(s,t))})}var tA=({children:t,...e})=>{const r=Y.useContext(eI),s=e.pause||!!r.pause,c=e.immediate||!!r.immediate;e=rwe(()=>({pause:s,immediate:c}),[s,c]);const{Provider:d}=eI;return Y.createElement(d,{value:e},t)},eI=Rwe(tA,{});tA.Provider=eI.Provider;tA.Consumer=eI.Consumer;function Rwe(t,e){return Object.assign(t,Y.createContext(e)),t.Provider._context=t,t.Consumer._context=t,t}var Mwe=()=>{const t=[],e=function(s){twe();const c=[];return Yr(t,(d,_)=>{if(xn.und(s))c.push(d.start());else{const x=r(s,d,_);x&&c.push(d.start(x))}}),c};e.current=t,e.add=function(s){t.includes(s)||t.push(s)},e.delete=function(s){const c=t.indexOf(s);~c&&t.splice(c,1)},e.pause=function(){return Yr(t,s=>s.pause(...arguments)),this},e.resume=function(){return Yr(t,s=>s.resume(...arguments)),this},e.set=function(s){Yr(t,(c,d)=>{const _=xn.fun(s)?s(d,c):s;_&&c.set(_)})},e.start=function(s){const c=[];return Yr(t,(d,_)=>{if(xn.und(s))c.push(d.start());else{const x=this._getProps(s,d,_);x&&c.push(d.start(x))}}),c},e.stop=function(){return Yr(t,s=>s.stop(...arguments)),this},e.update=function(s){return Yr(t,(c,d)=>c.update(this._getProps(s,c,d))),this};const r=function(s,c,d){return xn.fun(s)?s(d,c):s};return e._getProps=r,e};function kwe(t,e,r){const s=xn.fun(e)&&e;s&&!r&&(r=[]);const c=Y.useMemo(()=>s||arguments.length==3?Mwe():void 0,[]),d=Y.useRef(0),_=FH(),x=Y.useMemo(()=>({ctrls:[],queue:[],flush(U,H){const Z=e$(U,H);return d.current>0&&!x.queue.length&&!Object.keys(Z).some(ve=>!U.springs[ve])?Jk(U,H):new Promise(ve=>{QH(U,Z),x.queue.push(()=>{ve(Jk(U,H))}),_()})}}),[]),a=Y.useRef([...x.ctrls]),I=[],M=VV(t)||0;Y.useMemo(()=>{Yr(a.current.slice(t,M),U=>{_we(U,c),U.stop(!0)}),a.current.length=t,D(M,t)},[t]),Y.useMemo(()=>{D(0,Math.min(M,t))},r);function D(U,H){for(let Z=U;Z<H;Z++){const de=a.current[Z]||(a.current[Z]=new Pwe(null,x.flush)),ve=s?s(Z,de):e[Z];ve&&(I[Z]=Swe(ve))}}const L=a.current.map((U,H)=>e$(U,I[H])),G=Y.useContext(tA),Q=VV(G),re=G!==Q&&gwe(G);j5(()=>{d.current++,x.ctrls=a.current;const{queue:U}=x;U.length&&(x.queue=[],Yr(U,H=>H())),Yr(a.current,(H,Z)=>{c==null||c.add(H),re&&H.start({default:G});const de=I[Z];de&&(ywe(H,de.ref),H.ref?H.queue.push(de):H.start(de))})}),BH(()=>()=>{Yr(x.ctrls,U=>U.stop(!0))});const ee=L.map(U=>({...U}));return c?[ee,c]:ee}function vb(t,e){const r=xn.fun(t),[[s],c]=kwe(1,r?t:[t],r?[]:e);return r||arguments.length==2?[s,c]:s}var Owe=class extends q5{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=Px(...e);const r=this._get(),s=Hk(r);U5(this,s.create(r))}advance(t){const e=this._get(),r=this.get();Ch(e,r)||(Eu(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&t$(this._active)&&zR(this)}_get(){const t=xn.arr(this.source)?this.source.map(Da):ul(Da(this.source));return this.calc(...t)}_start(){this.idle&&!t$(this._active)&&(this.idle=!1,Yr(JC(this),t=>{t.done=!1}),qc.skipAnimation?(Or.batchedUpdates(()=>this.advance()),zR(this)):XC.start(this))}_attach(){let t=1;Yr(ul(this.source),e=>{Vl(e)&&s0(e,this),Kk(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){Yr(ul(this.source),t=>{Vl(t)&&kx(t,this)}),this._active.clear(),zR(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=ul(this.source).reduce((e,r)=>Math.max(e,(Kk(r)?r.priority:0)+1),0))}};function Dwe(t){return t.idle!==!1}function t$(t){return!t.size||Array.from(t).every(Dwe)}function zR(t){t.idle||(t.idle=!0,Yr(JC(t),e=>{e.done=!0}),Mx(t,{type:"idle",parent:t}))}qc.assign({createStringInterpolator:zH,to:(t,e)=>new Owe(t,e)});var tZ=/^--/;function Lwe(t,e){return e==null||typeof e=="boolean"||e===""?"":typeof e=="number"&&e!==0&&!tZ.test(t)&&!(U1.hasOwnProperty(t)&&U1[t])?e+"px":(""+e).trim()}var n$={};function zwe(t,e){if(!t.nodeType||!t.setAttribute)return!1;const r=t.nodeName==="filter"||t.parentNode&&t.parentNode.nodeName==="filter",{style:s,children:c,scrollTop:d,scrollLeft:_,viewBox:x,...a}=e,I=Object.values(a),M=Object.keys(a).map(D=>r||t.hasAttribute(D)?D:n$[D]||(n$[D]=D.replace(/([A-Z])/g,L=>"-"+L.toLowerCase())));c!==void 0&&(t.textContent=c);for(const D in s)if(s.hasOwnProperty(D)){const L=Lwe(D,s[D]);tZ.test(D)?t.style.setProperty(D,L):t.style[D]=L}M.forEach((D,L)=>{t.setAttribute(D,I[L])}),d!==void 0&&(t.scrollTop=d),_!==void 0&&(t.scrollLeft=_),x!==void 0&&t.setAttribute("viewBox",x)}var U1={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Nwe=(t,e)=>t+e.charAt(0).toUpperCase()+e.substring(1),Fwe=["Webkit","Ms","Moz","O"];U1=Object.keys(U1).reduce((t,e)=>(Fwe.forEach(r=>t[Nwe(r,e)]=t[e]),t),U1);var Bwe=/^(matrix|translate|scale|rotate|skew)/,jwe=/^(translate)/,Uwe=/^(rotate|skew)/,NR=(t,e)=>xn.num(t)&&t!==0?t+e:t,ME=(t,e)=>xn.arr(t)?t.every(r=>ME(r,e)):xn.num(t)?t===e:parseFloat(t)===e,Vwe=class extends eA{constructor({x:t,y:e,z:r,...s}){const c=[],d=[];(t||e||r)&&(c.push([t||0,e||0,r||0]),d.push(_=>[`translate3d(${_.map(x=>NR(x,"px")).join(",")})`,ME(_,0)])),$u(s,(_,x)=>{if(x==="transform")c.push([_||""]),d.push(a=>[a,a===""]);else if(Bwe.test(x)){if(delete s[x],xn.und(_))return;const a=jwe.test(x)?"px":Uwe.test(x)?"deg":"";c.push(ul(_)),d.push(x==="rotate3d"?([I,M,D,L])=>[`rotate3d(${I},${M},${D},${NR(L,a)})`,ME(L,0)]:I=>[`${x}(${I.map(M=>NR(M,a)).join(",")})`,ME(I,x.startsWith("scale")?1:0)])}}),c.length&&(s.transform=new $we(c,d)),super(s)}},$we=class extends OH{constructor(t,e){super(),this.inputs=t,this.transforms=e,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let t="",e=!0;return Yr(this.inputs,(r,s)=>{const c=Da(r[0]),[d,_]=this.transforms[s](xn.arr(c)?c:r.map(Da));t+=" "+d,e=e&&_}),e?"none":t}observerAdded(t){t==1&&Yr(this.inputs,e=>Yr(e,r=>Vl(r)&&s0(r,this)))}observerRemoved(t){t==0&&Yr(this.inputs,e=>Yr(e,r=>Vl(r)&&kx(r,this)))}eventObserved(t){t.type=="change"&&(this._value=null),Mx(this,t)}},qwe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];qc.assign({batchedUpdates:II.unstable_batchedUpdates,createStringInterpolator:zH,colors:kbe});var Gwe=hwe(qwe,{applyAnimatedValues:zwe,createAnimatedStyle:t=>new Vwe(t),getComponentProps:({scrollTop:t,scrollLeft:e,...r})=>r}),nZ=Gwe.animated;function e4(t,e){return t.map(function(r,s){return r+e[s]})}function G5(t,e){return t.map(function(r,s){return r-e[s]})}function t4(t){return Math.hypot.apply(Math,t)}function Wwe(t,e,r){var s=t4(e),c=s===0?0:1/s,d=r===0?0:1/r,_=d*s,x=e.map(function(M){return d*M}),a=e.map(function(M){return c*M}),I=t4(t);return{velocities:x,velocity:_,distance:I,direction:a}}function n4(t){return Math.sign?Math.sign(t):+(t>0)-+(t<0)||+t}function Hwe(t,e,r){return Math.max(e,Math.min(t,r))}function Zwe(t,e){return Math.pow(t,e*5)}function r$(t,e,r){return e===0||Math.abs(e)===1/0?Zwe(t,r):t*e*r/(e+r*t)}function i$(t,e,r,s){return s===void 0&&(s=.15),s===0?Hwe(t,e,r):t<e?-r$(e-t,r-e,s)+e:t>r?+r$(t-r,r-e,s)+r:t}function Xwe(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function Kwe(t,e,r){return e&&Xwe(t.prototype,e),t}function ya(){return ya=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t},ya.apply(this,arguments)}function rZ(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function Qwe(t,e){if(t==null)return{};var r={},s=Object.keys(t),c,d;for(d=0;d<s.length;d++)c=s[d],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}function Sh(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ywe(t,e){if(t){if(typeof t=="string")return s$(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s$(t,e)}}function s$(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,s=new Array(e);r<e;r++)s[r]=t[r];return s}function nA(t,e){var r;if(typeof Symbol>"u"||t[Symbol.iterator]==null){if(Array.isArray(t)||(r=Ywe(t))||e){r&&(t=r);var s=0;return function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return r=t[Symbol.iterator](),r.next.bind(r)}function iZ(){}function sZ(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length===0?iZ:e.length===1?e[0]:function(){for(var s,c=nA(e),d;!(d=c()).done;){var _=d.value;s=_.apply(this,arguments)||s}return s}}function uf(t,e){if(t===void 0){if(e===void 0)throw new Error("Must define fallback value if undefined is expected");t=e}return Array.isArray(t)?t:[t,t]}function o$(t){if(typeof t=="function"){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];return t.apply(void 0,r)}else return t}function W5(t,e){t===void 0&&(t={});for(var r={},s=0,c=Object.entries(e);s<c.length;s++){var d=c[s],_=d[0],x=d[1];switch(typeof x){case"function":r[_]=x.call(r,t[_],_,t);break;case"object":r[_]=W5(t[_],x);break;case"boolean":x&&(r[_]=t[_]);break}}return r}function Jwe(){try{return"constructor"in GestureEvent}catch{return!1}}function oZ(){return typeof window<"u"&&"ontouchstart"in window}function eTe(){return typeof window<"u"&&"onpointerdown"in window}function aZ(t){return"pointerId"in t?null:t.type==="touchend"?t.changedTouches:t.targetTouches}function lZ(t){return Array.from(aZ(t)).map(function(e){return e.identifier})}function a$(t){var e="buttons"in t?t.buttons:0,r=t.shiftKey,s=t.altKey,c=t.metaKey,d=t.ctrlKey;return{buttons:e,shiftKey:r,altKey:s,metaKey:c,ctrlKey:d}}var tTe=function(e){return e};function l$(t,e){e===void 0&&(e=tTe);var r=aZ(t),s=r?r[0]:t,c=s.clientX,d=s.clientY;return e([c,d])}var nTe=180,rTe=.15,iTe=.5,sTe=50,oTe=250,aTe={threshold:function(e){return e===void 0&&(e=0),uf(e)},rubberband:function(e){switch(e===void 0&&(e=0),e){case!0:return uf(rTe);case!1:return uf(0);default:return uf(e)}},enabled:function(e){return e===void 0&&(e=!0),e},triggerAllEvents:function(e){return e===void 0&&(e=!1),e},initial:function(e){return e===void 0&&(e=0),typeof e=="function"?e:uf(e)},transform:!0},cZ=ya({},aTe,{axis:!0,lockDirection:function(e){return e===void 0&&(e=!1),e},bounds:function(e){if(e===void 0&&(e={}),typeof e=="function")return function(D){return cZ.bounds(e(D))};var r=e,s=r.left,c=s===void 0?-1/0:s,d=r.right,_=d===void 0?1/0:d,x=r.top,a=x===void 0?-1/0:x,I=r.bottom,M=I===void 0?1/0:I;return[[c,_],[a,M]]}}),lTe=typeof window<"u"&&window.document&&window.document.createElement,cTe={enabled:function(e){return e===void 0&&(e=!0),e},domTarget:!0,window:function(t){function e(r){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return t===void 0&&(t=lTe?window:void 0),t}),eventOptions:function(e){var r=e===void 0?{}:e,s=r.passive,c=s===void 0?!0:s,d=r.capture,_=d===void 0?!1:d;return{passive:c,capture:_}},transform:!0},uTe=ya({},cZ,{useTouch:function(e){e===void 0&&(e=!1);var r=oZ(),s=eTe();return!!(e&&r||r&&!s)},experimental_preventWindowScrollY:function(e){return e===void 0&&(e=!1),e},threshold:function(e,r,s){var c=s.filterTaps,d=c===void 0?!1:c,_=s.lockDirection,x=_===void 0?!1:_,a=s.axis,I=a===void 0?void 0:a,M=uf(e,d?3:x||I?1:0);return this.filterTaps=d,M},swipeVelocity:function(e){return e===void 0&&(e=iTe),uf(e)},swipeDistance:function(e){return e===void 0&&(e=sTe),uf(e)},swipeDuration:function(e){return e===void 0&&(e=oTe),e},delay:function(e){switch(e===void 0&&(e=0),e){case!0:return nTe;case!1:return 0;default:return e}}});function hTe(t){return t===void 0&&(t={}),W5(t,cTe)}function dTe(t){return t===void 0&&(t={}),W5(t,uTe)}function fTe(t){var e=t.domTarget,r=t.eventOptions,s=t.window,c=t.enabled,d=Qwe(t,["domTarget","eventOptions","window","enabled"]),_=hTe({domTarget:e,eventOptions:r,window:s,enabled:c});return _.drag=dTe(d),_}function Qv(t){return ya({_active:!1,_blocked:!1,_intentional:[!1,!1],_movement:[0,0],_initial:[0,0],_bounds:[[-1/0,1/0],[-1/0,1/0]],_threshold:[0,0],_lastEventType:void 0,_dragStarted:!1,_dragPreventScroll:!1,_dragIsTap:!0,_dragDelayed:!1,event:void 0,intentional:!1,values:[0,0],velocities:[0,0],delta:[0,0],movement:[0,0],offset:[0,0],lastOffset:[0,0],direction:[0,0],initial:[0,0],previous:[0,0],first:!1,last:!1,active:!1,timeStamp:0,startTime:0,elapsedTime:0,cancel:iZ,canceled:!1,memo:void 0,args:void 0},t)}function uZ(){var t={hovering:!1,scrolling:!1,wheeling:!1,dragging:!1,moving:!1,pinching:!1,touches:0,buttons:0,down:!1,shiftKey:!1,altKey:!1,metaKey:!1,ctrlKey:!1,locked:!1},e=Qv({_pointerId:void 0,axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0,tap:!1,swipe:[0,0]}),r=Qv({_pointerIds:[],da:[0,0],vdva:[0,0],origin:void 0,turns:0}),s=Qv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),c=Qv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0}),d=Qv({axis:void 0,xy:[0,0],vxvy:[0,0],velocity:0,distance:0});return{shared:t,drag:e,pinch:r,wheel:s,move:c,scroll:d}}var im=new Map,pTe=function(e){return e},mTe=function(){function t(r,s){var c=this;s===void 0&&(s=[]),this.controller=r,this.args=s,this.debounced=!0,this.setTimeout=function(d,_){var x;_===void 0&&(_=140),clearTimeout(c.controller.timeouts[c.stateKey]);for(var a=arguments.length,I=new Array(a>2?a-2:0),M=2;M<a;M++)I[M-2]=arguments[M];c.controller.timeouts[c.stateKey]=(x=window).setTimeout.apply(x,[d,_].concat(I))},this.clearTimeout=function(){clearTimeout(c.controller.timeouts[c.stateKey])},this.fireGestureHandler=function(d){if(d===void 0&&(d=!1),c.state._blocked)return c.debounced||(c.state._active=!1,c.clean()),null;if(!d&&!c.state.intentional&&!c.config.triggerAllEvents)return null;if(c.state.intentional){var _=c.state.active,x=c.state._active;c.state.active=x,c.state.first=x&&!_,c.state.last=_&&!x,c.controller.state.shared[c.ingKey]=x}var a=c.controller.pointerIds.size||c.controller.touchIds.size,I=c.controller.state.shared.buttons>0||a>0,M=ya({},c.controller.state.shared,c.state,c.mapStateValues(c.state),{locked:!!document.pointerLockElement,touches:a,down:I}),D=c.handler(M);return c.state.memo=D!==void 0?D:c.state.memo,M},this.controller=r,this.args=s}var e=t.prototype;return e.updateSharedState=function(s){Object.assign(this.controller.state.shared,s)},e.updateGestureState=function(s){Object.assign(this.state,s)},e.checkIntentionality=function(s,c){return{_intentional:s,_blocked:!1}},e.getMovement=function(s){var c=this.config.rubberband,d=this.state,_=d._bounds,x=d._initial,a=d._active,I=d._intentional,M=d.lastOffset,D=d.movement,L=d._threshold,G=this.getInternalMovement(s,this.state),Q=I[0]===!1?c$(G[0],L[0]):I[0],re=I[1]===!1?c$(G[1],L[1]):I[1],ee=this.checkIntentionality([Q,re],G);if(ee._blocked)return ya({},ee,{_movement:G,delta:[0,0]});var U=ee._intentional,H=G,Z=[U[0]!==!1?G[0]-U[0]:0,U[1]!==!1?G[1]-U[1]:0],de=e4(Z,M),ve=a?c:[0,0];return Z=u$(_,e4(Z,x),ve),ya({},ee,{intentional:U[0]!==!1||U[1]!==!1,_initial:x,_movement:H,movement:Z,values:s,offset:u$(_,de,ve),delta:G5(Z,D)})},e.clean=function(){this.clearTimeout()},Kwe(t,[{key:"config",get:function(){return this.controller.config[this.stateKey]}},{key:"enabled",get:function(){return this.controller.config.enabled&&this.config.enabled}},{key:"state",get:function(){return this.controller.state[this.stateKey]}},{key:"handler",get:function(){return this.controller.handlers[this.stateKey]}},{key:"transform",get:function(){return this.config.transform||this.controller.config.transform||pTe}}]),t}();function c$(t,e){return Math.abs(t)>=e?n4(t)*e:!1}function u$(t,e,r){var s=e[0],c=e[1],d=r[0],_=r[1],x=t[0],a=x[0],I=x[1],M=t[1],D=M[0],L=M[1];return[i$(s,a,I,d),i$(c,D,L,_)]}function FR(t,e,r){var s=t.state,c=e.timeStamp,d=e.type,_=s.values,x=r?0:c-s.startTime;return{_lastEventType:d,event:e,timeStamp:c,elapsedTime:x,previous:_}}function gTe(t,e,r,s){var c=t.state,d=t.config,_=t.stateKey,x=t.args,a=t.transform,I=c.offset,M=r.timeStamp,D=d.initial,L=d.bounds,G=d.threshold,Q=G5(a(G),a([0,0])).map(Math.abs),re=ya({},uZ()[_],{_active:!0,args:x,values:e,initial:e,_threshold:Q,offset:I,lastOffset:I,startTime:M});return ya({},re,{_initial:o$(D,re),_bounds:o$(L,re)})}var _Te=function(e){var r=this;this.classes=e,this.pointerIds=new Set,this.touchIds=new Set,this.supportsTouchEvents=oZ(),this.supportsGestureEvents=Jwe(),this.bind=function(){for(var s=arguments.length,c=new Array(s),d=0;d<s;d++)c[d]=arguments[d];for(var _={},x=nA(r.classes),a;!(a=x()).done;){var I=a.value;new I(r,c).addBindings(_)}var M=function(G){bu(_,G,function(Q){return r.nativeRefs[G](ya({},r.state.shared,{event:Q,args:c}))})};for(var D in r.nativeRefs)M(D);return r.config.domTarget?TTe(r,_):ETe(r,_)},this.effect=function(){return r.config.domTarget&&r.bind(),r.clean},this.clean=function(){var s=dZ(r.config),c=r.config.eventOptions;s&&xb(s,hZ(r.domListeners),c),Object.values(r.timeouts).forEach(clearTimeout),xTe(r)},this.classes=e,this.state=uZ(),this.timeouts={},this.domListeners=[],this.windowListeners={}};function yTe(t,e){"pointerId"in e?t.pointerIds.add(e.pointerId):t.touchIds=new Set(lZ(e))}function vTe(t,e){"pointerId"in e?t.pointerIds.delete(e.pointerId):lZ(e).forEach(function(r){return t.touchIds.delete(r)})}function xTe(t){var e=t.config,r=e.window,s=e.eventOptions,c=t.windowListeners;if(r){for(var d in c){var _=c[d];xb(r,_,s)}t.windowListeners={}}}function bTe(t,e,r){var s=t.config,c=t.windowListeners;r===void 0&&(r=s.eventOptions),s.window&&(xb(s.window,c[e],r),delete c[e])}function wTe(t,e,r,s){var c=t.config,d=t.windowListeners;r===void 0&&(r=[]),s===void 0&&(s=c.eventOptions),c.window&&(xb(c.window,d[e],s),fZ(c.window,d[e]=r,s))}function TTe(t,e){var r=t.config,s=t.domListeners,c=dZ(r);if(!c)throw new Error("domTarget must be defined");var d=r.eventOptions;xb(c,hZ(s),d);for(var _=0,x=Object.entries(e);_<x.length;_++){var a=x[_],I=a[0],M=a[1],D=I.slice(2).toLowerCase();s.push([D,sZ.apply(void 0,M)])}fZ(c,s,d)}function ETe(t,e){for(var r=t.config,s={},c=r.eventOptions.capture?"Capture":"",d=0,_=Object.entries(e);d<_.length;d++){var x=_[d],a=x[0],I=x[1],M=Array.isArray(I)?I:[I],D=a+c;s[D]=sZ.apply(void 0,M)}return s}function hZ(t){return t===void 0&&(t=[]),t.splice(0,t.length)}function dZ(t){var e=t.domTarget;return e&&"current"in e?e.current:e}function bu(t,e,r){t[e]||(t[e]=[]),t[e].push(r)}function fZ(t,e,r){e===void 0&&(e=[]),r===void 0&&(r={});for(var s=nA(e),c;!(c=s()).done;){var d=c.value,_=d[0],x=d[1];t.addEventListener(_,x,r)}}function xb(t,e,r){e===void 0&&(e=[]),r===void 0&&(r={});for(var s=nA(e),c;!(c=s()).done;){var d=c.value,_=d[0],x=d[1];t.removeEventListener(_,x,r)}}function STe(t,e,r){r===void 0&&(r={});var s=CTe(t),c=Gr.useMemo(function(){return new _Te(s)},[]);return c.config=e,c.handlers=t,c.nativeRefs=r,Gr.useEffect(c.effect,[]),c.config.domTarget?ITe:c.bind}function ITe(){}function CTe(t){var e=new Set;return t.drag&&e.add(im.get("drag")),t.wheel&&e.add(im.get("wheel")),t.scroll&&e.add(im.get("scroll")),t.move&&e.add(im.get("move")),t.pinch&&e.add(im.get("pinch")),t.hover&&e.add(im.get("hover")),e}var ATe=function(t){rZ(e,t);function e(){return t.apply(this,arguments)||this}var r=e.prototype;return r.getInternalMovement=function(c,d){return G5(c,d.initial)},r.checkIntentionality=function(c,d){if(c[0]===!1&&c[1]===!1)return{_intentional:c,axis:this.state.axis};var _=d.map(Math.abs),x=_[0],a=_[1],I=this.state.axis||(x>a?"x":x<a?"y":void 0);return!this.config.axis&&!this.config.lockDirection?{_intentional:c,_blocked:!1,axis:I}:I?this.config.axis&&I!==this.config.axis?{_intentional:c,_blocked:!0,axis:I}:(c[I==="x"?1:0]=!1,{_intentional:c,_blocked:!1,axis:I}):{_intentional:[!1,!1],_blocked:!1,axis:I}},r.getKinematics=function(c,d){var _=this.getMovement(c);if(!_._blocked){var x=d.timeStamp-this.state.timeStamp;Object.assign(_,Wwe(_.movement,_.delta,x))}return _},r.mapStateValues=function(c){return{xy:c.values,vxvy:c.velocities}},e}(mTe),PTe=3;function h$(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}var RTe=function(t){rZ(e,t);function e(){var s;return s=t.apply(this,arguments)||this,s.ingKey="dragging",s.stateKey="drag",s.setPointerCapture=function(c){if(!(s.config.useTouch||document.pointerLockElement)){var d=c.target,_=c.pointerId;d&&"setPointerCapture"in d&&d.setPointerCapture(_),s.updateGestureState({_dragTarget:d,_dragPointerId:_})}},s.releasePointerCapture=function(){if(!(s.config.useTouch||document.pointerLockElement)){var c=s.state,d=c._dragTarget,_=c._dragPointerId;if(_&&d&&"releasePointerCapture"in d&&(!("hasPointerCapture"in d)||d.hasPointerCapture(_)))try{d.releasePointerCapture(_)}catch{}}},s.preventScroll=function(c){s.state._dragPreventScroll&&c.cancelable&&c.preventDefault()},s.getEventId=function(c){return s.config.useTouch?c.changedTouches[0].identifier:c.pointerId},s.isValidEvent=function(c){return s.state._pointerId===s.getEventId(c)},s.shouldPreventWindowScrollY=s.config.experimental_preventWindowScrollY&&s.controller.supportsTouchEvents,s.setUpWindowScrollDetection=function(c){h$(c),wTe(s.controller,s.stateKey,[["touchmove",s.preventScroll],["touchend",s.clean.bind(Sh(s))],["touchcancel",s.clean.bind(Sh(s))]],{passive:!1}),s.setTimeout(s.startDrag.bind(Sh(s)),250,c)},s.setUpDelayedDragTrigger=function(c){s.state._dragDelayed=!0,h$(c),s.setTimeout(s.startDrag.bind(Sh(s)),s.config.delay,c)},s.setStartState=function(c){var d=l$(c,s.transform);s.updateSharedState(a$(c)),s.updateGestureState(ya({},gTe(Sh(s),d,c),FR(Sh(s),c,!0),{_pointerId:s.getEventId(c)})),s.updateGestureState(s.getMovement(d))},s.onDragStart=function(c){yTe(s.controller,c),!(!s.enabled||s.state._active)&&(s.setStartState(c),s.setPointerCapture(c),s.shouldPreventWindowScrollY?s.setUpWindowScrollDetection(c):s.config.delay>0?s.setUpDelayedDragTrigger(c):s.startDrag(c,!0))},s.onDragChange=function(c){if(!(s.state.canceled||!s.state._active||!s.isValidEvent(c)||s.state._lastEventType===c.type&&c.timeStamp===s.state.timeStamp)){var d;if(document.pointerLockElement){var _=c.movementX,x=c.movementY;d=e4(s.transform([_,x]),s.state.values)}else d=l$(c,s.transform);var a=s.getKinematics(d,c);if(!s.state._dragStarted){if(s.state._dragDelayed){s.startDrag(c);return}if(s.shouldPreventWindowScrollY)if(!s.state._dragPreventScroll&&a.axis)if(a.axis==="x")s.startDrag(c);else{s.state._active=!1;return}else return;else return}var I=a$(c);s.updateSharedState(I);var M=FR(Sh(s),c),D=t4(a._movement),L=s.state._dragIsTap;L&&D>=PTe&&(L=!1),s.updateGestureState(ya({},M,a,{_dragIsTap:L})),s.fireGestureHandler()}},s.onDragEnd=function(c){if(vTe(s.controller,c),!!s.isValidEvent(c)&&(s.clean(),!!s.state._active)){s.state._active=!1;var d=s.state._dragIsTap,_=s.state.velocities,x=_[0],a=_[1],I=s.state.movement,M=I[0],D=I[1],L=s.state._intentional,G=L[0],Q=L[1],re=s.config.swipeVelocity,ee=re[0],U=re[1],H=s.config.swipeDistance,Z=H[0],de=H[1],ve=s.config.swipeDuration,Ee=ya({},FR(Sh(s),c),s.getMovement(s.state.values)),ie=[0,0];Ee.elapsedTime<ve&&(G!==!1&&Math.abs(x)>ee&&Math.abs(M)>Z&&(ie[0]=n4(x)),Q!==!1&&Math.abs(a)>U&&Math.abs(D)>de&&(ie[1]=n4(a))),s.updateSharedState({buttons:0}),s.updateGestureState(ya({},Ee,{tap:d,swipe:ie})),s.fireGestureHandler(s.config.filterTaps&&d===!0)}},s.clean=function(){t.prototype.clean.call(Sh(s)),s.state._dragStarted=!1,s.releasePointerCapture(),bTe(s.controller,s.stateKey)},s.onCancel=function(){s.state.canceled||(s.updateGestureState({canceled:!0,_active:!1}),s.updateSharedState({buttons:0}),setTimeout(function(){return s.fireGestureHandler()},0))},s.onClick=function(c){s.state._dragIsTap||c.stopPropagation()},s}var r=e.prototype;return r.startDrag=function(c,d){d===void 0&&(d=!1),!(!this.state._active||this.state._dragStarted)&&(d||this.setStartState(c),this.updateGestureState({_dragStarted:!0,_dragPreventScroll:!0,cancel:this.onCancel}),this.clearTimeout(),this.fireGestureHandler())},r.addBindings=function(c){if(this.config.useTouch?(bu(c,"onTouchStart",this.onDragStart),bu(c,"onTouchMove",this.onDragChange),bu(c,"onTouchEnd",this.onDragEnd),bu(c,"onTouchCancel",this.onDragEnd)):(bu(c,"onPointerDown",this.onDragStart),bu(c,"onPointerMove",this.onDragChange),bu(c,"onPointerUp",this.onDragEnd),bu(c,"onPointerCancel",this.onDragEnd)),this.config.filterTaps){var d=this.controller.config.eventOptions.capture?"onClick":"onClickCapture";bu(c,d,this.onClick)}},e}(ATe);function MTe(t,e){var r,s=[],c,d=!1;function _(){for(var x=arguments.length,a=new Array(x),I=0;I<x;I++)a[I]=arguments[I];return d&&r===this&&e(a,s)||(c=t.apply(this,a),d=!0,r=this,s=a),c}return _}function kE(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var r,s,c;if(Array.isArray(t)){if(r=t.length,r!==e.length)return!1;for(s=r;s--!==0;)if(!kE(t[s],e[s]))return!1;return!0}var d;if(typeof Map=="function"&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(d=t.entries();!(s=d.next()).done;)if(!e.has(s.value[0]))return!1;for(d=t.entries();!(s=d.next()).done;)if(!kE(s.value[1],e.get(s.value[0])))return!1;return!0}if(typeof Set=="function"&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(d=t.entries();!(s=d.next()).done;)if(!e.has(s.value[0]))return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(c=Object.keys(t),r=c.length,r!==Object.keys(e).length)return!1;for(s=r;s--!==0;)if(!Object.prototype.hasOwnProperty.call(e,c[s]))return!1;if(typeof Element<"u"&&t instanceof Element)return!1;for(s=r;s--!==0;)if(!(c[s]==="_owner"&&t.$$typeof)&&!kE(t[c[s]],e[c[s]]))return!1;return!0}return t!==t&&e!==e}function kTe(t,e){try{return kE(t,e)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}}function bb(t,e){e===void 0&&(e={}),im.set("drag",RTe);var r=Y.useRef();return r.current||(r.current=MTe(fTe,kTe)),STe({drag:t},r.current(e))}const pZ=Y.createContext(),wb=()=>Y.useContext(pZ),OTe=({children:t})=>{const[e,r]=Y.useState([]),[s,c]=Y.useState(null);Y.useEffect(()=>{c(Date.now())},[]),Y.useEffect(()=>{if(s){const _=vi(wn,"quests"),x=co(_,yi("createdAt",">",new Date(s))),a=jh(x,I=>{I.docChanges().forEach(M=>{if(M.type==="added"){const D=M.doc.data();d(`New quest available: ${D.title}`,"info")}})});return()=>a()}},[s]);const d=Y.useCallback((_,x)=>{const a=Date.now();r(I=>[...I,{id:a,message:_,type:x,show:!0}]),setTimeout(()=>{r(I=>I.map(M=>M.id===a?{...M,show:!1}:M))},3e3),setTimeout(()=>{r(I=>I.filter(M=>M.id!==a))},3500)},[]);return F.jsxs(pZ.Provider,{value:{notifications:e,showNotification:d},children:[t,F.jsx("div",{className:"notification-container",children:e.map(_=>F.jsx("div",{className:`notification ${_.type} ${_.show?"show":"hide"}`,children:_.message},_.id))})]})};var mZ={exports:{}};(function(t,e){var r={};(function(s,c){t.exports=c()})(v8,function(){var s,c,d;function _(a,I){if(!s)s=I;else if(!c)c=I;else{var M="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",D={};s(D),d=I(D),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([M],{type:"text/javascript"})))}}_(["exports"],function(a){var I="3.6.0";let M;const D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(M==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{M=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):i}catch{M=i}}return M},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!D.API_URL)return null;try{const i=new URL(D.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function L(i){return D.API_URL_REGEX.test(i)}function G(i){return i.indexOf("mapbox:")===0}function Q(i){return D.API_CDN_URL_REGEX.test(i)}function re(i){return D.API_SPRITE_REGEX.test(i)}function ee(i){return D.API_STYLE_REGEX.test(i)&&!re(i)}const U={create:"create",load:"load",fullLoad:"fullLoad"},H={mark(i){performance.mark(i)},measure(i,n,o){performance.measure(i,n,o)}};function Z(i){const n=i.name.split("?")[0];return Q(n)&&n.includes("mapbox-gl.js")?"javascript":Q(n)&&n.includes("mapbox-gl.css")?"css":function(o){return D.API_FONTS_REGEX.test(o)}(n)?"fontRange":re(n)?"sprite":ee(n)?"style":function(o){return D.API_TILEJSON_REGEX.test(o)}(n)?"tilejson":"other"}function de(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ve={},Ee={};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.setMatrixArrayType=function(i){Ee.ARRAY_TYPE=ue=i},Ee.toRadian=function(i){return i*ge},Ee.equals=function(i,n){return Math.abs(i-n)<=ie*Math.max(1,Math.abs(i),Math.abs(n))},Ee.RANDOM=Ee.ARRAY_TYPE=Ee.EPSILON=void 0;var ie=1e-6;Ee.EPSILON=ie;var ue=typeof Float32Array<"u"?Float32Array:Array;Ee.ARRAY_TYPE=ue;var K=Math.random;Ee.RANDOM=K;var ge=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var i=0,n=arguments.length;n--;)i+=arguments[n]*arguments[n];return Math.sqrt(i)});var _e={};function Se(i){return Se=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Se(i)}Object.defineProperty(_e,"__esModule",{value:!0}),_e.create=function(){var i=new xe.ARRAY_TYPE(4);return xe.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},_e.clone=function(i){var n=new xe.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},_e.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},_e.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i},_e.fromValues=function(i,n,o,u){var h=new xe.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=o,h[3]=u,h},_e.set=function(i,n,o,u,h){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i},_e.transpose=function(i,n){if(i===n){var o=n[1];i[1]=n[2],i[2]=o}else i[0]=n[0],i[1]=n[2],i[2]=n[1],i[3]=n[3];return i},_e.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o*p-h*u;return m?(i[0]=p*(m=1/m),i[1]=-u*m,i[2]=-h*m,i[3]=o*m,i):null},_e.adjoint=function(i,n){var o=n[0];return i[0]=n[3],i[1]=-n[1],i[2]=-n[2],i[3]=o,i},_e.determinant=function(i){return i[0]*i[3]-i[2]*i[1]},_e.multiply=ft,_e.rotate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w+p*v,i[1]=h*w+m*v,i[2]=u*-v+p*w,i[3]=h*-v+m*w,i},_e.scale=function(i,n,o){var u=n[1],h=n[2],p=n[3],m=o[0],v=o[1];return i[0]=n[0]*m,i[1]=u*m,i[2]=h*v,i[3]=p*v,i},_e.fromRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=-o,i[3]=u,i},_e.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i},_e.str=function(i){return"mat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},_e.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},_e.LDU=function(i,n,o,u){return i[2]=u[2]/u[0],o[0]=u[0],o[1]=u[1],o[3]=u[3]-i[2]*o[1],[i,n,o]},_e.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i},_e.subtract=Tt,_e.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},_e.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=n[0],v=n[1],w=n[2],E=n[3];return Math.abs(o-m)<=xe.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(u-v)<=xe.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-w)<=xe.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-E)<=xe.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},_e.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i},_e.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i},_e.sub=_e.mul=void 0;var xe=function(i,n){if(i&&i.__esModule)return i;if(i===null||Se(i)!=="object"&&typeof i!="function")return{default:i};var o=wt(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function wt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(wt=function(u){return u?o:n})(i)}function ft(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[0],w=o[1],E=o[2],C=o[3];return i[0]=u*v+p*w,i[1]=h*v+m*w,i[2]=u*E+p*C,i[3]=h*E+m*C,i}function Tt(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i}_e.mul=ft,_e.sub=Tt;var gt={};function at(i){return at=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},at(i)}Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=function(){var i=new bt.ARRAY_TYPE(6);return bt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[4]=0,i[5]=0),i[0]=1,i[3]=1,i},gt.clone=function(i){var n=new bt.ARRAY_TYPE(6);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n},gt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i},gt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i},gt.fromValues=function(i,n,o,u,h,p){var m=new bt.ARRAY_TYPE(6);return m[0]=i,m[1]=n,m[2]=o,m[3]=u,m[4]=h,m[5]=p,m},gt.set=function(i,n,o,u,h,p,m){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i},gt.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=o*p-u*h;return w?(i[0]=p*(w=1/w),i[1]=-u*w,i[2]=-h*w,i[3]=o*w,i[4]=(h*v-p*m)*w,i[5]=(u*m-o*v)*w,i):null},gt.determinant=function(i){return i[0]*i[3]-i[1]*i[2]},gt.multiply=tt,gt.rotate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=Math.sin(o),C=Math.cos(o);return i[0]=u*C+p*E,i[1]=h*C+m*E,i[2]=u*-E+p*C,i[3]=h*-E+m*C,i[4]=v,i[5]=w,i},gt.scale=function(i,n,o){var u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=o[0],E=o[1];return i[0]=n[0]*w,i[1]=u*w,i[2]=h*E,i[3]=p*E,i[4]=m,i[5]=v,i},gt.translate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=o[0],C=o[1];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=u*E+p*C+v,i[5]=h*E+m*C+w,i},gt.fromRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=-o,i[3]=u,i[4]=0,i[5]=0,i},gt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=n[1],i[4]=0,i[5]=0,i},gt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=1,i[4]=n[0],i[5]=n[1],i},gt.str=function(i){return"mat2d("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+")"},gt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],1)},gt.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i},gt.subtract=Et,gt.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i},gt.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i[4]=n[4]+o[4]*u,i[5]=n[5]+o[5]*u,i},gt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]},gt.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=n[0],E=n[1],C=n[2],P=n[3],k=n[4],N=n[5];return Math.abs(o-w)<=bt.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(u-E)<=bt.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-C)<=bt.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-P)<=bt.EPSILON*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(m-k)<=bt.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(v-N)<=bt.EPSILON*Math.max(1,Math.abs(v),Math.abs(N))},gt.sub=gt.mul=void 0;var bt=function(i,n){if(i&&i.__esModule)return i;if(i===null||at(i)!=="object"&&typeof i!="function")return{default:i};var o=Zt(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function Zt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Zt=function(u){return u?o:n})(i)}function tt(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=o[0],C=o[1],P=o[2],k=o[3],N=o[4],j=o[5];return i[0]=u*E+p*C,i[1]=h*E+m*C,i[2]=u*P+p*k,i[3]=h*P+m*k,i[4]=u*N+p*j+v,i[5]=h*N+m*j+w,i}function Et(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i[4]=n[4]-o[4],i[5]=n[5]-o[5],i}gt.mul=tt,gt.sub=Et;var mt={};function Vt(i){return Vt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Vt(i)}Object.defineProperty(mt,"__esModule",{value:!0}),mt.create=function(){var i=new Pt.ARRAY_TYPE(9);return Pt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},mt.fromMat4=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[4],i[4]=n[5],i[5]=n[6],i[6]=n[8],i[7]=n[9],i[8]=n[10],i},mt.clone=function(i){var n=new Pt.ARRAY_TYPE(9);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n},mt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},mt.fromValues=function(i,n,o,u,h,p,m,v,w){var E=new Pt.ARRAY_TYPE(9);return E[0]=i,E[1]=n,E[2]=o,E[3]=u,E[4]=h,E[5]=p,E[6]=m,E[7]=v,E[8]=w,E},mt.set=function(i,n,o,u,h,p,m,v,w,E){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i[8]=E,i},mt.identity=function(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},mt.transpose=function(i,n){if(i===n){var o=n[1],u=n[2],h=n[5];i[1]=n[3],i[2]=n[6],i[3]=o,i[5]=n[7],i[6]=u,i[7]=h}else i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8];return i},mt.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=C*m-v*E,k=-C*p+v*w,N=E*p-m*w,j=o*P+u*k+h*N;return j?(i[0]=P*(j=1/j),i[1]=(-C*u+h*E)*j,i[2]=(v*u-h*m)*j,i[3]=k*j,i[4]=(C*o-h*w)*j,i[5]=(-v*o+h*p)*j,i[6]=N*j,i[7]=(-E*o+u*w)*j,i[8]=(m*o-u*p)*j,i):null},mt.adjoint=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8];return i[0]=m*C-v*E,i[1]=h*E-u*C,i[2]=u*v-h*m,i[3]=v*w-p*C,i[4]=o*C-h*w,i[5]=h*p-o*v,i[6]=p*E-m*w,i[7]=u*w-o*E,i[8]=o*m-u*p,i},mt.determinant=function(i){var n=i[3],o=i[4],u=i[5],h=i[6],p=i[7],m=i[8];return i[0]*(m*o-u*p)+i[1]*(-m*n+u*h)+i[2]*(p*n-o*h)},mt.multiply=dn,mt.translate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],k=o[0],N=o[1];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=w,i[6]=k*u+N*m+E,i[7]=k*h+N*v+C,i[8]=k*p+N*w+P,i},mt.rotate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],k=Math.sin(o),N=Math.cos(o);return i[0]=N*u+k*m,i[1]=N*h+k*v,i[2]=N*p+k*w,i[3]=N*m-k*u,i[4]=N*v-k*h,i[5]=N*w-k*p,i[6]=E,i[7]=C,i[8]=P,i},mt.scale=function(i,n,o){var u=o[0],h=o[1];return i[0]=u*n[0],i[1]=u*n[1],i[2]=u*n[2],i[3]=h*n[3],i[4]=h*n[4],i[5]=h*n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i},mt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=n[0],i[7]=n[1],i[8]=1,i},mt.fromRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=0,i[3]=-o,i[4]=u,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},mt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=n[1],i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},mt.fromMat2d=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=0,i[3]=n[2],i[4]=n[3],i[5]=0,i[6]=n[4],i[7]=n[5],i[8]=1,i},mt.fromQuat=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o+o,v=u+u,w=h+h,E=o*m,C=u*m,P=u*v,k=h*m,N=h*v,j=h*w,$=p*m,q=p*v,te=p*w;return i[0]=1-P-j,i[3]=C-te,i[6]=k+q,i[1]=C+te,i[4]=1-E-j,i[7]=N-$,i[2]=k-q,i[5]=N+$,i[8]=1-E-P,i},mt.normalFromMat4=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=n[9],k=n[10],N=n[11],j=n[12],$=n[13],q=n[14],te=n[15],pe=o*v-u*m,fe=o*w-h*m,me=o*E-p*m,Ae=u*w-h*v,Pe=u*E-p*v,ze=h*E-p*w,$e=C*$-P*j,Xe=C*q-k*j,rt=C*te-N*j,Qe=P*q-k*$,ut=P*te-N*$,At=k*te-N*q,ht=pe*At-fe*ut+me*Qe+Ae*rt-Pe*Xe+ze*$e;return ht?(i[0]=(v*At-w*ut+E*Qe)*(ht=1/ht),i[1]=(w*rt-m*At-E*Xe)*ht,i[2]=(m*ut-v*rt+E*$e)*ht,i[3]=(h*ut-u*At-p*Qe)*ht,i[4]=(o*At-h*rt+p*Xe)*ht,i[5]=(u*rt-o*ut-p*$e)*ht,i[6]=($*ze-q*Pe+te*Ae)*ht,i[7]=(q*me-j*ze-te*fe)*ht,i[8]=(j*Pe-$*me+te*pe)*ht,i):null},mt.projection=function(i,n,o){return i[0]=2/n,i[1]=0,i[2]=0,i[3]=0,i[4]=-2/o,i[5]=0,i[6]=-1,i[7]=1,i[8]=1,i},mt.str=function(i){return"mat3("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+")"},mt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8])},mt.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i[6]=n[6]+o[6],i[7]=n[7]+o[7],i[8]=n[8]+o[8],i},mt.subtract=yn,mt.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7]*o,i[8]=n[8]*o,i},mt.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i[4]=n[4]+o[4]*u,i[5]=n[5]+o[5]*u,i[6]=n[6]+o[6]*u,i[7]=n[7]+o[7]*u,i[8]=n[8]+o[8]*u,i},mt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]},mt.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],C=i[8],P=n[0],k=n[1],N=n[2],j=n[3],$=n[4],q=n[5],te=n[6],pe=n[7],fe=n[8];return Math.abs(o-P)<=Pt.EPSILON*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(u-k)<=Pt.EPSILON*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(h-N)<=Pt.EPSILON*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(p-j)<=Pt.EPSILON*Math.max(1,Math.abs(p),Math.abs(j))&&Math.abs(m-$)<=Pt.EPSILON*Math.max(1,Math.abs(m),Math.abs($))&&Math.abs(v-q)<=Pt.EPSILON*Math.max(1,Math.abs(v),Math.abs(q))&&Math.abs(w-te)<=Pt.EPSILON*Math.max(1,Math.abs(w),Math.abs(te))&&Math.abs(E-pe)<=Pt.EPSILON*Math.max(1,Math.abs(E),Math.abs(pe))&&Math.abs(C-fe)<=Pt.EPSILON*Math.max(1,Math.abs(C),Math.abs(fe))},mt.sub=mt.mul=void 0;var Pt=function(i,n){if(i&&i.__esModule)return i;if(i===null||Vt(i)!=="object"&&typeof i!="function")return{default:i};var o=pn(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function pn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(pn=function(u){return u?o:n})(i)}function dn(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],k=o[0],N=o[1],j=o[2],$=o[3],q=o[4],te=o[5],pe=o[6],fe=o[7],me=o[8];return i[0]=k*u+N*m+j*E,i[1]=k*h+N*v+j*C,i[2]=k*p+N*w+j*P,i[3]=$*u+q*m+te*E,i[4]=$*h+q*v+te*C,i[5]=$*p+q*w+te*P,i[6]=pe*u+fe*m+me*E,i[7]=pe*h+fe*v+me*C,i[8]=pe*p+fe*w+me*P,i}function yn(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i[4]=n[4]-o[4],i[5]=n[5]-o[5],i[6]=n[6]-o[6],i[7]=n[7]-o[7],i[8]=n[8]-o[8],i}mt.mul=dn,mt.sub=yn;var Mt={};function cn(i){return cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},cn(i)}Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=function(){var i=new Yt.ARRAY_TYPE(16);return Yt.ARRAY_TYPE!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},Mt.clone=function(i){var n=new Yt.ARRAY_TYPE(16);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],n},Mt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},Mt.fromValues=function(i,n,o,u,h,p,m,v,w,E,C,P,k,N,j,$){var q=new Yt.ARRAY_TYPE(16);return q[0]=i,q[1]=n,q[2]=o,q[3]=u,q[4]=h,q[5]=p,q[6]=m,q[7]=v,q[8]=w,q[9]=E,q[10]=C,q[11]=P,q[12]=k,q[13]=N,q[14]=j,q[15]=$,q},Mt.set=function(i,n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i[8]=E,i[9]=C,i[10]=P,i[11]=k,i[12]=N,i[13]=j,i[14]=$,i[15]=q,i},Mt.identity=xr,Mt.transpose=function(i,n){if(i===n){var o=n[1],u=n[2],h=n[3],p=n[6],m=n[7],v=n[11];i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=o,i[6]=n[9],i[7]=n[13],i[8]=u,i[9]=p,i[11]=n[14],i[12]=h,i[13]=m,i[14]=v}else i[0]=n[0],i[1]=n[4],i[2]=n[8],i[3]=n[12],i[4]=n[1],i[5]=n[5],i[6]=n[9],i[7]=n[13],i[8]=n[2],i[9]=n[6],i[10]=n[10],i[11]=n[14],i[12]=n[3],i[13]=n[7],i[14]=n[11],i[15]=n[15];return i},Mt.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=n[9],k=n[10],N=n[11],j=n[12],$=n[13],q=n[14],te=n[15],pe=o*v-u*m,fe=o*w-h*m,me=o*E-p*m,Ae=u*w-h*v,Pe=u*E-p*v,ze=h*E-p*w,$e=C*$-P*j,Xe=C*q-k*j,rt=C*te-N*j,Qe=P*q-k*$,ut=P*te-N*$,At=k*te-N*q,ht=pe*At-fe*ut+me*Qe+Ae*rt-Pe*Xe+ze*$e;return ht?(i[0]=(v*At-w*ut+E*Qe)*(ht=1/ht),i[1]=(h*ut-u*At-p*Qe)*ht,i[2]=($*ze-q*Pe+te*Ae)*ht,i[3]=(k*Pe-P*ze-N*Ae)*ht,i[4]=(w*rt-m*At-E*Xe)*ht,i[5]=(o*At-h*rt+p*Xe)*ht,i[6]=(q*me-j*ze-te*fe)*ht,i[7]=(C*ze-k*me+N*fe)*ht,i[8]=(m*ut-v*rt+E*$e)*ht,i[9]=(u*rt-o*ut-p*$e)*ht,i[10]=(j*Pe-$*me+te*pe)*ht,i[11]=(P*me-C*Pe-N*pe)*ht,i[12]=(v*Xe-m*Qe-w*$e)*ht,i[13]=(o*Qe-u*Xe+h*$e)*ht,i[14]=($*fe-j*Ae-q*pe)*ht,i[15]=(C*Ae-P*fe+k*pe)*ht,i):null},Mt.adjoint=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=n[4],v=n[5],w=n[6],E=n[7],C=n[8],P=n[9],k=n[10],N=n[11],j=n[12],$=n[13],q=n[14],te=n[15];return i[0]=v*(k*te-N*q)-P*(w*te-E*q)+$*(w*N-E*k),i[1]=-(u*(k*te-N*q)-P*(h*te-p*q)+$*(h*N-p*k)),i[2]=u*(w*te-E*q)-v*(h*te-p*q)+$*(h*E-p*w),i[3]=-(u*(w*N-E*k)-v*(h*N-p*k)+P*(h*E-p*w)),i[4]=-(m*(k*te-N*q)-C*(w*te-E*q)+j*(w*N-E*k)),i[5]=o*(k*te-N*q)-C*(h*te-p*q)+j*(h*N-p*k),i[6]=-(o*(w*te-E*q)-m*(h*te-p*q)+j*(h*E-p*w)),i[7]=o*(w*N-E*k)-m*(h*N-p*k)+C*(h*E-p*w),i[8]=m*(P*te-N*$)-C*(v*te-E*$)+j*(v*N-E*P),i[9]=-(o*(P*te-N*$)-C*(u*te-p*$)+j*(u*N-p*P)),i[10]=o*(v*te-E*$)-m*(u*te-p*$)+j*(u*E-p*v),i[11]=-(o*(v*N-E*P)-m*(u*N-p*P)+C*(u*E-p*v)),i[12]=-(m*(P*q-k*$)-C*(v*q-w*$)+j*(v*k-w*P)),i[13]=o*(P*q-k*$)-C*(u*q-h*$)+j*(u*k-h*P),i[14]=-(o*(v*q-w*$)-m*(u*q-h*$)+j*(u*w-h*v)),i[15]=o*(v*k-w*P)-m*(u*k-h*P)+C*(u*w-h*v),i},Mt.determinant=function(i){var n=i[0],o=i[1],u=i[2],h=i[3],p=i[4],m=i[5],v=i[6],w=i[7],E=i[8],C=i[9],P=i[10],k=i[11],N=i[12],j=i[13],$=i[14],q=i[15];return(n*m-o*p)*(P*q-k*$)-(n*v-u*p)*(C*q-k*j)+(n*w-h*p)*(C*$-P*j)+(o*v-u*m)*(E*q-k*N)-(o*w-h*m)*(E*$-P*N)+(u*w-h*v)*(E*j-C*N)},Mt.multiply=On,Mt.translate=function(i,n,o){var u,h,p,m,v,w,E,C,P,k,N,j,$=o[0],q=o[1],te=o[2];return n===i?(i[12]=n[0]*$+n[4]*q+n[8]*te+n[12],i[13]=n[1]*$+n[5]*q+n[9]*te+n[13],i[14]=n[2]*$+n[6]*q+n[10]*te+n[14],i[15]=n[3]*$+n[7]*q+n[11]*te+n[15]):(h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],k=n[9],N=n[10],j=n[11],i[0]=u=n[0],i[1]=h,i[2]=p,i[3]=m,i[4]=v,i[5]=w,i[6]=E,i[7]=C,i[8]=P,i[9]=k,i[10]=N,i[11]=j,i[12]=u*$+v*q+P*te+n[12],i[13]=h*$+w*q+k*te+n[13],i[14]=p*$+E*q+N*te+n[14],i[15]=m*$+C*q+j*te+n[15]),i},Mt.scale=function(i,n,o){var u=o[0],h=o[1],p=o[2];return i[0]=n[0]*u,i[1]=n[1]*u,i[2]=n[2]*u,i[3]=n[3]*u,i[4]=n[4]*h,i[5]=n[5]*h,i[6]=n[6]*h,i[7]=n[7]*h,i[8]=n[8]*p,i[9]=n[9]*p,i[10]=n[10]*p,i[11]=n[11]*p,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i},Mt.rotate=function(i,n,o,u){var h,p,m,v,w,E,C,P,k,N,j,$,q,te,pe,fe,me,Ae,Pe,ze,$e,Xe,rt,Qe,ut=u[0],At=u[1],ht=u[2],Ot=Math.hypot(ut,At,ht);return Ot<Yt.EPSILON?null:(ut*=Ot=1/Ot,At*=Ot,ht*=Ot,h=Math.sin(o),p=Math.cos(o),w=n[1],E=n[2],C=n[3],k=n[5],N=n[6],j=n[7],q=n[9],te=n[10],pe=n[11],fe=ut*ut*(m=1-p)+p,Pe=ut*At*m-ht*h,ze=At*At*m+p,$e=ht*At*m+ut*h,Xe=ut*ht*m+At*h,rt=At*ht*m-ut*h,Qe=ht*ht*m+p,i[0]=(v=n[0])*fe+(P=n[4])*(me=At*ut*m+ht*h)+($=n[8])*(Ae=ht*ut*m-At*h),i[1]=w*fe+k*me+q*Ae,i[2]=E*fe+N*me+te*Ae,i[3]=C*fe+j*me+pe*Ae,i[4]=v*Pe+P*ze+$*$e,i[5]=w*Pe+k*ze+q*$e,i[6]=E*Pe+N*ze+te*$e,i[7]=C*Pe+j*ze+pe*$e,i[8]=v*Xe+P*rt+$*Qe,i[9]=w*Xe+k*rt+q*Qe,i[10]=E*Xe+N*rt+te*Qe,i[11]=C*Xe+j*rt+pe*Qe,n!==i&&(i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i)},Mt.rotateX=function(i,n,o){var u=Math.sin(o),h=Math.cos(o),p=n[4],m=n[5],v=n[6],w=n[7],E=n[8],C=n[9],P=n[10],k=n[11];return n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[4]=p*h+E*u,i[5]=m*h+C*u,i[6]=v*h+P*u,i[7]=w*h+k*u,i[8]=E*h-p*u,i[9]=C*h-m*u,i[10]=P*h-v*u,i[11]=k*h-w*u,i},Mt.rotateY=function(i,n,o){var u=Math.sin(o),h=Math.cos(o),p=n[0],m=n[1],v=n[2],w=n[3],E=n[8],C=n[9],P=n[10],k=n[11];return n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h-E*u,i[1]=m*h-C*u,i[2]=v*h-P*u,i[3]=w*h-k*u,i[8]=p*u+E*h,i[9]=m*u+C*h,i[10]=v*u+P*h,i[11]=w*u+k*h,i},Mt.rotateZ=function(i,n,o){var u=Math.sin(o),h=Math.cos(o),p=n[0],m=n[1],v=n[2],w=n[3],E=n[4],C=n[5],P=n[6],k=n[7];return n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h+E*u,i[1]=m*h+C*u,i[2]=v*h+P*u,i[3]=w*h+k*u,i[4]=E*h-p*u,i[5]=C*h-m*u,i[6]=P*h-v*u,i[7]=k*h-w*u,i},Mt.fromTranslation=function(i,n){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=n[0],i[13]=n[1],i[14]=n[2],i[15]=1,i},Mt.fromScaling=function(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=n[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Mt.fromRotation=function(i,n,o){var u,h,p,m=o[0],v=o[1],w=o[2],E=Math.hypot(m,v,w);return E<Yt.EPSILON?null:(m*=E=1/E,v*=E,w*=E,u=Math.sin(n),h=Math.cos(n),i[0]=m*m*(p=1-h)+h,i[1]=v*m*p+w*u,i[2]=w*m*p-v*u,i[3]=0,i[4]=m*v*p-w*u,i[5]=v*v*p+h,i[6]=w*v*p+m*u,i[7]=0,i[8]=m*w*p+v*u,i[9]=v*w*p-m*u,i[10]=w*w*p+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)},Mt.fromXRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=u,i[6]=o,i[7]=0,i[8]=0,i[9]=-o,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Mt.fromYRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=0,i[2]=-o,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=o,i[9]=0,i[10]=u,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Mt.fromZRotation=function(i,n){var o=Math.sin(n),u=Math.cos(n);return i[0]=u,i[1]=o,i[2]=0,i[3]=0,i[4]=-o,i[5]=u,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Mt.fromRotationTranslation=fr,Mt.fromQuat2=function(i,n){var o=new Yt.ARRAY_TYPE(3),u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=u*u+h*h+p*p+m*m;return P>0?(o[0]=2*(v*m+C*u+w*p-E*h)/P,o[1]=2*(w*m+C*h+E*u-v*p)/P,o[2]=2*(E*m+C*p+v*h-w*u)/P):(o[0]=2*(v*m+C*u+w*p-E*h),o[1]=2*(w*m+C*h+E*u-v*p),o[2]=2*(E*m+C*p+v*h-w*u)),fr(i,n,o),i},Mt.getTranslation=function(i,n){return i[0]=n[12],i[1]=n[13],i[2]=n[14],i},Mt.getScaling=Lr,Mt.getRotation=function(i,n){var o=new Yt.ARRAY_TYPE(3);Lr(o,n);var u=1/o[0],h=1/o[1],p=1/o[2],m=n[0]*u,v=n[1]*h,w=n[2]*p,E=n[4]*u,C=n[5]*h,P=n[6]*p,k=n[8]*u,N=n[9]*h,j=n[10]*p,$=m+C+j,q=0;return $>0?(q=2*Math.sqrt($+1),i[3]=.25*q,i[0]=(P-N)/q,i[1]=(k-w)/q,i[2]=(v-E)/q):m>C&&m>j?(q=2*Math.sqrt(1+m-C-j),i[3]=(P-N)/q,i[0]=.25*q,i[1]=(v+E)/q,i[2]=(k+w)/q):C>j?(q=2*Math.sqrt(1+C-m-j),i[3]=(k-w)/q,i[0]=(v+E)/q,i[1]=.25*q,i[2]=(P+N)/q):(q=2*Math.sqrt(1+j-m-C),i[3]=(v-E)/q,i[0]=(k+w)/q,i[1]=(P+N)/q,i[2]=.25*q),i},Mt.fromRotationTranslationScale=function(i,n,o,u){var h=n[0],p=n[1],m=n[2],v=n[3],w=h+h,E=p+p,C=m+m,P=h*w,k=h*E,N=h*C,j=p*E,$=p*C,q=m*C,te=v*w,pe=v*E,fe=v*C,me=u[0],Ae=u[1],Pe=u[2];return i[0]=(1-(j+q))*me,i[1]=(k+fe)*me,i[2]=(N-pe)*me,i[3]=0,i[4]=(k-fe)*Ae,i[5]=(1-(P+q))*Ae,i[6]=($+te)*Ae,i[7]=0,i[8]=(N+pe)*Pe,i[9]=($-te)*Pe,i[10]=(1-(P+j))*Pe,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i},Mt.fromRotationTranslationScaleOrigin=function(i,n,o,u,h){var p=n[0],m=n[1],v=n[2],w=n[3],E=p+p,C=m+m,P=v+v,k=p*E,N=p*C,j=p*P,$=m*C,q=m*P,te=v*P,pe=w*E,fe=w*C,me=w*P,Ae=u[0],Pe=u[1],ze=u[2],$e=h[0],Xe=h[1],rt=h[2],Qe=(1-($+te))*Ae,ut=(N+me)*Ae,At=(j-fe)*Ae,ht=(N-me)*Pe,Ot=(1-(k+te))*Pe,ct=(q+pe)*Pe,vt=(j+fe)*ze,Nt=(q-pe)*ze,dt=(1-(k+$))*ze;return i[0]=Qe,i[1]=ut,i[2]=At,i[3]=0,i[4]=ht,i[5]=Ot,i[6]=ct,i[7]=0,i[8]=vt,i[9]=Nt,i[10]=dt,i[11]=0,i[12]=o[0]+$e-(Qe*$e+ht*Xe+vt*rt),i[13]=o[1]+Xe-(ut*$e+Ot*Xe+Nt*rt),i[14]=o[2]+rt-(At*$e+ct*Xe+dt*rt),i[15]=1,i},Mt.fromQuat=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o+o,v=u+u,w=h+h,E=o*m,C=u*m,P=u*v,k=h*m,N=h*v,j=h*w,$=p*m,q=p*v,te=p*w;return i[0]=1-P-j,i[1]=C+te,i[2]=k-q,i[3]=0,i[4]=C-te,i[5]=1-E-j,i[6]=N+$,i[7]=0,i[8]=k+q,i[9]=N-$,i[10]=1-E-P,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},Mt.frustum=function(i,n,o,u,h,p,m){var v=1/(o-n),w=1/(h-u),E=1/(p-m);return i[0]=2*p*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*p*w,i[6]=0,i[7]=0,i[8]=(o+n)*v,i[9]=(h+u)*w,i[10]=(m+p)*E,i[11]=-1,i[12]=0,i[13]=0,i[14]=m*p*2*E,i[15]=0,i},Mt.perspectiveNO=or,Mt.perspectiveZO=function(i,n,o,u,h){var p,m=1/Math.tan(n/2);return i[0]=m/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=h*(p=1/(u-h)),i[14]=h*u*p):(i[10]=-1,i[14]=-u),i},Mt.perspectiveFromFieldOfView=function(i,n,o,u){var h=Math.tan(n.upDegrees*Math.PI/180),p=Math.tan(n.downDegrees*Math.PI/180),m=Math.tan(n.leftDegrees*Math.PI/180),v=Math.tan(n.rightDegrees*Math.PI/180),w=2/(m+v),E=2/(h+p);return i[0]=w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=E,i[6]=0,i[7]=0,i[8]=-(m-v)*w*.5,i[9]=(h-p)*E*.5,i[10]=u/(o-u),i[11]=-1,i[12]=0,i[13]=0,i[14]=u*o/(o-u),i[15]=0,i},Mt.orthoNO=Yn,Mt.orthoZO=function(i,n,o,u,h,p,m){var v=1/(n-o),w=1/(u-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=E,i[11]=0,i[12]=(n+o)*v,i[13]=(h+u)*w,i[14]=p*E,i[15]=1,i},Mt.lookAt=function(i,n,o,u){var h,p,m,v,w,E,C,P,k,N,j=n[0],$=n[1],q=n[2],te=u[0],pe=u[1],fe=u[2],me=o[0],Ae=o[1],Pe=o[2];return Math.abs(j-me)<Yt.EPSILON&&Math.abs($-Ae)<Yt.EPSILON&&Math.abs(q-Pe)<Yt.EPSILON?xr(i):(C=j-me,P=$-Ae,k=q-Pe,h=pe*(k*=N=1/Math.hypot(C,P,k))-fe*(P*=N),p=fe*(C*=N)-te*k,m=te*P-pe*C,(N=Math.hypot(h,p,m))?(h*=N=1/N,p*=N,m*=N):(h=0,p=0,m=0),v=P*m-k*p,w=k*h-C*m,E=C*p-P*h,(N=Math.hypot(v,w,E))?(v*=N=1/N,w*=N,E*=N):(v=0,w=0,E=0),i[0]=h,i[1]=v,i[2]=C,i[3]=0,i[4]=p,i[5]=w,i[6]=P,i[7]=0,i[8]=m,i[9]=E,i[10]=k,i[11]=0,i[12]=-(h*j+p*$+m*q),i[13]=-(v*j+w*$+E*q),i[14]=-(C*j+P*$+k*q),i[15]=1,i)},Mt.targetTo=function(i,n,o,u){var h=n[0],p=n[1],m=n[2],v=u[0],w=u[1],E=u[2],C=h-o[0],P=p-o[1],k=m-o[2],N=C*C+P*P+k*k;N>0&&(C*=N=1/Math.sqrt(N),P*=N,k*=N);var j=w*k-E*P,$=E*C-v*k,q=v*P-w*C;return(N=j*j+$*$+q*q)>0&&(j*=N=1/Math.sqrt(N),$*=N,q*=N),i[0]=j,i[1]=$,i[2]=q,i[3]=0,i[4]=P*q-k*$,i[5]=k*j-C*q,i[6]=C*$-P*j,i[7]=0,i[8]=C,i[9]=P,i[10]=k,i[11]=0,i[12]=h,i[13]=p,i[14]=m,i[15]=1,i},Mt.str=function(i){return"mat4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+", "+i[8]+", "+i[9]+", "+i[10]+", "+i[11]+", "+i[12]+", "+i[13]+", "+i[14]+", "+i[15]+")"},Mt.frob=function(i){return Math.hypot(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])},Mt.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i[6]=n[6]+o[6],i[7]=n[7]+o[7],i[8]=n[8]+o[8],i[9]=n[9]+o[9],i[10]=n[10]+o[10],i[11]=n[11]+o[11],i[12]=n[12]+o[12],i[13]=n[13]+o[13],i[14]=n[14]+o[14],i[15]=n[15]+o[15],i},Mt.subtract=ke,Mt.multiplyScalar=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7]*o,i[8]=n[8]*o,i[9]=n[9]*o,i[10]=n[10]*o,i[11]=n[11]*o,i[12]=n[12]*o,i[13]=n[13]*o,i[14]=n[14]*o,i[15]=n[15]*o,i},Mt.multiplyScalarAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i[4]=n[4]+o[4]*u,i[5]=n[5]+o[5]*u,i[6]=n[6]+o[6]*u,i[7]=n[7]+o[7]*u,i[8]=n[8]+o[8]*u,i[9]=n[9]+o[9]*u,i[10]=n[10]+o[10]*u,i[11]=n[11]+o[11]*u,i[12]=n[12]+o[12]*u,i[13]=n[13]+o[13]*u,i[14]=n[14]+o[14]*u,i[15]=n[15]+o[15]*u,i},Mt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]&&i[8]===n[8]&&i[9]===n[9]&&i[10]===n[10]&&i[11]===n[11]&&i[12]===n[12]&&i[13]===n[13]&&i[14]===n[14]&&i[15]===n[15]},Mt.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],C=i[8],P=i[9],k=i[10],N=i[11],j=i[12],$=i[13],q=i[14],te=i[15],pe=n[0],fe=n[1],me=n[2],Ae=n[3],Pe=n[4],ze=n[5],$e=n[6],Xe=n[7],rt=n[8],Qe=n[9],ut=n[10],At=n[11],ht=n[12],Ot=n[13],ct=n[14],vt=n[15];return Math.abs(o-pe)<=Yt.EPSILON*Math.max(1,Math.abs(o),Math.abs(pe))&&Math.abs(u-fe)<=Yt.EPSILON*Math.max(1,Math.abs(u),Math.abs(fe))&&Math.abs(h-me)<=Yt.EPSILON*Math.max(1,Math.abs(h),Math.abs(me))&&Math.abs(p-Ae)<=Yt.EPSILON*Math.max(1,Math.abs(p),Math.abs(Ae))&&Math.abs(m-Pe)<=Yt.EPSILON*Math.max(1,Math.abs(m),Math.abs(Pe))&&Math.abs(v-ze)<=Yt.EPSILON*Math.max(1,Math.abs(v),Math.abs(ze))&&Math.abs(w-$e)<=Yt.EPSILON*Math.max(1,Math.abs(w),Math.abs($e))&&Math.abs(E-Xe)<=Yt.EPSILON*Math.max(1,Math.abs(E),Math.abs(Xe))&&Math.abs(C-rt)<=Yt.EPSILON*Math.max(1,Math.abs(C),Math.abs(rt))&&Math.abs(P-Qe)<=Yt.EPSILON*Math.max(1,Math.abs(P),Math.abs(Qe))&&Math.abs(k-ut)<=Yt.EPSILON*Math.max(1,Math.abs(k),Math.abs(ut))&&Math.abs(N-At)<=Yt.EPSILON*Math.max(1,Math.abs(N),Math.abs(At))&&Math.abs(j-ht)<=Yt.EPSILON*Math.max(1,Math.abs(j),Math.abs(ht))&&Math.abs($-Ot)<=Yt.EPSILON*Math.max(1,Math.abs($),Math.abs(Ot))&&Math.abs(q-ct)<=Yt.EPSILON*Math.max(1,Math.abs(q),Math.abs(ct))&&Math.abs(te-vt)<=Yt.EPSILON*Math.max(1,Math.abs(te),Math.abs(vt))},Mt.sub=Mt.mul=Mt.ortho=Mt.perspective=void 0;var Yt=function(i,n){if(i&&i.__esModule)return i;if(i===null||cn(i)!=="object"&&typeof i!="function")return{default:i};var o=Tn(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function Tn(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Tn=function(u){return u?o:n})(i)}function xr(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function On(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=n[8],k=n[9],N=n[10],j=n[11],$=n[12],q=n[13],te=n[14],pe=n[15],fe=o[0],me=o[1],Ae=o[2],Pe=o[3];return i[0]=fe*u+me*v+Ae*P+Pe*$,i[1]=fe*h+me*w+Ae*k+Pe*q,i[2]=fe*p+me*E+Ae*N+Pe*te,i[3]=fe*m+me*C+Ae*j+Pe*pe,i[4]=(fe=o[4])*u+(me=o[5])*v+(Ae=o[6])*P+(Pe=o[7])*$,i[5]=fe*h+me*w+Ae*k+Pe*q,i[6]=fe*p+me*E+Ae*N+Pe*te,i[7]=fe*m+me*C+Ae*j+Pe*pe,i[8]=(fe=o[8])*u+(me=o[9])*v+(Ae=o[10])*P+(Pe=o[11])*$,i[9]=fe*h+me*w+Ae*k+Pe*q,i[10]=fe*p+me*E+Ae*N+Pe*te,i[11]=fe*m+me*C+Ae*j+Pe*pe,i[12]=(fe=o[12])*u+(me=o[13])*v+(Ae=o[14])*P+(Pe=o[15])*$,i[13]=fe*h+me*w+Ae*k+Pe*q,i[14]=fe*p+me*E+Ae*N+Pe*te,i[15]=fe*m+me*C+Ae*j+Pe*pe,i}function fr(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=u+u,w=h+h,E=p+p,C=u*v,P=u*w,k=u*E,N=h*w,j=h*E,$=p*E,q=m*v,te=m*w,pe=m*E;return i[0]=1-(N+$),i[1]=P+pe,i[2]=k-te,i[3]=0,i[4]=P-pe,i[5]=1-(C+$),i[6]=j+q,i[7]=0,i[8]=k+te,i[9]=j-q,i[10]=1-(C+N),i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i}function Lr(i,n){var o=n[4],u=n[5],h=n[6],p=n[8],m=n[9],v=n[10];return i[0]=Math.hypot(n[0],n[1],n[2]),i[1]=Math.hypot(o,u,h),i[2]=Math.hypot(p,m,v),i}function or(i,n,o,u,h){var p,m=1/Math.tan(n/2);return i[0]=m/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+u)*(p=1/(u-h)),i[14]=2*h*u*p):(i[10]=-1,i[14]=-2*u),i}function Yn(i,n,o,u,h,p,m){var v=1/(n-o),w=1/(u-h),E=1/(p-m);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(n+o)*v,i[13]=(h+u)*w,i[14]=(m+p)*E,i[15]=1,i}function ke(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i[4]=n[4]-o[4],i[5]=n[5]-o[5],i[6]=n[6]-o[6],i[7]=n[7]-o[7],i[8]=n[8]-o[8],i[9]=n[9]-o[9],i[10]=n[10]-o[10],i[11]=n[11]-o[11],i[12]=n[12]-o[12],i[13]=n[13]-o[13],i[14]=n[14]-o[14],i[15]=n[15]-o[15],i}Mt.perspective=or,Mt.ortho=Yn,Mt.mul=On,Mt.sub=ke;var He={},lt={};function Ke(i){return Ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ke(i)}Object.defineProperty(lt,"__esModule",{value:!0}),lt.create=ln,lt.clone=function(i){var n=new st.ARRAY_TYPE(3);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n},lt.length=Ht,lt.fromValues=function(i,n,o){var u=new st.ARRAY_TYPE(3);return u[0]=i,u[1]=n,u[2]=o,u},lt.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i},lt.set=function(i,n,o,u){return i[0]=n,i[1]=o,i[2]=u,i},lt.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i},lt.subtract=vn,lt.multiply=Fn,lt.divide=pr,lt.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i},lt.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i},lt.min=function(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i[2]=Math.min(n[2],o[2]),i},lt.max=function(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i[2]=Math.max(n[2],o[2]),i},lt.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i},lt.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i},lt.scaleAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i},lt.distance=fi,lt.squaredDistance=ir,lt.squaredLength=Ci,lt.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i},lt.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i},lt.normalize=function(i,n){var o=n[0],u=n[1],h=n[2],p=o*o+u*u+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=n[0]*p,i[1]=n[1]*p,i[2]=n[2]*p,i},lt.dot=is,lt.cross=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=o[0],v=o[1],w=o[2];return i[0]=h*w-p*v,i[1]=p*m-u*w,i[2]=u*v-h*m,i},lt.lerp=function(i,n,o,u){var h=n[0],p=n[1],m=n[2];return i[0]=h+u*(o[0]-h),i[1]=p+u*(o[1]-p),i[2]=m+u*(o[2]-m),i},lt.hermite=function(i,n,o,u,h,p){var m=p*p,v=m*(2*p-3)+1,w=m*(p-2)+p,E=m*(p-1),C=m*(3-2*p);return i[0]=n[0]*v+o[0]*w+u[0]*E+h[0]*C,i[1]=n[1]*v+o[1]*w+u[1]*E+h[1]*C,i[2]=n[2]*v+o[2]*w+u[2]*E+h[2]*C,i},lt.bezier=function(i,n,o,u,h,p){var m=1-p,v=m*m,w=p*p,E=v*m,C=3*p*v,P=3*w*m,k=w*p;return i[0]=n[0]*E+o[0]*C+u[0]*P+h[0]*k,i[1]=n[1]*E+o[1]*C+u[1]*P+h[1]*k,i[2]=n[2]*E+o[2]*C+u[2]*P+h[2]*k,i},lt.random=function(i,n){n=n||1;var o=2*st.RANDOM()*Math.PI,u=2*st.RANDOM()-1,h=Math.sqrt(1-u*u)*n;return i[0]=Math.cos(o)*h,i[1]=Math.sin(o)*h,i[2]=u*n,i},lt.transformMat4=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=o[3]*u+o[7]*h+o[11]*p+o[15];return i[0]=(o[0]*u+o[4]*h+o[8]*p+o[12])/(m=m||1),i[1]=(o[1]*u+o[5]*h+o[9]*p+o[13])/m,i[2]=(o[2]*u+o[6]*h+o[10]*p+o[14])/m,i},lt.transformMat3=function(i,n,o){var u=n[0],h=n[1],p=n[2];return i[0]=u*o[0]+h*o[3]+p*o[6],i[1]=u*o[1]+h*o[4]+p*o[7],i[2]=u*o[2]+h*o[5]+p*o[8],i},lt.transformQuat=function(i,n,o){var u=o[0],h=o[1],p=o[2],m=n[0],v=n[1],w=n[2],E=h*w-p*v,C=p*m-u*w,P=u*v-h*m,k=h*P-p*C,N=p*E-u*P,j=u*C-h*E,$=2*o[3];return C*=$,P*=$,N*=2,j*=2,i[0]=m+(E*=$)+(k*=2),i[1]=v+C+N,i[2]=w+P+j,i},lt.rotateX=function(i,n,o,u){var h=[],p=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],p[0]=h[0],p[1]=h[1]*Math.cos(u)-h[2]*Math.sin(u),p[2]=h[1]*Math.sin(u)+h[2]*Math.cos(u),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},lt.rotateY=function(i,n,o,u){var h=[],p=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],p[0]=h[2]*Math.sin(u)+h[0]*Math.cos(u),p[1]=h[1],p[2]=h[2]*Math.cos(u)-h[0]*Math.sin(u),i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},lt.rotateZ=function(i,n,o,u){var h=[],p=[];return h[0]=n[0]-o[0],h[1]=n[1]-o[1],h[2]=n[2]-o[2],p[0]=h[0]*Math.cos(u)-h[1]*Math.sin(u),p[1]=h[0]*Math.sin(u)+h[1]*Math.cos(u),p[2]=h[2],i[0]=p[0]+o[0],i[1]=p[1]+o[1],i[2]=p[2]+o[2],i},lt.angle=function(i,n){var o=i[0],u=i[1],h=i[2],p=n[0],m=n[1],v=n[2],w=Math.sqrt(o*o+u*u+h*h)*Math.sqrt(p*p+m*m+v*v),E=w&&is(i,n)/w;return Math.acos(Math.min(Math.max(E,-1),1))},lt.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i},lt.str=function(i){return"vec3("+i[0]+", "+i[1]+", "+i[2]+")"},lt.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]},lt.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=n[0],m=n[1],v=n[2];return Math.abs(o-p)<=st.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(u-m)<=st.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(h-v)<=st.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))},lt.forEach=lt.sqrLen=lt.len=lt.sqrDist=lt.dist=lt.div=lt.mul=lt.sub=void 0;var st=function(i,n){if(i&&i.__esModule)return i;if(i===null||Ke(i)!=="object"&&typeof i!="function")return{default:i};var o=zt(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function zt(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(zt=function(u){return u?o:n})(i)}function ln(){var i=new st.ARRAY_TYPE(3);return st.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Ht(i){return Math.hypot(i[0],i[1],i[2])}function vn(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i}function Fn(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i[2]=n[2]*o[2],i}function pr(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i[2]=n[2]/o[2],i}function fi(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2])}function ir(i,n){var o=n[0]-i[0],u=n[1]-i[1],h=n[2]-i[2];return o*o+u*u+h*h}function Ci(i){var n=i[0],o=i[1],u=i[2];return n*n+o*o+u*u}function is(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]}lt.sub=vn,lt.mul=Fn,lt.div=pr,lt.dist=fi,lt.sqrDist=ir,lt.len=Ht,lt.sqrLen=Ci;var An,ar=(An=ln(),function(i,n,o,u,h,p){var m,v;for(n||(n=3),o||(o=0),v=u?Math.min(u*n+o,i.length):i.length,m=o;m<v;m+=n)An[0]=i[m],An[1]=i[m+1],An[2]=i[m+2],h(An,An,p),i[m]=An[0],i[m+1]=An[1],i[m+2]=An[2];return i});lt.forEach=ar;var mn={};function Js(i){return Js=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Js(i)}Object.defineProperty(mn,"__esModule",{value:!0}),mn.create=wa,mn.clone=function(i){var n=new Ai.ARRAY_TYPE(4);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},mn.fromValues=function(i,n,o,u){var h=new Ai.ARRAY_TYPE(4);return h[0]=i,h[1]=n,h[2]=o,h[3]=u,h},mn.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},mn.set=function(i,n,o,u,h){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i},mn.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i},mn.subtract=rn,mn.multiply=er,mn.divide=ti,mn.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i[2]=Math.ceil(n[2]),i[3]=Math.ceil(n[3]),i},mn.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i[2]=Math.floor(n[2]),i[3]=Math.floor(n[3]),i},mn.min=function(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i[2]=Math.min(n[2],o[2]),i[3]=Math.min(n[3],o[3]),i},mn.max=function(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i[2]=Math.max(n[2],o[2]),i[3]=Math.max(n[3],o[3]),i},mn.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i[2]=Math.round(n[2]),i[3]=Math.round(n[3]),i},mn.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i},mn.scaleAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i[2]=n[2]+o[2]*u,i[3]=n[3]+o[3]*u,i},mn.distance=Mi,mn.squaredDistance=Ts,mn.length=Es,mn.squaredLength=Ls,mn.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=-n[3],i},mn.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i[2]=1/n[2],i[3]=1/n[3],i},mn.normalize=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o*o+u*u+h*h+p*p;return m>0&&(m=1/Math.sqrt(m)),i[0]=o*m,i[1]=u*m,i[2]=h*m,i[3]=p*m,i},mn.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]+i[3]*n[3]},mn.cross=function(i,n,o,u){var h=o[0]*u[1]-o[1]*u[0],p=o[0]*u[2]-o[2]*u[0],m=o[0]*u[3]-o[3]*u[0],v=o[1]*u[2]-o[2]*u[1],w=o[1]*u[3]-o[3]*u[1],E=o[2]*u[3]-o[3]*u[2],C=n[0],P=n[1],k=n[2],N=n[3];return i[0]=P*E-k*w+N*v,i[1]=-C*E+k*m-N*p,i[2]=C*w-P*m+N*h,i[3]=-C*v+P*p-k*h,i},mn.lerp=function(i,n,o,u){var h=n[0],p=n[1],m=n[2],v=n[3];return i[0]=h+u*(o[0]-h),i[1]=p+u*(o[1]-p),i[2]=m+u*(o[2]-m),i[3]=v+u*(o[3]-v),i},mn.random=function(i,n){var o,u,h,p,m,v;n=n||1;do m=(o=2*Ai.RANDOM()-1)*o+(u=2*Ai.RANDOM()-1)*u;while(m>=1);do v=(h=2*Ai.RANDOM()-1)*h+(p=2*Ai.RANDOM()-1)*p;while(v>=1);var w=Math.sqrt((1-m)/v);return i[0]=n*o,i[1]=n*u,i[2]=n*h*w,i[3]=n*p*w,i},mn.transformMat4=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3];return i[0]=o[0]*u+o[4]*h+o[8]*p+o[12]*m,i[1]=o[1]*u+o[5]*h+o[9]*p+o[13]*m,i[2]=o[2]*u+o[6]*h+o[10]*p+o[14]*m,i[3]=o[3]*u+o[7]*h+o[11]*p+o[15]*m,i},mn.transformQuat=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=o[0],v=o[1],w=o[2],E=o[3],C=E*u+v*p-w*h,P=E*h+w*u-m*p,k=E*p+m*h-v*u,N=-m*u-v*h-w*p;return i[0]=C*E+N*-m+P*-w-k*-v,i[1]=P*E+N*-v+k*-m-C*-w,i[2]=k*E+N*-w+C*-v-P*-m,i[3]=n[3],i},mn.zero=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=0,i},mn.str=function(i){return"vec4("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},mn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},mn.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=n[0],v=n[1],w=n[2],E=n[3];return Math.abs(o-m)<=Ai.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(u-v)<=Ai.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(h-w)<=Ai.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-E)<=Ai.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},mn.forEach=mn.sqrLen=mn.len=mn.sqrDist=mn.dist=mn.div=mn.mul=mn.sub=void 0;var Ai=function(i,n){if(i&&i.__esModule)return i;if(i===null||Js(i)!=="object"&&typeof i!="function")return{default:i};var o=fo(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function fo(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(fo=function(u){return u?o:n})(i)}function wa(){var i=new Ai.ARRAY_TYPE(4);return Ai.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function rn(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i[3]=n[3]-o[3],i}function er(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i[2]=n[2]*o[2],i[3]=n[3]*o[3],i}function ti(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i[2]=n[2]/o[2],i[3]=n[3]/o[3],i}function Mi(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2],n[3]-i[3])}function Ts(i,n){var o=n[0]-i[0],u=n[1]-i[1],h=n[2]-i[2],p=n[3]-i[3];return o*o+u*u+h*h+p*p}function Es(i){return Math.hypot(i[0],i[1],i[2],i[3])}function Ls(i){var n=i[0],o=i[1],u=i[2],h=i[3];return n*n+o*o+u*u+h*h}mn.sub=rn,mn.mul=er,mn.div=ti,mn.dist=Mi,mn.sqrDist=Ts,mn.len=Es,mn.sqrLen=Ls;var $s=function(){var i=wa();return function(n,o,u,h,p,m){var v,w;for(o||(o=4),u||(u=0),w=h?Math.min(h*o+u,n.length):n.length,v=u;v<w;v+=o)i[0]=n[v],i[1]=n[v+1],i[2]=n[v+2],i[3]=n[v+3],p(i,i,m),n[v]=i[0],n[v+1]=i[1],n[v+2]=i[2],n[v+3]=i[3];return n}}();function Lo(i){return Lo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Lo(i)}mn.forEach=$s,Object.defineProperty(He,"__esModule",{value:!0}),He.create=po,He.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i},He.setAxisAngle=Fi,He.getAxisAngle=function(i,n){var o=2*Math.acos(n[3]),u=Math.sin(o/2);return u>jr.EPSILON?(i[0]=n[0]/u,i[1]=n[1]/u,i[2]=n[2]/u):(i[0]=1,i[1]=0,i[2]=0),o},He.getAngle=function(i,n){var o=De(i,n);return Math.acos(2*o*o-1)},He.multiply=Xu,He.rotateX=function(i,n,o){o*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w+m*v,i[1]=h*w+p*v,i[2]=p*w-h*v,i[3]=m*w-u*v,i},He.rotateY=function(i,n,o){o*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w-p*v,i[1]=h*w+m*v,i[2]=p*w+u*v,i[3]=m*w-h*v,i},He.rotateZ=function(i,n,o){o*=.5;var u=n[0],h=n[1],p=n[2],m=n[3],v=Math.sin(o),w=Math.cos(o);return i[0]=u*w+h*v,i[1]=h*w-u*v,i[2]=p*w+m*v,i[3]=m*w-p*v,i},He.calculateW=function(i,n){var o=n[0],u=n[1],h=n[2];return i[0]=o,i[1]=u,i[2]=h,i[3]=Math.sqrt(Math.abs(1-o*o-u*u-h*h)),i},He.exp=Ue,He.ln=ne,He.pow=function(i,n,o){return ne(i,n),Le(i,i,o),Ue(i,i),i},He.slerp=le,He.random=function(i){var n=jr.RANDOM(),o=jr.RANDOM(),u=jr.RANDOM(),h=Math.sqrt(1-n),p=Math.sqrt(n);return i[0]=h*Math.sin(2*Math.PI*o),i[1]=h*Math.cos(2*Math.PI*o),i[2]=p*Math.sin(2*Math.PI*u),i[3]=p*Math.cos(2*Math.PI*u),i},He.invert=function(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=o*o+u*u+h*h+p*p,v=m?1/m:0;return i[0]=-o*v,i[1]=-u*v,i[2]=-h*v,i[3]=p*v,i},He.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i},He.fromMat3=Te,He.fromEuler=function(i,n,o,u){var h=.5*Math.PI/180;n*=h,o*=h,u*=h;var p=Math.sin(n),m=Math.cos(n),v=Math.sin(o),w=Math.cos(o),E=Math.sin(u),C=Math.cos(u);return i[0]=p*w*C-m*v*E,i[1]=m*v*C+p*w*E,i[2]=m*w*E-p*v*C,i[3]=m*w*C+p*v*E,i},He.str=function(i){return"quat("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")"},He.setAxes=He.sqlerp=He.rotationTo=He.equals=He.exactEquals=He.normalize=He.sqrLen=He.squaredLength=He.len=He.length=He.lerp=He.dot=He.scale=He.mul=He.add=He.set=He.copy=He.fromValues=He.clone=void 0;var jr=Ta(Ee),Wa=Ta(mt),ni=Ta(lt),xi=Ta(mn);function Tl(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Tl=function(u){return u?o:n})(i)}function Ta(i,n){if(i&&i.__esModule)return i;if(i===null||Lo(i)!=="object"&&typeof i!="function")return{default:i};var o=Tl(n);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}function po(){var i=new jr.ARRAY_TYPE(4);return jr.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Fi(i,n,o){o*=.5;var u=Math.sin(o);return i[0]=u*n[0],i[1]=u*n[1],i[2]=u*n[2],i[3]=Math.cos(o),i}function Xu(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[0],w=o[1],E=o[2],C=o[3];return i[0]=u*C+m*v+h*E-p*w,i[1]=h*C+m*w+p*v-u*E,i[2]=p*C+m*E+u*w-h*v,i[3]=m*C-u*v-h*w-p*E,i}function Ue(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=Math.sqrt(o*o+u*u+h*h),v=Math.exp(p),w=m>0?v*Math.sin(m)/m:0;return i[0]=o*w,i[1]=u*w,i[2]=h*w,i[3]=v*Math.cos(m),i}function ne(i,n){var o=n[0],u=n[1],h=n[2],p=n[3],m=Math.sqrt(o*o+u*u+h*h),v=m>0?Math.atan2(m,p)/m:0;return i[0]=o*v,i[1]=u*v,i[2]=h*v,i[3]=.5*Math.log(o*o+u*u+h*h+p*p),i}function le(i,n,o,u){var h,p,m,v,w,E=n[0],C=n[1],P=n[2],k=n[3],N=o[0],j=o[1],$=o[2],q=o[3];return(p=E*N+C*j+P*$+k*q)<0&&(p=-p,N=-N,j=-j,$=-$,q=-q),1-p>jr.EPSILON?(h=Math.acos(p),m=Math.sin(h),v=Math.sin((1-u)*h)/m,w=Math.sin(u*h)/m):(v=1-u,w=u),i[0]=v*E+w*N,i[1]=v*C+w*j,i[2]=v*P+w*$,i[3]=v*k+w*q,i}function Te(i,n){var o,u=n[0]+n[4]+n[8];if(u>0)o=Math.sqrt(u+1),i[3]=.5*o,i[0]=(n[5]-n[7])*(o=.5/o),i[1]=(n[6]-n[2])*o,i[2]=(n[1]-n[3])*o;else{var h=0;n[4]>n[0]&&(h=1),n[8]>n[3*h+h]&&(h=2);var p=(h+1)%3,m=(h+2)%3;o=Math.sqrt(n[3*h+h]-n[3*p+p]-n[3*m+m]+1),i[h]=.5*o,i[3]=(n[3*p+m]-n[3*m+p])*(o=.5/o),i[p]=(n[3*p+h]+n[3*h+p])*o,i[m]=(n[3*m+h]+n[3*h+m])*o}return i}He.clone=xi.clone,He.fromValues=xi.fromValues,He.copy=xi.copy,He.set=xi.set,He.add=xi.add,He.mul=Xu;var Le=xi.scale;He.scale=Le;var De=xi.dot;He.dot=De,He.lerp=xi.lerp;var Ge=xi.length;He.length=Ge,He.len=Ge;var it=xi.squaredLength;He.squaredLength=it,He.sqrLen=it;var qe=xi.normalize;He.normalize=qe,He.exactEquals=xi.exactEquals,He.equals=xi.equals;var nt,St,It,Xt=(nt=ni.create(),St=ni.fromValues(1,0,0),It=ni.fromValues(0,1,0),function(i,n,o){var u=ni.dot(n,o);return u<-.999999?(ni.cross(nt,St,n),ni.len(nt)<1e-6&&ni.cross(nt,It,n),ni.normalize(nt,nt),Fi(i,nt,Math.PI),i):u>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(ni.cross(nt,n,o),i[0]=nt[0],i[1]=nt[1],i[2]=nt[2],i[3]=1+u,qe(i,i))});He.rotationTo=Xt;var _n,Cn,lr=(_n=po(),Cn=po(),function(i,n,o,u,h,p){return le(_n,n,h,p),le(Cn,o,u,p),le(i,_n,Cn,2*p*(1-p)),i});He.sqlerp=lr;var Mn,cr=(Mn=Wa.create(),function(i,n,o,u){return Mn[0]=o[0],Mn[3]=o[1],Mn[6]=o[2],Mn[1]=u[0],Mn[4]=u[1],Mn[7]=u[2],Mn[2]=-n[0],Mn[5]=-n[1],Mn[8]=-n[2],qe(i,Te(i,Mn))});He.setAxes=cr;var un={};function Zr(i){return Zr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Zr(i)}Object.defineProperty(un,"__esModule",{value:!0}),un.create=function(){var i=new _r.ARRAY_TYPE(8);return _r.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0),i[3]=1,i},un.clone=function(i){var n=new _r.ARRAY_TYPE(8);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n},un.fromValues=function(i,n,o,u,h,p,m,v){var w=new _r.ARRAY_TYPE(8);return w[0]=i,w[1]=n,w[2]=o,w[3]=u,w[4]=h,w[5]=p,w[6]=m,w[7]=v,w},un.fromRotationTranslationValues=function(i,n,o,u,h,p,m){var v=new _r.ARRAY_TYPE(8);v[0]=i,v[1]=n,v[2]=o,v[3]=u;var w=.5*h,E=.5*p,C=.5*m;return v[4]=w*u+E*o-C*n,v[5]=E*u+C*i-w*o,v[6]=C*u+w*n-E*i,v[7]=-w*i-E*n-C*o,v},un.fromRotationTranslation=Ss,un.fromTranslation=function(i,n){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=.5*n[0],i[5]=.5*n[1],i[6]=.5*n[2],i[7]=0,i},un.fromRotation=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},un.fromMat4=function(i,n){var o=ur.create();pi.getRotation(o,n);var u=new _r.ARRAY_TYPE(3);return pi.getTranslation(u,n),Ss(i,o,u),i},un.copy=qs,un.identity=function(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i},un.set=function(i,n,o,u,h,p,m,v,w){return i[0]=n,i[1]=o,i[2]=u,i[3]=h,i[4]=p,i[5]=m,i[6]=v,i[7]=w,i},un.getDual=function(i,n){return i[0]=n[4],i[1]=n[5],i[2]=n[6],i[3]=n[7],i},un.setDual=function(i,n){return i[4]=n[0],i[5]=n[1],i[6]=n[2],i[7]=n[3],i},un.getTranslation=function(i,n){var o=n[4],u=n[5],h=n[6],p=n[7],m=-n[0],v=-n[1],w=-n[2],E=n[3];return i[0]=2*(o*E+p*m+u*w-h*v),i[1]=2*(u*E+p*v+h*m-o*w),i[2]=2*(h*E+p*w+o*v-u*m),i},un.translate=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=.5*o[0],w=.5*o[1],E=.5*o[2],C=n[4],P=n[5],k=n[6],N=n[7];return i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=m*v+h*E-p*w+C,i[5]=m*w+p*v-u*E+P,i[6]=m*E+u*w-h*v+k,i[7]=-u*v-h*w-p*E+N,i},un.rotateX=function(i,n,o){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=v*m+C*u+w*p-E*h,k=w*m+C*h+E*u-v*p,N=E*m+C*p+v*h-w*u,j=C*m-v*u-w*h-E*p;return ur.rotateX(i,n,o),i[4]=P*(m=i[3])+j*(u=i[0])+k*(p=i[2])-N*(h=i[1]),i[5]=k*m+j*h+N*u-P*p,i[6]=N*m+j*p+P*h-k*u,i[7]=j*m-P*u-k*h-N*p,i},un.rotateY=function(i,n,o){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=v*m+C*u+w*p-E*h,k=w*m+C*h+E*u-v*p,N=E*m+C*p+v*h-w*u,j=C*m-v*u-w*h-E*p;return ur.rotateY(i,n,o),i[4]=P*(m=i[3])+j*(u=i[0])+k*(p=i[2])-N*(h=i[1]),i[5]=k*m+j*h+N*u-P*p,i[6]=N*m+j*p+P*h-k*u,i[7]=j*m-P*u-k*h-N*p,i},un.rotateZ=function(i,n,o){var u=-n[0],h=-n[1],p=-n[2],m=n[3],v=n[4],w=n[5],E=n[6],C=n[7],P=v*m+C*u+w*p-E*h,k=w*m+C*h+E*u-v*p,N=E*m+C*p+v*h-w*u,j=C*m-v*u-w*h-E*p;return ur.rotateZ(i,n,o),i[4]=P*(m=i[3])+j*(u=i[0])+k*(p=i[2])-N*(h=i[1]),i[5]=k*m+j*h+N*u-P*p,i[6]=N*m+j*p+P*h-k*u,i[7]=j*m-P*u-k*h-N*p,i},un.rotateByQuatAppend=function(i,n,o){var u=o[0],h=o[1],p=o[2],m=o[3],v=n[0],w=n[1],E=n[2],C=n[3];return i[0]=v*m+C*u+w*p-E*h,i[1]=w*m+C*h+E*u-v*p,i[2]=E*m+C*p+v*h-w*u,i[3]=C*m-v*u-w*h-E*p,i[4]=(v=n[4])*m+(C=n[7])*u+(w=n[5])*p-(E=n[6])*h,i[5]=w*m+C*h+E*u-v*p,i[6]=E*m+C*p+v*h-w*u,i[7]=C*m-v*u-w*h-E*p,i},un.rotateByQuatPrepend=function(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[0],w=o[1],E=o[2],C=o[3];return i[0]=u*C+m*v+h*E-p*w,i[1]=h*C+m*w+p*v-u*E,i[2]=p*C+m*E+u*w-h*v,i[3]=m*C-u*v-h*w-p*E,i[4]=u*(C=o[7])+m*(v=o[4])+h*(E=o[6])-p*(w=o[5]),i[5]=h*C+m*w+p*v-u*E,i[6]=p*C+m*E+u*w-h*v,i[7]=m*C-u*v-h*w-p*E,i},un.rotateAroundAxis=function(i,n,o,u){if(Math.abs(u)<_r.EPSILON)return qs(i,n);var h=Math.hypot(o[0],o[1],o[2]);u*=.5;var p=Math.sin(u),m=p*o[0]/h,v=p*o[1]/h,w=p*o[2]/h,E=Math.cos(u),C=n[0],P=n[1],k=n[2],N=n[3];i[0]=C*E+N*m+P*w-k*v,i[1]=P*E+N*v+k*m-C*w,i[2]=k*E+N*w+C*v-P*m,i[3]=N*E-C*m-P*v-k*w;var j=n[4],$=n[5],q=n[6],te=n[7];return i[4]=j*E+te*m+$*w-q*v,i[5]=$*E+te*v+q*m-j*w,i[6]=q*E+te*w+j*v-$*m,i[7]=te*E-j*m-$*v-q*w,i},un.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i[3]=n[3]+o[3],i[4]=n[4]+o[4],i[5]=n[5]+o[5],i[6]=n[6]+o[6],i[7]=n[7]+o[7],i},un.multiply=tc,un.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[7]=n[7]*o,i},un.lerp=function(i,n,o,u){var h=1-u;return ad(n,o)<0&&(u=-u),i[0]=n[0]*h+o[0]*u,i[1]=n[1]*h+o[1]*u,i[2]=n[2]*h+o[2]*u,i[3]=n[3]*h+o[3]*u,i[4]=n[4]*h+o[4]*u,i[5]=n[5]*h+o[5]*u,i[6]=n[6]*h+o[6]*u,i[7]=n[7]*h+o[7]*u,i},un.invert=function(i,n){var o=Ku(n);return i[0]=-n[0]/o,i[1]=-n[1]/o,i[2]=-n[2]/o,i[3]=n[3]/o,i[4]=-n[4]/o,i[5]=-n[5]/o,i[6]=-n[6]/o,i[7]=n[7]/o,i},un.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i[4]=-n[4],i[5]=-n[5],i[6]=-n[6],i[7]=n[7],i},un.normalize=function(i,n){var o=Ku(n);if(o>0){o=Math.sqrt(o);var u=n[0]/o,h=n[1]/o,p=n[2]/o,m=n[3]/o,v=n[4],w=n[5],E=n[6],C=n[7],P=u*v+h*w+p*E+m*C;i[0]=u,i[1]=h,i[2]=p,i[3]=m,i[4]=(v-u*P)/o,i[5]=(w-h*P)/o,i[6]=(E-p*P)/o,i[7]=(C-m*P)/o}return i},un.str=function(i){return"quat2("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+", "+i[4]+", "+i[5]+", "+i[6]+", "+i[7]+")"},un.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]&&i[4]===n[4]&&i[5]===n[5]&&i[6]===n[6]&&i[7]===n[7]},un.equals=function(i,n){var o=i[0],u=i[1],h=i[2],p=i[3],m=i[4],v=i[5],w=i[6],E=i[7],C=n[0],P=n[1],k=n[2],N=n[3],j=n[4],$=n[5],q=n[6],te=n[7];return Math.abs(o-C)<=_r.EPSILON*Math.max(1,Math.abs(o),Math.abs(C))&&Math.abs(u-P)<=_r.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(h-k)<=_r.EPSILON*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(p-N)<=_r.EPSILON*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(m-j)<=_r.EPSILON*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(v-$)<=_r.EPSILON*Math.max(1,Math.abs(v),Math.abs($))&&Math.abs(w-q)<=_r.EPSILON*Math.max(1,Math.abs(w),Math.abs(q))&&Math.abs(E-te)<=_r.EPSILON*Math.max(1,Math.abs(E),Math.abs(te))},un.sqrLen=un.squaredLength=un.len=un.length=un.dot=un.mul=un.setReal=un.getReal=void 0;var _r=Gi(Ee),ur=Gi(He),pi=Gi(Mt);function mi(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(mi=function(u){return u?o:n})(i)}function Gi(i,n){if(i&&i.__esModule)return i;if(i===null||Zr(i)!=="object"&&typeof i!="function")return{default:i};var o=mi(n);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}function Ss(i,n,o){var u=.5*o[0],h=.5*o[1],p=.5*o[2],m=n[0],v=n[1],w=n[2],E=n[3];return i[0]=m,i[1]=v,i[2]=w,i[3]=E,i[4]=u*E+h*w-p*v,i[5]=h*E+p*m-u*w,i[6]=p*E+u*v-h*m,i[7]=-u*m-h*v-p*w,i}function qs(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i}function tc(i,n,o){var u=n[0],h=n[1],p=n[2],m=n[3],v=o[4],w=o[5],E=o[6],C=o[7],P=n[4],k=n[5],N=n[6],j=n[7],$=o[0],q=o[1],te=o[2],pe=o[3];return i[0]=u*pe+m*$+h*te-p*q,i[1]=h*pe+m*q+p*$-u*te,i[2]=p*pe+m*te+u*q-h*$,i[3]=m*pe-u*$-h*q-p*te,i[4]=u*C+m*v+h*E-p*w+P*pe+j*$+k*te-N*q,i[5]=h*C+m*w+p*v-u*E+k*pe+j*q+N*$-P*te,i[6]=p*C+m*E+u*w-h*v+N*pe+j*te+P*q-k*$,i[7]=m*C-u*v-h*w-p*E+j*pe-P*$-k*q-N*te,i}un.getReal=ur.copy,un.setReal=ur.copy,un.mul=tc;var ad=ur.dot;un.dot=ad;var ld=ur.length;un.length=ld,un.len=ld;var Ku=ur.squaredLength;un.squaredLength=Ku,un.sqrLen=Ku;var Dn={};function zo(i){return zo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zo(i)}Object.defineProperty(Dn,"__esModule",{value:!0}),Dn.create=cd,Dn.clone=function(i){var n=new ea.ARRAY_TYPE(2);return n[0]=i[0],n[1]=i[1],n},Dn.fromValues=function(i,n){var o=new ea.ARRAY_TYPE(2);return o[0]=i,o[1]=n,o},Dn.copy=function(i,n){return i[0]=n[0],i[1]=n[1],i},Dn.set=function(i,n,o){return i[0]=n,i[1]=o,i},Dn.add=function(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i},Dn.subtract=oi,Dn.multiply=Wc,Dn.divide=nc,Dn.ceil=function(i,n){return i[0]=Math.ceil(n[0]),i[1]=Math.ceil(n[1]),i},Dn.floor=function(i,n){return i[0]=Math.floor(n[0]),i[1]=Math.floor(n[1]),i},Dn.min=function(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i},Dn.max=function(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i},Dn.round=function(i,n){return i[0]=Math.round(n[0]),i[1]=Math.round(n[1]),i},Dn.scale=function(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i},Dn.scaleAndAdd=function(i,n,o,u){return i[0]=n[0]+o[0]*u,i[1]=n[1]+o[1]*u,i},Dn.distance=rc,Dn.squaredDistance=Jf,Dn.length=Hc,Dn.squaredLength=Qu,Dn.negate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i},Dn.inverse=function(i,n){return i[0]=1/n[0],i[1]=1/n[1],i},Dn.normalize=function(i,n){var o=n[0],u=n[1],h=o*o+u*u;return h>0&&(h=1/Math.sqrt(h)),i[0]=n[0]*h,i[1]=n[1]*h,i},Dn.dot=function(i,n){return i[0]*n[0]+i[1]*n[1]},Dn.cross=function(i,n,o){var u=n[0]*o[1]-n[1]*o[0];return i[0]=i[1]=0,i[2]=u,i},Dn.lerp=function(i,n,o,u){var h=n[0],p=n[1];return i[0]=h+u*(o[0]-h),i[1]=p+u*(o[1]-p),i},Dn.random=function(i,n){n=n||1;var o=2*ea.RANDOM()*Math.PI;return i[0]=Math.cos(o)*n,i[1]=Math.sin(o)*n,i},Dn.transformMat2=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[2]*h,i[1]=o[1]*u+o[3]*h,i},Dn.transformMat2d=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[2]*h+o[4],i[1]=o[1]*u+o[3]*h+o[5],i},Dn.transformMat3=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[3]*h+o[6],i[1]=o[1]*u+o[4]*h+o[7],i},Dn.transformMat4=function(i,n,o){var u=n[0],h=n[1];return i[0]=o[0]*u+o[4]*h+o[12],i[1]=o[1]*u+o[5]*h+o[13],i},Dn.rotate=function(i,n,o,u){var h=n[0]-o[0],p=n[1]-o[1],m=Math.sin(u),v=Math.cos(u);return i[0]=h*v-p*m+o[0],i[1]=h*m+p*v+o[1],i},Dn.angle=function(i,n){var o=i[0],u=i[1],h=n[0],p=n[1],m=Math.sqrt(o*o+u*u)*Math.sqrt(h*h+p*p);return Math.acos(Math.min(Math.max(m&&(o*h+u*p)/m,-1),1))},Dn.zero=function(i){return i[0]=0,i[1]=0,i},Dn.str=function(i){return"vec2("+i[0]+", "+i[1]+")"},Dn.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]},Dn.equals=function(i,n){var o=i[0],u=i[1],h=n[0],p=n[1];return Math.abs(o-h)<=ea.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(u-p)<=ea.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))},Dn.forEach=Dn.sqrLen=Dn.sqrDist=Dn.dist=Dn.div=Dn.mul=Dn.sub=Dn.len=void 0;var ea=function(i,n){if(i&&i.__esModule)return i;if(i===null||zo(i)!=="object"&&typeof i!="function")return{default:i};var o=Gc(void 0);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}(Ee);function Gc(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(Gc=function(u){return u?o:n})(i)}function cd(){var i=new ea.ARRAY_TYPE(2);return ea.ARRAY_TYPE!=Float32Array&&(i[0]=0,i[1]=0),i}function oi(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i}function Wc(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i}function nc(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i}function rc(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1])}function Jf(i,n){var o=n[0]-i[0],u=n[1]-i[1];return o*o+u*u}function Hc(i){return Math.hypot(i[0],i[1])}function Qu(i){var n=i[0],o=i[1];return n*n+o*o}Dn.len=Hc,Dn.sub=oi,Dn.mul=Wc,Dn.div=nc,Dn.dist=rc,Dn.sqrDist=Jf,Dn.sqrLen=Qu;var ud=function(){var i=cd();return function(n,o,u,h,p,m){var v,w;for(o||(o=2),u||(u=0),w=h?Math.min(h*o+u,n.length):n.length,v=u;v<w;v+=o)i[0]=n[v],i[1]=n[v+1],p(i,i,m),n[v]=i[0],n[v+1]=i[1];return n}}();function hd(i){return hd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},hd(i)}Dn.forEach=ud,Object.defineProperty(ve,"__esModule",{value:!0}),a.aB=ve.vec4=a.$=ve.vec3=ve.vec2=ve.quat2=a.aw=ve.quat=a.ae=ve.mat4=a.bE=ve.mat3=ve.mat2d=a.aD=ve.mat2=ve.glMatrix=void 0;var ag=So(Ee);ve.glMatrix=ag;var Zc=So(_e);a.aD=ve.mat2=Zc;var Eo=So(gt);ve.mat2d=Eo;var hr=So(mt);a.bE=ve.mat3=hr;var lg=So(Mt);a.ae=ve.mat4=lg;var cg=So(He);a.aw=ve.quat=cg;var Xc=So(un);ve.quat2=Xc;var ug=So(Dn);ve.vec2=ug;var c0=So(lt);a.$=ve.vec3=c0;var ep=So(mn);function No(i){if(typeof WeakMap!="function")return null;var n=new WeakMap,o=new WeakMap;return(No=function(u){return u?o:n})(i)}function So(i,n){if(i&&i.__esModule)return i;if(i===null||hd(i)!=="object"&&typeof i!="function")return{default:i};var o=No(n);if(o&&o.has(i))return o.get(i);var u={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in i)if(p!=="default"&&Object.prototype.hasOwnProperty.call(i,p)){var m=h?Object.getOwnPropertyDescriptor(i,p):null;m&&(m.get||m.set)?Object.defineProperty(u,p,m):u[p]=i[p]}return u.default=i,o&&o.set(i,u),u}a.aB=ve.vec4=ep;var hg=Kc;function Kc(i,n,o,u){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=o,this.p2y=u}Kc.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,n){if(n===void 0&&(n=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,u=0;u<8;u++){var h=this.sampleCurveX(o)-i;if(Math.abs(h)<n)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=h/p}var m=0,v=1;for(o=i,u=0;u<20&&(h=this.sampleCurveX(o),!(Math.abs(h-i)<n));u++)i>h?m=o:v=o,o=.5*(v-m)+m;return o},solve:function(i,n){return this.sampleCurveY(this.solveCurveX(i,n))}};var Qc=de(hg),Yc=ta;function ta(i,n){this.x=i,this.y=n}ta.prototype={clone:function(){return new ta(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,n){return this.clone()._rotateAround(i,n)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var n=i.x-this.x,o=i.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,n){return Math.atan2(this.x*n-this.y*i,this.x*i+this.y*n)},_matMult:function(i){var n=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=n,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var n=Math.cos(i),o=Math.sin(i),u=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=u,this},_rotateAround:function(i,n){var o=Math.cos(i),u=Math.sin(i),h=n.y+u*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-u*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ta.convert=function(i){return i instanceof ta?i:Array.isArray(i)?new ta(i[0],i[1]):i};var jt=de(Yc);function ic(i,n){if(Array.isArray(i)){if(!Array.isArray(n)||i.length!==n.length)return!1;for(let o=0;o<i.length;o++)if(!ic(i[o],n[o]))return!1;return!0}if(typeof i=="object"&&i!==null&&n!==null){if(typeof n!="object"||Object.keys(i).length!==Object.keys(n).length)return!1;for(const o in i)if(!ic(i[o],n[o]))return!1;return!0}return i===n}const dd=Math.PI/180,ai=180/Math.PI;function tr(i){return i*dd}function eo(i){return i*ai}const Jc=[[0,0],[1,0],[1,1],[0,1]];function Yu(i){if(i<=0)return 0;if(i>=1)return 1;const n=i*i,o=n*i;return 4*(i<.5?o:3*(i-n)+o-.75)}function Ju(i,n,o,u){const h=new Qc(i,n,o,u);return function(p){return h.solve(p)}}const mo=Ju(.25,.1,.25,1);function Hn(i,n,o){return Math.min(o,Math.max(n,i))}function na(i,n,o){return(o=Hn((o-i)/(n-i),0,1))*o*(3-2*o)}function sc(i,n,o){const u=o-n,h=((i-n)%u+u)%u+n;return h===n?o:h}function eh(i,n,o){if(!i.length)return o(null,[]);let u=i.length;const h=new Array(i.length);let p=null;i.forEach((m,v)=>{n(m,(w,E)=>{w&&(p=w),h[v]=E,--u==0&&o(p,h)})})}function oc(i){const n=[];for(const o in i)n.push(i[o]);return n}function Is(i,...n){for(const o of n)for(const u in o)i[u]=o[u];return i}let fd=1;function ac(){return fd++}function lc(){return function i(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ea(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function tp(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function th(i,n){i.forEach(o=>{n[o]&&(n[o]=n[o].bind(n))})}function Ha(i,n){return i.indexOf(n,i.length-n.length)!==-1}function eu(i,n,o){const u={};for(const h in i)u[h]=n.call(this,i[h],h,i);return u}function Cs(i,n,o){const u={};for(const h in i)n.call(this,i[h],h,i)&&(u[h]=i[h]);return u}function zs(i){return Array.isArray(i)?i.map(zs):typeof i=="object"&&i?eu(i,zs):i}const fs={};function bi(i){fs[i]||(typeof console<"u"&&console.warn(i),fs[i]=!0)}function ra(i,n,o){return(o.y-i.y)*(n.x-i.x)>(n.y-i.y)*(o.x-i.x)}function dg(i){let n=0;for(let o,u,h=0,p=i.length,m=p-1;h<p;m=h++)o=i[h],u=i[m],n+=(u.x-o.x)*(o.y+u.y);return n}function cc([i,n,o]){const u=tr(n+90),h=tr(o);return{x:i*Math.cos(u)*Math.sin(h),y:i*Math.sin(u)*Math.sin(h),z:i*Math.cos(h),azimuthal:n,polar:o}}function Fo(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function tu(i){const n={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,u,h,p)=>{const m=h||p;return n[u]=!m||m.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let pd,nu,Za,El,ss,ru,iu=null;function Xa(i){try{const n=self[i];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}function R(i,n){return[i[4*n],i[4*n+1],i[4*n+2],i[4*n+3]]}function J(i,n,o,u){for(;n<o;){const h=n+o>>1;i[h]<u?n=h+1:o=h}return n}function he(i,n,o,u){for(;n<o;){const h=n+o>>1;i[h]<=u?n=h+1:o=h}return n}function Oe(i){return i>0?1/(1.001-i):1+i}function pt(i){return i>0?1-1/(1.001-i):-i}function Dt(){return pd==null&&(pd=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),pd}const tn={now:()=>El!==void 0?El:performance.now(),setNow(i){El=i},restoreNow(){El=void 0},frame(i){const n=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(i,n=0){const{width:o,height:u}=i;ss||(ss=document.createElement("canvas"));const h=ss.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>ss.width||u>ss.height)&&(ss.width=o,ss.height=u),h.clearRect(-n,-n,o+2*n,u+2*n),h.drawImage(i,0,0,o,u),h.getImageData(-n,-n,o+2*n,u+2*n)},resolveURL:i=>(nu||(nu=document.createElement("a")),nu.href=i,nu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Za==null&&(Za=window.matchMedia("(prefers-reduced-motion: reduce)")),Za.matches)},hasCanvasFingerprintNoise(){if(ru!==void 0)return ru;if(!Dt())return ru=!1,!1;const i=new OffscreenCanvas(85,1),n=i.getContext("2d",{willReadFrequently:!0});let o=0;for(let h=0;h<i.width;++h)n.fillStyle=`rgba(${o++},${o++},${o++}, 255)`,n.fillRect(h,0,1,1);const u=n.getImageData(0,0,i.width,i.height);o=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&o++!==u.data[h])return ru=!0,!0;return ru=!1,!1}};function ii(i,n){const o=i.indexOf("?");if(o<0)return`${i}?${new URLSearchParams(n).toString()}`;const u=new URLSearchParams(i.slice(o));for(const h in n)u.set(h,n[h]);return`${i.slice(0,o)}?${u.toString()}`}function ps(i,n={persistentParams:[]}){const o=i.indexOf("?");if(o<0)return i;const u=new URLSearchParams,h=new URLSearchParams(i.slice(o));for(const m of n.persistentParams){const v=h.get(m);v&&u.set(m,v)}const p=u.toString();return`${i.slice(0,o)}${p.length>0?`?${p}`:""}`}const Ur="mapbox-tiles";let As=500,Ps=50;const uc=["language","worldview","jobid"];let os,hc;function md(){try{return caches}catch{}}function np(){const i=md();i&&!os&&(os=i.open(Ur))}let fg=1/0;const pg={supported:!1,testSupport:function(i){!mg&&gd&&(Cb?u0(i):rp=i)}};let rp,gd,mg=!1,Cb=!1;const Ab=typeof self<"u"?self:{};function u0(i){const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,gd),i.isContextLost())return;pg.supported=!0}catch{}i.deleteTexture(n),mg=!0}Ab.document&&(gd=Ab.document.createElement("img"),gd.onload=function(){rp&&u0(rp),rp=null,Cb=!0},gd.onerror=function(){mg=!0,rp=null},gd.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ip={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ip);class gg extends Error{constructor(n,o,u){o===401&&L(u)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const h0=Fo()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Sl=function(i,n){if(!(/^file:/.test(o=i.url)||/^file:/.test(h0())&&!/^\w+:/.test(o))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,h){const p=new AbortController,m=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:h0(),referrerPolicy:u.referrerPolicy,signal:p.signal});let v=!1,w=!1;const E=(C=m.url).indexOf("sku=")>0&&L(C);var C;u.type==="json"&&m.headers.set("Accept","application/json");const P=(N,j,$)=>{if(w)return;if(N&&N.message!=="SecurityError"&&bi(N.toString()),j&&$)return k(j);const q=Date.now();fetch(m).then(te=>{if(te.ok){const pe=E?te.clone():null;return k(te,pe,q)}return h(new gg(te.statusText,te.status,u.url))}).catch(te=>{te.name!=="AbortError"&&h(new Error(`${te.message} ${u.url}`))})},k=(N,j,$)=>{(u.type==="arrayBuffer"?N.arrayBuffer():u.type==="json"?N.json():N.text()).then(q=>{w||(j&&$&&function(te,pe,fe){if(np(),!os)return;const me=tu(pe.headers.get("Cache-Control")||"");if(me["no-store"])return;const Ae={status:pe.status,statusText:pe.statusText,headers:new Headers};pe.headers.forEach(($e,Xe)=>Ae.headers.set(Xe,$e)),me["max-age"]&&Ae.headers.set("Expires",new Date(fe+1e3*me["max-age"]).toUTCString());const Pe=Ae.headers.get("Expires");if(!Pe||new Date(Pe).getTime()-fe<42e4)return;let ze=ps(te.url,{persistentParams:uc});if(pe.status===206){const $e=te.headers.get("Range");if(!$e)return;Ae.status=200,ze=ii(ze,{range:$e})}(function($e,Xe){if(hc===void 0)try{new Response(new ReadableStream),hc=!0}catch{hc=!1}hc?Xe($e.body):$e.blob().then(Xe)})(pe,$e=>{const Xe=new Response((rt=pe.status)!==200&&rt!==404&&[101,103,204,205,304].includes(rt)?null:$e,Ae);var rt;np(),os&&os.then(Qe=>Qe.put(ze,Xe)).catch(Qe=>bi(Qe.message))})}(m,j,$),v=!0,h(null,q,N.headers.get("Cache-Control"),N.headers.get("Expires")))}).catch(q=>{w||h(new Error(q.message))})};return E?function(N,j){if(np(),!os)return j(null);os.then($=>{let q=ps(N.url,{persistentParams:uc});const te=N.headers.get("Range");te&&(q=ii(q,{range:te})),$.match(q).then(pe=>{const fe=function(me){if(!me)return!1;const Ae=new Date(me.headers.get("Expires")||0),Pe=tu(me.headers.get("Cache-Control")||"");return Ae>Date.now()&&!Pe["no-cache"]}(pe);$.delete(q),fe&&$.put(q,pe.clone()),j(null,pe,fe)}).catch(j)}).catch(j)}(m,P):P(null,null),{cancel:()=>{w=!0,v||p.abort()}}}(i,n);if(Fo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,n,void 0,!0)}var o;return function(u,h){const p=new XMLHttpRequest;p.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in u.headers)p.setRequestHeader(m,u.headers[m]);return u.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=u.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(u.type==="json")try{m=JSON.parse(p.response)}catch(v){return h(v)}h(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new gg(p.statusText,p.status,u.url))},p.send(u.body),{cancel:()=>p.abort()}}(i,n)},nh=function(i,n){return Sl(Is(i,{type:"arrayBuffer"}),n)};function pA(i){const n=document.createElement("a");return n.href=i,n.protocol===location.protocol&&n.host===location.host}const Pb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let sp,_d;sp=[],_d=0;const op=function(i,n){if(pg.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),_d>=D.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return sp.push(p),p}_d++;let o=!1;const u=()=>{if(!o)for(o=!0,_d--;sp.length&&_d<D.MAX_PARALLEL_IMAGE_REQUESTS;){const p=sp.shift(),{requestParameters:m,callback:v,cancelled:w}=p;w||(p.cancel=op(m,v).cancel)}},h=nh(i,(p,m,v,w)=>{u(),p?n(p):m&&(self.createImageBitmap?function(E,C){const P=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(P).then(k=>{C(null,k)}).catch(k=>{C(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,C)=>n(E,C,v,w)):function(E,C){const P=new Image;P.onload=()=>{C(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=Pb})},P.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?URL.createObjectURL(k):Pb}(m,(E,C)=>n(E,C,v,w)))});return{cancel:()=>{h.cancel(),u()}}},d0="01",f0="NO_ACCESS_TOKEN",mA=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Sa(i){const n=i.match(mA);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function rh(i){const n=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${n}`}const p0="mapbox.eventData";function Rb(i){if(!i)return null;const n=i.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(n[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ih{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const o=Rb(D.ACCESS_TOKEN);let u="";return u=o&&o.u?btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):D.ACCESS_TOKEN||"",n?`${p0}.${n}:${u}`:`${p0}:${u}`}fetchEventData(){const n=Xa("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{const h=localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));const p=localStorage.getItem(u);p&&(this.anonId=p)}catch{bi("Unable to read from LocalStorage")}}saveEventData(){const n=Xa("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid"),h=this.anonId;if(n&&h)try{localStorage.setItem(u,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{bi("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,o,u,h){if(!D.EVENTS_URL)return;const p=Sa(D.EVENTS_URL);p.params.push(`access_token=${h||D.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(n).toISOString()},v=o?Is(m,o):m,w={url:rh(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=function(E,C){return Sl(Is(E,{method:"POST"}),C)}(w,E=>{this.pendingRequest=null,u(E),this.saveEventData(),this.processRequests(h)})}queueRequest(n,o){this.queue.push(n),this.processRequests(o)}}const Mb=new class extends ih{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,n){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(i)&&i.some(o=>G(o)||L(o))&&this.queueRequest(Date.now(),n)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Rb(D.ACCESS_TOKEN),o=n?n.u:D.ACCESS_TOKEN;let u=o!==this.eventData.tokenU;tp(this.anonId)||(this.anonId=lc(),u=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),m=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;u=u||v>=1||v<-1||p.getDate()!==m.getDate()}else u=!0;u?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:d0,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=o)},i):this.processRequests()}},m0=Mb.postTurnstileEvent.bind(Mb),yd=new class extends ih{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,n,o,u){this.skuToken=n,this.errorCb=u,D.EVENTS_URL&&(o||D.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(f0)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),tp(this.anonId)||(this.anonId=lc()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:d0,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},i))}remove(){this.errorCb=null}},kb=yd.postMapLoadEvent.bind(yd),ap=new class extends ih{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(i){let n=this.mapInstanceIdMap.get(i);return n||(n=lc(),this.mapInstanceIdMap.set(i,n)),n}getEventId(i){const n=this.eventIdPerMapInstanceMap.get(i)||0;return this.eventIdPerMapInstanceMap.set(i,n+1),n}postStyleLoadEvent(i,n){const{map:o,style:u,importedStyles:h}=n;if(!D.EVENTS_URL||!i&&!D.ACCESS_TOKEN)return;const p=this.getMapInstanceId(o),m={mapInstanceId:p,eventId:this.getEventId(p),style:u};h.length&&(m.importedStyles=h),this.queueRequest({timestamp:Date.now(),payload:m},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:o}=this.queue.shift();this.postEvent(n,o,()=>{},i)}},Ob=ap.postStyleLoadEvent.bind(ap),Db=new class extends ih{constructor(){super("gljs.performance")}postPerformanceEvent(i,n){D.EVENTS_URL&&(i||D.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:o}=this.queue.shift(),u=function(h){const p=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),v=function(N){const j={};if(N){for(const $ in N)if($!=="other")for(const q of N[$]){const te=`${$}ResolveRangeMin`,pe=`${$}ResolveRangeMax`,fe=`${$}RequestCount`,me=`${$}RequestCachedCount`;j[te]=Math.min(j[te]||1/0,q.startTime),j[pe]=Math.max(j[pe]||-1/0,q.responseEnd);const Ae=Pe=>{j[Pe]===void 0&&(j[Pe]=0),++j[Pe]};q.transferSize!==void 0&&q.transferSize===0&&Ae(me),Ae(fe)}}return j}(function(N,j){const $={};if(N)for(const q of N){const te=j(q);$[te]===void 0&&($[te]=[]),$[te].push(q)}return $}(p,Z)),w=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,C=E?E.effectiveType:void 0,P={counters:[],metadata:[],attributes:[]},k=(N,j,$)=>{$!=null&&N.push({name:j,value:$.toString()})};for(const N in v)k(P.counters,N,v[N]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(k(P.counters,"interactionRangeMin",h.interactionRange[0]),k(P.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const N of Object.keys(U)){const j=U[N],$=m.find(q=>q.name===j);$&&k(P.counters,j,$.startTime)}return k(P.counters,"visibilityHidden",h.visibilityHidden),k(P.attributes,"style",function(N){if(N)for(const j of N){const $=j.name.split("?")[0];if(ee($)){const q=$.split("/").slice(-2);if(q.length===2)return`mapbox://styles/${q[0]}/${q[1]}`}}}(p)),k(P.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),k(P.attributes,"fogEnabled",h.fogEnabled?"true":"false"),k(P.attributes,"projection",h.projection),k(P.attributes,"zoom",h.zoom),k(P.metadata,"devicePixelRatio",w),k(P.metadata,"connectionEffectiveType",C),k(P.metadata,"navigatorUserAgent",navigator.userAgent),k(P.metadata,"screenWidth",window.screen.width),k(P.metadata,"screenHeight",window.screen.height),k(P.metadata,"windowWidth",window.innerWidth),k(P.metadata,"windowHeight",window.innerHeight),k(P.metadata,"mapWidth",h.width/w),k(P.metadata,"mapHeight",h.height/w),k(P.metadata,"webglRenderer",h.renderer),k(P.metadata,"webglVendor",h.vendor),k(P.metadata,"sdkVersion",I),k(P.metadata,"sdkIdentifier","mapbox-gl-js"),P}(o);for(const h of u.metadata);for(const h of u.counters);for(const h of u.attributes);this.postEvent(n,u,()=>{},i)}},gA=Db.postPerformanceEvent.bind(Db),lp=new class extends ih{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,n,o,u){if(!D.API_URL||!D.SESSION_PATH)return;const h=Sa(D.API_URL+D.SESSION_PATH);h.params.push(`sku=${n||""}`),h.params.push(`access_token=${u||D.ACCESS_TOKEN||""}`);const p={url:rh(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,v){return Sl(Is(m,{method:"GET"}),v)}(p,m=>{this.pendingRequest=null,o(m),this.saveEventData(),this.processRequests(u)})}getSessionAPI(i,n,o,u){this.skuToken=n,this.errorCb=u,D.SESSION_PATH&&D.API_URL&&(o||D.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(f0)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||this.getSession(o,this.skuToken,u=>{u?this.errorCb(u):n&&(this.success[n]=!0)},i)}remove(){this.errorCb=null}},g0=lp.getSessionAPI.bind(lp),cp=new Set;var sh={exports:{}},vd={exports:function(i,n){var o,u,h,p,m,v,w,E;for(u=i.length-(o=3&i.length),h=n,m=3432918353,v=461845907,E=0;E<u;)w=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,h=27492+(65535&(p=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,o){case 3:w^=(255&i.charCodeAt(E+2))<<16;case 2:w^=(255&i.charCodeAt(E+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(E)))*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}},_A={exports:function(i,n){for(var o,u=i.length,h=n^u,p=0;u>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:h^=(255&i.charCodeAt(p+2))<<16;case 2:h^=(255&i.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}},Lb=vd.exports,yA=_A.exports;sh.exports=Lb,sh.exports.murmur3=Lb,sh.exports.murmur2=yA;var _g=de(sh.exports);class Il{constructor(n,...o){Is(this,o[0]||{}),this.type=n}}class up extends Il{constructor(n,o={}){super("error",Is({error:n},o))}}function yg(i,n,o){o[i]&&o[i].indexOf(n)!==-1||(o[i]=o[i]||[],o[i].push(n))}function _0(i,n,o){if(o&&o[i]){const u=o[i].indexOf(n);u!==-1&&o[i].splice(u,1)}}class oh{on(n,o){return this._listeners=this._listeners||{},yg(n,o,this._listeners),this}off(n,o){return _0(n,o,this._listeners),_0(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},yg(n,o,this._oneTimeListeners),this):new Promise(u=>this.once(n,u))}fire(n,o){const u=typeof n=="string"?new Il(n,o):n,h=u.type;if(this.listens(h)){u.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of p)w.call(this,u);const m=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of m)_0(h,w,this._oneTimeListeners),w.call(this,u);const v=this._eventedParent;v&&(Is(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(u))}else u instanceof up&&console.error(u.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}a.G=void 0;var zb={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function vg(i){return(i=Math.round(i))<0?0:i>255?255:i}function y0(i){return vg(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function xg(i){return(n=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:n>1?1:n;var n}function v0(i,n,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(n-i)*o*6:2*o<1?n:3*o<2?i+(n-i)*(2/3-o)*6:i}try{a.G={}.parseCSSColor=function(i){var n,o=i.replace(/ /g,"").toLowerCase();if(o in zb)return zb[o].slice();if(o[0]==="#")return o.length===4?(n=parseInt(o.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:o.length===7&&(n=parseInt(o.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var u=o.indexOf("("),h=o.indexOf(")");if(u!==-1&&h+1===o.length){var p=o.substr(0,u),m=o.substr(u+1,h-(u+1)).split(","),v=1;switch(p){case"rgba":if(m.length!==4)return null;v=xg(m.pop());case"rgb":return m.length!==3?null:[y0(m[0]),y0(m[1]),y0(m[2]),v];case"hsla":if(m.length!==4)return null;v=xg(m.pop());case"hsl":if(m.length!==3)return null;var w=(parseFloat(m[0])%360+360)%360/360,E=xg(m[1]),C=xg(m[2]),P=C<=.5?C*(E+1):C+E-C*E,k=2*C-P;return[vg(255*v0(k,P,w+1/3)),vg(255*v0(k,P,w)),vg(255*v0(k,P,w-1/3)),v];default:return null}}return null}}catch{}class Sr{constructor(n,o,u,h=1){this.r=n,this.g=o,this.b=u,this.a=h}static parse(n){if(!n)return;if(n instanceof Sr)return n;if(typeof n!="string")return;const o=a.G(n);return o?new Sr(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[n,o,u,h]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(o)},${Math.round(u)},${h})`}toRenderColor(n){const{r:o,g:u,b:h,a:p}=this;return new vA(n,o,u,h,p)}}class vA{constructor(n,o,u,h,p){if(n){const m=n.image.height,v=m*m;o=p===0?0:o/p*(m-1),u=p===0?0:u/p*(m-1),h=p===0?0:h/p*(m-1);const w=Math.floor(o),E=Math.floor(u),C=Math.floor(h),P=Math.ceil(o),k=Math.ceil(u),N=Math.ceil(h),j=o-w,$=u-E,q=h-C,te=n.image.data,pe=4*(w+E*v+C*m),fe=4*(w+E*v+N*m),me=4*(w+k*v+C*m),Ae=4*(w+k*v+N*m),Pe=4*(P+E*v+C*m),ze=4*(P+E*v+N*m),$e=4*(P+k*v+C*m),Xe=4*(P+k*v+N*m);if(pe<0||Xe>=te.length)throw new Error("out of range");this.r=Sn(Sn(Sn(te[pe],te[fe],q),Sn(te[me],te[Ae],q),$),Sn(Sn(te[Pe],te[ze],q),Sn(te[$e],te[Xe],q),$),j)/255*p,this.g=Sn(Sn(Sn(te[pe+1],te[fe+1],q),Sn(te[me+1],te[Ae+1],q),$),Sn(Sn(te[Pe+1],te[ze+1],q),Sn(te[$e+1],te[Xe+1],q),$),j)/255*p,this.b=Sn(Sn(Sn(te[pe+2],te[fe+2],q),Sn(te[me+2],te[Ae+2],q),$),Sn(Sn(te[Pe+2],te[ze+2],q),Sn(te[$e+2],te[Xe+2],q),$),j)/255*p,this.a=p}else this.r=o,this.g=u,this.b=h,this.a=p}toArray(){const{r:n,g:o,b:u,a:h}=this;return h===0?[0,0,0,0]:[255*n/h,255*o/h,255*u/h,h]}toArray01(){const{r:n,g:o,b:u,a:h}=this;return h===0?[0,0,0,0]:[n/h,o/h,u/h,h]}toArray01Scaled(n){const{r:o,g:u,b:h,a:p}=this;return p===0?[0,0,0]:[o/p*n,u/p*n,h/p*n]}toArray01PremultipliedAlpha(){const{r:n,g:o,b:u,a:h}=this;return[n,o,u,h]}toArray01Linear(){const{r:n,g:o,b:u,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(n/h,2.2),Math.pow(o/h,2.2),Math.pow(u/h,2.2),h]}}function Sn(i,n,o){return i*(1-o)+n*o}function x0(i,n,o){return i.map((u,h)=>Sn(u,n[h],o))}Sr.black=new Sr(0,0,0,1),Sr.white=new Sr(1,1,1,1),Sr.transparent=new Sr(0,0,0,0),Sr.red=new Sr(1,0,0,1),Sr.blue=new Sr(0,0,1,1);var hp=Object.freeze({__proto__:null,array:x0,color:function(i,n,o){return new Sr(Sn(i.r,n.r,o),Sn(i.g,n.g,o),Sn(i.b,n.b,o),Sn(i.a,n.a,o))},number:Sn});function xd(i,...n){for(const o of n)for(const u in o)i[u]=o[u];return i}class Cl extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}class b0{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[u,h]of o)this.bindings[u]=h}concat(n){return new b0(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const ia={kind:"null"},en={kind:"number"},yr={kind:"string"},Cr={kind:"boolean"},Ia={kind:"color"},bd={kind:"object"},wr={kind:"value"},bg={kind:"collator"},wd={kind:"formatted"},ah={kind:"resolvedImage"};function to(i,n){return{kind:"array",itemType:i,N:n}}function ki(i){if(i.kind==="array"){const n=ki(i.itemType);return typeof i.N=="number"?`array<${n}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${n}>`}return i.kind}const w0=[ia,en,yr,Cr,Ia,wd,bd,to(wr),ah];function dp(i,n){if(n.kind==="error")return null;if(i.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!dp(i.itemType,n.itemType))&&(typeof i.N!="number"||i.N===n.N))return null}else{if(i.kind===n.kind)return null;if(i.kind==="value"){for(const o of w0)if(!dp(o,n))return null}}return`Expected ${ki(i)} but found ${ki(n)} instead.`}function Ca(i,n){return n.some(o=>o.kind===i.kind)}function fp(i,n){return n.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}class wg{constructor(n,o,u){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Tg{constructor(n,o,u,h,p){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=u,this.fontStack=h,this.textColor=p}}class go{constructor(n){this.sections=n}static fromString(n){return new go([new Tg(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof go?n:go.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){n.push(["image",o.image.namePrimary]);continue}n.push(o.text);const u={};o.fontStack&&(u["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(u["font-scale"]=o.scale),o.textColor&&(u["text-color"]=["rgba"].concat(o.textColor.toRenderColor(null).toArray())),n.push(u)}return n}}class sa{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,o){return n?new sa({namePrimary:n,nameSecondary:o,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Nb(i,n,o,u){return typeof i=="number"&&i>=0&&i<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[i,n,o,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[i,n,o,u]:[i,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Td(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Sr||i instanceof wg||i instanceof go||i instanceof sa)return!0;if(Array.isArray(i)){for(const n of i)if(!Td(n))return!1;return!0}if(typeof i=="object"){for(const n in i)if(!Td(i[n]))return!1;return!0}return!1}function as(i){if(i===null)return ia;if(typeof i=="string")return yr;if(typeof i=="boolean")return Cr;if(typeof i=="number")return en;if(i instanceof Sr)return Ia;if(i instanceof wg)return bg;if(i instanceof go)return wd;if(i instanceof sa)return ah;if(Array.isArray(i)){const n=i.length;let o;for(const u of i){const h=as(u);if(o){if(o===h)continue;o=wr;break}o=h}return to(o||wr,n)}return bd}function Ka(i){const n=typeof i;return i===null?"":n==="string"||n==="number"||n==="boolean"?String(i):i instanceof Sr||i instanceof go||i instanceof sa?i.toString():JSON.stringify(i)}class Qa{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Td(n[1]))return o.error("invalid value");const u=n[1];let h=as(u);const p=o.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Qa(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Sr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof go?this.value.serialize():this.value}}class ms{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const T0={string:yr,number:en,boolean:Cr,object:bd};class oa{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let u,h=1;const p=n[0];if(p==="array"){let v,w;if(n.length>2){const E=n[1];if(typeof E!="string"||!(E in T0)||E==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);v=T0[E],h++}else v=wr;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);w=n[2],h++}u=to(v,w)}else u=T0[p];const m=[];for(;h<n.length;h++){const v=o.parse(n[h],h,wr);if(!v)return null;m.push(v)}return new oa(u,m)}evaluate(n){for(let o=0;o<this.args.length;o++){const u=this.args[o].evaluate(n);if(!dp(this.type,as(u)))return u;if(o===this.args.length-1)throw new ms(`The expression ${JSON.stringify(this.args[o].serialize())} evaluated to ${ki(as(u))} but was expected to be of type ${ki(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);const h=n.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(u=>u.serialize()))}}class lh{constructor(n){this.type=wd,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");const h=[];let p=!1;for(let m=1;m<=n.length-1;++m){const v=n[m];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let w=null;if(v["font-scale"]&&(w=o.parse(v["font-scale"],1,en),!w))return null;let E=null;if(v["text-font"]&&(E=o.parse(v["text-font"],1,to(yr)),!E))return null;let C=null;if(v["text-color"]&&(C=o.parse(v["text-color"],1,Ia),!C))return null;const P=h[h.length-1];P.scale=w,P.font=E,P.textColor=C}else{const w=o.parse(n[m],1,wr);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new lh(h)}evaluate(n){return new go(this.sections.map(o=>{const u=o.content.evaluate(n);return as(u)===ah?new Tg("",u,null,null,null):new Tg(Ka(u),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const u={};o.scale&&(u["font-scale"]=o.scale.serialize()),o.font&&(u["text-font"]=o.font.serialize()),o.textColor&&(u["text-color"]=o.textColor.serialize()),n.push(u)}return n}}class dc{constructor(n,o){this.type=ah,this.inputPrimary=n,this.inputSecondary=o}static parse(n,o){if(n.length<2)return o.error("Expected two or more arguments.");const u=o.parse(n[1],1,yr);if(!u)return o.error("No image name provided.");if(n.length===2)return new dc(u);const h=o.parse(n[2],1,yr);return h?new dc(u,h):o.error("Secondary image variant is not a string.")}evaluate(n){const o=sa.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return o&&n.availableImages&&(o.available=n.availableImages.indexOf(o.namePrimary)>-1,o.nameSecondary&&o.available&&n.availableImages&&(o.available=n.availableImages.indexOf(o.nameSecondary)>-1)),o}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function su(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}const xA={"to-boolean":Cr,"to-color":Ia,"to-number":en,"to-string":yr};class fc{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const u=n[0],h=[];let p=ia;if(u==="to-array"){if(!Array.isArray(n[1]))return null;const m=n[1].length;if(o.expectedType){if(o.expectedType.kind!=="array")return o.error(`Expected ${o.expectedType.kind} but found array.`);p=to(o.expectedType.itemType,m)}else{if(!(m>0&&Td(n[1][0])))return null;p=to(as(n[1][0]),m)}for(let v=0;v<m;v++){const w=n[1][v];let E;if(su(w)==="array")E=o.parse(w,void 0,p.itemType);else{const C=su(w);if(C!==p.itemType.kind)return o.error(`Expected ${p.itemType.kind} but found ${C}.`);E=o.registry.literal.parse(["literal",w===void 0?null:w],o)}if(!E)return null;h.push(E)}}else{if((u==="to-boolean"||u==="to-string")&&n.length!==2)return o.error("Expected one argument.");p=xA[u];for(let m=1;m<n.length;m++){const v=o.parse(n[m],m,wr);if(!v)return null;h.push(v)}}return new fc(p,h)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,u;for(const h of this.args){if(o=h.evaluate(n),u=null,o instanceof Sr)return o;if(typeof o=="string"){const p=n.parseColor(o);if(p)return p}else if(Array.isArray(o)&&(u=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Nb(o[0],o[1],o[2],o[3]),!u))return new Sr(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ms(u||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const u of this.args){if(o=u.evaluate(n),o===null)return 0;const h=Number(o);if(!isNaN(h))return h}throw new ms(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?go.fromString(Ka(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?sa.fromString(Ka(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(o=>o.evaluate(n)):Ka(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new lh([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new dc(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(o=>{n.push(o.serialize())}),n}}const bA=["Unknown","Point","LineString","Polygon"];class E0{constructor(n,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bA[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*o-n[0])+this.featureDistanceData.bearing[1]*(h*o-n[1])}return 0}parseColor(n){let o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=Sr.parse(n)),o}getConfig(n){return this.options?this.options.get(n):null}}class Bo{constructor(n,o,u,h,p){this.name=n,this.type=o,this._evaluate=u,this.args=h,this._overloadIndex=p}evaluate(n){if(!this._evaluate){const o=Bo.definitions[this.name];this._evaluate=Array.isArray(o)?o[2]:o.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,o){const u=n[0],h=Bo.definitions[u];if(!h)return o.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[];let w=null,E=-1;for(const[C,P]of m){if(Array.isArray(C)&&C.length!==n.length-1)continue;v.push(C),E++,w=new ew(o.registry,o.path,null,o.scope,void 0,o._scope,o.options);const k=[];let N=!1;for(let j=1;j<n.length;j++){const $=n[j],q=Array.isArray(C)?C[j-1]:C.type,te=w.parse($,1+k.length,q);if(!te){N=!0;break}k.push(te)}if(!N)if(Array.isArray(C)&&C.length!==k.length)w.error(`Expected ${C.length} arguments, but found ${k.length} instead.`);else{for(let j=0;j<k.length;j++){const $=Array.isArray(C)?C[j]:C.type,q=k[j];w.concat(j+1).checkSubtype($,q.type)}if(w.errors.length===0)return new Bo(u,p,P,k,E)}}if(v.length===1)o.errors.push(...w.errors);else{const C=(v.length?v:m.map(([k])=>k)).map(wA).join(" | "),P=[];for(let k=1;k<n.length;k++){const N=o.parse(n[k],1+P.length);if(!N)return null;P.push(ki(N.type))}o.error(`Expected arguments of type ${C}, but found (${P.join(", ")}) instead.`)}return null}static register(n,o){Bo.definitions=o;for(const u in o)n[u]=Bo}}function wA(i){return Array.isArray(i)?`(${i.map(ki).join(", ")})`:`(${ki(i.type)}...)`}class pp{constructor(n,o,u){this.type=bg,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const u=n[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");const h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Cr);if(!h)return null;const p=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Cr);if(!p)return null;let m=null;return u.locale&&(m=o.parse(u.locale,1,yr),!m)?null:new pp(h,p,m)}evaluate(n){return new wg(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function Ir(i,n,o=0,u=i.length-1,h=Fb){for(;u>o;){if(u-o>600){const w=u-o+1,E=n-o+1,C=Math.log(w),P=.5*Math.exp(2*C/3),k=.5*Math.sqrt(C*P*(w-P)/w)*(E-w/2<0?-1:1);Ir(i,n,Math.max(o,Math.floor(n-E*P/w+k)),Math.min(u,Math.floor(n+(w-E)*P/w+k)),h)}const p=i[n];let m=o,v=u;for(Ed(i,o,n),h(i[u],p)>0&&Ed(i,o,u);m<v;){for(Ed(i,m,v),m++,v--;h(i[m],p)<0;)m++;for(;h(i[v],p)>0;)v--}h(i[o],p)===0?Ed(i,o,v):(v++,Ed(i,v,u)),v<=n&&(o=v+1),n<=v&&(u=v-1)}}function Ed(i,n,o){const u=i[n];i[n]=i[o],i[o]=u}function Fb(i,n){return i<n?-1:i>n?1:0}function TA(i){let n=0;for(let o,u,h=0,p=i.length,m=p-1;h<p;m=h++)o=i[h],u=i[m],n+=(u.x-o.x)*(o.y+u.y);return n}function mp(i,n){i[0]=Math.min(i[0],n[0]),i[1]=Math.min(i[1],n[1]),i[2]=Math.max(i[2],n[0]),i[3]=Math.max(i[3],n[1])}function ou(i,n){return!(i[0]<=n[0]||i[2]>=n[2]||i[1]<=n[1]||i[3]>=n[3])}function Eg(i,n,o){const u=i[0]-n[0],h=i[1]-n[1],p=i[0]-o[0],m=i[1]-o[1];return u*m-p*h==0&&u*p<=0&&h*m<=0}function pc(i,n,o=!1){let u=!1;for(let v=0,w=n.length;v<w;v++){const E=n[v];for(let C=0,P=E.length,k=P-1;C<P;k=C++){const N=E[k],j=E[C];if(Eg(i,N,j))return o;(p=N)[1]>(h=i)[1]!=(m=j)[1]>h[1]&&h[0]<(m[0]-p[0])*(h[1]-p[1])/(m[1]-p[1])+p[0]&&(u=!u)}}var h,p,m;return u}function Bb(i,n,o,u){const h=u[0]-o[0],p=u[1]-o[1],m=(i[0]-o[0])*p-h*(i[1]-o[1]),v=(n[0]-o[0])*p-h*(n[1]-o[1]);return m>0&&v<0||m<0&&v>0}function gp(i,n,o,u){return(h=[u[0]-o[0],u[1]-o[1]])[0]*(p=[n[0]-i[0],n[1]-i[1]])[1]-h[1]*p[0]!=0&&!(!Bb(i,n,o,u)||!Bb(o,u,i,n));var h,p}const no=8192;function EA(i,n){const o=(180+i[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(o*h*no),Math.round(u*h*no)]}function jb(i,n){for(let o=0;o<n.length;o++)if(pc(i,n[o]))return!0;return!1}function _p(i,n,o){for(const u of o)for(let h=0,p=u.length,m=p-1;h<p;m=h++)if(gp(i,n,u[m],u[h]))return!0;return!1}function Sg(i,n){for(let o=0;o<i.length;++o)if(!pc(i[o],n))return!1;for(let o=0;o<i.length-1;++o)if(_p(i[o],i[o+1],n))return!1;return!0}function SA(i,n){for(let o=0;o<n.length;o++)if(Sg(i,n[o]))return!0;return!1}function S0(i,n,o){const u=[];for(let h=0;h<i.length;h++){const p=[];for(let m=0;m<i[h].length;m++){const v=EA(i[h][m],o);mp(n,v),p.push(v)}u.push(p)}return u}function Ub(i,n,o){const u=[];for(let h=0;h<i.length;h++){const p=S0(i[h],n,o);u.push(p)}return u}function I0(i,n,o,u){if(i[0]<o[0]||i[0]>o[2]){const h=.5*u;let p=i[0]-o[0]>h?-u:o[0]-i[0]>h?u:0;p===0&&(p=i[0]-o[2]>h?-u:o[2]-i[0]>h?u:0),i[0]+=p}mp(n,i)}function Ig(i,n,o,u){const h=Math.pow(2,u.z)*no,p=[u.x*no,u.y*no],m=[];if(!i)return m;for(const v of i)for(const w of v){const E=[w.x+p[0],w.y+p[1]];I0(E,n,o,h),m.push(E)}return m}function Vb(i,n,o,u){const h=Math.pow(2,u.z)*no,p=[u.x*no,u.y*no],m=[];if(!i)return m;for(const w of i){const E=[];for(const C of w){const P=[C.x+p[0],C.y+p[1]];mp(n,P),E.push(P)}m.push(E)}if(n[2]-n[0]<=h/2){(v=n)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of m)for(const E of w)I0(E,n,o,h)}var v;return m}class Al{constructor(n,o){this.type=Cr,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Td(n[1])){const u=n[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const p=u.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Al(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Al(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Al(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const v=S0(u.coordinates,p,m),w=Ig(o.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!pc(E,v))return!1}if(u.type==="MultiPolygon"){const v=Ub(u.coordinates,p,m),w=Ig(o.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!jb(E,v))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=o.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const v=S0(u.coordinates,p,m),w=Vb(o.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!Sg(E,v))return!1}if(u.type==="MultiPolygon"){const v=Ub(u.coordinates,p,m),w=Vb(o.geometry(),h,p,m);if(!ou(h,p))return!1;for(const E of w)if(!SA(E,v))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Cg={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},$b=1/298.257223563,qb=$b*(2-$b),yp=Math.PI/180;class vp{static fromTile(n,o,u){const h=Math.PI*(1-2*(n+.5)/Math.pow(2,o)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/yp;return new vp(p,u)}static get units(){return Cg}constructor(n,o){if(n===void 0)throw new Error("No latitude given.");if(o&&!Cg[o])throw new Error(`Unknown unit ${o}. Use one of: ${Object.keys(Cg).join(", ")}`);const u=6378.137*yp*(o?Cg[o]:1),h=Math.cos(n*yp),p=1/(1-qb*(1-h*h)),m=Math.sqrt(p);this.kx=u*m*h,this.ky=u*m*p*(1-qb)}distance(n,o){const u=aa(n[0]-o[0])*this.kx,h=(n[1]-o[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(n,o){const u=aa(o[0]-n[0])*this.kx;return Math.atan2(u,(o[1]-n[1])*this.ky)/yp}destination(n,o,u){const h=u*yp;return this.offset(n,Math.sin(h)*o,Math.cos(h)*o)}offset(n,o,u){return[n[0]+o/this.kx,n[1]+u/this.ky]}lineDistance(n){let o=0;for(let u=0;u<n.length-1;u++)o+=this.distance(n[u],n[u+1]);return o}area(n){let o=0;for(let u=0;u<n.length;u++){const h=n[u];for(let p=0,m=h.length,v=m-1;p<m;v=p++)o+=aa(h[p][0]-h[v][0])*(h[p][1]+h[v][1])*(u?-1:1)}return Math.abs(o)/2*this.kx*this.ky}along(n,o){let u=0;if(o<=0)return n[0];for(let h=0;h<n.length-1;h++){const p=n[h],m=n[h+1],v=this.distance(p,m);if(u+=v,u>o)return C0(p,m,(o-(u-v))/v)}return n[n.length-1]}pointToSegmentDistance(n,o,u){let[h,p]=o,m=aa(u[0]-h)*this.kx,v=(u[1]-p)*this.ky;if(m!==0||v!==0){const w=(aa(n[0]-h)*this.kx*m+(n[1]-p)*this.ky*v)/(m*m+v*v);w>1?(h=u[0],p=u[1]):w>0&&(h+=m/this.kx*w,p+=v/this.ky*w)}return m=aa(n[0]-h)*this.kx,v=(n[1]-p)*this.ky,Math.sqrt(m*m+v*v)}pointOnLine(n,o){let u=1/0,h=n[0][0],p=n[0][1],m=0,v=0;for(let w=0;w<n.length-1;w++){let E=n[w][0],C=n[w][1],P=aa(n[w+1][0]-E)*this.kx,k=(n[w+1][1]-C)*this.ky,N=0;P===0&&k===0||(N=(aa(o[0]-E)*this.kx*P+(o[1]-C)*this.ky*k)/(P*P+k*k),N>1?(E=n[w+1][0],C=n[w+1][1]):N>0&&(E+=P/this.kx*N,C+=k/this.ky*N)),P=aa(o[0]-E)*this.kx,k=(o[1]-C)*this.ky;const j=P*P+k*k;j<u&&(u=j,h=E,p=C,m=w,v=N)}return{point:[h,p],index:m,t:Math.max(0,Math.min(1,v))}}lineSlice(n,o,u){let h=this.pointOnLine(u,n),p=this.pointOnLine(u,o);if(h.index>p.index||h.index===p.index&&h.t>p.t){const E=h;h=p,p=E}const m=[h.point],v=h.index+1,w=p.index;!Gb(u[v],m[0])&&v<=w&&m.push(u[v]);for(let E=v+1;E<=w;E++)m.push(u[E]);return Gb(u[w],p.point)||m.push(p.point),m}lineSliceAlong(n,o,u){let h=0;const p=[];for(let m=0;m<u.length-1;m++){const v=u[m],w=u[m+1],E=this.distance(v,w);if(h+=E,h>n&&p.length===0&&p.push(C0(v,w,(n-(h-E))/E)),h>=o)return p.push(C0(v,w,(o-(h-E))/E)),p;h>n&&p.push(w)}return p}bufferPoint(n,o){const u=o/this.ky,h=o/this.kx;return[n[0]-h,n[1]-u,n[0]+h,n[1]+u]}bufferBBox(n,o){const u=o/this.ky,h=o/this.kx;return[n[0]-h,n[1]-u,n[2]+h,n[3]+u]}insideBBox(n,o){return aa(n[0]-o[0])>=0&&aa(n[0]-o[2])<=0&&n[1]>=o[1]&&n[1]<=o[3]}}function Gb(i,n){return i[0]===n[0]&&i[1]===n[1]}function C0(i,n,o){const u=aa(n[0]-i[0]);return[i[0]+u*o,i[1]+(n[1]-i[1])*o]}function aa(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}class au{constructor(n=[],o=(u,h)=>u<h?-1:u>h?1:0){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:u}=this,h=o[n];for(;n>0;){const p=n-1>>1,m=o[p];if(u(h,m)>=0)break;o[n]=m,n=p}o[n]=h}_down(n){const{data:o,compare:u}=this,h=this.length>>1,p=o[n];for(;n<h;){let m=1+(n<<1);const v=m+1;if(v<this.length&&u(o[v],o[m])<0&&(m=v),u(o[m],p)>=0)break;o[n]=o[m],n=m}o[n]=p}}var Ft=8192;function Wb(i,n){return n.dist-i.dist}const xp=100,A0=50;function Hb(i){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==i.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==i[o])return!1;return!0}function Ag(i){return i[1]-i[0]+1}function mc(i,n){const o=i[1]>=i[0]&&i[1]<n;return o||console.warn("Distance Expression: Index is out of range"),o}function P0(i,n){if(i[0]>i[1])return[null,null];const o=Ag(i);if(n){if(o===2)return[i,null];const u=Math.floor(o/2);return[[i[0],i[0]+u],[i[0]+u,i[1]]]}{if(o===1)return[i,null];const u=Math.floor(o/2)-1;return[[i[0],i[0]+u],[i[0]+u+1,i[1]]]}}function la(i,n){const o=[1/0,1/0,-1/0,-1/0];if(!mc(n,i.length))return o;for(let u=n[0];u<=n[1];++u)mp(o,i[u]);return o}function Pg(i){const n=[1/0,1/0,-1/0,-1/0];for(let o=0;o<i.length;++o)for(let u=0;u<i[o].length;++u)mp(n,i[o][u]);return n}function Sd(i,n,o){if(Hb(i)||Hb(n))return NaN;let u=0,h=0;return i[2]<n[0]&&(u=n[0]-i[2]),i[0]>n[2]&&(u=i[0]-n[2]),i[1]>n[3]&&(h=i[1]-n[3]),i[3]<n[1]&&(h=n[1]-i[3]),o.distance([0,0],[u,h])}function Zb(i){return 360*i-180}function Xb(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function ca(i,n){const o=Math.pow(2,n.z),u=(i.y/Ft+n.y)/o;return[Zb((i.x/Ft+n.x)/o),Xb(u)]}function Kb(i,n){const o=[];for(let u=0;u<i.length;++u)o.push(ca(i[u],n));return o}function Qb(i,n,o){const u=o.pointOnLine(n,i).point;return o.distance(i,u)}function R0(i,n,o,u,h){const p=o.slice(u[0],u[1]+1);let m=1/0;for(let v=n[0];v<=n[1];++v)if((m=Math.min(m,Qb(i[v],p,h)))===0)return 0;return m}function Id(i,n,o,u,h){const p=Math.min(h.pointToSegmentDistance(i,o,u),h.pointToSegmentDistance(n,o,u)),m=Math.min(h.pointToSegmentDistance(o,i,n),h.pointToSegmentDistance(u,i,n));return Math.min(p,m)}function IA(i,n,o,u,h){if(!mc(n,i.length)||!mc(u,o.length))return NaN;let p=1/0;for(let m=n[0];m<n[1];++m)for(let v=u[0];v<u[1];++v){if(gp(i[m],i[m+1],o[v],o[v+1]))return 0;p=Math.min(p,Id(i[m],i[m+1],o[v],o[v+1],h))}return p}function CA(i,n,o,u,h){if(!mc(n,i.length)||!mc(u,o.length))return NaN;let p=1/0;for(let m=n[0];m<=n[1];++m)for(let v=u[0];v<=u[1];++v)if((p=Math.min(p,h.distance(i[m],o[v])))===0)return p;return p}function AA(i,n,o){if(pc(i,n,!0))return 0;let u=1/0;for(const h of n){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(u=Math.min(u,o.pointToSegmentDistance(i,h[p-1],h[0])))===0||(u=Math.min(u,Qb(i,h,o)))===0)return u}return u}function PA(i,n,o,u){if(!mc(n,i.length))return NaN;for(let p=n[0];p<=n[1];++p)if(pc(i[p],o,!0))return 0;let h=1/0;for(let p=n[0];p<n[1];++p)for(const m of o)for(let v=0,w=m.length,E=w-1;v<w;E=v++){if(gp(i[p],i[p+1],m[E],m[v]))return 0;h=Math.min(h,Id(i[p],i[p+1],m[E],m[v],u))}return h}function Yb(i,n){for(const o of i)for(let u=0;u<=o.length-1;++u)if(pc(o[u],n,!0))return!0;return!1}function Rg(i,n,o,u=1/0){const h=Pg(i),p=Pg(n);if(u!==1/0&&Sd(h,p,o)>=u)return u;if(ou(h,p)){if(Yb(i,n))return 0}else if(Yb(n,i))return 0;let m=u;for(const v of i)for(let w=0,E=v.length,C=E-1;w<E;C=w++)for(const P of n)for(let k=0,N=P.length,j=N-1;k<N;j=k++){if(gp(v[C],v[w],P[j],P[k]))return 0;m=Math.min(m,Id(v[C],v[w],P[j],P[k],o))}return m}function ch(i,n,o,u,h,p,m){if(p===null||m===null)return;const v=Sd(la(u,p),la(h,m),o);v<n&&i.push({dist:v,range1:p,range2:m})}function ua(i,n,o,u,h=1/0){let p=Math.min(u.distance(i[0],o[0][0]),h);if(p===0)return p;const m=new au([{dist:0,range1:[0,i.length-1],range2:[0,0]}],Wb),v=n?A0:xp,w=Pg(o);for(;m.length;){const E=m.pop();if(E.dist>=p)continue;const C=E.range1;if(Ag(C)<=v){if(!mc(C,i.length))return NaN;if(n){const P=PA(i,C,o,u);if((p=Math.min(p,P))===0)return p}else for(let P=C[0];P<=C[1];++P){const k=AA(i[P],o,u);if((p=Math.min(p,k))===0)return p}}else{const P=P0(C,n);if(P[0]!==null){const k=Sd(la(i,P[0]),w,u);k<p&&m.push({dist:k,range1:P[0],range2:[0,0]})}if(P[1]!==null){const k=Sd(la(i,P[1]),w,u);k<p&&m.push({dist:k,range1:P[1],range2:[0,0]})}}}return p}function bp(i,n,o,u,h,p=1/0){let m=Math.min(p,h.distance(i[0],o[0]));if(m===0)return m;const v=new au([{dist:0,range1:[0,i.length-1],range2:[0,o.length-1]}],Wb),w=n?A0:xp,E=u?A0:xp;for(;v.length;){const C=v.pop();if(C.dist>=m)continue;const P=C.range1,k=C.range2;if(Ag(P)<=w&&Ag(k)<=E){if(!mc(P,i.length)||!mc(k,o.length))return NaN;if(n&&u?m=Math.min(m,IA(i,P,o,k,h)):n||u?n&&!u?m=Math.min(m,R0(o,k,i,P,h)):!n&&u&&(m=Math.min(m,R0(i,P,o,k,h))):m=Math.min(m,CA(i,P,o,k,h)),m===0)return m}else{const N=P0(P,n),j=P0(k,u);ch(v,m,h,i,o,N[0],j[0]),ch(v,m,h,i,o,N[0],j[1]),ch(v,m,h,i,o,N[1],j[0]),ch(v,m,h,i,o,N[1],j[1])}}return m}function M0(i,n,o,u,h=1/0){let p=h;const m=la(i,[0,i.length-1]);for(const v of o)if(!(p!==1/0&&Sd(m,la(v,[0,v.length-1]),u)>=p)&&(p=Math.min(p,bp(i,n,v,!0,u,p)),p===0))return p;return p}function Mg(i,n,o,u,h=1/0){let p=h;const m=la(i,[0,i.length-1]);for(const v of o){if(p!==1/0&&Sd(m,Pg(v),u)>=p)continue;const w=ua(i,n,v,u,p);if(isNaN(w))return w;if((p=Math.min(p,w))===0)return p}return p}function k0(i){return i==="Point"||i==="MultiPoint"||i==="LineString"||i==="MultiLineString"||i==="Polygon"||i==="MultiPolygon"}class uh{constructor(n,o){this.type=en,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(Td(n[1])){const u=n[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(k0(u.features[h].geometry.type))return new uh(u,u.features[h].geometry)}else if(u.type==="Feature"){if(k0(u.geometry.type))return new uh(u,u.geometry)}else if(k0(u.type))return new uh(u,u)}return o.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const o=n.geometry(),u=n.canonicalID();if(o!=null&&u!=null){if(n.geometryType()==="Point")return function(h,p,m){const v=[];for(const E of h)for(const C of E)v.push(ca(C,p));const w=new vp(v[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?bp(v,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",w):m.type==="MultiLineString"?M0(v,!1,m.coordinates,w):m.type==="Polygon"||m.type==="MultiPolygon"?Mg(v,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,w):null}(o,u,this.geometries);if(n.geometryType()==="LineString")return function(h,p,m){const v=[];for(const E of h){const C=[];for(const P of E)C.push(ca(P,p));v.push(C)}const w=new vp(v[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return M0(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,w);if(m.type==="MultiLineString"){let E=1/0;for(let C=0;C<m.coordinates.length;C++){const P=M0(m.coordinates[C],!0,v,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}if(m.type==="Polygon"||m.type==="MultiPolygon"){let E=1/0;for(let C=0;C<v.length;C++){const P=Mg(v[C],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return null}(o,u,this.geometries);if(n.geometryType()==="Polygon")return function(h,p,m){const v=[];for(const E of function(C,P){const k=C.length;if(k<=1)return[C];const N=[];let j,$;for(let q=0;q<k;q++){const te=TA(C[q]);te!==0&&(C[q].area=Math.abs(te),$===void 0&&($=te<0),$===te<0?(j&&N.push(j),j=[C[q]]):j.push(C[q]))}return j&&N.push(j),N}(h)){const C=[];for(let P=0;P<E.length;++P)C.push(Kb(E[P],p));v.push(C)}const w=new vp(v[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Mg(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",v,w);if(m.type==="MultiLineString"){let E=1/0;for(let C=0;C<m.coordinates.length;C++){const P=Mg(m.coordinates[C],!0,v,w,E);if(isNaN(P))return P;if((E=Math.min(E,P))===0)return E}return E}return m.type==="Polygon"||m.type==="MultiPolygon"?function(E,C,P){let k=1/0;for(const N of E)for(const j of C){const $=Rg(N,j,P,k);if(isNaN($))return $;if((k=Math.min(k,$))===0)return k}return k}(m.type==="Polygon"?[m.coordinates]:m.coordinates,v,w):null}(o,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function wp(i,n){switch(i){case"string":return Ka(n);case"number":return+n;case"boolean":return!!n;case"color":return Sr.parse(n);case"formatted":return go.fromString(Ka(n));case"resolvedImage":return sa.fromString(Ka(n))}return n}function Jb(i,n,o,u){return u!==void 0&&(i=u*Math.round(i/u)),n!==void 0&&i<n&&(i=n),o!==void 0&&i>o&&(i=o),i}class lu{constructor(n,o,u){this.type=n,this.key=o,this.scope=u}static parse(n,o){let u=o.expectedType;if(u==null&&(u=wr),n.length<2||n.length>3)return o.error("Invalid number of arguments for 'config' expression.");const h=o.parse(n[1],1);if(!(h instanceof Qa))return o.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const p=o.parse(n[2],2);return p instanceof Qa?new lu(u,Ka(h.value),Ka(p.value)):o.error("Scope of 'config' expression must be a string literal.")}return new lu(u,Ka(h.value))}evaluate(n){const o=[this.key,this.scope,n.scope].filter(Boolean).join(""),u=n.getConfig(o);if(!u)return null;const{type:h,value:p,values:m,minValue:v,maxValue:w,stepValue:E}=u,C=u.default.evaluate(n);let P=C;if(p){const k=n.scope;n.scope=(k||"").split("").slice(1).join(""),P=p.evaluate(n),n.scope=k}return h&&(P=wp(h,P)),P===void 0||v===void 0&&w===void 0&&E===void 0||(typeof P=="number"?P=Jb(P,v,w,E):Array.isArray(P)&&(P=P.map(k=>typeof k=="number"?Jb(k,v,w,E):k))),p!==void 0&&P!==void 0&&m&&!m.includes(P)&&(P=C,h&&(P=wp(h,P))),(h&&h!==this.type||P!==void 0&&as(P)!==this.type)&&(P=wp(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function Tp(i){if(i instanceof Bo&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Al||i instanceof uh)return!1;let n=!0;return i.eachChild(o=>{n&&!Tp(o)&&(n=!1)}),n}function kg(i){if(i instanceof Bo&&i.name==="feature-state")return!1;let n=!0;return i.eachChild(o=>{n&&!kg(o)&&(n=!1)}),n}function Ep(i){if(i instanceof lu)return new Set([i.key]);let n=new Set;return i.eachChild(o=>{n=new Set([...n,...Ep(o)])}),n}function Sp(i,n){if(i instanceof Bo&&n.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(u=>{o&&!Sp(u,n)&&(o=!1)}),o}class Ip{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const u=n[1];return o.scope.has(u)?new Ip(u,o.scope.get(u)):o.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Og{constructor(n,o=[],u,h=new b0,p=[],m,v){this.registry=n,this.path=o,this.key=o.map(w=>`[${w}]`).join(""),this.scope=h,this.errors=p,this.expectedType=u,this._scope=m,this.options=v}parse(n,o,u,h,p={}){return o||u?this.concat(o,u,h)._parse(n,p):this._parse(n,p)}_parse(n,o){function u(h,p,m){return m==="assert"?new oa(p,[h]):m==="coerce"?new fc(p,[h]):h}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(h){let p=h.parse(n,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,v=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||v.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(m,v))return null}else p=u(p,m,o.typeAnnotation||"coerce");else p=u(p,m,o.typeAnnotation||"assert")}if(!(p instanceof Qa)&&p.type.kind!=="resolvedImage"&&Cp(p)){const m=new E0(this._scope,this.options);try{p=new Qa(p.type,p.evaluate(m))}catch(v){return this.error(v.message),null}}return p}return fc.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,u){const h=typeof n=="number"?this.path.concat(n):this.path,p=u?this.scope.concat(u):this.scope;return new Og(this.registry,h,o||null,p,this.errors,this._scope,this.options)}error(n,...o){const u=`${this.key}${o.map(h=>`[${h}]`).join("")}`;this.errors.push(new Cl(u,n))}checkSubtype(n,o){const u=dp(n,o);return u&&this.error(u),u}}var ew=Og;function Cp(i){if(i instanceof Ip)return Cp(i.boundExpression);if(i instanceof Bo&&i.name==="error"||i instanceof pp||i instanceof Al||i instanceof uh||i instanceof lu)return!1;const n=i instanceof fc||i instanceof oa;let o=!0;return i.eachChild(u=>{o=n?o&&Cp(u):o&&u instanceof Qa}),!!o&&Tp(i)&&Sp(i,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function hh(i,n){const o=i.length-1;let u,h,p=0,m=o,v=0;for(;p<=m;)if(v=Math.floor((p+m)/2),u=i[v],h=i[v+1],u<=n){if(v===o||n<h)return v;p=v+1}else{if(!(u>n))throw new ms("Input is not a number.");m=v-1}return 0}class Cd{constructor(n,o,u){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[h,p]of u)this.labels.push(h),this.outputs.push(p)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const u=o.parse(n[1],1,en);if(!u)return null;const h=[];let p=null;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(let m=1;m<n.length;m+=2){const v=m===1?-1/0:n[m],w=n[m+1],E=m,C=m+1;if(typeof v!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=o.parse(w,C,p);if(!P)return null;p=p||P.type,h.push([v,P])}return new Cd(p,u,h)}evaluate(n){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return u[0].evaluate(n);const p=o.length;return h>=o[p-1]?u[p-1].evaluate(n):u[hh(o,h)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}const tw=.95047,O0=1.08883,nw=4/29,cu=6/29,rw=3*cu*cu,RA=cu*cu*cu,MA=Math.PI/180,kA=180/Math.PI;function Dg(i){return i>RA?Math.pow(i,1/3):i/rw+nw}function D0(i){return i>cu?i*i*i:rw*(i-nw)}function L0(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function z0(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function iw(i){const n=z0(i.r),o=z0(i.g),u=z0(i.b),h=Dg((.4124564*n+.3575761*o+.1804375*u)/tw),p=Dg((.2126729*n+.7151522*o+.072175*u)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Dg((.0193339*n+.119192*o+.9503041*u)/O0)),alpha:i.a}}function sw(i){let n=(i.l+16)/116,o=isNaN(i.a)?n:n+i.a/500,u=isNaN(i.b)?n:n-i.b/200;return n=1*D0(n),o=tw*D0(o),u=O0*D0(u),new Sr(L0(3.2404542*o-1.5371385*n-.4985314*u),L0(-.969266*o+1.8760108*n+.041556*u),L0(.0556434*o-.2040259*n+1.0572252*u),i.alpha)}function OA(i,n,o){const u=n-i;return i+o*(u>180||u<-180?u-360*Math.round(u/360):u)}const Ap={forward:iw,reverse:sw,interpolate:function(i,n,o){return{l:Sn(i.l,n.l,o),a:Sn(i.a,n.a,o),b:Sn(i.b,n.b,o),alpha:Sn(i.alpha,n.alpha,o)}}},Pp={forward:function(i){const{l:n,a:o,b:u}=iw(i),h=Math.atan2(u,o)*kA;return{h:h<0?h+360:h,c:Math.sqrt(o*o+u*u),l:n,alpha:i.a}},reverse:function(i){const n=i.h*MA,o=i.c;return sw({l:i.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:i.alpha})},interpolate:function(i,n,o){return{h:OA(i.h,n.h,o),c:Sn(i.c,n.c,o),l:Sn(i.l,n.l,o),alpha:Sn(i.alpha,n.alpha,o)}}};var Rp=Object.freeze({__proto__:null,hcl:Pp,lab:Ap});class ha{constructor(n,o,u,h,p){this.type=n,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[m,v]of p)this.labels.push(m),this.outputs.push(v)}static interpolationFactor(n,o,u,h){let p=0;if(n.name==="exponential")p=N0(o,n.base,u,h);else if(n.name==="linear")p=N0(o,1,u,h);else if(n.name==="cubic-bezier"){const m=n.controlPoints;p=new Qc(m[0],m[1],m[2],m[3]).solve(N0(o,1,u,h))}return p}static parse(n,o){let[u,h,p,...m]=n;if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(p=o.parse(p,2,en),!p)return null;const v=[];let w=null;u==="interpolate-hcl"||u==="interpolate-lab"?w=Ia:o.expectedType&&o.expectedType.kind!=="value"&&(w=o.expectedType);for(let E=0;E<m.length;E+=2){const C=m[E],P=m[E+1],k=E+3,N=E+4;if(typeof C!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(v.length&&v[v.length-1][0]>=C)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const j=o.parse(P,N,w);if(!j)return null;w=w||j.type,v.push([C,j])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new ha(w,u,h,p,v):o.error(`Type ${ki(w)} is not interpolatable.`)}evaluate(n){const o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return u[0].evaluate(n);const p=o.length;if(h>=o[p-1])return u[p-1].evaluate(n);const m=hh(o,h),v=ha.interpolationFactor(this.interpolation,h,o[m],o[m+1]),w=u[m].evaluate(n),E=u[m+1].evaluate(n);return this.operator==="interpolate"?hp[this.type.kind.toLowerCase()](w,E,v):this.operator==="interpolate-hcl"?Pp.reverse(Pp.interpolate(Pp.forward(w),Pp.forward(E),v)):Ap.reverse(Ap.interpolate(Ap.forward(w),Ap.forward(E),v))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,n,this.input.serialize()];for(let u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o}}function N0(i,n,o,u){const h=u-o,p=i-o;return h===0?0:n===1?p/h:(Math.pow(n,p)-1)/(Math.pow(n,h)-1)}class dh{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let u=null;const h=o.expectedType;h&&h.kind!=="value"&&(u=h);const p=[];for(const v of n.slice(1)){const w=o.parse(v,1+p.length,u,void 0,{typeAnnotation:"omit"});if(!w)return null;u=u||w.type,p.push(w)}const m=h&&p.some(v=>dp(h,v.type));return new dh(m?wr:u,p)}evaluate(n){let o,u=null,h=0;for(const p of this.args){if(h++,u=p.evaluate(n),u&&u instanceof sa&&!u.available&&(o||(o=u),u=null,h===this.args.length))return o;if(u!==null)break}return u}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class Lg{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const u=[];for(let p=1;p<n.length-1;p+=2){const m=n[p];if(typeof m!="string")return o.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=o.parse(n[p+1],p+1);if(!v)return null;u.push([m,v])}const h=o.parse(n[n.length-1],n.length-1,o.expectedType,u);return h?new Lg(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,u]of this.bindings)n.push(o,u.serialize());return n.push(this.result.serialize()),n}}class zg{constructor(n,o,u){this.type=n,this.index=o,this.input=u}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,en),h=o.parse(n[2],2,to(o.expectedType||wr));return u&&h?new zg(h.type.itemType,u,h):null}evaluate(n){const o=this.index.evaluate(n),u=this.input.evaluate(n);if(o<0)throw new ms(`Array index out of bounds: ${o} < 0.`);if(o>=u.length)throw new ms(`Array index out of bounds: ${o} > ${u.length-1}.`);if(o!==Math.floor(o))throw new ms(`Array index must be an integer, but found ${o} instead.`);return u[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class F0{constructor(n,o){this.type=Cr,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,wr),h=o.parse(n[2],2,wr);return u&&h?Ca(u.type,[Cr,yr,en,ia,wr])?new F0(u,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(u.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(u==null)return!1;if(!fp(o,["boolean","string","number","null"]))throw new ms(`Expected first argument to be of type boolean, string, number or null, but found ${ki(as(o))} instead.`);if(!fp(u,["string","array"]))throw new ms(`Expected second argument to be of type array or string, but found ${ki(as(u))} instead.`);return u.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Mp{constructor(n,o,u){this.type=en,this.needle=n,this.haystack=o,this.fromIndex=u}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,wr),h=o.parse(n[2],2,wr);if(!u||!h)return null;if(!Ca(u.type,[Cr,yr,en,ia,wr]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(u.type)} instead`);if(n.length===4){const p=o.parse(n[3],3,en);return p?new Mp(u,h,p):null}return new Mp(u,h)}evaluate(n){const o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!fp(o,["boolean","string","number","null"]))throw new ms(`Expected first argument to be of type boolean, string, number or null, but found ${ki(as(o))} instead.`);if(!fp(u,["string","array"]))throw new ms(`Expected second argument to be of type array or string, but found ${ki(as(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return u.indexOf(o,h)}return u.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ng{constructor(n,o,u,h,p,m){this.inputType=n,this.type=o,this.input=u,this.cases=h,this.outputs=p,this.otherwise=m}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const p={},m=[];for(let E=2;E<n.length-1;E+=2){let C=n[E];const P=n[E+1];Array.isArray(C)||(C=[C]);const k=o.concat(E);if(C.length===0)return k.error("Expected at least one branch label.");for(const j of C){if(typeof j!="number"&&typeof j!="string")return k.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return k.error("Numeric branch labels must be integer values.");if(u){if(k.checkSubtype(u,as(j)))return null}else u=as(j);if(p[String(j)]!==void 0)return k.error("Branch labels must be unique.");p[String(j)]=m.length}const N=o.parse(P,E,h);if(!N)return null;h=h||N.type,m.push(N)}const v=o.parse(n[1],1,wr);if(!v)return null;const w=o.parse(n[n.length-1],n.length-1,h);return w?v.type.kind!=="value"&&o.concat(1).checkSubtype(u,v.type)?null:new Ng(u,h,v,p,m,w):null}evaluate(n){const o=this.input.evaluate(n);return(as(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),u=[],h={};for(const m of o){const v=h[this.cases[m]];v===void 0?(h[this.cases[m]]=u.length,u.push([this.cases[m],[m]])):u[v][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,v]of u)n.push(v.length===1?p(v[0]):v.map(p)),n.push(this.outputs[m].serialize());return n.push(this.otherwise.serialize()),n}}class Fg{constructor(n,o,u){this.type=n,this.branches=o,this.otherwise=u}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);const h=[];for(let m=1;m<n.length-1;m+=2){const v=o.parse(n[m],m,Cr);if(!v)return null;const w=o.parse(n[m+1],m+1,u);if(!w)return null;h.push([v,w]),u=u||w.type}const p=o.parse(n[n.length-1],n.length-1,u);return p?new Fg(u,h,p):null}evaluate(n){for(const[o,u]of this.branches)if(o.evaluate(n))return u.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,u]of this.branches)n(o),n(u);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(o=>{n.push(o.serialize())}),n}}class kp{constructor(n,o,u,h){this.type=n,this.input=o,this.beginIndex=u,this.endIndex=h}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const u=o.parse(n[1],1,wr),h=o.parse(n[2],2,en);if(!u||!h)return null;if(!Ca(u.type,[to(wr),yr,wr]))return o.error(`Expected first argument to be of type array or string, but found ${ki(u.type)} instead`);if(n.length===4){const p=o.parse(n[3],3,en);return p?new kp(u.type,u,h,p):null}return new kp(u.type,u,h)}evaluate(n){const o=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!fp(o,["string","array"]))throw new ms(`Expected first argument to be of type array or string, but found ${ki(as(o))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return o.slice(u,h)}return o.slice(u)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Bg(i,n){return i==="=="||i==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function jg(i,n,o,u){return u.compare(n,o)===0}function Ad(i,n,o){const u=i!=="=="&&i!=="!=";return class gZ{constructor(p,m,v){this.type=Cr,this.lhs=p,this.rhs=m,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const v=p[0];let w=m.parse(p[1],1,wr);if(!w)return null;if(!Bg(v,w.type))return m.concat(1).error(`"${v}" comparisons are not supported for type '${ki(w.type)}'.`);let E=m.parse(p[2],2,wr);if(!E)return null;if(!Bg(v,E.type))return m.concat(2).error(`"${v}" comparisons are not supported for type '${ki(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${ki(w.type)}' and '${ki(E.type)}'.`);u&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new oa(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new oa(w.type,[E])));let C=null;if(p.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(C=m.parse(p[3],3,bg),!C)return null}return new gZ(w,E,C)}evaluate(p){const m=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(u&&this.hasUntypedArgument){const w=as(m),E=as(v);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new ms(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const w=as(m),E=as(v);if(w.kind!=="string"||E.kind!=="string")return n(p,m,v)}return this.collator?o(p,m,v,this.collator.evaluate(p)):n(p,m,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const DA=Ad("==",function(i,n,o){return n===o},jg),ow=Ad("!=",function(i,n,o){return n!==o},function(i,n,o,u){return!jg(0,n,o,u)}),LA=Ad("<",function(i,n,o){return n<o},function(i,n,o,u){return u.compare(n,o)<0}),zA=Ad(">",function(i,n,o){return n>o},function(i,n,o,u){return u.compare(n,o)>0}),NA=Ad("<=",function(i,n,o){return n<=o},function(i,n,o,u){return u.compare(n,o)<=0}),FA=Ad(">=",function(i,n,o){return n>=o},function(i,n,o,u){return u.compare(n,o)>=0});class B0{constructor(n,o,u,h,p,m){this.type=yr,this.number=n,this.locale=o,this.currency=u,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const u=o.parse(n[1],1,en);if(!u)return null;const h=n[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=o.parse(h.locale,1,yr),!p))return null;let m=null;if(h.currency&&(m=o.parse(h.currency,1,yr),!m))return null;let v=null;if(h.unit&&(v=o.parse(h.unit,1,yr),!v))return null;let w=null;if(h["min-fraction-digits"]&&(w=o.parse(h["min-fraction-digits"],1,en),!w))return null;let E=null;return h["max-fraction-digits"]&&(E=o.parse(h["max-fraction-digits"],1,en),!E)?null:new B0(u,p,m,v,w,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class j0{constructor(n){this.type=en,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const u=o.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${ki(u.type)} instead.`):new j0(u):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new ms(`Expected value to be of type string or array, but found ${ki(as(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(o=>{n.push(o.serialize())}),n}}function aw(i){return function(){i=1831565813+(i|=0)|0;let n=Math.imul(i^i>>>15,1|i);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const Pd={"==":DA,"!=":ow,">":zA,"<":LA,">=":FA,"<=":NA,array:oa,at:zg,boolean:oa,case:Fg,coalesce:dh,collator:pp,format:lh,image:dc,in:F0,"index-of":Mp,interpolate:ha,"interpolate-hcl":ha,"interpolate-lab":ha,length:j0,let:Lg,literal:Qa,match:Ng,number:oa,"number-format":B0,object:oa,slice:kp,step:Cd,string:oa,"to-boolean":fc,"to-color":fc,"to-number":fc,"to-string":fc,var:Ip,within:Al,distance:uh,config:lu};function lw(i,[n,o,u,h]){n=n.evaluate(i),o=o.evaluate(i),u=u.evaluate(i);const p=h?h.evaluate(i):1,m=Nb(n,o,u,p);if(m)throw new ms(m);return new Sr(n/255*p,o/255*p,u/255*p,p)}function BA(i,[n,o,u,h]){n=n.evaluate(i),o=o.evaluate(i),u=u.evaluate(i);const p=h?h.evaluate(i):1,m=function(E,C,P,k){return typeof E=="number"&&E>=0&&E<=360?typeof C=="number"&&C>=0&&C<=100&&typeof P=="number"&&P>=0&&P<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[E,C,P,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[E,C,P,k]:[E,C,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[E,C,P,k]:[E,C,P]).join(", ")}]: 'h' must be between 0 and 360.`}(n,o,u,p);if(m)throw new ms(m);const v=`hsla(${n}, ${o}%, ${u}%, ${p})`,w=Sr.parse(v);if(!w)throw new ms(`Failed to parse HSLA color: ${v}`);return w}function g(i,n){return i in n}function l(i,n){const o=n[i];return o===void 0?null:o}function f(i){return{type:i}}function y(i){return{result:"success",value:i}}function b(i){return{result:"error",value:i}}function T(i,n){return!!i&&!!i.parameters&&i.parameters.indexOf(n)>-1}function S(i){return i["property-type"]==="data-driven"}function A(i){return T(i.expression,"measure-light")}function O(i){return T(i.expression,"zoom")}function z(i){return!!i.expression&&i.expression.interpolated}function B(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function V(i){return i}function W(i,n){const o=n.type==="color",u=i.stops&&typeof i.stops[0][0]=="object",h=u||!(u||i.property!==void 0),p=i.type||(z(n)?"exponential":"interval");if(o&&((i=xd({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],Sr.parse(E[1])])),i.default=Sr.parse(i.default?i.default:n.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Rp[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let m,v,w;if(p==="exponential")m=ae;else if(p==="interval")m=oe;else if(p==="categorical"){m=se,v=Object.create(null);for(const E of i.stops)v[E[0]]=E[1];w=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=ce}if(u){const E={},C=[];for(let N=0;N<i.stops.length;N++){const j=i.stops[N],$=j[0].zoom;E[$]===void 0&&(E[$]={zoom:$,type:i.type,property:i.property,default:i.default,stops:[]},C.push($)),E[$].stops.push([j[0].value,j[1]])}const P=[];for(const N of C)P.push([E[N].zoom,W(E[N],n)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:ha.interpolationFactor.bind(void 0,k),zoomStops:P.map(N=>N[0]),evaluate:({zoom:N},j)=>ae({stops:P,base:i.base},n,N).evaluate(N,j)}}if(h){const E=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ha.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(i,n,C,v,w)}}return{kind:"source",evaluate(E,C){const P=C&&C.properties?C.properties[i.property]:void 0;return P===void 0?X(i.default,n.default):m(i,n,P,v,w)}}}function X(i,n,o){return i!==void 0?i:n!==void 0?n:o!==void 0?o:void 0}function se(i,n,o,u,h){return X(typeof o===h?u[o]:void 0,i.default,n.default)}function oe(i,n,o){if(su(o)!=="number")return X(i.default,n.default);const u=i.stops.length;if(u===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[u-1][0])return i.stops[u-1][1];const h=hh(i.stops.map(p=>p[0]),o);return i.stops[h][1]}function ae(i,n,o){const u=i.base!==void 0?i.base:1;if(su(o)!=="number")return X(i.default,n.default);const h=i.stops.length;if(h===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[h-1][0])return i.stops[h-1][1];const p=hh(i.stops.map(C=>C[0]),o),m=function(C,P,k,N){const j=N-k,$=C-k;return j===0?0:P===1?$/j:(Math.pow(P,$)-1)/(Math.pow(P,j)-1)}(o,u,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],w=i.stops[p+1][1];let E=hp[n.type]||V;if(i.colorSpace&&i.colorSpace!=="rgb"){const C=Rp[i.colorSpace];E=(P,k)=>C.reverse(C.interpolate(C.forward(P),C.forward(k),m))}return typeof v.evaluate=="function"?{evaluate(...C){const P=v.evaluate.apply(void 0,C),k=w.evaluate.apply(void 0,C);if(P!==void 0&&k!==void 0)return E(P,k,m)}}:E(v,w,m)}function ce(i,n,o){return n.type==="color"?o=Sr.parse(o):n.type==="formatted"?o=go.fromString(o.toString()):n.type==="resolvedImage"?o=sa.fromString(o.toString()):su(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),X(o,i.default,n.default)}Bo.register(Pd,{error:[{kind:"error"},[yr],(i,[n])=>{throw new ms(n.evaluate(i))}],typeof:[yr,[wr],(i,[n])=>ki(as(n.evaluate(i)))],"to-rgba":[to(en,4),[Ia],(i,[n])=>n.evaluate(i).toRenderColor(null).toArray()],rgb:[Ia,[en,en,en],lw],rgba:[Ia,[en,en,en,en],lw],hsl:[Ia,[en,en,en],BA],hsla:[Ia,[en,en,en,en],BA],has:{type:Cr,overloads:[[[yr],(i,[n])=>g(n.evaluate(i),i.properties())],[[yr,bd],(i,[n,o])=>g(n.evaluate(i),o.evaluate(i))]]},get:{type:wr,overloads:[[[yr],(i,[n])=>l(n.evaluate(i),i.properties())],[[yr,bd],(i,[n,o])=>l(n.evaluate(i),o.evaluate(i))]]},"feature-state":[wr,[yr],(i,[n])=>l(n.evaluate(i),i.featureState||{})],properties:[bd,[],i=>i.properties()],"geometry-type":[yr,[],i=>i.geometryType()],id:[wr,[],i=>i.id()],zoom:[en,[],i=>i.globals.zoom],pitch:[en,[],i=>i.globals.pitch||0],"distance-from-center":[en,[],i=>i.distanceFromCenter()],"measure-light":[en,[yr],(i,[n])=>i.measureLight(n.evaluate(i))],"heatmap-density":[en,[],i=>i.globals.heatmapDensity||0],"line-progress":[en,[],i=>i.globals.lineProgress||0],"raster-value":[en,[],i=>i.globals.rasterValue||0],"raster-particle-speed":[en,[],i=>i.globals.rasterParticleSpeed||0],"sky-radial-progress":[en,[],i=>i.globals.skyRadialProgress||0],accumulated:[wr,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[en,f(en),(i,n)=>{let o=0;for(const u of n)o+=u.evaluate(i);return o}],"*":[en,f(en),(i,n)=>{let o=1;for(const u of n)o*=u.evaluate(i);return o}],"-":{type:en,overloads:[[[en,en],(i,[n,o])=>n.evaluate(i)-o.evaluate(i)],[[en],(i,[n])=>-n.evaluate(i)]]},"/":[en,[en,en],(i,[n,o])=>n.evaluate(i)/o.evaluate(i)],"%":[en,[en,en],(i,[n,o])=>n.evaluate(i)%o.evaluate(i)],ln2:[en,[],()=>Math.LN2],pi:[en,[],()=>Math.PI],e:[en,[],()=>Math.E],"^":[en,[en,en],(i,[n,o])=>Math.pow(n.evaluate(i),o.evaluate(i))],sqrt:[en,[en],(i,[n])=>Math.sqrt(n.evaluate(i))],log10:[en,[en],(i,[n])=>Math.log(n.evaluate(i))/Math.LN10],ln:[en,[en],(i,[n])=>Math.log(n.evaluate(i))],log2:[en,[en],(i,[n])=>Math.log(n.evaluate(i))/Math.LN2],sin:[en,[en],(i,[n])=>Math.sin(n.evaluate(i))],cos:[en,[en],(i,[n])=>Math.cos(n.evaluate(i))],tan:[en,[en],(i,[n])=>Math.tan(n.evaluate(i))],asin:[en,[en],(i,[n])=>Math.asin(n.evaluate(i))],acos:[en,[en],(i,[n])=>Math.acos(n.evaluate(i))],atan:[en,[en],(i,[n])=>Math.atan(n.evaluate(i))],min:[en,f(en),(i,n)=>Math.min(...n.map(o=>o.evaluate(i)))],max:[en,f(en),(i,n)=>Math.max(...n.map(o=>o.evaluate(i)))],abs:[en,[en],(i,[n])=>Math.abs(n.evaluate(i))],round:[en,[en],(i,[n])=>{const o=n.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[en,[en],(i,[n])=>Math.floor(n.evaluate(i))],ceil:[en,[en],(i,[n])=>Math.ceil(n.evaluate(i))],"filter-==":[Cr,[yr,wr],(i,[n,o])=>i.properties()[n.value]===o.value],"filter-id-==":[Cr,[wr],(i,[n])=>i.id()===n.value],"filter-type-==":[Cr,[yr],(i,[n])=>i.geometryType()===n.value],"filter-<":[Cr,[yr,wr],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Cr,[wr],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o<u}],"filter->":[Cr,[yr,wr],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u>h}],"filter-id->":[Cr,[wr],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o>u}],"filter-<=":[Cr,[yr,wr],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Cr,[wr],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o<=u}],"filter->=":[Cr,[yr,wr],(i,[n,o])=>{const u=i.properties()[n.value],h=o.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Cr,[wr],(i,[n])=>{const o=i.id(),u=n.value;return typeof o==typeof u&&o>=u}],"filter-has":[Cr,[wr],(i,[n])=>n.value in i.properties()],"filter-has-id":[Cr,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Cr,[to(yr)],(i,[n])=>n.value.indexOf(i.geometryType())>=0],"filter-id-in":[Cr,[to(wr)],(i,[n])=>n.value.indexOf(i.id())>=0],"filter-in-small":[Cr,[yr,to(wr)],(i,[n,o])=>o.value.indexOf(i.properties()[n.value])>=0],"filter-in-large":[Cr,[yr,to(wr)],(i,[n,o])=>function(u,h,p,m){for(;p<=m;){const v=p+m>>1;if(h[v]===u)return!0;h[v]>u?m=v-1:p=v+1}return!1}(i.properties()[n.value],o.value,0,o.value.length-1)],all:{type:Cr,overloads:[[[Cr,Cr],(i,[n,o])=>n.evaluate(i)&&o.evaluate(i)],[f(Cr),(i,n)=>{for(const o of n)if(!o.evaluate(i))return!1;return!0}]]},any:{type:Cr,overloads:[[[Cr,Cr],(i,[n,o])=>n.evaluate(i)||o.evaluate(i)],[f(Cr),(i,n)=>{for(const o of n)if(o.evaluate(i))return!0;return!1}]]},"!":[Cr,[Cr],(i,[n])=>!n.evaluate(i)],"is-supported-script":[Cr,[yr],(i,[n])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(n.evaluate(i))}],upcase:[yr,[yr],(i,[n])=>n.evaluate(i).toUpperCase()],downcase:[yr,[yr],(i,[n])=>n.evaluate(i).toLowerCase()],concat:[yr,f(wr),(i,n)=>n.map(o=>Ka(o.evaluate(i))).join("")],"resolved-locale":[yr,[bg],(i,[n])=>n.evaluate(i).resolvedLocale()],random:[en,[en,en,wr],(i,n)=>{const[o,u,h]=n.map(m=>m.evaluate(i));if(o>u||o===u)return o;let p;if(typeof h=="string")p=function(m){let v=0;if(m.length===0)return v;for(let w=0;w<m.length;w++)v=(v<<5)-v+m.charCodeAt(w),v|=0;return v}(h);else{if(typeof h!="number")throw new ms(`Invalid seed input: ${h}`);p=h}return o+aw(p)()*(u-o)}]});class be{constructor(n,o,u,h){this.expression=n,this._warningHistory={},this._evaluator=new E0(u,h),this._defaultValue=o?function(p){return p.type==="color"&&(B(p.default)||Array.isArray(p.default))?new Sr(0,0,0,0):p.type==="color"?Sr.parse(p.default)||null:p.default===void 0?null:p.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(n,o,u,h,p,m,v,w){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,u,h,p,m,v,w){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new ms(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${E.message}`)),this._defaultValue}}}function we(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Pd}function ye(i,n,o,u){const h=new ew(Pd,[],n?function(m){const v={color:Ia,string:yr,number:en,enum:yr,boolean:Cr,formatted:wd,resolvedImage:ah};return m.type==="array"?to(v[m.value]||wr,m.length):v[m.type]}(n):void 0,void 0,void 0,o,u),p=h.parse(i,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?y(new be(p,n,o,u)):b(h.errors)}class Me{constructor(n,o,u){this.kind=n,this._styleExpression=o,this.isLightConstant=u,this.isStateDependent=n!=="constant"&&!kg(o.expression),this.configDependencies=Ep(o.expression)}evaluateWithoutErrorHandling(n,o,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,h,p,m)}evaluate(n,o,u,h,p,m){return this._styleExpression.evaluate(n,o,u,h,p,m)}}class Ie{constructor(n,o,u,h,p){this.kind=n,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!kg(o.expression),this.isLightConstant=p,this.configDependencies=Ep(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,o,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,h,p,m)}evaluate(n,o,u,h,p,m){return this._styleExpression.evaluate(n,o,u,h,p,m)}interpolationFactor(n,o,u){return this.interpolationType?ha.interpolationFactor(this.interpolationType,n,o,u):0}}function Ce(i,n,o,u){if((i=ye(i,n,o,u)).result==="error")return i;const h=i.value.expression,p=Tp(h);if(!p&&!S(n))return b([new Cl("","data expressions not supported")]);const m=Sp(h,["zoom","pitch","distance-from-center"]);if(!m&&!O(n))return b([new Cl("","zoom expressions not supported")]);const v=Sp(h,["measure-light"]);if(!v&&!A(n))return b([new Cl("","measure-light expression not supported")]);const w=n.expression&&n.expression.relaxZoomRestriction,E=Fe(h);return E||m||w?E instanceof Cl?b([E]):E instanceof ha&&!z(n)?b([new Cl("",'"interpolate" expressions cannot be used with this property')]):y(E?new Ie(p?"camera":"composite",i.value,E.labels,E instanceof ha?E.interpolation:void 0,v):new Me(p?"constant":"source",i.value,v)):b([new Cl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ne{constructor(n,o){this._parameters=n,this._specification=o,xd(this,W(this._parameters,this._specification))}static deserialize(n){return new Ne(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Fe(i){let n=null;if(i instanceof Lg)n=Fe(i.result);else if(i instanceof dh){for(const o of i.args)if(n=Fe(o),n)break}else(i instanceof Cd||i instanceof ha)&&i.input instanceof Bo&&i.input.name==="zoom"&&(n=i);return n instanceof Cl||i.eachChild(o=>{const u=Fe(o);u instanceof Cl?n=u:n&&u&&n!==u&&(n=new Cl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var We=Re,Be=3;function Re(i,n,o){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(n=h[1])+2*(o=h[2]);for(var p=0;p<this.d*this.d;p++){var m=h[Be+p],v=h[Be+p+1];u.push(m===v?null:h.subarray(m,v))}var w=h[Be+u.length+1];this.keys=h.subarray(h[Be+u.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*o;for(var E=0;E<this.d*this.d;E++)u.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=i,this.padding=o,this.scale=n/i,this.uid=0;var C=o/n*i;this.min=-C,this.max=i+C}Re.prototype.insert=function(i,n,o,u,h){this._forEachCell(n,o,u,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h)},Re.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Re.prototype._insertCell=function(i,n,o,u,h,p){this.cells[h].push(p)},Re.prototype.query=function(i,n,o,u,h){var p=this.min,m=this.max;if(i<=p&&n<=p&&m<=o&&m<=u&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,n,o,u,this._queryCell,v,{},h),v},Re.prototype._queryCell=function(i,n,o,u,h,p,m,v){var w=this.cells[h];if(w!==null)for(var E=this.keys,C=this.bboxes,P=0;P<w.length;P++){var k=w[P];if(m[k]===void 0){var N=4*k;(v?v(C[N+0],C[N+1],C[N+2],C[N+3]):i<=C[N+2]&&n<=C[N+3]&&o>=C[N+0]&&u>=C[N+1])?(m[k]=!0,p.push(E[k])):m[k]=!1}}},Re.prototype._forEachCell=function(i,n,o,u,h,p,m,v){for(var w=this._convertToCellCoord(i),E=this._convertToCellCoord(n),C=this._convertToCellCoord(o),P=this._convertToCellCoord(u),k=w;k<=C;k++)for(var N=E;N<=P;N++){var j=this.d*N+k;if((!v||v(this._convertFromCellCoord(k),this._convertFromCellCoord(N),this._convertFromCellCoord(k+1),this._convertFromCellCoord(N+1)))&&h.call(this,i,n,o,u,j,p,m,v))return}},Re.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Re.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Re.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,n=Be+this.cells.length+1+1,o=0,u=0;u<this.cells.length;u++)o+=this.cells[u].length;var h=new Int32Array(n+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=n,m=0;m<i.length;m++){var v=i[m];h[Be+m]=p,h.set(v,p),p+=v.length}return h[Be+i.length]=p,h.set(this.keys,p),h[Be+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var et=de(We);const Ye={};function Ve(i,n,o={}){Object.defineProperty(i,"_classRegistryKey",{value:n,writable:!1}),Ye[n]={klass:i,omit:o.omit||[]}}Ve(Object,"Object"),et.serialize=function(i,n){const o=i.toArrayBuffer();return n&&n.add(o),{buffer:o}},et.deserialize=function(i){return new et(i.buffer)},Object.defineProperty(et,"name",{value:"Grid"}),Ve(et,"Grid"),Ve(Sr,"Color"),Ve(Error,"Error"),Ve(go,"Formatted"),Ve(Tg,"FormattedSection"),Ve(gg,"AJAXError"),Ve(sa,"ResolvedImage"),Ve(Ne,"StylePropertyFunction"),Ve(be,"StyleExpression",{omit:["_evaluator"]}),Ve(Ie,"ZoomDependentExpression"),Ve(Me,"ZoomConstantExpression"),Ve(Bo,"CompoundExpression",{omit:["_evaluate"]});for(const i in Pd)Ye[Pd[i]._classRegistryKey]||Ve(Pd[i],`Expression${i}`);function Ct(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function _t(i){return self.ImageBitmap&&i instanceof ImageBitmap}function Ze(i,n){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Ct(i)||_t(i))return n&&n.add(i),i;if(ArrayBuffer.isView(i)){const o=i;return n&&n.add(o.buffer),o}if(i instanceof ImageData)return n&&n.add(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const u of i)o.push(Ze(u,n));return o}if(i instanceof Map){const o={$name:"Map"};for(const[u,h]of i.entries())o[u]=Ze(h);return o}if(i instanceof Set){const o={$name:"Set"};let u=0;for(const h of i.values())o[++u]=Ze(h);return o}if(typeof i=="object"){const o=i.constructor,u=o._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const h=o.serialize?o.serialize(i,n):{};if(!o.serialize){for(const p in i)i.hasOwnProperty(p)&&(Ye[u].omit.indexOf(p)>=0||(h[p]=Ze(i[p],n)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof i)}function ot(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Ct(i)||_t(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(ot);if(typeof i=="object"){const n=i.$name||"Object";if(n==="Map"){const h=new Map;for(const p of Object.keys(i))p!=="$name"&&h.set(p,ot(i[p]));return h}if(n==="Set"){const h=new Set;for(const p of Object.keys(i))p!=="$name"&&h.add(ot(i[p]));return h}const{klass:o}=Ye[n];if(!o)throw new Error(`can't deserialize unregistered class ${n}`);if(o.deserialize)return o.deserialize(i);const u=Object.create(o.prototype);for(const h of Object.keys(i))h!=="$name"&&(u[h]=ot(i[h]));return u}throw new Error("can't deserialize object of type "+typeof i)}const je={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519,"CJK Unified Ideographs Extension B":i=>i>=131072&&i<=173791};function yt(i){for(const n of i)if(Gt(n.charCodeAt(0)))return!0;return!1}function xt(i){for(const n of i)if(!$t(n.charCodeAt(0)))return!1;return!0}function $t(i){return!(je.Arabic(i)||je["Arabic Supplement"](i)||je["Arabic Extended-A"](i)||je["Arabic Presentation Forms-A"](i)||je["Arabic Presentation Forms-B"](i))}function Gt(i){return!(i!==746&&i!==747&&(i<4352||!(je["Bopomofo Extended"](i)||je.Bopomofo(i)||je["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||je["CJK Compatibility Ideographs"](i)||je["CJK Compatibility"](i)||je["CJK Radicals Supplement"](i)||je["CJK Strokes"](i)||!(!je["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||je["CJK Unified Ideographs Extension A"](i)||je["CJK Unified Ideographs"](i)||je["Enclosed CJK Letters and Months"](i)||je["Hangul Compatibility Jamo"](i)||je["Hangul Jamo Extended-A"](i)||je["Hangul Jamo Extended-B"](i)||je["Hangul Jamo"](i)||je["Hangul Syllables"](i)||je.Hiragana(i)||je["Ideographic Description Characters"](i)||je.Kanbun(i)||je["Kangxi Radicals"](i)||je["Katakana Phonetic Extensions"](i)||je.Katakana(i)&&i!==12540||!(!je["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!je["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||je["Unified Canadian Aboriginal Syllabics"](i)||je["Unified Canadian Aboriginal Syllabics Extended"](i)||je["Vertical Forms"](i)||je["Yijing Hexagram Symbols"](i)||je["Yi Syllables"](i)||je["Yi Radicals"](i))))}function sn(i){return!(Gt(i)||function(n){return!!(je["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||je["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||je["Letterlike Symbols"](n)||je["Number Forms"](n)||je["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||je["Control Pictures"](n)&&n!==9251||je["Optical Character Recognition"](n)||je["Enclosed Alphanumerics"](n)||je["Geometric Shapes"](n)||je["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||je["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||je["CJK Symbols and Punctuation"](n)||je.Katakana(n)||je["Private Use Area"](n)||je["CJK Compatibility Forms"](n)||je["Small Form Variants"](n)||je["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(i))}function Kt(i){return i>=1424&&i<=2303||je["Arabic Presentation Forms-A"](i)||je["Arabic Presentation Forms-B"](i)}function En(i,n){return!(!n&&Kt(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||je.Khmer(i))}function Un(i){for(const n of i)if(Kt(n.charCodeAt(0)))return!0;return!1}const In="deferred",Gn="loading",dr="loaded";let Xr=null,Nr="unavailable",mr=null;const zr=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(Nr="error"),Xr&&Xr(i)};function Zn(){Jn.fire(new Il("pluginStateChange",{pluginStatus:Nr,pluginURL:mr}))}const Jn=new oh,Vn=function(){return Nr},br=function(){if(Nr!==In||!mr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Nr=Gn,Zn(),mr&&nh({url:mr},i=>{i?zr(i):(Nr=dr,Zn())})},nr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Nr===dr||nr.applyArabicShaping!=null,isLoading:()=>Nr===Gn,setState(i){Nr=i.pluginStatus,mr=i.pluginURL},isParsed:()=>nr.applyArabicShaping!=null&&nr.processBidirectionalText!=null&&nr.processStyledBidirectionalText!=null,getPluginURL:()=>mr};class Rn{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch,this.brightness=o.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(o,u){for(const h of o)if(!En(h.charCodeAt(0),u))return!1;return!0}(n,nr.isLoaded())}}class Bi{constructor(n,o,u,h){this.property=n,this.value=o,this.expression=function(p,m,v,w){if(B(p))return new Ne(p,m);if(we(p)||Array.isArray(p)&&p.length>0){const E=Ce(p,m,v,w);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));return E.value}{let E=p;return typeof p=="string"&&m.type==="color"&&(E=Sr.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>E}}}(o===void 0?n.specification.default:o,n.specification,u,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,u){return this.property.possiblyEvaluate(this,n,o,u)}}class ji{constructor(n,o,u){this.property=n,this.value=new Bi(n,void 0,o,u)}transitioned(n,o){return new io(this.property,this.value,o,Is({},n.transition,this.transition),n.now)}untransitioned(){return new io(this.property,this.value,null,{},0)}}class ro{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return zs(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new ji(this._values[n].property,this._scope,this._options)),this._values[n].value=new Bi(this._values[n].property,o===null?void 0:zs(o),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,o){o&&(this._options=o);const u=this._properties.properties;if(n)for(const h in n){const p=n[h];if(Ha(h,"-transition")){const m=h.slice(0,-11);u[m]&&this.setTransition(m,p)}else u.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(n){return zs(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new ji(this._values[n].property)),this._values[n].transition=zs(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u);const h=this.getTransition(o);h!==void 0&&(n[`${o}-transition`]=h)}return n}transitioned(n,o){const u=new Gs(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(n,o._values[h]);return u}untransitioned(){const n=new Gs(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class io{constructor(n,o,u,h,p){const m=h.delay||0,v=h.duration||0;p=p||0,this.property=n,this.value=o,this.begin=p+m,this.end=this.begin+v,n.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(n,o,u){const h=n.now||0,p=this.value.possiblyEvaluate(n,o,u),m=this.prior;if(m){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return m.possiblyEvaluate(n,o,u);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(n,o,u),p,Yu(v))}}return p}}class Gs{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,u){const h=new Ws(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,o,u);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class so{constructor(n,o,u){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=o,this._options=u,this.configDependencies=new Set}getValue(n){return zs(this._values[n].value)}setValue(n,o){this._values[n]=new Bi(this._values[n].property,o===null?void 0:zs(o),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const o of Object.keys(this._values)){const u=this.getValue(o);u!==void 0&&(n[o]=u)}return n}possiblyEvaluate(n,o,u){const h=new Ws(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,o,u);return h}}class Ns{constructor(n,o,u){this.property=n,this.value=o,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,u,h){return this.property.evaluate(this.value,this.parameters,n,o,u,h)}}class Ws{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class kt{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,u){const h=hp[this.specification.type];return h?h(n,o,u):n}}class an{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,u,h){return new Ns(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},u,h)}:n.expression,o)}interpolate(n,o,u){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new Ns(this,{kind:"constant",value:void 0},n.parameters);const h=hp[this.specification.type];return h?new Ns(this,{kind:"constant",value:h(n.value.value,o.value.value,u)},n.parameters):n}evaluate(n,o,u,h,p,m){return n.kind==="constant"?n.value:n.evaluate(o,u,h,p,m)}}class _o{constructor(n){this.specification=n}possiblyEvaluate(n,o,u,h){return!!n.expression.evaluate(o,null,{},u,h)}interpolate(){return!1}}class Vr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new Rn(0,{});for(const u in n){const h=n[u];h.specification.overridable&&this.overridableProperties.push(u);const p=this.defaultPropertyValues[u]=new Bi(h,void 0),m=this.defaultTransitionablePropertyValues[u]=new ji(h);this.defaultTransitioningPropertyValues[u]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=p.possiblyEvaluate(o)}}}Ve(an,"DataDrivenProperty"),Ve(kt,"DataConstantProperty"),Ve(_o,"ColorRampProperty");var Je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-line-alignment":{"type":"enum","values":{"inside":1,"outside":1,"center":1},"default":"center","property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function gc(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ya(i){if(Array.isArray(i))return i.map(Ya);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const n={};for(const o in i)n[o]=Ya(i[o]);return n}return gc(i)}function _c(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const n of i.slice(1))if(!_c(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function yc(i,n="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};_c(i)||(i=Rd(i));const o=i;let u=!0;try{u=function(E){if(!uu(E))return E;let C=Ya(E);return Vg(C),C=Ug(C),C}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const h=Je[`filter_${n}`],p=ye(u,h);let m=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,C,P)=>p.value.evaluate(E,C,{},P);let v=null,w=null;if(u!==o){const E=ye(o,h);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));v=(C,P,k,N,j)=>E.value.evaluate(C,P,{},k,void 0,void 0,N,j),w=!Tp(E.value.expression)}return{filter:m,dynamicFilter:v||void 0,needGeometry:$g(u),needFeature:!!w}}function Ug(i){if(!Array.isArray(i))return i;const n=function(o){if(U0.has(o[0])){for(let u=1;u<o.length;u++)if(uu(o[u]))return!0}return o}(i);return n===!0?n:n.map(o=>Ug(o))}function Vg(i){let n=!1;const o=[];if(i[0]==="case"){for(let u=1;u<i.length-1;u+=2)n=n||uu(i[u]),o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="match"){n=n||uu(i[1]);for(let u=2;u<i.length-1;u+=2)o.push(i[u+1]);o.push(i[i.length-1])}else if(i[0]==="step"){n=n||uu(i[1]);for(let u=1;u<i.length-1;u+=2)o.push(i[u+1])}n&&(i.length=0,i.push("any",...o));for(let u=1;u<i.length;u++)Vg(i[u])}function uu(i){if(!Array.isArray(i))return!1;if((n=i[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<i.length;o++)if(uu(i[o]))return!0;return!1}const U0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fh(i,n){return i<n?-1:i>n?1:0}function $g(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let n=1;n<i.length;n++)if($g(i[n]))return!0;return!1}function Rd(i){if(!i)return!0;const n=i[0];return i.length<=1?n!=="any":n==="=="?jA(i[1],i[2],"=="):n==="!="?cw(jA(i[1],i[2],"==")):n==="<"||n===">"||n==="<="||n===">="?jA(i[1],i[2],n):n==="any"?(o=i.slice(1),["any"].concat(o.map(Rd))):n==="all"?["all"].concat(i.slice(1).map(Rd)):n==="none"?["all"].concat(i.slice(1).map(Rd).map(cw)):n==="in"?cL(i[1],i.slice(2)):n==="!in"?cw(cL(i[1],i.slice(2))):n==="has"?uL(i[1]):n!=="!has"||cw(uL(i[1]));var o}function jA(i,n,o){switch(i){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,i,n]}}function cL(i,n){if(n.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",i,["literal",n.sort(fh)]]:["filter-in-small",i,["literal",n]]}}function uL(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function cw(i){return["!",i]}const uw="";function hL(i,n){return n?`${i}${uw}${n}`:i}const dL="-transition",jX=new Set(["fill","line","background","hillshade","raster"]);class da extends oh{constructor(n,o,u,h,p){if(super(),this.id=n.id,this.fqid=hL(this.id,u),this.type=n.type,this.scope=u,this.lut=h,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),o.layout&&(this._unevaluatedLayout=new so(o.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),o.paint)){this._transitionablePaint=new ro(o.paint,this.scope,p);for(const m in n.paint)this.setPaintProperty(m,n.paint[m]);for(const m in n.layout)this.setLayoutProperty(m,n.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ws(o.paint)}}onAdd(n){}onRemove(n){}isDraped(n){return jX.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o){if(this.type==="custom"&&n==="visibility")return void(this.visibility=o);const u=this._unevaluatedLayout;u._properties.properties[n]&&(u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return Ha(n,dL)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o){const u=this._transitionablePaint,h=u._properties.properties;if(Ha(n,dL)){const P=n.slice(0,-11);return h[P]&&u.setTransition(P,o||void 0),!1}if(!h[n])return!1;const p=u._values[n],m=p.value.isDataDriven(),v=p.value;u.setValue(n,o),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const w=u._values[n].value,E=w.isDataDriven(),C=Ha(n,"pattern")||n==="line-dasharray";return E||m||C||this._handleOverridablePaintPropertyUpdate(n,v,w)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,o,u){return null}_handleOverridablePaintPropertyUpdate(n,o,u){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){return Cs({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof Ns&&S(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=yc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,o,u,h,p,m,v,w,E){}queryIntersectsMatchingFeature(n,o,u,h){}}const UX={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class V0{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class li{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Rr(i,n=1){let o=0,u=0;return{members:i.map(h=>{const p=UX[h.type].BYTES_PER_ELEMENT,m=o=fL(o,Math.max(n,p)),v=h.components||1;return u=Math.max(u,p),o+=p*v,{name:h.name,type:h.type,components:v,offset:m}}),size:fL(o,Math.max(u,n)),alignment:n}}function fL(i,n){return Math.ceil(i/n)*n}class vc extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const h=2*n;return this.int16[h+0]=o,this.int16[h+1]=u,n}}vc.prototype.bytesPerElement=4,Ve(vc,"StructArrayLayout2i4");class hw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u)}emplace(n,o,u,h){const p=3*n;return this.int16[p+0]=o,this.int16[p+1]=u,this.int16[p+2]=h,n}}hw.prototype.bytesPerElement=6,Ve(hw,"StructArrayLayout3i6");class ph extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=4*n;return this.int16[m+0]=o,this.int16[m+1]=u,this.int16[m+2]=h,this.int16[m+3]=p,n}}ph.prototype.bytesPerElement=8,Ve(ph,"StructArrayLayout4i8");class UA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=5*n;return this.int16[v+0]=o,this.int16[v+1]=u,this.int16[v+2]=h,this.int16[v+3]=p,this.int16[v+4]=m,n}}UA.prototype.bytesPerElement=10,Ve(UA,"StructArrayLayout5i10");class VA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=6*n,C=12*n,P=3*n;return this.int16[E+0]=o,this.int16[E+1]=u,this.uint8[C+4]=h,this.uint8[C+5]=p,this.uint8[C+6]=m,this.uint8[C+7]=v,this.float32[P+2]=w,n}}VA.prototype.bytesPerElement=12,Ve(VA,"StructArrayLayout2i4ub1f12");class Md extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=4*n;return this.float32[m+0]=o,this.float32[m+1]=u,this.float32[m+2]=h,this.float32[m+3]=p,n}}Md.prototype.bytesPerElement=16,Ve(Md,"StructArrayLayout4f16");class kd extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u)}emplace(n,o,u,h){const p=3*n;return this.float32[p+0]=o,this.float32[p+1]=u,this.float32[p+2]=h,n}}kd.prototype.bytesPerElement=12,Ve(kd,"StructArrayLayout3f12");class Od extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=6*n,w=3*n;return this.uint16[v+0]=o,this.uint16[v+1]=u,this.uint16[v+2]=h,this.uint16[v+3]=p,this.float32[w+2]=m,n}}Od.prototype.bytesPerElement=12,Ve(Od,"StructArrayLayout4ui1f12");class dw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=4*n;return this.uint16[m+0]=o,this.uint16[m+1]=u,this.uint16[m+2]=h,this.uint16[m+3]=p,n}}dw.prototype.bytesPerElement=8,Ve(dw,"StructArrayLayout4ui8");class fw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,h,p,m)}emplace(n,o,u,h,p,m,v){const w=6*n;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=h,this.int16[w+3]=p,this.int16[w+4]=m,this.int16[w+5]=v,n}}fw.prototype.bytesPerElement=12,Ve(fw,"StructArrayLayout6i12");class $A extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,k){const N=this.length;return this.resize(N+1),this.emplace(N,n,o,u,h,p,m,v,w,E,C,P,k)}emplace(n,o,u,h,p,m,v,w,E,C,P,k,N){const j=12*n;return this.int16[j+0]=o,this.int16[j+1]=u,this.int16[j+2]=h,this.int16[j+3]=p,this.uint16[j+4]=m,this.uint16[j+5]=v,this.uint16[j+6]=w,this.uint16[j+7]=E,this.int16[j+8]=C,this.int16[j+9]=P,this.int16[j+10]=k,this.int16[j+11]=N,n}}$A.prototype.bytesPerElement=24,Ve($A,"StructArrayLayout4i4ui4i24");class qA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,u,h,p,m)}emplace(n,o,u,h,p,m,v){const w=10*n,E=5*n;return this.int16[w+0]=o,this.int16[w+1]=u,this.int16[w+2]=h,this.float32[E+2]=p,this.float32[E+3]=m,this.float32[E+4]=v,n}}qA.prototype.bytesPerElement=20,Ve(qA,"StructArrayLayout3i3f20");class GA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}GA.prototype.bytesPerElement=4,Ve(GA,"StructArrayLayout1ul4");class Dd extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const h=2*n;return this.uint16[h+0]=o,this.uint16[h+1]=u,n}}Dd.prototype.bytesPerElement=4,Ve(Dd,"StructArrayLayout2ui4");class WA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,k,N){const j=this.length;return this.resize(j+1),this.emplace(j,n,o,u,h,p,m,v,w,E,C,P,k,N)}emplace(n,o,u,h,p,m,v,w,E,C,P,k,N,j){const $=20*n,q=10*n;return this.int16[$+0]=o,this.int16[$+1]=u,this.int16[$+2]=h,this.int16[$+3]=p,this.int16[$+4]=m,this.float32[q+3]=v,this.float32[q+4]=w,this.float32[q+5]=E,this.float32[q+6]=C,this.int16[$+14]=P,this.uint32[q+8]=k,this.uint16[$+18]=N,this.uint16[$+19]=j,n}}WA.prototype.bytesPerElement=40,Ve(WA,"StructArrayLayout5i4f1i1ul2ui40");class pw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=8*n;return this.int16[E+0]=o,this.int16[E+1]=u,this.int16[E+2]=h,this.int16[E+4]=p,this.int16[E+5]=m,this.int16[E+6]=v,this.int16[E+7]=w,n}}pw.prototype.bytesPerElement=16,Ve(pw,"StructArrayLayout3i2i2i16");class HA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=4*n,w=8*n;return this.float32[v+0]=o,this.float32[v+1]=u,this.float32[v+2]=h,this.int16[w+6]=p,this.int16[w+7]=m,n}}HA.prototype.bytesPerElement=16,Ve(HA,"StructArrayLayout2f1f2i16");class ZA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=12*n,v=3*n;return this.uint8[m+0]=o,this.uint8[m+1]=u,this.float32[v+1]=h,this.float32[v+2]=p,n}}ZA.prototype.bytesPerElement=12,Ve(ZA,"StructArrayLayout2ub2f12");class Fs extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,u)}emplace(n,o,u,h){const p=3*n;return this.uint16[p+0]=o,this.uint16[p+1]=u,this.uint16[p+2]=h,n}}Fs.prototype.bytesPerElement=6,Ve(Fs,"StructArrayLayout3ui6");class XA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q,te,pe,fe,me,Ae){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q,te,pe,fe,me,Ae)}emplace(n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q,te,pe,fe,me,Ae,Pe){const ze=30*n,$e=15*n,Xe=60*n;return this.int16[ze+0]=o,this.int16[ze+1]=u,this.int16[ze+2]=h,this.float32[$e+2]=p,this.float32[$e+3]=m,this.uint16[ze+8]=v,this.uint16[ze+9]=w,this.uint32[$e+5]=E,this.uint32[$e+6]=C,this.uint32[$e+7]=P,this.uint16[ze+16]=k,this.uint16[ze+17]=N,this.uint16[ze+18]=j,this.float32[$e+10]=$,this.float32[$e+11]=q,this.uint8[Xe+48]=te,this.uint8[Xe+49]=pe,this.uint8[Xe+50]=fe,this.uint32[$e+13]=me,this.int16[ze+28]=Ae,this.uint8[Xe+58]=Pe,n}}XA.prototype.bytesPerElement=60,Ve(XA,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class KA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q,te,pe,fe,me,Ae,Pe,ze,$e,Xe,rt,Qe,ut,At,ht,Ot,ct){const vt=this.length;return this.resize(vt+1),this.emplace(vt,n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q,te,pe,fe,me,Ae,Pe,ze,$e,Xe,rt,Qe,ut,At,ht,Ot,ct)}emplace(n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q,te,pe,fe,me,Ae,Pe,ze,$e,Xe,rt,Qe,ut,At,ht,Ot,ct,vt){const Nt=20*n,dt=40*n,Ut=80*n;return this.float32[Nt+0]=o,this.float32[Nt+1]=u,this.int16[dt+4]=h,this.int16[dt+5]=p,this.int16[dt+6]=m,this.int16[dt+7]=v,this.int16[dt+8]=w,this.int16[dt+9]=E,this.int16[dt+10]=C,this.int16[dt+11]=P,this.int16[dt+12]=k,this.uint16[dt+13]=N,this.uint16[dt+14]=j,this.uint16[dt+15]=$,this.uint16[dt+16]=q,this.uint16[dt+17]=te,this.uint16[dt+18]=pe,this.uint16[dt+19]=fe,this.uint16[dt+20]=me,this.uint16[dt+21]=Ae,this.uint16[dt+22]=Pe,this.uint16[dt+23]=ze,this.uint16[dt+24]=$e,this.uint16[dt+25]=Xe,this.uint16[dt+26]=rt,this.uint16[dt+27]=Qe,this.uint32[Nt+14]=ut,this.float32[Nt+15]=At,this.float32[Nt+16]=ht,this.float32[Nt+17]=Ot,this.float32[Nt+18]=ct,this.uint8[Ut+76]=vt,n}}KA.prototype.bytesPerElement=80,Ve(KA,"StructArrayLayout2f9i15ui1ul4f1ub80");class qg extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}qg.prototype.bytesPerElement=4,Ve(qg,"StructArrayLayout1f4");class Op extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,n,o,u,h,p)}emplace(n,o,u,h,p,m){const v=5*n;return this.float32[v+0]=o,this.float32[v+1]=u,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=m,n}}Op.prototype.bytesPerElement=20,Ve(Op,"StructArrayLayout5f20");class QA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=7*n;return this.float32[E+0]=o,this.float32[E+1]=u,this.float32[E+2]=h,this.float32[E+3]=p,this.float32[E+4]=m,this.float32[E+5]=v,this.float32[E+6]=w,n}}QA.prototype.bytesPerElement=28,Ve(QA,"StructArrayLayout7f28");class YA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,u,h)}emplace(n,o,u,h,p){const m=6*n;return this.uint32[3*n+0]=o,this.uint16[m+2]=u,this.uint16[m+3]=h,this.uint16[m+4]=p,n}}YA.prototype.bytesPerElement=12,Ve(YA,"StructArrayLayout1ul3ui12");class $0 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}$0.prototype.bytesPerElement=2,Ve($0,"StructArrayLayout1ui2");class q0 extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const u=this.length;return this.resize(u+1),this.emplace(u,n,o)}emplace(n,o,u){const h=2*n;return this.float32[h+0]=o,this.float32[h+1]=u,n}}q0.prototype.bytesPerElement=8,Ve(q0,"StructArrayLayout2f8");class JA extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q){const te=this.length;return this.resize(te+1),this.emplace(te,n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q)}emplace(n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q,te){const pe=16*n;return this.float32[pe+0]=o,this.float32[pe+1]=u,this.float32[pe+2]=h,this.float32[pe+3]=p,this.float32[pe+4]=m,this.float32[pe+5]=v,this.float32[pe+6]=w,this.float32[pe+7]=E,this.float32[pe+8]=C,this.float32[pe+9]=P,this.float32[pe+10]=k,this.float32[pe+11]=N,this.float32[pe+12]=j,this.float32[pe+13]=$,this.float32[pe+14]=q,this.float32[pe+15]=te,n}}JA.prototype.bytesPerElement=64,Ve(JA,"StructArrayLayout16f64");class mw extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,u,h,p,m,v){const w=this.length;return this.resize(w+1),this.emplace(w,n,o,u,h,p,m,v)}emplace(n,o,u,h,p,m,v,w){const E=10*n,C=5*n;return this.uint16[E+0]=o,this.uint16[E+1]=u,this.uint16[E+2]=h,this.uint16[E+3]=p,this.float32[C+2]=m,this.float32[C+3]=v,this.float32[C+4]=w,n}}mw.prototype.bytesPerElement=20,Ve(mw,"StructArrayLayout4ui3f20");class eP extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.int16[1*n+0]=o,n}}eP.prototype.bytesPerElement=2,Ve(eP,"StructArrayLayout1i2");class tP extends li{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint8[1*n+0]=o,n}}tP.prototype.bytesPerElement=1,Ve(tP,"StructArrayLayout1ub1");class pL extends V0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}pL.prototype.size=40;class nP extends WA{get(n){return new pL(this,n)}}Ve(nP,"CollisionBoxArray");class mL extends V0{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}mL.prototype.size=60;class gL extends XA{get(n){return new mL(this,n)}}Ve(gL,"PlacedSymbolArray");class _L extends V0{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}_L.prototype.size=80;class yL extends KA{get(n){return new _L(this,n)}}Ve(yL,"SymbolInstanceArray");class vL extends qg{getoffsetX(n){return this.float32[1*n+0]}}Ve(vL,"GlyphOffsetArray");class xL extends vc{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Ve(xL,"SymbolLineVertexArray");class bL extends V0{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bL.prototype.size=12;class wL extends YA{get(n){return new bL(this,n)}}Ve(wL,"FeatureIndexArray");class TL extends Dd{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Ve(TL,"FillExtrusionCentroidArray");class EL extends V0{get a_join_normal_inside_polygon0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside_polygon1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside_polygon2(){return this._structArray.int16[this._pos2+2]}get a_join_normal_inside_polygon3(){return this._structArray.int16[this._pos2+3]}}EL.prototype.size=8;class SL extends ph{get(n){return new EL(this,n)}}Ve(SL,"FillExtrusionWallArray");const VX=Rr([{name:"a_pos",components:2,type:"Int16"}],4),$X=Rr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class gi{constructor(n=[]){this.segments=n}_prepareSegment(n,o,u,h){let p=this.segments[this.segments.length-1];return n>gi.MAX_VERTEX_ARRAY_LENGTH&&bi(`Max vertices per segment is ${gi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!p||p.vertexLength+n>gi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:o,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(n,o,u,h){return this._prepareSegment(n,o.length,u.length,h)}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,u,h){return new gi([{vertexOffset:n,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function IL(i,n){return 256*(i=Hn(Math.floor(i),0,255))+Hn(Math.floor(n),0,255)}gi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ve(gi,"SegmentVector");const qX=Rr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),GX=Rr([{name:"a_dash",components:4,type:"Uint16"}]);class G0{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,o,u,h){this.ids.push(CL(n)),this.positions.push(o,u,h)}eachPosition(n,o){const u=CL(n);let h=0,p=this.ids.length-1;for(;h<p;){const m=h+p>>1;this.ids[m]>=u?p=m:h=m+1}for(;this.ids[h]===u;)o(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(n,o){const u=new Float64Array(n.ids),h=new Uint32Array(n.positions);return rP(u,h,0,u.length-1),o&&(o.add(u.buffer),o.add(h.buffer)),{ids:u,positions:h}}static deserialize(n){const o=new G0;let u;o.ids=n.ids,o.positions=n.positions;for(const h of o.ids)h!==u&&o.uniqueIds.push(h),u=h;return o.indexed=!0,o}}function CL(i){const n=+i;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:_g(String(i))}function rP(i,n,o,u){for(;o<u;){const h=i[o+u>>1];let p=o-1,m=u+1;for(;;){do p++;while(i[p]<h);do m--;while(i[m]>h);if(p>=m)break;gw(i,p,m),gw(n,3*p,3*m),gw(n,3*p+1,3*m+1),gw(n,3*p+2,3*m+2)}m-o<u-m?(rP(i,n,o,m),o=m+1):(rP(i,n,m+1,u),u=m)}}function gw(i,n,o){const u=i[n];i[n]=i[o],i[o]=u}Ve(G0,"FeaturePositionMap");class mh{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}set(n,o,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class _w extends mh{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class jo extends mh{constructor(n){super(n),this.current=0}set(n,o,u){this.fetchUniformLocation(n,o)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class gh extends mh{constructor(n){super(n),this.current=[0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class iP extends mh{constructor(n){super(n),this.current=[0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class sP extends mh{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,u){this.fetchUniformLocation(n,o)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class AL extends mh{constructor(n){super(n),this.current=Sr.transparent.toRenderColor(null)}set(n,o,u){this.fetchUniformLocation(n,o)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const WX=new Float32Array(16);class W0 extends mh{constructor(n){super(n),this.current=WX}set(n,o,u){if(this.fetchUniformLocation(n,o)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const HX=new Float32Array(9),ZX=new Float32Array(4);class oP extends mh{constructor(n){super(n),this.current=ZX}set(n,o,u){if(this.fetchUniformLocation(n,o)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function aP(i){return[IL(255*i.r,255*i.g),IL(255*i.b,255*i.a)]}class H0{constructor(n,o,u,h){this.value=n,this.uniformNames=o.map(p=>`u_${p}`),this.type=u,this.context=h}setUniform(n,o,u,h,p){const m=h.constantOr(this.value);o.set(n,p,m instanceof Sr?m.toRenderColor(this.context.lut):m)}getBinding(n,o){return this.type==="color"?new AL(n):new jo(n)}}class Gg{constructor(n,o){this.uniformNames=o.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,o,u,h,p){const m=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;m&&o.set(n,p,m)}getBinding(n,o){return o==="u_pattern"||o==="u_dash"?new sP(n):new jo(n)}}class _h{constructor(n,o,u,h){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(p=>({name:`a_${p}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,o,u,h,p,m,v){const w=this.paintVertexArray.length,E=this.expression.evaluate(new Rn(0,{brightness:m}),o,{},p,h,v);this.paintVertexArray.resize(n),this._setPaintValue(w,n,E,this.context)}updatePaintArray(n,o,u,h,p,m,v){const w=this.expression.evaluate({zoom:0,brightness:v},u,h,void 0,p);this._setPaintValue(n,o,w,this.context)}_setPaintValue(n,o,u,h){if(this.type==="color"){const p=aP(u.toRenderColor(h.lut));for(let m=n;m<o;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=n;p<o;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xc{constructor(n,o,u,h,p,m){this.expression=n,this.uniformNames=o.map(v=>`u_${v}_t`),this.type=u,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=o.map(v=>({name:`a_${v}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(n,o,u,h,p,m,v){const w=this.expression.evaluate(new Rn(this.context.zoom,{brightness:m}),o,{},p,h,v),E=this.expression.evaluate(new Rn(this.context.zoom+1,{brightness:m}),o,{},p,h,v),C=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(C,n,w,E,this.context)}updatePaintArray(n,o,u,h,p,m,v){const w=this.expression.evaluate({zoom:this.context.zoom,brightness:v},u,h,void 0,p),E=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v},u,h,void 0,p);this._setPaintValue(n,o,w,E,this.context)}_setPaintValue(n,o,u,h,p){if(this.type==="color"){const m=aP(u.toRenderColor(p.lut)),v=aP(u.toRenderColor(p.lut));for(let w=n;w<o;w++)this.paintVertexArray.emplace(w,m[0],m[1],v[0],v[1])}else{for(let m=n;m<o;m++)this.paintVertexArray.emplace(m,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,u,h,p){const m=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=Hn(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);o.set(n,p,v)}getBinding(n,o){return new jo(n)}}class Ld{constructor(n,o,u,h,p){this.expression=n,this.layerId=p,this.paintVertexAttributes=(u==="array"?GX:qX).members;for(let m=0;m<o.length;++m);this.paintVertexArray=new h}populatePaintArray(n,o,u,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(p,n,o.patterns&&o.patterns[this.layerId],u)}updatePaintArray(n,o,u,h,p,m,v){this._setPaintValues(n,o,u.patterns&&u.patterns[this.layerId],m)}_setPaintValues(n,o,u,h){if(!h||!u)return;const p=h[u];if(!p)return;const{tl:m,br:v,pixelRatio:w}=p;for(let E=n;E<o;E++)this.paintVertexArray.emplace(E,m[0],m[1],v[0],v[1],w)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Dp{constructor(n,o,u=()=>!0){this.binders={},this._buffers=[],this.context=o;const h=[];for(const p in n.paint._values){const m=n.paint.get(p);if(!u(p)||!(m instanceof Ns&&S(m.property.specification)))continue;const v=KX(p,n.type),w=m.value,E=m.property.specification.type,C=!!m.property.useIntegerZoom,P=p==="line-dasharray"||p.endsWith("pattern"),k=p==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||k)if(w.kind==="source"||k||P){const N=PL(p,E,"source");this.binders[p]=P?new Ld(w,v,E,N,n.id):new _h(w,v,E,N),h.push(`/a_${p}`)}else{const N=PL(p,E,"composite");this.binders[p]=new xc(w,v,E,C,o,N),h.push(`/z_${p}`)}else this.binders[p]=P?new Gg(w.value,v):new H0(w.value,v,E,o),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof _h||o instanceof xc?o.maxValue:0}populatePaintArrays(n,o,u,h,p,m,v){for(const w in this.binders){const E=this.binders[w];E.context=this.context,(E instanceof _h||E instanceof xc||E instanceof Ld)&&E.populatePaintArray(n,o,u,h,p,m,v)}}setConstantPatternPositions(n){for(const o in this.binders){const u=this.binders[o];u instanceof Gg&&u.setConstantPatternPositions(n)}}updatePaintArrays(n,o,u,h,p,m,v,w){let E=!1;const C=Object.keys(n),P=C.length!==0,k=P?C:o.uniqueIds;this.context.lut=p.lut;for(const N in this.binders){const j=this.binders[N];if(j.context=this.context,(j instanceof _h||j instanceof xc||j instanceof Ld)&&(j.expression.isStateDependent===!0||j.expression.isLightConstant===!1)){const $=p.paint.get(N);j.expression=$.value;for(const q of k){const te=n[q.toString()];o.eachPosition(q,(pe,fe,me)=>{const Ae=h.feature(pe);j.updatePaintArray(fe,me,Ae,te,m,v,w)})}if(!P)for(const q of u.uniqueIds){const te=n[q.toString()];u.eachPosition(q,(pe,fe,me)=>{const Ae=h.feature(pe);j.updatePaintArray(fe,me,Ae,te,m,v,w)})}E=!0}}return E}defines(){const n=[];for(const o in this.binders){const u=this.binders[o];(u instanceof H0||u instanceof Gg)&&n.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof _h||u instanceof xc||u instanceof Ld)for(let h=0;h<u.paintVertexAttributes.length;h++)n.push(u.paintVertexAttributes[h].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const u=this.binders[o];if(u instanceof H0||u instanceof Gg||u instanceof xc)for(const h of u.uniformNames)n.push(h)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof H0||h instanceof Gg||h instanceof xc)for(const p of h.uniformNames)o.push({name:p,property:u,binding:h.getBinding(n,p)})}return o}setUniforms(n,o,u,h,p){for(const{name:m,property:v,binding:w}of u)this.binders[v].setUniform(n,w,p,h.get(v),m)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof _h||o instanceof xc||o instanceof Ld)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(n){for(const o in this.binders){const u=this.binders[o];(u instanceof _h||u instanceof xc||u instanceof Ld)&&u.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof _h||o instanceof xc||o instanceof Ld)&&o.destroy()}}}class zd{constructor(n,o,u=()=>!0){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new Dp(h,o,u);this.needsUpload=!1,this._featureMap=new G0,this._featureMapWithoutIds=new G0,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,o,u,h,p,m,v,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(n,o,h,p,m,v,w);o.id!==void 0?this._featureMap.add(o.id,u,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,u,h,p,m){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,o,v,h,p,m||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const XX={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function KX(i,n){return XX[i]||[i.replace(`${n}-`,"").replace(/-/g,"_")]}const QX={"line-pattern":{source:Od,composite:Od},"fill-pattern":{source:Od,composite:Od},"fill-extrusion-pattern":{source:Od,composite:Od},"line-dasharray":{source:dw,composite:dw}},YX={color:{source:q0,composite:Md},number:{source:qg,composite:q0}};function PL(i,n,o){const u=QX[i];return u&&u[o]||YX[n][o]}Ve(H0,"ConstantBinder"),Ve(Gg,"PatternConstantBinder"),Ve(_h,"SourceExpressionBinder"),Ve(Ld,"PatternCompositeBinder"),Ve(xc,"CompositeExpressionBinder"),Ve(Dp,"ProgramConfiguration",{omit:["_buffers"]}),Ve(zd,"ProgramConfigurationSet");const Uo=Ft/Math.PI/2,lP=5,RL=6,JX=16383,Wg=64,cP=[Wg,32,16],Pl=-Uo,Rl=Uo;function Hg(i,n,o,u=Uo){return o=tr(o),[i*Math.sin(o)*u,-n*u,i*Math.cos(o)*u]}function Lp(i,n,o){return Hg(Math.cos(tr(i)),Math.sin(tr(i)),n,o)}const Zg=63710088e-1,uP=2*Math.PI*Zg;class Tr{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Tr(sc(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,u=this.lat*o,h=n.lat*o,p=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((n.lng-this.lng)*o);return Zg*Math.acos(Math.min(p,1))}toBounds(n=0){const o=360*n/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Nd({lng:this.lng-u,lat:this.lat-o},{lng:this.lng+u,lat:this.lat+o})}toEcef(n){return Lp(this.lat,this.lng,Uo+n*Uo/Zg)}static convert(n){if(n instanceof Tr)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Tr(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Tr(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Nd{constructor(n,o){if(n)if(o)this.setSouthWest(n).setNorthEast(o);else if(n.length===4){const u=n;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=n;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(n){return this._ne=n instanceof Tr?new Tr(n.lng,n.lat):Tr.convert(n),this}setSouthWest(n){return this._sw=n instanceof Tr?new Tr(n.lng,n.lat):Tr.convert(n),this}extend(n){const o=this._sw,u=this._ne;let h,p;if(n instanceof Tr)h=n,p=n;else{if(!(n instanceof Nd))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Nd.convert(n)):this.extend(Tr.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(Tr.convert(n)):this;if(h=n._sw,p=n._ne,!h||!p)return this}return o||u?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new Tr(h.lng,h.lat),this._ne=new Tr(p.lng,p.lat)),this}getCenter(){return new Tr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Tr(this.getWest(),this.getNorth())}getSouthEast(){return new Tr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:u}=Tr.convert(n);let h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(n){return!n||n instanceof Nd?n:new Nd(n)}}var ML={};(function(i,n){(function(o){function u(p,m,v){var w=h(256*p,256*(m=Math.pow(2,v)-m-1),v),E=h(256*(p+1),256*(m+1),v);return w[0]+","+w[1]+","+E[0]+","+E[1]}function h(p,m,v){var w=2*Math.PI*6378137/256/Math.pow(2,v);return[p*w-2*Math.PI*6378137/2,m*w-2*Math.PI*6378137/2]}o.getURL=function(p,m,v,w,E,C){return C=C||{},p+"?"+["bbox="+u(v,w,E),"format="+(C.format||"image/png"),"service="+(C.service||"WMS"),"version="+(C.version||"1.1.1"),"request="+(C.request||"GetMap"),"srs="+(C.srs||"EPSG:3857"),"width="+(C.width||256),"height="+(C.height||256),"layers="+m].join("&")},o.getTileBBox=u,o.getMercCoords=h,Object.defineProperty(o,"__esModule",{value:!0})})(n)})(0,ML);var eK=ML;class zp{constructor(n,o,u){this.z=n,this.x=o,this.y=u,this.key=Xg(0,n,n,o,u)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o){const u=eK.getTileBBox(this.x,this.y,this.z),h=function(p,m,v){let w,E="";for(let C=p;C>0;C--)w=1<<C-1,E+=(m&w?1:0)+(v&w?2:0);return E}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kL{constructor(n,o){this.wrap=n,this.canonical=o,this.key=Xg(n,o.z,o.z,o.x,o.y)}}class gs{constructor(n,o,u,h,p){this.overscaledZ=n,this.wrap=o,this.canonical=new zp(u,+h,+p),this.key=o===0&&n===u?this.canonical.key:Xg(o,n,u,h,p)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new gs(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new gs(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return Xg(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-n;return Xg(this.wrap*+o,n,n,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new gs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new gs(o,this.wrap,o,u,h),new gs(o,this.wrap,o,u+1,h),new gs(o,this.wrap,o,u,h+1),new gs(o,this.wrap,o,u+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new gs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new gs(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kL(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Xg(i,n,o,u,h){const p=1<<Math.min(o,22);let m=p*(h%p)+u%p;return i&&o<22&&(m+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-o)))),16*(32*m+o)+(n-o)}const tK=[i=>{let n=i.canonical.x-1,o=i.wrap;return n<0&&(n=(1<<i.canonical.z)-1,o--),new gs(i.overscaledZ,o,i.canonical.z,n,i.canonical.y)},i=>{let n=i.canonical.x+1,o=i.wrap;return n===1<<i.canonical.z&&(n=0,o++),new gs(i.overscaledZ,o,i.canonical.z,n,i.canonical.y)},i=>new gs(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,(i.canonical.y===0?1<<i.canonical.z:i.canonical.y)-1),i=>new gs(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y===(1<<i.canonical.z)-1?0:i.canonical.y+1)];Ve(zp,"CanonicalTileID"),Ve(gs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const nK=0,rK=25.5;function hP(i){return uP*Math.cos(i*Math.PI/180)}function hu(i){return(180+i)/360}function du(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Vo(i,n){return i/hP(n)}function fa(i){return 360*i-180}function Hs(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function OL(i,n){return i*hP(Hs(n))}const Ui=85.051129;function DL(i){return Math.cos(tr(Hn(i,-Ui,Ui)))}function Np(i,n){const o=Hn(n,nK,rK),u=Math.pow(2,o);return DL(i)*uP/(512*u)}function LL(i){return 1/Math.cos(i*Math.PI/180)}function yw(i,n=0){const o=Math.exp(Math.PI*(1-(i.y+n/Ft)/(1<<i.z)*2));return 80150034*o/(o*o+1)/Ft/(1<<i.z)}class yo{constructor(n,o,u=0){this.x=+n,this.y=+o,this.z=+u}static fromLngLat(n,o=0){const u=Tr.convert(n);return new yo(hu(u.lng),du(u.lat),Vo(o,u.lat))}toLngLat(){return new Tr(fa(this.x),Hs(this.y))}toAltitude(){return OL(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/uP*LL(Hs(this.y))}}function dP(i,n,o,u,h,p,m,v,w){const E=(n+u)/2,C=(o+h)/2,P=new jt(E,C);v(P),function(k,N,j,$,q,te){const pe=j-q,fe=$-te;return Math.abs(($-N)*pe-(j-k)*fe)/Math.hypot(pe,fe)}(P.x,P.y,p.x,p.y,m.x,m.y)>=w?(dP(i,n,o,E,C,p,P,v,w),dP(i,E,C,u,h,P,m,v,w)):i.push(m)}function zL(i,n,o){let u=i[0],h=u.x,p=u.y;n(u);const m=[u];for(let v=1;v<i.length;v++){const w=i[v],{x:E,y:C}=w;n(w),dP(m,h,p,E,C,u,w,n,o),h=E,p=C,u=w}return m}function fP(i,n,o,u){if(u(n,o)){const h=n.add(o)._mult(.5);fP(i,n,h,u),fP(i,h,o,u)}else i.push(o)}function iK(i,n){let o=i[0];const u=[o];for(let h=1;h<i.length;h++){const p=i[h];fP(u,o,p,n),o=p}return u}const pP=Math.pow(2,14)-1,NL=-pP-1;function sK(i,n){const o=Math.round(i.x*n),u=Math.round(i.y*n);return i.x=Hn(o,NL,pP),i.y=Hn(u,NL,pP),(o<i.x||o>i.x+1||u<i.y||u>i.y+1)&&bi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function bc(i,n,o){const u=i.loadGeometry(),h=i.extent,p=Ft/h;if(n&&o&&o.projection.isReprojectedInTileSpace){const m=1<<n.z,{scale:v,x:w,y:E,projection:C}=o,P=k=>{const N=fa((n.x+k.x/h)/m),j=Hs((n.y+k.y/h)/m),$=C.project(N,j);k.x=($.x*v-w)*h,k.y=($.y*v-E)*h};for(let k=0;k<u.length;k++)if(i.type!==1)u[k]=zL(u[k],P,1);else{const N=[];for(const j of u[k])j.x<0||j.x>=h||j.y<0||j.y>=h||(P(j),N.push(j));u[k]=N}}for(const m of u)for(const v of m)sK(v,p);return u}function yh(i,n){return{type:i.type,id:i.id,properties:i.properties,geometry:n?bc(i):[]}}function vw(i,n,o,u,h){i.emplaceBack(2*n+(u+1)/2,2*o+(h+1)/2)}function xw(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class mP{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new vc,this.indexArray=new Fs,this.segments=new gi,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}updateFootprints(n,o){}populate(n,o,u,h){const p=this.layers[0],m=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:P,sourceLayerIndex:k}of n){const N=this.layers[0]._featureFilter.needGeometry,j=yh(E,N);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),j,u))continue;const $=v?v.evaluate(j,{},u):void 0,q={id:C,properties:E.properties,type:E.type,sourceLayerIndex:k,index:P,geometry:N?j.geometry:bc(E,u,h),patterns:{},sortKey:$};m.push(q)}v&&m.sort((E,C)=>E.sortKey-C.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new fw,w=h.projection);for(const E of m){const{geometry:C,index:P,sourceLayerIndex:k}=E,N=n[P].feature;this.addFeature(E,C,P,o.availableImages,u,w,o.brightness),o.featureIndex.insert(N,C,P,k,this.index)}}update(n,o,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,u,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,VX.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,$X.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,o,u,h,p,m,v){for(const w of o)for(const E of w){const C=E.x,P=E.y;if(C<0||C>=Ft||P<0||P>=Ft)continue;if(m){const j=m.projectTilePoint(C,P,p),$=m.upVector(p,C,P),q=this.globeExtVertexArray;xw(q,j,$),xw(q,j,$),xw(q,j,$),xw(q,j,$)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),N=k.vertexLength;vw(this.layoutVertexArray,C,P,-1,-1),vw(this.layoutVertexArray,C,P,1,-1),vw(this.layoutVertexArray,C,P,1,1),vw(this.layoutVertexArray,C,P,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+2,N+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},h,p,v)}}function gP(i,n){for(let o=0;o<i.length;o++)if(Fd(n,i[o]))return!0;for(let o=0;o<n.length;o++)if(Fd(i,n[o]))return!0;return!!_P(i,n)}function oK(i,n,o){return!!Fd(i,n)||!!yP(n,i,o)}function FL(i,n){if(i.length===1)return jL(n,i[0]);for(let o=0;o<n.length;o++){const u=n[o];for(let h=0;h<u.length;h++)if(Fd(i,u[h]))return!0}for(let o=0;o<i.length;o++)if(jL(n,i[o]))return!0;for(let o=0;o<n.length;o++)if(_P(i,n[o]))return!0;return!1}function aK(i,n,o){if(i.length>1){if(_P(i,n))return!0;for(let u=0;u<n.length;u++)if(yP(n[u],i,o))return!0}for(let u=0;u<i.length;u++)if(yP(i[u],n,o))return!0;return!1}function _P(i,n){if(i.length===0||n.length===0)return!1;for(let o=0;o<i.length-1;o++){const u=i[o],h=i[o+1];for(let p=0;p<n.length-1;p++)if(lK(u,h,n[p],n[p+1]))return!0}return!1}function lK(i,n,o,u){return ra(i,o,u)!==ra(n,o,u)&&ra(i,n,o)!==ra(i,n,u)}function yP(i,n,o){const u=o*o;if(n.length===1)return i.distSqr(n[0])<u;for(let h=1;h<n.length;h++)if(BL(i,n[h-1],n[h])<u)return!0;return!1}function BL(i,n,o){const u=n.distSqr(o);if(u===0)return i.distSqr(n);const h=((i.x-n.x)*(o.x-n.x)+(i.y-n.y)*(o.y-n.y))/u;return i.distSqr(h<0?n:h>1?o:o.sub(n)._mult(h)._add(n))}function jL(i,n){let o,u,h,p=!1;for(let m=0;m<i.length;m++){o=i[m];for(let v=0,w=o.length-1;v<o.length;w=v++)u=o[v],h=o[w],u.y>n.y!=h.y>n.y&&n.x<(h.x-u.x)*(n.y-u.y)/(h.y-u.y)+u.x&&(p=!p)}return p}function Fd(i,n){let o=!1;for(let u=0,h=i.length-1;u<i.length;h=u++){const p=i[u],m=i[h];p.y>n.y!=m.y>n.y&&n.x<(m.x-p.x)*(n.y-p.y)/(m.y-p.y)+p.x&&(o=!o)}return o}function UL(i,n,o,u,h){for(const m of i)if(n<=m.x&&o<=m.y&&u>=m.x&&h>=m.y)return!0;const p=[new jt(n,o),new jt(n,h),new jt(u,h),new jt(u,o)];if(i.length>2){for(const m of p)if(Fd(i,m))return!0}for(let m=0;m<i.length-1;m++)if(cK(i[m],i[m+1],p))return!0;return!1}function cK(i,n,o){const u=o[0],h=o[2];if(i.x<u.x&&n.x<u.x||i.x>h.x&&n.x>h.x||i.y<u.y&&n.y<u.y||i.y>h.y&&n.y>h.y)return!1;const p=ra(i,n,o[0]);return p!==ra(i,n,o[1])||p!==ra(i,n,o[2])||p!==ra(i,n,o[3])}function Kg(i,n,o,u,h,p){let m=n.y-i.y,v=i.x-n.x;if(p=p||0){const w=m*m+v*v;if(w===0)return!0;const E=Math.sqrt(w);m/=E,v/=E}return!((o.x-i.x)*m+(o.y-i.y)*v-p<0||(u.x-i.x)*m+(u.y-i.y)*v-p<0||(h.x-i.x)*m+(h.y-i.y)*v-p<0)}function vP(i,n,o,u,h,p,m){return!(Kg(i,n,u,h,p,m)||Kg(n,o,u,h,p,m)||Kg(o,i,u,h,p,m)||Kg(u,h,i,n,o,m)||Kg(h,p,i,n,o,m)||Kg(p,u,i,n,o,m))}function Qg(i,n,o){const u=n.paint.get(i).value;return u.kind==="constant"?u.value:o.programConfigurations.get(n.id).getMaxValue(i)}function bw(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function VL(i,n,o,u,h){if(!n[0]&&!n[1])return i;const p=jt.convert(n)._mult(h);o==="viewport"&&p._rotate(-u);const m=[];for(let v=0;v<i.length;v++)m.push(i[v].sub(p));return m}function $L(i,n,o,u){const h=jt.convert(i)._mult(u);return n==="viewport"&&h._rotate(-o),h}let qL,GL;Ve(mP,"CircleBucket",{omit:["layers"]});class xP{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,u){const h=a.$.dot(o,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/h;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,u[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(n,o,u){if(a.$.equals(this.pos,n)||o===0)return u[0]=u[1]=u[2]=0,!1;const[h,p,m]=this.dir,v=this.pos[0]-n[0],w=this.pos[1]-n[1],E=this.pos[2]-n[2],C=h*h+p*p+m*m,P=2*(v*h+w*p+E*m),k=P*P-4*C*(v*v+w*w+E*E-o*o);if(k<0){const N=Math.max(-P/2,0),j=v+h*N,$=w+p*N,q=E+m*N,te=Math.hypot(j,$,q);return u[0]=j*o/te,u[1]=$*o/te,u[2]=q*o/te,!1}{const N=(-P-Math.sqrt(k))/(2*C);if(N<0){const j=Math.hypot(v,w,E);return u[0]=v*o/j,u[1]=w*o/j,u[2]=E*o/j,!1}return u[0]=v+h*N,u[1]=w+p*N,u[2]=E+m*N,!0}}}class bP{constructor(n,o,u,h,p){this.TL=n,this.TR=o,this.BR=u,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(n,o,u){const h=[-1,1,1],p=[1,1,1],m=[1,-1,1],v=[-1,-1,1],w=a.$.transformMat4(h,h,n),E=a.$.transformMat4(p,p,n),C=a.$.transformMat4(m,m,n),P=a.$.transformMat4(v,v,n);return new bP(w,E,C,P,o/u)}}function Z0(i,n,o){let u=1/0,h=-1/0;const p=[];for(const m of i){a.$.sub(p,m,n);const v=a.$.dot(p,o);u=Math.min(u,v),h=Math.max(h,v)}return[u,h]}function WL(i,n){let o=!0;for(let u=0;u<i.planes.length;u++){const h=i.planes[u];let p=0;for(let m=0;m<n.length;m++)p+=a.$.dot(h,n[m])+h[3]>=0;if(p===0)return 0;p!==n.length&&(o=!1)}return o?2:1}function HL(i,n){for(const o of i.projections){const u=Z0(n,i.points[0],o.axis);if(o.projection[1]<u[0]||o.projection[0]>u[1])return 0}return 1}function ZL(i,n){let o=0;const u=[0,0,0,0];for(let h=0;h<i.length;h++)u[0]=i[h][0],u[1]=i[h][1],u[2]=i[h][2],u[3]=1,a.aB.dot(u,n)>=0&&o++;return o}class wP{constructor(n,o){this.points=n||new Array(8).fill([0,0,0]),this.planes=o||new Array(6).fill([0,0,0,0]),this.bounds=ci.fromPoints(this.points),this.projections=[],this.frustumEdges=[a.$.sub([],this.points[2],this.points[3]),a.$.sub([],this.points[0],this.points[3]),a.$.sub([],this.points[4],this.points[0]),a.$.sub([],this.points[5],this.points[1]),a.$.sub([],this.points[6],this.points[2]),a.$.sub([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],p=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Z0(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:Z0(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(n,o,u,h){const p=Math.pow(2,u),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const C=a.aB.transformMat4([],E,n),P=1/C[3]/o*p;return a.aB.mul(C,C,[P,P,h?1/C[3]:P,P])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const C=a.$.sub([],m[E[0]],m[E[1]]),P=a.$.sub([],m[E[2]],m[E[1]]),k=a.$.normalize([],a.$.cross([],C,P)),N=-a.$.dot(k,m[E[1]]);return k.concat(N)}),w=[];for(let E=0;E<m.length;E++)w.push([m[E][0],m[E][1],m[E][2]]);return new wP(w,v)}intersectsPrecise(n,o,u){for(let h=0;h<o.length;h++)if(!ZL(n,o[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!ZL(n,this.planes[h]))return 0;for(const h of u)for(const p of this.frustumEdges){const m=a.$.cross([],h,p),v=a.$.length(m);if(v===0)continue;a.$.scale(m,m,1/v);const w=Z0(this.points,this.points[0],m),E=Z0(n,this.points[0],m);if(w[0]>E[1]||E[0]>w[1])return 0}return 1}containsPoint(n){for(const o of this.planes){const u=o[3];if(a.$.dot([o[0],o[1],o[2]],n)+u<0)return!1}return!0}}class ci{static fromPoints(n){const o=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of n)a.$.min(o,o,h),a.$.max(u,u,h);return new ci(o,u)}static fromTileIdAndHeight(n,o,u){const h=1<<n.canonical.z,p=n.canonical.x,m=n.canonical.y;return new ci([p/h,m/h,o],[(p+1)/h,(m+1)/h,u])}static applyTransform(n,o){const u=n.getCorners();for(let h=0;h<u.length;++h)a.$.transformMat4(u[h],u[h],o);return ci.fromPoints(u)}static applyTransformFast(n,o){const u=[o[12],o[13],o[14]],h=[...u];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const v=o[4*m+p],w=v*n.min[m],E=v*n.max[m];u[p]+=Math.min(w,E),h[p]+=Math.max(w,E)}return new ci(u,h)}static projectAabbCorners(n,o){const u=n.getCorners();for(let h=0;h<u.length;++h)a.$.transformMat4(u[h],u[h],o);return u}constructor(n,o){this.min=n,this.max=o,this.center=a.$.scale([],a.$.add([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],u=a.$.clone(this.min),h=a.$.clone(this.max);for(let p=0;p<o.length;p++)u[p]=o[p]?this.min[p]:this.center[p],h[p]=o[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new ci(u,h)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?WL(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?WL(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,o){return o||this.intersects(n)?HL(n,this.getCorners()):0}intersectsPreciseFlat(n,o){return o||this.intersectsFlat(n)?HL(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let o=0;o<3;++o)if(this.min[o]>n.max[o]||n.min[o]>this.max[o])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n.min[o]),this.max[o]=Math.max(this.max[o],n.max[o])}encapsulatePoint(n){for(let o=0;o<3;o++)this.min[o]=Math.min(this.min[o],n[o]),this.max[o]=Math.max(this.max[o],n[o])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}Ve(ci,"Aabb");const uK=Rr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ww}=uK,XL=Rr([{name:"a_pos_3",components:3,type:"Int16"}]);var X0=Rr([{name:"a_pos",type:"Int16",components:2}]);function Tw(i){return i*Uo/Zg}const hK=[new ci([Pl,Pl,Pl],[Rl,Rl,Rl]),new ci([Pl,Pl,Pl],[0,0,Rl]),new ci([0,Pl,Pl],[Rl,0,Rl]),new ci([Pl,0,Pl],[0,Rl,Rl]),new ci([0,0,Pl],[Rl,Rl,Rl])];function KL(i,n,o,u=!0){const h=a.$.scale([],i._camera.position,i.worldSize),p=[n,o,1,1];a.aB.transformMat4(p,p,i.pixelMatrixInverse),a.aB.scale(p,p,1/p[3]);const m=a.$.sub([],p,h),v=a.$.normalize([],m),w=i.globeMatrix,E=[w[12],w[13],w[14]],C=a.$.sub([],E,h),P=a.$.length(C),k=a.$.normalize([],C),N=i.worldSize/(2*Math.PI),j=a.$.dot(k,v),$=Math.asin(N/P);if($<Math.acos(j)){if(!u)return null;const Qe=[],ut=[];a.$.scale(Qe,v,P/j),a.$.normalize(ut,a.$.sub(ut,Qe,C)),a.$.normalize(v,a.$.add(v,C,a.$.scale(v,ut,Math.tan($)*P)))}const q=[];new xP(h,v).closestPointOnSphere(E,N,q);const te=a.$.normalize([],R(w,0)),pe=a.$.normalize([],R(w,1)),fe=a.$.normalize([],R(w,2)),me=a.$.dot(te,q),Ae=a.$.dot(pe,q),Pe=a.$.dot(fe,q),ze=eo(Math.asin(-Ae/N));let $e=eo(Math.atan2(me,Pe));$e=i.center.lng+function(Qe,ut){const At=(ut-Qe+180)%360-180;return At<-180?At+360:At}(i.center.lng,$e);const Xe=hu($e),rt=Hn(du(ze),0,1);return new yo(Xe,rt)}class dK{constructor(n,o,u){this.a=a.$.sub([],n,u),this.b=a.$.sub([],o,u),this.center=u;const h=a.$.normalize([],this.a),p=a.$.normalize([],this.b);this.angle=Math.acos(a.$.dot(h,p))}}function TP(i,n){if(i.angle===0)return null;let o;return o=i.a[n]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[n]/i.a[n]/Math.sin(i.angle)-1/Math.tan(i.angle)),o<0||o>1?null:function(u,h,p,m){const v=Math.sin(p);return u*(Math.sin((1-m)*p)/v)+h*(Math.sin(m*p)/v)}(i.a[n],i.b[n],i.angle,Hn(o,0,1))+i.center[n]}function fu(i){if(i.z<=1)return hK[i.z+2*i.y+i.x];const n=EP(Ew(i));return ci.fromPoints(n)}function vh(i,n,o){return a.$.scale(i,i,1-o),a.$.scaleAndAdd(i,i,n,o)}function QL(i,n){const o=xh(n.zoom);if(o===0)return fu(i);const u=Ew(i),h=EP(u),p=hu(u.getWest())*n.worldSize,m=hu(u.getEast())*n.worldSize,v=du(u.getNorth())*n.worldSize,w=du(u.getSouth())*n.worldSize,E=[p,v,0],C=[m,v,0],P=[p,w,0],k=[m,w,0],N=a.ae.invert([],n.globeMatrix);return a.$.transformMat4(E,E,N),a.$.transformMat4(C,C,N),a.$.transformMat4(P,P,N),a.$.transformMat4(k,k,N),h[0]=vh(h[0],P,o),h[1]=vh(h[1],k,o),h[2]=vh(h[2],C,o),h[3]=vh(h[3],E,o),ci.fromPoints(h)}function YL(i,n,o){for(const u of i)a.$.transformMat4(u,u,n),a.$.scale(u,u,o)}function JL(i,n,o,u){const h=n/i.worldSize,p=i.globeMatrix;if(o.z<=1){const Xe=fu(o).getCorners();return YL(Xe,p,h),ci.fromPoints(Xe)}const m=Ew(o,u),v=EP(m,Uo+Tw(i._tileCoverLift));YL(v,p,h);const w=Number.MAX_VALUE,E=[-w,-w,-w],C=[w,w,w];if(m.contains(i.center)){for(const Qe of v)a.$.min(C,C,Qe),a.$.max(E,E,Qe);E[2]=0;const Xe=i.point,rt=[Xe.x*h,Xe.y*h,0];return a.$.min(C,C,rt),a.$.max(E,E,rt),new ci(C,E)}if(i._tileCoverLift>0){for(const Xe of v)a.$.min(C,C,Xe),a.$.max(E,E,Xe);return new ci(C,E)}const P=[p[12]*h,p[13]*h,p[14]*h],k=m.getCenter(),N=Hn(i.center.lat,-Ui,Ui),j=Hn(k.lat,-Ui,Ui),$=hu(i.center.lng),q=du(N);let te=$-hu(k.lng);const pe=q-du(j);te>.5?te-=1:te<-.5&&(te+=1);let fe=0;if(Math.abs(te)>Math.abs(pe))fe=te>=0?1:3;else{fe=pe>=0?0:2;const Xe=[p[4]*h,p[5]*h,p[6]*h],rt=-Math.sin(tr(pe>=0?m.getSouth():m.getNorth()))*Uo;a.$.scaleAndAdd(P,P,Xe,rt)}const me=v[fe],Ae=v[(fe+1)%4],Pe=new dK(me,Ae,P),ze=[TP(Pe,0)||me[0],TP(Pe,1)||me[1],TP(Pe,2)||me[2]],$e=xh(i.zoom);if($e>0){const Xe=function({x:Qe,y:ut,z:At},ht,Ot,ct,vt){const Nt=1/(1<<At);let dt=Qe*Nt,Ut=dt+Nt,Lt=ut*Nt,Rt=Lt+Nt,bn=0;const fn=(dt+Ut)/2-ct;return fn>.5?bn=-1:fn<-.5&&(bn=1),dt=((dt+bn)*ht-(ct*=ht))*Ot+ct,Ut=((Ut+bn)*ht-ct)*Ot+ct,Lt=(Lt*ht-(vt*=ht))*Ot+vt,Rt=(Rt*ht-vt)*Ot+vt,[[dt,Rt,0],[Ut,Rt,0],[Ut,Lt,0],[dt,Lt,0]]}(o,n,i._pixelsPerMercatorPixel,$,q);for(let Qe=0;Qe<v.length;Qe++)vh(v[Qe],Xe[Qe],$e);const rt=a.$.add([],Xe[fe],Xe[(fe+1)%4]);a.$.scale(rt,rt,.5),vh(ze,rt,$e)}for(const Xe of v)a.$.min(C,C,Xe),a.$.max(E,E,Xe);return C[2]=Math.min(me[2],Ae[2]),a.$.min(C,C,ze),a.$.max(E,E,ze),new ci(C,E)}function Ew({x:i,y:n,z:o},u=!1){const h=1/(1<<o),p=new Tr(fa(i*h),n===(1<<o)-1&&u?-90:Hs((n+1)*h)),m=new Tr(fa((i+1)*h),n===0&&u?90:Hs(n*h));return new Nd(p,m)}function EP(i,n=Uo){const o=tr(i.getNorth()),u=tr(i.getSouth()),h=Math.cos(o),p=Math.cos(u),m=Math.sin(o),v=Math.sin(u),w=i.getWest(),E=i.getEast();return[Hg(p,v,w,n),Hg(p,v,E,n),Hg(h,m,E,n),Hg(h,m,w,n)]}function K0(i,n,o,u){const h=1<<o.z,p=(i/Ft+o.x)/h;return Lp(Hs((n/Ft+o.y)/h),fa(p),u)}function Sw({min:i,max:n}){return JX/Math.max(n[0]-i[0],n[1]-i[1],n[2]-i[2])}const ez=new Float64Array(16);function Q0(i){const n=Sw(i),o=a.ae.fromScaling(ez,[n,n,n]);return a.ae.translate(o,o,a.$.negate([],i.min))}function SP(i){const n=a.ae.fromTranslation(ez,i.min),o=1/Sw(i);return a.ae.scale(n,n,[o,o,o])}function IP(i){const n=Ft/(2*Math.PI);return i/(2*Math.PI)/n}function tz(i,n){return Ft/(512*Math.pow(2,i))*Sw(fu(n))}function nz(i,n,o,u,h){const p=IP(o),m=[i,n,-o/(2*Math.PI)],v=a.ae.identity(new Float64Array(16));return a.ae.translate(v,v,m),a.ae.scale(v,v,[p,p,p]),a.ae.rotateX(v,v,tr(-h)),a.ae.rotateY(v,v,tr(-u)),v}function xh(i){return na(lP,RL,i)}function rz(i,n){const o=Lp(n.lat,n.lng),u=function(p){const m=Lp(p._center.lat,p._center.lng),v=a.$.fromValues(0,1,0);let w=a.$.cross([],v,m);const E=a.ae.fromRotation([],-p.angle,m);w=a.$.transformMat4(w,w,E),a.ae.fromRotation(E,-p._pitch,w);const C=a.$.normalize([],m);return a.$.scale(C,C,Tw(p.cameraToCenterDistance/p.pixelsPerMeter)),a.$.transformMat4(C,C,E),a.$.add([],m,C)}(i),h=a.$.subtract([],u,o);return a.$.angle(h,o)}function CP(i,n){return rz(i,n)>Math.PI/2*1.01}const iz=tr(85),fK=Math.cos(iz),pK=Math.sin(iz),mK=a.ae.create(),sz=i=>{const n=[];return i.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),i.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function oz(i,n,o,u,h,p,m,v,w){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(w*=i.pixelToTileUnitsFactor);const E=i.tileID.canonical,C=o.projection.upVectorScale(E,o.center.lat,o.worldSize).metersToTile;for(const P of n)for(const k of P){const N=k.add(v),j=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(N.x,N.y,!0):0,$=o.projection.projectTilePoint(N.x,N.y,E);if(j>0){const fe=o.projection.upVector(E,N.x,N.y);$.x+=fe[0]*C*j,$.y+=fe[1]*C*j,$.z+=fe[2]*C*j}const q=p?N:gK($.x,$.y,$.z,u),te=p?i.tilespaceRays.map(fe=>yK(fe,j)):i.queryGeometry.screenGeometry,pe=a.aB.transformMat4([],[$.x,$.y,$.z,1],u);if(!m&&p?w*=pe[3]/o.cameraToCenterDistance:m&&!p&&(w*=o.cameraToCenterDistance/pe[3]),p){const fe=Hs((k.y/Ft+E.y)/(1<<E.z));w/=o.projection.pixelsPerMeter(fe,1)/Vo(1,fe)}if(oK(te,q,w))return!0}return!1}function gK(i,n,o,u){const h=a.aB.transformMat4([],[i,n,o,1],u);return new jt(h[0]/h[3],h[1]/h[3])}const az=a.$.fromValues(0,0,0),_K=a.$.fromValues(0,0,1);function yK(i,n){const o=a.$.create();return az[2]=n,i.intersectsPlane(az,_K,o),new jt(o[0],o[1])}class lz extends mP{}function cz(i,{width:n,height:o},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*o*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*o*u);return i.width=n,i.height=o,i.data=h,i}function uz(i,n,o){const{width:u,height:h}=n;u===i.width&&h===i.height||(AP(i,n,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,u),height:Math.min(i.height,h)},o,null),i.width=u,i.height=h,i.data=n.data)}function AP(i,n,o,u,h,p,m,v){if(h.width===0||h.height===0)return n;if(h.width>i.width||h.height>i.height||o.x>i.width-h.width||o.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||u.x>n.width-h.width||u.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const w=i.data,E=n.data,C=p===4&&v;for(let P=0;P<h.height;P++){const k=((o.y+P)*i.width+o.x)*p,N=((u.y+P)*n.width+u.x)*p;if(C)for(let j=0;j<h.width;j++){const $=k+j*p+3,q=N+j*p;E[q+0]=255,E[q+1]=255,E[q+2]=255,E[q+3]=w[$]}else if(m)for(let j=0;j<h.width;j++){const $=k+j*p,q=N+j*p,te=w[$+3],pe=new Sr(w[$+0]/255*te,w[$+1]/255*te,w[$+2]/255*te,te).toRenderColor(m).toArray();E[q+0]=pe[0],E[q+1]=pe[1],E[q+2]=pe[2],E[q+3]=pe[3]}else for(let j=0;j<h.width*p;j++)E[N+j]=w[k+j]}return n}Ve(lz,"HeatmapBucket",{omit:["layers"]});class Bd{constructor(n,o){cz(this,n,1,o)}resize(n){uz(this,new Bd(n),1)}clone(){return new Bd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,h,p){AP(n,o,u,h,p,1,null)}}class Ja{constructor(n,o){cz(this,n,4,o)}resize(n){uz(this,new Ja(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ja({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,u,h,p,m,v){AP(n,o,u,h,p,4,m,v)}}class hz{constructor(n,o){this.width=n.width,this.height=n.height,this.data=o instanceof Uint8Array?new Float32Array(o.buffer):o}}let dz,fz,pz,mz;function Y0(i){const n={},o=i.resolution||256,u=i.clips?i.clips.length:1,h=i.image||new Ja({width:o,height:u}),p=(m,v,w)=>{n[i.evaluationKey]=w;const E=i.expression.evaluate(n);E&&(h.data[m+v+0]=Math.floor(255*E.r/E.a),h.data[m+v+1]=Math.floor(255*E.g/E.a),h.data[m+v+2]=Math.floor(255*E.b/E.a),h.data[m+v+3]=Math.floor(255*E.a))};if(i.clips)for(let m=0,v=0;m<u;++m,v+=4*o)for(let w=0,E=0;w<o;w++,E+=4){const C=w/(o-1),{start:P,end:k}=i.clips[m];p(v,E,P*(1-C)+k*C)}else for(let m=0,v=0;m<o;m++,v+=4)p(0,v,m/(o-1));return h}Ve(Bd,"AlphaImage"),Ve(Ja,"RGBAImage");const vK=Rr([{name:"a_pos",components:2,type:"Int16"}],4),{members:xK}=vK;function J0(i,n,o=2){const u=n&&n.length,h=u?n[0]*o:i.length;let p=gz(i,0,h,o,!0);const m=[];if(!p||p.next===p.prev)return m;let v,w,E;if(u&&(p=function(C,P,k,N){const j=[];for(let $=0,q=P.length;$<q;$++){const te=gz(C,P[$]*N,$<q-1?P[$+1]*N:C.length,N,!1);te===te.next&&(te.steiner=!0),j.push(AK(te))}j.sort(SK);for(let $=0;$<j.length;$++)k=IK(j[$],k);return k}(i,n,p,o)),i.length>80*o){v=1/0,w=1/0;let C=-1/0,P=-1/0;for(let k=o;k<h;k+=o){const N=i[k],j=i[k+1];N<v&&(v=N),j<w&&(w=j),N>C&&(C=N),j>P&&(P=j)}E=Math.max(C-v,P-w),E=E!==0?32767/E:0}return ev(p,m,o,v,w,E,0),m}function gz(i,n,o,u,h){let p;if(h===function(m,v,w,E){let C=0;for(let P=v,k=w-E;P<w;P+=E)C+=(m[k]-m[P])*(m[P+1]+m[k+1]),k=P;return C}(i,n,o,u)>0)for(let m=n;m<o;m+=u)p=vz(m/u|0,i[m],i[m+1],p);else for(let m=o-u;m>=n;m-=u)p=vz(m/u|0,i[m],i[m+1],p);return p&&Iw(p,p.next)&&(nv(p),p=p.next),p}function Fp(i,n){if(!i)return i;n||(n=i);let o,u=i;do if(o=!1,u.steiner||!Iw(u,u.next)&&_s(u.prev,u,u.next)!==0)u=u.next;else{if(nv(u),u=n=u.prev,u===u.next)break;o=!0}while(o||u!==n);return n}function ev(i,n,o,u,h,p,m){if(!i)return;!m&&p&&function(w,E,C,P){let k=w;do k.z===0&&(k.z=PP(k.x,k.y,E,C,P)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==w);k.prevZ.nextZ=null,k.prevZ=null,function(N){let j,$=1;do{let q,te=N;N=null;let pe=null;for(j=0;te;){j++;let fe=te,me=0;for(let Pe=0;Pe<$&&(me++,fe=fe.nextZ,fe);Pe++);let Ae=$;for(;me>0||Ae>0&&fe;)me!==0&&(Ae===0||!fe||te.z<=fe.z)?(q=te,te=te.nextZ,me--):(q=fe,fe=fe.nextZ,Ae--),pe?pe.nextZ=q:N=q,q.prevZ=pe,pe=q;te=fe}pe.nextZ=null,$*=2}while(j>1)}(k)}(i,u,h,p);let v=i;for(;i.prev!==i.next;){const w=i.prev,E=i.next;if(p?wK(i,u,h,p):bK(i))n.push(w.i,i.i,E.i),nv(i),i=E.next,v=E.next;else if((i=E)===v){m?m===1?ev(i=TK(Fp(i),n),n,o,u,h,p,2):m===2&&EK(i,n,o,u,h,p):ev(Fp(i),n,o,u,h,p,1);break}}}function bK(i){const n=i.prev,o=i,u=i.next;if(_s(n,o,u)>=0)return!1;const h=n.x,p=o.x,m=u.x,v=n.y,w=o.y,E=u.y,C=h<p?h<m?h:m:p<m?p:m,P=v<w?v<E?v:E:w<E?w:E,k=h>p?h>m?h:m:p>m?p:m,N=v>w?v>E?v:E:w>E?w:E;let j=u.next;for(;j!==n;){if(j.x>=C&&j.x<=k&&j.y>=P&&j.y<=N&&Yg(h,v,p,w,m,E,j.x,j.y)&&_s(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function wK(i,n,o,u){const h=i.prev,p=i,m=i.next;if(_s(h,p,m)>=0)return!1;const v=h.x,w=p.x,E=m.x,C=h.y,P=p.y,k=m.y,N=v<w?v<E?v:E:w<E?w:E,j=C<P?C<k?C:k:P<k?P:k,$=v>w?v>E?v:E:w>E?w:E,q=C>P?C>k?C:k:P>k?P:k,te=PP(N,j,n,o,u),pe=PP($,q,n,o,u);let fe=i.prevZ,me=i.nextZ;for(;fe&&fe.z>=te&&me&&me.z<=pe;){if(fe.x>=N&&fe.x<=$&&fe.y>=j&&fe.y<=q&&fe!==h&&fe!==m&&Yg(v,C,w,P,E,k,fe.x,fe.y)&&_s(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,me.x>=N&&me.x<=$&&me.y>=j&&me.y<=q&&me!==h&&me!==m&&Yg(v,C,w,P,E,k,me.x,me.y)&&_s(me.prev,me,me.next)>=0))return!1;me=me.nextZ}for(;fe&&fe.z>=te;){if(fe.x>=N&&fe.x<=$&&fe.y>=j&&fe.y<=q&&fe!==h&&fe!==m&&Yg(v,C,w,P,E,k,fe.x,fe.y)&&_s(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;me&&me.z<=pe;){if(me.x>=N&&me.x<=$&&me.y>=j&&me.y<=q&&me!==h&&me!==m&&Yg(v,C,w,P,E,k,me.x,me.y)&&_s(me.prev,me,me.next)>=0)return!1;me=me.nextZ}return!0}function TK(i,n){let o=i;do{const u=o.prev,h=o.next.next;!Iw(u,h)&&_z(u,o,o.next,h)&&tv(u,h)&&tv(h,u)&&(n.push(u.i,o.i,h.i),nv(o),nv(o.next),o=i=h),o=o.next}while(o!==i);return Fp(o)}function EK(i,n,o,u,h,p){let m=i;do{let v=m.next.next;for(;v!==m.prev;){if(m.i!==v.i&&PK(m,v)){let w=yz(m,v);return m=Fp(m,m.next),w=Fp(w,w.next),ev(m,n,o,u,h,p,0),void ev(w,n,o,u,h,p,0)}v=v.next}m=m.next}while(m!==i)}function SK(i,n){return i.x-n.x}function IK(i,n){const o=function(h,p){let m=p;const v=h.x,w=h.y;let E,C=-1/0;do{if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){const $=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if($<=v&&$>C&&(C=$,E=m.x<m.next.x?m:m.next,$===v))return E}m=m.next}while(m!==p);if(!E)return null;const P=E,k=E.x,N=E.y;let j=1/0;m=E;do{if(v>=m.x&&m.x>=k&&v!==m.x&&Yg(w<N?v:C,w,k,N,w<N?C:v,w,m.x,m.y)){const $=Math.abs(w-m.y)/(v-m.x);tv(m,h)&&($<j||$===j&&(m.x>E.x||m.x===E.x&&CK(E,m)))&&(E=m,j=$)}m=m.next}while(m!==P);return E}(i,n);if(!o)return n;const u=yz(o,i);return Fp(u,u.next),Fp(o,o.next)}function CK(i,n){return _s(i.prev,i,n.prev)<0&&_s(n.next,i,i.next)<0}function PP(i,n,o,u,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-o)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-u)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function AK(i){let n=i,o=i;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==i);return o}function Yg(i,n,o,u,h,p,m,v){return(h-m)*(n-v)>=(i-m)*(p-v)&&(i-m)*(u-v)>=(o-m)*(n-v)&&(o-m)*(p-v)>=(h-m)*(u-v)}function PK(i,n){return i.next.i!==n.i&&i.prev.i!==n.i&&!function(o,u){let h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==u.i&&h.next.i!==u.i&&_z(h,h.next,o,u))return!0;h=h.next}while(h!==o);return!1}(i,n)&&(tv(i,n)&&tv(n,i)&&function(o,u){let h=o,p=!1;const m=(o.x+u.x)/2,v=(o.y+u.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&m<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==o);return p}(i,n)&&(_s(i.prev,i,n.prev)||_s(i,n.prev,n))||Iw(i,n)&&_s(i.prev,i,i.next)>0&&_s(n.prev,n,n.next)>0)}function _s(i,n,o){return(n.y-i.y)*(o.x-n.x)-(n.x-i.x)*(o.y-n.y)}function Iw(i,n){return i.x===n.x&&i.y===n.y}function _z(i,n,o,u){const h=Aw(_s(i,n,o)),p=Aw(_s(i,n,u)),m=Aw(_s(o,u,i)),v=Aw(_s(o,u,n));return h!==p&&m!==v||!(h!==0||!Cw(i,o,n))||!(p!==0||!Cw(i,u,n))||!(m!==0||!Cw(o,i,u))||!(v!==0||!Cw(o,n,u))}function Cw(i,n,o){return n.x<=Math.max(i.x,o.x)&&n.x>=Math.min(i.x,o.x)&&n.y<=Math.max(i.y,o.y)&&n.y>=Math.min(i.y,o.y)}function Aw(i){return i>0?1:i<0?-1:0}function tv(i,n){return _s(i.prev,i,i.next)<0?_s(i,n,i.next)>=0&&_s(i,i.prev,n)>=0:_s(i,n,i.prev)<0||_s(i,i.next,n)<0}function yz(i,n){const o=RP(i.i,i.x,i.y),u=RP(n.i,n.x,n.y),h=i.next,p=n.prev;return i.next=n,n.prev=i,o.next=h,h.prev=o,u.next=o,o.prev=u,p.next=u,u.prev=p,u}function vz(i,n,o,u){const h=RP(i,n,o);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function nv(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function RP(i,n,o){return{i,x:n,y:o,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Pw(i,n){const o=i.length;if(o<=1)return[i];const u=[];let h,p;for(let m=0;m<o;m++){const v=dg(i[m]);v!==0&&(i[m].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(h&&u.push(h),h=[i[m]]):h.push(i[m]))}if(h&&u.push(h),n>1)for(let m=0;m<u.length;m++)u[m].length<=n||(Ir(u[m],n,1,u[m].length-1,RK),u[m]=u[m].slice(0,n));return u}function RK(i,n){return n.area-i.area}function MP(i,n,o){const u=o.patternDependencies;let h=!1;for(const p of n){const m=p.paint.get(`${i}-pattern`);m.isConstant()||(h=!0);const v=m.constantOr(null);v&&(h=!0,u[v]=!0)}return h}function kP(i,n,o,u,h){const p=h.patternDependencies;for(const m of n){const v=m.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:u},o,{},h.availableImages);w=w&&w.name?w.name:w,p[w]=!0,o.patterns[m.id]=w}}return o}class Rw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vc,this.indexArray=new Fs,this.indexArray2=new Dd,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new gi,this.segments2=new gi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection}updateFootprints(n,o){}populate(n,o,u,h){this.hasPattern=MP("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:v,id:w,index:E,sourceLayerIndex:C}of n){const P=this.layers[0]._featureFilter.needGeometry,k=yh(v,P);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),k,u))continue;const N=p?p.evaluate(k,{},u,o.availableImages):void 0,j={id:w,properties:v.properties,type:v.type,sourceLayerIndex:C,index:E,geometry:P?k.geometry:bc(v,u,h),patterns:{},sortKey:N};m.push(j)}p&&m.sort((v,w)=>v.sortKey-w.sortKey);for(const v of m){const{geometry:w,index:E,sourceLayerIndex:C}=v;if(this.hasPattern){const P=kP("fill",this.layers,v,this.zoom,o);this.patternFeatures.push(P)}else this.addFeature(v,w,E,u,{},o.availableImages,o.brightness);o.featureIndex.insert(n[E].feature,w,E,C,this.index)}}update(n,o,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,u,h,p)}addFeatures(n,o,u,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,u,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,xK),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,u,h,p,m=[],v){for(const w of Pw(o,500)){let E=0;for(const $ of w)E+=$.length;const C=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),P=C.vertexLength,k=[],N=[];for(const $ of w){if($.length===0)continue;$!==w[0]&&N.push(k.length/2);const q=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),te=q.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(te+$.length-1,te),k.push($[0].x),k.push($[0].y);for(let pe=1;pe<$.length;pe++)this.layoutVertexArray.emplaceBack($[pe].x,$[pe].y),this.indexArray2.emplaceBack(te+pe-1,te+pe),k.push($[pe].x),k.push($[pe].y);q.vertexLength+=$.length,q.primitiveLength+=$.length}const j=J0(k,N);for(let $=0;$<j.length;$+=3)this.indexArray.emplaceBack(P+j[$],P+j[$+1],P+j[$+2]);C.vertexLength+=E,C.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,v)}}let xz,bz,wz,Tz;Ve(Rw,"FillBucket",{omit:["layers","patternFeatures"]});class OP{constructor(n,o,u,h){if(this.triangleCount=o.length/3,this.min=new jt(0,0),this.max=new jt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[p,m]=[n[0].clone(),n[0].clone()];for(let P=1;P<n.length;++P){const k=n[P];p.x=Math.min(p.x,k.x),p.y=Math.min(p.y,k.y),m.x=Math.max(m.x,k.x),m.y=Math.max(m.y,k.y)}if(h){const P=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/h);u=Math.max(u,P)}if(u===0)return;this.min=p,this.max=m;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const w=Math.max(v.x,v.y)/u;this.cellsX=Math.max(1,Math.ceil(v.x/w)),this.cellsY=Math.max(1,Math.ceil(v.y/w)),this.xScale=1/w,this.yScale=1/w;const E=[];for(let P=0;P<this.triangleCount;P++){const k=n[o[3*P+0]].sub(this.min),N=n[o[3*P+1]].sub(this.min),j=n[o[3*P+2]].sub(this.min),$=pu(Math.floor(Math.min(k.x,N.x,j.x)),this.xScale,this.cellsX),q=pu(Math.floor(Math.max(k.x,N.x,j.x)),this.xScale,this.cellsX),te=pu(Math.floor(Math.min(k.y,N.y,j.y)),this.yScale,this.cellsY),pe=pu(Math.floor(Math.max(k.y,N.y,j.y)),this.yScale,this.cellsY),fe=new jt(0,0),me=new jt(0,0),Ae=new jt(0,0),Pe=new jt(0,0);for(let ze=te;ze<=pe;++ze){fe.y=me.y=ze*w,Ae.y=Pe.y=(ze+1)*w;for(let $e=$;$e<=q;++$e)fe.x=Ae.x=$e*w,me.x=Pe.x=($e+1)*w,(vP(k,N,j,fe,me,Pe)||vP(k,N,j,fe,Pe,Ae))&&E.push({cellIdx:ze*this.cellsX+$e,triIdx:P})}}if(E.length===0)return;E.sort((P,k)=>P.cellIdx-k.cellIdx||P.triIdx-k.triIdx);let C=0;for(;C<E.length;){const P=E[C].cellIdx,k={start:this.payload.length,len:0};for(;C<E.length&&E[C].cellIdx===P;)++k.len,this.payload.push(E[C++].triIdx);this.cells[P]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,o){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const u=pu(n.x-this.min.x,this.xScale,this.cellsX),h=pu(n.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+u];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const v=this.payload[p.start+m],w=Math.floor(v/8),E=1<<v%8;if(!(this.lookup[w]&E)&&(this.lookup[w]|=E,o.push(v),o.length===this.triangleCount))return}}}query(n,o,u){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>o.x||n.y>this.max.y||this.min.y>o.y)return;this._lazyInitLookup();const h=pu(n.x-this.min.x,this.xScale,this.cellsX),p=pu(o.x-this.min.x,this.xScale,this.cellsX),m=pu(n.y-this.min.y,this.yScale,this.cellsY),v=pu(o.y-this.min.y,this.yScale,this.cellsY);for(let w=m;w<=v;w++)for(let E=h;E<=p;E++){const C=this.cells[w*this.cellsX+E];if(C)for(let P=0;P<C.len;P++){const k=this.payload[C.start+P],N=Math.floor(k/8),j=1<<k%8;if(!(this.lookup[N]&j)&&(this.lookup[N]|=j,u.push(k),u.length===this.triangleCount))return}}}}function pu(i,n,o){return Math.max(0,Math.min(o-1,Math.floor(i*n)))}Ve(OP,"TriangleGridIndex");class Ez{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.footprints=[]}updateFootprints(n,o){for(const u of this.footprints)o.push({footprint:u,id:n})}populate(n,o,u,h){const p=[];for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of n){const C=this.layers[0]._featureFilter.needGeometry,P=yh(m,C);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),P,u))continue;const k={id:v,properties:m.properties,type:m.type,sourceLayerIndex:E,index:w,geometry:C?P.geometry:bc(m,u,h),patterns:{}};p.push(k)}for(const m of p){const{geometry:v,index:w,sourceLayerIndex:E}=m;this.addFeature(m,v,w,u,{},o.availableImages,o.brightness),o.featureIndex.insert(n[w].feature,v,w,E,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,o,u,h,p){}destroy(){}addFeature(n,o,u,h,p,m=[],v){for(const w of Pw(o,2)){const E=[],C=[],P=[],k=new jt(1/0,1/0),N=new jt(-1/0,-1/0);for(const q of w)if(q.length!==0){q!==w[0]&&P.push(C.length/2);for(let te=0;te<q.length;te++)C.push(q[te].x),C.push(q[te].y),E.push(q[te]),k.x=Math.min(k.x,q[te].x),k.y=Math.min(k.y,q[te].y),N.x=Math.max(N.x,q[te].x),N.y=Math.max(N.y,q[te].y)}const j=J0(C,P),$=new OP(E,j,8,256);this.footprints.push({vertices:E,indices:j,grid:$,min:k,max:N})}}}Ve(Ez,"ClipBucket",{omit:["layers"]});const MK=Rr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),kK=Rr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),OK=Rr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),DK=Rr([{name:"a_join_normal_inside_polygon",components:4,type:"Int16"}]),LK=Rr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),zK=Rr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:NK}=MK;var Mw={},FK=Yc,Sz=Jg;function Jg(i,n,o,u,h){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=u,this._values=h,i.readFields(BK,this,n)}function BK(i,n,o){i==1?n.id=o.readVarint():i==2?function(u,h){for(var p=u.readVarint()+u.pos;u.pos<p;){var m=h._keys[u.readVarint()],v=h._values[u.readVarint()];h.properties[m]=v}}(o,n):i==3?n.type=o.readVarint():i==4&&(n._geometry=o.pos)}function jK(i){for(var n,o,u=0,h=0,p=i.length,m=p-1;h<p;m=h++)u+=((o=i[m]).x-(n=i[h]).x)*(n.y+o.y);return u}Jg.types=["Unknown","Point","LineString","Polygon"],Jg.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var n,o=i.readVarint()+i.pos,u=1,h=0,p=0,m=0,v=[];i.pos<o;){if(h<=0){var w=i.readVarint();u=7&w,h=w>>3}if(h--,u===1||u===2)p+=i.readSVarint(),m+=i.readSVarint(),u===1&&(n&&v.push(n),n=[]),n.push(new FK(p,m));else{if(u!==7)throw new Error("unknown command "+u);n&&n.push(n[0].clone())}}return n&&v.push(n),v},Jg.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var n=i.readVarint()+i.pos,o=1,u=0,h=0,p=0,m=1/0,v=-1/0,w=1/0,E=-1/0;i.pos<n;){if(u<=0){var C=i.readVarint();o=7&C,u=C>>3}if(u--,o===1||o===2)(h+=i.readSVarint())<m&&(m=h),h>v&&(v=h),(p+=i.readSVarint())<w&&(w=p),p>E&&(E=p);else if(o!==7)throw new Error("unknown command "+o)}return[m,w,v,E]},Jg.prototype.toGeoJSON=function(i,n,o){var u,h,p=this.extent*Math.pow(2,o),m=this.extent*i,v=this.extent*n,w=this.loadGeometry(),E=Jg.types[this.type];function C(N){for(var j=0;j<N.length;j++){var $=N[j];N[j]=[360*($.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(u=0;u<w.length;u++)P[u]=w[u][0];C(w=P);break;case 2:for(u=0;u<w.length;u++)C(w[u]);break;case 3:for(w=function(N){var j=N.length;if(j<=1)return[N];for(var $,q,te=[],pe=0;pe<j;pe++){var fe=jK(N[pe]);fe!==0&&(q===void 0&&(q=fe<0),q===fe<0?($&&te.push($),$=[N[pe]]):$.push(N[pe]))}return $&&te.push($),te}(w),u=0;u<w.length;u++)for(h=0;h<w[u].length;h++)C(w[u][h])}w.length===1?w=w[0]:E="Multi"+E;var k={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(k.id=this.id),k};var UK=Sz,Iz=Cz;function Cz(i,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(VK,this,n),this.length=this._features.length}function VK(i,n,o){i===15?n.version=o.readVarint():i===1?n.name=o.readString():i===5?n.extent=o.readVarint():i===2?n._features.push(o.pos):i===3?n._keys.push(o.readString()):i===4&&n._values.push(function(u){for(var h=null,p=u.readVarint()+u.pos;u.pos<p;){var m=u.readVarint()>>3;h=m===1?u.readString():m===2?u.readFloat():m===3?u.readDouble():m===4?u.readVarint64():m===5?u.readVarint():m===6?u.readSVarint():m===7?u.readBoolean():null}return h}(o))}Cz.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var n=this._pbf.readVarint()+this._pbf.pos;return new UK(this._pbf,n,this.extent,this._keys,this._values)};var $K=Iz;function qK(i,n,o){if(i===3){var u=new $K(o,o.readVarint()+o.pos);u.length&&(n[u.name]=u)}}var DP=Mw.VectorTile=function(i,n){this.layers=i.readFields(qK,{},n)},kw=Mw.VectorTileFeature=Sz;Mw.VectorTileLayer=Iz;class Bp extends jt{constructor(n,o,u){super(n,o),this.z=u}}class Az extends Bp{constructor(n,o,u,h){super(n,o,u),this.w=h}}function Ow(i,n,o,u){const h=[],p=u===0?(m,v,w,E,C,P)=>{m.push(new jt(P,w+(P-v)/(E-v)*(C-w)))}:(m,v,w,E,C,P)=>{m.push(new jt(v+(P-w)/(C-w)*(E-v),P))};for(const m of i){const v=[];for(const w of m){if(w.length<=2)continue;const E=[];for(let k=0;k<w.length-1;k++){const N=w[k].x,j=w[k].y,$=w[k+1].x,q=w[k+1].y,te=u===0?N:j,pe=u===0?$:q;te<n?pe>n&&p(E,N,j,$,q,n):te>o?pe<o&&p(E,N,j,$,q,o):E.push(w[k]),pe<n&&te>=n&&p(E,N,j,$,q,n),pe>o&&te<=o&&p(E,N,j,$,q,o)}let C=w[w.length-1];const P=u===0?C.x:C.y;P>=n&&P<=o&&E.push(C),E.length&&(C=E[E.length-1],E[0].x===C.x&&E[0].y===C.y||E.push(E[0]),v.push(E))}v.length&&h.push(v)}return h}function Pz(i,n,o,u){const h=o==="x"?"y":"x",p=(u-i[o])/(n[o]-i[o]);i[h]=i[h]+(n[h]-i[h])*p,i[o]=u,i.hasOwnProperty("z")&&(i.z=Sn(i.z,n.z,p)),i.hasOwnProperty("w")&&(i.w=Sn(i.w,n.w,p))}function Rz(i,n,o,u){const h=o,p=u;for(const m of["x","y"]){let v=i,w=n;v[m]>=w[m]&&(v=n,w=i),v[m]<h&&w[m]>h&&Pz(v,w,m,h),v[m]<p&&w[m]>p&&Pz(w,v,m,p)}}const Dw=Number.MAX_SAFE_INTEGER;function Mz(i,n,o,u){return i.order<n||i.order===Dw||!(i.clipMask&o)||function(h,p){return p.length!==0&&p.find(m=>m===h)===void 0}(u,i.clipScope)}function Lw(i,n){return i.x-n.x||i.y-n.y}function kz(i,n){return Lw(i.min,n.min)===0&&Lw(i.max,n.max)===0}function LP(i,n){return!(i.min.x>n.max.x||i.max.x<n.min.x||i.min.y>n.max.y||i.max.y<n.min.y)}function zP(i,n){if(i.length!==n.length)return!1;for(let o=0;o<i.length;o++)if(i[o].sourceId!==n[o].sourceId||!kz(i[o],n[o])||i[o].order!==n[o].order||i[o].clipMask!==n[o].clipMask||!ic(i[o].clipScope,n[o].clipScope))return!1;return!0}function Oz(i,n,o){const u=1/Ft,h=1/(1<<o.canonical.z),p=(n.x*u+o.canonical.x)*h+o.wrap,m=(n.y*u+o.canonical.y)*h;return{min:new jt((i.x*u+o.canonical.x)*h+o.wrap,(i.y*u+o.canonical.y)*h),max:new jt(p,m)}}function GK(i,n,o){const u=1<<o.canonical.z,h=((n.x-o.wrap)*u-o.canonical.x)*Ft,p=(n.y*u-o.canonical.y)*Ft;return{min:new jt(((i.x-o.wrap)*u-o.canonical.x)*Ft,(i.y*u-o.canonical.y)*Ft),max:new jt(h,p)}}function Dz(i,n,o,u,h,p,m){const v=i.indices,w=i.vertices,E=[];for(let C=u;C<u+h;C+=3){const P=n[o[C+0]+p],k=n[o[C+1]+p],N=n[o[C+2]+p],j=Math.min(P.x,k.x,N.x),$=Math.max(P.x,k.x,N.x),q=Math.min(P.y,k.y,N.y),te=Math.max(P.y,k.y,N.y);E.length=0,i.grid.query(new jt(j,q),new jt($,te),E);for(let pe=0;pe<E.length;pe++){const fe=E[pe];if(vP(w[v[3*fe+0]],w[v[3*fe+1]],w[v[3*fe+2]],P,k,N,m))return!0}}return!1}function Lz(i,n,o,u){if(!i||!o)return!1;let h=i.vertices;if(!n.canonical.equals(u.canonical)||n.wrap!==u.wrap){if(o.vertices.length<i.vertices.length)return Lz(o,u,i,n);const p=n.canonical,m=u.canonical,v=Math.pow(2,m.z-p.z);h=i.vertices.map(w=>new jt((w.x+p.x*Ft)*v-m.x*Ft,(w.y+p.y*Ft)*v-m.y*Ft))}return Dz(o,h,i.indices,0,i.indices.length,0,0)}function zz(i,n,o,u){const h=Math.pow(2,u.z-o.z);return new jt((i+o.x*Ft)*h-u.x*Ft,(n+o.y*Ft)*h-u.y*Ft)}function Nz(i,n){const o=[];n.footprint.grid.queryPoint(i,o);const u=n.footprint.indices,h=n.footprint.vertices;for(let p=0;p<o.length;p++){const m=o[p];if(Fd([h[u[3*m+0]],h[u[3*m+1]],h[u[3*m+2]]],i))return!0}return!1}class Fz{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const u=this.toIdx(n,o);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function Bz(i,n,o,u){let h=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(u[m])<1e-15){if(o[m]<i[m]||o[m]>n[m])return null}else{const v=1/u[m];let w=(i[m]-o[m])*v,E=(n[m]-o[m])*v;if(w>E){const C=w;w=E,E=C}if(w>h&&(h=w),E<p&&(p=E),h>p)return null}return h}function jz(i,n,o,u,h,p,m,v,w,E,C){const P=u-i,k=h-n,N=p-o,j=m-i,$=v-n,q=w-o,te=C[1]*q-C[2]*$,pe=C[2]*j-C[0]*q,fe=C[0]*$-C[1]*j,me=P*te+k*pe+N*fe;if(Math.abs(me)<1e-15)return null;const Ae=1/me,Pe=E[0]-i,ze=E[1]-n,$e=E[2]-o,Xe=(Pe*te+ze*pe+$e*fe)*Ae;if(Xe<0||Xe>1)return null;const rt=ze*N-$e*k,Qe=$e*P-Pe*N,ut=Pe*k-ze*P,At=(C[0]*rt+C[1]*Qe+C[2]*ut)*Ae;return At<0||Xe+At>1?null:(j*rt+$*Qe+q*ut)*Ae}function Uz(i,n,o){return(i-n)/(o-n)}function Vz(i,n,o,u,h,p,m,v,w){const E=1<<o,C=p-u,P=m-h,k=(i+1)/E*C+u,N=(n+0)/E*P+h,j=(n+1)/E*P+h;v[0]=(i+0)/E*C+u,v[1]=N,w[0]=k,w[1]=j}class $z{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(p){const m=Math.ceil(Math.log2(p.dim/8)),v=[];let w=Math.ceil(Math.pow(2,m));const E=1/w,C=(N,j,$,q,te)=>{const pe=q?1:0,fe=(N+1)*$-pe,me=j*$,Ae=(j+1)*$-pe;te[0]=N*$,te[1]=me,te[2]=fe,te[3]=Ae};let P=new Fz(w);const k=[];for(let N=0;N<w*w;N++){C(N%w,Math.floor(N/w),E,!1,k);const j=jd(k[0],k[1],p),$=jd(k[2],k[1],p),q=jd(k[2],k[3],p),te=jd(k[0],k[3],p);P.minimums.push(Math.min(j,$,q,te)),P.maximums.push(Math.max(j,$,q,te)),P.leaves.push(1)}for(v.push(P),w/=2;w>=1;w/=2){const N=v[v.length-1];P=new Fz(w);for(let j=0;j<w*w;j++){C(j%w,Math.floor(j/w),2,!0,k);const $=N.getElevation(k[0],k[1]),q=N.getElevation(k[2],k[1]),te=N.getElevation(k[2],k[3]),pe=N.getElevation(k[0],k[3]),fe=N.isLeaf(k[0],k[1]),me=N.isLeaf(k[2],k[1]),Ae=N.isLeaf(k[2],k[3]),Pe=N.isLeaf(k[0],k[3]),ze=Math.min($.min,q.min,te.min,pe.min),$e=Math.max($.max,q.max,te.max,pe.max),Xe=fe&&me&&Ae&&Pe;P.maximums.push($e),P.minimums.push(ze),P.leaves.push($e-ze<=5&&Xe?1:0)}v.push(P)}return v}(this.dem),u=o.length-1,h=o[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,u,0)}raycastRoot(n,o,u,h,p,m,v=1){return Bz([n,o,-100],[u,h,this.maximums[0]*v],p,m)}raycast(n,o,u,h,p,m,v=1){if(!this.nodeCount)return null;const w=this.raycastRoot(n,o,u,h,p,m,v);if(w==null)return null;const E=[],C=[],P=[],k=[],N=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:j,t:$,nodex:q,nodey:te,depth:pe}=N.pop();if(this.leaves[j]){Vz(q,te,pe,n,o,u,h,P,k);const me=1<<pe,Ae=(q+0)/me,Pe=(q+1)/me,ze=(te+0)/me,$e=(te+1)/me,Xe=jd(Ae,ze,this.dem)*v,rt=jd(Pe,ze,this.dem)*v,Qe=jd(Pe,$e,this.dem)*v,ut=jd(Ae,$e,this.dem)*v,At=jz(P[0],P[1],Xe,k[0],P[1],rt,k[0],k[1],Qe,p,m),ht=jz(k[0],k[1],Qe,P[0],k[1],ut,P[0],P[1],Xe,p,m),Ot=Math.min(At!==null?At:Number.MAX_VALUE,ht!==null?ht:Number.MAX_VALUE);if(Ot!==Number.MAX_VALUE)return Ot;{const ct=a.$.scaleAndAdd([],p,m,$);if(qz(Xe,rt,ut,Qe,Uz(ct[0],P[0],k[0]),Uz(ct[1],P[1],k[1]))>=ct[2])return $}continue}let fe=0;for(let me=0;me<this._siblingOffset.length;me++){Vz((q<<1)+this._siblingOffset[me][0],(te<<1)+this._siblingOffset[me][1],pe+1,n,o,u,h,P,k),P[2]=-100,k[2]=this.maximums[this.childOffsets[j]+me]*v;const Ae=Bz(P,k,p,m);if(Ae!=null){const Pe=Ae;E[me]=Pe;let ze=!1;for(let $e=0;$e<fe&&!ze;$e++)Pe>=E[C[$e]]&&(C.splice($e,0,me),ze=!0);ze||(C[fe]=me),fe++}}for(let me=0;me<fe;me++){const Ae=C[me];N.push({idx:this.childOffsets[j]+Ae,t:E[Ae],nodex:(q<<1)+this._siblingOffset[Ae][0],nodey:(te<<1)+this._siblingOffset[Ae][1],depth:pe+1})}}return null}_addNode(n,o,u){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,u,h,p){if(n[h].isLeaf(o,u)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=h-1,v=n[m];let w=0,E=0;for(let C=0;C<this._siblingOffset.length;C++){const P=2*o+this._siblingOffset[C][0],k=2*u+this._siblingOffset[C][1],N=v.getElevation(P,k),j=v.isLeaf(P,k),$=this._addNode(N.min,N.max,j);j&&(w|=1<<C),E||(E=$)}for(let C=0;C<this._siblingOffset.length;C++)w&1<<C||this._construct(n,2*o+this._siblingOffset[C][0],2*u+this._siblingOffset[C][1],m,E+C)}}function qz(i,n,o,u,h,p){return Sn(Sn(i,o,p),Sn(n,u,p),h)}function jd(i,n,o){const u=o.dim,h=Hn(i*u-.5,0,u-1),p=Hn(n*u-.5,0,u-1),m=Math.floor(h),v=Math.floor(p),w=Math.min(m+1,u-1),E=Math.min(v+1,u-1);return qz(o.get(m,v),o.get(w,v),o.get(m,E),o.get(w,E),h-m,p-v)}const WK={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function HK(i,n,o){return(256*i*256+256*n+o)/10-1e4}function ZK(i,n,o){return 256*i+n+o/256-32768}class zw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,u,h=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return bi(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const p=this.dim=o.height-2,m=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.floatView=new Float32Array(o.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let w=0;w<p;w++)m[this._idx(-1,w)]=m[this._idx(0,w)],m[this._idx(p,w)]=m[this._idx(p-1,w)],m[this._idx(w,-1)]=m[this._idx(w,0)],m[this._idx(w,p)]=m[this._idx(w,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const v=u==="terrarium"?ZK:HK;for(let w=0;w<m.length;++w){const E=4*w;this.floatView[w]=v(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=tn.now()}_buildQuadTree(){this._tree=new $z(this)}get(n,o,u=!1){u&&(n=Hn(n,-1,this.dim),o=Hn(o,-1,this.dim));const h=this._idx(n,o);return this.floatView[h]}set(n,o,u){const h=this._idx(n,o),p=this.floatView[h];return this.floatView[h]=u,u-p}static getUnpackVector(n){return WK[n]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const u=[0,0,0,0],h=zw.getUnpackVector(o);let p=Math.floor((n+h[3])/h[2]);return u[2]=p%256,p=Math.floor(p/256),u[1]=p%256,p=Math.floor(p/256),u[0]=p,u}getPixels(){return new hz({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,p=o*this.dim+this.dim,m=u*this.dim,v=u*this.dim+this.dim;switch(o){case-1:h=p-1;break;case 1:p=h+1}switch(u){case-1:m=v-1;break;case 1:v=m+1}const w=-o*this.dim,E=-u*this.dim;for(let C=m;C<v;C++)for(let P=h;P<p;P++){const k=4*this._idx(P,C),N=4*this._idx(P+w,C+E);this.pixels[k+0]=n.pixels[N+0],this.pixels[k+1]=n.pixels[N+1],this.pixels[k+2]=n.pixels[N+2],this.pixels[k+3]=n.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ve(zw,"DEMData"),Ve($z,"DemMinMaxQuadTree",{omit:["dem"]});class e_{constructor(n,o,u){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=u}static create(n,o,u){const h=u||n.findDEMTileFor(o);if(!h||!h.dem)return;const p=h.dem,m=h.tileID,v=1<<o.canonical.z-m.canonical.z;return new e_(h,p.dim/Ft/v,[(o.canonical.x/v-m.canonical.x)*p.dim,(o.canonical.y/v-m.canonical.y)*p.dim])}tileCoordToPixel(n,o){const u=o*this._scale+this._offset[1],h=Math.floor(n*this._scale+this._offset[0]),p=Math.floor(u);return new jt(h,p)}getElevationAt(n,o,u,h){const p=n*this._scale+this._offset[0],m=o*this._scale+this._offset[1],v=Math.floor(p),w=Math.floor(m),E=this._dem;return h=!!h,u?Sn(Sn(E.get(v,w,h),E.get(v,w+1,h),m-w),Sn(E.get(v+1,w,h),E.get(v+1,w+1,h),m-w),p-v):E.get(v,w,h)}getElevationAtPixel(n,o,u){return this._dem.get(n,o,!!u)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Vo(1,n)*this._dem.stride}}const Gz={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},XK=kw.types,KK=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-line-alignment"],QK=["fill-extrusion-flood-light-ground-radius"],YK=Math.pow(2,13),JK=Math.pow(2,15)-1,Wz=new jt(0,1),Ud=2147483648;function rv(i,n,o,u,h,p,m,v){i.emplaceBack((n<<1)+m,(o<<1)+p,(Math.floor(u*YK)<<1)+h,Math.round(v))}function iv(i,n,o,u){i.emplaceBack(n.x*Ft,n.y*Ft,o?0:1,u?1:0)}function Nw(i,n,o,u,h,p){i.emplaceBack(n.x,n.y,(o.x<<1)+u,(o.y<<1)+h,p)}function sv(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class Hz{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Zz{constructor(){this.centroidXY=new jt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new jt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new jt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new jt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Xz{constructor(){this.acc=new jt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,o){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=o.x,n.min.y=n.max.y=o.y)}appendEdge(n,o,u){this.accCount++,this.acc._add(o);let h=!!this.borders;o.x<n.min.x?(n.min.x=o.x,h=!0):o.x>n.max.x&&(n.max.x=o.x,h=!0),o.y<n.min.y?(n.min.y=o.y,h=!0):o.y>n.max.y&&(n.max.y=o.y,h=!0),((o.x===0||o.x===Ft)&&o.x===u.x)!=((o.y===0||o.y===Ft)&&o.y===u.y)&&this.processBorderOverlap(o,u),h&&this.checkBorderIntersection(o,u)}checkBorderIntersection(n,o){o.x<0!=n.x<0&&this.addBorderIntersection(0,Sn(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>Ft!=n.x>Ft&&this.addBorderIntersection(1,Sn(o.y,n.y,(Ft-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,Sn(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>Ft!=n.y>Ft&&this.addBorderIntersection(3,Sn(o.x,n.x,(Ft-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[n];o<u[0]&&(u[0]=o),o>u[1]&&(u[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const u=n.x===0?0:1;this.addBorderIntersection(u,o.y),this.addBorderIntersection(u,n.y)}else{const u=n.y===0?2:3;this.addBorderIntersection(u,o.x),this.addBorderIntersection(u,n.x)}}centroid(){return this.accCount===0?new jt(0,0):new jt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,o)=>n+ +(o[0]!==Number.MAX_VALUE),0):0}}function Kz(i,n){const o=i.add(n)._unit(),u=Hn(i.x*o.x+i.y*o.y,-1,1);var h,p,m;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*JK*((p=i).x*(m=n).y-p.y*m.x<0?-1:1)}const eQ=[i=>i.x<0,i=>i.x>Ft,i=>i.y<0,i=>i.y>Ft];function tQ(i,n,o,u){const h=[4];if(u===0)return h;o._mult(u);const p=i.sub(o),m=n.sub(o),v=[i,n,p,m];for(let w=0;w<4;w++)for(const E of v)if(eQ[w](E)){h.push(w);break}return h}class Qz{constructor(n){this.vertexArray=new UA,this.indexArray=new Fs,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut},o=>QK.includes(o)),this._segments=new gi,this.hiddenByLandmarkVertexArray=new tP,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new gi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,o,u,h=!1){const p=n.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let w;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const E=n[0],C=n[1];w=Kz(E.sub(n[p-1])._perp()._unit(),C.sub(E)._perp()._unit())}for(let E=0;E<p;E++){const C=E===p-1?0:E+1,P=n[E],k=n[C],N=n[C===p-1?0:C+1],j=k.sub(P)._perp()._unit(),$=Kz(j,N.sub(k)._perp()._unit()),q=w,te=$;if(NP(P,k,o)||h&&eN(P,o)&&eN(k,o)){w=$;continue}const pe=v.vertexLength;Nw(this.vertexArray,P,k,1,1,q),Nw(this.vertexArray,P,k,1,0,q),Nw(this.vertexArray,P,k,0,1,te),Nw(this.vertexArray,P,k,0,0,te),v.vertexLength+=4;const fe=tQ(P,k,j,u);for(const me of fe)this._segmentToGroundQuads[m].push({id:pe,region:me}),this._segmentToRegionTriCounts[m][me]+=2,v.primitiveLength+=2;w=$}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),o=n.length;for(let u=0;u<o;u++)this._segmentToGroundQuads[u].sort((h,p)=>h.region-p.region);for(let u=0;u<o;u++){const h=this._segmentToGroundQuads[u],p=n[u],m=this._segmentToRegionTriCounts[u];m.reduce((w,E)=>w+E,0);let v=0;for(let w=0;w<=4;w++){const E=m[w];if(E!==0){let C=this.regionSegments[w];C||(C=this.regionSegments[w]=new gi);const P={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:E};C.get().push(P)}v+=E}for(let w=0;w<h.length;w++){const E=h[w].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,o,u,h,p,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,o,u,h,p,m)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,kK.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,o,u,h,p,m){this.hasData()&&this.programConfigurations.updatePaintArrays(n,o,u,h,p,m)}updateHiddenByLandmark(n){if(!this.hasData())return;const o=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const u=n.flags&Ud?1:0;for(let h=n.groundVertexArrayOffset;h<o;++h)this.hiddenByLandmarkVertexArray.emplace(h,u);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,LK.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const o=this.regionSegments[n];o&&o.destroy()}}}}class Fw{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Fs,this.footprintVertices=new vc,this.footprintSegments=[],this.layoutVertexArray=new ph,this.centroidVertexArray=new TL,this.wallVertexArray=new SL,this.indexArray=new Fs,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut},o=>KK.includes(o)),this.segments=new gi,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.groundEffect=new Qz(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,o){}populate(n,o,u,h){this.features=[],this.hasPattern=MP("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=yw(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:v,sourceLayerIndex:w}of n){const E=this.layers[0]._featureFilter.needGeometry,C=yh(p,E);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),C,u))continue;const P={id:m,sourceLayerIndex:w,index:v,geometry:E?C.geometry:bc(p,u,h),properties:p.properties,type:p.type,patterns:{}},k=this.layoutVertexArray.length;if(this.hasPattern)this.features.push(kP("fill-extrusion",this.layers,P,this.zoom,o));else if(this.wallMode)for(const N of P.geometry)this.addFeature(P,[N],v,u,{},o.availableImages,h,o.brightness);else this.addFeature(P,P.geometry,v,u,{},o.availableImages,h,o.brightness);o.featureIndex.insert(p,P.geometry,v,w,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,o,u,h,p,m){for(const v of this.features){const{geometry:w}=v;if(this.wallMode)for(const E of w)this.addFeature(v,[E],v.index,o,u,h,p,m);else this.addFeature(v,w,v.index,o,u,h,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,o,u,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,o,v,u,h,p),this.groundEffect.update(n,o,v,u,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,NK),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,DK.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,zK.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,OK.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,u,h,p,m,v,w){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,C=[new jt(0,0),new jt(Ft,Ft)],P=v.projection,k=P.name==="globe",N=this.wallMode||XK[n.type]==="Polygon",j=new Xz;j.centroidDataIndex=this.centroidData.length;const $=new Zz,q=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},h)<=0,te=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},h);let pe;if($.height=te,$.vertexArrayOffset=this.layoutVertexArray.length,$.groundVertexArrayOffset=this.groundEffect.vertexArray.length,k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new fw),this.wallMode){if(k)return void bi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;pe=function(rt){const Qe=rt[0].x===rt[rt.length-1].x&&rt[0].y===rt[rt.length-1].y;(function(fn){let Jt=0;const Bt=fn.length;for(let Pn=0;Pn<Bt;Pn++)Jt+=(fn[(Pn+1)%Bt].x-fn[Pn].x)*(fn[(Pn+1)%Bt].y+fn[Pn].y);return Jt>=0})(rt)||(rt=rt.reverse());const At={isPolygon:Qe,geometry:[],joinNormals:[]},ht=[],Ot=[],ct=[];let vt=rt.length;if(vt<(Qe?3:2))return At;for(;vt>=2&&rt[vt-1].equals(rt[vt-2]);)vt--;let Nt,dt,Ut,Lt,Rt,bn=0;for(;bn<vt-1&&rt[bn].equals(rt[bn+1]);)bn++;Qe&&(Nt=rt[vt-2],Rt=rt[bn].sub(Nt)._unit()._perp());for(let fn=bn;fn<vt;fn++){if(Ut=fn===vt-1?Qe?rt[bn+1]:void 0:rt[fn+1],Ut&&rt[fn].equals(Ut))continue;Rt&&(Lt=Rt),Nt&&(dt=Nt),Nt=rt[fn],Rt=Ut?Ut.sub(Nt)._unit()._perp():Lt,Lt=Lt||Rt;const Jt=Lt.add(Rt);Jt.x===0&&Jt.y===0||Jt._unit();const Bt=Jt.x*Rt.x+Jt.y*Rt.y,Pn=Bt!==0?1/Bt:1/0,gn=Lt.x*Rt.y-Lt.y*Rt.x>0;let on="miter";on==="miter"&&Pn>2&&(on="bevel");const zn=(Bn,Nn,Wn,gr)=>{const sr=new jt(Bn.x,Bn.y),Br=new jt(Bn.x,Bn.y);sr.x-=Nn.x*gr,sr.y-=Nn.y*gr,Br.x-=Nn.x*Math.max(Wn,1),Br.y-=Nn.y*Math.max(Wn,1),ct.push(Nn),ht.push(sr),Ot.push(Br)};if(on==="miter")Jt._mult(Pn),zn(Nt,Jt,1,0);else{const Bn=-Math.sqrt(Pn*Pn-1),Nn=gn?Bn:0,Wn=gn?0:Bn;dt&&zn(Nt,Lt,Nn,Wn),Ut&&zn(Nt,Rt,Nn,Wn)}}return At.geometry=[...ht,...Ot.reverse(),ht[0]],At.joinNormals=[...ct,...ct.reverse(),ct[ct.length-1]],At}(o[0]),o=[pe.geometry]}const fe=(rt,Qe)=>rt<(Qe.length-1)/2||rt===Qe.length-1,me=this.wallMode?[o]:Pw(o,500);for(let rt=me.length-1;rt>=0;rt--){const Qe=me[rt];(Qe.length===0||(Ae=Qe[0]).every(ut=>ut.x<=0)||Ae.every(ut=>ut.x>=Ft)||Ae.every(ut=>ut.y<=0)||Ae.every(ut=>ut.y>=Ft))&&me.splice(rt,1)}var Ae;let Pe;if(k)Pe=iN(me,C,h);else{Pe=[];for(const rt of me)Pe.push({polygon:rt,bounds:C})}const ze=N?this.edgeRadius:0,$e=ze>0&&this.zoom<17,Xe=(rt,Qe)=>{if(rt.length===0)return!1;const ut=rt[rt.length-1];return Qe.x===ut.x&&Qe.y===ut.y};for(const{polygon:rt,bounds:Qe}of Pe){let ut=0,At=0;for(const vt of rt)N&&!vt[0].equals(vt[vt.length-1])&&vt.push(vt[0]),At+=N?vt.length-1:vt.length;const ht=this.segments.prepareSegment((N?5:4)*At,this.layoutVertexArray,this.indexArray);$.footprintSegIdx<0&&($.footprintSegIdx=this.footprintSegments.length),$.polygonSegIdx<0&&($.polygonSegIdx=this.polygonSegments.length);const Ot={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ct=new Hz;if(ct.vertexOffset=this.footprintVertices.length,ct.indexOffset=3*this.footprintIndices.length,ct.ringIndices=[],N){const vt=[],Nt=[];ut=ht.vertexLength;for(let Ut=0;Ut<rt.length;Ut++){const Lt=rt[Ut];Lt.length&&Ut!==0&&Nt.push(vt.length/2);const Rt=[];let bn,fn;bn=Lt[1].sub(Lt[0])._perp()._unit(),ct.ringIndices.push(Lt.length-1);for(let Jt=1;Jt<Lt.length;Jt++){const Bt=Lt[Jt],Pn=Lt[Jt===Lt.length-1?1:Jt+1],gn=Bt.clone();if(ze){fn=Pn.sub(Bt)._perp()._unit();const on=bn.add(fn)._unit(),zn=ze*Math.min(4,1/(bn.x*on.x+bn.y*on.y));gn.x+=zn*on.x,gn.y+=zn*on.y,gn.x=Math.round(gn.x),gn.y=Math.round(gn.y),bn=fn}if(!q||ze!==0&&!$e||Xe(Rt,gn)||Rt.push(gn),rv(this.layoutVertexArray,gn.x,gn.y,0,0,1,1,0),this.wallMode){const on=fe(Jt,Lt);iv(this.wallVertexArray,pe.joinNormals[Jt],on,pe.isPolygon)}ht.vertexLength++,this.footprintVertices.emplaceBack(Bt.x,Bt.y),vt.push(Bt.x,Bt.y),k&&sv(this.layoutVertexExtArray,P.projectTilePoint(gn.x,gn.y,h),P.upVector(h,gn.x,gn.y))}q&&(ze===0||$e)&&(Rt.length!==0&&Xe(Rt,Rt[0])&&Rt.pop(),this.groundEffect.addData(Rt,Qe,E))}const dt=J0(vt,Nt);for(let Ut=0;Ut<dt.length;Ut+=3)this.footprintIndices.emplaceBack(ct.vertexOffset+dt[Ut+0],ct.vertexOffset+dt[Ut+1],ct.vertexOffset+dt[Ut+2]),this.indexArray.emplaceBack(ut+dt[Ut],ut+dt[Ut+2],ut+dt[Ut+1]),ht.primitiveLength++;ct.indexCount+=dt.length,ct.vertexCount+=this.footprintVertices.length-ct.vertexOffset}for(let vt=0;vt<rt.length;vt++){const Nt=rt[vt];j.startRing($,Nt[0]);let dt=Nt.length>4&&tN(Nt[Nt.length-2],Nt[0],Nt[1]),Ut=ze?nQ(Nt[Nt.length-2],Nt[0],Nt[1],ze):0;const Lt=[];let Rt,bn,fn;bn=Nt[1].sub(Nt[0])._perp()._unit();let Jt=!0;for(let Bt=1,Pn=0;Bt<Nt.length;Bt++){let gn=Nt[Bt-1],on=Nt[Bt];const zn=Nt[Bt===Nt.length-1?1:Bt+1];if(j.appendEdge($,on,gn),NP(on,gn,Qe)){ze&&(bn=zn.sub(on)._perp()._unit(),Jt=!Jt);continue}const Bn=on.sub(gn)._perp(),Nn=Bn.x/(Math.abs(Bn.x)+Math.abs(Bn.y)),Wn=Bn.y>0?1:0,gr=gn.dist(on);if(Pn+gr>32768&&(Pn=0),ze){fn=zn.sub(on)._perp()._unit();let jn=Jz(gn,on,zn,Yz(bn,fn),ze);isNaN(jn)&&(jn=0);const Mr=on.sub(gn)._unit();gn=gn.add(Mr.mult(Ut))._round(),on=on.add(Mr.mult(-jn))._round(),Ut=jn,bn=fn,q&&this.zoom>=17&&(Xe(Lt,gn)||Lt.push(gn),Xe(Lt,on)||Lt.push(on))}const sr=ht.vertexLength,Br=Nt.length>4&&tN(gn,on,zn);let $r=nN(Pn,dt,Jt);if(rv(this.layoutVertexArray,gn.x,gn.y,Nn,Wn,0,0,$r),rv(this.layoutVertexArray,gn.x,gn.y,Nn,Wn,0,1,$r),this.wallMode){const jn=fe(Bt-1,Nt),Mr=pe.joinNormals[Bt-1];iv(this.wallVertexArray,Mr,!jn,pe.isPolygon),iv(this.wallVertexArray,Mr,!jn,pe.isPolygon)}if(Pn+=gr,$r=nN(Pn,Br,!Jt),dt=Br,rv(this.layoutVertexArray,on.x,on.y,Nn,Wn,0,0,$r),rv(this.layoutVertexArray,on.x,on.y,Nn,Wn,0,1,$r),this.wallMode){const jn=fe(Bt,Nt),Mr=pe.joinNormals[Bt];iv(this.wallVertexArray,Mr,!jn,pe.isPolygon),iv(this.wallVertexArray,Mr,!jn,pe.isPolygon)}if(ht.vertexLength+=4,this.indexArray.emplaceBack(sr+0,sr+1,sr+2),this.indexArray.emplaceBack(sr+1,sr+3,sr+2),ht.primitiveLength+=2,ze){const jn=ut+(Bt===1?Nt.length-2:Bt-2),Mr=Bt===1?ut:jn+1;if(this.indexArray.emplaceBack(sr+1,jn,sr+3),this.indexArray.emplaceBack(jn,Mr,sr+3),ht.primitiveLength+=2,Rt===void 0&&(Rt=sr),!NP(zn,Nt[Bt],Qe)){const Dr=Bt===Nt.length-1?Rt:ht.vertexLength;this.indexArray.emplaceBack(sr+2,sr+3,Dr),this.indexArray.emplaceBack(sr+3,Dr+1,Dr),this.indexArray.emplaceBack(sr+3,Mr,Dr+1),ht.primitiveLength+=3}Jt=!Jt}if(k){const jn=this.layoutVertexExtArray,Mr=P.projectTilePoint(gn.x,gn.y,h),Dr=P.projectTilePoint(on.x,on.y,h),Jr=P.upVector(h,gn.x,gn.y),Oi=P.upVector(h,on.x,on.y);sv(jn,Mr,Jr),sv(jn,Mr,Jr),sv(jn,Dr,Oi),sv(jn,Dr,Oi)}}N&&(ut+=Nt.length-1),q&&ze&&this.zoom>=17&&(Lt.length!==0&&Xe(Lt,Lt[0])&&Lt.pop(),this.groundEffect.addData(Lt,Qe,E,ze>0))}this.footprintSegments.push(ct),Ot.triangleCount=this.indexArray.length-Ot.triangleArrayOffset,this.polygonSegments.push(Ot),++$.footprintSegLen,++$.polygonSegLen}if($.vertexCount=this.layoutVertexArray.length-$.vertexArrayOffset,$.groundVertexCount=this.groundEffect.vertexArray.length-$.groundVertexArrayOffset,$.vertexCount!==0){if($.centroidXY=j.borders?Wz:this.encodeCentroid(j,$),this.centroidData.push($),j.borders){this.featuresOnBorder.push(j);const rt=this.featuresOnBorder.length-1;for(let Qe=0;Qe<j.borders.length;Qe++)j.borders[Qe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Qe].push(rt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,w),this.groundEffect.addPaintPropertiesData(n,u,p,m,h,w),this.maxHeight=Math.max(this.maxHeight,te)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((o,u)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[u].borders[n][0])}splitToSubtiles(){const n=[];for(let v=0;v<this.centroidData.length;v++){const w=this.centroidData[v],E=+(w.min.y+w.max.y>Ft),C=2*E+(+(w.min.x+w.max.x>Ft)^E);for(let P=0;P<w.polygonSegLen;P++){const k=w.polygonSegIdx+P;n.push({centroidIdx:v,subtile:C,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const o=new Fs;n.sort((v,w)=>v.triangleSegmentIdx===w.triangleSegmentIdx?v.subtile-w.subtile:v.triangleSegmentIdx-w.triangleSegmentIdx);let u=0,h=0,p=0;for(const v of n){if(v.triangleSegmentIdx!==u)break;p++}const m=n.length;for(;h!==n.length;){u=n[h].triangleSegmentIdx;let v=0,w=h,E=h;for(let C=w;C<p&&n[C].subtile===v;C++)E++;for(;w!==p;){const C=n[w];v=C.subtile;const P=this.centroidData[C.centroidIdx].min.clone(),k=this.centroidData[C.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:o.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let j=w;j<E;j++){const $=n[j],q=this.polygonSegments[$.polygonSegmentIdx],te=this.centroidData[$.centroidIdx].min,pe=this.centroidData[$.centroidIdx].max,fe=this.indexArray.uint16;for(let me=q.triangleArrayOffset;me<q.triangleArrayOffset+q.triangleCount;me++)o.emplaceBack(fe[3*me],fe[3*me+1],fe[3*me+2]);N.primitiveLength+=q.triangleCount,P.x=Math.min(P.x,te.x),P.y=Math.min(P.y,te.y),k.x=Math.max(k.x,pe.x),k.y=Math.max(k.y,pe.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:P,max:k}),w=E;for(let j=w;j<p&&n[j].subtile===n[w].subtile;j++)E++}h=p;for(let C=h;C<m&&n[C].triangleSegmentIdx===n[h].triangleSegmentIdx;C++)p++}o._trim(),this.indexArray=o}getVisibleSegments(n,o,u){const h=new gi;if(this.wallMode){for(const $ of this.triangleSubSegments)h.segments.push($.segment);return h}let p=0,m=0;const v=1<<n.canonical.z;if(o){const $=o.getMinMaxForTile(n);$&&(p=$.min,m=$.max)}m+=this.maxHeight;const w=n.toUnwrapped();let E;const C=[w.canonical.x/v+w.wrap,w.canonical.y/v],P=[(w.canonical.x+1)/v+w.wrap,(w.canonical.y+1)/v],k=($,q,te)=>[$[0]*(1-te[0])+q[0]*te[0],$[1]*(1-te[1])+q[1]*te[1]],N=[],j=[];for(const $ of this.triangleSubSegments){N[0]=$.min.x/Ft,N[1]=$.min.y/Ft,j[0]=$.max.x/Ft,j[1]=$.max.y/Ft;const q=k(C,P,N),te=k(C,P,j);if(new ci([q[0],q[1],p],[te[0],te[1],m]).intersectsPrecise(u)===0){E&&(h.segments.push(E),E=void 0);continue}const pe=$.segment;E&&E.vertexOffset!==pe.vertexOffset&&(h.segments.push(E),E=void 0),E?(E.vertexLength+=pe.vertexLength,E.primitiveLength+=pe.primitiveLength):E={vertexOffset:pe.vertexOffset,primitiveLength:pe.primitiveLength,vertexLength:pe.vertexLength,primitiveOffset:pe.primitiveOffset,sortKey:void 0,vaos:{}}}return E&&h.segments.push(E),h}encodeCentroid(n,o){const u=n.centroid(),h=o.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new jt(Hn(u.x,1,Ft-1)<<3|p,Hn(u.y,1,Ft-1)<<3|m)}encodeBorderCentroid(n){if(!n.borders)return new jt(0,0);const o=n.borders,u=Number.MAX_VALUE;if(o[0][0]!==u||o[1][0]!==u){const h=o[0][0]!==u?0:1;return new jt(6|(o[0][0]!==u?0:65528),(o[h][0]+o[h][1])/2<<3|6)}{const h=o[2][0]!==u?2:3;return new jt((o[h][0]+o[h][1])/2<<3|6,6|(o[2][0]!==u?0:65528))}}showCentroid(n){const o=this.centroidData[n.centroidDataIndex];o.flags&=Ud,o.centroidXY.x=0,o.centroidXY.y=0,this.writeCentroidToBuffer(o)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const o=n.vertexArrayOffset,u=n.vertexCount+n.vertexArrayOffset,h=n.flags&Ud?Wz:n.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(o);if(this.centroidVertexArray.geta_centroid_pos1(o)!==h.y||p!==h.x){for(let m=o;m<u;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,o,u){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const h=o.getReplacementRegionsForTile(n.toUnwrapped());if(zP(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<u)continue;const v=Math.pow(2,m.footprintTileId.canonical.z-n.canonical.z);for(const w of this.centroidData)if(!(w.flags&Ud||m.min.x>w.max.x||w.min.x>m.max.x||m.min.y>w.max.y||w.min.y>m.max.y))for(let E=0;E<w.footprintSegLen;E++){const C=this.footprintSegments[w.footprintSegIdx+E];if(p.length=0,rQ(this.footprintVertices,C.vertexOffset,C.vertexCount,m.footprintTileId.canonical,n.canonical,p),Dz(m.footprint,p,this.footprintIndices.uint16,C.indexOffset,C.indexCount,-C.vertexOffset,-v)){w.flags|=Ud;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,o,u){let h=!1;for(let p=0;p<u.footprintSegLen;p++){const m=this.footprintSegments[u.footprintSegIdx+p];let v=0;for(const w of m.ringIndices){for(let E=v,C=w+v-1;E<w+v;C=E++){const P=this.footprintVertices.int16[2*(E+m.vertexOffset)+0],k=this.footprintVertices.int16[2*(E+m.vertexOffset)+1],N=this.footprintVertices.int16[2*(C+m.vertexOffset)+1];k>o!=N>o&&n<(this.footprintVertices.int16[2*(C+m.vertexOffset)+0]-P)*(o-k)/(N-k)+P&&(h=!h)}v=w}}return h}getHeightAtTileCoord(n,o){let u=Number.NEGATIVE_INFINITY,h=!0;const p=4*(n+Ft)*Ft+(o+Ft);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&Ud)}:void 0}for(const m of this.centroidData)n>m.max.x||m.min.x>n||o>m.max.y||m.min.y>o||this.footprintContainsPoint(n,o,m)&&m&&m.height>u&&(u=m.height,this.partLookup[p]=m,h=!!(m.flags&Ud));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[p]=void 0}}function Yz(i,n){const o=i.add(n)._unit();return i.x*o.x+i.y*o.y}function nQ(i,n,o,u){const h=n.sub(i)._perp()._unit(),p=o.sub(n)._perp()._unit();return Jz(i,n,o,Yz(h,p),u)}function Jz(i,n,o,u,h){const p=Math.sqrt(1-u*u);return Math.min(i.dist(n)/3,n.dist(o)/3,h*p/u)}function NP(i,n,o){return i.x<o[0].x&&n.x<o[0].x||i.x>o[1].x&&n.x>o[1].x||i.y<o[0].y&&n.y<o[0].y||i.y>o[1].y&&n.y>o[1].y}function eN(i,n){return i.x<n[0].x||i.x>n[1].x||i.y<n[0].y||i.y>n[1].y}function tN(i,n,o){if(i.x<0||i.x>=Ft||n.x<0||n.x>=Ft||o.x<0||o.x>=Ft)return!1;const u=o.sub(n),h=u.perp(),p=i.sub(n);return(u.x*p.x+u.y*p.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function nN(i,n,o){const u=n?2|i:-3&i;return o?1|u:-2&u}function rN(){const i=Math.PI/32,n=Math.tan(i),o=Zg;return o*Math.sqrt(1+2*n*n)-o}function iN(i,n,o){const u=1<<o.z,h=fa(o.x/u),p=fa((o.x+1)/u),m=Hs(o.y/u),v=Hs((o.y+1)/u);return function(w,E,C,P,k=0,N){const j=[];if(!w.length||!C||!P)return j;const $=(Pe,ze)=>{for(const $e of Pe)j.push({polygon:$e,bounds:ze})},q=Math.ceil(Math.log2(C)),te=Math.ceil(Math.log2(P)),pe=q-te,fe=[];for(let Pe=0;Pe<Math.abs(pe);Pe++)fe.push(pe>0?0:1);for(let Pe=0;Pe<Math.min(q,te);Pe++)fe.push(0),fe.push(1);let me=w;if(me=Ow(me,E[0].y-k,E[1].y+k,1),me=Ow(me,E[0].x-k,E[1].x+k,0),!me.length)return j;const Ae=[];for(fe.length?Ae.push({polygons:me,bounds:E,depth:0}):$(me,E);Ae.length;){const Pe=Ae.pop(),ze=Pe.depth,$e=fe[ze],Xe=Pe.bounds[0],rt=Pe.bounds[1],Qe=$e===0?Xe.x:Xe.y,ut=$e===0?rt.x:rt.y,At=N?N($e,Qe,ut):.5*(Qe+ut),ht=Ow(Pe.polygons,Qe-k,At+k,$e),Ot=Ow(Pe.polygons,At-k,ut+k,$e);if(ht.length){const ct=[Xe,new jt($e===0?At:rt.x,$e===1?At:rt.y)];fe.length>ze+1?Ae.push({polygons:ht,bounds:ct,depth:ze+1}):$(ht,ct)}if(Ot.length){const ct=[new jt($e===0?At:Xe.x,$e===1?At:Xe.y),rt];fe.length>ze+1?Ae.push({polygons:Ot,bounds:ct,depth:ze+1}):$(Ot,ct)}}return j}(i,n,Math.ceil((p-h)/11.25),Math.ceil((m-v)/11.25),1,(w,E,C)=>{if(w===0)return .5*(E+C);{const P=Hs((o.y+E/Ft)/u);return(du(.5*(Hs((o.y+C/Ft)/u)+P))*u-o.y)*Ft}})}function rQ(i,n,o,u,h,p){const m=Math.pow(2,u.z-h.z);for(let v=0;v<o;v++){let w=i.int16[2*(v+n)+0],E=i.int16[2*(v+n)+1];w=(w+h.x*Ft)*m-u.x*Ft,E=(E+h.y*Ft)*m-u.y*Ft,p.push(new jt(w,E))}}let sN,oN;function ov(i,n){return i.x*n.x+i.y*n.y}function aN(i,n){if(i.length===1){let o=0;const u=n[o++];let h;for(;!h||u.equals(h);)if(h=n[o++],!h)return 1/0;for(;o<n.length;o++){const p=n[o],m=i[0],v=h.sub(u),w=p.sub(u),E=m.sub(u),C=ov(v,v),P=ov(v,w),k=ov(w,w),N=ov(E,v),j=ov(E,w),$=C*k-P*P,q=(k*N-P*j)/$,te=(C*j-P*N)/$,pe=u.z*(1-q-te)+h.z*q+p.z*te;if(isFinite(pe))return pe}return 1/0}{let o=1/0;for(const u of n)o=Math.min(o,u.z);return o}}function lN(i,n,o,u,h,p,m,v){const w=m*h.getElevationAt(i,n,!0,!0),E=p[0]!==0,C=E?p[1]===0?m*(p[0]/7-450):m*function(P,k,N){const j=Math.floor(k[0]/8),$=Math.floor(k[1]/8),q=10*(k[0]-8*j),te=10*(k[1]-8*$),pe=P.getElevationAt(j,$,!0,!0),fe=P.getMeterToDEM(N),me=Math.floor(.5*(q*fe-1)),Ae=Math.floor(.5*(te*fe-1)),Pe=P.tileCoordToPixel(j,$),ze=2*me+1,$e=2*Ae+1,Xe=function(Ot,ct,vt,Nt,dt){return[Ot.getElevationAtPixel(ct,vt,!0),Ot.getElevationAtPixel(ct+dt,vt,!0),Ot.getElevationAtPixel(ct,vt+dt,!0),Ot.getElevationAtPixel(ct+Nt,vt+dt,!0)]}(P,Pe.x-me,Pe.y-Ae,ze,$e),rt=Math.abs(Xe[0]-Xe[1]),Qe=Math.abs(Xe[2]-Xe[3]),ut=Math.abs(Xe[0]-Xe[2])+Math.abs(Xe[1]-Xe[3]),At=Math.min(.25,.5*fe*(rt+Qe)/ze),ht=Math.min(.25,.5*fe*ut/$e);return pe+Math.max(At*q,ht*te)}(h,p,v):w;return{base:w+(o===0)?-1:o,top:E?Math.max(C+u,w+o+2):w+u}}Ve(Fw,"FillExtrusionBucket",{omit:["layers","features"]}),Ve(Zz,"PartData"),Ve(Hz,"FootprintSegment"),Ve(Xz,"BorderCentroidData"),Ve(Qz,"GroundEffect");const iQ=Rr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:sQ}=iQ,oQ=Rr([{name:"a_packed",components:4,type:"Float32"}]),{members:aQ}=oQ,lQ=Rr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:cQ}=lQ,uQ=Rr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hQ=Rr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),dQ=Rr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Rr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cN=Rr([{name:"a_z_offset",components:1,type:"Float32"}],4),fQ=Rr([{name:"a_texb",components:2,type:"Uint16"}]),pQ=Rr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),mQ=Rr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Rr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const uN=Rr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gQ=Rr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Rr([{name:"triangle",components:3,type:"Uint16"}]),Rr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Rr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Rr([{type:"Float32",name:"offsetX"}]),Rr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class hN{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new Bd({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const u=this.getKey(n,o);return this.positions[u]}trim(){const n=this.width,o=this.height=Ea(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,u){const h=[];let p=n.length%2==1?-n[n.length-1]*u:0,m=n[0]*u,v=!0;h.push({left:p,right:m,isDash:v,zeroLength:n[0]===0});let w=n[0];for(let E=1;E<n.length;E++){v=!v;const C=n[E];p=w*u,w+=C,m=w*u,h.push({left:p,right:m,isDash:v,zeroLength:C===0})}return h}addRoundDash(n,o,u){const h=o/2;for(let p=-u;p<=u;p++){const m=this.width*(this.nextRow+u+p);let v=0,w=n[v];for(let E=0;E<this.width;E++){E/w.right>1&&(w=n[++v]);const C=Math.abs(E-w.left),P=Math.abs(E-w.right),k=Math.min(C,P);let N;const j=p/u*(h+1);if(w.isDash){const $=h-Math.abs(j);N=Math.sqrt(k*k+$*$)}else N=h-Math.sqrt(k*k+j*j);this.image.data[m+E]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(n,o){for(let w=n.length-1;w>=0;--w){const E=n[w],C=n[w+1];E.zeroLength?n.splice(w,1):C&&C.isDash===E.isDash&&(C.left=E.left,n.splice(w,1))}const u=n[0],h=n[n.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const p=this.width*this.nextRow;let m=0,v=n[m];for(let w=0;w<this.width;w++){w/v.right>1&&(v=n[++m]);const E=Math.abs(w-v.left),C=Math.abs(w-v.right),P=Math.min(E,C);this.image.data[p+w]=Math.max(0,Math.min(255,(v.isDash?P:-P)+o+128))}}addDash(n,o){const u=this.getKey(n,o);if(this.positions[u])return this.positions[u];const h=o==="round",p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return bi("LineAtlas out of space"),null;n.length===0&&n.push(1);let v=0;for(let C=0;C<n.length;C++)n[C]<0&&(bi("Negative value is found in line dasharray, replacing values with 0"),n[C]=0),v+=n[C];if(v!==0){const C=this.width/v,P=this.getDashRanges(n,this.width,C);h?this.addRoundDash(P,C,p):this.addRegularDash(P,o==="square"?.5*C:0)}const w=this.nextRow+p;this.nextRow+=m;const E={tl:[w,p],br:[v,0]};return this.positions[u]=E,E}}Ve(hN,"LineAtlas");const _Q=kw.types,yQ=Math.cos(Math.PI/180*37.5),vQ=Math.cos(Math.PI/180*5);class Bw{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new VA,this.layoutVertexArray2=new Md,this.patternVertexArray=new kd,this.indexArray=new Fs,this.programConfigurations=new zd(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new gi,this.maxLineLength=0,this.zOffsetVertexArray=new qg,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:Ft/64}updateFootprints(n,o){}populate(n,o,u,h){this.hasPattern=MP("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),m=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!m.isConstant()||!!m.constantOr(0);const v=[];for(const{feature:P,id:k,index:N,sourceLayerIndex:j}of n){const $=this.layers[0]._featureFilter.needGeometry,q=yh(P,$);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),q,u))continue;const te=p?p.evaluate(q,{},u):void 0,pe={id:k,properties:P.properties,type:P.type,sourceLayerIndex:j,index:N,geometry:$?q.geometry:bc(P,u,h),patterns:{},sortKey:te};v.push(pe)}p&&v.sort((P,k)=>P.sortKey-k.sortKey);const{lineAtlas:w,featureIndex:E}=o,C=this.addConstantDashes(w);for(const P of v){const{geometry:k,index:N,sourceLayerIndex:j}=P;if(C&&this.addFeatureDashes(P,w),this.hasPattern){const $=kP("line",this.layers,P,this.zoom,o);this.patternFeatures.push($)}else this.addFeature(P,k,N,u,w.positions,o.availableImages,o.brightness);E.insert(n[N].feature,k,N,j,this.index)}}addConstantDashes(n){let o=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")o=!0;else{const m=p.value,v=h.value;if(!v)continue;n.addDash(v,m)}}return o}addFeatureDashes(n,o){const u=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let v,w;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:u},n);w=m.kind==="constant"?m.value:m.evaluate({zoom:u},n),o.addDash(v,w),n.patterns[h.id]=o.getKey(v,w)}}update(n,o,u,h,p){const m=Object.keys(n).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,o,m?this.stateDependentLayers:this.layers,u,h,p)}addFeatures(n,o,u,h,p,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,o,u,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,aQ)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,cQ)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,cN.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,sQ),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,u,h,p,m,v){const w=this.layers[0].layout,E=w.get("line-join").evaluate(n,{}),C=w.get("line-cap").evaluate(n,{}),P=w.get("line-miter-limit"),k=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const N of o)this.addLine(N,n,h,E,C,P,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,p,m,h,v)}addLine(n,o,u,h,p,m,v){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const w={zoom:this.zoom,lineProgress:void 0},E=this.layers[0].layout,C=h==="none";if(this.patternJoinNone=this.hasPattern&&C,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<n.length-1;Pe++)this.totalDistance+=n[Pe].dist(n[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=_Q[o.type]==="Polygon";let k=n.length;for(;k>=2&&n[k-1].equals(n[k-2]);)k--;let N=0;for(;N<k-1&&n[N].equals(n[N+1]);)N++;if(k<(P?3:2))return;h==="bevel"&&(m=1.05);const j=this.overscaling<=16?15*Ft/(512*this.overscaling):0,$=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let q,te,pe,fe,me,Ae;this.e1=this.e2=-1,P&&(q=n[k-2],me=n[N].sub(q)._unit()._perp());for(let Pe=N;Pe<k;Pe++){if(pe=Pe===k-1?P?n[N+1]:void 0:n[Pe+1],pe&&n[Pe].equals(pe))continue;if(me&&(fe=me),q&&(te=q),q=n[Pe],this.hasZOffset){const ct=E.get("line-z-offset").value;if(ct.kind==="constant")Ae=ct.value;else{if(this.lineClips){const vt=this.totalDistance/(this.lineClips.end-this.lineClips.start);w.lineProgress=(vt*this.lineClips.start+this.distance+(te?te.dist(q):0))/vt}else bi(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),w.lineProgress=0;Ae=ct.evaluate(w,o)}Ae=Ae||0}me=pe?pe.sub(q)._unit()._perp():fe,fe=fe||me;const ze=te&&pe;let $e=ze?h:P||C?"butt":p;const Xe=fe.x*me.x+fe.y*me.y;if(C){const ct=function(vt){if(vt.patternJoinNone){const Nt=vt.segmentPoints.length/2,dt=vt.lineSoFar-vt.segmentStart;for(let Ut=0;Ut<Nt;++Ut){const Lt=vt.segmentPoints[2*Ut+1],Rt=Math.round(vt.segmentPoints[2*Ut])+.5+.25*Lt;vt.patternVertexArray.emplaceBack(Rt,dt,vt.segmentStart),vt.patternVertexArray.emplaceBack(Rt,dt,vt.segmentStart)}vt.segmentPoints.length=0}vt.e1=vt.e2=-1};if(ze&&Xe<vQ){this.updateDistance(te,q),this.addCurrentVertex(q,fe,1,1,$,Ae),ct(this),this.addCurrentVertex(q,me,-1,-1,$,Ae);continue}if(te){if(!pe){this.updateDistance(te,q),this.addCurrentVertex(q,fe,1,1,$,Ae),ct(this);continue}$e="miter"}}let rt=fe.add(me);rt.x===0&&rt.y===0||rt._unit();const Qe=rt.x*me.x+rt.y*me.y,ut=Qe!==0?1/Qe:1/0,At=2*Math.sqrt(2-2*Qe),ht=Qe<yQ&&te&&pe,Ot=fe.x*me.y-fe.y*me.x>0;if(ht&&Pe>N){const ct=q.dist(te);if(ct>2*j){const vt=q.sub(q.sub(te)._mult(j/ct)._round());this.updateDistance(te,vt),this.addCurrentVertex(vt,fe,0,0,$,Ae),te=vt}}if(ze&&$e==="round"&&(ut<v?$e="miter":ut<=2&&($e="fakeround")),$e==="miter"&&ut>m&&($e="bevel"),$e==="bevel"&&(ut>2&&($e="flipbevel"),ut<m&&($e="miter")),te&&this.updateDistance(te,q),$e==="miter")rt._mult(ut),this.addCurrentVertex(q,rt,0,0,$,Ae);else if($e==="flipbevel"){if(ut>100)rt=me.mult(-1);else{const ct=ut*fe.add(me).mag()/fe.sub(me).mag();rt._perp()._mult(ct*(Ot?-1:1))}this.addCurrentVertex(q,rt,0,0,$,Ae),this.addCurrentVertex(q,rt.mult(-1),0,0,$,Ae)}else if($e==="bevel"||$e==="fakeround"){const ct=-Math.sqrt(ut*ut-1),vt=Ot?ct:0,Nt=Ot?0:ct;if(te&&this.addCurrentVertex(q,fe,vt,Nt,$,Ae),$e==="fakeround"){const dt=Math.round(180*At/Math.PI/20);for(let Ut=1;Ut<dt;Ut++){let Lt=Ut/dt;if(Lt!==.5){const bn=Lt-.5;Lt+=Lt*bn*(Lt-1)*((1.0904+Xe*(Xe*(3.55645-1.43519*Xe)-3.2452))*bn*bn+(.848013+Xe*(.215638*Xe-1.06021)))}const Rt=me.sub(fe)._mult(Lt)._add(fe)._unit()._mult(Ot?-1:1);this.addHalfVertex(q,Rt.x,Rt.y,!1,Ot,0,$,Ae)}}pe&&this.addCurrentVertex(q,me,-vt,-Nt,$,Ae)}else $e==="butt"?this.addCurrentVertex(q,rt,0,0,$,Ae):$e==="square"?(te||this.addCurrentVertex(q,rt,-1,-1,$,Ae),this.addCurrentVertex(q,rt,0,0,$,Ae),te&&this.addCurrentVertex(q,rt,1,1,$,Ae)):$e==="round"&&(te&&(this.addCurrentVertex(q,fe,0,0,$,Ae),this.addCurrentVertex(q,fe,1,1,$,Ae,!0)),pe&&(this.addCurrentVertex(q,me,-1,-1,$,Ae,!0),this.addCurrentVertex(q,me,0,0,$,Ae)));if(ht&&Pe<k-1){const ct=q.dist(pe);if(ct>2*j){const vt=q.add(pe.sub(q)._mult(j/ct)._round());this.updateDistance(q,vt),this.addCurrentVertex(vt,me,0,0,$,Ae),q=vt}}}}addVerticesTo(n,o,u,h,p,m,v,w,E,C){const P=(o.w-n.w)/this.tessellationStep|0;if(P>1){this.lineSoFar=n.w;const k=(o.x-n.x)/P,N=(o.y-n.y)/P,j=(o.z-n.z)/P,$=(o.w-n.w)/P;for(let q=1;q<P;++q)n.x+=k,n.y+=N,n.z+=j,this.lineSoFar+=$,this.addHalfVertex(n,u,h,C,!1,v,E,n.z),this.addHalfVertex(n,p,m,C,!0,-w,E,n.z)}this.lineSoFar=o.w,this.addHalfVertex(o,u,h,C,!1,v,E,o.z),this.addHalfVertex(o,p,m,C,!0,-w,E,o.z)}addCurrentVertex(n,o,u,h,p,m,v=!1){const w=o.x+o.y*u,E=o.y-o.x*u,C=o.y*h-o.x,P=-o.y-o.x*h;if(m!=null){const N=Ft+10,j=m,$=new Az(n.x,n.y,j,this.lineSoFar),q=dN(n,-10,N),te=this.lineSoFar;if(this.currentVertex)if(q){const pe=this.currentVertexIsOutside,fe=this.currentVertex,me=new Az(n.x,n.y,j,this.lineSoFar);Rz(fe,me,-10,N),dN(me,-10,N)||(pe&&(this.e1=this.e2=-1,this.lineSoFar=fe.w,this.addHalfVertex(fe,w,E,v,!1,u,p,fe.z),this.addHalfVertex(fe,C,P,v,!0,-h,p,fe.z)),this.addVerticesTo(fe,me,w,E,C,P,u,h,p,v))}else{const pe=this.currentVertex;this.currentVertexIsOutside&&(Rz(pe,$,-10,N),this.e1=this.e2=-1,this.lineSoFar=pe.w,this.addHalfVertex(pe,w,E,v,!1,u,p,pe.z),this.addHalfVertex(pe,C,P,v,!0,-h,p,pe.z)),this.addVerticesTo(pe,$,w,E,C,P,u,h,p,v)}else q||(this.addHalfVertex(n,w,E,v,!1,u,p,m),this.addHalfVertex(n,C,P,v,!0,-h,p,m));this.currentVertex=$,this.currentVertexIsOutside=q,this.lineSoFar=te}else this.addHalfVertex(n,w,E,v,!1,u,p,m),this.addHalfVertex(n,C,P,v,!0,-h,p,m)}addHalfVertex({x:n,y:o},u,h,p,m,v,w,E){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((n<<1)+(p?1:0),(o<<1)+(m?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),m?this.e2=C:this.e1=C,E!=null&&this.zOffsetVertexArray.emplaceBack(E)}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,o){this.distance+=n.dist(o),this.updateScaledDistance()}}function dN(i,n,o){return i.x<n||i.x>o||i.y<n||i.y>o}let fN,pN;function mN(i,n,o){return n*(Ft/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}function gN(i,n){return 1/mN(i,1,n.tileZoom)}function _N(i,n,o,u){return i.translatePosMatrix(u||n.tileID.projMatrix,n,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}Ve(Bw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const yN=i=>{const n=[];vN(i)&&n.push("RENDER_LINE_DASH"),i.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const o=i.paint.get("line-trim-offset");o[0]===0&&o[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),i.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const u=i.layout.get("line-join").constantOr("miter")==="none",h=!!i.paint.get("line-pattern").constantOr(1);return u&&h&&n.push("LINE_JOIN_NONE"),n};function vN(i){const n=i.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}class xN{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const u=n[o];this._stringToNumber[u]=o,this._numberToString[o]=u}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}var xQ={read:function(i,n,o,u,h){var p,m,v=8*h-u-1,w=(1<<v)-1,E=w>>1,C=-7,P=o?h-1:0,k=o?-1:1,N=i[n+P];for(P+=k,p=N&(1<<-C)-1,N>>=-C,C+=v;C>0;p=256*p+i[n+P],P+=k,C-=8);for(m=p&(1<<-C)-1,p>>=-C,C+=u;C>0;m=256*m+i[n+P],P+=k,C-=8);if(p===0)p=1-E;else{if(p===w)return m?NaN:1/0*(N?-1:1);m+=Math.pow(2,u),p-=E}return(N?-1:1)*m*Math.pow(2,p-u)},write:function(i,n,o,u,h,p){var m,v,w,E=8*p-h-1,C=(1<<E)-1,P=C>>1,k=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,N=u?0:p-1,j=u?1:-1,$=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(v=isNaN(n)?1:0,m=C):(m=Math.floor(Math.log(n)/Math.LN2),n*(w=Math.pow(2,-m))<1&&(m--,w*=2),(n+=m+P>=1?k/w:k*Math.pow(2,1-P))*w>=2&&(m++,w/=2),m+P>=C?(v=0,m=C):m+P>=1?(v=(n*w-1)*Math.pow(2,h),m+=P):(v=n*Math.pow(2,P-1)*Math.pow(2,h),m=0));h>=8;i[o+N]=255&v,N+=j,v/=256,h-=8);for(m=m<<h|v,E+=h;E>0;i[o+N]=255&m,N+=j,m/=256,E-=8);i[o+N-j]|=128*$}},bN=ui,jw=xQ;function ui(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}ui.Varint=0,ui.Fixed64=1,ui.Bytes=2,ui.Fixed32=5;var FP=4294967296,wN=1/FP,TN=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function bh(i){return i.type===ui.Bytes?i.readVarint()+i.pos:i.pos+1}function t_(i,n,o){return o?4294967296*n+(i>>>0):4294967296*(n>>>0)+(i>>>0)}function EN(i,n,o){var u=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(u);for(var h=o.pos-1;h>=i;h--)o.buf[h+u]=o.buf[h]}function bQ(i,n){for(var o=0;o<i.length;o++)n.writeVarint(i[o])}function wQ(i,n){for(var o=0;o<i.length;o++)n.writeSVarint(i[o])}function TQ(i,n){for(var o=0;o<i.length;o++)n.writeFloat(i[o])}function EQ(i,n){for(var o=0;o<i.length;o++)n.writeDouble(i[o])}function SQ(i,n){for(var o=0;o<i.length;o++)n.writeBoolean(i[o])}function IQ(i,n){for(var o=0;o<i.length;o++)n.writeFixed32(i[o])}function CQ(i,n){for(var o=0;o<i.length;o++)n.writeSFixed32(i[o])}function AQ(i,n){for(var o=0;o<i.length;o++)n.writeFixed64(i[o])}function PQ(i,n){for(var o=0;o<i.length;o++)n.writeSFixed64(i[o])}function Uw(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+16777216*i[n+3]}function n_(i,n,o){i[o]=n,i[o+1]=n>>>8,i[o+2]=n>>>16,i[o+3]=n>>>24}function SN(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+(i[n+3]<<24)}ui.prototype={destroy:function(){this.buf=null},readFields:function(i,n,o){for(o=o||this.length;this.pos<o;){var u=this.readVarint(),h=u>>3,p=this.pos;this.type=7&u,i(h,n,this),this.pos===p&&this.skip(u)}return n},readMessage:function(i,n){return this.readFields(i,n,this.readVarint()+this.pos)},readFixed32:function(){var i=Uw(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=SN(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Uw(this.buf,this.pos)+Uw(this.buf,this.pos+4)*FP;return this.pos+=8,i},readSFixed64:function(){var i=Uw(this.buf,this.pos)+SN(this.buf,this.pos+4)*FP;return this.pos+=8,i},readFloat:function(){var i=jw.read(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=jw.read(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var n,o,u=this.buf;return n=127&(o=u[this.pos++]),o<128?n:(n|=(127&(o=u[this.pos++]))<<7,o<128?n:(n|=(127&(o=u[this.pos++]))<<14,o<128?n:(n|=(127&(o=u[this.pos++]))<<21,o<128?n:function(h,p,m){var v,w,E=m.buf;if(v=(112&(w=E[m.pos++]))>>4,w<128||(v|=(127&(w=E[m.pos++]))<<3,w<128)||(v|=(127&(w=E[m.pos++]))<<10,w<128)||(v|=(127&(w=E[m.pos++]))<<17,w<128)||(v|=(127&(w=E[m.pos++]))<<24,w<128)||(v|=(1&(w=E[m.pos++]))<<31,w<128))return t_(h,v,p);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(o=u[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,n=this.pos;return this.pos=i,i-n>=12&&TN?function(o,u,h){return TN.decode(o.subarray(u,h))}(this.buf,n,i):function(o,u,h){for(var p="",m=u;m<h;){var v,w,E,C=o[m],P=null,k=C>239?4:C>223?3:C>191?2:1;if(m+k>h)break;k===1?C<128&&(P=C):k===2?(192&(v=o[m+1]))==128&&(P=(31&C)<<6|63&v)<=127&&(P=null):k===3?(w=o[m+2],(192&(v=o[m+1]))==128&&(192&w)==128&&((P=(15&C)<<12|(63&v)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):k===4&&(w=o[m+2],E=o[m+3],(192&(v=o[m+1]))==128&&(192&w)==128&&(192&E)==128&&((P=(15&C)<<18|(63&v)<<12|(63&w)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,k=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),m+=k}return p}(this.buf,n,i)},readBytes:function(){var i=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,i);return this.pos=i,n},readPackedVarint:function(i,n){if(this.type!==ui.Bytes)return i.push(this.readVarint(n));var o=bh(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(n));return i},readPackedSVarint:function(i){if(this.type!==ui.Bytes)return i.push(this.readSVarint());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==ui.Bytes)return i.push(this.readBoolean());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==ui.Bytes)return i.push(this.readFloat());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==ui.Bytes)return i.push(this.readDouble());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==ui.Bytes)return i.push(this.readFixed32());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==ui.Bytes)return i.push(this.readSFixed32());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==ui.Bytes)return i.push(this.readFixed64());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==ui.Bytes)return i.push(this.readSFixed64());var n=bh(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed64());return i},skip:function(i){var n=7&i;if(n===ui.Varint)for(;this.buf[this.pos++]>127;);else if(n===ui.Bytes)this.pos=this.readVarint()+this.pos;else if(n===ui.Fixed32)this.pos+=4;else{if(n!==ui.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(i,n){this.writeVarint(i<<3|n)},realloc:function(i){for(var n=this.length||16;n<this.pos+i;)n*=2;if(n!==this.length){var o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),n_(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),n_(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),n_(this.buf,-1&i,this.pos),n_(this.buf,Math.floor(i*wN),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),n_(this.buf,-1&i,this.pos),n_(this.buf,Math.floor(i*wN),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(n,o){var u,h;if(n>=0?(u=n%4294967296|0,h=n/4294967296|0):(h=~(-n/4294967296),4294967295^(u=~(-n%4294967296))?u=u+1|0:(u=0,h=h+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(p,m,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(u,0,o),function(p,m){var v=(7&p)<<4;m.buf[m.pos++]|=v|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(h,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var n=this.pos;this.pos=function(u,h,p){for(var m,v,w=0;w<h.length;w++){if((m=h.charCodeAt(w))>55295&&m<57344){if(!v){m>56319||w+1===h.length?(u[p++]=239,u[p++]=191,u[p++]=189):v=m;continue}if(m<56320){u[p++]=239,u[p++]=191,u[p++]=189,v=m;continue}m=v-55296<<10|m-56320|65536,v=null}else v&&(u[p++]=239,u[p++]=191,u[p++]=189,v=null);m<128?u[p++]=m:(m<2048?u[p++]=m>>6|192:(m<65536?u[p++]=m>>12|224:(u[p++]=m>>18|240,u[p++]=m>>12&63|128),u[p++]=m>>6&63|128),u[p++]=63&m|128)}return p}(this.buf,i,this.pos);var o=this.pos-n;o>=128&&EN(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),jw.write(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),jw.write(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var n=i.length;this.writeVarint(n),this.realloc(n);for(var o=0;o<n;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,n){this.pos++;var o=this.pos;i(n,this);var u=this.pos-o;u>=128&&EN(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeMessage:function(i,n,o){this.writeTag(i,ui.Bytes),this.writeRawMessage(n,o)},writePackedVarint:function(i,n){n.length&&this.writeMessage(i,bQ,n)},writePackedSVarint:function(i,n){n.length&&this.writeMessage(i,wQ,n)},writePackedBoolean:function(i,n){n.length&&this.writeMessage(i,SQ,n)},writePackedFloat:function(i,n){n.length&&this.writeMessage(i,TQ,n)},writePackedDouble:function(i,n){n.length&&this.writeMessage(i,EQ,n)},writePackedFixed32:function(i,n){n.length&&this.writeMessage(i,IQ,n)},writePackedSFixed32:function(i,n){n.length&&this.writeMessage(i,CQ,n)},writePackedFixed64:function(i,n){n.length&&this.writeMessage(i,AQ,n)},writePackedSFixed64:function(i,n){n.length&&this.writeMessage(i,PQ,n)},writeBytesField:function(i,n){this.writeTag(i,ui.Bytes),this.writeBytes(n)},writeFixed32Field:function(i,n){this.writeTag(i,ui.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(i,n){this.writeTag(i,ui.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(i,n){this.writeTag(i,ui.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(i,n){this.writeTag(i,ui.Fixed64),this.writeSFixed64(n)},writeVarintField:function(i,n){this.writeTag(i,ui.Varint),this.writeVarint(n)},writeSVarintField:function(i,n){this.writeTag(i,ui.Varint),this.writeSVarint(n)},writeStringField:function(i,n){this.writeTag(i,ui.Bytes),this.writeString(n)},writeFloatField:function(i,n){this.writeTag(i,ui.Fixed32),this.writeFloat(n)},writeDoubleField:function(i,n){this.writeTag(i,ui.Fixed64),this.writeDouble(n)},writeBooleanField:function(i,n){this.writeVarintField(i,!!n)}};var av=de(bN);const RQ=["id","tile","layer","source","sourceLayer","state"];class IN{constructor(n,o,u,h,p){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=u,this._y=h,this.properties=n.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const o of RQ)this[o]!==void 0&&(n[o]=this[o]);return n}}class MQ{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,u){const h=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][h]=this.stateChanges[n][h]||{},Is(this.stateChanges[n][h],u),this.deletedStates[n]===null){this.deletedStates[n]={};for(const p in this.state[n])p!==h&&(this.deletedStates[n][p]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][h]===null){this.deletedStates[n][h]={};for(const p in this.state[n][h])u[p]||(this.deletedStates[n][h][p]=null)}else for(const p in u)this.deletedStates[n]&&this.deletedStates[n][h]&&this.deletedStates[n][h][p]===null&&delete this.deletedStates[n][h][p]}removeFeatureState(n,o,u){if(this.deletedStates[n]===null)return;const h=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},u&&o!==void 0)this.deletedStates[n][h]!==null&&(this.deletedStates[n][h]=this.deletedStates[n][h]||{},this.deletedStates[n][h][u]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][h])for(u in this.deletedStates[n][h]={},this.stateChanges[n][h])this.deletedStates[n][h][u]=null;else this.deletedStates[n][h]=null;else this.deletedStates[n]=null}getState(n,o){const u=String(o),h=Is({},(this.state[n]||{})[u],(this.stateChanges[n]||{})[u]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const p=this.deletedStates[n][o];if(p===null)return{};for(const m in p)delete h[m]}return h}initializeTileState(n,o){n.setFeatureState(this.state,o)}coalesceChanges(n,o){const u={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),Is(this.state[h][m],this.stateChanges[h][m]),p[m]=this.state[h][m];u[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const m in this.state[h])p[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(const v of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][v];p[m]=this.state[h][m]}u[h]=u[h]||{},Is(u[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const h in n)n[h].setFeatureState(u,o)}}class CN{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new et(Ft,16,0),this.featureIndexArray=new wL,this.promoteId=o,this.is3DTile=!1}insert(n,o,u,h,p,m=0,v=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,p,m);const E=this.grid;for(let C=0;C<o.length;C++){const P=o[C],k=[1/0,1/0,-1/0,-1/0];for(let N=0;N<P.length;N++){const j=P[N];k[0]=Math.min(k[0],j.x),k[1]=Math.min(k[1],j.y),k[2]=Math.max(k[2],j.x),k[3]=Math.max(k[3],j.y)}v!==0&&(k[0]-=v,k[1]-=v,k[2]+=v,k[3]+=v),k[0]<Ft&&k[1]<Ft&&k[2]>=0&&k[3]>=0&&E.insert(w,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new DP(new av(this.rawTileData)).layers,this.sourceLayerCoder=new xN(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o,u,h){this.loadVTLayers();const p=n.params||{},m=yc(p.filter),v=n.tileResult,w=n.transform,E=v.bufferedTilespaceBounds,C=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(j,$,q,te)=>UL(v.bufferedTilespaceGeometry,j,$,q,te));C.sort(kQ);let P=null;w.elevation&&C.length>0&&(P=e_.create(w.elevation,this.tileID));const k={};let N;for(let j=0;j<C.length;j++){const $=C[j];if($===N)continue;N=$;const q=this.featureIndexArray.get($);let te=null;if(this.is3DTile){const pe=this.bucketLayerIDs[0][0],fe=o[pe];if(fe.type!=="model")continue;const{queryFeature:me,intersectionZ:Ae}=fe.queryIntersectsMatchingFeature(v,q.featureIndex,m,w);me&&this.appendToResult(k,pe,q.featureIndex,me,Ae)}else this.loadMatchingFeature(k,q,m,p.layers,p.availableImages,o,u,h,(pe,fe,me,Ae=0)=>(te||(te=bc(pe,this.tileID.canonical,n.tileTransform)),fe.queryIntersectsFeature(v,pe,me,te,this.z,n.transform,n.pixelPosMatrix,P,Ae)))}return k}loadMatchingFeature(n,o,u,h,p,m,v,w,E){const{featureIndex:C,bucketIndex:P,sourceLayerIndex:k,layoutVertexArrayOffset:N}=o,j=this.bucketLayerIDs[P];if(h&&!function(pe,fe){for(let me=0;me<pe.length;me++)if(fe.indexOf(pe[me])>=0)return!0;return!1}(h,j))return;const $=this.sourceLayerCoder.decode(k),q=this.vtLayers[$].feature(C);if(u.needGeometry){const pe=yh(q,!0);if(!u.filter(new Rn(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!u.filter(new Rn(this.tileID.overscaledZ),q))return;const te=this.getId(q,$);for(let pe=0;pe<j.length;pe++){const fe=j[pe];if(h&&h.indexOf(fe)<0)continue;const me=m[fe];if(!me)continue;let Ae={};te!==void 0&&w&&(Ae=w.getState(me.sourceLayer||"_geojsonTileLayer",te));const Pe=!E||E(q,me,Ae,N);if(!Pe)continue;const ze=new IN(q,this.z,this.x,this.y,te),$e=Is({},v[fe]);$e.paint=AN($e.paint,me.paint,q,Ae,p),$e.layout=AN($e.layout,me.layout,q,Ae,p),ze.layer=$e,this.appendToResult(n,fe,C,ze,Pe)}}appendToResult(n,o,u,h,p){let m=n[o];m===void 0&&(m=n[o]=[]),m.push({featureIndex:u,feature:h,intersectionZ:p})}lookupSymbolFeatures(n,o,u,h,p,m,v,w){const E={};this.loadVTLayers();const C=yc(p);for(const P of n)this.loadMatchingFeature(E,{bucketIndex:u,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},C,m,v,w,o);return E}loadFeature(n){const{featureIndex:o,sourceLayerIndex:u}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),p=this.vtFeatures[h];if(p[o])return p[o];const m=this.vtLayers[h].feature(o);return p[o]=m,m}hasLayer(n){for(const o of this.bucketLayerIDs)for(const u of o)if(n===u)return!0;return!1}getId(n,o){let u=n.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];h!=null&&(u=n.properties[h]),typeof u=="boolean"&&(u=Number(u))}return u}}function AN(i,n,o,u,h){return eu(i,(p,m)=>{const v=n instanceof Ws?n.get(m):null;return v&&v.evaluate?v.evaluate(o,u,h):v})}function kQ(i,n){return n-i}Ve(CN,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var oo=24;const wc=128;function BP(i,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Rn(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:h}=o;let p=0;for(;p<u.length&&u[p]<=i;)p++;p=Math.max(0,p-1);let m=p;for(;m<u.length&&u[m]<i+1;)m++;m=Math.min(u.length-1,m);const v=u[p],w=u[m];return o.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:o.evaluate(new Rn(v)),maxSize:o.evaluate(new Rn(w)),interpolationType:h}}}function Vw(i,{uSize:n,uSizeT:o},{lowerSize:u,upperSize:h}){return i.kind==="source"?u/wc:i.kind==="composite"?Sn(u/wc,h/wc,o):n}function r_(i,n){let o=0,u=0;if(i.kind==="constant")u=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:m}=i,v=h?Hn(ha.interpolationFactor(h,n,p,m),0,1):0;i.kind==="camera"?u=Sn(i.minSize,i.maxSize,v):o=v}return{uSizeT:o,uSize:u}}var OQ=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:wc,evaluateSizeForFeature:Vw,evaluateSizeForZoom:r_,getSizeData:BP});function DQ(i,n,o){return i.sections.forEach(u=>{u.text=function(h,p,m){const v=p.layout.get("text-transform").evaluate(m,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),nr.applyArabicShaping&&(h=nr.applyArabicShaping(h)),h}(u.text,n,o)}),i}const lv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function LQ(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function zQ(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}const jP=3;function NQ(i,n,o){n.glyphs=[],i===1&&o.readMessage(FQ,n)}function FQ(i,n,o){if(i===3){const{id:u,bitmap:h,width:p,height:m,left:v,top:w,advance:E}=o.readMessage(BQ,{});n.glyphs.push({id:u,bitmap:new Bd({width:p+2*jP,height:m+2*jP},h),metrics:{width:p,height:m,left:v,top:w,advance:E}})}else i===4?n.ascender=o.readSVarint():i===5&&(n.descender=o.readSVarint())}function BQ(i,n,o){i===1?n.id=o.readVarint():i===2?n.bitmap=o.readBytes():i===3?n.width=o.readVarint():i===4?n.height=o.readVarint():i===5?n.left=o.readSVarint():i===6?n.top=o.readSVarint():i===7&&(n.advance=o.readVarint())}const PN=jP,el={horizontal:1,vertical:2,horizontalOnly:3};class cv{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,o){const u=new cv;return u.scale=n||1,u.fontStack=o,u}static forImage(n){const o=new cv;return o.imageName=n,o}}class i_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){const u=new i_;for(let h=0;h<n.sections.length;h++){const p=n.sections[h];p.image?u.addImageSection(p):u.addTextSection(p,o)}return u}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(o,u){let h="";for(let p=0;p<o.length;p++){const m=o.charCodeAt(p+1)||null,v=o.charCodeAt(p-1)||null;h+=!u&&(m&&sn(m)&&!lv[o[p+1]]||v&&sn(v)&&!lv[o[p-1]])||!lv[o[p]]?o[p]:lv[o[p]]}return h}(this.text,n)}trim(){let n=0;for(let u=0;u<this.text.length&&$w[this.text.charCodeAt(u)];u++)n++;let o=this.text.length;for(let u=this.text.length-1;u>=0&&u>=n&&$w[this.text.charCodeAt(u)];u--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const u=new i_;return u.text=this.text.substring(n,o),u.sectionIndex=this.sectionIndex.slice(n,o),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(cv.forText(n.scale,n.fontStack||o));const u=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(u)}addImageSection(n){const o=n.image?n.image.namePrimary:"";if(o.length===0)return void bi("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(cv.forImage(o)),this.sectionIndex.push(this.sections.length-1)):bi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function UP(i,n,o,u,h,p,m,v,w,E,C,P,k,N,j){const $=i_.fromFeature(i,h);P===el.vertical&&$.verticalizePunctuation(k);let q=[];const te=function(Pe,ze,$e,Xe,rt,Qe){if(!Pe)return[];const ut=[],At=function(vt,Nt,dt,Ut,Lt,Rt){let bn=0;for(let fn=0;fn<vt.length();fn++){const Jt=vt.getSection(fn);bn+=RN(vt.getCodePoint(fn),Jt,Ut,Lt,Nt,Rt)}return bn/Math.max(1,Math.ceil(bn/dt))}(Pe,ze,$e,Xe,rt,Qe),ht=Pe.text.indexOf("")>=0;let Ot=0;for(let vt=0;vt<Pe.length();vt++){const Nt=Pe.getSection(vt),dt=Pe.getCodePoint(vt);if($w[dt]||(Ot+=RN(dt,Nt,Xe,rt,ze,Qe)),vt<Pe.length()-1){const Ut=!((ct=dt)<11904||!(je["Bopomofo Extended"](ct)||je.Bopomofo(ct)||je["CJK Compatibility Forms"](ct)||je["CJK Compatibility Ideographs"](ct)||je["CJK Compatibility"](ct)||je["CJK Radicals Supplement"](ct)||je["CJK Strokes"](ct)||je["CJK Symbols and Punctuation"](ct)||je["CJK Unified Ideographs Extension A"](ct)||je["CJK Unified Ideographs"](ct)||je["Enclosed CJK Letters and Months"](ct)||je["Halfwidth and Fullwidth Forms"](ct)||je.Hiragana(ct)||je["Ideographic Description Characters"](ct)||je["Kangxi Radicals"](ct)||je["Katakana Phonetic Extensions"](ct)||je.Katakana(ct)||je["Vertical Forms"](ct)||je["Yi Radicals"](ct)||je["Yi Syllables"](ct)));(jQ[dt]||Ut||Nt.imageName)&&ut.push(kN(vt+1,Ot,At,ut,UQ(dt,Pe.getCodePoint(vt+1),Ut&&ht),!1))}}var ct;return ON(kN(Pe.length(),Ot,At,ut,0,!0))}($,E,p,n,u,N),{processBidirectionalText:pe,processStyledBidirectionalText:fe}=nr;if(pe&&$.sections.length===1){const Pe=pe($.toString(),te);for(const ze of Pe){const $e=new i_;$e.text=ze,$e.sections=$.sections;for(let Xe=0;Xe<ze.length;Xe++)$e.sectionIndex.push(0);q.push($e)}}else if(fe){const Pe=fe($.text,$.sectionIndex,te);for(const ze of Pe){const $e=new i_;$e.text=ze[0],$e.sectionIndex=ze[1],$e.sections=$.sections,q.push($e)}}else q=function(Pe,ze){const $e=[],Xe=Pe.text;let rt=0;for(const Qe of ze)$e.push(Pe.substring(rt,Qe)),rt=Qe;return rt<Xe.length&&$e.push(Pe.substring(rt,Xe.length)),$e}($,te);const me=[],Ae={positionedLines:me,text:$.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Pe,ze,$e,Xe,rt,Qe,ut,At,ht,Ot,ct,vt){let Nt=0,dt=0,Ut=0;const Lt=At==="right"?1:At==="left"?0:.5;let Rt=!1;for(const gn of rt){const on=gn.getSections();for(const zn of on){if(zn.imageName)continue;const Bn=ze[zn.fontStack];if(Bn&&(Rt=Bn.ascender!==void 0&&Bn.descender!==void 0,!Rt))break}if(!Rt)break}let bn=0;for(const gn of rt){gn.trim();const on=gn.getMaxScale(),zn=(on-1)*oo,Bn={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[bn]=Bn;const Nn=Bn.positionedGlyphs;let Wn=0;if(!gn.length()){dt+=Qe,++bn;continue}let gr=0,sr=0;for(let $r=0;$r<gn.length();$r++){const jn=gn.getSection($r),Mr=gn.getSectionIndex($r),Dr=gn.getCodePoint($r);let Jr=jn.scale,Oi=null,Hi=null,Di=null,wi=oo,Bs=0;const ls=!(ht===el.horizontal||!ct&&!Gt(Dr)||ct&&($w[Dr]||(fn=Dr,je.Arabic(fn)||je["Arabic Supplement"](fn)||je["Arabic Extended-A"](fn)||je["Arabic Presentation Forms-A"](fn)||je["Arabic Presentation Forms-B"](fn))));if(jn.imageName){const ao=Xe[jn.imageName];if(!ao)continue;Di=jn.imageName,Pe.iconsInText=Pe.iconsInText||!0,Hi=ao.paddedRect;const Kr=ao.displaySize;Jr=Jr*oo/vt,Oi={width:Kr[0],height:Kr[1],left:0,top:-PN,advance:ls?Kr[1]:Kr[0],localGlyph:!1},Bs=Rt?-Oi.height*Jr:on*oo-17-Kr[1]*Jr,wi=Oi.advance;const pa=(ls?Kr[0]:Kr[1])*Jr-oo*on;pa>0&&pa>Wn&&(Wn=pa)}else{const ao=$e[jn.fontStack];if(!ao)continue;ao[Dr]&&(Hi=ao[Dr]);const Kr=ze[jn.fontStack];if(!Kr)continue;const pa=Kr.glyphs[Dr];if(!pa)continue;if(Oi=pa.metrics,wi=Dr!==8203?oo:0,Rt){const Ac=Kr.ascender!==void 0?Math.abs(Kr.ascender):0,Dl=Kr.descender!==void 0?Math.abs(Kr.descender):0,Ll=(Ac+Dl)*Jr;gr<Ll&&(gr=Ll,sr=(Ac-Dl)/2*Jr),Bs=-Ac*Jr}else Bs=(on-Jr)*oo-17}ls?(Pe.verticalizable=!0,Nn.push({glyph:Dr,imageName:Di,x:Nt,y:dt+Bs,vertical:ls,scale:Jr,localGlyph:Oi.localGlyph,fontStack:jn.fontStack,sectionIndex:Mr,metrics:Oi,rect:Hi}),Nt+=wi*Jr+Ot):(Nn.push({glyph:Dr,imageName:Di,x:Nt,y:dt+Bs,vertical:ls,scale:Jr,localGlyph:Oi.localGlyph,fontStack:jn.fontStack,sectionIndex:Mr,metrics:Oi,rect:Hi}),Nt+=Oi.advance*Jr+Ot)}Nn.length!==0&&(Ut=Math.max(Nt-Ot,Ut),Rt?DN(Nn,Lt,Wn,sr,Qe*on/2):DN(Nn,Lt,Wn,0,Qe/2)),Nt=0;const Br=Qe*on+Wn;Bn.lineOffset=Math.max(Wn,zn),dt+=Br,++bn}var fn;const Jt=dt,{horizontalAlign:Bt,verticalAlign:Pn}=VP(ut);(function(gn,on,zn,Bn,Nn,Wn){const gr=(on-zn)*Nn,sr=-Wn*Bn;for(const Br of gn)for(const $r of Br.positionedGlyphs)$r.x+=gr,$r.y+=sr})(Pe.positionedLines,Lt,Bt,Pn,Ut,Jt),Pe.top+=-Pn*Jt,Pe.bottom=Pe.top+Jt,Pe.left+=-Bt*Ut,Pe.right=Pe.left+Ut,Pe.hasBaseline=Rt}(Ae,n,o,u,q,m,v,w,P,E,k,j),!function(Pe){for(const ze of Pe)if(ze.positionedGlyphs.length!==0)return!1;return!0}(me)&&Ae}const $w={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},jQ={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function RN(i,n,o,u,h,p){if(n.imageName){const m=u[n.imageName];return m?m.displaySize[0]*n.scale*oo/p+h:0}{const m=o[n.fontStack],v=m&&m.glyphs[i];return v?v.metrics.advance*n.scale+h:0}}function MN(i,n,o,u){const h=Math.pow(i-n,2);return u?i<n?h/2:2*h:h+Math.abs(o)*o}function UQ(i,n,o){let u=0;return i===10&&(u-=1e4),o&&(u+=150),i!==40&&i!==65288||(u+=50),n!==41&&n!==65289||(u+=50),u}function kN(i,n,o,u,h,p){let m=null,v=MN(n,o,h,p);for(const w of u){const E=MN(n-w.x,o,h,p)+w.badness;E<=v&&(m=w,v=E)}return{index:i,x:n,priorBreak:m,badness:v}}function ON(i){return i?ON(i.priorBreak).concat(i.index):[]}function VP(i){let n=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function DN(i,n,o,u,h){if(!(n||o||u||h))return;const p=i.length-1,m=i[p],v=(m.x+m.metrics.advance*m.scale)*n;for(let w=0;w<=p;w++)i[w].x-=v,i[w].y+=o+u+h}function VQ(i,n,o,u){const{horizontalAlign:h,verticalAlign:p}=VP(u),m=o[0]-i.displaySize[0]*h,v=o[1]-i.displaySize[1]*p;return{imagePrimary:i,imageSecondary:n,top:v,bottom:v+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function LN(i,n,o,u,h,p){const m=i.imagePrimary;let v;if(m.content){const q=m.content,te=m.pixelRatio||1;v=[q[0]/te,q[1]/te,m.displaySize[0]-q[2]/te,m.displaySize[1]-q[3]/te]}const w=n.left*p,E=n.right*p;let C,P,k,N;o==="width"||o==="both"?(N=h[0]+w-u[3],P=h[0]+E+u[1]):(N=h[0]+(w+E-m.displaySize[0])/2,P=N+m.displaySize[0]);const j=n.top*p,$=n.bottom*p;return o==="height"||o==="both"?(C=h[1]+j-u[0],k=h[1]+$+u[2]):(C=h[1]+(j+$-m.displaySize[1])/2,k=C+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:C,right:P,bottom:k,left:N,collisionPadding:v}}class wh extends jt{constructor(n,o,u,h,p){super(n,o),this.angle=h,this.z=u,p!==void 0&&(this.segment=p)}clone(){return new wh(this.x,this.y,this.z,this.angle,this.segment)}}function zN(i,n,o,u,h){if(n.segment===void 0)return!0;let p=n,m=n.segment+1,v=0;for(;v>-o/2;){if(m--,m<0)return!1;v-=i[m].dist(p),p=i[m]}v+=i[m].dist(i[m+1]),m++;const w=[];let E=0;for(;v<o/2;){const C=i[m],P=i[m+1];if(!P)return!1;let k=i[m-1].angleTo(C)-C.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:k}),E+=k;v-w[0].distance>u;)E-=w.shift().angleDelta;if(E>h)return!1;m++,v+=C.dist(P)}return!0}function NN(i){let n=0;for(let o=0;o<i.length-1;o++)n+=i[o].dist(i[o+1]);return n}function FN(i,n,o){return i?.6*n*o:0}function BN(i,n){return Math.max(i?i.right-i.left:0,n?n.right-n.left:0)}function $Q(i,n,o,u,h,p){const m=FN(o,h,p),v=BN(o,u)*p;let w=0;const E=NN(i)/2;for(let C=0;C<i.length-1;C++){const P=i[C],k=i[C+1],N=P.dist(k);if(w+N>E){const j=(E-w)/N,$=Sn(P.x,k.x,j),q=Sn(P.y,k.y,j),te=new wh($,q,0,k.angleTo(P),C);return!m||zN(i,te,v,m,n)?te:void 0}w+=N}}function qQ(i,n,o,u,h,p,m,v,w){const E=FN(u,p,m),C=BN(u,h),P=C*m,k=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return n-P<n/4&&(n=P+n/4),jN(i,k?n/2*v%n:(C/2+2*p)*m*v%n,n,E,o,P,k,!1,w)}function jN(i,n,o,u,h,p,m,v,w){const E=p/2,C=NN(i);let P=0,k=n-o,N=[];for(let j=0;j<i.length-1;j++){const $=i[j],q=i[j+1],te=$.dist(q),pe=q.angleTo($);for(;k+o<P+te;){k+=o;const fe=(k-P)/te,me=Sn($.x,q.x,fe),Ae=Sn($.y,q.y,fe);if(me>=0&&me<w&&Ae>=0&&Ae<w&&k-E>=0&&k+E<=C){const Pe=new wh(me,Ae,0,pe,j);u&&!zN(i,Pe,p,u,h)||N.push(Pe)}}P+=te}return v||N.length||m||(N=jN(i,P/2,o,u,h,p,m,!0,w)),N}function UN(i,n,o,u,h){const p=[];for(let m=0;m<i.length;m++){const v=i[m];let w;for(let E=0;E<v.length-1;E++){let C=v[E],P=v[E+1];C.x<n&&P.x<n||(C.x<n?C=new jt(n,C.y+(n-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<n&&(P=new jt(n,C.y+(n-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<o&&P.y<o||(C.y<o?C=new jt(C.x+(o-C.y)/(P.y-C.y)*(P.x-C.x),o)._round():P.y<o&&(P=new jt(C.x+(o-C.y)/(P.y-C.y)*(P.x-C.x),o)._round()),C.x>=u&&P.x>=u||(C.x>=u?C=new jt(u,C.y+(u-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=u&&(P=new jt(u,C.y+(u-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=h&&P.y>=h||(C.y>=h?C=new jt(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round():P.y>=h&&(P=new jt(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round()),w&&C.equals(w[w.length-1])||(w=[C],p.push(w)),w.push(P)))))}}return p}function VN(i){let n=0,o=0;for(const m of i)n+=m.w*m.h,o=Math.max(o,m.w);i.sort((m,v)=>v.h-m.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let h=0,p=0;for(const m of i)for(let v=u.length-1;v>=0;v--){const w=u[v];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,p=Math.max(p,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===w.w&&m.h===w.h){const E=u.pop();v<u.length&&(u[v]=E)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(u.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:h,h:p,fill:n/(h*p)||0}}Ve(wh,"Anchor");const Aa=1;class $P{constructor(n,{pixelRatio:o,version:u,stretchX:h,stretchY:p,content:m}){this.paddedRect=n,this.pixelRatio=o,this.stretchX=h,this.stretchY=p,this.content=m,this.version=u}get tl(){return[this.paddedRect.x+Aa,this.paddedRect.y+Aa]}get br(){return[this.paddedRect.x+this.paddedRect.w-Aa,this.paddedRect.y+this.paddedRect.h-Aa]}get displaySize(){return[(this.paddedRect.w-2*Aa)/this.pixelRatio,(this.paddedRect.h-2*Aa)/this.pixelRatio]}}class $N{constructor(n,o,u){const h={},p={};this.haveRenderCallbacks=[];const m=[];this.addImages(n,h,m),this.addImages(o,p,m);const{w:v,h:w}=VN(m),E=new Ja({width:v||1,height:w||1});for(const C in n){const P=n[C],k=h[C].paddedRect;Ja.copy(P.data,E,{x:0,y:0},{x:k.x+Aa,y:k.y+Aa},P.data,u,P.sdf)}for(const C in o){const P=o[C],k=p[C].paddedRect,N=k.x+Aa,j=k.y+Aa,$=P.data.width,q=P.data.height;Ja.copy(P.data,E,{x:0,y:0},{x:N,y:j},P.data,u),Ja.copy(P.data,E,{x:0,y:q-1},{x:N,y:j-1},{width:$,height:1},u),Ja.copy(P.data,E,{x:0,y:0},{x:N,y:j+q},{width:$,height:1},u),Ja.copy(P.data,E,{x:$-1,y:0},{x:N-1,y:j},{width:1,height:q},u),Ja.copy(P.data,E,{x:0,y:0},{x:N+$,y:j},{width:1,height:q},u)}this.image=E,this.iconPositions=h,this.patternPositions=p}addImages(n,o,u){for(const h in n){const p=n[h],m={x:0,y:0,w:p.data.width+2*Aa,h:p.data.height+2*Aa};u.push(m),o[h]=new $P(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,o,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>n.hasImage(h,u)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h in n.getUpdatedImages(u))this.patchUpdatedImage(this.iconPositions[h],n.getImage(h,u),o),this.patchUpdatedImage(this.patternPositions[h],n.getImage(h,u),o)}patchUpdatedImage(n,o,u){if(!n||!o||n.version===o.version)return;n.version=o.version;const[h,p]=n.tl,m=!!Object.keys(this.patternPositions).length;u.update(o.data,{useMipmap:m},{x:h,y:p})}}Ve($P,"ImagePosition"),Ve($N,"ImageAtlas");const uv=1e20;function qN(i,n,o,u,h,p,m,v,w){for(let E=n;E<n+u;E++)GN(i,o*p+E,p,h,m,v,w);for(let E=o;E<o+h;E++)GN(i,E*p+n,1,u,m,v,w)}function GN(i,n,o,u,h,p,m){p[0]=0,m[0]=-uv,m[1]=uv,h[0]=i[n];for(let v=1,w=0,E=0;v<u;v++){h[v]=i[n+v*o];const C=v*v;do{const P=p[w];E=(h[v]-h[P]+C-P*P)/(v-P)/2}while(E<=m[w]&&--w>-1);w++,p[w]=v,m[w]=E,m[w+1]=uv}for(let v=0,w=0;v<u;v++){for(;m[w+1]<v;)w++;const E=p[w],C=v-E;i[n+v*o]=h[E]+C*C}}const Tc=2,qP={none:0,ideographs:1,all:2};class s_{constructor(n,o,u){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=u,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,o){this.urls[o]=n}getGlyphs(n,o,u){const h=[],p=this.urls[o]||D.GLYPHS_URL;for(const m in n)for(const v of n[m])h.push({stack:m,id:v});eh(h,({stack:m,id:v},w)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=E.glyphs[v];if(C!==void 0)return void w(null,{stack:m,id:v,glyph:C});if(C=this._tinySDF(E,m,v),C)return E.glyphs[v]=C,void w(null,{stack:m,id:v,glyph:C});const P=Math.floor(v/256);if(256*P>65535)return void w(new Error("glyphs > 65535 not supported"));if(E.ranges[P])return void w(null,{stack:m,id:v,glyph:C});let k=E.requests[P];k||(k=E.requests[P]=[],s_.loadGlyphRange(m,P,p,this.requestManager,(N,j)=>{if(j){E.ascender=j.ascender,E.descender=j.descender;for(const $ in j.glyphs)this._doesCharSupportLocalGlyph(+$)||(E.glyphs[+$]=j.glyphs[+$]);E.ranges[P]=!0}for(const $ of k)$(N,j);delete E.requests[P]})),k.push((N,j)=>{N?w(N):j&&w(null,{stack:m,id:v,glyph:j.glyphs[v]||null})})},(m,v)=>{if(m)u(m);else if(v){const w={};for(const{stack:E,id:C,glyph:P}of v)w[E]===void 0&&(w[E]={}),w[E].glyphs===void 0&&(w[E].glyphs={}),w[E].glyphs[C]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},w[E].ascender=this.entries[E].ascender,w[E].descender=this.entries[E].descender;u(null,w)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==qP.none&&(this.localGlyphMode===qP.all?!!this.localFontFamily:!!this.localFontFamily&&(je["CJK Unified Ideographs"](n)||je["Hangul Syllables"](n)||je.Hiragana(n)||je.Katakana(n)||je["CJK Symbols and Punctuation"](n)||je["CJK Unified Ideographs Extension A"](n)||je["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,o,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let p=n.tinySDF;if(!p){let $="400";/bold/i.test(o)?$="900":/medium/i.test(o)?$="500":/light/i.test(o)&&($="200"),p=n.tinySDF=new s_.TinySDF({fontFamily:h,fontWeight:$,fontSize:24*Tc,buffer:3*Tc,radius:8*Tc}),p.fontWeight=$}if(this.localGlyphs[p.fontWeight][u])return this.localGlyphs[p.fontWeight][u];const m=String.fromCodePoint(u),{data:v,width:w,height:E,glyphWidth:C,glyphHeight:P,glyphLeft:k,glyphTop:N,glyphAdvance:j}=p.draw(m);return this.localGlyphs[p.fontWeight][u]={id:u,bitmap:new Bd({width:w,height:E},v),metrics:{width:C/Tc,height:P/Tc,left:k/Tc,top:N/Tc-27,advance:j/Tc,localGlyph:!0}}}}s_.loadGlyphRange=function(i,n,o,u,h){const p=256*n,m=p+255,v=u.transformRequest(u.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",`${p}-${m}`),ip.Glyphs);nh(v,(w,E)=>{if(w)h(w);else if(E){const C={},P=function(k){return new av(k).readFields(NQ,{})}(E);for(const k of P.glyphs)C[k.id]=k;h(null,{glyphs:C,ascender:P.ascender,descender:P.descender})}})},s_.TinySDF=class{constructor({fontSize:i=24,buffer:n=3,radius:o=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=n,this.cutoff=u,this.radius=o;const v=this.size=i+4*n,w=this._createCanvas(v),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${p} ${i}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const n=document.createElement("canvas");return n.width=n.height=i,n}draw(i){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(i),m=Math.ceil(o),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),w=Math.min(this.size-this.buffer,m+Math.ceil(u)),E=v+2*this.buffer,C=w+2*this.buffer,P=Math.max(E*C,0),k=new Uint8ClampedArray(P),N={data:k,width:E,height:C,glyphWidth:v,glyphHeight:w,glyphTop:m,glyphLeft:0,glyphAdvance:n};if(v===0||w===0)return N;const{ctx:j,buffer:$,gridInner:q,gridOuter:te}=this;j.clearRect($,$,v,w),j.fillText(i,$,$+m);const pe=j.getImageData($,$,v,w);te.fill(uv,0,P),q.fill(0,0,P);for(let fe=0;fe<w;fe++)for(let me=0;me<v;me++){const Ae=pe.data[4*(fe*v+me)+3]/255;if(Ae===0)continue;const Pe=(fe+$)*E+me+$;if(Ae===1)te[Pe]=0,q[Pe]=uv;else{const ze=.5-Ae;te[Pe]=ze>0?ze*ze:0,q[Pe]=ze<0?ze*ze:0}}qN(te,0,0,E,C,E,this.f,this.v,this.z),qN(q,$,$,v,w,E,this.f,this.v,this.z);for(let fe=0;fe<P;fe++){const me=Math.sqrt(te[fe])-Math.sqrt(q[fe]);k[fe]=Math.round(255-255*(me/this.radius+this.cutoff))}return N}};const Vd=Aa;function WN(i,n,o,u){const h=[],p=i.imagePrimary,m=p.pixelRatio,v=p.paddedRect.w-2*Vd,w=p.paddedRect.h-2*Vd,E=i.right-i.left,C=i.bottom-i.top,P=p.stretchX||[[0,v]],k=p.stretchY||[[0,w]],N=(Qe,ut)=>Qe+ut[1]-ut[0],j=P.reduce(N,0),$=k.reduce(N,0),q=v-j,te=w-$;let pe=0,fe=j,me=0,Ae=$,Pe=0,ze=q,$e=0,Xe=te;if(p.content&&u){const Qe=p.content;pe=qw(P,0,Qe[0]),me=qw(k,0,Qe[1]),fe=qw(P,Qe[0],Qe[2]),Ae=qw(k,Qe[1],Qe[3]),Pe=Qe[0]-pe,$e=Qe[1]-me,ze=Qe[2]-Qe[0]-fe,Xe=Qe[3]-Qe[1]-Ae}const rt=(Qe,ut,At,ht)=>{const Ot=Gw(Qe.stretch-pe,fe,E,i.left),ct=Ww(Qe.fixed-Pe,ze,Qe.stretch,j),vt=Gw(ut.stretch-me,Ae,C,i.top),Nt=Ww(ut.fixed-$e,Xe,ut.stretch,$),dt=Gw(At.stretch-pe,fe,E,i.left),Ut=Ww(At.fixed-Pe,ze,At.stretch,j),Lt=Gw(ht.stretch-me,Ae,C,i.top),Rt=Ww(ht.fixed-$e,Xe,ht.stretch,$),bn=new jt(Ot,vt),fn=new jt(dt,vt),Jt=new jt(dt,Lt),Bt=new jt(Ot,Lt),Pn=new jt(ct/m,Nt/m),gn=new jt(Ut/m,Rt/m),on=n*Math.PI/180;if(on){const sr=Math.sin(on),Br=Math.cos(on),$r=[Br,-sr,sr,Br];bn._matMult($r),fn._matMult($r),Bt._matMult($r),Jt._matMult($r)}const zn=Qe.stretch+Qe.fixed,Bn=At.stretch+At.fixed,Nn=ut.stretch+ut.fixed,Wn=ht.stretch+ht.fixed,gr=i.imageSecondary;return{tl:bn,tr:fn,bl:Bt,br:Jt,texPrimary:{x:p.paddedRect.x+Vd+zn,y:p.paddedRect.y+Vd+Nn,w:Bn-zn,h:Wn-Nn},texSecondary:gr?{x:gr.paddedRect.x+Vd+zn,y:gr.paddedRect.y+Vd+Nn,w:Bn-zn,h:Wn-Nn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pn,pixelOffsetBR:gn,minFontScaleX:ze/m/E,minFontScaleY:Xe/m/C,isSDF:o}};if(u&&(p.stretchX||p.stretchY)){const Qe=HN(P,q,j),ut=HN(k,te,$);for(let At=0;At<Qe.length-1;At++){const ht=Qe[At],Ot=Qe[At+1];for(let ct=0;ct<ut.length-1;ct++)h.push(rt(ht,ut[ct],Ot,ut[ct+1]))}}else h.push(rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function qw(i,n,o){let u=0;for(const h of i)u+=Math.max(n,Math.min(o,h[1]))-Math.max(n,Math.min(o,h[0]));return u}function HN(i,n,o){const u=[{fixed:-Vd,stretch:0}];for(const[h,p]of i){const m=u[u.length-1];u.push({fixed:h-m.stretch,stretch:m.stretch}),u.push({fixed:h-m.stretch,stretch:m.stretch+(p-h)})}return u.push({fixed:n+Vd,stretch:o}),u}function Gw(i,n,o,u){return i/n*o+u}function Ww(i,n,o,u){return i-n*o/u}function GQ(i,n,o,u){const h=n+i.positionedLines[u].lineOffset;return u===0?o+h/2:o+(h+(n+i.positionedLines[u-1].lineOffset))/2}function WQ(i,n=1,o=!1){let u=1/0,h=1/0,p=-1/0,m=-1/0;const v=i[0];for(let N=0;N<v.length;N++){const j=v[N];(!N||j.x<u)&&(u=j.x),(!N||j.y<h)&&(h=j.y),(!N||j.x>p)&&(p=j.x),(!N||j.y>m)&&(m=j.y)}const w=Math.min(p-u,m-h);let E=w/2;const C=new au([],HQ);if(w===0)return new jt(u,h);for(let N=u;N<p;N+=w)for(let j=h;j<m;j+=w)C.push(new o_(N+E,j+E,E,i));let P=function(N){let j=0,$=0,q=0;const te=N[0];for(let pe=0,fe=te.length,me=fe-1;pe<fe;me=pe++){const Ae=te[pe],Pe=te[me],ze=Ae.x*Pe.y-Pe.x*Ae.y;$+=(Ae.x+Pe.x)*ze,q+=(Ae.y+Pe.y)*ze,j+=3*ze}return new o_($/j,q/j,0,N)}(i),k=C.length;for(;C.length;){const N=C.pop();(N.d>P.d||!P.d)&&(P=N,o&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,k)),N.max-P.d<=n||(E=N.h/2,C.push(new o_(N.p.x-E,N.p.y-E,E,i)),C.push(new o_(N.p.x+E,N.p.y-E,E,i)),C.push(new o_(N.p.x-E,N.p.y+E,E,i)),C.push(new o_(N.p.x+E,N.p.y+E,E,i)),k+=4)}return o&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function HQ(i,n){return n.max-i.max}class o_{constructor(n,o,u,h){this.p=new jt(n,o),this.h=u,this.d=function(p,m){let v=!1,w=1/0;for(let E=0;E<m.length;E++){const C=m[E];for(let P=0,k=C.length,N=k-1;P<k;N=P++){const j=C[P],$=C[N];j.y>p.y!=$.y>p.y&&p.x<($.x-j.x)*(p.y-j.y)/($.y-j.y)+j.x&&(v=!v),w=Math.min(w,BL(p,j,$))}}return(v?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const GP=Number.POSITIVE_INFINITY,ZQ=Math.sqrt(2);function ZN(i,[n,o]){let u=0,h=0;if(o===GP){n<0&&(n=0);const p=n/ZQ;switch(i){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-n;break;case"top":h=n-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=n;break;case"right":u=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),i){case"top-right":case"top-left":case"top":h=o-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-o}switch(i){case"top-right":case"bottom-right":case"right":u=-n;break;case"top-left":case"bottom-left":case"left":u=n}}return[u,h]}function WP(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function XQ(i,n,o,u,h,p,m,v,w,E,C,P,k,N,j){let $=p.textMaxSize.evaluate(n,{},P);$===void 0&&($=m);const q=i.layers[0].layout,te=q.get("icon-offset").evaluate(n,{},P),pe=KN(o.horizontal)||o.vertical,fe=k.name==="globe",me=oo,Ae=m/me,Pe=i.tilePixelRatio*$/me,ze=(Ot=i.overscaling,i.zoom>18&&Ot>2&&(Ot>>=1),Math.max(Ft/(512*Ot),1)*q.get("symbol-spacing")),$e=q.get("text-padding")*i.tilePixelRatio,Xe=q.get("icon-padding")*i.tilePixelRatio,rt=tr(q.get("text-max-angle")),Qe=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",ut=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",At=q.get("symbol-placement"),ht=ze/2;var Ot;const ct=q.get("icon-text-fit").evaluate(n,{},P),vt=q.get("icon-text-fit-padding").evaluate(n,{},P),Nt=ct!=="none";let dt;i.hasAnyIconTextFit===!1&&Nt&&(i.hasAnyIconTextFit=!0),u&&Nt&&(i.allowVerticalPlacement&&o.vertical&&(dt=LN(u,o.vertical,ct,vt,te,Ae)),pe&&(u=LN(u,pe,ct,vt,te,Ae)));const Ut=(Lt,Rt,bn)=>{if(Rt.x<0||Rt.x>=Ft||Rt.y<0||Rt.y>=Ft)return;let fn=null;if(fe){const{x:Jt,y:Bt,z:Pn}=k.projectTilePoint(Rt.x,Rt.y,bn);fn={anchor:new wh(Jt,Bt,Pn,0,void 0),up:k.upVector(bn,Rt.x,Rt.y)}}(function(Jt,Bt,Pn,gn,on,zn,Bn,Nn,Wn,gr,sr,Br,$r,jn,Mr,Dr,Jr,Oi,Hi,Di,wi,Bs,ls,ao,Kr,pa,Ac){const Dl=Jt.addToLineVertexArray(Bt,gn);let Ll,Wp,Zd,Hp,Rv,dB,fB,pB=0,mB=0,gB=0,_B=0,b3=-1,w3=-1;const _u={};let yB=_g("");const Zp=Pn?Pn.anchor:Bt,T3=Wn.layout.get("icon-text-fit").evaluate(wi,{},Kr)!=="none";let E3=0,S3=0;if(Wn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[E3,S3]=Wn.layout.get("text-offset").evaluate(wi,{},Kr).map(Ra=>Ra*oo):(E3=Wn.layout.get("text-radial-offset").evaluate(wi,{},Kr)*oo,S3=GP),Jt.allowVerticalPlacement&&on.vertical){const Ra=on.vertical;if(Mr)dB=HP(Ra),Nn&&(fB=HP(Nn));else{const Ma=Wn.layout.get("text-rotate").evaluate(wi,{},Kr)+90;Zd=Hw(gr,Zp,Bt,sr,Br,$r,Ra,jn,Ma,Dr),Nn&&(Hp=Hw(gr,Zp,Bt,sr,Br,$r,Nn,Oi,Ma))}}if(zn){const Ra=Wn.layout.get("icon-rotate").evaluate(wi,{},Kr),Ma=WN(zn,Ra,ls,T3),m_=Nn?WN(Nn,Ra,ls,T3):void 0;Wp=Hw(gr,Zp,Bt,sr,Br,$r,zn,Oi,Ra),pB=4*Ma.length;const vB=Jt.iconSizeData;let Xp=null;vB.kind==="source"?(Xp=[wc*Wn.layout.get("icon-size").evaluate(wi,{},Kr)],Xp[0]>$d&&bi(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${hv}. Reduce your "icon-size".`)):vB.kind==="composite"&&(Xp=[wc*Bs.compositeIconSizes[0].evaluate(wi,{},Kr),wc*Bs.compositeIconSizes[1].evaluate(wi,{},Kr)],(Xp[0]>$d||Xp[1]>$d)&&bi(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${hv}. Reduce your "icon-size".`)),Jt.addSymbols(Jt.icon,Ma,Xp,Di,Hi,wi,!1,Pn,Bt,Dl.lineStartIndex,Dl.lineLength,-1,ao,Kr,pa,Ac),b3=Jt.icon.placedSymbolArray.length-1,m_&&(mB=4*m_.length,Jt.addSymbols(Jt.icon,m_,Xp,Di,Hi,wi,el.vertical,Pn,Bt,Dl.lineStartIndex,Dl.lineLength,-1,ao,Kr,pa,Ac),w3=Jt.icon.placedSymbolArray.length-1)}for(const Ra in on.horizontal){const Ma=on.horizontal[Ra];Ll||(yB=_g(Ma.text),Mr?Rv=HP(Ma):Ll=Hw(gr,Zp,Bt,sr,Br,$r,Ma,jn,Wn.layout.get("text-rotate").evaluate(wi,{},Kr),Dr));const m_=Ma.positionedLines.length===1;if(gB+=XN(Jt,Pn,Bt,Ma,Bn,Wn,Mr,wi,Dr,Dl,on.vertical?el.horizontal:el.horizontalOnly,m_?Object.keys(on.horizontal):[Ra],_u,b3,Bs,ao,Kr,pa),m_)break}on.vertical&&(_B+=XN(Jt,Pn,Bt,on.vertical,Bn,Wn,Mr,wi,Dr,Dl,el.vertical,["vertical"],_u,w3,Bs,ao,Kr,pa));let Xd=-1;const I3=(Ra,Ma)=>Ra?Math.max(Ra,Ma):Ma;Xd=I3(Rv,Xd),Xd=I3(dB,Xd),Xd=I3(fB,Xd);const cJ=Xd>-1?1:0;Jt.glyphOffsetArray.length>=65535&&bi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),wi.sortKey!==void 0&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,wi.sortKey),Jt.symbolInstances.emplaceBack(Bt.x,Bt.y,Zp.x,Zp.y,Zp.z,_u.right>=0?_u.right:-1,_u.center>=0?_u.center:-1,_u.left>=0?_u.left:-1,_u.vertical>=0?_u.vertical:-1,b3,w3,yB,Ll!==void 0?Ll:Jt.collisionBoxArray.length,Ll!==void 0?Ll+1:Jt.collisionBoxArray.length,Zd!==void 0?Zd:Jt.collisionBoxArray.length,Zd!==void 0?Zd+1:Jt.collisionBoxArray.length,Wp!==void 0?Wp:Jt.collisionBoxArray.length,Wp!==void 0?Wp+1:Jt.collisionBoxArray.length,Hp||Jt.collisionBoxArray.length,Hp?Hp+1:Jt.collisionBoxArray.length,sr,gB,_B,pB,mB,cJ,0,E3,S3,Xd,0,T3?1:0)})(i,Rt,fn,Lt,o,u,h,dt,i.layers[0],i.collisionBoxArray,n.index,n.sourceLayerIndex,i.index,$e,Qe,w,0,Xe,ut,te,n,p,E,C,P,N,j)};if(At==="line")for(const Lt of UN(n.geometry,0,0,Ft,Ft)){const Rt=qQ(Lt,ze,rt,o.vertical||pe,u,me,Pe,i.overscaling,Ft);for(const bn of Rt)pe&&KQ(i,pe.text,ht,bn)||Ut(Lt,bn,P)}else if(At==="line-center"){for(const Lt of n.geometry)if(Lt.length>1){const Rt=$Q(Lt,rt,o.vertical||pe,u,me,Pe);Rt&&Ut(Lt,Rt,P)}}else if(n.type==="Polygon")for(const Lt of Pw(n.geometry,0)){const Rt=WQ(Lt,16);Ut(Lt[0],new wh(Rt.x,Rt.y,0,0,void 0),P)}else if(n.type==="LineString")for(const Lt of n.geometry)Ut(Lt,new wh(Lt[0].x,Lt[0].y,0,0,void 0),P);else if(n.type==="Point")for(const Lt of n.geometry)for(const Rt of Lt)Ut([Rt],new wh(Rt.x,Rt.y,0,0,void 0),P)}const hv=255,$d=hv*wc;function XN(i,n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q,te){const pe=function(Ae,Pe,ze,$e,Xe,rt,Qe,ut){const At=[];if(Pe.positionedLines.length===0)return At;const ht=$e.layout.get("text-rotate").evaluate(rt,{})*Math.PI/180,Ot=function(Ut){const Lt=Ut[0],Rt=Ut[1],bn=Lt*Rt;return bn>0?[Lt,-Rt]:bn<0?[-Lt,Rt]:Lt===0?[Rt,Lt]:[Rt,-Lt]}(ze);let ct=Math.abs(Pe.top-Pe.bottom);for(const Ut of Pe.positionedLines)ct-=Ut.lineOffset;const vt=Pe.positionedLines.length,Nt=ct/vt;let dt=Pe.top-ze[1];for(let Ut=0;Ut<vt;++Ut){const Lt=Pe.positionedLines[Ut];dt=GQ(Pe,Nt,dt,Ut);for(const Rt of Lt.positionedGlyphs){if(!Rt.rect)continue;const bn=Rt.rect||{};let fn=PN+1,Jt=!0,Bt=1,Pn=0;if(Rt.imageName){const Di=Qe[Rt.imageName];if(!Di)continue;if(Di.sdf){bi("SDF images are not supported in formatted text and will be ignored.");continue}Jt=!1,Bt=Di.pixelRatio,fn=Aa/Bt}const gn=(Xe||ut)&&Rt.vertical,on=Rt.metrics.advance*Rt.scale/2,zn=Rt.metrics,Bn=Rt.rect;if(Bn===null)continue;ut&&Pe.verticalizable&&(Pn=Rt.imageName?on-Rt.metrics.width*Rt.scale/2:0);const Nn=Xe?[Rt.x+on,Rt.y]:[0,0];let Wn=[0,0],gr=[0,0],sr=!1;Xe||(gn?(gr=[Rt.x+on+Ot[0],Rt.y+Ot[1]-Pn],sr=!0):Wn=[Rt.x+on+ze[0],Rt.y+ze[1]-Pn]);const Br=Bn.w*Rt.scale/(Bt*(Rt.localGlyph?Tc:1)),$r=Bn.h*Rt.scale/(Bt*(Rt.localGlyph?Tc:1));let jn,Mr,Dr,Jr;if(gn){const Di=Rt.y-dt,wi=new jt(-on,on-Di),Bs=-Math.PI/2,ls=new jt(...gr);jn=new jt(-on+Wn[0],Wn[1]),jn._rotateAround(Bs,wi)._add(ls),jn.x+=-Di+on,jn.y-=(zn.left-fn)*Rt.scale;const ao=Rt.imageName?zn.advance*Rt.scale:oo*Rt.scale,Kr=String.fromCodePoint(Rt.glyph);LQ(Kr)?jn.x+=(1-fn)*Rt.scale:zQ(Kr)?jn.x+=ao-zn.height*Rt.scale+(-fn-1)*Rt.scale:jn.x+=Rt.imageName||zn.width+2*fn===Bn.w&&zn.height+2*fn===Bn.h?(ao-$r)/2:(ao-(zn.height+2*fn)*Rt.scale)/2,Mr=new jt(jn.x,jn.y-Br),Dr=new jt(jn.x+$r,jn.y),Jr=new jt(jn.x+$r,jn.y-Br)}else{const Di=(zn.left-fn)*Rt.scale-on+Wn[0],wi=(-zn.top-fn)*Rt.scale+Wn[1],Bs=Di+Br,ls=wi+$r;jn=new jt(Di,wi),Mr=new jt(Bs,wi),Dr=new jt(Di,ls),Jr=new jt(Bs,ls)}if(ht){let Di;Di=Xe?new jt(0,0):sr?new jt(Ot[0],Ot[1]):new jt(ze[0],ze[1]),jn._rotateAround(ht,Di),Mr._rotateAround(ht,Di),Dr._rotateAround(ht,Di),Jr._rotateAround(ht,Di)}const Oi=new jt(0,0),Hi=new jt(0,0);At.push({tl:jn,tr:Mr,bl:Dr,br:Jr,texPrimary:bn,texSecondary:void 0,writingMode:Pe.writingMode,glyphOffset:Nn,sectionIndex:Rt.sectionIndex,isSDF:Jt,pixelOffsetTL:Oi,pixelOffsetBR:Hi,minFontScaleX:0,minFontScaleY:0})}}return At}(0,u,w,p,m,v,h,i.allowVerticalPlacement),fe=i.textSizeData;let me=null;fe.kind==="source"?(me=[wc*p.layout.get("text-size").evaluate(v,{},q)],me[0]>$d&&bi(`${i.layerIds[0]}: Value for "text-size" is >= ${hv}. Reduce your "text-size".`)):fe.kind==="composite"&&(me=[wc*j.compositeTextSizes[0].evaluate(v,{},q),wc*j.compositeTextSizes[1].evaluate(v,{},q)],(me[0]>$d||me[1]>$d)&&bi(`${i.layerIds[0]}: Value for "text-size" is >= ${hv}. Reduce your "text-size".`)),i.addSymbols(i.text,pe,me,w,m,v,C,n,o,E.lineStartIndex,E.lineLength,N,$,q,te,!1);for(const Ae of P)k[Ae]=i.text.placedSymbolArray.length-1;return 4*pe.length}function KN(i){for(const n in i)return i[n];return null}function Hw(i,n,o,u,h,p,m,v,w,E){let C=m.top,P=m.bottom,k=m.left,N=m.right;const j=m.collisionPadding;if(j&&(k-=j[0],C-=j[1],N+=j[2],P+=j[3]),w){const $=new jt(k,C),q=new jt(N,C),te=new jt(k,P),pe=new jt(N,P),fe=tr(w);let me=new jt(0,0);E&&(me=new jt(E[0],E[1])),$._rotateAround(fe,me),q._rotateAround(fe,me),te._rotateAround(fe,me),pe._rotateAround(fe,me),k=Math.min($.x,q.x,te.x,pe.x),N=Math.max($.x,q.x,te.x,pe.x),C=Math.min($.y,q.y,te.y,pe.y),P=Math.max($.y,q.y,te.y,pe.y)}return i.emplaceBack(n.x,n.y,n.z,o.x,o.y,k,C,N,P,v,u,h,p),i.length-1}function HP(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const n=i.bottom-i.top;return n>0?Math.max(10,n):null}function KQ(i,n,o,u){const h=i.compareText;if(n in h){const p=h[n];for(let m=p.length-1;m>=0;m--)if(u.dist(p[m])<o)return!0}else h[n]=[];return h[n].push(u),!1}function QN(i,n){const o=i.fovAboveCenter,u=i.elevation?i.elevation.getMinElevationBelowMSL()*n:0,h=(i._camera.position[2]*i.worldSize-u)/Math.cos(i._pitch),p=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-i._pitch-o,.01)),m=Math.sin(i._pitch)*p+h;return Math.min(1.01*m,h*(1/i._horizonShift))}function jp(i,n){if(!n.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:n};const o=Math.pow(2,-i.z),u=i.x*o,h=(i.x+1)*o,p=i.y*o,m=(i.y+1)*o,v=fa(u),w=fa(h),E=Hs(p),C=Hs(m),P=n.project(v,E),k=n.project(w,E),N=n.project(w,C),j=n.project(v,C);let $=Math.min(P.x,k.x,N.x,j.x),q=Math.min(P.y,k.y,N.y,j.y),te=Math.max(P.x,k.x,N.x,j.x),pe=Math.max(P.y,k.y,N.y,j.y);const fe=o/16;function me(Pe,ze,$e,Xe,rt,Qe){const ut=($e+rt)/2,At=(Xe+Qe)/2,ht=n.project(fa(ut),Hs(At)),Ot=Math.max(0,$-ht.x,q-ht.y,ht.x-te,ht.y-pe);$=Math.min($,ht.x),te=Math.max(te,ht.x),q=Math.min(q,ht.y),pe=Math.max(pe,ht.y),Ot>fe&&(me(Pe,ht,$e,Xe,ut,At),me(ht,ze,ut,At,rt,Qe))}me(P,k,u,p,h,p),me(k,N,h,p,h,m),me(N,j,h,m,u,m),me(j,P,u,m,u,p),$-=fe,q-=fe,te+=fe,pe+=fe;const Ae=1/Math.max(te-$,pe-q);return{scale:Ae,x:$*Ae,y:q*Ae,x2:te*Ae,y2:pe*Ae,projection:n}}function YN(i,{x:n,y:o},u=0){return new jt(((n-u)*i.scale-i.x)*Ft,(o*i.scale-i.y)*Ft)}const QQ=a.ae.identity(new Float32Array(16));class qd{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new Tr(0,0)}projectTilePoint(n,o,u){return{x:n,y:o,z:0}}locationPoint(n,o,u=!0){return n._coordinatePoint(n.locationCoordinate(o),u)}pixelsPerMeter(n,o){return Vo(1,n)*o}pixelSpaceConversion(n,o,u){return 1}farthestPixelDistance(n){return QN(n,n.pixelsPerMeter)}pointCoordinate(n,o,u,h){const p=n.horizonLineFromTop(!1),m=new jt(o,Math.max(p,u));return n.rayIntersectionCoordinate(n.pointRayIntersection(m,h))}pointCoordinate3D(n,o,u){const h=new jt(o,u);if(n.elevation)return n.elevation.pointCoordinate(h);{const p=this.pointCoordinate(n,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(n,o){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,o.x,o.y);const u=n.horizonLineFromTop();return o.y<u}createInversionMatrix(n,o){return QQ}createTileMatrix(n,o,u){let h,p,m;const v=u.canonical,w=a.ae.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=jp(v,this);h=1,p=E.x+u.wrap*E.scale,m=E.y,a.ae.scale(w,w,[h/E.scale,h/E.scale,n.pixelsPerMeter/o])}else h=o/n.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*u.wrap)*h,m=v.y*h;return a.ae.translate(w,w,[p,m,0]),a.ae.scale(w,w,[h/Ft,h/Ft,1]),w}upVector(n,o,u){return[0,0,1]}upVectorScale(n,o,u){return{metersToTile:1}}}class YQ extends qd{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,u]=this.parallels=n.parallels||[29.5,45.5],h=Math.sin(tr(o));this.n=(h+Math.sin(tr(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:u,c:h,r0:p}=this,m=tr(n-this.center[0]),v=tr(o),w=Math.sqrt(h-2*u*Math.sin(v))/u;return{x:w*Math.sin(m*u),y:w*Math.cos(m*u)-p,z:0}}unproject(n,o){const{n:u,c:h,r0:p}=this,m=p+o;let v=Math.atan2(n,Math.abs(m))*Math.sign(m);m*u<0&&(v-=Math.PI*Math.sign(n)*Math.sign(m));const w=tr(this.center[0])*u;v=sc(v,-Math.PI-w,Math.PI-w);const E=Hn(eo(v/u)+this.center[0],-180,180),C=Math.asin(Hn((h-(n*n+m*m)*u*u)/(2*u),-1,1)),P=Hn(eo(C),-Ui,Ui);return new Tr(E,P)}}const dv=1.340264,fv=-.081106,pv=893e-6,mv=.003796,Zw=Math.sqrt(3)/2;class JQ extends qd{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const u=Math.asin(Zw*Math.sin(o)),h=u*u,p=h*h*h;return{x:.5*(n*Math.cos(u)/(Zw*(dv+3*fv*h+p*(7*pv+9*mv*h)))/Math.PI+.5),y:1-.5*(u*(dv+fv*h+p*(pv+mv*h))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,h=u*u,p=h*h*h;for(let C,P,k,N=0;N<12&&(P=u*(dv+fv*h+p*(pv+mv*h))-o,k=dv+3*fv*h+p*(7*pv+9*mv*h),C=P/k,u=Hn(u-C,-Math.PI/3,Math.PI/3),h=u*u,p=h*h*h,!(Math.abs(C)<1e-12));++N);const m=Zw*n*(dv+3*fv*h+p*(7*pv+9*mv*h))/Math.cos(u),v=Math.asin(Math.sin(u)/Zw),w=Hn(180*m/Math.PI,-180,180),E=Hn(180*v/Math.PI,-Ui,Ui);return new Tr(w,E)}}class eY extends qd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const u=360*(n-.5),h=Hn(360*(.5-o),-Ui,Ui);return new Tr(u,h)}}const a_=Math.PI/2;function Xw(i){return Math.tan((a_+i)/2)}class tY extends qd{constructor(n){super(n),this.center=n.center||[0,30];const[o,u]=this.parallels=n.parallels||[30,30];let h=tr(o),p=tr(u);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const m=Math.cos(h),v=Xw(h);this.n=h===p?Math.sin(h):Math.log(m/Math.cos(p))/Math.log(Xw(p)/v),this.f=m*Math.pow(Xw(h),this.n)/this.n}project(n,o){o=tr(o),this.southernCenter&&(o=-o),n=tr(n-this.center[0]);const u=1e-6,{n:h,f:p}=this;p>0?o<-a_+u&&(o=-a_+u):o>a_-u&&(o=a_-u);const m=p/Math.pow(Xw(o),h);let v=m*Math.sin(h*n),w=p-m*Math.cos(h*n);return v=.5*(v/Math.PI+.5),w=.5*(w/Math.PI+.5),{x:v,y:this.southernCenter?w:1-w,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:u,f:h}=this,p=h-o,m=Math.sign(p),v=Math.sign(u)*Math.sqrt(n*n+p*p);let w=Math.atan2(n,Math.abs(p))*m;p*u<0&&(w-=Math.PI*Math.sign(n)*m);const E=Hn(eo(w/u)+this.center[0],-180,180),C=Hn(eo(2*Math.atan(Math.pow(h/v,1/u))-a_),-Ui,Ui);return new Tr(E,this.southernCenter?-C:C)}}class JN extends qd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:hu(n),y:du(o),z:0}}unproject(n,o){const u=fa(n),h=Hs(o);return new Tr(u,h)}}const eF=tr(Ui);class nY extends qd{project(n,o){const u=(o=tr(o))*o,h=u*u;return{x:.5*((n=tr(n))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let u=o=(2*(1-o)-1)*Math.PI,h=25,p=0,m=u*u;do{m=u*u;const E=m*m;p=(u*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-o)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),u=Hn(u-p,-eF,eF)}while(Math.abs(p)>1e-6&&--h>0);m=u*u;const v=Hn(eo(n/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),w=eo(u);return new Tr(v,w)}}const tF=tr(Ui);class rY extends qd{project(n,o){o=tr(o),n=tr(n);const u=Math.cos(o),h=2/Math.PI,p=Math.acos(u*Math.cos(n/2)),m=Math.sin(p)/p,v=.5*(n*h+2*u*Math.sin(n/2)/m)||0,w=.5*(o+Math.sin(o)/m)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(n,o){let u=n=(2*n-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,p=25;const m=1e-6;let v=0,w=0;do{const E=Math.cos(h),C=Math.sin(h),P=2*C*E,k=C*C,N=E*E,j=Math.cos(u/2),$=Math.sin(u/2),q=2*j*$,te=$*$,pe=1-N*j*j,fe=pe?1/pe:0,me=pe?Math.acos(E*j)*Math.sqrt(1/pe):0,Ae=.5*(2*me*E*$+2*u/Math.PI)-n,Pe=.5*(me*C+h)-o,ze=.5*fe*(N*te+me*E*j*k)+1/Math.PI,$e=fe*(q*P/4-me*C*$),Xe=.125*fe*(P*$-me*C*N*q),rt=.5*fe*(k*j+me*te*E)+.5,Qe=$e*Xe-rt*ze;v=(Pe*$e-Ae*rt)/Qe,w=(Ae*Xe-Pe*ze)/Qe,u=Hn(u-v,-Math.PI,Math.PI),h=Hn(h-w,-tF,tF)}while((Math.abs(v)>m||Math.abs(w)>m)&&--p>0);return new Tr(eo(u),eo(h))}}class nF extends qd{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(tr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:u,cosPhi:h}=this;return{x:tr(n)*h*u+.5,y:-Math.sin(tr(o))/h*u+.5,z:0}}unproject(n,o){const{scale:u,cosPhi:h}=this,p=-(o-.5)/u,m=Hn(eo((n-.5)/u)/h,-180,180),v=Math.asin(Hn(p*h,-1,1)),w=Hn(eo(v),-Ui,Ui);return new Tr(m,w)}}class iY extends JN{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,u){const h=K0(n,o,u),p=Q0(fu(u));return a.$.transformMat4(h,h,p),{x:h[0],y:h[1],z:h[2]}}locationPoint(n,o){const u=Lp(o.lat,o.lng),h=a.$.normalize([],u),p=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude,m=Vo(1,0)*Ft*p;a.$.scaleAndAdd(u,u,h,m);const v=a.ae.identity(new Float64Array(16));return a.ae.multiply(v,n.pixelMatrix,n.globeMatrix),a.$.transformMat4(u,u,v),new jt(u[0],u[1])}pixelsPerMeter(n,o){return Vo(1,0)*o}pixelSpaceConversion(n,o,u){const h=Vo(1,n)*o,p=Sn(Vo(1,45)*o,h,u);return this.pixelsPerMeter(n,o)/p}createTileMatrix(n,o,u){const h=SP(fu(u.canonical));return a.ae.multiply(new Float64Array(16),n.globeMatrix,h)}createInversionMatrix(n,o){const{center:u}=n,h=Q0(fu(o));return a.ae.rotateY(h,h,tr(u.lng)),a.ae.rotateX(h,h,tr(u.lat)),a.ae.scale(h,h,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(n,o,u,h){return KL(n,o,u,!0)||new yo(0,0)}pointCoordinate3D(n,o,u){const h=this.pointCoordinate(n,o,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(n,o){return!KL(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=function(h,p){const m=h.cameraToCenterDistance,v=h._centerAltitude*p,w=h._camera,E=h._camera.forward(),C=a.$.add([],a.$.scale([],E,-m),[0,0,v]),P=h.worldSize/(2*Math.PI),k=[0,0,-P],N=h.width/h.height,j=Math.tan(h.fovAboveCenter),$=a.$.scale([],w.up(),j),q=a.$.scale([],w.right(),j*N),te=a.$.normalize([],a.$.add([],a.$.add([],E,$),q)),pe=[];let fe;if(new xP(C,te).closestPointOnSphere(k,P,pe)){const me=a.$.add([],pe,k),Ae=a.$.sub([],me,C);fe=Math.cos(h.fovAboveCenter)*a.$.length(Ae)}else{const me=a.$.sub([],C,k),Ae=a.$.sub([],k,C);a.$.normalize(Ae,Ae);const Pe=a.$.length(me)-P;fe=Math.sqrt(Pe*(Pe+2*P));const ze=Math.acos(fe/(P+Pe))-Math.acos(a.$.dot(E,Ae));fe*=Math.cos(ze)}return 1.01*fe}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),u=xh(n.zoom);if(u>0){const h=QN(n,Vo(1,n.center.lat)*n.worldSize),p=n.worldSize/(2*Math.PI),m=Math.max(n.width,n.height)/n.worldSize*Math.PI;return Sn(o,h+p*(1-Math.cos(m)),Math.pow(u,10))}return o}upVector(n,o,u){return K0(o,u,n,1)}upVectorScale(n){return{metersToTile:Tw(Sw(fu(n)))}}}function rF(i){const n=i.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(i.name){case"mercator":return new JN(i);case"equirectangular":return new eY(i);case"naturalEarth":return new nY(i);case"equalEarth":return new JQ(i);case"winkelTripel":return new rY(i);case"albers":return o?new nF(i):new YQ(i);case"lambertConformalConic":return o?new nF(i):new tY(i);case"globe":return new iY(i)}throw new Error(`Invalid projection name: ${i.name}`)}const sY=kw.types,oY=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kw(i,n,o,u,h,p,m,v,w,E,C,P,k){const N=v?Math.min($d,Math.round(v[0])):0,j=v?Math.min($d,Math.round(v[1])):0;i.emplaceBack(n,o,Math.round(32*u),Math.round(32*h),p,m,(N<<1)+(w?1:0),j,16*E,16*C,256*P,256*k)}function Qw(i,n,o){i.emplaceBack(n,o)}function Yw(i,n,o,u,h,p,m){i.emplaceBack(n,o,u,h,p,m)}function Jw(i,n,o,u,h){i.emplaceBack(n,o,u,h),i.emplaceBack(n,o,u,h),i.emplaceBack(n,o,u,h),i.emplaceBack(n,o,u,h)}function aY(i){for(const n of i.sections)if(Un(n.text))return!0;return!1}class ZP{constructor(n){this.layoutVertexArray=new $A,this.indexArray=new Fs,this.programConfigurations=n,this.segments=new gi,this.dynamicLayoutVertexArray=new Md,this.opacityVertexArray=new GA,this.placedSymbolArray=new gL,this.iconTransitioningVertexArray=new Dd,this.globeExtVertexArray=new qA,this.zOffsetVertexArray=new qg}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,o,u,h,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,uQ.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,dQ.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,oY,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,fQ.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,hQ.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,cN.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ve(ZP,"SymbolBuffers");class XP{constructor(n,o,u){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new u,this.segments=new gi,this.collisionVertexArray=new ZA,this.collisionVertexArrayExt=new Md}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,pQ.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,mQ.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ve(XP,"CollisionBuffers");class l_{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=a.ae.identity([]),this.placementViewportMatrix=a.ae.identity([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=BP(this.zoom,o["text-size"]),this.iconSizeData=BP(this.zoom,o["icon-size"]);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),p=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(m=>el[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=u.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new ZP(new zd(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^text/.test(n))),this.icon=new ZP(new zd(this.layers,{zoom:this.zoom,lut:this.lut},n=>/^icon/.test(n))),this.glyphOffsetArray=new vL,this.lineVertexArray=new xL,this.symbolInstances=new yL}calculateGlyphDependencies(n,o,u,h,p){for(let m=0;m<n.length;m++){const v=n.codePointAt(m);if(v===void 0)break;if(o[v]=!0,h&&p&&v<=65535){const w=lv[n.charAt(m)];w&&(o[w.charCodeAt(0)]=!0)}}}updateFootprints(n,o){}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!zP(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(n,o,u,h){const p=this.layers[0],m=p.layout,v=this.projection.name==="globe",w=m.get("text-font"),E=m.get("text-field"),C=m.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof go&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),k=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,N=m.get("symbol-sort-key");if(this.features=[],!P&&!k)return;const j=o.iconDependencies,$=o.glyphDependencies,q=o.availableImages,te=new Rn(this.zoom);for(const{feature:pe,id:fe,index:me,sourceLayerIndex:Ae}of n){const Pe=p._featureFilter.needGeometry,ze=yh(pe,Pe);if(!p._featureFilter.filter(te,ze,u))continue;if(Pe||(ze.geometry=bc(pe,u,h)),v&&pe.type!==1&&u.z<=5){const Qe=ze.geometry,ut=.98078528056,At=(ht,Ot)=>{const ct=K0(ht.x,ht.y,u,1),vt=K0(Ot.x,Ot.y,u,1);return a.$.dot(ct,vt)<ut};for(let ht=0;ht<Qe.length;ht++)Qe[ht]=iK(Qe[ht],At)}let $e,Xe;if(P){const Qe=p.getValueAndResolveTokens("text-field",ze,u,q),ut=go.factory(Qe);aY(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||Vn()==="unavailable"||this.hasRTLText&&nr.isParsed())&&($e=DQ(ut,p,ze))}if(k){const Qe=p.getValueAndResolveTokens("icon-image",ze,u,q);Xe=Qe instanceof sa?Qe:sa.fromString(Qe)}if(!$e&&!Xe)continue;const rt=this.sortFeaturesByKey?N.evaluate(ze,{},u):void 0;if(this.features.push({id:fe,text:$e,icon:Xe,index:me,sourceLayerIndex:Ae,geometry:ze.geometry,properties:pe.properties,type:sY[pe.type],sortKey:rt}),Xe&&(j[Xe.namePrimary]=!0,Xe.nameSecondary&&(j[Xe.nameSecondary]=!0)),$e){const Qe=w.evaluate(ze,{},u).join(","),ut=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(el.vertical)>=0;for(const At of $e.sections)if(At.image)j[At.image.namePrimary]=!0;else{const ht=yt($e.toString()),Ot=At.fontStack||Qe,ct=$[Ot]=$[Ot]||{};this.calculateGlyphDependencies(At.text,ct,ut,this.allowVerticalPlacement,ht)}}}m.get("symbol-placement")==="line"&&(this.features=function(pe){const fe={},me={},Ae=[];let Pe=0;function ze(Qe){Ae.push(pe[Qe]),Pe++}function $e(Qe,ut,At){const ht=me[Qe];return delete me[Qe],me[ut]=ht,Ae[ht].geometry[0].pop(),Ae[ht].geometry[0]=Ae[ht].geometry[0].concat(At[0]),ht}function Xe(Qe,ut,At){const ht=fe[ut];return delete fe[ut],fe[Qe]=ht,Ae[ht].geometry[0].shift(),Ae[ht].geometry[0]=At[0].concat(Ae[ht].geometry[0]),ht}function rt(Qe,ut,At){const ht=At?ut[0][ut[0].length-1]:ut[0][0];return`${Qe}:${ht.x}:${ht.y}`}for(let Qe=0;Qe<pe.length;Qe++){const ut=pe[Qe],At=ut.geometry,ht=ut.text?ut.text.toString():null;if(!ht){ze(Qe);continue}const Ot=rt(ht,At),ct=rt(ht,At,!0);if(Ot in me&&ct in fe&&me[Ot]!==fe[ct]){const vt=Xe(Ot,ct,At),Nt=$e(Ot,ct,Ae[vt].geometry);delete fe[Ot],delete me[ct],me[rt(ht,Ae[Nt].geometry,!0)]=Nt,Ae[vt].geometry=null}else Ot in me?$e(Ot,ct,At):ct in fe?Xe(Ot,ct,At):(ze(Qe),fe[Ot]=Pe-1,me[ct]=Pe-1)}return Ae.filter(Qe=>Qe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,fe)=>pe.sortKey-fe.sortKey)}update(n,o,u,h,p){const m=Object.keys(n).length!==0;if(m&&!this.stateDependentLayers.length)return;const v=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,o,v,u,h,p),this.icon.programConfigurations.updatePaintArrays(n,o,v,u,h,p)}updateZOffset(){const n=(p,m,v)=>{u+=m,u>p.length&&p.resize(u);for(let w=-m;w<0;w++)p.emplace(w+u,v)},o=(p,m,v)=>{h+=m,h>p.length&&p.resize(h);for(let w=-m;w<0;w++)p.emplace(w+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:w,numIconVertices:E}=m,C=m.zOffset,P=E>0;if((v>0||w>0)&&(n(this.text.zOffsetVertexArray,v,C),n(this.text.zOffsetVertexArray,w,C)),P){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:N}=m;k>=0&&o(this.icon.zOffsetVertexArray,E,C),N>=0&&o(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rF(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const u=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:h,y:p}of o)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(n,o,u,h,p,m,v,w,E,C,P,k,N,j,$,q){const te=n.indexArray,pe=n.layoutVertexArray,fe=n.globeExtVertexArray,me=n.segments.prepareSegment(4*o.length,pe,te,this.canOverlap?m.sortKey:void 0),Ae=this.glyphOffsetArray.length,Pe=me.vertexLength,ze=this.allowVerticalPlacement&&v===el.vertical?Math.PI/2:0,$e=m.text&&m.text.sections;for(let rt=0;rt<o.length;rt++){const{tl:Qe,tr:ut,bl:At,br:ht,texPrimary:Ot,texSecondary:ct,pixelOffsetTL:vt,pixelOffsetBR:Nt,minFontScaleX:dt,minFontScaleY:Ut,glyphOffset:Lt,isSDF:Rt,sectionIndex:bn}=o[rt],fn=me.vertexLength,Jt=Lt[1];if(Kw(pe,E.x,E.y,Qe.x,Jt+Qe.y,Ot.x,Ot.y,u,Rt,vt.x,vt.y,dt,Ut),Kw(pe,E.x,E.y,ut.x,Jt+ut.y,Ot.x+Ot.w,Ot.y,u,Rt,Nt.x,vt.y,dt,Ut),Kw(pe,E.x,E.y,At.x,Jt+At.y,Ot.x,Ot.y+Ot.h,u,Rt,vt.x,Nt.y,dt,Ut),Kw(pe,E.x,E.y,ht.x,Jt+ht.y,Ot.x+Ot.w,Ot.y+Ot.h,u,Rt,Nt.x,Nt.y,dt,Ut),w){const{x:Bt,y:Pn,z:gn}=w.anchor,[on,zn,Bn]=w.up;Yw(fe,Bt,Pn,gn,on,zn,Bn),Yw(fe,Bt,Pn,gn,on,zn,Bn),Yw(fe,Bt,Pn,gn,on,zn,Bn),Yw(fe,Bt,Pn,gn,on,zn,Bn),Jw(n.dynamicLayoutVertexArray,Bt,Pn,gn,ze)}else Jw(n.dynamicLayoutVertexArray,E.x,E.y,E.z,ze);if(q){const Bt=ct||Ot;Qw(n.iconTransitioningVertexArray,Bt.x,Bt.y),Qw(n.iconTransitioningVertexArray,Bt.x+Bt.w,Bt.y),Qw(n.iconTransitioningVertexArray,Bt.x,Bt.y+Bt.h),Qw(n.iconTransitioningVertexArray,Bt.x+Bt.w,Bt.y+Bt.h)}te.emplaceBack(fn,fn+1,fn+2),te.emplaceBack(fn+1,fn+2,fn+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Lt[0]),rt!==o.length-1&&bn===o[rt+1].sectionIndex||n.programConfigurations.populatePaintArrays(pe.length,m,m.index,{},N,j,$,$e&&$e[bn])}const Xe=w?w.anchor:E;n.placedSymbolArray.emplaceBack(Xe.x,Xe.y,Xe.z,E.x,E.y,Ae,this.glyphOffsetArray.length-Ae,Pe,C,P,E.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],v,0,!1,0,k,0)}_commitLayoutVertex(n,o,u,h,p,m,v){n.emplaceBack(o,u,h,p,m,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(n,o,u,h,p,m,v){const w=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),E=w.vertexLength,C=v.tileAnchorX,P=v.tileAnchorY;for(let N=0;N<4;N++)u.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,o,n.padding,v.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new jt(n.x1,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new jt(n.x2,n.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new jt(n.x2,n.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,C,P,new jt(n.x1,n.y2)),w.vertexLength+=4;const k=u.indexArray;k.emplaceBack(E,E+1),k.emplaceBack(E+1,E+2),k.emplaceBack(E+2,E+3),k.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceTextSize(n,m,o,v);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceIconSize(n,o,m.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}generateCollisionDebugBuffers(n,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new XP(pw,uN.members,Dd),this.iconCollisionBox=new XP(pw,uN.members,Dd);const u=r_(this.iconSizeData,n),h=r_(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,n,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,n,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(u,n,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(u,n,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(n,o,u,h){const p=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),m=Vw(this.textSizeData,n,p)/oo;return this.tilePixelRatio*m}getSymbolInstanceIconSize(n,o,u){const h=this.icon.placedSymbolArray.get(u),p=Vw(this.iconSizeData,n,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(n,o,u,h){n.emplaceBack(o,-u,-u,h),n.emplaceBack(o,u,-u,h),n.emplaceBack(o,u,u,h),n.emplaceBack(o,-u,u,h)}_updateTextDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceTextSize(n,m,o,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(n,o,u,h,p,m){for(let v=h;v<p;v++){const w=u.get(v),E=this.getSymbolInstanceIconSize(n,o,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding,m.zOffset)}}updateCollisionDebugBuffers(n,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=r_(this.iconSizeData,n),h=r_(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,n,o,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,n,o,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(u,n,o,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(u,n,o,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,u,h,p,m,v,w,E){const C={};if(o<u){const{x1:P,y1:k,x2:N,y2:j,padding:$,projectedAnchorX:q,projectedAnchorY:te,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me,featureIndex:Ae}=n.get(o);C.textBox={x1:P,y1:k,x2:N,y2:j,padding:$,projectedAnchorX:q,projectedAnchorY:te,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me},C.textFeatureIndex=Ae}if(h<p){const{x1:P,y1:k,x2:N,y2:j,padding:$,projectedAnchorX:q,projectedAnchorY:te,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me,featureIndex:Ae}=n.get(h);C.verticalTextBox={x1:P,y1:k,x2:N,y2:j,padding:$,projectedAnchorX:q,projectedAnchorY:te,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me},C.verticalTextFeatureIndex=Ae}if(m<v){const{x1:P,y1:k,x2:N,y2:j,padding:$,projectedAnchorX:q,projectedAnchorY:te,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me,featureIndex:Ae}=n.get(m);C.iconBox={x1:P,y1:k,x2:N,y2:j,padding:$,projectedAnchorX:q,projectedAnchorY:te,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me},C.iconFeatureIndex=Ae}if(w<E){const{x1:P,y1:k,x2:N,y2:j,padding:$,projectedAnchorX:q,projectedAnchorY:te,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me,featureIndex:Ae}=n.get(w);C.verticalIconBox={x1:P,y1:k,x2:N,y2:j,padding:$,projectedAnchorX:q,projectedAnchorY:te,projectedAnchorZ:pe,tileAnchorX:fe,tileAnchorY:me},C.verticalIconFeatureIndex=Ae}return C}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,o){const u=n.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs;for(let p=u.vertexStartIndex;p<h;p+=4)n.indexArray.emplaceBack(p,p+1,p+2),n.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),u=Math.cos(n),h=[],p=[],m=[];for(let v=0;v<this.symbolInstances.length;++v){m.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(o*w.tileAnchorX+u*w.tileAnchorY)),p.push(w.featureIndex)}return m.sort((v,w)=>h[v]-h[w]||p[w]-p[v]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,o)=>this.symbolInstances.get(o).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,o){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const u=this.symbolInstances.get(o);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ve(l_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),l_.addDynamicAttributes=Jw;class Ml{constructor(n,o,u,h){this.context=n,this.format=u,this.texture=n.gl.createTexture(),this.update(o,h)}update(n,o,u){const{width:h,height:p}=n,{context:m}=this,{gl:v}=m;if(v.bindTexture(v.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!o||o.premultiply!==!1)),this.useMipmap=!!(o&&o.useMipmap),u||this.size&&this.size[0]===h&&this.size[1]===p){const{x:w,y:E}=u||{x:0,y:0};if(n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap)v.texSubImage2D(v.TEXTURE_2D,0,w,E,v.RGBA,v.UNSIGNED_BYTE,n);else{let C=this.format,P=v.UNSIGNED_BYTE;this.format===v.R32F&&(C=v.RED,P=v.FLOAT),v.texSubImage2D(v.TEXTURE_2D,0,w,E,h,p,C,P,n.data)}}else if(this.size=[h,p],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap){let w=this.format;this.format===v.R8&&(w=v.RED),v.texImage2D(v.TEXTURE_2D,0,this.format,w,v.UNSIGNED_BYTE,n)}else{let w=this.format,E=this.format,C=v.UNSIGNED_BYTE,P=!1;this.format===v.DEPTH_COMPONENT&&(w=v.DEPTH_COMPONENT16,C=v.UNSIGNED_SHORT),this.format===v.DEPTH_STENCIL&&(w=v.DEPTH24_STENCIL8,C=v.UNSIGNED_INT_24_8,P=!0),this.format===v.R8&&(E=v.RED),this.format===v.R32F&&(C=v.FLOAT,E=v.RED),!this.useMipmap&&P?v.texStorage2D(v.TEXTURE_2D,1,w,h,p):v.texImage2D(v.TEXTURE_2D,0,w,h,p,0,E,C,n.data)}this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,o,u=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!u?n===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrapS=o)}bindExtraParam(n,o,u,h){const{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),o!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),this.magFilter=o),n!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?n===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),u!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class eT{constructor(n,o){this.context=n,this.texture=o}bind(n,o){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,n),this.minFilter=n),o!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrapS=o)}}const kl=32,mu=33,Gd=new Uint16Array(8184);for(let i=0;i<2046;i++){let n=i+2,o=0,u=0,h=0,p=0,m=0,v=0;for(1&n?h=p=m=kl:o=u=v=kl;(n>>=1)>1;){const E=o+h>>1,C=u+p>>1;1&n?(h=o,p=u,o=m,u=v):(o=h,u=p,h=m,p=v),m=E,v=C}const w=4*i;Gd[w+0]=o,Gd[w+1]=u,Gd[w+2]=h,Gd[w+3]=p}const gu=new Uint16Array(2178),Wd=new Uint8Array(1089),tT=new Uint16Array(1089);function iF(i){return i===0?-.03125:i===32?.03125:0}var nT=Rr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Up{constructor(n,o,u,h){this.id=Up.uniqueIdxCounter,Up.uniqueIdxCounter++,this.context=n;const p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||h||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=Up.uniqueIdxCounter,Up.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Up.uniqueIdxCounter=0;class c_{constructor(n,o,u){this.func=n,this.mask=o,this.range=u}}c_.ReadOnly=!1,c_.ReadWrite=!0,c_.disabled=new c_(519,c_.ReadOnly,[0,1]);const KP=7680;class QP{constructor(n,o,u,h,p,m){this.test=n,this.ref=o,this.mask=u,this.fail=h,this.depthFail=p,this.pass=m}}QP.disabled=new QP({func:519,mask:0},0,0,KP,KP,KP);const gv=771;class Pa{constructor(n,o,u,h){this.blendFunction=n,this.blendColor=o,this.mask=u,this.blendEquation=h}}Pa.Replace=[1,0,1,0],Pa.disabled=new Pa(Pa.Replace,Sr.transparent,[!1,!1,!1,!1]),Pa.unblended=new Pa(Pa.Replace,Sr.transparent,[!0,!0,!0,!0]),Pa.alphaBlended=new Pa([1,gv,1,gv],Sr.transparent,[!0,!0,!0,!0]),Pa.alphaBlendedNonPremultiplied=new Pa([770,gv,770,gv],Sr.transparent,[!0,!0,!0,!0]),Pa.multiply=new Pa([774,0,774,0],Sr.transparent,[!0,!0,!0,!0]);const YP=1029,JP=2305;class Ec{constructor(n,o,u){this.enable=n,this.mode=o,this.frontFace=u}}Ec.disabled=new Ec(!1,YP,JP),Ec.backCCW=new Ec(!0,YP,JP),Ec.backCW=new Ec(!0,YP,2304),Ec.frontCW=new Ec(!0,1028,2304),Ec.frontCCW=new Ec(!0,1028,JP);var lY=Rr([{name:"a_index",type:"Int16",components:1}]);const sF={type:2,extent:Ft,loadGeometry:()=>[[new jt(0,0),new jt(Ft+1,0),new jt(Ft+1,Ft+1),new jt(0,Ft+1),new jt(0,0)]]};class rT{constructor(n,o,u,h,p){this.tileID=n,this.uid=ac(),this.uses=0,this.tileSize=o,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<tn.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=jp(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,u){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(h,p){const m={};if(!p)return m;for(const v of h){const w=v.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(E=>w.filter(C=>C.id===E)[0]));for(const E of w)m[E.fqid]=v}}return m}(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof l_){if(this.hasSymbolBuckets=!0,!u)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof l_&&p.hasRTLText){this.hasRTLText=!0,nr.isLoading()||nr.isLoaded()||Vn()!=="deferred"||br();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h],m=o.style.getOwnLayer(h);if(!m)continue;const v=m.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,v)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new nP}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(n)}const o=n.gl,u=this.imageAtlas;if(u&&!u.uploaded){const h=!!Object.keys(u.patternPositions).length;this.imageAtlasTexture=new Ml(n,u.image,o.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ml(n,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ml(n,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(n,o,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,u),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const h=o.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,o)))}queryRenderedFeatures(n,o,u,h,p,m,v,w){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:m,params:p,tileTransform:this.tileTransform},n,o,u):{}}querySourceFeatures(n,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const h=u.loadVTLayers(),p=o?o.sourceLayer:"",m=h._geojsonTileLayer||h[p];if(!m)return;const v=yc(o&&o.filter),{z:w,x:E,y:C}=this.tileID.canonical,P={z:w,x:E,y:C};for(let k=0;k<m.length;k++){const N=m.feature(k);if(v.needGeometry){const q=yh(N,!0);if(!v.filter(new Rn(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!v.filter(new Rn(this.tileID.overscaledZ),N))continue;const j=u.getId(N,p),$=new IN(N,w,E,C,j);$.tile=P,n.push($)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const u=tu(n.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const u=Date.now();let h=!1;if(this.expirationTime>u)h=!1;else if(o)if(this.expirationTime<o)h=!0;else{const p=this.expirationTime-o;p?this.expirationTime=u+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,o){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&o&&this.updateBuckets(n,o)}updateBuckets(n,o){if(!this.latestFeatureIndex)return;const u=this.latestFeatureIndex.loadVTLayers(),h=o.style.listImages(),p=o.style.getBrightness();for(const m in this.buckets){if(!o.style.hasLayer(m))continue;const v=this.buckets[m],w=v.layers[0].sourceLayer||"_geojsonTileLayer",E=u[w];let C={};if(n&&(C=n[w],!E||!C||Object.keys(C).length===0))continue;if(v.update(C,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),v instanceof Bw||v instanceof Rw){const k=o.style.getOwnSourceCache(v.layers[0].source);o._terrain&&o._terrain.enabled&&k&&v.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(k.id,this.tileID)}const P=o&&o.style&&o.style.getOwnLayer(m);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<tn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=tn.now()+n}setTexture(n,o){const u=o.context,h=u.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof Ml?this.texture.update(n,{useMipmap:!0}):(this.texture=new Ml(u,n,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(n,o){const u={};for(const h of o)u[h]=!0;this.dependencies[n]=u}hasDependency(n,o){for(const u of n){const h=this.dependencies[u];if(h){for(const p of o)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const u=bc(sF,this.tileID.canonical,this.tileTransform)[0],h=new vc,p=new $0;for(let m=0;m<u.length;m++){const{x:v,y:w}=u[m];h.emplaceBack(v,w),p.emplaceBack(m)}p.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(p),this._tileDebugBuffer=n.createVertexBuffer(h,X0.members),this._tileDebugSegments=gi.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const u=bc(sF,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const m=function(v,w){const E=jp(v,w),C=Math.pow(2,v.z);for(let q=0;q<mu;q++)for(let te=0;te<mu;te++){const pe=fa((v.x+(te+iF(te))/kl)/C),fe=Hs((v.y+(q+iF(q))/kl)/C),me=w.project(pe,fe),Ae=q*mu+te;gu[2*Ae+0]=Math.round((me.x*E.scale-E.x)*Ft),gu[2*Ae+1]=Math.round((me.y*E.scale-E.y)*Ft)}Wd.fill(0),tT.fill(0);for(let q=2045;q>=0;q--){const te=4*q,pe=Gd[te+0],fe=Gd[te+1],me=Gd[te+2],Ae=Gd[te+3],Pe=pe+me>>1,ze=fe+Ae>>1,$e=Pe+ze-fe,Xe=ze+pe-Pe,rt=fe*mu+pe,Qe=Ae*mu+me,ut=ze*mu+Pe,At=Math.hypot((gu[2*rt+0]+gu[2*Qe+0])/2-gu[2*ut+0],(gu[2*rt+1]+gu[2*Qe+1])/2-gu[2*ut+1])>=16;Wd[ut]=Wd[ut]||(At?1:0),q<1022&&(Wd[ut]=Wd[ut]||Wd[(fe+Xe>>1)*mu+(pe+$e>>1)]||Wd[(Ae+Xe>>1)*mu+(me+$e>>1)])}const P=new ph,k=new Fs;let N=0;function j(q,te){const pe=te*mu+q;return tT[pe]===0&&(P.emplaceBack(gu[2*pe+0],gu[2*pe+1],q*Ft/kl,te*Ft/kl),tT[pe]=++N),tT[pe]-1}function $(q,te,pe,fe,me,Ae){const Pe=q+pe>>1,ze=te+fe>>1;if(Math.abs(q-me)+Math.abs(te-Ae)>1&&Wd[ze*mu+Pe])$(me,Ae,q,te,Pe,ze),$(pe,fe,me,Ae,Pe,ze);else{const $e=j(q,te),Xe=j(pe,fe),rt=j(me,Ae);k.emplaceBack($e,Xe,rt)}}return $(0,0,kl,kl,kl,0),$(kl,kl,0,0,0,kl),{vertices:P,indices:k}}(this.tileID.canonical,o);h=m.vertices,p=m.indices}else{h=new ph,p=new Fs;for(const{x:v,y:w}of u)h.emplaceBack(v,w,0,0);const m=J0(h.int16,void 0,4);for(let v=0;v<m.length;v+=3)p.emplaceBack(m[v],m[v+1],m[v+2])}this._tileBoundsBuffer=n.createVertexBuffer(h,nT.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(p),this._tileBoundsSegments=gi.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(n,o){const u=o.projection;if(!u||u.name!=="globe"||o.freezeTileCoverage)return;const h=this.tileID.canonical,p=Q0(QL(h,o)),m=xh(o.zoom);let v;m>0&&(v=a.ae.invert(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,h,o,p,v,m),this._makeGlobeTileDebugTextBuffer(n,h,o,p,v,m)}_globePoint(n,o,u,h,p,m,v){let w=K0(n,o,u);if(m){const E=1<<u.z,C=hu(h.center.lng),P=du(h.center.lat),k=(u.x+.5)/E-C;let N=0;k>.5?N=-1:k<-.5&&(N=1);let j=(n/Ft+u.x)/E+N,$=(o/Ft+u.y)/E;j=(j-C)*h._pixelsPerMercatorPixel+C,$=($-P)*h._pixelsPerMercatorPixel+P;const q=[j*h.worldSize,$*h.worldSize,0];a.$.transformMat4(q,q,m),w=vh(w,q,v)}return a.$.transformMat4(w,w,p)}_makeGlobeTileDebugBorderBuffer(n,o,u,h,p,m){const v=new vc,w=new $0,E=new hw,C=(k,N,j,$,q)=>{const te=(j-k)/(q-1),pe=($-N)/(q-1),fe=v.length;for(let me=0;me<q;me++){const Ae=k+me*te,Pe=N+me*pe;v.emplaceBack(Ae,Pe);const ze=this._globePoint(Ae,Pe,o,u,h,p,m);E.emplaceBack(ze[0],ze[1],ze[2]),w.emplaceBack(fe+me)}},P=Ft;C(0,0,P,0,16),C(P,0,P,P,16),C(P,P,0,P,16),C(0,P,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(w),this._tileDebugBuffer=n.createVertexBuffer(v,X0.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(E,XL.members),this._tileDebugSegments=gi.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugTextBuffer(n,o,u,h,p,m){const v=Ft/4,w=new vc,E=new Fs,C=new hw,P=25;E.reserve(32),w.reserve(P),C.reserve(P);const k=(N,j)=>P*N+j;for(let N=0;N<P;N++){const j=N*v;for(let $=0;$<P;$++){const q=$*v;w.emplaceBack(q,j);const te=this._globePoint(q,j,o,u,h,p,m);C.emplaceBack(te[0],te[1],te[2])}}for(let N=0;N<4;N++)for(let j=0;j<4;j++){const $=k(N,j),q=k(N,j+1),te=k(N+1,j),pe=k(N+1,j+1);E.emplaceBack($,q,te),E.emplaceBack(te,q,pe)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(E),this._tileDebugTextBuffer=n.createVertexBuffer(w,X0.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(C,XL.members),this._tileDebugTextSegments=gi.simpleSegment(0,0,P,32)}destroy(n=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof Ml&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function cY(i,n,o){i===1?n.header_length=o.readFixed32():i===2?n.x=o.readVarint():i===3?n.y=o.readVarint():i===4?n.z=o.readVarint():i===5&&n.layers.push(function(u,h){return u.readFields(pY,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},h)}(o,o.readVarint()+o.pos))}function uY(i,n,o){i===1?(n.delta_filter=function(u,h){return u.readFields(hY,{block_size:0},h)}(o,o.readVarint()+o.pos),n.filter="delta_filter"):i===2?(o.readVarint(),n.filter="zigzag_filter"):i===3?(o.readVarint(),n.filter="bitshuffle_filter"):i===4&&(o.readVarint(),n.filter="byteshuffle_filter")}function hY(i,n,o){i===1&&(n.block_size=o.readVarint())}function dY(i,n,o){i===1?(o.readVarint(),n.codec="gzip_data"):i===2?(o.readVarint(),n.codec="jpeg_image"):i===3?(o.readVarint(),n.codec="webp_image"):i===4&&(o.readVarint(),n.codec="png_image")}function fY(i,n,o){i===1?n.first_byte=o.readFixed64():i===2?n.last_byte=o.readFixed64():i===3?n.filters.push(function(u,h){return u.readFields(uY,{},h)}(o,o.readVarint()+o.pos)):i===4?n.codec=function(u,h){return u.readFields(dY,{},h)}(o,o.readVarint()+o.pos):i===5?n.deprecated_offset=o.readFloat():i===6?n.deprecated_scale=o.readFloat():i===7?n.bands.push(o.readString()):i===8?n.offset=o.readDouble():i===9&&(n.scale=o.readDouble())}function pY(i,n,o){i===1?n.version=o.readVarint():i===2?n.name=o.readString():i===3?n.units=o.readString():i===4?n.tilesize=o.readVarint():i===5?n.buffer=o.readVarint():i===6?n.pixel_format=o.readVarint():i===7&&n.data_index.push(function(u,h){return u.readFields(fY,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},h)}(o,o.readVarint()+o.pos))}function mY(i,n,o){if(i===2)(function(u,h,p){u.readFields(gY,p,h)})(o,o.readVarint()+o.pos,n);else if(i===3)throw new Error("Not implemented")}function gY(i,n,o){if(i===1){let u=0;const h=o.readVarint()+o.pos;for(;o.pos<h;)n[u++]=o.readVarint()}}class _Y{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const o=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,o),o}put(n,o){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,o)}}function yY(i,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let o=n[3];for(let u=2;u>=1;u--){const h=u===1?1:0,p=u===2?1:0;for(let m=0;m<n[0];m++){const v=n[1]*m;for(let w=h;w<n[1];w++){const E=n[2]*(w+v);for(let C=p;C<n[2];C++){const P=n[3]*(C+E);for(let k=0;k<n[3];k++){const N=P+k;i[N]+=i[N-o]}}}}o*=n[u]}return i}function vY(i){for(let n=0,o=i.length;n<o;n++)i[n]=i[n]>>>1^-(1&i[n]);return i}function xY(i,n){switch(n){case"uint32":return i;case"uint16":for(let o=0;o<i.length;o+=2){const u=i[o],h=i[o+1];i[o]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,i[o+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return i;case"uint8":for(let o=0;o<i.length;o+=4){const u=i[o],h=i[o+1],p=i[o+2],m=i[o+3];i[o+0]=(192&u)>>6|(192&h)>>4|(192&p)>>2|192&m,i[o+1]=(48&u)>>4|(48&h)>>2|48&p|(48&m)<<2,i[o+2]=(12&u)>>2|12&h|(12&p)<<2|(12&m)<<4,i[o+3]=3&u|(3&h)<<2|(3&p)<<4|(3&m)<<6}return i;default:throw new Error(`Invalid pixel format, "${n}"`)}}var tl=Uint8Array,_v=Uint16Array,bY=Int32Array,oF=new tl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),aF=new tl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wY=new tl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lF=function(i,n){for(var o=new _v(31),u=0;u<31;++u)o[u]=n+=1<<i[u-1];var h=new bY(o[30]);for(u=1;u<30;++u)for(var p=o[u];p<o[u+1];++p)h[p]=p-o[u]<<5|u;return{b:o,r:h}},cF=lF(oF,2),uF=cF.b,TY=cF.r;uF[28]=258,TY[258]=28;for(var EY=lF(aF,0).b,hF=new _v(32768),Wi=0;Wi<32768;++Wi){var u_=(43690&Wi)>>1|(21845&Wi)<<1;hF[Wi]=((65280&(u_=(61680&(u_=(52428&u_)>>2|(13107&u_)<<2))>>4|(3855&u_)<<4))>>8|(255&u_)<<8)>>1}var yv=function(i,n,o){for(var u=i.length,h=0,p=new _v(n);h<u;++h)i[h]&&++p[i[h]-1];var m,v=new _v(n);for(h=1;h<n;++h)v[h]=v[h-1]+p[h-1]<<1;m=new _v(1<<n);var w=15-n;for(h=0;h<u;++h)if(i[h])for(var E=h<<4|i[h],C=n-i[h],P=v[i[h]-1]++<<C,k=P|(1<<C)-1;P<=k;++P)m[hF[P]>>w]=E;return m},vv=new tl(288);for(Wi=0;Wi<144;++Wi)vv[Wi]=8;for(Wi=144;Wi<256;++Wi)vv[Wi]=9;for(Wi=256;Wi<280;++Wi)vv[Wi]=7;for(Wi=280;Wi<288;++Wi)vv[Wi]=8;var dF=new tl(32);for(Wi=0;Wi<32;++Wi)dF[Wi]=5;var SY=yv(vv,9),IY=yv(dF,5),e3=function(i){for(var n=i[0],o=1;o<i.length;++o)i[o]>n&&(n=i[o]);return n},Sc=function(i,n,o){var u=n/8|0;return(i[u]|i[u+1]<<8)>>(7&n)&o},t3=function(i,n){var o=n/8|0;return(i[o]|i[o+1]<<8|i[o+2]<<16)>>(7&n)},CY=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ic=function(i,n,o){var u=new Error(n||CY[i]);if(u.code=i,Error.captureStackTrace&&Error.captureStackTrace(u,Ic),!o)throw u;return u},AY=new tl(0),PY=typeof TextDecoder<"u"&&new TextDecoder;try{PY.decode(AY,{stream:!0})}catch{}const RY={gzip_data:"gzip"};class Ol extends Error{constructor(n){super(n),this.name="MRTError"}}const MY={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},fF={uint32:1,uint16:2,uint8:4},kY={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let n3,r3;class xv{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const o=this.layers[n];if(!o)throw new Ol(`Layer '${n}' not found`);return o}getHeaderLength(n){const o=new Uint8Array(n),u=new DataView(n);if(o[0]!==13)throw new Ol("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(n){const o=new Uint8Array(n),u=this.getHeaderLength(n);if(o.length<u)throw new Ol(`Expected header with length >= ${u} but got buffer of length ${o.length}`);const h=function(p,m){return p.readFields(cY,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new n3(o.subarray(0,u)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Ol(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new OY(p,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const o=[],u=this.getLayer(n.layerName);for(let h of n.blockIndices){const p=u.dataIndex[h],m=p.first_byte-n.firstByte,v=p.last_byte-n.firstByte;if(u._blocksInProgress.has(h))continue;const w={layerName:u.name,firstByte:m,lastByte:v,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(u.bandShape),buffer:u.buffer,codec:p.codec.codec,filters:p.filters.map(E=>E.filter)};u._blocksInProgress.add(h),o.push(w)}return new pF(o,()=>{o.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,p)=>{if(o.forEach(m=>u._blocksInProgress.delete(m.blockIndex)),h)throw h;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class OY{constructor({version:n,name:o,units:u,tilesize:h,pixel_format:p,buffer:m,data_index:v},w){if(this.version=n,this.version!==1)throw new Ol(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=o,this.units=u,this.tileSize=h,this.buffer=m,this.pixelFormat=MY[p],this.dataIndex=v,this.bandShape=[h+2*m,h+2*m,fF[this.pixelFormat]],this._decodedBlocks=new _Y(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return fF[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const o=n.blockIndex.toString();this._decodedBlocks.get(o)||this._decodedBlocks.put(o,n.data)}getBlockForBand(n){let o=0;switch(typeof n){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[p,m]of h.bands.entries())if(m===n)return{bandIndex:o+p,blockIndex:u,blockBandIndex:p};o+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(n>=o&&n<o+h.bands.length)return{bandIndex:n,blockIndex:u,blockBandIndex:n-o};o+=h.bands.length}break;default:throw new Ol(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new Ol(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let o=1/0,u=-1/0;const h=[],p=new Set;for(const m of n){const{blockIndex:v}=this.getBlockForBand(m);if(v<0)throw new Ol(`Invalid band: ${JSON.stringify(m)}`);const w=this.dataIndex[v];h.includes(v)||h.push(v),p.add(v),o=Math.min(o,w.first_byte),u=Math.max(u,w.last_byte)}if(p.size>this.cacheSize)throw new Ol(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:o,lastByte:u,blockIndices:h}}hasBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0}hasDataForBand(n){const{blockIndex:o}=this.getBlockForBand(n);return o>=0&&!!this._decodedBlocks.get(o.toString())}getBandView(n){const{blockIndex:o,blockBandIndex:u}=this.getBlockForBand(n),h=this._decodedBlocks.get(o.toString());if(!h)throw new Ol(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[o],m=this.bandShape.reduce((E,C)=>E*C,1),v=u*m,w=h.subarray(v,v+m);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset!==0?p.offset:p.deprecated_offset,scale:p.scale!==0?p.scale:p.deprecated_scale}}}xv.setPbf=function(i){n3=i};class pF{constructor(n,o,u){this.tasks=n,this._onCancel=o,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,o){this._finalized||(this._onComplete(n,o),this._finalized=!0)}}xv.performDecoding=function(i,n){const o=new Uint8Array(i);return Promise.all(n.tasks.map(u=>{const{layerName:h,firstByte:p,lastByte:m,pixelFormat:v,blockShape:w,blockIndex:E,filters:C,codec:P}=u,k=o.subarray(p,m+1),N=new Uint32Array(w[0]*w[1]*w[2]);let j;if(P!=="gzip_data")throw new Ol(`Unhandled codec: ${P}`);return j=function($,q){if(!globalThis.DecompressionStream&&q==="gzip_data")return Promise.resolve(((me=function(ze){ze[0]==31&&ze[1]==139&&ze[2]==8||Ic(6,"invalid gzip data");var $e=ze[3],Xe=10;4&$e&&(Xe+=2+(ze[10]|ze[11]<<8));for(var rt=($e>>3&1)+($e>>4&1);rt>0;rt-=!ze[Xe++]);return Xe+(2&$e)}(fe=$))+8>fe.length&&Ic(6,"invalid gzip data"),function(ze,$e,Xe,rt){var Qe=ze.length;if(!Qe||$e.f&&!$e.l)return Xe||new tl(0);var ut=!Xe,At=ut||$e.i!=2,ht=$e.i;ut&&(Xe=new tl(3*Qe));var Ot,ct,vt=function(Zd){var Hp=Xe.length;if(Zd>Hp){var Rv=new tl(Math.max(2*Hp,Zd));Rv.set(Xe),Xe=Rv}},Nt=$e.f||0,dt=$e.p||0,Ut=$e.b||0,Lt=$e.l,Rt=$e.d,bn=$e.m,fn=$e.n,Jt=8*Qe;do{if(!Lt){Nt=Sc(ze,dt,1);var Bt=Sc(ze,dt+1,3);if(dt+=3,!Bt){var Pn=ze[(jn=4+((dt+7)/8|0))-4]|ze[jn-3]<<8,gn=jn+Pn;if(gn>Qe){ht&&Ic(0);break}At&&vt(Ut+Pn),Xe.set(ze.subarray(jn,gn),Ut),$e.b=Ut+=Pn,$e.p=dt=8*gn,$e.f=Nt;continue}if(Bt==1)Lt=SY,Rt=IY,bn=9,fn=5;else if(Bt==2){var on=Sc(ze,dt,31)+257,zn=Sc(ze,dt+10,15)+4,Bn=on+Sc(ze,dt+5,31)+1;dt+=14;for(var Nn=new tl(Bn),Wn=new tl(19),gr=0;gr<zn;++gr)Wn[wY[gr]]=Sc(ze,dt+3*gr,7);dt+=3*zn;var sr=e3(Wn),Br=(1<<sr)-1,$r=yv(Wn,sr);for(gr=0;gr<Bn;){var jn,Mr=$r[Sc(ze,dt,Br)];if(dt+=15&Mr,(jn=Mr>>4)<16)Nn[gr++]=jn;else{var Dr=0,Jr=0;for(jn==16?(Jr=3+Sc(ze,dt,3),dt+=2,Dr=Nn[gr-1]):jn==17?(Jr=3+Sc(ze,dt,7),dt+=3):jn==18&&(Jr=11+Sc(ze,dt,127),dt+=7);Jr--;)Nn[gr++]=Dr}}var Oi=Nn.subarray(0,on),Hi=Nn.subarray(on);bn=e3(Oi),fn=e3(Hi),Lt=yv(Oi,bn),Rt=yv(Hi,fn)}else Ic(1);if(dt>Jt){ht&&Ic(0);break}}At&&vt(Ut+131072);for(var Di=(1<<bn)-1,wi=(1<<fn)-1,Bs=dt;;Bs=dt){var ls=(Dr=Lt[t3(ze,dt)&Di])>>4;if((dt+=15&Dr)>Jt){ht&&Ic(0);break}if(Dr||Ic(2),ls<256)Xe[Ut++]=ls;else{if(ls==256){Bs=dt,Lt=null;break}var ao=ls-254;ls>264&&(ao=Sc(ze,dt,(1<<(Ac=oF[gr=ls-257]))-1)+uF[gr],dt+=Ac);var Kr=Rt[t3(ze,dt)&wi],pa=Kr>>4;if(Kr||Ic(3),dt+=15&Kr,Hi=EY[pa],pa>3){var Ac=aF[pa];Hi+=t3(ze,dt)&(1<<Ac)-1,dt+=Ac}if(dt>Jt){ht&&Ic(0);break}At&&vt(Ut+131072);var Dl=Ut+ao;if(Ut<Hi){var Ll=0-Hi,Wp=Math.min(Hi,Dl);for(Ll+Ut<0&&Ic(3);Ut<Wp;++Ut)Xe[Ut]=(void 0)[Ll+Ut]}for(;Ut<Dl;++Ut)Xe[Ut]=Xe[Ut-Hi]}}$e.l=Lt,$e.p=Bs,$e.b=Ut,$e.f=Nt,Lt&&(Nt=1,$e.m=bn,$e.d=Rt,$e.n=fn)}while(!Nt);return Ut!=Xe.length&&ut?(Ot=Xe,((ct=Ut)==null||ct>Ot.length)&&(ct=Ot.length),new tl(Ot.subarray(0,ct))):Xe.subarray(0,Ut)}(fe.subarray(me,-8),{i:2},new tl(((te=fe)[(pe=te.length)-4]|te[pe-3]<<8|te[pe-2]<<16|te[pe-1]<<24)>>>0))));var te,pe,fe,me;const Ae=RY[q];if(!Ae)throw new Error(`Unhandled codec: ${q}`);const Pe=new globalThis.DecompressionStream(Ae);return new Response(new Blob([$]).stream().pipeThrough(Pe)).arrayBuffer().then(ze=>new Uint8Array(ze))}(k,P).then($=>(function(q,te){q.readFields(mY,te)}(new n3($),N),new kY[v](N.buffer))),j.then($=>{for(let q=C.length-1;q>=0;q--)switch(C[q]){case"delta_filter":yY($,w);break;case"zigzag_filter":vY($);break;case"bitshuffle_filter":xY($,v);break;default:throw new Ol(`Unhandled filter "${C[q]}"`)}return{layerName:h,blockIndex:E,data:$}}).catch($=>{throw $})}))},xv.setPbf(av);class mF extends rT{constructor(n,o,u,h,p){super(n,o,u,h,p),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,o){const u=o.context,h=u.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture&&this.texture instanceof Ml?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new Ml(u,n,h.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,o){const u=this._mrt=new xv(30),h=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=nh(h,(p,m,v,w)=>{if(p)o(p);else try{const E=u.getHeaderLength(m);if(E>n)return void(this.request=this.fetchHeader(E,o));u.parseHeader(m),this._isHeaderLoaded=!0;let C=0;for(const P of Object.values(u.layers))C=Math.max(C,P.dataIndex[P.dataIndex.length-1].last_byte);m.byteLength>=C&&(this.entireBuffer=m),o(null,this.entireBuffer||m,v,w)}catch(E){o(E)}}),this.request}fetchBand(n,o,u){const h=this._mrt;if(!this._isHeaderLoaded||!h)return void u(new Error("Tile header is not ready"));const p=this.actor;if(!p)return void u(new Error("Can't fetch tile band without an actor"));let m;const v=(P,k)=>{m.complete(P,k),P?u(P):(this.updateTextureDescriptor(n,o),u(null,this.textureDescriptor&&this.textureDescriptor.img))},w=(P,k)=>{if(P)return u(P);const N=p.send("decodeRasterArray",{buffer:k,task:m},v,void 0,!0);this._workQueue.push(()=>{N&&N.cancel(),m.cancel()})},E=h.getLayer(n);if(!E)return void u(new Error(`Unknown sourceLayer "${n}"`));if(E.hasDataForBand(o))return this.updateTextureDescriptor(n,o),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const C=E.getDataRange([o]);if(m=h.createDecodingTask(C),!m||m.tasks.length)if(this.flushQueues(),this.entireBuffer)w(null,this.entireBuffer.slice(C.firstByte,C.lastByte+1));else{const P=Object.assign({},this.requestParams,{headers:{Range:`bytes=${C.firstByte}-${C.lastByte}`}}),k=nh(P,w);this._fetchQueue.push(()=>{k.cancel(),m.cancel()})}else u(null)}updateNeeded(n,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,o){if(!this._mrt)return;const u=this._mrt.getLayer(n);if(!u||!u.hasBand(o)||!u.hasDataForBand(o))return;const{bytes:h,tileSize:p,buffer:m,offset:v,scale:w}=u.getBandView(o),E=p+2*m,C={data:h,width:E,height:E},P=this.texture;P&&P instanceof Ml&&P.update(C,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:o,img:C,buffer:m,offset:v,tileSize:p,format:u.pixelFormat,mix:[w,256*w,65536*w,16777216*w]}}}class DY{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,u){const h=n.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:o,timeout:void 0};if(u!==void 0&&(p.timeout=setTimeout(()=>{this.remove(n,p)},u)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const u=n.wrapped().key,h=o===void 0?0:this.data[u].indexOf(o),p=this.data[u][h];return this.data[u].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(p.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const u in this.data)for(const h of this.data[u])n(h.value)||o.push(h);for(const u of o)this.remove(u.value.tileID,u)}}class Vp extends oh{constructor(n,o,u){super(),this.id=n,this._onlySymbols=u,o.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new DY(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new MQ,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(n),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return oc(this._tiles).map(n=>n.tileID).sort(gF).map(n=>n.key)}getRenderableIds(n,o){const u=[];for(const h in this._tiles)this._isIdRenderable(+h,n,o)&&u.push(this._tiles[h]);return n?u.sort((h,p)=>{const m=h.tileID,v=p.tileID,w=new jt(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new jt(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||E.y-w.y||E.x-w.x}).map(h=>h.tileID.key):u.map(h=>h.tileID).sort(gF).map(h=>h.key)}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o,u){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())&&(u||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const u=this._tiles[n];u&&(u.state!=="loading"&&(u.state=o),this._loadTile(u,this._tileLoaded.bind(this,u,n,o)))}_tileLoaded(n,o,u,h){if(h)if(n.state="errored",h.status!==404)this._source.fire(new up(h,{tile:n}));else{if(this._source.fire(new Il("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=tn.now(),u==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Il("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let h=0;h<o.length;h++){const p=o[h];if(n.neighboringTiles&&n.neighboringTiles[p]){const m=this.getTileByID(p);u(n,m),u(m,n)}}function u(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=p.tileID.canonical.x-h.tileID.canonical.x;const v=p.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),E=p.tileID.key;m===0&&v===0||Math.abs(v)>1||(Math.abs(m)>1&&(Math.abs(m+w)===1?m+=w:Math.abs(m-w)===1&&(m-=w)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,m,v),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,u,h){for(const p in this._tiles){let m=this._tiles[p];if(h[p]||!m.hasData()||m.tileID.overscaledZ<=o||m.tileID.overscaledZ>u)continue;let v=m.tileID;for(;m&&m.tileID.overscaledZ>o+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(v=E)}let w=v;for(;w.overscaledZ>o;)if(w=w.scaledTo(w.overscaledZ-1),n[w.key]){h[v.key]=v;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const u=this._loadedParentTiles[n.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=n.overscaledZ-1;u>=o;u--){const h=n.scaledTo(u),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const u=Math.ceil(n.width/o)+1,h=Math.ceil(n.height/o)+1,p=Math.floor(u*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const u={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+o),u[p.tileID.key]=p}this._tiles=u;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(n,o,u,h){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const p=this._source.type==="batched-model";let m;if(this.used||this.usedForTerrain){if(this._source.tileID)m=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new gs(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y));else if(this.tileCoverLift!==0){const E=n.clone();E.tileCoverLift=this.tileCoverLift,m=E.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.minzoom<=1&&n.projection.name==="globe"&&(m.push(new gs(1,0,1,0,0)),m.push(new gs(1,0,1,1,0)),m.push(new gs(1,0,1,0,1)),m.push(new gs(1,0,1,1,1)))}else if(m=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:p}),this._source.hasTile){const E=this._source.hasTile.bind(this._source);m=m.filter(C=>E(C))}}else m=[];if(m.length>0&&this.castsShadows&&h&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!i3(this._source.type)){const E=n.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),C=Math.min(E,this._source.maxzoom);if(p){const P=n.extendTileCover(m,C);for(const k of P)m.push(k)}else{const P=n.extendTileCover(m,C,h);for(const k of P)this._shadowCasterTiles[k.key]=!0,m.push(k)}}const v=this._updateRetainedTiles(m);if(i3(this._source.type)&&m.length!==0){const E={},C={},P=Object.keys(v);for(const N of P){const j=v[N],$=this._tiles[N];if(!$||$.fadeEndTime&&$.fadeEndTime<=tn.now())continue;const q=this.findLoadedParent(j,Math.max(j.overscaledZ-Vp.maxOverzooming,this._source.minzoom));q&&(this._addTile(q.tileID),E[q.tileID.key]=q.tileID),C[N]=j}const k=m[m.length-1].overscaledZ;for(const N in this._tiles){const j=this._tiles[N];if(v[N]||!j.hasData())continue;let $=j.tileID;for(;$.overscaledZ>k;){$=$.scaledTo($.overscaledZ-1);const q=this._tiles[$.key];if(q&&q.hasData()&&C[$.key]){v[N]=j.tileID;break}}}for(const N in E)v[N]||(this._coveredTiles[N]=!0,v[N]=E[N])}for(const E in v)this._tiles[E].clearFadeHold();const w=function(E,C){const P=[];for(const k in E)k in C||P.push(k);return P}(this._tiles,v);for(const E of w){const C=this._tiles[E];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const u={},h=n.reduce((E,C)=>Math.min(E,C.overscaledZ),1/0),p=n[0].overscaledZ,m=Math.max(p-Vp.maxOverzooming,this._source.minzoom),v=Math.max(p+Vp.maxUnderzooming,this._source.minzoom),w={};for(const E of n){const C=this._addTile(E);o[E.key]=E,C.hasData()||h<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,h,v,o);for(const E of n){let C=this._tiles[E.key];if(C.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const k=E.children(this._source.maxzoom)[0],N=this.getTile(k);if(N&&N.hasData()){o[k.key]=k;continue}}else{const k=E.children(this._source.maxzoom);if(o[k[0].key]&&o[k[1].key]&&o[k[2].key]&&o[k[3].key])continue}let P=C.wasRequested();for(let k=E.overscaledZ-1;k>=m;--k){const N=E.scaledTo(k);if(u[N.key]||(u[N.key]=!0,C=this.getTile(N),!C&&P&&(C=this._addTile(N)),C&&(o[N.key]=N,P=C.wasRequested(),C.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let u,h=this._tiles[n].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){u=this._loadedParentTiles[h.key];break}o.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(u=this._getLoadedTile(p),u)break;h=p}for(const p of o)this._loadedParentTiles[p]=u}}_addTile(n){let o=this._tiles[n.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const u=!!o;if(!u){const h=this.map?this.map.painter:null,p=this._source.tileSize*n.overscaleFactor();o=this._source.type==="raster-array"?new mF(n,p,this.transform.tileZoom,h,this._isRaster):new rT(n,p,this.transform.tileZoom,h,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,u||this._source.fire(new Il("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const u=o.getExpiryTimeout();u&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},u))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,u){const h=[],p=this.transform;if(!p)return h;const m=p.projection.name==="globe",v=hu(p.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(u&&E.clearQueryDebugViz(),E.holdingForFade())continue;let C;if(m){const P=E.tileID.canonical;if(P.z===0){const k=[Math.abs(Hn(v,...bv(P,-1))-v),Math.abs(Hn(v,...bv(P,1))-v)];C=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(Hn(v,...bv(P,-1))-v),Math.abs(Hn(v,...bv(P,0))-v),Math.abs(Hn(v,...bv(P,1))-v)];C=[k.indexOf(Math.min(...k))-1]}}else C=[0];for(const P of C){const k=n.containsTile(E,p,o,P);k&&h.push(k)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,o){const u=this.getRenderableIds(n,o).map(p=>this._tiles[p].tileID),h=this.transform.projection.name==="globe";for(const p of u)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=h?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return u}sortCoordinatesByDistance(n){const o=n.slice(),u=this.transform._camera.position,h=this.transform._camera.forward(),p={};for(const m of o){const v=1/(1<<m.canonical.z);p[m.key]=((m.canonical.x+.5)*v+m.wrap-u[0])*h[0]+((m.canonical.y+.5)*v-u[1])*h[1]-u[2]*h[2]}return o.sort((m,v)=>p[m.key]-p[v.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(i3(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=tn.now())return!0}return!1}setFeatureState(n,o,u){this._state.updateState(n=n||"_geojsonTileLayer",o,u)}removeFeatureState(n,o,u){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,u)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,u){const h=this._tiles[n];h&&h.setDependencies(o,u)}reloadTilesForDependencies(n,o){for(const u in this._tiles)this._tiles[u].hasDependency(n,o)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(n,o))}_preloadTiles(n,o){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(n,o))};return void this._source.on("data",v)}const u=new Map,h=Array.isArray(n)?n:[n],p=this.map.painter.terrain,m=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of h){const w=v.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)u.set(E.key,E);this.usedForTerrain&&v.updateElevation(!1)}eh(Array.from(u.values()),(v,w)=>{const E=new rT(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,C=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(C,E)})},o)}}function gF(i,n){const o=Math.abs(2*i.wrap)-+(i.wrap<0),u=Math.abs(2*n.wrap)-+(n.wrap<0);return i.overscaledZ-n.overscaledZ||u-o||n.canonical.y-i.canonical.y||n.canonical.x-i.canonical.x}function i3(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function bv(i,n){const o=1<<i.z;return[i.x/o+n,(i.x+1)/o+n]}Vp.maxOverzooming=10,Vp.maxUnderzooming=3;const _F=()=>r3||(r3={layout:fN||(fN=new Vr({"line-cap":new an(Je.layout_line["line-cap"]),"line-join":new an(Je.layout_line["line-join"]),"line-miter-limit":new kt(Je.layout_line["line-miter-limit"]),"line-round-limit":new kt(Je.layout_line["line-round-limit"]),"line-sort-key":new an(Je.layout_line["line-sort-key"]),"line-z-offset":new an(Je.layout_line["line-z-offset"]),visibility:new kt(Je.layout_line.visibility)})),paint:pN||(pN=new Vr({"line-opacity":new an(Je.paint_line["line-opacity"]),"line-color":new an(Je.paint_line["line-color"]),"line-translate":new kt(Je.paint_line["line-translate"]),"line-translate-anchor":new kt(Je.paint_line["line-translate-anchor"]),"line-width":new an(Je.paint_line["line-width"]),"line-gap-width":new an(Je.paint_line["line-gap-width"]),"line-offset":new an(Je.paint_line["line-offset"]),"line-blur":new an(Je.paint_line["line-blur"]),"line-dasharray":new an(Je.paint_line["line-dasharray"]),"line-pattern":new an(Je.paint_line["line-pattern"]),"line-gradient":new _o(Je.paint_line["line-gradient"]),"line-trim-offset":new kt(Je.paint_line["line-trim-offset"]),"line-trim-fade-range":new kt(Je.paint_line["line-trim-fade-range"]),"line-trim-color":new kt(Je.paint_line["line-trim-color"]),"line-emissive-strength":new kt(Je.paint_line["line-emissive-strength"]),"line-border-width":new an(Je.paint_line["line-border-width"]),"line-border-color":new an(Je.paint_line["line-border-color"]),"line-occlusion-opacity":new kt(Je.paint_line["line-occlusion-opacity"])}))},r3);class LY extends an{possiblyEvaluate(n,o){return o=new Rn(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,transition:o.transition}),super.possiblyEvaluate(n,o)}evaluate(n,o,u,h){return o=Is({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(n,o,u,h)}}let wv,yF,vF,s3;function xF(i,n){return n>0?n+2*i:i}class bF{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:ia,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ve(bF,"FormatSectionOverride",{omit:["defaultValue"]});const o3=()=>s3||(s3={layout:yF||(yF=new Vr({"symbol-placement":new kt(Je.layout_symbol["symbol-placement"]),"symbol-spacing":new kt(Je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kt(Je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new an(Je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kt(Je.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new kt(Je.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new kt(Je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new kt(Je.layout_symbol["icon-ignore-placement"]),"icon-optional":new kt(Je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kt(Je.layout_symbol["icon-rotation-alignment"]),"icon-size":new an(Je.layout_symbol["icon-size"]),"icon-text-fit":new an(Je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new an(Je.layout_symbol["icon-text-fit-padding"]),"icon-image":new an(Je.layout_symbol["icon-image"]),"icon-rotate":new an(Je.layout_symbol["icon-rotate"]),"icon-padding":new kt(Je.layout_symbol["icon-padding"]),"icon-keep-upright":new kt(Je.layout_symbol["icon-keep-upright"]),"icon-offset":new an(Je.layout_symbol["icon-offset"]),"icon-anchor":new an(Je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kt(Je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kt(Je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kt(Je.layout_symbol["text-rotation-alignment"]),"text-field":new an(Je.layout_symbol["text-field"]),"text-font":new an(Je.layout_symbol["text-font"]),"text-size":new an(Je.layout_symbol["text-size"]),"text-max-width":new an(Je.layout_symbol["text-max-width"]),"text-line-height":new an(Je.layout_symbol["text-line-height"]),"text-letter-spacing":new an(Je.layout_symbol["text-letter-spacing"]),"text-justify":new an(Je.layout_symbol["text-justify"]),"text-radial-offset":new an(Je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kt(Je.layout_symbol["text-variable-anchor"]),"text-anchor":new an(Je.layout_symbol["text-anchor"]),"text-max-angle":new kt(Je.layout_symbol["text-max-angle"]),"text-writing-mode":new kt(Je.layout_symbol["text-writing-mode"]),"text-rotate":new an(Je.layout_symbol["text-rotate"]),"text-padding":new kt(Je.layout_symbol["text-padding"]),"text-keep-upright":new kt(Je.layout_symbol["text-keep-upright"]),"text-transform":new an(Je.layout_symbol["text-transform"]),"text-offset":new an(Je.layout_symbol["text-offset"]),"text-allow-overlap":new kt(Je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new kt(Je.layout_symbol["text-ignore-placement"]),"text-optional":new kt(Je.layout_symbol["text-optional"]),visibility:new kt(Je.layout_symbol.visibility)})),paint:vF||(vF=new Vr({"icon-opacity":new an(Je.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new an(Je.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new an(Je.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new an(Je.paint_symbol["text-emissive-strength"]),"icon-color":new an(Je.paint_symbol["icon-color"]),"icon-halo-color":new an(Je.paint_symbol["icon-halo-color"]),"icon-halo-width":new an(Je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new an(Je.paint_symbol["icon-halo-blur"]),"icon-translate":new kt(Je.paint_symbol["icon-translate"]),"icon-translate-anchor":new kt(Je.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new an(Je.paint_symbol["icon-image-cross-fade"]),"text-opacity":new an(Je.paint_symbol["text-opacity"]),"text-occlusion-opacity":new an(Je.paint_symbol["text-occlusion-opacity"]),"text-color":new an(Je.paint_symbol["text-color"],{runtimeType:Ia,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new an(Je.paint_symbol["text-halo-color"]),"text-halo-width":new an(Je.paint_symbol["text-halo-width"]),"text-halo-blur":new an(Je.paint_symbol["text-halo-blur"]),"text-translate":new kt(Je.paint_symbol["text-translate"]),"text-translate-anchor":new kt(Je.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new kt(Je.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new kt(Je.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new kt(Je.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new kt(Je.paint_symbol["icon-color-brightness-max"])}))},s3);class iT extends da{constructor(n,o,u,h){super(n,o3(),o,u,h),this._colorAdjustmentMatrix=a.ae.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,o){super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const p of u)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,o,u,h){return this._saturation===n&&this._contrast===o&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(p,m,v,w){p=pt(p),m=Oe(m);const E=a.ae.create(),C=p/3,P=1-2*C,k=[P,C,C,0,C,P,C,0,C,C,P,0,0,0,0,1],N=.5-.5*m,j=w-v;return a.ae.multiply(E,[j,0,0,0,0,j,0,0,0,0,j,0,v,v,v,1],[m,0,0,0,0,m,0,0,0,0,m,0,N,N,N,1]),a.ae.multiply(E,E,k),E}(n,o,u,h),this._saturation=n,this._contrast=o,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,o,u,h){const p=this.layout.get(n).evaluate(o,{},u,h),m=this._unevaluatedLayout._values[n];return m.isDataDriven()||we(m.value)||!p?p:function(v,w){return w.replace(/{([^{}]+)}/g,(E,C)=>C in v?String(v[C]):"")}(o.properties,p)}createBucket(n){return new l_(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of o3().paint.overridableProperties){if(!iT.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),u=new bF(o),h=new be(u,o.property.specification,this.scope,this.options);let p=null;p=o.value.kind==="constant"||o.value.kind==="source"?new Me("source",h):new Ie("composite",h,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new Ns(o.property,p,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,u){return!(!this.layout||o.isDataDriven()||u.isDataDriven())&&iT.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const u=n.get("text-field"),h=o3().paint.properties[o];let p=!1;const m=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(p=!0)};if(u.value.kind==="constant"&&u.value.value instanceof go)m(u.value.value.sections);else if(u.value.kind==="source"){const v=E=>{p||(E instanceof Qa&&as(E.value)===wd?m(E.value.sections):E instanceof lh?m(E.sections):E.eachChild(v))},w=u.value;w._styleExpression&&v(w._styleExpression.expression)}return p}getProgramIds(){const n=this.paint.get("icon-opacity").constantOr(1)!==0,o=this.paint.get("text-opacity").constantOr(1)!==0,u=[];return n&&u.push("symbolIcon"),o&&u.push("symbolSDF"),u}getDefaultProgramParams(n,o,u){return{config:new Dp(this,{zoom:o,lut:u}),overrideFog:!1}}}let wF,TF,EF,SF;function sT(i,n,o,u,h,p,m,v){const w=[i,n,1,o,u,1,h,p,1],E=[m,v,1],C=a.bE.adjoint([],w),[P,k,N]=a.$.transformMat3(E,E,C);return a.bE.multiply(w,w,[P,0,0,0,k,0,0,0,N])}function IF(i,n,o,u,h,p,m,v){const w=function(E,C,P,k,N,j,$,q){const te=sT(0,0,1,0,1,1,0,1),pe=sT(E,C,P,k,N,j,$,q),fe=a.bE.adjoint([],te);return a.bE.multiply(pe,pe,fe)}(i,n,o,u,h,p,m,v);return[w[2]/w[8]/Ft,w[5]/w[8]/Ft]}function oT(i){return[i[0],Math.min(Math.max(i[1],-Ui),Ui)]}class CF extends oh{constructor(n,o,u,h){super(),this.id=n,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=o,this._dirty=!1}load(n,o){if(this._loaded=o||!1,this.fire(new Il("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=op(this.map._requestManager.transformRequest(this.url,ip.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new up(u)):h&&(this.image=h instanceof HTMLImageElement?tn.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new eT(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Il("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof eT||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let o=n[0][1],u=n[0][1];for(const p of n)p[1]>u&&(u=p[1]),p[1]<o&&(o=p[1]);const h=(u+o)/2;if(h>Ui?this.onNorthPole=!0:h<-Ui&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=n.map(yo.fromLngLat);this.tileID=function(m){let v=1/0,w=1/0,E=-1/0,C=-1/0;for(const $ of m)v=Math.min(v,$.x),w=Math.min(w,$.y),E=Math.max(E,$.x),C=Math.max(C,$.y);const P=Math.max(E-v,C-w),k=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),N=Math.pow(2,k);let j=Math.floor((v+E)/2*N);return j>1&&(j-=1),new zp(k,j,Math.floor((w+C)/2*N))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Il("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const q in this.tiles){const te=this.tiles[q];te.state!=="loaded"&&(te.state="loaded",te.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const o=jp(new zp(0,0,0),this.map.transform.projection),u=[o.projection.project(this.coordinates[0][0],this.coordinates[0][1]),o.projection.project(this.coordinates[1][0],this.coordinates[1][1]),o.projection.project(this.coordinates[2][0],this.coordinates[2][1]),o.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(q){const te=q[1].x-q[0].x,pe=q[1].y-q[0].y,fe=q[2].x-q[1].x,me=q[2].y-q[1].y,Ae=q[3].x-q[2].x,Pe=q[3].y-q[2].y,ze=q[0].x-q[3].x,$e=q[0].y-q[3].y,Xe=te*me-fe*pe,rt=fe*Pe-Ae*me,Qe=Ae*$e-ze*Pe,ut=ze*pe-te*$e;return Xe>0&&rt>0&&Qe>0&&ut>0||Xe<0&&rt<0&&Qe<0&&ut<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=jp(this.tileID,this.map.transform.projection),[p,m,v,w]=this.coordinates.map(q=>{const te=h.projection.project(q[0],q[1]);return YN(h,te)._round()});this.perspectiveTransform=IF(p.x,p.y,m.x,m.y,v.x,v.y,w.x,w.y);const E=this._boundsArray=new ph;E.emplaceBack(p.x,p.y,0,0),E.emplaceBack(m.x,m.y,Ft,0),E.emplaceBack(w.x,w.y,0,Ft),E.emplaceBack(v.x,v.y,Ft,Ft),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(E,nT.members),this.boundsSegments=gi.simpleSegment(0,0,4,2);const C=[],P=function(q){return[oT(q[0]),oT(q[1]),oT(q[2]),oT(q[3])]}(this.coordinates),[k,N,j,$]=function(q){let te=q[0][0],pe=te,fe=q[0][1],me=fe;for(let Ae=1;Ae<q.length;Ae++)q[Ae][0]<te?te=q[Ae][0]:q[Ae][0]>pe&&(pe=q[Ae][0]),q[Ae][1]<fe?fe=q[Ae][1]:q[Ae][1]>me&&(me=q[Ae][1]);return[te,fe,pe-te,me-fe]}(P);{const q=new ph,[te,pe,fe,me]=function(ct){let vt=ct[0].x,Nt=vt,dt=ct[0].y,Ut=dt;for(let Lt=1;Lt<ct.length;Lt++)ct[Lt].x<vt?vt=ct[Lt].x:ct[Lt].x>Nt&&(Nt=ct[Lt].x),ct[Lt].y<dt?dt=ct[Lt].y:ct[Lt].y>Ut&&(Ut=ct[Lt].y);return[vt,dt,Nt-vt,Ut-dt]}(u),Ae=ct=>[(ct.x-te)/fe,(ct.y-pe)/me],[Pe,ze,$e,Xe]=u.map(Ae),rt=function(ct,vt,Nt,dt,Ut,Lt,Rt,bn){const fn=sT(0,0,1,0,1,1,0,1),Jt=sT(ct,vt,Nt,dt,Ut,Lt,Rt,bn),Bt=a.bE.adjoint([],Jt);return a.bE.multiply(fn,fn,Bt)}(Pe[0],Pe[1],ze[0],ze[1],$e[0],$e[1],Xe[0],Xe[1]);this.elevatedGlobePerspectiveTransform=IF(Pe[0],Pe[1],ze[0],ze[1],$e[0],$e[1],Xe[0],Xe[1]);const Qe=(ct,vt)=>{C.push(ct.lng);const Nt=Math.round((ct.lng-k)/j*Ft),dt=Math.round((ct.lat-N)/$*Ft),Ut=Ae(vt),Lt=a.$.transformMat3([],[Ut[0],Ut[1],1],rt),Rt=Math.round(Lt[0]/Lt[2]*Ft),bn=Math.round(Lt[1]/Lt[2]*Ft);q.emplaceBack(Nt,dt,Rt,bn)},ut=u[3].x-u[0].x,At=u[3].y-u[0].y,ht=u[2].x-u[1].x,Ot=u[2].y-u[1].y;for(let ct=0;ct<65;ct++){const vt=ct/64,Nt=[u[0].x+vt*ut,u[0].y+vt*At],dt=[u[1].x+vt*ht,u[1].y+vt*Ot],Ut=dt[0]-Nt[0],Lt=dt[1]-Nt[1];for(let Rt=0;Rt<65;Rt++){const bn=Rt/64,fn={x:Nt[0]+Ut*bn,y:Nt[1]+Lt*bn,z:0};Qe(o.projection.unproject(fn.x,fn.y),fn)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(q,nT.members)}{this.maxLongitudeTriangleSize=0;let q=[],te=new Fs;const pe=(fe,me,Ae)=>{te.emplaceBack(fe,me,Ae);const Pe=C[fe],ze=C[me],$e=C[Ae],Xe=Math.min(Math.min(Pe,ze),$e),rt=Math.max(Math.max(Pe,ze),$e)-Xe;rt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=rt),q.push(Xe+rt/2)};for(let fe=0;fe<64;fe++)for(let me=0;me<64;me++){const Ae=65*fe+me,Pe=Ae+1,ze=Ae+65,$e=ze+1;pe(Ae,ze,Pe),pe(Pe,ze,$e)}[q,te]=function(fe,me){const Ae=Array.from({length:fe.length},($e,Xe)=>Xe);Ae.sort(($e,Xe)=>fe[$e]-fe[Xe]);const Pe=[],ze=new Fs;for(let $e=0;$e<Ae.length;$e++){const Xe=Ae[$e];Pe.push(fe[Xe]);const rt=3*Xe,Qe=rt+1;ze.emplaceBack(me.uint16[rt],me.uint16[Qe],me.uint16[Qe+1])}return[Pe,ze]}(q,te),this.elevatedGlobeTrianglesCenterLongitudes=q,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(te)}this.elevatedGlobeSegments=gi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,j/Ft,0,$/Ft,0,0,N,k,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const o=this.map.painter.context,u=o.gl;!this._dirty||this.texture instanceof eT||(this.texture?this.texture.update(this.image):(this.texture=new Ml(o,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(o)}loadTile(n,o){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},o(null)):(n.state="errored",o(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const o=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!o)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=n+180)+360*Math.round((u[0]-p)/360);var p;const m=new gi,v=(P,k)=>{m.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:o.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=w){const P=he(u,0,u.length,h+w);return P===u.length||v(P,J(u,P+1,u.length,h+360-w)-P),m}h<u[0]&&(h+=360);const E=J(u,0,u.length,h-w);if(E===u.length)return v(0,u.length),m;v(0,E-0);const C=he(u,E+1,u.length,h+w);return C!==u.length&&v(C,u.length-C),m}}const zY=(Math.pow(256,2)-1)/16907520;class AF extends da{constructor(n,o,u,h){super(n,{layout:EF||(EF=new Vr({visibility:new kt(Je.layout_raster.visibility)})),paint:SF||(SF=new Vr({"raster-opacity":new kt(Je.paint_raster["raster-opacity"]),"raster-color":new _o(Je.paint_raster["raster-color"]),"raster-color-mix":new kt(Je.paint_raster["raster-color-mix"]),"raster-color-range":new kt(Je.paint_raster["raster-color-range"]),"raster-hue-rotate":new kt(Je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kt(Je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kt(Je.paint_raster["raster-brightness-max"]),"raster-saturation":new kt(Je.paint_raster["raster-saturation"]),"raster-contrast":new kt(Je.paint_raster["raster-contrast"]),"raster-resampling":new kt(Je.paint_raster["raster-resampling"]),"raster-fade-duration":new kt(Je.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new kt(Je.paint_raster["raster-emissive-strength"]),"raster-array-band":new kt(Je.paint_raster["raster-array-band"]),"raster-elevation":new kt(Je.paint_raster["raster-elevation"])}))},o,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof CF&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const o=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Y0({expression:o,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let PF,RF,MF,kF,OF;class DF extends da{constructor(n,o,u,h){super(n,{layout:PF||(PF=new Vr({visibility:new kt(Je["layout_raster-particle"].visibility)})),paint:RF||(RF=new Vr({"raster-particle-array-band":new kt(Je["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new kt(Je["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new _o(Je["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new kt(Je["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new kt(Je["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new kt(Je["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new kt(Je["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new kt(Je["paint_raster-particle"]["raster-particle-elevation"])}))},o,u,h),this._updateColorRamp(),this.lastInvalidatedAt=tn.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,o=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Y0({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:o}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=tn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class NY extends da{constructor(n,o){super(n,{},o,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function a3(i,n,o){const u=[0,0,1],h=a.aw.identity([]);return a.aw.rotateY(h,h,o?-tr(i)+Math.PI:tr(i)),a.aw.rotateX(h,h,-tr(n)),a.$.transformQuat(u,u,h),a.$.normalize(u,u)}function LF(i,n){const o=aT(i.projection,i.zoom,i.width,i.height),u=function(p,m,v,w,E){const C=new Tr(v.lng-180*Hd,v.lat),P=new Tr(v.lng+180*Hd,v.lat),k=p.project(C.lng,C.lat),N=p.project(P.lng,P.lat),j=-Math.atan2(N.y-k.y,N.x-k.x),$=yo.fromLngLat(v);$.y=Hn($.y,-1+Hd,1-Hd);const q=$.toLngLat(),te=p.project(q.lng,q.lat),pe=yo.fromLngLat(q);pe.x+=Hd;const fe=pe.toLngLat(),me=p.project(fe.lng,fe.lat),Ae=FF(me.x-te.x,me.y-te.y,j),Pe=yo.fromLngLat(q);Pe.y+=Hd;const ze=Pe.toLngLat(),$e=p.project(ze.lng,ze.lat),Xe=FF($e.x-te.x,$e.y-te.y,j),rt=Math.abs(Ae.x)/Math.abs(Xe.y),Qe=a.ae.identity([]);a.ae.rotateZ(Qe,Qe,-j*(1-(E?0:w)));const ut=a.ae.identity([]);return a.ae.scale(ut,ut,[1,1-(1-rt)*w,1]),ut[4]=-Xe.x/Xe.y*w,a.ae.rotateZ(ut,ut,j),a.ae.multiply(ut,Qe,ut),ut}(i.projection,0,i.center,o,n),h=zF(i);return a.ae.scale(u,u,[h,h,1]),u}function zF(i){const n=i.projection,o=aT(i.projection,i.zoom,i.width,i.height),u=NF(n,i.center),h=NF(n,Tr.convert(n.center));return Math.pow(2,u*o+(1-o)*h)}function aT(i,n,o,u,h=1/0){const p=i.range;if(!p)return 0;const m=Math.min(h,Math.max(o,u)),v=Math.log(m/1024)/Math.LN2;return na(p[0]+v,p[1]+v,n)}const Hd=1/4e4;function NF(i,n){const o=Hn(n.lat,-Ui,Ui),u=new Tr(n.lng-180*Hd,o),h=new Tr(n.lng+180*Hd,o),p=i.project(u.lng,o),m=i.project(h.lng,o),v=yo.fromLngLat(u),w=yo.fromLngLat(h),E=m.x-p.x,C=m.y-p.y,P=w.x-v.x,k=w.y-v.y,N=Math.sqrt((P*P+k*k)/(E*E+C*C));return Math.log(N)/Math.LN2}function FF(i,n,o){const u=Math.cos(o),h=Math.sin(o);return{x:i*u-n*h,y:i*h+n*u}}function BF(i,n,o){a.ae.identity(i),a.ae.rotateZ(i,i,tr(n[2])),a.ae.rotateX(i,i,tr(n[0])),a.ae.rotateY(i,i,tr(n[1])),a.ae.scale(i,i,o),a.ae.multiply(i,i,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function lT(i,n,o,u,h,p,m,v){const w=[o[0]-n[0],o[1]-n[1],0],E=[u[0]-n[0],u[1]-n[1],0];if(a.$.length(w)<1e-12||a.$.length(E)<1e-12)return a.aw.identity(i);const C=a.$.cross([],w,E);a.$.normalize(C,C),a.$.subtract(E,u,n),w[2]=(p-h)*v,E[2]=(m-h)*v;const P=w;return a.$.cross(P,w,E),a.$.normalize(P,P),a.aw.rotationTo(i,C,P)}function l3(i,n,o=!1){const u=xh(n.zoom),h=function(p,m,v){const w=m.worldSize,E=[p[12],p[13],p[14]],C=Hs(E[1]/w),P=fa(E[0]/w),k=a.ae.identity([]),N=Vo(1,C)*w,j=Vo(1,0)*w*Np(C,m.zoom),$=1/IP(w);let q=j*$;if(v){const me=aT(m.projection,m.zoom,m.width,m.height,1024);q=$*m.projection.pixelSpaceConversion(m.center.lat,w,me)}const te=Lp(C,P);a.$.add(te,te,a.$.scale([],a.$.normalize([],te),N*q*E[2]));const pe=function(me){const Ae=[me[0],me[1],me[2]];let Pe=[0,1,0];const ze=a.$.cross([],Pe,Ae);return a.$.cross(Pe,Ae,ze),a.$.squaredLength(Pe)===0&&(Pe=[0,1,0],a.$.cross(ze,Ae,Pe)),a.$.normalize(ze,ze),a.$.normalize(Pe,Pe),a.$.normalize(Ae,Ae),[ze[0],ze[1],ze[2],0,Pe[0],Pe[1],Pe[2],0,Ae[0],Ae[1],Ae[2],0,me[0],me[1],me[2],1]}(te);a.ae.scale(k,k,[q,q,q*N]),a.ae.translate(k,k,[-E[0],-E[1],-E[2]]);const fe=a.ae.multiply([],m.globeMatrix,pe);return a.ae.multiply(fe,fe,k),a.ae.multiply(fe,fe,p),fe}(i,n,o);if(u>0){const p=function(m,v){const w=v.worldSize,E=Vo(1,0)*w*Np(v.center.lat,v.zoom)/IP(w),C=Vo(1,v.center.lat)*w,P=a.ae.identity([]);return a.ae.rotateY(P,P,tr(v.center.lng)),a.ae.rotateX(P,P,tr(v.center.lat)),a.ae.translate(P,P,[0,0,Uo]),a.ae.scale(P,P,[E,E,E*C]),a.ae.translate(P,P,[v.point.x-.5*w,v.point.y-.5*w,0]),a.ae.multiply(P,P,m),a.ae.multiply(P,v.globeMatrix,P)}(i,n);return function(m,v,w){const E=(j,$,q)=>{const te=a.$.length(j),pe=a.$.length($),fe=vh(j,$,q);return a.$.scale(fe,fe,1/a.$.length(fe)*Sn(te,pe,q))},C=E([m[0],m[1],m[2]],[v[0],v[1],v[2]],w),P=E([m[4],m[5],m[6]],[v[4],v[5],v[6]],w),k=E([m[8],m[9],m[10]],[v[8],v[9],v[10]],w),N=vh([m[12],m[13],m[14]],[v[12],v[13],v[14]],w);return[C[0],C[1],C[2],0,P[0],P[1],P[2],0,k[0],k[1],k[2],0,N[0],N[1],N[2],1]}(h,p,u)}return h}function jF(i,n,o,u){const h=ci.projectAabbCorners(u,o);let p=Number.MAX_VALUE,m=-1;for(let E=0;E<h.length;++E){const C=h[E];C[0]=(.5*C[0]+.5)*n.width,C[1]=(.5-.5*C[1])*n.height,C[2]<p&&(m=E,p=C[2])}const v=E=>new jt(h[E][0],h[E][1]);let w;switch(m){case 0:case 6:w=[v(1),v(5),v(4),v(7),v(3),v(2),v(1)];break;case 1:case 7:w=[v(0),v(4),v(5),v(6),v(2),v(3),v(0)];break;case 3:case 5:w=[v(1),v(0),v(4),v(7),v(6),v(2),v(1)];break;default:w=[v(1),v(5),v(6),v(7),v(3),v(0),v(1)]}if(gP(i,w))return p}const FY=Rr([{name:"a_pos_3f",components:3,type:"Float32"}]),BY=Rr([{name:"a_color_3f",components:3,type:"Float32"}]),jY=Rr([{name:"a_color_4f",components:4,type:"Float32"}]),UY=Rr([{name:"a_uv_2f",components:2,type:"Float32"}]),VY=Rr([{name:"a_normal_3f",components:3,type:"Float32"}]),$Y=Rr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),qY=Rr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class cT{constructor(n,o,u,h){this.message=(n?`${n}: `:"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)}}function UF(i,n){const o=i.indexOf("://")===-1;try{return new URL(i,o&&n?"http://example.com":void 0),!0}catch{return!1}}class VF{constructor(n,o){this.feature=n,this.instancedDataOffset=o,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class $F{constructor(){this.instancedDataArray=new JA,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class c3{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,o){}populate(n,o,u,h){this.tileToMeter=yw(u);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:v,index:w,sourceLayerIndex:E}of n){const C=v??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),P=yh(m,p);if(!this.layers[0]._featureFilter.filter(new Rn(this.zoom),P,u))continue;const k={id:C,sourceLayerIndex:E,index:w,geometry:p?P.geometry:bc(m,u,h),properties:m.properties,type:m.type,patterns:{}},N=this.addFeature(k,k.geometry,P);N&&o.featureIndex.insert(m,k.geometry,w,E,this.index,this.instancesPerModel[N].instancedDataArray.length,Ft/32)}this.lookup=null}update(n,o,u,h){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const v in n)m.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(m.features[m.idToFeaturesIndex[v]],n[v],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];for(const h of u.features){const p=this.layers[0],m=h.feature,v=this.canonical,w=p.paint.get("model-rotation").evaluate(m,{},v),E=p.paint.get("model-scale").evaluate(m,{},v),C=p.paint.get("model-translation").evaluate(m,{},v);a.$.exactEquals(h.rotation,w)&&a.$.exactEquals(h.scale,E)&&a.$.exactEquals(h.translation,C)||(this.evaluate(h,h.featureStates,u,!0),n=!0)}}return n}updateReplacement(n,o,u,h){if(o.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=o.updateTime;const p=o.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(zP(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const v in this.instancesPerModel){const w=this.instancesPerModel[v],E=w.instancedDataArray;for(const C of w.features){const P=C.instancedDataOffset,k=C.instancedDataCount;for(let N=0;N<k;N++){const j=16*(N+P);let $=E.float32[j+0];$=$>Ft?$-Ft:$;const q=Math.floor($),te=E.float32[j+1];let pe=!1;for(const fe of this.activeReplacements)if(!Mz(fe,u,Gz.Model,h)&&!(fe.min.x>q||q>fe.max.x||fe.min.y>te||te>fe.max.y)&&(pe=Nz(zz(q,te,n.canonical,fe.footprintTileId.canonical),fe),pe))break;E.float32[j]=pe?$+Ft:$,m=m||pe}}}return m}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=n.createVertexBuffer(u.instancedDataArray,$Y.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const o in this.instancesPerModel){const u=this.instancesPerModel[o];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const o of this.modelUris)n.removeModel(o,"")}addFeature(n,o,u){const h=this.layers[0],p=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!p)return bi(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;UF(p,!1)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new $F);const m=this.instancesPerModel[p],v=m.instancedDataArray,w=new VF(u,v.length);for(const E of o)for(const C of E){if(C.x<0||C.x>=Ft||C.y<0||C.y>=Ft)continue;const P=(this.lookupDim-1)/Ft,k=this.lookupDim*(C.y*P|0)+C.x*P|0;if(this.lookup){if(this.lookup[k]!==0)continue;this.lookup[k]=1}this.instanceCount++;const N=v.length;v.resize(N+1),m.instancesEvaluatedElevation.push(0),v.float32[16*N]=C.x,v.float32[16*N+1]=C.y}return w.instancedDataCount=m.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(n.id&&(m.idToFeaturesIndex[n.id]=m.features.length),m.features.push(w),this.evaluate(w,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(n,o,u,h){const p=this.layers[0],m=n.feature,v=this.canonical,w=n.rotation=p.paint.get("model-rotation").evaluate(m,o,v),E=n.scale=p.paint.get("model-scale").evaluate(m,o,v),C=n.translation=p.paint.get("model-translation").evaluate(m,o,v),P=p.paint.get("model-color").evaluate(m,o,v);P.a=p.paint.get("model-color-mix-intensity").evaluate(m,o,v);const k=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),BF(k,w,E);const N=Math.round(100*P.a)+P.b/1.05;for(let j=0;j<n.instancedDataCount;++j){const $=n.instancedDataOffset+j,q=16*$,te=u.instancedDataArray.float32;let pe=0;h&&(pe=te[q+6]-u.instancesEvaluatedElevation[$]);const fe=0|te[q+1];te[q]=(0|te[q])+P.r/1.05,te[q+1]=fe+P.g/1.05,te[q+2]=N,te[q+3]=1/(v.z>10?this.tileToMeter:yw(v,fe)),te[q+4]=C[0],te[q+5]=C[1],te[q+6]=C[2]+pe,te[q+7]=k[0],te[q+8]=k[1],te[q+9]=k[2],te[q+10]=k[4],te[q+11]=k[5],te[q+12]=k[6],te[q+13]=k[8],te[q+14]=k[9],te[q+15]=k[10],u.instancesEvaluatedElevation[$]=C[2]}}}let qF,GF;Ve(c3,"ModelBucket",{omit:["layers"]}),Ve($F,"PerModelAttributes"),Ve(VF,"ModelFeature");const $p=64,h_={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function WF(i,n,o,u,h,p,m,v,w,E=!1){const C=o.zoom,P=o.project(u),k=Np(u.lat,C),N=1/k;a.ae.identity(i),a.ae.translate(i,i,[P.x+m[0]*N,P.y+m[1]*N,m[2]]);let j=1,$=1;const q=o.worldSize;if(E){if(o.projection.name==="mercator"){let me=0;o.elevation&&(me=o.elevation.getAtPointOrZero(new yo(P.x/q,P.y/q),0));const Ae=a.aB.transformMat4([],[P.x,P.y,me,1],o.projMatrix)[3]/o.cameraToCenterDistance;j=Ae,$=Ae*Np(o.center.lat,C)}else if(o.projection.name==="globe"){const me=l3(i,o),Ae=a.ae.multiply([],o.projMatrix,me),Pe=[0,0,0,1];a.aB.transformMat4(Pe,Pe,Ae);const ze=Pe[3]/o.cameraToCenterDistance,$e=xh(C),Xe=o.projection.pixelsPerMeter(u.lat,q)*Np(u.lat,C),rt=o.projection.pixelsPerMeter(o.center.lat,q)*Np(o.center.lat,C);j=ze/Sn(Xe,DL(o.center.lat),$e),$=ze*k/Xe,j*=rt,$*=rt}}else j=N;a.ae.scale(i,i,[j,j,$]);const te=[...i],pe=n.orientation,fe=[];if(BF(fe,[pe[0]+h[0],pe[1]+h[1],pe[2]+h[2]],p),a.ae.multiply(i,te,fe),v&&o.elevation){let me=0;const Ae=[];if(w&&o.elevation){me=function($e,Xe,rt,Qe,ut){const At=Xe.elevation;if(!At)return 0;const ht=ci.projectAabbCorners(rt,Qe),Ot=Vo(1,ut.lat)*Xe.worldSize,ct=function(Pn,gn){const on=[0,0,1],zn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Bn of zn){const Nn=Pn[Bn.corners[0]],Wn=Pn[Bn.corners[1]],gr=Pn[Bn.corners[2]],sr=[Wn[0]-Nn[0],Wn[1]-Nn[1],gn*(Wn[2]-Nn[2])],Br=a.$.cross(sr,sr,[gr[0]-Nn[0],gr[1]-Nn[1],gn*(gr[2]-Nn[2])]);a.$.normalize(Br,Br),Bn.dotProductWithUp=a.$.dot(Br,on)}return zn.sort((Bn,Nn)=>Bn.dotProductWithUp-Nn.dotProductWithUp),zn[0].corners}(ht,Ot),vt=ht[ct[0]],Nt=ht[ct[1]],dt=ht[ct[2]],Ut=ht[ct[3]],Lt=At.getAtPointOrZero(new yo(vt[0]/Xe.worldSize,vt[1]/Xe.worldSize),0),Rt=At.getAtPointOrZero(new yo(Nt[0]/Xe.worldSize,Nt[1]/Xe.worldSize),0),bn=At.getAtPointOrZero(new yo(dt[0]/Xe.worldSize,dt[1]/Xe.worldSize),0),fn=At.getAtPointOrZero(new yo(Ut[0]/Xe.worldSize,Ut[1]/Xe.worldSize),0),Jt=(Lt+fn)/2,Bt=(Rt+bn)/2;return Jt>Bt?Rt<bn?lT($e,Nt,Ut,vt,Rt,fn,Lt,Ot):lT($e,dt,vt,Ut,bn,Lt,fn,Ot):Lt<fn?lT($e,vt,Nt,dt,Lt,Rt,bn,Ot):lT($e,Ut,dt,Nt,fn,bn,Rt,Ot),Math.max(Jt,Bt)}(Ae,o,n.aabb,i,u);const Pe=a.ae.fromQuat([],Ae),ze=a.ae.multiply([],Pe,fe);a.ae.multiply(i,te,ze)}else me=o.elevation.getAtPointOrZero(new yo(P.x/q,P.y/q),0);me!==0&&(i[14]+=me)}}function Tv(i,n,o=!1){i.uploaded||(i.gfxTexture=new Ml(n,i.image,o?n.gl.R8:n.gl.RGBA,{useMipmap:i.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),i.uploaded=!0,i.image=null)}function GY(i,n,o){i.indexBuffer=n.createIndexBuffer(i.indexArray,!1,!0),i.vertexBuffer=n.createVertexBuffer(i.vertexArray,FY.members,!1,!0),i.normalArray&&(i.normalBuffer=n.createVertexBuffer(i.normalArray,VY.members,!1,!0)),i.texcoordArray&&(i.texcoordBuffer=n.createVertexBuffer(i.texcoordArray,UY.members,!1,!0)),i.colorArray&&(i.colorBuffer=n.createVertexBuffer(i.colorArray,(i.colorArray.bytesPerElement===12?BY:jY).members,!1,!0)),i.featureArray&&(i.pbrBuffer=n.createVertexBuffer(i.featureArray,qY.members,!0)),i.segments=gi.simpleSegment(0,0,i.vertexArray.length,i.indexArray.length);const u=i.material;u.pbrMetallicRoughness.baseColorTexture&&Tv(u.pbrMetallicRoughness.baseColorTexture,n),u.pbrMetallicRoughness.metallicRoughnessTexture&&Tv(u.pbrMetallicRoughness.metallicRoughnessTexture,n),u.normalTexture&&Tv(u.normalTexture,n),u.occlusionTexture&&Tv(u.occlusionTexture,n,o),u.emissionTexture&&Tv(u.emissionTexture,n)}function u3(i,n,o){if(i.meshes)for(const u of i.meshes)GY(u,n,o);if(i.children)for(const u of i.children)u3(u,n,o)}function uT(i){if(i.meshes)for(const n of i.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(i.children)for(const n of i.children)uT(n)}function h3(i){if(i.meshes)for(const o of i.meshes)o.vertexBuffer&&(o.vertexBuffer.destroy(),o.indexBuffer.destroy(),o.normalBuffer&&o.normalBuffer.destroy(),o.texcoordBuffer&&o.texcoordBuffer.destroy(),o.colorBuffer&&o.colorBuffer.destroy(),o.pbrBuffer&&o.pbrBuffer.destroy(),o.segments.destroy(),o.material&&((n=o.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(i.children)for(const o of i.children)h3(o)}class WY{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class HY{constructor(){this.tasks={},this.taskQueue=[],th(["process"],this),this.invoker=new WY(this.process),this.nextId=0}add(n,o){const u=this.nextId++,h=function({type:p,isSymbolTile:m,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-v:p==="maybePrepare"&&m?400-v:500:200-v:100-v}(o);if(h===0){try{n()}finally{}return null}return this.tasks[u]={fn:n,metadata:o,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let n=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<o&&(o=p.priority,n=h)}if(n===null)return null;const u=this.taskQueue[n];return this.taskQueue.splice(n,1),u}remove(){this.invoker.remove()}}class HF{constructor(n,o,u){this.target=n,this.parent=o,this.mapId=u,this.callbacks={},this.cancelCallbacks={},th(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new HY}send(n,o,u,h,p=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=m,this.callbacks[v]=u);const w=new Set;return this.target.postMessage({id:v,type:n,hasCallback:!!u,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:Ze(o,w)},w),{cancel:()=>{u&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(n){const o=n.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(o.mustQueue||Fo()){const h=this.callbacks[u],p=this.scheduler.add(()=>this.processTask(u,o),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[u]=p)}else this.processTask(u,o)}processTask(n,o){if(delete this.cancelCallbacks[n],o.type==="<response>"){const u=this.callbacks[n];delete this.callbacks[n],u&&(o.error?u(ot(o.error)):u(null,ot(o.data)))}else{const u=new Set,h=o.hasCallback?(m,v)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:m?Ze(m):null,data:Ze(v,u)},u)}:m=>{},p=ot(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,p,h);else if(this.parent.getWorkerSource){const m=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,m[0],p.source,p.scope)[m[1]](p,h)}else h(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class d_{constructor(n,o){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=ac();const u=this.workerPool.acquire(this.id);for(let h=0;h<u.length;h++){const p=new d_.Actor(u[h],o,this.id);p.name=`Worker ${h}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,o,u){eh(this.actors,(h,p)=>{h.send(n,o,p)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}d_.Actor=HF;var Ev={workerUrl:"",workerClass:null,workerParams:void 0};function ZY(){return Ev.workerClass!=null?new Ev.workerClass:new self.Worker(Ev.workerUrl,Ev.workerParams)}const d3="mapboxgl_preloaded_worker_pool";class Sv{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Sv.workerCount;)this.workers.push(new ZY);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[d3]}numActive(){return Object.keys(this.active).length}}let Iv;function hT(){return Iv||(Iv=new Sv),Iv}Sv.workerCount=2;let dT,f3,Cc,f_,p3,p_=null;function ZF(){return Fo()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:f3||D.DRACO_URL}function XF(){if(Fo()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(f_)return f_;const i=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return f_=WebAssembly.validate(i)?D.MESHOPT_SIMD_URL:D.MESHOPT_URL,f_}const fT={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},XY={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Cv={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function KF(i,n,o){const u=o.json.bufferViews.length,h=o.buffers.length;n.bufferView=u,o.json.bufferViews[u]={buffer:h,byteLength:i.byteLength},o.buffers[h]=i}const m3="KHR_draco_mesh_compression";function KY(i,n){const o=i.extensions&&i.extensions[m3];if(!o)return;const u=new Cc.Decoder,h=eB(n,o.bufferView),p=new Cc.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=n.json.accessors[i.indices],v=fT[m.componentType],w=m.count*v.BYTES_PER_ELEMENT,E=Cc._malloc(w);v===Uint16Array?u.GetTrianglesUInt16Array(p,w,E):u.GetTrianglesUInt32Array(p,w,E),KF(Cc.memory.buffer.slice(E,E+w),m,n),Cc._free(E);for(const C of Object.keys(o.attributes)){const P=u.GetAttributeByUniqueId(p,o.attributes[C]),k=n.json.accessors[i.attributes[C]],N=XY[k.componentType],j=k.count*Cv[k.type]*fT[k.componentType].BYTES_PER_ELEMENT,$=Cc._malloc(j);u.GetAttributeDataArrayForAllPoints(p,P,Cc[N],j,$),KF(Cc.memory.buffer.slice($,$+j),k,n),Cc._free($)}u.destroy(),p.destroy(),delete i.extensions[m3]}const pT="EXT_meshopt_compression";function QY(i,n){if(!i.extensions||!i.extensions[pT])return;const o=i.extensions[pT],u=new Uint8Array(n.buffers[o.buffer],o.byteOffset||0,o.byteLength||0),h=new Uint8Array(o.count*o.byteStride);p3.decodeGltfBuffer(h,o.count,o.byteStride,u,o.mode,o.filter),i.buffer=n.buffers.length,i.byteOffset=0,n.buffers[i.buffer]=h.buffer,delete i.extensions[pT]}const QF=1179937895,YF=new TextDecoder("utf8");function JF(i,n){return new URL(i,n).href}function YY(i,n,o,u){return fetch(JF(i.uri,u)).then(h=>h.arrayBuffer()).then(h=>{n.buffers[o]=h})}function eB(i,n){const o=i.json.bufferViews[n];return new Uint8Array(i.buffers[o.buffer],o.byteOffset||0,o.byteLength)}function JY(i,n,o,u){if(i.uri){const h=JF(i.uri,u);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{n.images[o]=p})}if(i.bufferView!==void 0){const h=eB(n,i.bufferView),p=new Blob([h],{type:i.mimeType});return createImageBitmap(p).then(m=>{n.images[o]=m})}}function tB(i,n=0,o){const u={json:null,images:[],buffers:[]};if(new Uint32Array(i,n,1)[0]===QF){const C=new Uint32Array(i,n);let P=2;const k=(C[P++]>>2)-3,N=C[P++]>>2;if(P++,u.json=JSON.parse(YF.decode(C.subarray(P,P+N))),P+=N,P<k){const j=C[P++];P++;const $=n+(P<<2);u.buffers[0]=i.slice($,$+j)}}else u.json=JSON.parse(YF.decode(new Uint8Array(i,n)));const{buffers:h,images:p,meshes:m,extensionsUsed:v,bufferViews:w}=u.json;let E=Promise.resolve();if(h){const C=[];for(let P=0;P<h.length;P++){const k=h[P];k.uri?C.push(YY(k,u,P,o)):u.buffers[P]||(u.buffers[P]=null)}E=Promise.all(C)}return E.then(()=>{const C=[],P=v&&v.includes(m3),k=v&&v.includes(pT);if(P&&C.push(function(){if(!Cc)return dT||(dT=function(N){let j,$=null;function q(){j=new Uint8Array($.buffer)}function te(){throw new Error("Unexpected Draco error.")}const pe={a:{a:te,d:function(fe,me,Ae){return j.copyWithin(fe,me,me+Ae)},c:function(fe){const me=j.length,Ae=Math.max(fe>>>0,Math.ceil(1.2*me)),Pe=Math.ceil((Ae-me)/65536);try{return $.grow(Pe),q(),!0}catch{return!1}},b:te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,pe):N.then(fe=>fe.arrayBuffer()).then(fe=>WebAssembly.instantiate(fe,pe))).then(fe=>{const{Rb:me,Qb:Ae,P:Pe,T:ze,X:$e,Ja:Xe,La:rt,Qa:Qe,Va:ut,Wa:At,eb:ht,jb:Ot,f:ct,e:vt,yb:Nt,zb:dt,Ab:Ut,Bb:Lt,Db:Rt,Gb:bn}=fe.instance.exports;$=vt;const fn=(()=>{let Jt=0,Bt=0,Pn=0,gn=0;return on=>{Pn&&(me(gn),me(Jt),Bt+=Pn,Pn=Jt=0),Jt||(Bt+=128,Jt=Ae(Bt));const zn=on.length+7&-8;let Bn=Jt;zn>=Bt&&(Pn=zn,Bn=gn=Ae(zn));for(let Nn=0;Nn<on.length;Nn++)j[Bn+Nn]=on[Nn];return Bn}})();return q(),ct(),{memory:vt,_free:me,_malloc:Ae,Mesh:class{constructor(){this.ptr=Pe()}destroy(){ze(this.ptr)}},Decoder:class{constructor(){this.ptr=Xe()}destroy(){Ot(this.ptr)}DecodeArrayToMesh(Jt,Bt,Pn){const gn=fn(Jt),on=rt(this.ptr,gn,Bt,Pn.ptr);return!!$e(on)}GetAttributeByUniqueId(Jt,Bt){return{ptr:Qe(this.ptr,Jt.ptr,Bt)}}GetTrianglesUInt16Array(Jt,Bt,Pn){ut(this.ptr,Jt.ptr,Bt,Pn)}GetTrianglesUInt32Array(Jt,Bt,Pn){At(this.ptr,Jt.ptr,Bt,Pn)}GetAttributeDataArrayForAllPoints(Jt,Bt,Pn,gn,on){ht(this.ptr,Jt.ptr,Bt.ptr,Pn,gn,on)}},DT_INT8:Nt(),DT_UINT8:dt(),DT_INT16:Ut(),DT_UINT16:Lt(),DT_UINT32:Rt(),DT_FLOAT32:bn()}})}(fetch(ZF())),dT.then(N=>{Cc=N,dT=void 0}))}()),k&&C.push(function(){if(p3)return;const N=function(j){let $;const q=WebAssembly.instantiateStreaming(j,{}).then(fe=>{$=fe.instance,$.exports.__wasm_call_ctors()}),te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},pe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:q,supported:!0,decodeGltfBuffer(fe,me,Ae,Pe,ze,$e){(function(Xe,rt,Qe,ut,At,ht,Ot){const ct=Xe.exports.sbrk,vt=ut+3&-4,Nt=ct(vt*At),dt=ct(ht.length),Ut=new Uint8Array(Xe.exports.memory.buffer);Ut.set(ht,dt);const Lt=rt(Nt,ut,At,dt,ht.length);if(Lt===0&&Ot&&Ot(Nt,vt,At),Qe.set(Ut.subarray(Nt,Nt+ut*At)),ct(Nt-ct(0)),Lt!==0)throw new Error(`Malformed buffer data: ${Lt}`)})($,$.exports[pe[ze]],fe,me,Ae,Pe,$.exports[te[$e]])}}}(fetch(XF()));return N.ready.then(()=>{p3=N})}()),p)for(let N=0;N<p.length;N++)C.push(JY(p[N],u,N,o));return(C.length?Promise.all(C):Promise.resolve()).then(()=>{if(P&&m)for(const{primitives:N}of m)for(const j of N)KY(j,u);if(k&&m&&w)for(const N of w)QY(N,u);return u})})}function qp(i,n){const o=i.json.bufferViews[n.bufferView],u=fT[n.componentType];return new u(i.buffers[o.buffer],(n.byteOffset||0)+(o.byteOffset||0),n.count*(o.byteStride&&o.byteStride!==Cv[n.type]*u.BYTES_PER_ELEMENT?o.byteStride/u.BYTES_PER_ELEMENT:Cv[n.type]))}function g3(i,n,o,u){const h=fT[n.componentType],p=function(C){switch(C){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),m=i.json.bufferViews[n.bufferView],v=m.byteStride?m.byteStride/h.BYTES_PER_ELEMENT:Cv[n.type],w=o.float32,E=w.length/o.capacity;for(let C=0,P=0;C<n.count*v;C+=v,P+=E)for(let k=0;k<E;k++)w[P+k]=u[C+k]*p;o._trim()}function eJ(i,n,o){const u=i.indices,h=i.attributes,p={};p.indexArray=new Fs;const m=n.json.accessors[u],v=m.count/3;p.indexArray.reserve(v);const w=qp(n,m);for(let k=0;k<v;k++)p.indexArray.emplaceBack(w[3*k],w[3*k+1],w[3*k+2]);p.indexArray._trim(),p.vertexArray=new kd;const E=n.json.accessors[h.POSITION];p.vertexArray.reserve(E.count);const C=qp(n,E);for(let k=0;k<E.count;k++)p.vertexArray.emplaceBack(C[3*k],C[3*k+1],C[3*k+2]);if(p.vertexArray._trim(),p.aabb=new ci(E.min,E.max),p.centroid=function(k,N){const j=[0,0,0],$=k.length;if($>0){for(let q=0;q<$;q++){const te=3*k[q];j[0]+=N[te],j[1]+=N[te+1],j[2]+=N[te+2]}j[0]/=$,j[1]/=$,j[2]/=$}return j}(w,C),h.COLOR_0!==void 0){const k=n.json.accessors[h.COLOR_0],N=Cv[k.type],j=qp(n,k);p.colorArray=N===3?new kd:new Md,p.colorArray.resize(k.count),g3(n,k,p.colorArray,j)}if(h.NORMAL!==void 0){p.normalArray=new kd;const k=n.json.accessors[h.NORMAL];p.normalArray.resize(k.count);const N=qp(n,k);g3(n,k,p.normalArray,N)}if(h.TEXCOORD_0!==void 0&&o.length>0){p.texcoordArray=new q0;const k=n.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(k.count);const N=qp(n,k);g3(n,k,p.texcoordArray,N)}if(h._FEATURE_ID_RGBA4444!==void 0){const k=n.json.accessors[h._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=qp(n,k))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(qp(n,n.json.accessors[h._FEATURE_RGBA4444]).buffer));const P=i.material;return p.material=function(k,N){const{emissiveFactor:j=[0,0,0],alphaMode:$="OPAQUE",alphaCutoff:q=.5,normalTexture:te,occlusionTexture:pe,emissiveTexture:fe,doubleSided:me}=k,{baseColorFactor:Ae=[1,1,1,1],metallicFactor:Pe=1,roughnessFactor:ze=1,baseColorTexture:$e,metallicRoughnessTexture:Xe}=k.pbrMetallicRoughness||{},rt=pe?N[pe.index]:void 0;if(pe&&pe.extensions&&pe.extensions.KHR_texture_transform&&rt){const Qe=pe.extensions.KHR_texture_transform;rt.offsetScale=[Qe.offset[0],Qe.offset[1],Qe.scale[0],Qe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Sr(...Ae),metallicFactor:Pe,roughnessFactor:ze,baseColorTexture:$e?N[$e.index]:void 0,metallicRoughnessTexture:Xe?N[Xe.index]:void 0},doubleSided:me,emissiveFactor:j,alphaMode:$,alphaCutoff:q,normalTexture:te?N[te.index]:void 0,occlusionTexture:rt,emissionTexture:fe?N[fe.index]:void 0,defined:k.defined===void 0}}(P!==void 0?n.json.materials[P]:{defined:!1},o),p}function nB(i,n,o){const{matrix:u,rotation:h,translation:p,scale:m,mesh:v,extras:w,children:E}=i,C={};if(C.matrix=u||a.ae.fromRotationTranslationScale([],h||[0,0,0,1],p||[0,0,0],m||[1,1,1]),v!==void 0){C.meshes=o[v];const P=C.anchor=[0,0];for(const k of C.meshes){const{min:N,max:j}=k.aabb;P[0]+=N[0]+j[0],P[1]+=N[1]+j[1]}P[0]=Math.floor(P[0]/C.meshes.length/2),P[1]=Math.floor(P[1]/C.meshes.length/2)}if(w&&(w.id&&(C.id=w.id),w.lights&&(C.lights=function(P){if(!P.length)return[];const k=function(te){const pe=atob(te),fe=new Uint8Array(pe.length);for(let me=0;me<pe.length;me++)fe[me]=pe.codePointAt(me);return fe}(P),N=[],j=k.length/24,$=new Uint16Array(k.buffer),q=new Float32Array(k.buffer);for(let te=0;te<j;te++){const pe=$[2*te*6]/30,fe=$[2*te*6+1]/30,me=$[2*te*6+10]/100,Ae=q[6*te+1],Pe=q[6*te+2],ze=q[6*te+3],$e=q[6*te+4],Xe=ze-Ae,rt=$e-Pe,Qe=Math.hypot(Xe,rt);N.push({pos:[Ae+.5*Xe,Pe+.5*rt,fe],normal:[rt/Qe,-Xe/Qe,0],width:Qe,height:pe,depth:me,points:[Ae,Pe,ze,$e]})}return N}(w.lights))),E){const P=[];for(const k of E)P.push(nB(n.json.nodes[k],n,o));C.children=P}return C}function tJ(i){if(i.vertices.length===0||i.indices.length===0)return null;const n=new OP(i.vertices,i.indices,8,256),[o,u]=[n.min.clone(),n.max.clone()];return{vertices:i.vertices,indices:i.indices,grid:n,min:o,max:u}}function nJ(i){if(!i.extras||!i.extras.ground)return null;const n=i.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const o=n[0];if(!o||!Array.isArray(o)||o.length===0)return null;const u=[];for(const m of o){if(!Array.isArray(m)||m.length!==2)continue;const v=m[0],w=m[1];typeof v=="number"&&typeof w=="number"&&u.push(new jt(v,w))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let m=0;m<u.length;m++){const v=u[m],w=u[(m+1)%u.length],E=u[(m+2)%u.length];h+=(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)}h>0&&u.reverse();const p=J0(u.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:u,indices:p}}function rJ(i,n){const o=[],u=[];let h=0;const p=[];for(const m of i){h=o.length;const v=m.vertexArray.float32,w=m.indexArray.uint16;for(let E=0;E<m.vertexArray.length;E++)p[0]=v[3*E+0],p[1]=v[3*E+1],p[2]=v[3*E+2],a.$.transformMat4(p,p,n),o.push(new jt(p[0],p[1]));for(let E=0;E<3*m.indexArray.length;E++)u.push(w[E]+h)}if(u.length%3!=0)return null;for(let m=0;m<u.length;m+=3){const v=o[u[m+0]],w=o[u[m+1]],E=o[u[m+2]];(v.x-w.x)*(E.y-w.y)-(E.x-w.x)*(v.y-w.y)>0&&([u[m+1],u[m+2]]=[u[m+2],u[m+1]])}return{vertices:o,indices:u}}function rB(i){const n=function(w,E){const C=[],P=WebGL2RenderingContext;if(w.json.textures)for(const k of w.json.textures){const N={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};k.sampler!==void 0&&Object.assign(N,w.json.samplers[k.sampler]),C.push({image:E[k.source],sampler:N,uploaded:!1})}return C}(i,i.images),o=function(w,E){const C=[];for(const P of w.json.meshes){const k=[];for(const N of P.primitives)k.push(eJ(N,w,E));C.push(k)}return C}(i,n),{scenes:u,scene:h,nodes:p}=i.json,m=u?u[h||0].nodes:p,v=[];for(const w of m)v.push(nB(p[w],i,o));return function(w,E,C){const P={},k=new Set;for(let N=0;N<w.length;N++){const j=C[E[N]];if(!j.extras)continue;const $=j.extras["mapbox:footprint:version"],q=j.extras["mapbox:footprint:id"];($||q)&&k.add(N),$==="1.0.0"&&q&&(P[q]=N)}for(let N=0;N<w.length;N++){if(k.has(N))continue;const j=w[N],$=C[E[N]];if(!$.extras)continue;let q=null;j.id in P&&(q=rJ(w[P[j.id]].meshes,j.matrix)),q||(q=nJ($)),q&&(j.footprint=tJ(q))}if(k.size>0){const N=Array.from(k.values()).sort((j,$)=>j-$);for(let j=N.length-1;j>=0;j--)w.splice(N[j],1)}}(v,m,i.json.nodes),v}function iJ(i){i.heightmap=new Float32Array(4096),i.heightmap.fill(-1);const n=i.vertexArray.float32,o=i.aabb.min[0]-1,u=i.aabb.min[1]-1,h=$p/(i.aabb.max[0]-o+2),p=$p/(i.aabb.max[1]-u+2);for(let m=0;m<n.length;m+=3){const v=n[m+2],w=(n[m+0]-o)*h|0,E=(n[m+1]-u)*p|0;v>i.heightmap[E*$p+w]&&(i.heightmap[E*$p+w]=v)}}function sJ(i,n){const o={};o.indexArray=new Fs,o.indexArray.reserve(4*i.length),o.vertexArray=new kd,o.vertexArray.reserve(10*i.length),o.colorArray=new Md,o.vertexArray.reserve(10*i.length);let u=0;for(const m of i){const v=Math.min(10,Math.max(4,1.3*m.height))*n,w=[-m.normal[1],m.normal[0],0],E=Math.min(.29,.1*m.width/m.depth),C=m.width-2*m.depth*n*(E+.01),P=a.$.scaleAndAdd([],m.pos,w,C/2),k=a.$.scaleAndAdd([],m.pos,w,-C/2),N=[P[0],P[1],P[2]+m.height],j=[k[0],k[1],k[2]+m.height],$=a.$.scaleAndAdd([],m.normal,w,E);a.$.scale($,$,v);const q=a.$.scaleAndAdd([],m.normal,w,-E);a.$.scale(q,q,v),a.$.add($,P,$),a.$.add(q,k,q),P[2]+=.1,k[2]+=.1,o.vertexArray.emplaceBack($[0],$[1],$[2]),o.vertexArray.emplaceBack(q[0],q[1],q[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(k[0],k[1],k[2]),o.vertexArray.emplaceBack(N[0],N[1],N[2]),o.vertexArray.emplaceBack(j[0],j[1],j[2]),o.vertexArray.emplaceBack(P[0],P[1],P[2]),o.vertexArray.emplaceBack(k[0],k[1],k[2]),o.vertexArray.emplaceBack($[0],$[1],$[2]),o.vertexArray.emplaceBack(q[0],q[1],q[2]);const te=C/v/2;o.colorArray.emplaceBack(-te-E,-1,te,.8),o.colorArray.emplaceBack(te+E,-1,te,.8),o.colorArray.emplaceBack(-te,0,te,1.3),o.colorArray.emplaceBack(te,0,te,1.3),o.colorArray.emplaceBack(te+E,-.8,te,.7),o.colorArray.emplaceBack(te+E,-.8,te,.7),o.colorArray.emplaceBack(0,0,te,1.3),o.colorArray.emplaceBack(0,0,te,1.3),o.colorArray.emplaceBack(te+E,-1.2,te,.8),o.colorArray.emplaceBack(te+E,-1.2,te,.8),o.indexArray.emplaceBack(6+u,4+u,8+u),o.indexArray.emplaceBack(7+u,9+u,5+u),o.indexArray.emplaceBack(0+u,1+u,2+u),o.indexArray.emplaceBack(1+u,3+u,2+u),u+=10}const h={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=Sr.white,h.pbrMetallicRoughness=p,o.material=h,o.aabb=new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),o}const _3=new Float32Array(262144),Gp=new Uint8Array(262144);function iB(i){let n=0;if(i.meshes)for(const o of i.meshes)n=Math.max(n,o.aabb.max[2]);if(i.children)for(const o of i.children)n=Math.max(n,iB(o));return n}function sB(i,n,o){if(i.meshes)for(const u of i.meshes)u.aabb.min[0]!==1/0&&o.insert(n,u.aabb.min[0],u.aabb.min[1],u.aabb.max[0],u.aabb.max[1]);if(i.children)for(const u of i.children)sB(u,n,o)}const oB=["","wall","door","roof","window","lamp","logo"];class aB{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:n.id,geometry:[],properties:{height:iB(n)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const o=new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==n&&(u.transformedAabb=ci.applyTransformFast(u.aabb,this.node.matrix),o.encapsulate(u.transformedAabb)),n++;this.aabb=o}return this.aabb}}class mT{constructor(n,o,u,h,p,m){this.id=o,this.modelTraits|=h_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=h_.HasMapboxMeshFeatures),h&&(this.modelTraits|=h_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const v of n)this.nodesInfo.push(new aB(v)),sB(v,m.featureIndexArray.length,m.grid),m.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,m.bucketLayerIDs.length-1,0)}updateFootprints(n,o){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&o.push({footprint:h.footprint,id:n})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const o=this.getNodesInfo();for(const u of o){const h=u.node;this.uploaded?this.updatePbrBuffer(h):u3(h,n,!0)}for(const u of o)uT(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let o=!1;if(!n.meshes)return o;for(const u of n.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),o=!0);return o}needsReEvaluation(n,o,u){const h=n.transform.projectionOptions,p=n.style.getBrightness(),m=this.brightness!==p;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||Av(u.paint.get("model-color").value,m)||Av(u.paint.get("model-color-mix-intensity").value,m)||Av(u.paint.get("model-roughness").value,m)||Av(u.paint.get("model-emissive-strength").value,m)||Av(u.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=h,this.brightness=p,!0)}evaluateScale(n,o){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const p of u){const m=p.feature;p.evaluatedScale=o.paint.get("model-scale").evaluate(m,{},h)}}evaluate(n){const o=this.getNodesInfo();for(const u of o){if(!u.node.meshes)continue;const h=u.feature,p=u.node.meshes&&u.node.meshes[0].featureData,m=u.evaluatedColor[2],v=u.evaluatedRMEA[2],w=this.id.canonical;if(u.hasTranslucentParts=!1,p){for(let E=0;E<oB.length;E++){const C=oB[E];C.length&&(h.properties.part=C);const P=n.paint.get("model-color").evaluate(h,{},w).toRenderColor(null),k=n.paint.get("model-color-mix-intensity").evaluate(h,{},w);u.evaluatedColor[E]=[P.r,P.g,P.b,k],u.evaluatedRMEA[E][0]=n.paint.get("model-roughness").evaluate(h,{},w),u.evaluatedRMEA[E][2]=n.paint.get("model-emissive-strength").evaluate(h,{},w),u.evaluatedRMEA[E][3]=P.a,u.emissionHeightBasedParams[E]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},w),!u.hasTranslucentParts&&P.a<1&&(u.hasTranslucentParts=!0)}delete h.properties.part,aJ(u,m!==u.evaluatedColor[2]||v!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(h,{},w);u.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},w),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,o,u,h){const p=n.findDEMTileFor(u);if(p&&(p.tileID.canonical!==this.terrainTile||o!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=e_.create(n,u,p);if(!m)return;this.modelTraits&h_.HasMapboxMeshFeatures&&this.updateDEM(n,m,u,h);for(const v of this.getNodesInfo()){const w=v.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const E=w.footprint.vertices;let C=m.getElevationAt(E[0].x,E[0].y,!0,!0);for(let P=1;P<E.length;P++)C=Math.min(C,m.getElevationAt(E[P].x,E[P].y,!0,!0));w.elevation=C}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=o}}updateDEM(n,o,u,h){let p=o._dem._modifiedForSources[h];if(p===void 0&&(o._dem._modifiedForSources[h]=[],p=o._dem._modifiedForSources[h]),p.includes(u.canonical))return;const m=o._dem.dim;p.push(u.canonical);let v=!1;for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.grid)continue;const C=E.footprint.grid,P=o.tileCoordToPixel(C.min.x,C.min.y),k=o.tileCoordToPixel(C.max.x,C.max.y),N=Math.min(Math.min(m-k.y,P.x),Math.min(P.y,m-k.x));if(N<0)continue;const j=Hn(N,2,5);let $=Math.max(0,P.x-j),q=Math.max(0,P.y-j),te=Math.min(k.x+j,m-1),pe=Math.min(k.y+j,m-1);for(let Pe=q;Pe<=pe;++Pe)for(let ze=$;ze<=te;++ze)Gp[Pe*m+ze]=255;let fe=0,me=0;for(let Pe=0;Pe<C.cellsY;++Pe)for(let ze=0;ze<C.cellsX;++ze){if(!C.cells[Pe*C.cellsX+ze])continue;const $e=o.tileCoordToPixel(C.min.x+ze/C.xScale,C.min.y+Pe/C.yScale),Xe=o.tileCoordToPixel(C.min.x+(ze+1)/C.xScale,C.min.y+(Pe+1)/C.yScale);for(let rt=$e.y;rt<=Math.min(Xe.y+1,m-1);++rt)for(let Qe=$e.x;Qe<=Math.min(Xe.x+1,m-1);++Qe)Gp[rt*m+Qe]===255&&(Gp[rt*m+Qe]=0,fe+=o.getElevationAtPixel(Qe,rt),me++)}const Ae=fe/me;$=Math.max(1,P.x-j),q=Math.max(1,P.y-j),te=Math.min(k.x+j,m-2),pe=Math.min(k.y+j,m-2),v=!0;for(let Pe=q;Pe<=pe;++Pe)for(let ze=$;ze<=te;++ze)Gp[Pe*m+ze]===0&&(_3[Pe*m+ze]=o._dem.set(ze,Pe,Ae));for(let Pe=1;Pe<j;++Pe){$=Math.max(1,P.x-Pe),q=Math.max(1,P.y-Pe),te=Math.min(k.x+Pe,m-2),pe=Math.min(k.y+Pe,m-2);for(let ze=q;ze<=pe;++ze)for(let $e=$;$e<=te;++$e){const Xe=ze*m+$e;if(Gp[Xe]===255){let rt=0,Qe=0,ut=-1,At=-1;for(let ht=-1;ht<=1;++ht)for(let Ot=-1;Ot<=1;++Ot){const ct=(ze+ht)*m+$e+Ot;if(Gp[ct]>=Pe)continue;const vt=_3[ct],Nt=Math.abs(vt);Nt>Qe&&(rt=vt,Qe=Nt,ut=Ot,At=ht)}if(Qe>.1){const ht=1-(Pe+.5*Math.abs(ut*At))/j;let Ot=o._dem.get($e,ze)+rt*ht;const ct=o._dem.get($e+ut,ze+At),vt=o._dem.get($e-ut,ze-At,!0);(Ot-ct)*(Ot-vt)>0&&(Ot=(ct+vt)/2),_3[Xe]=o._dem.set($e,ze,Ot),Gp[Xe]=Pe}}}}}v&&(o._demTile.needsDEMTextureUpload=!0,o._dem._timestamp=tn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const o of n)uT(o.node),h3(o.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,o){if(o.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=o.updateTime;const u=o.getReplacementRegionsForTile(n.toUnwrapped()),h=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const m=h[p].node;h[p].hiddenByReplacement=!!m.footprint&&!u.find(v=>v.footprint===m.footprint)}}getHeightAtTileCoord(n,o){const u=this.getNodesInfo(),h=[],p=[0,0,0],m=a.ae.identity([]);for(let v=0;v<this.nodesInfo.length;v++){const w=u[v],E=w.node.meshes[0],C=E.transformedAabb;if(n<C.min[0]||o<C.min[1]||n>C.max[0]||o>C.max[1])continue;if(w.node.hidden===!0)return{height:0,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};a.ae.invert(m,w.node.matrix),p[0]=n,p[1]=o,a.$.transformMat4(p,p,m);const P=(p[0]-E.aabb.min[0])/(E.aabb.max[0]-E.aabb.min[0])*$p|0,k=Math.min(63,(p[1]-E.aabb.min[1])/(E.aabb.max[1]-E.aabb.min[1])*$p|0)*$p+Math.min(63,P),N=E.heightmap[k];if(!(N<0&&w.node.footprint))return w.hiddenByReplacement?void 0:{height:N,maxHeight:w.feature.properties.height,hidden:!1,verticalScale:w.evaluatedScale[2]};if(w.node.footprint.grid.query(new jt(n,o),new jt(n,o),h),h.length>0)return{height:void 0,maxHeight:w.feature.properties.height,hidden:w.hiddenByReplacement,verticalScale:w.evaluatedScale[2]}}}}function Av(i,n){return!i.isLightConstant&&n}function oJ(i,n,o,u,h,p,m,v){let w=(61440&n|(61440&n)>>4)>>8,E=(3840&n|(3840&n)>>4)>>4,C=240&n|(240&n)>>4;o[3]>0&&(w=Sn(w,255*o[0],o[3]),E=Sn(E,255*o[1],o[3]),C=Sn(C,255*o[2],o[3]));const P=w<<8|E,k=C<<8|Math.floor(255*u[3]),N=function(Pe){const ze=Hn(Pe,0,2);return Math.min(Math.round(.5*ze*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],j=Hn(h[0],0,1),$=Hn(h[1],0,1),q=Hn(h[2],0,1),te=Hn(h[3],0,1);let pe,fe,me,Ae;if(j!==$&&m!==p&&$!==j){const Pe=m-p;fe=1/(Pe*($-j)),me=-(p+Pe*j)/(Pe*($-j));const ze=Hn(h[4],-1,1);Ae=Math.pow(10,ze),pe=255*q<<8|255*te}else pe=65535,fe=0,me=1,Ae=1;if(i.emplaceBack(P,k,N,pe,fe,me,Ae),v){const Pe=v.length;v.clear();for(let ze=0;ze<Pe;ze++)v.emplaceBack(P,k,N,pe,fe,me,Ae)}}function aJ(i,n,o){const u=i.node;let h=0;const p=o&h_.HasMeshoptCompression;for(const m of u.meshes){if(u.lights&&u.lightMeshIndex===h||!m.featureData)continue;m.featureArray=new mw,m.featureArray.reserve(m.featureData.length);let v=n;for(const w of m.featureData){const E=p?65535&w:w>>16&65535,C=p?w>>16&65535:65535&w,P=(15&C)<8?15&C:0,k=i.evaluatedRMEA[P],N=i.evaluatedColor[P],j=i.emissionHeightBasedParams[P];let $;if(v&&P===2&&u.lights&&($=new mw,$.resize(10*u.lights.length)),oJ(m.featureArray,E,N,k,j,m.aabb.min[2],m.aabb.max[2],$),$&&v){v=!1;const q=u.meshes[u.lightMeshIndex];q.featureArray=$,q.featureArray._trim()}}m.featureArray._trim(),h++}}function lB(i,n,o,u){const h=1<<i.z;n.lat=Hs((u/Ft+i.y)/h),n.lng=fa((o/Ft+i.x)/h)}Ve(mT,"Tiled3dModelBucket",{omit:["layers"]}),Ve(aB,"Tiled3dModelFeature");const lJ={circle:class extends da{constructor(i,n,o,u){super(i,{layout:qL||(qL=new Vr({"circle-sort-key":new an(Je.layout_circle["circle-sort-key"]),visibility:new kt(Je.layout_circle.visibility)})),paint:GL||(GL=new Vr({"circle-radius":new an(Je.paint_circle["circle-radius"]),"circle-color":new an(Je.paint_circle["circle-color"]),"circle-blur":new an(Je.paint_circle["circle-blur"]),"circle-opacity":new an(Je.paint_circle["circle-opacity"]),"circle-translate":new kt(Je.paint_circle["circle-translate"]),"circle-translate-anchor":new kt(Je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kt(Je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kt(Je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new an(Je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new an(Je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new an(Je.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new kt(Je.paint_circle["circle-emissive-strength"])}))},n,o,u)}createBucket(i){return new mP(i)}queryRadius(i){const n=i;return Qg("circle-radius",this,n)+Qg("circle-stroke-width",this,n)+bw(this.paint.get("circle-translate"))}queryIntersectsFeature(i,n,o,u,h,p,m,v){const w=$L(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return oz(i,u,p,m,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(i,n,o){const u=sz(this);return{config:new Dp(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}},heatmap:class extends da{createBucket(i){return new lz(i)}constructor(i,n,o,u){super(i,{layout:dz||(dz=new Vr({visibility:new kt(Je.layout_heatmap.visibility)})),paint:fz||(fz=new Vr({"heatmap-radius":new an(Je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new an(Je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kt(Je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _o(Je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kt(Je.paint_heatmap["heatmap-opacity"])}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Y0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Qg("heatmap-radius",this,i)}queryIntersectsFeature(i,n,o,u,h,p,m,v){const w=this.paint.get("heatmap-radius").evaluate(n,o);return oz(i,u,p,m,v,!0,!0,new jt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(i,n,o){return i==="heatmap"?{config:new Dp(this,{zoom:n,lut:o}),overrideFog:!1}:{}}},hillshade:class extends da{constructor(i,n,o,u){super(i,{layout:pz||(pz=new Vr({visibility:new kt(Je.layout_hillshade.visibility)})),paint:mz||(mz=new Vr({"hillshade-illumination-direction":new kt(Je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kt(Je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kt(Je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kt(Je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kt(Je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kt(Je.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new kt(Je.paint_hillshade["hillshade-emissive-strength"])}))},n,o,u)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(i,n,o){return{overrideFog:!1}}},fill:class extends da{constructor(i,n,o,u){super(i,{layout:xz||(xz=new Vr({"fill-sort-key":new an(Je.layout_fill["fill-sort-key"]),visibility:new kt(Je.layout_fill.visibility)})),paint:bz||(bz=new Vr({"fill-antialias":new kt(Je.paint_fill["fill-antialias"]),"fill-opacity":new an(Je.paint_fill["fill-opacity"]),"fill-color":new an(Je.paint_fill["fill-color"]),"fill-outline-color":new an(Je.paint_fill["fill-outline-color"]),"fill-translate":new kt(Je.paint_fill["fill-translate"]),"fill-translate-anchor":new kt(Je.paint_fill["fill-translate-anchor"]),"fill-pattern":new an(Je.paint_fill["fill-pattern"]),"fill-emissive-strength":new kt(Je.paint_fill["fill-emissive-strength"])}))},n,o,u)}getProgramIds(){const i=this.paint.get("fill-pattern"),n=i&&i.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getDefaultProgramParams(i,n,o){return{config:new Dp(this,{zoom:n,lut:o}),overrideFog:!1}}recalculate(i,n){super.recalculate(i,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Rw(i)}queryRadius(){return bw(this.paint.get("fill-translate"))}queryIntersectsFeature(i,n,o,u,h,p){return!i.queryGeometry.isAboveHorizon&&FL(VL(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends da{constructor(i,n,o,u){super(i,{layout:sN||(sN=new Vr({visibility:new kt(Je["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new kt(Je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:oN||(oN=new Vr({"fill-extrusion-opacity":new kt(Je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new an(Je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kt(Je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kt(Je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new an(Je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new an(Je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new an(Je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new kt(Je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new kt(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new kt(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new kt(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new kt(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new kt(Je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new kt(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new kt(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new an(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new an(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new kt(Je["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new kt(Je["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new kt(Je["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new kt(Je["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(Je["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new an(Je["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-line-alignment":new kt(Je["paint_fill-extrusion"]["fill-extrusion-line-alignment"])}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new Fw(i)}queryRadius(){return bw(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(i,n,o,u,h,p,m,v,w){const E=$L(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(n,o),P=this.paint.get("fill-extrusion-base").evaluate(n,o),k=[0,0],N=v&&p.elevation,j=p.elevation?p.elevation.exaggeration():1,$=i.tile.getBucket(this);if(N&&$ instanceof Fw){const me=$.centroidVertexArray,Ae=w+1;Ae<me.length&&(k[0]=me.geta_centroid_pos0(Ae),k[1]=me.geta_centroid_pos1(Ae))}if(k[0]===0&&k[1]===1)return!1;p.projection.name==="globe"&&(u=iN([u],[new jt(0,0),new jt(Ft,Ft)],i.tileID.canonical).map(me=>me.polygon).flat());const q=N?v:null,[te,pe]=function(me,Ae,Pe,ze,$e,Xe,rt,Qe,ut,At,ht){return me.projection.name==="globe"?function(Ot,ct,vt,Nt,dt,Ut,Lt,Rt,bn,fn,Jt){const Bt=[],Pn=[],gn=Ot.projection.upVectorScale(Jt,Ot.center.lat,Ot.worldSize).metersToTile,on=[0,0,0,1],zn=[0,0,0,1],Bn=(Wn,gr,sr,Br)=>{Wn[0]=gr,Wn[1]=sr,Wn[2]=Br,Wn[3]=1},Nn=rN();vt>0&&(vt+=Nn),Nt+=Nn;for(const Wn of ct){const gr=[],sr=[];for(const Br of Wn){const $r=Br.x+dt.x,jn=Br.y+dt.y,Mr=Ot.projection.projectTilePoint($r,jn,Jt),Dr=Ot.projection.upVector(Jt,Br.x,Br.y);let Jr=vt,Oi=Nt;if(Lt){const Hi=lN($r,jn,vt,Nt,Lt,Rt,bn,fn);Jr+=Hi.base,Oi+=Hi.top}vt!==0?Bn(on,Mr.x+Dr[0]*gn*Jr,Mr.y+Dr[1]*gn*Jr,Mr.z+Dr[2]*gn*Jr):Bn(on,Mr.x,Mr.y,Mr.z),Bn(zn,Mr.x+Dr[0]*gn*Oi,Mr.y+Dr[1]*gn*Oi,Mr.z+Dr[2]*gn*Oi),a.$.transformMat4(on,on,Ut),a.$.transformMat4(zn,zn,Ut),gr.push(new Bp(on[0],on[1],on[2])),sr.push(new Bp(zn[0],zn[1],zn[2]))}Bt.push(gr),Pn.push(sr)}return[Bt,Pn]}(me,Ae,Pe,ze,$e,Xe,rt,Qe,ut,At,ht):rt?function(Ot,ct,vt,Nt,dt,Ut,Lt,Rt,bn){const fn=[],Jt=[],Bt=[0,0,0,1];for(const Pn of Ot){const gn=[],on=[];for(const zn of Pn){const Bn=zn.x+Nt.x,Nn=zn.y+Nt.y,Wn=lN(Bn,Nn,ct,vt,Ut,Lt,Rt,bn);Bt[0]=Bn,Bt[1]=Nn,Bt[2]=Wn.base,Bt[3]=1,a.aB.transformMat4(Bt,Bt,dt),Bt[3]=Math.max(Bt[3],1e-5);const gr=new Bp(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);Bt[0]=Bn,Bt[1]=Nn,Bt[2]=Wn.top,Bt[3]=1,a.aB.transformMat4(Bt,Bt,dt),Bt[3]=Math.max(Bt[3],1e-5);const sr=new Bp(Bt[0]/Bt[3],Bt[1]/Bt[3],Bt[2]/Bt[3]);gn.push(gr),on.push(sr)}fn.push(gn),Jt.push(on)}return[fn,Jt]}(Ae,Pe,ze,$e,Xe,rt,Qe,ut,At):function(Ot,ct,vt,Nt,dt){const Ut=[],Lt=[],Rt=dt[8]*ct,bn=dt[9]*ct,fn=dt[10]*ct,Jt=dt[11]*ct,Bt=dt[8]*vt,Pn=dt[9]*vt,gn=dt[10]*vt,on=dt[11]*vt;for(const zn of Ot){const Bn=[],Nn=[];for(const Wn of zn){const gr=Wn.x+Nt.x,sr=Wn.y+Nt.y,Br=dt[0]*gr+dt[4]*sr+dt[12],$r=dt[1]*gr+dt[5]*sr+dt[13],jn=dt[2]*gr+dt[6]*sr+dt[14],Mr=dt[3]*gr+dt[7]*sr+dt[15],Dr=Br+Rt,Jr=$r+bn,Oi=jn+fn,Hi=Math.max(Mr+Jt,1e-5),Di=Br+Bt,wi=$r+Pn,Bs=jn+gn,ls=Math.max(Mr+on,1e-5);Bn.push(new Bp(Dr/Hi,Jr/Hi,Oi/Hi)),Nn.push(new Bp(Di/ls,wi/ls,Bs/ls))}Ut.push(Bn),Lt.push(Nn)}return[Ut,Lt]}(Ae,Pe,ze,$e,Xe)}(p,u,P,C,E,m,q,k,j,p.center.lat,i.tileID.canonical),fe=i.queryGeometry;return function(me,Ae,Pe){let ze=1/0;FL(Pe,Ae)&&(ze=aN(Pe,Ae[0]));for(let $e=0;$e<Ae.length;$e++){const Xe=Ae[$e],rt=me[$e];for(let Qe=0;Qe<Xe.length-1;Qe++){const ut=Xe[Qe],At=[ut,Xe[Qe+1],rt[Qe+1],rt[Qe],ut];gP(Pe,At)&&(ze=Math.min(ze,aN(Pe,At)))}}return ze!==1/0&&ze}(te,pe,fe.isPointQuery()?fe.screenBounds:fe.screenGeometry)}},line:class extends da{constructor(i,n,o,u){const h=_F();super(i,h,n,o,u),h.layout&&(this.layout=new Ws(h.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Cd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,n){super.recalculate(i,n),this.paint._values["line-floorwidth"]=(()=>{if(wv)return wv;const o=_F();return wv=new LY(o.paint.properties["line-width"].specification),wv.useIntegerZoom=!0,wv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Bw(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(i,n,o){const u=yN(this);return{config:new Dp(this,{zoom:n,lut:o}),defines:u,overrideFog:!1}}queryRadius(i){const n=i,o=xF(Qg("line-width",this,n),Qg("line-gap-width",this,n)),u=Qg("line-offset",this,n);return o/2+Math.abs(u)+bw(this.paint.get("line-translate"))}queryIntersectsFeature(i,n,o,u,h,p){if(i.queryGeometry.isAboveHorizon)return!1;const m=VL(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*xF(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),w=this.paint.get("line-offset").evaluate(n,o);return w&&(u=function(E,C){const P=[],k=new jt(0,0);for(let N=0;N<E.length;N++){const j=E[N],$=[];for(let q=0;q<j.length;q++){const te=j[q],pe=j[q+1],fe=q===0?k:te.sub(j[q-1])._unit()._perp(),me=q===j.length-1?k:pe.sub(te)._unit()._perp(),Ae=fe._add(me)._unit();Ae._mult(1/(Ae.x*me.x+Ae.y*me.y)),$.push(Ae._mult(C)._add(te))}P.push($)}return P}(u,w*i.pixelToTileUnitsFactor)),function(E,C,P){for(let k=0;k<C.length;k++){const N=C[k];if(E.length>=3){for(let j=0;j<N.length;j++)if(Fd(E,N[j]))return!0}if(aK(E,N,P))return!0}return!1}(m,u,v)}isTileClipped(){return!0}isDraped(i){const n=this.layout.get("line-z-offset");return n.isConstant()&&!n.constantOr(0)}},symbol:iT,background:class extends da{constructor(i,n,o,u){super(i,{layout:wF||(wF=new Vr({visibility:new kt(Je.layout_background.visibility)})),paint:TF||(TF=new Vr({"background-color":new kt(Je.paint_background["background-color"]),"background-pattern":new kt(Je.paint_background["background-pattern"]),"background-opacity":new kt(Je.paint_background["background-opacity"]),"background-emissive-strength":new kt(Je.paint_background["background-emissive-strength"])}))},n,o,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(i,n,o){return{overrideFog:!1}}},raster:AF,"raster-particle":DF,sky:class extends da{constructor(i,n,o,u){super(i,{layout:MF||(MF=new Vr({visibility:new kt(Je.layout_sky.visibility)})),paint:kF||(kF=new Vr({"sky-type":new kt(Je.paint_sky["sky-type"]),"sky-atmosphere-sun":new kt(Je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new kt(Je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new kt(Je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new kt(Je.paint_sky["sky-gradient-radius"]),"sky-gradient":new _o(Je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new kt(Je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new kt(Je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new kt(Je.paint_sky["sky-opacity"])}))},n,o,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Y0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(i,n){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,p=i.style.light,m=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&bi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?a3(m.azimuthal,90-m.polar,n):a3(u[0],90-u[1],n)}const o=this.paint.get("sky-gradient-center");return a3(o[0],90-o[1],n)}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}},slot:class extends da{constructor(i,n,o,u){super(i,{paint:OF||(OF=new Vr({}))},n,null)}},model:class extends da{constructor(i,n,o,u){super(i,{layout:qF||(qF=new Vr({visibility:new kt(Je.layout_model.visibility),"model-id":new an(Je.layout_model["model-id"])})),paint:GF||(GF=new Vr({"model-opacity":new kt(Je.paint_model["model-opacity"]),"model-rotation":new an(Je.paint_model["model-rotation"]),"model-scale":new an(Je.paint_model["model-scale"]),"model-translation":new an(Je.paint_model["model-translation"]),"model-color":new an(Je.paint_model["model-color"]),"model-color-mix-intensity":new an(Je.paint_model["model-color-mix-intensity"]),"model-type":new kt(Je.paint_model["model-type"]),"model-cast-shadows":new kt(Je.paint_model["model-cast-shadows"]),"model-receive-shadows":new kt(Je.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new kt(Je.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new an(Je.paint_model["model-emissive-strength"]),"model-roughness":new an(Je.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new an(Je.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new kt(Je.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new kt(Je.paint_model["model-front-cutoff"])}))},n,o,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(i){return new c3(i)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(i){return i instanceof mT?Ft-1:0}queryIntersectsFeature(i,n,o,u,h,p){if(!this.modelManager)return!1;const m=this.modelManager,v=i.tile.getBucket(this);if(!(v&&v instanceof c3))return!1;const w=v;for(const E in w.instancesPerModel){const C=w.instancesPerModel[E],P=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(P)){const k=C.features[C.idToFeaturesIndex[P]],N=m.getModel(E,this.scope);if(!N)return!1;let j=a.ae.create();const $=new Tr(0,0),q=w.canonical;let te=Number.MAX_VALUE;for(let pe=0;pe<k.instancedDataCount;++pe){const fe=16*(k.instancedDataOffset+pe),me=C.instancedDataArray.float32,Ae=[me[fe+4],me[fe+5],me[fe+6]];lB(q,$,me[fe],0|me[fe+1]),WF(j,N,p,$,k.rotation,k.scale,Ae,!1,!1,!1),p.projection.name==="globe"&&(j=l3(j,p));const Pe=a.ae.multiply([],p.projMatrix,j),ze=i.queryGeometry,$e=jF(ze.isPointQuery()?ze.screenBounds:ze.screenGeometry,p,Pe,N.aabb);$e!=null&&(te=Math.min($e,te))}return te!==Number.MAX_VALUE&&te}}return!1}_handleOverridablePaintPropertyUpdate(i,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven()||i!=="model-color"&&i!=="model-color-mix-intensity"&&i!=="model-rotation"&&i!=="model-scale"&&i!=="model-translation"&&i!=="model-emissive-strength")}_isPropertyZoomDependent(i){const n=this._transitionablePaint._values[i];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Ie}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(i,n,o,u){const h=i.tile,p=h.getBucket(this);let m=null,v=Number.MAX_VALUE;if(!(p&&p instanceof mT))return{queryFeature:m,intersectionZ:v};const w=p.getNodesInfo()[n];if(w.hiddenByReplacement||!w.node.meshes||!o.filter(new Rn(h.tileID.overscaledZ),w.feature,h.tileID.canonical))return{queryFeature:m,intersectionZ:v};const E=w.node,C=u.calculatePosMatrix(h.tileID.toUnwrapped(),u.worldSize),P=w.evaluatedScale;let k=0;u.elevation&&E.elevation&&(k=E.elevation*u.elevation.exaggeration()),a.ae.translate(C,C,[(E.anchor?E.anchor[0]:0)*(P[0]-1),(E.anchor?E.anchor[1]:0)*(P[1]-1),k]),a.ae.scale(C,C,P),a.ae.multiply(C,C,E.matrix);const N=i.queryGeometry,j=N.isPointQuery()?N.screenBounds:N.screenGeometry,$=function(te){const pe=a.ae.multiply([],C,te.matrix),fe=a.ae.multiply(pe,u.expandedFarZProjMatrix,pe);for(let me=0;me<te.meshes.length;++me){const Ae=te.meshes[me];if(me===te.lightMeshIndex)continue;const Pe=jF(j,u,fe,Ae.aabb);Pe!=null&&(v=Math.min(Pe,v))}if(te.children)for(const me of te.children)$(me)};if($(E),v===Number.MAX_VALUE)return{queryFeature:m,intersectionZ:v};const q=new Tr(0,0);return lB(h.tileID.canonical,q,w.node.anchor[0],w.node.anchor[1]),m={type:"Feature",geometry:{type:"Point",coordinates:[q.lng,q.lat]},properties:w.feature.properties,id:w.feature.id,state:{},layer:this.serialize()},{queryFeature:m,intersectionZ:v}}},clip:class extends da{constructor(i,n,o,u){super(i,{layout:wz||(wz=new Vr({"clip-layer-types":new kt(Je.layout_clip["clip-layer-types"]),"clip-layer-scope":new kt(Je.layout_clip["clip-layer-scope"])})),paint:Tz||(Tz=new Vr({}))},n,o,u)}recalculate(i,n){super.recalculate(i,n)}createBucket(i){return new Ez(i)}isTileClipped(){return!0}is3D(){return!0}}};Ve(pF,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const cB=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class y3{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,u]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=cB[15&u];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(n,2,1),[v]=new Uint32Array(n,4,1);return new y3(v,m,p,n)}constructor(n,o=64,u=Float64Array,h){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=u,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const p=cB.indexOf(this.ArrayType),m=2*n*this.ArrayType.BYTES_PER_ELEMENT,v=n*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+w,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+m+v+w),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+w,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=n,this.coords[this._pos++]=o,u}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return v3(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:v}=this,w=[0,p.length-1,0],E=[];for(;w.length;){const C=w.pop()||0,P=w.pop()||0,k=w.pop()||0;if(P-k<=v){for(let q=k;q<=P;q++){const te=m[2*q],pe=m[2*q+1];te>=n&&te<=u&&pe>=o&&pe<=h&&E.push(p[q])}continue}const N=k+P>>1,j=m[2*N],$=m[2*N+1];j>=n&&j<=u&&$>=o&&$<=h&&E.push(p[N]),(C===0?n<=j:o<=$)&&(w.push(k),w.push(N-1),w.push(1-C)),(C===0?u>=j:h>=$)&&(w.push(N+1),w.push(P),w.push(1-C))}return E}within(n,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,v=[0,h.length-1,0],w=[],E=u*u;for(;v.length;){const C=v.pop()||0,P=v.pop()||0,k=v.pop()||0;if(P-k<=m){for(let q=k;q<=P;q++)hB(p[2*q],p[2*q+1],n,o)<=E&&w.push(h[q]);continue}const N=k+P>>1,j=p[2*N],$=p[2*N+1];hB(j,$,n,o)<=E&&w.push(h[N]),(C===0?n-u<=j:o-u<=$)&&(v.push(k),v.push(N-1),v.push(1-C)),(C===0?n+u>=j:o+u>=$)&&(v.push(N+1),v.push(P),v.push(1-C))}return w}}function v3(i,n,o,u,h,p){if(h-u<=o)return;const m=u+h>>1;uB(i,n,m,u,h,p),v3(i,n,o,u,m-1,1-p),v3(i,n,o,m+1,h,1-p)}function uB(i,n,o,u,h,p){for(;h>u;){if(h-u>600){const E=h-u+1,C=o-u+1,P=Math.log(E),k=.5*Math.exp(2*P/3),N=.5*Math.sqrt(P*k*(E-k)/E)*(C-E/2<0?-1:1);uB(i,n,o,Math.max(u,Math.floor(o-C*k/E+N)),Math.min(h,Math.floor(o+(E-C)*k/E+N)),p)}const m=n[2*o+p];let v=u,w=h;for(Pv(i,n,u,o),n[2*h+p]>m&&Pv(i,n,u,h);v<w;){for(Pv(i,n,v,w),v++,w--;n[2*v+p]<m;)v++;for(;n[2*w+p]>m;)w--}n[2*u+p]===m?Pv(i,n,u,w):(w++,Pv(i,n,w,h)),w<=o&&(u=w+1),o<=w&&(h=w-1)}}function Pv(i,n,o,u){x3(i,o,u),x3(n,2*o,2*u),x3(n,2*o+1,2*u+1)}function x3(i,n,o){const u=i[n];i[n]=i[o],i[o]=u}function hB(i,n,o,u){const h=i-o,p=n-u;return h*h+p*p}a.A=kg,a.B=Sp,a.C=Sr,a.D=Tp,a.E=oh,a.F=Bo,a.H=_c,a.I=Up,a.J=B,a.K=A,a.L=function(i){const n=i.value;let o=[];if(!n)return o;const u=su(n);return u!=="string"?(o=o.concat([new cT(i.key,n,`string expected, "${u}" found`)]),o):(UF(n,!0)||(o=o.concat([new cT(i.key,n,`invalid url "${n}"`)])),o)},a.M=class{constructor(i,n,o,u){this.id=i,this.position=n!=null?new Tr(n[0],n[1]):new Tr(0,0),this.orientation=o??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new ci([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,n){if(a.ae.multiply(i.matrix,n,i.matrix),i.meshes)for(const o of i.meshes){const u=ci.applyTransformFast(o.aabb,i.matrix);this.aabb.encapsulate(u)}if(i.children)for(const o of i.children)this._applyTransformations(o,i.matrix)}computeBoundsAndApplyParent(){const i=a.ae.identity([]);for(const n of this.nodes)this._applyTransformations(n,i)}computeModelMatrix(i,n,o,u,h,p,m=!1){WF(this.matrix,this,i.transform,this.position,n,o,u,h,p,m)}upload(i){if(!this.uploaded){for(const n of this.nodes)u3(n,i);for(const n of this.nodes)uT(n);this.uploaded=!0}}destroy(){for(const i of this.nodes)h3(i)}},a.N=Je,a.O=ro,a.P=jt,a.Q=Is,a.R=ip,a.S=eP,a.T=Ml,a.U=Vr,a.V=cT,a.W=kt,a.X=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return cc(i.expression.evaluate(n))}interpolate(i,n,o){return{x:Sn(i.x,n.x,o),y:Sn(i.y,n.y,o),z:Sn(i.z,n.z,o),azimuthal:Sn(i.azimuthal,n.azimuthal,o),polar:Sn(i.polar,n.polar,o)}}},a.Y=Rn,a.Z=Ie,a._=yo,a.a=Pa,a.a$=bP,a.a0=na,a.a1=Ws,a.a2=xh,a.a3=Sn,a.a4=Ft,a.a5=x0,a.a6=class{constructor(i){this.specification=i}possiblyEvaluate(i,n){return function([o,u]){const h=cc([1,o,u]);return{x:h.x,y:h.y,z:h.z}}(i.expression.evaluate(n))}interpolate(i,n,o){return{x:Sn(i.x,n.x,o),y:Sn(i.y,n.y,o),z:Sn(i.z,n.z,o)}}},a.a7=W0,a.a8=_w,a.a9=gh,a.aA=function(i,n,o){i[4*n+0]=o[0],i[4*n+1]=o[1],i[4*n+2]=o[2],i[4*n+3]=o[3]},a.aC=function(i,n){const{x:o,y:u}=i.point,h=nz(o,u,i.worldSize/i._pixelsPerMercatorPixel,0,0);return a.ae.multiply(h,h,SP(fu(n)))},a.aE=r_,a.aF=el,a.aG=Vw,a.aH=function(i,n,o,u,h){const p=5*n+2;i.float32[p+0]=o,i.float32[p+1]=u,i.float32[p+2]=h},a.aI=Jw,a.aJ=Tr,a.aK=rF,a.aL=kL,a.aM=wP,a.aN=zF,a.aO=zp,a.aP=JL,a.aQ=gs,a.aR=function(i,n,o,u,h,p,m,v,w){if(w.name==="globe")return JL(i,n,new zp(o,u,h),!1);const E=jp({z:o,x:u,y:h},w);return new ci([(p+E.x/E.scale)*n,n*(E.y/E.scale),m],[(p+E.x2/E.scale)*n,n*(E.y2/E.scale),v])},a.aS=function(i,n,o){let u=0;for(let h=0;h<2;++h)i[h]>0&&(u+=(i[h]-0)*(i[h]-0)),n[h]<0&&(u+=(0-n[h])*(0-n[h]));return u},a.aT=Ui,a.aU=xP,a.aV=RL,a.aW=function(i){const n=a.ae.identity(new Float64Array(16));a.ae.multiply(n,i.pixelMatrix,i.globeMatrix);const o=[0,Pl,0],u=[0,Rl,0];return a.$.transformMat4(o,o,n),a.$.transformMat4(u,u,n),[o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!CP(i,new Tr(i.center.lat,90)),u[0]>0&&u[0]<=i.width&&u[1]>0&&u[1]<=i.height&&!CP(i,new Tr(i.center.lat,-90))]},a.aX=function(i,n){const{scale:o}=i.tileTransform,u=o*Ft/(i.tileSize*Math.pow(2,n.zoom-i.tileID.overscaledZ+i.tileID.canonical.z));return a.aD.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[u,u])},a.aY=aT,a.aZ=LF,a.a_=function(i){const n=LF(i,!0);return a.aD.invert([],[n[0],n[1],n[4],n[5]])},a.aa=AL,a.ab=jo,a.ac=tr,a.ad=function(i,n,o){const u=Math.sqrt(i*i+n*n+o*o),h=u>0?Math.acos(o/u)*ai:0;let p=i!==0||n!==0?Math.atan2(-n,-i)*ai+90:0;return p<0&&(p+=360),[u,p,h]},a.af=c_,a.ag=Ec,a.ah=QP,a.ai=function(i,n){const o={};for(let u=0;u<n.length;u++){const h=n[u];h in i&&(o[h]=i[h])}return o},a.aj=Nd,a.ak=hu,a.al=du,a.am=hL,a.an=function(i){fg++,fg>Ps&&(i.getActor().send("enforceCacheSizeLimit",As),fg=0)},a.ao=m0,a.ap=class{constructor(i){this.entries={},this.scheduler=i}request(i,n,o,u){const h=this.entries[i]=this.entries[i]||{callbacks:[]};if(h.result){const[p,m]=h.result;return this.scheduler?this.scheduler.add(()=>{u(p,m)},n):u(p,m),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=o((p,m)=>{h.result=[p,m];for(const v of h.callbacks)this.scheduler?this.scheduler.add(()=>{v(p,m)},n):v(p,m);setTimeout(()=>delete this.entries[i],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(p=>p!==u),h.callbacks.length||(h.cancel(),delete this.entries[i]))}}},a.aq=function(i,n,o){const u=JSON.stringify(i.request);return i.data&&(this.deduped.entries[u]={result:[null,i.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const p=nh(i.request,(m,v,w,E)=>{m?h(m):v&&h(null,{vectorTile:o?void 0:new DP(new av(v)),rawData:v,cacheControl:w,expires:E})});return()=>{p.cancel(),h()}},n)},a.ar=iP,a.as=class extends mh{constructor(i){super(i),this.current=HX}set(i,n,o){if(this.fetchUniformLocation(i,n)){for(let u=0;u<9;u++)if(o[u]!==this.current[u]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},a.at=sP,a.au=Hn,a.av=sc,a.ax=R,a.ay=Vo,a.az=Hs,a.b=gi,a.b$=tK,a.b0=function(i){const{x:n,y:o}=i.point,{lng:u,lat:h}=i._center;return nz(n,o,i.worldSize,u,h)},a.b1=eo,a.b2=Xg,a.b3=lP,a.b4=function(i){const n=Math.round((i+45+360)%360/90)%4;return Jc[n]},a.b5=45,a.b6=hP,a.b7=yw,a.b8=ci,a.b9=cc,a.bA=rT,a.bB=hz,a.bC=function(i,n){return[Math.pow(i[0],2.2)*n,Math.pow(i[1],2.2)*n,Math.pow(i[2],2.2)*n]},a.bD=mN,a.bF=tz,a.bG=pt,a.bH=Oe,a.bI=256,a.bJ=function(i,n){const o=[0,0,0],u=Q0(fu(n.canonical));return a.$.transformMat4(o,o,u),a.$.transformMat4(o,o,i),o},a.bK=i=>({u_camera_to_center_distance:new jo(i),u_extrude_scale:new oP(i),u_device_pixel_ratio:new jo(i),u_matrix:new W0(i),u_inv_rot_matrix:new W0(i),u_merc_center:new gh(i),u_tile_id:new iP(i),u_zoom_transition:new jo(i),u_up_dir:new iP(i),u_emissive_strength:new jo(i)}),a.bL=i=>({u_matrix:new W0(i),u_pixels_to_tile_units:new oP(i),u_device_pixel_ratio:new jo(i),u_units_to_pixels:new gh(i),u_dash_image:new _w(i),u_gradient_image:new _w(i),u_image_height:new jo(i),u_texsize:new gh(i),u_tile_units_to_pixels:new jo(i),u_alpha_discard_threshold:new jo(i),u_trim_offset:new gh(i),u_trim_fade_range:new gh(i),u_trim_color:new sP(i),u_emissive_strength:new jo(i)}),a.bM=i=>({u_matrix:new W0(i),u_texsize:new gh(i),u_pixels_to_tile_units:new oP(i),u_device_pixel_ratio:new jo(i),u_image:new _w(i),u_units_to_pixels:new gh(i),u_tile_units_to_pixels:new jo(i),u_alpha_discard_threshold:new jo(i),u_trim_offset:new gh(i)}),a.bN=HA,a.bO=gQ,a.bP=oo,a.bQ=OQ,a.bR=ZN,a.bS=VP,a.bT=sz,a.bU=(i,n,o,u,h,p)=>{const m=i.transform,v=m.projection.name==="globe";let w;if(p.paint.get("circle-pitch-alignment")==="map")if(v){const C=tz(m.zoom,n.canonical)*m._pixelsPerMercatorPixel;w=Float32Array.from([C,0,0,C])}else w=m.calculatePixelsToTileUnitsMatrix(o);else w=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:i.transform.getCameraToCenterDistance(m.projection),u_matrix:i.translatePosMatrix(n.projMatrix,o,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:tn.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:mK,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){E.u_inv_rot_matrix=u,E.u_merc_center=h,E.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],E.u_zoom_transition=xh(m.zoom);const C=h[0]*Ft,P=h[1]*Ft;E.u_up_dir=m.projection.upVector(new zp(0,0,0),C,P)}return E},a.bV=yN,a.bW=(i,n,o,u,h,p)=>{const m=i.transform;return{u_matrix:_N(i,n,o,u),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:gN(n,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p}},a.bX=(i,n,o,u,h,p,m)=>{const v=i.transform,w=v.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:_N(i,n,o,u),u_pixels_to_tile_units:w,u_device_pixel_ratio:p,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:vN(o)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:gN(n,i.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_trim_fade_range:o.paint.get("line-trim-fade-range"),u_trim_color:o.paint.get("line-trim-color").toRenderColor(o.lut).toArray01(),u_emissive_strength:o.paint.get("line-emissive-strength")}},a.bY=Ea,a.bZ=Y0,a.b_=rN,a.ba=function(i){return[Math.pow(i[0],1/2.2),Math.pow(i[1],1/2.2),Math.pow(i[2],1/2.2)]},a.bb=Yu,a.bc=function(i,n,o){const u=xh(o.zoom),h=i.style.map._antialias,p=n.options.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return u===0&&!h&&!p},a.bd=function(i){const n=i.pixelsPerMeter,o=n/Vo(1,i.center.lat),u=a.ae.identity(new Float64Array(16));return a.ae.translate(u,u,[i.point.x,i.point.y,0]),a.ae.scale(u,u,[o,o,n]),Float32Array.from(u)},a.be=Ew,a.bf=function(i){const n=Ui-5;i=Hn(i,-n,n)/n*90;const o=Math.pow(Math.abs(Math.sin(tr(i))),3);return Math.round(o*(cP.length-1))},a.bg=function(i,n,o,u){const h=n.getNorth(),p=n.getSouth(),m=n.getWest(),v=n.getEast(),w=1<<i.z,E=v-m,C=h-p,P=E/Wg,k=-C/cP[o],N=[0,P,0,k,0,0,h,m,0];if(i.z>0){const j=180/u;a.bE.multiply(N,N,[j/E+1,0,0,0,j/C+1,0,-.5*j/P,.5*j/k,1])}return N[2]=w,N[5]=i.x,N[8]=i.y,N},a.bh=Q0,a.bi=fu,a.bj=function(i,n,o){const u=a.ae.identity(new Float64Array(16)),h=(n/(1<<i)-.5)*Math.PI*2;return a.ae.rotateY(u,o.globeMatrix,h),Float32Array.from(u)},a.bk=Dt,a.bl=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.bm=AF,a.bn=DF,a.bo=CF,a.bp=function(i,n){const o=document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let u=0;u<i.length;u++){const h=document.createElement("source");pA(i[u])||(o.crossOrigin="Anonymous"),h.src=i[u],o.appendChild(h)}return{cancel:()=>{}}},a.bq=eT,a.br=th,a.bs=class{isDataAvailableAtPoint(i){const n=this._source();if(this.isUsingMockSource()||!n||i.y<0||i.y>1)return!1;const o=n.getSource().maxzoom,u=1<<o,h=Math.floor(i.x),p=Math.floor((i.x-h)*u),m=Math.floor(i.y*u),v=this.findDEMTileFor(new gs(o,h,o,p,m));return!(!v||!v.dem)}getAtPointOrZero(i,n=0){return this.getAtPoint(i,n)||0}getAtPoint(i,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const u=this._source();if(!u||i.y<0||i.y>1)return n;const h=u.getSource().maxzoom,p=1<<h,m=Math.floor(i.x),v=i.x-m,w=new gs(h,m,h,Math.floor(v*p),Math.floor(i.y*p)),E=this.findDEMTileFor(w);if(!E||!E.dem)return n;const C=E.dem,P=1<<E.tileID.canonical.z,k=(v*P-E.tileID.canonical.x)*C.dim,N=(i.y*P-E.tileID.canonical.y)*C.dim,j=Math.floor(k),$=Math.floor(N);return(o?this.exaggeration():1)*Sn(Sn(C.get(j,$),C.get(j,$+1),N-$),Sn(C.get(j+1,$),C.get(j+1,$+1),N-$),k-j)}getAtTileOffset(i,n,o){const u=1<<i.canonical.z;return this.getAtPointOrZero(new yo(i.wrap+(i.canonical.x+n/Ft)/u,(i.canonical.y+o/Ft)/u))}getAtTileOffsetFunc(i,n,o,u){return h=>{const p=this.getAtTileOffset(i,h.x,h.y),m=u.upVector(i.canonical,h.x,h.y),v=u.upVectorScale(i.canonical,n,o).metersToTile;return a.$.scale(m,m,p*v),m}}getForTilePoints(i,n,o,u){if(this.isUsingMockSource())return!1;const h=e_.create(this,i,u);return!!h&&(n.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],o)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(i);if(!n||!n.dem)return null;const o=n.dem.tree,u=n.tileID,h=1<<i.canonical.z-u.canonical.z;let p=i.canonical.x/h-u.canonical.x,m=i.canonical.y/h-u.canonical.y,v=0;for(let w=0;w<i.canonical.z-u.canonical.z&&!o.leaves[v];w++){p*=2,m*=2;const E=2*Math.floor(m)+Math.floor(p);v=o.childOffsets[v]+E,p%=1,m%=1}return{min:this.exaggeration()*o.minimums[v],max:this.exaggeration()*o.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const i=this.visibleDemTiles;if(i.length===0)return null;let n=!1,o=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of i){const p=this.getMinMaxForTile(h.tileID);p&&(o=Math.min(o,p.min),u=Math.max(u,p.max),n=!0)}return n?{min:o,max:u}:null}},a.bt=X0,a.bu=Tw,a.bv=vc,a.bw=Fs,a.bx=Vp,a.by=d_,a.bz=hT,a.c=rB,a.c$=function(i,n,o,u){return i.type==="custom"?new NY(i,n):new lJ[i.type](i,n,o,u)},a.c0=Fw,a.c1=Ud,a.c2=450,a.c3=7,a.c4=zY,a.c5=mF,a.c6=256,a.c7=QL,a.c8=SP,a.c9=Rr,a.cA=UL,a.cB=function(i,n,o=0){return a.$.fromValues(((n.x-o)*i.scale-i.x)*Ft,(n.y*i.scale-i.y)*Ft,OL(n.z,n.y))},a.cC=function(i){let n=1/0,o=1/0,u=-1/0,h=-1/0;for(const p of i)n=Math.min(n,p.x),o=Math.min(o,p.y),u=Math.max(u,p.x),h=Math.max(h,p.y);return{min:new jt(n,o),max:new jt(u,h)}},a.cD=Fd,a.cE=zL,a.cF=Uo,a.cG=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.cH=UN,a.cI=gP,a.cJ=Mz,a.cK=zz,a.cL=Nz,a.cM=WP,a.cN=y3,a.cO=function(i){return i({pluginStatus:Nr,pluginURL:mr}),Jn.on("pluginStateChange",i),i},a.cP=s_,a.cQ=qP,a.cR=h0,a.cS=zr,a.cT=G,a.cU=ps,a.cV=_g,a.cW=zs,a.cX=function(i){const n=i.indexOf(uw);return n>=0?i.slice(0,n):i},a.cY=function(i){return i.indexOf(uw)>=0},a.cZ=function(i){const n=i.indexOf(uw);return n>=0?i.slice(n+1):""},a.c_=function(i){const n=[],o=i.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},a.ca=kd,a.cb=Op,a.cc=1,a.cd=gv,a.ce=0,a.cf=QA,a.cg=function(i,n,o,u,h){return Hn((i-n)/(o-n)*(h-u)+u,u,h)},a.ch=aw,a.ci=Np,a.cj=class{constructor(i,n,o,u){this.context=i,this.format=u,this.size=o,this.texture=i.gl.createTexture();const[h,p,m]=this.size,{gl:v}=i;v.bindTexture(v.TEXTURE_3D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(!1);let w=this.format,E=v.UNSIGNED_BYTE;this.format===v.DEPTH_COMPONENT&&(w=v.DEPTH_COMPONENT16,E=v.UNSIGNED_SHORT),this.format===v.R8&&(u=v.RED),this.format===v.R32F&&(E=v.FLOAT,u=v.RED),v.texImage3D(v.TEXTURE_3D,0,w,h,p,m,0,u,E,n.data)}bind(i,n){const{context:o}=this,{gl:u}=o;u.bindTexture(u.TEXTURE_3D,this.texture),i!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,i),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,i),this.minFilter=i),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}},a.ck=l3,a.cl=[1,1,1],a.cm=e_,a.cn=h_,a.co=Dd,a.cp=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new jt(1/0,1/0),max:new jt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(i,n=!1){const o=Oz(new jt(0,0),new jt(Ft,Ft),i),u=[];if(n&&!LP(o,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!LP(o,h))continue;const p=GK(h.min,h.max,i);u.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(i){this._setSources(i.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const o=[];for(const u of n.cache.getVisibleCoordinates()){const h=n.cache.getTile(u).buckets[n.layer];h&&h.updateFootprints(u.toUnwrapped(),o)}return o},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(i){const n=i.getFootprints();if(n.length===0)return;const o=i.getOrder(),u=i.getClipMask(),h=i.getClipScope();for(const p of n){if(!p.footprint)continue;const m=Oz(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:o,clipMask:u,clipScope:h})}this._sourceIds.push(i.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,o)=>n.priority-o.priority||Lw(n.min,o.min)||Lw(n.max,o.max)||n.order-o.order||n.clipMask-o.clipMask||function(u,h){const p=(m,v)=>m+v;return u.length-h.length||u.reduce(p,"").localeCompare(h.reduce(p,""))}(n.clipScope,o.clipScope));let i=this._activeRegions.length!==this._prevRegions.length;if(!i){let n=0;for(;!i&&n!==this._activeRegions.length;){const o=this._activeRegions[n],u=this._prevRegions[n];i=o.priority!==u.priority||!kz(o,u)||o.order!==u.order||o.clipMask!==u.clipMask||!ic(o.clipScope,u.clipScope),++n}}if(i){++this._updateTime;for(const o of this._activeRegions)o.order!==Dw&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,o.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,o.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,o.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,o.max.y));const n=o=>{const u=this._activeRegions;if(o>=u.length)return o;const h=u[o].priority;for(;o<u.length&&u[o].priority===h;)++o;return o};if(this._sourceIds.length>1){let o=0,u=n(o);for(;o!==u;){let h=o;const p=o;for(;h!==u;){const m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let v=0;v<p;v++){const w=this._activeRegions[v];if(!w.hiddenByOverlap&&m.order===Dw&&LP(m,w)&&(m.hiddenByOverlap=Lz(m.footprint,m.tileId,w.footprint,w.tileId),m.hiddenByOverlap))break}++h}o=u,u=n(o)}}}}_setSources(i){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=i.length-1;n>=0;n--)this._addSource(i[n]);this._computeReplacement()}},a.cq=ph,a.cr=nT,a.cs=$0,a.ct=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy()}_fillGridMeshWithLods(i,n){const o=new vc,u=new Fs,h=[],p=i+1+2,m=n[0]+1,v=n[0]+1+(1+n.length),w=(E,C,P)=>{let k=E===p-1?E-2:E===0?E:E-1;return k+=P?24575:0,[k,C]};for(let E=0;E<p;++E)o.emplaceBack(...w(E,0,!0));for(let E=0;E<m;++E)for(let C=0;C<p;++C)o.emplaceBack(...w(C,E,(C===0||C===p-1)&&!0));for(let E=0;E<n.length;++E){const C=n[E];for(let P=0;P<p;++P)o.emplaceBack(...w(P,C,!0))}for(let E=0;E<n.length;++E){const C=u.length,P=n[E]+1+2,k=new Fs;for(let $=0;$<P-1;$++){const q=$===P-2,te=q?p*(v-n.length+E-$):p;for(let pe=0;pe<p-1;pe++){const fe=$*p+pe;$===0||q||pe===0||pe===p-2?(k.emplaceBack(fe+1,fe,fe+te),k.emplaceBack(fe+te,fe+te+1,fe+1)):(u.emplaceBack(fe+1,fe,fe+te),u.emplaceBack(fe+te,fe+te+1,fe+1))}}const N=gi.simpleSegment(0,C,o.length,u.length-C);for(let $=0;$<k.uint16.length;$+=3)u.emplaceBack(k.uint16[$],k.uint16[$+1],k.uint16[$+2]);const j=gi.simpleSegment(0,C,o.length,u.length-C);h.push({withoutSkirts:N,withSkirts:j})}return{vertices:o,indices:u,segments:h}}_createGrid(i){const n=this._fillGridMeshWithLods(Wg,cP);this._gridSegments=n.segments,this._gridBuffer=i.createVertexBuffer(n.vertices,X0.members),this._gridIndexBuffer=i.createIndexBuffer(n.indices,!0)}_createPoles(i){const n=new Fs;for(let m=0;m<=Wg;m++)n.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=i.createIndexBuffer(n,!0);const o=new Op,u=new Op,h=new Op,p=new Op;this._poleSegments=[];for(let m=0,v=0;m<lP;m++){const w=360/(1<<m);o.emplaceBack(0,-Uo,0,.5,0),u.emplaceBack(0,-Uo,0,.5,1),h.emplaceBack(0,-Uo,0,.5,.5),p.emplaceBack(0,-Uo,0,.5,.5);for(let E=0;E<=Wg;E++){let C=E/Wg,P=0;const k=Sn(0,w,C),[N,j,$]=Hg(fK,pK,k,Uo);o.emplaceBack(N,j,$,C,P),u.emplaceBack(N,j,$,C,1-P);const q=tr(k);C=.5+.5*Math.sin(q),P=.5+.5*Math.cos(q),h.emplaceBack(N,j,$,C,P),p.emplaceBack(N,j,$,C,1-P)}this._poleSegments.push(gi.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(o,ww,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(u,ww,!1),this._texturedPoleNorthVertexBuffer=i.createVertexBuffer(h,ww,!1),this._texturedPoleSouthVertexBuffer=i.createVertexBuffer(p,ww,!1)}getGridBuffers(i,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}},a.cu=function(i){return cp.has(i)},a.cv=Dw,a.cw=Gz,a.cx=function(i,n,o=0,u=!0){const h=new jt(o,o),p=i.sub(h),m=n.add(h),v=[p,new jt(m.x,p.y),m,new jt(p.x,m.y)];return u&&v.push(p.clone()),v},a.cy=function(i,n){const o=[];for(let u=0;u<i.length;u++){const h=sc(u-1,-1,i.length-1),p=sc(u+1,-1,i.length-1),m=i[u],v=i[p],w=i[h].sub(m).unit(),E=v.sub(m).unit(),C=E.angleWithSep(w.x,w.y),P=w.add(E).unit().mult(-1*n/Math.sin(C/2));o.push(m.add(P))}return o},a.cz=YN,a.d=ic,a.d$=xv,a.d0=Cs,a.d1=Jn,a.d2=Sl,a.d3=Ju,a.d4=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.d5=mo,a.d6=LL,a.d7=Lp,a.d8=function([i,n,o]){const u=Math.hypot(i,n,o),h=Math.atan2(i,o),p=.5*Math.PI-Math.acos(-n/u);return new Tr(eo(h),eo(p))},a.d9=fa,a.dA=function(){hT().acquire(d3)},a.dB=function(){const i=Iv;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(d3),Iv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.dC=Sv,a.dD=function(i){const n=md();if(!n)return;const o=n.delete(Ur);i&&o.catch(i).then(()=>i())},a.dE=Ev,a.dF=ZF,a.dG=function(i){f3=tn.resolveURL(i),p_||(p_=new d_(hT(),new oh)),p_.broadcast("setDracoUrl",f3)},a.dH=XF,a.dI=function(i){f_=tn.resolveURL(i),p_||(p_=new d_(hT(),new oh)),p_.broadcast("setMeshoptUrl",f_)},a.dJ=oc,a.dK=Ve,a.dL=Bd,a.dM=Tc,a.dN=jp,a.dO=nP,a.dP=xN,a.dQ=CN,a.dR=hN,a.dS=eu,a.dT=$N,a.dU=l_,a.dV=function(i,n,o,u,h,p,m,v,w,E,C){i.createArrays(),i.tilePixelRatio=Ft/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const P=i.layers[0].layout,k=i.layers[0]._unevaluatedLayout._values,N={};if(i.textSizeData.kind==="composite"){const{minZoom:te,maxZoom:pe}=i.textSizeData;N.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Rn(te),v),k["text-size"].possiblyEvaluate(new Rn(pe),v)]}if(i.iconSizeData.kind==="composite"){const{minZoom:te,maxZoom:pe}=i.iconSizeData;N.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Rn(te),v),k["icon-size"].possiblyEvaluate(new Rn(pe),v)]}N.layoutTextSize=k["text-size"].possiblyEvaluate(new Rn(w+1),v),N.layoutIconSize=k["icon-size"].possiblyEvaluate(new Rn(w+1),v),N.textMaxSize=k["text-size"].possiblyEvaluate(new Rn(18),v);const j=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",$=P.get("text-size");let q=!1;for(const te of i.features)if(te.icon&&te.icon.nameSecondary){q=!0;break}for(const te of i.features){const pe=P.get("text-font").evaluate(te,{},v).join(","),fe=$.evaluate(te,{},v),me=N.layoutTextSize.evaluate(te,{},v),Ae=(N.layoutIconSize.evaluate(te,{},v),{horizontal:{},vertical:void 0}),Pe=te.text;let ze,$e=[0,0];if(Pe){const Qe=Pe.toString(),ut=P.get("text-letter-spacing").evaluate(te,{},v)*oo,At=P.get("text-line-height").evaluate(te,{},v)*oo,ht=xt(Qe)?ut:0,Ot=P.get("text-anchor").evaluate(te,{},v),ct=P.get("text-variable-anchor");if(!ct){const Lt=P.get("text-radial-offset").evaluate(te,{},v);$e=Lt?ZN(Ot,[Lt*oo,GP]):P.get("text-offset").evaluate(te,{},v).map(Rt=>Rt*oo)}let vt=j?"center":P.get("text-justify").evaluate(te,{},v);const Nt=P.get("symbol-placement")==="point",dt=Nt?P.get("text-max-width").evaluate(te,{},v)*oo:1/0,Ut=Lt=>{i.allowVerticalPlacement&&yt(Qe)&&(Ae.vertical=UP(Pe,n,o,h,pe,dt,At,Ot,Lt,ht,$e,el.vertical,!0,me,fe))};if(!j&&ct){const Lt=vt==="auto"?ct.map(bn=>WP(bn)):[vt];let Rt=!1;for(let bn=0;bn<Lt.length;bn++){const fn=Lt[bn];if(!Ae.horizontal[fn])if(Rt)Ae.horizontal[fn]=Ae.horizontal[0];else{const Jt=UP(Pe,n,o,h,pe,dt,At,"center",fn,ht,$e,el.horizontal,!1,me,fe);Jt&&(Ae.horizontal[fn]=Jt,Rt=Jt.positionedLines.length===1)}}Ut("left")}else{if(vt==="auto"&&(vt=WP(Ot)),Nt||P.get("text-writing-mode").indexOf("horizontal")>=0||!yt(Qe)){const Lt=UP(Pe,n,o,h,pe,dt,At,Ot,vt,ht,$e,el.horizontal,!1,me,fe);Lt&&(Ae.horizontal[vt]=Lt)}Ut(Nt?"left":vt)}}let Xe=!1;if(te.icon&&te.icon.namePrimary){const Qe=u[te.icon.namePrimary];Qe&&(ze=VQ(h[te.icon.namePrimary],te.icon.nameSecondary?h[te.icon.nameSecondary]:void 0,P.get("icon-offset").evaluate(te,{},v),P.get("icon-anchor").evaluate(te,{},v)),Xe=Qe.sdf,i.sdfIcons===void 0?i.sdfIcons=Qe.sdf:i.sdfIcons!==Qe.sdf&&bi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qe.pixelRatio!==i.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const rt=KN(Ae.horizontal)||Ae.vertical;i.iconsInText||(i.iconsInText=!!rt&&rt.iconsInText),(rt||ze)&&XQ(i,te,Ae,ze,u,N,me,0,$e,Xe,m,v,E,C,q)}p&&i.generateCollisionDebugBuffers(w,i.collisionBoxArray)},a.dW=Bw,a.dX=Rw,a.dY=DP,a.dZ=av,a.d_=zw,a.da=Zg,a.db=D,a.dc=CP,a.dd=rz,a.de=function(i){const n=[0,0,0],o=a.ae.identity(new Float64Array(16));return a.ae.multiply(o,i.pixelMatrix,i.globeMatrix),a.$.transformMat4(n,n,o),new jt(n[0],n[1])},a.df=H,a.dg=U,a.dh=function(i){const n=i.navigator?i.navigator.userAgent:null;return!!function(o){if(iu==null){const u=o.navigator?o.navigator.userAgent:null;iu=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return iu}(i)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.di=ac,a.dj=class{constructor(i,n,o){this._transformRequestFn=i,this._customAccessToken=n,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const i=function(){let n="";for(let o=0;o<10;o++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",d0,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,n){return this._transformRequestFn&&this._transformRequestFn(i,n)||{url:i}}normalizeStyleURL(i,n){if(!G(i))return i;const o=Sa(i);return o.params.push(`sdk=js-${I}`),o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeGlyphsURL(i,n){if(!G(i))return i;const o=Sa(i);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeModelURL(i,n){if(!G(i))return i;const o=Sa(i);return o.path=`/models/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeSourceURL(i,n,o,u){if(!G(i))return i;const h=Sa(i);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),o&&h.params.push(`language=${o}`),u&&h.params.push(`worldview=${u}`),this._makeAPIURL(h,this._customAccessToken||n)}normalizeSpriteURL(i,n,o,u){const h=Sa(i);return G(i)?(h.path=`/styles/v1${h.path}/sprite${n}${o}`,this._makeAPIURL(h,this._customAccessToken||u)):(h.path+=`${n}${o}`,rh(h))}normalizeTileURL(i,n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!G(i))return i;const u=Sa(i);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||o&&u.authority!=="raster"&&o===512?"@2x":""}${pg.supported?".webp":"$1"}`),u.authority==="raster"?u.path=`/${D.RASTER_URL_PREFIX}${u.path}`:u.authority==="rasterarrays"?u.path=`/${D.RASTERARRAYS_URL_PREFIX}${u.path}`:u.authority==="3dtiles"?u.path=`/${D.TILES3D_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${D.TILE_URL_VERSION}${u.path}`);const h=this._customAccessToken||function(p){for(const m of p){const v=m.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(u.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,h)}canonicalizeTileURL(i,n){const o=Sa(i);if(!o.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!o.path.match(/\.[\w]+$/))return i;let u="mapbox://";o.path.match(/^\/raster\/v1\//)?u+=`raster/${o.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:o.path.match(/^\/rasterarrays\/v1\//)?u+=`rasterarrays/${o.path.replace(`/${D.RASTERARRAYS_URL_PREFIX}/`,"")}`:u+=`tiles/${o.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let h=o.params;return n&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(u+=`?${h.join("&")}`),u}canonicalizeTileset(i,n){const o=!!n&&G(n),u=[];for(const h of i.tiles||[])L(h)?u.push(this.canonicalizeTileURL(h,o)):u.push(h);return u}_makeAPIURL(i,n){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Sa(D.API_URL);if(i.protocol=u.protocol,i.authority=u.authority,i.protocol==="http"){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(u.path!=="/"&&(i.path=`${u.path}${i.path}`),!D.REQUIRE_ACCESS_TOKEN)return rh(i);if(n=n||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${n||""}`),rh(i)}},a.dk=function(i,n){n?cp.add(i):cp.delete(i)},a.dl=pg,a.dm=gA,a.dn=g0,a.dp=f0,a.dq=kb,a.dr=Ob,a.ds=function(i){cp.delete(i)},a.dt=lp,a.du=yd,a.dv=eh,a.dw=I,a.dx=function(i,n){As=i,Ps=n},a.dy=function(i,n,o=!1){if(Nr===In||Nr===Gn||Nr===dr)throw new Error("setRTLTextPlugin cannot be called multiple times.");mr=tn.resolveURL(i),Nr=In,Xr=n,Zn(),o||br()},a.dz=Vn,a.e=tn,a.e0=kw,a.e1=Mw,a.e2=Yc,a.e3=bN,a.e4=de,a.e5=nh,a.e6=function(i){let n=0;if(new Uint32Array(i,0,1)[0]!==QF){const o=new Uint32Array(i,0,7),[,,u,h,p,m]=o;n=o.byteLength+h+p+m+p,(u!==i.byteLength||n>=i.byteLength)&&bi("Invalid b3dm header information.")}return tB(i,n)},a.e7=function(i,n){const o=rB(i);for(const u of o){for(const h of u.meshes)iJ(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(sJ(u.lights,n)))}return o},a.e8=mT,a.e9=HF,a.ea=nr,a.eb=function(i){np(),os&&os.then(n=>{n.keys().then(o=>{for(let u=0;u<o.length-i;u++)n.delete(o[u])})})},a.f=up,a.g=Il,a.h=function(i,n){return Sl(Is(i,{type:"json"}),n)},a.i=op,a.j=Ja,a.k=VN,a.l=function(i){return fetch(i).then(n=>n.arrayBuffer()).then(n=>tB(n,0,i))},a.m=$P,a.n=class extends cT{},a.o=su,a.p=lY,a.q=xd,a.r=S,a.s=z,a.t=O,a.u=gc,a.v=we,a.w=bi,a.x=Ya,a.y=Ce,a.z=ye}),_(["./shared"],function(a){function I(Ue){const ne=Ue?Ue.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function M(Ue){if(typeof Ue=="number"||typeof Ue=="boolean"||typeof Ue=="string"||Ue==null)return JSON.stringify(Ue);if(Array.isArray(Ue)){let le="[";for(const Te of Ue)le+=`${M(Te)},`;return`${le}]`}let ne="{";for(const le of Object.keys(Ue).sort())ne+=`${le}:${M(Ue[le])},`;return`${ne}}`}function D(Ue){let ne="";for(const le of a.cG)ne+=`/${M(Ue[le])}`;return ne}class L{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,le){this._layerConfigs={},this._layers={},this.update(ne,[],le)}update(ne,le,Te){this._options=Te;for(const De of ne)this._layerConfigs[De.id]=De,(this._layers[De.id]=a.c$(De,this.scope,null,this._options)).compileFilter(),this.keyCache[De.id]&&delete this.keyCache[De.id];for(const De of le)delete this.keyCache[De],delete this._layerConfigs[De],delete this._layers[De];this.familiesBySource={};const Le=function(De,Ge){const it={};for(let nt=0;nt<De.length;nt++){const St=Ge&&Ge[De[nt].id]||D(De[nt]);Ge&&(Ge[De[nt].id]=St);let It=it[St];It||(It=it[St]=[]),It.push(De[nt])}const qe=[];for(const nt in it)qe.push(it[nt]);return qe}(a.dJ(this._layerConfigs),this.keyCache);for(const De of Le){const Ge=De.map(Xt=>this._layers[Xt.id]),it=Ge[0];if(it.visibility==="none")continue;const qe=it.source||"";let nt=this.familiesBySource[qe];nt||(nt=this.familiesBySource[qe]={});const St=it.sourceLayer||"_geojsonTileLayer";let It=nt[St];It||(It=nt[St]=[]),It.push(Ge)}}}const G=1*a.dM;class Q{constructor(ne){const le={},Te=[];for(const it in ne){const qe=ne[it],nt=le[it]={};for(const St in qe.glyphs){const It=qe.glyphs[+St];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const Xt=It.metrics.localGlyph?G:1,_n={x:0,y:0,w:It.bitmap.width+2*Xt,h:It.bitmap.height+2*Xt};Te.push(_n),nt[St]=_n}}const{w:Le,h:De}=a.k(Te),Ge=new a.dL({width:Le||1,height:De||1});for(const it in ne){const qe=ne[it];for(const nt in qe.glyphs){const St=qe.glyphs[+nt];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;const It=le[it][nt],Xt=St.metrics.localGlyph?G:1;a.dL.copy(St.bitmap,Ge,{x:0,y:0},{x:It.x+Xt,y:It.y+Xt},St.bitmap)}}this.image=Ge,this.positions=le}}a.dK(Q,"GlyphAtlas");class re{constructor(ne){this.tileID=new a.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=a.dN(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep}parse(ne,le,Te,Le,De){this.status="parsing",this.data=ne,this.collisionBoxArray=new a.dO;const Ge=new a.dP(Object.keys(ne.layers).sort()),it=new a.dQ(this.tileID,this.promoteId);it.bucketLayerIDs=[];const qe={},nt=new a.dR(256,256),St={featureIndex:it,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:nt,availableImages:Te,brightness:this.brightness},It=le.familiesBySource[this.source];for(const un in It){const Zr=ne.layers[un];if(!Zr)continue;let _r=!1,ur=!1,pi=!1;for(const Ss of It[un])Ss[0].type==="symbol"?_r=!0:ur=!0,Ss[0].is3D()&&Ss[0].type!=="model"&&(pi=!0);if(this.extraShadowCaster&&!pi||this.isSymbolTile===!0&&!_r||this.isSymbolTile===!1&&!ur)continue;Zr.version===1&&a.w(`Vector tile source "${this.source}" layer "${un}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const mi=Ge.encode(un),Gi=[];for(let Ss=0;Ss<Zr.length;Ss++){const qs=Zr.feature(Ss),tc=it.getId(qs,un);Gi.push({feature:qs,id:tc,index:Ss,sourceLayerIndex:mi})}for(const Ss of It[un]){const qs=Ss[0];(!this.extraShadowCaster||qs.is3D()&&qs.type!=="model")&&(this.isSymbolTile!==void 0&&qs.type==="symbol"!==this.isSymbolTile||qs.minzoom&&this.zoom<Math.floor(qs.minzoom)||qs.maxzoom&&this.zoom>=qs.maxzoom||qs.visibility!=="none"&&(ee(Ss,this.zoom,St.brightness,Te),(qe[qs.id]=qs.createBucket({index:it.bucketLayerIDs.length,layers:Ss,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:mi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Gi,St,this.tileID.canonical,this.tileTransform),it.bucketLayerIDs.push(Ss.map(tc=>tc.id))))}}let Xt,_n,Cn,lr;nt.trim();const Mn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},cr=()=>{if(Xt)return this.status="done",De(Xt);if(this.extraShadowCaster)this.status="done",De(null,{buckets:a.dJ(qe).filter(un=>!un.isEmpty()),featureIndex:it,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:St.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(_n&&Cn&&lr){const un=new Q(_n),Zr=new a.dT(Cn,lr,this.lut);for(const _r in qe){const ur=qe[_r];ur instanceof a.dU?(ee(ur.layers,this.zoom,St.brightness,Te),a.dV(ur,_n,un.positions,Cn,Zr.iconPositions,this.showCollisionBoxes,Te,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):ur.hasPattern&&(ur instanceof a.dW||ur instanceof a.dX||ur instanceof a.c0)&&(ee(ur.layers,this.zoom,St.brightness,Te),ur.addFeatures(St,this.tileID.canonical,Zr.patternPositions,Te,this.tileTransform,this.brightness))}this.status="done",De(null,{buckets:a.dJ(qe).filter(_r=>!_r.isEmpty()),featureIndex:it,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:un.image,lineAtlas:nt,imageAtlas:Zr,brightness:St.brightness})}};if(!this.extraShadowCaster){const un=a.dS(St.glyphDependencies,ur=>Object.keys(ur).map(Number));Object.keys(un).length?Le.send("getGlyphs",{uid:this.uid,stacks:un,scope:this.scope},(ur,pi)=>{Xt||(Xt=ur,_n=pi,cr())},void 0,!1,Mn):_n={};const Zr=Object.keys(St.iconDependencies);Zr.length?Le.send("getImages",{icons:Zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ur,pi)=>{Xt||(Xt=ur,Cn=pi,cr())},void 0,!1,Mn):Cn={};const _r=Object.keys(St.patternDependencies);_r.length?Le.send("getImages",{icons:_r,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ur,pi)=>{Xt||(Xt=ur,lr=pi,cr())},void 0,!1,Mn):lr={}}cr()}}function ee(Ue,ne,le,Te){const Le=new a.Y(ne,{brightness:le});for(const De of Ue)De.recalculate(Le,Te)}class U extends a.E{constructor(ne,le,Te,Le,De,Ge){super(),this.actor=ne,this.layerIndex=le,this.availableImages=Te,this.loadVectorData=De||a.aq,this.loading={},this.loaded={},this.deduped=new a.ap(ne.scheduler),this.isSpriteLoaded=Le,this.scheduler=ne.scheduler,this.brightness=Ge}loadTile(ne,le){const Te=ne.uid,Le=ne&&ne.request,De=Le&&Le.collectResourceTiming,Ge=this.loading[Te]=new re(ne);Ge.abort=this.loadVectorData(ne,(it,qe)=>{const nt=!this.loading[Te];if(delete this.loading[Te],nt||it||!qe)return Ge.status="done",nt||(this.loaded[Te]=Ge),le(it);const St=qe.rawData,It={};qe.expires&&(It.expires=qe.expires),qe.cacheControl&&(It.cacheControl=qe.cacheControl),Ge.vectorTile=qe.vectorTile||new a.dY(new a.dZ(St));const Xt=()=>{Ge.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,(_n,Cn)=>{if(_n||!Cn)return le(_n);const lr={};if(De){const Mn=I(Le);Mn.length>0&&(lr.resourceTiming=JSON.parse(JSON.stringify(Mn)))}le(null,a.Q({rawTileData:St.slice(0)},Cn,It,lr))})};this.isSpriteLoaded?Xt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Xt,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):Xt()}),this.loaded=this.loaded||{},this.loaded[Te]=Ge})}reloadTile(ne,le){const Te=this.loaded,Le=ne.uid;if(Te&&Te[Le]){const De=Te[Le];De.showCollisionBoxes=ne.showCollisionBoxes,De.projection=ne.projection,De.brightness=ne.brightness,De.tileTransform=a.dN(ne.tileID.canonical,ne.projection),De.extraShadowCaster=ne.extraShadowCaster,De.lut=ne.lut;const Ge=(it,qe)=>{const nt=De.reloadCallback;nt&&(delete De.reloadCallback,De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,nt)),le(it,qe)};De.status==="parsing"?De.reloadCallback=Ge:De.status==="done"&&(De.vectorTile?De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,Ge):Ge())}else le(null,void 0)}abortTile(ne,le){const Te=ne.uid,Le=this.loading[Te];Le&&(Le.abort&&Le.abort(),delete this.loading[Te]),le()}removeTile(ne,le){const Te=this.loaded,Le=ne.uid;Te&&Te[Le]&&delete Te[Le],le()}}class H{loadTile(ne,le){const{uid:Te,encoding:Le,rawImageData:De,padding:Ge}=ne,it=ImageBitmap&&De instanceof ImageBitmap?this.getImageData(De,Ge):De;le(null,new a.d_(Te,it,Le,Ge<1))}getImageData(ne,le){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const Te=this.offscreenCanvasContext.getImageData(-le,-le,ne.width+2*le,ne.height+2*le);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Te}}a.d$.setPbf(a.dZ);class Z{decodeRasterArray({task:ne,buffer:le},Te){a.d$.performDecoding(le,ne).then(Le=>{Te(null,Le)},Le=>{Te(Le)})}}const de=a.e0.prototype.toGeoJSON;let ve=class{constructor(Ue){this._feature=Ue,this.extent=a.a4,this.type=Ue.type,this.properties=Ue.tags,"id"in Ue&&!isNaN(Ue.id)&&(this.id=parseInt(Ue.id,10))}loadGeometry(){if(this._feature.type===1){const Ue=[];for(const ne of this._feature.geometry)Ue.push([new a.P(ne[0],ne[1])]);return Ue}{const Ue=[];for(const ne of this._feature.geometry){const le=[];for(const Te of ne)le.push(new a.P(Te[0],Te[1]));Ue.push(le)}return Ue}}toGeoJSON(Ue,ne,le){return de.call(this,Ue,ne,le)}},Ee=class{constructor(Ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.a4,this.length=Ue.length,this._features=Ue}feature(Ue){return new ve(this._features[Ue])}};const ie=64/4096,ue=128;class K{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],le){for(const Te of ne){const Le=Te.id;if(Le==null)continue;let De=this.features.get(Le);De&&this.updateCache(De,le),Te.geometry?(De=_e(Te),this.updateCache(De,le),this.features.set(Le,De)):this.features.delete(Le),this.updateCache(De,le)}}updateCache(ne,le){for(const{canonical:Te,uid:Le}of Object.values(le)){const{z:De,x:Ge,y:it}=Te;ge(ne,Math.pow(2,De),Ge,it)&&delete le[Le]}}getTile(ne,le,Te){const Le=Math.pow(2,ne),De=[];for(const Ge of this.features.values())ge(Ge,Le,le,Te)&&De.push(ft(Ge,Le,le,Te));return{features:De}}getFeatures(){return[...this.features.values()]}}function ge({minX:Ue,minY:ne,maxX:le,maxY:Te},Le,De,Ge){return Ue<(De+1+ie)/Le&&ne<(Ge+1+ie)/Le&&le>(De-ie)/Le&&Te>(Ge-ie)/Le}function _e(Ue){const{id:ne,geometry:le,properties:Te}=Ue;if(!le)return;if(le.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Le,coordinates:De}=le,Ge={id:ne,type:1,geometry:[],tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},it=Ge.geometry;if(Le==="Point")Se(De,it,Ge);else if(Le==="MultiPoint")for(const qe of De)Se(qe,it,Ge);else if(Le==="LineString")Ge.type=2,xe(De,it,Ge);else if(Le==="MultiLineString")Ge.type=2,wt(De,it,Ge);else if(Le==="Polygon")Ge.type=3,wt(De,it,Ge,!0);else{if(Le!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ge.type=3;for(const qe of De)wt(qe,it,Ge,!0)}return Ge}function Se([Ue,ne],le,Te){const Le=a.ak(Ue);let De=a.al(ne);De=De<0?0:De>1?1:De,le.push(Le,De),Te.minX=Math.min(Te.minX,Le),Te.minY=Math.min(Te.minY,De),Te.maxX=Math.max(Te.maxX,Le),Te.maxY=Math.max(Te.maxY,De)}function xe(Ue,ne,le,Te=!1,Le=!1){const De=[];for(const Ge of Ue)Se(Ge,De,le);ne.push(De),Te&&function(Ge,it){let qe=0;for(let nt=0,St=Ge.length,It=St-2;nt<St;It=nt,nt+=2)qe+=(Ge[nt]-Ge[It])*(Ge[nt+1]+Ge[It+1]);if(qe>0===it)for(let nt=0,St=Ge.length;nt<St/2;nt+=2){const It=Ge[nt],Xt=Ge[nt+1];Ge[nt]=Ge[St-2-nt],Ge[nt+1]=Ge[St-1-nt],Ge[St-2-nt]=It,Ge[St-1-nt]=Xt}}(De,Le)}function wt(Ue,ne,le,Te=!1){for(let Le=0;Le<Ue.length;Le++)xe(Ue[Le],ne,le,Te,Le===0)}function ft(Ue,ne,le,Te){const{id:Le,type:De,geometry:Ge,tags:it}=Ue,qe=[];if(De===1)(function(nt,St,It,Xt,_n){for(let Cn=0;Cn<nt.length;Cn+=2){const lr=Math.round(a.a4*(nt[Cn+0]*St-It)),Mn=Math.round(a.a4*(nt[Cn+1]*St-Xt));_n.push([lr,Mn])}})(Ge,ne,le,Te,qe);else for(const nt of Ge)Tt(nt,ne,le,Te,qe);return{id:Le,type:De,geometry:qe,tags:it}}function Tt(Ue,ne,le,Te,Le){const De=-ue,Ge=a.a4+ue;let it;for(let qe=0;qe<Ue.length-2;qe+=2){let nt=Math.round(a.a4*(Ue[qe+0]*ne-le)),St=Math.round(a.a4*(Ue[qe+1]*ne-Te)),It=Math.round(a.a4*(Ue[qe+2]*ne-le)),Xt=Math.round(a.a4*(Ue[qe+3]*ne-Te));const _n=It-nt,Cn=Xt-St;nt<De&&It<De||(nt<De?(St+=Math.round(Cn*((De-nt)/_n)),nt=De):It<De&&(Xt=St+Math.round(Cn*((De-nt)/_n)),It=De),St<De&&Xt<De||(St<De?(nt+=Math.round(_n*((De-St)/Cn)),St=De):Xt<De&&(It=nt+Math.round(_n*((De-St)/Cn)),Xt=De),nt>=Ge&&It>=Ge||(nt>=Ge?(St+=Math.round(Cn*((Ge-nt)/_n)),nt=Ge):It>=Ge&&(Xt=St+Math.round(Cn*((Ge-nt)/_n)),It=Ge),St>=Ge&&Xt>=Ge||(St>=Ge?(nt+=Math.round(_n*((Ge-St)/Cn)),St=Ge):Xt>=Ge&&(It=nt+Math.round(_n*((Ge-St)/Cn)),Xt=Ge),it&&nt===it[it.length-1][0]&&St===it[it.length-1][1]||(it=[[nt,St]],Le.push(it)),it.push([It,Xt])))))}}var gt={exports:{}},at=a.e2,bt=a.e1.VectorTileFeature,Zt=tt;function tt(Ue,ne){this.options=ne||{},this.features=Ue,this.length=Ue.length}function Et(Ue,ne){this.id=typeof Ue.id=="number"?Ue.id:void 0,this.type=Ue.type,this.rawGeometry=Ue.type===1?[Ue.geometry]:Ue.geometry,this.properties=Ue.tags,this.extent=ne||4096}tt.prototype.feature=function(Ue){return new Et(this.features[Ue],this.options.extent)},Et.prototype.loadGeometry=function(){var Ue=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Ue.length;ne++){for(var le=Ue[ne],Te=[],Le=0;Le<le.length;Le++)Te.push(new at(le[Le][0],le[Le][1]));this.geometry.push(Te)}return this.geometry},Et.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ue=this.geometry,ne=1/0,le=-1/0,Te=1/0,Le=-1/0,De=0;De<Ue.length;De++)for(var Ge=Ue[De],it=0;it<Ge.length;it++){var qe=Ge[it];ne=Math.min(ne,qe.x),le=Math.max(le,qe.x),Te=Math.min(Te,qe.y),Le=Math.max(Le,qe.y)}return[ne,Te,le,Le]},Et.prototype.toGeoJSON=bt.prototype.toGeoJSON;var mt=a.e3,Vt=Zt;function Pt(Ue){var ne=new mt;return function(le,Te){for(var Le in le.layers)Te.writeMessage(3,pn,le.layers[Le])}(Ue,ne),ne.finish()}function pn(Ue,ne){var le;ne.writeVarintField(15,Ue.version||1),ne.writeStringField(1,Ue.name||""),ne.writeVarintField(5,Ue.extent||4096);var Te={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<Ue.length;le++)Te.feature=Ue.feature(le),ne.writeMessage(2,dn,Te);var Le=Te.keys;for(le=0;le<Le.length;le++)ne.writeStringField(3,Le[le]);var De=Te.values;for(le=0;le<De.length;le++)ne.writeMessage(4,Tn,De[le])}function dn(Ue,ne){var le=Ue.feature;le.id!==void 0&&ne.writeVarintField(1,le.id),ne.writeMessage(2,yn,Ue),ne.writeVarintField(3,le.type),ne.writeMessage(4,Yt,le)}function yn(Ue,ne){var le=Ue.feature,Te=Ue.keys,Le=Ue.values,De=Ue.keycache,Ge=Ue.valuecache;for(var it in le.properties){var qe=le.properties[it],nt=De[it];if(qe!==null){nt===void 0&&(Te.push(it),De[it]=nt=Te.length-1),ne.writeVarint(nt);var St=typeof qe;St!=="string"&&St!=="boolean"&&St!=="number"&&(qe=JSON.stringify(qe));var It=St+":"+qe,Xt=Ge[It];Xt===void 0&&(Le.push(qe),Ge[It]=Xt=Le.length-1),ne.writeVarint(Xt)}}}function Mt(Ue,ne){return(ne<<3)+(7&Ue)}function cn(Ue){return Ue<<1^Ue>>31}function Yt(Ue,ne){for(var le=Ue.loadGeometry(),Te=Ue.type,Le=0,De=0,Ge=le.length,it=0;it<Ge;it++){var qe=le[it],nt=1;Te===1&&(nt=qe.length),ne.writeVarint(Mt(1,nt));for(var St=Te===3?qe.length-1:qe.length,It=0;It<St;It++){It===1&&Te!==1&&ne.writeVarint(Mt(2,St-1));var Xt=qe[It].x-Le,_n=qe[It].y-De;ne.writeVarint(cn(Xt)),ne.writeVarint(cn(_n)),Le+=Xt,De+=_n}Te===3&&ne.writeVarint(Mt(7,1))}}function Tn(Ue,ne){var le=typeof Ue;le==="string"?ne.writeStringField(1,Ue):le==="boolean"?ne.writeBooleanField(7,Ue):le==="number"&&(Ue%1!=0?ne.writeDoubleField(3,Ue):Ue<0?ne.writeSVarintField(6,Ue):ne.writeVarintField(5,Ue))}gt.exports=Pt,gt.exports.fromVectorTileJs=Pt,gt.exports.fromGeojsonVt=function(Ue,ne){ne=ne||{};var le={};for(var Te in Ue)le[Te]=new Vt(Ue[Te].features,ne),le[Te].name=Te,le[Te].version=ne.version,le[Te].extent=ne.extent;return Pt({layers:le})},gt.exports.GeoJSONWrapper=Vt;var xr=a.e4(gt.exports);const On={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ue=>Ue},fr=Math.fround||(Lr=new Float32Array(1),Ue=>(Lr[0]=+Ue,Lr[0]));var Lr;const or=3,Yn=5,ke=6;class He{constructor(ne){this.options=Object.assign(Object.create(On),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:le,minZoom:Te,maxZoom:Le}=this.options;le&&console.time("total time");const De=`prepare ${ne.length} points`;le&&console.time(De),this.points=ne;const Ge=[];for(let qe=0;qe<ne.length;qe++){const nt=ne[qe];if(!nt.geometry)continue;const[St,It]=nt.geometry.coordinates,Xt=fr(st(St)),_n=fr(zt(It));Ge.push(Xt,_n,1/0,qe,-1,1),this.options.reduce&&Ge.push(0)}let it=this.trees[Le+1]=this._createTree(Ge);le&&console.timeEnd(De);for(let qe=Le;qe>=Te;qe--){const nt=+Date.now();it=this.trees[qe]=this._createTree(this._cluster(it,qe)),le&&console.log("z%d: %d clusters in %dms",qe,it.numItems,+Date.now()-nt)}return le&&console.timeEnd("total time"),this}getClusters(ne,le){let Te=((ne[0]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,ne[1]));let De=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)Te=-180,De=180;else if(Te>De){const It=this.getClusters([Te,Le,180,Ge],le),Xt=this.getClusters([-180,Le,De,Ge],le);return It.concat(Xt)}const it=this.trees[this._limitZoom(le)],qe=it.range(st(Te),zt(Ge),st(De),zt(Le)),nt=it.data,St=[];for(const It of qe){const Xt=this.stride*It;St.push(nt[Xt+Yn]>1?lt(nt,Xt,this.clusterProps):this.points[nt[Xt+or]])}return St}getChildren(ne){const le=this._getOriginId(ne),Te=this._getOriginZoom(ne),Le="No cluster with the specified id.",De=this.trees[Te];if(!De)throw new Error(Le);const Ge=De.data;if(le*this.stride>=Ge.length)throw new Error(Le);const it=this.options.radius/(this.options.extent*Math.pow(2,Te-1)),qe=De.within(Ge[le*this.stride],Ge[le*this.stride+1],it),nt=[];for(const St of qe){const It=St*this.stride;Ge[It+4]===ne&&nt.push(Ge[It+Yn]>1?lt(Ge,It,this.clusterProps):this.points[Ge[It+or]])}if(nt.length===0)throw new Error(Le);return nt}getLeaves(ne,le,Te){const Le=[];return this._appendLeaves(Le,ne,le=le||10,Te=Te||0,0),Le}getTile(ne,le,Te){const Le=this.trees[this._limitZoom(ne)],De=Math.pow(2,ne),{extent:Ge,radius:it}=this.options,qe=it/Ge,nt=(Te-qe)/De,St=(Te+1+qe)/De,It={features:[]};return this._addTileFeatures(Le.range((le-qe)/De,nt,(le+1+qe)/De,St),Le.data,le,Te,De,It),le===0&&this._addTileFeatures(Le.range(1-qe/De,nt,1,St),Le.data,De,Te,De,It),le===De-1&&this._addTileFeatures(Le.range(0,nt,qe/De,St),Le.data,-1,Te,De,It),It.features.length?It:null}getClusterExpansionZoom(ne){let le=this._getOriginZoom(ne)-1;for(;le<=this.options.maxZoom;){const Te=this.getChildren(ne);if(le++,Te.length!==1)break;ne=Te[0].properties.cluster_id}return le}_appendLeaves(ne,le,Te,Le,De){const Ge=this.getChildren(le);for(const it of Ge){const qe=it.properties;if(qe&&qe.cluster?De+qe.point_count<=Le?De+=qe.point_count:De=this._appendLeaves(ne,qe.cluster_id,Te,Le,De):De<Le?De++:ne.push(it),ne.length===Te)break}return De}_createTree(ne){const le=new a.cN(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Te=0;Te<ne.length;Te+=this.stride)le.add(ne[Te],ne[Te+1]);return le.finish(),le.data=ne,le}_addTileFeatures(ne,le,Te,Le,De,Ge){for(const it of ne){const qe=it*this.stride,nt=le[qe+Yn]>1;let St,It,Xt;if(nt)St=Ke(le,qe,this.clusterProps),It=le[qe],Xt=le[qe+1];else{const lr=this.points[le[qe+or]];St=lr.properties;const[Mn,cr]=lr.geometry.coordinates;It=st(Mn),Xt=zt(cr)}const _n={type:1,geometry:[[Math.round(this.options.extent*(It*De-Te)),Math.round(this.options.extent*(Xt*De-Le))]],tags:St};let Cn;Cn=nt||this.options.generateId?le[qe+or]:this.points[le[qe+or]].id,Cn!==void 0&&(_n.id=Cn),Ge.features.push(_n)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,le){const{radius:Te,extent:Le,reduce:De,minPoints:Ge}=this.options,it=Te/(Le*Math.pow(2,le)),qe=ne.data,nt=[],St=this.stride;for(let It=0;It<qe.length;It+=St){if(qe[It+2]<=le)continue;qe[It+2]=le;const Xt=qe[It],_n=qe[It+1],Cn=ne.within(qe[It],qe[It+1],it),lr=qe[It+Yn];let Mn=lr;for(const cr of Cn){const un=cr*St;qe[un+2]>le&&(Mn+=qe[un+Yn])}if(Mn>lr&&Mn>=Ge){let cr,un=Xt*lr,Zr=_n*lr,_r=-1;const ur=(It/St<<5)+(le+1)+this.points.length;for(const pi of Cn){const mi=pi*St;if(qe[mi+2]<=le)continue;qe[mi+2]=le;const Gi=qe[mi+Yn];un+=qe[mi]*Gi,Zr+=qe[mi+1]*Gi,qe[mi+4]=ur,De&&(cr||(cr=this._map(qe,It,!0),_r=this.clusterProps.length,this.clusterProps.push(cr)),De(cr,this._map(qe,mi)))}qe[It+4]=ur,nt.push(un/Mn,Zr/Mn,1/0,ur,-1,Mn),De&&nt.push(_r)}else{for(let cr=0;cr<St;cr++)nt.push(qe[It+cr]);if(Mn>1)for(const cr of Cn){const un=cr*St;if(!(qe[un+2]<=le)){qe[un+2]=le;for(let Zr=0;Zr<St;Zr++)nt.push(qe[un+Zr])}}}}return nt}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,le,Te){if(ne[le+Yn]>1){const Ge=this.clusterProps[ne[le+ke]];return Te?Object.assign({},Ge):Ge}const Le=this.points[ne[le+or]].properties,De=this.options.map(Le);return Te&&De===Le?Object.assign({},De):De}}function lt(Ue,ne,le){return{type:"Feature",id:Ue[ne+or],properties:Ke(Ue,ne,le),geometry:{type:"Point",coordinates:[(Te=Ue[ne],360*(Te-.5)),ln(Ue[ne+1])]}};var Te}function Ke(Ue,ne,le){const Te=Ue[ne+Yn],Le=Te>=1e4?`${Math.round(Te/1e3)}k`:Te>=1e3?Math.round(Te/100)/10+"k":Te,De=Ue[ne+ke],Ge=De===-1?{}:Object.assign({},le[De]);return Object.assign(Ge,{cluster:!0,cluster_id:Ue[ne+or],point_count:Te,point_count_abbreviated:Le})}function st(Ue){return Ue/360+.5}function zt(Ue){const ne=Math.sin(Ue*Math.PI/180),le=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return le<0?0:le>1?1:le}function ln(Ue){const ne=(180-360*Ue)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function Ht(Ue,ne,le,Te){let Le=Te;const De=ne+(le-ne>>1);let Ge,it=le-ne;const qe=Ue[ne],nt=Ue[ne+1],St=Ue[le],It=Ue[le+1];for(let Xt=ne+3;Xt<le;Xt+=3){const _n=vn(Ue[Xt],Ue[Xt+1],qe,nt,St,It);if(_n>Le)Ge=Xt,Le=_n;else if(_n===Le){const Cn=Math.abs(Xt-De);Cn<it&&(Ge=Xt,it=Cn)}}Le>Te&&(Ge-ne>3&&Ht(Ue,ne,Ge,Te),Ue[Ge+2]=Le,le-Ge>3&&Ht(Ue,Ge,le,Te))}function vn(Ue,ne,le,Te,Le,De){let Ge=Le-le,it=De-Te;if(Ge!==0||it!==0){const qe=((Ue-le)*Ge+(ne-Te)*it)/(Ge*Ge+it*it);qe>1?(le=Le,Te=De):qe>0&&(le+=Ge*qe,Te+=it*qe)}return Ge=Ue-le,it=ne-Te,Ge*Ge+it*it}function Fn(Ue,ne,le,Te){const Le={id:Ue??null,type:ne,geometry:le,tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")pr(Le,le);else if(ne==="Polygon")pr(Le,le[0]);else if(ne==="MultiLineString")for(const De of le)pr(Le,De);else if(ne==="MultiPolygon")for(const De of le)pr(Le,De[0]);return Le}function pr(Ue,ne){for(let le=0;le<ne.length;le+=3)Ue.minX=Math.min(Ue.minX,ne[le]),Ue.minY=Math.min(Ue.minY,ne[le+1]),Ue.maxX=Math.max(Ue.maxX,ne[le]),Ue.maxY=Math.max(Ue.maxY,ne[le+1])}function fi(Ue,ne,le,Te){if(!ne.geometry)return;const Le=ne.geometry.coordinates;if(Le&&Le.length===0)return;const De=ne.geometry.type,Ge=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let it=[],qe=ne.id;if(le.promoteId?qe=ne.properties[le.promoteId]:le.generateId&&(qe=Te||0),De==="Point")ir(Le,it);else if(De==="MultiPoint")for(const nt of Le)ir(nt,it);else if(De==="LineString")Ci(Le,it,Ge,!1);else if(De==="MultiLineString"){if(le.lineMetrics){for(const nt of Le)it=[],Ci(nt,it,Ge,!1),Ue.push(Fn(qe,"LineString",it,ne.properties));return}is(Le,it,Ge,!1)}else if(De==="Polygon")is(Le,it,Ge,!0);else{if(De!=="MultiPolygon"){if(De==="GeometryCollection"){for(const nt of ne.geometry.geometries)fi(Ue,{id:qe,geometry:nt,properties:ne.properties},le,Te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of Le){const St=[];is(nt,St,Ge,!0),it.push(St)}}Ue.push(Fn(qe,De,it,ne.properties))}function ir(Ue,ne){ne.push(An(Ue[0]),ar(Ue[1]),0)}function Ci(Ue,ne,le,Te){let Le,De,Ge=0;for(let qe=0;qe<Ue.length;qe++){const nt=An(Ue[qe][0]),St=ar(Ue[qe][1]);ne.push(nt,St,0),qe>0&&(Ge+=Te?(Le*St-nt*De)/2:Math.sqrt(Math.pow(nt-Le,2)+Math.pow(St-De,2))),Le=nt,De=St}const it=ne.length-3;ne[2]=1,Ht(ne,0,it,le),ne[it+2]=1,ne.size=Math.abs(Ge),ne.start=0,ne.end=ne.size}function is(Ue,ne,le,Te){for(let Le=0;Le<Ue.length;Le++){const De=[];Ci(Ue[Le],De,le,Te),ne.push(De)}}function An(Ue){return Ue/360+.5}function ar(Ue){const ne=Math.sin(Ue*Math.PI/180),le=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return le<0?0:le>1?1:le}function mn(Ue,ne,le,Te,Le,De,Ge,it){if(Te/=ne,De>=(le/=ne)&&Ge<Te)return Ue;if(Ge<le||De>=Te)return null;const qe=[];for(const nt of Ue){const St=nt.geometry;let It=nt.type;const Xt=Le===0?nt.minX:nt.minY,_n=Le===0?nt.maxX:nt.maxY;if(Xt>=le&&_n<Te){qe.push(nt);continue}if(_n<le||Xt>=Te)continue;let Cn=[];if(It==="Point"||It==="MultiPoint")Js(St,Cn,le,Te,Le);else if(It==="LineString")Ai(St,Cn,le,Te,Le,!1,it.lineMetrics);else if(It==="MultiLineString")wa(St,Cn,le,Te,Le,!1);else if(It==="Polygon")wa(St,Cn,le,Te,Le,!0);else if(It==="MultiPolygon")for(const lr of St){const Mn=[];wa(lr,Mn,le,Te,Le,!0),Mn.length&&Cn.push(Mn)}if(Cn.length){if(it.lineMetrics&&It==="LineString"){for(const lr of Cn)qe.push(Fn(nt.id,It,lr,nt.tags));continue}It!=="LineString"&&It!=="MultiLineString"||(Cn.length===1?(It="LineString",Cn=Cn[0]):It="MultiLineString"),It!=="Point"&&It!=="MultiPoint"||(It=Cn.length===3?"Point":"MultiPoint"),qe.push(Fn(nt.id,It,Cn,nt.tags))}}return qe.length?qe:null}function Js(Ue,ne,le,Te,Le){for(let De=0;De<Ue.length;De+=3){const Ge=Ue[De+Le];Ge>=le&&Ge<=Te&&rn(ne,Ue[De],Ue[De+1],Ue[De+2])}}function Ai(Ue,ne,le,Te,Le,De,Ge){let it=fo(Ue);const qe=Le===0?er:ti;let nt,St,It=Ue.start;for(let Mn=0;Mn<Ue.length-3;Mn+=3){const cr=Ue[Mn],un=Ue[Mn+1],Zr=Ue[Mn+2],_r=Ue[Mn+3],ur=Ue[Mn+4],pi=Le===0?cr:un,mi=Le===0?_r:ur;let Gi=!1;Ge&&(nt=Math.sqrt(Math.pow(cr-_r,2)+Math.pow(un-ur,2))),pi<le?mi>le&&(St=qe(it,cr,un,_r,ur,le),Ge&&(it.start=It+nt*St)):pi>Te?mi<Te&&(St=qe(it,cr,un,_r,ur,Te),Ge&&(it.start=It+nt*St)):rn(it,cr,un,Zr),mi<le&&pi>=le&&(St=qe(it,cr,un,_r,ur,le),Gi=!0),mi>Te&&pi<=Te&&(St=qe(it,cr,un,_r,ur,Te),Gi=!0),!De&&Gi&&(Ge&&(it.end=It+nt*St),ne.push(it),it=fo(Ue)),Ge&&(It+=nt)}let Xt=Ue.length-3;const _n=Ue[Xt],Cn=Ue[Xt+1],lr=Le===0?_n:Cn;lr>=le&&lr<=Te&&rn(it,_n,Cn,Ue[Xt+2]),Xt=it.length-3,De&&Xt>=3&&(it[Xt]!==it[0]||it[Xt+1]!==it[1])&&rn(it,it[0],it[1],it[2]),it.length&&ne.push(it)}function fo(Ue){const ne=[];return ne.size=Ue.size,ne.start=Ue.start,ne.end=Ue.end,ne}function wa(Ue,ne,le,Te,Le,De){for(const Ge of Ue)Ai(Ge,ne,le,Te,Le,De,!1)}function rn(Ue,ne,le,Te){Ue.push(ne,le,Te)}function er(Ue,ne,le,Te,Le,De){const Ge=(De-ne)/(Te-ne);return rn(Ue,De,le+(Le-le)*Ge,1),Ge}function ti(Ue,ne,le,Te,Le,De){const Ge=(De-le)/(Le-le);return rn(Ue,ne+(Te-ne)*Ge,De,1),Ge}function Mi(Ue,ne){const le=[];for(let Te=0;Te<Ue.length;Te++){const Le=Ue[Te],De=Le.type;let Ge;if(De==="Point"||De==="MultiPoint"||De==="LineString")Ge=Ts(Le.geometry,ne);else if(De==="MultiLineString"||De==="Polygon"){Ge=[];for(const it of Le.geometry)Ge.push(Ts(it,ne))}else if(De==="MultiPolygon"){Ge=[];for(const it of Le.geometry){const qe=[];for(const nt of it)qe.push(Ts(nt,ne));Ge.push(qe)}}le.push(Fn(Le.id,De,Ge,Le.tags))}return le}function Ts(Ue,ne){const le=[];le.size=Ue.size,Ue.start!==void 0&&(le.start=Ue.start,le.end=Ue.end);for(let Te=0;Te<Ue.length;Te+=3)le.push(Ue[Te]+ne,Ue[Te+1],Ue[Te+2]);return le}function Es(Ue,ne){if(Ue.transformed)return Ue;const le=1<<Ue.z,Te=Ue.x,Le=Ue.y;for(const De of Ue.features){const Ge=De.geometry,it=De.type;if(De.geometry=[],it===1)for(let qe=0;qe<Ge.length;qe+=2)De.geometry.push(Ls(Ge[qe],Ge[qe+1],ne,le,Te,Le));else for(let qe=0;qe<Ge.length;qe++){const nt=[];for(let St=0;St<Ge[qe].length;St+=2)nt.push(Ls(Ge[qe][St],Ge[qe][St+1],ne,le,Te,Le));De.geometry.push(nt)}}return Ue.transformed=!0,Ue}function Ls(Ue,ne,le,Te,Le,De){return[Math.round(le*(Ue*Te-Le)),Math.round(le*(ne*Te-De))]}function $s(Ue,ne,le,Te,Le){const De=ne===Le.maxZoom?0:Le.tolerance/((1<<ne)*Le.extent),Ge={features:[],numPoints:0,numSimplified:0,numFeatures:Ue.length,source:null,x:le,y:Te,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const it of Ue)Lo(Ge,it,De,Le);return Ge}function Lo(Ue,ne,le,Te){const Le=ne.geometry,De=ne.type,Ge=[];if(Ue.minX=Math.min(Ue.minX,ne.minX),Ue.minY=Math.min(Ue.minY,ne.minY),Ue.maxX=Math.max(Ue.maxX,ne.maxX),Ue.maxY=Math.max(Ue.maxY,ne.maxY),De==="Point"||De==="MultiPoint")for(let it=0;it<Le.length;it+=3)Ge.push(Le[it],Le[it+1]),Ue.numPoints++,Ue.numSimplified++;else if(De==="LineString")jr(Ge,Le,Ue,le,!1,!1);else if(De==="MultiLineString"||De==="Polygon")for(let it=0;it<Le.length;it++)jr(Ge,Le[it],Ue,le,De==="Polygon",it===0);else if(De==="MultiPolygon")for(let it=0;it<Le.length;it++){const qe=Le[it];for(let nt=0;nt<qe.length;nt++)jr(Ge,qe[nt],Ue,le,!0,nt===0)}if(Ge.length){let it=ne.tags||null;if(De==="LineString"&&Te.lineMetrics){it={};for(const nt in ne.tags)it[nt]=ne.tags[nt];it.mapbox_clip_start=Le.start/Le.size,it.mapbox_clip_end=Le.end/Le.size}const qe={geometry:Ge,type:De==="Polygon"||De==="MultiPolygon"?3:De==="LineString"||De==="MultiLineString"?2:1,tags:it};ne.id!==null&&(qe.id=ne.id),Ue.features.push(qe)}}function jr(Ue,ne,le,Te,Le,De){const Ge=Te*Te;if(Te>0&&ne.size<(Le?Ge:Te))return void(le.numPoints+=ne.length/3);const it=[];for(let qe=0;qe<ne.length;qe+=3)(Te===0||ne[qe+2]>Ge)&&(le.numSimplified++,it.push(ne[qe],ne[qe+1])),le.numPoints++;Le&&function(qe,nt){let St=0;for(let It=0,Xt=qe.length,_n=Xt-2;It<Xt;_n=It,It+=2)St+=(qe[It]-qe[_n])*(qe[It+1]+qe[_n+1]);if(St>0===nt)for(let It=0,Xt=qe.length;It<Xt/2;It+=2){const _n=qe[It],Cn=qe[It+1];qe[It]=qe[Xt-2-It],qe[It+1]=qe[Xt-1-It],qe[Xt-2-It]=_n,qe[Xt-1-It]=Cn}}(it,De),Ue.push(it)}const Wa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ni{constructor(ne,le){const Te=(le=this.options=function(De,Ge){for(const it in Ge)De[it]=Ge[it];return De}(Object.create(Wa),le)).debug;if(Te&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Le=function(De,Ge){const it=[];if(De.type==="FeatureCollection")for(let qe=0;qe<De.features.length;qe++)fi(it,De.features[qe],Ge,qe);else fi(it,De.type==="Feature"?De:{geometry:De},Ge);return it}(ne,le);this.tiles={},this.tileCoords=[],Te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Le=function(De,Ge){const it=Ge.buffer/Ge.extent;let qe=De;const nt=mn(De,1,-1-it,it,0,-1,2,Ge),St=mn(De,1,1-it,2+it,0,-1,2,Ge);return(nt||St)&&(qe=mn(De,1,-it,1+it,0,-1,2,Ge)||[],nt&&(qe=Mi(nt,1).concat(qe)),St&&(qe=qe.concat(Mi(St,-1)))),qe}(Le,le),Le.length&&this.splitTile(Le,0,0,0),Te&&(Le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,le,Te,Le,De,Ge,it){const qe=[ne,le,Te,Le],nt=this.options,St=nt.debug;for(;qe.length;){Le=qe.pop(),Te=qe.pop(),le=qe.pop(),ne=qe.pop();const It=1<<le,Xt=xi(le,Te,Le);let _n=this.tiles[Xt];if(!_n&&(St>1&&console.time("creation"),_n=this.tiles[Xt]=$s(ne,le,Te,Le,nt),this.tileCoords.push({z:le,x:Te,y:Le}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,Te,Le,_n.numFeatures,_n.numPoints,_n.numSimplified),console.timeEnd("creation"));const Gi=`z${le}`;this.stats[Gi]=(this.stats[Gi]||0)+1,this.total++}if(_n.source=ne,De==null){if(le===nt.indexMaxZoom||_n.numPoints<=nt.indexMaxPoints)continue}else{if(le===nt.maxZoom||le===De)continue;if(De!=null){const Gi=De-le;if(Te!==Ge>>Gi||Le!==it>>Gi)continue}}if(_n.source=null,ne.length===0)continue;St>1&&console.time("clipping");const Cn=.5*nt.buffer/nt.extent,lr=.5-Cn,Mn=.5+Cn,cr=1+Cn;let un=null,Zr=null,_r=null,ur=null,pi=mn(ne,It,Te-Cn,Te+Mn,0,_n.minX,_n.maxX,nt),mi=mn(ne,It,Te+lr,Te+cr,0,_n.minX,_n.maxX,nt);ne=null,pi&&(un=mn(pi,It,Le-Cn,Le+Mn,1,_n.minY,_n.maxY,nt),Zr=mn(pi,It,Le+lr,Le+cr,1,_n.minY,_n.maxY,nt),pi=null),mi&&(_r=mn(mi,It,Le-Cn,Le+Mn,1,_n.minY,_n.maxY,nt),ur=mn(mi,It,Le+lr,Le+cr,1,_n.minY,_n.maxY,nt),mi=null),St>1&&console.timeEnd("clipping"),qe.push(un||[],le+1,2*Te,2*Le),qe.push(Zr||[],le+1,2*Te,2*Le+1),qe.push(_r||[],le+1,2*Te+1,2*Le),qe.push(ur||[],le+1,2*Te+1,2*Le+1)}}getTile(ne,le,Te){ne=+ne,le=+le,Te=+Te;const Le=this.options,{extent:De,debug:Ge}=Le;if(ne<0||ne>24)return null;const it=1<<ne,qe=xi(ne,le=le+it&it-1,Te);if(this.tiles[qe])return Es(this.tiles[qe],De);Ge>1&&console.log("drilling down to z%d-%d-%d",ne,le,Te);let nt,St=ne,It=le,Xt=Te;for(;!nt&&St>0;)St--,It>>=1,Xt>>=1,nt=this.tiles[xi(St,It,Xt)];return nt&&nt.source?(Ge>1&&(console.log("found parent tile z%d-%d-%d",St,It,Xt),console.time("drilling down")),this.splitTile(nt.source,St,It,Xt,ne,le,Te),Ge>1&&console.timeEnd("drilling down"),this.tiles[qe]?Es(this.tiles[qe],De):null):null}}function xi(Ue,ne,le){return 32*((1<<Ue)*le+ne)+Ue}function Tl(Ue,ne){const le=Ue.tileID.canonical;if(!this._geoJSONIndex)return ne(null,null);const Te=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!Te)return ne(null,null);const Le=new Ee(Te.features);let De=xr(Le);De.byteOffset===0&&De.byteLength===De.buffer.byteLength||(De=new Uint8Array(De)),ne(null,{vectorTile:Le,rawData:De.buffer})}class Ta extends U{constructor(ne,le,Te,Le,De,Ge){super(ne,le,Te,Le,Tl,Ge),De&&(this.loadGeoJSON=De),this._dynamicIndex=new K}loadData(ne,le){const Te=ne&&ne.request,Le=Te&&Te.collectResourceTiming;this.loadGeoJSON(ne,(De,Ge)=>{if(De||!Ge)return le(De);if(typeof Ge!="object")return le(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const qe=a.z(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(qe.result==="error")throw new Error(qe.value.map(nt=>`${nt.key}: ${nt.message}`).join(", "));Ge.features=Ge.features.filter(nt=>qe.value.evaluate({zoom:0},nt))}ne.dynamic?(Ge.type==="Feature"&&(Ge={type:"FeatureCollection",features:[Ge]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ge.features,this.loaded),ne.cluster&&(Ge.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new He(function({superclusterOptions:qe,clusterProperties:nt}){if(!nt||!qe)return qe;const St={},It={},Xt={accumulated:null,zoom:0},_n={properties:null},Cn=Object.keys(nt);for(const lr of Cn){const[Mn,cr]=nt[lr],un=a.z(cr),Zr=a.z(typeof Mn=="string"?[Mn,["accumulated"],["get",lr]]:Mn);St[lr]=un.value,It[lr]=Zr.value}return qe.map=lr=>{_n.properties=lr;const Mn={};for(const cr of Cn)Mn[cr]=St[cr].evaluate(Xt,_n);return Mn},qe.reduce=(lr,Mn)=>{_n.properties=Mn;for(const cr of Cn)Xt.accumulated=lr[cr],lr[cr]=It[cr].evaluate(Xt,_n)},qe}(ne)).load(Ge.features):ne.dynamic?this._dynamicIndex:function(qe,nt){return new ni(qe,nt)}(Ge,ne.geojsonVtOptions)}catch(qe){return le(qe)}const it={};if(Le){const qe=I(Te);qe&&(it.resourceTiming={},it.resourceTiming[ne.source]=JSON.parse(JSON.stringify(qe)))}le(null,it)}})}reloadTile(ne,le){const Te=this.loaded;return Te&&Te[ne.uid]?ne.partial?le(null,void 0):super.reloadTile(ne,le):this.loadTile(ne,le)}loadGeoJSON(ne,le){if(ne.request)a.h(ne.request,le);else{if(typeof ne.data!="string")return le(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));try{return le(null,JSON.parse(ne.data))}catch{return le(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ne,le){try{le(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(Te){le(Te)}}getClusterChildren(ne,le){try{le(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(Te){le(Te)}}getClusterLeaves(ne,le){try{le(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(Te){le(Te)}}}class po{constructor(ne,le){this.tileID=new a.aQ(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=le}parse(ne,le,Te,Le){this.status="parsing";const De=new a.aQ(Te.tileID.overscaledZ,Te.tileID.wrap,Te.tileID.canonical.z,Te.tileID.canonical.x,Te.tileID.canonical.y),Ge={},it=le.familiesBySource[Te.source],qe=new a.dQ(De,Te.promoteId);return qe.bucketLayerIDs=[],qe.is3DTile=!0,a.e6(ne).then(nt=>{if(!nt)return Le(new Error("Could not parse tile"));const St=a.e7(nt,1/a.b7(Te.tileID.canonical)),It=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("MAPBOX_mesh_features")||nt.json.asset.extras&&nt.json.asset.extras.MAPBOX_mesh_features,Xt=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("EXT_meshopt_compression"),_n=new a.Y(this.zoom,{brightness:this.brightness});for(const Cn in it)for(const lr of it[Cn]){const Mn=lr[0];qe.bucketLayerIDs.push(lr.map(un=>un.id)),Mn.recalculate(_n,[]);const cr=new a.e8(St,De,It,Xt,this.brightness,qe);It||(cr.needsUpload=!0),Ge[Mn.fqid]=cr,cr.evaluate(Mn)}this.status="done",Le(null,{buckets:Ge,featureIndex:qe})}).catch(nt=>Le(new Error(nt.message)))}}class Fi{constructor(ne,le,Te,Le,De,Ge){this.actor=ne,this.layerIndex=le,this.brightness=Ge,this.loading={},this.loaded={}}loadTile(ne,le){const Te=ne.uid,Le=this.loading[Te]=new po(ne,this.brightness);a.e5(ne.request,(De,Ge)=>{const it=!this.loading[Te];return delete this.loading[Te],it||De?(Le.status="done",it||(this.loaded[Te]=Le),le(De)):Ge&&Ge.byteLength!==0?void Le.parse(Ge,this.layerIndex,ne,(qe,nt)=>{Le.status="done",this.loaded=this.loaded||{},this.loaded[Te]=Le,qe||!nt?le(qe):le(null,nt)}):(Le.status="done",this.loaded[Te]=Le,le())})}reloadTile(ne,le){const Te=this.loaded,Le=ne.uid;if(Te&&Te[Le]){const De=Te[Le];De.projection=ne.projection,De.brightness=ne.brightness;const Ge=(it,qe)=>{De.reloadCallback&&(delete De.reloadCallback,this.loadTile(ne,le)),le(it,qe)};De.status==="parsing"?De.reloadCallback=Ge:De.status==="done"&&this.loadTile(ne,le)}}abortTile(ne,le){const Te=ne.uid;this.loading[Te]&&delete this.loading[Te],le()}removeTile(ne,le){const Te=this.loaded,Le=ne.uid;Te&&Te[Le]&&delete Te[Le],le()}}class Xu{constructor(ne){this.self=ne,this.actor=new a.e9(ne,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.aK({name:"mercator"}),this.workerSourceTypes={vector:U,geojson:Ta,"batched-model":Fi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(le,Te)=>{if(this.workerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.workerSourceTypes[le]=Te},this.self.registerRTLTextPlugin=le=>{if(a.ea.isParsed())throw new Error("RTL text plugin already registered.");a.ea.applyArabicShaping=le.applyArabicShaping,a.ea.processBidirectionalText=le.processBidirectionalText,a.ea.processStyledBidirectionalText=le.processStyledBidirectionalText}}clearCaches(ne,le,Te){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.workerSources[ne],delete this.demWorkerSources[ne],delete this.rasterArrayWorkerSource,Te()}checkIfReady(ne,le,Te){Te()}setReferrer(ne,le){this.referrer=le}spriteLoaded(ne,{scope:le,isLoaded:Te}){if(this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.isSpriteLoaded[ne][le]=Te,this.workerSources[ne]&&this.workerSources[ne][le])for(const Le in this.workerSources[ne][le]){const De=this.workerSources[ne][le][Le];for(const Ge in De){const it=De[Ge];it instanceof U&&(it.isSpriteLoaded=Te,it.fire(new a.g("isSpriteLoaded")))}}}setImages(ne,{scope:le,images:Te},Le){if(this.availableImages[ne]||(this.availableImages[ne]={}),this.availableImages[ne][le]=Te,this.workerSources[ne]&&this.workerSources[ne][le]){for(const De in this.workerSources[ne][le]){const Ge=this.workerSources[ne][le][De];for(const it in Ge)Ge[it].availableImages=Te}Le()}else Le()}setProjection(ne,le){this.projections[ne]=a.aK(le)}setBrightness(ne,le,Te){this.brightness=le,Te()}setLayers(ne,le,Te){this.getLayerIndex(ne,le.scope).replace(le.layers,le.options),Te()}updateLayers(ne,le,Te){this.getLayerIndex(ne,le.scope).update(le.layers,le.removedIds,le.options),Te()}loadTile(ne,le,Te){le.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,le.type,le.source,le.scope).loadTile(le,Te)}loadDEMTile(ne,le,Te){this.getDEMWorkerSource(ne,le.source,le.scope).loadTile(le,Te)}decodeRasterArray(ne,le,Te){this.getRasterArrayWorkerSource().decodeRasterArray(le,Te)}reloadTile(ne,le,Te){le.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,le.type,le.source,le.scope).reloadTile(le,Te)}abortTile(ne,le,Te){this.getWorkerSource(ne,le.type,le.source,le.scope).abortTile(le,Te)}removeTile(ne,le,Te){this.getWorkerSource(ne,le.type,le.source,le.scope).removeTile(le,Te)}removeSource(ne,le,Te){if(!(this.workerSources[ne]&&this.workerSources[ne][le.scope]&&this.workerSources[ne][le.scope][le.type]&&this.workerSources[ne][le.scope][le.type][le.source]))return;const Le=this.workerSources[ne][le.scope][le.type][le.source];delete this.workerSources[ne][le.scope][le.type][le.source],Le.removeSource!==void 0?Le.removeSource(le,Te):Te()}loadWorkerSource(ne,le,Te){try{this.self.importScripts(le.url),Te()}catch(Le){Te(Le.toString())}}syncRTLPluginState(ne,le,Te){try{a.ea.setState(le);const Le=a.ea.getPluginURL();if(a.ea.isLoaded()&&!a.ea.isParsed()&&Le!=null){this.self.importScripts(Le);const De=a.ea.isParsed();Te(De?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Le}`),De)}}catch(Le){Te(Le.toString())}}setDracoUrl(ne,le){this.dracoUrl=le}getAvailableImages(ne,le){this.availableImages[ne]||(this.availableImages[ne]={});let Te=this.availableImages[ne][le];return Te||(Te=[]),Te}getLayerIndex(ne,le){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let Te=this.layerIndexes[ne][le];return Te||(Te=this.layerIndexes[ne][le]=new L,Te.scope=le),Te}getWorkerSource(ne,le,Te,Le){return this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][Le]||(this.workerSources[ne][Le]={}),this.workerSources[ne][Le][le]||(this.workerSources[ne][Le][le]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),this.workerSources[ne][Le][le][Te]||(this.workerSources[ne][Le][le][Te]=new this.workerSourceTypes[le]({send:(De,Ge,it,qe,nt,St)=>{this.actor.send(De,Ge,it,ne,nt,St)},scheduler:this.actor.scheduler},this.getLayerIndex(ne,Le),this.getAvailableImages(ne,Le),this.isSpriteLoaded[ne][Le],void 0,this.brightness)),this.workerSources[ne][Le][le][Te]}getDEMWorkerSource(ne,le,Te){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][Te]||(this.demWorkerSources[ne][Te]={}),this.demWorkerSources[ne][Te][le]||(this.demWorkerSources[ne][Te][le]=new H),this.demWorkerSources[ne][Te][le]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Z),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ne,le){a.eb(le)}getWorkerPerformanceMetrics(ne,le,Te){Te(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Xu(self)),Xu}),_(["./shared"],function(a){var I=M;function M(g){return!function(l){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,b,T=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(T);try{b=new Worker(S),y=!0}catch{y=!1}return b&&b.terminate(),URL.revokeObjectURL(S),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var b=y.getContext("2d");if(!b)return!1;var T=b.getImageData(0,0,1,1);return T&&T.width===y.width}()?(D[f=l&&l.failIfMajorPerformanceCaveat]===void 0&&(D[f]=function(y){var b,T=function(S){var A=document.createElement("canvas"),O=Object.create(M.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=S,A.getContext("webgl2",O)}(y);if(!T)return!1;try{b=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!b||T.isContextLost())&&(T.shaderSource(b,"void main() {}"),T.compileShader(b),T.getShaderParameter(b,T.COMPILE_STATUS)===!0)}(f)),D[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var f}(g)}var D={};function L(g,l,f){const y=document.createElement(g);return l!=null&&(y.className=l),f&&f.appendChild(y),y}function G(g,l,f){const y=document.createElementNS("http://www.w3.org/2000/svg",g);for(const b of Object.keys(l))y.setAttributeNS(null,b,String(l[b]));return f&&f.appendChild(y),y}M.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Q=typeof document<"u"?document.documentElement&&document.documentElement.style:null,re=Q&&Q.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ee;function U(){Q&&re&&(ee=Q[re],Q[re]="none")}function H(){Q&&re&&(Q[re]=ee)}function Z(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",Z,!0)}function de(){window.addEventListener("click",Z,!0),window.setTimeout(()=>{window.removeEventListener("click",Z,!0)},0)}function ve(g,l){const f=g.getBoundingClientRect();return ue(g,f,l)}function Ee(g,l){const f=g.getBoundingClientRect(),y=[];for(let b=0;b<l.length;b++)y.push(ue(g,f,l[b]));return y}function ie(g){return window.InstallTrigger!==void 0&&g.button===2&&g.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function ue(g,l,f){const y=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new a.P((f.clientX-l.left)*y,(f.clientY-l.top)*y)}class K{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(l,f){this._updatedSourceCaches[l]=f,this.setDirty()}discardSourceCacheUpdate(l){delete this._updatedSourceCaches[l]}updateLayer(l){const f=l.scope;this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._updatedLayers[f].add(l.id),this.setDirty()}removeLayer(l){const f=l.scope;this._removedLayers[f]=this._removedLayers[f]||{},this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._removedLayers[f][l.id]=l,this._updatedLayers[f].delete(l.id),this._updatedPaintProps.delete(l.fqid),this.setDirty()}getRemovedLayer(l){return this._removedLayers[l.scope]?this._removedLayers[l.scope][l.id]:null}discardLayerRemoval(l){this._removedLayers[l.scope]&&delete this._removedLayers[l.scope][l.id]}getLayerUpdatesByScope(){const l={};for(const f in this._updatedLayers)l[f]=l[f]||{},l[f].updatedIds=Array.from(this._updatedLayers[f].values());for(const f in this._removedLayers)l[f]=l[f]||{},l[f].removedIds=Object.keys(this._removedLayers[f]);return l}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(l){this._updatedPaintProps.add(l.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(l){this._updatedImages.add(l),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const ge={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _e{constructor(l,f,y,b,T,S){this.length=f.length,this.attributes=y,this.itemSize=f.bytesPerElement,this.dynamicDraw=b,this.instanceCount=S,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||T||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let y=0;y<this.attributes.length;y++){const b=f.attributes[this.attributes[y].name];b!==void 0&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,f,y){for(let b=0;b<this.attributes.length;b++){const T=this.attributes[b],S=f.attributes[T.name];S!==void 0&&l.vertexAttribPointer(S,T.components,l[ge[T.type]],!1,this.itemSize,T.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(l,f,y){for(let b=0;b<this.attributes.length;b++){const T=f.attributes[this.attributes[b].name];T!==void 0&&this.instanceCount&&this.instanceCount>0&&l.vertexAttribDivisor(T,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Se{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class xe extends Se{getDefault(){return a.C.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class wt extends Se{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class ft extends Se{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Tt extends Se{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class gt extends Se{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class at extends Se{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class bt extends Se{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Zt extends Se{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class tt extends Se{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class Et extends Se{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class mt extends Se{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class Vt extends Se{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Pt extends Se{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class pn extends Se{getDefault(){const l=this.gl;return[l.ONE,l.ZERO,l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.blendFuncSeparate(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class dn extends Se{getDefault(){return a.C.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class yn extends Se{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(l,l),this.current=l,this.dirty=!1)}}class Mt extends Se{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class cn extends Se{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Yt extends Se{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Tn=class extends Se{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class xr extends Se{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class On extends Se{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class fr extends Se{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Lr extends Se{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class or extends Se{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Yn extends Se{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ke extends Se{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class He extends Se{getDefault(){return null}set(l){this.gl&&(l!==this.current||this.dirty)&&(this.gl.bindVertexArray(l),this.current=l,this.dirty=!1)}}class lt extends Se{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Ke extends Se{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class st extends Se{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class zt extends Se{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class ln extends zt{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Ht extends zt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class vn extends zt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachment(),f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Fn extends Ht{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class pr{constructor(l,f,y,b,T){this.context=l,this.width=f,this.height=y;const S=this.framebuffer=l.gl.createFramebuffer();b&&(this.colorAttachment=new ln(l,S)),T&&(this.depthAttachmentType=T,this.depthAttachment=T==="renderbuffer"?new Ht(l,S):new vn(l,S))}destroy(){const l=this.context.gl;if(this.colorAttachment){const f=this.colorAttachment.get();f&&l.deleteTexture(f)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const f=this.depthAttachment.get();f&&l.deleteRenderbuffer(f)}else{const f=this.depthAttachment.get();f&&l.deleteTexture(f)}l.deleteFramebuffer(this.framebuffer)}}class fi{constructor(l,f){this.gl=l,this.clearColor=new xe(this),this.clearDepth=new wt(this),this.clearStencil=new ft(this),this.colorMask=new Tt(this),this.depthMask=new gt(this),this.stencilMask=new at(this),this.stencilFunc=new bt(this),this.stencilOp=new Zt(this),this.stencilTest=new tt(this),this.depthRange=new Et(this),this.depthTest=new mt(this),this.depthFunc=new Vt(this),this.blend=new Pt(this),this.blendFunc=new pn(this),this.blendColor=new dn(this),this.blendEquation=new yn(this),this.cullFace=new Mt(this),this.cullFaceSide=new cn(this),this.frontFace=new Yt(this),this.program=new Tn(this),this.activeTexture=new xr(this),this.viewport=new On(this),this.bindFramebuffer=new fr(this),this.bindRenderbuffer=new Lr(this),this.bindTexture=new or(this),this.bindVertexBuffer=new Yn(this),this.bindElementBuffer=new ke(this),this.bindVertexArrayOES=new He(this),this.pixelStoreUnpack=new lt(this),this.pixelStoreUnpackPremultiplyAlpha=new Ke(this),this.pixelStoreUnpackFlipY=new st(this),this.options=f?{...f}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=l.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),this.maxPointSize=l.getParameter(l.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f,y){return new a.I(this,l,f,y)}createVertexBuffer(l,f,y,b,T){return new _e(this,l,f,y,b,T)}createRenderbuffer(l,f,y){const b=this.gl,T=b.createRenderbuffer();return this.bindRenderbuffer.set(T),b.renderbufferStorage(b.RENDERBUFFER,l,f,y),this.bindRenderbuffer.set(null),T}createFramebuffer(l,f,y,b){return new pr(this,l,f,y,b)}clear({color:l,depth:f,stencil:y,colorMask:b}){const T=this.gl;let S=0;l&&(S|=T.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set(b||[!0,!0,!0,!0])),f!==void 0&&(S|=T.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),y!==void 0&&(S|=T.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),T.clear(S)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){a.d(l.blendFunction,a.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor),l.blendEquation?this.blendEquation.set(l.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(l.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ir{constructor(l,f,y,b){const T={width:y[0],height:y[1],data:null},S=l.gl;this.targetColorTexture=new a.T(l,T,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new a.T(l,T,S.RGBA,{useMipmap:!1}),this.context=l,this.updateParticleTexture(f,b),this.lastInvalidatedAt=0}updateParticleTexture(l,f){if(this.particleTextureDimension===f.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,b=f.width*f.height;this.particleTexture0=new a.T(this.context,f,y.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,f,y.RGBA,{premultiply:!1,useMipmap:!1});const T=new a.S;T.reserve(b);for(let S=0;S<b;S++)T.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(T,a.p.members,!0),this.particleSegment=a.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=f.width}update(l){return!(this.lastInvalidatedAt<l&&(this.lastInvalidatedAt=a.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Ci extends a.E{constructor(l){super(),this.requestManager=l,this.models={"":{}},this.numModelsLoading={}}loadModel(l,f){return a.l(this.requestManager.transformRequest(f,a.R.Model).url).then(y=>{if(!y)return;const b=a.c(y),T=new a.M(l,void 0,void 0,b);return T.computeBoundsAndApplyParent(),T}).catch(y=>{if(y&&y.status===404)return null;this.fire(new a.f(new Error(`Could not load model ${l} from ${f}: ${y.message}`)))})}load(l,f){this.models[f]||(this.models[f]={});const y=Object.keys(l);this.numModelsLoading[f]=(this.numModelsLoading[f]||0)+y.length;const b=[];for(const T of y)b.push(this.loadModel(T,l[T]));Promise.allSettled(b).then(T=>{for(let S=0;S<T.length;S++){const{status:A,value:O}=T[S];A==="fulfilled"&&O&&(this.models[f][y[S]]={model:O,numReferences:1})}this.numModelsLoading[f]-=y.length,this.fire(new a.g("data",{dataType:"style"}))}).catch(T=>{this.fire(new a.f(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const l in this.numModelsLoading)if(this.numModelsLoading[l]>0)return!1;return!0}hasModel(l,f){return!!this.getModel(l,f)}getModel(l,f){return this.models[f]||(this.models[f]={}),this.models[f][l]?this.models[f][l].model:void 0}addModel(l,f,y){this.models[y]||(this.models[y]={}),this.hasModel(l,y)&&this.models[y][l].numReferences++,this.load({[l]:this.requestManager.normalizeModelURL(f)},y)}addModels(l,f){this.models[f]||(this.models[f]={});const y={};for(const b in l)this.models[f][b]={},y[b]=this.requestManager.normalizeModelURL(l[b]);this.load(y,f)}addModelsFromBucket(l,f){this.models[f]||(this.models[f]={});const y={};for(const b of l)this.hasModel(b,f)?this.models[f][b].numReferences++:y[b]=this.requestManager.normalizeModelURL(b);this.load(y,f)}removeModel(l,f){if(this.models[f]&&this.models[f][l]&&(this.models[f][l].numReferences--,this.models[f][l].numReferences===0)){const y=this.models[f][l].model;delete this.models[f][l],y.destroy()}}listModels(l){return this.models[l]||(this.models[l]={}),Object.keys(this.models[l])}upload(l,f){this.models[f]||(this.models[f]={});for(const y in this.models[f])this.models[f][y].model&&this.models[f][y].model.upload(l.context)}}function is(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class An extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(l){this.images[l]={},this.loaded[l]=!1,this.updatedImages[l]={},this.patterns[l]={},this.callbackDispatchedThisFrame[l]={},this.atlasImage[l]=new a.j({width:1,height:1})}isLoaded(){for(const l in this.loaded)if(!this.loaded[l])return!1;return!0}setLoaded(l,f){if(this.loaded[f]!==l&&(this.loaded[f]=l,l)){for(const{ids:y,callback:b}of this.requestors)this._notify(y,f,b);this.requestors=[]}}hasImage(l,f){return!!this.getImage(l,f)}getImage(l,f){return this.images[f][l]}addImage(l,f,y){this._validate(l,y)&&(this.images[f][l]=y)}_validate(l,f){let y=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(f.content,f)||(this.fire(new a.f(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,f){if(!l)return!0;let y=0;for(const b of l){if(b[0]<y||b[1]<b[0]||f<b[1])return!1;y=b[1]}return!0}_validateContent(l,f){return!(l&&(l.length!==4||l[0]<0||f.data.width<l[0]||l[1]<0||f.data.height<l[1]||l[2]<0||f.data.width<l[2]||l[3]<0||f.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,f,y){y.version=this.images[f][l].version+1,this.images[f][l]=y,this.updatedImages[f][l]=!0}removeImage(l,f){const y=this.images[f][l];delete this.images[f][l],delete this.patterns[f][l],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(l){return Object.keys(this.images[l])}getImages(l,f,y){let b=!0;const T=!!this.loaded[f];if(!T)for(const S of l)this.images[f][S]||(b=!1);T||b?this._notify(l,f,y):this.requestors.push({ids:l,scope:f,callback:y})}getUpdatedImages(l){return this.updatedImages[l]}_notify(l,f,y){const b={};for(const T of l){this.images[f][T]||this.fire(new a.g("styleimagemissing",{id:T}));const S=this.images[f][T];S?b[T]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:a.w(`Image "${T}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,b)}getPixelSize(l){const{width:f,height:y}=this.atlasImage[l];return{width:f,height:y}}getPattern(l,f,y){const b=this.patterns[f][l],T=this.getImage(l,f);if(!T)return null;if(b&&b.position.version===T.version)return b.position;if(b)b.position.version=T.version;else{const S={w:T.data.width+2,h:T.data.height+2,x:0,y:0},A=new a.m(S,T);this.patterns[f][l]={bin:S,position:A}}return this._updatePatternAtlas(f,y),this.patterns[f][l].position}bind(l,f){const y=l.gl;let b=this.atlasTexture[f];b?this.dirty&&(b.update(this.atlasImage[f]),this.dirty=!1):(b=new a.T(l,this.atlasImage[f],y.RGBA),this.atlasTexture[f]=b),b.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(l,f){const y=[];for(const A in this.patterns[l])y.push(this.patterns[l][A].bin);const{w:b,h:T}=a.k(y),S=this.atlasImage[l];S.resize({width:b||1,height:T||1});for(const A in this.patterns[l]){const{bin:O}=this.patterns[l][A],z=O.x+1,B=O.y+1,V=this.images[l][A].data,W=V.width,X=V.height;a.j.copy(V,S,{x:0,y:0},{x:z,y:B},{width:W,height:X},f),a.j.copy(V,S,{x:0,y:X-1},{x:z,y:B-1},{width:W,height:1},f),a.j.copy(V,S,{x:0,y:0},{x:z,y:B+X},{width:W,height:1},f),a.j.copy(V,S,{x:W-1,y:0},{x:z-1,y:B},{width:1,height:X},f),a.j.copy(V,S,{x:0,y:0},{x:z+W,y:B},{width:1,height:X},f)}this.dirty=!0}beginFrame(){for(const l in this.images)this.callbackDispatchedThisFrame[l]={}}dispatchRenderCallbacks(l,f){for(const y of l){if(this.callbackDispatchedThisFrame[f][y])continue;this.callbackDispatchedThisFrame[f][y]=!0;const b=this.images[f][y];is(b)&&this.updateImage(y,f,b)}}}function ar(g){const l=g.key,f=g.value,y=g.valueSpec||{},b=g.objectElementValidators||{},T=g.style,S=g.styleSpec;let A=[];const O=a.o(f);if(O!=="object")return[new a.V(l,f,`object expected, ${O} found`)];for(const z in f){const B=z.split(".")[0];let V;b[B]?V=b[B]:y[B]?V=Fi:b["*"]?V=b["*"]:y["*"]&&(V=Fi),V?A=A.concat(V({key:(l&&`${l}.`)+z,value:f[z],valueSpec:y[B]||y["*"],style:T,styleSpec:S,object:f,objectKey:z},f)):A.push(new a.n(l,f[z],`unknown property "${z}"`))}for(const z in y)b[z]||y[z].required&&y[z].default===void 0&&f[z]===void 0&&A.push(new a.V(l,f,`missing required property "${z}"`));return A}function mn(g){const l=g.value,f=g.valueSpec,y=g.style,b=g.styleSpec,T=g.key,S=g.arrayElementValidator||Fi;if(a.o(l)!=="array")return[new a.V(T,l,`array expected, ${a.o(l)} found`)];if(f.length&&l.length!==f.length)return[new a.V(T,l,`array length ${f.length} expected, length ${l.length} found`)];if(f["min-length"]&&l.length<f["min-length"])return[new a.V(T,l,`array length at least ${f["min-length"]} expected, length ${l.length} found`)];let A={type:f.value,values:f.values,minimum:f.minimum,maximum:f.maximum,function:void 0};b.$version<7&&(A.function=f.function),a.o(f.value)==="object"&&(A=f.value);let O=[];for(let z=0;z<l.length;z++)O=O.concat(S({array:l,arrayIndex:z,value:l[z],valueSpec:A,style:y,styleSpec:b,key:`${T}[${z}]`},!0));return O}function Js(g){const l=g.key,f=g.value,y=g.valueSpec;let b=a.o(f);if(b==="number"&&f!=f&&(b="NaN"),b!=="number")return[new a.V(l,f,`number expected, ${b} found`)];if("minimum"in y){let T=y.minimum;if(a.o(y.minimum)==="array"&&(T=y.minimum[g.arrayIndex]),f<T)return[new a.V(l,f,`${f} is less than the minimum value ${T}`)]}if("maximum"in y){let T=y.maximum;if(a.o(y.maximum)==="array"&&(T=y.maximum[g.arrayIndex]),f>T)return[new a.V(l,f,`${f} is greater than the maximum value ${T}`)]}return[]}function Ai(g){const l=g.valueSpec,f=a.u(g.value.type);let y,b,T,S={};const A=f!=="categorical"&&g.value.property===void 0,O=!A,z=a.o(g.value.stops)==="array"&&a.o(g.value.stops[0])==="array"&&a.o(g.value.stops[0][0])==="object",B=ar({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(X){if(f==="identity")return[new a.V(X.key,X.value,'identity function may not have a "stops" property')];let se=[];const oe=X.value;return se=se.concat(mn({key:X.key,value:oe,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:V})),a.o(oe)==="array"&&oe.length===0&&se.push(new a.V(X.key,oe,"array must have at least one stop")),se},default:function(X){return Fi({key:X.key,value:X.value,valueSpec:l,style:X.style,styleSpec:X.styleSpec})}}});return f==="identity"&&A&&B.push(new a.V(g.key,g.value,'missing required property "property"')),f==="identity"||g.value.stops||B.push(new a.V(g.key,g.value,'missing required property "stops"')),f==="exponential"&&g.valueSpec.expression&&!a.s(g.valueSpec)&&B.push(new a.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(O&&!a.r(g.valueSpec)?B.push(new a.V(g.key,g.value,"property functions not supported")):A&&!a.t(g.valueSpec)&&B.push(new a.V(g.key,g.value,"zoom functions not supported"))),f!=="categorical"&&!z||g.value.property!==void 0||B.push(new a.V(g.key,g.value,'"property" property is required')),B;function V(X){let se=[];const oe=X.value,ae=X.key;if(a.o(oe)!=="array")return[new a.V(ae,oe,`array expected, ${a.o(oe)} found`)];if(oe.length!==2)return[new a.V(ae,oe,`array length 2 expected, length ${oe.length} found`)];if(z){if(a.o(oe[0])!=="object")return[new a.V(ae,oe,`object expected, ${a.o(oe[0])} found`)];if(oe[0].zoom===void 0)return[new a.V(ae,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new a.V(ae,oe,"object stop key must have value")];const ce=a.u(oe[0].zoom);if(typeof ce!="number")return[new a.V(ae,oe[0].zoom,"stop zoom values must be numbers")];if(T&&T>ce)return[new a.V(ae,oe[0].zoom,"stop zoom values must appear in ascending order")];ce!==T&&(T=ce,b=void 0,S={}),se=se.concat(ar({key:`${ae}[0]`,value:oe[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:Js,value:W}}))}else se=se.concat(W({key:`${ae}[0]`,value:oe[0],valueSpec:{},style:X.style,styleSpec:X.styleSpec},oe));return a.v(a.x(oe[1]))?se.concat([new a.V(`${ae}[1]`,oe[1],"expressions are not allowed in function stops.")]):se.concat(Fi({key:`${ae}[1]`,value:oe[1],valueSpec:l,style:X.style,styleSpec:X.styleSpec}))}function W(X,se){const oe=a.o(X.value),ae=a.u(X.value),ce=X.value!==null?X.value:se;if(y){if(oe!==y)return[new a.V(X.key,ce,`${oe} stop domain type must match previous stop domain type ${y}`)]}else y=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new a.V(X.key,ce,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&f!=="categorical"){let be=`number expected, ${oe} found`;return a.r(l)&&f===void 0&&(be+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(X.key,ce,be)]}return f!=="categorical"||oe!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?f!=="categorical"&&oe==="number"&&typeof ae=="number"&&typeof b=="number"&&b!==void 0&&ae<b?[new a.V(X.key,ce,"stop domain values must appear in ascending order")]:(b=ae,f==="categorical"&&ae in S?[new a.V(X.key,ce,"stop domain values must be unique")]:(S[ae]=!0,[])):[new a.V(X.key,ce,`integer expected, found ${String(ae)}`)]}}function fo(g){const l=(g.expressionContext==="property"?a.y:a.z)(a.x(g.value),g.valueSpec);if(l.result==="error")return l.value.map(y=>new a.V(`${g.key}${y.key}`,g.value,y.message));const f=l.value.expression||l.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!f.outputDefined())return[new a.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!a.A(f))return[new a.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return wa(f,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!a.B(f,["zoom","feature-state"]))return[new a.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!a.D(f))return[new a.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wa(g,l){const f=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(l.valueSpec&&l.valueSpec.expression)for(const b of l.valueSpec.expression.parameters)f.delete(b);if(f.size===0)return[];const y=[];return g instanceof a.F&&f.has(g.name)?[new a.V(l.key,l.value,`["${g.name}"] expression is not supported in a filter for a ${l.object.type} layer with id: ${l.object.id}`)]:(g.eachChild(b=>{y.push(...wa(b,l))}),y)}function rn(g){const l=g.key,f=g.value,y=g.valueSpec,b=[];return Array.isArray(y.values)?y.values.indexOf(a.u(f))===-1&&b.push(new a.V(l,f,`expected one of [${y.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(y.values).indexOf(a.u(f))===-1&&b.push(new a.V(l,f,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(f)} found`)),b}function er(g){return a.H(a.x(g.value))?fo(a.q({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):ti(g)}function ti(g){const l=g.value,f=g.key;if(a.o(l)!=="array")return[new a.V(f,l,`array expected, ${a.o(l)} found`)];const y=g.styleSpec;let b,T=[];if(l.length<1)return[new a.V(f,l,"filter array must have at least 1 element")];switch(T=T.concat(rn({key:`${f}[0]`,value:l[0],valueSpec:y.filter_operator,style:g.style,styleSpec:g.styleSpec})),a.u(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&a.u(l[1])==="$type"&&T.push(new a.V(f,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&T.push(new a.V(f,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(b=a.o(l[1]),b!=="string"&&T.push(new a.V(`${f}[1]`,l[1],`string expected, ${b} found`)));for(let S=2;S<l.length;S++)b=a.o(l[S]),a.u(l[1])==="$type"?T=T.concat(rn({key:`${f}[${S}]`,value:l[S],valueSpec:y.geometry_type,style:g.style,styleSpec:g.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&T.push(new a.V(`${f}[${S}]`,l[S],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let S=1;S<l.length;S++)T=T.concat(ti({key:`${f}[${S}]`,value:l[S],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":b=a.o(l[1]),l.length!==2?T.push(new a.V(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):b!=="string"&&T.push(new a.V(`${f}[1]`,l[1],`string expected, ${b} found`))}return T}function Mi(g,l){const f=g.key,y=g.style,b=g.layer,T=g.styleSpec,S=g.value,A=g.objectKey,O=T[`${l}_${g.layerType}`];if(!O)return[];const z=A.match(/^(.*)-transition$/);if(l==="paint"&&z&&O[z[1]]&&O[z[1]].transition)return Fi({key:f,value:S,valueSpec:T.transition,style:y,styleSpec:T});const B=g.valueSpec||O[A];if(!B)return[new a.n(f,S,`unknown property "${A}"`)];let V;if(a.o(S)==="string"&&a.r(B)&&!B.tokens&&(V=/^{([^}]+)}$/.exec(S))){const X=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new a.V(f,S,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${X}.`)]}const W=[];if(g.layerType==="symbol")A!=="text-field"||!y||y.glyphs||y.imports||W.push(new a.V(f,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&a.J(a.x(S))&&a.u(S.type)==="identity"&&W.push(new a.V(f,S,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&l==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&a.r(B)&&(a.K(B)||a.t(B))){const X=a.y(a.x(S),B),se=X.value.expression||X.value._styleExpression.expression;se&&!a.B(se,["measure-light"])&&(A==="model-emissive-strength"&&a.D(se)&&a.A(se)||W.push(new a.V(f,S,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return W.concat(Fi({key:g.key,value:S,valueSpec:B,style:y,styleSpec:T,expressionContext:"property",propertyType:l,propertyKey:A}))}function Ts(g){return Mi(g,"paint")}function Es(g){return Mi(g,"layout")}function Ls(g){let l=[];const f=g.value,y=g.key,b=g.style,T=g.styleSpec;f.type||f.ref||l.push(new a.V(y,f,'either "type" or "ref" is required'));let S=a.u(f.type);const A=a.u(f.ref);if(f.id){const O=a.u(f.id);for(let z=0;z<g.arrayIndex;z++){const B=b.layers[z];a.u(B.id)===O&&l.push(new a.V(y,f.id,`duplicate layer id "${f.id}", previously used at line ${B.id.__line__}`))}}if("ref"in f){let O;["type","source","source-layer","filter","layout"].forEach(z=>{z in f&&l.push(new a.V(y,f[z],`"${z}" is prohibited for ref layers`))}),b.layers.forEach(z=>{a.u(z.id)===A&&(O=z)}),O?O.ref?l.push(new a.V(y,f.ref,"ref cannot reference another ref layer")):S=a.u(O.type):typeof A=="string"&&l.push(new a.V(y,f.ref,`ref layer "${A}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(f.source){const O=b.sources&&b.sources[f.source],z=O&&a.u(O.type);O?z==="vector"&&S==="raster"?l.push(new a.V(y,f.source,`layer "${f.id}" requires a raster source`)):z==="raster"&&S!=="raster"?l.push(new a.V(y,f.source,`layer "${f.id}" requires a vector source`)):z!=="vector"||f["source-layer"]?z==="raster-dem"&&S!=="hillshade"?l.push(new a.V(y,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!f.paint||!f.paint["line-gradient"]&&!f.paint["line-trim-offset"]||z==="geojson"&&O.lineMetrics?S==="raster-particle"&&z!=="raster-array"&&l.push(new a.V(y,f.source,`layer "${f.id}" requires a 'raster-array' source.`)):l.push(new a.V(y,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new a.V(y,f.source,"raster-array source can only be used with layer type 'raster'.")):l.push(new a.V(y,f,`layer "${f.id}" must specify a "source-layer"`)):l.push(new a.V(y,f.source,`source "${f.source}" not found`))}else l.push(new a.V(y,f,'missing required property "source"'));return l=l.concat(ar({key:y,value:f,valueSpec:T.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fi({key:`${y}.type`,value:f.type,valueSpec:T.layer.type,style:g.style,styleSpec:g.styleSpec,object:f,objectKey:"type"}),filter:O=>er(a.q({layerType:S},O)),layout:O=>ar({layer:f,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":z=>Es(a.q({layerType:S},z))}}),paint:O=>ar({layer:f,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":z=>Ts(a.q({layerType:S,layer:f},z))}})}})),l}function $s(g){const l=g.value,f=g.key,y=a.o(l);return y!=="string"?[new a.V(f,l,`string expected, ${y} found`)]:[]}const Lo={promoteId:function({key:g,value:l}){if(a.o(l)==="string")return $s({key:g,value:l});{const f=[];for(const y in l)f.push(...$s({key:`${g}.${y}`,value:l[y]}));return f}}};function jr(g){const l=g.value,f=g.key,y=g.styleSpec,b=g.style;if(!l.type)return[new a.V(f,l,'"type" is required')];const T=a.u(l.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(T)&&(l.url||l.tiles||S.push(new a.n(f,l,'Either "url" or "tiles" is required.'))),T){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(ar({key:f,value:l,valueSpec:y[`source_${T.replace("-","_")}`],style:g.style,styleSpec:y,objectElementValidators:Lo})),S;case"geojson":if(S=ar({key:f,value:l,valueSpec:y.source_geojson,style:b,styleSpec:y,objectElementValidators:Lo}),l.cluster)for(const A in l.clusterProperties){const[O,z]=l.clusterProperties[A],B=typeof O=="string"?[O,["accumulated"],["get",A]]:O;S.push(...fo({key:`${f}.${A}.map`,value:z,expressionContext:"cluster-map"})),S.push(...fo({key:`${f}.${A}.reduce`,value:B,expressionContext:"cluster-reduce"}))}return S;case"video":return ar({key:f,value:l,valueSpec:y.source_video,style:b,styleSpec:y});case"image":return ar({key:f,value:l,valueSpec:y.source_image,style:b,styleSpec:y});case"canvas":return[new a.V(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rn({key:`${f}.type`,value:l.type,valueSpec:{values:Wa(y)},style:b,styleSpec:y})}}function Wa(g){return g.source.reduce((l,f)=>{const y=g[f];return y.type.type==="enum"&&(l=l.concat(Object.keys(y.type.values))),l},[])}function ni(g){const l=g.value,f=g.styleSpec,y=f.light,b=g.style;let T=[];const S=a.o(l);if(l===void 0)return T;if(S!=="object")return T=T.concat([new a.V("light",l,`object expected, ${S} found`)]),T;for(const A in l){const O=A.match(/^(.*)-transition$/);T=T.concat(O&&y[O[1]]&&y[O[1]].transition?Fi({key:A,value:l[A],valueSpec:f.transition,style:b,styleSpec:f}):y[A]?Fi({key:A,value:l[A],valueSpec:y[A],style:b,styleSpec:f}):[new a.V(A,l[A],`unknown property "${A}"`)])}return T}function xi(g){const l=g.value;let f=[];if(!l)return f;const y=a.o(l);if(y!=="object")return f=f.concat([new a.V("light-3d",l,`object expected, ${y} found`)]),f;const b=g.styleSpec,T=b["light-3d"],S=g.key,A=g.style,O=g.style.lights;for(const V of["type","id"])if(!(V in l))return f=f.concat([new a.V("light-3d",l,`missing property ${V} on light`)]),f;if(l.type&&O)for(let V=0;V<g.arrayIndex;V++){const W=a.u(l.type),X=O[V];a.u(X.type)===W&&f.push(new a.V(S,l.id,`duplicate light type "${l.type}", previously defined at line ${X.id.__line__}`))}const z=`properties_light_${l.type}`;if(!(z in b))return f=f.concat([new a.V("light-3d",l,`Invalid light type ${l.type}`)]),f;const B=b[z];for(const V in l)if(V==="properties"){const W=l[V],X=a.o(W);if(X!=="object")return f=f.concat([new a.V("properties",W,`object expected, ${X} found`)]),f;for(const se in W)f=f.concat(B[se]?Fi({key:se,value:W[se],valueSpec:B[se],style:A,styleSpec:b}):[new a.n(g.key,W[se],`unknown property "${se}"`)])}else{const W=V.match(/^(.*)-transition$/);f=f.concat(W&&T[W[1]]&&T[W[1]].transition?Fi({key:V,value:l[V],valueSpec:b.transition,style:A,styleSpec:b}):T[V]?Fi({key:V,value:l[V],valueSpec:T[V],style:A,styleSpec:b}):[new a.n(V,l[V],`unknown property "${V}"`)])}return f}function Tl(g){const l=g.value,f=g.key,y=g.style,b=g.styleSpec,T=b.terrain;let S=[];const A=a.o(l);if(l===void 0||A==="null")return S;if(A!=="object")return S=S.concat([new a.V("terrain",l,`object expected, ${A} found`)]),S;for(const O in l){const z=O.match(/^(.*)-transition$/);S=S.concat(z&&T[z[1]]&&T[z[1]].transition?Fi({key:O,value:l[O],valueSpec:b.transition,style:y,styleSpec:b}):T[O]?Fi({key:O,value:l[O],valueSpec:T[O],style:y,styleSpec:b}):[new a.n(O,l[O],`unknown property "${O}"`)])}if(l.source){const O=y.sources&&y.sources[l.source],z=O&&a.u(O.type);O?z!=="raster-dem"&&S.push(new a.V(f,l.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):S.push(new a.V(f,l.source,`source "${l.source}" not found`))}else S.push(new a.V(f,l,'terrain is missing required property "source"'));return S}function Ta(g){const l=g.value,f=g.style,y=g.styleSpec,b=y.fog;let T=[];const S=a.o(l);if(l===void 0)return T;if(S!=="object")return T=T.concat([new a.V("fog",l,`object expected, ${S} found`)]),T;for(const A in l){const O=A.match(/^(.*)-transition$/);T=T.concat(O&&b[O[1]]&&b[O[1]].transition?Fi({key:A,value:l[A],valueSpec:y.transition,style:f,styleSpec:y}):b[A]?Fi({key:A,value:l[A],valueSpec:b[A],style:f,styleSpec:y}):[new a.n(A,l[A],`unknown property "${A}"`)])}return T}const po={"*":()=>[],array:mn,boolean:function(g){const l=g.value,f=g.key,y=a.o(l);return y!=="boolean"?[new a.V(f,l,`boolean expected, ${y} found`)]:[]},number:Js,color:function(g){const l=g.key,f=g.value,y=a.o(f);return y!=="string"?[new a.V(l,f,`color expected, ${y} found`)]:a.G(f)===null?[new a.V(l,f,`color expected, "${f}" found`)]:[]},enum:rn,filter:er,function:Ai,layer:Ls,object:ar,source:jr,model:a.L,light:ni,"light-3d":xi,terrain:Tl,fog:Ta,string:$s,formatted:function(g){return $s(g).length===0?[]:fo(g)},resolvedImage:function(g){return $s(g).length===0?[]:fo(g)},projection:function(g){const l=g.value,f=g.styleSpec,y=f.projection,b=g.style;let T=[];const S=a.o(l);if(S==="object")for(const A in l)T=T.concat(Fi({key:A,value:l[A],valueSpec:y[A],style:b,styleSpec:f}));else S!=="string"&&(T=T.concat([new a.V("projection",l,`object or string expected, ${S} found`)]));return T},import:function(g){const{value:l,styleSpec:f}=g,{data:y,...b}=l;Object.defineProperty(b,"__line__",{value:l.__line__,enumerable:!1});let T=ar(a.q({},g,{value:b,valueSpec:f.import}));return a.u(b.id)===""&&T.push(new a.V(`${g.key}.id`,b,"import id can't be an empty string")),y&&(T=T.concat(Ue(y,f,{key:`${g.key}.data`}))),T}};function Fi(g,l=!1){const f=g.value,y=g.valueSpec,b=g.styleSpec;if(y.expression&&a.J(a.u(f)))return Ai(g);if(y.expression&&a.v(a.x(f)))return fo(g);if(y.type&&po[y.type]){const T=po[y.type](g);return l===!0&&T.length>0&&a.o(g.value)==="array"?fo(g):T}return ar(a.q({},g,{valueSpec:y.type?b[y.type]:y}))}function Xu(g){const l=g.value,f=g.key,y=$s(g);return y.length||(l.indexOf("{fontstack}")===-1&&y.push(new a.V(f,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&y.push(new a.V(f,l,'"glyphs" url must include a "{range}" token'))),y}function Ue(g,l=a.N,f={}){return Fi({key:f.key||"",value:g,valueSpec:l.$root,styleSpec:l,style:g,objectElementValidators:{glyphs:Xu,"*":()=>[]}})}function ne(g,l=a.N){return Xt(Ue(g,l))}const le=g=>Xt(jr(g)),Te=g=>Xt(ni(g)),Le=g=>Xt(xi(g)),De=g=>Xt(Tl(g)),Ge=g=>Xt(Ta(g)),it=g=>Xt(Ls(g)),qe=g=>Xt(er(g)),nt=g=>Xt(Ts(g)),St=g=>Xt(Es(g)),It=g=>Xt(a.L(g));function Xt(g){return g.slice().sort((l,f)=>l.line&&f.line?l.line-f.line:0)}function _n(g,l){let f=!1;if(l&&l.length)for(const y of l)y instanceof a.n?a.w(y.message):(g.fire(new a.f(new Error(y.message))),f=!0);return f}let Cn;class lr extends a.E{constructor(l,f="flat"){super(),this._transitionable=new a.O(Cn||(Cn=new a.U({anchor:new a.W(a.N.light.anchor),position:new a.X(a.N.light.position),color:new a.W(a.N.light.color),intensity:new a.W(a.N.light.intensity)}))),this.setLight(l,f),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f,y={}){this._validate(Te,l,y)||(this._transitionable.setTransitionOrValue(l),this.id=f)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,y){return(!y||y.validate!==!1)&&_n(this,l.call(ne,a.Q({value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}const Mn=new a.U({source:new a.W(a.N.terrain.source),exaggeration:new a.W(a.N.terrain.exaggeration)});let cr=class extends a.E{constructor(g,l,f,y){super(),this.scope=f,this._transitionable=new a.O(Mn,f,y),this._transitionable.setTransitionOrValue(g,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g,l){this._transitionable.setTransitionOrValue(g,l)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new a.Y(g)).get("exaggeration")}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof a.Z}};const un=45,Zr=65,_r=.05;function ur(g,l,f,y){const b=a.a0(un,Zr,f),[T,S]=pi(g,y);let A=1-Math.min(1,Math.exp((l-T)/(S-T)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*b*g.alpha}function pi(g,l){const f=.5/Math.tan(.5*l);return[g.range[0]+f,g.range[1]+f]}function mi(g,l,f,y,b){const T=a.$.transformMat4([],[l,f,y],b.mercatorFogMatrix);return ur(g,a.$.length(T),b.pitch,b._fov)}function Gi(g,l,f,y,b,T,S){const A=[[f,y,0],[b,y,0],[b,T,0],[f,T,0]];let O=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const B of A){const V=a.$.transformMat4([],B,l),W=a.$.length(V);O=Math.min(O,W),z=Math.max(z,W)}return[ur(g,O,S.pitch,S._fov),ur(g,z,S.pitch,S._fov)]}const Ss=new a.U({range:new a.W(a.N.fog.range),color:new a.W(a.N.fog.color),"high-color":new a.W(a.N.fog["high-color"]),"space-color":new a.W(a.N.fog["space-color"]),"horizon-blend":new a.W(a.N.fog["horizon-blend"]),"star-intensity":new a.W(a.N.fog["star-intensity"]),"vertical-range":new a.W(a.N.fog["vertical-range"])});class qs extends a.E{constructor(l,f,y,b){super(),this._transitionable=new a.O(Ss,y,new Map(b)),this.set(l,b),this._transitioning=this._transitionable.untransitioned(),this._transform=f,this.properties=new a.a1(Ss),this.scope=y}get state(){const l=this._transform,f=l.projection.name==="globe",y=a.a2(l.zoom),b=this.properties.get("range"),T=[.5,3];return{range:f?[a.a3(T[0],b[0],y),a.a3(T[1],b[1],y)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,f,y={}){if(this._validate(Ge,l,y))return;const b=a.Q({},l);for(const T of Object.keys(a.N.fog))b[T]===void 0&&(b[T]=a.N.fog[T].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,f)}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.a0(un,Zr,l))*f.a}getOpacityAtLatLng(l,f){return this._transform.projection.supportsFog?function(y,b,T){const S=a._.fromLngLat(b),A=T.elevation?T.elevation.getAtPointOrZero(S):0;return mi(y,S.x,S.y,A,T)}(this.state,l,f):0}getOpacityForTile(l){if(!this._transform.projection.supportsFog)return[1,1];const f=this._transform.calculateFogTileMatrix(l.toUnwrapped());return Gi(this.state,f,0,0,a.a4,a.a4,this._transform)}getOpacityForBounds(l,f,y,b,T){return this._transform.projection.supportsFog?Gi(this.state,l,f,y,b,T,this._transform):[1,1]}getFovAdjustedRange(l){return this._transform.projection.supportsFog?pi(this.state,l):[0,1]}isVisibleOnFrustum(l){if(!this._transform.projection.supportsFog)return!1;const f=[4,5,6,7];for(const y of f){const b=l.points[y];let T;if(b[2]>=0)T=b;else{const S=l.points[y-4];T=a.a5(S,b,S[2]/(S[2]-b[2]))}if(mi(this.state,T[0],T[1],0,this._transform)>=_r)return!0}return!1}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,y){return(!y||y.validate!==!1)&&_n(this,l.call(ne,a.Q({value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.N})))}}class tc extends a.E{constructor(l,f,y,b){super(),this.scope=y,this._options=l,this.properties=new a.a1(f),this._transitionable=new a.O(f,y,new Map(b)),this._transitionable.setTransitionOrValue(l.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(l){this._transitionable.setTransitionOrValue(this._options.properties,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(l,f){this._options=l,this._transitionable.setTransitionOrValue(l.properties,f)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let ad,ld;var Ku=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Dn=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,zo=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ea="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Gc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,cd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,oi=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Wc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,nc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,rc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Jf=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Hc=[];Eo(Ku,Hc),Eo(zo,Hc),Eo(Dn,Hc);const Qu={"_prelude_fog.vertex.glsl":cd,"_prelude_terrain.vertex.glsl":Gc,"_prelude_shadow.vertex.glsl":rc,"_prelude_fog.fragment.glsl":oi,"_prelude_shadow.fragment.glsl":Jf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Wc,"_prelude_raster_particle.glsl":nc},ud={};hr("",Gc),hr(oi,cd),hr(Jf,rc),hr(Wc,""),hr(nc,"");const hd=hr(Dn,zo),ag=Ku;var Zc={background:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:hr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:hr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:hr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:hr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);scaled_pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);scaled_pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:hr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_alignment;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);pos.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);pos.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_alignment;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec4 a_join_normal_inside_polygon;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside_polygon.xy/EXTENT);float isPolygon=a_join_normal_inside_polygon.w;float sideAlignment=abs(isPolygon*u_alignment);p.xy+=(1.0-a_join_normal_inside_polygon.z)*mix(wall_offset*0.5,wall_offset*mix(1.0,0.0,max(u_alignment,0.0)),sideAlignment);p.xy-=a_join_normal_inside_polygon.z*mix(wall_offset*0.5,wall_offset*mix(0.0,1.0,max(u_alignment,0.0)),sideAlignment);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:hr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:hr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:hr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:hr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:hr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:hr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:hr(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);v_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:hr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:hr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depthOcclusion=occlusionFadeMultiSample(projected_point);float depthOcclusionMultplier=mix(occlusion_opacity,1.0,depthOcclusion);out_fade_opacity*=depthOcclusionMultplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:hr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:hr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ea),skyboxGradient:hr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ea),skyboxCapture:hr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:hr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:hr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:hr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:hr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:hr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Eo(g,l){const f=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of f)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=y.split(" ");for(const T of b)l.includes(T)||l.push(T)}}function hr(g,l){const f=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=l.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(z=>{const B=z.split(" ");return B[B.length-1]}),b=[...new Set(b)]);const T={},S=[],A=[];if(g=g.replace(f,(z,B)=>(A.push(B),"")),(l=l.replace(f,(z,B)=>(S.push(B),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...Hc];Eo(g,O),Eo(l,O);for(const z of[...S,...A])Qu[z]||console.error(`Undefined include: ${z}`),ud[z]||(ud[z]=[],Eo(Qu[z],ud[z])),O=[...O,...ud[z]];return{fragmentSource:g=g.replace(y,(z,B,V,W,X)=>(T[X]=!0,B==="define"?`
#ifndef HAS_UNIFORM_u_${X}
in ${V} ${W} ${X};
#else
uniform ${V} ${W} u_${X};
#endif
`:B==="initialize"?`
#ifdef HAS_UNIFORM_u_${X}
    ${V} ${W} ${X} = u_${X};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${V} ${W} ${X};
#endif
`:B==="initialize-attribute"?"":void 0)),vertexSource:l=l.replace(y,(z,B,V,W,X)=>{const se=W==="float"?"vec2":W,oe=X.match(/color/)?"color":se;return B==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${X}
in ${V} ${W} a_${X};
#endif
`:T[X]?B==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${V} ${se} a_${X};
out ${V} ${W} ${X};
#else
uniform ${V} ${W} u_${X};
#endif
`:B==="initialize"?oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${V} ${W} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${oe}(a_${X}, u_${X}_t);
#else
    ${V} ${W} ${X} = u_${X};
#endif
`:B==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    in ${V} ${W} a_${X};
    out ${V} ${W} ${X};
#endif
`:B==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${X} = a_${X};
#endif
`:void 0:B==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
in ${V} ${se} a_${X};
#else
uniform ${V} ${W} u_${X};
#endif
`:B==="define-instanced"?oe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${X}0;
in vec4 a_${X}1;
in vec4 a_${X}2;
in vec4 a_${X}3;
#else
uniform ${V} ${W} u_${X};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${V} ${se} a_${X};
#else
uniform ${V} ${W} u_${X};
#endif
`:B==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${X}
    ${V} ${W} ${X} = a_${X};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${V} ${W} ${X} = a_${X};
#else
    ${V} ${W} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${V} ${W} ${X} = unpack_mix_${oe}(a_${X}, u_${X}_t);
#else
    ${V} ${W} ${X} = u_${X};
#endif
`}),staticAttributes:b,usedDefines:O,vertexIncludes:S,fragmentIncludes:A}}class lg{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,f,y,b,T,S,A,O){this.context=l;let z=this.boundPaintVertexBuffers.length!==b.length;for(let V=0;!z&&V<b.length;V++)this.boundPaintVertexBuffers[V]!==b[V]&&(z=!0);let B=this.boundDynamicVertexBuffers.length!==A.length;for(let V=0;!B&&V<A.length;V++)this.boundDynamicVertexBuffers[V]!==A[V]&&(B=!0);if(!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==y||z||B||this.boundIndexBuffer!==T||this.boundVertexOffset!==S)this.freshBind(f,y,b,T,S,A,O);else{l.bindVertexArrayOES.set(this.vao);for(const V of A)V&&(V.bind(),O&&V.instanceCount&&V.setVertexAttribDivisor(l.gl,f,O));T&&T.dynamicDraw&&T.bind()}}freshBind(l,f,y,b,T,S,A){const O=l.numAttributes,z=this.context,B=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=b,this.boundVertexOffset=T,this.boundDynamicVertexBuffers=S,f.enableAttributes(B,l),f.bind(),f.setVertexAttribPointers(B,l,T);for(const V of y)V.enableAttributes(B,l),V.bind(),V.setVertexAttribPointers(B,l,T);for(const V of S)V&&(V.enableAttributes(B,l),V.bind(),V.setVertexAttribPointers(B,l,T),A&&V.instanceCount&&V.setVertexAttribDivisor(B,l,A));b&&b.bind(),z.currentNumAttributes=O}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function cg(g,l){const f=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new a._(0,y/f).toLngLat().lat,new a._(0,(y+1)/f).toLngLat().lat]}function Xc(g,l,f,y,b,T,S){const A=g.context,O=A.gl,z=f.hillshadeFBO;if(!z)return;g.prepareDrawTile();const B=g.isTileAffectedByFog(l),V=g.getOrCreateProgram("hillshade",{overrideFog:B});A.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,z.colorAttachment.get());const W=((ae,ce,be,we)=>{const ye=be.paint.get("hillshade-shadow-color"),Me=be.paint.get("hillshade-highlight-color"),Ie=be.paint.get("hillshade-accent-color"),Ce=be.paint.get("hillshade-emissive-strength");let Ne=a.ac(be.paint.get("hillshade-illumination-direction"));if(be.paint.get("hillshade-illumination-anchor")==="viewport")Ne-=ae.transform.angle;else if(ae.style&&ae.style.enable3dLights()&&ae.style.directionalLight){const We=ae.style.directionalLight.properties.get("direction"),Be=a.ad(We.x,We.y,We.z);Ne=a.ac(Be[1])}const Fe=!ae.options.moving;return{u_matrix:we||ae.transform.calculateProjMatrix(ce.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:cg(0,ce.tileID),u_light:[be.paint.get("hillshade-exaggeration"),Ne],u_shadow:ye.toRenderColor(be.lut),u_highlight:Me.toRenderColor(be.lut),u_emissive_strength:Ce,u_accent:Ie.toRenderColor(be.lut)}})(g,f,y,g.terrain?l.projMatrix:null);g.uploadCommonUniforms(A,V,l.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:se,tileBoundsSegments:oe}=g.getTileBoundsBuffers(f);V.draw(g,O.TRIANGLES,b,T,S,a.ag.disabled,W,y.id,X,se,oe)}function ug(g,l,f){if(!l.needsDEMTextureUpload)return;const y=g.context,b=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(f.stride);const T=f.getPixels();l.demTexture?l.demTexture.update(T,{premultiply:!1}):l.demTexture=new a.T(y,T,b.R32F,{premultiply:!1}),l.needsDEMTextureUpload=!1}function c0(g,l,f){const y=g.context,b=y.gl;if(!l.dem)return;const T=l.dem;if(y.activeTexture.set(b.TEXTURE1),ug(g,l,T),!l.demTexture)return;l.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const S=T.dim;y.activeTexture.set(b.TEXTURE0);let A=l.hillshadeFBO;if(!A){const W=new a.T(y,{width:S,height:S,data:null},b.RGBA);W.bind(b.LINEAR,b.CLAMP_TO_EDGE),A=l.hillshadeFBO=y.createFramebuffer(S,S,!0,"renderbuffer"),A.colorAttachment.set(W.texture)}y.bindFramebuffer.set(A.framebuffer),y.viewport.set([0,0,S,S]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:z,tileBoundsSegments:B}=g.getMercatorTileBoundsBuffers(),V=[];g.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(g,b.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,((W,X)=>{const se=X.stride,oe=a.ae.create();return a.ae.ortho(oe,0,a.a4,-a.a4,0,0,1),a.ae.translate(oe,oe,[0,-a.a4,0]),{u_matrix:oe,u_image:1,u_dimension:[se,se],u_zoom:W.overscaledZ}})(l.tileID,T),f.id,O,z,B),l.needsHillshadePrepare=!1}function ep(g,l,f,y,b){const T=function(A,O){if(A)return b(A);if(O){if(g.url&&O.tiles&&g.tiles&&delete g.tiles,O.variants){if(!Array.isArray(O.variants))return b(new Error("variants must be an array"));for(const B of O.variants){if(B==null||typeof B!="object"||B.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(B.capabilities))return b(new Error("capabilities must be an array"));if(B.capabilities.length===1&&B.capabilities[0]==="meshopt"){O=a.Q(O,B);break}}}const z=a.ai(a.Q(O,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);O.vector_layers&&(z.vectorLayers=O.vector_layers,z.vectorLayerIds=z.vectorLayers.map(B=>B.id)),O.raster_layers&&(z.rasterLayers=O.raster_layers,z.rasterLayerIds=z.rasterLayers.map(B=>B.id)),z.tiles=l.canonicalizeTileset(z,g.url),b(null,z)}},S=function(A,O,z){if(!A)return null;if(!O&&!z)return A;z=z||A.worldview_default;const B=Object.values(A.language||{});if(B.length===0)return null;const V=Object.values(A.worldview||{});if(V.length===0)return null;const W=B.every(se=>se===O),X=V.every(se=>se===z);return W&&X?A:O in(A.language_options||{})||z in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null}(g.data,f,y);return S?a.e.frame(()=>T(null,S)):g.url?a.h(l.transformRequest(l.normalizeSourceURL(g.url,null,f,y),a.R.Source),T):a.e.frame(()=>{const{data:A,...O}=g;T(null,O)})}class No{constructor(l,f,y){this.bounds=a.aj.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),y=Math.floor(a.ak(this.bounds.getWest())*f),b=Math.floor(a.al(this.bounds.getNorth())*f),T=Math.ceil(a.ak(this.bounds.getEast())*f),S=Math.ceil(a.al(this.bounds.getSouth())*f);return l.x>=y&&l.x<T&&l.y>=b&&l.y<S}}class So extends a.E{constructor(l,f,y,b){super(),this.id=l,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.Q({type:"raster"},f),a.Q(this,a.ai(f,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._tileJSONRequest=ep(this._options,this.map._requestManager,null,null,(f,y)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new a.f(f)):y&&(a.Q(this,y),y.bounds&&(this.tileBounds=new No(y.bounds,this.minzoom,this.maxzoom)),a.ao(y.tiles),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(f)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,f){const y=a.e.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);l.request=a.i(this.map._requestManager.transformRequest(b,a.R.Tile),(T,S,A,O)=>(delete l.request,l.aborted?(l.state="unloaded",f(null)):T?(l.state="errored",f(T)):S?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:A,expires:O}),l.setTexture(S,this.map.painter),l.state="loaded",a.an(this.dispatcher),void f(null)):f(null)))}abortTile(l,f){l.request&&(l.request.cancel(),delete l.request),f&&f()}unloadTile(l,f){l.texture&&l.texture instanceof a.T?(l.destroy(!0),l.texture&&l.texture instanceof a.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),f&&f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class hg extends a.E{constructor(l,f,y,b){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.Q(this,a.ai(f,["url","scheme","tileSize","promoteId"])),this._options=a.Q({type:"vector"},f),this._collectResourceTiming=!!f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new a.ap}load(l){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map._worldview;this._tileJSONRequest=ep(this._options,this.map._requestManager,f,y,(b,T)=>{this._tileJSONRequest=null,this._loaded=!0,b?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),y&&y.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new a.f(b))):T&&(a.Q(this,T),T.bounds&&(this.tileBounds=new No(T.bounds,this.minzoom,this.maxzoom)),a.ao(T.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),l&&l(b)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=a.am(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(l){this.cancelTileJSONRequest()}serialize(){return a.Q({},this._options)}loadTile(l,f){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),b=this.map._requestManager.transformRequest(y,a.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,S={request:b,data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,lut:T?{image:T.image.clone()}:null,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=f:l.request=l.actor.send("reloadTile",S,A.bind(this));else if(l.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",S,A.bind(this),void 0,!0);else{const O=a.aq.call({deduped:this._deduped},S,(z,B)=>{z||!B?A.call(this,z):(S.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},l.actor&&l.actor.send("loadTile",S,A.bind(this),void 0,!0))},!0);l.request={cancel:O}}function A(O,z){return delete l.request,l.aborted?f(null):O&&O.status!==404?f(O):(z&&z.resourceTiming&&(l.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&l.setExpiryData(z),l.loadVectorData(z,this.map.painter),a.an(this.dispatcher),f(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(l,f){l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Kc=(g,l,f)=>({u_matrix:g,u_image0:0,u_skirt_height:l,u_ground_shadow_factor:f}),Qc=(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:f,u_zoom_transition:b,u_merc_center:T,u_image0:0,u_frustum_tl:S,u_frustum_tr:A,u_frustum_br:O,u_frustum_bl:z,u_globe_pos:B,u_globe_radius:V,u_viewport:W,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9),u_skirt_height:X,u_far_z_cutoff:se});class Yc{constructor(l=0,f=0,y=0,b=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(y)||y<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=y,this.right=b}interpolate(l,f,y){return f.top!=null&&l.top!=null&&(this.top=a.a3(l.top,f.top,y)),f.bottom!=null&&l.bottom!=null&&(this.bottom=a.a3(l.bottom,f.bottom,y)),f.left!=null&&l.left!=null&&(this.left=a.a3(l.left,f.left,y)),f.right!=null&&l.right!=null&&(this.right=a.a3(l.right,f.right,y)),this}getCenter(l,f){const y=a.au((this.left+l-this.right)/2,0,l),b=a.au((this.top+f-this.bottom)/2,0,f);return new a.P(y,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Yc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ta(g,l){const f=a.ax(g,3);a.ae.fromQuat(g,l),a.aA(g,3,f)}function jt(g,l){const f=a.aw.identity([]);return a.aw.rotateZ(f,f,-l),a.aw.rotateX(f,f,-g),f}function ic(g,l){const f=[g[0],g[1],0],y=[l[0],l[1],0];if(a.$.length(f)>=1e-15){const S=a.$.normalize([],f);a.$.scale(y,S,a.$.dot(y,S)),l[0]=y[0],l[1]=y[1]}const b=a.$.cross([],l,g);if(a.$.len(b)<1e-15)return null;const T=Math.atan2(-b[1],b[0]);return jt(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),T)}class dd{constructor(l,f){this.position=l,this.orientation=f}get position(){return this._position}set position(l){if(l){const f=l instanceof a._?l:new a._(l[0],l[1],l[2]);this._renderWorldCopies&&(f.x=a.av(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(l,f){if(this.orientation=null,!this.position)return;const y=this.position,b=this._elevation?this._elevation.getAtPointOrZero(a._.fromLngLat(l)):0,T=a._.fromLngLat(l,b),S=[T.x-y.x,T.y-y.y,T.z-y.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=ic(S,f)}setPitchBearing(l,f){this.orientation=jt(a.ac(l),a.ac(-f))}}class ai{constructor(l,f){this._transform=a.ae.identity([]),this.orientation=f,this.position=l}get mercatorPosition(){const l=this.position;return new a._(l[0],l[1],l[2])}get position(){const l=a.ax(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var f;l&&a.aA(this._transform,3,[(f=l)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||a.aw.identity([]),l&&ta(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,f){this._orientation=jt(l,f),ta(this._transform,this._orientation)}forward(){const l=a.ax(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=a.ax(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=a.ax(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,f){const y=new Float64Array(16);return a.ae.invert(y,this.getWorldToCamera(l,f)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(l,f,y){const b=this.position;a.$.scale(b,b,-l);const T=new Float64Array(16);return a.ae.fromScaling(T,[y,y,y]),a.ae.translate(T,T,b),T[10]*=f,T}getWorldToCamera(l,f){const y=new Float64Array(16),b=new Float64Array(4),T=this.position;return a.aw.conjugate(b,this._orientation),a.$.scale(T,T,-l),a.ae.fromQuat(y,b),a.ae.translate(y,y,T),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=f,y[9]*=f,y[10]*=f,y[11]*=f,y}getCameraToClipPerspective(l,f,y,b){const T=new Float64Array(16);return a.ae.perspective(T,l,f,y,b),T}getCameraToClipOrthographic(l,f,y,b,T,S){const A=new Float64Array(16);return a.ae.ortho(A,l,f,y,b,T,S),A}getDistanceToElevation(l,f=!1){const y=l===0?0:a.ay(l,f?a.az(this.position[1]):this.position[1]),b=this.forward();return(y-this.position[2])/b[2]}clone(){return new ai([...this.position],[...this.orientation])}}const tr={unknown:0,flipRequired:1,flipNotRequired:2},eo=Math.tan(85*Math.PI/180);function Jc(g,l,f,y,b,T,S){const A=a.ae.create();if(f)if(T.name==="globe"){const O=a.aC(b,l);a.ae.multiply(A,A,O)}else{const O=a.aD.invert([],S);A[0]=O[0],A[1]=O[1],A[4]=O[2],A[5]=O[3],y||a.ae.rotateZ(A,A,b.angle)}else a.ae.multiply(A,b.labelPlaneMatrix,g);return A}function Yu(g,l,f,y,b,T,S){const A=Jc(g,l,f,y,b,T,S);return T.name==="globe"&&f||(A[2]=A[6]=A[10]=A[14]=0),A}function Ju(g,l,f,y,b,T,S){if(f){if(T.name==="globe"){const A=Jc(g,l,f,y,b,T,S);return a.ae.invert(A,A),a.ae.multiply(A,g,A),A}{const A=a.ae.clone(g),O=a.ae.identity([]);return O[0]=S[0],O[1]=S[1],O[4]=S[2],O[5]=S[3],a.ae.multiply(A,A,O),y||a.ae.rotateZ(A,A,-b.angle),A}}return b.glCoordMatrix}function mo(g,l,f,y){const b=[g,l,f,1];f?a.aB.transformMat4(b,b,y):tp(b,b,y);const T=b[3];return b[0]/=T,b[1]/=T,b[2]/=T,b}function Hn(g,l){return Math.min(.5+g/l*.5,1.5)}function na(g,l){const f=g[0]/g[3],y=g[1]/g[3];return f>=-l[0]&&f<=l[0]&&y>=-l[1]&&y<=l[1]}function sc(g,l,f,y,b,T,S,A,O,z){const B=f.transform,V=y?g.textSizeData:g.iconSizeData,W=a.aE(V,f.transform.zoom),X=B.projection.name==="globe",se=[256/f.width*2+1,256/f.height*2+1],oe=y?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;oe.clear();let ae=null;X&&(ae=y?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const ce=g.lineVertexArray,be=y?g.text.placedSymbolArray:g.icon.placedSymbolArray,we=f.transform.width/f.transform.height;let ye,Me=!1;for(let Ie=0;Ie<be.length;Ie++){const Ce=be.get(Ie),{numGlyphs:Ne,writingMode:Fe}=Ce;if(Fe!==a.aF.vertical||Me||ye===a.aF.horizontal||(Me=!0),ye=Fe,(Ce.hidden||Fe===a.aF.vertical)&&!Me){Ea(Ne,oe);continue}Me=!1;const We=new a.P(Ce.tileAnchorX,Ce.tileAnchorY);let{x:Be,y:Re,z:et}=B.projection.projectTilePoint(We.x,We.y,z.canonical);if(O){const[$t,Gt,sn]=O(We);Be+=$t,Re+=Gt,et+=sn}const Ye=[Be,Re,et,1];if(a.aB.transformMat4(Ye,Ye,l),!na(Ye,se)){Ea(Ne,oe);continue}const Ve=Ye[3],Ct=Hn(f.transform.getCameraToCenterDistance(B.projection),Ve),_t=a.aG(V,W,Ce),Ze=S?_t/Ct:_t*Ct,ot=mo(Be,Re,et,b);if(ot[3]<=0){Ea(Ne,oe);continue}let je={};const yt=S?null:O,xt=Is(Ce,Ze,!1,A,l,b,T,g.glyphOffsetArray,ce,oe,ae,ot,We,je,we,yt,B.projection,z,S);Me=xt.useVertical,yt&&xt.needsFlipping&&(je={}),(xt.notEnoughRoom||Me||xt.needsFlipping&&Is(Ce,Ze,!0,A,l,b,T,g.glyphOffsetArray,ce,oe,ae,ot,We,je,we,yt,B.projection,z,S).notEnoughRoom)&&Ea(Ne,oe)}y?(g.text.dynamicLayoutVertexBuffer.updateData(oe),ae&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(ae)):(g.icon.dynamicLayoutVertexBuffer.updateData(oe),ae&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(ae))}function eh(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe){const{lineStartIndex:ae,glyphStartIndex:ce,segment:be}=A,we=ce+A.numGlyphs,ye=ae+A.lineLength,Me=l.getoffsetX(ce),Ie=l.getoffsetX(we-1),Ce=lc(g*Me,f,y,b,T,S,be,ae,ye,O,z,B,V,W,!0,X,se,oe);if(!Ce)return null;const Ne=lc(g*Ie,f,y,b,T,S,be,ae,ye,O,z,B,V,W,!0,X,se,oe);return Ne?{first:Ce,last:Ne}:null}function oc(g,l,f,y){return g===a.aF.horizontal&&Math.abs(y)>Math.abs(f)?{useVertical:!0}:g===a.aF.vertical?y>0?{needsFlipping:!0}:null:l!==tr.unknown&&function(b,T){return b===0||Math.abs(T/b)>eo}(f,y)?l===tr.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function Is(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe,ae,ce,be){const we=l/24,ye=g.lineOffsetX*we,Me=g.lineOffsetY*we,{lineStartIndex:Ie,glyphStartIndex:Ce,numGlyphs:Ne,segment:Fe,writingMode:We,flipState:Be}=g,Re=Ie+g.lineLength,et=Ye=>{if(B){const[Ze,ot,je]=Ye.up,yt=z.length;a.aH(B,yt+0,Ze,ot,je),a.aH(B,yt+1,Ze,ot,je),a.aH(B,yt+2,Ze,ot,je),a.aH(B,yt+3,Ze,ot,je)}const[Ve,Ct,_t]=Ye.point;a.aI(z,Ve,Ct,_t,Ye.angle)};if(Ne>1){const Ye=eh(we,A,ye,Me,f,V,W,g,O,T,X,oe,!1,ae,ce,be);if(!Ye)return{notEnoughRoom:!0};if(y&&!f){let[Ve,Ct,_t]=Ye.first.point,[Ze,ot,je]=Ye.last.point;[Ve,Ct]=mo(Ve,Ct,_t,S),[Ze,ot]=mo(Ze,ot,je,S);const yt=oc(We,Be,(Ze-Ve)*se,ot-Ct);if(g.flipState=yt&&yt.needsFlipping?tr.flipRequired:tr.flipNotRequired,yt)return yt}et(Ye.first);for(let Ve=Ce+1;Ve<Ce+Ne-1;Ve++){const Ct=lc(we*A.getoffsetX(Ve),ye,Me,f,V,W,Fe,Ie,Re,O,T,X,oe,!1,!1,ae,ce,be);if(!Ct)return z.length-=4*(Ve-Ce),{notEnoughRoom:!0};et(Ct)}et(Ye.last)}else{if(y&&!f){const Ve=mo(W.x,W.y,0,b),Ct=Ie+Fe+1,_t=new a.P(O.getx(Ct),O.gety(Ct)),Ze=mo(_t.x,_t.y,0,b),ot=Ze[3]>0?Ze:ac(W,_t,Ve,1,b,void 0,ae,ce.canonical),je=oc(We,Be,(ot[0]-Ve[0])*se,ot[1]-Ve[1]);if(g.flipState=je&&je.needsFlipping?tr.flipRequired:tr.flipNotRequired,je)return je}const Ye=lc(we*A.getoffsetX(Ce),ye,Me,f,V,W,Fe,Ie,Re,O,T,X,oe,!1,!1,ae,ce,be);if(!Ye)return{notEnoughRoom:!0};et(Ye)}return{}}function fd(g,l,f,y,b){const{x:T,y:S,z:A}=y.projectTilePoint(g.x,g.y,l);if(!b)return mo(T,S,A,f);const[O,z,B]=b(g);return mo(T+O,S+z,A+B,f)}function ac(g,l,f,y,b,T,S,A){const O=fd(g.sub(l)._unit()._add(g),A,b,S,T);return a.$.sub(O,f,O),a.$.normalize(O,O),a.$.scaleAndAdd(O,f,O,y)}function lc(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe,ae,ce){const be=y?g-l:g+l;let we=be>0?1:-1,ye=0;y&&(we*=-1,ye=Math.PI),we<0&&(ye+=Math.PI);let Me=A+S+(we>0?0:1)|0,Ie=b,Ce=b,Ne=0,Fe=0;const We=Math.abs(be),Be=[],Re=[];let et=T,Ye=et;const Ve=()=>ac(Ye,et,Ce,We-Ne+1,B,W,oe,ae.canonical);for(;Ne+Fe<=We;){if(Me+=we,Me<A||Me>=O)return null;if(Ce=Ie,Ye=et,Be.push(Ce),X&&Re.push(Ye),et=new a.P(z.getx(Me),z.gety(Me)),Ie=V[Me],!Ie){const Gt=fd(et,ae.canonical,B,oe,W);Ie=Gt[3]>0?V[Me]=Gt:Ve()}Ne+=Fe,Fe=a.$.distance(Ce,Ie)}se&&W&&(V[Me]&&(Ie=Ve(),Fe=a.$.distance(Ce,Ie)),V[Me]=Ie);const Ct=(We-Ne)/Fe,_t=et.sub(Ye)._mult(Ct)._add(Ye),Ze=a.$.sub([],Ie,Ce),ot=a.$.scaleAndAdd([],Ce,Ze,Ct);let je=[0,0,1],yt=Ze[0],xt=Ze[1];if(ce&&(je=oe.upVector(ae.canonical,_t.x,_t.y),je[0]!==0||je[1]!==0||je[2]!==1)){const Gt=[je[2],0,-je[0]],sn=a.$.cross([],je,Gt);a.$.normalize(Gt,Gt),a.$.normalize(sn,sn),yt=a.$.dot(Ze,Gt),xt=a.$.dot(Ze,sn)}if(f){const Gt=a.$.cross([],je,Ze);a.$.normalize(Gt,Gt),a.$.scaleAndAdd(ot,ot,Gt,f*we)}const $t=ye+Math.atan2(xt,yt);return Be.push(ot),X&&Re.push(_t),{point:ot,angle:$t,path:Be,tilePath:Re,up:je}}function Ea(g,l){const f=l.length,y=f+4*g;l.resize(y),l.float32.fill(-1/0,4*f,4*y)}function tp(g,l,f){const y=l[0],b=l[1];return g[0]=f[0]*y+f[4]*b+f[12],g[1]=f[1]*y+f[5]*b+f[13],g[3]=f[3]*y+f[7]*b+f[15],g}const th=(g,l,f)=>(1-f)*g+f*l,Ha=g=>g*g*g*g*g;class eu{constructor(l,f,y,b,T,S,A){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=y??0,this._maxPitch=b??60,this.setProjection(S),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new a.aJ(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Yc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ai,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const l=new eu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(l,f=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(l||y)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return a.ai(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=a.aK(this.projectionOptions);const y=this.getProjection(),b=!a.d(f,y);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(l){return this._orthographicProjectionAtLowPitch!==l&&(this._orthographicProjectionAtLowPitch=l,this._calcMatrices(),!0)}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.aK({name:"mercator"});const f=l!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.ay(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.av(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const f=-l*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=a.aD.create(),a.aD.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=a.au(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=a.ac(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(l){this._tileCoverLift!==l&&(this._tileCoverLift=l)}_updateCameraOnTerrain(){const l=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,f=this.elevation&&l===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||l===Number.NEGATIVE_INFINITY&&(!f||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;f||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=l||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let b=0,T=0;for(let S=0;S<f.length;S++){const A=new a.P(f[S][0]*this.width,y+f[S][1]*(this.height-y)),O=l.pointCoordinate(A);if(!O)continue;const z=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);b+=O[3]*z,T+=z}return T===0?NaN:b/T}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const l=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*f,b=this._mercatorZfromZoom(l),T=this._mercatorZfromZoom(this._maxZoom),S=Math.max(b-y,T);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let y;y=l.z<this._camera.position[2]?[f.x,f.y,f.z]:[l.x,l.y,l.z];const b=a.$.length(a.$.sub([],this._camera.position,y));return a.au(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let f=!1;if(l.orientation&&!a.aw.exactEquals(l.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(l.orientation)),l.position){const y=[l.position.x,l.position.y,l.position.z];a.$.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,f=new dd;return f.position=new a._(l[0],l[1],l[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(l){if(!a.aw.length(l))return!1;a.aw.normalize(l,l);const f=a.$.transformQuat([],[0,0,-1],l),y=a.$.transformQuat([],[0,-1,0],l);if(y[2]<0)return!1;const b=ic(f,y);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(l){const f=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;l[2]=a.au(l[2],b/y,b/f),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,y){this._unmodified=!1,this._edgeInsets.interpolate(l,f,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new a.aL(0,l)];if(this.renderWorldCopies){const y=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),T=this.pointCoordinate(new a.P(this.width,this.height)),S=this.pointCoordinate(new a.P(0,this.height)),A=Math.floor(Math.min(y.x,b.x,T.x,S.x)),O=Math.floor(Math.max(y.x,b.x,T.x,S.x)),z=1;for(let B=A-z;B<=O+z;B++)B!==0&&f.push(new a.aL(B,l))}return f}isLODDisabled(l){return(!l||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(l,f,y){let b=[];const T=y!==void 0,S=!T;if(S&&this.zoom<f||T&&y[0]===0&&y[1]===0)return b;const A=new Set,O=(B,V,W,X,se)=>{const oe=a.b2(V,B,W,X,se);A.has(oe)||(b.push(new a.aQ(B,V,W,X,se)),A.add(oe))};for(let B=0;B<l.length;B++){const V=l[B];if(S&&V.canonical.z!==f)continue;const W=V.canonical,X=V.overscaledZ,se=V.wrap,oe=1<<W.z,ae=W.x+1<oe,ce=W.x>0,be=W.y+1<oe,we=W.y>0,ye=V.wrap-(ce?0:1),Me=V.wrap+(ae?0:1),Ie=ce?W.x-1:oe-1,Ce=ae?W.x+1:0;if(T)y[0]<0?(O(X,Me,W.z,Ce,W.y),y[1]<0&&be&&(O(X,se,W.z,W.x,W.y+1),O(X,Me,W.z,Ce,W.y+1)),y[1]>0&&we&&(O(X,se,W.z,W.x,W.y-1),O(X,Me,W.z,Ce,W.y-1))):y[0]>0?(O(X,ye,W.z,Ie,W.y),y[1]<0&&be&&(O(X,se,W.z,W.x,W.y+1),O(X,ye,W.z,Ie,W.y+1)),y[1]>0&&we&&(O(X,se,W.z,W.x,W.y-1),O(X,ye,W.z,Ie,W.y-1))):y[1]<0&&be?O(X,se,W.z,W.x,W.y+1):we&&O(X,se,W.z,W.x,W.y-1);else{const Ne=V.visibleQuadrants;1&Ne&&(O(X,ye,W.z,Ie,W.y),we&&(O(X,se,W.z,W.x,W.y-1),O(X,ye,W.z,Ie,W.y-1))),2&Ne&&(O(X,Me,W.z,Ce,W.y),we&&(O(X,se,W.z,W.x,W.y-1),O(X,Me,W.z,Ce,W.y-1))),4&Ne&&(O(X,ye,W.z,Ie,W.y),be&&(O(X,se,W.z,W.x,W.y+1),O(X,ye,W.z,Ie,W.y+1))),8&Ne&&(O(X,Me,W.z,Ce,W.y),be&&(O(X,se,W.z,W.x,W.y+1),O(X,Me,W.z,Ce,W.y+1)))}}const z=[];for(const B of b)b.some(V=>B.isChildOf(V))||z.push(B);if(b=z.filter(B=>!l.some(V=>!!(B.overscaledZ<f&&V.isChildOf(B))||B.equals(V)||B.isChildOf(V))),S){const B=1<<f,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=[B*V.x,B*V.y],X=4,se=X*X;b=b.filter(oe=>{const ae=oe.canonical.x+.5-W[0],ce=oe.canonical.y+.5-W[1];return ae*ae+ce*ce<se})}return b}coveringTiles(l){let f=this.coveringZoomLevel(l);const y=f,b=this.elevation&&this.elevation.exaggeration(),T=b&&!l.isTerrainDEM,S=this.projection.name==="mercator";if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);const A=this.locationCoordinate(this.center),O=this.center.lat,z=1<<f,B=[z*A.x,z*A.y,0],V=this.projection.name==="globe",W=!V,X=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,W),se=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=z*a.ay(1,this.center.lat),ae=this._camera.position[2]/a.ay(1,this.center.lat),ce=[z*se.x,z*se.y,ae*(W?1:oe)],be=V||b,we=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),ye=this.isLODDisabled(!0)?f:0;let Me;if(this._elevation&&l.isTerrainDEM)Me=1e4*this._elevation.exaggeration();else if(this._elevation){const Ze=this._elevation.getMinMaxForVisibleTiles();Me=Ze?Ze.max:this._centerAltitude}else Me=this._centerAltitude;const Ie=l.isTerrainDEM?-Me:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ce=this.projection.isReprojectedInTileSpace?a.aN(this):1,Ne=Ze=>{const je=new a._(Ze.x+25e-6,Ze.y,Ze.z),yt=new a._(Ze.x,Ze.y+25e-6,Ze.z),xt=Ze.toLngLat(),$t=je.toLngLat(),Gt=yt.toLngLat(),sn=this.locationCoordinate(xt),Kt=this.locationCoordinate($t),En=this.locationCoordinate(Gt),Un=Math.hypot(Kt.x-sn.x,Kt.y-sn.y),In=Math.hypot(En.x-sn.x,En.y-sn.y);return Math.sqrt(Un*In)*Ce/25e-6},Fe=Ze=>{const ot=Me,je=Ie;return{aabb:a.aR(this,z,0,0,0,Ze,je,ot,this.projection),zoom:0,x:0,y:0,minZ:je,maxZ:ot,wrap:Ze,fullyVisible:!1}},We=[];let Be=[];const Re=f,et=l.reparseOverscaled?y:f,Ye=(ae-this._centerAltitude)*oe,Ve=Ze=>{if(!this._elevation||!Ze.tileID||!S)return;const ot=this._elevation.getMinMaxForTile(Ze.tileID),je=Ze.aabb;ot?(je.min[2]=ot.min,je.max[2]=ot.max,je.center[2]=(je.min[2]+je.max[2])/2):(Ze.shouldSplit=_t(Ze),Ze.shouldSplit||(je.min[2]=je.max[2]=je.center[2]=this._centerAltitude))},Ct=(Ze,ot)=>{if(.707*ot<Ze)return 1;const je=ot/Ze;return je/(1.4144271570014144+(Math.pow(1.1,je-1.4144271570014144+1)-1)/(1.1-1)-1)},_t=Ze=>{if(Ze.zoom<ye)return!0;if(Ze.zoom===Re)return!1;if(Ze.shouldSplit!=null)return Ze.shouldSplit;const ot=Ze.aabb.distanceX(ce),je=Ze.aabb.distanceY(ce);let yt=Ye,xt=1;if(V){yt=Ze.aabb.distanceZ(ce);const In=Math.pow(2,Ze.zoom),Gn=a.az((Ze.y+1)/In),dr=a.az(Ze.y/In),Xr=Math.min(Math.max(O,Gn),dr),Nr=a.b6(Xr)/a.b6(O);if(xt=Xr===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Nr/this._mercatorScaleRatio),this.zoom<=a.b3&&Ze.zoom===Re-1&&Nr>=.9)return!0}else if(T&&(yt=Ze.aabb.distanceZ(ce)*oe),this.projection.isReprojectedInTileSpace&&y<=5){const In=Math.pow(2,Ze.zoom),Gn=Ne(new a._((Ze.x+.5)/In,(Ze.y+.5)/In));xt=Gn>.85?1:Gn}if(!S){const In=Math.sqrt(ot*ot+je*je+yt*yt);let Gn=(1<<Re-Ze.zoom)*we*xt;return Gn*=Ct(Math.max(yt,Ye),In),In<Gn}let $t=Number.MAX_VALUE,Gt=0;const sn=Ze.aabb.getCorners(),Kt=[];for(const In of sn){a.$.sub(Kt,In,ce),V||(T?Kt[2]*=oe:Kt[2]=Ye);const Gn=a.$.dot(Kt,this._camera.forward());Gn<$t&&($t=Gn,Gt=Math.abs(Kt[2]))}let En=(1<<Re-Ze.zoom)*we*xt;if(En*=Ct(Math.max(Gt,Ye),$t),$t<En)return!0;const Un=Ze.aabb.closestPoint(B);return Un[0]===B[0]&&Un[1]===B[1]};if(this.renderWorldCopies)for(let Ze=1;Ze<=3;Ze++)We.push(Fe(-Ze)),We.push(Fe(Ze));for(We.push(Fe(0));We.length>0;){const Ze=We.pop(),ot=Ze.x,je=Ze.y;let yt=Ze.fullyVisible;const xt=()=>this.projection.name==="globe"&&(Ze.y===0||Ze.y===(1<<Ze.zoom)-1);if(!yt){let $t=be?Ze.aabb.intersects(X):Ze.aabb.intersectsFlat(X);if($t===0&&xt()){const Gt=new a.aO(Ze.zoom,ot,je);$t=a.aP(this,z,Gt,!0).intersects(X)}if($t===0)continue;yt=$t===2}if(Ze.zoom!==Re&&_t(Ze))for(let $t=0;$t<4;$t++){const Gt=(ot<<1)+$t%2,sn=(je<<1)+($t>>1),Kt={aabb:S?Ze.aabb.quadrant($t):a.aR(this,z,Ze.zoom+1,Gt,sn,Ze.wrap,Ze.minZ,Ze.maxZ,this.projection),zoom:Ze.zoom+1,x:Gt,y:sn,wrap:Ze.wrap,fullyVisible:yt,tileID:void 0,shouldSplit:void 0,minZ:Ze.minZ,maxZ:Ze.maxZ};T&&!V&&(Kt.tileID=new a.aQ(Ze.zoom+1===Re?et:Ze.zoom+1,Ze.wrap,Ze.zoom+1,Gt,sn),Ve(Kt)),We.push(Kt)}else{const $t=Ze.zoom===Re?et:Ze.zoom;if(l.minzoom&&l.minzoom>$t)continue;let Gt=0;if(!yt){let Un=be?Ze.aabb.intersectsPrecise(X):Ze.aabb.intersectsPreciseFlat(X);if(Un===0&&xt()){const In=new a.aO(Ze.zoom,ot,je);Un=a.aP(this,z,In,!0).intersectsPrecise(X)}if(Un===0)continue;if(l.calculateQuadrantVisibility)if(X.containsPoint(Ze.aabb.center))Gt=15;else for(let In=0;In<4;In++)Ze.aabb.quadrant(In).intersects(X)!==0&&(Gt|=1<<In)}const sn=B[0]-(.5+ot+(Ze.wrap<<Ze.zoom))*(1<<f-Ze.zoom),Kt=B[1]-.5-je,En=Ze.tileID?Ze.tileID:new a.aQ($t,Ze.wrap,Ze.zoom,ot,je);l.calculateQuadrantVisibility&&(En.visibleQuadrants=Gt),Be.push({tileID:En,distanceSq:sn*sn+Kt*Kt})}}if(this.fogCullDistSq){const Ze=this.fogCullDistSq,ot=this.horizonLineFromTop();Be=Be.filter(je=>{const yt=[0,0,0,1],xt=[a.a4,a.a4,0,1],$t=this.calculateFogTileMatrix(je.tileID.toUnwrapped());a.aB.transformMat4(yt,yt,$t),a.aB.transformMat4(xt,xt,$t);const Gt=a.aB.min([],yt,xt),sn=a.aB.max([],yt,xt),Kt=a.aS(Gt,sn);if(Kt===0)return!0;let En=!1;const Un=this._elevation;if(Un&&Kt>Ze&&ot!==0){const In=this.calculateProjMatrix(je.tileID.toUnwrapped());let Gn;l.isTerrainDEM||(Gn=Un.getMinMaxForTile(je.tileID)),Gn||(Gn={min:Ie,max:Me});const dr=a.b4(this.rotation),Xr=[dr[0]*a.a4,dr[1]*a.a4,Gn.max];a.$.transformMat4(Xr,Xr,In),En=(1-Xr[1])*this.height*.5<ot}return Kt<Ze||En})}return Be.sort((Ze,ot)=>Ze.distanceSq-ot.distanceSq).map(Ze=>Ze.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const f=a.au(l.lat,-a.aT,a.aT),y=this.projection.project(l.lng,f);return new a.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.ay(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,f){let y,b;const T=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;y=(f.x-T.x)/A,b=(f.y-T.y)/A}else{const A=this.pointCoordinate(f),O=this.pointCoordinate(T);y=A.x-O.x,b=A.y-O.y}const S=this.locationCoordinate(l);this.setLocation(new a._(S.x-y,S.y-b))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,f){const y=f?a.ay(f,l.lat):void 0,b=this.projection.project(l.lng,l.lat);return new a._(b.x,b.y,y)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,f){const y=f??this._centerAltitude,b=[l.x,l.y,0,1],T=[l.x,l.y,1,1];a.aB.transformMat4(b,b,this.pixelMatrixInverse),a.aB.transformMat4(T,T,this.pixelMatrixInverse);const S=T[3];a.aB.scale(b,b,1/b[3]),a.aB.scale(T,T,1/S);const A=b[2],O=T[2];return{p0:b,p1:T,t:A===O?0:(y-A)/(O-A)}}screenPointToMercatorRay(l){const f=[l.x,l.y,0,1],y=[l.x,l.y,1,1];return a.aB.transformMat4(f,f,this.pixelMatrixInverse),a.aB.transformMat4(y,y,this.pixelMatrixInverse),a.aB.scale(f,f,1/f[3]),a.aB.scale(y,y,1/y[3]),f[2]=a.ay(f[2],this._center.lat)*this.worldSize,y[2]=a.ay(y[2],this._center.lat)*this.worldSize,a.aB.scale(f,f,1/this.worldSize),a.aB.scale(y,y,1/this.worldSize),new a.aU([f[0],f[1],f[2]],a.$.normalize([],a.$.sub([],y,f)))}rayIntersectionCoordinate(l){const{p0:f,p1:y,t:b}=l,T=a.ay(f[2],this._center.lat),S=a.ay(y[2],this._center.lat);return new a._(a.a3(f[0],y[0],b)/this.worldSize,a.a3(f[1],y[1],b)/this.worldSize,a.a3(T,S,b))}pointCoordinate(l,f=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,f)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let f=this.projection.pointCoordinate3D(this,l.x,l.y);if(f)return new a._(f[0],f[1],f[2]);let y=0,b=this.horizonLineFromTop();if(l.y>b)return this.pointCoordinate(l);const T=.02*b,S=l.clone();for(let A=0;A<10&&b-y>T;A++){S.y=a.a3(y,b,.66);const O=this.projection.pointCoordinate3D(this,S.x,S.y);O?(b=S.y,f=O):y=S.y}return f?new a._(f[0],f[1],f[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=a.aV)return!this.isPointAboveHorizon(l);const f=this.pointCoordinate(l);return f.y>=0&&f.y<=1}_coordinatePoint(l,f){const y=f&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,b=[l.x*this.worldSize,l.y*this.worldSize,y+l.toAltitude(),1];return a.aB.transformMat4(b,b,this.pixelMatrix),b[3]>0?new a.P(b[0]/b[3],b[1]/b[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:f}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,T=this.pointLocation3D(new a.P(f,l)),S=this.pointLocation3D(new a.P(b,l)),A=this.pointLocation3D(new a.P(b,y)),O=this.pointLocation3D(new a.P(f,y));let z=Math.min(T.lng,S.lng,A.lng,O.lng),B=Math.max(T.lng,S.lng,A.lng,O.lng),V=Math.min(T.lat,S.lat,A.lat,O.lat),W=Math.max(T.lat,S.lat,A.lat,O.lat);const X=Math.pow(2,-this.zoom)/16*270,se=this.projection.name==="globe"?1:4,oe=(ae,ce,be,we,ye)=>{const Me=(ae+be)/2,Ie=(ce+we)/2,Ce=new a.P(Me,Ie),{lng:Ne,lat:Fe}=this.pointLocation3D(Ce),We=Math.max(0,z-Ne,V-Fe,Ne-B,Fe-W);z=Math.min(z,Ne),B=Math.max(B,Ne),V=Math.min(V,Fe),W=Math.max(W,Fe),(ye<se||We>X)&&(oe(ae,ce,Me,Ie,ye+1),oe(Me,Ie,be,we,ye+1))};if(oe(f,l,b,l,1),oe(b,l,b,y,1),oe(b,y,f,y,1),oe(f,y,f,l,1),this.projection.name==="globe"){const[ae,ce]=a.aW(this);ae?(W=90,B=180,z=-180):ce&&(V=-90,B=180,z=-180)}return new a.aj(new a.aJ(z,V),new a.aJ(B,W))}_getBoundsRectangular(l,f){const{top:y,left:b}=this._edgeInsets,T=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,A=new a.P(b,y),O=new a.P(S,y),z=new a.P(S,T),B=new a.P(b,T);let V=this.pointCoordinate(A,l),W=this.pointCoordinate(O,l);const X=this.pointCoordinate(z,f),se=this.pointCoordinate(B,f),oe=(ae,ce)=>(ce.y-ae.y)/(ce.x-ae.x);return V.y>1&&W.y>=0?V=new a._((1-se.y)/oe(se,V)+se.x,1):V.y<0&&W.y<=1&&(V=new a._(-se.y/oe(se,V)+se.x,0)),W.y>1&&V.y>=0?W=new a._((1-X.y)/oe(X,W)+X.x,1):W.y<0&&V.y<=1&&(W=new a._(-X.y/oe(X,W)+X.x,0)),new a.aj().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(se)).extend(this.coordinateLocation(X))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=l.visibleDemTiles.reduce((y,b)=>{if(b.dem){const T=b.dem.tree;y.min=Math.min(y.min,T.minimums[0]),y.max=Math.max(y.max,T.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*l.exaggeration(),f.max*l.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-f*(1-this._horizonShift);return l?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-a.aT,this.maxLat=a.aT,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.ak(this.minLng)*this.tileSize,this.worldMaxX=a.ak(this.maxLng)*this.tileSize,this.worldMinY=a.al(this.maxLat)*this.tileSize,this.worldMaxY=a.al(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,f){return this.projection.createTileMatrix(this,f,l)}calculateDistanceTileData(l){const f=l.key,y=this._distanceTileDataCache;if(y[f])return y[f];const b=l.canonical,T=1/this.height,S=this.cameraWorldSize,A=S/this.zoomScale(b.z),O=(b.x+Math.pow(2,b.z)*l.wrap)*A,z=b.y*A,B=this.point;B.x*=S/this.worldSize,B.y*=S/this.worldSize;const V=this.angle,W=Math.sin(-V),X=-Math.cos(-V);return y[f]={bearing:[W,X],center:[(B.x-O)*T,(B.y-z)*T],scale:A/a.a4*T},y[f]}calculateFogTileMatrix(l){const f=l.key,y=this._fogTileMatrixCache;if(y[f])return y[f];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return a.ae.multiply(b,this.worldToFogMatrix,b),y[f]=new Float32Array(b),y[f]}calculateProjMatrix(l,f=!1,y=!1){const b=l.key;let T;if(T=y?this._expandedProjMatrixCache:f?this._alignedProjMatrixCache:this._projMatrixCache,T[b])return T[b];const S=this.calculatePosMatrix(l,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:f?this.alignedProjMatrix:this.projMatrix,a.ae.multiply(S,A,S),T[b]=new Float32Array(S),T[b]}calculatePixelsToTileUnitsMatrix(l){const f=l.tileID.key,y=this._pixelsToTileUnitsCache;if(y[f])return y[f];const b=a.aX(l,this);return y[f]=b,y[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const l=1/this.worldSize,f=a.ae.fromScaling([],[l,l,l]);return a.ae.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const l=this._elevation;this._updateCameraState();const f=a.ay(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(f),b=this._camera.forward(),T=a.ay(1,this._center.lat);y[2]/=T,b[2]/=T,a.$.normalize(b,b);const S=l.raycast(y,b,l.exaggeration());if(S){const A=a.$.scaleAndAdd([],y,b,S),O=new a._(A[0],A[1],a.ay(A[2],a.az(A[1]))),z=(O.z+a.$.length([O.x-y[0],O.y-y[1],O.z-y[2]*T]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const f=this._elevation,y=a.ay(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(y),T=f.getAtPointOrZero(new a._(...b)),S=this.pixelsPerMeter/this.worldSize*T,A=this._minimumHeightOverTerrain(),O=b[2]-S;if(O<=A)if(O<0||l){const z=this.locationCoordinate(this._center,this._centerAltitude),B=[b[0],b[1],z.z-b[2]],V=a.$.length(B);B[2]-=(A-O)/this._pixelsPerMercatorPixel;const W=a.$.length(B);if(W===0)return;a.$.scale(B,B,V/W*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],z.z*this._pixelsPerMercatorPixel-B[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const W=this.center;return W.lat=a.au(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(W.lng=a.au(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const f=this._unmodified,{x:y,y:b}=this.point;let T=0,S=y,A=b;const O=this.width/2,z=this.height/2,B=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(b-z<B&&(A=B+z),b+z>V&&(A=V-z),V-B<this.height&&(T=Math.max(T,this.height/(V-B)),A=(V+B)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,se=this.worldSize/2-(W+X)/2;S=(y+se+this.worldSize)%this.worldSize-se,S-O<W&&(S=W+O),S+O>X&&(S=X-O),X-W<this.width&&(T=Math.max(T,this.width/(X-W)),S=(X+W)/2)}S===y&&A===b||(this.center=this.unproject(new a.P(S,A))),T&&(this.zoom+=this.scaleZoom(T)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.ay(1,this.center.lat)/a.ay(1,a.b5));const b=a.aY(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const T=this.projection.zAxisUnit==="meters"?y:1,S=this._camera.getWorldToCamera(this.worldSize,T);let A;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-l.x/this.width,O[9]=2*l.y/this.height,this.isOrthographic){let Fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),We=Fe*this.aspect,Be=-We,Re=-Fe;We-=l.x,Be-=l.x,Fe+=l.y,Re+=l.y,A=this._camera.getCameraToClipOrthographic(Be,We,Re,Fe,this._nearZ,this._farZ),((et,Ye,Ve,Ct)=>{for(let _t=0;_t<16;_t++)et[_t]=th(Ye[_t],Ve[_t],Ct)})(A,A,O,Ha(this.pitch>=15?1:this.pitch/15))}else A=O;const z=a.ae.mul([],O,S);let B=a.ae.mul([],A,S);if(this.projection.isReprojectedInTileSpace){const Fe=this.locationCoordinate(this.center),We=a.ae.identity([]);a.ae.translate(We,We,[Fe.x*this.worldSize,Fe.y*this.worldSize,0]),a.ae.multiply(We,We,a.aZ(this)),a.ae.translate(We,We,[-Fe.x*this.worldSize,-Fe.y*this.worldSize,0]),a.ae.multiply(B,B,We),a.ae.multiply(z,z,We),this.inverseAdjustmentMatrix=a.a_(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.ae.scale([],B,[this.worldSize,this.worldSize,this.worldSize/T,1]),this.projMatrix=B,this.invProjMatrix=a.ae.invert(new Float64Array(16),this.projMatrix),f){const Fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Fe[8]=2*-l.x/this.width,Fe[9]=2*l.y/this.height,this.expandedFarZProjMatrix=a.ae.mul([],Fe,S)}else this.expandedFarZProjMatrix=this.projMatrix;const V=a.ae.invert([],A);this.frustumCorners=a.a$.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!f);const W=new Float32Array(16);a.ae.identity(W),a.ae.scale(W,W,[1,-1,1]),a.ae.rotateX(W,W,this._pitch),a.ae.rotateZ(W,W,this.angle);const X=a.ae.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.ae.clone(X);const se=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;X[8]=2*-l.x/this.width,X[9]=2*(l.y+se)/this.height,this.skyboxMatrix=a.ae.multiply(W,X,W);const oe=this.point,ae=oe.x,ce=oe.y,be=this.width%2/2,we=this.height%2/2,ye=Math.cos(this.angle),Me=Math.sin(this.angle),Ie=ae-Math.round(ae)+ye*be+Me*we,Ce=ce-Math.round(ce)+ye*we+Me*be,Ne=new Float64Array(B);if(a.ae.translate(Ne,Ne,[Ie>.5?Ie-1:Ie,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=Ne,B=a.ae.create(),a.ae.scale(B,B,[this.width/2,-this.height/2,1]),a.ae.translate(B,B,[1,-1,0]),this.labelPlaneMatrix=B,B=a.ae.create(),a.ae.scale(B,B,[1,-1,1]),a.ae.translate(B,B,[-1,-1,0]),a.ae.scale(B,B,[2/this.width,2/this.height,1]),this.glCoordMatrix=B,this.pixelMatrix=a.ae.multiply(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},B=a.ae.invert(new Float64Array(16),this.pixelMatrix),!B)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=B,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.b0(this);const Fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.$.transformMat4(Fe,Fe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=B;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,y=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,T=[l,l,f];a.$.scale(T,T,b),a.$.scale(y,y,-1),a.$.multiply(y,y,T);const S=a.ae.create();a.ae.translate(S,S,y),a.ae.scale(S,S,T),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,f,b)}_computeCameraPosition(l){const f=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),b=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-l/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-y[0]*T,b.y/this.worldSize-y[1]*T,l/this.worldSize*this._centerAltitude-y[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],b=l[2];let T=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(T=Math.min((f-y)/b,1)),this._camera.position=a.$.scaleAndAdd([],this._camera.position,l,T),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,f=this._camera.forward(),{pitch:y,bearing:b}=this._camera.getPitchBearing(),T=a.ay(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.ac(this._maxPitch)),A=Math.max((l[2]-T)/Math.cos(y),S),O=this._zoomFromMercatorZ(A);a.$.scaleAndAdd(l,l,f,A),this._pitch=a.au(y,a.ac(this.minPitch),a.ac(this.maxPitch)),this.angle=a.av(b,-Math.PI,Math.PI),this._setZoom(a.au(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a._(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let f=0,y=a.aV,b=0,T=1/0;for(;y-f>1e-6&&y>f;){const S=f+.5*(y-f),A=this.tileSize*Math.pow(2,S),O=this.getCameraToCenterDistance(this.projection,S,A),z=this.scaleZoom(O/(l*this.tileSize)),B=Math.abs(S-z);B<T&&(T=B,b=S),S<z?f=S:y=S}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,f){const y=Math.min(l.x,f.x),b=Math.max(l.x,f.x),T=Math.min(l.y,f.y),S=Math.max(l.y,f.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new a.P(y,T),new a.P(b,S),new a.P(y,S),new a.P(b,T)],O=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const B of A){const V=this.pointRayIntersection(B);if(V.t<0)return!0;const W=this.rayIntersectionCoordinate(V);if(W.x<O||W.y<0||W.x>z||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.b1(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(l,f){const y=a.$.length(a.$.sub([],this._camera.position,l)),b=this._zoomFromMercatorZ(y)+f;return y-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const l=function([f,y,b],T){const S=[f,y,b,1];a.aB.transformMat4(S,S,T);const A=S[3]=Math.max(S[3],1e-6);return S[0]/=A,S[1]/=A,S[2]/=A,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,l))}}getCameraToCenterDistance(l,f=this.zoom,y=this.worldSize){const b=a.aY(l,f,this.width,this.height,1024),T=l.pixelSpaceConversion(this.center.lat,y,b);let S=.5/Math.tan(.5*this._fov)*this.height*T;return this.isOrthographic&&(S=th(1,S,Ha(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.ae.multiply(l,l,this.globeMatrix),l}getFrustum(l){return a.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,this.projection.zAxisUnit==="meters")}}const Cs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},zs=(g,l)=>{if(l>0&&g.terrain&&a.w("Cutoff is currently disabled on terrain"),l<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const f=g.transform,y=Math.max(Math.abs(f._zoom-(g.minCutoffZoom-1)),1),b=f.isLODDisabled(!1)?a.a0(60,45,f.pitch):a.a0(30,15,f.pitch),T=f._farZ-f._nearZ,S=l*f.height,A=((1-(O=b))*f.cameraToCenterDistance+O*(f._farZ+S))*y;var O;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[f._nearZ,f._farZ,(A-f._nearZ)/T,(A-S-f._nearZ)/T]}}},fs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class bi{constructor(l,f){this.aabb=l,this.lastCascade=f}}class ra{add(l,f){const y=this.receivers[l.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],f.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],f.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],f.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],f.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],f.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],f.max[2])):this.receivers[l.key]=new bi(f,null)}clear(){this.receivers={}}get(l){return this.receivers[l.key]}computeRequiredCascades(l,f,y){const b=a.b8.fromPoints(l.points);let T=0;for(const S in this.receivers){const A=this.receivers[S];if(!A||!b.intersectsAabb(A.aabb))continue;A.aabb.min=b.closestPoint(A.aabb.min),A.aabb.max=b.closestPoint(A.aabb.max);const O=A.aabb.getCorners();for(let z=0;z<y.length;z++){let B=!0;for(const V of O){const W=[V[0]*f,V[1]*f,V[2]];if(a.$.transformMat4(W,W,y[z].matrix),W[0]<-1||W[0]>1||W[1]<-1||W[1]>1){B=!1;break}}if(A.lastCascade=z,T=Math.max(T,z),B)break}}return T+1}}class dg{constructor(l){this.painter=l,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ra,this._depthMode=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,l.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),l.tp.registerParameter(fs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),l.tp.registerParameter(fs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),l.tp.registerParameter(fs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),l.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const l of this._cascades)l.texture.destroy(),l.framebuffer.destroy();this._cascades=[]}updateShadowParameters(l,f){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!f||!f.properties)return;const b=f.properties.get("shadow-intensity");if(!f.shadowsEnabled()||b<=0||(this._shadowLayerCount=y.style.order.reduce((se,oe)=>{const ae=y.style._mergedLayers[oe];return se+(ae.hasShadowPass()&&!ae.isHidden(l.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const T=y.context,S=fs.shadowMapResolution,A=fs.shadowMapResolution;if(this._cascades.length===0||fs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let se=0;se<fs.cascadeCount;++se){const oe=y._shadowMapDebug,ae=T.gl,ce=T.createFramebuffer(S,A,oe,"texture"),be=new a.T(T,{width:S,height:A,data:null},ae.DEPTH_COMPONENT);if(ce.depthAttachment.set(be.texture),oe){const we=new a.T(T,{width:S,height:A,data:null},ae.RGBA);ce.colorAttachment.set(we.texture)}this._cascades.push({framebuffer:ce,texture:be,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.aM,scale:0})}}this.shadowDirection=Fo(f);let O=0;if(l.elevation){const se=l.elevation,oe=[1e4,-1e4];se.visibleDemTiles.filter(ae=>ae.dem).forEach(ae=>{const ce=ae.dem.tree;oe[0]=Math.min(oe[0],ce.minimums[0]),oe[1]=Math.max(oe[1],ce.maximums[0])}),oe[0]!==1e4&&(O=(oe[1]-oe[0])*se.exaggeration())}const z=1.5*l.cameraToCenterDistance,B=3*z,V=new Float64Array(16);for(let se=0;se<this._cascades.length;++se){const oe=this._cascades[se];let ae=l.height/50,ce=1;fs.cascadeCount===1?ce=B:se===0?ce=z:(ae=z,ce=B);const[be,we]=pd(l,this.shadowDirection,ae,ce,fs.shadowMapResolution,O);oe.scale=l.scale,oe.matrix=be,oe.boundingSphereRadius=we,a.ae.invert(V,oe.matrix),oe.frustum=a.aM.fromInvProjectionMatrix(V,1,0,!0),oe.far=ce}const W=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[W].far,this._cascades[W].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/fs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=fs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Cs.ShadowMap0,this._uniformValues.u_shadowmap_1=Cs.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const X=y.transform.elevation;for(const se of this._groundShadowTiles){let oe={min:0,max:0};if(X){const ae=X.getMinMaxForTile(se);ae&&(oe=ae)}this.addShadowReceiver(se.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(l){this._enabled=l}drawShadowPass(l,f){if(!this.enabled)return;const y=this.painter,b=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),b.viewport.set([0,0,fs.shadowMapResolution,fs.shadowMapResolution]);for(let T=0;T<this._numCascadesToRender;++T){y.currentShadowCascade=T,b.bindFramebuffer.set(this._cascades[T].framebuffer.framebuffer),b.clear({color:a.C.white,depth:1});for(const S of l.order){const A=l._mergedLayers[S];if(!A.hasShadowPass()||A.isHidden(y.transform.zoom))continue;const O=l.getLayerSourceCache(A),z=O?f[O.id]:void 0;(A.type==="model"||z&&z.length)&&y.renderLayer(y,O,A,z)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const l=this.painter,f=l.style,y=l.context,b=f.directionalLight,T=f.ambientLight;if(!b||!T)return;const S=[],A=zs(l,l.longestCutoffRange);A.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const O=tu(f,b,T),z=new a.af(y.gl.LEQUAL,a.af.ReadOnly,l.depthRangeFor3D);for(const B of this._groundShadowTiles){const V=B.toUnwrapped(),W=l.isTileAffectedByFog(B),X=l.getOrCreateProgram("groundShadow",{defines:S,overrideFog:W});this.setupShadows(V,X),l.uploadCommonUniforms(y,X,V,null,A);const se={u_matrix:l.transform.calculateProjMatrix(V),u_ground_shadow_factor:O};X.draw(l,y.gl.TRIANGLES,z,a.ah.disabled,a.a.multiply,a.ag.disabled,se,"ground_shadow",l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments,{},l.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?a.a.unblended:a.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(l){const f=this.painter.transform,y=f.calculatePosMatrix(l,f.worldSize);return a.ae.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(l){return a.ae.multiply(l,this._cascades[this.painter.currentShadowCascade].matrix,l),Float32Array.from(l)}setupShadows(l,f,y,b=0){if(!this.enabled)return;const T=this.painter.transform,S=this.painter.context,A=S.gl,O=this._uniformValues,z=new Float64Array(16),B=T.calculatePosMatrix(l,T.worldSize);for(let V=0;V<this._cascades.length;V++)a.ae.multiply(z,this._cascades[V].matrix,B),O[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),S.activeTexture.set(A.TEXTURE0+Cs.ShadowMap0+V),this._cascades[V].texture.bind(A.NEAREST,A.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const V=a.b7(l.canonical),W=2/T.tileSize*a.a4/fs.shadowMapResolution,X=W*this._cascades[0].boundingSphereRadius,se=W*this._cascades[this._cascades.length-1].boundingSphereRadius,oe=(y==="vector-tile"?1:3)/Math.pow(2,b-l.canonical.z-(1-T.zoom+Math.floor(T.zoom)));O.u_shadow_normal_offset=[V,X*oe,se*oe],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(S,O)}setupShadowsFromMatrix(l,f,y=!1){if(!this.enabled)return;const b=this.painter.context,T=b.gl,S=this._uniformValues,A=new Float64Array(16);for(let O=0;O<fs.cascadeCount;O++)a.ae.multiply(A,this._cascades[O].matrix,l),S[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),b.activeTexture.set(T.TEXTURE0+Cs.ShadowMap0+O),this._cascades[O].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=y,y){const O=fs.normalOffset;S.u_shadow_normal_offset=[1,O,O],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(b,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(l,f,y,b){if(b[2]>=0)return{};const T=function(O,z,B){const V=B/(1<<O.canonical.z);return new a.b8([O.canonical.x*V+O.wrap*B,O.canonical.y*V+O.wrap*B,0],[(O.canonical.x+1)*V+O.wrap*B,(O.canonical.y+1)*V+O.wrap*B,z])}(l,f,y).getCorners(),S=f/-b[2];b[0]<0?(a.$.add(T[0],T[0],[b[0]*S,0,0]),a.$.add(T[3],T[3],[b[0]*S,0,0])):b[0]>0&&(a.$.add(T[1],T[1],[b[0]*S,0,0]),a.$.add(T[2],T[2],[b[0]*S,0,0])),b[1]<0?(a.$.add(T[0],T[0],[0,b[1]*S,0]),a.$.add(T[1],T[1],[0,b[1]*S,0])):b[1]>0&&(a.$.add(T[2],T[2],[0,b[1]*S,0]),a.$.add(T[3],T[3],[0,b[1]*S,0]));const A={};return A.vertices=T,A.planes=[cc(T[1],T[0],T[4]),cc(T[2],T[1],T[5]),cc(T[3],T[2],T[6]),cc(T[0],T[3],T[7])],A}addShadowReceiver(l,f,y){this._receivers.add(l,a.b8.fromTileIdAndHeight(l,f,y))}getMaxCascadeForTile(l){const f=this._receivers.get(l);return f&&f.lastCascade?f.lastCascade:0}}function cc(g,l,f){const y=a.$.sub([],f,l),b=a.$.sub([],g,l),T=a.$.cross([],y,b),S=a.$.length(T);return S===0?[0,0,1,0]:(a.$.scale(T,T,1/S),[T[0],T[1],T[2],-a.$.dot(T,l)])}function Fo(g){const l=g.properties.get("direction"),f=a.ad(l.x,l.y,l.z);f[2]=a.au(f[2],0,75);const y=a.b9([f[0],f[1],f[2]]);return a.$.fromValues(y.x,y.y,y.z)}function tu(g,l,f){const y=l.properties.get("color"),b=l.properties.get("intensity"),T=l.properties.get("direction"),S=[T.x,T.y,T.z],A=f.properties.get("color"),O=f.properties.get("intensity"),z=Math.max(a.$.dot([0,0,1],S),0),B=[0,0,0];a.$.scale(B,A.toRenderColor(g.getLut(l.scope)).toArray01Linear().slice(0,3),O);const V=[0,0,0];return a.$.scale(V,y.toRenderColor(g.getLut(f.scope)).toArray01Linear().slice(0,3),z*b),a.ba([B[0]>0?B[0]/(B[0]+V[0]):0,B[1]>0?B[1]/(B[1]+V[1]):0,B[2]>0?B[2]/(B[2]+V[2]):0])}function pd(g,l,f,y,b,T){const S=g.zoom,A=g.scale,O=g.worldSize,z=1/O,B=g.aspect,V=Math.sqrt(1+B*B)*Math.tan(.5*g.fovX),W=V*V,X=y-f,se=y+f;let oe,ae;W>X/se?(oe=y,ae=y*V):(oe=.5*se*(1+W),ae=.5*Math.sqrt(X*X+2*(y*y+f*f)*W+se*se*W*W));const ce=g.projection.pixelsPerMeter(g.center.lat,O),be=g._camera.getCameraToWorldMercator(),we=[0,0,-oe*z];a.$.transformMat4(we,we,be);let ye=ae*z;const Me=g._edgeInsets;if(!(Me.left===0&&Me.top===0&&Me.right===0&&Me.bottom===0||Me.left===Me.right&&Me.top===Me.bottom)){const yt=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?ce:1),xt=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,f,y);xt[8]=2*-g.centerOffset.x/g.width,xt[9]=2*g.centerOffset.y/g.height;const $t=new Float64Array(16);a.ae.mul($t,xt,yt);const Gt=new Float64Array(16);a.ae.invert(Gt,$t);const sn=a.aM.fromInvProjectionMatrix(Gt,O,S,!0);for(const Kt of sn.points){const En=((Ie=Kt)[0]/=A,Ie[1]/=A,Ie[2]=a.ay(Ie[2],g._center.lat),Ie);ye=Math.max(ye,a.$.len(a.$.subtract([],we,En)))}}var Ie;ye*=b/(b-1);const Ce=Math.acos(l[2]),Ne=Math.atan2(-l[0],-l[1]),Fe=new ai;Fe.position=we,Fe.setPitchBearing(Ce,Ne);const We=Fe.getWorldToCamera(O,ce),Be=ye*O,Re=Math.min(g._mercatorZfromZoom(17)*O*-2,-2*Be),et=Fe.getCameraToClipOrthographic(-Be,Be,-Be,Be,Re,(Be+T*ce)/l[2]),Ye=new Float64Array(16);a.ae.multiply(Ye,et,We);const Ve=a.$.fromValues(Math.floor(1e6*we[0])/1e6*O,Math.floor(1e6*we[1])/1e6*O,0),Ct=.5*b,_t=[0,0,0];a.$.transformMat4(_t,Ve,Ye),a.$.scale(_t,_t,Ct);const Ze=[Math.floor(_t[0]),Math.floor(_t[1]),Math.floor(_t[2])],ot=[0,0,0];a.$.sub(ot,_t,Ze),a.$.scale(ot,ot,-1/Ct);const je=new Float64Array(16);return a.ae.identity(je),a.ae.translate(je,je,ot),a.ae.multiply(Ye,je,Ye),[Ye,Be]}function nu(g,l){return g!=null&&l!=null&&!(!g.hasData()||!l.hasData())&&g.demTexture!=null&&l.demTexture!=null&&g.tileID.key!==l.tileID.key}const Za=new class{constructor(){this.operations={}}newMorphing(g,l,f,y,b){if(g in this.operations){const T=this.operations[g];T.to.tileID.key!==f.tileID.key&&(T.queued=f)}else this.operations[g]={startTime:y,phase:0,duration:b,from:l,to:f,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const f=this.operations[l];for(f.phase=(g-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},El={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ss(g,l,f){if(l===0)return 0;const y=l<1&&f===514?.25/l:1;return 6*Math.pow(1.5,22-g)*Math.max(l,1)*y}function ru(g,l){const f=1<<g.z;return!l&&(g.x===0||g.x===f-1)||g.y===0||g.y===f-1}const iu=g=>({u_matrix:g});function Xa(g,l,f,y,b){if(b>0){const T=a.e.now(),S=(T-g.timeAdded)/b,A=l?(T-l.timeAdded)/b:-1,O=f.getSource(),z=y.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),B=!l||Math.abs(l.tileID.overscaledZ-z)>Math.abs(g.tileID.overscaledZ-z),V=B&&g.refreshedUponExpiration?1:a.au(B?S:1-A,0,1);return g.refreshedUponExpiration&&S>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class R extends So{constructor(l,f,y,b){super(l,f,y,b),this.type="raster-array",this.maxzoom=22,this._options=a.Q({type:"raster-array"},f)}triggerRepaint(l){const f=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);f&&f.enabled&&y&&f._clearRenderCacheForTile(y.id,l.tileID),this.map.triggerRepaint()}loadTile(l,f){const y=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(y,a.R.Tile);l.requestParams=b,l.actor||(l.actor=this.dispatcher.getActor()),l.request=l.fetchHeader(void 0,(T,S,A,O)=>{if(delete l.request,l.aborted)return l.state="unloaded",f(null);if(T)return T.code===20?void 0:(l.state="errored",f(T));this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:A,expires:O}),l.state="empty",f(null)})}unloadTile(l,f){const y=l.texture;y&&y instanceof a.T?(l.destroy(!0),this.map.painter.saveTileTexture(y)):(l.destroy(),l.flushQueues(),l._isHeaderLoaded=!1,delete l._mrt,delete l.textureDescriptor),l.fbo&&(l.fbo.destroy(),delete l.fbo),delete l.request,delete l.requestParams,delete l.neighboringTiles,l.state="unloaded"}prepareTile(l,f,y){l._isHeaderLoaded&&(l.state!=="empty"&&(l.state="reloading"),l.fetchBand(f,y,(b,T)=>{if(b)return l.state="errored",this.fire(new a.f(b)),void this.triggerRepaint(l);T&&(l.setTexture(T,this.map.painter),l.state="loaded",this.triggerRepaint(l))}))}getInitialBand(l){if(!this.rasterLayers)return 0;const f=this.rasterLayers.find(({id:T})=>T===l),y=f&&f.fields,b=y&&y.bands&&y.bands;return b?b[0]:0}getTextureDescriptor(l,f,y){if(!l)return;const b=f.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let T=null;f instanceof a.bm?T=f.paint.get("raster-array-band"):f instanceof a.bn&&(T=f.paint.get("raster-particle-array-band"));const S=T||this.getInitialBand(b);if(S!=null)if(l.textureDescriptor){if(!l.updateNeeded(b,S)||y)return Object.assign({},l.textureDescriptor,{texture:l.texture})}else this.prepareTile(l,b,S)}}const J={vector:hg,raster:So,"raster-dem":class extends So{constructor(g,l,f,y){super(g,l,f,y),this.type="raster-dem",this.maxzoom=22,this._options=a.Q({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const f=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(b,T){b&&(g.state="errored",l(b)),T&&(g.dem=T,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=a.i(this.map._requestManager.transformRequest(f,a.R.Tile),(function(b,T,S,A){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(b)g.state="errored",l(b);else if(T){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:S,expires:A});const O=ImageBitmap&&T instanceof ImageBitmap&&a.bk(),z=1-(T.width-a.bl(T.width))/2;z<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const B=O?T:a.e.getImageData(T,z),V={uid:g.uid,coord:g.tileID,source:this.id,scope:this.scope,rawImageData:B,encoding:this.encoding,padding:z};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",V,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const l=g.canonical,f=Math.pow(2,l.z),y=(l.x-1+f)%f,b=l.x===0?g.wrap-1:g.wrap,T=(l.x+1+f)%f,S=l.x+1===f?g.wrap+1:g.wrap,A={};return A[new a.aQ(g.overscaledZ,b,l.z,y,l.y).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,S,l.z,T,l.y).key]={backfilled:!1},l.y>0&&(A[new a.aQ(g.overscaledZ,b,l.z,y,l.y-1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,S,l.z,T,l.y-1).key]={backfilled:!1}),l.y+1<f&&(A[new a.aQ(g.overscaledZ,b,l.z,y,l.y+1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},A[new a.aQ(g.overscaledZ,S,l.z,T,l.y+1).key]={backfilled:!1}),A}},"raster-array":R,geojson:class extends a.E{constructor(g,l,f,y){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(y),this._data=l.data,this._options=a.Q({},l),this._collectResourceTiming=l.collectResourceTiming,l.maxzoom!==void 0&&(this.maxzoom=l.maxzoom),l.minzoom!==void 0&&(this.minzoom=l.minzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const b=a.a4/this.tileSize;this.workerOptions=a.Q({source:this.id,scope:this.scope,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(l.buffer!==void 0?l.buffer:128)*b,tolerance:(l.tolerance!==void 0?l.tolerance:.375)*b,extent:a.a4,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:l.clusterMaxZoom!==void 0?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:a.a4,radius:(l.clusterRadius!==void 0?l.clusterRadius:50)*b,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter,dynamic:l.dynamic},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new a.f(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new a.f(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const l=new Map;for(const f of this._data.features)l.set(f.id,f);for(const f of g.features)l.set(f.id,f);this._data.features=[...l.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},l),this}getClusterLeaves(g,l,f,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:l,offset:f},y),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.g("dataloading",{dataType:"source"})),this._loaded=!1;const l=a.Q({append:g},this.workerOptions);l.scope=this.scope;const f=this._data;typeof f=="string"?(l.request=this.map._requestManager.transformRequest(a.e.resolveURL(f),a.R.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(f),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(y,b)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new a.f(y));else{const T={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(T.resourceTiming=b.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new a.g("data",T)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const f=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,b=this._partialReload,T={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y?{image:y.image.clone()}:null,scope:this.scope,pixelRatio:a.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:b};g.request=this.actor.send(f,T,(S,A)=>b&&!A?(g.state="loaded",l(null)):(delete g.request,g.destroy(),g.aborted?l(null):S?l(S):(g.loadVectorData(A,this.map.painter,f==="reloadTile"),l(null))),void 0,f==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,l){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.Q({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.bo{constructor(g,l,f,y){super(g,l,f,y),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,a.R.Source).url);a.bp(this.urls,(l,f)=>{this._loaded=!0,l?this.fire(new a.f(l)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new a.f(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(g,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.bo,model:class extends a.E{constructor(g,l,f,y){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=l}load(){const g=[];for(const l in this._options.models){const f=this._options.models[l],y=a.l(this.map._requestManager.transformRequest(f.uri,a.R.Model).url).then(b=>{if(!b)return;const T=a.c(b),S=new a.M(l,f.position,f.orientation,T);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(b=>{this.fire(new a.f(new Error(`Could not load model ${l} from ${f.uri}: ${b.message}`)))});g.push(y)}return Promise.allSettled(g).then(()=>{this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(l=>{this.fire(new a.f(new Error(`Could not load models: ${l.message}`)))})}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,l){}serialize(){return{type:"model"}}},"batched-model":class extends a.E{constructor(g,l,f,y){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=l,this.tiles=this._options.tiles,this.maxzoom=l.maxzoom||19,this.minzoom=l.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=f,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(g){this.map=g,this.load()}load(g){this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=ep(this._options,this.map._requestManager,l,f,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new a.f(y))):b&&(a.Q(this,b),b.bounds&&(this.tileBounds=new No(b.bounds,this.minzoom,this.maxzoom)),a.ao(b.tiles,this.map._requestManager._customAccessToken),this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))),g&&g(y)})}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,l){const f=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(f,a.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=l;else{if(g.buckets){const T=Object.values(g.buckets);for(const S of T)S.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",y,b.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",y,b.bind(this),void 0,!0);function b(T,S){return g.aborted?l(null):T&&T.status!==404?l(T):(S&&(S.resourceTiming&&(g.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&g.setExpiryData(S),g.buckets={...g.buckets,...S.buckets},S.featureIndex&&(g.latestFeatureIndex=S.featureIndex)),g.state="loaded",void l(null))}}serialize(){return a.Q({},this._options)}},canvas:class extends a.bo{constructor(g,l,f,y){super(g,l,f,y),l.coordinates?Array.isArray(l.coordinates)&&l.coordinates.length===4&&!l.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(T=>typeof T!="number"))||this.fire(new a.f(new a.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&typeof l.animate!="boolean"&&this.fire(new a.f(new a.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?typeof l.canvas=="string"||l.canvas instanceof HTMLCanvasElement||this.fire(new a.f(new a.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.f(new a.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=l.animate===void 0||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.f(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const l=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof a.bq||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends a.E{constructor(g,l,f,y){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=l,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.f(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.f(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new No(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),a.Q(this,a.ai(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.ai(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.g("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new a.g("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:f,z:y}=g.canonical;return this._implementation.hasTile({x:l,y:f,z:y})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:f,y,z:b}=g.tileID.canonical,T=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:f,y,z:b},{signal:T.signal})).then((function(S){return delete g.request,g.aborted?(g.state="unloaded",l(null)):S===void 0?(g.state="errored",l(null)):S===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement}(S)?(this.loadTileData(g,S),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(g.state="errored",l(S))}),g.request.cancel=()=>T.abort()}loadTileData(g,l){g.setTexture(l,this.map.painter)}unloadTile(g,l){if(g.texture&&g.texture instanceof a.T?(g.destroy(!0),g.texture&&g.texture instanceof a.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:f,y,z:b}=g.tileID.canonical;this._implementation.unloadTile({x:f,y,z:b})}l&&l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l&&l()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){const g=a.am(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new a.g("data",{dataType:"source",sourceDataType:"content"}))}}},he=function(g,l,f,y){const b=new J[l.type](g,l,f,y);if(b.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${b.id}`);return a.br(["load","abort","unload","serialize","prepare"],b),b};class Oe extends a.bx{constructor(l){const f={type:"raster-dem",maxzoom:l.transform.maxZoom},y=new a.by(a.bz(),null),b=he("mock-dem",f,y,l.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,f){l.state="loaded",f(null)}}class pt extends a.bx{constructor(l){const f=he("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new a.by(a.bz(),null),l.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,f,y){if(l.freezeTileCoverage)return;this.transform=l;const b=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,S)=>{if(T[S.key]="",!this._tiles[S.key]){const A=new a.bA(S,this._source.tileSize*S.overscaleFactor(),l.tileZoom);A.state="loaded",this._tiles[S.key]=A}return T},{});for(const T in this._tiles)T in b||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(l){const f=this.proxyCachedFBO[l];if(f!==void 0){const y=Object.values(f);this.renderCachePool.push(...y),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Dt extends a.aQ{constructor(l,f,y){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=f,this.projMatrix=y}}class tn extends a.bs{constructor(l,f){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},l.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),l.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,b,T]=function(O){const z=new a.bv,B=new a.bw,V=131;z.reserve(17161),B.reserve(33800);const W=a.a4/128,X=a.a4+W/2,se=X+W;for(let ae=-W;ae<se;ae+=W)for(let ce=-W;ce<se;ce+=W){const be=ce<0||ce>X||ae<0||ae>X?24575:0,we=a.au(Math.round(ce),0,a.a4),ye=a.au(Math.round(ae),0,a.a4);z.emplaceBack(we+be,ye)}const oe=(ae,ce)=>{const be=ce*V+ae;B.emplaceBack(be+1,be,be+V),B.emplaceBack(be+V,be+V+1,be+1)};for(let ae=1;ae<129;ae++)for(let ce=1;ce<129;ce++)oe(ce,ae);return[0,129].forEach(ae=>{for(let ce=0;ce<130;ce++)oe(ce,ae),oe(ae,ce)}),[z,B,32768]}(),S=l.context;this.gridBuffer=S.createVertexBuffer(y,a.bt.members),this.gridIndexBuffer=S.createIndexBuffer(b),this.gridSegments=a.b.simpleSegment(0,0,y.length,b.length),this.gridNoSkirtSegments=a.b.simpleSegment(0,0,y.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new pt(f.map),this.orthoMatrix=a.ae.create(),a.ae.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.a4,0,a.a4,0,1);const A=S.gl;this._overlapStencilMode=new a.ah({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Oe(f.map),this._pendingGroundEffectLayers=[]}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),this._style=l,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,f,y){if(l&&l.terrain){this._style!==l&&(this.style=l,this._evaluationZoom=void 0);const b=l.terrain.properties,T=l.terrain.drapeRenderMode===0,S=l.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.e.now();const A=l.terrain&&l.terrain.scope,O=b.get("source"),z=T?this._mockSourceCache:l.getSourceCache(O,A);if(!z)return void a.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=z,this._exaggeration=S?this.calculateExaggeration(f):b.get("exaggeration"),!f.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const B=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(f,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,B(),this._initializing=!0),B(),f.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0,this._previousZoom=f.zoom}else this._disable()}calculateExaggeration(l){const f=this._previousCameraAltitude,y=l.getFreeCameraOptions().position.z/l.pixelsPerMeter*l.worldSize;this._previousCameraAltitude=y;const b=f!=null?y-f:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const T=l.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(T);let A=T-this._previousZoom;const O=this._previousUpdateTimestamp;let z=T;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(T-z)>.5&&(A=.5*(T-z+A)),A*b<0&&(z+=A)),this._evaluationZoom=z;const B=S.getExaggeration(z),V=B===S.getExaggeration(Math.max(0,z-.1));if(V&&Math.abs(B-this._exaggeration)<.01)return B;let W=Math.min(.1,.00375*(this._updateTimestamp-O));return(V||B<.1||Math.abs(A)<1e-4)&&(W=Math.min(.2,4*W)),a.a3(this._exaggeration,B,W)}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(l){l.coord&&l.dataType==="source"?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):l.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._mergedSourceCaches)this._style._mergedSourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(a._.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=f.getIds().map(O=>{const z=f.getTileByID(O).tileID;return z.projMatrix=y.calculateProjMatrix(z.toUnwrapped()),z});(function(O,z){const B=z.transform.pointCoordinate(z.transform.getCameraPoint()),V=new a.P(B.x,B.y);O.sort((W,X)=>{if(X.overscaledZ-W.overscaledZ)return X.overscaledZ-W.overscaledZ;const se=new a.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),oe=new a.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ae=V.mult(1<<W.canonical.z);return ae.x-=.5,ae.y-=.5,ae.distSqr(se)-ae.distSqr(oe)})})(b,this.painter);const T=this.proxyToSource||{};this.proxyToSource={},b.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const O in S){const z=S[O];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,l[O],T),z.usedForTerrain))continue;const B=l[O];z.getSource().reparseOverscaled&&this._assignTerrainTiles(B)}this.proxiedCoords[f.id]=b.map(O=>new Dt(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const z=this.terrainTileForTile[O.key];if(!z)continue;const B=z.tileID.key;B in A||(this._visibleDemTiles.push(z),A[B]=B)}}_assignTerrainTiles(l){this._initializing||l.forEach(f=>{if(this.terrainTileForTile[f.key])return;const y=this._findTileCoveringTileID(f,this.sourceCache);y&&(this.terrainTileForTile[f.key]=y)})}_prepareDEMTextures(){const l=this.painter.context,f=l.gl;for(const y in this.terrainTileForTile){const b=this.terrainTileForTile[y],T=b.dem;!T||b.demTexture&&!b.needsDEMTextureUpload||(l.activeTexture.set(f.TEXTURE1),ug(this.painter,b,T))}}_prepareDemTileUniforms(l,f,y,b){if(!f||f.demTexture==null)return!1;const T=l.tileID.canonical,S=Math.pow(2,f.tileID.canonical.z-T.z),A=b||"";return y[`u_dem_tl${A}`]=[T.x*S%1,T.y*S%1],y[`u_dem_scale${A}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let l=0;const f=this._visibleDemTiles.reduce((y,b)=>{if(!b.dem)return y;const T=b.dem.tree.minimums[0];return T>0&&l++,y+T},0);return l?f/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,f=l.gl;l.activeTexture.set(f.TEXTURE2);const y=this._getLoadedAreaMinimum(),[b,T]=(()=>{const A=new a.bB({width:1,height:1},new Float32Array([y]));return[f.R32F,A]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(T,{premultiply:!1}):S=this._emptyDEMTexture=new a.T(l,T,b,{premultiply:!1}),S}setupElevationDraw(l,f,y){const b=this.painter.context,T=b.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let A=null,O=null,z=1;if(y&&y.morphing&&this._useVertexMorphing){const X=y.morphing.srcDemTile,se=y.morphing.dstDemTile;z=y.morphing.phase,X&&se&&(this._prepareDemTileUniforms(l,X,S,"_prev")&&(O=X),this._prepareDemTileUniforms(l,se,S)&&(A=se))}const B=X=>X&&X.demTexture&&this.painter.linearFloatFilteringSupported()?T.LINEAR:T.NEAREST;let V=null;var W;if(this.enabled?O&&A?(V=A.demTexture,b.activeTexture.set(T.TEXTURE4),O.demTexture.bind(B(O),T.CLAMP_TO_EDGE),S.u_dem_lerp=z):(A=this.terrainTileForTile[l.tileID.key],V=this._prepareDemTileUniforms(l,A,S)?A.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,b.activeTexture.set(T.TEXTURE2),V&&(S.u_dem_size=(W=V).size[0]===1?1:W.size[0]-2,V.bind(B(A),T.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,f,S),y&&y.useMeterToDem&&A){const X=(1<<A.tileID.canonical.z)*a.ay(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=X}if(y&&y.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),f.setTerrainUniformValues(b,S),this.painter.transform.projection.name==="globe"){const X=this.globeUniformValues(this.painter.transform,l.tileID.canonical,y&&y.useDenormalizedUpVectorScale);f.setGlobeUniformValues(b,X)}}globeUniformValues(l,f,y){const b=l.projection;return{u_tile_tl_up:b.upVector(f,0,0),u_tile_tr_up:b.upVector(f,a.a4,0),u_tile_br_up:b.upVector(f,a.a4,a.a4),u_tile_bl_up:b.upVector(f,0,a.a4),u_tile_up_scale:y?a.bu(1):b.upVectorScale(f,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const f=this.painter,y=this.painter.context;l.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,T,S,A,O){if(b.transform.projection.name==="globe")(function(z,B,V,W,X){const se=z.context,oe=se.gl;let ae,ce;const be=z.transform,we=a.bc(z,se,be),ye=(et,Ye)=>{if(ce===Ye)return;const Ve=[El[Ye],"PROJECTION_GLOBE_VIEW"];we&&Ve.push("CUSTOM_ANTIALIASING");const Ct=z.isTileAffectedByFog(et);ae=z.getOrCreateProgram("globeRaster",{defines:Ve,overrideFog:Ct}),ce=Ye},Me=z.colorModeForRenderPass(),Ie=new a.af(oe.LEQUAL,a.af.ReadWrite,z.depthRangeFor3D);Za.update(X);const Ce=a.bd(be),Ne=[a.ak(be.center.lng),a.al(be.center.lat)],Fe=z.globeSharedBuffers,We=[be.width*a.e.devicePixelRatio,be.height*a.e.devicePixelRatio],Be=Float32Array.from(be.globeMatrix),Re={useDenormalizedUpVectorScale:!0};{const et=z.transform,Ye=ss(et.zoom,B.exaggeration(),B.sourceCache._source.tileSize);ce=-1;const Ve=oe.TRIANGLES;for(const Ct of W){const _t=V.getTile(Ct),Ze=a.ah.disabled,ot=B.prevTerrainTileForTile[Ct.key],je=B.terrainTileForTile[Ct.key];nu(ot,je)&&Za.newMorphing(Ct.key,ot,je,X,250),se.activeTexture.set(oe.TEXTURE0),_t.texture&&_t.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const yt=Za.getMorphValuesForProxy(Ct.key),xt=yt?1:0;yt&&a.q(Re,{morphing:{srcDemTile:yt.from,dstDemTile:yt.to,phase:a.bb(yt.phase)}});const $t=a.be(Ct.canonical),Gt=a.bf($t.getCenter().lat),sn=a.bg(Ct.canonical,$t,Gt,et.worldSize/et._pixelsPerMercatorPixel),Kt=a.bh(a.bi(Ct.canonical)),En=Qc(et.expandedFarZProjMatrix,Be,Ce,Kt,a.a2(et.zoom),Ne,et.frustumCorners.TL,et.frustumCorners.TR,et.frustumCorners.BR,et.frustumCorners.BL,et.globeCenterInViewSpace,et.globeRadius,We,Ye,et._farZ,sn);if(ye(Ct,xt),ae&&(B.setupElevationDraw(_t,ae,Re),z.uploadCommonUniforms(se,ae,Ct.toUnwrapped()),Fe)){const[Un,In,Gn]=Fe.getGridBuffers(Gt,Ye!==0);ae.draw(z,Ve,Ie,Ze,Me,a.ag.backCCW,En,"globe_raster",Un,In,Gn)}}}if(Fe&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];we&&et.push("CUSTOM_ANTIALIASING"),ae=z.getOrCreateProgram("globeRaster",{defines:et});for(const Ye of W){const{x:Ve,y:Ct,z:_t}=Ye.canonical,Ze=Ct===0,ot=Ct===(1<<_t)-1,[je,yt,xt,$t]=Fe.getPoleBuffers(_t,!1);if($t&&(Ze||ot)){const Gt=V.getTile(Ye);se.activeTexture.set(oe.TEXTURE0),Gt.texture&&Gt.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let sn=a.bj(_t,Ve,be);const Kt=a.bh(a.bi(Ye.canonical)),En=(Un,In)=>Un.draw(z,oe.TRIANGLES,Ie,a.ah.disabled,Me,a.ag.disabled,Qc(be.expandedFarZProjMatrix,sn,sn,Kt,0,Ne,be.frustumCorners.TL,be.frustumCorners.TR,be.frustumCorners.BR,be.frustumCorners.BL,be.globeCenterInViewSpace,be.globeRadius,We,0,be._farZ),"globe_pole_raster",In,xt,$t);B.setupElevationDraw(Gt,ae,Re),z.uploadCommonUniforms(se,ae,Ye.toUnwrapped()),Ze&&z.renderDefaultNorthPole&&En(ae,je),ot&&z.renderDefaultSouthPole&&(sn=a.ae.scale(a.ae.create(),sn,[1,-1,1]),En(ae,yt))}}}})(b,T,S,A,O);else{const z=b.context,B=z.gl;let V,W;const X=b.shadowRenderer,se=zs(b,b.longestCutoffRange),oe=Me=>{if(W===Me)return;const Ie=[];Ie.push(El[Me]),se.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF"),V=b.getOrCreateProgram("terrainRaster",{defines:Ie}),W=Me},ae=b.colorModeForRenderPass(),ce=new a.af(B.LEQUAL,a.af.ReadWrite,b.depthRangeFor3D);Za.update(O);const be=b.transform,we=ss(be.zoom,T.exaggeration(),T.sourceCache._source.tileSize);let ye=[0,0,0];if(X){const Me=b.style.directionalLight,Ie=b.style.ambientLight;Me&&Ie&&(ye=tu(b.style,Me,Ie))}{W=-1;const Me=B.TRIANGLES,[Ie,Ce]=[T.gridIndexBuffer,T.gridSegments];for(const Ne of A){const Fe=S.getTile(Ne),We=a.ah.disabled,Be=T.prevTerrainTileForTile[Ne.key],Re=T.terrainTileForTile[Ne.key];nu(Be,Re)&&Za.newMorphing(Ne.key,Be,Re,O,250),z.activeTexture.set(B.TEXTURE0),Fe.texture&&Fe.texture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const et=Za.getMorphValuesForProxy(Ne.key),Ye=et?1:0;let Ve;et&&(Ve={morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:a.bb(et.phase)}});const Ct=Kc(Ne.projMatrix,ru(Ne.canonical,be.renderWorldCopies)?we/10:we,ye);if(oe(Ye),!V)continue;T.setupElevationDraw(Fe,V,Ve);const _t=Ne.toUnwrapped();X&&X.setupShadows(_t,V),b.uploadCommonUniforms(z,V,_t,null,se),V.draw(b,Me,ce,We,ae,a.ag.backCCW,Ct,"terrain_raster",T.gridBuffer,Ie,Ce)}}}}(f,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(this._drapedRenderBatches.length===0)return l+1;this.renderingToTexture=!0;const f=this.painter,y=this.painter.context,b=this.proxySourceCache,T=this.proxiedCoords[b.id],S=this._drapedRenderBatches.shift(),A=f.style.order,O=[];let z=0;for(const B of T){const V=b.getTileByID(B.proxyTileKey),W=b.proxyCachedFBO[B.key]?b.proxyCachedFBO[B.key][l]:void 0,X=W!==void 0?b.renderCache[W]:this.pool[z++],se=W!==void 0;if(V.texture=X.tex,se&&!X.dirty){O.push(V.tileID);continue}let oe;y.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(y.clear({color:a.C.transparent,stencil:0}),X.dirty=!1);for(let ae=S.start;ae<=S.end;++ae){const ce=f.style._mergedLayers[A[ae]];if(ce.isHidden(f.transform.zoom))continue;const be=f.style.getLayerSourceCache(ce),we=be?this.proxyToSource[B.key][be.id]:[B];if(!we)continue;const ye=we;y.viewport.set([0,0,X.fb.width,X.fb.height]),oe!==(be?be.id:null)&&(this._setupStencil(X,we,ce,be),oe=be?be.id:null),f.renderLayer(f,be,ce,ye)}if(this._drapedRenderBatches.length===0)for(const ae of this._pendingGroundEffectLayers){const ce=f.style._mergedLayers[A[ae]];if(ce.isHidden(f.transform.zoom))continue;const be=f.style.getLayerSourceCache(ce),we=be?this.proxyToSource[B.key][be.id]:[B];if(!we)continue;const ye=we;y.viewport.set([0,0,X.fb.width,X.fb.height]),oe!==(be?be.id:null)&&(this._setupStencil(X,we,ce,be),oe=be?be.id:null),f.renderLayer(f,be,ce,ye)}this.renderedToTile?(X.dirty=!0,O.push(V.tileID)):se||--z,z===5&&(z=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,f.width,f.height]),S.end+1}postRender(){}isLayerOrderingCorrect(l){const f=l.order.length;let y=-1,b=f;for(let T=0;T<f;++T)this._style.isLayerDraped(l._mergedLayers[l.order[T]])?y=Math.max(y,T):b=Math.min(b,T);return b>y}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{l=Math.min(l,f.dem.tree.minimums[0])}),l===0?l:(l-30)*this._exaggeration}raycast(l,f,y){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const S=T.tileID,A=1<<S.overscaledZ,{x:O,y:z}=S.canonical,B=O/A,V=(O+1)/A,W=z/A,X=(z+1)/A;return{minx:B,miny:W,maxx:V,maxy:X,t:T.dem.tree.raycastRoot(B,W,V,X,l,f,y),tile:T}});b.sort((T,S)=>(T.t!==null?T.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const T of b){if(T.t==null)return null;const S=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,l,f,y);if(S!=null)return S}return null}_createFBO(){const l=this.painter.context,f=l.gl,y=this.drapeBufferSize;l.activeTexture.set(f.TEXTURE0);const b=new a.T(l,{width:y[0],height:y[1],data:null},f.RGBA);b.bind(f.LINEAR,f.CLAMP_TO_EDGE);const T=l.createFramebuffer(y[0],y[1],!0,null);return T.colorAttachment.set(b.texture),T.depthAttachment=new Fn(l,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:T,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const l in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const f=this._style._mergedLayers[l],y=f.isHidden(this.painter.transform.zoom);return f.type==="custom"?!y&&f.shouldRedrape():!y&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const y of this._style.getSources())if(y instanceof hg){l=!0;break}if(!l)return;const f={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(T&&!f[T.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof a.Z){f[T.id]=!0;for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][T.id];if(A)for(const O of A)this._clearRenderCacheForTile(T.id,O)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof So){l=!0;break}if(!l)return;const f={};for(let y=0;y<this._style.order.length;++y){const b=this._style._mergedLayers[this._style.order[y]],T=this._style.getLayerSourceCache(b);if(!T||f[T.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const S=b.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const O=this.proxyToSource[A.key][T.id];if(O)for(const z of O){const B=Xa(T.getTile(z),T.findLoadedParent(z,0),T,this.painter.transform,S);(B.opacity!==1||B.mix!==0)&&this._clearRenderCacheForTile(T.id,z)}}}}_setupDrapedRenderBatches(){const l=this._style.order,f=l.length;if(f===0)return;const y=[];this._pendingGroundEffectLayers=[];let b,T=0,S=this._style._mergedLayers[l[T]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++T<f;)S=this._style._mergedLayers[l[T]];for(;T<f;++T){const A=this._style._mergedLayers[l[T]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?b===void 0&&(b=T):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(T),b!==void 0&&(y.push({start:b,end:T-1}),b=void 0)))}if(b!==void 0&&y.push({start:b,end:T-1}),y.length!==0){const A=y[y.length-1];this._pendingGroundEffectLayers.every(O=>O>A.end)||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(l){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const S=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let A=0;A<S.length;++A){const O=Object.values(S[A]);f.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,b=this._tilesDirty;for(let S=y.length-1;S>=0;S--){const A=y[S];if(f.getTileByID(A.key),f.proxyCachedFBO[A.key]!==void 0){const O=l[A.key],z=this.proxyToSource[A.key];let B=0;for(const V in z){const W=z[V],X=O[V];if(!X||X.length!==W.length||W.some((se,oe)=>se!==X[oe]||b[V]&&b[V].hasOwnProperty(se.key))){B=-1;break}++B}for(const V in f.proxyCachedFBO[A.key])f.renderCache[f.proxyCachedFBO[A.key][V]].dirty=B<0||B!==Object.values(O).length}}const T=[...this._drapedRenderBatches];T.sort((S,A)=>A.end-A.start-(S.end-S.start));for(const S of T)for(const A of y){if(f.proxyCachedFBO[A.key])continue;let O=f.renderCachePool.pop();O===void 0&&f.renderCache.length<50&&(O=f.renderCache.length,f.renderCache.push(this._createFBO())),O!==void 0&&(f.proxyCachedFBO[A.key]={},f.proxyCachedFBO[A.key][S.start]=O,f.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(l,f,y,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,S=T.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let A;if(y.isTileClipped())A=f.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):a.ah.disabled}_renderTileClippingMasks(l,f){const y=this.painter,b=this.painter.context,T=b.gl;y._tileClippingMaskIDs={},b.setColorMode(a.a.disabled),b.setDepthMode(a.af.disabled);const S=y.getOrCreateProgram("clippingMask");for(const A of l){const O=y._tileClippingMaskIDs[A.key]=--f;S.draw(y,T.TRIANGLES,a.af.disabled,new a.ah({func:T.ALWAYS,mask:0},O,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.ag.disabled,iu(A.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(l){const f=this.painter.transform;if(l.x<0||l.x>f.width||l.y<0||l.y>f.height)return null;const y=[l.x,l.y,1,1];a.aB.transformMat4(y,y,f.pixelMatrixInverse),a.aB.scale(y,y,1/y[3]),y[0]/=f.worldSize,y[1]/=f.worldSize;const b=f._camera.position,T=a.ay(1,f.center.lat),S=[b[0],b[1],b[2]/T,0],A=a.$.subtract([],y.slice(0,3),S);a.$.normalize(A,A);const O=this.raycast(S,A,this._exaggeration);return O!==null&&O?(a.$.scaleAndAdd(S,S,A,O),S[3]=S[2],S[2]*=T,S):null}_setupProxiedCoordsForOrtho(l,f,y){if(l.getSource()instanceof a.bo)return this._setupProxiedCoordsForImageSource(l,f,y);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const b=this.proxiedCoords[l.id]=[],T=this.proxyCoords;for(let O=0;O<T.length;O++){const z=T[O],B=this._findTileCoveringTileID(z,l);if(B){const V=this._createProxiedId(z,B,y[z.key]&&y[z.key][l.id]);b.push(V),this.proxyToSource[z.key][l.id]=[V]}}let S=!1;const A=new Set;for(let O=0;O<f.length;O++){const z=l.getTile(f[O]);if(!z||!z.hasData())continue;const B=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==z.tileID.canonical.z){const V=this.proxyToSource[B.tileID.key][l.id],W=this._createProxiedId(B.tileID,z,y[B.tileID.key]&&y[B.tileID.key][l.id]);V?V.splice(V.length-1,0,W):this.proxyToSource[B.tileID.key][l.id]=[W];const X=this.proxyToSource[B.tileID.key][l.id];A.has(X)||A.add(X),b.push(W),S=!0}}if(this._sourceTilesOverlap[l.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const O of A)O.sort((z,B)=>B.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(l,f,y){if(!l.getSource().loaded())return;const b=this.proxiedCoords[l.id]=[],T=this.proxyCoords,S=l.getSource(),A=S.tileID;if(!A)return;const O=new a.P(A.x,A.y)._div(1<<A.z),z=S.coordinates.map(a._.fromLngLat).reduce((V,W)=>(V.min.x=Math.min(V.min.x,W.x-O.x),V.min.y=Math.min(V.min.y,W.y-O.y),V.max.x=Math.max(V.max.x,W.x-O.x),V.max.y=Math.max(V.max.y,W.y-O.y),V),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(V,W)=>{const X=V.wrap+V.canonical.x/(1<<V.canonical.z),se=V.canonical.y/(1<<V.canonical.z),oe=a.a4/(1<<V.canonical.z),ae=W.wrap+W.canonical.x/(1<<W.canonical.z),ce=W.canonical.y/(1<<W.canonical.z);return X+oe<ae+z.min.x||X>ae+z.max.x||se+oe<ce+z.min.y||se>ce+z.max.y};for(let V=0;V<T.length;V++){const W=T[V];for(let X=0;X<f.length;X++){const se=l.getTile(f[X]);if(!se||!se.hasData()||B(W,se.tileID))continue;const oe=this._createProxiedId(W,se,y[W.key]&&y[W.key][l.id]),ae=this.proxyToSource[W.key][l.id];ae?ae.push(oe):this.proxyToSource[W.key][l.id]=[oe],b.push(oe)}}}_createProxiedId(l,f,y){let b=this.orthoMatrix;if(y){const T=y.find(S=>S.key===f.tileID.key);if(T)return T}if(f.tileID.key!==l.key){const T=l.canonical.z-f.tileID.canonical.z;let S,A,O;b=a.ae.create();const z=f.tileID.wrap-l.wrap<<l.overscaledZ;T>0?(S=a.a4>>T,A=S*((f.tileID.canonical.x<<T)-l.canonical.x+z),O=S*((f.tileID.canonical.y<<T)-l.canonical.y)):(S=a.a4<<-T,A=a.a4*(f.tileID.canonical.x-(l.canonical.x+z<<-T)),O=a.a4*(f.tileID.canonical.y-(l.canonical.y<<-T))),a.ae.ortho(b,0,S,0,S,0,1),a.ae.translate(b,b,[A,O,0])}return new Dt(f.tileID,l.key,b)}_findTileCoveringTileID(l,f){let y=f.getTile(l);if(y&&y.hasData())return y;const b=this._findCoveringTileCache[f.id],T=b[l.key];if(y=T?f.getTileByID(T):null,y&&y.hasData()||T===null)return y;let S=y?y.tileID:l,A=S.overscaledZ;const O=f.getSource().minzoom,z=[];if(!T){const V=f.getSource().maxzoom;if(l.canonical.z>=V){const W=l.canonical.z-V;f.getSource().reparseOverscaled?(A=Math.max(l.canonical.z+2,f.transform.tileZoom),S=new a.aQ(A,l.wrap,V,l.canonical.x>>W,l.canonical.y>>W)):W!==0&&(A=V,S=new a.aQ(A,l.wrap,V,l.canonical.x>>W,l.canonical.y>>W))}S.key!==l.key&&(z.push(S.key),y=f.getTile(S))}const B=V=>{z.forEach(W=>{b[W]=V}),z.length=0};for(A-=1;A>=O&&(!y||!y.hasData());A--){y&&B(y.tileID.key);const V=S.calculateScaledKey(A);if(y=f.getTileByID(V),y&&y.hasData())break;const W=b[V];if(W===null)break;W===void 0?z.push(V):y=f.getTileByID(W)}return B(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,f){let y=this._tilesDirty[l];y||(y=this._tilesDirty[l]={}),y[f.key]=!0}}function ii(g,l,f){const y=function(A,O,z){const B=a.$.dot(O,A),V=a.$.dot(z,[.2126,.7152,.0722]),W=(se,oe,ae)=>(1-ae)*se+ae*oe,X=W(1-.3*Math.min(V,1),1,Math.min(B+1,1));return W(.92,1,Math.asin(a.au(O[2],-1,1))/Math.PI+.5)*X}(g,[0,0,1],l),b=[0,0,0];a.$.scale(b,f.slice(0,3),y);const T=[0,0,0];a.$.scale(T,l.slice(0,3),g[2]);const S=[0,0,0];return a.$.add(S,b,T),a.ba(S)}const ps=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ur=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class As{static cacheKey(l,f,y,b){let T=`${f}${b?b.cacheKey:""}`;for(const S of y)l.usedDefines.includes(S)&&(T+=`/${S}`);return T}constructor(l,f,y,b,T,S){const A=l.gl;this.program=A.createProgram(),this.configuration=b,this.name=f,this.fixedDefines=[...S];const O=b?b.getBinderAttributes():[],z=(y.staticAttributes||[]).concat(O);let B=b?b.defines():[];B=B.concat(S.map(ae=>`#define ${ae}`));const V=`#version 300 es
`;let W=V+B.concat("precision mediump float;",ag,hd.fragmentSource).join(`
`);for(const ae of y.fragmentIncludes)W+=`
${Qu[ae]}`;W+=`
${y.fragmentSource}`;let X=V+B.concat("precision highp float;",ag,hd.vertexSource).join(`
`);for(const ae of y.vertexIncludes)X+=`
${Qu[ae]}`;X+=`
${y.vertexSource}`;const se=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(se,W),A.compileShader(se),A.attachShader(this.program,se);const oe=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(oe,X),A.compileShader(oe),A.attachShader(this.program,oe),this.attributes={},this.numAttributes=z.length;for(let ae=0;ae<this.numAttributes;ae++)if(z[ae]){const ce=z[ae].startsWith("a_")?z[ae]:`a_${z[ae]}`;A.bindAttribLocation(this.program,ae,ce),this.attributes[ce]=ae}A.linkProgram(this.program),A.deleteShader(oe),A.deleteShader(se),this.fixedUniforms=T(l),this.binderUniforms=b?b.getUniforms(l):[],(S.includes("TERRAIN")||f.indexOf("symbol")!==-1||f.indexOf("circle")!==-1)&&(this.terrainUniforms=(ae=>({u_dem:new a.a8(ae),u_dem_prev:new a.a8(ae),u_dem_tl:new a.a9(ae),u_dem_scale:new a.ab(ae),u_dem_tl_prev:new a.a9(ae),u_dem_scale_prev:new a.ab(ae),u_dem_size:new a.ab(ae),u_dem_lerp:new a.ab(ae),u_exaggeration:new a.ab(ae),u_depth:new a.a8(ae),u_depth_size_inv:new a.a9(ae),u_depth_range_unpack:new a.a9(ae),u_occluder_half_size:new a.ab(ae),u_occlusion_depth_offset:new a.ab(ae),u_meter_to_dem:new a.ab(ae),u_label_plane_matrix_inv:new a.a7(ae)}))(l)),S.includes("GLOBE")&&(this.globeUniforms=(ae=>({u_tile_tl_up:new a.ar(ae),u_tile_tr_up:new a.ar(ae),u_tile_br_up:new a.ar(ae),u_tile_bl_up:new a.ar(ae),u_tile_up_scale:new a.ab(ae)}))(l)),S.includes("FOG")&&(this.fogUniforms=(ae=>({u_fog_matrix:new a.a7(ae),u_fog_range:new a.a9(ae),u_fog_color:new a.at(ae),u_fog_horizon_blend:new a.ab(ae),u_fog_vertical_limit:new a.a9(ae),u_fog_temporal_offset:new a.ab(ae),u_frustum_tl:new a.ar(ae),u_frustum_tr:new a.ar(ae),u_frustum_br:new a.ar(ae),u_frustum_bl:new a.ar(ae),u_globe_pos:new a.ar(ae),u_globe_radius:new a.ab(ae),u_globe_transition:new a.ab(ae),u_is_globe:new a.a8(ae),u_viewport:new a.a9(ae)}))(l)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ae=>({u_cutoff_params:new a.at(ae)}))(l)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ae=>({u_lighting_ambient_color:new a.ar(ae),u_lighting_directional_dir:new a.ar(ae),u_lighting_directional_color:new a.ar(ae),u_ground_radiance:new a.ar(ae)}))(l)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ae=>({u_light_matrix_0:new a.a7(ae),u_light_matrix_1:new a.a7(ae),u_fade_range:new a.a9(ae),u_shadow_normal_offset:new a.ar(ae),u_shadow_intensity:new a.ab(ae),u_shadow_texel_size:new a.ab(ae),u_shadow_map_resolution:new a.ab(ae),u_shadow_direction:new a.ar(ae),u_shadow_bias:new a.ar(ae),u_shadowmap_0:new a.a8(ae),u_shadowmap_1:new a.a8(ae)}))(l))}}setTerrainUniformValues(l,f){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in f)y[b]&&y[b].set(this.program,b,f[b])}}setGlobeUniformValues(l,f){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in f)y[b]&&y[b].set(this.program,b,f[b])}}setFogUniformValues(l,f){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in f)y[b].set(this.program,b,f[b])}}setCutoffUniformValues(l,f){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in f)y[b].set(this.program,b,f[b])}}setLightsUniformValues(l,f){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const b in f)y[b].set(this.program,b,f[b])}}setShadowUniformValues(l,f){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;l.program.set(this.program);for(const b in f)y[b].set(this.program,b,f[b])}_drawDebugWireframe(l,f,y,b,T,S,A,O,z,B){const V=l.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const W=l.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||l._terrain&&l._terrain.renderingToTexture||!ps.includes(this.name))||!(!V.layers3D||!Ur.includes(this.name))))return;const X=W.gl,se=l.wireframeDebugCache.getLinesFromTrianglesBuffer(l.frameCounter,T,W);if(!se)return;const oe=[...this.fixedDefines];oe.push("DEBUG_WIREFRAME");const ae=l.getOrCreateProgram(this.name,{config:this.configuration,defines:oe});W.program.set(ae.program);const ce=(ye,Me,Ie)=>{if(Me[ye]&&Ie[ye])for(const Ce in Me[ye])Ie[ye][Ce]&&Ie[ye][Ce].set(Ie.program,Ce,Me[ye][Ce].current)};z&&z.setUniforms(ae.program,W,ae.binderUniforms,A,{zoom:O}),ce("fixedUniforms",this,ae),ce("terrainUniforms",this,ae),ce("globeUniforms",this,ae),ce("fogUniforms",this,ae),ce("lightsUniforms",this,ae),ce("shadowUniforms",this,ae),se.bind(),W.setColorMode(new a.a([X.ONE,X.ONE_MINUS_SRC_ALPHA,X.ZERO,X.ONE],a.C.transparent,[!0,!0,!0,!1])),W.setDepthMode(new a.af(f.func===X.LESS?X.LEQUAL:f.func,a.af.ReadOnly,f.range)),W.setStencilMode(a.ah.disabled);const be=3*S.primitiveLength*2,we=3*S.primitiveOffset*2*2;B&&B>1?X.drawElementsInstanced(X.LINES,be,X.UNSIGNED_SHORT,we,B):X.drawElements(X.LINES,be,X.UNSIGNED_SHORT,we),T.bind(),W.program.set(this.program),W.setDepthMode(f),W.setStencilMode(y),W.setColorMode(b)}draw(l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe,ae){const ce=l.context,be=ce.gl;if(this.failedToCreate)return;ce.program.set(this.program),ce.setDepthMode(y),ce.setStencilMode(b),ce.setColorMode(T),ce.setCullFace(S);for(const Me of Object.keys(this.fixedUniforms))this.fixedUniforms[Me].set(this.program,Me,A[Me]);se&&se.setUniforms(this.program,ce,this.binderUniforms,W,{zoom:X});const we={[be.POINTS]:1,[be.LINES]:2,[be.TRIANGLES]:3,[be.LINE_STRIP]:1}[f],ye=ae&&ae>0?1:void 0;for(const Me of V.get()){const Ie=Me.vaos||(Me.vaos={});(Ie[O]||(Ie[O]=new lg)).bind(ce,this,z,se?se.getPaintVertexBuffers():[],B,Me.vertexOffset,oe||[],ye),ae&&ae>1?be.drawElementsInstanced(f,Me.primitiveLength*we,be.UNSIGNED_SHORT,Me.primitiveOffset*we*2,ae):B?be.drawElements(f,Me.primitiveLength*we,be.UNSIGNED_SHORT,Me.primitiveOffset*we*2):be.drawArrays(f,Me.vertexOffset,Me.vertexLength),f===be.TRIANGLES&&B&&this._drawDebugWireframe(l,y,b,T,B,Me,W,X,se,ae)}}}function Ps(g,l){const f=Math.pow(2,l.tileID.overscaledZ),y=l.tileSize*Math.pow(2,g.transform.tileZoom)/f,b=y*(l.tileID.canonical.x+l.tileID.wrap*f),T=y*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture?l.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.bD(l,1,g.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T]}}const uc=a.ae.create(),os=(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe,ae,ce)=>{const be=l.style.light,we=be.properties.get("position"),ye=[we.x,we.y,we.z],Me=a.bE.create();be.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(Me,-l.transform.angle),a.$.transformMat3(ye,ye,Me));const Ie=be.properties.get("color"),Ce=l.transform,Ne={u_matrix:g,u_lightpos:ye,u_lightintensity:be.properties.get("intensity"),u_lightcolor:[Ie.r,Ie.g,Ie.b],u_vertical_gradient:+f,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:uc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:T,u_alignment:S,u_width_scale:A,u_flood_light_color:X,u_vertical_scale:se,u_flood_light_intensity:oe,u_ground_shadow_factor:ae,u_emissive_strength:ce};return Ce.projection.name==="globe"&&(Ne.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],Ne.u_zoom_transition=B,Ne.u_inv_rot_matrix=W,Ne.u_merc_center=V,Ne.u_up_dir=Ce.projection.upVector(new a.aO(0,0,0),V[0]*a.a4,V[1]*a.a4),Ne.u_height_lift=z),Ne},hc=(g,l,f,y,b)=>({u_matrix:g,u_edge_radius:l,u_alignment:f,u_width_scale:y,u_vertical_scale:b}),md=(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe)=>{const ae=os(g,l,f,y,b,T,S,A,O,B,V,W,X,se,oe,1,[0,0,0],0),ce={u_height_factor:-Math.pow(2,O.overscaledZ)/z.tileSize/8};return a.Q(ae,Ps(l,z),ce)},np=(g,l)=>({u_matrix:g,u_emissive_strength:l}),fg=(g,l,f,y)=>a.Q(np(g,l),Ps(f,y)),pg=(g,l,f)=>({u_matrix:g,u_world:f,u_emissive_strength:l}),rp=(g,l,f,y,b)=>a.Q(fg(g,l,f,y),{u_world:b}),gd=(g,l,f,y)=>{const b=a.a4/f.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(y),u_extrude_scale:[l.pixelsToGLUnits[0]/b,l.pixelsToGLUnits[1]/b]}},mg=(g,l,f=1)=>({u_matrix:g,u_color:l.toRenderColor(null),u_overlay:0,u_overlay_scale:f}),Cb=a.ae.create(),Ab=(g,l,f,y,b,T,S)=>{const A=g.transform,O=A.projection.name==="globe",z=O?a.bF(A.zoom,l.canonical)*A._pixelsPerMercatorPixel:a.bD(f,1,T),B={u_matrix:l.projMatrix,u_extrude_scale:z,u_intensity:S,u_inv_rot_matrix:Cb,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){B.u_inv_rot_matrix=y,B.u_merc_center=b,B.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],B.u_zoom_transition=a.a2(A.zoom);const V=b[0]*a.a4,W=b[1]*a.a4;B.u_up_dir=A.projection.upVector(new a.aO(0,0,0),V,W)}return B};function u0(g,[l,f,y,b],[T,S]){if(T===S)return[0,0,0,0];const A=255*(g-1)/(g*(S-T));return[l*A,f*A,y*A,b*A]}function ip(g,l,[f,y]){return f===y?0:.5/g+(l-f)*(g-1)/(g*(y-f))}const gg=(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe,ae,ce,be,we,ye)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:f,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:z,u_fade_t:B.mix,u_opacity:B.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:a.bG(V.paint.get("raster-saturation")),u_contrast_factor:a.bH(V.paint.get("raster-contrast")),u_spin_weights:h0(V.paint.get("raster-hue-rotate")),u_perspective_transform:W,u_raster_elevation:X,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:O,u_colorization_mix:u0(a.bI,oe,ce),u_colorization_offset:ip(a.bI,ae,ce),u_color_ramp:se,u_texture_offset:[we/(be+2*we),be/(be+2*we)],u_texture_res:[be+2*we,be+2*we],u_emissive_strength:ye});function h0(g){g*=Math.PI/180;const l=Math.sin(g),f=Math.cos(g);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const Sl=.05,nh=(g,l,f,y,b,T,S,A,O,z,B,V)=>({u_matrix:g,u_normalize_matrix:l,u_globe_matrix:f,u_merc_matrix:y,u_grid_matrix:b,u_tl_parent:T,u_scale_parent:z,u_fade_t:B.mix,u_opacity:B.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:O}),pA=(g,l,f,y,b,T,S,A,O,z)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_tile_offset:f,u_velocity:y,u_color_ramp:T,u_velocity_res:b,u_max_speed:S,u_uv_offset:A,u_data_scale:[255*O[0],255*O[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Sl,Sl]}),Pb=(g,l,f,y,b,T,S,A,O,z)=>({u_particle_texture:g,u_particle_texture_side_len:l,u_velocity:f,u_velocity_res:y,u_max_speed:b,u_speed_factor:T,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*O[0],255*O[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Sl,Sl]}),sp=a.ae.create(),_d=(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe,ae,ce)=>{const be=b.transform,we={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(oe),u_rotate_symbol:+f,u_aspect_ratio:be.width/be.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+O,u_pitch_with_map:+y,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:sp,u_up_vector:[0,-1,0],u_color_adj_mat:ae,u_icon_transition:ce||0};return oe.name==="globe"&&(we.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],we.u_zoom_transition=V,we.u_inv_rot_matrix=X,we.u_merc_center=W,we.u_camera_forward=be._camera.forward(),we.u_ecef_origin=a.bJ(be.globeMatrix,B.toUnwrapped()),we.u_tile_matrix=Float32Array.from(be.globeMatrix),we.u_up_vector=se),we},op=(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe,ae)=>a.Q(_d(g,l,f,y,b,T,S,A,O,z,V,W,X,se,oe,ae),{u_gamma_scale:y?b.transform.getCameraToCenterDistance(ae)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:a.e.devicePixelRatio,u_is_halo:+B,undefined:void 0}),d0=(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe)=>a.Q(op(g,l,f,y,b,T,S,A,!0,O,!0,B,V,W,X,se,oe),{u_texsize_icon:z,u_texture_icon:1}),f0=(g,l,f,y)=>({u_matrix:g,u_emissive_strength:l,u_opacity:f,u_color:y}),mA=(g,l,f,y,b,T,S,A)=>a.Q(function(O,z,B,V,W){const{width:X,height:se}=V.imageManager.getPixelSize(z),oe=Math.pow(2,W.tileID.overscaledZ),ae=W.tileSize*Math.pow(2,V.transform.tileZoom)/oe,ce=ae*(W.tileID.canonical.x+W.tileID.wrap*oe),be=ae*W.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[X,se],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/a.bD(W,1,V.transform.tileZoom),u_pixel_coord_upper:[ce>>16,be>>16],u_pixel_coord_lower:[65535&ce,65535&be]}}(0,T,S,y,A),{u_matrix:g,u_emissive_strength:l,u_opacity:f}),Sa=new Float32Array(a.ae.identity([])),rh=(g,l,f,y,b,T,S,A,O,z,B,V,W,X=[0,0,0],se)=>{const oe=b.style.light,ae=oe.properties.get("position"),ce=[-ae.x,-ae.y,ae.z],be=a.bE.create();oe.properties.get("anchor")==="viewport"&&(a.bE.fromRotation(be,-b.transform.angle),a.$.transformMat3(ce,ce,be));const we=B.alphaMode==="MASK",ye=oe.properties.get("color").toRenderColor(null),Me=W.paint.get("model-ambient-occlusion-intensity"),Ie=W.paint.get("model-color").constantOr(a.C.white).toRenderColor(null),Ce=W.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:g,u_lighting_matrix:l,u_normal_matrix:f,u_node_matrix:y||Sa,u_lightpos:ce,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:X,u_opacity:T,u_baseTextureIsAlpha:0,u_alphaMask:+we,u_alphaCutoff:B.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[A[0],A[1],A[2],1],u_metallicFactor:O,u_roughnessFactor:z,u_baseColorTexture:Cs.BaseColor,u_metallicRoughnessTexture:Cs.MetallicRoughness,u_normalTexture:Cs.Normal,u_occlusionTexture:Cs.Occlusion,u_emissionTexture:Cs.Emission,u_lutTexture:Cs.LUT,u_color_mix:[Ie.r,Ie.g,Ie.b,Ce],u_aoIntensity:Me,u_emissive_strength:V,u_occlusionTextureTransform:se||[0,0,0,0]}},p0=(g,l=Sa,f=Sa)=>({u_matrix:g,u_instance:l,u_node_matrix:f}),Rb={fillExtrusion:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_opacity:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_flood_light_color:new a.ar(g),u_vertical_scale:new a.ab(g),u_flood_light_intensity:new a.ab(g),u_ground_shadow_factor:new a.ar(g),u_emissive_strength:new a.ab(g)}),fillExtrusionDepth:g=>({u_matrix:new a.a7(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_vertical_scale:new a.ab(g)}),fillExtrusionPattern:g=>({u_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_vertical_gradient:new a.ab(g),u_height_factor:new a.ab(g),u_edge_radius:new a.ab(g),u_alignment:new a.ab(g),u_width_scale:new a.ab(g),u_ao:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_up_dir:new a.ar(g),u_height_lift:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g),u_opacity:new a.ab(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new a.a7(g),u_opacity:new a.ab(g),u_ao_pass:new a.ab(g),u_meter_to_tile:new a.ab(g),u_ao:new a.a9(g),u_flood_light_intensity:new a.ab(g),u_flood_light_color:new a.ar(g),u_attenuation:new a.ab(g),u_edge_radius:new a.ab(g),u_fb:new a.a8(g),u_fb_size:new a.ab(g)}),fill:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g)}),fillPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),fillOutline:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g)}),fillOutlinePattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_world:new a.a9(g),u_image:new a.a8(g),u_texsize:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),circle:a.bK,collisionBox:g=>({u_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_extrude_scale:new a.a9(g)}),collisionCircle:g=>({u_matrix:new a.a7(g),u_inv_matrix:new a.a7(g),u_camera_to_center_distance:new a.ab(g),u_viewport_size:new a.a9(g)}),debug:g=>({u_color:new a.aa(g),u_matrix:new a.a7(g),u_overlay:new a.a8(g),u_overlay_scale:new a.ab(g)}),clippingMask:g=>({u_matrix:new a.a7(g)}),heatmap:g=>({u_extrude_scale:new a.ab(g),u_intensity:new a.ab(g),u_matrix:new a.a7(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_up_dir:new a.ar(g)}),heatmapTexture:g=>({u_image:new a.a8(g),u_color_ramp:new a.a8(g),u_opacity:new a.ab(g)}),hillshade:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_latrange:new a.a9(g),u_light:new a.a9(g),u_shadow:new a.aa(g),u_highlight:new a.aa(g),u_emissive_strength:new a.ab(g),u_accent:new a.aa(g)}),hillshadePrepare:g=>({u_matrix:new a.a7(g),u_image:new a.a8(g),u_dimension:new a.a9(g),u_zoom:new a.ab(g)}),line:a.bL,linePattern:a.bM,raster:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_brightness_low:new a.ab(g),u_brightness_high:new a.ab(g),u_saturation_factor:new a.ab(g),u_contrast_factor:new a.ab(g),u_spin_weights:new a.ar(g),u_perspective_transform:new a.a9(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g),u_colorization_mix:new a.at(g),u_colorization_offset:new a.ab(g),u_color_ramp:new a.a8(g),u_texture_offset:new a.a9(g),u_texture_res:new a.a9(g),u_emissive_strength:new a.ab(g)}),rasterParticle:g=>({u_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_grid_matrix:new a.as(g),u_tl_parent:new a.a9(g),u_scale_parent:new a.ab(g),u_fade_t:new a.ab(g),u_opacity:new a.ab(g),u_image0:new a.a8(g),u_image1:new a.a8(g),u_raster_elevation:new a.ab(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_cutoff_params:new a.at(g)}),rasterParticleTexture:g=>({u_texture:new a.a8(g),u_opacity:new a.ab(g)}),rasterParticleDraw:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_tile_offset:new a.a9(g),u_velocity:new a.a8(g),u_color_ramp:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),rasterParticleUpdate:g=>({u_particle_texture:new a.a8(g),u_particle_texture_side_len:new a.ab(g),u_velocity:new a.a8(g),u_velocity_res:new a.a9(g),u_max_speed:new a.ab(g),u_speed_factor:new a.ab(g),u_reset_rate:new a.ab(g),u_rand_seed:new a.ab(g),u_uv_offset:new a.a9(g),u_data_scale:new a.a9(g),u_data_offset:new a.ab(g),u_particle_pos_scale:new a.ab(g),u_particle_pos_offset:new a.a9(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_texture:new a.a8(g),u_icon_transition:new a.ab(g),u_color_adj_mat:new a.a7(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texture:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_tile_id:new a.ar(g),u_zoom_transition:new a.ab(g),u_inv_rot_matrix:new a.a7(g),u_merc_center:new a.a9(g),u_camera_forward:new a.ar(g),u_tile_matrix:new a.a7(g),u_up_vector:new a.ar(g),u_ecef_origin:new a.ar(g),u_is_halo:new a.a8(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new a.a8(g),u_is_size_feature_constant:new a.a8(g),u_size_t:new a.ab(g),u_size:new a.ab(g),u_camera_to_center_distance:new a.ab(g),u_rotate_symbol:new a.a8(g),u_aspect_ratio:new a.ab(g),u_fade_change:new a.ab(g),u_matrix:new a.a7(g),u_label_plane_matrix:new a.a7(g),u_coord_matrix:new a.a7(g),u_is_text:new a.a8(g),u_pitch_with_map:new a.a8(g),u_texsize:new a.a9(g),u_texsize_icon:new a.a9(g),u_texture:new a.a8(g),u_texture_icon:new a.a8(g),u_gamma_scale:new a.ab(g),u_device_pixel_ratio:new a.ab(g),u_is_halo:new a.a8(g)}),background:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_color:new a.aa(g)}),backgroundPattern:g=>({u_matrix:new a.a7(g),u_emissive_strength:new a.ab(g),u_opacity:new a.ab(g),u_image:new a.a8(g),u_pattern_tl:new a.a9(g),u_pattern_br:new a.a9(g),u_texsize:new a.a9(g),u_pattern_size:new a.a9(g),u_pixel_coord_upper:new a.a9(g),u_pixel_coord_lower:new a.a9(g),u_tile_units_to_pixels:new a.ab(g)}),terrainRaster:g=>({u_matrix:new a.a7(g),u_image0:new a.a8(g),u_skirt_height:new a.ab(g),u_ground_shadow_factor:new a.ar(g)}),skybox:g=>({u_matrix:new a.a7(g),u_sun_direction:new a.ar(g),u_cubemap:new a.a8(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxGradient:g=>({u_matrix:new a.a7(g),u_color_ramp:new a.a8(g),u_center_direction:new a.ar(g),u_radius:new a.ab(g),u_opacity:new a.ab(g),u_temporal_offset:new a.ab(g)}),skyboxCapture:g=>({u_matrix_3f:new a.as(g),u_sun_direction:new a.ar(g),u_sun_intensity:new a.ab(g),u_color_tint_r:new a.at(g),u_color_tint_m:new a.at(g),u_luminance:new a.ab(g)}),globeRaster:g=>({u_proj_matrix:new a.a7(g),u_globe_matrix:new a.a7(g),u_normalize_matrix:new a.a7(g),u_merc_matrix:new a.a7(g),u_zoom_transition:new a.ab(g),u_merc_center:new a.a9(g),u_image0:new a.a8(g),u_grid_matrix:new a.as(g),u_skirt_height:new a.ab(g),u_far_z_cutoff:new a.ab(g),u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_globe_pos:new a.ar(g),u_globe_radius:new a.ab(g),u_viewport:new a.a9(g)}),globeAtmosphere:g=>({u_frustum_tl:new a.ar(g),u_frustum_tr:new a.ar(g),u_frustum_br:new a.ar(g),u_frustum_bl:new a.ar(g),u_horizon:new a.ab(g),u_transition:new a.ab(g),u_fadeout_range:new a.ab(g),u_color:new a.at(g),u_high_color:new a.at(g),u_space_color:new a.at(g),u_temporal_offset:new a.ab(g),u_horizon_angle:new a.ab(g)}),model:g=>({u_matrix:new a.a7(g),u_lighting_matrix:new a.a7(g),u_normal_matrix:new a.a7(g),u_node_matrix:new a.a7(g),u_lightpos:new a.ar(g),u_lightintensity:new a.ab(g),u_lightcolor:new a.ar(g),u_camera_pos:new a.ar(g),u_opacity:new a.ab(g),u_baseColorFactor:new a.at(g),u_emissiveFactor:new a.at(g),u_metallicFactor:new a.ab(g),u_roughnessFactor:new a.ab(g),u_baseTextureIsAlpha:new a.a8(g),u_alphaMask:new a.a8(g),u_alphaCutoff:new a.ab(g),u_baseColorTexture:new a.a8(g),u_metallicRoughnessTexture:new a.a8(g),u_normalTexture:new a.a8(g),u_occlusionTexture:new a.a8(g),u_emissionTexture:new a.a8(g),u_lutTexture:new a.a8(g),u_color_mix:new a.at(g),u_aoIntensity:new a.ab(g),u_emissive_strength:new a.ab(g),u_occlusionTextureTransform:new a.at(g)}),modelDepth:g=>({u_matrix:new a.a7(g),u_instance:new a.a7(g),u_node_matrix:new a.a7(g)}),groundShadow:g=>({u_matrix:new a.a7(g),u_ground_shadow_factor:new a.ar(g)}),stars:g=>({u_matrix:new a.a7(g),u_up:new a.ar(g),u_right:new a.ar(g),u_intensity_multiplier:new a.ab(g)}),occlusion:g=>({u_matrix:new a.a7(g),u_anchorPos:new a.ar(g),u_screenSizePx:new a.a9(g),u_occluderSizePx:new a.a9(g),u_color:new a.at(g)})};function ih(g,l,f){const y=l.createTileMatrix(g,g.worldSize,f.toUnwrapped());return a.ae.multiply(new Float32Array(16),g.projMatrix,y)}function Mb(g,l,f){if(l.projection.name===f.projection.name)return g.projMatrix;const y=f.clone();return y.setProjection(l.projection),ih(y,l.getProjection(),g)}function m0(g,l,f){return l.name===f.projection.name?g.projMatrix:ih(f,l,g)}let yd;function kb(g,l,f,y,b,T,S){const A=g.context,O=A.gl,z=g.transform,B=g.getOrCreateProgram("collisionBox"),V=[];let W=0,X=0;for(let ye=0;ye<y.length;ye++){const Me=y[ye],Ie=l.getTile(Me),Ce=Ie.getBucket(f);if(!Ce)continue;const Ne=Mb(Me,Ce,z);let Fe=Ne;b[0]===0&&b[1]===0||(Fe=g.translatePosMatrix(Ne,Ie,b,T));const We=S?Ce.textCollisionBox:Ce.iconCollisionBox,Be=Ce.collisionCircleArray;if(Be.length>0){const Re=a.ae.create(),et=Fe;a.ae.mul(Re,Ce.placementInvProjMatrix,z.glCoordMatrix),a.ae.mul(Re,Re,Ce.placementViewportMatrix),V.push({circleArray:Be,circleOffset:X,transform:et,invTransform:Re,projection:Ce.getProjection()}),W+=Be.length/4,X=W}We&&(g.terrain&&g.terrain.setupElevationDraw(Ie,B),B.draw(g,O.LINES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,gd(Fe,z,Ie,Ce.getProjection()),f.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,null,z.zoom,null,[We.collisionVertexBuffer,We.collisionVertexBufferExt]))}if(!S||!V.length)return;const se=g.getOrCreateProgram("collisionCircle"),oe=new a.bN;oe.resize(4*W),oe._trim();let ae=0;for(const ye of V)for(let Me=0;Me<ye.circleArray.length/4;Me++){const Ie=4*Me,Ce=ye.circleArray[Ie+0],Ne=ye.circleArray[Ie+1],Fe=ye.circleArray[Ie+2],We=ye.circleArray[Ie+3];oe.emplace(ae++,Ce,Ne,Fe,We,0),oe.emplace(ae++,Ce,Ne,Fe,We,1),oe.emplace(ae++,Ce,Ne,Fe,We,2),oe.emplace(ae++,Ce,Ne,Fe,We,3)}(!yd||yd.length<2*W)&&(yd=function(ye){const Me=2*ye,Ie=new a.bw;Ie.resize(Me),Ie._trim();for(let Ce=0;Ce<Me;Ce++){const Ne=6*Ce;Ie.uint16[Ne+0]=4*Ce+0,Ie.uint16[Ne+1]=4*Ce+1,Ie.uint16[Ne+2]=4*Ce+2,Ie.uint16[Ne+3]=4*Ce+2,Ie.uint16[Ne+4]=4*Ce+3,Ie.uint16[Ne+5]=4*Ce+0}return Ie}(W));const ce=A.createIndexBuffer(yd,!0),be=A.createVertexBuffer(oe,a.bO.members,!0);for(const ye of V){const Me={u_matrix:ye.transform,u_inv_matrix:ye.invTransform,u_camera_to_center_distance:(we=z).getCameraToCenterDistance(ye.projection),u_viewport_size:[we.width,we.height]};se.draw(g,O.TRIANGLES,a.af.disabled,a.ah.disabled,g.colorModeForRenderPass(),a.ag.disabled,Me,f.id,be,ce,a.b.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,z.zoom)}var we;be.destroy(),ce.destroy()}const ap=a.ae.create();function Ob(g){const l=g._camera.getWorldToCamera(g.worldSize,1),f=a.ae.multiply([],l,g.globeMatrix);a.ae.invert(f,f);const y=[0,0,0],b=[0,1,0,0];return a.aB.transformMat4(b,b,f),y[0]=b[0],y[1]=b[1],y[2]=b[2],a.$.normalize(y,y),y}function Db({width:g,height:l,anchor:f,textOffset:y,textScale:b},T){const{horizontalAlign:S,verticalAlign:A}=a.bS(f),O=-(S-.5)*g,z=-(A-.5)*l,B=a.bR(f,y);return new a.P((O/b+B[0])*T,(z/b+B[1])*T)}function gA(g,l,f,y,b,T,S,A,O,z,B){const V=g.text.placedSymbolArray,W=g.text.dynamicLayoutVertexArray,X=g.icon.dynamicLayoutVertexArray,se={},oe=g.getProjection(),ae=m0(A,oe,T),ce=T.elevation,be=oe.upVectorScale(A.canonical,T.center.lat,T.worldSize).metersToTile;W.clear();for(let we=0;we<V.length;we++){const ye=V.get(we),{tileAnchorX:Me,tileAnchorY:Ie,numGlyphs:Ce}=ye,Ne=ye.hidden||!ye.crossTileID||g.allowVerticalPlacement&&!ye.placedOrientation?null:y[ye.crossTileID];if(Ne){let Fe=0,We=0,Be=0;if(ce){const je=ce?ce.getAtTileOffset(A,Me,Ie):0,[yt,xt,$t]=oe.upVector(A.canonical,Me,Ie);Fe=je*yt*be,We=je*xt*be,Be=je*$t*be}let[Re,et,Ye,Ve]=mo(ye.projectedAnchorX+Fe,ye.projectedAnchorY+We,ye.projectedAnchorZ+Be,f?ae:S);const Ct=Hn(T.getCameraToCenterDistance(oe),Ve);let _t=b.evaluateSizeForFeature(g.textSizeData,z,ye)*Ct/a.bP;f&&(_t*=g.tilePixelRatio/O);const Ze=Db(Ne,_t);f?({x:Re,y:et,z:Ye}=oe.projectTilePoint(Me+Ze.x,Ie+Ze.y,A.canonical),[Re,et,Ye]=mo(Re+Fe,et+We,Ye+Be,S)):(l&&Ze._rotate(-T.angle),Re+=Ze.x,et+=Ze.y,Ye=0);const ot=g.allowVerticalPlacement&&ye.placedOrientation===a.aF.vertical?Math.PI/2:0;for(let je=0;je<Ce;je++)a.aI(W,Re,et,Ye,ot);B&&ye.associatedIconIndex>=0&&(se[ye.associatedIconIndex]={x:Re,y:et,z:Ye,angle:ot})}else Ea(Ce,W)}if(B){X.clear();const we=g.icon.placedSymbolArray;for(let ye=0;ye<we.length;ye++){const Me=we.get(ye),{numGlyphs:Ie}=Me,Ce=se[ye];if(Me.hidden||!Ce)Ea(Ie,X);else{const{x:Ne,y:Fe,z:We,angle:Be}=Ce;for(let Re=0;Re<Ie;Re++)a.aI(X,Ne,Fe,We,Be)}}g.icon.dynamicLayoutVertexBuffer.updateData(X)}g.text.dynamicLayoutVertexBuffer.updateData(W)}function lp(g,l,f,y,b,T,S={}){const A=f.paint.get("icon-translate"),O=f.paint.get("text-translate"),z=f.paint.get("icon-translate-anchor"),B=f.paint.get("text-translate-anchor"),V=f.layout.get("icon-rotation-alignment"),W=f.layout.get("text-rotation-alignment"),X=f.layout.get("icon-pitch-alignment"),se=f.layout.get("text-pitch-alignment"),oe=f.layout.get("icon-keep-upright"),ae=f.layout.get("text-keep-upright"),ce=f.paint.get("icon-color-saturation"),be=f.paint.get("icon-color-contrast"),we=f.paint.get("icon-color-brightness-min"),ye=f.paint.get("icon-color-brightness-max");f.paint.get("icon-occlusion-opacity").constantOr(0),f.paint.get("text-occlusion-opacity").constantOr(0);const Me=g.context,Ie=Me.gl,Ce=g.transform,Ne=V==="map",Fe=W==="map",We=X==="map",Be=se==="map",Re=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let et=!1;const Ye=g.depthModeForSublayer(0,a.af.ReadOnly),Ve=[a.ak(Ce.center.lng),a.al(Ce.center.lat)],Ct=f.layout.get("text-variable-anchor"),_t=Ce.projection.name==="globe",Ze=[],ot=[0,-1,0];for(const je of y){const yt=l.getTile(je),xt=yt.getBucket(f);if(!xt||xt.projection.name==="mercator"&&_t||xt.fullyClipped)continue;const $t=xt.projection.name==="globe",Gt=$t?a.a2(Ce.zoom):0,sn=m0(je,xt.getProjection(),Ce),Kt=Ce.calculatePixelsToTileUnitsMatrix(yt),En=Ct&&xt.hasTextData(),Un=xt.hasIconTextFit()&&En&&xt.hasIconData(),In=xt.getProjection().createInversionMatrix(Ce,je.canonical),Gn=br=>{Ce.depthOcclusionForSymbolsAndCircles&&(f.hasInitialOcclusionOpacityProperties||g.terrain)&&(br.push("DEPTH_D24"),br.push("DEPTH_OCCLUSION"))},dr=()=>{const br=Ne&&f.layout.get("symbol-placement")!=="point",nr=[];Gn(nr);const Rn=br||Un,Bi=f.paint.get("icon-image-cross-fade").constantOr(0);g.terrainRenderModeElevated()&&We&&nr.push("PITCH_WITH_MAP_TERRAIN"),$t&&(nr.push("PROJECTION_GLOBE_VIEW"),Rn&&nr.push("PROJECTED_POS_ON_VIEWPORT")),Bi>0&&nr.push("ICON_TRANSITION"),xt.icon.zOffsetVertexBuffer&&nr.push("Z_OFFSET"),ce===0&&be===0&&we===0&&ye===1||nr.push("COLOR_ADJUSTMENT");const ji=xt.icon.programConfigurations.get(f.id),ro=g.getOrCreateProgram(xt.sdfIcons?"symbolSDF":"symbolIcon",{config:ji,defines:nr});let io;const Gs=yt.imageAtlasTexture?yt.imageAtlasTexture.size:[0,0],so=xt.iconSizeData,Ns=a.aE(so,Ce.zoom),Ws=We||Ce.pitch!==0,kt=Jc(sn,yt.tileID.canonical,We,Ne,Ce,xt.getProjection(),Kt),an=Ju(sn,yt.tileID.canonical,We,Ne,Ce,xt.getProjection(),Kt),_o=g.translatePosMatrix(an,yt,A,z,!0),Vr=g.translatePosMatrix(sn,yt,A,z),Je=Rn?ap:kt,gc=Ne&&!We&&!br;let Ya=ot;!_t&&!Ce.mercatorFromTransition||Ne||(Ya=Ob(Ce));const _c=$t?Ya:ot;if(xt.sdfIcons&&!xt.iconsInText)io=op(so.kind,Ns,gc,We,g,Vr,Je,_o,!1,Gs,!0,je,Gt,Ve,In,_c,xt.getProjection());else{const fh=f.getColorAdjustmentMatrix(ce,be,we,ye);io=_d(so.kind,Ns,gc,We,g,Vr,Je,_o,!1,Gs,je,Gt,Ve,In,_c,xt.getProjection(),fh,Bi)}const yc=yt.imageAtlasTexture?yt.imageAtlasTexture:null,Ug=f.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear,Vg=xt.sdfIcons||g.options.rotating||g.options.zooming||Ug||Ws?Ie.LINEAR:Ie.NEAREST,uu=xt.sdfIcons&&f.paint.get("icon-halo-width").constantOr(1)!==0,U0=g.terrain&&We&&br?a.ae.invert(a.ae.create(),kt):ap;if(br&&xt.icon){const fh=Ce.elevation,$g=fh?fh.getAtTileOffsetFunc(je,Ce.center.lat,Ce.worldSize,xt.getProjection()):null,Rd=Yu(sn,yt.tileID.canonical,We,Ne,Ce,xt.getProjection(),Kt);sc(xt,sn,g,!1,Rd,an,We,oe,$g,je)}return{program:ro,buffers:xt.icon,uniformValues:io,atlasTexture:yc,atlasTextureIcon:null,atlasInterpolation:Vg,atlasInterpolationIcon:null,isSDF:xt.sdfIcons,hasHalo:uu,tile:yt,labelPlaneMatrixInv:U0}},Xr=()=>{const br=Fe&&f.layout.get("symbol-placement")!=="point",nr=[],Rn=br||Ct||Un;g.terrainRenderModeElevated()&&Be&&nr.push("PITCH_WITH_MAP_TERRAIN"),$t&&(nr.push("PROJECTION_GLOBE_VIEW"),Rn&&nr.push("PROJECTED_POS_ON_VIEWPORT")),xt.text.zOffsetVertexBuffer&&nr.push("Z_OFFSET"),Gn(nr);const Bi=xt.text.programConfigurations.get(f.id),ji=g.getOrCreateProgram(xt.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Bi,defines:nr});let ro,io=[0,0],Gs=null;const so=xt.textSizeData;xt.iconsInText&&(io=yt.imageAtlasTexture?yt.imageAtlasTexture.size:[0,0],Gs=yt.imageAtlasTexture?yt.imageAtlasTexture:null,ro=Be||Ce.pitch!==0||g.options.rotating||g.options.zooming||so.kind==="composite"||so.kind==="camera"?Ie.LINEAR:Ie.NEAREST);const Ns=yt.glyphAtlasTexture?yt.glyphAtlasTexture.size:[0,0],Ws=a.aE(so,Ce.zoom),kt=Jc(sn,yt.tileID.canonical,Be,Fe,Ce,xt.getProjection(),Kt),an=Ju(sn,yt.tileID.canonical,Be,Fe,Ce,xt.getProjection(),Kt),_o=g.translatePosMatrix(an,yt,O,B,!0),Vr=g.translatePosMatrix(sn,yt,O,B),Je=Rn?ap:kt,gc=Fe&&!Be&&!br;let Ya=ot;!_t&&!Ce.mercatorFromTransition||Fe||(Ya=Ob(Ce));const _c=$t?Ya:ot;let yc;yc=xt.iconsInText?d0(so.kind,Ws,gc,Be,g,Vr,Je,_o,Ns,io,je,Gt,Ve,In,_c,xt.getProjection()):op(so.kind,Ws,gc,Be,g,Vr,Je,_o,!0,Ns,!0,je,Gt,Ve,In,_c,xt.getProjection());const Ug=yt.glyphAtlasTexture?yt.glyphAtlasTexture:null,Vg=Ie.LINEAR,uu=f.paint.get("text-halo-width").constantOr(1)!==0,U0=g.terrain&&Be&&br?a.ae.invert(a.ae.create(),kt):ap;if(br&&xt.text){const fh=Ce.elevation,$g=fh?fh.getAtTileOffsetFunc(je,Ce.center.lat,Ce.worldSize,xt.getProjection()):null,Rd=Yu(sn,yt.tileID.canonical,Be,Fe,Ce,xt.getProjection(),Kt);sc(xt,sn,g,!0,Rd,an,Be,ae,$g,je)}return{program:ji,buffers:xt.text,uniformValues:yc,atlasTexture:Ug,atlasTextureIcon:Gs,atlasInterpolation:Vg,atlasInterpolationIcon:ro,isSDF:!0,hasHalo:uu,tile:yt,labelPlaneMatrixInv:U0}},Nr=xt.icon.segments.get().length,mr=xt.text.segments.get().length,zr=Nr&&!S.onlyText?dr():null,Zn=mr&&!S.onlyIcons?Xr():null,Jn=f.paint.get("icon-opacity").constantOr(1),Vn=f.paint.get("text-opacity").constantOr(1);if(Re&&xt.canOverlap){et=!0;const br=Jn&&!S.onlyText?xt.icon.segments.get():[],nr=Vn&&!S.onlyIcons?xt.text.segments.get():[];for(const Rn of br)Ze.push({segments:new a.b([Rn]),sortKey:Rn.sortKey,state:zr});for(const Rn of nr)Ze.push({segments:new a.b([Rn]),sortKey:Rn.sortKey,state:Zn})}else S.onlyText||Ze.push({segments:Jn?xt.icon.segments:new a.b([]),sortKey:0,state:zr}),S.onlyIcons||Ze.push({segments:Vn?xt.text.segments:new a.b([]),sortKey:0,state:Zn})}et&&Ze.sort((je,yt)=>je.sortKey-yt.sortKey);for(const je of Ze){const yt=je.state;if(yt)if(g.terrain?g.terrain.setupElevationDraw(yt.tile,yt.program,{useDepthForOcclusion:Ce.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:yt.labelPlaneMatrixInv}):g.setupDepthForOcclusion(Ce.depthOcclusionForSymbolsAndCircles,yt.program),Me.activeTexture.set(Ie.TEXTURE0),yt.atlasTexture&&yt.atlasTexture.bind(yt.atlasInterpolation,Ie.CLAMP_TO_EDGE,!0),yt.atlasTextureIcon&&(Me.activeTexture.set(Ie.TEXTURE1),yt.atlasTextureIcon&&yt.atlasTextureIcon.bind(yt.atlasInterpolationIcon,Ie.CLAMP_TO_EDGE,!0)),g.uploadCommonLightUniforms(g.context,yt.program),yt.hasHalo){const xt=yt.uniformValues;xt.u_is_halo=1,g0(yt.buffers,je.segments,f,g,yt.program,Ye,b,T,xt,2),xt.u_is_halo=0}else{if(yt.isSDF){const xt=yt.uniformValues;yt.hasHalo&&(xt.u_is_halo=1,g0(yt.buffers,je.segments,f,g,yt.program,Ye,b,T,xt,1)),xt.u_is_halo=0}g0(yt.buffers,je.segments,f,g,yt.program,Ye,b,T,yt.uniformValues,1)}}}function g0(g,l,f,y,b,T,S,A,O,z){const B=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer];b.draw(y,y.context.gl.TRIANGLES,T,S,A,a.ag.disabled,O,f.id,g.layoutVertexBuffer,g.indexBuffer,l,f.paint,y.transform.zoom,g.programConfigurations.get(f.id),B,z)}function cp(g,l,f,y,b,T,S){const A=g.context.gl,O=f.paint.get("fill-pattern"),z=O&&O.constantOr(1);let B,V,W,X,se;S?(V=z&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):(V=z?"fillPattern":"fill",B=A.TRIANGLES);for(const oe of y){const ae=l.getTile(oe);if(z&&!ae.patternsLoaded())continue;const ce=ae.getBucket(f);if(!ce)continue;g.prepareDrawTile();const be=ce.programConfigurations.get(f.id),we=g.isTileAffectedByFog(oe),ye=g.getOrCreateProgram(V,{config:be,overrideFog:we});z&&(g.context.activeTexture.set(A.TEXTURE0),ae.imageAtlasTexture&&ae.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),be.updatePaintBuffers());const Me=O.constantOr(null);if(Me&&ae.imageAtlas){const Ne=ae.imageAtlas.patternPositions[Me.toString()];Ne&&be.setConstantPatternPositions(Ne)}const Ie=g.translatePosMatrix(oe.projMatrix,ae,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),Ce=f.paint.get("fill-emissive-strength");if(S){X=ce.indexBuffer2,se=ce.segments2;const Ne=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];W=V==="fillOutlinePattern"&&z?rp(Ie,Ce,g,ae,Ne):pg(Ie,Ce,Ne)}else X=ce.indexBuffer,se=ce.segments,W=z?fg(Ie,Ce,g,ae):np(Ie,Ce);g.uploadCommonUniforms(g.context,ye,oe.toUnwrapped()),ye.draw(g,B,b,g.stencilModeForClipping(oe),T,a.ag.disabled,W,f.id,ce.layoutVertexBuffer,X,se,f.paint,g.transform.zoom,be,void 0)}}function sh(g,l,f,y,b,T,S,A){f.resetLayerRenderingStats(g);const O=g.context,z=O.gl,B=g.transform,V=f.paint.get("fill-extrusion-pattern"),W=V.constantOr(1),X=f.paint.get("fill-extrusion-opacity"),se=g.style.enable3dLights(),oe=f.paint.get(se&&!W?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],ce=f.layout.get("fill-extrusion-edge-radius"),be=ce>0&&!f.paint.get("fill-extrusion-rounded-roof"),we=be?0:ce,ye=B.projection.name==="globe"?a.b_():0,Me=B.projection.name==="globe",Ie=Me?a.a2(B.zoom):0,Ce=[a.ak(B.center.lng),a.al(B.center.lat)],Ne=f.paint.get("fill-extrusion-flood-light-color").toRenderColor(f.lut).toArray01().slice(0,3),Fe=f.paint.get("fill-extrusion-flood-light-intensity"),We=f.paint.get("fill-extrusion-vertical-scale"),Be=f.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Re=zs(g,f.paint.get("fill-extrusion-cutoff-fade-range")),et=f.paint.get("fill-extrusion-emissive-strength"),Ye=[];Me&&Ye.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&Ye.push("FAUX_AO"),be&&Ye.push("ZERO_ROOF_RADIUS"),A&&Ye.push("HAS_CENTROID"),Fe>0&&Ye.push("FLOOD_LIGHT"),Re.shouldRenderCutoff&&Ye.push("RENDER_CUTOFF"),Be&&Ye.push("RENDER_WALL_MODE");const Ve=(()=>{const $t=f.paint.get("fill-extrusion-line-alignment");switch($t){case"inside":return 1;case"outside":return-1;case"center":return 0;default:return a.w(`Unsupported value for fill-extrusion-line-alignment: ${$t}`),0}})();let Ct;const _t=g.renderPass==="shadow",Ze=g.shadowRenderer,ot=_t&&!!Ze;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let je=[0,0,0];if(Ze){const $t=g.style.directionalLight,Gt=g.style.ambientLight;$t&&Gt&&(je=tu(g.style,$t,Gt)),Ct=Ye.concat(["SHADOWS_SINGLE_CASCADE"])}const yt=ot?"fillExtrusionDepth":W?"fillExtrusionPattern":"fillExtrusion",xt=f.getLayerRenderingStats();for(const $t of y){const Gt=l.getTile($t),sn=Gt.getBucket(f);if(!sn||sn.projection.name!==B.projection.name)continue;let Kt=!1;Ze&&(Kt=Ze.getMaxCascadeForTile($t.toUnwrapped())===0);const En=g.isTileAffectedByFog($t),Un=sn.programConfigurations.get(f.id),In=g.getOrCreateProgram(yt,{config:Un,defines:Kt?Ct:Ye,overrideFog:En});if(g.terrain&&g.terrain.setupElevationDraw(Gt,In,{useMeterToDem:!0}),!sn.centroidVertexBuffer){const Zn=In.attributes.a_centroid_pos;Zn!==void 0&&z.vertexAttrib2f(Zn,0,0)}!_t&&Ze&&Ze.setupShadows(Gt.tileID.toUnwrapped(),In,"vector-tile",Gt.tileID.overscaledZ),W&&(g.context.activeTexture.set(z.TEXTURE0),Gt.imageAtlasTexture&&Gt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Un.updatePaintBuffers());const Gn=V.constantOr(null);if(Gn&&Gt.imageAtlas){const Zn=Gt.imageAtlas.patternPositions[Gn.toString()];Zn&&Un.setConstantPatternPositions(Zn)}const dr=f.paint.get("fill-extrusion-vertical-gradient"),Xr=1/sn.tileToMeter;let Nr;if(_t&&Ze){if(Il(Gt.tileID,sn,g))continue;const Zn=Ze.calculateShadowPassMatrixFromTile(Gt.tileID.toUnwrapped());Nr=hc(Zn,we,Ve,Xr,We)}else{const Zn=g.translatePosMatrix($t.expandedProjMatrix,Gt,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Jn=B.projection.createInversionMatrix(B,$t.canonical);Nr=W?md(Zn,g,dr,X,ae,we,Ve,Xr,$t,Gt,ye,Ie,Ce,Jn,Ne,We):os(Zn,g,dr,X,ae,we,Ve,Xr,$t,ye,Ie,Ce,Jn,Ne,We,Fe,je,et)}g.uploadCommonUniforms(O,In,$t.toUnwrapped(),null,Re);let mr=sn.segments;if(B.projection.name==="mercator"&&!_t&&(mr=sn.getVisibleSegments(Gt.tileID,g.terrain,g.transform.getFrustum(0)),!mr.get().length))continue;if(xt)if(_t)for(const Zn of mr.get())xt.numRenderedVerticesInShadowPass+=Zn.primitiveLength;else for(const Zn of mr.get())xt.numRenderedVerticesInTransparentPass+=Zn.primitiveLength;const zr=[];(g.terrain||A)&&zr.push(sn.centroidVertexBuffer),Me&&zr.push(sn.layoutVertexExtBuffer),Be&&zr.push(sn.wallVertexBuffer),In.draw(g,O.gl.TRIANGLES,b,T,S,a.ag.backCCW,Nr,f.id,sn.layoutVertexBuffer,sn.indexBuffer,mr,f.paint,g.transform.zoom,Un,zr)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}function vd(g,l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe,ae,ce,be){const we=g.context,ye=we.gl,Me=g.transform,Ie=g.transform.zoom,Ce=[],Ne=zs(g,f.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(Ce.push("CLEAR_SUBPASS"),be&&(Ce.push("CLEAR_FROM_TEXTURE"),we.activeTexture.set(ye.TEXTURE0),be.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):z==="sdf"&&Ce.push("SDF_SUBPASS"),ae&&Ce.push("HAS_CENTROID"),Ne.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF");const Fe=f.layout.get("fill-extrusion-edge-radius"),We=(Be,Re,et,Ye,Ve)=>{const Ct=Re.programConfigurations.get(f.id),_t=g.isTileAffectedByFog(Be),Ze=g.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ct,defines:Ce,overrideFog:_t}),ot=((yt,xt,$t,Gt,sn,Kt,En,Un,In,Gn,dr)=>({u_matrix:xt,u_opacity:$t,u_ao_pass:Gt?1:0,u_meter_to_tile:sn,u_ao:Kt,u_flood_light_intensity:En,u_flood_light_color:Un,u_attenuation:In,u_edge_radius:Gn,u_fb:0,u_fb_size:dr}))(0,Ye,B,O,Ve,[V,W*Ve],X,se,oe,Ie>=17?0:Fe*Ve,be?be.size[0]:0),je=[];ae&&je.push(Re.hiddenByLandmarkVertexBuffer),g.uploadCommonUniforms(we,Ze,Be.toUnwrapped(),null,Ne),Ze.draw(g,we.gl.TRIANGLES,b,T,S,A,ot,f.id,Re.vertexBuffer,Re.indexBuffer,et,f.paint,Ie,Ct,je)};for(const Be of y){const Re=l.getTile(Be),et=Re.getBucket(f);if(!et||et.projection.name!==Me.projection.name||!et.groundEffect||et.groundEffect&&!et.groundEffect.hasData())continue;const Ye=et.groundEffect,Ve=1/et.tileToMeter;{const Ct=g.translatePosMatrix(Be.projMatrix,Re,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),_t=Ye.getDefaultSegment();We(Be,Ye,_t,Ct,Ve)}if(ce)for(let Ct=0;Ct<4;Ct++){const _t=a.b$[Ct](Be),Ze=l.getTile(_t);if(!Ze)continue;const ot=Ze.getBucket(f);if(!ot||ot.projection.name!==Me.projection.name||!ot.groundEffect||ot.groundEffect&&!ot.groundEffect.hasData())continue;const je=ot.groundEffect;let yt,xt;Ct===0?(yt=[-a.a4,0,0],xt=1):Ct===1?(yt=[a.a4,0,0],xt=0):Ct===2?(yt=[0,-a.a4,0],xt=3):(yt=[0,a.a4,0],xt=2);const $t=je.regionSegments[xt];if(!$t)continue;const Gt=new Float32Array(16);a.ae.translate(Gt,Be.projMatrix,yt),We(Be,je,$t,g.translatePosMatrix(Gt,Re,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Ve)}}}function _A(g,l,f,y,b,T,S){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const A=T?T.findDEMTileFor(f):null;if(!(A&&A.dem||S))return;const O=ce=>new a.P(Math.ceil((ce+a.c2)*a.c3),0),z=ce=>{const be=l.getSource().minzoom,we=Me=>{const Ie=l.getTileByID(Me);if(Ie&&Ie.hasData())return Ie.getBucket(b)},ye=[0,-1,1];for(const Me of ye){if(ce.overscaledZ+Me<be)continue;const Ie=we(ce.calculateScaledKey(ce.overscaledZ+Me));if(Ie)return Ie}},B=[0,0,0],V=(ce,be)=>(B[0]=Math.min(ce.min.y,be.min.y),B[1]=Math.max(ce.max.y,be.max.y),B[2]=a.a4-be.min.x>ce.max.x?be.min.x-a.a4:ce.max.x,B),W=(ce,be)=>(B[0]=Math.min(ce.min.x,be.min.x),B[1]=Math.max(ce.max.x,be.max.x),B[2]=a.a4-be.min.y>ce.max.y?be.min.y-a.a4:ce.max.y,B),X=[(ce,be)=>V(ce,be),(ce,be)=>V(be,ce),(ce,be)=>W(ce,be),(ce,be)=>W(be,ce)],se=(ce,be,we,ye,Me,Ie,Ce)=>{if(!T)return 0;const Ne=[[Ie?we:ce,Ie?ce:we,0],[Ie?we:be,Ie?be:we,0]],Fe=Ce<0?a.a4+Ce:Ce,We=[Ie?Fe:(ce+be)/2,Ie?(ce+be)/2:Fe,0];return we===0&&Ce<0||we!==0&&Ce>0?T.getForTilePoints(Me,[We],!0,ye):Ne.push(We),T.getForTilePoints(f,Ne,!0,A),Math.max(Ne[0][2],Ne[1][2],We[2])/T.exaggeration()};for(let ce=0;ce<4;ce++){const be=y.borderFeatureIndices[ce];if(be.length===0)continue;const we=a.b$[ce](f),ye=z(we);if(!(ye&&ye instanceof a.c0)||y.borderDoneWithNeighborZ[ce]===ye.canonical.z)continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const Me=T?T.findDEMTileFor(we):null;if(!(Me&&Me.dem||S))continue;const Ie=(ce<2?1:5)-ce,Ce=ye.borderDoneWithNeighborZ[Ie]!==y.canonical.z,Ne=ye.borderFeatureIndices[Ie];let Fe=0;if(y.canonical.z!==ye.canonical.z){for(const We of be)y.showCentroid(y.featuresOnBorder[We]);if(Ce)for(const We of Ne)ye.showCentroid(ye.featuresOnBorder[We]);y.borderDoneWithNeighborZ[ce]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ie]=y.canonical.z}for(const We of be){const Be=y.featuresOnBorder[We],Re=y.centroidData[Be.centroidDataIndex],et=Be.borders[ce];let Ye;for(;Fe<Ne.length;){Ye=ye.featuresOnBorder[Ne[Fe]];const Ve=Ye.borders[Ie];if(Ve[1]>et[0]+3||Ve[0]>et[0]-3)break;ye.showCentroid(Ye),Fe++}if(Ye&&Fe<Ne.length){const Ve=Fe;let Ct=0;for(;!(Ye.borders[Ie][0]>et[1]-3)&&(Ct++,++Fe!==Ne.length);)Ye=ye.featuresOnBorder[Ne[Fe]];if(Ye=ye.featuresOnBorder[Ne[Ve]],Ct>1){const ot=Ye.borders[Ie];Math.abs(et[0]-ot[0])<3&&Math.abs(et[1]-ot[1])<3&&(Ct=1,Fe=Ve+1)}else if(Ct===0){y.showCentroid(Be);continue}const _t=ye.centroidData[Ye.centroidDataIndex];S&&Ct===1&&(((oe=Re).flags|(ae=_t).flags)&a.c1?(oe.flags|=a.c1,ae.flags|=a.c1):(oe.flags&=~a.c1,ae.flags&=~a.c1));const Ze=Be.intersectsCount()>1||Ye.intersectsCount()>1;if(Ct>1)Fe=Ve,Re.centroidXY=_t.centroidXY=new a.P(0,0);else if(Me&&Me.dem&&!Ze){const ot=X[ce](Re,_t),je=ce%2?a.a4-1:0,yt=se(ot[0],Math.min(a.a4-1,ot[1]),je,Me,we,ce<2,ot[2]);Re.centroidXY=_t.centroidXY=O(yt)}else Ze?Re.centroidXY=_t.centroidXY=new a.P(0,0):(Re.centroidXY=y.encodeBorderCentroid(Be),_t.centroidXY=ye.encodeBorderCentroid(Ye));y.writeCentroidToBuffer(Re),ye.writeCentroidToBuffer(_t)}else y.showCentroid(Be)}y.borderDoneWithNeighborZ[ce]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ie]=y.canonical.z}var oe,ae;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(g)}const Lb=[1,0,0],yA=[0,1,0],_g=[0,0,1];function Il(g,l,f){const y=f.transform,b=f.shadowRenderer;if(!b)return!0;const T=g.toUnwrapped(),S=y.tileSize*b._cascades[f.currentShadowCascade].scale;let A=l.maxHeight;if(y.elevation){const oe=y.elevation.getMinMaxForTile(g);oe&&(A+=oe.max)}const O=[...b.shadowDirection];O[2]=-O[2];const z=b.computeSimplifiedTileShadowVolume(T,A,S,O);if(!z)return!1;const B=[Lb,yA,_g,O,[O[0],0,O[2]],[0,O[1],O[2]]],V=y.projection.name==="globe",W=y.scaleZoom(S),X=a.aM.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,W,!V),se=b.getCurrentCascadeFrustum();return X.intersectsPrecise(z.vertices,z.planes,B)===0||se.intersectsPrecise(z.vertices,z.planes,B)===0}function up(g){return[g[0]*a.c4,g[1]*a.c4,g[2]*a.c4,0]}function yg(g,l,f,y,b,T,S,A,O){const z=y.getSource(),B=f.globeSharedBuffers;if(!B)return;let V,W,X;if(l&&(V=y.getTile(l)),z instanceof a.bo?(W=z.texture,X=a.bj(0,0,f.transform)):V&&l&&(W=V.texture,X=a.bj(l.canonical.z,l.canonical.x,f.transform)),!W||!X)return;g||(X=a.ae.scale(a.ae.create(),X,[1,-1,1]));const se=f.context,oe=se.gl,ae=b.paint.get("raster-resampling")==="nearest"?oe.NEAREST:oe.LINEAR,ce=f.colorModeForDrapableLayerRenderPass(T),be=S.defines;be.push("GLOBE_POLES");const we=new a.af(oe.LEQUAL,a.af.ReadWrite,f.depthRangeFor3D),ye=Float32Array.from(f.transform.expandedFarZProjMatrix),Me=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0))));f.terrain&&f.terrain.prepareDrawTile(),se.activeTexture.set(oe.TEXTURE0),W.bind(ae,oe.CLAMP_TO_EDGE),se.activeTexture.set(oe.TEXTURE1),W.bind(ae,oe.CLAMP_TO_EDGE),W.useMipmap&&se.extTextureFilterAnisotropic&&f.transform.pitch>20&&oe.texParameterf(oe.TEXTURE_2D,se.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,se.extTextureFilterAnisotropicMax);const[Ie,Ce,Ne,Fe]=l?B.getPoleBuffers(l.canonical.z,!1):B.getPoleBuffers(0,!0),We=b.paint.get("raster-elevation");let Be;g?(Be=Ie,f.renderDefaultNorthPole=We!==0):(Be=Ce,f.renderDefaultSouthPole=We!==0);const Re=up(S.mix),et=((Ve,Ct,_t,Ze,ot,je,yt,xt,$t,Gt,sn,Kt,En)=>gg(Ve,Ct,_t,new Float32Array(16),new Float32Array(9),[0,0],Ze,[0,0],[0,0,0,0],1,{opacity:1,mix:0},je,[0,0],xt,2,Gt,sn,Kt,1,0,En))(ye,Me,X,a.a2(f.transform.zoom),0,b,0,We,0,Re,S.offset,S.range,T),Ye=f.getOrCreateProgram("raster",{defines:be});f.uploadCommonUniforms(se,Ye,null),Ye.draw(f,oe.TRIANGLES,we,O,ce,A,et,b.id,Be,Ne,Fe)}function _0(g){const l=g._nearZ,f=g.projection.farthestPixelDistance(g),y=f-l,b=.2*g.height,T=l+b;return[l,f,(T-b-l)/y,(T-l)/y]}function oh(g,l,f,y){if(g)return l instanceof R&&g instanceof a.c5?l.getTextureDescriptor(g,f,!0):{texture:g.texture,mix:up(y.mix),offset:y.offset,buffer:0,tileSize:1}}function zb(g,l,f){if(!g)return null;const y=l.getTextureDescriptor(g,f,!0);if(!y)return null;let{texture:b,mix:T,offset:S,tileSize:A,buffer:O,format:z}=y;if(!b||!z)return null;let B=!1;return z==="uint32"&&(B=!0,T[3]=0,T=u0(a.c6,T,[0,f.paint.get("raster-particle-max-speed")]),S=ip(a.c6,S,[0,f.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[O/(A+2*O),A/(A+2*O)],tileSize:A,scalarData:B,scale:T,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function vg(g){const l=g._nearZ,f=g.projection.farthestPixelDistance(g),y=f-l,b=.2*g.height,T=l+b;return[l,f,(T-b-l)/y,(T-l)/y]}const y0=new a.C(1,0,0,1),xg=new a.C(0,1,0,1),v0=new a.C(0,0,1,1),Sr=new a.C(1,0,1,1),vA=new a.C(0,1,1,1);function Sn(g,l,f,y,b,T,S){const A=g.context,O=g.transform,z=A.gl,B=O.projection.name==="globe",V=B?["PROJECTION_GLOBE_VIEW"]:[];let W=a.ae.clone(f.projMatrix);if(B&&a.a2(O.zoom)>0){const Re=a.c7(f.canonical,O),et=a.c8(Re);W=a.ae.multiply(new Float32Array(16),O.globeMatrix,et),a.ae.multiply(W,O.projMatrix,W)}const X=a.ae.create();X[12]+=2*b/(a.e.devicePixelRatio*O.width),X[13]+=2*T/(a.e.devicePixelRatio*O.height),a.ae.multiply(W,X,W);const se=g.getOrCreateProgram("debug",{defines:V}),oe=l.getTileByID(f.key);g.terrain&&g.terrain.setupElevationDraw(oe,se);const ae=a.af.disabled,ce=a.ah.disabled,be=g.colorModeForRenderPass(),we="$debug";A.activeTexture.set(z.TEXTURE0),g.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),B?oe._makeGlobeTileDebugBuffers(g.context,O):oe._makeDebugTileBoundsBuffers(g.context,O.projection);const ye=oe._tileDebugBuffer||g.debugBuffer,Me=oe._tileDebugIndexBuffer||g.debugIndexBuffer,Ie=oe._tileDebugSegments||g.debugSegments;if(se.draw(g,z.LINE_STRIP,ae,ce,be,a.ag.disabled,mg(W,y),we,ye,Me,Ie,null,null,null,[oe._globeTileDebugBorderBuffer]),S){const Re=oe.latestRawTileData,et=Math.floor((Re&&Re.byteLength||0)/1024);let Ye=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Ye+=` => ${f.overscaledZ}`),Ye+=` ${oe.state}`,Ye+=` ${et}kb`,function(Ve,Ct){Ve.initDebugOverlayCanvas();const _t=Ve.debugOverlayCanvas,Ze=Ve.context.gl,ot=Ve.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,_t.width,_t.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(Ct,5,5),ot.strokeText(Ct,5,5),Ve.debugOverlayTexture.update(_t),Ve.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(g,Ye)}const Ce=l.getTile(f).tileSize,Ne=512/Math.min(Ce,512)*(f.overscaledZ/O.zoom)*.5,Fe=oe._tileDebugTextBuffer||g.debugBuffer,We=oe._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Be=oe._tileDebugTextSegments||g.debugSegments;se.draw(g,z.TRIANGLES,ae,ce,a.a.alphaBlended,a.ag.disabled,mg(W,a.C.transparent,Ne),we,Fe,We,Be,null,null,null,[oe._globeTileDebugTextBuffer])}function x0(g,l,f,y){xd(g,0,l+f/2,g.transform.width,f,y)}function hp(g,l,f,y){xd(g,l-f/2,0,f,g.transform.height,y)}function xd(g,l,f,y,b,T){const S=g.context,A=S.gl;A.enable(A.SCISSOR_TEST),A.scissor(l*a.e.devicePixelRatio,f*a.e.devicePixelRatio,y*a.e.devicePixelRatio,b*a.e.devicePixelRatio),S.clear({color:T}),A.disable(A.SCISSOR_TEST)}const Cl=a.c9([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:b0}=Cl;function ia(g,l,f,y){g.emplaceBack(l,f,y)}class en{constructor(l){this.vertexArray=new a.ca,this.indices=new a.bw,ia(this.vertexArray,-1,-1,1),ia(this.vertexArray,1,-1,1),ia(this.vertexArray,-1,1,1),ia(this.vertexArray,1,1,1),ia(this.vertexArray,-1,-1,-1),ia(this.vertexArray,1,-1,-1),ia(this.vertexArray,-1,1,-1),ia(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,b0),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=a.b.simpleSegment(0,0,36,12)}}function yr(g,l,f,y,b,T){const S=g.context.gl,A=l.paint.get("sky-atmosphere-color"),O=l.paint.get("sky-atmosphere-halo-color"),z=l.paint.get("sky-atmosphere-sun-intensity"),B=((V,W,X,se,oe)=>({u_matrix_3f:V,u_sun_direction:W,u_sun_intensity:X,u_color_tint_r:[se.r,se.g,se.b,se.a],u_color_tint_m:[oe.r,oe.g,oe.b,oe.a],u_luminance:5e-5}))(a.bE.fromMat4(a.bE.create(),y),b,z,A,O);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+T,l.skyboxTexture,0),f.draw(g,S.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.frontCW,B,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Cr=a.c9([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ia{constructor(l){const f=new a.cb;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const y=new a.bw;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(f,Cr.members),this.indexBuffer=l.createIndexBuffer(y),this.segments=a.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const bd=a.c9([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class wr{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class bg{constructor(l){this.colorModeAlphaBlendedWriteRGB=new a.a([a.cc,a.cd,a.cc,a.cd],a.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new a.a([a.cc,a.ce,a.cc,a.ce],a.C.transparent,[!1,!1,!1,!0]),this.params=new wr,this.updateNeeded=!0,l.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),l.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),l.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(l){const f=l.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ia(f);const y=this.params.sizeRange,b=this.params.intensityRange,T=function(B){const V=a.ch(30),W=[];for(let X=0;X<B;++X){const se=2*Math.PI*V(),oe=Math.acos(1-2*V())-.5*Math.PI;W.push(a.$.fromValues(Math.cos(oe)*Math.cos(se),Math.cos(oe)*Math.sin(se),Math.sin(oe)))}return W}(this.params.starsCount),S=a.ch(300),A=new a.cf,O=new a.bw;let z=0;for(let B=0;B<T.length;++B){const V=a.$.scale([],T[B],200),W=Math.max(0,1+.01*y*(1*S()-.5)),X=Math.max(0,1+.01*b*(1*S()-.5));A.emplaceBack(V[0],V[1],V[2],-1,-1,W,X),A.emplaceBack(V[0],V[1],V[2],1,-1,W,X),A.emplaceBack(V[0],V[1],V[2],1,1,W,X),A.emplaceBack(V[0],V[1],V[2],-1,1,W,X),O.emplaceBack(z+0,z+1,z+2),O.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=f.createVertexBuffer(A,bd.members),this.starsIdx=f.createIndexBuffer(O),this.starsSegments=a.b.simpleSegment(0,0,A.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(l,f){const y=l.context,b=y.gl,T=l.transform,S=new a.af(b.LEQUAL,a.af.ReadOnly,[0,1]),A=a.a2(T.zoom),O=l.style.getLut(f.scope),z=f.properties.get("color").toRenderColor(O).toArray01(),B=f.properties.get("high-color").toRenderColor(O).toArray01(),V=f.properties.get("space-color").toRenderColor(O).toArray01PremultipliedAlpha(),W=5e-4,X=a.cg(f.properties.get("horizon-blend"),0,1,W,.25),se=a.bc(l,y,T)&&X===W?T.worldSize/(2*Math.PI*1.025)-1:T.globeRadius,oe=l.frameCounter/1e3%1,ae=a.$.length(T.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(ae,2)-Math.pow(se,2)),be=Math.acos(ce/ae),we=ye=>{const Me=T.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ye&&Me.push("ALPHA_PASS");const Ie=l.getOrCreateProgram("globeAtmosphere",{defines:Me}),Ce=((Fe,We,Be,Re,et,Ye,Ve,Ct,_t,Ze,ot,je)=>({u_frustum_tl:Fe,u_frustum_tr:We,u_frustum_br:Be,u_frustum_bl:Re,u_horizon:et,u_transition:Ye,u_fadeout_range:Ve,u_color:Ct,u_high_color:_t,u_space_color:Ze,u_temporal_offset:ot,u_horizon_angle:je}))(T.frustumCorners.TL,T.frustumCorners.TR,T.frustumCorners.BR,T.frustumCorners.BL,T.frustumCorners.horizon,A,X,z,B,V,oe,be);l.uploadCommonUniforms(y,Ie);const Ne=this.atmosphereBuffer;Ne&&Ie.draw(l,b.TRIANGLES,S,a.ah.disabled,ye?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,a.ag.backCW,Ce,ye?"atmosphere_glow_alpha":"atmosphere_glow",Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)};we(!1),we(!0)}drawStars(l,f){const y=a.au(f.properties.get("star-intensity"),0,1);if(y===0)return;const b=l.context,T=b.gl,S=l.transform,A=l.getOrCreateProgram("stars"),O=a.aw.identity([]);a.aw.rotateX(O,O,-S._pitch),a.aw.rotateZ(O,O,-S.angle),a.aw.rotateX(O,O,a.ac(S._center.lat)),a.aw.rotateY(O,O,-a.ac(S._center.lng));const z=a.ae.fromQuat(new Float32Array(16),O),B=a.ae.multiply([],S.starsProjMatrix,z),V=a.bE.fromMat4([],z),W=a.bE.invert([],V),X=[0,1,0];a.$.transformMat3(X,X,W),a.$.scale(X,X,this.params.sizeMultiplier);const se=[1,0,0];a.$.transformMat3(se,se,W),a.$.scale(se,se,this.params.sizeMultiplier);const oe=(ae=X,ce=se,be=y,{u_matrix:Float32Array.from(B),u_up:ae,u_right:ce,u_intensity_multiplier:be});var ae,ce,be;l.uploadCommonUniforms(b,A),this.starsVx&&this.starsIdx&&A.draw(l,T.TRIANGLES,a.af.disabled,a.ah.disabled,this.colorModeAlphaBlendedWriteRGB,a.ag.disabled,oe,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function wd(g,l){const f=[...g],y=l.cameraWorldSizeForFog/l.worldSize,b=a.ae.identity([]);return a.ae.scale(b,b,[y,y,1]),a.ae.multiply(f,b,f),a.ae.multiply(f,l.worldToFogMatrix,f),f}function ah(g,l,f,y,b){const T=f.material,S=y.context,{baseColorTexture:A,metallicRoughnessTexture:O}=T.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:B,emissionTexture:V}=T;function W(X,se,oe){if(X&&(g.push(se),S.activeTexture.set(S.gl.TEXTURE0+oe),X.gfxTexture)){const{minFilter:ae,magFilter:ce,wrapS:be,wrapT:we}=X.sampler;X.gfxTexture.bindExtraParam(ae,ce,be,we)}}W(A,"HAS_TEXTURE_u_baseColorTexture",Cs.BaseColor),W(O,"HAS_TEXTURE_u_metallicRoughnessTexture",Cs.MetallicRoughness),W(z,"HAS_TEXTURE_u_normalTexture",Cs.Normal),W(B,"HAS_TEXTURE_u_occlusionTexture",Cs.Occlusion),W(V,"HAS_TEXTURE_u_emissionTexture",Cs.Emission),b&&(b.texture||(b.texture=new a.cj(y.context,b.image,[b.image.height,b.image.height,b.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Cs.LUT),b.texture&&b.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),f.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),l.push(f.texcoordBuffer)),f.colorBuffer&&(g.push(f.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),l.push(f.colorBuffer)),f.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),l.push(f.normalBuffer)),f.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),l.push(f.pbrBuffer)),T.alphaMode!=="OPAQUE"&&T.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),T.defined||g.push("DIFFUSE_SHADED"),g.push("USE_STANDARD_DERIVATIVES")}function to(g,l,f,y,b,T){const S=f.paint.get("model-opacity"),A=l.context,O=new a.af(l.context.gl.LEQUAL,a.af.ReadWrite,l.depthRangeFor3D),z=l.transform,B=g.mesh,V=B.material,W=V.pbrMetallicRoughness,X=l.style.fog;let se;se=l.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:a.ae.multiply([],y.zScaleMatrix,g.nodeModelMatrix),a.ae.multiply(se,y.negCameraPosMatrix,se);const oe=a.ae.invert([],se);a.ae.transpose(oe,oe);const ae=f.paint.get("model-emissive-strength").constantOr(0),ce=rh(new Float32Array(g.worldViewProjection),new Float32Array(se),new Float32Array(oe),null,l,S,W.baseColorFactor.toRenderColor(null),V.emissiveFactor,W.metallicFactor,W.roughnessFactor,V,ae,f),be={defines:[]},we=[];ah(be.defines,we,B,l,f.lut);const ye=l.shadowRenderer;ye&&(ye.useNormalOffset=!1);let Me=null;if(X){const Ne=wd(g.nodeModelMatrix,l.transform);if(Me=new Float32Array(Ne),z.projection.name!=="globe"){const Fe=B.aabb.min,We=B.aabb.max,[Be,Re]=X.getOpacityForBounds(Ne,Fe[0],Fe[1],We[0],We[1]);be.overrideFog=Be>=_r||Re>=_r}}const Ie=zs(l,f.paint.get("model-cutoff-fade-range"));Ie.shouldRenderCutoff&&be.defines.push("RENDER_CUTOFF");const Ce=l.getOrCreateProgram("model",be);l.uploadCommonUniforms(A,Ce,null,Me,Ie),l.renderPass!=="shadow"&&ye&&ye.setupShadowsFromMatrix(g.nodeModelMatrix,Ce),Ce.draw(l,A.gl.TRIANGLES,O,b,T,B.material.doubleSided?a.ag.disabled:a.ag.backCCW,ce,f.id,B.vertexBuffer,B.indexBuffer,B.segments,f.paint,l.transform.zoom,void 0,we)}function ki(g,l,f,y,b,T,S){let A;A=g.projection.name==="globe"?a.ck(f,g):[...f],a.ae.multiply(A,A,l.matrix);const O=a.ae.multiply([],y,A);if(l.meshes)for(const z of l.meshes){if(z.material.alphaMode!=="BLEND"){S.push({mesh:z,depth:0,modelIndex:b,worldViewProjection:O,nodeModelMatrix:A});continue}const B=a.$.transformMat4([],z.centroid,O);B[2]>0&&T.push({mesh:z,depth:B[2],modelIndex:b,worldViewProjection:O,nodeModelMatrix:A})}if(l.children)for(const z of l.children)ki(g,z,f,y,b,T,S)}function w0(g,l,f,y){const b=f.shadowRenderer;if(!b)return;const T=b.getShadowPassDepthMode(),S=b.getShadowPassColorMode(),A=b.calculateShadowPassMatrixFromMatrix(l),O=p0(A);f.getOrCreateProgram("modelDepth",{defines:f._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(f,f.context.gl.TRIANGLES,T,a.ah.disabled,S,a.ag.backCCW,O,y.id,g.vertexBuffer,g.indexBuffer,g.segments,y.paint,f.transform.zoom,void 0,void 0)}function dp(g,l,f){const y=l.updateZoomBasedPaintProperties(),b=function(T,S,A){let O,z,B,V=T.terrain?T.terrain.exaggeration():0;if(T.terrain&&V>0){const W=T.terrain,X=W.findDEMTileFor(A);X&&X.dem?O=a.cm.create(W,A,X):V=0}if(V===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),V===S.validForExaggeration&&(V===0||O&&O._demTile&&O._demTile.tileID===S.validForDEMTile.id&&O._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const W in S.instancesPerModel){const X=S.instancesPerModel[W];for(let se=0;se<X.instancedDataArray.length;++se){const oe=(O?V*O.getElevationAt(0|X.instancedDataArray.float32[16*se],0|X.instancedDataArray.float32[16*se+1],!0,!0):0)+X.instancesEvaluatedElevation[se];X.instancedDataArray.float32[16*se+6]=oe,z=z?Math.min(S.terrainElevationMin,oe):oe,B=B?Math.max(S.terrainElevationMax,oe):oe}}return S.terrainElevationMin=z||0,S.terrainElevationMax=B||0,S.validForExaggeration=V,S.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(g,l,f);(y||b)&&(l.uploaded=!1,l.upload(g.context))}const Ca={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.b8([0,0,0],[a.a4,a.a4,0])};function fp(g,l){const f=1<<g.canonical.z,y=l.getFreeCameraOptions().position,b=l.elevation,T=g.canonical.x/f,S=(g.canonical.x+1)/f,A=g.canonical.y/f,O=(g.canonical.y+1)/f;let z=l._centerAltitude;if(b){const X=b.getMinMaxForTile(g);X&&X.max>z&&(z=X.max)}const B=a.au(y.x,T,S)-y.x,V=a.au(y.y,A,O)-y.y,W=a.ay(z,l.center.lat)-y.z;return l._zoomFromMercatorZ(Math.sqrt(B*B+V*V+W*W))}function wg(g,l,f,y,b,T,S){const A=g.context,O=g.renderPass==="shadow",z=g.shadowRenderer,B=O&&z?z.getShadowPassDepthMode():new a.af(A.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),V=g.isTileAffectedByFog(T);if(f.meshes)for(const W of f.meshes){const X=["MODEL_POSITION_ON_GPU"],se=[];let oe,ae,ce;y.instancedDataArray.length>20&&X.push("INSTANCED_ARRAYS");const be=zs(g,l.paint.get("model-cutoff-fade-range"));if(be.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),O&&z)oe=g.getOrCreateProgram("modelDepth",{defines:X}),ae=p0(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(f.matrix)),ce=z.getShadowPassColorMode();else{ah(X,se,W,g,l.lut),oe=g.getOrCreateProgram("model",{defines:X,overrideFog:V});const ye=W.material,Me=ye.pbrMetallicRoughness,Ie=l.paint.get("model-opacity"),Ce=l.paint.get("model-emissive-strength").constantOr(0);ae=rh(T.expandedProjMatrix,Float32Array.from(f.matrix),new Float32Array(16),null,g,Ie,Me.baseColorFactor.toRenderColor(null),ye.emissiveFactor,Me.metallicFactor,Me.roughnessFactor,ye,Ce,l,b),z&&(S.shadowUniformsInitialized?oe.setShadowUniformValues(A,z.getShadowUniformValues()):(z.setupShadows(T.toUnwrapped(),oe,"model-tile",T.overscaledZ),S.shadowUniformsInitialized=!0)),ce=be.shouldRenderCutoff||Ie<1||ye.alphaMode!=="OPAQUE"?a.a.alphaBlended:a.a.unblended}g.uploadCommonUniforms(A,oe,T.toUnwrapped(),null,be);const we=W.material.doubleSided?a.ag.disabled:a.ag.backCCW;if(y.instancedDataArray.length>20)se.push(y.instancedDataBuffer),oe.draw(g,A.gl.TRIANGLES,B,a.ah.disabled,ce,we,ae,l.id,W.vertexBuffer,W.indexBuffer,W.segments,l.paint,g.transform.zoom,void 0,se,y.instancedDataArray.length);else{const ye=O?"u_instance":"u_normal_matrix";for(let Me=0;Me<y.instancedDataArray.length;++Me)ae[ye]=new Float32Array(y.instancedDataArray.arrayBuffer,64*Me,16),oe.draw(g,A.gl.TRIANGLES,B,a.ah.disabled,ce,we,ae,l.id,W.vertexBuffer,W.indexBuffer,W.segments,l.paint,g.transform.zoom,void 0,se)}}if(f.children)for(const W of f.children)wg(g,l,W,y,b,T,S)}const Tg=[1,-1,1];function go(g,l,f,y){if(!f.modelManager)return!0;const b=f.modelManager;if(!f.shadowRenderer)return!0;const T=f.shadowRenderer,S=l.aabb;let A=!0,O=g.maxHeight;if(O===0){let B=0;for(const V in g.instancesPerModel){const W=b.getModel(V,y);W?B=Math.max(B,Math.max(Math.max(W.aabb.max[0],W.aabb.max[1]),W.aabb.max[2])):A=!1}O=g.maxScale*B*1.41+g.maxVerticalOffset,A&&(g.maxHeight=O)}S.max[2]=O,S.min[2]+=g.terrainElevationMin,S.max[2]+=g.terrainElevationMax,a.$.transformMat4(S.min,S.min,l.tileMatrix),a.$.transformMat4(S.max,S.max,l.tileMatrix);const z=S.intersects(T.getCurrentCascadeFrustum());return f.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=z===2),z===0}function sa(g,l){const f=g.uniformValues.u_cutoff_params[0],y=g.uniformValues.u_cutoff_params[1],b=g.uniformValues.u_cutoff_params[2],T=g.uniformValues.u_cutoff_params[3];return y===f||T===b?1:a.au(((l-f)/(y-f)-b)/(T-b),0,1)}function Nb(g,l,f,y){if(l.pitch<20)return 1;const b=l.getWorldToCameraMatrix(),T=a.ae.multiply([],b,g),S=[...f.min,1];let A=a.aB.transformMat4([],S,T),O=A,z=A;S[1]=f.max[1],A=a.aB.transformMat4([],S,T),O=A[1]<O[1]?A:O,z=A[1]>z[1]?A:z,S[0]=f.max[0],A=a.aB.transformMat4([],S,T),O=A[1]<O[1]?A:O,z=A[1]>z[1]?A:z,S[1]=f.min[1],A=a.aB.transformMat4([],S,T),O=A[1]<O[1]?A:O,z=A[1]>z[1]?A:z;const B=a.au(y[0],0,1),V=100*l.pixelsPerMeter*a.au(y[1],0,1),W=a.au(y[2],0,1),X=a.$.lerp([],O,z,B),se=Math.tan(.5*l.fovX),oe=-X[2]*se;if(V===0)return X[1]<-Math.abs(oe)?W:1;const ae=(-Math.abs(oe)-X[1])/V,ce=(we,ye,Me)=>(1-Me)*we+Me*ye,be=a.au(ce(1,W,ae),W,1);return ce(1,be,a.au((l.pitch-20)/20,0,1))}class Td{}class as{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(l,f,y){{const V=this._storage.get(f.id);if(V)return V.lastUsedFrameIdx=l,V.buf}const b=y.gl,T=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),S=new ArrayBuffer(T),A=new Int16Array(S);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const O=new a.co;for(let V=0;V<T/2;V+=3){const W=A[V],X=A[V+1],se=A[V+2];O.emplaceBack(W,X),O.emplaceBack(X,se),O.emplaceBack(se,W)}const z=y.bindVertexArrayOES.current,B=new Td;return B.buf=new a.I(y,O),B.lastUsedFrameIdx=l,this._storage.set(f.id,B),y.bindVertexArrayOES.set(z),B.buf}update(l){for(const[f,y]of this._storage)l-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(f))}destroy(){for(const[l,f]of this._storage)f.buf.destroy(),this._storage.delete(l)}}class Ka{constructor(l){this.occluderSize=30,this.depthOffset=-1e-4,l.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),l.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Qa={symbol:function(g,l,f,y,b){if(g.renderPass!=="translucent")return;const T=a.ah.disabled,S=g.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(z,B,V,W,X,se,oe){const ae=B.transform,ce=X==="map",be=se==="map";for(const we of z){const ye=W.getTile(we),Me=ye.getBucket(V);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const Ie=a.aE(Me.textSizeData,ae.zoom),Ce=m0(we,Me.getProjection(),ae),Ne=ae.calculatePixelsToTileUnitsMatrix(ye),Fe=Jc(Ce,ye.tileID.canonical,be,ce,ae,Me.getProjection(),Ne),We=Me.hasIconTextFit()&&Me.hasIconData();if(Ie){const Be=Math.pow(2,ae.zoom-ye.tileID.overscaledZ);gA(Me,ce,be,oe,a.bQ,ae,Fe,we,Be,Ie,We)}}}(y,g,f,l,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),b);const A=f.paint.get("icon-opacity").constantOr(1)!==0,O=f.paint.get("text-opacity").constantOr(1)!==0;f.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(A||O)?lp(g,l,f,y,T,S):(A&&lp(g,l,f,y,T,S,{onlyIcons:!0}),O&&lp(g,l,f,y,T,S,{onlyText:!0})),l.map.showCollisionBoxes&&(kb(g,l,f,y,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),kb(g,l,f,y,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,f,y){if(g.renderPass!=="translucent")return;const b=f.paint.get("circle-opacity"),T=f.paint.get("circle-stroke-width"),S=f.paint.get("circle-stroke-opacity"),A=f.layout.get("circle-sort-key").constantOr(1)!==void 0,O=f.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(T.constantOr(1)===0||S.constantOr(1)===0))return;const z=g.context,B=z.gl,V=g.transform,W=g.depthModeForSublayer(0,a.af.ReadOnly),X=a.ah.disabled,se=g.colorModeForDrapableLayerRenderPass(O),oe=V.projection.name==="globe",ae=[a.ak(V.center.lng),a.al(V.center.lat)],ce=[];for(let we=0;we<y.length;we++){const ye=y[we],Me=l.getTile(ye),Ie=Me.getBucket(f);if(!Ie||Ie.projection.name!==V.projection.name)continue;const Ce=Ie.programConfigurations.get(f.id),Ne=a.bT(f),Fe=g.isTileAffectedByFog(ye);oe&&Ne.push("PROJECTION_GLOBE_VIEW"),Ne.push("DEPTH_D24"),g.terrain&&V.depthOcclusionForSymbolsAndCircles&&Ne.push("DEPTH_OCCLUSION");const We=g.getOrCreateProgram("circle",{config:Ce,defines:Ne,overrideFog:Fe}),Be=Ie.layoutVertexBuffer,Re=Ie.globeExtVertexBuffer,et=Ie.indexBuffer,Ye=V.projection.createInversionMatrix(V,ye.canonical),Ve={programConfiguration:Ce,program:We,layoutVertexBuffer:Be,globeExtVertexBuffer:Re,indexBuffer:et,uniformValues:a.bU(g,ye,Me,Ye,ae,f),tile:Me};if(A){const Ct=Ie.segments.get();for(const _t of Ct)ce.push({segments:new a.b([_t]),sortKey:_t.sortKey,state:Ve})}else ce.push({segments:Ie.segments,sortKey:0,state:Ve})}A&&ce.sort((we,ye)=>we.sortKey-ye.sortKey);const be={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const we of ce){const{programConfiguration:ye,program:Me,layoutVertexBuffer:Ie,globeExtVertexBuffer:Ce,indexBuffer:Ne,uniformValues:Fe,tile:We}=we.state,Be=we.segments;g.terrain&&g.terrain.setupElevationDraw(We,Me,be),g.uploadCommonUniforms(z,Me,We.tileID.toUnwrapped()),Me.draw(g,B.TRIANGLES,W,X,se,a.ag.disabled,Fe,f.id,Ie,Ne,Be,f.paint,V.zoom,ye,[Ce])}},heatmap:function(g,l,f,y){if(f.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const b=g.context,T=b.gl,S=a.ah.disabled,A=new a.a([T.ONE,T.ONE,T.ONE,T.ONE],a.C.transparent,[!0,!0,!0,!0]);(function(X,se,oe,ae){const ce=X.gl,be=se.width*ae,we=se.height*ae;X.activeTexture.set(ce.TEXTURE1),X.viewport.set([0,0,be,we]);let ye=oe.heatmapFbo;if(!ye||ye&&(ye.width!==be||ye.height!==we)){ye&&ye.destroy();const Me=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Me),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),ye=oe.heatmapFbo=X.createFramebuffer(be,we,!0,null),function(Ie,Ce,Ne,Fe,We,Be){const Re=Ie.gl;Re.texImage2D(Re.TEXTURE_2D,0,Ie.extRenderToTextureHalfFloat?Re.RGBA16F:Re.RGBA,We,Be,0,Re.RGBA,Ie.extRenderToTextureHalfFloat?Re.HALF_FLOAT:Re.UNSIGNED_BYTE,null),Fe.colorAttachment.set(Ne)}(X,0,Me,ye,be,we)}else ce.bindTexture(ce.TEXTURE_2D,ye.colorAttachment.get()),X.bindFramebuffer.set(ye.framebuffer)})(b,g,f,g.transform.projection.name==="globe"?.5:.25),b.clear({color:a.C.transparent});const O=g.transform,z=O.projection.name==="globe",B=z?["PROJECTION_GLOBE_VIEW"]:[],V=z?a.ag.frontCCW:a.ag.disabled,W=[a.ak(O.center.lng),a.al(O.center.lat)];for(let X=0;X<y.length;X++){const se=y[X];if(l.hasRenderableParent(se))continue;const oe=l.getTile(se),ae=oe.getBucket(f);if(!ae||ae.projection.name!==O.projection.name)continue;const ce=g.isTileAffectedByFog(se),be=ae.programConfigurations.get(f.id),we=g.getOrCreateProgram("heatmap",{config:be,defines:B,overrideFog:ce}),{zoom:ye}=g.transform;g.terrain&&g.terrain.setupElevationDraw(oe,we),g.uploadCommonUniforms(b,we,se.toUnwrapped());const Me=O.projection.createInversionMatrix(O,se.canonical);we.draw(g,T.TRIANGLES,a.af.disabled,S,A,V,Ab(g,se,oe,Me,W,ye,f.paint.get("heatmap-intensity")),f.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,f.paint,g.transform.zoom,be,z?[ae.globeExtVertexBuffer]:null)}b.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),function(b,T){const S=b.context,A=S.gl,O=T.heatmapFbo;if(!O)return;S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,O.colorAttachment.get()),S.activeTexture.set(A.TEXTURE1);let z=T.colorRampTexture;z||(z=T.colorRampTexture=new a.T(S,T.colorRamp,A.RGBA)),z.bind(A.LINEAR,A.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,A.TRIANGLES,a.af.disabled,a.ah.disabled,b.colorModeForRenderPass(),a.ag.disabled,((B,V,W,X)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,T),T.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,T.paint,b.transform.zoom)}(g,f))},line:function(g,l,f,y){if(g.renderPass!=="translucent")return;const b=f.paint.get("line-opacity"),T=f.paint.get("line-width");if(b.constantOr(1)===0||T.constantOr(1)===0)return;const S=f.paint.get("line-emissive-strength"),A=f.paint.get("line-occlusion-opacity"),O=g.context,z=O.gl,B=f.layout.get("line-z-offset"),V=!B.isConstant()||!!B.constantOr(0),W=V?new a.af(g.depthOcclusion?z.GREATER:z.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly),X=g.colorModeForDrapableLayerRenderPass(S),se=g.terrain&&g.terrain.renderingToTexture,oe=se?1:a.e.devicePixelRatio,ae=f.paint.get("line-dasharray"),ce=ae.constantOr(1),be=f.layout.get("line-cap"),we=ae.constantOr(null),ye=be.constantOr(null),Me=f.paint.get("line-pattern"),Ie=Me.constantOr(1),Ce=Me.constantOr(null),Ne=f.paint.get("line-opacity").constantOr(1);let Fe=!Ie&&Ne!==1||g.depthOcclusion&&A>0&&A<1;const We=f.paint.get("line-gradient"),Be=Ie?"linePattern":"line",Re=a.bV(f);let et;if(se&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Fe=!1),A!==0&&g.depthOcclusion){const Ve=f.paint._values["line-opacity"];Ve&&Ve.value&&Ve.value.kind==="constant"?et=Ve.value:a.w(`Occlusion opacity for layer ${f.id} is supported only when line-opacity isn't data-driven.`)}if(V&&(g.forceTerrainMode=!0),!V&&A!==0&&g.terrain&&!se)return void a.w(`Occlusion opacity for layer ${f.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Ye=Fe&&V?g.stencilModeFor3D():a.ah.disabled;for(const Ve of y){const Ct=l.getTile(Ve);if(Ie&&!Ct.patternsLoaded())continue;const _t=Ct.getBucket(f);if(!_t)continue;g.prepareDrawTile();const Ze=_t.programConfigurations.get(f.id),ot=g.isTileAffectedByFog(Ve),je=g.getOrCreateProgram(Be,{config:Ze,defines:V?[...Re,"ELEVATED"]:Re,overrideFog:ot});if(Ce&&Ct.imageAtlas){const Kt=Ct.imageAtlas.patternPositions[Ce.toString()];Kt&&Ze.setConstantPatternPositions(Kt)}if(!Ie&&we&&ye&&Ct.lineAtlas){const Kt=Ct.lineAtlas.getDash(we,ye);Kt&&Ze.setConstantPatternPositions(Kt)}let[yt,xt]=f.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&yt!==xt&&(yt===0&&(yt-=1),xt===1&&(xt+=1));const $t=se?Ve.projMatrix:null,Gt=Ie?a.bW(g,Ct,f,$t,oe,[yt,xt]):a.bX(g,Ct,f,$t,_t.lineClipsArray.length,oe,[yt,xt]);if(We){const Kt=_t.gradients[f.id];let En=Kt.texture;if(f.gradientVersion!==Kt.version){let Un=256;if(f.stepInterpolant){const In=l.getSource().maxzoom,Gn=Ve.canonical.z===In?Math.ceil(1<<g.transform.maxZoom-Ve.canonical.z):1;Un=a.au(a.bY(_t.maxLineLength/a.a4*1024*Gn),256,O.maxTextureSize)}Kt.gradient=a.bZ({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Un,image:Kt.gradient||void 0,clips:_t.lineClipsArray}),Kt.texture?Kt.texture.update(Kt.gradient):Kt.texture=new a.T(O,Kt.gradient,z.RGBA),Kt.version=f.gradientVersion,En=Kt.texture}O.activeTexture.set(z.TEXTURE1),En.bind(f.stepInterpolant?z.NEAREST:z.LINEAR,z.CLAMP_TO_EDGE)}ce&&(O.activeTexture.set(z.TEXTURE0),Ct.lineAtlasTexture&&Ct.lineAtlasTexture.bind(z.LINEAR,z.REPEAT),Ze.updatePaintBuffers()),Ie&&(O.activeTexture.set(z.TEXTURE0),Ct.imageAtlasTexture&&Ct.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ze.updatePaintBuffers()),V&&g.terrain.setupElevationDraw(Ct,je),g.uploadCommonUniforms(O,je,Ve.toUnwrapped());const sn=Kt=>{et!=null&&(et.value=Ne*A),je.draw(g,z.TRIANGLES,W,Kt,X,a.ag.disabled,Gt,f.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,f.paint,g.transform.zoom,Ze,[_t.layoutVertexBuffer2,_t.patternVertexBuffer,_t.zOffsetVertexBuffer]),et!=null&&(et.value=Ne)};if(Fe&&!V){const Kt=g.stencilModeForClipping(Ve).ref;Kt===0&&se&&O.clear({stencil:0});const En={func:z.EQUAL,mask:255};Gt.u_alpha_discard_threshold=.8,sn(new a.ah(En,Kt,255,z.KEEP,z.KEEP,z.INVERT)),Gt.u_alpha_discard_threshold=0,sn(new a.ah(En,Kt,255,z.KEEP,z.KEEP,z.KEEP))}else Fe&&V&&(Gt.u_alpha_discard_threshold=.001),sn(V?Ye:g.stencilModeForClipping(Ve))}Fe&&(g.resetStencilClippingMasks(),se&&O.clear({stencil:0})),A===0||g.depthOcclusion||se||g.layersWithOcclusionOpacity.push(g.currentLayer),V&&(g.forceTerrainMode=!1)},fill:function(g,l,f,y){const b=f.paint.get("fill-color"),T=f.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const S=f.paint.get("fill-emissive-strength"),A=g.colorModeForDrapableLayerRenderPass(S),O=f.paint.get("fill-pattern"),z=g.opaquePassEnabledForLayer()&&!O.constantOr(1)&&b.constantOr(a.C.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(g.renderPass===z){const B=g.depthModeForSublayer(1,g.renderPass==="opaque"?a.af.ReadWrite:a.af.ReadOnly);cp(g,l,f,y,B,A,!1)}if(g.renderPass==="translucent"&&f.paint.get("fill-antialias")){const B=g.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,a.af.ReadOnly);cp(g,l,f,y,B,A,!0)}},"fill-extrusion":function(g,l,f,y){const b=f.paint.get("fill-extrusion-opacity"),T=g.context,S=T.gl,A=g.terrain,O=A&&A.renderingToTexture;if(b===0)return;const z=g.conflationActive&&g.style.isLayerClipped(f,l.getSource()),B=g.style.order.indexOf(f.fqid);if(z&&function(V,W,X,se,oe){for(const ae of se){const ce=W.getTile(ae).getBucket(X);ce&&(ce.updateReplacement(ae,V.replacementSource,oe),ce.uploadCentroid(V.context))}}(g,l,f,y,B),A||z)for(const V of y){const W=l.getTile(V).getBucket(f);W&&_A(g.context,l,V,W,f,A,z)}if(g.renderPass==="shadow"&&g.shadowRenderer){const V=g.shadowRenderer;if(A&&b<.65&&f._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.Z)return;const W=V.getShadowPassDepthMode(),X=V.getShadowPassColorMode();sh(g,l,f,y,W,a.ah.disabled,X,z)}else if(g.renderPass==="translucent"){const V=!f.paint.get("fill-extrusion-pattern").constantOr(1),W=f.paint.get("fill-extrusion-color").constantOr(a.C.white);if(!O&&W.a!==0){const X=new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D);b===1&&V?sh(g,l,f,y,X,a.ah.disabled,a.a.unblended,z):(sh(g,l,f,y,X,a.ah.disabled,a.a.disabled,z),sh(g,l,f,y,X,g.stencilModeFor3D(),g.colorModeForRenderPass(),z),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&V&&(!A&&g.transform.projection.name!=="globe"||O)){const X=f.paint.get("fill-extrusion-opacity"),se=f.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe=f.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ae=f.paint.get("fill-extrusion-flood-light-intensity"),ce=f.paint.get("fill-extrusion-flood-light-color").toRenderColor(f.lut).toArray01().slice(0,3),be=se>0&&oe>0,we=ae>0,ye=(Ie,Ce,Ne)=>(1-Ne)*Ie+Ne*Ce,Me=Ie=>{const Ce=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!0),Ne=f.paint.get(Ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Fe=ye(.1,3,Ne),We=g._showOverdrawInspector;if(!We){const Be=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Re=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);vd(g,l,f,y,Ce,Be,Re,a.ag.disabled,Ie,"sdf",X,se,oe,ae,ce,Fe,z,!1)}{const Be=We?a.ah.disabled:new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Re=We?g.colorModeForRenderPass():new a.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],a.C.transparent,[!0,!0,!0,!0]);vd(g,l,f,y,Ce,Be,Re,a.ag.disabled,Ie,"color",X,se,oe,ae,ce,Fe,z,!1)}};if(O){const Ie=(Ce,Ne,Fe)=>{const We=g.depthModeForSublayer(1,a.af.ReadOnly,S.LEQUAL,!1),Be=f.paint.get(Ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Re=ye(.1,3,Be);{const et=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0]);vd(g,l,f,y,We,a.ah.disabled,et,a.ag.disabled,Ce,"clear",X,se,oe,ae,ce,Re,z,Ne)}{const et=new a.ah({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Ye=new a.a([S.ONE,S.ONE,S.ONE,S.ONE],a.C.transparent,[!1,!1,!1,!0],S.MIN);vd(g,l,f,y,We,et,Ye,a.ag.disabled,Ce,"sdf",X,se,oe,ae,ce,Re,z,Ne)}{const et=Ce?S.ZERO:S.ONE_MINUS_DST_ALPHA,Ye=new a.ah({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ve=new a.a([et,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],a.C.transparent,[!0,!0,!0,!0]);vd(g,l,f,y,We,Ye,Ve,a.ag.disabled,Ce,"color",X,se,oe,ae,ce,Re,z,Ne)}{const et=new a.a([S.ONE,S.ONE,S.ONE,Ce?S.ZERO:S.ONE],a.C.transparent,[!1,!1,!1,!0],Ce?S.FUNC_ADD:S.MAX);vd(g,l,f,y,We,a.ah.disabled,et,a.ag.disabled,Ce,"clear",X,se,oe,ae,ce,Re,z,Ne,Fe)}};if(be||we){let Ce;if(g.prepareDrawTile(),A){const Ne=A.drapeBufferSize[0],Fe=A.drapeBufferSize[1];Ce=A.framebufferCopyTexture,Ce&&(!Ce||Ce.size[0]===Ne&&Ce.size[1]===Fe)||(Ce&&Ce.destroy(),Ce=A.framebufferCopyTexture=new a.T(T,new a.j({width:Ne,height:Fe}),S.RGBA)),Ce.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,Ne,Fe,0)}be&&Ie(!0,!1,Ce),we&&Ie(!1,!0,Ce)}}else be&&Me(!0),we&&Me(!1),(be||we)&&g.resetStencilClippingMasks()}}},hillshade:function(g,l,f,y){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const b=g.context,T=g.terrain&&g.terrain.renderingToTexture,[S,A]=g.renderPass!=="translucent"||T?[{},y]:g.stencilConfigForOverlap(y);for(const O of A){const z=l.getTile(O);if(z.needsHillshadePrepare&&g.renderPass==="offscreen")c0(g,z,f);else if(g.renderPass==="translucent"){const B=g.depthModeForSublayer(0,a.af.ReadOnly),V=f.paint.get("hillshade-emissive-strength"),W=g.colorModeForDrapableLayerRenderPass(V),X=T&&g.terrain?g.terrain.stencilModeForRTTOverlap(O):S[O.overscaledZ];Xc(g,O,z,f,B,X,W)}}b.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,f,y,b,T){if(g.renderPass!=="translucent"||f.paint.get("raster-opacity")===0)return;const S=g.transform.projection.name==="globe",A=f.paint.get("raster-elevation")!==0,O=A&&S;if(g.renderElevatedRasterBackface&&!O)return;const z=g.context,B=z.gl,V=l.getSource(),W=function(Ie,Ce,Ne,Fe){const We=Ce.paint.get("raster-color"),Be=Ie.type==="raster-array",Re=[],et=Ce.paint.get("raster-resampling"),Ye=Ce.paint.get("raster-color-mix");let Ve=Ce.paint.get("raster-color-range");const Ct=[Ye[0],Ye[1],Ye[2],0],_t=Ye[3];let Ze=et==="nearest"?Fe.NEAREST:Fe.LINEAR;if(Be&&(Re.push("RASTER_ARRAY"),We||Re.push("RASTER_COLOR"),et==="linear"&&Re.push("RASTER_ARRAY_LINEAR"),Ze=Fe.NEAREST,!Ve&&Ie.rasterLayers)){const ot=Ie.rasterLayers.find(({id:je})=>je===Ce.sourceLayer);ot&&ot.fields&&ot.fields.range&&(Ve=ot.fields.range)}if(Ve=Ve||[0,1],We){Re.push("RASTER_COLOR"),Ne.activeTexture.set(Fe.TEXTURE2),Ce.updateColorRamp(Ve);let ot=Ce.colorRampTexture;ot||(ot=Ce.colorRampTexture=new a.T(Ne,Ce.colorRamp,Fe.RGBA)),ot.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}return{mix:Ct,range:Ve,offset:_t,defines:Re,resampling:Ze}}(V,f,z,B);if(V instanceof a.bo&&!y.length&&!S)return;const X=f.paint.get("raster-emissive-strength"),se=g.colorModeForDrapableLayerRenderPass(X),oe=g.terrain&&g.terrain.renderingToTexture,ae=!g.options.moving,ce=f.paint.get("raster-resampling")==="nearest"?B.NEAREST:B.LINEAR;if(V instanceof a.bo&&!y.length&&(V.onNorthPole||V.onSouthPole)){const Ie=A?g.stencilModeFor3D():a.ah.disabled;return void yg(!!V.onNorthPole,null,g,l,f,X,W,a.ag.disabled,Ie)}if(!y.length)return;const[be,we]=V instanceof a.bo||oe?[{},y]:g.stencilConfigForOverlap(y),ye=we[we.length-1].overscaledZ;O&&W.defines.push("PROJECTION_GLOBE_VIEW"),A&&W.defines.push("RENDER_CUTOFF");const Me=(Ie,Ce,Ne)=>{for(const Fe of Ie){const We=Fe.toUnwrapped(),Be=l.getTile(Fe);if(oe&&(!Be||!Be.hasData()))continue;z.activeTexture.set(B.TEXTURE0);const Re=oh(Be,V,f,W);if(!Re||!Re.texture)continue;const{texture:et,mix:Ye,offset:Ve,tileSize:Ct,buffer:_t}=Re;let Ze,ot;oe?(Ze=a.af.disabled,ot=Fe.projMatrix):A?(Ze=new a.af(B.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D),ot=S?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(We,ae)):(Ze=g.depthModeForSublayer(Fe.overscaledZ-ye,f.paint.get("raster-opacity")===1?a.af.ReadWrite:a.af.ReadOnly,B.LESS),ot=g.transform.calculateProjMatrix(We,ae));const je=g.terrain&&oe?g.terrain.stencilModeForRTTOverlap(Fe):be[Fe.overscaledZ],yt=T?0:f.paint.get("raster-fade-duration");Be.registerFadeDuration(yt);const xt=l.findLoadedParent(Fe,0),$t=Xa(Be,xt,l,g.transform,yt);let Gt,sn;g.terrain&&g.terrain.prepareDrawTile(),z.activeTexture.set(B.TEXTURE0),et.bind(ce,B.CLAMP_TO_EDGE),z.activeTexture.set(B.TEXTURE1),xt?(xt.texture&&xt.texture.bind(ce,B.CLAMP_TO_EDGE),Gt=Math.pow(2,xt.tileID.overscaledZ-Be.tileID.overscaledZ),sn=[Be.tileID.canonical.x*Gt%1,Be.tileID.canonical.y*Gt%1]):et.bind(ce,B.CLAMP_TO_EDGE),et.useMipmap&&z.extTextureFilterAnisotropic&&g.transform.pitch>20&&B.texParameterf(B.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Kt=g.transform;let En;const Un=A?_0(Kt):[0,0,0,0];let In,Gn,dr,Xr,Nr,mr=0;if(O&&V instanceof a.bo&&V.coordinates.length>3)In=Float32Array.from(a.bh(a.bi(new a.aO(0,0,0)))),Gn=Float32Array.from(Kt.globeMatrix),dr=Float32Array.from(a.bd(Kt)),Xr=[a.ak(Kt.center.lng),a.al(Kt.center.lat)],En=V.elevatedGlobePerspectiveTransform,Nr=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Vn=a.be(Fe.canonical);mr=a.bf(Vn.getCenter().lat),In=Float32Array.from(a.bh(a.bi(Fe.canonical))),Gn=Float32Array.from(Kt.globeMatrix),dr=Float32Array.from(a.bd(Kt)),Xr=[a.ak(Kt.center.lng),a.al(Kt.center.lat)],En=[0,0],Nr=Float32Array.from(a.bg(Fe.canonical,Vn,mr,Kt.worldSize/Kt._pixelsPerMercatorPixel))}else En=V instanceof a.bo?V.perspectiveTransform:[0,0],In=new Float32Array(16),Gn=new Float32Array(9),dr=new Float32Array(16),Xr=[0,0],Nr=new Float32Array(9);const zr=gg(ot,In,Gn,dr,Nr,sn||[0,0],a.a2(g.transform.zoom),Xr,Un,Gt||1,$t,f,En,A?f.paint.get("raster-elevation"):0,2,Ye,Ve,W.range,Ct,_t,X),Zn=g.isTileAffectedByFog(Fe),Jn=g.getOrCreateProgram("raster",{defines:W.defines,overrideFog:Zn});if(g.uploadCommonUniforms(z,Jn,We),V instanceof a.bo){const Vn=V.elevatedGlobeVertexBuffer,br=V.elevatedGlobeIndexBuffer;if(oe||!S)V.boundsBuffer&&V.boundsSegments&&Jn.draw(g,B.TRIANGLES,Ze,a.ah.disabled,se,a.ag.disabled,zr,f.id,V.boundsBuffer,g.quadTriangleIndexBuffer,V.boundsSegments);else if(Vn&&br){const nr=Kt.zoom<=a.b3?V.elevatedGlobeSegments:V.getSegmentsForLongitude(Kt.center.lng);nr&&Jn.draw(g,B.TRIANGLES,Ze,a.ah.disabled,se,Ce,zr,f.id,Vn,br,nr)}}else if(O){Ze=new a.af(B.LEQUAL,a.af.ReadOnly,g.depthRangeFor3D);const Vn=g.globeSharedBuffers;if(Vn){const[br,nr,Rn]=Vn.getGridBuffers(mr,!1);Jn.draw(g,B.TRIANGLES,Ze,Ne||je,g.colorModeForRenderPass(),Ce,zr,f.id,br,nr,Rn)}}else{const{tileBoundsBuffer:Vn,tileBoundsIndexBuffer:br,tileBoundsSegments:nr}=g.getTileBoundsBuffers(Be);Jn.draw(g,B.TRIANGLES,Ze,je,se,a.ag.disabled,zr,f.id,Vn,br,nr)}}if(!(V instanceof a.bo)&&O)for(const Fe of Ie){const We=Fe.canonical.y===(1<<Fe.canonical.z)-1;Fe.canonical.y===0&&yg(!0,Fe,g,l,f,X,W,Ce,Ne||a.ah.disabled),We&&yg(!1,Fe,g,l,f,X,W,Ce===a.ag.frontCW?a.ag.backCW:a.ag.frontCW,Ne||a.ah.disabled)}};O?Me(we,g.renderElevatedRasterBackface?a.ag.backCW:a.ag.frontCW,g.stencilModeFor3D()):Me(we,a.ag.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,l,f,y,b,T){g.renderPass==="offscreen"&&function(S,A,O,z){if(!z.length)return;const B=S.context,V=B.gl,W=A.getSource();if(!(W instanceof R))return;const X=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let se=O.particlePositionRGBAImage;if(!se||se.width!==X){const we=function(ye){const Me=ye*ye,Ie=new Uint8Array(4*Me),Ce=function(Fe){return Fe|=0,Fe=Math.imul(2747636419^Fe,2654435769),Fe=Math.imul(Fe^Fe>>>16,2654435769),((Fe=Math.imul(Fe^Fe>>>16,2654435769))>>>0)/4294967296},Ne=1/1.1;for(let Fe=0;Fe<Me;Fe++){const We=Ne*(Ce(2*Fe+0)+Sl),Be=Ne*(Ce(2*Fe+1)+Sl),Re=255*We%1,et=255*Be%1,Ye=Re,Ve=Be-et/255,Ct=et;Ie[4*Fe+0]=255*(We-Re/255),Ie[4*Fe+1]=255*Ye,Ie[4*Fe+2]=255*Ve,Ie[4*Fe+3]=255*Ct}return Ie}(X);se=O.particlePositionRGBAImage=new a.j({width:X,height:X},we)}let oe=O.particleFramebuffer;oe?oe.width!==X&&(oe.destroy(),oe=O.particleFramebuffer=B.createFramebuffer(X,X,!0,null)):oe=O.particleFramebuffer=B.createFramebuffer(X,X,!0,null);const ae=[];for(const we of z){const ye=A.getTile(we);if(!(ye instanceof a.c5))continue;const Me=zb(ye,W,O);if(!Me)continue;const Ie=[ye.tileSize,ye.tileSize];let Ce=O.tileFramebuffer;Ce||(Ce=O.tileFramebuffer=B.createFramebuffer(Ie[0],Ie[1],!0,null));let Ne=ye.rasterParticleState;Ne||(Ne=ye.rasterParticleState=new ir(B,we,Ie,se));const Fe=Ne.update(O.lastInvalidatedAt);Ne.particleTextureDimension!==X&&Ne.updateParticleTexture(we,se);const We=Ne.targetColorTexture;Ne.targetColorTexture=Ne.backgroundColorTexture,Ne.backgroundColorTexture=We;const Be=Ne.particleTexture0;Ne.particleTexture0=Ne.particleTexture1,Ne.particleTexture1=Be,ae.push([we,Me,Ne,Fe])}if(ae.length===0)return;const ce=a.e.now(),be=O.previousDrawTimestamp?.001*(ce-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=ce,O.hasColorMap()){B.activeTexture.set(V.TEXTURE0+2);let we=O.colorRampTexture;we||(we=O.colorRampTexture=new a.T(B,O.colorRamp,V.RGBA)),we.bind(V.LINEAR,V.CLAMP_TO_EDGE)}B.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(we,ye,Me){const Ie=we.context,Ce=Ie.gl,Ne=ye.tileFramebuffer;Ie.activeTexture.set(Ce.TEXTURE0);const Fe={u_texture:0,u_opacity:1.05*(Be=ye.paint.get("raster-particle-fade-opacity-factor"))/(Be+.05)},We=we.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Be;for(const Re of Me){const[,,et,Ye]=Re;Ne.colorAttachment.set(et.targetColorTexture.texture),Ie.viewport.set([0,0,Ne.width,Ne.height]),Ie.clear({color:a.C.transparent}),Ye&&(et.backgroundColorTexture.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE),We.draw(we,Ce.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,Fe,ye.id,we.viewportBuffer,we.quadTriangleIndexBuffer,we.viewportSegments))}}(S,O,ae),function(we,ye,Me,Ie){const Ce=we.context,Ne=Ce.gl,Fe=Me.tileFramebuffer,We=we.transform.projection.name==="globe",Be=Me.paint.get("raster-particle-max-speed");for(const Re of Ie){const[et,Ye,Ve]=Re;Ce.activeTexture.set(Ne.TEXTURE0+0),Ye.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Fe.colorAttachment.set(Ve.targetColorTexture.texture);const Ct=we.getOrCreateProgram("rasterParticleDraw",{defines:Ye.defines,overrideFog:!1});Ce.activeTexture.set(Ne.TEXTURE0+1);const _t=Ye.scalarData?[]:[0,1,2,3].map(je=>a.b$[je](et));_t.push(et);const Ze=et.canonical.x,ot=et.canonical.y;for(const je of _t){const yt=ye.getTile(We?je.wrapped():je);if(!yt)continue;const xt=yt.rasterParticleState;if(!xt)continue;const $t=je.canonical.x+(1<<je.canonical.z)*(je.wrap-et.wrap),Gt=je.canonical.y;xt.particleTexture0.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const sn=pA(1,xt.particleTexture0.size[0],[$t-Ze,Gt-ot],0,Ye.texture.size,2,Be,Ye.textureOffset,Ye.scale,Ye.offset);Ct.draw(we,Ne.POINTS,a.af.disabled,a.ah.disabled,a.a.alphaBlended,a.ag.disabled,sn,Me.id,xt.particleIndexBuffer,void 0,xt.particleSegment)}}}(S,A,O,ae),B.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(we,ye,Me,Ie){const Ce=we.context,Ne=Ce.gl,Fe=ye.paint.get("raster-particle-max-speed"),We=Ie*ye.paint.get("raster-particle-speed-factor")*.15,Be=function(et){return Math.pow(et,6)}(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),Re=ye.particleFramebuffer;Ce.viewport.set([0,0,Re.width,Re.height]);for(const et of Me){const[,Ye,Ve]=et;Ce.activeTexture.set(Ne.TEXTURE0+0),Ye.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Ce.activeTexture.set(Ne.TEXTURE0+1);const Ct=Ve.particleTexture0;Ct.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const _t=Pb(1,Ct.size[0],0,Ye.texture.size,Fe,We,Be,Ye.textureOffset,Ye.scale,Ye.offset);Re.colorAttachment.set(Ve.particleTexture1.texture),Ce.clear({color:a.C.transparent}),we.getOrCreateProgram("rasterParticleUpdate",{defines:Ye.defines}).draw(we,Ne.TRIANGLES,a.af.disabled,a.ah.disabled,a.a.unblended,a.ag.disabled,_t,ye.id,we.viewportBuffer,we.quadTriangleIndexBuffer,we.viewportSegments)}}(S,O,ae,be)}(g,l,f,y),g.renderPass==="translucent"&&(function(S,A,O,z,B){const V=S.context,W=V.gl,X=A.getSource().tileSize,se=5*(1-a.a0(a.aV,a.aV+1,S.transform.zoom))*X+O.paint.get("raster-particle-elevation"),oe=!S.options.moving,ae=S.transform.projection.name==="globe";if(!z.length)return;const[ce,be]=S.stencilConfigForOverlap(z),we=[];ae&&we.push("PROJECTION_GLOBE_VIEW");const ye=S.stencilModeFor3D();for(const Me of be){const Ie=Me.toUnwrapped(),Ce=A.getTile(Me);if(!Ce.rasterParticleState)continue;const Ne=Ce.rasterParticleState,Fe=100;Ce.registerFadeDuration(Fe);const We=A.findLoadedParent(Me,0),Be=Xa(Ce,We,A,S.transform,Fe);let Re,et;S.terrain&&S.terrain.prepareDrawTile(),V.activeTexture.set(W.TEXTURE0),Ne.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),V.activeTexture.set(W.TEXTURE1),We&&We.rasterParticleState?(We.rasterParticleState.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Re=Math.pow(2,We.tileID.overscaledZ-Ce.tileID.overscaledZ),et=[Ce.tileID.canonical.x*Re%1,Ce.tileID.canonical.y*Re%1]):Ne.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const Ye=ae?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Ie,oe),Ve=S.transform,Ct=vg(Ve),_t=a.be(Me.canonical),Ze=a.bf(_t.getCenter().lat);let ot,je,yt,xt,$t;ae?(ot=Float32Array.from(a.bh(a.bi(Me.canonical))),je=Float32Array.from(Ve.globeMatrix),yt=Float32Array.from(a.bd(Ve)),xt=[a.ak(Ve.center.lng),a.al(Ve.center.lat)],$t=Float32Array.from(a.bg(Me.canonical,_t,Ze,Ve.worldSize/Ve._pixelsPerMercatorPixel))):(ot=new Float32Array(16),je=new Float32Array(9),yt=new Float32Array(16),xt=[0,0],$t=new Float32Array(9));const Gt=nh(Ye,ot,je,yt,$t,et||[0,0],a.a2(S.transform.zoom),xt,Ct,Re||1,Be,se),sn=S.isTileAffectedByFog(Me),Kt=S.getOrCreateProgram("rasterParticle",{defines:we,overrideFog:sn});if(S.uploadCommonUniforms(V,Kt,Ie),ae){const En=new a.af(W.LEQUAL,a.af.ReadOnly,S.depthRangeFor3D),Un=0,In=S.globeSharedBuffers;if(In){const[Gn,dr,Xr]=In.getGridBuffers(Ze,Un!==0);Kt.draw(S,W.TRIANGLES,En,ye,a.a.alphaBlended,S.renderElevatedRasterBackface?a.ag.frontCCW:a.ag.backCCW,Gt,O.id,Gn,dr,Xr)}}else{const En=S.depthModeForSublayer(0,a.af.ReadOnly),Un=ce[Me.overscaledZ],{tileBoundsBuffer:In,tileBoundsIndexBuffer:Gn,tileBoundsSegments:dr}=S.getTileBoundsBuffers(Ce);Kt.draw(S,W.TRIANGLES,En,Un,a.a.alphaBlended,a.ag.disabled,Gt,O.id,In,Gn,dr)}}S.resetStencilClippingMasks()}(g,l,f,y),g.style.map.triggerRepaint())},background:function(g,l,f,y){const b=f.paint.get("background-color"),T=f.paint.get("background-opacity"),S=f.paint.get("background-emissive-strength");if(T===0)return;const A=g.context,O=A.gl,z=g.transform,B=z.tileSize,V=f.paint.get("background-pattern");let W;if(V!==void 0&&(V===null||(W=g.imageManager.getPattern(V.toString(),f.scope,g.style.getLut(f.scope)),!W)))return;const X=!V&&b.a===1&&T===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==X)return;const se=a.ah.disabled,oe=g.depthModeForSublayer(0,X==="opaque"?a.af.ReadWrite:a.af.ReadOnly),ae=g.colorModeForDrapableLayerRenderPass(S),ce=V?"backgroundPattern":"background";let be,we=y;we||(be=g.getBackgroundTiles(),we=Object.values(be).map(ye=>ye.tileID)),V&&(A.activeTexture.set(O.TEXTURE0),g.imageManager.bind(g.context,f.scope));for(const ye of we){const Me=g.isTileAffectedByFog(ye),Ie=g.getOrCreateProgram(ce,{overrideFog:Me}),Ce=ye.toUnwrapped(),Ne=y?ye.projMatrix:g.transform.calculateProjMatrix(Ce);g.prepareDrawTile();const Fe=l?l.getTile(ye):be?be[ye.key]:new a.bA(ye,B,z.zoom,g),We=V?mA(Ne,S,T,g,0,f.scope,W,{tileID:ye,tileSize:B}):f0(Ne,S,T,b.toRenderColor(f.lut));g.uploadCommonUniforms(A,Ie,Ce);const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:Re,tileBoundsSegments:et}=g.getTileBoundsBuffers(Fe);Ie.draw(g,O.TRIANGLES,oe,se,ae,a.ag.disabled,We,f.id,Be,Re,et)}},sky:function(g,l,f){const y=g._atmosphere?a.a2(g.transform.zoom):1,b=f.paint.get("sky-opacity")*y;if(b===0)return;const T=g.context,S=f.paint.get("sky-type"),A=new a.af(T.gl.LEQUAL,a.af.ReadOnly,[0,1]),O=g.frameCounter/1e3%1;S==="atmosphere"?g.renderPass==="offscreen"?f.needsSkyboxCapture(g)&&(function(z,B,V,W){const X=z.context,se=X.gl;let oe=B.skyboxFbo;if(!oe){oe=B.skyboxFbo=X.createFramebuffer(32,32,!0,null),B.skyboxGeometry=new en(X),B.skyboxTexture=X.gl.createTexture(),se.bindTexture(se.TEXTURE_CUBE_MAP,B.skyboxTexture),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_CUBE_MAP,se.TEXTURE_MAG_FILTER,se.LINEAR);for(let we=0;we<6;++we)se.texImage2D(se.TEXTURE_CUBE_MAP_POSITIVE_X+we,0,se.RGBA,32,32,0,se.RGBA,se.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(oe.framebuffer),X.viewport.set([0,0,32,32]);const ae=B.getCenter(z,!0),ce=z.getOrCreateProgram("skyboxCapture"),be=new Float64Array(16);a.ae.identity(be),a.ae.rotateY(be,be,.5*-Math.PI),yr(z,B,ce,be,ae,0),a.ae.identity(be),a.ae.rotateY(be,be,.5*Math.PI),yr(z,B,ce,be,ae,1),a.ae.identity(be),a.ae.rotateX(be,be,.5*-Math.PI),yr(z,B,ce,be,ae,2),a.ae.identity(be),a.ae.rotateX(be,be,.5*Math.PI),yr(z,B,ce,be,ae,3),a.ae.identity(be),yr(z,B,ce,be,ae,4),a.ae.identity(be),a.ae.rotateY(be,be,Math.PI),yr(z,B,ce,be,ae,5),X.viewport.set([0,0,z.width,z.height])}(g,f),f.markSkyboxValid(g)):g.renderPass==="sky"&&function(z,B,V,W,X){const se=z.context,oe=se.gl,ae=z.transform,ce=z.getOrCreateProgram("skybox");se.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_CUBE_MAP,B.skyboxTexture);const be=((we,ye,Me,Ie,Ce)=>({u_matrix:we,u_sun_direction:ye,u_cubemap:0,u_opacity:Ie,u_temporal_offset:Ce}))(ae.skyboxMatrix,B.getCenter(z,!1),0,W,X);z.uploadCommonUniforms(se,ce),ce.draw(z,oe.TRIANGLES,V,a.ah.disabled,z.colorModeForRenderPass(),a.ag.backCW,be,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(g,f,A,b,O):S==="gradient"&&g.renderPass==="sky"&&function(z,B,V,W,X){const se=z.context,oe=se.gl,ae=z.transform,ce=z.getOrCreateProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new en(se)),se.activeTexture.set(oe.TEXTURE0);let be=B.colorRampTexture;be||(be=B.colorRampTexture=new a.T(se,B.colorRamp,oe.RGBA)),be.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const we=((ye,Me,Ie,Ce,Ne)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Me,u_radius:a.ac(Ie),u_opacity:Ce,u_temporal_offset:Ne}))(ae.skyboxMatrix,B.getCenter(z,!1),B.paint.get("sky-gradient-radius"),W,X);z.uploadCommonUniforms(se,ce),ce.draw(z,oe.TRIANGLES,V,a.ah.disabled,z.colorModeForRenderPass(),a.ag.backCW,we,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(g,f,A,b,O)},debug:function(g,l,f,y,b,T){for(let S=0;S<f.length;S++)if(b){const z=new a.C(y.r*.8,y.g*.8,y.b*.8,1);Sn(g,l,f[S],y,-1,-1,T),Sn(g,l,f[S],y,-1,1,T),Sn(g,l,f[S],y,1,1,T),Sn(g,l,f[S],y,1,-1,T),Sn(g,l,f[S],z,0,0,T)}else Sn(g,l,f[S],y,0,0,T)},custom:function(g,l,f,y){const b=g.context,T=f.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&f.isDraped(l)){if(g.renderPass==="offscreen"){const S=T.prerender;if(S){if(g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const A=g.transform.pointMerc;S.call(T,b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else S.call(T,b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const A=T.renderToTile;if(A){const O=y[0].canonical,z=new a._(O.x+y[0].wrap*(1<<O.z),O.y,O.z);b.setDepthMode(a.af.disabled),b.setStencilMode(a.ah.disabled),b.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),A.call(T,b.gl,z),b.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),b.setColorMode(g.colorModeForRenderPass()),b.setStencilMode(a.ah.disabled);const S=T.renderingMode==="3d"?new a.af(g.context.gl.LEQUAL,a.af.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,a.af.ReadOnly);if(b.setDepthMode(S),g.transform.projection.name==="globe"){const A=g.transform.pointMerc;T.render(b.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),a.a2(g.transform.zoom),[A.x,A.y],g.transform.pixelsPerMeterRatio)}else T.render(b.gl,g.transform.customLayerMatrix());b.setDirty(),g.setBaseState(),b.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,l,f,y){if(g.renderPass==="opaque")return;const b=f.paint.get("model-opacity");if(b===0)return;const T=f.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!T||g.terrain&&b<.65&&f._transitionablePaint._values["model-opacity"].value.expression instanceof a.Z))return;const S=g.shadowRenderer,A=f.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,A||(S.enabled=!1));const O=()=>{S&&(S.useNormalOffset=!0,A||(S.enabled=!0))},z=l.getSource();if(g.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(ce,be,we,ye,Me){const Ie=ce.transform;if(Ie.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${Ie.projection.name} projection is not yet implemented`);const Ce=Ie.getFreeCameraOptions().position;if(!ce.modelManager)return;const Ne=ce.modelManager;we.modelManager=Ne;const Fe=ce.shadowRenderer;if(!we._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const We=we._unevaluatedLayout._values["model-id"],Be={...we.layout.get("model-id").parameters},Re=ce.style.order.indexOf(we.fqid);for(const et of ye){const Ye=be.getTile(et).getBucket(we);if(!Ye||Ye.projection.name!==Ie.projection.name)continue;const Ve=Ye.getModelUris();Ve&&!Ye.modelsRequested&&(Ne.addModelsFromBucket(Ve,Me),Ye.modelsRequested=!0);const Ct=fp(et,Ie);Be.zoom=Ct;const _t=We.possiblyEvaluate(Be);if(dp(ce,Ye,et),Ca.shadowUniformsInitialized=!1,Ca.useSingleShadowCascade=!!Fe&&Fe.getMaxCascadeForTile(et.toUnwrapped())===0,ce.renderPass==="shadow"&&Fe){if(ce.currentShadowCascade===1&&Ye.isInsideFirstShadowMapFrustum)continue;const je=Ie.calculatePosMatrix(et.toUnwrapped(),Ie.worldSize);if(Ca.tileMatrix.set(je),Ca.shadowTileMatrix=Float32Array.from(Fe.calculateShadowPassMatrixFromMatrix(je)),Ca.aabb.min.fill(0),Ca.aabb.max[0]=Ca.aabb.max[1]=a.a4,Ca.aabb.max[2]=0,go(Ye,Ca,ce,we.scope))continue}const Ze=1<<et.canonical.z,ot=[((Ce.x-et.wrap)*Ze-et.canonical.x)*a.a4,(Ce.y*Ze-et.canonical.y)*a.a4,Ce.z*Ze*a.a4];ce.conflationActive&&Object.keys(Ye.instancesPerModel).length>0&&ce.style.isLayerClipped(we,be.getSource())&&Ye.updateReplacement(et,ce.replacementSource,Re,Me)&&(Ye.uploaded=!1,Ye.upload(ce.context));for(let je in Ye.instancesPerModel){const yt=Ye.instancesPerModel[je];yt.features.length>0&&(je=_t.evaluate(yt.features[0].feature,{}));const xt=Ne.getModel(je,Me);if(xt&&xt.uploaded)for(const $t of xt.nodes)wg(ce,we,$t,yt,ot,et,Ca)}}}(g,l,f,y,z.type==="vector"?f.scope:""),void O();if(!z.loaded())return;if(z.type==="batched-model")return function(ce,be,we,ye){we.resetLayerRenderingStats(ce);const Me=ce.context,Ie=ce.transform,Ce=ce.style.fog,Ne=ce.shadowRenderer;if(Ie.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Ie.projection.name} projection is not yet implemented`);const Fe=ce.transform.getFreeCameraOptions().position,We=a.$.scale([],[Fe.x,Fe.y,Fe.z],ce.transform.worldSize);a.$.negate(We,We);const Be=a.ae.identity([]),Re=a.ci(Ie.center.lat,Ie.zoom),et=a.ae.fromScaling([],[1,1,1/Re]);a.ae.translate(Be,Be,We);const Ye=we.paint.get("model-opacity"),Ve=new a.af(Me.gl.LEQUAL,a.af.ReadWrite,ce.depthRangeFor3D),Ct=new a.af(Me.gl.LEQUAL,a.af.ReadOnly,ce.depthRangeFor3D),_t=new a.b8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ze=ce.renderPass==="shadow",ot=Ze&&Ne?Ne.getCurrentCascadeFrustum():Ie.getFrustum(Ie.scaleZoom(Ie.worldSize)),je=we.paint.get("model-front-cutoff"),yt=je[2]<1,xt=zs(ce,we.paint.get("model-cutoff-fade-range")),$t=we.getLayerRenderingStats();(function(Gt,sn,Kt,En){const Un=Gt.terrain?Gt.terrain.exaggeration():0,In=Gt.transform.zoom;for(const Gn of En){const dr=sn.getTile(Gn).getBucket(Kt);dr&&(Gt.conflationActive&&dr.updateReplacement(Gn,Gt.replacementSource),dr.evaluateScale(Gt,Kt),Gt.terrain&&Un>0&&dr.elevationUpdate(Gt.terrain,Un,Gn,Kt.source),dr.needsReEvaluation(Gt,In,Kt)&&dr.evaluate(Kt))}})(ce,be,we,ye),function(){let Gt,sn,Kt;yt?(Gt=ye.length-1,sn=-1,Kt=-1):(Gt=0,sn=ye.length,Kt=1);for(let En=Gt;En!==sn;En+=Kt){const Un=ye[En],In=be.getTile(Un).getBucket(we);if(!In||!In.uploaded)continue;let Gn=!1;Ne&&(Gn=Ne.getMaxCascadeForTile(Un.toUnwrapped())===0);const dr=Ie.calculatePosMatrix(Un.toUnwrapped(),Ie.worldSize),Xr=In.modelTraits,Nr=[];for(const mr of In.getNodesInfo()){if(mr.hiddenByReplacement||!mr.node.meshes)continue;const zr=mr.node;let Zn=0;ce.terrain&&zr.elevation&&(Zn=zr.elevation*ce.terrain.exaggeration());const Jn=mr.evaluatedScale;if(Jn[0]<=1&&Jn[1]<=1&&Jn[2]<=1&&(()=>{const Gs=mr.aabb;return _t.min=[...Gs.min],_t.max=[...Gs.max],_t.min[2]+=Zn,_t.max[2]+=Zn,a.$.transformMat4(_t.min,_t.min,dr),a.$.transformMat4(_t.max,_t.max,dr),_t})().intersects(ot)===0)continue;const Vn=[...dr],br=zr.anchor?zr.anchor[0]:0,nr=zr.anchor?zr.anchor[1]:0;a.ae.translate(Vn,Vn,[br*(Jn[0]-1),nr*(Jn[1]-1),Zn]),a.$.exactEquals(Jn,a.cl)||a.ae.scale(Vn,Vn,Jn);const Rn=a.ae.multiply([],Vn,zr.matrix),Bi=a.ae.multiply([],Ie.expandedFarZProjMatrix,Rn),ji=a.ae.multiply([],Ie.expandedFarZProjMatrix,Vn),ro=a.aB.transformMat4([],[br,nr,Zn,1],Bi)[2];zr.hidden=!1;let io=Ye;Ze||(yt&&(io*=Nb(Vn,Ie,mr.aabb,je)),io*=sa(xt,ro)),io!==0?Nr.push({nodeInfo:mr,depth:ro,opacity:io,wvpForNode:Bi,wvpForTile:ji,nodeModelMatrix:Rn,tileModelMatrix:Vn}):zr.hidden=!0}Ze||Nr.sort((mr,zr)=>!yt||mr.opacity===1&&zr.opacity===1?mr.depth<zr.depth?-1:1:mr.opacity===1?-1:zr.opacity===1?1:mr.depth>zr.depth?-1:1);for(const mr of Nr){const zr=mr.nodeInfo,Zn=zr.node;let Jn=a.ae.multiply([],et,mr.tileModelMatrix);a.ae.multiply(Jn,Be,Jn);const Vn=a.ae.invert([],Jn);a.ae.transpose(Vn,Vn),a.ae.scale(Vn,Vn,Tg),Jn=a.ae.multiply(Jn,Jn,Zn.matrix);const br=ce.renderPass==="light-beam",nr=Xr&a.cn.HasMapboxMeshFeatures,Rn=nr?0:zr.evaluatedRMEA[0][2];for(let Bi=0;Bi<Zn.meshes.length;++Bi){const ji=Zn.meshes[Bi],ro=Bi===Zn.lightMeshIndex;let io=mr.wvpForNode;if(ro){if(!br&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}io=mr.wvpForTile}else if(br)continue;const Gs={defines:[]},so=[];if(ah(Gs.defines,so,ji,ce,we.lut),nr||Gs.defines.push("DIFFUSE_SHADED"),Gn&&Gs.defines.push("SHADOWS_SINGLE_CASCADE"),$t&&(Ze?$t.numRenderedVerticesInShadowPass+=ji.vertexArray.length:$t.numRenderedVerticesInTransparentPass+=ji.vertexArray.length),Ze){w0(ji,mr.nodeModelMatrix,ce,we);continue}let Ns=null;if(Ce){const Je=wd(mr.nodeModelMatrix,ce.transform);if(Ns=new Float32Array(Je),Ie.projection.name!=="globe"){const gc=ji.aabb.min,Ya=ji.aabb.max,[_c,yc]=Ce.getOpacityForBounds(Je,gc[0],gc[1],Ya[0],Ya[1]);Gs.overrideFog=_c>=_r||yc>=_r}}const Ws=ji.material;let kt;Ws.occlusionTexture&&Ws.occlusionTexture.offsetScale&&(kt=Ws.occlusionTexture.offsetScale,Gs.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Ze&&Ne&&(Ne.useNormalOffset=!!ji.normalBuffer);const an=ce.getOrCreateProgram("model",Gs);!Ze&&Ne&&Ne.setupShadowsFromMatrix(mr.tileModelMatrix,an,Ne.useNormalOffset),ce.uploadCommonUniforms(Me,an,null,Ns);const _o=Ws.pbrMetallicRoughness;_o.metallicFactor=.9,_o.roughnessFactor=.5;const Vr=rh(new Float32Array(io),new Float32Array(Jn),new Float32Array(Vn),new Float32Array(Zn.matrix),ce,mr.opacity,_o.baseColorFactor.toRenderColor(null),Ws.emissiveFactor,_o.metallicFactor,_o.roughnessFactor,Ws,Rn,we,[0,0,0],kt);!ro&&(zr.hasTranslucentParts||mr.opacity<1)&&an.draw(ce,Me.gl.TRIANGLES,Ve,a.ah.disabled,a.a.disabled,a.ag.backCCW,Vr,we.id,ji.vertexBuffer,ji.indexBuffer,ji.segments,we.paint,ce.transform.zoom,void 0,so),an.draw(ce,Me.gl.TRIANGLES,ro?Ct:Ve,a.ah.disabled,ro||mr.opacity<1||zr.hasTranslucentParts?a.a.alphaBlended:a.a.unblended,a.ag.backCCW,Vr,we.id,ji.vertexBuffer,ji.indexBuffer,ji.segments,we.paint,ce.transform.zoom,void 0,so)}}}}()}(g,l,f,y),void O();if(z.type!=="model")return;const B=z.getModels(),V=[],W=g.transform.getFreeCameraOptions().position,X=a.$.scale([],[W.x,W.y,W.z],g.transform.worldSize);a.$.negate(X,X);const se=[],oe=[];let ae=0;for(const ce of B){const be=f.paint.get("model-rotation").constantOr(null),we=f.paint.get("model-scale").constantOr(null),ye=f.paint.get("model-translation").constantOr(null);ce.computeModelMatrix(g,be,we,ye,!0,!0,!1);const Me=a.ae.identity([]),Ie=a.ci(ce.position.lat,g.transform.zoom),Ce=a.ae.fromScaling([],[1,1,1/Ie]);a.ae.translate(Me,Me,X),V.push({zScaleMatrix:Ce,negCameraPosMatrix:Me});for(const Ne of ce.nodes)ki(g.transform,Ne,ce.matrix,g.transform.expandedFarZProjMatrix,ae,se,oe);ae++}if(se.sort((ce,be)=>be.depth-ce.depth),g.renderPass!=="shadow"){if(b===1)for(const ce of oe)to(ce,g,f,V[ce.modelIndex],a.ah.disabled,g.colorModeForRenderPass());else{for(const ce of oe)to(ce,g,f,V[ce.modelIndex],a.ah.disabled,a.a.disabled);for(const ce of oe)to(ce,g,f,V[ce.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const ce of se)to(ce,g,f,V[ce.modelIndex],a.ah.disabled,g.colorModeForRenderPass());O()}else{for(const ce of oe)w0(ce.mesh,ce.nodeModelMatrix,g,f);for(const ce of se)w0(ce.mesh,ce.nodeModelMatrix,g,f);O()}}},ms={model:function(g,l,f){const y=l.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(f.modelManager&&f.modelManager.upload(f,y.type==="vector"?g.scope:""));if(y.type==="batched-model"||y.type!=="model")return;const b=y.getModels();for(const T of b)T.upload(f.context)},raster:function(g,l,f){const y=l.getSource();if(!(y instanceof R&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=g.paint.get("raster-array-band")||y.getInitialBand(b);if(T==null)return;const S=l.getIds().map(A=>l.getTileByID(A));for(const A of S)A.updateNeeded(b,T)&&y.prepareTile(A,b,T)},"raster-particle":function(g,l,f){const y=l.getSource();if(!(y instanceof R&&y.loaded()))return;const b=g.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!b)return;const T=g.paint.get("raster-particle-array-band")||y.getInitialBand(b);if(T==null)return;const S=l.getIds().map(A=>l.getTileByID(A));for(const A of S)A.updateNeeded(b,T)&&y.prepareTile(A,b,T)}};class T0{constructor(l,f,y,b){this.context=new fi(l,f),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=a.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const A of T)this._debugParams.enabledLayers[A]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const A of T)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],A);this.occlusionParams=new Ka(b),this.setup(),this.numSublayers=a.bx.maxUnderzooming+a.bx.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.cp,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new dg(this),this._wireframeDebugCache=new as,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new a.j({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,S,l.RGBA)}updateTerrain(l,f){const y=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new tn(this,l));const b=this._terrain;this.transform.elevation=y?b:null,b.update(l,this.transform,f),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(l){const f=l.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,b]=f.getFovAdjustedRange(this.transform._fov);if(y>b)return void(this.transform.fogCullDistSq=null);const T=y+.78*(b-y);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(l){l&&!this._terrain&&(this._terrain=new tn(this,this.style)),this._forceTerrainMode=l}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(l,f){if(this.width=l*a.e.devicePixelRatio,this.height=f*a.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const l=this.context,f=new a.bv;f.emplaceBack(0,0),f.emplaceBack(a.a4,0),f.emplaceBack(0,a.a4),f.emplaceBack(a.a4,a.a4),this.tileExtentBuffer=l.createVertexBuffer(f,a.bt.members),this.tileExtentSegments=a.b.simpleSegment(0,0,4,2);const y=new a.bv;y.emplaceBack(0,0),y.emplaceBack(a.a4,0),y.emplaceBack(0,a.a4),y.emplaceBack(a.a4,a.a4),this.debugBuffer=l.createVertexBuffer(y,a.bt.members),this.debugSegments=a.b.simpleSegment(0,0,4,5);const b=new a.bv;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,a.bt.members),this.viewportSegments=a.b.simpleSegment(0,0,4,2);const T=new a.cq;T.emplaceBack(0,0,0,0),T.emplaceBack(a.a4,0,a.a4,0),T.emplaceBack(0,a.a4,0,a.a4),T.emplaceBack(a.a4,a.a4,a.a4,a.a4),this.mercatorBoundsBuffer=l.createVertexBuffer(T,a.cr.members),this.mercatorBoundsSegments=a.b.simpleSegment(0,0,4,2);const S=new a.bw;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(S);const A=new a.cs;for(const z of[0,1,3,2,0])A.emplaceBack(z);this.debugIndexBuffer=l.createIndexBuffer(A),this.emptyTexture=new a.T(l,new a.j({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=a.ae.create();const O=this.context.gl;this.stencilClearMode=new a.ah({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,l.TRIANGLES,a.af.disabled,this.stencilClearMode,a.a.disabled,a.ag.disabled,iu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,f,y){if(!f||this.currentStencilSource===f.id||!l.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const O of y)if(this._tileClippingMaskIDs[O.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=f.id;const b=this.context,T=b.gl;this.nextStencilID+y.length>256&&this.clearStencil(),b.setColorMode(a.a.disabled),b.setDepthMode(a.af.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of y){const O=f.getTile(A),z=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:B,tileBoundsIndexBuffer:V,tileBoundsSegments:W}=this.getTileBoundsBuffers(O);S.draw(this,T.TRIANGLES,a.af.disabled,new a.ah({func:T.ALWAYS,mask:0},z,255,T.KEEP,T.KEEP,T.REPLACE),a.a.disabled,a.ag.disabled,iu(A.projMatrix),"$clipping",B,V,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new a.ah({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const f=this.context.gl;return new a.ah({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,y=l.sort((S,A)=>A.overscaledZ-S.overscaledZ),b=y[y.length-1].overscaledZ,T=y[0].overscaledZ-b+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const S={};for(let A=0;A<T;A++)S[A+b]=new a.ah({func:f.GEQUAL,mask:255},A+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=T,[S,y]}return[{[b]:a.ah.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new a.a([l.CONSTANT_COLOR,l.ONE,l.CONSTANT_COLOR,l.ONE],new a.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.a.unblended:a.a.alphaBlended}colorModeForDrapableLayerRenderPass(l){const f=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new a.a([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.CONSTANT_ALPHA,f.ONE_MINUS_SRC_ALPHA],new a.C(0,0,0,l===void 0?0:l),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(l,f,y,b=!1){if(this.depthOcclusion)return new a.af(this.context.gl.GREATER,a.af.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return a.af.disabled;const T=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new a.af(y||this.context.gl.LEQUAL,f,[T,T])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const l=this.context.gl,f=Math.ceil(this.width),y=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),T=l.getParameter(l.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===f&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),f!==0&&y!==0&&(this.depthFBO=new pr(this.context,f,y,!1,"texture"),this.depthTexture=new a.T(this.context,{width:f,height:y,data:null},l.DEPTH_STENCIL),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),l.bindTexture(l.TEXTURE_2D,T),this.depthFBO&&(l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),l.blitFramebuffer(0,0,f,y,0,0,f,y,l.DEPTH_BUFFER_BIT,l.NEAREST),l.bindFramebuffer(l.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((l,f)=>l+f/this._fpsHistory.length,0))}render(l,f){const y=a.e.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=l.map.repaint,this.style=l,this.options=f;const b=this.style._mergedLayers,T=this.style.order.filter(Be=>{const Re=b[Be];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]});let S=!1,A=!1;for(const Be of T){const Re=b[Be];Re.type==="circle"&&(S=!0),Re.type==="symbol"&&(Re.hasInitialOcclusionOpacityProperties?A=!0:S=!0)}const O=T.map(Be=>b[Be]),z=this.style._mergedSourceCaches;this.imageManager=l.imageManager,this.modelManager=l.modelManager,this.symbolFadeChange=l.placement.symbolFadeChange(a.e.now()),this.imageManager.beginFrame();let B=0,V=!1;for(const Be in z){const Re=z[Be];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++B)}let W=!1;for(const Be of O)Be.isHidden(this.transform.zoom)||(Be.type==="clip"&&(W=!0),this.prepareLayer(Be));const X={},se={},oe={},ae={},ce={};for(const Be in z){const Re=z[Be];X[Be]=Re.getVisibleCoordinates(),se[Be]=X[Be].slice().reverse(),oe[Be]=Re.getVisibleCoordinates(!0).reverse(),ae[Be]=Re.getShadowCasterCoordinates(),ce[Be]=Re.sortCoordinatesByDistance(X[Be])}const be=Be=>{const Re=this.style.getLayerSourceCache(Be);return Re&&Re.used?Re.getSource():null};if(B||W){const Be=[],Re=[];let et=0;for(const Ye of O)this.isSourceForClippingOrConflation(Ye,be(Ye))&&(Be.push(Ye),Re.push(et)),et++;if(Be&&(W||Be.length>1)){const Ye=[];for(let Ve=0;Ve<Be.length;Ve++){const Ct=Be[Ve],_t=Re[Ve],Ze=this.style.getLayerSourceCache(Ct);if(!Ze||!Ze.used||!Ze.getSource().usedInConflation&&Ct.type!=="clip")continue;let ot=a.cv,je=a.cw.None;const yt=[];if(Ct.type==="clip"){ot=_t;for(const xt of Ct.layout.get("clip-layer-types"))je|=xt==="model"?a.cw.Model:xt==="symbol"?a.cw.Symbol:a.cw.FillExtrusion;for(const xt of Ct.layout.get("clip-layer-scope"))yt.push(xt)}Ye.push({layer:Ct.fqid,cache:Ze,order:ot,clipMask:je,clipScope:yt})}this.replacementSource.setSources(Ye),V=!0}}V||this.replacementSource.clear(),this.conflationActive=V,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Be=0;Be<O.length;Be++){const Re=O[Be],et=Re.cutoffRange();if(this.longestCutoffRange=Math.max(et,this.longestCutoffRange),et>0){const Ye=be(Re);Ye&&(this.minCutoffZoom=Math.max(Ye.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Be),this._lastOcclusionLayer=Be)}const we=this.style&&this.style.fog;we?(this._fogVisible=we.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=we.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(oe),this.opaquePassCutoff=0);const ye=this._shadowRenderer;if(ye){ye.updateShadowParameters(this.transform,this.style.directionalLight);for(const Be in z)for(const Re of X[Be]){let et={min:0,max:0};this.terrain&&(et=this.terrain.getMinMaxForTile(Re)||et),ye.addShadowReceiver(Re.toUnwrapped(),et.min,et.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.ct(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new bg(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!a.cu(this.context.gl))return;this.renderPass="offscreen";for(const Be of O){const Re=l.getLayerSourceCache(Be);if(!Be.hasOffscreenPass()||Be.isHidden(this.transform.zoom))continue;const et=Re?se[Re.id]:void 0;(Be.type==="custom"||Be.type==="raster"||Be.type==="raster-particle"||Be.isSky()||et&&et.length)&&this.renderLayer(this,Re,Be,et)}this.depthRangeFor3D=[0,1-(O.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ae)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Me=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ie=(()=>{if(f.showOverdrawInspector)return a.C.black;const Be=this.style.fog;if(Be&&this.transform.projection.supportsFog){const Re=this.style.getLut(Be.scope);if(!Me){const et=Be.properties.get("color").toRenderColor(Re).toArray01();return new a.C(...et)}if(Me){const et=Be.properties.get("space-color").toRenderColor(Re).toArray01();return new a.C(...et)}}return a.C.transparent})();if(this.context.clear({color:Ie,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const Be=O[this.currentLayer],Re=l.getLayerSourceCache(Be);if(Be.isSky())continue;const et=Re?(Be.is3D()?ce:se)[Re.id]:void 0;this._renderTileClippingMasks(Be,Re,et),this.renderLayer(this,Re,Be,et)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Me&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.a2(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const Be=O[this.currentLayer],Re=l.getLayerSourceCache(Be);Be.isSky()&&this.renderLayer(this,Re,Be,Re?se[Re.id]:void 0)}function Ce(Be,Re){let et;return Re&&(et=(Be.type==="symbol"?oe:Be.is3D()?ce:se)[Re.id]),et}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<T.length;){const Be=O[this.currentLayer];if(Be.type==="raster"||Be.type==="raster-particle"){const Re=l.getLayerSourceCache(Be);this.renderLayer(this,Re,Be,Ce(Be,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ne=0;ye&&(Ne=ye.getShadowCastingLayerCount());let Fe=!1,We=-1;for(let Be=0;Be<T.length;++Be){const Re=O[Be];Re.isHidden(this.transform.zoom)||Re.is3D()&&(We=Be)}for(A&&We===-1&&(S=!0);this.currentLayer<T.length;){const Be=O[this.currentLayer],Re=l.getLayerSourceCache(Be);if(Be.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Be)){if(Be.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(S&&!Fe&&this.terrain&&!this.transform.isOrthographic&&(Fe=!0,this.blitDepth()),A&&We!==-1&&this.currentLayer===We+1&&!this.transform.isOrthographic&&this.blitDepth(),Be.is3D()||this.terrain||this._renderTileClippingMasks(Be,Re,Re?X[Re.id]:void 0),this.renderLayer(this,Re,Be,Ce(Be,Re)),!this.terrain&&ye&&Ne>0&&Be.hasShadowPass()&&--Ne==0&&(ye.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const et=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=et;this.currentLayer++){const Ye=O[this.currentLayer];if(!Ye.hasLightBeamPass())continue;const Ve=l.getLayerSourceCache(Ye);this.renderLayer(this,Ve,Ye,Ve?se[Ve.id]:void 0)}this.currentLayer=et,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const et=this.currentLayer;this.depthOcclusion=!0;for(const Ye of this.layersWithOcclusionOpacity){this.currentLayer=Ye;const Ve=O[this.currentLayer],Ct=l.getLayerSourceCache(Ve),_t=Ct?se[Ct.id]:void 0;Ve.is3D()||this.terrain||this._renderTileClippingMasks(Ve,Ct,Ct?X[Ct.id]:void 0),this.renderLayer(this,Ct,Ve,_t)}this.depthOcclusion=!1,this.currentLayer=et,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Be=null;O.forEach(Re=>{const et=l.getLayerSourceCache(Re);et&&!Re.isHidden(this.transform.zoom)&&et.getVisibleCoordinates().length&&(!Be||Be.getSource().maxzoom<et.getSource().maxzoom)&&(Be=et)}),Be&&this.options.showTileBoundaries&&Qa.debug(this,Be,Be.getVisibleCoordinates(),a.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Qa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Be){const Re=Be.transform.padding;x0(Be,Be.transform.height-(Re.top||0),3,y0),x0(Be,Re.bottom||0,3,xg),hp(Be,Re.left||0,3,v0),hp(Be,Be.transform.width-(Re.right||0),3,Sr);const et=Be.transform.centerPoint;(function(Ye,Ve,Ct,_t){xd(Ye,Ve-1,Ct-10,2,20,_t),xd(Ye,Ve-10,Ct-1,20,2,_t)})(Be,et.x,Be.transform.height-et.y,vA)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),V||(this.conflationActive=!1)}prepareLayer(l){this.gpuTimingStart(l);const{unsupportedLayers:f}=this.transform.projection,y=!f||!f.includes(l.type);if(ms[l.type]&&(y||this.terrain&&l.type==="custom")){const b=this.style.getLayerSourceCache(l);ms[l.type](l,b,this)}this.gpuTimingEnd()}renderLayer(l,f,y,b){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||b&&b.length)&&(this.id=y.id,this.gpuTimingStart(y),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(y.type)&&(!l.terrain||y.type!=="custom")||y.type==="clip"||Qa[y.type](l,f,y,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery,y=this.context.gl;let b=this.gpuTimers[l.id];b||(b=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:y.createQuery()}),b.calls++,y.beginQuery(f.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,f=this.context.gl,y=f.createQuery();this.deferredRenderGpuTimeQueries.push(y),f.beginQuery(l.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const f={};for(const y in l){const b=l[y],T=this.context.extTimerQuery,S=T.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;T.deleteQueryEXT(b.query),f[y]=S}return f}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery,y=this.context.gl;let b=0;for(const T of l)b+=f.getQueryParameter(T,y.QUERY_RESULT)/1e6,f.deleteQueryEXT(T);return b}translatePosMatrix(l,f,y,b,T){if(!y[0]&&!y[1])return l;const S=T?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(S){const z=Math.sin(S),B=Math.cos(S);y=[y[0]*B-y[1]*z,y[0]*z+y[1]*B]}const A=[T?y[0]:a.bD(f,y[0],this.transform.zoom),T?y[1]:a.bD(f,y[1],this.transform.zoom),0],O=new Float32Array(16);return a.ae.translate(O,l,A),O}saveTileTexture(l){const f=l.size[0],y=this._tileTextures[f];y?y.push(l):this._tileTextures[f]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(l,f,y){const b=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,T=[];return this.style&&this.style.enable3dLights()&&(l==="globeRaster"||l==="terrainRaster"?(T.push("LIGHTING_3D_MODE"),T.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||T.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||T.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?T.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):T.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(T.push("TERRAIN"),this.linearFloatFilteringSupported()&&T.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&T.push("GLOBE"),!this._fogVisible||b||f!==void 0&&!f||T.push("FOG","FOG_DITHERING"),b&&T.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&T.push("OVERDRAW_INSPECTOR"),T}getOrCreateProgram(l,f){this.cache=this.cache||{};const y=f&&f.defines||[],b=f&&f.config,T=this.currentGlobalDefines(l,f&&f.overrideFog,f&&f.overrideRtt).concat(y),S=As.cacheKey(Zc[l],l,T,b);return this.cache[S]||(this.cache[S]=new As(this.context,l,Zc[l],b,Rb[l],T)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(l,f){if(this.style.enable3dLights()){const y=this.style.directionalLight,b=this.style.ambientLight;if(y&&b){const T=((S,A,O)=>{const z=S.properties.get("direction"),B=S.properties.get("color").toRenderColor(O.getLut(S.scope)).toArray01(),V=S.properties.get("intensity"),W=A.properties.get("color").toRenderColor(O.getLut(A.scope)).toArray01(),X=A.properties.get("intensity"),se=[z.x,z.y,z.z],oe=a.bC(W,X),ae=a.bC(B,V);return{u_lighting_ambient_color:oe,u_lighting_directional_dir:se,u_lighting_directional_color:ae,u_ground_radiance:ii(se,ae,oe)}})(y,b,this.style);f.setLightsUniformValues(l,T)}}}uploadCommonUniforms(l,f,y,b,T){if(this.uploadCommonLightUniforms(l,f),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const A=S.getOpacity(this.transform.pitch),O=((z,B,V,W,X,se,oe,ae,ce,be,we,ye)=>{const Me=z.transform,Ie=B.properties.get("color").toRenderColor(z.style.getLut(B.scope)).toArray01();Ie[3]=W;const Ce=z.frameCounter/1e3%1,[Ne,Fe]=B.properties.get("vertical-range");return{u_fog_matrix:V?Me.calculateFogTileMatrix(V):ye||z.identityMat,u_fog_range:B.getFovAdjustedRange(Me._fov),u_fog_color:Ie,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ne,Fe),Fe],u_fog_temporal_offset:Ce,u_frustum_tl:X,u_frustum_tr:se,u_frustum_br:oe,u_frustum_bl:ae,u_globe_pos:ce,u_globe_radius:be,u_viewport:we,u_globe_transition:a.a2(Me.zoom),u_is_globe:+(Me.projection.name==="globe")}})(this,S,y,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.e.devicePixelRatio,this.transform.height*a.e.devicePixelRatio],b);f.setFogUniformValues(l,O)}T&&f.setCutoffUniformValues(l,T.uniformValues)}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,f=l.createTexture();return l.bindTexture(l.TEXTURE_2D,f),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&l.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const l=this._backgroundTiles,f=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const b of y)f[b.key]=l[b.key]||new a.bA(b,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(l,f){return!(!l.is3D()||l.minzoom&&l.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||l.sourceLayer!=="building")&&l.type!=="clip"&&(!f||f.type!=="batched-model"))}isTileAffectedByFog(l){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let f=this._cachedTileFogOpacities[l.key];return f||(this._cachedTileFogOpacities[l.key]=f=this.style.fog.getOpacityForTile(l)),f[0]>=_r||f[1]>=_r}setupDepthForOcclusion(l,f,y){const b=this.context,T=b.gl,S=!!y;var A;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(T.TEXTURE3),l&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),b.activeTexture.set(T.TEXTURE0),S||f.setTerrainUniformValues(b,y)}}class oa{constructor(l,f,y,b){this.screenBounds=l,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(l,f){let y,b;if(l instanceof a.P||typeof l[0]=="number"){const T=a.P.convert(l);y=[T],b=f.isPointAboveHorizon(T)}else{const T=a.P.convert(l[0]),S=a.P.convert(l[1]);y=[T,S],b=a.cx(T,S).every(A=>f.isPointAboveHorizon(A))}return new oa(y,f.getCameraPoint(),b,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(l){return a.cx(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const f=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cx(f,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<y.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?b[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(b[3]=this.cameraPoint)),a.cy(b,l)}bufferedCameraGeometryGlobe(l){const f=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],b=a.cx(f,y,l),T=this.cameraPoint.clone();switch(3*((T.y>f.y)+(T.y>y.y))+((T.x>f.x)+(T.x>y.x))){case 0:b[0]=T,b[4]=T.clone();break;case 1:b.splice(1,0,T);break;case 2:b[1]=T;break;case 3:b.splice(4,0,T);break;case 5:b.splice(2,0,T);break;case 6:b[3]=T;break;case 7:b.splice(3,0,T);break;case 8:b[2]=T}return b}containsTile(l,f,y,b=0){const T=l.queryPadding/f._pixelsPerMercatorPixel+1,S=y?this._bufferedCameraMercator(T,f):this._bufferedScreenMercator(T,f);let A=l.tileID.wrap+(S.unwrapped?b:0);const O=S.polygon.map(ae=>a.cz(l.tileTransform,ae,A));if(!a.cA(O,0,0,a.a4,a.a4))return;A=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const z=this.screenGeometryMercator.polygon.map(ae=>a.cB(l.tileTransform,ae,A)),B=z.map(ae=>new a.P(ae[0],ae[1])),V=f.getFreeCameraOptions().position||new a._(0,0,0),W=a.cB(l.tileTransform,V,A),X=z.map(ae=>{const ce=a.$.sub(ae,ae,W);return a.$.normalize(ce,ce),new a.aU(W,ce)}),se=a.bD(l,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:B,tilespaceRays:X,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(oe=a.cC(O),oe.min.x=a.au(oe.min.x,0,a.a4),oe.min.y=a.au(oe.min.y,0,a.a4),oe.max.x=a.au(oe.max.x,0,a.a4),oe.max.y=a.au(oe.max.y,0,a.a4),oe),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:se};var oe}_bufferedScreenMercator(l,f){const y=su(l);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let b;return b=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(l),f):{polygon:this.bufferedScreenGeometry(l).map(T=>f.pointCoordinate3D(T)),unwrapped:!0},this._screenRaycastCache[y]=b,b}}_bufferedCameraMercator(l,f){const y=su(l);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let b;return b=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),f):{polygon:this.bufferedCameraGeometry(l).map(T=>f.pointCoordinate3D(T)),unwrapped:!0},this._cameraRaycastCache[y]=b,b}}_projectAndResample(l,f){const y=function(T,S){const A=a.ae.multiply([],S.pixelMatrix,S.globeMatrix),O=[0,-a.cF,0,1],z=[0,a.cF,0,1],B=[0,0,0,1];a.aB.transformMat4(O,O,A),a.aB.transformMat4(z,z,A),a.aB.transformMat4(B,B,A);const V=new a.P(O[0]/O[3],O[1]/O[3]),W=new a.P(z[0]/z[3],z[1]/z[3]),X=a.cD(T,V)&&O[3]<B[3],se=a.cD(T,W)&&z[3]<B[3];if(!X&&!se)return null;const oe=function(Ce,Ne,Fe){for(let We=1;We<Ce.length;We++){const Be=dc(Ne.pointCoordinate3D(Ce[We-1]).x),Re=dc(Ne.pointCoordinate3D(Ce[We]).x);if(Fe<0){if(Be<Re)return{idx:We,t:-Be/(Re-1-Be)}}else if(Re<Be)return{idx:We,t:(1-Be)/(Re+1-Be)}}return null}(T,S,X?-1:1);if(!oe)return null;const{idx:ae,t:ce}=oe;let be=ae>1?lh(T.slice(0,ae),S):[],we=ae<T.length?lh(T.slice(ae),S):[];be=be.map(Ce=>new a.P(dc(Ce.x),Ce.y)),we=we.map(Ce=>new a.P(dc(Ce.x),Ce.y));const ye=[...be];ye.length===0&&ye.push(we[we.length-1]);const Me=a.a3(ye[ye.length-1].y,(we.length===0?be[0]:we[0]).y,ce);let Ie;return Ie=X?[new a.P(0,Me),new a.P(0,0),new a.P(1,0),new a.P(1,Me)]:[new a.P(1,Me),new a.P(1,1),new a.P(0,1),new a.P(0,Me)],ye.push(...Ie),we.length===0?ye.push(be[0]):ye.push(...we),{polygon:ye.map(Ce=>new a._(Ce.x,Ce.y)),unwrapped:!1}}(l,f);if(y)return y;const b=function(T,S){let A=!1,O=-1/0,z=0;for(let V=0;V<T.length-1;V++)T[V].x>O&&(O=T[V].x,z=V);for(let V=0;V<T.length-1;V++){const W=(z+V)%(T.length-1),X=T[W],se=T[W+1];Math.abs(X.x-se.x)>.5&&(X.x<se.x?(X.x+=1,W===0&&(T[T.length-1].x+=1)):(se.x+=1,W+1===T.length-1&&(T[0].x+=1)),A=!0)}const B=a.ak(S.center.lng);return A&&B<Math.abs(B-1)&&T.forEach(V=>{V.x-=1}),{polygon:T,unwrapped:A}}(lh(l,f).map(T=>new a.P(dc(T.x),T.y)),f);return{polygon:b.polygon.map(T=>new a._(T.x,T.y)),unwrapped:b.unwrapped}}}function lh(g,l){return a.cE(g,f=>{const y=l.pointCoordinate3D(f);f.x=y.x,f.y=y.y},1/256)}function dc(g){return g<0?1+g%1:g%1}function su(g){return 100*g|0}function xA(g,l){const f=a.ae.identity([]);return a.ae.scale(f,f,[.5*g.width,.5*-g.height,1]),a.ae.translate(f,f,[1,-1,0]),a.ae.multiply(f,f,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(f)}function fc(g,l,f,y,b,T,S,A=!1){const O=g.tilesIn(y,S,A);O.sort(E0);const z=[];for(const V of O)z.push({wrappedTileID:V.tile.tileID.wrapped().key,queryResults:V.tile.queryRenderedFeatures(l,f,g._state,V,b,T,xA(g.transform,V.tile.tileID),A)});const B=function(V){const W={},X={};for(const se of V){const oe=se.queryResults,ae=se.wrappedTileID,ce=X[ae]=X[ae]||{};for(const be in oe){const we=oe[be],ye=ce[be]=ce[be]||{},Me=W[be]=W[be]||[];for(const Ie of we)ye[Ie.featureIndex]||(ye[Ie.featureIndex]=!0,Me.push(Ie))}}return W}(z);for(const V in B)B[V].forEach(W=>{const X=W.feature,se=X.layer;se&&se.type!=="background"&&se.type!=="sky"&&se.type!=="slot"&&(X.source=se.source,se["source-layer"]&&(X.sourceLayer=se["source-layer"]),X.state=X.id!==void 0?g.getFeatureState(se["source-layer"],X.id):{})});return B}function bA(g,l){const f=g.getRenderableIds().map(T=>g.getTileByID(T)),y=[],b={};for(let T=0;T<f.length;T++){const S=f[T],A=S.tileID.canonical.key;b[A]||(b[A]=!0,S.querySourceFeatures(y,l))}return y}function E0(g,l){const f=g.tileID,y=l.tileID;return f.overscaledZ-y.overscaledZ||f.canonical.y-y.canonical.y||f.wrap-y.wrap||f.canonical.x-y.canonical.x}class Bo{constructor(l){this.style=l,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const l=!1,f=!1;for(const y in this.style._mergedLayers){const b=this.style._mergedLayers[y];if(b.type==="fill-extrusion")this.layers.push({layer:b,visible:l,visibilityChanged:f});else if(b.type==="model"){const T=this.style.getLayerSource(b);T&&T.type==="batched-model"&&this.layers.push({layer:b,visible:l,visibilityChanged:f})}}}onNewFrame(l){this.layersGotHidden=!1;for(const f of this.layers){const y=f.layer;let b=!1;y.type==="fill-extrusion"?b=!y.isHidden(l)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="model"&&(b=!y.isHidden(l)&&y.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!b&&f.visible,f.visible=b}}updateZOffset(l,f){this.currentBuildingBuckets=[];for(const b of this.layers){const T=b.layer,S=this.style.getLayerSourceCache(T);let A=1;T.type==="fill-extrusion"&&(A=b.visible?T.paint.get("fill-extrusion-vertical-scale"):0);let O=S?S.getTile(f):null;if(!O&&S&&f.canonical.z>S.getSource().minzoom){let z=f.scaledTo(Math.min(S.getSource().maxzoom,f.overscaledZ-1));for(;z.overscaledZ>=S.getSource().minzoom&&(O=S.getTile(z),!O&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:O?O.getBucket(T):null,tileID:O?O.tileID:f,verticalScale:A})}l.hasAnyZOffset=!1;let y=!1;for(let b=0;b<l.symbolInstances.length;b++){const T=l.symbolInstances.get(b),S=T.zOffset,A=this._getHeightAtTileOffset(f,T.tileAnchorX,T.tileAnchorY);T.zOffset=A!==Number.NEGATIVE_INFINITY?A:S,y||S===T.zOffset||(y=!0),l.hasAnyZOffset||T.zOffset===0||(l.hasAnyZOffset=!0)}y&&(l.zOffsetBuffersNeedUpload=!0,l.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(l,f,y,b){let T=f,S=y;if(l.canonical.z!==b.canonical.z){const A=b.canonical,O=1/(1<<l.canonical.z-A.z);T=(f+l.canonical.x*a.a4)*O-A.x*a.a4|0,S=(y+l.canonical.y*a.a4)*O-A.y*a.a4|0}return{tileX:T,tileY:S}}_getHeightAtTileOffset(l,f,y){let b,T;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:A,tileID:O,verticalScale:z}=this.currentBuildingBuckets[S];if(!A)continue;const{tileX:B,tileY:V}=this._mapCoordToOverlappingTile(l,f,y,O),W=A.getHeightAtTileCoord(B,V);W&&W.height!==void 0&&(W.hidden?b=W.height:T=Math.max(W.height*z,T||0))}if(T!==void 0)return T;for(let S=0;S<this.layers.length;++S){const A=this.layers[S];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:O,tileID:z}=this.currentBuildingBuckets[S];if(!O)continue;const{tileX:B,tileY:V}=this._mapCoordToOverlappingTile(l,f,y,z),W=O.getHeightAtTileCoord(B,V);if(W&&!W.hidden)return W.height===void 0&&b!==void 0?Math.min(W.maxHeight,b)*W.verticalScale:W.height?W.height*W.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function wA(g,l){const f={};for(const y in g)y!=="ref"&&(f[y]=g[y]);return a.cG.forEach(y=>{y in l&&(f[y]=l[y])}),f}function pp(g){g=g.slice();const l=Object.create(null);for(let f=0;f<g.length;f++)l[g[f].id]=g[f];for(let f=0;f<g.length;f++)"ref"in g[f]&&(g[f]=wA(g[f],l[g[f].ref]));return g}const Ir={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ed(g,l,f){f.push({command:Ir.addSource,args:[g,l[g]]})}function Fb(g,l,f){l.push({command:Ir.removeSource,args:[g]}),f[g]=!0}function TA(g,l,f,y){Fb(g,f,y),Ed(g,l,f)}function mp(g,l,f){let y;for(y in g[f])if(g[f].hasOwnProperty(y)&&y!=="data"&&!a.d(g[f][y],l[f][y]))return!1;for(y in l[f])if(l[f].hasOwnProperty(y)&&y!=="data"&&!a.d(g[f][y],l[f][y]))return!1;return!0}function ou(g,l,f,y,b,T){let S;for(S in l=l||{},g=g||{})g.hasOwnProperty(S)&&(a.d(g[S],l[S])||f.push({command:T,args:[y,S,l[S],b]}));for(S in l)l.hasOwnProperty(S)&&!g.hasOwnProperty(S)&&(a.d(g[S],l[S])||f.push({command:T,args:[y,S,l[S],b]}))}function Eg(g){return g.id}function pc(g,l){return g[l.id]=l,g}class Bb{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=a.au(l,0,1);let f=1,y=this._distances[f];const b=l*this.paddedLength+this.padding;for(;y<b&&f<this._distances.length;)y=this._distances[++f];const T=f-1,S=this._distances[T],A=y-S,O=A>0?(b-S)/A:0;return this.points[T].mult(1-O).add(this.points[f].mult(O))}}class gp{constructor(l,f,y){const b=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(f/y);for(let S=0;S<this.xCellCount*this.yCellCount;S++)b.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,y,b,T){this._forEachCell(f,y,b,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(b),this.bboxes.push(T)}insertCircle(l,f,y,b){this._forEachCell(f-b,y-b,f+b,y+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(y),this.circles.push(b)}_insertBoxCell(l,f,y,b,T,S){this.boxCells[T].push(S)}_insertCircleCell(l,f,y,b,T,S){this.circleCells[T].push(S)}_query(l,f,y,b,T,S){if(y<0||l>this.width||b<0||f>this.height)return!T&&[];const A=[];if(l<=0&&f<=0&&this.width<=y&&this.height<=b){if(T)return!0;for(let O=0;O<this.boxKeys.length;O++)A.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const z=this.circles[3*O],B=this.circles[3*O+1],V=this.circles[3*O+2];A.push({key:this.circleKeys[O],x1:z-V,y1:B-V,x2:z+V,y2:B+V})}return S?A.filter(S):A}return this._forEachCell(l,f,y,b,this._queryCell,A,{hitTest:T,seenUids:{box:{},circle:{}}},S),T?A.length>0:A}_queryCircle(l,f,y,b,T){const S=l-y,A=l+y,O=f-y,z=f+y;if(A<0||S>this.width||z<0||O>this.height)return!b&&[];const B=[];return this._forEachCell(S,O,A,z,this._queryCellCircle,B,{hitTest:b,circle:{x:l,y:f,radius:y},seenUids:{box:{},circle:{}}},T),b?B.length>0:B}query(l,f,y,b,T){return this._query(l,f,y,b,!1,T)}hitTest(l,f,y,b,T){return this._query(l,f,y,b,!0,T)}hitTestCircle(l,f,y,b){return this._queryCircle(l,f,y,!0,b)}_queryCell(l,f,y,b,T,S,A,O){const z=A.seenUids,B=this.boxCells[T];if(B!==null){const W=this.bboxes;for(const X of B)if(!z.box[X]){z.box[X]=!0;const se=4*X;if(l<=W[se+2]&&f<=W[se+3]&&y>=W[se+0]&&b>=W[se+1]&&(!O||O(this.boxKeys[X]))){if(A.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[X],x1:W[se],y1:W[se+1],x2:W[se+2],y2:W[se+3]})}}}const V=this.circleCells[T];if(V!==null){const W=this.circles;for(const X of V)if(!z.circle[X]){z.circle[X]=!0;const se=3*X;if(this._circleAndRectCollide(W[se],W[se+1],W[se+2],l,f,y,b)&&(!O||O(this.circleKeys[X]))){if(A.hitTest)return S.push(!0),!0;{const oe=W[se],ae=W[se+1],ce=W[se+2];S.push({key:this.circleKeys[X],x1:oe-ce,y1:ae-ce,x2:oe+ce,y2:ae+ce})}}}}}_queryCellCircle(l,f,y,b,T,S,A,O){const z=A.circle,B=A.seenUids,V=this.boxCells[T];if(V!==null){const X=this.bboxes;for(const se of V)if(!B.box[se]){B.box[se]=!0;const oe=4*se;if(this._circleAndRectCollide(z.x,z.y,z.radius,X[oe+0],X[oe+1],X[oe+2],X[oe+3])&&(!O||O(this.boxKeys[se])))return S.push(!0),!0}}const W=this.circleCells[T];if(W!==null){const X=this.circles;for(const se of W)if(!B.circle[se]){B.circle[se]=!0;const oe=3*se;if(this._circlesCollide(X[oe],X[oe+1],X[oe+2],z.x,z.y,z.radius)&&(!O||O(this.circleKeys[se])))return S.push(!0),!0}}}_forEachCell(l,f,y,b,T,S,A,O){const z=this._convertToXCellCoord(l),B=this._convertToYCellCoord(f),V=this._convertToXCellCoord(y),W=this._convertToYCellCoord(b);for(let X=z;X<=V;X++)for(let se=B;se<=W;se++)if(T.call(this,l,f,y,b,this.xCellCount*se+X,S,A,O))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,y,b,T,S){const A=b-l,O=T-f,z=y+S;return z*z>A*A+O*O}_circleAndRectCollide(l,f,y,b,T,S,A){const O=(S-b)/2,z=Math.abs(l-(b+O));if(z>O+y)return!1;const B=(A-T)/2,V=Math.abs(f-(T+B));if(V>B+y)return!1;if(z<=O||V<=B)return!0;const W=z-O,X=V-B;return W*W+X*X<=y*y}}const no=100;class EA{constructor(l,f,y=new gp(l.width+200,l.height+200,25),b=new gp(l.width+200,l.height+200,25)){this.transform=l,this.grid=y,this.ignoredGrid=b,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+no,this.screenBottomBoundary=l.height+no,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=f}placeCollisionBox(l,f,y,b,T,S,A,O){let z=y.projectedAnchorX,B=y.projectedAnchorY,V=y.projectedAnchorZ;const W=y.elevation,X=y.tileID,se=l.getProjection();if(W&&X){const[Ie,Ce,Ne]=se.upVector(X.canonical,y.tileAnchorX,y.tileAnchorY),Fe=se.upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=Ie*W*Fe,B+=Ce*W*Fe,V+=Ne*W*Fe}const oe=this.projectAndGetPerspectiveRatio(A,z,B,V,y.tileID,se.name==="globe"||!!W||this.transform.pitch>0,se),ae=S*oe.perspectiveRatio,ce=(y.x1*f+b.x-y.padding)*ae+oe.point.x,be=(y.y1*f+b.y-y.padding)*ae+oe.point.y,we=(y.x2*f+b.x+y.padding)*ae+oe.point.x,ye=(y.y2*f+b.y+y.padding)*ae+oe.point.y,Me=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(ce,be,we,ye)||!T&&this.grid.hitTest(ce,be,we,ye,O)||Me?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[ce,be,we,ye],offscreen:this.isOffscreen(ce,be,we,ye),occluded:!1}}placeCollisionCircles(l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe){const ae=[],ce=this.transform.elevation,be=l.getProjection(),we=ce?ce.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,be):null,ye=new a.P(y.tileAnchorX,y.tileAnchorY);let{x:Me,y:Ie,z:Ce}=be.projectTilePoint(ye.x,ye.y,oe.canonical);if(we){const[_t,Ze,ot]=we(ye);Me+=_t,Ie+=Ze,Ce+=ot}const Ne=be.name==="globe",Fe=this.projectAndGetPerspectiveRatio(A,Me,Ie,Ce,oe,Ne||!!ce||this.transform.pitch>0,be),{perspectiveRatio:We}=Fe,Be=(V?S/We:S*We)/a.bP,Re=mo(Me,Ie,Ce,O),et=Fe.signedDistanceFromCamera>0?eh(Be,T,y.lineOffsetX*Be,y.lineOffsetY*Be,!1,Re,ye,y,b,O,{},ce&&!V?we:null,V&&!!ce,be,oe,V):null;let Ye=!1,Ve=!1,Ct=!0;if(et&&!Fe.occluded){const _t=.5*X*We+se,Ze=new a.P(-100,-100),ot=new a.P(this.screenRightBoundary,this.screenBottomBoundary),je=new Bb,{first:yt,last:xt}=et,$t=yt.path.length;let Gt=[];for(let En=$t-1;En>=1;En--)Gt.push(yt.path[En]);for(let En=1;En<xt.path.length;En++)Gt.push(xt.path[En]);const sn=2.5*_t;z&&(Gt=Gt.map(([En,Un,In],Gn)=>(we&&!Ne&&(In=we(Gn<$t-1?yt.tilePath[$t-1-Gn]:xt.tilePath[Gn-$t+2])[2]),mo(En,Un,In,z))),Gt.some(En=>En[3]<=0)&&(Gt=[]));let Kt=[];if(Gt.length>0){let En=1/0,Un=-1/0,In=1/0,Gn=-1/0;for(const dr of Gt)En=Math.min(En,dr[0]),In=Math.min(In,dr[1]),Un=Math.max(Un,dr[0]),Gn=Math.max(Gn,dr[1]);Un>=Ze.x&&En<=ot.x&&Gn>=Ze.y&&In<=ot.y&&(Kt=[Gt.map(dr=>new a.P(dr[0],dr[1]))],(En<Ze.x||Un>ot.x||In<Ze.y||Gn>ot.y)&&(Kt=a.cH(Kt,Ze.x,Ze.y,ot.x,ot.y)))}for(const En of Kt){je.reset(En,.25*_t);let Un=0;Un=je.length<=.5*_t?1:Math.ceil(je.paddedLength/sn)+1;for(let In=0;In<Un;In++){const Gn=In/Math.max(Un-1,1),dr=je.lerp(Gn),Xr=dr.x+no,Nr=dr.y+no;ae.push(Xr,Nr,_t,0);const mr=Xr-_t,zr=Nr-_t,Zn=Xr+_t,Jn=Nr+_t;if(Ct=Ct&&this.isOffscreen(mr,zr,Zn,Jn),Ve=Ve||this.isInsideGrid(mr,zr,Zn,Jn),!f&&this.grid.hitTestCircle(Xr,Nr,_t,W)&&(Ye=!0,!B))return{circles:[],offscreen:!1,collisionDetected:Ye,occluded:!1}}}}return{circles:!B&&Ye||!Ve?[]:ae,offscreen:Ct,collisionDetected:Ye,occluded:Fe.occluded}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let y=1/0,b=1/0,T=-1/0,S=-1/0;for(const B of l){const V=new a.P(B.x+no,B.y+no);y=Math.min(y,V.x),b=Math.min(b,V.y),T=Math.max(T,V.x),S=Math.max(S,V.y),f.push(V)}const A=this.grid.query(y,b,T,S).concat(this.ignoredGrid.query(y,b,T,S)),O={},z={};for(const B of A){const V=B.key;if(O[V.bucketInstanceId]===void 0&&(O[V.bucketInstanceId]={}),O[V.bucketInstanceId][V.featureIndex])continue;const W=[new a.P(B.x1,B.y1),new a.P(B.x2,B.y1),new a.P(B.x2,B.y2),new a.P(B.x1,B.y2)];a.cI(f,W)&&(O[V.bucketInstanceId][V.featureIndex]=!0,z[V.bucketInstanceId]===void 0&&(z[V.bucketInstanceId]=[]),z[V.bucketInstanceId].push(V.featureIndex))}return z}insertCollisionBox(l,f,y,b,T){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:b,collisionGroupID:T},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,y,b,T){const S=f?this.ignoredGrid:this.grid,A={bucketInstanceId:y,featureIndex:b,collisionGroupID:T};for(let O=0;O<l.length;O+=4)S.insertCircle(A,l[O],l[O+1],l[O+2])}projectAndGetPerspectiveRatio(l,f,y,b,T,S,A){const O=[f,y,b,1];let z=!1;b||this.transform.pitch>0?(a.aB.transformMat4(O,O,l),this.fogState&&T&&A.name!=="globe"&&(z=function(W,X,se,oe,ae,ce){const be=ce.calculateFogTileMatrix(ae),we=[X,se,oe];return a.$.transformMat4(we,we,be),ur(W,a.$.length(we),ce.pitch,ce._fov)}(this.fogState,f,y,b,T.toUnwrapped(),this.transform)>.9)):tp(O,O,l);const B=O[3];return{point:new a.P((O[0]/B+1)/2*this.transform.width+no,(-O[1]/B+1)/2*this.transform.height+no),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/B*.5,1.5),signedDistanceFromCamera:B,occluded:S&&O[2]>B||z}}isOffscreen(l,f,y,b){return y<no||l>=this.screenRightBoundary||b<no||f>this.screenBottomBoundary}isInsideGrid(l,f,y,b){return y>=0&&l<this.gridRightBoundary&&b>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=a.ae.identity([]);return a.ae.translate(l,l,[-100,-100,0]),l}}class jb{constructor(l,f,y,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):b&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class _p{constructor(l,f,y,b,T,S=!1){this.text=new jb(l?l.text:null,f,y,T),this.icon=new jb(l?l.icon:null,f,b,T),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Sg{constructor(l,f,y,b=!1){this.text=l,this.icon=f,this.skipFade=y,this.clipped=b}}class SA{constructor(){this.invProjMatrix=a.ae.create(),this.viewportMatrix=a.ae.create(),this.circles=[]}}class S0{constructor(l,f,y,b,T){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=y,this.bucketIndex=b,this.tileID=T}}class Ub{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:y=>y.collisionGroupID===f}}return this.collisionGroups[l]}}function I0(g,l,f,y,b){const{horizontalAlign:T,verticalAlign:S}=a.bS(g),A=-(T-.5)*l,O=-(S-.5)*f,z=a.bR(g,y);return new a.P(A+z[0]*b,O+z[1]*b)}function Ig(g,l,f,y,b){const T=new a.P(g,l);return f&&T._rotate(y?b:-b),T}class Vb{constructor(l,f,y,b,T,S){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new EA(this.transform,T),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Ub(y),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,y,b){const T=y.getBucket(f),S=y.latestFeatureIndex;if(!T||!S||f.fqid!==T.layerIds[0])return;const A=T.layers[0].layout,O=y.collisionBoxArray,z=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),B=y.tileSize/a.a4,V=y.tileID.toUnwrapped();this.transform.setProjection(T.projection);const W=(X=y.tileID,se=T.getProjection(),oe=this.transform,se.name===this.projection?oe.calculateProjMatrix(X.toUnwrapped()):ih(oe,se,X));var X,se,oe;const ae=A.get("text-pitch-alignment")==="map",ce=A.get("text-rotation-alignment")==="map";f.compileFilter();const be=f.dynamicFilter(),we=f.dynamicFilterNeedsFeature(),ye=this.transform.calculatePixelsToTileUnitsMatrix(y),Me=Yu(W,y.tileID.canonical,ae,ce,this.transform,T.getProjection(),ye);let Ie=null;if(ae){const Fe=Ju(W,y.tileID.canonical,ae,ce,this.transform,T.getProjection(),ye);Ie=a.ae.multiply([],this.transform.labelPlaneMatrix,Fe)}let Ce=null;be&&y.latestFeatureIndex&&(Ce={unwrappedTileID:V,dynamicFilter:be,dynamicFilterNeedsFeature:we,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new S0(T.bucketInstanceId,S,T.sourceLayerIndex,T.index,y.tileID);const Ne={bucket:T,layout:A,posMatrix:W,textLabelPlaneMatrix:Me,labelToScreenMatrix:Ie,clippingData:Ce,scale:z,textPixelRatio:B,holdingForFade:y.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:a.aE(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.aE(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(b)for(const Fe of T.sortKeyRanges){const{sortKey:We,symbolInstanceStart:Be,symbolInstanceEnd:Re}=Fe;l.push({sortKey:We,symbolInstanceStart:Be,symbolInstanceEnd:Re,parameters:Ne})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(l,f,y,b,T,S,A,O,z,B,V,W,X,se,oe,ae,ce,be){const{textOffset0:we,textOffset1:ye,crossTileID:Me}=W,Ie=[we,ye],Ce=I0(l,y,b,Ie,T),Ne=this.collisionIndex.placeCollisionBox(se,T,f,Ig(Ce.x,Ce.y,S,A,this.transform.angle),V,O,z,B.predicate);if(ae){const Fe=se.getSymbolInstanceIconSize(be,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(se,Fe,ae,Ig(Ce.x,Ce.y,S,A,this.transform.angle),V,O,z,B.predicate).box.length===0)return}if(Ne.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[Me]&&this.prevPlacement.placements[Me]&&this.prevPlacement.placements[Me].text&&(Fe=this.prevPlacement.variableOffsets[Me].anchor),this.variableOffsets[Me]={textOffset:Ie,width:y,height:b,anchor:l,textScale:T,prevAnchor:Fe},this.markUsedJustification(se,l,W,oe),se.allowVerticalPlacement&&(this.markUsedOrientation(se,oe,W),this.placedOrientations[Me]=oe),{shift:Ce,placedGlyphBoxes:Ne}}}placeLayerBucketPart(l,f,y,b){const{bucket:T,layout:S,posMatrix:A,textLabelPlaneMatrix:O,labelToScreenMatrix:z,clippingData:B,textPixelRatio:V,holdingForFade:W,collisionBoxArray:X,partiallyEvaluatedTextSize:se,partiallyEvaluatedIconSize:oe,collisionGroup:ae}=l.parameters,ce=S.get("text-optional"),be=S.get("icon-optional"),we=S.get("text-allow-overlap"),ye=S.get("icon-allow-overlap"),Me=S.get("text-rotation-alignment")==="map",Ie=S.get("text-pitch-alignment")==="map",Ce=S.get("symbol-z-order")==="viewport-y",Ne=S.get("symbol-z-elevate");this.transform.setProjection(T.projection);let Fe=we&&(ye||!T.hasIconData()||be),We=ye&&(we||!T.hasTextData()||ce);!T.collisionArrays&&X&&T.deserializeCollisionBoxes(X),y&&b&&T.updateCollisionDebugBuffers(this.transform.zoom,X);const Be=(Re,et,Ye)=>{const{crossTileID:Ve,numVerticalGlyphVertices:Ct}=Re;if(B){const Zn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Jn=null;if(B.dynamicFilterNeedsFeature){const Vn=this.retainedQueryData[T.bucketInstanceId];Jn=B.featureIndex.loadFeature({featureIndex:Re.featureIndex,bucketIndex:Vn.bucketIndex,sourceLayerIndex:Vn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,B.dynamicFilter)(Zn,Jn,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new a.P(Re.tileAnchorX,Re.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Ve]=new Sg(!1,!1,!1,!0),void f.add(Ve)}if(f.has(Ve))return;if(W)return void(this.placements[Ve]=new Sg(!1,!1,!1));let _t=!1,Ze=!1,ot=!0,je=!1,yt=!1,xt=null,$t={box:null,offscreen:null,occluded:null},Gt={box:null,offscreen:null,occluded:null},sn=null,Kt=null,En=null,Un=0,In=0,Gn=0;Ye.textFeatureIndex?Un=Ye.textFeatureIndex:Re.useRuntimeCollisionCircles&&(Un=Re.featureIndex),Ye.verticalTextFeatureIndex&&(In=Ye.verticalTextFeatureIndex);const dr=Zn=>{Zn.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Jn=this.transform.elevation;Zn.elevation=Re.zOffset+(Jn?Jn.getAtTileOffset(Zn.tileID,Zn.tileAnchorX,Zn.tileAnchorY):0)},Xr=Ye.textBox;if(Xr){dr(Xr);const Zn=Vn=>{let br=a.aF.horizontal;if(T.allowVerticalPlacement&&!Vn&&this.prevPlacement){const nr=this.prevPlacement.placedOrientations[Ve];nr&&(this.placedOrientations[Ve]=nr,br=nr,this.markUsedOrientation(T,br,Re))}return br},Jn=(Vn,br)=>{if(T.allowVerticalPlacement&&Ct>0&&Ye.verticalTextBox){for(const nr of T.writingModes)if(nr===a.aF.vertical?($t=br(),Gt=$t):$t=Vn(),$t&&$t.box&&$t.box.length)break}else $t=Vn()};if(S.get("text-variable-anchor")){let Vn=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ve]){const Rn=this.prevPlacement.variableOffsets[Ve];Vn.indexOf(Rn.anchor)>0&&(Vn=Vn.filter(Bi=>Bi!==Rn.anchor),Vn.unshift(Rn.anchor))}const br=(Rn,Bi,ji)=>{const ro=T.getSymbolInstanceTextSize(se,Re,this.transform.zoom,et),io=(Rn.x2-Rn.x1)*ro+2*Rn.padding,Gs=(Rn.y2-Rn.y1)*ro+2*Rn.padding,so=Re.hasIconTextFit&&!ye?Bi:null;so&&dr(so);let Ns={box:[],offscreen:!1,occluded:!1};const Ws=we?2*Vn.length:Vn.length;for(let kt=0;kt<Ws;++kt){const an=this.attemptAnchorPlacement(Vn[kt%Vn.length],Rn,io,Gs,ro,Me,Ie,V,A,ae,kt>=Vn.length,Re,et,T,ji,so,se,oe);if(an&&(Ns=an.placedGlyphBoxes,Ns&&Ns.box&&Ns.box.length)){_t=!0,xt=an.shift;break}}return Ns};Jn(()=>br(Xr,Ye.iconBox,a.aF.horizontal),()=>{const Rn=Ye.verticalTextBox;return Rn&&dr(Rn),T.allowVerticalPlacement&&!($t&&$t.box&&$t.box.length)&&Ct>0&&Rn?br(Rn,Ye.verticalIconBox,a.aF.vertical):{box:null,offscreen:null,occluded:null}}),$t&&(_t=$t.box,ot=$t.offscreen,je=$t.occluded);const nr=Zn(!(!$t||!$t.box));if(!_t&&this.prevPlacement){const Rn=this.prevPlacement.variableOffsets[Ve];Rn&&(this.variableOffsets[Ve]=Rn,this.markUsedJustification(T,Rn.anchor,Re,nr))}}else{const Vn=(br,nr)=>{const Rn=T.getSymbolInstanceTextSize(se,Re,this.transform.zoom,et),Bi=this.collisionIndex.placeCollisionBox(T,Rn,br,new a.P(0,0),we,V,A,ae.predicate);return Bi&&Bi.box&&Bi.box.length&&(this.markUsedOrientation(T,nr,Re),this.placedOrientations[Ve]=nr),Bi};Jn(()=>Vn(Xr,a.aF.horizontal),()=>{const br=Ye.verticalTextBox;return T.allowVerticalPlacement&&Ct>0&&br?(dr(br),Vn(br,a.aF.vertical)):{box:null,offscreen:null,occluded:null}}),Zn(!!($t&&$t.box&&$t.box.length))}}if(sn=$t,_t=sn&&sn.box&&sn.box.length>0,ot=sn&&sn.offscreen,je=sn&&sn.occluded,Re.useRuntimeCollisionCircles){const Zn=T.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex>=0?Re.centerJustifiedTextSymbolIndex:Re.verticalPlacedTextSymbolIndex),Jn=a.aG(T.textSizeData,se,Zn),Vn=S.get("text-padding");Kt=this.collisionIndex.placeCollisionCircles(T,we,Zn,T.lineVertexArray,T.glyphOffsetArray,Jn,A,O,z,y,Ie,ae.predicate,Re.collisionCircleDiameter*Jn/a.bP,Vn,this.retainedQueryData[T.bucketInstanceId].tileID),_t=we||Kt.circles.length>0&&!Kt.collisionDetected,ot=ot&&Kt.offscreen,je=Kt.occluded}if(Ye.iconFeatureIndex&&(Gn=Ye.iconFeatureIndex),Ye.iconBox){const Zn=Jn=>{dr(Jn);const Vn=Re.hasIconTextFit&&xt?Ig(xt.x,xt.y,Me,Ie,this.transform.angle):new a.P(0,0),br=T.getSymbolInstanceIconSize(oe,this.transform.zoom,Re.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,br,Jn,Vn,ye,V,A,ae.predicate)};Gt&&Gt.box&&Gt.box.length&&Ye.verticalIconBox?(En=Zn(Ye.verticalIconBox),Ze=En.box.length>0):(En=Zn(Ye.iconBox),Ze=En.box.length>0),ot=ot&&En.offscreen,yt=En.occluded}const Nr=ce||Re.numHorizontalGlyphVertices===0&&Ct===0,mr=be||Re.numIconVertices===0;if(Nr||mr?mr?Nr||(Ze=Ze&&_t):_t=Ze&&_t:Ze=_t=Ze&&_t,_t&&sn&&sn.box&&this.collisionIndex.insertCollisionBox(sn.box,S.get("text-ignore-placement"),T.bucketInstanceId,Gt&&Gt.box&&In?In:Un,ae.ID),Ze&&En&&this.collisionIndex.insertCollisionBox(En.box,S.get("icon-ignore-placement"),T.bucketInstanceId,Gn,ae.ID),Kt&&(_t&&this.collisionIndex.insertCollisionCircles(Kt.circles,S.get("text-ignore-placement"),T.bucketInstanceId,Un,ae.ID),y)){const Zn=T.bucketInstanceId;let Jn=this.collisionCircleArrays[Zn];Jn===void 0&&(Jn=this.collisionCircleArrays[Zn]=new SA);for(let Vn=0;Vn<Kt.circles.length;Vn+=4)Jn.circles.push(Kt.circles[Vn+0]),Jn.circles.push(Kt.circles[Vn+1]),Jn.circles.push(Kt.circles[Vn+2]),Jn.circles.push(Kt.collisionDetected?1:0)}const zr=T.projection.name!=="globe";Fe=Fe&&(zr||!je),We=We&&(zr||!yt),this.placements[Ve]=new Sg(_t||Fe,Ze||We,ot||T.justReloaded),f.add(Ve)};if(Ne&&this.buildingIndex&&(this.buildingIndex.updateZOffset(T,this.retainedQueryData[T.bucketInstanceId].tileID),T.updateZOffset()),Ce){const Re=T.getSortedSymbolIndexes(this.transform.angle);for(let et=Re.length-1;et>=0;--et){const Ye=Re[et];Be(T.symbolInstances.get(Ye),Ye,T.collisionArrays[Ye])}T.hasAnyZOffset&&a.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Re=T.getSortedIndexesByZOffset();for(let et=0;et<Re.length;++et){const Ye=Re[et];Be(T.symbolInstances.get(Ye),Ye,T.collisionArrays[Ye])}}else for(let Re=l.symbolInstanceStart;Re<l.symbolInstanceEnd;Re++)Be(T.symbolInstances.get(Re),Re,T.collisionArrays[Re]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[T.bucketInstanceId];a.ae.invert(Re.invProjMatrix,A),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(l,f,y,b){const{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:O,crossTileID:z}=y,B=a.cM(f),V=b===a.aF.vertical?O:B==="left"?T:B==="center"?S:B==="right"?A:-1;T>=0&&(l.text.placedSymbolArray.get(T).crossTileID=V>=0&&T!==V?0:z),S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=V>=0&&S!==V?0:z),A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=V>=0&&A!==V?0:z),O>=0&&(l.text.placedSymbolArray.get(O).crossTileID=V>=0&&O!==V?0:z)}markUsedOrientation(l,f,y){const b=f===a.aF.horizontal||f===a.aF.horizontalOnly?f:0,T=f===a.aF.vertical?f:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:z}=y,B=l.text.placedSymbolArray;S>=0&&(B.get(S).placedOrientation=b),A>=0&&(B.get(A).placedOrientation=b),O>=0&&(B.get(O).placedOrientation=b),z>=0&&(B.get(z).placedOrientation=T)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let y=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const b=f?f.symbolFadeChange(l):1,T=f?f.opacities:{},S=f?f.variableOffsets:{},A=f?f.placedOrientations:{};for(const O in this.placements){const z=this.placements[O],B=T[O];B?(this.opacities[O]=new _p(B,b,z.text,z.icon,null,z.clipped),y=y||z.text!==B.text.placed||z.icon!==B.icon.placed):(this.opacities[O]=new _p(null,b,z.text,z.icon,z.skipFade,z.clipped),y=y||z.text||z.icon)}for(const O in T){const z=T[O];if(!this.opacities[O]){const B=new _p(z,b,!1,!1);B.isHidden()||(this.opacities[O]=B,y=y||z.text.placed||z.icon.placed)}}for(const O in S)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=S[O]);for(const O in A)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=A[O]);y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f,y,b){const T=new Set;for(const S of f){const A=S.getBucket(l);A&&S.latestFeatureIndex&&l.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,T,S.collisionBoxArray,y,b,S.tileID,l.scope),A.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(A,S.tileID),A.updateZOffset()))}}updateBucketOpacities(l,f,y,b,T,S,A){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const O=l.layers[0].layout,z=!!l.layers[0].dynamicFilter(),B=new _p(null,0,!1,!1,!0),V=O.get("text-allow-overlap"),W=O.get("icon-allow-overlap"),X=O.get("text-variable-anchor"),se=O.get("text-rotation-alignment")==="map",oe=O.get("text-pitch-alignment")==="map",ae=new _p(null,0,V&&(W||!l.hasIconData()||O.get("icon-optional")),W&&(V||!l.hasTextData()||O.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const ce=(we,ye,Me)=>{for(let Ie=0;Ie<ye/4;Ie++)we.opacityVertexArray.emplaceBack(Me)};let be=0;T&&l.updateReplacement(S,T);for(let we=0;we<l.symbolInstances.length;we++){const ye=l.symbolInstances.get(we),{numHorizontalGlyphVertices:Me,numVerticalGlyphVertices:Ie,crossTileID:Ce,numIconVertices:Ne,tileAnchorX:Fe,tileAnchorY:We}=ye,Be=f.has(Ce);let Re=this.opacities[Ce];Be?Re=B:Re||(Re=ae,this.opacities[Ce]=Re),f.add(Ce);const et=Me>0||Ie>0,Ye=Ne>0,Ve=this.placedOrientations[Ce],Ct=Ve===a.aF.vertical,_t=Ve===a.aF.horizontal||Ve===a.aF.horizontalOnly;!et&&!Ye||Re.isHidden()||be++;let Ze=!1;if((et||Ye)&&T)for(const ot of l.activeReplacements){if(a.cJ(ot,b,a.cw.Symbol,A)||ot.min.x>Fe||Fe>ot.max.x||ot.min.y>We||We>ot.max.y)continue;const je=a.cK(Fe,We,S.canonical,ot.footprintTileId.canonical);if(Ze=a.cL(je,ot),Ze)break}if(et){const ot=Ze?au:aa(Re.text);ce(l.text,Me,Ct?au:ot),ce(l.text,Ie,_t?au:ot);const je=Re.text.isHidden(),{leftJustifiedTextSymbolIndex:yt,centerJustifiedTextSymbolIndex:xt,rightJustifiedTextSymbolIndex:$t,verticalPlacedTextSymbolIndex:Gt}=ye,sn=l.text.placedSymbolArray,Kt=je||Ct?1:0;yt>=0&&(sn.get(yt).hidden=Kt),xt>=0&&(sn.get(xt).hidden=Kt),$t>=0&&(sn.get($t).hidden=Kt),Gt>=0&&(sn.get(Gt).hidden=je||_t?1:0);const En=this.variableOffsets[Ce];En&&this.markUsedJustification(l,En.anchor,ye,Ve);const Un=this.placedOrientations[Ce];Un&&(this.markUsedJustification(l,"left",ye,Un),this.markUsedOrientation(l,Un,ye))}if(Ye){const ot=Ze?au:aa(Re.icon),{placedIconSymbolIndex:je,verticalPlacedIconSymbolIndex:yt}=ye,xt=l.icon.placedSymbolArray,$t=Re.icon.isHidden()?1:0;je>=0&&(ce(l.icon,Ne,Ct?au:ot),xt.get(je).hidden=$t),yt>=0&&(ce(l.icon,ye.numVerticalIconVertices,_t?au:ot),xt.get(yt).hidden=$t)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const ot=l.collisionArrays[we];if(ot){let je=new a.P(0,0),yt=!0;if(ot.textBox||ot.verticalTextBox){if(X){const $t=this.variableOffsets[Ce];$t?(je=I0($t.anchor,$t.width,$t.height,$t.textOffset,$t.textScale),se&&je._rotate(oe?this.transform.angle:-this.transform.angle)):yt=!1}z&&(yt=!Re.clipped),ot.textBox&&Al(l.textCollisionBox.collisionVertexArray,Re.text.placed,!yt||Ct,je.x,je.y),ot.verticalTextBox&&Al(l.textCollisionBox.collisionVertexArray,Re.text.placed,!yt||_t,je.x,je.y)}const xt=yt&&!!(!_t&&ot.verticalIconBox);ot.iconBox&&Al(l.iconCollisionBox.collisionVertexArray,Re.icon.placed,xt,ye.hasIconTextFit?je.x:0,ye.hasIconTextFit?je.y:0),ot.verticalIconBox&&Al(l.iconCollisionBox.collisionVertexArray,Re.icon.placed,!xt,ye.hasIconTextFit?je.x:0,ye.hasIconTextFit?je.y:0)}}}if(l.fullyClipped=be===0,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=we.invProjMatrix,l.placementViewportMatrix=we.viewportMatrix,l.collisionCircleArray=we.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const y=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function Al(g,l,f,y,b){g.emplaceBack(l?1:0,f?1:0,y||0,b||0),g.emplaceBack(l?1:0,f?1:0,y||0,b||0),g.emplaceBack(l?1:0,f?1:0,y||0,b||0),g.emplaceBack(l?1:0,f?1:0,y||0,b||0)}const Cg=Math.pow(2,25),$b=Math.pow(2,24),qb=Math.pow(2,17),yp=Math.pow(2,16),vp=Math.pow(2,9),Gb=Math.pow(2,8),C0=Math.pow(2,1);function aa(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const l=g.placed?1:0,f=Math.floor(127*g.opacity);return f*Cg+l*$b+f*qb+l*yp+f*vp+l*Gb+f*C0+l}const au=0;class Ft{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,f,y,b,T){const S=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(S,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,O)=>A.sortKey-O.sortKey));this._currentPartIndex<S.length;){const A=S[this._currentPartIndex];if(f.placeLayerBucketPart(A,this._seenCrossTileIDs,y,A.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class Wb{constructor(l,f,y,b,T,S,A,O,z){this.placement=new Vb(l,T,S,A,O,z),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(l,f,y,b){const T=a.e.now(),S=()=>{const A=a.e.now()-T;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=f[l[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=O)&&(!A.maxzoom||A.maxzoom>O)){const z=A,B=z.layout.get("symbol-z-elevate"),V=this._inProgressLayer=this._inProgressLayer||new Ft(z),W=a.am(A.source,A.scope);if(V.continuePlacement(B?b[W]:y[W],this.placement,this._showCollisionBoxes,A,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const xp=512/a.a4/2;class A0{constructor(l,f,y){this.tileID=l,this.bucketInstanceId=y,this.index=new a.cN(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=l.canonical.x*a.a4,T=l.canonical.y*a.a4;for(let S=0;S<f.length;S++){const{key:A,crossTileID:O,tileAnchorX:z,tileAnchorY:B}=f.get(S),V=Math.floor((b+z)*xp),W=Math.floor((T+B)*xp);this.index.add(V,W),this.keys.push(A),this.crossTileIDs.push(O)}this.index.finish()}findMatches(l,f,y){const b=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),T=xp/Math.pow(2,f.canonical.z-this.tileID.canonical.z),S=f.canonical.x*a.a4,A=f.canonical.y*a.a4;for(let O=0;O<l.length;O++){const z=l.get(O);if(z.crossTileID)continue;const{key:B,tileAnchorX:V,tileAnchorY:W}=z,X=Math.floor((S+V)*T),se=Math.floor((A+W)*T),oe=this.index.range(X-b,se-b,X+b,se+b);for(const ae of oe){const ce=this.crossTileIDs[ae];if(this.keys[ae]===B&&!y.has(ce)){y.add(ce),z.crossTileID=ce;break}}}}}class Hb{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ag{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const y in this.indexes){const b=this.indexes[y],T={};for(const S in b){const A=b[S];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+f),T[A.tileID.key]=A}this.indexes[y]=T}this.lng=l}addBucket(l,f,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let T=0;T<f.symbolInstances.length;T++)f.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const b=this.usedCrossTileIDs[l.overscaledZ];for(const T in this.indexes){const S=this.indexes[T];if(Number(T)>l.overscaledZ)for(const A in S){const O=S[A];O.tileID.isChildOf(l)&&O.findMatches(f.symbolInstances,l,b)}else{const A=S[l.scaledTo(Number(T)).key];A&&A.findMatches(f.symbolInstances,l,b)}}for(let T=0;T<f.symbolInstances.length;T++){const S=f.symbolInstances.get(T);S.crossTileID||(S.crossTileID=y.generate(),b.add(S.crossTileID))}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new A0(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const y of f.crossTileIDs)this.usedCrossTileIDs[l].delete(y)}removeStaleBuckets(l){let f=!1;for(const y in this.indexes){const b=this.indexes[y];for(const T in b)l[b[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,b[T]),delete b[T],f=!0)}return f}}class mc{constructor(){this.layerIndexes={},this.crossTileIDs=new Hb,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,y,b){let T=this.layerIndexes[l.fqid];T===void 0&&(T=this.layerIndexes[l.fqid]=new Ag);let S=!1;const A={};b.name!=="globe"&&T.handleWrapJump(y);for(const O of f){const z=O.getBucket(l);z&&l.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(O.tileID,z,this.crossTileIDs)&&(S=!0),A[z.bucketInstanceId]=!0)}return T.removeStaleBuckets(A)&&(S=!0),S}pruneUnusedLayers(l){const f={};l.forEach(y=>{f[y]=!0});for(const y in this.layerIndexes)f[y]||delete this.layerIndexes[y]}}const P0=new a.U({data:new a.W(a.N.colorTheme.data)}),la=(g,l)=>_n(g,l&&l.filter(f=>f.identifier!=="source.canvas")),Pg=a.ai(Ir,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Sd=a.ai(Ir,["setCenter","setZoom","setBearing","setPitch"]),Zb={version:8,layers:[],sources:{}},Xb={duration:300,delay:0};class ca extends a.E{constructor(l,f={}){super(),this.map=l,this.scope=f.scope||"",this.globalId=null,this.fragments=[],this.importDepth=f.importDepth||0,this.importsCache=f.importsCache||new Map,this.resolvedImports=f.resolvedImports||new Set,this.transition=a.Q({},Xb),this._buildingIndex=new Bo(this),this.crossTileSymbolIndex=new mc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=f.styleChanges||new K,this.dispatcher=f.dispatcher?f.dispatcher:new a.by(a.bz(),this),f.imageManager?this.imageManager=f.imageManager:(this.imageManager=new An,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=f.glyphManager?f.glyphManager:new a.cP(l._requestManager,f.localFontFamily?a.cQ.all:f.localIdeographFontFamily?a.cQ.ideographs:a.cQ.none,f.localFontFamily||f.localIdeographFontFamily),f.modelManager?this.modelManager=f.modelManager:(this.modelManager=new Ci(l._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=f.configOptions?f.configOptions:new Map,this._configDependentLayers=f.configDependentLayers?f.configDependentLayers:new Set,this._config=f.config,this._initialConfig=f.initialConfig,this.dispatcher.broadcast("setReferrer",a.cR());const y=this;this._rtlTextPluginCallback=ca.registerForPluginStateChange(b=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(T,S)=>{if(a.cS(T),S&&S.every(A=>A))for(const A in y._sourceCaches){const O=y._sourceCaches[A],z=O.getSource().type;z!=="vector"&&z!=="geojson"||O.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const T=this.getOwnSource(b.sourceId);if(T&&T.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===T.id&&this._validateLayer(A)}})}load(l){return l?(typeof l=="string"?this.loadURL(l):this.loadJSON(l),this):this}_getGlobalId(l){if(!l)return null;if(typeof l=="string"){if(a.cT(l))return l;const f=a.cU(l);if(!f.startsWith("http"))try{return new URL(f,location.href).toString()}catch{return f}return f}return`json://${a.cV(JSON.stringify(l))}`}_diffStyle(l,f,y){this.globalId=this._getGlobalId(l);const b=(T,S)=>{try{S(null,this.setState(T,y))}catch(A){S(A,!1)}};if(typeof l=="string"){const T=this.map._requestManager.normalizeStyleURL(l),S=this.map._requestManager.transformRequest(T,a.R.Style);a.h(S,(A,O)=>{A?this.fire(new a.f(A)):O&&b(O,f)})}else typeof l=="object"&&b(l,f)}loadURL(l,f={}){this.fire(new a.g("dataloading",{dataType:"style"}));const y=typeof f.validate=="boolean"?f.validate:!a.cT(l);this.globalId=this._getGlobalId(l),l=this.map._requestManager.normalizeStyleURL(l,f.accessToken),this.resolvedImports.add(l);const b=this.importsCache.get(l);if(b)return this._load(b,y);const T=this.map._requestManager.transformRequest(l,a.R.Style);this._request=a.h(T,(S,A)=>{if(this._request=null,S)this.fire(new a.f(S));else if(A)return this.importsCache.set(l,A),this._load(A,y)})}loadJSON(l,f={}){this.fire(new a.g("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(l),this._request=a.e.frame(()=>{this._request=null,this._load(l,f.validate!==!1)})}loadEmpty(){this.fire(new a.g("dataloading",{dataType:"style"})),this._load(Zb,!1)}_loadImports(l,f,y){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const T of l){const S=this._createFragmentStyle(T),A=new Promise(B=>{S.once("style.import.load",B),S.once("error",B)}).then(()=>this.mergeAll());if(b.push(A),this.resolvedImports.has(T.url)){S.loadEmpty();continue}const O=T.data||this.importsCache.get(T.url);O?(S.loadJSON(O,{validate:f}),this._isInternalStyle(O)&&(S.globalId=null)):T.url?S.loadURL(T.url,{validate:f}):S.loadEmpty();const z={style:S,id:T.id,config:T.config};if(y){const B=this.fragments.findIndex(({id:V})=>V===y);this.fragments=this.fragments.slice(0,B).concat(z).concat(this.fragments.slice(B))}else this.fragments.push(z)}return Promise.allSettled(b)}getImportGlobalIds(l=this,f=new Set){for(const y of l.fragments)y.style.globalId&&f.add(y.style.globalId),this.getImportGlobalIds(y.style,f);return[...f.values()]}_createFragmentStyle(l){const f=this.scope?a.am(l.id,this.scope):l.id;let y;const b=this._initialConfig&&this._initialConfig[f];(l.config||b)&&(y=a.Q({},l.config,b));const T=new ca(this.map,{scope:f,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,configDependentLayers:this._configDependentLayers});return T.setEventedParent(this.map,{style:T}),T}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(l){return this.isRootStyle()&&(l.fragment||!!l.schema&&l.fragment!==!1)}_load(l,f){const y=l.schema;if(this._isInternalStyle(l)){const S=a.Q({},Zb,{imports:[{id:"basemap",data:l,url:""}]});return void this._load(S,f)}if(this.updateConfig(this._config,y),f&&la(this,ne(l)))return;this._loaded=!0,this.stylesheet=a.cW(l);const b=()=>{for(const z in l.sources)this.addSource(z,l.sources[z],{validate:!1,isInitialLoad:!0});l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(l.glyphs,this.scope);const S=pp(this.stylesheet.layers);if(this._order=S.map(z=>z.id),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new lr(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new lr(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const z of S){const B=a.c$(z,this.scope,this._styleColorTheme.lut,this.options);B.configDependencies.size!==0&&this._configDependentLayers.add(B.fqid),B.setEventedParent(this,{layer:{id:B.id}}),this._layers[B.id]=B,this._serializedLayers[B.id]=B.serialize();const V=this.getOwnLayerSourceCache(B),W=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&B.canCastShadows()&&W&&(V.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.g("data",{dataType:"style"}));const O=this.isRootStyle();l.imports?this._loadImports(l.imports,f).then(()=>{this._reloadImports(),this.fire(new a.g(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new a.g(O?"style.load":"style.import.load")))},T=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=T,T){const S=this._evaluateColorThemeData(T);this._loadColorTheme(S).then(()=>{b()}).catch(A=>{a.w(`Couldn't load color theme from the stylesheet: ${A}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return this.importDepth===0}mergeAll(){let l,f,y,b,T,S,A,O;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(l=B.light),B.stylesheet.lights)for(const V of B.stylesheet.lights)V.type==="ambient"&&B.ambientLight!=null&&(f=B.ambientLight),V.type==="directional"&&B.directionalLight!=null&&(y=B.directionalLight);b=this._prioritizeTerrain(b,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(T=B.fog),B.stylesheet.camera!=null&&(O=B.stylesheet.camera),B.stylesheet.projection!=null&&(S=B.stylesheet.projection),B.stylesheet.transition!=null&&(A=B.stylesheet.transition),z[B.scope]=B._styleColorTheme}}),this.light=l,this.ambientLight=f,this.directionalLight=y,this.fog=T,this._styleColorThemeForScope=z,b===null?delete this.terrain:this.terrain=b,this.camera=O||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=a.Q({},Xb,A),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(l){const f=y=>{for(const b of y.fragments)f(b.style);l(y)};f(this)}_prioritizeTerrain(l,f,y){const b=l&&l.drapeRenderMode===0;return y===null?f&&f.drapeRenderMode===0?f:b?l:null:f!=null&&(!l||b||f&&f.drapeRenderMode===1)?f:l}mergeTerrain(){let l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(f=>{l=this._prioritizeTerrain(l,f.terrain,f.stylesheet.terrain)}),l===null?delete this.terrain:this.terrain=l}mergeProjection(){let l;this.forEachFragmentStyle(f=>{f.stylesheet.projection!=null&&(l=f.stylesheet.projection)}),this.projection=l||{name:"mercator"}}mergeSources(){const l={},f={},y={};this.forEachFragmentStyle(b=>{for(const T in b._sourceCaches){const S=a.am(T,b.scope);l[S]=b._sourceCaches[T]}for(const T in b._otherSourceCaches){const S=a.am(T,b.scope);f[S]=b._otherSourceCaches[T]}for(const T in b._symbolSourceCaches){const S=a.am(T,b.scope);y[S]=b._symbolSourceCaches[T]}}),this._mergedSourceCaches=l,this._mergedOtherSourceCaches=f,this._mergedSymbolSourceCaches=y}mergeLayers(){const l={},f=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const A of S._order){const O=S._layers[A];if(O.type==="slot"){const z=a.cX(A);if(l[z])continue;l[z]=[]}O.slot&&l[O.slot]?l[O.slot].push(O):f.push(O)}}),this._mergedOrder=[],this._clipLayerIndices=[];let b=0;const T=(S=[])=>{for(const A of S)if(A.type==="slot"){const O=a.cX(A.id);l[O]&&T(l[O]),this._mergedSlots.push(O)}else{const O=a.am(A.id,A.scope);this._mergedOrder.push(O),y[O]=A,A.is3D()&&(this._has3DLayers=!0),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0),A.type==="clip"&&this._clipLayerIndices.push(b),b++}};T(f),this._mergedOrder.sort((S,A)=>{const O=y[S],z=y[A];return O.hasInitialOcclusionOpacityProperties?z.is3D()?1:0:O.is3D()&&z.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(l){return this.stylesheet.camera=a.Q({},this.stylesheet.camera,l),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(l){return l.data?function(f,y,b){const T=a.Q({},y);for(const A of Object.keys(a.N.colorTheme))T[A]===void 0&&(T[A]=a.N.colorTheme[A].default);const S=new a.O(P0,f,new Map(b));return S.setTransitionOrValue(T,b),S.untransitioned().possiblyEvaluate(new a.Y(0))}(this.scope,l,this.options).get("data"):null}_loadColorTheme(l){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const f=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,b)=>{const T="data:image/png;base64,";if(!l||l.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let S=l;S.startsWith(T)||(S=T+S);const A="mapbox-reserved-lut",O=new Image;O.src=S,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==f)return void y();this._styleColorTheme.lutLoading=!1;const{width:z,height:B,data:V}=a.e.getImageData(O);if(B>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==B*B)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new a.j({width:z,height:B},V),pixelRatio:1,sdf:!1,version:0});const W=this.imageManager.getImage(A,this.scope);W?(this._styleColorTheme.lut={image:W.data,data:l},y()):b(new Error("Missing LUT image."))}})}getLut(l){const f=this._styleColorThemeForScope[l];return f?f.lut:null}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(l){this._spriteRequest=function(f,y,b){let T,S,A;const O=a.e.devicePixelRatio>1?"@2x":"";let z=a.h(y.transformRequest(y.normalizeSpriteURL(f,O,".json"),a.R.SpriteJSON),(W,X)=>{z=null,A||(A=W,T=X,V())}),B=a.i(y.transformRequest(y.normalizeSpriteURL(f,O,".png"),a.R.SpriteImage),(W,X)=>{B=null,A||(A=W,S=X,V())});function V(){if(A)b(A);else if(T&&S){const W=a.e.getImageData(S),X={};for(const se in T){const{width:oe,height:ae,x:ce,y:be,sdf:we,pixelRatio:ye,stretchX:Me,stretchY:Ie,content:Ce}=T[se],Ne=new a.j({width:oe,height:ae});a.j.copy(W,Ne,{x:ce,y:be},{x:0,y:0},{width:oe,height:ae},null),X[se]={data:Ne,pixelRatio:ye,sdf:we,stretchX:Me,stretchY:Ie,content:Ce}}b(null,X)}}return{cancel(){z&&(z.cancel(),z=null),B&&(B.cancel(),B=null)}}}(l,this.map._requestManager,(f,y)=>{if(this._spriteRequest=null,f)this.fire(new a.f(f));else if(y)for(const b in y)this.imageManager.addImage(b,this.scope,y[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.g("data",{dataType:"style"}))})}_validateLayer(l){const f=this.getOwnSource(l.source);if(!f)return;const y=l.sourceLayer;y&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(y)===-1)&&this.fire(new a.f(new Error(`Source layer "${y}" does not exist on source "${f.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:l}of this.fragments)if(!l.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((l,f)=>{const y=this.fragments[f];return y&&y.style&&(l.data=y.style.serialize()),l})}_serializeSources(){const l={};for(const f in this._sourceCaches){const y=this._sourceCaches[f].getSource();l[y.id]||(l[y.id]=y.serialize())}return l}_serializeLayers(l){const f=[];for(const y of l){const b=this._layers[y];b&&b.type!=="custom"&&f.push(b.serialize())}return f}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(l){return!!this.terrain&&l.isDraped(this.getLayerSourceCache(l))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(l){const f=this.getOwnLayer(l);if(f)return f;this.fire(new a.f(new Error(`The layer '${l}' does not exist in the map's style.`)))}_checkSource(l){const f=this.getOwnSource(l);if(f)return f;this.fire(new a.f(new Error(`The source '${l}' does not exist in the map's style.`)))}precompilePrograms(l,f){const y=this.map.painter;if(y)for(let b=l.minzoom||0;b<(l.maxzoom||25.5);b++){const T=l.getProgramIds();if(T)for(const S of T){const A=l.getDefaultProgramParams(S,f.zoom,this._styleColorTheme.lut);A&&(y.style=this,this.fog&&(y._fogVisible=!0,A.overrideFog=!0,y.getOrCreateProgram(S,A)),y._fogVisible=!1,A.overrideFog=!1,y.getOrCreateProgram(S,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,y.getOrCreateProgram(S,A)))}}}update(l){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(l),this.directionalLight&&this.directionalLight.recalculate(l);const f=this.calculateLightsBrightness();l.brightness=f||0,f!==this._brightness&&(this._brightness=f,this.dispatcher.broadcast("setBrightness",f));const y=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const A in S){const{updatedIds:O,removedIds:z}=S[A];(O||z)&&(this._updateWorkerLayers(A,O,z),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(l),this.light&&this.light.updateTransitions(l),this.ambientLight&&this.ambientLight.updateTransitions(l),this.directionalLight&&this.directionalLight.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._changes.reset()}const T={};for(const S in this._mergedSourceCaches){const A=this._mergedSourceCaches[S];T[S]=A.used,A.used=!1,A.tileCoverLift=0}for(const S of this._mergedOrder){const A=this._mergedLayers[S];if(A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)){const O=this.getLayerSourceCache(A);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,l)}):this.precompilePrograms(A,l))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();for(const S in T){const A=this._mergedSourceCaches[S];T[S]!==A.used&&A.getSource().fire(new a.g("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new a.g("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=this._changes.getUpdatedImages();if(l.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changes.resetUpdatedImages()}}_updateWorkerLayers(l,f,y){const b=this.getFragmentStyle(l);b&&this.dispatcher.broadcast("updateLayers",{layers:f?b._serializeLayers(f):[],scope:l,removedIds:y||[],options:b.options})}setState(l,f){if(this._checkLoaded(),la(this,ne(l)))return!1;(l=a.cW(l)).layers=pp(l.layers);const y=function(S,A){if(!S)return[{command:Ir.setStyle,args:[A]}];let O=[];try{if(!a.d(S.version,A.version))return[{command:Ir.setStyle,args:[A]}];if(a.d(S.center,A.center)||O.push({command:Ir.setCenter,args:[A.center]}),a.d(S.zoom,A.zoom)||O.push({command:Ir.setZoom,args:[A.zoom]}),a.d(S.bearing,A.bearing)||O.push({command:Ir.setBearing,args:[A.bearing]}),a.d(S.pitch,A.pitch)||O.push({command:Ir.setPitch,args:[A.pitch]}),a.d(S.sprite,A.sprite)||O.push({command:Ir.setSprite,args:[A.sprite]}),a.d(S.glyphs,A.glyphs)||O.push({command:Ir.setGlyphs,args:[A.glyphs]}),a.d(S.imports,A.imports)||function(X=[],se=[],oe){se=se||[];const ae=(X=X||[]).map(Eg),ce=se.map(Eg),be=X.reduce(pc,{}),we=se.reduce(pc,{}),ye=ae.slice();let Me,Ie,Ce,Ne;for(Me=0,Ie=0;Me<ae.length;Me++)Ce=ae[Me],we.hasOwnProperty(Ce)?Ie++:(oe.push({command:Ir.removeImport,args:[Ce]}),ye.splice(ye.indexOf(Ce,Ie),1));for(Me=0,Ie=0;Me<ce.length;Me++)Ce=ce[ce.length-1-Me],ye[ye.length-1-Me]!==Ce&&(be.hasOwnProperty(Ce)?(oe.push({command:Ir.removeImport,args:[Ce]}),ye.splice(ye.lastIndexOf(Ce,ye.length-Ie),1)):Ie++,Ne=ye[ye.length-Me],oe.push({command:Ir.addImport,args:[we[Ce],Ne]}),ye.splice(ye.length-Me,0,Ce));for(const Fe of se){const We=be[Fe.id];We&&!a.d(We,Fe)&&oe.push({command:Ir.updateImport,args:[Fe.id,Fe]})}}(S.imports,A.imports,O),a.d(S.transition,A.transition)||O.push({command:Ir.setTransition,args:[A.transition]}),a.d(S.light,A.light)||O.push({command:Ir.setLight,args:[A.light]}),a.d(S.fog,A.fog)||O.push({command:Ir.setFog,args:[A.fog]}),a.d(S.projection,A.projection)||O.push({command:Ir.setProjection,args:[A.projection]}),a.d(S.lights,A.lights)||O.push({command:Ir.setLights,args:[A.lights]}),a.d(S.camera,A.camera)||O.push({command:Ir.setCamera,args:[A.camera]}),!a.d(S["color-theme"],A["color-theme"]))return[{command:Ir.setStyle,args:[A]}];const z={},B=[];(function(X,se,oe,ae){let ce;for(ce in se=se||{},X=X||{})X.hasOwnProperty(ce)&&(se.hasOwnProperty(ce)||Fb(ce,oe,ae));for(ce in se){if(!se.hasOwnProperty(ce))continue;const be=se[ce];X.hasOwnProperty(ce)?a.d(X[ce],be)||(X[ce].type==="geojson"&&be.type==="geojson"&&mp(X,se,ce)?oe.push({command:Ir.setGeoJSONSourceData,args:[ce,be.data]}):TA(ce,se,oe,ae)):Ed(ce,se,oe)}})(S.sources,A.sources,B,z);const V=[];S.layers&&S.layers.forEach(X=>{X.source&&z[X.source]?O.push({command:Ir.removeLayer,args:[X.id]}):V.push(X)});let W=S.terrain;W&&z[W.source]&&(O.push({command:Ir.setTerrain,args:[void 0]}),W=void 0),O=O.concat(B),a.d(W,A.terrain)||O.push({command:Ir.setTerrain,args:[A.terrain]}),function(X,se,oe){se=se||[];const ae=(X=X||[]).map(Eg),ce=se.map(Eg),be=X.reduce(pc,{}),we=se.reduce(pc,{}),ye=ae.slice(),Me=Object.create(null);let Ie,Ce,Ne,Fe,We,Be,Re;for(Ie=0,Ce=0;Ie<ae.length;Ie++)Ne=ae[Ie],we.hasOwnProperty(Ne)?Ce++:(oe.push({command:Ir.removeLayer,args:[Ne]}),ye.splice(ye.indexOf(Ne,Ce),1));for(Ie=0,Ce=0;Ie<ce.length;Ie++)Ne=ce[ce.length-1-Ie],ye[ye.length-1-Ie]!==Ne&&(be.hasOwnProperty(Ne)?(oe.push({command:Ir.removeLayer,args:[Ne]}),ye.splice(ye.lastIndexOf(Ne,ye.length-Ce),1)):Ce++,Be=ye[ye.length-Ie],oe.push({command:Ir.addLayer,args:[we[Ne],Be]}),ye.splice(ye.length-Ie,0,Ne),Me[Ne]=!0);for(Ie=0;Ie<ce.length;Ie++)if(Ne=ce[Ie],Fe=be[Ne],We=we[Ne],!Me[Ne]&&!a.d(Fe,We))if(a.d(Fe.source,We.source)&&a.d(Fe["source-layer"],We["source-layer"])&&a.d(Fe.type,We.type)){for(Re in ou(Fe.layout,We.layout,oe,Ne,null,Ir.setLayoutProperty),ou(Fe.paint,We.paint,oe,Ne,null,Ir.setPaintProperty),a.d(Fe.slot,We.slot)||oe.push({command:Ir.setSlot,args:[Ne,We.slot]}),a.d(Fe.filter,We.filter)||oe.push({command:Ir.setFilter,args:[Ne,We.filter]}),a.d(Fe.minzoom,We.minzoom)&&a.d(Fe.maxzoom,We.maxzoom)||oe.push({command:Ir.setLayerZoomRange,args:[Ne,We.minzoom,We.maxzoom]}),Fe)Fe.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?ou(Fe[Re],We[Re],oe,Ne,Re.slice(6),Ir.setPaintProperty):a.d(Fe[Re],We[Re])||oe.push({command:Ir.setLayerProperty,args:[Ne,Re,We[Re]]}));for(Re in We)We.hasOwnProperty(Re)&&!Fe.hasOwnProperty(Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&Re!=="slot"&&(Re.indexOf("paint.")===0?ou(Fe[Re],We[Re],oe,Ne,Re.slice(6),Ir.setPaintProperty):a.d(Fe[Re],We[Re])||oe.push({command:Ir.setLayerProperty,args:[Ne,Re,We[Re]]}))}else oe.push({command:Ir.removeLayer,args:[Ne]}),Be=ye[ye.lastIndexOf(Ne)+1],oe.push({command:Ir.addLayer,args:[We,Be]})}(V,A.layers,O)}catch(z){console.warn("Unable to compute style diff:",z),O=[{command:Ir.setStyle,args:[A]}]}return O}(this.serialize(),l).filter(S=>!(S.command in Sd));if(y.length===0)return!1;const b=y.filter(S=>!(S.command in Pg));if(b.length>0)throw new Error(`Unimplemented: ${b.map(S=>S.command).join(", ")}.`);const T=[];return y.forEach(S=>{T.push(this[S.command].apply(this,S.args))}),f&&Promise.all(T).then(f),this.stylesheet=l,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(l,f){return this.getImage(l)?this.fire(new a.f(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,this.scope,f),this._afterImageUpdated(l),this)}updateImage(l,f){this.imageManager.updateImage(l,this.scope,f)}getImage(l){return this.imageManager.getImage(l,this.scope)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l,this.scope),this._afterImageUpdated(l),this):this.fire(new a.f(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(l),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new a.g("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(l,f,y={}){return this._checkLoaded(),this._validate(It,`models.${l}`,f,null,y)||(this.modelManager.addModel(l,f,this.scope),this._changes.setDirty()),this}hasModel(l){return this.modelManager.hasModel(l,this.scope)}removeModel(l){return this.hasModel(l)?(this.modelManager.removeModel(l,this.scope),this):this.fire(new a.f(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(l,f,y={}){if(this._checkLoaded(),this.getOwnSource(l)!==void 0)throw new Error(`There is already a source with ID "${l}".`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(le,`sources.${l}`,f,null,y))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const b=he(l,f,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const T=S=>{const A=(S?"symbol:":"other:")+b.id,O=a.am(A,this.scope),z=this._sourceCaches[A]=new a.bx(O,b,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=z,z.onAdd(this.map)};T(!1),f.type!=="vector"&&f.type!=="geojson"||T(!0),b.onAdd&&b.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(l){this._checkLoaded();const f=this.getOwnSource(l);if(!f)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===l)return this.fire(new a.f(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(l);for(const b of y){const T=a.cX(b.id);delete this._sourceCaches[T],this._changes.discardSourceCacheUpdate(b.id),b.fire(new a.g("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],this.mergeSources(),f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(l,f){this._checkLoaded(),this.getOwnSource(l).setData(f),this._changes.setDirty()}getOwnSource(l){const f=this.getOwnSourceCache(l);return f&&f.getSource()}getOwnSources(){const l=[];for(const f in this._otherSourceCaches){const y=this.getOwnSourceCache(f);y&&l.push(y.getSource())}return l}areTilesLoaded(){const l=this._mergedSourceCaches;for(const f in l){const y=l[f]._tiles;for(const b in y){const T=y[b];if(T.state!=="loaded"&&T.state!=="errored")return!1}}return!0}setLights(l){if(this._checkLoaded(),!l)return delete this.ambientLight,void delete this.directionalLight;const f=this._getTransitionParameters();for(const b of l){if(this._validate(Le,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(f)}else this.ambientLight=new tc(b,ad||(ad=new a.U({color:new a.W(a.N.properties_light_ambient.color),intensity:new a.W(a.N.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(f)}else this.directionalLight=new tc(b,ld||(ld=new a.U({direction:new a.a6(a.N.properties_light_directional.direction),color:new a.W(a.N.properties_light_directional.color),intensity:new a.W(a.N.properties_light_directional.intensity),"cast-shadows":new a.W(a.N.properties_light_directional["cast-shadows"]),"shadow-intensity":new a.W(a.N.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=new a.Y(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const l=this.directionalLight,f=this.ambientLight;if(!l||!f)return;const y=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),b=l.properties.get("color").toRenderColor(null).toArray01(),T=l.properties.get("intensity"),S=l.properties.get("direction"),A=1-a.ad(S.x,S.y,S.z)[2]/90,O=y(b)*T*A,z=f.properties.get("color").toRenderColor(null).toArray01(),B=f.properties.get("intensity");return(O+y(z)*B)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const l=[];return this.directionalLight&&l.push(this.directionalLight.get()),this.ambientLight&&l.push(this.ambientLight.get()),l}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(l){if(!l)return this;if(a.cY(l)){const f=a.cZ(l),y=this.fragments.find(({id:T})=>T===f);if(!y)throw new Error(`Style import not found: ${l}`);const b=a.cX(l);return y.style.getFragmentStyle(b)}{const f=this.fragments.find(({id:y})=>y===l);if(!f)throw new Error(`Style import not found: ${l}`);return f.style}}getConfigProperty(l,f){const y=this.getFragmentStyle(l);if(!y)return null;const b=a.am(f,y.scope),T=y.options.get(b),S=T?T.value||T.default:null;return S?S.serialize():null}setConfigProperty(l,f,y){const b=this.getFragmentStyle(l);if(!b)return;const T=b.stylesheet.schema;if(!T||!T[f])return;const S=a.z(y);if(S.result!=="success")return void la(this,S.value);const A=S.value.expression,O=a.am(f,b.scope),z=b.options.get(O);if(!z)return;let B;const{minValue:V,maxValue:W,stepValue:X,type:se,values:oe}=T[f],ae=a.z(T[f].default);ae.result==="success"&&(B=ae.value.expression),B?(this.options.set(O,{...z,value:A,default:B,minValue:V,maxValue:W,stepValue:X,type:se,values:oe}),this.updateConfigDependencies(f)):this.fire(new a.f(new Error(`No schema defined for the config option "${f}" in the "${l}" fragment.`)))}getConfig(l){const f=this.getFragmentStyle(l);if(!f)return null;const y=f.stylesheet.schema;if(!y)return null;const b={};for(const T in y){const S=a.am(T,f.scope),A=f.options.get(S),O=A?A.value||A.default:null;b[T]=O?O.serialize():null}return b}setConfig(l,f){const y=this.getFragmentStyle(l);y&&(y.updateConfig(f,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(l){const f=this.getFragmentStyle(l);return f?f.stylesheet.schema:null}setSchema(l,f){const y=this.getFragmentStyle(l);y&&(y.stylesheet.schema=f,y.updateConfig(y._config,f),this.updateConfigDependencies())}updateConfig(l,f){if(this._config=l,l||f)if(f)for(const y in f){let b,T;const S=a.z(f[y].default);if(S.result==="success"&&(b=S.value.expression),l&&l[y]!==void 0){const W=a.z(l[y]);W.result==="success"&&(T=W.value.expression)}const{minValue:A,maxValue:O,stepValue:z,type:B,values:V}=f[y];if(b){const W=a.am(y,this.scope);this.options.set(W,{default:b,value:T,minValue:A,maxValue:O,stepValue:z,type:B,values:V})}else this.fire(new a.f(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new a.f(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(l){for(const f of this._configDependentLayers){const y=this.getLayer(f);if(y){if(l&&!y.configDependencies.has(l))continue;y.possiblyEvaluateVisibility(),this._updateLayer(y)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(f=>{if(f._styleColorTheme.colorTheme){const y=f._evaluateColorThemeData(f._styleColorTheme.colorTheme);(!f._styleColorTheme.lut&&y!==""||f._styleColorTheme.lut&&y!==f._styleColorTheme.lut.data)&&f.setColorTheme(f._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(l,f,y={}){this._checkLoaded();const b=l.id;if(this._layers[b])return void this.fire(new a.f(new Error(`Layer with id "${b}" already exists on this map`)));let T;if(l.type==="custom"){if(la(this,a.c_(l)))return;T=a.c$(l,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof l.source=="object"&&(this.addSource(b,l.source),l=a.cW(l),l=a.Q(l,{source:b})),this._validate(it,`layers.${b}`,l,{arrayIndex:-1},y))return;T=a.c$(l,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[T.id]=T.serialize()}T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid);let S=this._order.length;if(f){const B=this._order.indexOf(f);if(B===-1)return void this.fire(new a.f(new Error(`Layer with id "${f}" does not exist on this map.`)));T.slot===this._layers[f].slot?S=B:a.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,b),this._layerOrderChanged=!0,this._layers[b]=T;const A=this.getOwnLayerSourceCache(T),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&T.canCastShadows()&&O&&(A.castsShadows=!0);const z=this._changes.getRemovedLayer(T);if(z&&T.source&&A&&T.type!=="custom"){this._changes.discardLayerRemoval(T);const B=a.am(T.source,T.scope);z.type!==T.type?this._changes.updateSourceCache(B,"clear"):(this._changes.updateSourceCache(B,"reload"),A.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),T.scope=this.scope,this.mergeLayers()}moveLayer(l,f){this._checkLoaded();const y=this._checkLayer(l);if(!y||l===f)return;const b=this._order.indexOf(l);this._order.splice(b,1);let T=this._order.length;if(f){const S=this._order.indexOf(f);if(S===-1)return void this.fire(new a.f(new Error(`Layer with id "${f}" does not exist on this map.`)));y.slot===this._layers[f].slot?T=S:a.w(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(T,0,l),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(l){this._checkLoaded();const f=this._checkLayer(l);if(!f)return;f.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),delete this._layers[l],delete this._serializedLayers[l],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(f.fqid),this._changes.removeLayer(f);const b=this.getOwnLayerSourceCache(f);if(b&&b.castsShadows){let T=!1;for(const S in this._layers)if(this._layers[S].source===f.source&&this._layers[S].canCastShadows()){T=!0;break}b.castsShadows=T}f.onRemove&&f.onRemove(this.map),this.mergeLayers()}getOwnLayer(l){return this._layers[l]}hasLayer(l){return l in this._mergedLayers}hasLayerType(l){for(const f in this._layers)if(this._layers[f].type===l)return!0;return!1}setLayerZoomRange(l,f,y){this._checkLoaded();const b=this._checkLayer(l);b&&(b.minzoom===f&&b.maxzoom===y||(f!=null&&(b.minzoom=f),y!=null&&(b.maxzoom=y),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(l,f){this._checkLoaded();const y=this._checkLayer(l);y&&y.slot!==f&&(y.slot=f,this._updateLayer(y))}setFilter(l,f,y={}){this._checkLoaded();const b=this._checkLayer(l);if(b&&!a.d(b.filter,f))return f==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(qe,`layers.${b.id}.filter`,f,{layerType:b.type},y)||(b.filter=a.cW(f),this._updateLayer(b)))}getFilter(l){const f=this._checkLayer(l);if(f)return a.cW(f.filter)}setLayoutProperty(l,f,y,b={}){this._checkLoaded();const T=this._checkLayer(l);if(T&&!a.d(T.getLayoutProperty(f),y)){if(y!=null&&(!b||b.validate!==!1)&&la(T,St.call(ne,{key:`layers.${l}.layout.${f}`,layerType:T.type,objectKey:f,value:y,styleSpec:a.N,style:{glyphs:!0,sprite:!0}})))return;T.setLayoutProperty(f,y),T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),this._updateLayer(T)}}getLayoutProperty(l,f){const y=this._checkLayer(l);if(y)return y.getLayoutProperty(f)}setPaintProperty(l,f,y,b={}){this._checkLoaded();const T=this._checkLayer(l);if(!T||a.d(T.getPaintProperty(f),y)||y!=null&&(!b||b.validate!==!1)&&la(T,nt.call(ne,{key:`layers.${l}.paint.${f}`,layerType:T.type,objectKey:f,value:y,styleSpec:a.N})))return;const S=T.setPaintProperty(f,y);T.configDependencies.size!==0&&this._configDependentLayers.add(T.fqid),S&&this._updateLayer(T),this._changes.updatePaintProperties(T)}getPaintProperty(l,f){const y=this._checkLayer(l);if(y)return y.getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const y=l.source,b=l.sourceLayer,T=this._checkSource(y);if(!T)return;const S=T.type;if(S==="geojson"&&b)return void this.fire(new a.f(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!b)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(y);for(const O of A)O.setFeatureState(b,l.id,f)}removeFeatureState(l,f){this._checkLoaded();const y=l.source,b=this._checkSource(y);if(!b)return;const T=b.type,S=T==="vector"?l.sourceLayer:void 0;if(T==="vector"&&!S)return void this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof l.id!="string"&&typeof l.id!="number")return void this.fire(new a.f(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(y);for(const O of A)O.removeFeatureState(S,l.id,f)}getFeatureState(l){this._checkLoaded();const f=l.source,y=l.sourceLayer,b=this._checkSource(f);if(b){if(b.type!=="vector"||y)return l.id===void 0&&this.fire(new a.f(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(y,l.id);this.fire(new a.f(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(l){return this.stylesheet.transition=a.Q({},this.stylesheet.transition,l),this.transition=this.stylesheet.transition,this}getTransition(){return a.Q({},this.stylesheet.transition)}serialize(){this._checkLoaded();const l=this.getTerrain(),f=l&&this.terrain&&this.terrain.scope===this.scope?l:this.stylesheet.terrain;return a.d0({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:f,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateLayer(l){this._changes.updateLayer(l);const f=this.getLayerSourceCache(l),y=a.am(l.source,l.scope),b=this._changes.getUpdatedSourceCaches();l.source&&!b[y]&&f&&f.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),f.pause()),l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const f=A=>this._mergedLayers[A].type==="fill-extrusion"||this._mergedLayers[A].type==="model",y=this.order,b={},T=[];for(let A=y.length-1;A>=0;A--){const O=y[A];if(f(O)){b[O]=A;for(const z of l){const B=z[O];if(B)for(const V of B)T.push(V)}}}T.sort((A,O)=>O.intersectionZ-A.intersectionZ);const S=[];for(let A=y.length-1;A>=0;A--){const O=y[A];if(f(O))for(let z=T.length-1;z>=0;z--){const B=T[z].feature;if(B.layer&&b[B.layer.id]<A)break;S.push(B),T.pop()}else for(const z of l){const B=z[O];if(B)for(const V of B)S.push(V.feature)}}return S}queryRenderedFeatures(l,f,y){f&&f.filter&&this._validate(qe,"queryRenderedFeatures.filter",f.filter,null,f),f.scope=this.scope,f.availableImages=this._availableImages,f.serializedLayers=this._serializedLayers;const b={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new a.f(new Error("parameters.layers must be an Array."))),[];for(const z of f.layers){const B=this._mergedLayers[z];if(!B)return this.fire(new a.f(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const T=[],S=f.serializedLayers||{},A=f&&f.layers?f.layers.some(z=>{const B=this.getLayer(z);return B&&B.is3D()}):this.has3DLayers(),O=oa.createFromScreenPoints(l,y);for(const z in this._mergedSourceCaches){const B=this._mergedSourceCaches[z].getSource();if(!B||B.scope!==f.scope)continue;const V=this._mergedSourceCaches[z].getSource().id;f.layers&&!b[V]||T.push(fc(this._mergedSourceCaches[z],this._mergedLayers,S,O,f,y,A,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(z,B,V,W,X,se,oe){const ae={},ce=se.queryRenderedSymbols(W),be=[];for(const we of Object.keys(ce).map(Number))be.push(oe[we]);be.sort(E0);for(const we of be){const ye=we.featureIndex.lookupSymbolFeatures(ce[we.bucketInstanceId],B,we.bucketIndex,we.sourceLayerIndex,X.filter,X.layers,X.availableImages,z);for(const Me in ye){const Ie=ae[Me]=ae[Me]||[],Ce=ye[Me];Ce.sort((Ne,Fe)=>{const We=we.featureSortOrder;if(We){const Be=We.indexOf(Ne.featureIndex);return We.indexOf(Fe.featureIndex)-Be}return Fe.featureIndex-Ne.featureIndex});for(const Ne of Ce)Ie.push(Ne)}}for(const we in ae)ae[we].forEach(ye=>{const Me=ye.feature,Ie=V(z[we]);if(!Ie)return;const Ce=Ie.getFeatureState(Me.layer["source-layer"],Me.id);Me.source=Me.layer.source,Me.layer["source-layer"]&&(Me.sourceLayer=Me.layer["source-layer"]),Me.state=Ce});return ae}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),O.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(l,f){f&&f.filter&&this._validate(qe,"querySourceFeatures.filter",f.filter,null,f);const y=this.getOwnSourceCaches(l);let b=[];for(const T of y)b=b.concat(bA(T,f));return b}addSourceType(l,f,y){return ca.getSourceType(l)?y(new Error(`A source type called "${l}" already exists.`)):(ca.setSourceType(l,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:f.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(l,f,y={}){this._checkLoaded();const b=this.light.getLight();let T=!1;for(const A in l)if(!a.d(l[A],b[A])){T=!0;break}if(!T)return;const S=this._getTransitionParameters();this.light.setLight(l,f,y),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(l,f=1){if(this._checkLoaded(),!l)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),f===0&&delete this.terrain,l===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=l;const b=l.source==null;if(f===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const A="terrain-dem-src";this.addSource(A,y.source),y=a.cW(y),y=a.Q(y,{source:A})}const T=a.Q({},y),S={};if(this.terrain&&b){T.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(S.style=A.serialize())}if(this._validate(De,"terrain",T,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&f!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,f),this.fire(new a.g("data",{dataType:"style"}))}else{const T=this.terrain,S=T.get();for(const A of Object.keys(a.N.terrain))!y.hasOwnProperty(A)&&a.N.terrain[A].default&&(y[A]=a.N.terrain[A].default);for(const A in l)if(!a.d(l[A],S[A])){T.set(l,this.options),this.stylesheet.terrain=l;const O=this._getTransitionParameters({duration:0});T.updateTransitions(O),this.fire(new a.g("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const f=this.fog=new qs(l,this.map.transform,this.scope,this.options);this.stylesheet.fog=f.get();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog;if(!a.d(f.get(),l)){f.set(l,this.options),this.stylesheet.fog=f.get();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}}else this._createFog(l);this._markersNeedUpdate=!0}setColorTheme(l){this._checkLoaded();const f=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()};if(this._styleColorTheme.colorTheme=l,!l)return this._styleColorTheme.lut=null,void f();const y=this._evaluateColorThemeData(l);this._loadColorTheme(y).then(()=>{this.fire(new a.g("colorthemeset")),f()}).catch(b=>{a.w(`Couldn't set color theme: ${b}`)})}_getTransitionParameters(l){return{now:a.e.now(),transition:a.Q(this.transition,l)}}updateDrapeFirstLayers(){if(!this.terrain)return;const l=[],f=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?l.push(y):f.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...f)}_createTerrain(l,f){const y=this.terrain=new cr(l,f,this.scope,this.options);f===1&&(this.stylesheet.terrain=l),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});y.updateTransitions(b)}_force3DLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const f=this._layers[l];f.type==="symbol"&&this._updateLayer(f)}}_validate(l,f,y,b,T={}){if(T&&T.validate===!1)return!1;const S=a.Q({},this.serialize());return la(this,l.call(ne,a.Q({key:f,style:S,value:y,styleSpec:a.N},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.d1.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._mergedLayers)this._mergedLayers[l].setEventedParent(null);for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles(),this._mergedSourceCaches[l].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(l){const f=this.getSourceCaches(l);for(const y of f)y.clearTiles()}clearSources(){for(const l in this._mergedSourceCaches)this._mergedSourceCaches[l].clearTiles()}reloadSource(l){const f=this.getSourceCaches(l);for(const y of f)y.resume(),y.reload()}reloadSources(){for(const l of this.getSources())l.reload&&l.reload()}updateSources(l){let f;this.directionalLight&&(f=Fo(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(l,void 0,void 0,f)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const f=this._sourceCaches[l];f.resume(),f.reload()}}_updatePlacement(l,f,y,b,T,S,A=!1){let O=!1,z=!1;const B={},V={};for(const W of this._mergedOrder){const X=this._mergedLayers[W];if(X.type!=="symbol")continue;const se=a.am(X.source,X.scope);let oe=B[se];if(!oe){const ce=this.getLayerSourceCache(X);if(!ce)continue;const be=ce.getRenderableIds(!0).map(we=>ce.getTileByID(we));V[se]=be.slice(),oe=B[se]=be.sort((we,ye)=>ye.tileID.overscaledZ-we.tileID.overscaledZ||(we.tileID.isLessThan(ye.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(X,oe,f.center.lng,f.projection);O=O||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||b===0,this._layerOrderChanged&&this.fire(new a.g("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.e.now(),f.zoom))&&(this.pauseablePlacement=new Wb(f,this._mergedOrder,A,y,b,T,this.placement,this.fog&&f.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,B,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.e.now()),z=!0),O&&this.pauseablePlacement.placement.setStale()),z||O){this._buildingIndex.onNewFrame(f.zoom);for(let W=0;W<this._mergedOrder.length;W++){const X=this._mergedLayers[this._mergedOrder[W]];if(X.type!=="symbol")continue;const se=this.isLayerClipped(X)&&this._clipLayerIndices.some(oe=>W<oe);this.placement.updateLayerOpacities(X,B[a.am(X.source,X.scope)],W,se?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.e.now())}}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}addImport(l,f){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:T})=>T===l.id)!==-1)return void this.fire(new a.f(new Error(`Import with id '${l.id}' already exists in the map's style.`)));if(!f)return y.push(l),this._loadImports([l],!0);const b=y.findIndex(({id:T})=>T===f);return b===-1&&this.fire(new a.f(new Error(`Import with id "${f}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,b).concat(l).concat(y.slice(b)),this._loadImports([l],!0,f)}updateImport(l,f){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);return b===-1?this:typeof f=="string"?(this.setImportUrl(l,f),this):(f.url&&f.url!==y[b].url&&this.setImportUrl(l,f.url),a.d(f.config,y[b].config)||this.setImportConfig(l,f.config),a.d(f.data,y[b].data)||this.setImportData(l,f.data),this)}moveImport(l,f){this._checkLoaded();let y=this.stylesheet.imports||[];const b=this.getImportIndex(l);if(b===-1)return this;const T=this.getImportIndex(f);if(T===-1)return this;const S=y[b],A=this.fragments[b];return y=y.filter(({id:O})=>O!==l),this.fragments=this.fragments.filter(({id:O})=>O!==l),this.stylesheet.imports=y.slice(0,T).concat(S).concat(y.slice(T)),this.fragments=this.fragments.slice(0,T).concat(A).concat(this.fragments.slice(T)),this.mergeLayers(),this}setImportUrl(l,f){this._checkLoaded();const y=this.stylesheet.imports||[],b=this.getImportIndex(l);if(b===-1)return this;y[b].url=f;const T=this.fragments[b];return T.style=this._createFragmentStyle(y[b]),T.style.on("style.import.load",()=>this.mergeAll()),T.style.loadURL(f),this}setImportData(l,f){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];return y===-1?this:f?(this.fragments[y].style.setState(f),this._reloadImports(),this):(delete b[y].data,this.setImportUrl(l,b[y].url))}setImportConfig(l,f){this._checkLoaded();const y=this.getImportIndex(l),b=this.stylesheet.imports||[];if(y===-1)return this;f?b[y].config=f:delete b[y].config;const T=this.fragments[y],S=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=f,T.style.updateConfig(f,S),this.updateConfigDependencies(),this}removeImport(l){this._checkLoaded();const f=this.stylesheet.imports||[],y=this.getImportIndex(l);y!==-1&&(f.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(l){const f=(this.stylesheet.imports||[]).findIndex(y=>y.id===l);return f===-1&&this.fire(new a.f(new Error(`Import '${l}' does not exist in the map's style and cannot be updated.`))),f}getLayer(l){return this._mergedLayers[l]}getSources(){const l=[];for(const f in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[f];y&&l.push(y.getSource())}return l}getSource(l,f){const y=this.getSourceCache(l,f);return y&&y.getSource()}getLayerSource(l){const f=this.getLayerSourceCache(l);return f&&f.getSource()}getSourceCache(l,f){const y=a.am(l,f);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(l){const f=a.am(l.source,l.scope);return l.type==="symbol"?this._mergedSymbolSourceCaches[f]:this._mergedOtherSourceCaches[f]}getSourceCaches(l){if(l==null)return Object.values(this._mergedSourceCaches);const f=[];return this._mergedOtherSourceCaches[l]&&f.push(this._mergedOtherSourceCaches[l]),this._mergedSymbolSourceCaches[l]&&f.push(this._mergedSymbolSourceCaches[l]),f}updateSourceCaches(){const l=this._changes.getUpdatedSourceCaches();for(const f in l){const y=l[f];y==="reload"?this.reloadSource(f):y==="clear"&&this.clearSource(f)}}updateLayers(l){const f=this._changes.getUpdatedPaintProperties();for(const y of f){const b=this.getLayer(y);b&&b.updateTransitions(l)}}getImages(l,f,y){this.imageManager.getImages(f.icons,f.scope,y),this._updateTilesForChangedImages();const b=T=>{T&&T.setDependencies(f.tileID.key,f.type,f.icons)};b(this._otherSourceCaches[f.source]),b(this._symbolSourceCaches[f.source])}getGlyphs(l,f,y){this.glyphManager.getGlyphs(f.stacks,f.scope,y)}getResource(l,f,y){return a.d2(f,y)}getOwnSourceCache(l){return this._otherSourceCaches[l]}getOwnLayerSourceCache(l){return l.type==="symbol"?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}getOwnSourceCaches(l){const f=[];return this._otherSourceCaches[l]&&f.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&f.push(this._symbolSourceCaches[l]),f}_isSourceCacheLoaded(l){const f=this.getOwnSourceCaches(l);return f.length===0?(this.fire(new a.f(new Error(`There is no source with ID '${l}'`))),!1):f.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(l,f){if(this._clipLayerIndices.length===0&&l.type!=="fill-extrusion")return!1;const y=l.type==="fill-extrusion"&&l.sourceLayer==="building";let b=0;if(l.is3D()){if(y||f&&f.type==="batched-model")return!0;l.type==="model"&&(b=a.cw.Model)}else l.type==="symbol"&&(b=a.cw.Symbol);for(const T of this._clipLayerIndices){const S=this._mergedLayers[this._mergedOrder[T]];if(!S)continue;const A=[];for(const O of S.layout.get("clip-layer-types"))A.push(O==="model"?a.cw.Model:O==="symbol"?a.cw.Symbol:a.cw.FillExtrusion);for(const O of A)if(b&O)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(l=>{l.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function Kb(g,l){let f=!1,y=null;const b=()=>{y=null,f&&(g(),y=setTimeout(b,l),f=!1)};return()=>(f=!0,y||b(),y)}ca.getSourceType=function(g){return J[g]},ca.setSourceType=function(g,l){J[g]=l},ca.registerForPluginStateChange=a.cO;class Qb{constructor(l){this._hashName=l&&encodeURIComponent(l),a.br(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Kb(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const f=R0(l);if(this._hashName){const y=this._hashName;let b=!1;const T=location.hash.slice(1).split("&").map(S=>{const A=S.split("=")[0];return A===y?(b=!0,`${A}=${f}`):S}).filter(S=>S);return b||T.push(`${y}=${f}`),`#${T.join("&")}`}return`#${f}`}_getCurrentHash(){const l=location.hash.replace("#","");if(this._hashName){let f;return l.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(f=y)}),(f&&f[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(y=>isNaN(y))){const y=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(f[3]||0):l.getBearing();return l.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:y,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function R0(g,l){const f=g.getCenter(),y=Math.round(100*g.getZoom())/100,b=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),S=Math.round(f.lng*T)/T,A=Math.round(f.lat*T)/T,O=g.getBearing(),z=g.getPitch();let B=l?`/${S}/${A}/${y}`:`${y}/${A}/${S}`;return(O||z)&&(B+="/"+Math.round(10*O)/10),z&&(B+=`/${Math.round(z)}`),B}const Id={linearity:.3,easing:a.d3(0,0,.3,1)},IA=a.Q({deceleration:2500,maxSpeed:1400},Id),CA=a.Q({deceleration:20,maxSpeed:1400},Id),AA=a.Q({deceleration:1e3,maxSpeed:360},Id),PA=a.Q({deceleration:1e3,maxSpeed:90},Id);class Yb{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.e.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=a.e.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)f.zoom+=T.zoomDelta||0,f.bearing+=T.bearingDelta||0,f.pitch+=T.pitchDelta||0,T.panDelta&&f.pan._add(T.panDelta),T.around&&(f.around=T.around),T.pinchAround&&(f.pinchAround=T.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(f.pan.mag()){const T=ch(f.pan.mag(),y,a.Q({},IA,l||{}));b.offset=f.pan.mult(T.amount/f.pan.mag()),b.center=this._map.transform.center,Rg(b,T)}if(f.zoom){const T=ch(f.zoom,y,CA);b.zoom=this._map.transform.zoom+T.amount,Rg(b,T)}if(f.bearing){const T=ch(f.bearing,y,AA);b.bearing=this._map.transform.bearing+a.au(T.amount,-179,179),Rg(b,T)}if(f.pitch){const T=ch(f.pitch,y,PA);b.pitch=this._map.transform.pitch+T.amount,Rg(b,T)}if(b.zoom||b.bearing){const T=f.pinchAround===void 0?f.around:f.pinchAround;b.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Rg(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function ch(g,l,f){const{maxSpeed:y,linearity:b,deceleration:T}=f,S=a.au(g*b/(l/1e3),-y,y),A=Math.abs(S)/(T*b);return{easing:f.easing,duration:1e3*A,amount:S*(A/2)}}class ua extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,y,b={}){const T=ve(f.getCanvasContainer(),y),S=f.unproject(T);super(l,a.Q({point:T,lngLat:S,originalEvent:y},b)),this._defaultPrevented=!1,this.target=f}}class bp extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,y){const b=l==="touchend"?y.changedTouches:y.touches,T=Ee(f.getCanvasContainer(),b),S=T.map(O=>f.unproject(O)),A=T.reduce((O,z,B,V)=>O.add(z.div(V.length)),new a.P(0,0));super(l,{points:T,point:A,lngLats:S,lngLat:f.unproject(A),originalEvent:y}),this._defaultPrevented=!1}}class M0 extends a.g{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f){super("wheel",{originalEvent:f}),this._defaultPrevented=!1}}class Mg{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new M0(this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new ua(l.type,this._map,l))}mouseup(l){this._map.fire(new ua(l.type,this._map,l))}preclick(l){const f=a.Q({},l);f.type="preclick",this._map.fire(new ua(f.type,this._map,f))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(l),this._map.fire(new ua(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new ua(l.type,this._map,l))}mouseover(l){this._map.fire(new ua(l.type,this._map,l))}mouseout(l){this._map.fire(new ua(l.type,this._map,l))}touchstart(l){return this._firePreventable(new bp(l.type,this._map,l))}touchmove(l){this._map.fire(new bp(l.type,this._map,l))}touchend(l){this._map.fire(new bp(l.type,this._map,l))}touchcancel(l){this._map.fire(new bp(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class k0{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new ua(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ua("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ua(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uh{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(U(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const y=f,b=this._startPos,T=this._lastPos;if(!b||!T||T.equals(y)||!this._box&&y.dist(b)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=L("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const S=Math.min(b.x,y.x),A=Math.max(b.x,y.x),O=Math.min(b.y,y.y),z=Math.max(b.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${O}px)`,this._box.style.width=A-S+"px",this._box.style.height=z-O+"px")})}mouseupWindow(l,f){if(!this._active)return;const y=this._startPos,b=f;if(y&&l.button===0){if(this.reset(),de(),y.x!==b.x||y.y!==b.y)return this._map.fire(new a.g("boxzoomend",{originalEvent:l})),{cameraAnimation:T=>T.fitScreenCoordinates(y,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),H(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new a.g(l,{originalEvent:f}))}}function wp(g,l){const f={};for(let y=0;y<g.length;y++)f[g[y].identifier]=l[y];return f}class Jb{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,f,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(b){const T=new a.P(0,0);for(const S of b)T._add(S);return T.div(b.length)}(f),this.touches=wp(y,f)))}touchmove(l,f,y){if(this.aborted||!this.centroid)return;const b=wp(y,f);for(const T in this.touches){const S=b[T];(!S||S.dist(this.touches[T])>30)&&(this.aborted=!0)}}touchend(l,f,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class lu{constructor(l){this.singleTap=new Jb(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,f,y){this.singleTap.touchstart(l,f,y)}touchmove(l,f,y){this.singleTap.touchmove(l,f,y)}touchend(l,f,y){const b=this.singleTap.touchend(l,f,y);if(b){const T=l.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(b)<30;if(T&&S||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Tp{constructor(){this._zoomIn=new lu({numTouches:1,numTaps:2}),this._zoomOut=new lu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,y){this._zoomIn.touchstart(l,f,y),this._zoomOut.touchstart(l,f,y)}touchmove(l,f,y){this._zoomIn.touchmove(l,f,y),this._zoomOut.touchmove(l,f,y)}touchend(l,f,y){const b=this._zoomIn.touchend(l,f,y),T=this._zoomOut.touchend(l,f,y);return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(b)},{originalEvent:l})}):T?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(T)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const kg={0:1,2:2};class Ep{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,f){return!1}_move(l,f){return{}}mousedown(l,f){if(this._lastPoint)return;const y=ie(l);this._correctButton(l,y)&&(this._lastPoint=f,this._eventButton=y)}mousemoveWindow(l,f){const y=this._lastPoint;if(y){if(l.preventDefault(),this._eventButton!=null&&function(b,T){const S=kg[T];return b.buttons===void 0||(b.buttons&S)!==S}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(y,f)}}mouseupWindow(l){this._lastPoint&&ie(l)===this._eventButton&&(this._moved&&de(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sp extends Ep{mousedown(l,f){super.mousedown(l,f),this._lastPoint&&(this._active=!0)}_correctButton(l,f){return f===0&&!l.ctrlKey}_move(l,f){return{around:f,panDelta:f.sub(l)}}}class Ip extends Ep{_correctButton(l,f){return f===0&&l.ctrlKey||f===2}_move(l,f){const y=.8*(f.x-l.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(l){l.preventDefault()}}class Og extends Ep{_correctButton(l,f){return f===0&&l.ctrlKey||f===2}_move(l,f){const y=-.5*(f.y-l.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(l){l.preventDefault()}}class ew{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),a.br(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(l,f,y){return this._calculateTransform(l,f,y)}touchmove(l,f,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!a.d4())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,f,y)}}touchend(l,f,y){this._calculateTransform(l,f,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,y){y.length>0&&(this._active=!0);const b=wp(y,f),T=new a.P(0,0),S=new a.P(0,0);let A=0;for(const z in b){const B=b[z],V=this._touches[z];V&&(T._add(B),S._add(B.sub(V)),A++,b[z]=B)}if(this._touches=b,A<this._minTouches||!S.mag())return;const O=S.div(A);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(A),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Cp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,f,y){return{}}touchstart(l,f,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,y){const b=this._firstTwoTouches;if(!b)return;l.preventDefault();const[T,S]=b,A=hh(y,f,T),O=hh(y,f,S);if(!A||!O)return;const z=this._aroundCenter?null:A.add(O).div(2);return this._move([A,O],z,l)}touchend(l,f,y){if(!this._firstTwoTouches)return;const[b,T]=this._firstTwoTouches,S=hh(y,f,b),A=hh(y,f,T);S&&A||(this._active&&de(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function hh(g,l,f){for(let y=0;y<g.length;y++)if(g[y].identifier===f)return l[y]}function Cd(g,l){return Math.log(g/l)/Math.LN2}class tw extends Cp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Cd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cd(this._distance,y),pinchAround:f}}}function O0(g,l){return 180*g.angleWith(l)/Math.PI}class nw extends Cp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f){const y=this._vector;if(this._vector=l[0].sub(l[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:O0(this._vector,y),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const b=O0(l,y);return Math.abs(b)<f}}function cu(g){return Math.abs(g.y)>Math.abs(g.x)}class rw extends Cp{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,cu(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,y){const b=this._lastPoints;if(!b)return;const T=l[0].sub(b[0]),S=l[1].sub(b[1]);return this._map._cooperativeGestures&&!a.d4()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(T,S,y.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(T.y+S.y)/2*-.5})}gestureBeginsVertically(l,f,y){if(this._valid!==void 0)return this._valid;const b=l.mag()>=2,T=f.mag()>=2;if(!b&&!T)return;if(!b||!T)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const S=l.y>0==f.y>0;return cu(l)&&cu(f)&&S}}const RA={panStep:100,bearingStep:15,pitchStep:10};class MA{constructor(){const l=RA;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,y=0,b=0,T=0,S=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),T=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),T=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),S=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(y=0,b=0),{cameraAnimation:A=>{const O=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:kA,zoom:f?Math.round(O)+f*(l.shiftKey?2:1):O,bearing:A.getBearing()+y*this._bearingStep,pitch:A.getPitch()+b*this._pitchStep,offset:[-T*this._panStep,-S*this._panStep],center:A.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kA(g){return g*(2-g)}const Dg=4.000244140625,D0=1/450;class L0{constructor(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=D0,a.br(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||a.d4()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=a.e.now(),b=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,f!==0&&f%Dg==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=f,this._timeout=window.setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=ve(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;this._type==="wheel"&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Dg?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&B!==0&&(B=1/B);const V=f(),W=Math.pow(2,V),X=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(X*B))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:f(),b=this._startZoom,T=this._easing;let S,A=!1;if(this._type==="wheel"&&b&&T){const z=Math.min((a.e.now()-this._lastWheelEventTime)/200,1),B=T(z);S=a.a3(b,y,B),z<1?this._frameId||(this._frameId=!0):A=!0}else S=y,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=S-f();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=a.d5;if(this._prevEase){const y=this._prevEase,b=(a.e.now()-y.start)/y.duration,T=y.easing(b+.01)-y.easing(b),S=.27/Math.sqrt(T*T+1e-4)*.01,A=Math.sqrt(.0729-S*S);f=a.d3(S,A,.25,1)}return this._prevEase={start:a.e.now(),duration:l,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=L("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class z0{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class iw{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,f){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(l.shiftKey?-1:1),around:y.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sw{constructor(){this._tap=new lu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,f,y){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=f[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(l,f,y))}touchmove(l,f,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const b=f[0],T=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(l,f,y)}touchend(l,f,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(l,f,y)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class OA{constructor(l,f,y){this._el=l,this._mousePan=f,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ap{constructor(l,f,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Pp{constructor(l,f,y,b){this._el=l,this._touchZoom=f,this._touchRotate=y,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Rp=g=>g.zoom||g.drag||g.pitch||g.rotate;class ha extends a.g{}class N0{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,f){const y=a.$.sub([],f,l);this.radius=a.$.length(y[2]<0?a.$.div([],y,this.constants):[y[0],y[1],0])}projectRay(l){a.$.div(l,l,this.constants),a.$.normalize(l,l),a.$.mul(l,l,this.constants);const f=a.$.scale([],l,this.radius);if(f[2]>0){const y=a.$.scale([],[0,0,1],a.$.dot(f,[0,0,1])),b=a.$.scale([],a.$.normalize([],[f[0],f[1],0]),this.radius),T=a.$.add([],f,a.$.scale([],a.$.sub([],a.$.add([],b,y),f),2));f[0]=T[0],f[1]=T[1]}return f}}function dh(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Lg{constructor(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yb(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new N0,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),a.br(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,T,S]of this._listeners){const A=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(T,A,S)}}destroy(){for(const[l,f,y]of this._listeners){const b=l===document?this.handleWindowEvent:this.handleEvent;l.removeEventListener(f,b,y)}}_addDefaultHandlers(l){const f=this._map,y=f.getCanvasContainer();this._add("mapEvent",new Mg(f,l));const b=f.boxZoom=new uh(f,l);this._add("boxZoom",b);const T=new Tp,S=new iw;f.doubleClickZoom=new z0(S,T),this._add("tapZoom",T),this._add("clickZoom",S);const A=new sw;this._add("tapDragZoom",A);const O=f.touchPitch=new rw(f);this._add("touchPitch",O);const z=new Ip(l),B=new Og(l);f.dragRotate=new Ap(l,z,B),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",B,["mouseRotate"]);const V=new Sp(l),W=new ew(f,l);f.dragPan=new OA(y,V,W),this._add("mousePan",V),this._add("touchPan",W,["touchZoom","touchRotate"]);const X=new nw,se=new tw;f.touchZoomRotate=new Pp(y,se,X,A),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",se,["touchPan","touchRotate"]),this._add("blockableMapEvent",new k0(f));const oe=f.scrollZoom=new L0(f,this);this._add("scrollZoom",oe,["mousePan"]);const ae=f.keyboard=new MA;this._add("keyboard",ae);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[ce]&&f[ce].enable(l[ce])}_add(l,f,y){this._handlers.push({handlerName:l,handler:f,allowed:y}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Rp(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,f,y){for(const b in l)if(b!==y&&(!f||f.indexOf(b)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const f=[];for(const y of l)this._el.contains(y.target)&&f.push(y);return f}handleEvent(l,f){this._updatingCamera=!0;const y=l.type==="renderFrame",b=y?void 0:l,T={needsRenderFrame:!1},S={},A={},O=l.touches?this._getMapTouches(l.touches):void 0,z=O?Ee(this._el,O):y?void 0:ve(this._el,l);for(const{handlerName:W,handler:X,allowed:se}of this._handlers){if(!X.isEnabled())continue;let oe;this._blockedByActive(A,se,W)?X.reset():X[f||l.type]&&(oe=X[f||l.type](l,z,O),this.mergeHandlerResult(T,S,oe,W,b),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||X.isActive())&&(A[W]=X)}const B={};for(const W in this._previousActiveHandlers)A[W]||(B[W]=b);this._previousActiveHandlers=A,(Object.keys(B).length||dh(T))&&(this._changes.push([T,S,B]),this._triggerRenderFrame()),(Object.keys(A).length||dh(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=T;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(l,f,y,b,T){if(!y)return;a.Q(l,y);const S={handlerName:b,originalEvent:y.originalEvent||T};y.zoomDelta!==void 0&&(f.zoom=S),y.panDelta!==void 0&&(f.drag=S),y.pitchDelta!==void 0&&(f.pitch=S),y.bearingDelta!==void 0&&(f.rotate=S)}_applyChanges(){const l={},f={},y={};for(const[b,T,S]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(l.around=b.around),b.aroundCoord!==void 0&&(l.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),a.Q(f,T),a.Q(y,S);this._updateMapTransform(l,f,y),this._changes=[]}_updateMapTransform(l,f,y){const b=this._map,T=b.transform,S=be=>[be.x,be.y,be.z];if((be=>{const we=this._eventsInProgress.drag;return we&&!this._handlersById[we.handlerName].isActive()})()&&!dh(l)){const be=T.zoom;T.cameraElevationReference="sea",this._originalZoom!=null&&T._orthographicProjectionAtLowPitch&&T.projection.name!=="globe"&&T.pitch===0?(T.cameraElevationReference="ground",T.zoom=this._originalZoom):(T.recenterOnTerrain(),T.cameraElevationReference="ground"),be!==T.zoom&&this._map._update(!0)}if(T._isCameraConstrained&&b._stop(!0),!dh(l))return void this._fireEvents(f,y,!0);let{panDelta:A,zoomDelta:O,bearingDelta:z,pitchDelta:B,around:V,aroundCoord:W,pinchAround:X}=l;T._isCameraConstrained&&(O>0&&(O=0),T._isCameraConstrained=!1),X!==void 0&&(V=X),(O||(be=>f[be]&&!this._eventsInProgress[be])("drag"))&&V&&(this._dragOrigin=S(T.pointCoordinate3D(V)),this._originalZoom=T.zoom,this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",b._stop(!0),V=V||b.transform.centerPoint,z&&(T.bearing+=z),B&&(T.pitch+=B),T._updateCameraState();const se=[0,0,0];if(A)if(T.projection.name==="mercator"){const be=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(V).dir),we=this._trackingEllipsoid.projectRay(T.screenPointToMercatorRay(V.sub(A)).dir);se[0]=we[0]-be[0],se[1]=we[1]-be[1]}else{const be=T.pointCoordinate(V);if(T.projection.name==="globe"){A=A.rotate(-T.angle);const we=T._pixelsPerMercatorPixel/T.worldSize;se[0]=-A.x*a.d6(a.az(be.y))*we,se[1]=-A.y*a.d6(T.center.lat)*we}else{const we=T.pointCoordinate(V.sub(A));be&&we&&(se[0]=we.x-be.x,se[1]=we.y-be.y)}}const oe=T.zoom,ae=[0,0,0];if(O){const be=S(W||T.pointCoordinate3D(V)),we={dir:a.$.normalize([],a.$.sub([],be,T._camera.position))};if(we.dir[2]<0){const ye=T.zoomDeltaToMovement(be,O);a.$.scale(ae,we.dir,ye)}}const ce=a.$.add(se,se,ae);T._translateCameraConstrained(ce),O&&Math.abs(T.zoom-oe)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,y,!0)}_fireEvents(l,f,y){const b=Rp(this._eventsInProgress),T=Rp(l),S={};for(const B in l){const{originalEvent:V}=l[B];this._eventsInProgress[B]||(S[`${B}start`]=V),this._eventsInProgress[B]=l[B]}!b&&T&&this._fireEvent("movestart",T.originalEvent);for(const B in S)this._fireEvent(B,S[B]);T&&this._fireEvent("move",T.originalEvent);for(const B in l){const{originalEvent:V}=l[B];this._fireEvent(B,V)}const A={};let O;for(const B in this._eventsInProgress){const{handlerName:V,originalEvent:W}=this._eventsInProgress[B];this._handlersById[V].isActive()||(delete this._eventsInProgress[B],O=f[V]||W,A[`${B}end`]=O)}for(const B in A)this._fireEvent(B,A[B]);const z=Rp(this._eventsInProgress);if(y&&(b||T)&&!z){this._updatingCamera=!0;const B=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;B?(V(B.bearing||this._map.getBearing())&&(B.bearing=0),this._map.easeTo(B,{originalEvent:O})):(this._map.fire(new a.g("moveend",{originalEvent:O})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new a.g(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new ha("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const zg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class F0 extends a.E{constructor(l,f){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,a.br(["_renderFrameCallback"],this)}getCenter(){return new a.aJ(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,y){return l=a.P.convert(l).mult(-1),this.panTo(this.transform.center,a.Q({offset:l},f),y)}panTo(l,f,y){return this.easeTo(a.Q({center:l},f),y)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,y){return this.easeTo(a.Q({zoom:l},f),y)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,y){return this.easeTo(a.Q({bearing:l},f),y)}resetNorth(l,f){return this.rotateTo(0,a.Q({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(a.Q({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=a.aj.convert(l);const y=f&&f.bearing||0,b=f&&f.pitch||0,T=l.getNorthWest(),S=l.getSouthEast();return this._cameraForBounds(this.transform,T,S,y,b,f)}_extendPadding(l){const f={top:0,right:0,bottom:0,left:0};return l==null?a.Q({},f,this.transform.padding):typeof l=="number"?{top:l,bottom:l,right:l,left:l}:a.Q({},f,l)}_extendCameraOptions(l){return(l=a.Q({offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding=this._extendPadding(l.padding),l}_minimumAABBFrustumDistance(l,f){const y=f.max[0]-f.min[0],b=f.max[1]-f.min[1];return y/b>l.aspect?y/(2*Math.tan(.5*l.fovX)*l.aspect):b/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,f,y,b,T,S){const A=l.clone(),O=this._extendCameraOptions(S);A.bearing=b,A.pitch=T;const z=a.aJ.convert(f),B=a.aJ.convert(y),V=.5*(z.lat+B.lat),W=.5*(z.lng+B.lng),X=a.d7(V,W),se=a.$.normalize([],X),oe=a.$.normalize([],a.$.cross([],se,[0,1,0])),ae=a.$.cross([],oe,se),ce=[oe[0],oe[1],oe[2],0,ae[0],ae[1],ae[2],0,se[0],se[1],se[2],0,0,0,0,1],be=[X,a.d7(z.lat,z.lng),a.d7(B.lat,z.lng),a.d7(B.lat,B.lng),a.d7(z.lat,B.lng),a.d7(V,z.lng),a.d7(V,B.lng),a.d7(z.lat,W),a.d7(B.lat,W)];let we=a.b8.fromPoints(be.map(je=>[a.$.dot(oe,je),a.$.dot(ae,je),a.$.dot(se,je)]));const ye=a.$.transformMat4([],we.center,ce);a.$.squaredLength(ye)===0&&a.$.set(ye,0,0,1),a.$.normalize(ye,ye),a.$.scale(ye,ye,a.cF),A.center=a.d8(ye);const Me=A.getWorldToCameraMatrix(),Ie=a.ae.invert(new Float64Array(16),Me);we=a.b8.applyTransform(we,a.ae.multiply([],Me,ce));const Ce=this._extendAABB(we,A,O,b);if(!Ce)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");we=Ce,a.$.transformMat4(ye,ye,Me);const Ne=.5*(we.max[2]-we.min[2]),Fe=this._minimumAABBFrustumDistance(A,we),We=a.$.scale([],[0,0,1],Ne),Be=a.$.add(We,ye,We),Re=Fe+(A.pitch===0?0:a.$.distance(ye,Be)),et=A.globeCenterInViewSpace,Ye=a.$.sub([],ye,[et[0],et[1],et[2]]);a.$.normalize(Ye,Ye),a.$.scale(Ye,Ye,Re);const Ve=a.$.add([],ye,Ye);a.$.transformMat4(Ve,Ve,Ie);const Ct=a.da/a.cF,_t=a.$.length(Ve),Ze=a.ay(Math.max(_t*Ct-a.da,Number.EPSILON),0),ot=Math.min(A.zoomFromMercatorZAdjusted(Ze),O.maxZoom);return ot>.5*(a.b3+a.aV)?(A.setProjection({name:"mercator"}),A.zoom=ot,this._cameraForBounds(A,f,y,b,T,S)):{center:A.center,zoom:ot,bearing:b,pitch:T}}_extendAABB(l,f,y,b){const T=.5*((y.padding.left||0)+(y.padding.right||0)),S=.5*((y.padding.top||0)+(y.padding.bottom||0)),A=S,O=T,z=T,B=S,V=f.width-(O+z),W=f.height-(A+B),X=a.$.sub([],l.max,l.min),se=Math.min(V/X[0],W/X[1]),oe=Math.min(f.scaleZoom(f.scale*se),y.maxZoom);if(isNaN(oe))return null;const ae=f.scale/f.zoomScale(oe),ce=new a.b8([l.min[0]-O*ae,l.min[1]-B*ae,l.min[2]],[l.max[0]+z*ae,l.max[1]+A*ae,l.max[2]]),be=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new a.P(y.offset.x,y.offset.y):a.P.convert(y.offset)).rotate(-a.ac(b));return ce.center[0]-=be.x*ae,ce.center[1]+=be.y*ae,ce}queryTerrainElevation(l,f){const y=this.transform.elevation;return y?(f=a.Q({},{exaggerated:!0},f),y.getAtPoint(a._.fromLngLat(l),null,f.exaggerated)):null}_cameraForBounds(l,f,y,b,T,S){if(l.projection.name==="globe")return this._cameraForBoundsOnGlobe(l,f,y,b,T,S);const A=l.clone(),O=this._extendCameraOptions(S);A.bearing=b,A.pitch=T;const z=a.aJ.convert(f),B=a.aJ.convert(y),V=new a.aJ(z.lng,B.lat),W=new a.aJ(B.lng,z.lat),X=A.project(z),se=A.project(B),oe=this.queryTerrainElevation(z),ae=this.queryTerrainElevation(B),ce=this.queryTerrainElevation(V),be=this.queryTerrainElevation(W),we=[[X.x,X.y,Math.min(oe||0,ae||0,ce||0,be||0)],[se.x,se.y,Math.max(oe||0,ae||0,ce||0,be||0)]];let ye=a.b8.fromPoints(we);const Me=A.getWorldToCameraMatrix(),Ie=a.ae.invert(new Float64Array(16),Me);ye=a.b8.applyTransform(ye,Me);const Ce=this._extendAABB(ye,A,O,b);if(!Ce)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Ce;const Ne=.5*a.$.sub([],ye.max,ye.min)[2],Fe=this._minimumAABBFrustumDistance(A,ye),We=[0,0,1,0];a.aB.transformMat4(We,We,Me),a.aB.normalize(We,We);const Be=a.$.scale([],We,Fe+Ne),Re=a.$.add([],ye.center,Be);a.$.transformMat4(ye.center,ye.center,Ie),a.$.transformMat4(Re,Re,Ie);const et=[ye.center[0],ye.center[1],Re[2]*A.pixelsPerMeter];a.$.scale(et,et,1/A.worldSize);const Ye=a.d9(et[0]),Ve=a.az(et[1]),Ct=Math.min(A._zoomFromMercatorZ(et[2]),O.maxZoom),_t=new a.aJ(Ye,Ve);return A.mercatorFromTransition&&Ct<.5*(a.b3+a.aV)?(A.setProjection({name:"globe"}),A.zoom=Ct,this._cameraForBounds(A,f,y,b,T,S)):{center:_t,zoom:Ct,bearing:b,pitch:T}}fitBounds(l,f,y){const b=this.cameraForBounds(l,f);return this._fitInternal(b,f,y)}fitScreenCoordinates(l,f,y,b,T){const S=a.P.convert(l),A=a.P.convert(f),O=new a.P(Math.min(S.x,A.x),Math.min(S.y,A.y)),z=new a.P(Math.max(S.x,A.x),Math.max(S.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,A))return this;const B=this.transform.pointLocation3D(O),V=this.transform.pointLocation3D(z),W=this.transform.pointLocation3D(new a.P(O.x,z.y)),X=this.transform.pointLocation3D(new a.P(z.x,O.y)),se=[Math.min(B.lng,V.lng,W.lng,X.lng),Math.min(B.lat,V.lat,W.lat,X.lat)],oe=[Math.max(B.lng,V.lng,W.lng,X.lng),Math.max(B.lat,V.lat,W.lat,X.lat)],ae=b&&b.pitch?b.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,se,oe,y,ae,b);return this._fitInternal(ce,b,T)}_fitInternal(l,f,y){return l?(f=a.Q(l,f)).linear?this.easeTo(f,y):this.flyTo(f,y):this}jumpTo(l,f){this.stop();const y=l.preloadOnly?this.transform.clone():this.transform;let b=!1,T=!1,S=!1;if("zoom"in l&&y.zoom!==+l.zoom&&(b=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=a.aJ.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(T=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(S=!0,y.pitch=+l.pitch),l.padding!=null){const A=typeof l.padding=="number"?this._extendPadding(l.padding):l.padding;y.isPaddingEqual(A)||(y.padding=A)}return l.preloadOnly?(this._preloadTiles(y),this):(this.fire(new a.g("movestart",f)).fire(new a.g("move",f)),b&&this.fire(new a.g("zoomstart",f)).fire(new a.g("zoom",f)).fire(new a.g("zoomend",f)),T&&this.fire(new a.g("rotatestart",f)).fire(new a.g("rotate",f)).fire(new a.g("rotateend",f)),S&&this.fire(new a.g("pitchstart",f)).fire(new a.g("pitch",f)).fire(new a.g("pitchend",f)),this.fire(new a.g("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w(zg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,f){const y=this.transform;if(!y.projection.supportsFreeCamera)return a.w(zg),this;this.stop();const b=y.zoom,T=y.pitch,S=y.bearing;y.setFreeCameraOptions(l);const A=b!==y.zoom,O=T!==y.pitch,z=S!==y.bearing;return this.fire(new a.g("movestart",f)).fire(new a.g("move",f)),A&&this.fire(new a.g("zoomstart",f)).fire(new a.g("zoom",f)).fire(new a.g("zoomend",f)),z&&this.fire(new a.g("rotatestart",f)).fire(new a.g("rotate",f)).fire(new a.g("rotateend",f)),O&&this.fire(new a.g("pitchstart",f)).fire(new a.g("pitch",f)).fire(new a.g("pitchend",f)),this.fire(new a.g("moveend",f)),this}easeTo(l,f){this._stop(!1,l.easeId),((l=a.Q({offset:[0,0],duration:500,easing:a.d5},l)).animate===!1||this._prefersReducedMotion(l))&&(l.duration=0);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),A=this.getPadding(),O="zoom"in l?+l.zoom:b,z="bearing"in l?this._normalizeBearing(l.bearing,T):T,B="pitch"in l?+l.pitch:S,V=this._extendPadding(l.padding),W=a.P.convert(l.offset);let X,se,oe;if(y.projection.name==="globe"){const Fe=a._.fromLngLat(y.center),We=W.rotate(-y.angle);Fe.x+=We.x/y.worldSize,Fe.y+=We.y/y.worldSize;const Be=Fe.toLngLat(),Re=a.aJ.convert(l.center||Be);this._normalizeCenter(Re),X=y.centerPoint.add(We),se=new a.P(Fe.x,Fe.y).mult(y.worldSize),oe=new a.P(a.ak(Re.lng),a.al(Re.lat)).mult(y.worldSize).sub(se)}else{X=y.centerPoint.add(W);const Fe=y.pointLocation(X),We=a.aJ.convert(l.center||Fe);this._normalizeCenter(We),se=y.project(Fe),oe=y.project(We).sub(se)}const ae=y.zoomScale(O-b);let ce,be;l.around&&(ce=a.aJ.convert(l.around),be=y.locationPoint(ce));const we=this._zooming||O!==b,ye=this._rotating||T!==z,Me=this._pitching||B!==S,Ie=!y.isPaddingEqual(V),Ce=Fe=>We=>{if(we&&(Fe.zoom=a.a3(b,O,We)),ye&&(Fe.bearing=a.a3(T,z,We)),Me&&(Fe.pitch=a.a3(S,B,We)),Ie&&(Fe.interpolatePadding(A,V,We),X=Fe.centerPoint.add(W)),ce)Fe.setLocationAtPoint(ce,be);else{const Be=Fe.zoomScale(Fe.zoom-b),Re=O>b?Math.min(2,ae):Math.max(.5,ae),et=Math.pow(Re,1-We),Ye=Fe.unproject(se.add(oe.mult(We*et)).mult(Be));Fe.setLocationAtPoint(Fe.renderWorldCopies?Ye.wrap():Ye,X)}return l.preloadOnly||this._fireMoveEvents(f),Fe};if(l.preloadOnly){const Fe=this._emulate(Ce,l.duration,y);return this._preloadTiles(Fe),this}const Ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=we,this._rotating=ye,this._pitching=Me,this._padding=Ie,this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,Ne),this._ease(Ce(y),Fe=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(f,Fe)},l),this}_prepareEase(l,f,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),f||y.moving||this.fire(new a.g("movestart",l)),this._zooming&&!y.zooming&&this.fire(new a.g("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new a.g("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new a.g("pitchstart",l))}_fireMoveEvents(l){this.fire(new a.g("move",l)),this._zooming&&this.fire(new a.g("zoom",l)),this._rotating&&this.fire(new a.g("rotate",l)),this._pitching&&this.fire(new a.g("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new a.g("zoomend",l)),b&&this.fire(new a.g("rotateend",l)),T&&this.fire(new a.g("pitchend",l)),this.fire(new a.g("moveend",l))}flyTo(l,f){if(this._prefersReducedMotion(l)){const ot=a.ai(l,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(ot,f)}this.stop(),l=a.Q({offset:[0,0],speed:1.2,curve:1.42,easing:a.d5},l);const y=this.transform,b=this.getZoom(),T=this.getBearing(),S=this.getPitch(),A=this.getPadding(),O="zoom"in l?a.au(+l.zoom,y.minZoom,y.maxZoom):b,z="bearing"in l?this._normalizeBearing(l.bearing,T):T,B="pitch"in l?+l.pitch:S,V=this._extendPadding(l.padding),W=y.zoomScale(O-b),X=a.P.convert(l.offset);let se=y.centerPoint.add(X);const oe=y.pointLocation(se),ae=a.aJ.convert(l.center||oe);this._normalizeCenter(ae);const ce=y.project(oe),be=y.project(ae).sub(ce);let we=l.curve;const ye=Math.max(y.width,y.height),Me=ye/W,Ie=be.mag();if("minZoom"in l){const ot=a.au(Math.min(l.minZoom,b,O),y.minZoom,y.maxZoom),je=ye/y.zoomScale(ot-b);we=Math.sqrt(je/Ie*2)}const Ce=we*we;function Ne(ot){const je=(Me*Me-ye*ye+(ot?-1:1)*Ce*Ce*Ie*Ie)/(2*(ot?Me:ye)*Ce*Ie);return Math.log(Math.sqrt(je*je+1)-je)}function Fe(ot){return(Math.exp(ot)-Math.exp(-ot))/2}function We(ot){return(Math.exp(ot)+Math.exp(-ot))/2}const Be=Ne(0);let Re=function(ot){return We(Be)/We(Be+we*ot)},et=function(ot){return ye*((We(Be)*(Fe(je=Be+we*ot)/We(je))-Fe(Be))/Ce)/Ie;var je},Ye=(Ne(1)-Be)/we;if(Math.abs(Ie)<1e-6||!isFinite(Ye)){if(Math.abs(ye-Me)<1e-6)return this.easeTo(l,f);const ot=Me<ye?-1:1;Ye=Math.abs(Math.log(Me/ye))/we,et=function(){return 0},Re=function(je){return Math.exp(ot*we*je)}}l.duration="duration"in l?+l.duration:1e3*Ye/("screenSpeed"in l?+l.screenSpeed/we:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Ve=T!==z,Ct=B!==S,_t=!y.isPaddingEqual(V),Ze=ot=>je=>{const yt=je*Ye,xt=1/Re(yt);ot.zoom=je===1?O:b+ot.scaleZoom(xt),Ve&&(ot.bearing=a.a3(T,z,je)),Ct&&(ot.pitch=a.a3(S,B,je)),_t&&(ot.interpolatePadding(A,V,je),se=ot.centerPoint.add(X));const $t=je===1?ae:ot.unproject(ce.add(be.mult(et(yt))).mult(xt));return ot.setLocationAtPoint(ot.renderWorldCopies?$t.wrap():$t,se),ot._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(f),ot};if(l.preloadOnly){const ot=this._emulate(Ze,l.duration,y);return this._preloadTiles(ot),this}return this._zooming=!0,this._rotating=Ve,this._pitching=Ct,this._padding=_t,this._prepareEase(f,!1),this._ease(Ze(y),()=>this._afterEase(f),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(l){}_cancelRenderFrame(l){}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,f)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,f,y){y.animate===!1||y.duration===0?(l(1),f()):(this._easeStart=a.e.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((a.e.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,f){l=a.av(l,-180,180);const y=Math.abs(l-f);return Math.abs(l-360-f)<y&&(l-=360),Math.abs(l+360-f)<y&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(f.maxBounds||f.projection.name!=="globe"&&!f.renderWorldCopies)return;const y=l.lng-f.center.lng;l.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&a.e.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,f,y){const b=Math.ceil(15*f/1e3),T=[],S=l(y.clone());for(let A=0;A<=b;A++){const O=S(A/b);T.push(O.clone())}return T}_preloadTiles(l,f){}}class Mp{constructor(l={}){this.options=l,a.br(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const f=this.options&&this.options.compact,y=l._getUIString("AttributionControl.ToggleAttribution");this._map=l,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=L("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const b=L("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",y),this._innerContainer=L("div","mapboxgl-ctrl-attrib-inner",this._container),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.db.ACCESS_TOKEN}];if(l){const y=f.reduce((b,T,S)=>(T.value&&(b+=`${T.key}=${T.value}${S<f.length-1?"&":""}`),b),"?");l.href=`${a.db.FEEDBACK_URL}/${y}#${R0(this._map,!0)}`,l.rel="noopener nofollow"}}_updateData(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const f=this._map.style._mergedSourceCaches;for(const b in f){const T=f[b];if(T.used){const S=T.getSource();S.attribution&&l.indexOf(S.attribution)<0&&l.push(S.attribution)}}l.sort((b,T)=>b.length-T.length),l=l.filter((b,T)=>{for(let S=T+1;S<l.length;S++)if(l[S].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ng{constructor(){a.br(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=L("div","mapboxgl-ctrl");const f=L("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(Object.entries(l).length===0)return!0;for(const f in l){const y=l[f].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class Fg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,y=f?this._queue.concat(f):this._queue;for(const b of y)if(b.id===l)return void(b.cancelled=!0)}run(l=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const y of f)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function kp(g,l,f){if(g=new a.aJ(g.lng,g.lat),l){const y=new a.aJ(g.lng-360,g.lat),b=new a.aJ(g.lng+360,g.lat),T=360*Math.ceil(Math.abs(g.lng-f.center.lng)/360),S=f.locationPoint(g).distSqr(l),A=l.x<0||l.y<0||l.x>f.width||l.y>f.height;f.locationPoint(y).distSqr(l)<S&&(A||Math.abs(y.lng-f.center.lng)<T)?g=y:f.locationPoint(b).distSqr(l)<S&&(A||Math.abs(b.lng-f.center.lng)<T)&&(g=b)}for(;Math.abs(g.lng-f.center.lng)>180;){const y=f.locationPoint(g);if(y.x>=0&&y.y>=0&&y.x<=f.width&&y.y<=f.height)break;g.lng>f.center.lng?g.lng-=360:g.lng+=360}return g}const Bg={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class jg extends a.E{constructor(l,f){if(super(),(l instanceof HTMLElement||f)&&(l=a.Q({element:l},f)),a.br(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=a.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=L("div");const T=41,S=27,A=G("svg",{display:"block",height:T*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${T}`},this._element),O=G("radialGradient",{id:"shadowGradient"},G("defs",{},A));G("stop",{offset:"10%","stop-opacity":.4},O),G("stop",{offset:"100%","stop-opacity":.05},O),G("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),G("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),G("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),G("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=a.P.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",T=>{T.preventDefault()}),this._element.addEventListener("mousedown",T=>{T.preventDefault()});const y=this._element.classList;for(const T in Bg)y.remove(`mapboxgl-marker-anchor-${T}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const b=l&&l.className?l.className.trim().split(/\s+/):[];y.add(...b),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.aJ.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const f=l.code,y=l.charCode||l.keyCode;f!=="Space"&&f!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(l){const f=l.originalEvent.target,y=this._element;this._popup&&(f===y||y.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,f=this._pos;if(!l||!f)return!1;const y=l.unproject(f),b=l.getFreeCameraOptions();if(!b.position)return!1;const T=b.position.toLngLat();return T.distanceTo(y)<.9*T.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const f=this._pos;if(!f||f.x<0||f.x>l.transform.width||f.y<0||f.y>l.transform.height)return void this._clearFadeTimer();const y=l.unproject(f);let b;l._showingGlobe()&&a.dc(l.transform,this._lngLat)?b=0:(b=1-l._queryFogOpacity(y),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${l.x}px,${l.y}px)
            ${Bg[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const l=this._pos,f=this._map,y=this.getPitchAlignment();if(!f||!l||y!=="map")return"";if(!f._showingGlobe()){const O=f.getPitch();return O?`rotateX(${O}deg)`:""}const b=a.b1(a.dd(f.transform,this._lngLat)),T=l.sub(a.de(f.transform)),S=Math.abs(T.x)+Math.abs(T.y);if(S===0)return"";const A=b/S;return`rotateX(${-T.y*A}deg) rotateY(${T.x*A}deg)`}_calculateZTransform(){const l=this._pos,f=this._map;if(!f||!l)return"";let y=0;const b=this.getRotationAlignment();if(b==="map")if(f._showingGlobe()){const T=f.project(new a.aJ(this._lngLat.lng,this._lngLat.lat+.001)),S=f.project(new a.aJ(this._lngLat.lng,this._lngLat.lat-.001)).sub(T);y=a.b1(Math.atan2(S.y,S.x))-90}else y=-f.getBearing();else if(b==="horizon"){const T=a.a0(4,6,f.getZoom()),S=a.de(f.transform);S.y+=T*f.transform.height;const A=l.sub(S),O=a.b1(Math.atan2(A.y,A.x));y=(O>90?O-270:O+90)*(1-T)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(l){cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=kp(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),l===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=a.P.convert(l),this._update(),this}addClassName(l){return this._element.classList.add(l),this}removeClassName(l){return this._element.classList.remove(l),this}toggleClassName(l){return this._element.classList.toggle(l)}_onMove(l){const f=this._map;if(!f)return;const y=this._pointerdownPos,b=this._positionDelta;if(y&&b){if(!this._isDragging){const T=this._clickTolerance||f._clickTolerance;if(l.point.dist(y)<T)return;this._isDragging=!0}this._pos=l.point.sub(b),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.g("dragstart"))),this.fire(new a.g("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.g("dragend")),this._state="inactive"}_addDragHandler(l){const f=this._map,y=this._pos;f&&y&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(y),this._pointerdownPos=l.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const f=this._map;return f&&(l?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ad={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},DA=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ow(g=new a.P(0,0),l="bottom"){if(typeof g=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new a.P(0,g);case"top-left":return new a.P(f,f);case"top-right":return new a.P(-f,f);case"bottom":return new a.P(0,-g);case"bottom-left":return new a.P(f,-f);case"bottom-right":return new a.P(-f,-f);case"left":return new a.P(g,0);case"right":return new a.P(-g,0)}return new a.P(0,0)}return g instanceof a.P||Array.isArray(g)?a.P.convert(g):a.P.convert(g[l]||[0,0])}class LA{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const f=a.bb((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,f,y){this._start=this.getValue(f),this._end=l,this._startTime=f,this._endTime=f+y}}const zA={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class NA{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const FA={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},B0={showCompass:!0,showZoom:!0,visualizePitch:!1};class j0{constructor(l,f,y=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new Ip({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,y&&(this.mousePitch=new Og({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),a.br(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),U()}move(l,f){const y=this.map,b=this.mouseRotate.mousemoveWindow(l,f),T=b&&b.bearingDelta;if(T&&y.setBearing(y.getBearing()+T),this.mousePitch){const S=this.mousePitch.mousemoveWindow(l,f),A=S&&S.pitchDelta;A&&y.setPitch(y.getPitch()+A)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){H(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(a.Q({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),ve(this.element,l)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,ve(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ee(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){l.targetTouches.length!==1?this.reset():(this._lastPos=Ee(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const aw={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Pd={maxWidth:100,unit:"metric"},lw={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:a.dw,supported:I,setRTLTextPlugin:a.dy,getRTLTextPluginStatus:a.dz,Map:class extends F0{constructor(g){a.df.mark(a.dg.create);const l=g;if((g=a.Q({},FA,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&a.dh(window)&&(g.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new eu(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new Fg,this._domRenderTaskQueue=new Fg,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.di(),this._locale=a.Q({},zA,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new LA(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new a.dj(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?{...g.contextCreateOptions}:{},typeof g.container=="string"){const f=document.getElementById(g.container);if(!f)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=f}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),a.br(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new NA),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Lg(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||a.db.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),g.hash&&(this._hash=new Qb(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){l.center==null&&l.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const f=g.bounds;f&&(this.resize(),this.fitBounds(f,a.Q({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new Mp({customAttribution:g.customAttribution})),this._logoControl=new Ng,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new a.g(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new a.g(`${f.dataType}dataloading`,f))})}_getMapId(){return this._mapId}addControl(g,l){if(l===void 0&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new a.f(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=g.onAdd(this);this._controls.push(g);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(f,y.firstChild):y.appendChild(f),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new a.f(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new a.g("movestart",g)).fire(new a.g("move",g)),this.fire(new a.g("resize",g)),l&&this.fire(new a.g("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(a.aj.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new a.g("zoomstart")).fire(new a.g("zoom")).fire(new a.g("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new a.g("pitchstart")).fire(new a.g("pitch")).fire(new a.g("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map(l=>l==="auto"?navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style.reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,l=g.projection.name;let f;l==="globe"&&g.zoom>=a.aV?(g.setMercatorFromTransition(),f=!0):l==="mercator"&&g.zoom<a.aV&&(g.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;return l=g.name==="globe"&&this.transform.zoom>=a.aV?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g){return this.transform.locationPoint3D(a.aJ.convert(g))}unproject(g){return this.transform.pointLocation3D(a.P.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,f){if(g==="mouseenter"||g==="mouseover"){let y=!1;const b=S=>{const A=l.filter(z=>this.getLayer(z)),O=A.length?this.queryRenderedFeatures(S.point,{layers:A}):[];O.length?y||(y=!0,f.call(this,new ua(g,this,S.originalEvent,{features:O}))):y=!1},T=()=>{y=!1};return{layers:new Set(l),listener:f,delegates:{mousemove:b,mouseout:T}}}if(g==="mouseleave"||g==="mouseout"){let y=!1;const b=S=>{const A=l.filter(O=>this.getLayer(O));(A.length?this.queryRenderedFeatures(S.point,{layers:A}):[]).length?y=!0:y&&(y=!1,f.call(this,new ua(g,this,S.originalEvent)))},T=S=>{y&&(y=!1,f.call(this,new ua(g,this,S.originalEvent)))};return{layers:new Set(l),listener:f,delegates:{mousemove:b,mouseout:T}}}{const y=b=>{const T=l.filter(A=>this.getLayer(A)),S=T.length?this.queryRenderedFeatures(b.point,{layers:T}):[];S.length&&(b.features=S,f.call(this,b),delete b.features)};return{layers:new Set(l),listener:f,delegates:{[g]:y}}}}on(g,l,f){if(typeof l=="function"||f===void 0)return super.on(g,l);if(Array.isArray(l)||(l=[l]),l){for(const b of l)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(y);for(const b in y.delegates)this.on(b,y.delegates[b]);return this}once(g,l,f){if(typeof l=="function"||f===void 0)return super.once(g,l);if(Array.isArray(l)||(l=[l]),l){for(const b of l)if(!this._isValidId(b))return this}const y=this._createDelegatedListener(g,l,f);for(const b in y.delegates)this.once(b,y.delegates[b]);return this}off(g,l,f){if(typeof l=="function"||f===void 0)return super.off(g,l);const y=new Set(Array.isArray(l)?l:[l]);for(const S of y)if(!this._isValidId(S))return this;const b=(S,A)=>{if(S.size!==A.size)return!1;for(const O of S)if(!A.has(O))return!1;return!0},T=this._delegatedListeners?this._delegatedListeners[g]:void 0;return T&&(S=>{for(let A=0;A<S.length;A++){const O=S[A];if(O.listener===f&&b(O.layers,y)){for(const z in O.delegates)this.off(z,O.delegates[z]);return S.splice(A,1),this}}})(T),this}queryRenderedFeatures(g,l){if(!this.style)return[];if(l!==void 0||g===void 0||g instanceof a.P||Array.isArray(g)||(l=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],(l=l||{}).layers&&Array.isArray(l.layers)){for(const f of l.layers)if(!this._isValidId(f))return[]}return this.style.queryRenderedFeatures(g,l,this.transform)}querySourceFeatures(g,l){return this._isValidId(g)?this.style.querySourceFeatures(g,l):[]}isPointOnSurface(g){const{name:l}=this.transform.projection;return l!=="globe"&&l!=="mercator"&&a.w(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(g))}setStyle(g,l){return l=a.Q({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l),this.style&&g&&l.diff!==!1&&l.localFontFamily===this._localFontFamily&&l.localIdeographFontFamily===this._localIdeographFontFamily&&!l.config?(this.style._diffStyle(g,(f,y)=>{f?(a.w(`Unable to perform style diff: ${String(f.message||f.error||f)}. Rebuilding the style from scratch.`),this._updateStyle(g,l)):y&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(l==null)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const f=a.Q({},l);l&&l.config&&(f.initialConfig=l.config,delete f.config),this.style=new ca(this,f).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ca(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new a.f(new Error("IDs can't be empty."))),!1):!a.cY(g)||(this.fire(new a.f(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}addSource(g,l){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,l,f){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,f)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,l,{pixelRatio:f=1,sdf:y=!1,stretchX:b,stretchY:T,content:S}={}){if(this._lazyInitEmptyStyle(),l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap){const{width:A,height:O,data:z}=a.e.getImageData(l);this.style.addImage(g,{data:new a.j({width:A,height:O},z),pixelRatio:f,stretchX:b,stretchY:T,content:S,sdf:y,version:0})}else if(l.width===void 0||l.height===void 0)this.fire(new a.f(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:O}=l,z=l;this.style.addImage(g,{data:new a.j({width:A,height:O},new Uint8Array(z.data)),pixelRatio:f,stretchX:b,stretchY:T,content:S,sdf:y,version:0,userImage:z}),z.onAdd&&z.onAdd(this,g)}}updateImage(g,l){this._lazyInitEmptyStyle();const f=this.style.getImage(g);if(!f)return void this.fire(new a.f(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap?a.e.getImageData(l):l,{width:b,height:T,data:S}=y;if(b===void 0||T===void 0)return void this.fire(new a.f(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==f.data.width||T!==f.data.height)return void this.fire(new a.f(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const A=!(l instanceof HTMLImageElement||ImageBitmap&&l instanceof ImageBitmap);f.data.replace(S,A),this.style.updateImage(g,f)}hasImage(g){return g?!!this.style&&!!this.style.getImage(g):(this.fire(new a.f(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){a.i(this._requestManager.transformRequest(g,a.R.Image),(f,y)=>{l(f,y instanceof HTMLImageElement?a.e.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(g,l){this._lazyInitEmptyStyle(),this.style.addModel(g,l)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new a.f(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,l){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)):this}getSlot(g){const l=this.getLayer(g);return l&&l.slot||null}setSlot(g,l){return this.style.setSlot(g,l),this.style.mergeLayers(),this._update(!0)}addImport(g,l){return this.style.addImport(g,l),this}updateImport(g,l){return typeof l!="string"&&l.id!==g?(this.removeImport(g),this.addImport(l)):(this.style.updateImport(g,l),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,l){return this.style.moveImport(g,l),this._update(!0)}moveLayer(g,l){return this._isValidId(g)?(this.style.moveLayer(g,l),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const l=this.style.getOwnLayer(g);return l?l.type==="custom"?l.implementation:l.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,l,f){return this._isValidId(g)?(this.style.setLayerZoomRange(g,l,f),this._update(!0)):this}setFilter(g,l,f={}){return this._isValidId(g)?(this.style.setFilter(g,l,f),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,l,f,y={}){return this._isValidId(g)?(this.style.setPaintProperty(g,l,f,y),this._update(!0)):this}getPaintProperty(g,l){return this._isValidId(g)?this.style.getPaintProperty(g,l):null}setLayoutProperty(g,l,f,y={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,l,f,y),this._update(!0)):this}getLayoutProperty(g,l){return this._isValidId(g)?this.style.getLayoutProperty(g,l):null}getSchema(g){return this.style.getSchema(g)}setSchema(g,l){return this.style.setSchema(g,l),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,l){return this.style.setConfig(g,l),this._update(!0)}getConfigProperty(g,l){return this.style.getConfigProperty(g,l)}setConfigProperty(g,l,f){return this.style.setConfigProperty(g,l,f),this._update(!0)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const l=g[0];l.properties?this.style.setFlatLight(l.properties,l.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,l={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.aJ.convert(g),this.transform):0}setFeatureState(g,l){return this._isValidId(g.source)?(this.style.setFeatureState(g,l),this._update()):this}removeFeatureState(g,l){return this._isValidId(g.source)?(this.style.removeFeatureState(g,l),this._update()):this}getFeatureState(g){return this._isValidId(g.source)?this.style.getFeatureState(g):null}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let f,y,b,T=this._container;for(;T&&(!y||!b);){const S=window.getComputedStyle(T).transform;S&&S!=="none"&&(f=S.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(y=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(b=f[3])),T=T.parentElement}this._containerWidth=y?Math.abs(g/y):g,this._containerHeight=b?Math.abs(l/b):l}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=L("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=L("div","mapboxgl-canvas-container",g);this._canvas=L("canvas","mapboxgl-canvas",l),this._interactive&&(l.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=L("div","mapboxgl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{y[b]=L("div",`mapboxgl-ctrl-${b}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const f=a.e.devicePixelRatio||1;this._canvas.width=f*Math.ceil(g),this._canvas.height=f*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);l!==-1&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);l!==-1&&this._popups.splice(l,1)}_setupPainter(){const g=a.Q({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl2",g);l?(a.dk(l,!0),this.painter=new T0(l,this._contextCreateOptions,this.transform,this._tp),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.dl.testSupport(l)):this.fire(new a.f(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.g("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new a.g("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;this.fire(new a.g("renderstart")),++this._frameId;const f=this.painter.context.extTimerQuery,y=a.e.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(l=b.createQuery(),b.beginQuery(f.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,B=this.transform.pitch,V=a.e.now(),W=new a.Y(z,{now:V,fadeDuration:T,pitch:B,transition:this.style.transition});this.style.update(W)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(y);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,this.painter.replacementSource);if(A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.g("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.df.mark(a.dg.load),this.fire(new a.g("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const z=a.e.now()-y;b.endQuery(f.TIME_ELAPSED_EXT),setTimeout(()=>{const B=b.getQueryParameter(l,b.QUERY_RESULT)/1e6;b.deleteQuery(l),this.fire(new a.g("gpu-timing-frame",{cpuTime:z,gpuTime:B}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(z);this.fire(new a.g("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(z);this.fire(new a.g("gpu-timing-deferred-render",{gpuTime:B}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(O||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(S=this._updateAverageElevation(y,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new a.g("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new a.g("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,a.df.mark(a.dg.fullLoad),this._performanceMetricsCollection&&a.dm(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const f=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const b=this.transform.averageElevation;let T=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(T)?T=0:this._averageElevationLastSampledAt=g;const S=Math.abs(b-T);if(S>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(T),f(T);this._averageElevation.easeTo(T,g,300)}else if(S>1e-4)return this._averageElevation.jumpTo(T),f(T)}return!!this._averageElevation.isEasing(g)&&f(this._averageElevation.getValue(g))}_authenticate(){a.dn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===a.dp||g.status===401)){const l=this.painter.context.gl;a.dk(l,!1),this._logoControl instanceof Ng&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.f(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.dq(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&a.dr(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const f=this.painter.context.gl,y=f.createFramebuffer();function b(T){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,T,0);const S=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,S),S}return f.bindFramebuffer(f.FRAMEBUFFER,y),this._canvasPixelComparison(b(g),l.canvasCopies.map(b),l.timeStamps)}_canvasPixelComparison(g,l,f){let y=f[1]-f[0];const b=g.length/4;for(let T=0;T<l.length;T++){const S=l[T];let A=0;for(let O=0;O<S.length;O+=4)S[O]===g[O]&&S[O+1]===g[O+1]&&S[O+2]===g[O+2]&&S[O+3]===g[O+3]&&(A+=1);y+=(f[T+2]-f[T+1])*(1-A/b)}return y}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.ds(this.painter.context.gl),a.dt.remove(),a.du.remove(),this._removed=!0,this.fire(new a.g("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=a.e.frame(l=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(l)}))}_preloadTiles(g){const l=this.style?this.style.getSourceCaches():[];return a.dv(l,(f,y)=>f._preloadTiles(g,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,l){a.dx(g,l)}get version(){return a.dw}},NavigationControl:class{constructor(g={}){this.options=a.Q({},B0,g),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(a.br(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),L("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),L("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.br(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:l}):f.resetNorth({},{originalEvent:l}))}),this._compassIcon=L("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),f=l===g.getMaxZoom(),y=l===g.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new j0(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const f=L("button",g,this._container);return f.type="button",f.addEventListener("click",l),f}_setButtonTitle(g,l){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",f),g.firstElementChild&&g.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends a.E{constructor(g={}){super();const l=navigator.geolocation;this.options=a.Q({geolocation:l},aw,g),a.br(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Kb(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,g(f)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(f=>l(f.state!=="denied")).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),f=g.coords;return!!l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new a.g("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("geolocate",g)),this._finish()}}_updateCamera(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude),f=g.coords.accuracy,y=this._map.getBearing(),b=a.Q({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(f),b,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new a.aJ(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=a.ay(1,g._center.lat)*g.worldSize,f=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.g("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=L("button","mapboxgl-ctrl-geolocate",this._container),L("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=L("div","mapboxgl-user-location"),this._dotElement.appendChild(L("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(L("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new jg({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=L("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jg({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l.originalEvent&&l.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.g("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.g("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.g("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.g("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(l=>{l==="granted"&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Mp,ScaleControl:class{constructor(g={}){this.options=a.Q({},Pd,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.br(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,f=l._containerHeight/2,y=l._containerWidth/2-g/2,b=l.unproject([y,f]),T=l.unproject([y+g,f]),S=b.distanceTo(T);if(this.options.unit==="imperial"){const A=3.2808*S;A>5280?this._setScale(g,A/5280,"mile"):this._setScale(g,A,"foot")}else this.options.unit==="nautical"?this._setScale(g,S/1852,"nautical-mile"):S>=1e3?this._setScale(g,S/1e3,"kilometer"):this._setScale(g,S,"meter")}_setScale(g,l,f){this._map._requestDomTask(()=>{const y=function(T){const S=Math.pow(10,`${Math.floor(T)}`.length-1);let A=T/S;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(O){const z=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*z)/z}(A),S*A}(l),b=y/l;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(y):`${y}&nbsp;${lw[f]}`,this._container.style.width=g*b+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=L("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:a.w("Full screen control 'container' must be a DOM element.")),a.br(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=L("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=L("button","mapboxgl-ctrl-fullscreen",this._controlContainer);L("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.E{constructor(g){super(),this.options=a.Q(Object.create(Ad),g),a.br(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new a.g("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new a.g("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=a.aJ.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const l=document.createDocumentFragment(),f=document.createElement("body");let y;for(f.innerHTML=g;y=f.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=L("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const f=this._closeButton=L("button","mapboxgl-popup-close-button",l);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,f=this._container,y=this._pos;if(!l||!f||!y)return"bottom";const b=f.offsetWidth,T=f.offsetHeight,S=y.x<b/2,A=y.x>l.transform.width-b/2;if(y.y+g<T)return S?"top-left":A?"top-right":"top";if(y.y>l.transform.height-T){if(S)return"bottom-left";if(A)return"bottom-right"}return S?"left":A?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,f=this._content;if(!l||!this._lngLat&&!this._trackPointer||!f)return;let y=this._container;if(y||(y=this._container=L("div","mapboxgl-popup",l.getContainer()),this._tip=L("div","mapboxgl-popup-tip",y),y.appendChild(f)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=kp(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const b=this._pos=this._trackPointer&&g instanceof a.P?g:l.project(this._lngLat),T=ow(this.options.offset),S=this._anchor=this._getAnchor(T.y),A=ow(this.options.offset,S),O=b.add(A).round();l._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Bg[S]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&l._showingGlobe()){const b=a.dc(l.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(DA);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:jg,Style:ca,LngLat:a.aJ,LngLatBounds:a.aj,Point:a.P,MercatorCoordinate:a._,FreeCameraOptions:dd,Evented:a.E,config:a.db,prewarm:a.dA,clearPrewarmedResources:a.dB,get accessToken(){return a.db.ACCESS_TOKEN},set accessToken(g){a.db.ACCESS_TOKEN=g},get baseApiUrl(){return a.db.API_URL},set baseApiUrl(g){a.db.API_URL=g},get workerCount(){return a.dC.workerCount},set workerCount(g){a.dC.workerCount=g},get maxParallelImageRequests(){return a.db.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){a.db.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){a.dD(g)},get workerUrl(){return a.dE.workerUrl},set workerUrl(g){a.dE.workerUrl=g},get workerClass(){return a.dE.workerClass},set workerClass(g){a.dE.workerClass=g},get workerParams(){return a.dE.workerParams},set workerParams(g){a.dE.workerParams=g},get dracoUrl(){return a.dF()},set dracoUrl(g){a.dG(g)},get meshoptUrl(){return a.dH()},set meshoptUrl(g){a.dI(g)},setNow:a.e.setNow,restoreNow:a.e.restoreNow}});var x=d;return x})})(mZ);var DTe=mZ.exports;const qm=Gy(DTe),_Z="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";qm.accessToken=_Z;let eE=null,d$=!1;const Nl={},LTe=async(t,e)=>{if(Wt.currentUser){const r=Xn(wn,"users",Wt.currentUser.uid);try{await us(r,{location:{latitude:t,longitude:e,timestamp:new Date().toISOString()}})}catch(s){console.error("Error updating location:",s)}}},yZ=(t,e,r,s)=>{if(console.log("Adding marker for user:",s),!t||typeof t.addLayer!="function")return console.error("Invalid map object in addMarker"),null;if(!t.loaded())return console.log("Map not yet loaded, waiting..."),t.on("load",()=>yZ(t,e,r,s)),null;const c=document.createElement("div");c.className="marker-container";const d=document.createElement("img");d.src=s.profilePhoto||"/default-profile.png",d.alt=s.name||"User",d.className="marker-image";let _=!1;d.onerror=()=>{_||(console.warn(`Failed to load image for ${s.name||"user"}, default profile used.`),_=!0),d.src="/default-profile.png"},c.appendChild(d);const x=document.createElement("div");x.className="marker-dot",c.appendChild(x);try{const a=new qm.Marker(c).setLngLat([r,e]).addTo(t);console.log("Marker created:",a);const I=new qm.Popup({offset:25,closeButton:!1,closeOnClick:!1,maxWidth:"none"}),M=document.createElement("div");M.className="custom-popup",M.innerHTML=`
      <div class="profile-container">
        <div class="profile-header">
          <div class="profile-photo-container">
            <img src="${s.profilePhoto||"/default-profile.png"}" alt="${s.name||"User"}" class="profile-photo">
          </div>
          <div class="profile-info">
            <h2 class="profile-name">${s.name||"Unknown User"}</h2>
            <p class="profile-status"><span class="status-dot"></span> Active</p>
            <p class="profile-bio">${s.bio||"No bio available"}</p>
          </div>
        </div>
        <div class="tags-container">
          ${(s.tags||[]).map(L=>`<div class="tag">${L}</div>`).join("")}
        </div>
        <button class="add-friend-button">Add Friend</button>
      </div>
    `;const D=M.querySelector(".add-friend-button");return D.addEventListener("click",async()=>{console.log("Add friend button clicked");try{const L=Xn(wn,"users",Wt.currentUser.uid),re=(await $i(L)).data().friends||[];re.includes(s.id)||(await us(L,{friends:[...re,s.id]}),D.textContent="Friend Added",D.disabled=!0)}catch(L){console.error("Error adding friend:",L)}}),I.setDOMContent(M),a.setPopup(I),a.getElement().addEventListener("click",L=>{console.log("Marker clicked:",s),L.stopPropagation(),I.addTo(t)}),a}catch(a){return console.error("Error creating marker:",a),null}},vZ=(t,e)=>{if(console.log("Setting up user locations listener"),!t||typeof t.addLayer!="function")return console.error("Invalid map object in setupUserLocationsListener"),()=>{};if(!t.loaded())return t.on("load",()=>vZ(t,e)),()=>{};const r=vi(wn,"users"),s=co(r,yi("isActive","==",!0));return jh(s,async c=>{console.log("User locations snapshot received");const d=new Set,_=Wt.currentUser;if(!_){console.warn("No authenticated user found");return}const a=(await $i(Xn(wn,"users",_.uid))).data(),I=(a==null?void 0:a.friends)||[],M=(a==null?void 0:a.isPrivate)||!1;c.forEach(async D=>{const L=D.id,G=D.data();console.log("Processing user:",L,G);const Q=!G.isPrivate||L===_.uid||M&&I.includes(L)||!M&&I.includes(L);if(G.isActive&&G.location&&Q){d.add(L);const re=new Date(G.location.timestamp).getTime();if(new Date().getTime()-re>3e5)console.log("Removing inactive user:",L),Nl[L]&&(Nl[L].remove(),delete Nl[L]);else if(Nl[L])console.log("Updating marker for user:",L),Nl[L].setLngLat([G.location.longitude,G.location.latitude]);else{console.log("Adding new marker for user:",L);const H=yZ(t,G.location.latitude,G.location.longitude,{id:L,name:G.name,profilePhoto:G.profilePhoto,bio:G.bio,tags:G.tags});H&&(Nl[L]=H)}}else console.log("Removing marker for non-visible user:",L),Nl[L]&&(Nl[L].remove(),delete Nl[L])}),Object.keys(Nl).forEach(D=>{d.has(D)||(console.log("Removing marker for user no longer in snapshot:",D),Nl[D].remove(),delete Nl[D])}),typeof e=="function"?e([...d]):console.warn("setCurrentUserIds is not a function")})},zTe=(t,e)=>{if(console.log("Setting up user location tracking"),!t||typeof t.addLayer!="function"){console.error("Invalid map object in trackUserLocation");return}if("geolocation"in navigator)return navigator.geolocation.watchPosition(s=>{const{latitude:c,longitude:d}=s.coords;LTe(c,d),(!eE||!d$||Math.abs(c-eE.latitude)>.001||Math.abs(d-eE.longitude)>.001)&&(t.flyTo({center:[d,c],zoom:15}),eE={latitude:c,longitude:d},d$=!0),fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${d},${c}.json?access_token=${_Z}`).then(x=>x.json()).then(x=>{x.features&&x.features.length>0&&e(x.features[0].place_name)}).catch(x=>{console.error("Error fetching address:",x)})},s=>{console.error("Error getting location:",s)},{enableHighAccuracy:!0,maximumAge:0,timeout:27e3});console.error("Geolocation is not supported by this browser.")},r4=async(t,e)=>{if(!t){console.error("Map object is not available");return}try{const s=(await $i(Xn(wn,"users",e))).data();s&&s.location?t.flyTo({center:[s.location.longitude,s.location.latitude],zoom:15,duration:1e3}):console.warn(`No location data found for user ${e}`)}catch(r){console.error("Error centering map on user:",r)}},i4=async t=>{if(Wt.currentUser){const e=Xn(wn,"users",Wt.currentUser.uid);try{await us(e,{isActive:t})}catch(r){console.error("Error updating active status:",r)}}},NTe=t=>Wt.onAuthStateChanged(e=>{e?i4(!0):(i4(!1),t("/login"))}),FTe=(t,e)=>{Wt.currentUser?i4(!1).then(()=>{localStorage.clear(),Wt.signOut().then(()=>{t("/login")}).catch(r=>{console.error("Error signing out:",r)})}):(localStorage.clear(),Wt.signOut().then(()=>{t("/login")}).catch(r=>{console.error("Error signing out:",r)}))},xZ=Y.createContext(),BTe=()=>Y.useContext(xZ),jTe=({children:t})=>{const[e,r]=Y.useState("offline"),[s,c]=Y.useState(Date.now());Y.useEffect(()=>{const x=Wt.onAuthStateChanged(a=>{a?(r("online"),c(Date.now()),_(a.uid,"online"),d(a.uid)):(r("offline"),c(Date.now()))});return()=>{x()}},[]);const d=x=>{const a=["mousedown","keydown","scroll","touchstart"],I=()=>{c(Date.now()),e!=="online"&&(r("online"),_(x,"online"))};a.forEach(L=>{window.addEventListener(L,I)});const M=setInterval(()=>{Date.now()-s>3*60*1e3&&(r("idle"),_(x,"idle"))},60*1e3),D=()=>{document.hidden?(r("offline"),_(x,"offline")):(r("online"),c(Date.now()),_(x,"online"))};return document.addEventListener("visibilitychange",D),()=>{a.forEach(L=>{window.removeEventListener(L,I)}),clearInterval(M),document.removeEventListener("visibilitychange",D)}},_=async(x,a)=>{try{const I=Xn(wn,"users",x);await us(I,{status:a})}catch(I){console.error("Error updating user status in Firestore:",I)}};return Y.useEffect(()=>{if(Wt.currentUser){const x=Xn(wn,"users",Wt.currentUser.uid),a=jh(x,I=>{I.exists()&&I.data().activeQuest&&r("on quest")});return()=>a()}},[]),F.jsx(xZ.Provider,{value:{userStatus:e,setUserStatus:r},children:t})},f$=()=>{};let H5={},bZ={},wZ=null,TZ={mark:f$,measure:f$};try{typeof window<"u"&&(H5=window),typeof document<"u"&&(bZ=document),typeof MutationObserver<"u"&&(wZ=MutationObserver),typeof performance<"u"&&(TZ=performance)}catch{}const{userAgent:p$=""}=H5.navigator||{},jf=H5,es=bZ,m$=wZ,tE=TZ;jf.document;const od=!!es.documentElement&&!!es.head&&typeof es.addEventListener=="function"&&typeof es.createElement=="function",EZ=~p$.indexOf("MSIE")||~p$.indexOf("Trident/");var ds="classic",SZ="duotone",gl="sharp",_l="sharp-duotone",UTe=[ds,SZ,gl,_l],VTe={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds"}},g$={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},$Te=["kit"],qTe=/fa(s|r|l|t|d|b|k|kd|ss|sr|sl|st|sds)?[\-\ ]/,GTe=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit)?.*/i,WTe={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}},HTe={"Font Awesome 6 Free":{900:"fas",400:"far"},"Font Awesome 6 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 6 Brands":{400:"fab",normal:"fab"},"Font Awesome 6 Duotone":{900:"fad"},"Font Awesome 6 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 6 Sharp Duotone":{900:"fasds"}},ZTe={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds"}},XTe={classic:["fas","far","fal","fat"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds"]},KTe={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid"}},QTe={classic:{solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab"},sharp:{solid:"fass",regular:"fasr",light:"fasl",thin:"fast"},"sharp-duotone":{solid:"fasds"}},IZ={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid"}},YTe=["solid","regular","light","thin","duotone","brands"],CZ=[1,2,3,4,5,6,7,8,9,10],JTe=CZ.concat([11,12,13,14,15,16,17,18,19,20]),f1={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},eEe=[...Object.keys(XTe),...YTe,"2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",f1.GROUP,f1.SWAP_OPACITY,f1.PRIMARY,f1.SECONDARY].concat(CZ.map(t=>"".concat(t,"x"))).concat(JTe.map(t=>"w-".concat(t))),tEe={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},nEe={kit:{"fa-kit":"fak"},"kit-duotone":{"fa-kit-duotone":"fakd"}},rEe={kit:{fak:"fa-kit"},"kit-duotone":{fakd:"fa-kit-duotone"}},_$={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}};const Jh="___FONT_AWESOME___",s4=16,AZ="fa",PZ="svg-inline--fa",Gm="data-fa-i2svg",o4="data-fa-pseudo-element",iEe="data-fa-pseudo-element-pending",Z5="data-prefix",X5="data-icon",y$="fontawesome-i2svg",sEe="async",oEe=["HTML","HEAD","STYLE","SCRIPT"],RZ=(()=>{try{return!0}catch{return!1}})(),MZ=[ds,gl,_l];function Tb(t){return new Proxy(t,{get(e,r){return r in e?e[r]:e[ds]}})}const kZ={...IZ};kZ[ds]={...IZ[ds],...g$.kit,...g$["kit-duotone"]};const Em=Tb(kZ),a4={...QTe};a4[ds]={...a4[ds],..._$.kit,..._$["kit-duotone"]};const Fx=Tb(a4),l4={...KTe};l4[ds]={...l4[ds],...rEe.kit};const Sm=Tb(l4),c4={...ZTe};c4[ds]={...c4[ds],...nEe.kit};const aEe=Tb(c4),lEe=qTe,OZ="fa-layers-text",cEe=GTe,uEe={...VTe};Tb(uEe);const hEe=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],BR=f1,Fy=new Set;Object.keys(Fx[ds]).map(Fy.add.bind(Fy));Object.keys(Fx[gl]).map(Fy.add.bind(Fy));Object.keys(Fx[_l]).map(Fy.add.bind(Fy));const dEe=[...$Te,...eEe],V1=jf.FontAwesomeConfig||{};function fEe(t){var e=es.querySelector("script["+t+"]");if(e)return e.getAttribute(t)}function pEe(t){return t===""?!0:t==="false"?!1:t==="true"?!0:t}es&&typeof es.querySelector=="function"&&[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(e=>{let[r,s]=e;const c=pEe(fEe(r));c!=null&&(V1[s]=c)});const DZ={styleDefault:"solid",familyDefault:"classic",cssPrefix:AZ,replacementClass:PZ,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};V1.familyPrefix&&(V1.cssPrefix=V1.familyPrefix);const By={...DZ,...V1};By.autoReplaceSvg||(By.observeMutations=!1);const qn={};Object.keys(DZ).forEach(t=>{Object.defineProperty(qn,t,{enumerable:!0,set:function(e){By[t]=e,$1.forEach(r=>r(qn))},get:function(){return By[t]}})});Object.defineProperty(qn,"familyPrefix",{enumerable:!0,set:function(t){By.cssPrefix=t,$1.forEach(e=>e(qn))},get:function(){return By.cssPrefix}});jf.FontAwesomeConfig=qn;const $1=[];function mEe(t){return $1.push(t),()=>{$1.splice($1.indexOf(t),1)}}const ef=s4,ku={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function gEe(t){if(!t||!od)return;const e=es.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t;const r=es.head.childNodes;let s=null;for(let c=r.length-1;c>-1;c--){const d=r[c],_=(d.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(_)>-1&&(s=d)}return es.head.insertBefore(e,s),t}const _Ee="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function Bx(){let t=12,e="";for(;t-- >0;)e+=_Ee[Math.random()*62|0];return e}function o0(t){const e=[];for(let r=(t||[]).length>>>0;r--;)e[r]=t[r];return e}function K5(t){return t.classList?o0(t.classList):(t.getAttribute("class")||"").split(" ").filter(e=>e)}function LZ(t){return"".concat(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function yEe(t){return Object.keys(t||{}).reduce((e,r)=>e+"".concat(r,'="').concat(LZ(t[r]),'" '),"").trim()}function rA(t){return Object.keys(t||{}).reduce((e,r)=>e+"".concat(r,": ").concat(t[r].trim(),";"),"")}function Q5(t){return t.size!==ku.size||t.x!==ku.x||t.y!==ku.y||t.rotate!==ku.rotate||t.flipX||t.flipY}function vEe(t){let{transform:e,containerWidth:r,iconWidth:s}=t;const c={transform:"translate(".concat(r/2," 256)")},d="translate(".concat(e.x*32,", ").concat(e.y*32,") "),_="scale(".concat(e.size/16*(e.flipX?-1:1),", ").concat(e.size/16*(e.flipY?-1:1),") "),x="rotate(".concat(e.rotate," 0 0)"),a={transform:"".concat(d," ").concat(_," ").concat(x)},I={transform:"translate(".concat(s/2*-1," -256)")};return{outer:c,inner:a,path:I}}function xEe(t){let{transform:e,width:r=s4,height:s=s4,startCentered:c=!1}=t,d="";return c&&EZ?d+="translate(".concat(e.x/ef-r/2,"em, ").concat(e.y/ef-s/2,"em) "):c?d+="translate(calc(-50% + ".concat(e.x/ef,"em), calc(-50% + ").concat(e.y/ef,"em)) "):d+="translate(".concat(e.x/ef,"em, ").concat(e.y/ef,"em) "),d+="scale(".concat(e.size/ef*(e.flipX?-1:1),", ").concat(e.size/ef*(e.flipY?-1:1),") "),d+="rotate(".concat(e.rotate,"deg) "),d}var bEe=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 6 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 6 Sharp Duotone";
}

svg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {
  overflow: visible;
  box-sizing: content-box;
}

.svg-inline--fa {
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285705em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: var(--fa-pull-margin, 0.3em);
  width: auto;
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  top: 0.25em;
}
.svg-inline--fa.fa-fw {
  width: var(--fa-fw-width, 1.25em);
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: 0.625em;
  line-height: 0.1em;
  vertical-align: 0.225em;
}

.fa-xs {
  font-size: 0.75em;
  line-height: 0.0833333337em;
  vertical-align: 0.125em;
}

.fa-sm {
  font-size: 0.875em;
  line-height: 0.0714285718em;
  vertical-align: 0.0535714295em;
}

.fa-lg {
  font-size: 1.25em;
  line-height: 0.05em;
  vertical-align: -0.075em;
}

.fa-xl {
  font-size: 1.5em;
  line-height: 0.0416666682em;
  vertical-align: -0.125em;
}

.fa-2xl {
  font-size: 2em;
  line-height: 0.03125em;
  vertical-align: -0.1875em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: var(--fa-li-margin, 2.5em);
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.08em);
  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);
}

.fa-pull-left {
  float: left;
  margin-right: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right {
  float: right;
  margin-left: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
.fa-bounce,
.fa-fade,
.fa-beat-fade,
.fa-flip,
.fa-pulse,
.fa-shake,
.fa-spin,
.fa-spin-pulse {
    animation-delay: -1ms;
    animation-duration: 1ms;
    animation-iteration-count: 1;
    transition-delay: 0s;
    transition-duration: 0s;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.fa-stack {
  display: inline-block;
  vertical-align: middle;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
  z-index: var(--fa-stack-z-index, auto);
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.sr-only,
.fa-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.sr-only-focusable:not(:focus),
.fa-sr-only-focusable:not(:focus) {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse,
.fa-duotone.fa-inverse {
  color: var(--fa-inverse, #fff);
}`;function zZ(){const t=AZ,e=PZ,r=qn.cssPrefix,s=qn.replacementClass;let c=bEe;if(r!==t||s!==e){const d=new RegExp("\\.".concat(t,"\\-"),"g"),_=new RegExp("\\--".concat(t,"\\-"),"g"),x=new RegExp("\\.".concat(e),"g");c=c.replace(d,".".concat(r,"-")).replace(_,"--".concat(r,"-")).replace(x,".".concat(s))}return c}let v$=!1;function jR(){qn.autoAddCss&&!v$&&(gEe(zZ()),v$=!0)}var wEe={mixout(){return{dom:{css:zZ,insertCss:jR}}},hooks(){return{beforeDOMElementCreation(){jR()},beforeI2svg(){jR()}}}};const ed=jf||{};ed[Jh]||(ed[Jh]={});ed[Jh].styles||(ed[Jh].styles={});ed[Jh].hooks||(ed[Jh].hooks={});ed[Jh].shims||(ed[Jh].shims=[]);var Ou=ed[Jh];const NZ=[],FZ=function(){es.removeEventListener("DOMContentLoaded",FZ),tI=1,NZ.map(t=>t())};let tI=!1;od&&(tI=(es.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(es.readyState),tI||es.addEventListener("DOMContentLoaded",FZ));function TEe(t){od&&(tI?setTimeout(t,0):NZ.push(t))}function Eb(t){const{tag:e,attributes:r={},children:s=[]}=t;return typeof t=="string"?LZ(t):"<".concat(e," ").concat(yEe(r),">").concat(s.map(Eb).join(""),"</").concat(e,">")}function x$(t,e,r){if(t&&t[e]&&t[e][r])return{prefix:e,iconName:r,icon:t[e][r]}}var UR=function(e,r,s,c){var d=Object.keys(e),_=d.length,x=r,a,I,M;for(s===void 0?(a=1,M=e[d[0]]):(a=0,M=s);a<_;a++)I=d[a],M=x(M,e[I],I,e);return M};function EEe(t){const e=[];let r=0;const s=t.length;for(;r<s;){const c=t.charCodeAt(r++);if(c>=55296&&c<=56319&&r<s){const d=t.charCodeAt(r++);(d&64512)==56320?e.push(((c&1023)<<10)+(d&1023)+65536):(e.push(c),r--)}else e.push(c)}return e}function u4(t){const e=EEe(t);return e.length===1?e[0].toString(16):null}function SEe(t,e){const r=t.length;let s=t.charCodeAt(e),c;return s>=55296&&s<=56319&&r>e+1&&(c=t.charCodeAt(e+1),c>=56320&&c<=57343)?(s-55296)*1024+c-56320+65536:s}function b$(t){return Object.keys(t).reduce((e,r)=>{const s=t[r];return!!s.icon?e[s.iconName]=s.icon:e[r]=s,e},{})}function h4(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{skipHooks:s=!1}=r,c=b$(e);typeof Ou.hooks.addPack=="function"&&!s?Ou.hooks.addPack(t,b$(e)):Ou.styles[t]={...Ou.styles[t]||{},...c},t==="fas"&&h4("fa",e)}const{styles:am,shims:IEe}=Ou,CEe={[ds]:Object.values(Sm[ds]),[gl]:Object.values(Sm[gl]),[_l]:Object.values(Sm[_l])};let Y5=null,BZ={},jZ={},UZ={},VZ={},$Z={};const AEe={[ds]:Object.keys(Em[ds]),[gl]:Object.keys(Em[gl]),[_l]:Object.keys(Em[_l])};function PEe(t){return~dEe.indexOf(t)}function REe(t,e){const r=e.split("-"),s=r[0],c=r.slice(1).join("-");return s===t&&c!==""&&!PEe(c)?c:null}const qZ=()=>{const t=s=>UR(am,(c,d,_)=>(c[_]=UR(d,s,{}),c),{});BZ=t((s,c,d)=>(c[3]&&(s[c[3]]=d),c[2]&&c[2].filter(x=>typeof x=="number").forEach(x=>{s[x.toString(16)]=d}),s)),jZ=t((s,c,d)=>(s[d]=d,c[2]&&c[2].filter(x=>typeof x=="string").forEach(x=>{s[x]=d}),s)),$Z=t((s,c,d)=>{const _=c[2];return s[d]=d,_.forEach(x=>{s[x]=d}),s});const e="far"in am||qn.autoFetchSvg,r=UR(IEe,(s,c)=>{const d=c[0];let _=c[1];const x=c[2];return _==="far"&&!e&&(_="fas"),typeof d=="string"&&(s.names[d]={prefix:_,iconName:x}),typeof d=="number"&&(s.unicodes[d.toString(16)]={prefix:_,iconName:x}),s},{names:{},unicodes:{}});UZ=r.names,VZ=r.unicodes,Y5=iA(qn.styleDefault,{family:qn.familyDefault})};mEe(t=>{Y5=iA(t.styleDefault,{family:qn.familyDefault})});qZ();function J5(t,e){return(BZ[t]||{})[e]}function MEe(t,e){return(jZ[t]||{})[e]}function _f(t,e){return($Z[t]||{})[e]}function GZ(t){return UZ[t]||{prefix:null,iconName:null}}function kEe(t){const e=VZ[t],r=J5("fas",t);return e||(r?{prefix:"fas",iconName:r}:null)||{prefix:null,iconName:null}}function Uf(){return Y5}const eL=()=>({prefix:null,iconName:null,rest:[]});function iA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{family:r=ds}=e,s=Em[r][t],c=Fx[r][t]||Fx[r][s],d=t in Ou.styles?t:null;return c||d||null}const OEe={[ds]:Object.keys(Sm[ds]),[gl]:Object.keys(Sm[gl]),[_l]:Object.keys(Sm[_l])};function sA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{skipLookups:r=!1}=e,s={[ds]:"".concat(qn.cssPrefix,"-").concat(ds),[gl]:"".concat(qn.cssPrefix,"-").concat(gl),[_l]:"".concat(qn.cssPrefix,"-").concat(_l)};let c=null,d=ds;const _=UTe.filter(a=>a!==SZ);_.forEach(a=>{(t.includes(s[a])||t.some(I=>OEe[a].includes(I)))&&(d=a)});const x=t.reduce((a,I)=>{const M=REe(qn.cssPrefix,I);if(am[I]?(I=CEe[d].includes(I)?aEe[d][I]:I,c=I,a.prefix=I):AEe[d].indexOf(I)>-1?(c=I,a.prefix=iA(I,{family:d})):M?a.iconName=M:I!==qn.replacementClass&&!_.some(D=>I===s[D])&&a.rest.push(I),!r&&a.prefix&&a.iconName){const D=c==="fa"?GZ(a.iconName):{},L=_f(a.prefix,a.iconName);D.prefix&&(c=null),a.iconName=D.iconName||L||a.iconName,a.prefix=D.prefix||a.prefix,a.prefix==="far"&&!am.far&&am.fas&&!qn.autoFetchSvg&&(a.prefix="fas")}return a},eL());return(t.includes("fa-brands")||t.includes("fab"))&&(x.prefix="fab"),(t.includes("fa-duotone")||t.includes("fad"))&&(x.prefix="fad"),!x.prefix&&d===gl&&(am.fass||qn.autoFetchSvg)&&(x.prefix="fass",x.iconName=_f(x.prefix,x.iconName)||x.iconName),!x.prefix&&d===_l&&(am.fasds||qn.autoFetchSvg)&&(x.prefix="fasds",x.iconName=_f(x.prefix,x.iconName)||x.iconName),(x.prefix==="fa"||c==="fa")&&(x.prefix=Uf()||"fas"),x}class DEe{constructor(){this.definitions={}}add(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const c=r.reduce(this._pullDefinitions,{});Object.keys(c).forEach(d=>{this.definitions[d]={...this.definitions[d]||{},...c[d]},h4(d,c[d]);const _=Sm[ds][d];_&&h4(_,c[d]),qZ()})}reset(){this.definitions={}}_pullDefinitions(e,r){const s=r.prefix&&r.iconName&&r.icon?{0:r}:r;return Object.keys(s).map(c=>{const{prefix:d,iconName:_,icon:x}=s[c],a=x[2];e[d]||(e[d]={}),a.length>0&&a.forEach(I=>{typeof I=="string"&&(e[d][I]=x)}),e[d][_]=x}),e}}let w$=[],X_={};const my={},LEe=Object.keys(my);function zEe(t,e){let{mixoutsTo:r}=e;return w$=t,X_={},Object.keys(my).forEach(s=>{LEe.indexOf(s)===-1&&delete my[s]}),w$.forEach(s=>{const c=s.mixout?s.mixout():{};if(Object.keys(c).forEach(d=>{typeof c[d]=="function"&&(r[d]=c[d]),typeof c[d]=="object"&&Object.keys(c[d]).forEach(_=>{r[d]||(r[d]={}),r[d][_]=c[d][_]})}),s.hooks){const d=s.hooks();Object.keys(d).forEach(_=>{X_[_]||(X_[_]=[]),X_[_].push(d[_])})}s.provides&&s.provides(my)}),r}function d4(t,e){for(var r=arguments.length,s=new Array(r>2?r-2:0),c=2;c<r;c++)s[c-2]=arguments[c];return(X_[t]||[]).forEach(_=>{e=_.apply(null,[e,...s])}),e}function Wm(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),s=1;s<e;s++)r[s-1]=arguments[s];(X_[t]||[]).forEach(d=>{d.apply(null,r)})}function Vf(){const t=arguments[0],e=Array.prototype.slice.call(arguments,1);return my[t]?my[t].apply(null,e):void 0}function f4(t){t.prefix==="fa"&&(t.prefix="fas");let{iconName:e}=t;const r=t.prefix||Uf();if(e)return e=_f(r,e)||e,x$(WZ.definitions,r,e)||x$(Ou.styles,r,e)}const WZ=new DEe,NEe=()=>{qn.autoReplaceSvg=!1,qn.observeMutations=!1,Wm("noAuto")},FEe={i2svg:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return od?(Wm("beforeI2svg",t),Vf("pseudoElements2svg",t),Vf("i2svg",t)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:e}=t;qn.autoReplaceSvg===!1&&(qn.autoReplaceSvg=!0),qn.observeMutations=!0,TEe(()=>{jEe({autoReplaceSvgRoot:e}),Wm("watch",t)})}},BEe={icon:t=>{if(t===null)return null;if(typeof t=="object"&&t.prefix&&t.iconName)return{prefix:t.prefix,iconName:_f(t.prefix,t.iconName)||t.iconName};if(Array.isArray(t)&&t.length===2){const e=t[1].indexOf("fa-")===0?t[1].slice(3):t[1],r=iA(t[0]);return{prefix:r,iconName:_f(r,e)||e}}if(typeof t=="string"&&(t.indexOf("".concat(qn.cssPrefix,"-"))>-1||t.match(lEe))){const e=sA(t.split(" "),{skipLookups:!0});return{prefix:e.prefix||Uf(),iconName:_f(e.prefix,e.iconName)||e.iconName}}if(typeof t=="string"){const e=Uf();return{prefix:e,iconName:_f(e,t)||t}}}},wl={noAuto:NEe,config:qn,dom:FEe,parse:BEe,library:WZ,findIconDefinition:f4,toHtml:Eb},jEe=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{autoReplaceSvgRoot:e=es}=t;(Object.keys(Ou.styles).length>0||qn.autoFetchSvg)&&od&&qn.autoReplaceSvg&&wl.dom.i2svg({node:e})};function oA(t,e){return Object.defineProperty(t,"abstract",{get:e}),Object.defineProperty(t,"html",{get:function(){return t.abstract.map(r=>Eb(r))}}),Object.defineProperty(t,"node",{get:function(){if(!od)return;const r=es.createElement("div");return r.innerHTML=t.html,r.children}}),t}function UEe(t){let{children:e,main:r,mask:s,attributes:c,styles:d,transform:_}=t;if(Q5(_)&&r.found&&!s.found){const{width:x,height:a}=r,I={x:x/a/2,y:.5};c.style=rA({...d,"transform-origin":"".concat(I.x+_.x/16,"em ").concat(I.y+_.y/16,"em")})}return[{tag:"svg",attributes:c,children:e}]}function VEe(t){let{prefix:e,iconName:r,children:s,attributes:c,symbol:d}=t;const _=d===!0?"".concat(e,"-").concat(qn.cssPrefix,"-").concat(r):d;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:{...c,id:_},children:s}]}]}function tL(t){const{icons:{main:e,mask:r},prefix:s,iconName:c,transform:d,symbol:_,title:x,maskId:a,titleId:I,extra:M,watchable:D=!1}=t,{width:L,height:G}=r.found?r:e,Q=s==="fak",re=[qn.replacementClass,c?"".concat(qn.cssPrefix,"-").concat(c):""].filter(ve=>M.classes.indexOf(ve)===-1).filter(ve=>ve!==""||!!ve).concat(M.classes).join(" ");let ee={children:[],attributes:{...M.attributes,"data-prefix":s,"data-icon":c,class:re,role:M.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(L," ").concat(G)}};const U=Q&&!~M.classes.indexOf("fa-fw")?{width:"".concat(L/G*16*.0625,"em")}:{};D&&(ee.attributes[Gm]=""),x&&(ee.children.push({tag:"title",attributes:{id:ee.attributes["aria-labelledby"]||"title-".concat(I||Bx())},children:[x]}),delete ee.attributes.title);const H={...ee,prefix:s,iconName:c,main:e,mask:r,maskId:a,transform:d,symbol:_,styles:{...U,...M.styles}},{children:Z,attributes:de}=r.found&&e.found?Vf("generateAbstractMask",H)||{children:[],attributes:{}}:Vf("generateAbstractIcon",H)||{children:[],attributes:{}};return H.children=Z,H.attributes=de,_?VEe(H):UEe(H)}function T$(t){const{content:e,width:r,height:s,transform:c,title:d,extra:_,watchable:x=!1}=t,a={..._.attributes,...d?{title:d}:{},class:_.classes.join(" ")};x&&(a[Gm]="");const I={..._.styles};Q5(c)&&(I.transform=xEe({transform:c,startCentered:!0,width:r,height:s}),I["-webkit-transform"]=I.transform);const M=rA(I);M.length>0&&(a.style=M);const D=[];return D.push({tag:"span",attributes:a,children:[e]}),d&&D.push({tag:"span",attributes:{class:"sr-only"},children:[d]}),D}function $Ee(t){const{content:e,title:r,extra:s}=t,c={...s.attributes,...r?{title:r}:{},class:s.classes.join(" ")},d=rA(s.styles);d.length>0&&(c.style=d);const _=[];return _.push({tag:"span",attributes:c,children:[e]}),r&&_.push({tag:"span",attributes:{class:"sr-only"},children:[r]}),_}const{styles:VR}=Ou;function p4(t){const e=t[0],r=t[1],[s]=t.slice(4);let c=null;return Array.isArray(s)?c={tag:"g",attributes:{class:"".concat(qn.cssPrefix,"-").concat(BR.GROUP)},children:[{tag:"path",attributes:{class:"".concat(qn.cssPrefix,"-").concat(BR.SECONDARY),fill:"currentColor",d:s[0]}},{tag:"path",attributes:{class:"".concat(qn.cssPrefix,"-").concat(BR.PRIMARY),fill:"currentColor",d:s[1]}}]}:c={tag:"path",attributes:{fill:"currentColor",d:s}},{found:!0,width:e,height:r,icon:c}}const qEe={found:!1,width:512,height:512};function GEe(t,e){!RZ&&!qn.showMissingIcons&&t&&console.error('Icon with name "'.concat(t,'" and prefix "').concat(e,'" is missing.'))}function m4(t,e){let r=e;return e==="fa"&&qn.styleDefault!==null&&(e=Uf()),new Promise((s,c)=>{if(r==="fa"){const d=GZ(t)||{};t=d.iconName||t,e=d.prefix||e}if(t&&e&&VR[e]&&VR[e][t]){const d=VR[e][t];return s(p4(d))}GEe(t,e),s({...qEe,icon:qn.showMissingIcons&&t?Vf("missingIconAbstract")||{}:{}})})}const E$=()=>{},g4=qn.measurePerformance&&tE&&tE.mark&&tE.measure?tE:{mark:E$,measure:E$},p1='FA "6.6.0"',WEe=t=>(g4.mark("".concat(p1," ").concat(t," begins")),()=>HZ(t)),HZ=t=>{g4.mark("".concat(p1," ").concat(t," ends")),g4.measure("".concat(p1," ").concat(t),"".concat(p1," ").concat(t," begins"),"".concat(p1," ").concat(t," ends"))};var nL={begin:WEe,end:HZ};const OE=()=>{};function S$(t){return typeof(t.getAttribute?t.getAttribute(Gm):null)=="string"}function HEe(t){const e=t.getAttribute?t.getAttribute(Z5):null,r=t.getAttribute?t.getAttribute(X5):null;return e&&r}function ZEe(t){return t&&t.classList&&t.classList.contains&&t.classList.contains(qn.replacementClass)}function XEe(){return qn.autoReplaceSvg===!0?DE.replace:DE[qn.autoReplaceSvg]||DE.replace}function KEe(t){return es.createElementNS("http://www.w3.org/2000/svg",t)}function QEe(t){return es.createElement(t)}function ZZ(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{ceFn:r=t.tag==="svg"?KEe:QEe}=e;if(typeof t=="string")return es.createTextNode(t);const s=r(t.tag);return Object.keys(t.attributes||[]).forEach(function(d){s.setAttribute(d,t.attributes[d])}),(t.children||[]).forEach(function(d){s.appendChild(ZZ(d,{ceFn:r}))}),s}function YEe(t){let e=" ".concat(t.outerHTML," ");return e="".concat(e,"Font Awesome fontawesome.com "),e}const DE={replace:function(t){const e=t[0];if(e.parentNode)if(t[1].forEach(r=>{e.parentNode.insertBefore(ZZ(r),e)}),e.getAttribute(Gm)===null&&qn.keepOriginalSource){let r=es.createComment(YEe(e));e.parentNode.replaceChild(r,e)}else e.remove()},nest:function(t){const e=t[0],r=t[1];if(~K5(e).indexOf(qn.replacementClass))return DE.replace(t);const s=new RegExp("".concat(qn.cssPrefix,"-.*"));if(delete r[0].attributes.id,r[0].attributes.class){const d=r[0].attributes.class.split(" ").reduce((_,x)=>(x===qn.replacementClass||x.match(s)?_.toSvg.push(x):_.toNode.push(x),_),{toNode:[],toSvg:[]});r[0].attributes.class=d.toSvg.join(" "),d.toNode.length===0?e.removeAttribute("class"):e.setAttribute("class",d.toNode.join(" "))}const c=r.map(d=>Eb(d)).join(`
`);e.setAttribute(Gm,""),e.innerHTML=c}};function I$(t){t()}function XZ(t,e){const r=typeof e=="function"?e:OE;if(t.length===0)r();else{let s=I$;qn.mutateApproach===sEe&&(s=jf.requestAnimationFrame||I$),s(()=>{const c=XEe(),d=nL.begin("mutate");t.map(c),d(),r()})}}let rL=!1;function KZ(){rL=!0}function _4(){rL=!1}let nI=null;function C$(t){if(!m$||!qn.observeMutations)return;const{treeCallback:e=OE,nodeCallback:r=OE,pseudoElementsCallback:s=OE,observeMutationsRoot:c=es}=t;nI=new m$(d=>{if(rL)return;const _=Uf();o0(d).forEach(x=>{if(x.type==="childList"&&x.addedNodes.length>0&&!S$(x.addedNodes[0])&&(qn.searchPseudoElements&&s(x.target),e(x.target)),x.type==="attributes"&&x.target.parentNode&&qn.searchPseudoElements&&s(x.target.parentNode),x.type==="attributes"&&S$(x.target)&&~hEe.indexOf(x.attributeName))if(x.attributeName==="class"&&HEe(x.target)){const{prefix:a,iconName:I}=sA(K5(x.target));x.target.setAttribute(Z5,a||_),I&&x.target.setAttribute(X5,I)}else ZEe(x.target)&&r(x.target)})}),od&&nI.observe(c,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}function JEe(){nI&&nI.disconnect()}function eSe(t){const e=t.getAttribute("style");let r=[];return e&&(r=e.split(";").reduce((s,c)=>{const d=c.split(":"),_=d[0],x=d.slice(1);return _&&x.length>0&&(s[_]=x.join(":").trim()),s},{})),r}function tSe(t){const e=t.getAttribute("data-prefix"),r=t.getAttribute("data-icon"),s=t.innerText!==void 0?t.innerText.trim():"";let c=sA(K5(t));return c.prefix||(c.prefix=Uf()),e&&r&&(c.prefix=e,c.iconName=r),c.iconName&&c.prefix||(c.prefix&&s.length>0&&(c.iconName=MEe(c.prefix,t.innerText)||J5(c.prefix,u4(t.innerText))),!c.iconName&&qn.autoFetchSvg&&t.firstChild&&t.firstChild.nodeType===Node.TEXT_NODE&&(c.iconName=t.firstChild.data)),c}function nSe(t){const e=o0(t.attributes).reduce((c,d)=>(c.name!=="class"&&c.name!=="style"&&(c[d.name]=d.value),c),{}),r=t.getAttribute("title"),s=t.getAttribute("data-fa-title-id");return qn.autoA11y&&(r?e["aria-labelledby"]="".concat(qn.replacementClass,"-title-").concat(s||Bx()):(e["aria-hidden"]="true",e.focusable="false")),e}function rSe(){return{iconName:null,title:null,titleId:null,prefix:null,transform:ku,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function A$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0};const{iconName:r,prefix:s,rest:c}=tSe(t),d=nSe(t),_=d4("parseNodeAttributes",{},t);let x=e.styleParser?eSe(t):[];return{iconName:r,title:t.getAttribute("title"),titleId:t.getAttribute("data-fa-title-id"),prefix:s,transform:ku,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:c,styles:x,attributes:d},..._}}const{styles:iSe}=Ou;function QZ(t){const e=qn.autoReplaceSvg==="nest"?A$(t,{styleParser:!1}):A$(t);return~e.extra.classes.indexOf(OZ)?Vf("generateLayersText",t,e):Vf("generateSvgReplacementMutation",t,e)}let qu=new Set;MZ.map(t=>{qu.add("fa-".concat(t))});Object.keys(Em[ds]).map(qu.add.bind(qu));Object.keys(Em[gl]).map(qu.add.bind(qu));Object.keys(Em[_l]).map(qu.add.bind(qu));qu=[...qu];function P$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!od)return Promise.resolve();const r=es.documentElement.classList,s=M=>r.add("".concat(y$,"-").concat(M)),c=M=>r.remove("".concat(y$,"-").concat(M)),d=qn.autoFetchSvg?qu:MZ.map(M=>"fa-".concat(M)).concat(Object.keys(iSe));d.includes("fa")||d.push("fa");const _=[".".concat(OZ,":not([").concat(Gm,"])")].concat(d.map(M=>".".concat(M,":not([").concat(Gm,"])"))).join(", ");if(_.length===0)return Promise.resolve();let x=[];try{x=o0(t.querySelectorAll(_))}catch{}if(x.length>0)s("pending"),c("complete");else return Promise.resolve();const a=nL.begin("onTree"),I=x.reduce((M,D)=>{try{const L=QZ(D);L&&M.push(L)}catch(L){RZ||L.name==="MissingIcon"&&console.error(L)}return M},[]);return new Promise((M,D)=>{Promise.all(I).then(L=>{XZ(L,()=>{s("active"),s("complete"),c("pending"),typeof e=="function"&&e(),a(),M()})}).catch(L=>{a(),D(L)})})}function sSe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;QZ(t).then(r=>{r&&XZ([r],e)})}function oSe(t){return function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=(e||{}).icon?e:f4(e||{});let{mask:c}=r;return c&&(c=(c||{}).icon?c:f4(c||{})),t(s,{...r,mask:c})}}const aSe=function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=ku,symbol:s=!1,mask:c=null,maskId:d=null,title:_=null,titleId:x=null,classes:a=[],attributes:I={},styles:M={}}=e;if(!t)return;const{prefix:D,iconName:L,icon:G}=t;return oA({type:"icon",...t},()=>(Wm("beforeDOMElementCreation",{iconDefinition:t,params:e}),qn.autoA11y&&(_?I["aria-labelledby"]="".concat(qn.replacementClass,"-title-").concat(x||Bx()):(I["aria-hidden"]="true",I.focusable="false")),tL({icons:{main:p4(G),mask:c?p4(c.icon):{found:!1,width:null,height:null,icon:{}}},prefix:D,iconName:L,transform:{...ku,...r},symbol:s,title:_,maskId:d,titleId:x,extra:{attributes:I,styles:M,classes:a}})))};var lSe={mixout(){return{icon:oSe(aSe)}},hooks(){return{mutationObserverCallbacks(t){return t.treeCallback=P$,t.nodeCallback=sSe,t}}},provides(t){t.i2svg=function(e){const{node:r=es,callback:s=()=>{}}=e;return P$(r,s)},t.generateSvgReplacementMutation=function(e,r){const{iconName:s,title:c,titleId:d,prefix:_,transform:x,symbol:a,mask:I,maskId:M,extra:D}=r;return new Promise((L,G)=>{Promise.all([m4(s,_),I.iconName?m4(I.iconName,I.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(Q=>{let[re,ee]=Q;L([e,tL({icons:{main:re,mask:ee},prefix:_,iconName:s,transform:x,symbol:a,maskId:M,title:c,titleId:d,extra:D,watchable:!0})])}).catch(G)})},t.generateAbstractIcon=function(e){let{children:r,attributes:s,main:c,transform:d,styles:_}=e;const x=rA(_);x.length>0&&(s.style=x);let a;return Q5(d)&&(a=Vf("generateAbstractTransformGrouping",{main:c,transform:d,containerWidth:c.width,iconWidth:c.width})),r.push(a||c.icon),{children:r,attributes:s}}}},cSe={mixout(){return{layer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{classes:r=[]}=e;return oA({type:"layer"},()=>{Wm("beforeDOMElementCreation",{assembler:t,params:e});let s=[];return t(c=>{Array.isArray(c)?c.map(d=>{s=s.concat(d.abstract)}):s=s.concat(c.abstract)}),[{tag:"span",attributes:{class:["".concat(qn.cssPrefix,"-layers"),...r].join(" ")},children:s}]})}}}},uSe={mixout(){return{counter(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{title:r=null,classes:s=[],attributes:c={},styles:d={}}=e;return oA({type:"counter",content:t},()=>(Wm("beforeDOMElementCreation",{content:t,params:e}),$Ee({content:t.toString(),title:r,extra:{attributes:c,styles:d,classes:["".concat(qn.cssPrefix,"-layers-counter"),...s]}})))}}}},hSe={mixout(){return{text(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{transform:r=ku,title:s=null,classes:c=[],attributes:d={},styles:_={}}=e;return oA({type:"text",content:t},()=>(Wm("beforeDOMElementCreation",{content:t,params:e}),T$({content:t,transform:{...ku,...r},title:s,extra:{attributes:d,styles:_,classes:["".concat(qn.cssPrefix,"-layers-text"),...c]}})))}}},provides(t){t.generateLayersText=function(e,r){const{title:s,transform:c,extra:d}=r;let _=null,x=null;if(EZ){const a=parseInt(getComputedStyle(e).fontSize,10),I=e.getBoundingClientRect();_=I.width/a,x=I.height/a}return qn.autoA11y&&!s&&(d.attributes["aria-hidden"]="true"),Promise.resolve([e,T$({content:e.innerHTML,width:_,height:x,transform:c,title:s,extra:d,watchable:!0})])}}};const dSe=new RegExp('"',"ug"),R$=[1105920,1112319],M$={FontAwesome:{normal:"fas",400:"fas"},...HTe,...WTe,...tEe},y4=Object.keys(M$).reduce((t,e)=>(t[e.toLowerCase()]=M$[e],t),{}),fSe=Object.keys(y4).reduce((t,e)=>{const r=y4[e];return t[e]=r[900]||[...Object.entries(r)][0][1],t},{});function pSe(t){const e=t.replace(dSe,""),r=SEe(e,0),s=r>=R$[0]&&r<=R$[1],c=e.length===2?e[0]===e[1]:!1;return{value:u4(c?e[0]:e),isSecondary:s||c}}function mSe(t,e){const r=t.replace(/^['"]|['"]$/g,"").toLowerCase(),s=parseInt(e),c=isNaN(s)?"normal":s;return(y4[r]||{})[c]||fSe[r]}function k$(t,e){const r="".concat(iEe).concat(e.replace(":","-"));return new Promise((s,c)=>{if(t.getAttribute(r)!==null)return s();const _=o0(t.children).filter(L=>L.getAttribute(o4)===e)[0],x=jf.getComputedStyle(t,e),a=x.getPropertyValue("font-family"),I=a.match(cEe),M=x.getPropertyValue("font-weight"),D=x.getPropertyValue("content");if(_&&!I)return t.removeChild(_),s();if(I&&D!=="none"&&D!==""){const L=x.getPropertyValue("content");let G=mSe(a,M);const{value:Q,isSecondary:re}=pSe(L),ee=I[0].startsWith("FontAwesome");let U=J5(G,Q),H=U;if(ee){const Z=kEe(Q);Z.iconName&&Z.prefix&&(U=Z.iconName,G=Z.prefix)}if(U&&!re&&(!_||_.getAttribute(Z5)!==G||_.getAttribute(X5)!==H)){t.setAttribute(r,H),_&&t.removeChild(_);const Z=rSe(),{extra:de}=Z;de.attributes[o4]=e,m4(U,G).then(ve=>{const Ee=tL({...Z,icons:{main:ve,mask:eL()},prefix:G,iconName:H,extra:de,watchable:!0}),ie=es.createElementNS("http://www.w3.org/2000/svg","svg");e==="::before"?t.insertBefore(ie,t.firstChild):t.appendChild(ie),ie.outerHTML=Ee.map(ue=>Eb(ue)).join(`
`),t.removeAttribute(r),s()}).catch(c)}else s()}else s()})}function gSe(t){return Promise.all([k$(t,"::before"),k$(t,"::after")])}function _Se(t){return t.parentNode!==document.head&&!~oEe.indexOf(t.tagName.toUpperCase())&&!t.getAttribute(o4)&&(!t.parentNode||t.parentNode.tagName!=="svg")}function O$(t){if(od)return new Promise((e,r)=>{const s=o0(t.querySelectorAll("*")).filter(_Se).map(gSe),c=nL.begin("searchPseudoElements");KZ(),Promise.all(s).then(()=>{c(),_4(),e()}).catch(()=>{c(),_4(),r()})})}var ySe={hooks(){return{mutationObserverCallbacks(t){return t.pseudoElementsCallback=O$,t}}},provides(t){t.pseudoElements2svg=function(e){const{node:r=es}=e;qn.searchPseudoElements&&O$(r)}}};let D$=!1;var vSe={mixout(){return{dom:{unwatch(){KZ(),D$=!0}}}},hooks(){return{bootstrap(){C$(d4("mutationObserverCallbacks",{}))},noAuto(){JEe()},watch(t){const{observeMutationsRoot:e}=t;D$?_4():C$(d4("mutationObserverCallbacks",{observeMutationsRoot:e}))}}}};const L$=t=>{let e={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return t.toLowerCase().split(" ").reduce((r,s)=>{const c=s.toLowerCase().split("-"),d=c[0];let _=c.slice(1).join("-");if(d&&_==="h")return r.flipX=!0,r;if(d&&_==="v")return r.flipY=!0,r;if(_=parseFloat(_),isNaN(_))return r;switch(d){case"grow":r.size=r.size+_;break;case"shrink":r.size=r.size-_;break;case"left":r.x=r.x-_;break;case"right":r.x=r.x+_;break;case"up":r.y=r.y-_;break;case"down":r.y=r.y+_;break;case"rotate":r.rotate=r.rotate+_;break}return r},e)};var xSe={mixout(){return{parse:{transform:t=>L$(t)}}},hooks(){return{parseNodeAttributes(t,e){const r=e.getAttribute("data-fa-transform");return r&&(t.transform=L$(r)),t}}},provides(t){t.generateAbstractTransformGrouping=function(e){let{main:r,transform:s,containerWidth:c,iconWidth:d}=e;const _={transform:"translate(".concat(c/2," 256)")},x="translate(".concat(s.x*32,", ").concat(s.y*32,") "),a="scale(".concat(s.size/16*(s.flipX?-1:1),", ").concat(s.size/16*(s.flipY?-1:1),") "),I="rotate(".concat(s.rotate," 0 0)"),M={transform:"".concat(x," ").concat(a," ").concat(I)},D={transform:"translate(".concat(d/2*-1," -256)")},L={outer:_,inner:M,path:D};return{tag:"g",attributes:{...L.outer},children:[{tag:"g",attributes:{...L.inner},children:[{tag:r.icon.tag,children:r.icon.children,attributes:{...r.icon.attributes,...L.path}}]}]}}}};const $R={x:0,y:0,width:"100%",height:"100%"};function z$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return t.attributes&&(t.attributes.fill||e)&&(t.attributes.fill="black"),t}function bSe(t){return t.tag==="g"?t.children:[t]}var wSe={hooks(){return{parseNodeAttributes(t,e){const r=e.getAttribute("data-fa-mask"),s=r?sA(r.split(" ").map(c=>c.trim())):eL();return s.prefix||(s.prefix=Uf()),t.mask=s,t.maskId=e.getAttribute("data-fa-mask-id"),t}}},provides(t){t.generateAbstractMask=function(e){let{children:r,attributes:s,main:c,mask:d,maskId:_,transform:x}=e;const{width:a,icon:I}=c,{width:M,icon:D}=d,L=vEe({transform:x,containerWidth:M,iconWidth:a}),G={tag:"rect",attributes:{...$R,fill:"white"}},Q=I.children?{children:I.children.map(z$)}:{},re={tag:"g",attributes:{...L.inner},children:[z$({tag:I.tag,attributes:{...I.attributes,...L.path},...Q})]},ee={tag:"g",attributes:{...L.outer},children:[re]},U="mask-".concat(_||Bx()),H="clip-".concat(_||Bx()),Z={tag:"mask",attributes:{...$R,id:U,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"},children:[G,ee]},de={tag:"defs",children:[{tag:"clipPath",attributes:{id:H},children:bSe(D)},Z]};return r.push(de,{tag:"rect",attributes:{fill:"currentColor","clip-path":"url(#".concat(H,")"),mask:"url(#".concat(U,")"),...$R}}),{children:r,attributes:s}}}},TSe={provides(t){let e=!1;jf.matchMedia&&(e=jf.matchMedia("(prefers-reduced-motion: reduce)").matches),t.missingIconAbstract=function(){const r=[],s={fill:"currentColor"},c={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};r.push({tag:"path",attributes:{...s,d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}});const d={...c,attributeName:"opacity"},_={tag:"circle",attributes:{...s,cx:"256",cy:"364",r:"28"},children:[]};return e||_.children.push({tag:"animate",attributes:{...c,attributeName:"r",values:"28;14;28;28;14;28;"}},{tag:"animate",attributes:{...d,values:"1;0;1;1;0;1;"}}),r.push(_),r.push({tag:"path",attributes:{...s,opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"},children:e?[]:[{tag:"animate",attributes:{...d,values:"1;0;0;0;0;1;"}}]}),e||r.push({tag:"path",attributes:{...s,opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"},children:[{tag:"animate",attributes:{...d,values:"0;0;1;1;0;0;"}}]}),{tag:"g",attributes:{class:"missing"},children:r}}}},ESe={hooks(){return{parseNodeAttributes(t,e){const r=e.getAttribute("data-fa-symbol"),s=r===null?!1:r===""?!0:r;return t.symbol=s,t}}}},SSe=[wEe,lSe,cSe,uSe,hSe,ySe,vSe,xSe,wSe,TSe,ESe];zEe(SSe,{mixoutsTo:wl});wl.noAuto;wl.config;wl.library;wl.dom;const v4=wl.parse;wl.findIconDefinition;wl.toHtml;const ISe=wl.icon;wl.layer;wl.text;wl.counter;function N$(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),r.push.apply(r,s)}return r}function Cu(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?N$(Object(r),!0).forEach(function(s){K_(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):N$(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function rI(t){"@babel/helpers - typeof";return rI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rI(t)}function K_(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function CSe(t,e){if(t==null)return{};var r={},s=Object.keys(t),c,d;for(d=0;d<s.length;d++)c=s[d],!(e.indexOf(c)>=0)&&(r[c]=t[c]);return r}function ASe(t,e){if(t==null)return{};var r=CSe(t,e),s,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(t);for(c=0;c<d.length;c++)s=d[c],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(r[s]=t[s])}return r}function x4(t){return PSe(t)||RSe(t)||MSe(t)||kSe()}function PSe(t){if(Array.isArray(t))return b4(t)}function RSe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function MSe(t,e){if(t){if(typeof t=="string")return b4(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return b4(t,e)}}function b4(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,s=new Array(e);r<e;r++)s[r]=t[r];return s}function kSe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OSe(t){var e,r=t.beat,s=t.fade,c=t.beatFade,d=t.bounce,_=t.shake,x=t.flash,a=t.spin,I=t.spinPulse,M=t.spinReverse,D=t.pulse,L=t.fixedWidth,G=t.inverse,Q=t.border,re=t.listItem,ee=t.flip,U=t.size,H=t.rotation,Z=t.pull,de=(e={"fa-beat":r,"fa-fade":s,"fa-beat-fade":c,"fa-bounce":d,"fa-shake":_,"fa-flash":x,"fa-spin":a,"fa-spin-reverse":M,"fa-spin-pulse":I,"fa-pulse":D,"fa-fw":L,"fa-inverse":G,"fa-border":Q,"fa-li":re,"fa-flip":ee===!0,"fa-flip-horizontal":ee==="horizontal"||ee==="both","fa-flip-vertical":ee==="vertical"||ee==="both"},K_(e,"fa-".concat(U),typeof U<"u"&&U!==null),K_(e,"fa-rotate-".concat(H),typeof H<"u"&&H!==null&&H!==0),K_(e,"fa-pull-".concat(Z),typeof Z<"u"&&Z!==null),K_(e,"fa-swap-opacity",t.swapOpacity),e);return Object.keys(de).map(function(ve){return de[ve]?ve:null}).filter(function(ve){return ve})}function DSe(t){return t=t-0,t===t}function YZ(t){return DSe(t)?t:(t=t.replace(/[\-_\s]+(.)?/g,function(e,r){return r?r.toUpperCase():""}),t.substr(0,1).toLowerCase()+t.substr(1))}var LSe=["style"];function zSe(t){return t.charAt(0).toUpperCase()+t.slice(1)}function NSe(t){return t.split(";").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,r){var s=r.indexOf(":"),c=YZ(r.slice(0,s)),d=r.slice(s+1).trim();return c.startsWith("webkit")?e[zSe(c)]=d:e[c]=d,e},{})}function JZ(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof e=="string")return e;var s=(e.children||[]).map(function(a){return JZ(t,a)}),c=Object.keys(e.attributes||{}).reduce(function(a,I){var M=e.attributes[I];switch(I){case"class":a.attrs.className=M,delete e.attributes.class;break;case"style":a.attrs.style=NSe(M);break;default:I.indexOf("aria-")===0||I.indexOf("data-")===0?a.attrs[I.toLowerCase()]=M:a.attrs[YZ(I)]=M}return a},{attrs:{}}),d=r.style,_=d===void 0?{}:d,x=ASe(r,LSe);return c.attrs.style=Cu(Cu({},c.attrs.style),_),t.apply(void 0,[e.tag,Cu(Cu({},c.attrs),x)].concat(x4(s)))}var eX=!1;try{eX=!0}catch{}function FSe(){if(!eX&&console&&typeof console.error=="function"){var t;(t=console).error.apply(t,arguments)}}function F$(t){if(t&&rI(t)==="object"&&t.prefix&&t.iconName&&t.icon)return t;if(v4.icon)return v4.icon(t);if(t===null)return null;if(t&&rI(t)==="object"&&t.prefix&&t.iconName)return t;if(Array.isArray(t)&&t.length===2)return{prefix:t[0],iconName:t[1]};if(typeof t=="string")return{prefix:"fas",iconName:t}}function qR(t,e){return Array.isArray(e)&&e.length>0||!Array.isArray(e)&&e?K_({},t,e):{}}var B$={border:!1,className:"",mask:null,maskId:null,fixedWidth:!1,inverse:!1,flip:!1,icon:null,listItem:!1,pull:null,pulse:!1,rotation:null,size:null,spin:!1,spinPulse:!1,spinReverse:!1,beat:!1,fade:!1,beatFade:!1,bounce:!1,shake:!1,symbol:!1,title:"",titleId:null,transform:null,swapOpacity:!1},tX=Gr.forwardRef(function(t,e){var r=Cu(Cu({},B$),t),s=r.icon,c=r.mask,d=r.symbol,_=r.className,x=r.title,a=r.titleId,I=r.maskId,M=F$(s),D=qR("classes",[].concat(x4(OSe(r)),x4((_||"").split(" ")))),L=qR("transform",typeof r.transform=="string"?v4.transform(r.transform):r.transform),G=qR("mask",F$(c)),Q=ISe(M,Cu(Cu(Cu(Cu({},D),L),G),{},{symbol:d,title:x,titleId:a,maskId:I}));if(!Q)return FSe("Could not find icon",M),null;var re=Q.abstract,ee={ref:e};return Object.keys(r).forEach(function(U){B$.hasOwnProperty(U)||(ee[U]=r[U])}),BSe(re[0],ee)});tX.displayName="FontAwesomeIcon";tX.propTypes={beat:qr.bool,border:qr.bool,beatFade:qr.bool,bounce:qr.bool,className:qr.string,fade:qr.bool,flash:qr.bool,mask:qr.oneOfType([qr.object,qr.array,qr.string]),maskId:qr.string,fixedWidth:qr.bool,inverse:qr.bool,flip:qr.oneOf([!0,!1,"horizontal","vertical","both"]),icon:qr.oneOfType([qr.object,qr.array,qr.string]),listItem:qr.bool,pull:qr.oneOf(["right","left"]),pulse:qr.bool,rotation:qr.oneOf([0,90,180,270]),shake:qr.bool,size:qr.oneOf(["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"]),spin:qr.bool,spinPulse:qr.bool,spinReverse:qr.bool,symbol:qr.oneOfType([qr.bool,qr.string]),title:qr.string,titleId:qr.string,transform:qr.oneOfType([qr.string,qr.object]),swapOpacity:qr.bool};var BSe=JZ.bind(null,Gr.createElement);const jSe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M414-46q-32%200-55-20.5T332-118l-9-67q-5-2-10-5l-10-6-61%2026q-29%2012-59%202.5T137-205L71-322q-16-27-9.5-57.5T93-429l52-40v-22l-52-39q-26-19-32-49.5T71-638l66-116q16-27%2045.5-37t58.5%202l64%2026q5-3%209-5.5t9-4.5l9-68q4-32%2027-52.5t55-20.5h132q32%200%2055%2020.5t27%2052.5l9%2068q5%202%2010%204.5t10%205.5l61-26q29-12%2059-2t46%2037l66%20116q16%2028%2010%2058.5T867-530l-53%2039v11q0%203-.5%205.5t-.5%205.5l53%2039q26%2019%2032%2049.5T888-322l-67%20117q-16%2027-45.5%2037t-58.5-2l-62-26q-5%203-9%206t-9%205l-9%2067q-4%2031-27%2051.5T546-46H414Zm37-126h56l15-104q32-8%2061-24t51-42l98%2041%2027-50-83-63q5-16%208-32.5t3-33.5q0-17-3-33.5t-8-32.5l85-63-29-50-97%2042q-22-26-51-43t-62-24l-13-104h-58l-12%20103q-34%207-63.5%2024T323-618l-96-41-28%2050%2082%2061q-5%2017-8%2033.5t-3%2034.5q0%2017%203%2034t8%2034l-82%2061%2028%2050%2096-41q23%2025%2053%2042t63%2025l12%20103Zm28-168q58%200%2099-41t41-99q0-58-41-99t-99-41q-58%200-99%2041t-41%2099q0%2058%2041%2099t99%2041Zm1-140Z'/%3e%3c/svg%3e",j$="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M202.63-202.87h57.24l374.74-374.74-56.76-57-375.22%20375.22v56.52Zm-45.26%2091q-19.15%200-32.33-13.17-13.17-13.18-13.17-32.33v-102.26q0-18.15%206.84-34.69%206.83-16.53%2019.51-29.2l501.17-500.41q12.48-11.72%2027.7-17.96%2015.21-6.24%2031.93-6.24%2016.48%200%2032.2%206.24%2015.71%206.24%2027.67%2018.72l65.28%2065.56q12.48%2011.72%2018.34%2027.56%205.86%2015.83%205.86%2031.79%200%2016.72-5.86%2032.05-5.86%2015.34-18.34%2027.82L324-138.22q-12.67%2012.68-29.21%2019.51-16.53%206.84-34.68%206.84H157.37Zm597.37-586.39-56.24-56.48%2056.24%2056.48Zm-148.89%2092.41-28-28.76%2056.76%2057-28.76-28.24Z'/%3e%3c/svg%3e",nX="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='m421-443-60-60q-17-17-42-17t-42%2017q-17%2017-16.5%2042t17.5%2042l98%2098q19.36%2019%2045.18%2019T466-321l211-211q17-17%2017-41.5T677-615q-17-17-42-17t-42%2017L421-443Zm59%20397q-91%200-169.99-34.08-78.98-34.09-137.41-92.52-58.43-58.43-92.52-137.41Q46-389%2046-480q0-91%2034.08-169.99%2034.09-78.98%2092.52-137.41%2058.43-58.43%20137.41-92.52Q389-914%20480-914q91%200%20169.99%2034.08%2078.98%2034.09%20137.41%2092.52%2058.43%2058.43%2092.52%20137.41Q914-571%20914-480q0%2091-34.08%20169.99-34.09%2078.98-92.52%20137.41-58.43%2058.43-137.41%2092.52Q571-46%20480-46Zm0-126q130%200%20219-89t89-219q0-130-89-219t-219-89q-130%200-219%2089t-89%20219q0%20130%2089%20219t219%2089Zm0-308Z'/%3e%3c/svg%3e",rX=({handleLogout:t,isNavExpanded:e})=>{const[r,s]=Y.useState("placeholder.jpg"),[c,d]=Y.useState("Default Name"),[_,x]=Y.useState("default_username"),[a,I]=Y.useState("Default Bio"),[M,D]=Y.useState(!1),[L,G]=Y.useState(!1),[Q,re]=Y.useState(null),[ee,U]=Y.useState([]);Y.useState(!1);const[H,Z]=Y.useState([]),[de,ve]=Y.useState(null),Ee=Y.useRef(null),{showNotification:ie}=wb();BTe();const ue=Km(),[K,ge]=Y.useState(window.innerWidth<768),[_e,Se]=Y.useState(window.innerHeight*.5),xe=[{img:"/education.png",value:"education"},{img:"/food.png",value:"food"},{img:"/games.png",value:"games"},{img:"/other.png",value:"other"}];Y.useEffect(()=>{const tt=()=>{ge(window.innerWidth<768)};return window.addEventListener("resize",tt),()=>window.removeEventListener("resize",tt)},[]),Y.useEffect(()=>{Wt.currentUser&&(wt(),ft(),Tt())},[]);const wt=async()=>{try{const tt=await uy(Wt.currentUser.uid);tt&&(d(tt.name||"Default Name"),x(tt.username||"default_username"),s(tt.profilePhoto||"placeholder.jpg"),I(tt.bio||"Default Bio"),G(tt.isPrivate||!1),U(tt.tags||[]))}catch(tt){console.error("Error fetching user data:",tt),ie("Failed to load user data","error")}},ft=async()=>{if(Wt.currentUser)try{const tt=co(vi(wn,"quests"),yi("uid","==",Wt.currentUser.uid),wx("createdAt","desc"),HD(5)),mt=(await _a(tt)).docs.map(Vt=>({id:Vt.id,...Vt.data()}));Z(mt)}catch(tt){console.error("Error fetching recent quests:",tt),ie("Failed to load recent quests","error")}},Tt=async()=>{if(Wt.currentUser)try{const tt=co(vi(wn,"quests"),yi("uid","==",Wt.currentUser.uid),yi("status","==","accepted")),Et=await _a(tt);if(Et.empty)ve(null);else{const mt=Et.docs[0].data();if(mt.targetUser){const Vt=await uy(mt.targetUser);ve({...mt,partnerName:(Vt==null?void 0:Vt.name)||"Unknown",partnerPhoto:(Vt==null?void 0:Vt.profilePhoto)||"placeholder.jpg",partnerUsername:(Vt==null?void 0:Vt.username)||"unknown_user"})}else ve(mt)}}catch(tt){console.error("Error fetching active quest:",tt),ie("Failed to load active quest","error")}},gt=async()=>{try{let tt=r;Q&&(tt=await lge(Q)),await Ak(Wt.currentUser.uid,{name:c,username:_,bio:a,profilePhoto:tt,tags:ee}),D(!1),re(null),ie("Profile updated successfully!","success")}catch(tt){console.error("Error updating profile:",tt),ie("Failed to update profile","error")}},at=tt=>{const Et=tt.target.files[0];Et&&(re(Et),s(URL.createObjectURL(Et)))},bt=()=>{M&&Ee.current.click()},Zt=async tt=>{const Et=ee.filter(mt=>mt!==tt);U(Et);try{await Ak(Wt.currentUser.uid,{tags:Et}),ie("Tag removed successfully","success")}catch(mt){console.error("Error removing tag:",mt),ie("Failed to remove tag","error")}};return bb(({movement:[,tt],down:Et,event:mt})=>{if(K){if(Et){const Vt=window.innerHeight*.5-tt;Se(Math.max(100,Math.min(Vt,window.innerHeight-60)))}mt.preventDefault()}},{delay:0,threshold:5}),vb({height:K?_e:"auto",config:{tension:300,friction:30}}),F.jsx(aA,{children:F.jsxs("div",{className:"prof-container",children:[F.jsxs("header",{children:[F.jsxs("div",{className:"prof",children:[F.jsxs("div",{className:"prof-picture",onClick:()=>M&&bt(),style:M?{cursor:"pointer"}:{},children:[M&&F.jsxs(F.Fragment,{children:[F.jsx("input",{type:"file",ref:Ee,onChange:at,style:{display:"none"}}),F.jsx(j$,{})]}),F.jsx("img",{src:r,alt:"ProfilePicture"})]}),F.jsx("div",{className:"prof-name-container",style:M?{gap:"4px"}:{},children:M?F.jsxs(F.Fragment,{children:[F.jsx("input",{type:"text",value:c,onChange:tt=>d(tt.target.value),className:"prof-input",placeholder:"Name"}),F.jsx("div",{children:F.jsx("input",{type:"text",value:_,onChange:tt=>x(tt.target.value),className:"prof-input",placeholder:"Username"})})]}):F.jsxs(F.Fragment,{children:[F.jsx("p",{className:"prof-name",children:c}),F.jsxs("p",{className:"prof-username",children:["@",_]})]})}),F.jsxs("div",{className:"prof-header-buttons",children:[M?F.jsx(nX,{onClick:gt}):F.jsx(j$,{onClick:()=>D(!0)}),F.jsx(jSe,{onClick:()=>ue("/home/settings")})]})]}),F.jsxs("div",{className:"prof-bio",children:[F.jsx("h3",{children:"Bio"}),M?F.jsx("textarea",{value:a,onChange:tt=>I(tt.target.value),className:"prof-bio-edit",placeholder:"Bio",maxLength:150}):F.jsx("p",{children:a})]})]}),F.jsxs("div",{className:"prof-body",children:[F.jsxs("div",{className:"profile-section",children:[F.jsx("h3",{className:"section-title",children:"Tags"}),F.jsx("div",{className:"tags-container",children:ee.map(tt=>{var Et;return F.jsxs("div",{className:"tag",children:[F.jsx("img",{src:((Et=xe.find(mt=>mt.value===tt))==null?void 0:Et.img)||"/other.png",alt:tt,className:"tag-icon"}),F.jsx("button",{onClick:()=>Zt(tt),children:"x"})]},tt)})})]}),F.jsxs("div",{className:"profile-section",children:[F.jsx("h3",{className:"section-title",children:"Active Quests"}),de?F.jsxs("div",{className:"quest-item",children:[F.jsxs("p",{children:['"',de.title,'" with']}),de.partnerName&&F.jsxs("div",{className:"quest-partner",children:[F.jsx("img",{src:de.partnerPhoto||"placeholder.jpg",alt:de.partnerName,className:"partner-photo"}),F.jsxs("p",{children:[de.partnerName," @",de.partnerUsername]})]})]}):F.jsx("p",{className:"section-empty-msg",children:"No quests ongoing. Ready to start a new adventure?"})]}),F.jsxs("div",{className:"profile-section",children:[F.jsx("h3",{className:"section-title",children:"Recent Quests"}),H.length>0?H.map(tt=>F.jsxs("div",{className:"quest-item",children:[F.jsx("p",{children:tt.title}),tt.targetUser&&F.jsxs("p",{children:["with"," ",typeof tt.targetUser=="string"?tt.targetUser:tt.targetUser.name||"Unknown User"]})]},tt.id)):F.jsx("p",{className:"section-empty-msg",children:"No recent quests. Time to explore!"})]})]})]})})},USe=Hu("div")({backgroundColor:"#000000",borderRadius:"20px",width:"90%",maxWidth:"500px",height:"90%",display:"flex",flexDirection:"column",overflow:"hidden"}),VSe=Hu("div")({position:"relative",width:"100%",height:"calc(100% - 150px)",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",backgroundColor:"#000000"}),$Se=Hu("img")({maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}),qSe=Hu("div")({position:"absolute",border:"2px solid white",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"}),GSe=Hu("div")({padding:"20px",backgroundColor:"#000000"}),WSe=Hu(Zxe)({display:"flex",justifyContent:"space-between",marginBottom:"20px"}),HSe=Hu(Gxe)({color:"white","&.Mui-checked":{color:"white"}}),ZSe=Hu(N1e)({"& .MuiFormControlLabel-label":{color:"white"}}),XSe=Hu("div")({display:"flex",justifyContent:"space-between"}),U$=Hu(Z_)({flex:1,margin:"0 5px",fontWeight:"bold",borderRadius:"25px",padding:"12px 0"}),GR=[{value:"standard",label:"Standard (2:3)",width:1e3,height:1500},{value:"square",label:"Square (1:1)",width:1e3,height:1e3},{value:"long",label:"Long (1:2.1)",width:1e3,height:2100}],KSe=({photoPreview:t,onUpload:e,onCancel:r})=>{const[s,c]=Y.useState("standard"),[d,_]=Y.useState({x:0,y:0}),[x,a]=Y.useState({width:0,height:0}),[I,M]=Y.useState({width:0,height:0}),D=Y.useRef(null),L=Y.useRef(null),G=Y.useRef(null);Y.useEffect(()=>{const U=new Image;U.onload=()=>{M({width:U.width,height:U.height})},U.src=t},[t]),Y.useEffect(()=>{Q()},[s,I]);const Q=()=>{if(D.current&&I.width&&I.height){const U=D.current.getBoundingClientRect(),H=GR.find(ie=>ie.value===s);U.width/U.height;const Z=I.width/I.height,de=H.width/H.height;let ve,Ee;de>Z?(ve=U.width,Ee=ve/de):(Ee=U.height,ve=Ee*de),a({width:ve,height:Ee}),_({x:(U.width-ve)/2,y:(U.height-Ee)/2})}},re=U=>{U.preventDefault();const H=U.clientX-d.x,Z=U.clientY-d.y,de=Ee=>{if(D.current&&G.current&&L.current){const ie=D.current.getBoundingClientRect(),ue=L.current.getBoundingClientRect();let K=Ee.clientX-H,ge=Ee.clientY-Z;K=Math.max(ue.left-ie.left,Math.min(K,ue.right-ie.left-x.width)),ge=Math.max(ue.top-ie.top,Math.min(ge,ue.bottom-ie.top-x.height)),_({x:K,y:ge})}},ve=()=>{document.removeEventListener("mousemove",de),document.removeEventListener("mouseup",ve)};document.addEventListener("mousemove",de),document.addEventListener("mouseup",ve)},ee=()=>{if(L.current&&G.current){const U=L.current.getBoundingClientRect(),H=G.current.getBoundingClientRect(),Z={x:(H.left-U.left)/U.width,y:(H.top-U.top)/U.height,width:H.width/U.width,height:H.height/U.height},de=GR.find(ve=>ve.value===s);e(Z,`${de.width}:${de.height}`)}};return F.jsxs(USe,{children:[F.jsxs(VSe,{ref:D,children:[F.jsx($Se,{ref:L,src:t,alt:"Preview"}),F.jsx(qSe,{ref:G,style:{width:`${x.width}px`,height:`${x.height}px`,left:`${d.x}px`,top:`${d.y}px`},onMouseDown:re})]}),F.jsxs(GSe,{children:[F.jsx(WSe,{row:!0,"aria-label":"aspect-ratio",name:"aspect-ratio",value:s,onChange:U=>c(U.target.value),children:GR.map(U=>F.jsx(ZSe,{value:U.value,control:F.jsx(HSe,{}),label:U.label},U.value))}),F.jsxs(XSe,{children:[F.jsx(U$,{onClick:ee,variant:"contained",color:"primary",children:"Done"}),F.jsx(U$,{onClick:r,variant:"outlined",children:"Cancel"})]})]})]})};function aA({children:t}){return F.jsxs("div",{className:"navigation-modal-container",children:[F.jsx(RI,{className:"navigation-modal-bg",to:"/home"}),F.jsx("div",{className:"navigation-modal",children:t})]})}const QSe=t=>{t.getLayer("route")&&t.removeLayer("route"),t.getSource("route")&&t.removeSource("route")},iX=({currentUserIds:t,map:e,setLockedUserId:r,lockedUserId:s,lockedUserData:c,isCreateQuestOpen:d,setIsCreateQuestOpen:_})=>{console.log("Quests component rendering"),Y.useState(!1);const[x,a]=Y.useState(""),[I,M]=Y.useState(""),[D,L]=Y.useState(""),[G,Q]=Y.useState([]),[re,ee]=Y.useState(""),[U,H]=Y.useState([]),[Z,de]=Y.useState(null),[ve,Ee]=Y.useState(!1),[ie,ue]=Y.useState(!1),[K,ge]=Y.useState(null),[_e,Se]=Y.useState(null),[xe,wt]=Y.useState(null),[ft,Tt]=Y.useState({acceptors:[],pendingAcceptors:[]}),[gt,at]=Y.useState(!1);Y.useState(null),Y.useState(!1);const[bt,Zt]=Y.useState([]),[tt,Et]=Y.useState("public"),[mt,Vt]=Y.useState(window.innerHeight*.5),{showNotification:Pt}=wb();Y.useEffect(()=>{(async()=>{try{const He=co(vi(wn,"users")),lt=jh(He,Ke=>{if(Ke.empty){console.error("No users found."),H([]);return}const st=Ke.docs.map(zt=>({id:zt.id,...zt.data()}));H(st)});return()=>lt()}catch(He){console.error("Error fetching users:",He)}})()},[]),Y.useEffect(()=>{Wt.currentUser&&(async()=>{try{const He=co(vi(wn,"quests"),yi("isPublic","==",!0)),lt=co(vi(wn,"quests"),yi("uid","==",Wt.currentUser.uid)),Ke=co(vi(wn,"quests"),yi("targetUser","==",Wt.currentUser.uid)),[st,zt,ln]=await Promise.all([_a(He),_a(lt),_a(Ke)]),Ht=st.docs.map(ir=>({id:ir.id,...ir.data()})),vn=zt.docs.map(ir=>({id:ir.id,...ir.data()})),Fn=await Promise.all(ln.docs.map(async ir=>{const Ci=ir.data(),is=await $i(Xn(wn,"users",Ci.uid)),An=is.exists()?is.data():{};return{id:ir.id,...Ci,senderName:An.name||"Unknown sender"}})),pr=[...Ht,...vn,...Fn],fi=new Map(pr.map(ir=>[ir.id,ir]));Q(Array.from(fi.values()))}catch(He){console.error("Error fetching quests:",He)}})()},[Wt.currentUser,Pt,U]),U.filter(ke=>ke.name.toLowerCase().includes(re.toLowerCase()));const pn=async()=>{if(Wt.currentUser){if(!K){console.error("Pending quest is null.");return}try{const ke=Xn(vi(wn,"quests"));if(K.isPublic)await wm(ke,{...K,id:ke.id,uid:Wt.currentUser.uid,acceptedBy:[],pendingAcceptors:[]});else{if(!K.targetUser){console.error("Target user is missing in the quest");return}const He=co(vi(wn,"quests"),yi("uid","==",Wt.currentUser.uid),yi("targetUser","==",K.targetUser),yi("title","==",K.title),yi("description","==",K.description),yi("isPublic","==",!1));if(!(await _a(He)).empty){Pt("A similar private quest already exists for this user.","info");return}await wm(ke,{...K,id:ke.id,uid:Wt.currentUser.uid,acceptedBy:[],pendingAcceptors:[]})}Pt("Quest created!","success"),ge(null),ue(!1),a(""),M(""),L(""),de(null),ee(""),Ee(!1)}catch(ke){console.error("Error creating quest:",ke),Pt("Failed to create quest.","error")}}},dn=async ke=>{if(Wt.currentUser)try{const He=Xn(wn,"quests",ke),Ke=(await $i(He)).data();if(!Ke.isPublic&&Ke.targetUser===Wt.currentUser.uid)await cy(He),Q(G.filter(st=>st.id!==ke)),Pt("Quest declined!","success");else if(Ke.isPublic)await us(He,{declinedBy:O1(Wt.currentUser.uid)}),Q(G.filter(st=>st.id!==ke)),Pt("Quest declined!","success");else{const st=Ke.acceptedBy.filter(zt=>zt!==Wt.currentUser.uid);await us(He,{acceptedBy:st}),Q(G.map(zt=>zt.id===ke?{...zt,acceptedBy:st}:zt)),Pt("Quest declined!","success")}}catch(He){console.error("Error declining quest:",He),Pt("Failed to decline quest.","error")}},yn=async ke=>{if(!Wt.currentUser){console.error("No authenticated user"),Pt("You must be logged in to accept quests.","error");return}if(!ke.id){console.error("Quest ID is missing"),Pt("Invalid quest. Please try again.","error");return}try{const He=Xn(wn,"quests",ke.id),lt=await $i(He);if(!lt.exists()){console.error("Quest does not exist"),Pt("This quest no longer exists.","error");return}let st={...lt.data(),status:ke.isPublic?"pending":"accepted"};ke.isPublic?st.pendingAcceptors=O1(Wt.currentUser.uid):st.acceptedBy=Wt.currentUser.uid;const zt=await $i(Xn(wn,"users",ke.uid)),ln=await $i(Xn(wn,"users",Wt.currentUser.uid));if(!zt.exists()||!ln.exists()){console.error("Sender or receiver data not found"),Pt("Unable to process quest. User data missing.","error");return}const Ht=zt.data(),vn=ln.data();if(!Ht.location||!vn.location?(console.error("Sender or receiver location missing"),Pt("Location data is missing. Unable to display route.","warning")):st.routeInfo={senderLocation:Ht.location,receiverLocation:vn.location},await us(He,st),Q(Fn=>Fn.map(pr=>pr.id===ke.id?st:pr)),ke.isPublic||(Zt(Fn=>[...Fn,st]),st.routeInfo&&e&&Mt(e,st.routeInfo.senderLocation,st.routeInfo.receiverLocation)),Pt("Quest accepted!","success"),ke.isPublic){const Fn=Xn(vi(wn,"notifications"));await wm(Fn,{type:"quest_accepted",questId:ke.id,recipientId:ke.uid,senderId:Wt.currentUser.uid,content:`${Wt.currentUser.displayName||"Someone"} has accepted your quest: ${ke.title}`,createdAt:new Date,read:!1})}}catch(He){console.error("Error accepting quest:",He),Pt("Failed to accept quest. Please try again.","error")}},Mt=Y.useCallback((ke,He)=>{if(!e||!e.loaded()){console.error("Map is not fully loaded");return}if(!ke||!He){console.error("Invalid locations for route display");return}const lt=`https://api.mapbox.com/directions/v5/mapbox/walking/${ke.longitude},${ke.latitude};${He.longitude},${He.latitude}?geometries=geojson&access_token=${qm.accessToken}`;fetch(lt).then(Ke=>Ke.json()).then(Ke=>{if(!Ke.routes||Ke.routes.length===0){console.error("No route found in the response");return}const st=Ke.routes[0].geometry;e.getSource("route")?e.getSource("route").setData(st):e.addLayer({id:"route",type:"line",source:{type:"geojson",data:st},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#00FFFF","line-width":5,"line-opacity":.75}});const zt=new qm.LngLatBounds().extend([ke.longitude,ke.latitude]).extend([He.longitude,He.latitude]);e.fitBounds(zt,{padding:50})}).catch(Ke=>{console.error("Error fetching or displaying route:",Ke)})},[e]);Y.useEffect(()=>{if(Wt.currentUser&&e){const ke=jh(co(vi(wn,"quests"),yi("status","in",["approved","accepted"]),yi("uid","==",Wt.currentUser.uid)),He=>{const lt=He.docs.map(Ke=>({id:Ke.id,...Ke.data()}));Zt(lt),lt.forEach(Ke=>{!Ke.isPublic&&Ke.routeInfo&&Mt(Ke.routeInfo.senderLocation,Ke.routeInfo.receiverLocation)})});return()=>ke()}},[Wt.currentUser,e,Mt]);const cn=async(ke,He)=>{if(console.log("Approving acceptor:",He),!He||!He.id){console.error("Selected acceptor is not defined or missing id."),Pt("Invalid acceptor data.","error");return}try{const lt=Xn(wn,"quests",ke),Ke=await $i(lt);if(!Ke.exists()){console.error("Quest document does not exist."),Pt("Quest not found.","error");return}const st=Ke.data(),zt={...st,pendingAcceptors:Ik(He.id),acceptedBy:O1(He.id),targetUser:He.id,status:"approved"};if(Wt.currentUser){const ln=Xn(wn,"users",Wt.currentUser.uid),Ht=Xn(wn,"users",He.id),[vn,Fn]=await Promise.all([$i(ln),$i(Ht)]);if(vn.exists()&&Fn.exists()){const pr=vn.data(),fi=Fn.data();pr.location&&fi.location&&(zt.routeInfo={senderLocation:pr.location,receiverLocation:fi.location})}}await us(lt,zt),Q(ln=>ln.map(Ht=>Ht.id===ke?{...Ht,...zt}:Ht)),Zt(ln=>[...ln,{...st,...zt,id:ke}]),zt.routeInfo&&e&&Mt(e,zt.routeInfo.senderLocation,zt.routeInfo.receiverLocation),Pt(`Quest approved for ${He.name}!`,"success"),at(!1)}catch(lt){console.error("Error approving acceptor:",lt),Pt("Failed to approve acceptor.","error")}},Yt=async ke=>{try{const He=Xn(wn,"quests",ke);await cy(He),Q(G.filter(lt=>lt.id!==ke)),Zt(bt.filter(lt=>lt.id!==ke)),e&&QSe(e),Pt("Quest completed and deleted!","success")}catch(He){console.error("Error completing quest:",He),Pt("Failed to complete quest.","error")}},Tn=async ke=>{try{const He=Xn(wn,"quests",ke);await cy(He),Q(G.filter(lt=>lt.id!==ke)),Pt("Quest canceled!","success")}catch(He){console.error("Error canceling quest:",He),Pt("Failed to cancel quest.","error")}},xr=async ke=>{try{const He=Xn(wn,"quests",ke.id),Ke=(await $i(He)).data(),st=Ke.acceptedBy||[],zt=Ke.pendingAcceptors||[],ln=await Promise.all(st.map(async vn=>{const Fn=await $i(Xn(wn,"users",vn));return{id:vn,...Fn.data()}})),Ht=await Promise.all(zt.map(async vn=>{const Fn=await $i(Xn(wn,"users",vn));return{id:vn,...Fn.data()}}));Tt({acceptors:ln,pendingAcceptors:Ht}),wt(ke),at(!0)}catch(He){console.error("Error fetching acceptors:",He),Pt("Failed to fetch acceptors.","error")}},On=G.filter(ke=>{var He,lt,Ke,st;return ke.isPublic?ke.uid===((He=Wt.currentUser)==null?void 0:He.uid)||ke.approvedUser===((lt=Wt.currentUser)==null?void 0:lt.uid):ke.targetUser===((Ke=Wt.currentUser)==null?void 0:Ke.uid)||ke.uid===((st=Wt.currentUser)==null?void 0:st.uid)}),fr=async(ke,He)=>{try{const lt=Xn(wn,"quests",ke.id);await us(lt,{acceptedBy:He.id,pendingAcceptors:[]}),Q(G.map(Ke=>Ke.id===ke.id?{...Ke,acceptedBy:He.id,pendingAcceptors:[]}:Ke)),Tt([]),Pt(`Quest assigned to ${He.name}!`,"success")}catch(lt){console.error("Error selecting acceptor:",lt),Pt("Failed to assign quest.","error")}},Lr=()=>{Se(null)},or=()=>{switch(tt){case"public":return F.jsxs("div",{className:"quests-column",children:[F.jsx("h3",{children:"Public Quests"}),On.filter(ke=>{var He;return ke.isPublic&&(!ke.declinedBy||!ke.declinedBy.includes((He=Wt.currentUser)==null?void 0:He.uid))}).length>0?On.filter(ke=>{var He;return ke.isPublic&&(!ke.declinedBy||!ke.declinedBy.includes((He=Wt.currentUser)==null?void 0:He.uid))}).map(ke=>{var Ke,st,zt,ln,Ht;const lt=(U.find(vn=>vn.id===ke.uid)||{}).name||"";return F.jsxs("div",{className:"quest-item",children:[F.jsxs("p",{children:[F.jsx("strong",{children:"Title:"})," ",ke.title]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Description:"})," ",ke.description]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Time Frame:"})," ",ke.timeFrame]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Sender:"})," ",lt]}),ke.isPublic&&((Ke=Wt.currentUser)==null?void 0:Ke.uid)!==ke.uid&&!(Array.isArray(ke.acceptedBy)&&ke.acceptedBy.includes((st=Wt.currentUser)==null?void 0:st.uid))&&!(Array.isArray(ke.pendingAcceptors)&&ke.pendingAcceptors.includes((zt=Wt.currentUser)==null?void 0:zt.uid))&&F.jsxs("div",{className:"quest-actions",children:[F.jsx("button",{className:"confirm-button",onClick:()=>yn(ke),children:"Accept"}),F.jsx("button",{className:"cancel-button",onClick:()=>dn(ke.id),children:"Decline"})]}),ke.uid===((ln=Wt.currentUser)==null?void 0:ln.uid)&&F.jsxs("div",{className:"quest-actions",children:[F.jsx("button",{className:"select-button",onClick:()=>xr(ke),children:"View Pending Acceptors"}),F.jsx("button",{className:"cancel-button",onClick:()=>Tn(ke.id),children:"Cancel Quest"})]}),Array.isArray(ke.acceptedBy)&&ke.acceptedBy.includes((Ht=Wt.currentUser)==null?void 0:Ht.uid)&&F.jsx("div",{className:"quest-actions",children:F.jsx("button",{className:"confirm-button",onClick:()=>Yt(ke.id),children:"Complete"})})]},ke.id)}):F.jsx("p",{children:"No public quests."})]});case"received":return F.jsxs("div",{className:"quests-column",children:[F.jsx("h3",{children:"Received Quests"}),G.filter(ke=>{var He;return ke.targetUser===((He=Wt.currentUser)==null?void 0:He.uid)&&!ke.isPublic}).length>0?G.filter(ke=>{var He;return ke.targetUser===((He=Wt.currentUser)==null?void 0:He.uid)&&!ke.isPublic}).map(ke=>{var zt,ln,Ht,vn;const lt=(U.find(Fn=>Fn.id===ke.uid)||{}).name||"",Ke=ke.targetUser===((zt=Wt.currentUser)==null?void 0:zt.uid),st=ke.uid===((ln=Wt.currentUser)==null?void 0:ln.uid);return F.jsxs("div",{className:"quest-item",children:[F.jsxs("p",{children:[F.jsx("strong",{children:"Title:"})," ",ke.title]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Description:"})," ",ke.description]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Time Frame:"})," ",ke.timeFrame]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Sender:"})," ",lt]}),Ke&&ke.status==="accepted"&&F.jsxs("div",{className:"quest-actions",children:[F.jsx("button",{className:"confirm-button",onClick:()=>Yt(ke.id),children:"Complete"}),F.jsx("button",{className:"cancel-button",onClick:()=>Tn(ke.id),children:"Cancel"})]}),Ke&&ke.status==="pending"&&F.jsxs("div",{className:"quest-actions",children:[F.jsx("button",{className:"confirm-button",onClick:()=>yn(ke),children:"Accept"}),F.jsx("button",{className:"cancel-button",onClick:()=>dn(ke.id),children:"Decline"})]}),st&&F.jsxs("p",{children:["Status: ",ke.status]}),ke.acceptedBy&&F.jsxs("div",{children:[F.jsxs("p",{children:[F.jsx("strong",{children:"Accepted By:"})," ",((Ht=U.find(Fn=>Fn.id===ke.acceptedBy))==null?void 0:Ht.name)||"Pending acceptance"]}),F.jsx("img",{src:((vn=U.find(Fn=>Fn.id===ke.acceptedBy))==null?void 0:vn.profilePhotoUrl)||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},ke.id)}):F.jsx("p",{children:"No received quests."})]});case"sent":return F.jsxs("div",{className:"quests-column",children:[F.jsx("h3",{children:"Sent Quests"}),G.filter(ke=>{var He;return ke.uid===((He=Wt.currentUser)==null?void 0:He.uid)&&!ke.isPublic}).length>0?G.filter(ke=>{var He;return ke.uid===((He=Wt.currentUser)==null?void 0:He.uid)&&!ke.isPublic}).map(ke=>{const He=U.find(st=>st.id===ke.acceptedBy)||{},lt=He.name||"",Ke=U.filter(st=>ke.pendingAcceptors&&ke.pendingAcceptors.includes(st.id));return F.jsxs("div",{className:"quest-item",children:[F.jsxs("p",{children:[F.jsx("strong",{children:"Title:"})," ",ke.title]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Description:"})," ",ke.description]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Time Frame:"})," ",ke.timeFrame]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Status:"})," ",ke.status]}),Ke.length>0&&F.jsxs("div",{children:[F.jsx("p",{children:F.jsx("strong",{children:"Pending Acceptors:"})}),F.jsx("ul",{children:Ke.map(st=>F.jsxs("li",{onClick:()=>fr(ke,st),children:[st.name,F.jsx("img",{src:st.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]},st.id))})]}),ke.acceptedBy&&F.jsxs("div",{children:[F.jsxs("p",{children:[F.jsx("strong",{children:"Accepted By:"})," ",lt]}),F.jsx("img",{src:He.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"})]})]},ke.id)}):F.jsx("p",{children:"No sent quests."})]});default:return null}},Yn=bb(({movement:[,ke],down:He})=>{if(He){const lt=window.innerHeight*.5-ke;Vt(Math.max(100,Math.min(lt,window.innerHeight-60)))}});return vb({height:mt,config:{tension:300,friction:30}}),F.jsx(aA,{children:F.jsxs("div",{className:"quests-page",children:[F.jsx("div",{className:"drag-handle",...Yn()}),F.jsx("div",{className:"quests-header",children:F.jsx("h2",{children:"Quests"})}),F.jsxs("div",{className:"tabs",children:[F.jsx("button",{className:`tab-button ${tt==="public"?"active":""}`,onClick:()=>Et("public"),children:"Public Quests"}),F.jsx("button",{className:`tab-button ${tt==="received"?"active":""}`,onClick:()=>Et("received"),children:"Received Quests"}),F.jsx("button",{className:`tab-button ${tt==="sent"?"active":""}`,onClick:()=>Et("sent"),children:"Sent Quests"})]}),or(),ie&&K&&F.jsx("div",{className:"modal-overlay",children:F.jsxs("div",{className:"modal confirmation-dialog",children:[F.jsx("h3",{children:"Confirm Quest Sending"}),F.jsx("p",{children:"Are you sure you want to send the quest with the following details?"}),F.jsxs("p",{children:[F.jsx("strong",{children:"Title:"})," ",K.title]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Description:"})," ",K.description]}),F.jsxs("p",{children:[F.jsx("strong",{children:"Time Frame:"})," ",K.timeFrame]}),F.jsxs("div",{className:"modal-actions",children:[F.jsx("button",{className:"confirm-button",onClick:pn,children:"Confirm"}),F.jsx("button",{className:"cancel-button",onClick:()=>ue(!1),children:"Cancel"})]})]})}),_e&&F.jsx("div",{className:"modal-overlay",children:F.jsxs("div",{className:"modal profile-popup",children:[F.jsx("button",{className:"close-button",onClick:Lr,children:"X"}),F.jsx("h3",{children:_e.name}),F.jsx("img",{src:_e.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"profile-pic"}),F.jsxs("p",{children:[F.jsx("strong",{children:"Bio:"})," ",_e.bio]})]})}),gt&&F.jsx("div",{className:"modal-overlay",children:F.jsxs("div",{className:"modal acceptors-modal",children:[F.jsx("h3",{children:"Accepted By"}),F.jsx("ul",{children:ft.acceptors.map((ke,He)=>F.jsx("li",{children:ke.name},He))}),F.jsx("h3",{children:"Pending Acceptors"}),F.jsx("ul",{children:ft.pendingAcceptors.map((ke,He)=>F.jsx("li",{onClick:()=>cn(xe.id,ke),className:"selectable-user",children:ke.name},He))}),F.jsx("button",{className:"close-button",onClick:()=>at(!1),children:"Close"})]})})]})})},YSe=({isOpen:t,quests:e,currentUserIds:r,map:s})=>F.jsx("div",{className:`quests-window ${t?"show-section":"hide-section"}`,children:F.jsx(iX,{quests:e,currentUserIds:r,map:s})}),sX={"--background-color":"rgb(33,33,35)","--text-color":"#ffffff","--accent-color":"#0a91ff","--nav-background":"#1a1a1a","--card-background":"#2c2c2c","--hover-color":"#3a3a3a","--border-color":"#333333"},oX={"--background-color":"#f5f5f5","--text-color":"#333333","--accent-color":"#3c68c6","--nav-background":"#ffffff","--card-background":"#ffffff","--hover-color":"#e0e0e0","--border-color":"#e0e0e0"},JSe="mapbox://styles/mapbox/dark-v10",eIe="mapbox://styles/mapbox/light-v10";function w4(t){for(let[e,r]of Object.entries(t))document.documentElement.style.setProperty(e,r)}function aX(t,e){t&&t.setStyle&&t.setStyle(e?eIe:JSe)}function lX(){const t=document.body.classList.toggle("light-mode");w4(t?oX:sX),localStorage.setItem("theme",t?"light":"dark");const r=window.currentMap;aX(r,t),window.dispatchEvent(new CustomEvent("themeChanged",{detail:{isLightMode:t}}))}function cX(){const e=localStorage.getItem("theme")==="light";e?(w4(oX),document.body.classList.add("light-mode")):w4(sX);const r=window.currentMap;aX(r,e)}function T4(){return document.body.classList.contains("light-mode")?"light":"dark"}const tIe="pk.eyJ1Ijoia3lpbTUwIiwiYSI6ImNsempkdjZibDAzM2MybXE4bDJmcnZ6ZGsifQ.-ie6lQO1TWYrL8c6h2W41g";qm.accessToken=tIe;const V$="mapbox://styles/kyim50/clzniqnmq009s01qgee0a13s0",$$="mapbox://styles/mapbox/light-v10",k_=({address:t,setAddress:e,setCurrentUserIds:r,setMap:s,activeSection:c,lockedUser:d,showAddressBar:_,isFullScreen:x})=>{const a=Y.useRef(null),I=Y.useRef(null),[M,D]=Y.useState(!1),[L,G]=Y.useState([]),Q=Y.useRef({}),re=Y.useCallback(()=>{if(!I.current){const ee=JSON.parse(localStorage.getItem("mapState")),U=T4();I.current=new qm.Map({container:a.current,style:U==="light"?$$:V$,center:(ee==null?void 0:ee.center)||[0,0],zoom:(ee==null?void 0:ee.zoom)||2,attributionControl:!1}),I.current.on("load",()=>{D(!0),s(I.current),window.currentMap=I.current}),I.current.on("moveend",()=>{const H=I.current.getCenter(),Z=I.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:H,zoom:Z}))})}},[s]);return Y.useEffect(()=>(re(),cX(),()=>{if(I.current){const ee=I.current.getCenter(),U=I.current.getZoom();localStorage.setItem("mapState",JSON.stringify({center:ee,zoom:U})),I.current.remove(),I.current=null,window.currentMap=null}}),[re]),Y.useEffect(()=>{const ee=U=>{const{isLightMode:H}=U.detail;I.current&&M&&I.current.setStyle(H?$$:V$)};return window.addEventListener("themeChanged",ee),()=>{window.removeEventListener("themeChanged",ee)}},[M]),Y.useEffect(()=>{let ee;return M&&I.current&&(zTe(I.current,e),ee=vZ(I.current,(U,H)=>{G(U),r(U),Q.current=H})),()=>{ee&&ee()}},[M,e,r]),Y.useEffect(()=>{if(I.current&&M){const ee=()=>{I.current.resize()};return ee(),window.addEventListener("resize",ee),()=>window.removeEventListener("resize",ee)}},[M,c,x]),Y.useEffect(()=>{I.current&&M&&d&&(r4(I.current,d),Object.keys(Q.current).forEach(ee=>{const H=Q.current[ee].getElement(),Z=H.querySelector(".lock-indicator");if(ee===d){if(!Z){const de=document.createElement("div");de.className="lock-indicator",H.appendChild(de)}}else Z&&H.removeChild(Z)}))},[M,d]),F.jsxs(F.Fragment,{children:[F.jsx("div",{ref:a,className:`map-placeholder ${x?"full-screen":""}`,style:{width:"100%",height:"100%"}}),_&&F.jsx("div",{className:"address-bar",id:"address-bar",children:t})]})},nIe=({activeSection:t,showSection:e,logo:r,title:s})=>{const c=[{id:"home",icon:"/home.png",label:"Feed"},{id:"profile",icon:"/user-avatar.png",label:"Profile"},{id:"connections",icon:"/happy.png",label:"Connections"},{id:"quests",icon:"/letter.png",label:"Quests"},{id:"privacy",icon:"/privacy1.png",label:"Privacy"}];return F.jsxs("div",{className:"nav-bar",children:[F.jsxs("div",{className:"nav-header",children:[F.jsx("img",{src:r,alt:"Quests Logo",className:"qlogo"}),F.jsx("span",{className:"nav-title",children:s})]}),F.jsx("nav",{children:c.map(d=>F.jsxs("button",{onClick:()=>e(d.id),className:`nav-button ${t===d.id?"active":""}`,children:[F.jsx("img",{src:d.icon,alt:d.label}),F.jsx("span",{children:d.label})]},d.id))})]})},WR="/assets/chatbubble-DDibP9i3.png",uX=({currentUserIds:t,map:e,setLockedUserId:r,lockedUserId:s,lockedUserData:c})=>{const[d,_]=Y.useState([]),[x,a]=Y.useState([]),[I,M]=Y.useState([]),[D,L]=Y.useState(null),[G,Q]=Y.useState(""),[re,ee]=Y.useState(""),[U,H]=Y.useState(null),[Z,de]=Y.useState([]),[ve,Ee]=Y.useState(""),[ie,ue]=Y.useState([]),[K,ge]=Y.useState(!1),[_e,Se]=Y.useState(null),[xe,wt]=Y.useState(null),[ft,Tt]=Y.useState("friends"),[gt,at]=Y.useState(window.innerHeight*.5),bt=Y.useCallback(async()=>{if(!Wt.currentUser){console.error("User is not authenticated");return}const ke=vi(wn,"users"),He=co(ke,yi("isActive","==",!0)),Ke=(await _a(He)).docs.map(st=>({id:st.id,...st.data()})).filter(st=>st.id!==Wt.currentUser.uid&&!x.some(zt=>zt.id===st.id)&&t.includes(st.id));_(Ke)},[x,t]),Zt=Y.useCallback(async()=>{if(!Wt.currentUser){console.error("User is not authenticated");return}try{const ke=Xn(wn,"users",Wt.currentUser.uid),lt=(await $i(ke)).data(),Ke=(lt==null?void 0:lt.friends)||[],st=await Promise.all(Ke.map(async zt=>{const ln=Xn(wn,"users",zt),Ht=await $i(ln);return{id:zt,...Ht.data()}}));a(st)}catch(ke){console.error("Error fetching friends:",ke)}},[]);Y.useEffect(()=>{if(!Wt.currentUser){console.error("User is not authenticated");return}const ke=jh(vi(wn,"friend_requests"),async He=>{const lt=He.docs.map(Ht=>({id:Ht.id,...Ht.data()})),Ke=lt.filter(Ht=>Ht.status==="pending"&&Ht.receiverId===Wt.currentUser.uid),zt=lt.filter(Ht=>Ht.status==="accepted"&&(Ht.senderId===Wt.currentUser.uid||Ht.receiverId===Wt.currentUser.uid)).map(Ht=>Ht.senderId===Wt.currentUser.uid?Ht.receiverId:Ht.senderId);Zt().then(()=>{a(Ht=>Ht.filter(vn=>zt.includes(vn.id)))});const ln=await Promise.all(Ke.map(async Ht=>{const vn=Xn(wn,"users",Ht.senderId),pr=(await $i(vn)).data();return{id:Ht.id,senderId:Ht.senderId,senderName:(pr==null?void 0:pr.name)||"User",senderPhoto:(pr==null?void 0:pr.profilePhoto)||"default_photo_url"}}));M(ln),bt()});return Zt(),()=>ke()},[bt,Zt]);const tt=async ke=>{if(console.log("Attempting to send friend request to:",ke),!ke){console.error("Receiver ID is undefined.");return}try{const He=co(vi(wn,"friend_requests"),yi("senderId","==",Wt.currentUser.uid),yi("receiverId","==",ke),yi("status","==","pending"));if(!(await _a(He)).empty){console.log("Friend request already exists"),ee("Friend request already exists!");return}await Tx(vi(wn,"friend_requests"),{senderId:Wt.currentUser.uid,senderName:Wt.currentUser.displayName,senderPhoto:Wt.currentUser.photoURL,receiverId:ke,status:"pending",timestamp:OS()}),ee("Friend request sent!")}catch(He){console.error("Error sending friend request:",He)}},Et=async(ke,He)=>{try{await us(Xn(wn,"friend_requests",ke),{status:"accepted"}),await us(Xn(wn,"users",Wt.currentUser.uid),{friends:O1(He)}),await us(Xn(wn,"users",He),{friends:O1(Wt.currentUser.uid)}),ee("Friend request accepted!"),Zt()}catch(lt){console.error("Error accepting friend request:",lt)}},mt=async ke=>{try{await cy(Xn(wn,"friend_requests",ke)),ee("Friend request declined!")}catch(He){console.error("Error declining friend request:",He)}},Vt=async ke=>{try{await us(Xn(wn,"users",Wt.currentUser.uid),{friends:Ik(ke)}),await us(Xn(wn,"users",ke),{friends:Ik(Wt.currentUser.uid)}),a(He=>He.filter(lt=>lt.id!==ke)),ee("Friend removed!")}catch(He){console.error("Error removing friend:",He)}},Pt=async ke=>{if(xe===ke.id)wt(null),e&&Wt.currentUser&&(r4(e,Wt.currentUser.uid),setTimeout(()=>e.resize(),300));else{wt(ke.id);const lt=(await $i(Xn(wn,"users",ke.id))).data();lt&&lt.location&&e&&(r4(e,ke.id),setTimeout(()=>e.resize(),300))}},pn=()=>{L(null)},dn=ke=>{Q(ke.target.value)},yn=ke=>{H(ke),Yt(ke.id),cn(ke)},Mt=()=>{H(null),de([])},cn=ke=>{ue(He=>{const lt=He.filter(Ke=>Ke.id!==ke.id);return[ke,...lt]})},Yt=async ke=>{if(!Wt.currentUser){console.error("User is not authenticated");return}const He=vi(wn,"messages"),lt=co(He,yi("senderId","in",[Wt.currentUser.uid,ke]),yi("receiverId","in",[Wt.currentUser.uid,ke]),wx("timestamp","desc"),HD(20)),st=(await _a(lt)).docs.map(zt=>({id:zt.id,...zt.data()})).reverse();de(st)},Tn=async()=>{if(ve.trim())try{await Tx(vi(wn,"messages"),{senderId:Wt.currentUser.uid,receiverId:U.id,content:ve,timestamp:OS()}),Ee(""),cn(U)}catch(ke){console.error("Error sending message:",ke)}},xr=ke=>{Ee(ke.target.value),_e&&clearTimeout(_e),us(Xn(wn,"users",Wt.currentUser.uid),{isTyping:!0});const He=setTimeout(()=>{us(Xn(wn,"users",Wt.currentUser.uid),{isTyping:!1})},2e3);Se(He)};Y.useEffect(()=>{if(U){const ke=jh(co(vi(wn,"messages"),yi("senderId","in",[Wt.currentUser.uid,U.id]),yi("receiverId","in",[Wt.currentUser.uid,U.id]),wx("timestamp")),lt=>{const Ke=lt.docs.map(st=>({id:st.id,...st.data()}));de(Ke)}),He=jh(Xn(wn,"users",U.id),lt=>{const Ke=lt.data();Ke&&Ke.isTyping?ge(!0):ge(!1)});return()=>{ke(),He()}}},[U]);const On=d.filter(ke=>ke.name.toLowerCase().includes(G.toLowerCase())),fr=()=>{if(!xe)return null;const ke=d.find(He=>He.id===xe)||x.find(He=>He.id===xe);return ke?(x.some(He=>He.id===ke.id),F.jsxs("div",{className:"profile-container",children:[F.jsxs("div",{className:"profile-header",children:[F.jsx("div",{className:"profile-photo-container",children:F.jsx("img",{src:ke.profilePhoto,alt:"Profile",className:"profile-photo"})}),F.jsxs("div",{className:"profile-name-status",children:[F.jsx("h2",{className:"profile-name",children:ke.name}),F.jsxs("p",{className:"profile-status",children:[F.jsx("span",{className:"status-dot"})," Active"]})]})]}),F.jsxs("div",{className:"profile-section",children:[F.jsx("h3",{className:"section-title",children:"Bio"}),F.jsx("p",{className:"profile-bio",children:ke.bio||"No bio available"})]}),F.jsxs("div",{className:"profile-section",children:[F.jsx("h3",{className:"section-title",children:"Tags"}),F.jsx("div",{className:"tags-container",children:ke.tags&&ke.tags.map(He=>F.jsx("div",{className:"tag",children:He},He))})]}),F.jsxs("div",{className:"profile-actions",children:[F.jsx("button",{className:"add-friend-btn1",onClick:()=>tt(ke.id),children:"Add Friend"}),F.jsx("button",{className:"chat-btn2",onClick:()=>yn(ke),children:F.jsx("img",{src:WR,alt:"Chat",className:"icon-img"})})]}),F.jsx("button",{className:"unlock-btn1",onClick:()=>wt(null),children:"Unlock User"})]})):null},Lr=()=>{switch(ft){case"friends":return F.jsxs("div",{className:"friends-section",children:[F.jsx("h2",{children:"Friends"}),x.map(ke=>F.jsxs("div",{className:"friend-item1",onClick:()=>Pt(ke),children:[F.jsx("img",{src:ke.profilePhoto,alt:"Friend"}),F.jsx("div",{children:ke.name}),F.jsxs("div",{className:"button-group",children:[F.jsx("button",{className:"remove-friend-btn1",onClick:He=>{He.stopPropagation(),Vt(ke.id)},children:"Remove"}),F.jsx("button",{className:"chat-btn1",onClick:He=>{He.stopPropagation(),yn(ke)},children:F.jsx("img",{src:WR,alt:"Chat",className:"icon-img"})})]})]},ke.id))]});case"pending":return F.jsxs("div",{className:"pending-requests-section",children:[F.jsx("h2",{children:"Pending Requests"}),I.map(ke=>F.jsxs("div",{className:"pending-request",children:[F.jsx("img",{src:ke.senderPhoto,alt:"User"}),F.jsx("div",{children:ke.senderName}),F.jsxs("div",{className:"button-group",children:[F.jsx("button",{className:"accept-btn",onClick:()=>Et(ke.id,ke.senderId),children:"Accept"}),F.jsx("button",{className:"decline-btn",onClick:()=>mt(ke.id),children:"Decline"})]})]},ke.id))]});case"people":return F.jsxs("div",{className:"people-section",children:[F.jsx("h2",{children:"People"}),On.map(ke=>F.jsxs("div",{className:`people-item ${xe===ke.id?"locked":""}`,onClick:()=>Pt(ke),children:[F.jsx("img",{src:ke.profilePhoto,alt:"User"}),F.jsx("div",{children:ke.name}),F.jsxs("div",{className:"button-group",children:[F.jsx("button",{className:"add-friend-btn1",onClick:He=>{He.stopPropagation(),tt(ke.id)},children:"Add Friend"}),F.jsx("button",{className:"chat-btn1",onClick:He=>{He.stopPropagation(),yn(ke)},children:F.jsx("img",{src:WR,alt:"Chat",className:"icon-img"})})]})]},ke.id))]});case"recentChats":return F.jsxs("div",{className:"recent-chats-section",children:[F.jsx("h2",{children:"Recent Chats"}),ie.map(ke=>F.jsxs("div",{className:"chat-history-item",onClick:()=>yn(ke),children:[F.jsx("img",{src:ke.profilePhoto,alt:"Profile"}),F.jsx("div",{children:ke.name})]},ke.id))]});default:return null}},or=bb(({movement:[,ke],down:He})=>{if(He){const lt=window.innerHeight*.5-ke;at(Math.max(100,Math.min(lt,window.innerHeight-60)))}}),Yn=vb({height:gt,config:{tension:300,friction:30}});return F.jsx(aA,{children:F.jsxs("div",{className:`connections-container2 ${xe?"user-locked1":""}`,style:Yn,children:[F.jsx("div",{className:"drag-handle",...or()}),re&&F.jsx("div",{className:"notification1",children:re}),xe?fr():F.jsxs(F.Fragment,{children:[F.jsx("div",{className:"search-bar1",children:F.jsx("input",{type:"text",placeholder:"Search users...",value:G,onChange:dn})}),F.jsxs("div",{className:"connectionstabs",children:[F.jsx("button",{className:`tab-button-con ${ft==="friends"?"active1 selected":""}`,onClick:()=>Tt("friends"),children:"Friends"}),F.jsx("button",{className:`tab-button-con ${ft==="pending"?"active1 selected":""}`,onClick:()=>Tt("pending"),children:"Pending Requests"}),F.jsx("button",{className:`tab-button-con ${ft==="people"?"active1 selected":""}`,onClick:()=>Tt("people"),children:"People"}),F.jsx("button",{className:`tab-button-con ${ft==="recentChats"?"active1 selected":""}`,onClick:()=>Tt("recentChats"),children:"Recent Chats"})]}),Lr()]}),D&&F.jsxs("div",{className:"user-popup1",children:[F.jsx("button",{className:"close-popup1",onClick:pn,children:""}),F.jsx("img",{src:D.profilePhoto,alt:"Profile"}),F.jsx("div",{children:D.name}),F.jsx("div",{children:D.bio}),F.jsx("button",{className:"view-profile-btn1",onClick:()=>tt(D.id),children:"Add Friend"}),F.jsx("button",{className:"remove-friend-btn1",onClick:()=>Vt(D.id),children:"Remove"})]}),U&&F.jsxs("div",{className:"chat-container1",children:[F.jsxs("div",{className:"chat-header1",children:[F.jsx("button",{className:"back-btn1",onClick:Mt,children:""}),F.jsx("img",{src:U.profilePhoto,alt:"Profile"}),F.jsx("div",{children:U.name})]}),F.jsxs("div",{className:"chat-messages1",children:[Z.map(ke=>F.jsx("div",{className:`message1 ${ke.senderId===Wt.currentUser.uid?"sent1":"received1"}`,children:F.jsx("div",{children:ke.content})},ke.id)),K&&F.jsxs("div",{className:"typing-indicator1",children:[F.jsx("span",{}),F.jsx("span",{}),F.jsx("span",{})]})]}),F.jsxs("div",{className:"chat-input1",children:[F.jsx("input",{type:"text",placeholder:"Type a message...",value:ve,onChange:xr}),F.jsx("button",{onClick:Tn,children:F.jsx("img",{className:"sendchatimg",src:"sendchat.png",alt:"Send"})})]})]})]})})},rIe=()=>{const[t,e]=Y.useState({friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),[r,s]=Y.useState([]),[c,d]=Y.useState(""),[_,x]=Y.useState([]),[a,I]=Y.useState(window.innerHeight*.5);Y.useEffect(()=>{M()},[]);const M=async()=>{try{const H=(await $i(Xn(wn,"users",Wt.currentUser.uid))).data();e(H.privacySettings||{friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),s(H.customVisibilityList||[])}catch(U){console.error("Error fetching privacy settings:",U)}},D=async(U,H)=>{try{const Z={...t,[U]:H};e(Z),await us(Xn(wn,"users",Wt.currentUser.uid),{privacySettings:Z})}catch(Z){console.error("Error updating privacy setting:",Z)}},L=async U=>{if(d(U.target.value),U.target.value.length>2)try{const H=vi(wn,"users"),Z=co(H,yi("username",">=",U.target.value),yi("username","<=",U.target.value+"")),ve=(await _a(Z)).docs.map(Ee=>({id:Ee.id,...Ee.data()}));x(ve)}catch(H){console.error("Error searching users:",H)}else x([])},G=async U=>{if(U&&!r.some(H=>H.id===U.id)){const H=[...r,U];s(H),d(""),x([]);try{await us(Xn(wn,"users",Wt.currentUser.uid),{customVisibilityList:H})}catch(Z){console.error("Error updating custom list:",Z)}}},Q=async U=>{const H=r.filter(Z=>Z.id!==U);s(H);try{await us(Xn(wn,"users",Wt.currentUser.uid),{customVisibilityList:H})}catch(Z){console.error("Error updating custom list:",Z)}},re=bb(({movement:[,U],down:H})=>{if(H){const Z=window.innerHeight*.5-U;I(Math.max(100,Math.min(Z,window.innerHeight-60)))}}),ee=vb({height:a,config:{tension:300,friction:30}});return F.jsxs(nZ.div,{className:"privacy-container",style:ee,children:[F.jsx("div",{className:"drag-handle",...re()}),F.jsx("h2",{children:"Privacy Settings"}),F.jsxs("div",{className:"privacy-section",children:[F.jsx("h3",{className:"section-title1",children:"Location Visibility"}),F.jsxs("div",{className:"privacy-option",children:[F.jsxs("label",{className:"toggle-switch",children:[F.jsx("input",{type:"checkbox",checked:t.friendsCanSeeLocation,onChange:U=>D("friendsCanSeeLocation",U.target.checked)}),F.jsx("span",{className:"slider round"})]}),F.jsx("span",{children:"Friends can see my location in privacy mode"})]}),F.jsxs("div",{className:"privacy-option",children:[F.jsxs("label",{className:"toggle-switch",children:[F.jsx("input",{type:"checkbox",checked:t.quietMap,onChange:U=>D("quietMap",U.target.checked)}),F.jsx("span",{className:"slider round"})]}),F.jsx("span",{children:"Quiet Map (Hide my location from everyone)"})]}),F.jsxs("div",{className:"privacy-option",children:[F.jsxs("label",{className:"toggle-switch",children:[F.jsx("input",{type:"checkbox",checked:t.canSeeOtherMarkers,onChange:U=>D("canSeeOtherMarkers",U.target.checked)}),F.jsx("span",{className:"slider round"})]}),F.jsx("span",{children:"See other users' markers on the map"})]})]}),F.jsxs("div",{className:"privacy-section",children:[F.jsx("h3",{className:"section-title1",children:"Custom Visibility List"}),F.jsxs("div",{className:"privacy-option",children:[F.jsxs("label",{className:"toggle-switch",children:[F.jsx("input",{type:"checkbox",checked:t.useCustomVisibilityList,onChange:U=>D("useCustomVisibilityList",U.target.checked)}),F.jsx("span",{className:"slider round"})]}),F.jsx("span",{children:"Use Custom Visibility List"})]}),t.useCustomVisibilityList&&F.jsxs(F.Fragment,{children:[F.jsxs("div",{className:"search-user",children:[F.jsx("input",{type:"text",value:c,onChange:L,placeholder:"Search users..."}),F.jsx("div",{className:"search-results",children:_.map(U=>F.jsxs("div",{className:"search-result-item",onClick:()=>G(U),children:[F.jsx("img",{src:U.profilePhoto||"/default-profile.png",alt:U.username,className:"user-avatar"}),F.jsx("span",{children:U.username})]},U.id))})]}),F.jsx("div",{className:"custom-list",children:r.map(U=>F.jsxs("div",{className:"custom-list-item",children:[F.jsx("img",{src:U.profilePhoto||"/default-profile.png",alt:U.username,className:"user-avatar"}),F.jsx("span",{children:U.username}),F.jsx("button",{onClick:()=>Q(U.id),children:"Remove"})]},U.id))})]})]})]})},iIe="/assets/notification-bPXQTjjH.png",sIe="/assets/day-and-night-DlaE3U3y.png",q$=Gr.memo(({items:t,onItemClick:e})=>{const r=Y.useCallback(s=>{const c=s.split(":").map(Number);return c[0]===c[1]?"square":c[0]*3===c[1]*2?"standard":c[0]*21===c[1]*10?"long":"standard"},[]);return F.jsx("div",{className:"pin-container",children:t.map(s=>{const c=r(s.aspectRatio||"2:3");return F.jsxs("div",{className:"pin-item",children:[F.jsx("div",{className:`card-wrapper pin-${c}`,children:F.jsxs("div",{className:"card",onClick:()=>e(s),children:[F.jsx("div",{className:"card-image-container",children:F.jsx("img",{src:s.image,alt:s.caption||`Photo by ${s.user.name}`,className:"card-image"})}),F.jsx("div",{className:"card-content",children:s.caption&&F.jsx("p",{className:"card-caption",children:s.caption})})]})}),F.jsxs("div",{className:"card-user-info",children:[F.jsx("img",{src:s.user.profilePhoto||"/default-profile-image.jpg",alt:s.user.name,className:"card-user-avatar"}),F.jsx("span",{className:"card-username",children:s.user.name})]})]},s.id)})})}),oIe=Gr.memo(({selectedImage:t,comments:e,onClose:r,onAddComment:s,onDeletePost:c})=>{var a,I,M;const[d,_]=Y.useState(""),x=()=>{s(d),_("")};return F.jsx("div",{className:"image-preview-overlay",onClick:r,children:F.jsxs("div",{className:"image-preview-content",onClick:D=>D.stopPropagation(),children:[F.jsx("div",{className:"image-preview-main",children:F.jsx("img",{src:t==null?void 0:t.image,alt:"Preview",className:"preview-image"})}),F.jsxs("div",{className:"image-preview-sidebar",children:[F.jsxs("div",{className:"image-preview-header",children:[F.jsxs("div",{className:"user-info",children:[F.jsx("img",{src:((a=t==null?void 0:t.user)==null?void 0:a.profilePhoto)||"/default-profile-image.jpg",alt:"User",className:"user-avatar"}),F.jsx("span",{className:"username",children:((I=t==null?void 0:t.user)==null?void 0:I.name)||"Unknown User"})]}),F.jsx(IconButton,{onClick:r,className:"close-button",children:F.jsx(Close,{})})]}),F.jsx("div",{className:"quest-info",children:t!=null&&t.questTitle?F.jsx("p",{className:"quest-title",children:t.questTitle}):F.jsx("p",{className:"quest-break",children:"Taking a break from quests"})}),(t==null?void 0:t.caption)&&F.jsx("p",{className:"image-caption",children:t.caption}),F.jsx("div",{className:"comments-section",children:e.map(D=>F.jsxs("div",{className:"comment",children:[F.jsx("img",{src:D.userProfileImage||"/default-profile-image.jpg",alt:D.username,className:"comment-user-avatar"}),F.jsxs("div",{className:"comment-content",children:[F.jsx("strong",{children:D.username}),F.jsx("p",{children:D.text})]})]},D.id))}),F.jsx("div",{className:"add-comment",children:F.jsx(TextField,{value:d,onChange:D=>_(D.target.value),placeholder:"Add a comment...",fullWidth:!0,InputProps:{endAdornment:F.jsx(IconButton,{onClick:x,children:F.jsx(Send,{})})}})}),(t==null?void 0:t.userId)===((M=auth.currentUser)==null?void 0:M.uid)&&F.jsx(Button,{startIcon:F.jsx(Delete,{}),onClick:c,className:"delete-button",children:"Delete Post"})]})]})})}),aIe=({currentUser:t})=>Y.useMemo(()=>F.jsxs("div",{className:"profile-display",children:[F.jsx("div",{className:"profile-photo-container",children:F.jsx("img",{src:(t==null?void 0:t.profilePhoto)||"/default-profile-image.jpg",alt:(t==null?void 0:t.name)||"Profile",className:"profile-photo"})}),F.jsxs("div",{className:"profile-name-status",children:[F.jsx("h2",{className:"profile-name",children:(t==null?void 0:t.name)||"Loading..."}),F.jsxs("p",{className:"profile-status",children:[F.jsx("span",{className:"status-dot"}),"Active now"]})]})]}),[t]);Gr.memo(()=>{const[t,e]=Y.useState(""),[r,s]=Y.useState([]),[c,d]=Y.useState("Loading address..."),[_,x]=Y.useState(null),[a,I]=Y.useState(null),[M,D]=Y.useState(null);Y.useState(null);const[L,G]=Y.useState("environment"),[Q,re]=Y.useState(!1),[ee,U]=Y.useState(null),[H,Z]=Y.useState(!1),[de,ve]=Y.useState(null);Y.useState("medium"),Y.useState([]);const[Ee,ie]=Y.useState(!1),[ue,K]=Y.useState(null),[ge,_e]=Y.useState(""),[Se,xe]=Y.useState([]);Y.useState("");const[wt,ft]=Y.useState([]),[Tt,gt]=Y.useState(!0),[at,bt]=Y.useState(null),[Zt,tt]=Y.useState(!1),[Et,mt]=Y.useState([]),[Vt,Pt]=Y.useState(!0),[pn,dn]=Y.useState({width:1920,height:1080}),[yn,Mt]=Y.useState([]),[cn,Yt]=Y.useState(!1),[Tn,xr]=Y.useState(window.innerHeight*.5),[On,fr]=Y.useState(window.innerWidth<=768),Lr=Km(),{showNotification:or}=wb();Y.useRef(null);const Yn=Y.useCallback(async rn=>await uy(rn),[]);Y.useEffect(()=>{const rn=Wt.onAuthStateChanged(async er=>{if(er){const ti=await Yn(er.uid);ti?(bt({uid:er.uid,...ti}),U(ti),ke(er.uid),He(er.uid)):console.error("User document not found")}else bt(null),U(null),Mt([]),ft([]);gt(!1)});return()=>rn()},[Yn]),Y.useEffect(()=>{const rn=NTe(Lr);return()=>rn()},[Lr]),Y.useEffect(()=>{const rn=()=>{fr(window.innerWidth<=768)};return window.addEventListener("resize",rn),()=>window.removeEventListener("resize",rn)},[]),Y.useEffect(()=>{const rn=()=>{const er=window.innerWidth>=1024;dn(er?{width:3840,height:2160}:{width:1920,height:1080})};return rn(),window.addEventListener("resize",rn),()=>window.removeEventListener("resize",rn)},[]);const ke=Y.useCallback(async rn=>{const er=Xn(wn,"users",rn),ti=await $i(er);if(ti.exists()){const Ts=ti.data().friends||[],Es=await Promise.all(Ts.map(async Ls=>{const $s=Xn(wn,"users",Ls),Lo=await $i($s);if(Lo.exists()){const jr=Lo.data(),Wa=co(vi(wn,"quests"),yi("uid","==",Ls),yi("status","==","accepted")),ni=await _a(Wa);let xi="Idle",Tl=null;if(!ni.empty){const Ta=ni.docs[0].data();if(xi="On a quest",Ta.targetUser){const po=await $i(Xn(wn,"users",Ta.targetUser));po.exists()&&(Tl=po.data())}}return{id:Ls,name:jr.name,username:jr.username,profilePhoto:jr.profilePhoto,status:xi,questPartner:Tl}}return null}));Mt(Es.filter(Ls=>Ls!==null))}},[]),He=Y.useCallback(async rn=>{if(rn)try{const er=Xn(wn,"users",rn),ti=await $i(er);if(ti.exists()){const Ts=ti.data().friends||[],Es=vi(wn,"photos"),Ls=co(Es,yi("userId","in",[rn,...Ts]),wx("timestamp","desc")),$s=await _a(Ls),Lo=await Promise.all($s.docs.map(async jr=>{const Wa=jr.data(),ni=await uy(Wa.userId);return{id:jr.id,...Wa,username:(ni==null?void 0:ni.name)||"Unknown User",user:{name:(ni==null?void 0:ni.name)||"Unknown User",profilePhoto:(ni==null?void 0:ni.profilePhoto)||"/default-profile-image.jpg"}}}));ft(Lo)}}catch(er){console.error("Error fetching grid data:",er),or("Failed to load posts. Please try again.")}},[uy,or]),lt=Y.useCallback(rn=>{e(er=>{const ti=rn===er?"":rn;return Pt(ti===""||ti==="home"),Z(!1),ti})},[]),Ke=Y.useCallback(async rn=>{if(rn)try{const er=await Yn(rn);er?(I(rn),D({id:rn,...er}),e("connections"),_&&_.flyTo({center:[er.location.longitude,er.location.latitude],zoom:15})):console.error("No user found with ID:",rn)}catch(er){console.error("Error fetching user data:",er)}else if(I(null),D(null),_&&Wt.currentUser){const er=await Yn(Wt.currentUser.uid);_.flyTo({center:[er.location.longitude,er.location.latitude],zoom:15})}},[_,Yn]),st=Y.useCallback(rn=>{ve(rn),re(!1)},[]),zt=Y.useCallback(()=>{G(rn=>rn==="user"?"environment":"user")},[]),ln=Y.useCallback(()=>{re(rn=>!rn),Yt(rn=>!rn)},[]),Ht=Y.useCallback(()=>{Z(rn=>{const er=!rn;return!er&&_&&(ee!=null&&ee.location)&&_.flyTo({center:[ee.location.longitude,ee.location.latitude],zoom:15,duration:2e3}),er})},[_,ee]),vn=Y.useCallback(rn=>{K(rn),ie(er=>!er),rn&&Fn(rn.id)},[]),Fn=Y.useCallback(async rn=>{const er=vi(wn,"photos",rn,"comments"),ti=await _a(er),Mi=await Promise.all(ti.docs.map(async Ts=>{const Es=Ts.data(),Ls=await Yn(Es.userId);return{id:Ts.id,...Es,userProfileImage:Ls.profilePhoto}}));xe(Mi)},[Yn]),pr=Y.useCallback(async rn=>{if(rn.trim()&&ue){const er=await Tx(vi(wn,"photos",ue.id,"comments"),{text:rn,userId:Wt.currentUser.uid,username:Wt.currentUser.displayName,timestamp:new Date}),ti=await Yn(Wt.currentUser.uid);xe(Mi=>[...Mi,{id:er.id,text:rn,userId:Wt.currentUser.uid,username:Wt.currentUser.displayName,timestamp:new Date,userProfileImage:ti.profilePhoto}])}},[ue,Yn]),fi=Y.useCallback(async(rn,er,ti="")=>{if(Wt.currentUser&&de)try{const Mi=Xn(vi(wn,"photos")),Ts={id:Mi.id,userId:Wt.currentUser.uid,user:{name:Wt.currentUser.displayName||"Unknown User",profilePhoto:(at==null?void 0:at.profilePhoto)||null},image:de,aspectRatio:er,caption:ti,cropInfo:rn,timestamp:OS()};await wm(Mi,Ts),or("Photo uploaded successfully"),ve(null),_e(""),ft(Es=>[Ts,...Es]),He(Wt.currentUser.uid)}catch(Mi){console.error("Error uploading photo:",Mi),or("Failed to upload photo. Please try again.")}},[Wt.currentUser,de,at,or,He]),ir=Y.useCallback(async()=>{if(ue&&ue.userId===Wt.currentUser.uid)try{await cy(Xn(wn,"photos",ue.id)),ie(!1),ft(rn=>rn.filter(er=>er.id!==ue.id)),or("Post deleted successfully"),He(Wt.currentUser.uid)}catch(rn){console.error("Error deleting post:",rn),or("Failed to delete post. Please try again.")}},[ue,or,He]),Ci=Y.useCallback(()=>tt(rn=>!rn),[]),is=Y.useCallback(()=>mt([]),[]),An=bb(({movement:[,rn],down:er})=>{if(er&&On){const ti=window.innerHeight*.5-rn;xr(Math.max(100,Math.min(ti,window.innerHeight-60)))}}),ar=vb({height:Tn,config:{tension:300,friction:30}}),mn=Y.useCallback(()=>F.jsxs("div",{className:"home-content",children:[F.jsxs("div",{className:"top-bar-old",children:[F.jsx(aIe,{}),F.jsx("div",{className:"top-bar-old-center",children:F.jsx(bH,{className:"search-bar-home",placeholder:"Search...",variant:"outlined",fullWidth:!0,InputProps:{startAdornment:F.jsx(mm,{children:F.jsx(dbe,{})})}})}),F.jsxs("div",{className:"top-bar-old-right",children:[F.jsx(mm,{onClick:Ci,children:F.jsx(Wve,{badgeContent:Et.length,color:"primary",children:F.jsx("img",{src:iIe,alt:"Notifications",className:"top-bar-old-icon"})})}),F.jsx(mm,{onClick:lX,children:F.jsx("img",{src:sIe,alt:"Toggle Theme",className:"top-bar-old-icon"})})]})]}),F.jsx("div",{className:"section-container",children:F.jsx("div",{className:"friends-list2",children:yn.map(rn=>F.jsxs("div",{className:"friend-item",children:[F.jsx("div",{className:"friend-photo-container",children:F.jsx("img",{src:rn.profilePhoto||"/default-profile-image.jpg",alt:rn.name,className:"friend-photo"})}),F.jsxs("div",{className:"friend-info",children:[F.jsx("div",{className:"friend-name",children:rn.name}),F.jsxs("div",{className:"friend-username",children:["@",rn.username]}),F.jsxs("div",{className:`friend-status ${rn.status==="Idle"?"idle":"on-quest"}`,children:[rn.status,rn.status==="On a quest"&&rn.questPartner&&F.jsxs("span",{className:"quest-partner",children:["with ",F.jsx("img",{src:rn.questPartner.profilePhoto||"/default-profile-image.jpg",alt:rn.questPartner.name,className:"partner-photo"}),"@",rn.questPartner.username]})]})]})]},rn.id))})}),Zt&&F.jsxs("div",{className:"notifications-dropdown",children:[F.jsx("h3",{children:"Notifications"}),Et.map((rn,er)=>F.jsx("div",{className:"notification-item",children:rn},er)),F.jsx(Z_,{onClick:is,children:"Clear All"})]}),F.jsx("div",{className:"main-area",children:On?F.jsxs("div",{className:"mobile-layout",children:[F.jsx("div",{className:"full-map-container",children:F.jsx(k_,{address:c,setAddress:d,setCurrentUserIds:s,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!1,isFullScreen:!0})}),F.jsxs(nZ.div,{className:"draggable-container",style:ar,children:[F.jsx("div",{className:"drag-handle",...An()}),F.jsxs("div",{className:"mobile-content",children:[F.jsx("div",{className:"camera-button",onClick:ln,children:F.jsx(MV,{})}),F.jsxs("div",{className:"section-container",children:[F.jsx("h2",{className:"section-title3",children:"Feed"}),F.jsx(q$,{items:wt,onItemClick:vn})]})]})]})]}):F.jsxs(F.Fragment,{children:[F.jsx("div",{className:"grid-area",children:F.jsxs("div",{className:"section-container",children:[F.jsx("h2",{className:"section-title3",children:"Feed"}),F.jsx(q$,{items:wt,onItemClick:vn})]})}),F.jsx("div",{className:"side-area",children:F.jsxs("div",{className:"section-container",children:[F.jsx("h2",{className:"section-title",children:"Camera & Map"}),F.jsxs("div",{className:"camera-map-area",children:[cn?F.jsx(CameraComponent,{facingMode:L,toggleCamera:ln,handleCapture:st,handleFlipCamera:zt,isFullScreenCamera:cn,cameraResolution:pn}):F.jsxs("div",{className:"camera-placeholder",onClick:ln,children:[F.jsx(MV,{}),F.jsx("span",{children:"Open Camera"})]}),F.jsx("div",{className:"mini-map",onClick:Ht,children:F.jsx(k_,{address:c,setAddress:d,setCurrentUserIds:s,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!1,isFullScreen:!1})})]})]})})]})}),F.jsxs(Tbe,{children:[Ee&&F.jsx(oIe,{selectedImage:ue,comments:Se,onClose:()=>ie(!1),onAddComment:pr,onDeletePost:ir}),de&&F.jsx(KSe,{photoPreview:de,onUpload:fi,onCancel:()=>ve(null),currentUser:at})]})]}),[Q,L,ln,st,zt,Ht,c,t,a,Ee,ue,Se,pr,ir,de,fi,at,Et,Ci,is,pn,yn,wt,On,ar,An]),Js=Y.useCallback(()=>F.jsxs("div",{className:"full-map-container",children:[F.jsx(mm,{onClick:Ht,className:"back-button",children:F.jsx(wH,{})}),F.jsx(k_,{address:c,setAddress:d,setCurrentUserIds:s,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!0,isFullScreen:!0})]}),[Ht,c,t,a]),Ai=Y.useCallback(async()=>{try{await FTe(),or("Logged out successfully"),Lr("/login")}catch(rn){console.error("Logout failed:",rn),or("Logout failed. Please try again.")}},[or,Lr]),fo=Y.useCallback(()=>{const rn=Vt?mn():F.jsx("div",{className:`section-content ${On?"mobile-section":""}`,children:(()=>{switch(t){case"profile":return F.jsx(rX,{handleLogout:Ai});case"quests":return F.jsx(YSe,{currentUserIds:r,map:_});case"connections":return F.jsx(uX,{currentUserIds:r,map:_,setLockedUser:Ke,lockedUser:a,lockedUserData:M});case"privacy":return F.jsx(rIe,{});default:return null}})()});return On&&!Vt?F.jsxs("div",{className:"mobile-section-with-map",children:[F.jsx("div",{className:"mobile-map-container",children:F.jsx(k_,{address:c,setAddress:d,setCurrentUserIds:s,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!1,isFullScreen:!1})}),F.jsx("div",{className:"mobile-section-content",children:rn})]}):rn},[t,Vt,r,_,Ke,a,M,mn,Ai,On,c]),wa=Y.useCallback(()=>Vt?"home-active":t==="profile"||t==="privacy"?`${t}-active`:t==="connections"?a?"connections-locked-active":"connections-active":t?`${t}-active`:"",[t,a,Vt]);return Y.useEffect(()=>{Vt&&x(null)},[Vt]),F.jsxs("div",{className:`home-screen-container2 ${On?"mobile-view":""}`,children:[F.jsx(nIe,{activeSection:t,showSection:lt,logo:"Questslogo blue.png",title:"QUESTS"}),On&&F.jsx("nav",{className:"mobile-nav-bar-container",children:F.jsxs("nav",{className:"mobile-nav-bar",children:[F.jsx("a",{href:"#home",className:`mobile-nav-button ${t===""?"active":""}`,onClick:()=>lt(""),children:F.jsx("img",{src:"home.png",alt:"Home"})}),F.jsx("a",{href:"#profile",className:`mobile-nav-button ${t==="profile"?"active":""}`,onClick:()=>lt("profile"),children:F.jsx("img",{src:"user-avatar.png",alt:"Profile"})}),F.jsx("a",{href:"#connections",className:`mobile-nav-button ${t==="connections"?"active":""}`,onClick:()=>lt("connections"),children:F.jsx("img",{src:"happy.png",alt:"Connections"})}),F.jsx("a",{href:"#quests",className:`mobile-nav-button ${t==="quests"?"active":""}`,onClick:()=>lt("quests"),children:F.jsx("img",{src:"letter.png",alt:"Quests"})}),F.jsx("a",{href:"#privacy",className:`mobile-nav-button ${t==="privacy"?"active":""}`,onClick:()=>lt("privacy"),children:F.jsx("img",{src:"privacy1.png",alt:"Privacy"})})]})}),F.jsxs("div",{className:`main-content2 ${wa()}`,children:[H?Js():fo(),!Vt&&!H&&!On&&F.jsx("div",{className:"map-container2",children:F.jsx(k_,{address:c,setAddress:d,setCurrentUserIds:s,setMap:x,activeSection:t,lockedUser:a,showAddressBar:!0,isFullScreen:!1})})]})]})});const G$=()=>{const{notifications:t}=wb();return F.jsx("div",{className:"notification-container",children:t.map(e=>F.jsx("div",{className:`notification ${e.type} ${e.show?"show":"hide"}`,children:e.message},e.id))})};function lIe(){return F.jsxs("div",{className:"landing-page",children:[F.jsx("header",{className:"landing-header",children:F.jsx("img",{src:"Quests Logo.png",alt:"Quests Logo",className:"logo"})}),F.jsxs("main",{className:"landing-main",children:[F.jsxs("div",{className:"headline",children:["Connect ",F.jsx("span",{className:"Today",children:"Today"})]}),F.jsx("h1",{className:"mainheadline",children:"Promoting daily connections & making networking easier than ever"}),F.jsx("p",{className:"subtext",children:"Quests makes networking easy by encouraging you to connect with nearby individuals, helping you build meaningful relationships effortlessly and fostering stronger communities."}),F.jsx("button",{className:"login-button",onClick:()=>window.location.href="/login",children:"Get Started"})]}),F.jsxs("section",{className:"Functions",children:[F.jsx("h2",{className:"Functionsh1",children:"Functions"}),F.jsx("div",{className:"functions-container",children:[{icon:"profile_hover.png",title:"Create a profile",text:"Express yourself and give others insight to who you are by uploading a profile photo, creating a bio, showing your current status and more. You can choose to make your account public or private"},{icon:"connections_hover.png",title:"Make a friend",text:"You can search for existing users who you may know, add someone you went on a quest with as a friend, view your friend's profile and so much more."},{icon:"quest_hover.png",title:"Go on a quest",text:"Using built in map functions and interactive social features to allow you to create public or private quests which you can accept, decline, complete, and view current quests."},{icon:"privacy.png",title:"Privacy & Security",text:"We ensure you and your data are safe and sound. Once your account is private, you won't be seen by and can't see people nearby unless they are a friend. Additionally, there is an SOS feature that alerts nearby personnel that you are in danger or in need of help."},{icon:"history_hover.png",title:"History",text:"Keep track of previous quests and specific details of that quest such as the location, date, time and who you went on that quest with."},{icon:"feed.png",title:"Photo Feed",text:"Look at pictures from quests your friends are currently on and take pictures of your own. Like and leave a message on your friends' pictures."}].map((t,e)=>F.jsxs("div",{className:"function-box",children:[F.jsx("div",{className:"functionicon",children:F.jsx("img",{src:t.icon,alt:t.title})}),F.jsx("div",{className:"functionrectheader",children:t.title.split(" ").map((r,s)=>s===t.title.split(" ").length-1?F.jsx("span",{children:r},s):r+" ")}),F.jsx("div",{className:"functiontext",children:t.text})]},e))})]}),F.jsx("footer",{className:"landing-footer",children:F.jsx("p",{children:" 2024 Quests. All rights reserved."})})]})}var hX={exports:{}};(function(t,e){(function(r,s){t.exports=s(Y)})(typeof self<"u"?self:v8,function(r){return function(s){function c(_){if(d[_])return d[_].exports;var x=d[_]={i:_,l:!1,exports:{}};return s[_].call(x.exports,x,x.exports,c),x.l=!0,x.exports}var d={};return c.m=s,c.c=d,c.d=function(_,x,a){c.o(_,x)||Object.defineProperty(_,x,{configurable:!1,enumerable:!0,get:a})},c.n=function(_){var x=_&&_.__esModule?function(){return _.default}:function(){return _};return c.d(x,"a",x),x},c.o=function(_,x){return Object.prototype.hasOwnProperty.call(_,x)},c.p="",c(c.s=6)}([function(s,c,d){function _(_e,Se){return I(_e)||a(_e,Se)||x()}function x(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function a(_e,Se){var xe=[],wt=!0,ft=!1,Tt=void 0;try{for(var gt,at=_e[Symbol.iterator]();!(wt=(gt=at.next()).done)&&(xe.push(gt.value),!Se||xe.length!==Se);wt=!0);}catch(bt){ft=!0,Tt=bt}finally{try{wt||at.return==null||at.return()}finally{if(ft)throw Tt}}return xe}function I(_e){if(Array.isArray(_e))return _e}var M=d(1),D=d.n(M),L=d(7),G=d.n(L),Q=d(2),re=d(9),ee=d.n(re),U=d(10),H=d(5),Z=function(_e){return _e.query||Object(U.a)(_e)},de=function(_e){if(!_e)return null;var Se=Object.keys(_e);return Se.length===0?null:Se.reduce(function(xe,wt){return xe[Object(Q.a)(wt)]=_e[wt],xe},{})},ve=function(){var _e=D.a.useRef(!1);return D.a.useEffect(function(){_e.current=!0},[]),_e.current},Ee=function(_e){var Se=D.a.useContext(H.a),xe=function(){return de(_e)||de(Se)},wt=D.a.useState(xe),ft=_(wt,2),Tt=ft[0],gt=ft[1];return D.a.useEffect(function(){var at=xe();ee()(Tt,at)||gt(at)},[_e,Se]),Tt},ie=function(_e){var Se=function(){return Z(_e)},xe=D.a.useState(Se),wt=_(xe,2),ft=wt[0],Tt=wt[1];return D.a.useEffect(function(){var gt=Se();ft!==gt&&Tt(gt)},[_e]),ft},ue=function(_e,Se){var xe=function(){return G()(_e,Se||{},!!Se)},wt=D.a.useState(xe),ft=_(wt,2),Tt=ft[0],gt=ft[1],at=ve();return D.a.useEffect(function(){return at&&gt(xe()),function(){Tt.dispose()}},[_e,Se]),Tt},K=function(_e){var Se=D.a.useState(_e.matches),xe=_(Se,2),wt=xe[0],ft=xe[1];return D.a.useEffect(function(){var Tt=function(){ft(_e.matches)};return _e.addListener(Tt),Tt(),function(){_e.removeListener(Tt)}},[_e]),wt},ge=function(_e,Se,xe){var wt=Ee(Se),ft=ie(_e);if(!ft)throw new Error("Invalid or missing MediaQuery!");var Tt=ue(ft,wt),gt=K(Tt),at=ve();return D.a.useEffect(function(){at&&xe&&xe(gt)},[gt]),gt};c.a=ge},function(s,c){s.exports=r},function(s,c,d){function _(D){return"-"+D.toLowerCase()}function x(D){if(M.hasOwnProperty(D))return M[D];var L=D.replace(a,_);return M[D]=I.test(L)?"-"+L:L}var a=/[A-Z]/g,I=/^ms-/,M={};c.a=x},function(s,c,d){s.exports=d(13)},function(s,c,d){s.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(s,c,d){var _=d(1),x=d.n(_),a=x.a.createContext();c.a=a},function(s,c,d){Object.defineProperty(c,"__esModule",{value:!0});var _=d(0),x=d(17),a=d(5);d.d(c,"default",function(){return x.a}),d.d(c,"useMediaQuery",function(){return _.a}),d.d(c,"Context",function(){return a.a})},function(s,c,d){function _(M,D,L){function G(Z){H&&H.addListener(Z)}function Q(Z){H&&H.removeListener(Z)}function re(Z){U.matches=Z.matches,U.media=Z.media}function ee(){H&&H.removeListener(re)}var U=this;if(I&&!L){var H=I.call(window,M);this.matches=H.matches,this.media=H.media,H.addListener(re)}else this.matches=a(M,D),this.media=M;this.addListener=G,this.removeListener=Q,this.dispose=ee}function x(M,D,L){return new _(M,D,L)}var a=d(8).match,I=typeof window<"u"?window.matchMedia:null;s.exports=x},function(s,c,d){function _(ee,U){return x(ee).some(function(H){var Z=H.inverse,de=H.type==="all"||U.type===H.type;if(de&&Z||!de&&!Z)return!1;var ve=H.expressions.every(function(Ee){var ie=Ee.feature,ue=Ee.modifier,K=Ee.value,ge=U[ie];if(!ge)return!1;switch(ie){case"orientation":case"scan":return ge.toLowerCase()===K.toLowerCase();case"width":case"height":case"device-width":case"device-height":K=M(K),ge=M(ge);break;case"resolution":K=I(K),ge=I(ge);break;case"aspect-ratio":case"device-aspect-ratio":case"device-pixel-ratio":K=a(K),ge=a(ge);break;case"grid":case"color":case"color-index":case"monochrome":K=parseInt(K,10)||1,ge=parseInt(ge,10)||0}switch(ue){case"min":return ge>=K;case"max":return ge<=K;default:return ge===K}});return ve&&!Z||!ve&&Z})}function x(ee){return ee.split(",").map(function(U){U=U.trim();var H=U.match(D),Z=H[1],de=H[2],ve=H[3]||"",Ee={};return Ee.inverse=!!Z&&Z.toLowerCase()==="not",Ee.type=de?de.toLowerCase():"all",ve=ve.match(/\([^\)]+\)/g)||[],Ee.expressions=ve.map(function(ie){var ue=ie.match(L),K=ue[1].toLowerCase().match(G);return{modifier:K[1],feature:K[2],value:ue[2]}}),Ee})}function a(ee){var U,H=Number(ee);return H||(U=ee.match(/^(\d+)\s*\/\s*(\d+)$/),H=U[1]/U[2]),H}function I(ee){var U=parseFloat(ee);switch(String(ee).match(re)[1]){case"dpcm":return U/2.54;case"dppx":return 96*U;default:return U}}function M(ee){var U=parseFloat(ee);switch(String(ee).match(Q)[1]){case"em":case"rem":return 16*U;case"cm":return 96*U/2.54;case"mm":return 96*U/2.54/10;case"in":return 96*U;case"pt":return 72*U;case"pc":return 72*U/12;default:return U}}c.match=_,c.parse=x;var D=/(?:(only|not)?\s*([^\s\(\)]+)(?:\s*and)?\s*)?(.+)?/i,L=/\(\s*([^\s\:\)]+)\s*(?:\:\s*([^\s\)]+))?\s*\)/,G=/^(?:(min|max)-)?(.+)/,Q=/(em|rem|px|cm|mm|in|pt|pc)?$/,re=/(dpi|dpcm|dppx)?$/},function(s,c,d){function _(x,a){if(x===a)return!0;if(!x||!a)return!1;var I=Object.keys(x),M=Object.keys(a),D=I.length;if(M.length!==D)return!1;for(var L=0;L<D;L++){var G=I[L];if(x[G]!==a[G])return!1}return!0}s.exports=_},function(s,c,d){var _=d(2),x=d(11),a=function(D){return"not ".concat(D)},I=function(D,L){var G=Object(_.a)(D);return typeof L=="number"&&(L="".concat(L,"px")),L===!0?G:L===!1?a(G):"(".concat(G,": ").concat(L,")")},M=function(D){return D.join(" and ")};c.a=function(D){var L=[];return Object.keys(x.a.all).forEach(function(G){var Q=D[G];Q!=null&&L.push(I(G,Q))}),M(L)}},function(s,c,d){function _(ee,U){var H=Object.keys(ee);if(Object.getOwnPropertySymbols){var Z=Object.getOwnPropertySymbols(ee);U&&(Z=Z.filter(function(de){return Object.getOwnPropertyDescriptor(ee,de).enumerable})),H.push.apply(H,Z)}return H}function x(ee){for(var U=1;U<arguments.length;U++){var H=arguments[U]!=null?arguments[U]:{};U%2?_(H,!0).forEach(function(Z){a(ee,Z,H[Z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(H)):_(H).forEach(function(Z){Object.defineProperty(ee,Z,Object.getOwnPropertyDescriptor(H,Z))})}return ee}function a(ee,U,H){return U in ee?Object.defineProperty(ee,U,{value:H,enumerable:!0,configurable:!0,writable:!0}):ee[U]=H,ee}var I=d(12),M=d.n(I),D=M.a.oneOfType([M.a.string,M.a.number]),L={orientation:M.a.oneOf(["portrait","landscape"]),scan:M.a.oneOf(["progressive","interlace"]),aspectRatio:M.a.string,deviceAspectRatio:M.a.string,height:D,deviceHeight:D,width:D,deviceWidth:D,color:M.a.bool,colorIndex:M.a.bool,monochrome:M.a.bool,resolution:D},G=x({minAspectRatio:M.a.string,maxAspectRatio:M.a.string,minDeviceAspectRatio:M.a.string,maxDeviceAspectRatio:M.a.string,minHeight:D,maxHeight:D,minDeviceHeight:D,maxDeviceHeight:D,minWidth:D,maxWidth:D,minDeviceWidth:D,maxDeviceWidth:D,minColor:M.a.number,maxColor:M.a.number,minColorIndex:M.a.number,maxColorIndex:M.a.number,minMonochrome:M.a.number,maxMonochrome:M.a.number,minResolution:D,maxResolution:D},L),Q={all:M.a.bool,grid:M.a.bool,aural:M.a.bool,braille:M.a.bool,handheld:M.a.bool,print:M.a.bool,projection:M.a.bool,screen:M.a.bool,tty:M.a.bool,tv:M.a.bool,embossed:M.a.bool},re=x({},Q,{},G);L.type=Object.keys(Q),c.a={all:re,types:Q,matchers:L,features:G}},function(s,c,d){var _=d(3);s.exports=d(14)(_.isElement,!0)},function(s,c,d){(function(){function _(ke){return typeof ke=="string"||typeof ke=="function"||ke===ue||ke===wt||ke===ge||ke===K||ke===Tt||ke===gt||typeof ke=="object"&&ke!==null&&(ke.$$typeof===bt||ke.$$typeof===at||ke.$$typeof===_e||ke.$$typeof===Se||ke.$$typeof===ft||ke.$$typeof===Zt||ke.$$typeof===tt)}function x(ke){if(typeof ke=="object"&&ke!==null){var He=ke.$$typeof;switch(He){case Ee:var lt=ke.type;switch(lt){case xe:case wt:case ue:case ge:case K:case Tt:return lt;default:var Ke=lt&&lt.$$typeof;switch(Ke){case Se:case ft:case _e:return Ke;default:return He}}case bt:case at:case ie:return He}}}function a(ke){return Yn||(Yn=!0,Vt(!1,"The ReactIs.isAsyncMode() alias has been deprecated, and will be removed in React 17+. Update your code to use ReactIs.isConcurrentMode() instead. It has the exact same API.")),I(ke)||x(ke)===xe}function I(ke){return x(ke)===wt}function M(ke){return x(ke)===Se}function D(ke){return x(ke)===_e}function L(ke){return typeof ke=="object"&&ke!==null&&ke.$$typeof===Ee}function G(ke){return x(ke)===ft}function Q(ke){return x(ke)===ue}function re(ke){return x(ke)===bt}function ee(ke){return x(ke)===at}function U(ke){return x(ke)===ie}function H(ke){return x(ke)===ge}function Z(ke){return x(ke)===K}function de(ke){return x(ke)===Tt}Object.defineProperty(c,"__esModule",{value:!0});var ve=typeof Symbol=="function"&&Symbol.for,Ee=ve?Symbol.for("react.element"):60103,ie=ve?Symbol.for("react.portal"):60106,ue=ve?Symbol.for("react.fragment"):60107,K=ve?Symbol.for("react.strict_mode"):60108,ge=ve?Symbol.for("react.profiler"):60114,_e=ve?Symbol.for("react.provider"):60109,Se=ve?Symbol.for("react.context"):60110,xe=ve?Symbol.for("react.async_mode"):60111,wt=ve?Symbol.for("react.concurrent_mode"):60111,ft=ve?Symbol.for("react.forward_ref"):60112,Tt=ve?Symbol.for("react.suspense"):60113,gt=ve?Symbol.for("react.suspense_list"):60120,at=ve?Symbol.for("react.memo"):60115,bt=ve?Symbol.for("react.lazy"):60116,Zt=ve?Symbol.for("react.fundamental"):60117,tt=ve?Symbol.for("react.responder"):60118,Et=function(){},mt=function(ke){for(var He=arguments.length,lt=Array(He>1?He-1:0),Ke=1;Ke<He;Ke++)lt[Ke-1]=arguments[Ke];var st=0,zt="Warning: "+ke.replace(/%s/g,function(){return lt[st++]});typeof console<"u"&&console.warn(zt);try{throw new Error(zt)}catch{}};Et=function(ke,He){if(He===void 0)throw new Error("`lowPriorityWarning(condition, format, ...args)` requires a warning message argument");if(!ke){for(var lt=arguments.length,Ke=Array(lt>2?lt-2:0),st=2;st<lt;st++)Ke[st-2]=arguments[st];mt.apply(void 0,[He].concat(Ke))}};var Vt=Et,Pt=xe,pn=wt,dn=Se,yn=_e,Mt=Ee,cn=ft,Yt=ue,Tn=bt,xr=at,On=ie,fr=ge,Lr=K,or=Tt,Yn=!1;c.typeOf=x,c.AsyncMode=Pt,c.ConcurrentMode=pn,c.ContextConsumer=dn,c.ContextProvider=yn,c.Element=Mt,c.ForwardRef=cn,c.Fragment=Yt,c.Lazy=Tn,c.Memo=xr,c.Portal=On,c.Profiler=fr,c.StrictMode=Lr,c.Suspense=or,c.isValidElementType=_,c.isAsyncMode=a,c.isConcurrentMode=I,c.isContextConsumer=M,c.isContextProvider=D,c.isElement=L,c.isForwardRef=G,c.isFragment=Q,c.isLazy=re,c.isMemo=ee,c.isPortal=U,c.isProfiler=H,c.isStrictMode=Z,c.isSuspense=de})()},function(s,c,d){function _(){return null}var x=d(3),a=d(15),I=d(4),M=d(16),D=Function.call.bind(Object.prototype.hasOwnProperty),L=function(){};L=function(G){var Q="Warning: "+G;typeof console<"u"&&console.error(Q);try{throw new Error(Q)}catch{}},s.exports=function(G,Q){function re(tt){var Et=tt&&(gt&&tt[gt]||tt[at]);if(typeof Et=="function")return Et}function ee(tt,Et){return tt===Et?tt!==0||1/tt==1/Et:tt!==tt&&Et!==Et}function U(tt){this.message=tt,this.stack=""}function H(tt){function Et(pn,dn,yn,Mt,cn,Yt,Tn){if(Mt=Mt||bt,Yt=Yt||yn,Tn!==I){if(Q){var xr=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");throw xr.name="Invariant Violation",xr}if(typeof console<"u"){var On=Mt+":"+yn;!mt[On]&&Vt<3&&(L("You are manually calling a React.PropTypes validation function for the `"+Yt+"` prop on `"+Mt+"`. This is deprecated and will throw in the standalone `prop-types` package. You may be seeing this warning due to a third-party PropTypes library. See https://fb.me/react-warning-dont-call-proptypes for details."),mt[On]=!0,Vt++)}}return dn[yn]==null?pn?new U(dn[yn]===null?"The "+cn+" `"+Yt+"` is marked as required in `"+Mt+"`, but its value is `null`.":"The "+cn+" `"+Yt+"` is marked as required in `"+Mt+"`, but its value is `undefined`."):null:tt(dn,yn,Mt,cn,Yt)}var mt={},Vt=0,Pt=Et.bind(null,!1);return Pt.isRequired=Et.bind(null,!0),Pt}function Z(tt){function Et(mt,Vt,Pt,pn,dn,yn){var Mt=mt[Vt];return xe(Mt)!==tt?new U("Invalid "+pn+" `"+dn+"` of type `"+wt(Mt)+"` supplied to `"+Pt+"`, expected `"+tt+"`."):null}return H(Et)}function de(tt){function Et(mt,Vt,Pt,pn,dn){if(typeof tt!="function")return new U("Property `"+dn+"` of component `"+Pt+"` has invalid PropType notation inside arrayOf.");var yn=mt[Vt];if(!Array.isArray(yn))return new U("Invalid "+pn+" `"+dn+"` of type `"+xe(yn)+"` supplied to `"+Pt+"`, expected an array.");for(var Mt=0;Mt<yn.length;Mt++){var cn=tt(yn,Mt,Pt,pn,dn+"["+Mt+"]",I);if(cn instanceof Error)return cn}return null}return H(Et)}function ve(tt){function Et(mt,Vt,Pt,pn,dn){if(!(mt[Vt]instanceof tt)){var yn=tt.name||bt;return new U("Invalid "+pn+" `"+dn+"` of type `"+Tt(mt[Vt])+"` supplied to `"+Pt+"`, expected instance of `"+yn+"`.")}return null}return H(Et)}function Ee(tt){function Et(mt,Vt,Pt,pn,dn){for(var yn=mt[Vt],Mt=0;Mt<tt.length;Mt++)if(ee(yn,tt[Mt]))return null;var cn=JSON.stringify(tt,function(Yt,Tn){return wt(Tn)==="symbol"?String(Tn):Tn});return new U("Invalid "+pn+" `"+dn+"` of value `"+String(yn)+"` supplied to `"+Pt+"`, expected one of "+cn+".")}return Array.isArray(tt)?H(Et):(L(arguments.length>1?"Invalid arguments supplied to oneOf, expected an array, got "+arguments.length+" arguments. A common mistake is to write oneOf(x, y, z) instead of oneOf([x, y, z]).":"Invalid argument supplied to oneOf, expected an array."),_)}function ie(tt){function Et(mt,Vt,Pt,pn,dn){if(typeof tt!="function")return new U("Property `"+dn+"` of component `"+Pt+"` has invalid PropType notation inside objectOf.");var yn=mt[Vt],Mt=xe(yn);if(Mt!=="object")return new U("Invalid "+pn+" `"+dn+"` of type `"+Mt+"` supplied to `"+Pt+"`, expected an object.");for(var cn in yn)if(D(yn,cn)){var Yt=tt(yn,cn,Pt,pn,dn+"."+cn,I);if(Yt instanceof Error)return Yt}return null}return H(Et)}function ue(tt){function Et(Pt,pn,dn,yn,Mt){for(var cn=0;cn<tt.length;cn++)if((0,tt[cn])(Pt,pn,dn,yn,Mt,I)==null)return null;return new U("Invalid "+yn+" `"+Mt+"` supplied to `"+dn+"`.")}if(!Array.isArray(tt))return L("Invalid argument supplied to oneOfType, expected an instance of array."),_;for(var mt=0;mt<tt.length;mt++){var Vt=tt[mt];if(typeof Vt!="function")return L("Invalid argument supplied to oneOfType. Expected an array of check functions, but received "+ft(Vt)+" at index "+mt+"."),_}return H(Et)}function K(tt){function Et(mt,Vt,Pt,pn,dn){var yn=mt[Vt],Mt=xe(yn);if(Mt!=="object")return new U("Invalid "+pn+" `"+dn+"` of type `"+Mt+"` supplied to `"+Pt+"`, expected `object`.");for(var cn in tt){var Yt=tt[cn];if(Yt){var Tn=Yt(yn,cn,Pt,pn,dn+"."+cn,I);if(Tn)return Tn}}return null}return H(Et)}function ge(tt){function Et(mt,Vt,Pt,pn,dn){var yn=mt[Vt],Mt=xe(yn);if(Mt!=="object")return new U("Invalid "+pn+" `"+dn+"` of type `"+Mt+"` supplied to `"+Pt+"`, expected `object`.");var cn=a({},mt[Vt],tt);for(var Yt in cn){var Tn=tt[Yt];if(!Tn)return new U("Invalid "+pn+" `"+dn+"` key `"+Yt+"` supplied to `"+Pt+"`.\nBad object: "+JSON.stringify(mt[Vt],null,"  ")+`
Valid keys: `+JSON.stringify(Object.keys(tt),null,"  "));var xr=Tn(yn,Yt,Pt,pn,dn+"."+Yt,I);if(xr)return xr}return null}return H(Et)}function _e(tt){switch(typeof tt){case"number":case"string":case"undefined":return!0;case"boolean":return!tt;case"object":if(Array.isArray(tt))return tt.every(_e);if(tt===null||G(tt))return!0;var Et=re(tt);if(!Et)return!1;var mt,Vt=Et.call(tt);if(Et!==tt.entries){for(;!(mt=Vt.next()).done;)if(!_e(mt.value))return!1}else for(;!(mt=Vt.next()).done;){var Pt=mt.value;if(Pt&&!_e(Pt[1]))return!1}return!0;default:return!1}}function Se(tt,Et){return tt==="symbol"||!!Et&&(Et["@@toStringTag"]==="Symbol"||typeof Symbol=="function"&&Et instanceof Symbol)}function xe(tt){var Et=typeof tt;return Array.isArray(tt)?"array":tt instanceof RegExp?"object":Se(Et,tt)?"symbol":Et}function wt(tt){if(tt==null)return""+tt;var Et=xe(tt);if(Et==="object"){if(tt instanceof Date)return"date";if(tt instanceof RegExp)return"regexp"}return Et}function ft(tt){var Et=wt(tt);switch(Et){case"array":case"object":return"an "+Et;case"boolean":case"date":case"regexp":return"a "+Et;default:return Et}}function Tt(tt){return tt.constructor&&tt.constructor.name?tt.constructor.name:bt}var gt=typeof Symbol=="function"&&Symbol.iterator,at="@@iterator",bt="<<anonymous>>",Zt={array:Z("array"),bool:Z("boolean"),func:Z("function"),number:Z("number"),object:Z("object"),string:Z("string"),symbol:Z("symbol"),any:function(){return H(_)}(),arrayOf:de,element:function(){function tt(Et,mt,Vt,Pt,pn){var dn=Et[mt];return G(dn)?null:new U("Invalid "+Pt+" `"+pn+"` of type `"+xe(dn)+"` supplied to `"+Vt+"`, expected a single ReactElement.")}return H(tt)}(),elementType:function(){function tt(Et,mt,Vt,Pt,pn){var dn=Et[mt];return x.isValidElementType(dn)?null:new U("Invalid "+Pt+" `"+pn+"` of type `"+xe(dn)+"` supplied to `"+Vt+"`, expected a single ReactElement type.")}return H(tt)}(),instanceOf:ve,node:function(){function tt(Et,mt,Vt,Pt,pn){return _e(Et[mt])?null:new U("Invalid "+Pt+" `"+pn+"` supplied to `"+Vt+"`, expected a ReactNode.")}return H(tt)}(),objectOf:ie,oneOf:Ee,oneOfType:ue,shape:K,exact:ge};return U.prototype=Error.prototype,Zt.checkPropTypes=M,Zt.resetWarningCache=M.resetWarningCache,Zt.PropTypes=Zt,Zt}},function(s,c,d){function _(M){if(M==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(M)}/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var x=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;s.exports=function(){try{if(!Object.assign)return!1;var M=new String("abc");if(M[5]="de",Object.getOwnPropertyNames(M)[0]==="5")return!1;for(var D={},L=0;L<10;L++)D["_"+String.fromCharCode(L)]=L;if(Object.getOwnPropertyNames(D).map(function(Q){return D[Q]}).join("")!=="0123456789")return!1;var G={};return"abcdefghijklmnopqrst".split("").forEach(function(Q){G[Q]=Q}),Object.keys(Object.assign({},G)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}()?Object.assign:function(M,D){for(var L,G,Q=_(M),re=1;re<arguments.length;re++){L=Object(arguments[re]);for(var ee in L)a.call(L,ee)&&(Q[ee]=L[ee]);if(x){G=x(L);for(var U=0;U<G.length;U++)I.call(L,G[U])&&(Q[G[U]]=L[G[U]])}}return Q}},function(s,c,d){function _(D,L,G,Q,re){for(var ee in D)if(M(D,ee)){var U;try{if(typeof D[ee]!="function"){var H=Error((Q||"React class")+": "+G+" type `"+ee+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof D[ee]+"`.");throw H.name="Invariant Violation",H}U=D[ee](L,ee,Q,G,null,a)}catch(de){U=de}if(!U||U instanceof Error||x((Q||"React class")+": type specification of "+G+" `"+ee+"` is invalid; the type checker function must return `null` or an `Error` but returned a "+typeof U+". You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument)."),U instanceof Error&&!(U.message in I)){I[U.message]=!0;var Z=re?re():"";x("Failed "+G+" type: "+U.message+(Z??""))}}}var x=function(){},a=d(4),I={},M=Function.call.bind(Object.prototype.hasOwnProperty);x=function(D){var L="Warning: "+D;typeof console<"u"&&console.error(L);try{throw new Error(L)}catch{}},_.resetWarningCache=function(){I={}},s.exports=_},function(s,c,d){function _(M,D){if(M==null)return{};var L,G,Q=x(M,D);if(Object.getOwnPropertySymbols){var re=Object.getOwnPropertySymbols(M);for(G=0;G<re.length;G++)L=re[G],D.indexOf(L)>=0||Object.prototype.propertyIsEnumerable.call(M,L)&&(Q[L]=M[L])}return Q}function x(M,D){if(M==null)return{};var L,G,Q={},re=Object.keys(M);for(G=0;G<re.length;G++)L=re[G],D.indexOf(L)>=0||(Q[L]=M[L]);return Q}function a(M){var D=M.children,L=M.device,G=M.onChange,Q=_(M,["children","device","onChange"]),re=Object(I.a)(Q,L,G);return typeof D=="function"?D(re):re?D:null}c.a=a;var I=d(0)}])})})(hX);var W$=hX.exports;const dX=Y.createContext(),fX=()=>Y.useContext(dX),cIe=({children:t})=>{const[e,r]=Y.useState(null),[s,c]=Y.useState(!0);return Y.useEffect(()=>{const d=Wt.onAuthStateChanged(async _=>{if(_){const x=await uy(_.uid);console.log("Fetched user data:",x),r(x)}else r(null);c(!1)});return()=>d()},[]),F.jsx(dX.Provider,{value:e,children:s?F.jsx("div",{}):t})},uIe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M202.87-520q-37.54%200-64.27-26.73-26.73-26.73-26.73-64.27v-146.13q0-37.54%2026.73-64.27%2026.73-26.73%2064.27-26.73H349q37.54%200%2064.27%2026.73Q440-794.67%20440-757.13V-611q0%2037.54-26.73%2064.27Q386.54-520%20349-520H202.87Zm0%20408.13q-37.54%200-64.27-26.73-26.73-26.73-26.73-64.27V-349q0-37.54%2026.73-64.27Q165.33-440%20202.87-440H349q37.54%200%2064.27%2026.73Q440-386.54%20440-349v146.13q0%2037.54-26.73%2064.27-26.73%2026.73-64.27%2026.73H202.87ZM611-520q-37.54%200-64.27-26.73Q520-573.46%20520-611v-146.13q0-37.54%2026.73-64.27%2026.73-26.73%2064.27-26.73h146.13q37.54%200%2064.27%2026.73%2026.73%2026.73%2026.73%2064.27V-611q0%2037.54-26.73%2064.27Q794.67-520%20757.13-520H611Zm0%20408.13q-37.54%200-64.27-26.73Q520-165.33%20520-202.87V-349q0-37.54%2026.73-64.27Q573.46-440%20611-440h146.13q37.54%200%2064.27%2026.73%2026.73%2026.73%2026.73%2064.27v146.13q0%2037.54-26.73%2064.27-26.73%2026.73-64.27%2026.73H611ZM202.87-611H349v-146.13H202.87V-611ZM611-611h146.13v-146.13H611V-611Zm0%20408.13h146.13V-349H611v146.13Zm-408.13%200H349V-349H202.87v146.13ZM611-611Zm0%20262Zm-262%200Zm0-262Z'/%3e%3c/svg%3e",hIe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M479.94-258.09q75.78%200%20128.88-53.04%2053.09-53.04%2053.09-128.81%200-75.78-53.04-128.88-53.04-53.09-128.81-53.09-75.78%200-128.88%2053.04-53.09%2053.04-53.09%20128.81%200%2075.78%2053.04%20128.88%2053.04%2053.09%20128.81%2053.09Zm.06-86.21q-40.33%200-68.01-27.69Q384.3-399.67%20384.3-440q0-40.33%2027.69-68.01Q439.67-535.7%20480-535.7q40.33%200%2068.01%2027.69Q575.7-480.33%20575.7-440q0%2040.33-27.69%2068.01Q520.33-344.3%20480-344.3ZM162.87-111.87q-37.78%200-64.39-26.61t-26.61-64.39v-474.26q0-37.78%2026.61-64.39t64.39-26.61H281.7l50.47-52.33q12.44-12.95%2029.61-20.31%2017.18-7.36%2035.61-7.36h165.22q18.43%200%2035.61%207.36%2017.17%207.36%2029.61%2020.31l50.47%2052.33h118.83q37.78%200%2064.39%2026.61t26.61%2064.39v474.26q0%2037.78-26.61%2064.39t-64.39%2026.61H162.87Zm0-91h634.26v-474.26H638.72l-75.63-80H397.63l-77.06%2080h-157.7v474.26ZM480-440Z'/%3e%3c/svg%3e",dIe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M412.84-170.87q44.64-90.04%20118.93-120.42%2074.29-30.38%20126.8-30.38%2022.52%200%2044.52%204%2022%204%2042.77%2010%2023.75-37.53%2037.63-81.22%2013.88-43.69%2013.88-91.35%200-132.56-92.28-224.73-92.29-92.16-224.85-92.16-132.57%200-224.85%2092.16-92.28%2092.17-92.28%20224.73%200%2044.75%2011.5%2085.52%2011.5%2040.76%2034.02%2075.05%2040.76-19.76%2084.28-30.65%2043.52-10.88%2088.29-10.88%2031.52%200%2060.9%205.5t57.9%2014.5q-22.76%2012.24-43.14%2027.88-20.38%2015.65-38.38%2033.65-12.48-2-20.38-2h-16.9q-32%200-63.15%206.88-31.14%206.88-59.9%2020.88%2031.52%2031.52%2070.78%2052.78%2039.27%2021.26%2083.91%2030.26Zm67.4%2099q-84.65%200-159.1-32.1-74.44-32.1-129.64-87.29-55.2-55.2-87.29-129.65-32.1-74.46-32.1-159.11%200-84.65%2032.1-159.09%2032.09-74.43%2087.29-129.63%2055.2-55.19%20129.65-87.29%2074.46-32.1%20159.11-32.1%2084.65%200%20158.97%2032.1%2074.31%2032.1%20129.51%2087.29%2055.19%2055.2%2087.29%20129.65%2032.1%2074.46%2032.1%20159.11%200%2084.65-32.1%20159.09-32.1%2074.43-87.29%20129.63-55.2%2055.19-129.57%2087.29-74.37%2032.1-158.93%2032.1ZM381.2-420.48q-57.77%200-98.41-40.64-40.64-40.64-40.64-98.4%200-57.76%2040.64-98.28%2040.64-40.53%2098.41-40.53%2057.76%200%2098.28%2040.53Q520-617.28%20520-559.52t-40.52%2098.4q-40.52%2040.64-98.28%2040.64Zm0-79.52q24.52%200%2041.9-17.5t17.38-42.02q0-24.52-17.38-41.9t-41.9-17.38q-24.53%200-42.03%2017.38t-17.5%2041.9q0%2024.52%2017.5%2042.02%2017.5%2017.5%2042.03%2017.5Zm277.66%20119.04q-41.58%200-70.46-28.7-28.88-28.71-28.88-70.29%200-41.57%2028.88-70.33%2028.88-28.76%2070.46-28.76%2041.57%200%2070.28%2028.7%2028.71%2028.71%2028.71%2070.29%200%2041.57-28.71%2070.33-28.71%2028.76-70.28%2028.76ZM480.24-480Z'/%3e%3c/svg%3e",fIe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M320-148.52q-37.78%200-64.39-26.61T229-239.52v-77.13q0-19.15%2013.17-32.33%2013.18-13.17%2032.33-13.17h77.37v-90q-29.04-2.72-57.47-13.34-28.42-10.62-50.42-30.9-6.48-6.24-9.98-14.1-3.5-7.86-3.5-16.34v-25.08h-25.65q-9.2%200-17.53-3.48-8.34-3.48-15.06-10.2l-88.8-88.8q-12.48-12.48-12.48-29.44%200-16.95%2012.72-29.43%2031.15-29%2078.95-42.62%2047.81-13.62%2089.76-13.62%2025.33%200%2049.87%203.88%2024.55%203.88%2049.59%2013.92%200-25.15%2017.43-42.58%2017.44-17.44%2042.59-17.44h345.24q37.78%200%2064.39%2026.61t26.61%2064.39v444.07q0%2053.11-37.51%2090.62-37.51%2037.51-90.62%2037.51H320Zm122.87-213.63h194.5q19.15%200%2032.33%2013.17%2013.17%2013.18%2013.17%2032.33v40q0%2015.8%2010.66%2026.47%2010.67%2010.66%2026.47%2010.66%2015.8%200%2026.47-10.66%2010.66-10.67%2010.66-26.47v-444.07H442.87V-696l219.91%20220.15q9.48%209.48%2011.6%2021.7%202.12%2012.22-2.88%2023.45-5%2011.24-14.6%2018.22-9.6%206.98-24.07%206.98-8.48%200-16.22-3.5-7.74-3.5-13.22-8.98l-96.98-97.22-6.56%206.57q-13.05%2013.04-27.23%2023.45-14.19%2010.4-29.75%2016.16v106.87ZM221.13-635.5h47.46q19.15%200%2032.32%2013.17%2013.18%2013.18%2013.18%2032.33v41.22q11.52%207.28%2024.28%2010.28%2012.76%203%2026.04%203%2022.29%200%2040.43-6.88t35.18-23.92l7.28-7.29-54.32-54.56q-29-29-64.52-43.38-35.53-14.38-76.05-14.38-19.04%200-36.2%202.76-17.17%202.76-34.21%208.52l39.13%2039.13Zm370.74%20356.93H320v39.05h277.87q-3-8.76-4.5-18.4-1.5-9.65-1.5-20.65ZM320-239.52v-39.05%2039.05Z'/%3e%3c/svg%3e";function pIe(){const[t,e]=Y.useState("/home"),r=fX();return F.jsx("div",{className:"navigation-bar-container",children:F.jsxs("div",{className:"navigation-bar",children:[F.jsx(s,{link:"/home",children:F.jsx(uIe,{})}),F.jsx(s,{link:"camera",children:F.jsx(hIe,{})}),F.jsx(s,{link:"profile",replace:!0,children:F.jsx("div",{className:"profile-icon",children:F.jsx("img",{src:(r==null?void 0:r.profilePhoto)||"/default-profile-image.jpg",alt:(r==null?void 0:r.name)||"User Profile",className:"profile-photo"})})}),F.jsx(s,{link:"connections",replace:!0,children:F.jsx(dIe,{})}),F.jsx(s,{link:"quests",replace:!0,children:F.jsx(fIe,{})})]})});function s({link:c,children:d,replace:_=!1}){return F.jsx(Lne,{end:!0,className:({isActive:x})=>`navigation-bar-button ${x?"selected":""}`,id:c,to:c,replace:_,onClick:()=>e(c),children:d})}}function mIe({imageUrl:t,aspectRatio:e,time:r,user:s,description:c,onClick:d}){const[_,x]=e?e.split(":").map(Number):[1,1];let a=_/x;return e==="16:9"&&(a=9/16),F.jsxs("div",{className:"quest-card",style:{backgroundImage:`url(${t})`,aspectRatio:a},onClick:d,children:[F.jsx("div",{className:"header",children:F.jsx("div",{className:"time",children:r})}),F.jsxs("div",{className:"footer",children:[F.jsx("p",{className:"user",children:s}),F.jsx("p",{className:"description",children:c})]})]})}function gIe({aspectRatio:t}){return F.jsxs("div",{className:"quest-card",style:{backgroundImage:"url('https://media.tenor.com/o_5RQarGvJ0AAAAM/kiss.gif')",aspectRatio:t},children:[F.jsx("div",{className:"header",children:F.jsx("div",{className:"time",children:"8:08 PM"})}),F.jsxs("div",{className:"footer",children:[F.jsx("p",{className:"user",children:"Kiity :3"}),F.jsx("p",{className:"description",children:"I am cat and i love yuu"})]})]})}function _Ie(){const[t,e]=Y.useState([]);Y.useEffect(()=>{const d=vi(wn,"quests"),_=co(d,wx("createdAt","desc"),HD(20)),x=jh(_,a=>{const I=a.docs.map(M=>({id:M.id,...M.data()}));e(I)});return()=>x()},[]);const r=async d=>{try{await cy(Xn(wn,"quests",d)),e(t.filter(_=>_.id!==d))}catch(_){console.error("Error deleting quest:",_)}},s=[{aspectRatio:3/4},{aspectRatio:9/16},{aspectRatio:1/1},{aspectRatio:3/4},{aspectRatio:1/1},{aspectRatio:9/16},{aspectRatio:1/1},{aspectRatio:1/1},{aspectRatio:9/16},{aspectRatio:3/4},{aspectRatio:9/16}],c=[...t,...s];return c.sort(()=>Math.random()-.5),F.jsx("div",{className:"feed",children:c.map((d,_)=>d.id?F.jsx(mIe,{imageUrl:d.imageUrl,aspectRatio:d.aspectRatio,time:d.time,user:d.user,description:d.description,onClick:()=>r(d.id)},d.id):F.jsx(gIe,{aspectRatio:d.aspectRatio},`dummy-${_}`))})}function pX({small:t=!1}){const[e,r]=Y.useState("Loading address..."),[s,c]=Y.useState([]),[d,_]=Y.useState(null),[x,a]=Y.useState(""),[I,M]=Y.useState(null),[D,L]=Y.useState(!1),G=()=>{L(!D)};return F.jsxs("div",{className:`map-container ${t?"small":""} ${D?"full-screen":""}`,children:[F.jsx(k_,{address:e,setAddress:r,setCurrentUserIds:c,setMap:_,activeSection:x,lockedUser:I,showAddressBar:!1,isFullScreen:D}),F.jsx("button",{className:"full-screen-toggle",onClick:G,"aria-label":D?"Exit full screen":"Enter full screen",children:D?"":""})]})}function yIe({ref:t,show:e}){return F.jsx("div",{className:"top-bar-container",style:{opacity:e?1:0},children:F.jsxs("div",{className:"top-bar",children:[F.jsx(M4,{small:!0}),F.jsx(O4,{small:!0}),F.jsx(k4,{small:!0}),F.jsx(pX,{small:!0})]})})}const vIe=({isOpen:t,onClose:e})=>{const[r,s]=Y.useState(""),[c,d]=Y.useState(""),[_,x]=Y.useState(""),[a,I]=Y.useState(!1),[M,D]=Y.useState(""),[L,G]=Y.useState(null),[Q,re]=Y.useState([]),[ee,U]=Y.useState([]),{showNotification:H}=wb();Y.useEffect(()=>{(async()=>{const K=vi(wn,"users"),_e=(await _a(K)).docs.map(Se=>({id:Se.id,...Se.data()}));re(_e)})()},[]),Y.useEffect(()=>{if(M){const ue=Q.filter(K=>K.name.toLowerCase().includes(M.toLowerCase()));U(ue)}else U([])},[M,Q]);const Z=async()=>{if(!Wt.currentUser){H("You must be logged in to create a quest.","error");return}if(!r||!c||!_){H("Please fill in all fields.","error");return}if(!a&&!L){H("Please select a user for private quest.","error");return}try{const ue={uid:Wt.currentUser.uid,title:r,description:c,timeFrame:_,createdAt:OS(),isPublic:a,targetUser:a?null:L.id,status:"pending",acceptedBy:a?[]:null};await Tx(vi(wn,"quests"),ue),H("Quest created successfully!","success"),ie(),e()}catch(ue){console.error("Error creating quest:",ue),H("Failed to create quest.","error")}},de=()=>{I(!a),G(null),D("")},ve=ue=>{ue.target.value.split(/\s+/).length<=300&&d(ue.target.value)},Ee=ue=>{G(ue),D("")},ie=()=>{s(""),d(""),x(""),I(!1),D(""),G(null)};return t?F.jsx("div",{className:"modal-overlay",children:F.jsx("div",{className:"quest-popup",children:F.jsxs("div",{className:"modal-content",children:[F.jsxs("div",{className:"modal-header",children:[F.jsx("svg",{onClick:e,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:F.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})}),F.jsx("h2",{children:"Create a New Quest"})]}),F.jsxs("div",{className:"input-group",children:[F.jsx("label",{htmlFor:"quest-title",children:"Title"}),F.jsx("input",{id:"quest-title",type:"text",placeholder:"Enter quest title",value:r,onChange:ue=>s(ue.target.value),className:"profile-input"})]}),F.jsxs("div",{className:"input-group",children:[F.jsx("label",{htmlFor:"quest-description",children:"Description"}),F.jsx("textarea",{id:"quest-description",placeholder:"Enter quest description",value:c,onChange:ve,className:"profile-bio-edit"})]}),F.jsxs("div",{className:"input-group",children:[F.jsx("label",{htmlFor:"quest-timeframe",children:"Time Frame"}),F.jsxs("select",{id:"quest-timeframe",value:_,onChange:ue=>x(ue.target.value),className:"profile-input",children:[F.jsx("option",{value:"",children:"Select Time Frame"}),F.jsx("option",{value:"5 mins",children:"5 mins"}),F.jsx("option",{value:"10 mins",children:"10 mins"}),F.jsx("option",{value:"15 mins",children:"15 mins"}),F.jsx("option",{value:"30 mins",children:"30 mins"}),F.jsx("option",{value:"1 hour",children:"1 hour"})]})]}),F.jsxs("div",{className:"toggle-container",children:[F.jsx("p",{children:"Public Quest"}),F.jsxs("label",{className:"switch",children:[F.jsx("input",{type:"checkbox",checked:a,onChange:de}),F.jsx("span",{className:"slider"})]})]}),!a&&F.jsxs("div",{className:"user-search-container",children:[F.jsx("input",{type:"text",placeholder:"Search users...",value:M,onChange:ue=>D(ue.target.value),className:"user-search-input"}),M&&ee.length>0&&F.jsx("div",{className:"user-search-results",children:ee.map(ue=>F.jsxs("div",{className:"user-search-result",onClick:()=>Ee(ue),children:[F.jsx("img",{src:ue.profilePhotoUrl||"/default-profile.png",alt:"Profile",className:"user-pfp"}),ue.name]},ue.id))}),L&&F.jsx("div",{className:"selected-user",children:F.jsxs("p",{children:["Selected User: ",L.name]})})]}),F.jsxs("div",{className:"modal-actions",children:[F.jsx("button",{className:"cancel-button",onClick:e,children:"Cancel"}),F.jsx("button",{className:"create-quest-button",onClick:Z,children:"Create Quest"})]})]})})}):null};var Ba=function(){return Ba=Object.assign||function(e){for(var r,s=1,c=arguments.length;s<c;s++){r=arguments[s];for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(e[d]=r[d])}return e},Ba.apply(this,arguments)};function iI(t,e,r){if(r||arguments.length===2)for(var s=0,c=e.length,d;s<c;s++)(d||!(s in e))&&(d||(d=Array.prototype.slice.call(e,0,s)),d[s]=e[s]);return t.concat(d||Array.prototype.slice.call(e))}var Xi="-ms-",q1="-moz-",_i="-webkit-",mX="comm",lA="rule",iL="decl",xIe="@import",gX="@keyframes",bIe="@layer",_X=Math.abs,sL=String.fromCharCode,E4=Object.assign;function wIe(t,e){return bo(t,0)^45?(((e<<2^bo(t,0))<<2^bo(t,1))<<2^bo(t,2))<<2^bo(t,3):0}function yX(t){return t.trim()}function Ah(t,e){return(t=e.exec(t))?t[0]:t}function Fr(t,e,r){return t.replace(e,r)}function LE(t,e,r){return t.indexOf(e,r)}function bo(t,e){return t.charCodeAt(e)|0}function jy(t,e,r){return t.slice(e,r)}function Au(t){return t.length}function vX(t){return t.length}function m1(t,e){return e.push(t),t}function TIe(t,e){return t.map(e).join("")}function H$(t,e){return t.filter(function(r){return!Ah(r,e)})}var cA=1,Uy=1,xX=0,Yl=0,Ks=0,a0="";function uA(t,e,r,s,c,d,_,x){return{value:t,root:e,parent:r,type:s,props:c,children:d,line:cA,column:Uy,length:_,return:"",siblings:x}}function tf(t,e){return E4(uA("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function C_(t){for(;t.root;)t=tf(t.root,{children:[t]});m1(t,t.siblings)}function EIe(){return Ks}function SIe(){return Ks=Yl>0?bo(a0,--Yl):0,Uy--,Ks===10&&(Uy=1,cA--),Ks}function Uc(){return Ks=Yl<xX?bo(a0,Yl++):0,Uy++,Ks===10&&(Uy=1,cA++),Ks}function Im(){return bo(a0,Yl)}function zE(){return Yl}function hA(t,e){return jy(a0,t,e)}function S4(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function IIe(t){return cA=Uy=1,xX=Au(a0=t),Yl=0,[]}function CIe(t){return a0="",t}function HR(t){return yX(hA(Yl-1,I4(t===91?t+2:t===40?t+1:t)))}function AIe(t){for(;(Ks=Im())&&Ks<33;)Uc();return S4(t)>2||S4(Ks)>3?"":" "}function PIe(t,e){for(;--e&&Uc()&&!(Ks<48||Ks>102||Ks>57&&Ks<65||Ks>70&&Ks<97););return hA(t,zE()+(e<6&&Im()==32&&Uc()==32))}function I4(t){for(;Uc();)switch(Ks){case t:return Yl;case 34:case 39:t!==34&&t!==39&&I4(Ks);break;case 40:t===41&&I4(t);break;case 92:Uc();break}return Yl}function RIe(t,e){for(;Uc()&&t+Ks!==57;)if(t+Ks===84&&Im()===47)break;return"/*"+hA(e,Yl-1)+"*"+sL(t===47?t:Uc())}function MIe(t){for(;!S4(Im());)Uc();return hA(t,Yl)}function kIe(t){return CIe(NE("",null,null,null,[""],t=IIe(t),0,[0],t))}function NE(t,e,r,s,c,d,_,x,a){for(var I=0,M=0,D=_,L=0,G=0,Q=0,re=1,ee=1,U=1,H=0,Z="",de=c,ve=d,Ee=s,ie=Z;ee;)switch(Q=H,H=Uc()){case 40:if(Q!=108&&bo(ie,D-1)==58){LE(ie+=Fr(HR(H),"&","&\f"),"&\f",_X(I?x[I-1]:0))!=-1&&(U=-1);break}case 34:case 39:case 91:ie+=HR(H);break;case 9:case 10:case 13:case 32:ie+=AIe(Q);break;case 92:ie+=PIe(zE()-1,7);continue;case 47:switch(Im()){case 42:case 47:m1(OIe(RIe(Uc(),zE()),e,r,a),a);break;default:ie+="/"}break;case 123*re:x[I++]=Au(ie)*U;case 125*re:case 59:case 0:switch(H){case 0:case 125:ee=0;case 59+M:U==-1&&(ie=Fr(ie,/\f/g,"")),G>0&&Au(ie)-D&&m1(G>32?X$(ie+";",s,r,D-1,a):X$(Fr(ie," ","")+";",s,r,D-2,a),a);break;case 59:ie+=";";default:if(m1(Ee=Z$(ie,e,r,I,M,c,x,Z,de=[],ve=[],D,d),d),H===123)if(M===0)NE(ie,e,Ee,Ee,de,d,D,x,ve);else switch(L===99&&bo(ie,3)===110?100:L){case 100:case 108:case 109:case 115:NE(t,Ee,Ee,s&&m1(Z$(t,Ee,Ee,0,0,c,x,Z,c,de=[],D,ve),ve),c,ve,D,x,s?de:ve);break;default:NE(ie,Ee,Ee,Ee,[""],ve,0,x,ve)}}I=M=G=0,re=U=1,Z=ie="",D=_;break;case 58:D=1+Au(ie),G=Q;default:if(re<1){if(H==123)--re;else if(H==125&&re++==0&&SIe()==125)continue}switch(ie+=sL(H),H*re){case 38:U=M>0?1:(ie+="\f",-1);break;case 44:x[I++]=(Au(ie)-1)*U,U=1;break;case 64:Im()===45&&(ie+=HR(Uc())),L=Im(),M=D=Au(Z=ie+=MIe(zE())),H++;break;case 45:Q===45&&Au(ie)==2&&(re=0)}}return d}function Z$(t,e,r,s,c,d,_,x,a,I,M,D){for(var L=c-1,G=c===0?d:[""],Q=vX(G),re=0,ee=0,U=0;re<s;++re)for(var H=0,Z=jy(t,L+1,L=_X(ee=_[re])),de=t;H<Q;++H)(de=yX(ee>0?G[H]+" "+Z:Fr(Z,/&\f/g,G[H])))&&(a[U++]=de);return uA(t,e,r,c===0?lA:x,a,I,M,D)}function OIe(t,e,r,s){return uA(t,e,r,mX,sL(EIe()),jy(t,2,-2),0,s)}function X$(t,e,r,s,c){return uA(t,e,r,iL,jy(t,0,s),jy(t,s+1,-1),s,c)}function bX(t,e,r){switch(wIe(t,e)){case 5103:return _i+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return _i+t+t;case 4789:return q1+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return _i+t+q1+t+Xi+t+t;case 5936:switch(bo(t,e+11)){case 114:return _i+t+Xi+Fr(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return _i+t+Xi+Fr(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return _i+t+Xi+Fr(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return _i+t+Xi+t+t;case 6165:return _i+t+Xi+"flex-"+t+t;case 5187:return _i+t+Fr(t,/(\w+).+(:[^]+)/,_i+"box-$1$2"+Xi+"flex-$1$2")+t;case 5443:return _i+t+Xi+"flex-item-"+Fr(t,/flex-|-self/g,"")+(Ah(t,/flex-|baseline/)?"":Xi+"grid-row-"+Fr(t,/flex-|-self/g,""))+t;case 4675:return _i+t+Xi+"flex-line-pack"+Fr(t,/align-content|flex-|-self/g,"")+t;case 5548:return _i+t+Xi+Fr(t,"shrink","negative")+t;case 5292:return _i+t+Xi+Fr(t,"basis","preferred-size")+t;case 6060:return _i+"box-"+Fr(t,"-grow","")+_i+t+Xi+Fr(t,"grow","positive")+t;case 4554:return _i+Fr(t,/([^-])(transform)/g,"$1"+_i+"$2")+t;case 6187:return Fr(Fr(Fr(t,/(zoom-|grab)/,_i+"$1"),/(image-set)/,_i+"$1"),t,"")+t;case 5495:case 3959:return Fr(t,/(image-set\([^]*)/,_i+"$1$`$1");case 4968:return Fr(Fr(t,/(.+:)(flex-)?(.*)/,_i+"box-pack:$3"+Xi+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+_i+t+t;case 4200:if(!Ah(t,/flex-|baseline/))return Xi+"grid-column-align"+jy(t,e)+t;break;case 2592:case 3360:return Xi+Fr(t,"template-","")+t;case 4384:case 3616:return r&&r.some(function(s,c){return e=c,Ah(s.props,/grid-\w+-end/)})?~LE(t+(r=r[e].value),"span",0)?t:Xi+Fr(t,"-start","")+t+Xi+"grid-row-span:"+(~LE(r,"span",0)?Ah(r,/\d+/):+Ah(r,/\d+/)-+Ah(t,/\d+/))+";":Xi+Fr(t,"-start","")+t;case 4896:case 4128:return r&&r.some(function(s){return Ah(s.props,/grid-\w+-start/)})?t:Xi+Fr(Fr(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return Fr(t,/(.+)-inline(.+)/,_i+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Au(t)-1-e>6)switch(bo(t,e+1)){case 109:if(bo(t,e+4)!==45)break;case 102:return Fr(t,/(.+:)(.+)-([^]+)/,"$1"+_i+"$2-$3$1"+q1+(bo(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~LE(t,"stretch",0)?bX(Fr(t,"stretch","fill-available"),e,r)+t:t}break;case 5152:case 5920:return Fr(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(s,c,d,_,x,a,I){return Xi+c+":"+d+I+(_?Xi+c+"-span:"+(x?a:+a-+d)+I:"")+t});case 4949:if(bo(t,e+6)===121)return Fr(t,":",":"+_i)+t;break;case 6444:switch(bo(t,bo(t,14)===45?18:11)){case 120:return Fr(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+_i+(bo(t,14)===45?"inline-":"")+"box$3$1"+_i+"$2$3$1"+Xi+"$2box$3")+t;case 100:return Fr(t,":",":"+Xi)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Fr(t,"scroll-","scroll-snap-")+t}return t}function sI(t,e){for(var r="",s=0;s<t.length;s++)r+=e(t[s],s,t,e)||"";return r}function DIe(t,e,r,s){switch(t.type){case bIe:if(t.children.length)break;case xIe:case iL:return t.return=t.return||t.value;case mX:return"";case gX:return t.return=t.value+"{"+sI(t.children,s)+"}";case lA:if(!Au(t.value=t.props.join(",")))return""}return Au(r=sI(t.children,s))?t.return=t.value+"{"+r+"}":""}function LIe(t){var e=vX(t);return function(r,s,c,d){for(var _="",x=0;x<e;x++)_+=t[x](r,s,c,d)||"";return _}}function zIe(t){return function(e){e.root||(e=e.return)&&t(e)}}function NIe(t,e,r,s){if(t.length>-1&&!t.return)switch(t.type){case iL:t.return=bX(t.value,t.length,r);return;case gX:return sI([tf(t,{value:Fr(t.value,"@","@"+_i)})],s);case lA:if(t.length)return TIe(r=t.props,function(c){switch(Ah(c,s=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":C_(tf(t,{props:[Fr(c,/:(read-\w+)/,":"+q1+"$1")]})),C_(tf(t,{props:[c]})),E4(t,{props:H$(r,s)});break;case"::placeholder":C_(tf(t,{props:[Fr(c,/:(plac\w+)/,":"+_i+"input-$1")]})),C_(tf(t,{props:[Fr(c,/:(plac\w+)/,":"+q1+"$1")]})),C_(tf(t,{props:[Fr(c,/:(plac\w+)/,Xi+"input-$1")]})),C_(tf(t,{props:[c]})),E4(t,{props:H$(r,s)});break}return""})}}var FIe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},il={},Vy=typeof process<"u"&&il!==void 0&&(il.REACT_APP_SC_ATTR||il.SC_ATTR)||"data-styled",wX="active",TX="data-styled-version",dA="6.1.13",oL=`/*!sc*/
`,oI=typeof window<"u"&&"HTMLElement"in window,BIe=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&il!==void 0&&il.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&il.REACT_APP_SC_DISABLE_SPEEDY!==""?il.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&il.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&il!==void 0&&il.SC_DISABLE_SPEEDY!==void 0&&il.SC_DISABLE_SPEEDY!==""&&il.SC_DISABLE_SPEEDY!=="false"&&il.SC_DISABLE_SPEEDY),fA=Object.freeze([]),$y=Object.freeze({});function jIe(t,e,r){return r===void 0&&(r=$y),t.theme!==r.theme&&t.theme||e||r.theme}var EX=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),UIe=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,VIe=/(^-|-$)/g;function K$(t){return t.replace(UIe,"-").replace(VIe,"")}var $Ie=/(a)(d)/gi,nE=52,Q$=function(t){return String.fromCharCode(t+(t>25?39:97))};function C4(t){var e,r="";for(e=Math.abs(t);e>nE;e=e/nE|0)r=Q$(e%nE)+r;return(Q$(e%nE)+r).replace($Ie,"$1-$2")}var ZR,SX=5381,Q_=function(t,e){for(var r=e.length;r;)t=33*t^e.charCodeAt(--r);return t},IX=function(t){return Q_(SX,t)};function qIe(t){return C4(IX(t)>>>0)}function GIe(t){return t.displayName||t.name||"Component"}function XR(t){return typeof t=="string"&&!0}var CX=typeof Symbol=="function"&&Symbol.for,AX=CX?Symbol.for("react.memo"):60115,WIe=CX?Symbol.for("react.forward_ref"):60112,HIe={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},ZIe={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},PX={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},XIe=((ZR={})[WIe]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},ZR[AX]=PX,ZR);function Y$(t){return("type"in(e=t)&&e.type.$$typeof)===AX?PX:"$$typeof"in t?XIe[t.$$typeof]:HIe;var e}var KIe=Object.defineProperty,QIe=Object.getOwnPropertyNames,J$=Object.getOwnPropertySymbols,YIe=Object.getOwnPropertyDescriptor,JIe=Object.getPrototypeOf,e8=Object.prototype;function RX(t,e,r){if(typeof e!="string"){if(e8){var s=JIe(e);s&&s!==e8&&RX(t,s,r)}var c=QIe(e);J$&&(c=c.concat(J$(e)));for(var d=Y$(t),_=Y$(e),x=0;x<c.length;++x){var a=c[x];if(!(a in ZIe||r&&r[a]||_&&a in _||d&&a in d)){var I=YIe(e,a);try{KIe(t,a,I)}catch{}}}}return t}function qy(t){return typeof t=="function"}function aL(t){return typeof t=="object"&&"styledComponentId"in t}function gm(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function t8(t,e){if(t.length===0)return"";for(var r=t[0],s=1;s<t.length;s++)r+=t[s];return r}function jx(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function A4(t,e,r){if(r===void 0&&(r=!1),!r&&!jx(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var s=0;s<e.length;s++)t[s]=A4(t[s],e[s]);else if(jx(e))for(var s in e)t[s]=A4(t[s],e[s]);return t}function lL(t,e){Object.defineProperty(t,"toString",{value:e})}function Sb(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var eCe=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var r=0,s=0;s<e;s++)r+=this.groupSizes[s];return r},t.prototype.insertRules=function(e,r){if(e>=this.groupSizes.length){for(var s=this.groupSizes,c=s.length,d=c;e>=d;)if((d<<=1)<0)throw Sb(16,"".concat(e));this.groupSizes=new Uint32Array(d),this.groupSizes.set(s),this.length=d;for(var _=c;_<d;_++)this.groupSizes[_]=0}for(var x=this.indexOfGroup(e+1),a=(_=0,r.length);_<a;_++)this.tag.insertRule(x,r[_])&&(this.groupSizes[e]++,x++)},t.prototype.clearGroup=function(e){if(e<this.length){var r=this.groupSizes[e],s=this.indexOfGroup(e),c=s+r;this.groupSizes[e]=0;for(var d=s;d<c;d++)this.tag.deleteRule(s)}},t.prototype.getGroup=function(e){var r="";if(e>=this.length||this.groupSizes[e]===0)return r;for(var s=this.groupSizes[e],c=this.indexOfGroup(e),d=c+s,_=c;_<d;_++)r+="".concat(this.tag.getRule(_)).concat(oL);return r},t}(),FE=new Map,aI=new Map,BE=1,rE=function(t){if(FE.has(t))return FE.get(t);for(;aI.has(BE);)BE++;var e=BE++;return FE.set(t,e),aI.set(e,t),e},tCe=function(t,e){BE=e+1,FE.set(t,e),aI.set(e,t)},nCe="style[".concat(Vy,"][").concat(TX,'="').concat(dA,'"]'),rCe=new RegExp("^".concat(Vy,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),iCe=function(t,e,r){for(var s,c=r.split(","),d=0,_=c.length;d<_;d++)(s=c[d])&&t.registerName(e,s)},sCe=function(t,e){for(var r,s=((r=e.textContent)!==null&&r!==void 0?r:"").split(oL),c=[],d=0,_=s.length;d<_;d++){var x=s[d].trim();if(x){var a=x.match(rCe);if(a){var I=0|parseInt(a[1],10),M=a[2];I!==0&&(tCe(M,I),iCe(t,M,a[3]),t.getTag().insertRules(I,c)),c.length=0}else c.push(x)}}},n8=function(t){for(var e=document.querySelectorAll(nCe),r=0,s=e.length;r<s;r++){var c=e[r];c&&c.getAttribute(Vy)!==wX&&(sCe(t,c),c.parentNode&&c.parentNode.removeChild(c))}};function oCe(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var MX=function(t){var e=document.head,r=t||e,s=document.createElement("style"),c=function(x){var a=Array.from(x.querySelectorAll("style[".concat(Vy,"]")));return a[a.length-1]}(r),d=c!==void 0?c.nextSibling:null;s.setAttribute(Vy,wX),s.setAttribute(TX,dA);var _=oCe();return _&&s.setAttribute("nonce",_),r.insertBefore(s,d),s},aCe=function(){function t(e){this.element=MX(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(r){if(r.sheet)return r.sheet;for(var s=document.styleSheets,c=0,d=s.length;c<d;c++){var _=s[c];if(_.ownerNode===r)return _}throw Sb(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,r){try{return this.sheet.insertRule(r,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var r=this.sheet.cssRules[e];return r&&r.cssText?r.cssText:""},t}(),lCe=function(){function t(e){this.element=MX(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,r){if(e<=this.length&&e>=0){var s=document.createTextNode(r);return this.element.insertBefore(s,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),cCe=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,r){return e<=this.length&&(this.rules.splice(e,0,r),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),r8=oI,uCe={isServer:!oI,useCSSOMInjection:!BIe},kX=function(){function t(e,r,s){e===void 0&&(e=$y),r===void 0&&(r={});var c=this;this.options=Ba(Ba({},uCe),e),this.gs=r,this.names=new Map(s),this.server=!!e.isServer,!this.server&&oI&&r8&&(r8=!1,n8(this)),lL(this,function(){return function(d){for(var _=d.getTag(),x=_.length,a="",I=function(D){var L=function(U){return aI.get(U)}(D);if(L===void 0)return"continue";var G=d.names.get(L),Q=_.getGroup(D);if(G===void 0||!G.size||Q.length===0)return"continue";var re="".concat(Vy,".g").concat(D,'[id="').concat(L,'"]'),ee="";G!==void 0&&G.forEach(function(U){U.length>0&&(ee+="".concat(U,","))}),a+="".concat(Q).concat(re,'{content:"').concat(ee,'"}').concat(oL)},M=0;M<x;M++)I(M);return a}(c)})}return t.registerId=function(e){return rE(e)},t.prototype.rehydrate=function(){!this.server&&oI&&n8(this)},t.prototype.reconstructWithOptions=function(e,r){return r===void 0&&(r=!0),new t(Ba(Ba({},this.options),e),this.gs,r&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(r){var s=r.useCSSOMInjection,c=r.target;return r.isServer?new cCe(c):s?new aCe(c):new lCe(c)}(this.options),new eCe(e)));var e},t.prototype.hasNameForId=function(e,r){return this.names.has(e)&&this.names.get(e).has(r)},t.prototype.registerName=function(e,r){if(rE(e),this.names.has(e))this.names.get(e).add(r);else{var s=new Set;s.add(r),this.names.set(e,s)}},t.prototype.insertRules=function(e,r,s){this.registerName(e,r),this.getTag().insertRules(rE(e),s)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(rE(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),hCe=/&/g,dCe=/^\s*\/\/.*$/gm;function OX(t,e){return t.map(function(r){return r.type==="rule"&&(r.value="".concat(e," ").concat(r.value),r.value=r.value.replaceAll(",",",".concat(e," ")),r.props=r.props.map(function(s){return"".concat(e," ").concat(s)})),Array.isArray(r.children)&&r.type!=="@keyframes"&&(r.children=OX(r.children,e)),r})}function fCe(t){var e,r,s,c=$y,d=c.options,_=d===void 0?$y:d,x=c.plugins,a=x===void 0?fA:x,I=function(L,G,Q){return Q.startsWith(r)&&Q.endsWith(r)&&Q.replaceAll(r,"").length>0?".".concat(e):L},M=a.slice();M.push(function(L){L.type===lA&&L.value.includes("&")&&(L.props[0]=L.props[0].replace(hCe,r).replace(s,I))}),_.prefix&&M.push(NIe),M.push(DIe);var D=function(L,G,Q,re){G===void 0&&(G=""),Q===void 0&&(Q=""),re===void 0&&(re="&"),e=re,r=G,s=new RegExp("\\".concat(r,"\\b"),"g");var ee=L.replace(dCe,""),U=kIe(Q||G?"".concat(Q," ").concat(G," { ").concat(ee," }"):ee);_.namespace&&(U=OX(U,_.namespace));var H=[];return sI(U,LIe(M.concat(zIe(function(Z){return H.push(Z)})))),H};return D.hash=a.length?a.reduce(function(L,G){return G.name||Sb(15),Q_(L,G.name)},SX).toString():"",D}var pCe=new kX,P4=fCe(),DX=Gr.createContext({shouldForwardProp:void 0,styleSheet:pCe,stylis:P4});DX.Consumer;Gr.createContext(void 0);function i8(){return Y.useContext(DX)}var mCe=function(){function t(e,r){var s=this;this.inject=function(c,d){d===void 0&&(d=P4);var _=s.name+d.hash;c.hasNameForId(s.id,_)||c.insertRules(s.id,_,d(s.rules,_,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=r,lL(this,function(){throw Sb(12,String(s.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=P4),this.name+e.hash},t}(),gCe=function(t){return t>="A"&&t<="Z"};function s8(t){for(var e="",r=0;r<t.length;r++){var s=t[r];if(r===1&&s==="-"&&t[0]==="-")return t;gCe(s)?e+="-"+s.toLowerCase():e+=s}return e.startsWith("ms-")?"-"+e:e}var LX=function(t){return t==null||t===!1||t===""},zX=function(t){var e,r,s=[];for(var c in t){var d=t[c];t.hasOwnProperty(c)&&!LX(d)&&(Array.isArray(d)&&d.isCss||qy(d)?s.push("".concat(s8(c),":"),d,";"):jx(d)?s.push.apply(s,iI(iI(["".concat(c," {")],zX(d),!1),["}"],!1)):s.push("".concat(s8(c),": ").concat((e=c,(r=d)==null||typeof r=="boolean"||r===""?"":typeof r!="number"||r===0||e in FIe||e.startsWith("--")?String(r).trim():"".concat(r,"px")),";")))}return s};function Cm(t,e,r,s){if(LX(t))return[];if(aL(t))return[".".concat(t.styledComponentId)];if(qy(t)){if(!qy(d=t)||d.prototype&&d.prototype.isReactComponent||!e)return[t];var c=t(e);return Cm(c,e,r,s)}var d;return t instanceof mCe?r?(t.inject(r,s),[t.getName(s)]):[t]:jx(t)?zX(t):Array.isArray(t)?Array.prototype.concat.apply(fA,t.map(function(_){return Cm(_,e,r,s)})):[t.toString()]}function _Ce(t){for(var e=0;e<t.length;e+=1){var r=t[e];if(qy(r)&&!aL(r))return!1}return!0}var yCe=IX(dA),vCe=function(){function t(e,r,s){this.rules=e,this.staticRulesId="",this.isStatic=(s===void 0||s.isStatic)&&_Ce(e),this.componentId=r,this.baseHash=Q_(yCe,r),this.baseStyle=s,kX.registerId(r)}return t.prototype.generateAndInjectStyles=function(e,r,s){var c=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,r,s):"";if(this.isStatic&&!s.hash)if(this.staticRulesId&&r.hasNameForId(this.componentId,this.staticRulesId))c=gm(c,this.staticRulesId);else{var d=t8(Cm(this.rules,e,r,s)),_=C4(Q_(this.baseHash,d)>>>0);if(!r.hasNameForId(this.componentId,_)){var x=s(d,".".concat(_),void 0,this.componentId);r.insertRules(this.componentId,_,x)}c=gm(c,_),this.staticRulesId=_}else{for(var a=Q_(this.baseHash,s.hash),I="",M=0;M<this.rules.length;M++){var D=this.rules[M];if(typeof D=="string")I+=D;else if(D){var L=t8(Cm(D,e,r,s));a=Q_(a,L+M),I+=L}}if(I){var G=C4(a>>>0);r.hasNameForId(this.componentId,G)||r.insertRules(this.componentId,G,s(I,".".concat(G),void 0,this.componentId)),c=gm(c,G)}}return c},t}(),NX=Gr.createContext(void 0);NX.Consumer;var KR={};function xCe(t,e,r){var s=aL(t),c=t,d=!XR(t),_=e.attrs,x=_===void 0?fA:_,a=e.componentId,I=a===void 0?function(de,ve){var Ee=typeof de!="string"?"sc":K$(de);KR[Ee]=(KR[Ee]||0)+1;var ie="".concat(Ee,"-").concat(qIe(dA+Ee+KR[Ee]));return ve?"".concat(ve,"-").concat(ie):ie}(e.displayName,e.parentComponentId):a,M=e.displayName,D=M===void 0?function(de){return XR(de)?"styled.".concat(de):"Styled(".concat(GIe(de),")")}(t):M,L=e.displayName&&e.componentId?"".concat(K$(e.displayName),"-").concat(e.componentId):e.componentId||I,G=s&&c.attrs?c.attrs.concat(x).filter(Boolean):x,Q=e.shouldForwardProp;if(s&&c.shouldForwardProp){var re=c.shouldForwardProp;if(e.shouldForwardProp){var ee=e.shouldForwardProp;Q=function(de,ve){return re(de,ve)&&ee(de,ve)}}else Q=re}var U=new vCe(r,L,s?c.componentStyle:void 0);function H(de,ve){return function(Ee,ie,ue){var K=Ee.attrs,ge=Ee.componentStyle,_e=Ee.defaultProps,Se=Ee.foldedComponentIds,xe=Ee.styledComponentId,wt=Ee.target,ft=Gr.useContext(NX),Tt=i8(),gt=Ee.shouldForwardProp||Tt.shouldForwardProp,at=jIe(ie,ft,_e)||$y,bt=function(Pt,pn,dn){for(var yn,Mt=Ba(Ba({},pn),{className:void 0,theme:dn}),cn=0;cn<Pt.length;cn+=1){var Yt=qy(yn=Pt[cn])?yn(Mt):yn;for(var Tn in Yt)Mt[Tn]=Tn==="className"?gm(Mt[Tn],Yt[Tn]):Tn==="style"?Ba(Ba({},Mt[Tn]),Yt[Tn]):Yt[Tn]}return pn.className&&(Mt.className=gm(Mt.className,pn.className)),Mt}(K,ie,at),Zt=bt.as||wt,tt={};for(var Et in bt)bt[Et]===void 0||Et[0]==="$"||Et==="as"||Et==="theme"&&bt.theme===at||(Et==="forwardedAs"?tt.as=bt.forwardedAs:gt&&!gt(Et,Zt)||(tt[Et]=bt[Et]));var mt=function(Pt,pn){var dn=i8(),yn=Pt.generateAndInjectStyles(pn,dn.styleSheet,dn.stylis);return yn}(ge,bt),Vt=gm(Se,xe);return mt&&(Vt+=" "+mt),bt.className&&(Vt+=" "+bt.className),tt[XR(Zt)&&!EX.has(Zt)?"class":"className"]=Vt,tt.ref=ue,Y.createElement(Zt,tt)}(Z,de,ve)}H.displayName=D;var Z=Gr.forwardRef(H);return Z.attrs=G,Z.componentStyle=U,Z.displayName=D,Z.shouldForwardProp=Q,Z.foldedComponentIds=s?gm(c.foldedComponentIds,c.styledComponentId):"",Z.styledComponentId=L,Z.target=s?c.target:t,Object.defineProperty(Z,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(de){this._foldedDefaultProps=s?function(ve){for(var Ee=[],ie=1;ie<arguments.length;ie++)Ee[ie-1]=arguments[ie];for(var ue=0,K=Ee;ue<K.length;ue++)A4(ve,K[ue],!0);return ve}({},c.defaultProps,de):de}}),lL(Z,function(){return".".concat(Z.styledComponentId)}),d&&RX(Z,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),Z}function o8(t,e){for(var r=[t[0]],s=0,c=e.length;s<c;s+=1)r.push(e[s],t[s+1]);return r}var a8=function(t){return Object.assign(t,{isCss:!0})};function bCe(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(qy(t)||jx(t))return a8(Cm(o8(fA,iI([t],e,!0))));var s=t;return e.length===0&&s.length===1&&typeof s[0]=="string"?Cm(s):a8(Cm(o8(s,e)))}function R4(t,e,r){if(r===void 0&&(r=$y),!e)throw Sb(1,e);var s=function(c){for(var d=[],_=1;_<arguments.length;_++)d[_-1]=arguments[_];return t(e,r,bCe.apply(void 0,iI([c],d,!1)))};return s.attrs=function(c){return R4(t,e,Ba(Ba({},r),{attrs:Array.prototype.concat(r.attrs,c).filter(Boolean)}))},s.withConfig=function(c){return R4(t,e,Ba(Ba({},r),c))},s}var FX=function(t){return R4(xCe,t)},l0=FX;EX.forEach(function(t){l0[t]=FX(t)});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function lI(t,e,r,s){return new(r||(r=Promise))(function(c,d){function _(I){try{a(s.next(I))}catch(M){d(M)}}function x(I){try{a(s.throw(I))}catch(M){d(M)}}function a(I){I.done?c(I.value):new r(function(M){M(I.value)}).then(_,x)}a((s=s.apply(t,[])).next())})}function cI(t,e){var r={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},s,c,d,_;return _={next:x(0),throw:x(1),return:x(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function x(I){return function(M){return a([I,M])}}function a(I){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,c&&(d=I[0]&2?c.return:I[0]?c.throw||((d=c.return)&&d.call(c),0):c.next)&&!(d=d.call(c,I[1])).done)return d;switch(c=0,d&&(I=[I[0]&2,d.value]),I[0]){case 0:case 1:d=I;break;case 4:return r.label++,{value:I[1],done:!1};case 5:r.label++,c=I[1],I=[0];continue;case 7:I=r.ops.pop(),r.trys.pop();continue;default:if(d=r.trys,!(d=d.length>0&&d[d.length-1])&&(I[0]===6||I[0]===2)){r=0;continue}if(I[0]===3&&(!d||I[1]>d[0]&&I[1]<d[3])){r.label=I[1];break}if(I[0]===6&&r.label<d[1]){r.label=d[1],d=I;break}if(d&&r.label<d[2]){r.label=d[2],r.ops.push(I);break}d[2]&&r.ops.pop(),r.trys.pop();continue}I=e.call(t,r)}catch(M){I=[6,M],c=0}finally{s=d=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}}function Ib(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var wCe=l0.div(c8||(c8=Ib([`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`],[`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
`]))),TCe=l0.div(u8||(u8=Ib([`
  width: 100%;
  `,`
`],[`
  width: 100%;
  `,`
`])),function(t){var e=t.aspectRatio;return e==="cover"?`
    position: absolute;
    bottom: 0;
    top: 0;
    left: 0;
    right: 0;`:`
    position: relative;
    padding-bottom: `+100/e+"%;"}),l8=l0.div(h8||(h8=Ib([`
  padding: 40px;
`],[`
  padding: 40px;
`]))),ECe=l0.video(d8||(d8=Ib([`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`],[`
  width: 100%;
  height: 100%;
  object-fit: cover;
  z-index: 0;
  transform: rotateY(`,`);
`])),function(t){var e=t.mirrored;return e?"180deg":"0deg"}),SCe=l0.canvas(f8||(f8=Ib([`
  display: none;
`],[`
  display: none;
`]))),c8,u8,h8,d8,f8,BX=Gr.forwardRef(function(t,e){var r=t.facingMode,s=r===void 0?"user":r,c=t.aspectRatio,d=c===void 0?"cover":c,_=t.numberOfCamerasCallback,x=_===void 0?function(){return null}:_,a=t.videoSourceDeviceId,I=a===void 0?void 0:a,M=t.errorMessages,D=M===void 0?{noCameraAccessible:"No camera device accessible. Please connect your camera or try a different browser.",permissionDenied:"Permission denied. Please refresh and give camera permission.",switchCamera:"It is not possible to switch camera to different one because there is only one video device accessible.",canvas:"Canvas is not supported."}:M,L=t.videoReadyCallback,G=L===void 0?function(){return null}:L,Q=Y.useRef(null),re=Y.useRef(null),ee=Y.useRef(null),U=Y.useRef(null),H=Y.useState(0),Z=H[0],de=H[1],ve=Y.useState(null),Ee=ve[0],ie=ve[1],ue=Y.useState(s),K=ue[0],ge=ue[1],_e=Y.useState(!1),Se=_e[0],xe=_e[1],wt=Y.useState(!1),ft=wt[0],Tt=wt[1],gt=Y.useState(!1),at=gt[0],bt=gt[1],Zt=Y.useState(!1),tt=Zt[0],Et=Zt[1],mt=Y.useRef(!1);Y.useEffect(function(){return mt.current=!0,function(){mt.current=!1}},[]),Y.useEffect(function(){x(Z)},[Z]);var Vt=function(Pt){return Pt===void 0&&(Pt=!1),lI(void 0,void 0,void 0,function(){var pn,dn;return cI(this,function(yn){switch(yn.label){case 0:if(!(Ee&&(navigator!=null&&navigator.mediaDevices)&&mt.current))return[3,4];if(pn=navigator.mediaDevices.getSupportedConstraints(),dn=Ee.getTracks()[0],!(pn&&"torch"in pn&&dn))return[3,4];yn.label=1;case 1:return yn.trys.push([1,3,,4]),[4,dn.applyConstraints({advanced:[{torch:Pt}]})];case 2:return yn.sent(),[2,!0];case 3:return yn.sent(),[2,!1];case 4:return[2,!1]}})})};return Y.useEffect(function(){Vt(tt)},[tt]),Y.useImperativeHandle(e,function(){return{takePhoto:function(Pt){var pn,dn,yn,Mt,cn;if(Z<1)throw new Error(D.noCameraAccessible);if(re!=null&&re.current){var Yt=((pn=Q==null?void 0:Q.current)===null||pn===void 0?void 0:pn.videoWidth)||1280,Tn=((dn=Q==null?void 0:Q.current)===null||dn===void 0?void 0:dn.videoHeight)||720,xr=Yt/Tn,On=((yn=U==null?void 0:U.current)===null||yn===void 0?void 0:yn.offsetWidth)||1280,fr=((Mt=U==null?void 0:U.current)===null||Mt===void 0?void 0:Mt.offsetHeight)||1280,Lr=On/fr,or=void 0,Yn=void 0,ke=void 0,He=void 0,lt=void 0;switch(xr>Lr?(He=Tn,ke=Tn*Lr,or=(Yt-ke)/2,Yn=0):(ke=Yt,He=Yt/Lr,or=0,Yn=(Tn-He)/2),re.current.width=ke,re.current.height=He,ee.current||(ee.current=re.current.getContext("2d",{willReadFrequently:!0})),ee.current&&(Q!=null&&Q.current)&&ee.current.drawImage(Q.current,or,Yn,ke,He,0,0,ke,He),Pt){case"imgData":lt=(cn=ee.current)===null||cn===void 0?void 0:cn.getImageData(0,0,ke,He);break;default:lt=re.current.toDataURL("image/jpeg");break}return lt}else throw new Error(D.canvas)},switchCamera:function(){if(Z<1)throw new Error(D.noCameraAccessible);Z<2&&console.error("Error: Unable to switch camera. Only one device is accessible.");var Pt=K==="user"?"environment":"user";return ge(Pt),Pt},getNumberOfCameras:function(){return Z},toggleTorch:function(){var Pt=!tt;return Et(Pt),Pt},torchSupported:at}}),Y.useEffect(function(){CCe(Ee,ie,K,I,de,xe,Tt,!!mt.current)},[K,I]),Y.useEffect(function(){return Vt(!1).then(function(Pt){return bt(Pt)}),Ee&&Q&&Q.current&&(Q.current.srcObject=Ee),function(){Ee&&Ee.getTracks().forEach(function(Pt){Pt.stop()})}},[Ee]),Gr.createElement(TCe,{ref:U,aspectRatio:d},Gr.createElement(wCe,null,Se?Gr.createElement(l8,null,D.noCameraAccessible):null,ft?Gr.createElement(l8,null,D.permissionDenied):null,Gr.createElement(ECe,{ref:Q,id:"video",muted:!0,autoPlay:!0,playsInline:!0,mirrored:K==="user",onLoadedData:function(){G()}}),Gr.createElement(SCe,{ref:re})))});BX.displayName="Camera";var ICe=function(t){return lI(void 0,void 0,void 0,function(){var e;return cI(this,function(r){switch(r.label){case 0:return e=[],t!=="environment"?[3,2]:[4,navigator.mediaDevices.enumerateDevices().then(function(s){var c=s.filter(function(d){return d.kind=="videoinput"});c.forEach(function(d){var _=d.getCapabilities();_.facingMode&&_.facingMode.indexOf("environment")>=0&&_.deviceId&&e.push(_.deviceId)})})];case 1:r.sent(),r.label=2;case 2:return e.length>1?[2,e.pop()]:[2,void 0]}})})},CCe=function(t,e,r,s,c,d,_,x){return lI(void 0,void 0,void 0,function(){var a,I,M,D,L;return cI(this,function(G){switch(G.label){case 0:return t&&t.getTracks().forEach(function(Q){Q.stop()}),[4,ICe(r)];case 1:return I=G.sent(),I?a=I:a=s?{exact:s}:void 0,M={audio:!1,video:{deviceId:a,facingMode:r}},!((L=navigator==null?void 0:navigator.mediaDevices)===null||L===void 0)&&L.getUserMedia?navigator.mediaDevices.getUserMedia(M).then(function(Q){x&&e(p8(Q,c))}).catch(function(Q){m8(Q,d,_)}):(D=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,D?D(M,function(Q){return lI(void 0,void 0,void 0,function(){return cI(this,function(re){return x&&e(p8(Q,c)),[2]})})},function(Q){m8(Q,d,_)}):d(!0)),[2]}})})},p8=function(t,e){return navigator.mediaDevices.enumerateDevices().then(function(r){return e(r.filter(function(s){return s.kind==="videoinput"}).length)}),t},m8=function(t,e,r){console.error(t),t.name==="PermissionDeniedError"?r(!0):e(!0)};const ACe=()=>{const[t,e]=Y.useState(null),[r,s]=Y.useState("1:1"),[c,d]=Y.useState(""),[_,x]=Y.useState(!1),[a,I]=Y.useState({x:0,y:0}),[M,D]=Y.useState(""),[L,G]=Y.useState("user"),[Q,re]=Y.useState(!1),[ee,U]=Y.useState(null),H=fX(),Z=Km(),de=Y.useRef(null),ve=Y.useRef(null),Ee=Y.useRef(null),ie=Y.useCallback(()=>{if(de.current){const ft=de.current.takePhoto(),Tt=new Image;Tt.onload=()=>{const gt=document.createElement("canvas");gt.width=Tt.width,gt.height=Tt.height,gt.getContext("2d").drawImage(Tt,0,0,Tt.width,Tt.height);const bt=gt.toDataURL("image/png",1);e(bt),D(new Date().toLocaleTimeString())},Tt.src=ft}},[]),ue=ft=>{s(ft),re(!1),K(ft)},K=ft=>{if(ve.current){const Tt=ve.current.getBoundingClientRect(),[gt,at]=ft.split(":").map(Number);let bt,Zt;Tt.width/Tt.height>gt/at?(Zt=Tt.height,bt=Zt*gt/at):(bt=Tt.width,Zt=bt*at/gt),bt=Math.min(bt,Tt.width),Zt=Math.min(Zt,Tt.height),setCropSize({width:bt,height:Zt}),I({x:(Tt.width-bt)/2,y:(Tt.height-Zt)/2})}},ge=async()=>{x(!0);try{const ft=xW(rge,`quest_images/${Date.now()}_${Wt.currentUser.uid}.jpg`);await Qme(ft,t,"data_url");const gt={imageUrl:await vW(ft),aspectRatio:r,time:new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),user:(H==null?void 0:H.name)||"Anonymous",description:c,createdAt:new Date().toISOString(),userId:Wt.currentUser.uid};await Tx(vi(wn,"quests"),gt),Z("/home/*")}catch(ft){console.error("Error uploading quest:",ft)}finally{x(!1)}},_e=ft=>{if(Ee.current&&ve.current){const Tt=ve.current.getBoundingClientRect(),gt=Ee.current.getBoundingClientRect();let at=ft.clientX-Tt.left-gt.width/2,bt=ft.clientY-Tt.top-gt.height/2;at=Math.max(0,Math.min(at,Tt.width-gt.width)),bt=Math.max(0,Math.min(bt,Tt.height-gt.height)),I({x:at,y:bt})}},Se=()=>{t?(e(null),re(!1)):Z("/home/*")},xe=()=>{G(ft=>ft==="user"?"environment":"user")},wt=()=>{re(!1),K(r)};return Y.useEffect(()=>{if(ve.current&&Ee.current){const ft=ve.current.getBoundingClientRect(),Tt=Ee.current.getBoundingClientRect();I({x:(ft.width-Tt.width)/2,y:(ft.height-Tt.height)/2})}},[r]),F.jsxs("div",{className:"camera-overlay1 fullscreen1",children:[ee&&F.jsx("div",{className:"camera-error",children:ee}),t?F.jsxs("div",{className:"image-preview-overlay",children:[F.jsxs("div",{className:"image-preview",onMouseMove:_e,children:[F.jsx("img",{ref:ve,src:t,alt:"Captured",className:"captured-image"}),F.jsx("div",{ref:Ee,className:`crop-outline ${Q?"finalized":""}`,style:{aspectRatio:r,left:`${a.x}px`,top:`${a.y}px`},children:F.jsx(ube,{className:"crop-icon1"})})]}),F.jsxs("div",{className:"controls-container",children:[F.jsx("div",{className:"aspect-ratio-selector",children:["1:1","4:5","9:16"].map(ft=>F.jsx(Z_,{variant:r===ft?"contained":"outlined",onClick:()=>ue(ft),className:"aspect-ratio-button1",disabled:Q,children:ft},ft))}),Q&&F.jsx(Z_,{variant:"outlined",onClick:wt,className:"reset-crop-button",startIcon:F.jsx(fbe,{}),children:"Reset Crop"}),F.jsx(bH,{fullWidth:!0,variant:"outlined",placeholder:"Add a description...",value:c,onChange:ft=>d(ft.target.value),className:"description-input"}),F.jsx(Z_,{variant:"contained",color:"primary",onClick:ge,disabled:_||!Q,className:"confirm-btn",children:"Done"})]}),F.jsx(Z_,{onClick:Se,className:"back-bttn",children:"Cancel"})]}):F.jsxs(F.Fragment,{children:[F.jsx(BX,{ref:de,facingMode:L,aspectRatio:"cover",errorMessages:{},videoSourceDeviceId:void 0,numberOfCamerasCallback:ft=>console.log(ft),videoResolution:"highest",onError:ft=>U("Could not start video source. Please check your camera permissions.")}),F.jsxs("div",{className:"camera-controls",children:[F.jsx(mm,{onClick:Se,className:"back-button1",children:F.jsx(wH,{})}),F.jsx(mm,{onClick:ie,className:"capture-button",children:F.jsx("div",{className:"capture-button-inner"})}),F.jsx(mm,{onClick:xe,className:"flip-button",children:F.jsx(hbe,{})})]})]})]})},PCe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M380-320q-109%200-184.5-75.5T120-580q0-109%2075.5-184.5T380-840q109%200%20184.5%2075.5T640-580q0%2044-14%2083t-38%2069l224%20224q11%2011%2011%2028t-11%2028q-11%2011-28%2011t-28-11L532-372q-30%2024-69%2038t-83%2014Zm0-80q75%200%20127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75%200-127.5%2052.5T200-580q0%2075%2052.5%20127.5T380-400Z'/%3e%3c/svg%3e",RCe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M459-381%20314-526q-3-3-4.5-6.5T308-540q0-8%205.5-14t14.5-6h304q9%200%2014.5%206t5.5%2014q0%202-6%2014L501-381q-5%205-10%207t-11%202q-6%200-11-2t-10-7Z'/%3e%3c/svg%3e",MCe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h200q17%200%2028.5%2011.5T440-800q0%2017-11.5%2028.5T400-760H200v560h560v-200q0-17%2011.5-28.5T800-440q17%200%2028.5%2011.5T840-400v200q0%2033-23.5%2056.5T760-120H200Zm440-520h-80q-17%200-28.5-11.5T520-680q0-17%2011.5-28.5T560-720h80v-80q0-17%2011.5-28.5T680-840q17%200%2028.5%2011.5T720-800v80h80q17%200%2028.5%2011.5T840-680q0%2017-11.5%2028.5T800-640h-80v80q0%2017-11.5%2028.5T680-520q-17%200-28.5-11.5T640-560v-80Z'/%3e%3c/svg%3e",g8="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M480-320q75%200%20127.5-52.5T660-500q0-75-52.5-127.5T480-680q-75%200-127.5%2052.5T300-500q0%2075%2052.5%20127.5T480-320Zm.18-93q-36.18%200-61.68-25.32-25.5-25.33-25.5-61.5%200-36.18%2025.32-61.68%2025.33-25.5%2061.5-25.5%2036.18%200%2061.68%2025.32%2025.5%2025.33%2025.5%2061.5%200%2036.18-25.32%2061.68-25.33%2025.5-61.5%2025.5ZM480-169q-140%200-256.5-74T41-441q-8-14-11.5-29T26-500q0-15%203.5-30T41-559q66-124%20182.5-198T480-831q140%200%20256.5%2074T919-559q8%2014%2011.5%2029t3.5%2030q0%2015-3.5%2030T919-441q-66%20124-182.5%20198T480-169Zm0-331Zm.09%20220Q592-280%20685.5-340T829-500q-50-100-143.59-160t-205.5-60Q368-720%20274.5-660T131-500q50%20100%20143.59%20160t205.5%2060Z'/%3e%3c/svg%3e",_8="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M607-627q15%2015%2027%2036.5t19%2044.5q0%2022-15%2037t-37%2015q-22%200-37-15t-15-37q2-7%200-12.5t-7-10.5q-5-5-10.5-7.5T518-577q-20%200-34.5-15T469-627q0-20%2014.5-34.5T518-676q25%205%2047%2017t42%2032Zm-127-93q-10%200-19.5.5T441-718q-23%202-43-10t-26-35q-6-23%206-42t35-22q17-2%2033.5-3t33.5-1q144%200%20264.5%2076.5T928-547q5%2011%208%2023t3%2024q0%2012-2%2024.5t-7%2023.5q-17%2034-39%2064.5T843-329q-15%2017-37.5%2015T768-333q-15-17-14-40t16-40q17-20%2032-42t28-45q-52-100-145-160t-205-60Zm0%20551q-140%200-257.5-74.5T39-443q-7-14-10.5-28T25-500q0-15%203-29.5T38-558q18-37%2042.5-69.5T134-689l-73-73q-14-14-14-33t14-33q14-14%2033.5-14t33.5%2014l685%20685q14%2014%2014%2033t-14%2033q-14%2014-33%2014t-33-14L630-193q-36%2013-74%2018.5t-76%205.5ZM213-613q-25%2026-45%2054t-37%2059q50%20101%20143.5%20160.5T480-280q15%200%2030-1.5t30-3.5l-36-38q-6%202-12%202.5t-12%20.5q-75%200-127.5-52.5T300-500v-12q0-6%201-12l-88-89Zm343%2074Zm-180%2090Z'/%3e%3c/svg%3e",y8="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M9-257q0-43.3%2022.7-79.6Q54.39-372.9%2092-392q65-32%20132.96-48.5Q292.92-457%20363-457q72%200%20140%2016t131%2048q37.61%2018.96%2060.3%2054.98Q717-302%20717-257v22q0%2053-36.5%2089.5T591-109H135q-53%200-89.5-36.5T9-235v-22Zm816%20148h-71q22-27%2032.5-59t10.5-67v-22q0-51-24.5-105T689-454q44%207%2091.5%2024t85.5%2037q40%2020%2062.5%2055.81T951-259v24q0%2053-36.5%2089.5T825-109ZM363-497q-74%200-125.5-51.5T186-674q0-74%2051.5-125.5T363-851q74%200%20125.5%2051.5T540-674q0%2074-51.5%20125.5T363-497Zm449-177.01Q812-601%20760.05-549q-51.94%2052-124.89%2052-12.16%200-28.16-3t-31-8q29-34%2044-76.85%2015-42.85%2015-89T620-763q-15-43-44-77%2015-6%2029-8.5t29.53-2.5q73.21%200%20125.34%2051.99%2052.13%2051.99%2052.13%20125ZM135-235h456v-17q0-10.03-5.5-18.24-5.5-8.2-14.5-12.76-48-23-100-35.5T363-331q-54%200-108%2012.5T155-283q-9%204.56-14.5%2012.76-5.5%208.21-5.5%2018.24v17Zm227.84-373q27.16%200%2046.66-19.34%2019.5-19.34%2019.5-46.5t-19.34-46.66q-19.34-19.5-46.5-19.5t-46.66%2019.34q-19.5%2019.34-19.5%2046.5t19.34%2046.66q19.34%2019.5%2046.5%2019.5Zm.16%20373Zm0-439Z'/%3e%3c/svg%3e",kCe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M472-480%20332-620q-18-18-18-44t18-44q18-18%2044-18t44%2018l183%20183q9%209%2014%2021t5%2024q0%2012-5%2024t-14%2021L420-252q-18%2018-44%2018t-44-18q-18-18-18-44t18-44l140-140Z'/%3e%3c/svg%3e",OCe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='m480-413%20100%20100q14%2014%2033.5%2013.5T647-314q14-14%2014-33.5T647-381l-100-99%20100-100q14-14%2014-33.5T647-647q-14-14-33.5-14T580-647L480-547%20380-647q-14-14-33-14t-33%2014q-14%2014-14%2033.5t14%2033.5l99%20100-100%20100q-14%2014-13.5%2033t14.5%2033q14%2014%2033.5%2014t33.5-14l99-99Zm0%20367q-91%200-170-34t-137.5-92.5Q114-231%2080-310T46-480q0-91%2034-170t92.5-137.5Q231-846%20310-880t170-34q91%200%20170%2034t137.5%2092.5Q846-729%20880-650t34%20170q0%2091-34%20170t-92.5%20137.5Q729-114%20650-80T480-46Zm0-126q130%200%20219-89t89-219q0-130-89-219t-219-89q-130%200-219%2089t-89%20219q0%20130%2089%20219t219%2089Zm0-308Z'/%3e%3c/svg%3e",DCe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M481-105q-162%200-269-106.5T105-480q0-121%2068-222.5T375-840q23-8%2042-5.5t32.5%2012.5q13.5%2010%2019.5%2026t4%2036q-4%2022-8%2041t-4%2038q0%2097.08%2068.54%20165.04T696-459q20%200%2040.5-2.5T776-468q19-2%2033.5%203.5t23.03%2016.5q9.47%2011%2011.97%2028.5T840-379q-32%20123-131.5%20198.5T481-105Zm0-126q62%200%20115.5-28.5T683-337q-10%201-19.5%201t-18.5-2q-119-17-203-98.5T339-645q-1-9-1.5-19t1.5-19q-48%2034-77.5%2088T232-480q0%20103.16%2072.92%20176.08Q377.84-231%20481-231Zm-23-226Z'/%3e%3c/svg%3e",LCe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23e8eaed'%3e%3cpath%20d='M480-406q31%200%2052.5-21.5T554-480q0-31-21.5-52.5T480-554q-31%200-52.5%2021.5T406-480q0%2031%2021.5%2052.5T480-406Zm0%20126q-83%200-141.5-58.5T280-480q0-83%2058.5-141.5T480-680q83%200%20141.5%2058.5T680-480q0%2083-58.5%20141.5T480-280ZM80-417q-26%200-44.5-18.5T17-480q0-26%2018.5-44.5T80-543h80q26%200%2044.5%2018.5T223-480q0%2026-18.5%2044.5T160-417H80Zm720%200q-26%200-44.5-18.5T737-480q0-26%2018.5-44.5T800-543h80q26%200%2044.5%2018.5T943-480q0%2026-18.5%2044.5T880-417h-80ZM480-737q-26%200-44.5-18.5T417-800v-80q0-26%2018.5-44.5T480-943q26%200%2044.5%2018.5T543-880v80q0%2026-18.5%2044.5T480-737Zm0%20720q-26%200-44.5-18.5T417-80v-80q0-26%2018.5-44.5T480-223q26%200%2044.5%2018.5T543-160v80q0%2026-18.5%2044.5T480-17ZM210-661l-43-42q-19-18-18.5-44t18.5-46q18-19%2044-19t45%2019l43%2043q18%2018%2017.5%2043.5T299-662q-18%2019-44%2019.5T210-661Zm494%20494-43-43q-18-18-18-43.5t18-44.5q18-19%2044-18.5t45%2018.5l43%2041q19%2018%2018.5%2044T793-167q-18%2019-44%2019t-45-19Zm-42-494q-19-18-18.5-44t18.5-45l41-43q18-19%2044-18.5t46%2018.5q19%2018%2019%2044t-19%2045l-43%2043q-18%2018-43.5%2017.5T662-661ZM167-167q-19-18-19-44t19-45l43-43q18-18%2043.5-18t44.5%2018q19%2018%2018.5%2044T298-210l-41%2043q-18%2019-44%2018.5T167-167Zm313-313Z'/%3e%3c/svg%3e";function zCe(){const t=Km(),[e,r]=Y.useState(T4()),s=()=>{lX(),r(T4())};return Y.useEffect(()=>{const c=d=>{r(d.detail.isLightMode?"light":"dark")};return window.addEventListener("themeChanged",c),()=>{window.removeEventListener("themeChanged",c)}},[]),F.jsx(aA,{children:F.jsxs("div",{className:"settings-container",children:[F.jsxs("header",{children:[F.jsx(kCe,{onClick:()=>t("/home/profile")}),F.jsx("h2",{children:"Settings"})]}),F.jsxs("section",{children:[F.jsx("h3",{children:"Privacy"}),F.jsx(NCe,{})]}),F.jsxs("section",{children:[F.jsx("h3",{children:"Theme"}),F.jsxs("div",{className:"setting-option",onClick:s,children:[F.jsx("div",{children:F.jsx("p",{children:e==="light"?"Light":"Dark"})}),F.jsx("div",{className:"setting-icons",children:e==="light"?F.jsx(LCe,{}):F.jsx(DCe,{})})]})]})]})})}function NCe(){const[t,e]=Y.useState({friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),[r,s]=Y.useState(1),[c,d]=Y.useState([]),[_,x]=Y.useState(""),[a,I]=Y.useState([]);Y.useState(window.innerHeight*.5),Y.useEffect(()=>{M()},[]),Y.useEffect(()=>{const ee=(t.friendsCanSeeLocation?1:0)+(t.quietMap?2:0);s(ee)},[t.friendsCanSeeLocation,t.quietMap]);const M=async()=>{try{const U=(await $i(Xn(wn,"users",Wt.currentUser.uid))).data();e(U.privacySettings||{friendsCanSeeLocation:!0,quietMap:!1,canSeeOtherMarkers:!0,useCustomVisibilityList:!1}),d(U.customVisibilityList||[])}catch(ee){console.error("Error fetching privacy settings:",ee)}},D=()=>{const ee=(r+1)%4;switch(s(ee),ee){case 0:L("friendsCanSeeLocation",!1),L("quietMap",!1);break;case 1:L("friendsCanSeeLocation",!0),L("quietMap",!1);break;case 2:L("friendsCanSeeLocation",!1),L("quietMap",!0);break;case 3:L("friendsCanSeeLocation",!0),L("quietMap",!0);break}},L=async(ee,U)=>{try{const H={...t,[ee]:U};e(H),await us(Xn(wn,"users",Wt.currentUser.uid),{privacySettings:H})}catch(H){console.error("Error updating privacy setting:",H)}},G=async ee=>{if(x(ee.target.value),ee.target.value.length>2)try{const U=vi(wn,"users"),H=co(U,yi("username",">=",ee.target.value),yi("username","<=",ee.target.value+"")),de=(await _a(H)).docs.map(ve=>({id:ve.id,...ve.data()}));I(de)}catch(U){console.error("Error searching users:",U)}else I([])},Q=async ee=>{if(ee&&!c.some(U=>U.id===ee.id)){const U=[...c,ee];d(U),x(""),I([]);try{await us(Xn(wn,"users",Wt.currentUser.uid),{customVisibilityList:U})}catch(H){console.error("Error updating custom list:",H)}}},re=async ee=>{const U=c.filter(H=>H.id!==ee);d(U);try{await us(Xn(wn,"users",Wt.currentUser.uid),{customVisibilityList:U})}catch(H){console.error("Error updating custom list:",H)}};return F.jsxs("div",{children:[F.jsxs("div",{className:"setting-option",children:[F.jsxs("div",{children:[F.jsx("p",{children:"Location Visibility"}),F.jsx("span",{children:"Only Friends can see my Location"})]}),F.jsxs("div",{className:"setting-icons",onClick:D,children:[r===0&&F.jsx(g8,{}),r===1&&F.jsxs(F.Fragment,{children:[F.jsx(g8,{}),F.jsx(y8,{})]}),r===2&&F.jsx(_8,{}),r===3&&F.jsxs(F.Fragment,{children:[F.jsx(_8,{}),F.jsx(y8,{})]})]})]}),F.jsxs("div",{className:"setting-option",children:[F.jsxs("div",{children:[F.jsx("p",{children:"Visibility List"}),F.jsx("span",{children:"Use Custom Visibility List"})]}),F.jsx("div",{className:"setting-icons",onClick:()=>L("useCustomVisibilityList",!t.useCustomVisibilityList),children:t.useCustomVisibilityList?F.jsx(nX,{}):F.jsx(OCe,{})})]}),t.useCustomVisibilityList&&F.jsxs(F.Fragment,{children:[F.jsxs("div",{className:"search-user",children:[F.jsx("input",{type:"text",value:_,onChange:G,placeholder:"Search users..."}),F.jsx("div",{className:"search-results",children:a.map(ee=>F.jsxs("div",{className:"search-result-item",onClick:()=>Q(ee),children:[F.jsx("img",{src:ee.profilePhoto||"/default-profile.png",alt:ee.username,className:"user-avatar"}),F.jsx("span",{children:ee.username})]},ee.id))})]}),F.jsx("div",{className:"custom-list",children:c.map(ee=>F.jsxs("div",{className:"custom-list-item",children:[F.jsx("img",{src:ee.profilePhoto||"/default-profile.png",alt:ee.username,className:"user-avatar"}),F.jsx("span",{children:ee.username}),F.jsx("button",{onClick:()=>re(ee.id),children:"Remove"})]},ee.id))})]})]})}function FCe(){const t=W$.useMediaQuery({query:"(max-width: 800px)"}),e=W$.useMediaQuery({query:"(max-width: 550px)"}),r=Y.useRef(null),[s,c]=Y.useState(!1),[d,_]=Y.useState(!1);Y.useState(!1),Gr.useState(!1),Y.useEffect(()=>{const a=()=>{if(console.debug("scroll"),r.current){const I=r.current.getBoundingClientRect();c(I.bottom<48)}};return window.addEventListener("scroll",a,!0),a(),()=>{window.removeEventListener("scroll",a,!0)}},[]);const x=()=>{_(!0)};return F.jsxs("div",{className:"main-page",children:[e&&F.jsx(yIe,{show:s}),F.jsxs("div",{className:"left-panel",children:[F.jsx(pIe,{}),F.jsxs(q2,{children:[F.jsx(Dc,{path:"profile",element:F.jsx(rX,{})}),F.jsx(Dc,{path:"settings",element:F.jsx(zCe,{})}),F.jsx(Dc,{path:"connections",element:F.jsx(uX,{})}),F.jsx(Dc,{path:"camera",element:F.jsx(ACe,{})}),F.jsx(Dc,{path:"quests",element:F.jsx(iX,{isCreateQuestOpen:d,setIsCreateQuestOpen:_})})]})]}),F.jsxs("div",{className:"body-section",children:[F.jsx("div",{className:"middle-panel",children:F.jsx(_Ie,{})}),F.jsx("div",{className:"right-panel",ref:r,children:F.jsxs("div",{className:"right-panel right-panel-sticky",children:[F.jsx(pX,{}),F.jsx("div",{className:"button-section",children:t?F.jsxs(F.Fragment,{children:[F.jsx(M4,{}),F.jsx(O4,{onClick:x}),F.jsx(k4,{})]}):F.jsxs(F.Fragment,{children:[F.jsxs("div",{className:"actions-container",children:[F.jsx(M4,{}),F.jsx(k4,{})]}),F.jsx(O4,{onClick:x})]})})]})})]}),d&&F.jsx(vIe,{isOpen:d,onClose:()=>_(!1)})]})}function M4({small:t=!1}){return F.jsxs("div",{className:`search ${t&&"small"}`,children:[F.jsx("div",{className:"icon-container",children:F.jsx(PCe,{})}),!t&&F.jsx("input",{className:"search-input",type:"text",placeholder:"Find Quests"})]})}function k4({small:t=!1}){const[e,r]=Y.useState("Near You");return F.jsxs("button",{className:`filter-button ${t&&"small"}`,children:[F.jsx("div",{className:"icon-container",children:F.jsx(RCe,{})}),e]})}function O4({small:t=!1,onClick:e}){return F.jsxs("button",{className:"create-button",onClick:e,children:[F.jsx("div",{className:"icon-container",children:F.jsx(MCe,{})}),!t&&"Create Quest"]})}function BCe(){return Y.useEffect(()=>{cX()},[]),F.jsx(OTe,{children:F.jsx(jTe,{children:F.jsxs(cIe,{children:[" ",F.jsx(kne,{children:F.jsxs(q2,{children:[F.jsx(Dc,{path:"/",element:F.jsx(lIe,{})}),F.jsx(Dc,{path:"/login",element:F.jsx(gge,{})}),F.jsx(Dc,{path:"/register",element:F.jsx(_ge,{})}),F.jsx(Dc,{path:"/home/*",element:F.jsxs(F.Fragment,{children:[F.jsx(FCe,{}),F.jsx(G$,{})]})}),F.jsx(Dc,{path:"/adventure-feed",element:F.jsx(F.Fragment,{children:F.jsx(G$,{})})})]})})]})})})}k2(document.getElementById("root")).render(F.jsx(Y.StrictMode,{children:F.jsx(BCe,{})}))});export default jCe();
